!function(){"use strict";Kekule.Calculator={},Kekule.Calculator.getWorkerBasePath=function(){var e=Kekule.scriptSrcInfo.useMinFile?"workers/":"calculation/workers/";return e=Kekule.scriptSrcInfo.path+e},Kekule.Calculator.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Calculator.Base",initProperties:function(){this.defineProp("async",{dataType:DataType.BOOL}),this.defineProp("worker",{dataType:DataType.OBJECT,setter:null})},initPropValues:function($super){$super(),this.setAsync(!0),this.reactWorkerMessageBind=this.reactWorkerMessage.bind(this),this.reactWorkerErrorBind=this.reactWorkerError.bind(this)},getWorkerBasePath:function(){return Kekule.Calculator.getWorkerBasePath()},execute:function(e,r,t){if(this._doneCallback=e,this._errCallback=r,this._msgCallback=t,this.getAsync()&&this.isWorkerSupported()&&this.createWorker()){var a=this.getWorker();this.workerStartCalc(a)}else{var s,i;try{i=this.executeSync(e)}catch(e){s=e}s?(Kekule.error(s),this.error(s)):i&&(s?this.error(s):this.done())}},executeSync:function(e){},error:function(e){Kekule.error(e),this._errCallback&&this._errCallback(e)},done:function(){this._doneCallback&&this._doneCallback.apply(this,arguments),this.workerJobDone()},halt:function(){var e=this.getWorker();e&&(e.terminate(),this.error(Kekule.$L("ErrorMsg.CALC_TERMINATED_BY_USER")))},isWorkerSupported:function(){return Kekule.BrowserFeature.workers},createWorker:function(){if(this.isWorkerSupported()){var e=this.getWorkerScriptFile();if(e){var r=new Worker(e);return r.addEventListener("message",this.reactWorkerMessageBind),r.addEventListener("error",this.reactWorkerErrorBind),this.setPropStoreFieldValue("worker",r),r}}},getWorkerScriptFile:function(){return null},importWorkerScriptFile:function(e){this.postWorkerMessage({type:"importScript",url:e})},postWorkerMessage:function(e){var r=this.getWorker();r&&r.postMessage(e)},reactWorkerMessage:function(e){return this._msgCallback&&this._msgCallback(e.data),this.doReactWorkerMessage(e.data,e)},doReactWorkerMessage:function(e,r){},reactWorkerError:function(e){Kekule.error(e.message),this.error(e.message)},workerStartCalc:function(e){},workerJobDone:function(){var e=this.getWorker();e&&(e.terminate(),this.setPropStoreFieldValue("worker",null))}}),Kekule.Calculator.AbstractStructure3DGenerator=Class.create(Kekule.Calculator.Base,{CLASS_NAME:"Kekule.Calculator.AbstractStructure3DGenerator",initProperties:function(){this.defineProp("sourceMol",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("generatedMol",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("options",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("options");return e||(e={},this.setPropStoreFieldValue("options",e)),e}})}}),Kekule.Calculator.ServiceManager={_services:{},_getServiceClasses:function(r,t){var a=e._services[r];return!a&&t&&(a=[],e._services[r]=a),a},register:function(r,t){var a=e._getServiceClasses(r,!0),s=a.indexOf(t);s>=0&&a.splice(s,1),a.push(t)},unregister:function(r,t){var a=e._getServiceClasses(r,!0),s=a.indexOf(t);s>=0&&a.splice(s,1)},getServiceClass:function(r){var t=null,a=e._getServiceClasses(r);return a&&a.length&&(t=a[a.length-1]),t}};var e=Kekule.Calculator.ServiceManager;Kekule.Calculator.Services={GEN3D:"3D structure generator"},Kekule.Calculator.generate3D=function(r,t,a,s,i){var o=Kekule.Calculator.Services.GEN3D,n=e.getServiceClass(o);if(n){var l=new n,c=function(e){s&&s(e)};try{l.setSourceMol(r),l.setOptions(t),l.execute(function(){a&&a(l.getGeneratedMol())},c,function(e){i&&i(e)})}catch(e){c(e)}return l}var u=Kekule.$L("ErrorMsg.CALC_SERVICE_UNAVAILABLE").format(o);return a&&a(u),null}}();