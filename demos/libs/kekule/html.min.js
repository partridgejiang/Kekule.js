(function(i,j){var h=i;if(!h.Kekule){Kekule={}}Kekule.Browser={IE:!!(i.attachEvent&&!i.opera),Opera:!!i.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("like Gecko")<0&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),language:navigator.language||navigator.browserLanguage};Kekule.Browser.IEVersion=Kekule.Browser.IE&&(function(){var o=navigator.userAgent.toLowerCase();return(o.indexOf("msie")!==-1)?parseInt(o.split("msie")[1]):false})();Kekule.BrowserFeature={typedArray:(typeof(ArrayBuffer)!=="undefined"),svg:!!i.SVGSVGElement,canvas:!!i.CanvasRenderingContext2D,webgl:(function(){var o=(function(){try{var p=j.createElement("canvas");return !!i.WebGLRenderingContext&&(p.getContext("webgl")||p.getContext("experimental-webgl"))}catch(q){return false}})();return !!o})(),downloadHref:(function(o){return"download" in o.createElement("a")})(j),blob:!!i.Blob,workers:!!i.Worker,fileapi:!!(i.File&&i.FileReader&&i.FileList&&i.Blob),sessionStorage:(function(){try{return !!i.sessionStorage}catch(o){return false}})(),localStorage:(function(){try{return !!i.localStorage}catch(o){return false}})(),cssTransition:(function(o){return"transition" in o||"WebkitTransition" in o||"MozTransition" in o||"msTransition" in o||"OTransition" in o})(j.createElement("div").style),cssTranform:(function(o){return"transform" in o||"WebkitTransform" in o||"MozTransform" in o||"msTransform" in o||"OTransform" in o})(j.createElement("div").style),cssFlex:(function(o){return"flex" in o||"WebkitFlex" in o||"MozFlex" in o||"msFlex" in o||"OFlex" in o})(j.createElement("div").style),html5Form:{placeholder:(function(o){return"placeholder" in o})(j.createElement("input")),supportType:function(p){var q=j.createElement("input");q.setAttribute("type",p);var o=q.type===p;var s=["text","url","search"];if(o&&(s.indexOf(p.toLowerCase())<0)){var r=":)";q.value=r;o=q.value!==r}return o}},mutationObserver:i.MutationObserver||i.MozMutationObserver||i.WebkitMutationObserver,touchEvent:!!i.touchEvent,pointerEvent:!!i.PointerEvent};(function(){var p=0;var q=["ms","moz","webkit","o"];for(var o=0;o<q.length&&!i.requestAnimationFrame;++o){i.requestAnimationFrame=i[q[o]+"RequestAnimationFrame"];i.cancelAnimationFrame=i[q[o]+"CancelAnimationFrame"]||i[q[o]+"CancelRequestAnimationFrame"]}if(!i.requestAnimationFrame){i.requestAnimationFrame=function(v,s){var r=new Date().getTime();var t=Math.max(0,16-(r-p));var u=i.setTimeout(function(){v(r+t)},t);p=r+t;return u}}if(!i.cancelAnimationFrame){i.cancelAnimationFrame=function(r){clearTimeout(r)}}}());Kekule.X={};var b=Kekule.X;var l=function(p){return((p===null)||(typeof(p)==="undefined"))};var k=function(p){return !l(p)};var m=function(o){var p=i.getComputedStyle?i.getComputedStyle(o,null).position:o.currentStyle?o.currentStyle.position:null;if(!p){return false}else{if(!p){return false}else{p=p.toString().toLowerCase();return(p==="relative")||(p==="absolute")}}};b.MutationObserver=i.MutationObserver||i.MozMutationObserver||i.WebkitMutationObserver;b.Event={MOUSE_BTN_LEFT:0,MOUSE_BTN_RIGHT:2,MOUSE_BTN_MID:1,MOUSE_BTN_LR:3};b.Event.PointerType={MOUSE:"mouse",TOUCH:"touch",PEN:"pen"};b.Event.MouseButton={LEFT:0,RIGHT:2,MID:1,LR:3};b.Event.KeyCode={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRTSC:44,INS:45,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145};b.Event.isSupported=(function(){var o={};return function(q){if(q.indexOf("touch")===0){return Kekule.BrowserFeature.touchEvent}if(q.indexOf("pointer")===0){return Kekule.BrowserFeature.pointerEvent}var s={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img",unload:"win",resize:"win"},t=q.replace(/^on/,"");if(o[t]){return o[t]}var r=s[t]=="win"?i:j.createElement(s[t]||"div");q="on"+t;var p=(q in r);if(!p){r.setAttribute(q,"return;");p=typeof r[q]=="function"}r=null;o[t]=p;return p}})();b.Event.Methods={getType:function(o){return o.__$type__||o.type},setType:function(o,p){o.__$type__=p;try{o.type=p}catch(q){}},getPointerType:function(o){return o.pointerType},getTarget:function(o){var p=o.__$target__||o.target||o.srcElement;if(p.nodeType==3){p=p.parentNode}return p},setTarget:function(o,q){o.__$target__=q;try{o.target=q}catch(p){}},getCurrentTarget:function(o){return o.currentTarget},getEventPhase:function(o){return o.eventPhase},getAltKey:function(o){return o.altKey},getCtrlKey:function(o){return o.ctrlKey},getShiftKey:function(o){return o.shiftKey},getCharCode:function(o){return k(o.charCode)?o.charCode:o.keyCode},getKeyCode:function(o){return o.keyCode},getClientX:function(p){var o;if(p.touches){var q=p.touches[0];o=q&&q.clientX}if(o===undefined){o=p.clientX}return o},getClientY:function(p){var o;if(p.touches){var q=p.touches[0];o=q&&q.clientY}if(o===undefined){o=p.clientY}return o},getScreenX:function(p){var o;if(p.touches){var q=p.touches[0];o=q&&q.screenX}if(o===undefined){o=p.screenX}return o},getScreenY:function(p){var o;if(p.touches){var q=p.touches[0];o=q&&q.screenY}if(o===undefined){o=p.screenY}return o},getPageX:function(q){var p;if(q.touches){var s=q.touches[0];if(s&&k(s.pageX)){p=s.pageX}}if(p===undefined&&k(q.pageX)){p=q.pageX}if(p===undefined){var r=b.Event.getTarget(q).ownerDocument||b.Event.getTarget(q);var o=r?r.body:null;p=b.Event.getClientX(q)+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0)}return p},getPageY:function(q){var p;if(q.touches){var s=q.touches[0];if(s&&k(s.pageY)){return s.pageY}}else{if(p===undefined&&k(q.pageY)){return q.pageY}}if(p===undefined){var r=b.Event.getTarget(q).ownerDocument||b.Event.getTarget(q);var o=r?r.body:null;p=b.Event.getClientY(q)+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)}return p},getOffsetX:function(q){if(k(q.offsetX)){return q.offsetX}else{var p=b.Event.getTarget(q);if((p.defaultView||p.parentWindow)&&p.body){p=p.body}if(k(q.layerX)&&m(p)&&!q.touches){return q.layerX}else{var o=b.Event.getClientX(q);return Math.round(o-Kekule.HtmlElementUtils.getElemPagePos(p,true).x)}}},getOffsetY:function(q){if(k(q.offsetY)){return q.offsetY}else{var p=b.Event.getTarget(q);if((p.defaultView||p.parentWindow)&&p.body){p=p.body}if(k(q.layerY)&&m(p)&&!q.touches){return q.layerY}else{var o=b.Event.getClientY(q);return Math.round(o-Kekule.HtmlElementUtils.getElemPagePos(p,true).y)}}},getOffsetCoord:function(o,w){var s=b.Event.getTarget(o);var t;if(w&&Kekule.ObjUtils.isUnset(o.offsetX)){t=Kekule.StyleUtils.getTotalTransformMatrix(s)}if(t){var q=b.Event.getClientX(o);var p=b.Event.getClientY(o);var u={x:q-Kekule.HtmlElementUtils.getElemBoundingClientRect(s).x,y:p-Kekule.HtmlElementUtils.getElemBoundingClientRect(s).y};var v=Kekule.StyleUtils.calcInvertTransformMatrix(t);if(v){var r=Kekule.MatrixUtils.create(3,1);r[0][0]=u.x;r[1][0]=u.y;r[2][0]=1;var x=Kekule.MatrixUtils.multiply(v,r);u.x=x[0][0];u.y=x[1][0];return u}}return{x:b.Event.getOffsetX(o),y:b.Event.getOffsetY(o)}},getWindowX:function(p){var o=b.Event.getPageX(p);var r=p.target.ownerDocument||p.target;var q=r&&(r.defaultView||r.parentWindow);var s=(q&&q.scrollX)||0;return o-s},getWindowY:function(o){var s=b.Event.getPageY(o);var q=o.target.ownerDocument||o.target;var p=q&&(q.defaultView||q.parentWindow);var r=(p&&p.scrollY)||0;return s-r},getRelXToCurrTarget:function(q){var p=b.Event.getCurrentTarget(q);if((p.defaultView||p.parentWindow)&&p.body){p=p.body}var o=b.Event.getClientX(q);return Math.round(o-Kekule.HtmlElementUtils.getElemPagePos(p,true).left)},getRelYToCurrTarget:function(q){var p=b.Event.getCurrentTarget(q);if((p.defaultView||p.parentWindow)&&p.body){p=p.body}var o=b.Event.getClientY(q);return Math.round(o-Kekule.HtmlElementUtils.getElemPagePos(p,true).top)},getTouches:function(o){return o.touches}};b.Event._MouseEventEx={isMouseEnterLeaveEvent:function(o){return(o==="mouseenter")||(o==="mouseleave")},addMouseEnterLeaveListener:function(s,r,t,o){var q=((r==="mouseenter")&&b.Event.isSupported("mouseenter"))||((r==="mouseleave")&&b.Event.isSupported("mouseleave"));if(q){return s.addEventListener(r,t,o)}else{var u=function(z){var y=z.getTarget?z.getTarget():z.target;var v=z.getCurrentTarget?z.getCurrentTarget():z.currentTarget;if((y===v)||(Kekule.DomUtils.isDescendantOf(y,v))){var x=z.getRelatedTarget?z.getRelatedTarget():z.relatedTarget;if((!x)||(!Kekule.DomUtils.isDescendantOf(x,v))){var w=new MouseEvent(r,{view:i,bubbles:false,cancelable:true,target:v,currentTarget:v,relatedTarget:x});t.call(v,w)}}};t.__$mouseExListenerWrapper__=u;var p=(r==="mouseenter")?"mouseover":"mouseout";return s.addEventListener(p,u,o)}},removeMouseEnterLeaveListener:function(r,q,s){var p=((q==="mouseenter")&&b.Event.isSupported("mouseenter"))||((q==="mouseleave")&&b.Event.isSupported("mouseleave"));if(p){return r.removeEventListener(q,s,useCapture)}else{var o=(q==="mouseenter")?"mouseover":"mouseout";return r.removeEventListener(o,s.__$mouseExListenerWrapper__||s)}}};b.Event._W3C={addListener:function(q,p,r,o){if(b.Event._MouseEventEx.isMouseEnterLeaveEvent(p)){return b.Event._MouseEventEx.addMouseEnterLeaveListener(q,p,r,o)}else{return q.addEventListener(p,r,o)}},removeListener:function(q,p,r,o){if(b.Event._MouseEventEx.isMouseEnterLeaveEvent(p)&&r.__$listenerWrapper__){return b.Event._MouseEventEx.removeMouseEnterLeaveListener(q,p,r.__$listenerWrapper__)}else{return q.removeEventListener(p,r,o)}},stopPropagation:function(o){o.stopPropagation()},preventDefault:function(o){o.preventDefault()}};b.Event._W3CMethods={getRelatedTarget:function(o){return o.relatedTarget},getButton:function(o){return o.button}};b.Event._Gecko={addListener:function(q,p,r,o){if(b.Event._MouseEventEx.isMouseEnterLeaveEvent(p)){return b.Event._MouseEventEx.addMouseEnterLeaveListener(q,p,r,o)}if((p==="mousewheel")){var s=function(t){t.wheelDeltaY=t.wheelDelta=-t.detail*40;t.__$type__="mousewheel";r.call(q,t)};r.__$mousewheelListenerWrapper__=s;q.addEventListener("DOMMouseScroll",s,o)}else{q.addEventListener(p,r,o)}},removeListener:function(q,p,r,o){if((p==="mousewheel")&&r.__$mousewheelListenerWrapper__){q.removeEventListener("DOMMouseScroll",r.__$mousewheelListenerWrapper__,o)}else{q.removeEventListener(p,r,o)}}};b.Event._IE={_handlers:{},WIN_UNLOAD_FLAG_FIELD:"__$win_unload_linked__",addListener:function(q,p,r,o){if(b.Event.findHandlerIndex(q,p,r)>=0){return}var u=(function(v){if(!v){v=i.event}v.currentTarget=q;v.eventPhase=(v.srcElement===q)?2:3;if(!d){Object.extend(v,g)}r.call(q,v)});q.attachEvent(b.Event.getEventName(p),u);b.Event.registerHandler(q,p,r,u);var t=q.ownerDocument||q;var s=t.parentWindow||t;b.Event._linkUnloadEvent(s)},removeListener:function(r,q,s,o){var p=b.Event.findHandlerIndex(r,q,s);if(p>=0){var t=b.Event._handlers[q][p].wrapper;r.detachEvent(b.Event.getEventName(q),t);b.Event._handlers[q].splice(p,1)}},stopPropagation:function(o){o.cancelBubble=true},preventDefault:function(o){o.returnValue=false},removeAllListeners:function(t){var u=b.Event._handlers;if(!u){return}for(var s in u){if(u.hasOwnProperty(s)){var q=u[s];if(q&&q.length){var o=b.Event.getEventName(s);for(var p=q.length-1;p>=0;--p){var r=q[p];if((!t)||(r.element.ownerDocument===t)){r.element.detachEvent(o,r.wrapper);q.splice(p,1)}}}}}},getEventName:function(o){return"on"+o},registerHandler:function(r,q,s,t){var o=b.Event._handlers;if(!o[q]){o[q]=[]}var p=o[q];p.push({element:r,handler:s,wrapper:t})},unregisterHandler:function(r,q,s){if(!handlers[q]){return}var p=handlers[q];var o=b.Event.findHandlerIndex(r,q,s);if(o>=0){p.splice(o,1)}},findHandlerIndex:function(s,r,u){var q=b.Event._handlers[r];if(!q){return -1}for(var p=0,o=q.length;p<o;++p){var t=q[p];if((t.element===s)&&(t.handler===u)){return p}}return -1},_linkUnloadEvent:function(o){var p=b.Event.WIN_UNLOAD_FLAG_FIELD;if(o[p]){return}else{o.attachEvent("onunload",b.Event.reactWinUnload);o[p]=true}},reactWinUnload:function(){var o=this.ownerDocument;b.Event.removeAllListeners(o)}};b.Event._IEMethods={getRelatedTarget:function(p){var o=p.type;if(["focusin","mouseenter","mouseover","pointerenter","pointerover","dragenter"].indexOf(o)>=0){return p.fromElement||p.toElement}else{return p.toElement||p.fromElement}},getButton:function(o){switch(o.button){case 1:return 0;case 2:return 2;case 4:return 1;case 3:return 3;default:return o.button}},stopPropagation:function(o){o.cancelBubble=true},preventDefault:function(o){o.returnValue=false}};if(j.addEventListener){b.Event=Object.extend(b.Event,b.Event._W3C);b.Event.Methods=Object.extend(b.Event.Methods,b.Event._W3CMethods);if(Kekule.Browser.Gecko){b.Event=Object.extend(b.Event,b.Event._Gecko)}}else{if(j.attachEvent){b.Event=Object.extend(b.Event,b.Event._IE);b.Event.Methods=Object.extend(b.Event.Methods,b.Event._IEMethods);if(i.Element){var f=i.Element.prototype;f.addEventListener=b.Event.addListener.methodize();f.removeEventListener=b.Event.removeListener.methodize()}}}Object.extend(b.Event,b.Event.Methods);var e=null;if(i.Event){e=i.Event.prototype}if(!e){if(j.createEvent){e=j.createEvent("HTMLEvents").__proto__}}var d=!!e;var g={};var c=b.Event.Methods;for(var a in c){if(c.hasOwnProperty(a)&&(typeof(c[a])==="function")){g[a]=c[a].methodize()}}if(e){Object.extend(e,g)}b.Ajax={XMLHttpFactories:[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],_availableFactoryIndex:-1,createXMLHTTPObject:function(){var q=false;var r=b.Ajax.XMLHttpFactories;var o=b.Ajax._availableFactoryIndex;if(o>=0){q=r[o]()}else{for(var p=0;p<r.length;p++){try{q=r[p]();b.Ajax._availableFactoryIndex=p}catch(s){continue}break}}return q},preparePostData:function(p){var o=p;if(typeof(p)==="object"){o=Kekule.UrlUtils.generateSearchString(p)}return o},sendRequest:function(q,x,s,u,r){var p=false;var t=true;var w=b.Ajax.createXMLHTTPObject();if(!w){return}var o=(s)?"POST":"GET";w.open(o,q,true);w.setRequestHeader("User-Agent","XMLHTTP/1.0");if(s){w.setRequestHeader("Content-type","application/x-www-form-urlencoded")}if(u){try{w.responseType=u}catch(v){}if((u==="arraybuffer")||(u==="blob")){p=true}if(w.responseType!==u){t=false}}if(p&&(!t)&w.overwriteMimeType){w.overrideMimeType("text/plain; charset=x-user-defined")}if(r&&w.overwriteMimeType){w.overwriteMimeType(r)}w.onreadystatechange=function(){if(w.readyState!=4){return}if(w.status!=200&&w.status!=304){x(null,w,false);throw"HTTP error "+w.status;return}x(w.response||w.responseText,w,true)};if(w.readyState==4){return}w.send(b.Ajax.preparePostData(s));return w},getResponseMimeType:function(o){return o.getResponseHeader("content-type")||""}};Kekule.Ajax=Kekule.X.Ajax;Kekule.X.DomReady={isReady:false,suspendFlag:0,funcs:[],domReady:function(p){n.initReady();if(!n.isReady){var o=j&&j.readyState;if(o==="complete"||o==="loaded"||(o==="interactive"&&!Kekule.Browser.IE)){n.isReady=true}}if(n.isReady){p()}else{n.funcs.push(p)}},fireReady:function(){if(n.isReady){return}n.isReady=true;n._execFuncs()},_execFuncs:function(){var o=n.funcs;if(o&&o.length){while(o.length&&!n.isSuspending()){var p=o.shift();if(p){p()}}}},suspend:function(){++n.suspendFlag},resume:function(){if(n.suspendFlag>0){--n.suspendFlag}if(!n.isSuspending()){n._execFuncs()}},isSuspending:function(){return n.suspendFlag>0},initReady:function(){if(j.addEventListener){j.addEventListener("DOMContentLoaded",function(){j.removeEventListener("DOMContentLoaded",arguments.callee,false);n.fireReady()},false)}else{if(j.getElementById){j.write('<script id="ie-domReady" defer="defer" src="//:"><\/script>');j.getElementById("ie-domReady").onreadystatechange=function(){if(this.readyState==="complete"){n.fireReady();this.onreadystatechange=null;this.parentNode.removeChild(this)}}}}}};var n=Kekule.X.DomReady;Kekule.X.domReady=n.domReady})(window,document);(function(){Kekule.NativeServices={MODE_OPEN:"open",MODE_SAVE:"save",FILTER_ALL_SUPPORT:"all",FILTER_ANY:"any",showFilePickerDialog:function(c,d,b){if(Kekule.NativeServices.doShowFilePickerDialog){return Kekule.NativeServices.doShowFilePickerDialog(c,d,b)}},canLoadFileData:function(b){return !!a.doLoadFileData||!!a.doShowFilePickerDialog},loadFileData:function(e,f,c){if(Kekule.NativeServices.doLoadFileData){return Kekule.NativeServices.doLoadFileData(e,f,c)}var d=Object.create(c||{});d.multiple=false;d.mode=a.MODE_OPEN;var b=function(h,i,j){if(!h||!i){f(h,null,null)}else{if(Kekule.BrowserFeature.fileapi){var l=i.name;var k=d.binaryDetector&&d.binaryDetector(l,i);var g=new FileReader();g.onload=function(n){var m=g.result;if(f){f(true,m,l)}};g.onerror=function(){if(f){f(false)}Kekule.error(Kekule.$L("ErrorMsg.ERROR_LOADING_FILE"+l))};if(k){g.readAsArrayBuffer(i)}else{g.readAsText(i)}}else{Kekule.error(Kekule.$L("ErrorMsg.FILE_API_NOT_SUPPORTED"))}}};a.showFilePickerDialog(e,b,d)},canSaveFileData:function(b){return !!a.doSaveFileData},saveFileData:function(d,c,e,b){if(Kekule.NativeServices.doSaveFileData){return Kekule.NativeServices.doSaveFileData(d,c,e,b)}}};var a=Kekule.NativeServices;Kekule.HtmlNativeServiceImpl={doShowFilePickerDialog:function(d,e,b){var c=Kekule.HtmlNativeServiceImpl._createFileInputElem(d,e,b||{});c.click()},_createFileInputElem:function(k,m,o){var p=k.createElement("input");p.setAttribute("type","file");var c=o||{};if(c.multiple){p.setAttribute("multiple","multiple")}if(c.filters){var d=[];for(var h=0,f=c.filters.length;h<f;++h){var e=c.filters[h];if(e===Kekule.NativeServices.FILTER_ALL_SUPPORT||e===Kekule.NativeServices.FILTER_ANY){continue}var g=e.filter;if(g){d.push(g)}}var n=d.join(",");p.setAttribute("accept",n)}var b=p.style;b.position="absolute";b.left="-100000px";b.opacity=0;k.body.appendChild(p);var j=function(r){var q=r.getTarget();var l=q.files;var i=l&&l[0];if(m){m(true,i,l)}Kekule.X.Event.removeListener(q,"change",j);q.ownerDocument.body.focus();if(q.parentNode){}};Kekule.X.Event.addListener(p,"change",j);return p},doSaveFileData:function(e,d,g,c){var f=c.initialFileName||null;var b=Kekule.HtmlNativeServiceImpl._createDataElem(e,d,f);b.click();b.parentNode.removeChild(b);if(g){g(null,null)}},_createDataElem:function(f,e,g){var c=f.createElement("a");var d="data:application/octet-stream,"+encodeURIComponent(e);c.setAttribute("href",d);c.setAttribute("download",g||"");var b=c.style;c.position="absolute";c.left="-100000px";c.opacity=0;f.body.appendChild(c);return c},doSaveFileDataIe:function(f,e,h,d){var g=d.initialFileName||null;if(Kekule.BrowserFeature.blob&&window.navigator.msSaveOrOpenBlob){var b=new Blob([e]);window.navigator.msSaveBlob(b,g)}else{var c=Kekule.HtmlNativeServiceImpl._createAndExecDataIframe(f,e,g);c.parentNode.removeChild(c)}if(h){h(null,null)}},_createAndExecDataIframe:function(f,e,g){var b=f.createElement("iframe");f.body.appendChild(b);var d=b.contentWindow||b.contentDocument;d.document.open("text/html","replace");var c=e.toString();d.document.write(c);d.document.close();d.focus();d.document.execCommand("SaveAs",true,Kekule.UrlUtils.extractFileCoreName(g));return b}};if(Kekule.BrowserFeature.fileapi){a.doShowFilePickerDialog=Kekule.HtmlNativeServiceImpl.doShowFilePickerDialog}if(Kekule.Browser.IE||window.navigator.msSaveOrOpenBlob){a.doSaveFileData=Kekule.HtmlNativeServiceImpl.doSaveFileDataIe}else{if(Kekule.BrowserFeature.downloadHref){a.doSaveFileData=Kekule.HtmlNativeServiceImpl.doSaveFileData}}})();Kekule.PredefinedResLoader=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PredefinedResLoader",initialize:function($super,c,b,a){$super();if(!b){Kekule.Error(Kekule.$L("ErrorMsg.EMPTY_RESURI"))}else{this.setPropStoreFieldValue("resUri",b);this.setDoc(c);if(a){this.setResType(a)}}},initProperties:function(){this.defineProp("doc",{dataType:DataType.OBJECT,serializable:false});this.defineProp("resUri",{dataType:DataType.STRING,serializable:false,setter:null});this.defineProp("resType",{dataType:DataType.STRING,serializable:false})},getLinkedResUrl:function(b){var a=b.tagName.toLowerCase();if(a==="link"){return b.getAttribute("href")}else{if(a==="script"){return b.getAttribute("src")}else{return null}}},getElemResType:function(a){return a.getAttribute("type")},load:function(k){var e=this.getResUri();var h,a;var d=Kekule.PredefinedResReferer.ID_MARK;if(e.startsWith(d)){var c=e.substr(d.length).trim();h=this.getDoc().getElementById(c);if(h){a=this.getLinkedResUrl(h);var j=this.getElemResType(h);if(j){this.setResType(j)}}}else{a=e}var f={resType:this.getResType(),resUri:e};if(a){Kekule.X.Ajax.sendRequest(a,function(o,n,p){if(p){f=Object.extend(f,{data:o,text:n.responseText,success:true});if(!f.resType){f.resType=Kekule.X.Ajax.getResponseMimeType(n);if(f.resType===Kekule.IO.MimeType.OCTSTREAM){var m=Kekule.UrlUtils.extractFileExt(a);if(m){var l=Kekule.IO.DataFormatsManager.findFormat(null,m);if(l){f.resType=l.mimeType}}}}k(f,p)}else{k(f,false)}},null,null,this.getResType()||null)}else{if(h){var i=h.innerHTML;var g=2;var b=i.indexOf("\r\n");if(b<0){b=i.indexOf("\n");g=1}if(b===0){i=i.substring(g)}f=Object.extend(f,{data:i,text:i,resType:f.resType||"text/plain",success:true});k(f,true)}else{k(f,false)}}}});Kekule.PredefinedResReferer={REFER_PATTERN:/^\s*url\((\S+)\)\s*$/,ID_MARK:"#",isResValue:function(a){return Kekule.PredefinedResReferer.isResReferrer(a)},isResReferrer:function(a){return Kekule.PredefinedResReferer.REFER_PATTERN.test(a)},extractReferedValue:function(c){var a=Kekule.PredefinedResReferer.REFER_PATTERN.exec(c);if(a){var b=a[1];if(b){b=Kekule.StrUtils.unquote(b);return b}}return null},loadResource:function(d,g,b,e){if(!e){e=document}var c=Kekule.PredefinedResReferer;var a=c.extractReferedValue(d);var f;f=new Kekule.PredefinedResLoader(e,a);if(f){if(b){f.setResType(b)}f.load(g)}}};Kekule._registerAfterLoadSysProc(function(){if(Kekule.IO){Kekule.IO.loadResourceData=function(b,d,a,c){Kekule.PredefinedResReferer.loadResource(b,function(e,f){var g;if(f){g=Kekule.IO.loadTypedData(e.data,e.resType,e.resUri)}if(d){d(g,f)}},a,c)}}});(function(){Kekule.DomUtils={namespaceMatched:function(b,a,c){if(c===undefined){c=true}return((b.namespaceURI==a)||(c&&(!b.namespaceURI)))},isElement:function(a){return(a&&a.tagName&&a.nodeType)},getElementText:function(d){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==3){a+=d.childNodes[c].nodeValue}}return a},setElementText:function(d,f){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==3){d.childNodes[c].nodeValue=f;return f}}var e=d.ownerDocument.createTextNode(f);d.appendChild(e);return f},getLocalName:function(a){return a.localName||a.baseName||a.nodeName},getChildNodesOfTypes:function(f,b){var a=[];var e=Kekule.ArrayUtils.toArray(b);for(var d=0,c=f.childNodes.length;d<c;++d){var g=f.childNodes[d];if(!b||(e.indexOf(g.nodeType)>=0)){a.push(g)}}return a},getFirstChildElem:function(g,e,b,c){for(var d=0,a=g.childNodes.length;d<a;++d){var f=g.childNodes[d];if(f.nodeType===Node.ELEMENT_NODE){if((e&&(e.toLowerCase()===f.tagName.toLowerCase()))||(b&&(b.toLowerCase()===Kekule.DomUtils.getLocalName(f).toLowerCase()))||((!e)&&(!b))){if((!c)||Kekule.DomUtils.namespaceMatched(f,c)){return f}}}}},getDirectChildElems:function(h,f,c,d){var a=[];for(var e=0,b=h.childNodes.length;e<b;++e){var g=h.childNodes[e];if(g.nodeType===Node.ELEMENT_NODE){if((f&&(f.toLowerCase()===g.tagName.toLowerCase()))||(c&&(c.toLowerCase()===Kekule.DomUtils.getLocalName(g).toLowerCase()))||((!f)&&(!c))){if((!d)||Kekule.DomUtils.namespaceMatched(g,d)){a.push(g)}}}}return a},getDirectChildElemsOfAttribValues:function(e,p,c,g,b){var a=Kekule.DomUtils.getDirectChildElems(e,c,g,b);var q=[];for(var n=0,f=a.length;n<f;++n){var o=true;for(var m=0,h=p.length;m<h;++m){var d=Kekule.ObjUtils.getOwnedFieldNames(p[m])[0];if(a[n].getAttribute(d)!=p[m][d]){o=false;break}}if(o){q.push(a[n])}}return q},isDescendantOf:function(b,a){try{if(b&&a){if(b.documentElement){return false}if(b.ownerDocument===a){return true}var c=b.parentNode;while(c){if(c===a){return true}c=c.parentNode}}return false}catch(d){return false}},isOrIsDescendantOf:function(b,a){return(b===a)||Kekule.DomUtils.isDescendantOf(b,a)},getNearestAncestorByTagName:function(e,d,c){var b=d.toLowerCase();if(c&&e.tagName&&(e.tagName.toLowerCase()===b)){return e}var a=e.parentNode;while(a&&a.tagName){if(a.tagName.toLowerCase()===b){return a}a=a.parentNode}return null},getSameNSAttributeValue:function(d,c,b){var a=d.getAttribute(c);return a},setSameNSAttributeValue:function(d,c,e,b){var a=d.setAttribute(c,e);return a},fetchAttributeValuesToArray:function(c,b,d){var k=[];for(var h=0,f=c.attributes.length;h<f;++h){var g=c.attributes[h];if(b&&(!Kekule.DomUtils.namespaceMatched(g,b,true))){continue}var a;if(d){try{a=Kekule.DomUtils.getLocalName(g)}catch(j){a=g.name}}else{a=g.name}k.push({name:a,value:g.value})}return k},fetchAttributeValuesToJson:function(c,b,d){var k={};for(var h=0,f=c.attributes.length;h<f;++h){var g=c.attributes[h];if(b&&(!Kekule.DomUtils.namespaceMatched(g,b,true))){continue}var a;if(d){try{a=Kekule.DomUtils.getLocalName(g)}catch(j){a=g.name}}else{a=g.name}k[a]=g.value}return k},hasAttribute:function(b,a){if(b.hasAttribute){return b.hasAttribute(a)}else{var c=b.getAttribute(a);return !!c}},isDataAttribName:function(a){return a.toString().startsWith("data-")},getDataAttribCoreName:function(a){if(Kekule.DomUtils.isDataAttribName(a)){return a.substr(5)}else{return null}},getDataAttrib:function(b,a){if(b.dataset){return b.dataset[a]}else{return b.getAttribute("data-"+a.toString().hyphenize())}},setDataAttrib:function(b,a,c){if(b.dataset){b.dataset[a]=c}else{b.setAttribute("data-"+a.toString().hyphenize(),c)}},getDataset:function(e){if(e.dataset){return e.dataset}else{var a={};var g=e.attributes;for(var d=0,b=g.length;d<b;++d){var f=g[d];var c=f.name;if(c.toLowerCase().indexOf("data-")===0){var h=c.substring(5).camelize();a[h]=f.value}}return a}},clearChildContent:function(a){var c=Kekule.ArrayUtils.toArray(a.childNodes);for(var b=c.length-1;b>=0;--b){var d=c[b];if(d.nodeType===Node.ATTRIBUTE_NODE){continue}a.removeChild(d)}return a},replaceTagName:function(c,d){if(c.tagName.toLowerCase()!==d.toLowerCase()){var h=c.ownerDocument.createElement(d);var a=Kekule.DomUtils.fetchAttributeValuesToArray(c);for(var f=0,e=a.length;f<e;++f){h.setAttribute(a[f].name,a[f].value)}var b=Kekule.DomUtils.getDirectChildElems(c);for(var f=0,e=b.length;f<e;++f){h.appendChild(b[f])}var g=c.parentNode;var j=c.nextSibling;g.removeChild(c);if(j){g.insertBefore(h,j)}else{g.appendChild(h)}return h}else{return c}},setElemAttributes:function(d,f){var c=Kekule.ObjUtils.getOwnedFieldNames(f);for(var b=0,a=c.length;b<a;++b){var g=c[b];var e=f[g];if(g&&e){d.setAttribute(g,e)}}return d},isInDomTree:function(b,c){if(!b){return false}if(!c){c=b.ownerDocument}if(c){var a=c.documentElement;return Kekule.DomUtils.isDescendantOf(b,a)||b===a}else{return false}}};Kekule.StyleUtils={removeStyleProperty:function(a,b){if(a.removeProperty){a.removeProperty(b)}else{if(a.removeAttribute){a.removeAttribute(b)}else{a[b]=null}}},analysisUnitsValue:function(e){var d={};d.total=e;d.value=parseFloat(e);var a;if(e&&e.length&&(d.value!==undefined)&&(d.value!==NaN)){a="";for(var b=e.length-1;b>=0;--b){var g=e.charAt(b);var f=(g>="0")&&(g<="9");if((!f)&&(g!==".")&&(g!=="-")){a=g+a}}}d.units=a||"";return d},multiplyUnitsValue:function(b,c){var a=Kekule.StyleUtils.analysisUnitsValue(b);a.value*=c;return""+a.value+a.units},colorStrToValue:function(f){var b=f.length>4;var d=b?f.substr(1,2):f.substr(1,1);var c=b?f.substr(3,2):f.substr(2,1);var e=b?f.substr(5,2):f.substr(3,1);if(!b){d+=d;c+=c;e+=e}var a=(parseInt(d,16)<<16)+(parseInt(c,16)<<8)+parseInt(e,16);return a},getComputedStyle:function(c,d){var b;var e=c.ownerDocument;if(!e){return null}var a=e.defaultView;if(a&&a.getComputedStyle){b=a.getComputedStyle(c,null)}else{if(c.currentStyle){b=c.currentStyle}}if(b){return d?b[d]:b}else{return null}},isShown:function(b){var a=Kekule.StyleUtils;return(a.isDisplayed(b)&&a.isVisible(b))},isDisplayed:function(a){return(Kekule.StyleUtils.getComputedStyle(a,"display")||"").toLowerCase()!=="none"},getDisplayed:function(a){return Kekule.StyleUtils.getComputedStyle(a,"display")},setDisplay:function(a,b){if(a){if(typeof(b)==="string"){a.style.display=b}else{a.style.display=(!!b)?"":"none"}}},isVisible:function(a){return(Kekule.StyleUtils.getComputedStyle(a,"visibility")||"").toLowerCase()!=="hidden"},getVisibility:function(a){return Kekule.StyleUtils.getComputedStyle(a,"visibility")},setVisibility:function(a,b){if(a){if(typeof(b)==="string"){a.style.visibility=b}else{a.style.visibility=(!!b)?"":"hidden"}}},isBlockElem:function(a){var b=Kekule.StyleUtils.getComputedStyle(a,"display");return["block","list-item","table","flex","grid"].indexOf(b)>=0},isAbsOrFixPositioned:function(b){var a=Kekule.StyleUtils.getComputedStyle(b,"position")||"";a=a.toLowerCase();return(a==="absolute")||(a==="fixed")},_fillAbsOrFixedPositionStyleStack:function(d,b){var a=Kekule.StyleUtils.getComputedStyle(d,"position")||"";a=a.toLowerCase();if((a==="absolute")||(a==="fixed")){b.push(a.toLocaleLowerCase())}var c=d.parentNode;if(c&&c.ownerDocument){Kekule.StyleUtils._fillAbsOrFixedPositionStyleStack(c,b)}return b},isAncestorPositionFixed:function(b){var a=b.parentNode;if(a){return Kekule.StyleUtils.isSelfOrAncestorPositionFixed(b)}else{return false}},isSelfOrAncestorPositionFixed:function(c){var a=[];Kekule.StyleUtils._fillAbsOrFixedPositionStyleStack(c,a);if(!a.length){return null}for(var b=a.length-1;b>=0;--b){var d=a[b];if(d==="fixed"){return true}}return false},setCursor:function(d,e){if(DataType.isArrayValue(e)){for(var c=0,a=e.length;c<a;++c){var b=e[c];d.style.cursor=b;if(d.style.cursor===b){return b}}return d.style.cursor}else{d.style.cursor=e;return d.style.cursor}},_cssTransformValuesToMatrix:function(b){var a=Kekule.MatrixUtils.create(3,3,0);a[0][0]=b.a;a[1][0]=b.b;a[0][1]=b.c;a[1][1]=b.d;a[0][2]=b.tx;a[1][2]=b.ty;return a},_matrixToCssTransformValues:function(b){var a={a:b[0][0],b:b[1][0],c:b[0][1],d:b[1][1],tx:b[0][2],ty:b[1][2]};return a},hasTransform:function(b){var a=Kekule.StyleUtils.getComputedStyle(b,"transform");return a&&(a!=="none")},getTransformMatrixValues:function(c){var b=Kekule.StyleUtils.getComputedStyle(c,"transform")||"";var a=b.match(/-?[\d\.]+/g);if(a){return{a:a[0],b:a[1],c:a[2],d:a[3],tx:a[4],ty:a[5]}}else{return null}},setTransformMatrixArrayValues:function(c,a){if(a){var b="matrix("+a.join(",")+")";c.style.transform=b}},getTransformMatrix:function(b){var a=Kekule.StyleUtils.getTransformMatrixValues(b);if(a){return Kekule.StyleUtils._cssTransformValuesToMatrix(a)}else{return null}},getCascadeTranformMatrixes:function(d){var c=[];var b=d;while(b){var a=Kekule.StyleUtils.getTransformMatrix(b);if(a){c.unshift(a)}b=b.parentNode}return c},getTotalTransformMatrix:function(d){var e=Kekule.StyleUtils.getCascadeTranformMatrixes(d);var b=null;for(var c=e.length-1;c>=0;--c){var a=e[c];if(!b){b=a}else{b=Kekule.MatrixUtils.multiply(b,a)}}return b},calcInvertTransformMatrix:function(c){var d=Kekule.StyleUtils._matrixToCssTransformValues(c);var b=d;var e=b.a*b.d-b.b*b.c;if(Math.abs(e)<0.000001){return false}var f={a:b.d/e,b:-b.b/e,c:-b.c/e,d:b.a/e,tx:(b.c*b.ty-b.d*b.tx)/e,ty:(b.b*b.tx-b.a*b.ty)/e};var a=Kekule.StyleUtils._cssTransformValuesToMatrix(f);return a}};Kekule.HtmlElementUtils={getClassNames:function(a){return Kekule.StrUtils.splitTokens(a.className)},hasClass:function(b,a){var c=Kekule.HtmlElementUtils.getClassNames(b);return(c.indexOf(a)>=0)},addClass:function(e,d){var b=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);for(var c=0,a=f.length;c<a;++c){if(!b.hasClass(e,f[c])){e.className+=" "+f[c]}}return b},removeClass:function(e,d){var a=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);var g=a.getClassNames(e);for(var c=g.length;c>=0;--c){var b=f.indexOf(g[c]);if(b>=0){g.splice(c,1)}}e.className=g.join(" ");return a},toggleClass:function(e,d){var b=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);for(var c=0,a=f.length;c<a;++c){if(b.hasClass(e,f[c])){b.removeClass(e,f[c])}else{b.addClass(e,f[c])}}return b},getInnerText:function(a){return a.innerText||a.textContent},resizeElem:function(d,b,a,c){d.style.width=b+(c||"px");d.style.height=a+(c||"px")},getElemClientDimension:function(a){return{width:a.clientWidth,height:a.clientHeight}},getElemScrollDimension:function(a){return{width:a.scrollWidth,height:a.scrollHeight}},getElemComputedDimension:function(e){var c=Kekule.StyleUtils;var f={width:c.getComputedStyle(e,"width"),height:c.getComputedStyle(e,"height")};var d=c.analysisUnitsValue(f.width);var b=c.analysisUnitsValue(f.height);var a={};if(d.units==="px"){a.width=d.value}if(b.units==="px"){a.height=d.value}return a},getElemOffsetDimension:function(a){return{width:a.offsetWidth,height:a.offsetHeight}},getViewportDimension:function(b){var a;if(b){if(b.ownerDocument){a=Kekule.DocumentUtils.getDefaultView(b.ownerDocument)}else{if(b.defaultView){a=b.defaultView}else{if(b.parentWindow){a=b.parentWindow}else{a=b}}}}a=a||window;if(a.innerWidth!=null){return{width:a.innerWidth,height:a.innerHeight}}var c=a.document;if(c.compatMode=="CSS1Compat"){return{width:c.documentElement.clientWidth,height:c.documentElement.clientHeight}}return{width:c.body.clientWidth,height:c.body.clientHeight}},getViewportVisibleBox:function(c){var b;if(c){if(c.ownerDocument){b=Kekule.DocumentUtils.getDefaultView(c.ownerDocument)}else{if(c.defaultView){b=c.defaultView}else{if(c.parentWindow){b=c.parentWindow}else{b=c}}}}b=b||window;var e=b.document;var d=Kekule.HtmlElementUtils.getViewportDimension(b);var f=Kekule.DocumentUtils.getScrollPosition(e);var a={x1:f.left,y1:f.top,x2:d.width,y2:d.height};a.left=a.x1;a.top=a.y1;a.right=a.x2;a.bottom=a.y2;return a},getElemBoundingClientRect:function(d,c){var b=Object.extend({},d.getBoundingClientRect());if(Kekule.ObjUtils.isUnset(b.width)){b.width=b.right-b.left}if(Kekule.ObjUtils.isUnset(b.height)){b.height=b.bottom-b.top}if(c){var f=d.ownerDocument;var e=f.documentElement.scrollTop||f.body.scrollTop||0;var g=f.documentElement.scrollLeft||f.body.scrollLeft||0;b.left+=g;b.right+=g;b.top+=e;b.bottom+=e}var a=b;a.x=a.left;a.y=a.top;return a},getElemPagePos:function(c,e){var d=0;var b=0;var a=c;while(a){d+=(a.offsetLeft-a.scrollLeft+a.clientLeft);b+=(a.offsetTop-a.scrollTop+a.clientTop);a=a.offsetParent}if(e){var g=c.ownerDocument;var f=g.documentElement.scrollTop||g.body.scrollTop||0;var h=g.documentElement.scrollLeft||g.body.scrollLeft||0;d-=h;b-=f}return{x:d,y:b}},getElemPageRect:function(a,b){var d=Kekule.HtmlElementUtils.getElemPagePos(a,b);var c=Kekule.HtmlElementUtils.getElemClientDimension(a);return{x:d.x,y:d.y,left:d.x,top:d.y,right:d.x+c.width,bottom:d.y+c.height,width:c.width,height:c.height}},getElemViewportPos:function(b){var a=Kekule.HtmlElementUtils.getElemPagePos(b,true);return{x:a.left,y:left.top}},makePositioned:function(a){var b=Kekule.StyleUtils.getComputedStyle(a,"position");if(!b||b.toLowerCase()==="static"){a.style.position="relative"}},isFormCtrlElement:function(b){var c=["input","button","textarea","select"];var a=b&&b.tagName.toLowerCase();return !!a&&c.indexOf(a)>=0},requestFullScreen:function(b){var a=b.requestFullScreen||b.mozRequestFullScreen||b.webkitRequestFullScreen||b.msRequestFullScreen;return a?a.apply(b):null},exitFullScreen:function(b){var a=b.exitFullScreen||b.mozExitFullScreen||b.webkitExitFullScreen||b.msExitFullScreen;return a?a.apply(b):null}};Kekule.DocumentUtils={getDefaultView:function(a){return a.defaultView||a.parentWindow},getScrollPosition:function(b){var c=Kekule.DocumentUtils.getDefaultView(b);var a={left:((c.pageXOffset!==undefined)?c.pageXOffset:(b.documentElement||b.body.parentNode||b.body).scrollLeft)||0,top:((c.pageYOffset!==undefined)?c.pageYOffset:(b.documentElement||b.body.parentNode||b.body).scrollTop)||0};a.x=a.left;a.y=a.top;return a},getClientDimension:function(a){if(a.compatMode=="BackCompat"){return{width:a.body.clientWidth,height:a.body.clientHeight}}else{return{width:a.documentElement.clientWidth,height:a.documentElement.clientHeight}}},getClientVisibleBox:function(b){var d=Kekule.DocumentUtils.getScrollPosition(b);var c=Kekule.DocumentUtils.getInnerClientDimension(b);var a={};a.left=a.x1=d.left;a.top=a.y1=d.top;a.right=a.x2=c.width+d.left;a.bottom=a.y2=c.height+d.top;a.width=c.width;a.height=c.height;return a},getWindowInnerDimension:function(a){var b=Kekule.DocumentUtils.getDefaultView(a);return{width:Math.min(b.innerWidth,b.outerWidth),height:Math.min(b.innerHeight,b.outerHeight)}},getInnerClientDimension:function(a){var c=Kekule.DocumentUtils.getClientDimension(a);var b=Kekule.DocumentUtils.getWindowInnerDimension(a);return{width:b.width?Math.min(b.width,c.width):c.width,height:b.height?Math.min(b.height,c.height):c.height}},getClientScaleLevel:function(a){return(a.compatMode=="BackCompat")?a.body.clientWidth/window.innerWidth:a.documentElement.clientWidth/window.innerWidth},getPixelZoomLevel:function(a){var b=Kekule.DocumentUtils.getClientScaleLevel(a);return b*(Kekule.DocumentUtils.getDefaultView(a).devicePixelRatio||1)},getDevicePPI:function(a){var e=Kekule.DocumentUtils.getDefaultView(a);if(e.matchMedia){var d=0;var c=0;var f=200;var b=[];while(!c||((c-d)>1)){if(e.matchMedia("(min-resolution: "+f+"dpi)").matches){if(c){d=f;f=Math.round((d+c)/2)}else{d=f;f=2*f}}else{c=f;f=Math.round((d+c)/2)}}return f}else{return 96}}};Kekule.DataSrcAttribUtils={isUrlBasedValue:function(b){var a=b.toLowerCase().indexOf("url(");return(a===0)},getUrl:function(d){var a=d.trim();var c=a.toLowerCase().indexOf("url(");if(c===0){var b=a.lastIndexOf(")");a=a.substring(4,b);return a}else{return null}},getElementContent:function(b){if(!b){return null}var a=b.innerHTML;a=a.ltrim();return a},getElementMimeType:function(a){return a.getAttribute("type")}};Kekule.ScriptFileUtils={_existedScriptUrls:new Kekule.MapEx(),appendScriptFile:function(d,b,e){var c=Kekule.ScriptFileUtils._existedScriptUrls.get(d);if(!c){c=[];Kekule.ScriptFileUtils._existedScriptUrls.set(d,c)}if(c.indexOf(b)>=0){if(e){e()}return}var a=d.createElement("script");a.src=b;a.onload=a.onreadystatechange=function(g){if(a._loaded){return}var f=a.readyState;if(f===undefined||f==="loaded"||f==="complete"){a._loaded=true;a.onload=a.onreadystatechange=null;c.push(b);if(e){e()}}};(d.getElementsByTagName("head")[0]||d.body).appendChild(a);return a},appendScriptFiles:function(d,c,e){var b=[].concat(c);var a=function(h,g,i){if(g.length<=0){if(i){i()}return}var f=g.shift();Kekule.ScriptFileUtils.appendScriptFile(h,f,function(){Kekule.ScriptFileUtils.appendScriptFiles(h,g,i)})};a(d,b,e)}}})();Kekule.DomHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DomHelper",NAMESPACE_DEFINE_PREFIX:"xmlns",NAMESPACE_DELIMITER:":",ERR_EMPTY_DOC:"Document is empty",ERR_ELEMENT_NOTSET:"Element not set",initialize:function($super,a){$super();this._supportNsMethods=null;if(a){this.setDocument(a)}},initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("document");if(!a){var b=this.getPropStoreFieldValue("rootElement");a=b?b.ownerDocument:null}return a},setter:function(a){if(a!=this.getPropStoreFieldValue("document")){this.setPropStoreFieldValue("document",a);this.analysisRootElem()}}});this.defineProp("rootElement",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("rootElement");if(!a){var b=this.getPropStoreFieldValue("document");a=b?b.documentElement:null}return a},setter:function(a){this.setPropStoreFieldValue("rootElement",a);this.analysisRootElem()}});this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:false,getter:function(){if(!this.getPropStoreFieldValue("namespaces")){this.setPropStoreFieldValue("namespaces",[])}return this.getPropStoreFieldValue("namespaces")}});this.defineProp("defNamespaceURI",{dataType:DataType.STRING,serializable:false});this.defineProp("forceAnalysisDoc",{dataType:DataType.BOOL})},analysisRootElem:function(){this.setNamespaces([]);this.setDefNamespaceURI(null);var b=this.getRootElement();if(!b){return}var j=b.ownerDocument;this._supportNsMethods=!!j.getElementsByTagNameNS;if((!this._supportNsMethods)||(this.getForceAnalysisDoc())){for(var f=0,d=b.attributes.length;f<d;++f){var e=b.attributes[f];var c=e.name;if(c&&c.indexOf(this.NAMESPACE_DEFINE_PREFIX)>=0){var h=e.value;var a=c.indexOf(this.NAMESPACE_DELIMITER);var g=(a>=0)?c.substring(a+1):null;this.getNamespaces().push({namespaceURI:h,prefix:g});if(!g){this.setDefNamespaceURI(h)}}}}},_getEmptyDocErrorMsg:function(){return !Kekule.hasLocalRes()?this.ERR_EMPTY_DOC:Kekule.$L("ErrorMsg.EMPTY_DOC")},_getElementNotSetErrorMsg:function(){return !Kekule.hasLocalRes()?this.ELEMENT_NOTSET:Kekule.$L("ErrorMsg.ELEMENT_NOTSET")},assertDocAvailable:function(a){if(!a){Kekule.raise(this._getEmptyDocErrorMsg());return false}else{return true}},assertElementAvailable:function(a){if(!a){Kekule.raise(this._getElementNotSetErrorMsg());return false}else{return true}},getNsPrefix:function(b){if(b==this.getDefNamespaceURI()){return""}var d=this.getNamespaces();for(var c=0,a=d.length;c<a;++c){if(d[c].namespaceURI==b){return d[c].prefix}}return null},getQualifiedName:function(b,a){var c=this.getNsPrefix(b);if(c===null){return null}else{return c?c+this.NAMESPACE_DELIMITER+a:a}},createElementNS:function(a,c){var b=this.getDocument();if(!this.assertDocAvailable(b)){return null}if(this._supportNsMethods){return b.createElementNS(a,c)}else{return b.createElement(c)}},getElementsByTagNameNS:function(c,b,d){var a=this.getPropStoreFieldValue("document")||this.getPropStoreFieldValue("rootElement");var f=this.getDocument();if(!this.assertDocAvailable(f)){return null}if(this._supportNsMethods){if(d){return d.getElementsByTagNameNS(c,b)}else{return a.getElementsByTagNameNS(c,b)}}else{var e=this.getQualifiedName(c,b);if(e===null){return[]}else{if(d){return d.getElementsByTagName(e)}else{return a.getElementsByTagName(e)}}}},getAttributeNodeNS:function(b,a,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.getAttributeNodeNS(b,a)}else{var d=this.getQualifiedName(b,a);if(d===null){return null}else{return c.getAttributeNode(d)}}},getAttributeNS:function(b,a,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.getAttributeNS(b,a)}else{var d=this.getQualifiedName(b,a);if(d===null){return null}else{return c.getAttribute(d)}}},setAttributeNS:function(b,a,d,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.setAttributeNS(b,a,d)}else{var e=this.getQualifiedName(b,a);if(e===null){return null}else{return c.setAttribute(e,d)}}}});