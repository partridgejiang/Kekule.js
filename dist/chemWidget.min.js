Kekule.ChemWidget={},Kekule.ChemWidget.AbstractWidget=Kekule.Widget.BaseWidget,Kekule.ChemWidget.ComponentWidgetNames={menu:"menu",newDoc:"newDoc",clearObjs:"clearObjs",loadFile:"loadFile",loadData:"loadData",saveData:"saveData",zoomIn:"zoomIn",zoomOut:"zoomOut",resetZoom:"resetZoom",rotateRight:"rotateRight",rotateLeft:"rotateLeft",rotateX:"rotateX",rotateY:"rotateY",rotateZ:"rotateZ",reset:"reset",molDisplayType:"molDisplayType",molDisplayTypeCondensed:"molDisplayTypeCondensed",molDisplayTypeSkeletal:"molDisplayTypeSkeletal",molDisplayTypeWire:"molDisplayTypeWire",molDisplayTypeSticks:"molDisplayTypeSticks",molDisplayTypeBallStick:"molDisplayTypeBallStick",molDisplayTypeSpaceFill:"molDisplayTypeSpaceFill",molHideHydrogens:"molHideHydrogens",molAutoGenerateCoords:"molAutoGenerateCoords",openEditor:"openEditor",config:"config",objInspector:"objInspector",issueInspector:"issueInspector",undo:"undo",redo:"redo",copy:"copy",cut:"cut",paste:"paste",cloneSelection:"cloneSelection",selectAll:"selectAll",toggleSelect:"toggleSelect",eraseSelection:"eraseSelection",recheckIssues:"recheckIssues",toggleShowAllIssues:"toggleShowAllIssues",dragScroll:"dragScroll",erase:"erase",manipulate:"manipulate",trackInput:"trackInput",molBond:"bond",molAtom:"atom",molFormula:"formula",molAtomAndFormula:"atomAndFormula",molCharge:"charge",textBlock:"textBlock",imageBlock:"imageBlock",molRing:"ring",glyph:"glyph",textImage:"textImage",fontName:"fontName",fontSize:"fontSize",color:"color",textDirection:"textDirection",textAlign:"textAlign",nodeDisplayMode:"nodeDisplayMode"},Kekule.ChemWidget.HtmlClassNames={PREFIX:"K-Chem-",INNER_TOOLBAR:"K-Chem-InnerToolbar"},function(){"use strict";Class.PropertyScope,Kekule.ChemWidget,Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DIALOG_LOADDATA:"K-Chem-Dialog-LoadData",DIALOG_LOADDATA_FORMATBOX:"K-Chem-Dialog-LoadData-FormatBox",DIALOG_LOADDATA_SRCEDITOR_REGION:"K-Chem-Dialog-LoadData-SrcEditorRegion",DIALOG_LOADDATA_SRCEDITOR:"K-Chem-Dialog-LoadData-SrcEditor",DIALOG_LOADDATA_BTN_LOADFROMFILE:"K-Chem-Dialog-LoadData-Btn-LoadFromFile",DIALOG_LOADAPPENDDATA:"K-Chem-Dialog-LoadAppendData",DIALOG_LOADAPPENDDATA_APPENDCHECKBOX:"K-Chem-Dialog-LoadAppendData-AppendCheckBox"}),Kekule.ChemWidget.LoadDataDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.ChemWidget.LoadDataDialog",initialize:function(e,t,r){this._openFileAction=new Kekule.ActionLoadFileData,this._openFileAction.setBinaryDetector(this._detectBinaryFormat),this._openFileAction.update(),this._openFileAction.addEventListener("load",this.reactFileLoad,this),this._sBtnLoadFromFile=Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_FROM_FILE"),this._formatItems=null,this.tryApplySuper("initialize",[e,t||Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG"),r||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]]),this.setResizable&&this.setResizable(!0)},finalize:function(){this._openFileAction.finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:null,getter:function(){var e=this.getDataDetails();return e&&e.data?Kekule.IO.loadTypedData(e.data,e.mimeType,e.fileName):null}}),this.defineProp("allowedFormatIds",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("allowedFormatIds",e),this.updateFormatItems()}}),this.defineProp("dataDetails",{dataType:DataType.HASH,setter:null,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoAdjustSizeOnPopup(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.DIALOG_LOADDATA},doCreateClientContents:function(t){this.tryApplySuper("doCreateClientContents");var r=this.getDocument();(i=r.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_FORMAT"),t.appendChild(i),i=r.createElement("div"),t.appendChild(i);var i,o=new Kekule.Widget.SelectBox(this);o.addClassName(e.DIALOG_LOADDATA_FORMATBOX),o.appendToElem(i),this._formatSelector=o,this.updateFormatItems(),(i=r.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_SRC"),t.appendChild(i),(i=r.createElement("div")).className=e.DIALOG_LOADDATA_SRCEDITOR_REGION,t.appendChild(i);var n=new Kekule.Widget.TextEditor(this);n.setWrap("off").setAutoWrapThreshold(!0).setFileDroppable(!0),n.setToolbarPos(Kekule.Widget.Position.BOTTOM),n.addClassName(e.DIALOG_LOADDATA_SRCEDITOR),n.appendToElem(i),this._dataEditor=n},getFormatSelectorItems:function(e){for(var t=[],r=this.getAllowedFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds(),i=0,o=r.length;i<o;++i){var n=Kekule.IO.DataFormatsManager.getFormatInfo(r[i]);if(n){for(var a=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(n.fileExts)),s=0,l=a.length;s<l;++s)a[s]="*."+a[s];var d=a.join(", "),u=n.title;d&&(u+=" ("+d+")"),t.push({value:n.id,formatId:n.id,text:u,title:n.mimeType,data:n})}}return t.sort(function(e,t){return e.text<t.text?-1:e.text>t.text?1:0}),t},getFileFilters:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r],n=o.data,a=o.text||o.title||o.value,s=Kekule.ArrayUtils.toArray(n.fileExts);t.push({title:a,filter:"."+s.join(",.")})}return t.push(Kekule.NativeServices.FILTER_ALL_SUPPORT),t.push(Kekule.NativeServices.FILTER_ANY),t},updateFormatItems:function(){this._formatItems=this.getFormatSelectorItems(),this._formatSelector.setItems(this._formatItems);var e=this.getFileFilters(this._formatItems);this._openFileAction.setFilters(e)},doSetButtons:function(t){var r=t||[];r.indexOf(this._sBtnLoadFromFile)<0&&r.unshift(this._sBtnLoadFromFile),this.tryApplySuper("doSetButtons",[r]);var i=this.getDialogButton(this._sBtnLoadFromFile);i.setAction(this._openFileAction),i.linkStyleResource(Kekule.Widget.StyleResourceNames.BUTTON_LOAD_FILE),i.addClassName(e.DIALOG_LOADDATA_BTN_LOADFROMFILE),i.setEnabled(this._openFileAction.getEnabled())},reactFileLoad:function(e){var t=e.data,r=e.fileName;try{if(e.success&&Kekule.ObjUtils.notUnset(t)&&r){this.setPropStoreFieldValue("dataDetails",{data:t,fileName:r});var i=Kekule.Widget.DialogButtons.OK;this.close(i)}else null}catch(e){Kekule.error(e)}},open:function(e,t,r){return this.setPropStoreFieldValue("dataDetails",{}),this.tryApplySuper("open",[e,t,r])},close:function(e){var t=this.getDataDetails();if((!t||!t.data&&!t.fileName)&&this.isPositiveResult(e)){var r=this._dataEditor.getValue(),i=this._formatSelector.getSelectedItemData(),o=i.id,n=i.mimeType;try{this.setPropStoreFieldValue("dataDetails",{data:r,mimeType:n,formatId:o})}catch(e){Kekule.raise(e,Kekule.ExceptionLevel.ERROR)}}return this.tryApplySuper("close",[e])},_detectBinaryFormat:function(e,t){if(t&&e){var r=Kekule.UrlUtils.extractFileExt(e),i=Kekule.IO.DataFormatsManager.findFormat(null,r);if(i)return Kekule.IO.ChemDataType.isBinaryType(i.dataType)}return!1}}),Kekule.ChemWidget.LoadOrAppendDataDialog=Class.create(Kekule.ChemWidget.LoadDataDialog,{CLASS_NAME:"Kekule.ChemWidget.LoadOrAppendDataDialog",initialize:function(e,t,r){this._appendCheckBox=null,this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("displayAppendCheckBox",{dataType:DataType.BOOL}),this.defineProp("isAppending",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._appendCheckBox&&this._appendCheckBox.getChecked()},setter:function(e){this._appendCheckBox&&this._appendCheckBox.setChecked(!!e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.DIALOG_LOADAPPENDDATA},doCreateClientContents:function(t){this.tryApplySuper("doCreateClientContents",[t]);this.getDocument();var r=new Kekule.Widget.CheckBox(this);r.addClassName(e.DIALOG_LOADAPPENDDATA_APPENDCHECKBOX),r.setText(Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG_APPENDMODE")),r.appendToElem(t),r.setDisplayed(this.getDisplayAppendCheckBox()),this._appendCheckBox=r},open:function(e,t,r){return this.setIsAppending(!1),this._appendCheckBox.setDisplayed(this.getDisplayAppendCheckBox()),this.tryApplySuper("open",[e,t,r])}})}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,r=Kekule.Widget.HtmlClassNames,i=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{PERIODIC_TABLE:"K-Chem-Periodic-Table",PERIODIC_TABLE_MINI:"K-Chem-Periodic-Table-Mini",PERIODIC_TABLE_LEGEND:"K-Chem-Periodic-Table-Legend",PERIODIC_TABLE_LEGEND_CONTENT:"K-Chem-Periodic-Table-Legend-Content",PERIODIC_TABLE_LEGEND_COLORS:"K-Chem-Periodic-Table-Legend-Colors",PERIODIC_TABLE_LEGEND_COLOR:"K-Chem-Periodic-Table-Legend-Color",PERIODIC_TABLE_MAINTABLE:"K-Chem-Periodic-Table-MainTable",PERIODIC_TABLE_EXTRATABLE:"K-Chem-Periodic-Table-ExtraTable",PERIODIC_TABLE_ELEM_CELL:"K-Chem-Periodic-Table-Elem-Cell",PERIODIC_TABLE_ELEM_STUBSCELL:"K-Chem-Periodic-Table-Elem-StubsCell",PERIODIC_TABLE_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_HEAD_CELL:"K-Chem-Periodic-Table-Head-Cell",PERIODIC_TABLE_HEAD_CELL_CONTENT:"K-Chem-Periodic-Table-Head-Cell-Content",PERIODIC_TABLE_HEAD_CELL_GROUP:"K-Chem-Periodic-Table-Head-Cell-Group",PERIODIC_TABLE_HEAD_CELL_PERIOD:"K-Chem-Periodic-Table-Head-Cell-Period",ELEM_SYMBOL:"K-Chem-Elem-Symbol",ELEM_SYMBOL_STUBS:"K-Chem-Elem-Symbol-Stubs",ELEM_NAME:"K-Chem-Elem-Name",ATOMIC_NUM:"K-Chem-Atomic-Num",ATOMIC_WEIGHT:"K-Chem-Atomic-Weight"}),Kekule.globalOptions.add("chemWidget.periodicTable",{displayedComponents:["symbol","name","atomicNumber","groupHead","legend"]}),Kekule.ChemWidget.PeriodicTable=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.PeriodicTable",BINDABLE_TAG_NAMES:["span","div"],ELEM_DATA_FIELD:"__$elemData__",MAX_GROUP:18,MAX_PERIOD:7,LA_SERIES:["La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu"],AC_SERIES:["Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr"],initialize:function(e,t){this.setPropStoreFieldValue("displayedComponents",t||this.getDefaultDisplayedComponents()),this._elemCells=[],this._selectedElemCells=[],this.tryApplySuper("initialize",[e]),this.setEnableSelect(!0),this.setEnableMultiSelect(!0)},initProperties:function(){this.defineProp("displayedComponents",{dataType:DataType.ARRAY,getter:function(){return this.getPropStoreFieldValue("displayedComponents")||this.getDefaultDisplayedComponents()}}),this.defineProp("startingAtomNum",{dataType:DataType.INT}),this.defineProp("endingAtomNum",{dataType:DataType.INT}),this.defineProp("startingElementSymbol",{dataType:DataType.INT,serializable:!1,getter:function(){var e=this.getStartingAtomNum();return e&&Kekule.ChemicalElementsDataUtil.getElementSymbol(e)},setter:function(e){this.setStartingAtomNum(e&&Kekule.ChemicalElementsDataUtil.getAtomicNumber(e)||null)}}),this.defineProp("endingElementSymbol",{dataType:DataType.INT,serializable:!1,getter:function(){var e=this.getEndingAtomNum();return e&&Kekule.ChemicalElementsDataUtil.getElementSymbol(e)},setter:function(e){this.setEndingAtomNum(e&&Kekule.ChemicalElementsDataUtil.getAtomicNumber(e)||null)}}),this.defineProp("enabledElementSymbols",{dataType:DataType.ARRAY}),this.defineProp("disabledElementSymbols",{dataType:DataType.ARRAY}),this.defineProp("useMiniMode",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useMiniMode",e),e?this.addClassName(i.PERIODIC_TABLE_MINI):this.removeClassName(i.PERIODIC_TABLE_MINI)}}),this.defineProp("enableSelect",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableSelect")||this.getEnableMultiSelect()}}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL}),this.defineProp("selected",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(){return this.getSelection()?this.getSelection()[0]:null}}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){for(var e=[],t=this._selectedElemCells||[],r=0,i=t.length;r<i;++r){var o=t[r][this.ELEM_DATA_FIELD];o&&e.push(o)}return e}}),this.defineProp("selectedSymbol",{dataType:DataType.STRING,getter:function(){return this.getSelectedSymbols()[0]},setter:function(e){this.setSelectedSymbols([e])}}),this.defineProp("selectedSymbols",{dataType:DataType.ARRAY,getter:function(){var e=this.getSelection();if(e){for(var t=[],r=0,i=e.length;r<i;++r)t.push(e[r].symbol);return t}return[]},setter:function(e){this.selectSymbols(e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.PERIODIC_TABLE},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.createMainTable(e,t);return r.concat([i])},doObjectChange:function(e){var t=["displayedComponents","startingAtomNum","endingAtomNum"];Kekule.ArrayUtils.intersect(e,t).length&&this.recreateMainTable(),t=["enabledElementSymbols","disabledElementSymbols"],Kekule.ArrayUtils.intersect(e,t).length&&this.updateCellEnableStates()},getDefaultDisplayedComponents:function(){return Kekule.globalOptions.chemWidget.periodicTable.displayedComponents},getShowElemSymbol:function(){return this.getDisplayedComponents().indexOf("symbol")>=0},getShowElemName:function(){return this.getDisplayedComponents().indexOf("name")>=0},getShowAtomicNum:function(){return this.getDisplayedComponents().indexOf("atomicNumber")>=0},getShowAtomicWeight:function(){return this.getDisplayedComponents().indexOf("atomicWeight")>=0},getShowGroupHead:function(){return this.getDisplayedComponents().indexOf("groupHead")>=0},getShowPeriodHead:function(){return this.getDisplayedComponents().indexOf("periodHead")>=0},getShowLegend:function(){return this.getDisplayedComponents().indexOf("legend")>=0},recreateMainTable:function(){this.deselectAll();var t=this.getElement();e.clearChildContent(t),this.createMainTable(t.ownerDocument,t)},createMainTable:function(t,o){var n=Kekule.chemicalElementsData,a=[];this._elemCells=[];for(var s=[],l=[],d=t.createElement("table"),u=0;u<=this.MAX_PERIOD;++u){for(var c=t.createElement("tr"),p=[],h=0;h<=this.MAX_GROUP;++h){var g=t.createElement("td");c.appendChild(g),p.push(g)}d.appendChild(c),a.push(p)}var C=t.createElement("table");for(u=0;u<2;++u){for(c=t.createElement("tr"),p=[],h=0;h<this.LA_SERIES.length;++h){g=t.createElement("td");c.appendChild(g),p.push(g)}C.appendChild(c),s.push(p)}for(var _=this.getStartingAtomNum()||0,m=this.getEndingAtomNum()||3e5,f=0,S=n.length;f<S;++f){var y=n[f],O=y.atomicNumber;if(!(O<_||O>m)){var E=y.symbol,T=y.period,A=y.group,k=y.chemicalSerie.replace(/\s/g,"");Kekule.ArrayUtils.pushUnique(l,y.chemicalSerie);var b=this.LA_SERIES.indexOf(E),I=this.AC_SERIES.indexOf(E);b>=0?g=s[0][b]:I>=0?g=s[1][I]:T&&A&&(g=a[T][A]),g&&(g.className=i.PERIODIC_TABLE_ELEM_CELL,g.appendChild(this.createElemCellContent(t,y,k.upperFirst())),g[this.ELEM_DATA_FIELD]=y,this._elemCells.push(g)),0!==b&&0!==I||((g=a[T][A]).className=i.PERIODIC_TABLE_ELEM_STUBSCELL,g.appendChild(this.createElemCellStubsContent(t,y,k.upperFirst())))}}if(this.getShowGroupHead()){var D=["IA","IIA","IIIB","IVB","VB","VIB","VIIB","","VIII","","IB","IIB","IIIA","IVA","VA","VIA","VIIA","VIIIA"];for(h=1;h<=this.MAX_GROUP;++h){(g=a[u=1===h||18===h?0:2===h||h>=13?1:3][h]).className=i.PERIODIC_TABLE_HEAD_CELL+" "+i.PERIODIC_TABLE_HEAD_CELL_GROUP,g.appendChild(this.createHeadContent(t,D[h-1]))}}if(this.getShowPeriodHead())for(u=1;u<=this.MAX_PERIOD;++u){(g=a[u][0]).className=i.PERIODIC_TABLE_HEAD_CELL+" "+i.PERIODIC_TABLE_HEAD_CELL_PERIOD,g.appendChild(this.createHeadContent(t,u))}if(o.appendChild(d),this.getShowLegend()){var P=t.createElement("a");P.href="javascript:void(0)",P.className=i.PERIODIC_TABLE_LEGEND+" "+r.CORNER_ALL,e.setElementText(P,Kekule.$L("ChemWidgetTexts.LEGEND_CAPTION"));var v=t.createElement("div");v.className=i.PERIODIC_TABLE_LEGEND_CONTENT+" "+r.CORNER_ALL;var R={symbol:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_SYMBOL"),atomicNumber:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_NUM"),naturalMass:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_WEIGHT"),name:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_NAME")},K=this.createElemCellContent(t,R,i.PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT);v.appendChild(K);var M=t.createElement("div");M.className=i.PERIODIC_TABLE_LEGEND_COLORS;for(f=0,S=l.length;f<S;++f){var N=t.createElement("div");N.className=i.PERIODIC_TABLE_LEGEND_COLOR+" "+l[f].replace(/\s/g,""),e.setElementText(N,l[f]),M.appendChild(N)}v.appendChild(M),P.appendChild(v),o.appendChild(P)}return o.appendChild(C),this.updateCellEnableStates(),d},createElemCellContent:function(e,t,r){var o=e.createElement("div"),n=i.PERIODIC_TABLE_ELEM_CELL_CONTENT;if(r&&(n+=" "+r),o.className=n,this.getShowAtomicNum()&&o.appendChild(this.createElemContentComponent(e,t.atomicNumber,i.ATOMIC_NUM)),this.getShowAtomicWeight()){var a=t.naturalMass;if(a){var s="number"==typeof a?a.toFixed(3):a;o.appendChild(this.createElemContentComponent(e,s,i.ATOMIC_WEIGHT))}else o.appendChild(this.createElemContentComponent(e,"Â ",i.ATOMIC_WEIGHT))}return this.getShowElemSymbol()&&o.appendChild(this.createElemContentComponent(e,t.symbol,i.ELEM_SYMBOL)),this.getShowElemName()&&o.appendChild(this.createElemContentComponent(e,t.name,i.ELEM_NAME)),o},createElemCellStubsContent:function(e,t,r){var o,n,a,s=e.createElement("div");return s.className=i.PERIODIC_TABLE_ELEM_CELL_CONTENT+" "+(r||""),a=t.chemicalSerie,"La"===t.symbol?(o="57-71",n="La-Lu"):(o="89-103",n="Ac-Lr"),this.getShowAtomicNum()&&s.appendChild(this.createElemContentComponent(e,o,i.ATOMIC_NUM)),this.getShowElemSymbol()&&s.appendChild(this.createElemContentComponent(e,n,i.ELEM_SYMBOL_STUBS,!0)),this.getShowElemName()&&s.appendChild(this.createElemContentComponent(e,a,i.ELEM_NAME)),s},createElemContentComponent:function(t,r,i,o){var n=t.createElement("span");if(n.className=i,o){var a=t.createElement("span");n.appendChild(a)}return e.setElementText(a||n,r),n},createHeadContent:function(t,r,o){var n=t.createElement("div");return n.className=i.PERIODIC_TABLE_HEAD_CELL_CONTENT+" "+(o||""),e.setElementText(n,r),n},updateCellEnableStates:function(){var e=this.getEnabledElementSymbols()||[],t=!e.length&&this.getDisabledElementSymbols()||[];if(t.length||e.length)for(var r=this._elemCells,i=0,o=r.length;i<o;++i){var n=this._getCellData(r[i]).symbol;e.length?e.indexOf(n)<0&&this.setCellEnableState(r[i],!1):t.length&&t.indexOf(n)>=0&&this.setCellEnableState(r[i],!1)}},setCellEnableState:function(e,i){i?(t.removeClass(e,r.STATE_DISABLED),this._getCellData(e).disabled=null):(t.addClass(e,r.STATE_DISABLED),this._getCellData(e).disabled=!0)},_getCellData:function(e){return e[this.ELEM_DATA_FIELD]},_isCellDisabled:function(e){return!!this._getCellData(e).disabled},_getAtomCellElem:function(t){var r=e.getNearestAncestorByTagName(t,"td",!0);return r&&this._elemCells.indexOf(r)>=0?r:null},_getCellElemOfSymbol:function(e){for(var t=this._elemCells,r=0,i=t.length;r<i;++r){var o=t[r];if(o[this.ELEM_DATA_FIELD].symbol===e)return o}return null},isCellSelected:function(e){return this._selectedElemCells.indexOf(e)>=0},selectCell:function(e){e&&(t.addClass(e,r.STATE_SELECTED),Kekule.ArrayUtils.pushUnique(this._selectedElemCells,e),this.invokeEvent("select",{elemData:e[this.ELEM_DATA_FIELD]}))},deselectCell:function(e){e&&(t.removeClass(e,r.STATE_SELECTED),Kekule.ArrayUtils.remove(this._selectedElemCells,e),this.invokeEvent("deselect",{elemData:e[this.ELEM_DATA_FIELD]}))},toggleCell:function(e){this.isCellSelected(e)?this.deselectCell(e):this.selectCell(e)},deselectAll:function(){for(var e=this._selectedElemCells,t=e.length-1;t>=0;--t)this.deselectCell(e[t]);return this},selectSymbols:function(e){this.deselectAll();for(var t=Kekule.ArrayUtils.toArray(e),r=0,i=t.length;r<i;++r){var o=this._getCellElemOfSymbol(t[r]);o&&this.selectCell(o)}return this},react_click:function(e){if(this.getEnableSelect()){var t=e.getTarget(),r=this._getAtomCellElem(t);if(r&&!this._isCellDisabled(r))return this.getEnableMultiSelect()?this.toggleCell(r):(this.deselectAll(),this.selectCell(r)),!0}this.tryApplySuper("react_click",[e])}})}(),function(){"use strict";var e=Class.PropertyScope,t=Kekule.ArrayUtils,r=(Kekule.DomUtils,Kekule.ZoomUtils),i=(Kekule.ChemWidget,Kekule.Widget.HtmlClassNames),o=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DISPLAYER_DRAWCONTEXT_PARENT:"K-Chem-Displayer-DrawContext-Parent",ACTION_MOL_DISPLAY_TYPE:"K-Chem-MolDisplayType",ACTION_MOL_DISPLAY_SKELETAL:"K-Chem-MolDisplaySkeletal",ACTION_MOL_DISPLAY_CONDENSED:"K-Chem-MolDisplayCondensed",ACTION_MOL_DISPLAY_WIRE:"K-Chem-MolDisplayWire",ACTION_MOL_DISPLAY_BALLSTICK:"K-Chem-MolDisplayBallStick",ACTION_MOL_DISPLAY_STICKS:"K-Chem-MolDisplaySticks",ACTION_MOL_DISPLAY_SPACEFILL:"K-Chem-MolDisplaySpaceFill",ACTION_MOL_HIDE_HYDROGENS:"K-Chem-MolHideHydrogens",ACTION_MOL_AUTO_COORD_GENERATION:"K-Chem-MolAutoCoordGeneration",ACTION_ZOOMIN:"K-Chem-ZoomIn",ACTION_ZOOMOUT:"K-Chem-ZoomOut",ACTION_RESET:"K-Chem-Reset",ACTION_COPY:"K-Chem-Copy",ACTION_RESET_ZOOM:"K-Chem-ResetZoom",ACTION_LOADFILE:"K-Chem-LoadFile",ACTION_LOADDATA:"K-Chem-LoadData",ACTION_SAVEFILE:"K-Chem-SaveFile",ACTION_CLEAROBJS:"K-Chem-ClearObjs",ACTION_CONFIG:"K-Chem-Config",DIALOG_CHOOSE_FILE_FORAMT:"K-Chem-Dialog-Choose-File-Format",DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX:"K-Chem-Dialog-Choose-File-Format-FormatBox",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER_REGION:"K-Chem-Dialog-Choose-File-Format-PreviewerRegion",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER:"K-Chem-Dialog-Choose-File-Format-Previewer"}),Kekule.ChemWidget.ChemObjDisplayerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerConfigs",initProperties:function(){this.addConfigProp("ioConfigs","Kekule.ChemWidget.ChemObjDisplayerIOConfigs"),this.addConfigProp("environment2DConfigs","Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs"),this.addConfigProp("environment3DConfigs","Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("ioConfigs",new Kekule.ChemWidget.ChemObjDisplayerIOConfigs),this.setPropStoreFieldValue("environment2DConfigs",new Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs),this.setPropStoreFieldValue("environment3DConfigs",new Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs)}}),Kekule.ChemWidget.ChemObjDisplayerIOConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerIOConfigs",initProperties:function(){this.addBoolConfigProp("canonicalizeBeforeSave",!0),this.addBoolConfigProp("autoGenerateCoordsAfterLoad",!0)}}),Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs",initProperties:function(){this.addBoolConfigProp("antialias",!1),this.addFloatConfigProp("antialiasBlurRatio",0),this.addFloatConfigProp("overSamplingRatio",1)}}),Kekule.ChemWidget.ChemObjDisplayer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer",initialize:function(e,t,r,i){this._paintFlag=0,this._bgColorMap={},this._contextTransformOpsMap=new Kekule.MapEx,this._reactChemObjDrawBind=this._reactChemObjDraw.bind(this),this.setPropStoreFieldValue("resetAfterLoad",!0),this.setPropStoreFieldValue("renderType",r||Kekule.Render.RendererType.R2D),this.setPropStoreFieldValue("displayerConfigs",i||this.createDefaultConfigs()),this.tryApplySuper("initialize",[e]),t&&this.setChemObj(t),this.setEnableLoadNewFile(!0)},doFinalize:function(){this.clearSubViews(),this.setPropStoreFieldValue("chemObj",null),this.getPainter().finalize();var e=this.getPropStoreFieldValue("drawBridge"),t=this.getPropStoreFieldValue("drawContext");t&&e&&e.releaseContext(t),e&&e.finalize&&e.finalize(),this.setPropStoreFieldValue("drawBridge",null),this.setPropStoreFieldValue("drawContext",null),this._contextTransformOpsMap&&this._contextTransformOpsMap.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("displayerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:!1,scope:e.PUBLIC}),this.defineProp("enableLoadNewFile",{dataType:DataType.BOOL}),this.defineProp("allowedInputFormatIds",{dataType:DataType.ARRAY}),this.defineProp("allowedOutputFormatIds",{dataType:DataType.ARRAY}),this.defineProp("standardizationOptions",{dataType:DataType.HASH}),this.defineProp("resetAfterLoad",{dataType:DataType.BOOL}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PUBLISHED,setter:function(e){var t=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",e),this.chemObjChanged(e,t)}}),this.defineProp("chemObjData",{dataType:DataType.STRING,serializable:!1,getter:null,setter:function(e){var t,r;(t="object"==typeof e?e:JSON.parse(e))&&((r=t.format?Kekule.IO.loadFormatData(t.data,t.format):t.mimeType?Kekule.IO.loadMimeData(t.data,t.mimeType):null)&&this._tryAutoGenerateChemObjCoordsAndLoad(r))}}),this.defineProp("chemObjLoaded",{dataType:DataType.BOOL,serializable:!1,scope:e.PUBLIC,setter:null,getter:function(){return this.getChemObj()&&this.getPropStoreFieldValue("chemObjLoaded")}}),this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,enumSource:Kekule.Render.RendererType,scope:e.PUBLISHED,setter:function(e){if(this.getAllowRenderTypeChange()){var t=this.getRenderType();e!==t&&(this.setPropStoreFieldValue("renderType",e),this.resetRenderType(t,e))}else Kekule.error(Kekule.$L("ErrorMsg.RENDER_TYPE_CHANGE_NOT_ALLOWED"))}}),this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:!1,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("renderConfigs");return e||(e=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()),e},setter:function(e){this.setPropStoreFieldValue("renderConfigs",e);var t=this.getPropStoreFieldValue("painter");t&&t.setRenderConfigs(this.getRenderConfigs())}}),this.defineProp("backgroundColor",{dataType:DataType.STRING,scope:e.PUBLISHED,setter:function(e){this.setPropStoreFieldValue("backgroundColor",e),this._bgColorMap[this.getRenderType().toString()]=e,this.backgroundColorChanged()}}),this.defineProp("inheritedRenderStyles",{dataType:DataType.ARRAY,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("inheritedRenderStyles");return e||(e=[],this.setPropStoreFieldValue("inheritedRenderStyles",e)),e},setter:function(e){this.setPropStoreFieldValue("inheritedRenderStyles",e||[]),this.requestRepaint()}}),this.defineProp("inheritedRenderColor",{dataType:DataType.BOOL,scope:e.PUBLISHED,getter:function(){var e=this.getInheritedRenderStyles();return!!(e&&e.indexOf("color")>=0)},setter:function(e){if(!!e!==this.getInheritedRenderColor()){var t=this.getInheritedRenderStyles();e?t.push("color"):Kekule.ArrayUtils.remove(t,"color"),this.setInheritedRenderStyles(t)}}}),this.defineProp("inheritedRenderBackgroundColor",{dataType:DataType.BOOL,scope:e.PUBLISHED,getter:function(){var e=this.getInheritedRenderStyles();return!!(e&&e.indexOf("backgroundColor")>=0)},setter:function(e){if(!!e!==this.getInheritedRenderBackgroundColor()){var t=this.getInheritedRenderStyles();e?t.push("backgroundColor"):Kekule.ArrayUtils.remove(t,"backgroundColor"),this.setInheritedRenderStyles(t)}}}),this.defineProp("enableCustomCssProperties",{dataType:DataType.BOOL,setter:function(e){e!=this.getEnableCustomCssProperties()&&(this.setPropStoreFieldValue("enableCustomCssProperties",!!e),this.requestRepaint())}}),this.defineProp("transformParams",{dataType:DataType.HASH,serializable:!1,scope:e.PUBLIC,getter:function(){var e=Object.extend({},this.getDrawOptions());return e.screenCoordOffset=this.getBaseCoordOffset(),e},setter:function(e){var t=e||{};this.setDrawOptions(t),this.setBaseCoordOffset(t.baseCoordOffset),this.drawOptionChanged()}}),this.defineProp("drawOptions",{dataType:DataType.HASH,serializable:!1,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("drawOptions");return e||(e={},this.setPropStoreFieldValue("drawOptions",e)),e},setter:function(e){this.setPropStoreFieldValue("drawOptions",e),this.drawOptionChanged()}}),this.defineProp("zoom",{dataType:DataType.FLOAT,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).zoom},setter:function(e){return this.zoomTo(e),this}}),this.defineProp("initialZoom",{dataType:DataType.FLOAT}),this.defineProp("autofit",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).autofit},setter:function(e){var t=this.getDrawOptions()||{};return t.autofit=e,this.setDrawOptions(t)}}),this.defineProp("autoShrink",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).autoShrink},setter:function(e){var t=this.getDrawOptions()||{};return t.autoShrink=e,this.setDrawOptions(t)}}),this.defineProp("moleculeDisplayType",{dataType:DataType.INT,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).moleculeDisplayType},setter:function(e){return this.getDrawOptions().moleculeDisplayType=e,this.drawOptionChanged(),this}}),this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL,serializable:!1,scope:e.PUBLIC,getter:function(){return Kekule.oneOf(this.getDrawOptions().allowCoordBorrow,this.getRenderConfigs().getGeneralConfigs().getAllowCoordBorrow())}}),this.defineProp("autoSize",{dataType:DataType.BOOL,serializable:!1,setter:function(e){e!=this.getAutoSize()&&(this.setPropStoreFieldValue("autoSize",e),e&&this.allowAutoSize()&&this.drawOptionChanged())}}),this.defineProp("padding",{dataType:DataType.INT,serializable:!1,setter:function(e){e!=this.getPadding()&&(this.setPropStoreFieldValue("padding",e),this.getDrawOptions().autofitContextPadding=e,this.drawOptionChanged())}}),this.defineProp("baseCoordOffset",{dataType:DataType.Hash,serializable:!1,setter:function(e){this.setPropStoreFieldValue("baseCoordOffset",e),this.getChemObjLoaded()&&this.repaint()}}),this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:!1,scope:e.PRIVATE,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("drawBridge");return t||this.__$drawBridgeInitialized$__||(this.__$drawBridgeInitialized$__=!0,t=this.createDrawBridge(),this.setPropStoreFieldValue("drawBridge",t)),t}}),this.defineProp("drawContext",{dataType:DataType.OBJECT,serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("drawContext");if(!e){var t=this.getDrawBridge();if(t){var r=this.getDrawContextParentElem();if(!r)return null;var i=Kekule.HtmlElementUtils.getElemOffsetDimension(r);e=t.createContext(r,i.width,i.height,this.getContextCreationParams(this.getRenderType(),t)),this.setPropStoreFieldValue("drawContext",e)}}return e}}),this.defineProp("painter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("painter");return e||(e=this.createNewPainter()),e}}),this.defineProp("rootRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPainter();return e?e.getRenderer():null}}),this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null,getter:function(){var e=this.getRootRenderer();return e&&e.getBoundInfoRecorder()}}),this.defineProp("subViews",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("subViews");return!t&&e&&(t=[],this.setPropStoreFieldValue("subViews",t)),t}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setStandardizationOptions({unmarshalSubFragments:!1,clearHydrogens:!1})},doEndUpdate:function(e){this.tryApplySuper("doEndUpdate",[e]),this._requestRepainting&&this.repaint(this._requestRepainting.overrideOptions)},elementBound:function(e){this.setObserveElemResize(!0)},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),e&&this.setChemObj(this.getChemObj())},doFileDragDrop:function(e){if(e){var t=this;return function(){Kekule.IO.loadFileData(e[0],function(e,r){r&&t.setChemObj(e)})}.defer(),!0}return this.tryApplySuper("doFileDragDrop")},notifyStyleAttribChanged:function(e){this.tryApplySuper("notifyStyleAttribChanged",[e]),(this.getInheritedRenderStyles()||[]).length&&this.requestRepaint()},getAllowRenderTypeChange:function(){return!1},resetRenderType:function(e,t){var r=this.getChemObj(),i=this.getPropStoreFieldValue("drawBridge"),o=this.getPropStoreFieldValue("drawContext");i&&o&&i.releaseContext(o),this.setPropStoreFieldValue("drawContext",null),this.setPropStoreFieldValue("drawBridge",null),this.__$drawBridgeInitialized$__=!1;var n=this.getBackgroundColorOfType(t);this.getDrawOptions().moleculeDisplayType=this.getDefaultMoleculeDisplayType(t),this.setPropStoreFieldValue("backgroundColor",n),this.backgroundColorChanged(!0),this._doLoadOnObj(r,{refreshOnly:!0}),this.resetDisplay()},resetRenderEnvironment:function(){return this.resetRenderType(null,this.getRenderType()),this},getDisplayerEnvironmentConfigs:function(){return this.getCoordMode()===Kekule.CoordMode.COORD3D?this.getDisplayerConfigs().getEnvironment3DConfigs():this.getDisplayerConfigs().getEnvironment2DConfigs()},getContextCreationParams:function(e,t){var r=this.getRenderConfigs(),i=this.getDisplayerConfigs();return e===Kekule.Render.RendererType.R3D?{alpha:!0,antialias:r.getEnvironmentConfigs().getAntialias()}:{alpha:!0,antialias:i.getEnvironment2DConfigs().getAntialias(),antialiasBlurRatio:i.getEnvironment2DConfigs().getAntialiasBlurRatio(),overSamplingRatio:i.getEnvironment2DConfigs().getOverSamplingRatio()}},createDefaultConfigs:function(){return new Kekule.ChemWidget.ChemObjDisplayerConfigs},getCoordMode:function(){return this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D},setCoordMode:function(e){var t=e===Kekule.CoordMode.COORD3D?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(t)},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r)try{var i=Kekule.IO.loadTypedData(t.data,t.resType,t.resUri);i||(i=Kekule.IO.loadFormatData(t.data,t.resType)),i?this._tryAutoGenerateChemObjCoordsAndLoad(i):Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}catch(e){this.reportException(e)}else this.reportException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},reportException:function(e,t){Kekule.raise(e,t||Kekule.ExceptionLevel.ERROR)},createDrawBridge:function(e){var t=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.Render.DrawBridge3DMananger:Kekule.Render.DrawBridge2DMananger,r=t.getPreferredBridgeInstance();if(!r&&!e){var i=t.getUnavailableMessage()||Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));i&&this.reportException(i,Kekule.ExceptionLevel.NOT_FATAL_ERROR)}return r},getClientElement:function(){return this.getElement()},getDrawContextParentElem:function(e){var t=this._drawContextParentElem;if(!t&&!e){t=this.getDocument().createElement("div"),this._drawContextParentElem=t,Kekule.HtmlElementUtils.addClass(t,i.DYN_CREATED),Kekule.HtmlElementUtils.addClass(t,o.DISPLAYER_DRAWCONTEXT_PARENT),t.style.width="100%",t.style.height="100%";var r=this.getClientElement(),n=Kekule.DomUtils.getFirstChildElem(r);n?r.insertBefore(t,n):r.appendChild(t)}return t},allowAutoSize:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D},canModifyPartialGraphic:function(e){var t=this.getDrawBridge();return!!t.canModifyGraphic&&t.canModifyGraphic(e||this.getDrawContext())},doInsertedToDom:function(){this.doResize()},doResize:function(){this.refitDrawContext(this.isPainting())},refitDrawContext:function(e){if(this.getDrawBridge()&&this.getDrawContext()){var t=Kekule.HtmlElementUtils.getElemClientDimension(this.getDrawContextParentElem()),r=this.changeContextDimension(t);!e&&r&&this.repaint()}},getContextDimension:function(){return this.getDrawBridge()&&this.getDrawContext()?this.getDrawBridge().getContextDimension(this.getDrawContext()):null},_getContextOverSamplingRatio:function(){var e=this.getDisplayerEnvironmentConfigs();return e.getAntialias&&e.getAntialias()&&e.getOverSamplingRatio&&e.getOverSamplingRatio()||1},changeContextDimension:function(e){return this.doChangeContextDimension(this.getDrawContext(),this.getDrawBridge(),e,!0)},doChangeContextDimension:function(e,t,r,i){if(t&&e){var o=r.width,n=r.height,a=t.getContextElem(e);if(a){var s=this._getContextOverSamplingRatio();if(1!==s&&Kekule.BrowserFeature.cssTranform&&i){var l=1/s;a.style.transform="scale("+l+","+l+")",a.style.transformOrigin="0 0",t.setContextParam(e,"overSamplingRatio",s)}else a.style.transform="",t.setContextParam(e,"overSamplingRatio",null)}return this._resizeContext(e,t,o,n),!0}return!1},_resizeContext:function(e,t,r,i){e&&t&&t.setContextDimension(e,r,i)},clearContext:function(){var e=this.getPropStoreFieldValue("drawContext");if(e){var t=this.getPropStoreFieldValue("painter");t&&t.clear(e),this.getDrawBridge().clearContext(e)}},createNewPainter:function(e){var t=this.getPropStoreFieldValue("painter");t&&(t.removeEventListener("draw",this._reactChemObjDrawBind),t.finalize());var r=this.getDrawBridge()?new Kekule.Render.ChemObjPainter(this.getRenderType(),e||this.getChemObj(),this.getDrawBridge()):null;return this.setPropStoreFieldValue("painter",r),r&&r.addEventListener("draw",this._reactChemObjDrawBind),r},isRenderable:function(){return!(!this.getDrawBridge()||!this.getDrawContext())},chemObjChanged:function(e,t){this.doLoad(e),this.getResetAfterLoad()&&t&&this.resetDisplay()},load:function(e){this.setChemObj(e)},doLoad:function(e,t){this._doLoadOnObj(e)},_doLoadOnObj:function(e,t){var r=t&&t.refreshOnly;this.clearSubViews(),this.refitDrawContext(!0),this.setPropStoreFieldValue("chemObjLoaded",!1);try{if(e){var i=this.createNewPainter(e);i&&i.setRenderConfigs(this.getRenderConfigs()),this.repaint(),this.setPropStoreFieldValue("chemObjLoaded",!0),r||this.invokeEvent("load",{obj:e})}else this.clearContext(),r||this.invokeEvent("load",{obj:e})}catch(e){this.clearContext(),this.reportException(e)}finally{this.doLoadEnd(this.getChemObj())}},doLoadEnd:function(e){},loadFromData:function(e,t,r,i,o){try{var n;return e?(i?n=Kekule.IO.loadFormatData(e,i):(t||r)&&(n=Kekule.IO.loadTypedData(e,t,r)),n?o?this._tryAutoGenerateChemObjCoordsForLoading(n,o):this._tryAutoGenerateChemObjCoordsAndLoad(n):Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED")),n):(this.setChemObj(null),null)}catch(e){this.reportException(e)}},loadFromFile:function(e){if(e){var t=this;try{Kekule.IO.loadFileData(e,function(e,r){r&&t._tryAutoGenerateChemObjCoordsAndLoad(e)})}catch(e){this.reportException(e)}}else this.setChemObj(null)},getSavingTargetObj:function(){return this.getChemObj()},saveData:function(e,t,r){r=r||this.getSavingTargetObj();this.prepareSaveData(r);var i=Kekule.IO.ChemDataWriterManager.getWriterByFormat(e,null,r);if(i){if(this._needToCanonicalizeBeforeSaving()&&this.getDisplayerConfigs().getIoConfigs().getCanonicalizeBeforeSave()&&r.standardize)(r=this._cloneSavingTargetObj(r)).standardize(this.getStandardizationOptions());if(!t)t=Kekule.IO.DataFormatsManager.getFormatInfo(e).dataType;return i.writeData(r,t,e)}return Kekule.error(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")),null},_cloneSavingTargetObj:function(e){return e.clone?e.clone(!0):e},_needToCanonicalizeBeforeSaving:function(){return!1},prepareSaveData:function(e){},_molNeedAutoCoordGeneration:function(e,t){return e instanceof Kekule.StructureFragment&&e.getNodeCount()>0&&!e.nodesHasCoordOfMode(this.getCoordMode(),this.getAllowCoordBorrow(),!0)},_isCoordGeneratorAvailable:function(e){if(Kekule.Calculator&&Kekule.Calculator.Services){var t=e===Kekule.CoordMode.COORD3D?Kekule.Calculator.Services.GEN3D:Kekule.Calculator.Services.GEN2D;return Kekule.Calculator.hasService(t)}return!1},canAutoGenerateCoordForChemObj:function(e,t){return e||(e=this.getChemObj()),Kekule.ObjUtils.isUnset(t)&&(t=this.getCoordMode()),e&&e instanceof Kekule.StructureFragment&&e.hasCtab()&&Kekule.Calculator&&Kekule.Calculator.generateStructure&&this._isCoordGeneratorAvailable(t)},_tryAutoGenerateChemObjCoords:function(e,t,r){if(Kekule.ObjUtils.isUnset(t)&&(t=this.getCoordMode()),this.canAutoGenerateCoordForChemObj(e,t)){var i=t===Kekule.CoordMode.COORD3D?Kekule.Calculator.Services.GEN3D:Kekule.Calculator.Services.GEN2D;try{Kekule.Calculator.generateStructure(e,i,{modifySource:!0},function(e){r(e)},function(t){r(e),Kekule.error(t)})}catch(t){r(e)}}else r(e)},_tryAutoGenerateChemObjCoordsForLoading:function(e,t){this.getDisplayerConfigs().getIoConfigs().getAutoGenerateCoordsAfterLoad()&&(this._molNeedAutoCoordGeneration(e,this.getCoordMode())?this._tryAutoGenerateChemObjCoords(e,null,t):t(e))},_tryAutoGenerateChemObjCoordsAndLoad:function(e){var t=this;this._tryAutoGenerateChemObjCoordsForLoading(e,function(e){t.setChemObj(e)})},autoGenerateChemObjCoords:function(e,t,r){var i=!t&&Kekule.ObjUtils.isUnset(r);t||(t=this.getChemObj()),Kekule.ObjUtils.isUnset(r)&&(r=this.getCoordMode());var o=this;return this._tryAutoGenerateChemObjCoords(t,r,function(t){i&&o.load(t),e&&e(t)}),this},getDrawClientDimension:function(){return Kekule.HtmlElementUtils.getElemClientDimension(this.getCoreElement())},setDrawDimension:function(e,t){this.setDimension(e,t)},calcDrawBaseCoord:function(e,t){var r,i,o=this.getDrawContext(),n=this.getPainter();if(!this._isContinuousRepainting&&t&&this.getAutoSize()&&this.allowAutoSize()){var a=this.getPadding()||0,s=n.estimateScreenBox(o,r,e,this.getAllowCoordBorrow());if(s){var l=s.x2-s.x1+2*a,d=s.y2-s.y1+2*a;this.changeContextDimension({width:l,height:d}),this.setDrawDimension(l,d),i={width:l,height:d},r={x:l/2,y:d/2}}}else if(!(r=e?e.baseCoord:null)){var u=this.getDrawClientDimension();r={x:u.width/2,y:u.height/2};var c=this.getBaseCoordOffset();c&&(r=Kekule.CoordUtils.add(r,c))}return{baseCoord:r=this.getDrawBridge().transformScreenCoordToContext(o,r),baseCoordPos:Kekule.Render.CoordPos.CENTER,newWidgetDimension:i}},getActualDrawOptions:function(){return this.getDrawOptions()},calcDrawParams:function(e,t){var r=this.getActualDrawOptions();e&&(r=Object.extend(r,e));var i=this.calcDrawBaseCoord(r,t);return{drawOptions:r,baseCoord:i.baseCoord,baseCoordPos:i.baseCoordPos,newWidgetDimension:i.newWidgetDimension}},_savePainterInitialRenderTransformOptions:function(e,t){var r=t.getActualInitialRenderTransformOptions(e);this._contextTransformOpsMap.set(e,r)},requestRepaint:function(e){this._requestRepainting={overrideOptions:e};var t=this;(function(){t._requestRepainting&&t._repaintCore(t._requestRepainting.overrideOptions),t._requestRepainting=null}).delay(0)},repaint:function(e){if(!this.isUpdating()){try{var t=this._repaintCore(e)}finally{this._requestRepainting=null}return t}this._requestRepainting={overrideOptions:e}},_repaintCore:function(e){if(this.getElement()&&!this.isPainting()&&this.isRenderable()){this.beginPaint();try{if(this.getInheritedRenderBackgroundColor()){var t=this.getComputedStyle("backgroundColor");this.backgroundColorChanged(!0,t||null)}else this.backgroundColorChanged(!0);if(e&&e.doNotClear||this.clearContext(),!this.getChemObj())return;var r,i,o=this.getPainter(),n=this.getDrawContext(),a=!0;if(e&&e.preserveTransformOptions?(i=this._contextTransformOpsMap.get(n)||null,a=!1,r=this.calcDrawParams(i,!0)):r=this.calcDrawParams(e,!0),this._lastBaseCoord=r.baseCoord,this.getInheritedRenderColor()){var s=this.getComputedStyle("color");r.drawOptions.color=s}else r.drawOptions.color=null;this.getEnableCustomCssProperties()&&this._applyCustomCssProps(r.drawOptions),this._setupRenderingEnvironment(n,this.getDrawBridge()),o.draw(n,r.baseCoord,r.drawOptions),a&&this._savePainterInitialRenderTransformOptions(n,o),this.invokeEvent("repaint",{obj:this.getChemObj()})}finally{this.endPaint()}}},_setupRenderingEnvironment:function(e,t){var r=this.getDisplayerEnvironmentConfigs();if(r.getAntialias&&r.getAntialias()&&(o=r.getAntialiasBlurRatio&&r.getAntialiasBlurRatio()||0)){var i=this.getRenderConfigs().getLengthConfigs(),o=r.getAntialiasBlurRatio()||0,n=i.getActualLength("bondLineWidth")*o||0,a=t||this.getDrawBridge();a.setFilter&&a.clearFilter&&(n?a.setFilter(e,"blur("+n+"px)"):a.clearFilter(e))}},beginPaint:function(){this._paintFlag||(this._paintFlag=0),++this._paintFlag},endPaint:function(){this._paintFlag>0&&--this._paintFlag,this._paintFlag<0&&(this._paintFlag=0)},isPainting:function(){return this._paintFlag>0},_reactChemObjDraw:function(e){var t=e.obj;t===this.getChemObj()&&this.chemObjRendered(t,e.renderOptions||{})},chemObjRendered:function(e,t){},getBackgroundColorOfType:function(e){return this._bgColorMap[e.toString()]},setBackgroundColorOfType:function(e,t){this._bgColorMap[t.toString()]=e,t===this.getRenderType()&&this.setBackgroundColor(e)},backgroundColorChanged:function(e,t){var r=t;void 0===r&&(r=this.getBackgroundColor()),"transparent"===r&&(r=null);var i=this.getDrawBridge();i&&i.setClearColor&&(i.setClearColor(this.getDrawContext(),r),e||this.requestRepaint())},_getApplicableCustomCssPropNames:function(){return{r2d:["unitLength","moleculeDisplayType","hydrogenDisplayLevel","showCharge","chargeMarkFontSize","chargeMarkMargin","chemMarkerFontSize","chemMarkerMargin","distinguishSingletAndTripletRadical","fontSize","fontFamily","supFontSizeRatio","subFontSizeRatio","superscriptOverhang","subscriptOversink","bondLineWidth","boldBondLineWidth","hashSpacing","multipleBondSpacingRatio","multipleBondSpacingAbs","multipleBondMaxAbsSpacing","bondArrowLength","bondArrowWidth","bondWedgeWidth","bondWedgeHashMinWidth","bondLengthScaleRatio","color","atomColor","bondColor","useAtomSpecifiedColor","opacity","fillColor","strokeColor","strokeWidth","atomRadius"],r3d:["displayMultipleBond","useVdWRadius","nodeRadius","connectorRadius","nodeRadiusRatio","connectorRadiusRatio","color","atomColor","bondColor","useAtomSpecifiedColor","hideHydrogens","bondSpliceMode"]}},_getRenderOptionDefinitionsHash:function(){if(!this.__$renderOptionDefinitionsHash__){this.__$renderOptionDefinitionsHash__={};var e,t,r=Kekule.Render.RenderOptionUtils.getOptionDefinitions(),i=Kekule.Render.Render3DOptionUtils.getOptionDefinitions();for(e=0,t=r.length;e<t;++e)this.__$renderOptionDefinitionsHash__[r[e].name]=r[e];for(e=0,t=i.length;e<t;++e)this.__$renderOptionDefinitionsHash__[i[e].name]=i[e]}return this.__$renderOptionDefinitionsHash__},_applyCustomCssProps:function(e){var t,r,i=this._getRenderOptionDefinitionsHash(),o=this._getApplicableCustomCssPropNames();for(t=0,r=o.r2d.length;t<r;++t){var n=o.r2d[t];this._applyCustomCssPropValue(n,i,e)}if(this.getRenderType()===Kekule.Render.RendererType.R3D)for(t=0,r=o.r3d.length;t<r;++t){n=o.r3d[t];this._applyCustomCssPropValue(n,i,e)}},_applyCustomCssPropValue:function(e,t,r){if(t[e]){var i=this.getComputedCustomStyle(e);if(i&&i.trim){i=i.trim();var o=Kekule.StrUtils.convertToType(i,t.dataType);Kekule.ObjUtils.notUnset(o)&&(r[e]=o)}}},drawOptionChanged:function(){this.repaint()},geometryOptionChanged:function(){var e=this.getPainter(),t=this.getDrawOptions();if(e&&e.supportGeometryOptionChange()){var r=this.getDrawContext();e.changeGeometryOptions(r,t.baseCoord||this._lastBaseCoord,t),this._savePainterInitialRenderTransformOptions(r,e)}else this.drawOptionChanged()},beginContinuousRepainting:function(){this._isContinuousRepainting=!0},endContinuousRepainting:function(){this._isContinuousRepainting&&(this._isContinuousRepainting=!1,this.repaint())},resetDisplay:function(){var e=this.getDrawOptions();return e.zoom=this.getInitialZoom()||1,e.rotateX=0,e.rotateY=0,e.rotateZ=0,e.rotateAngle=0,e.rotateAxisVector=null,e.rotateMatrix=null,this.setBaseCoordOffset(null),this.geometryOptionChanged(),this},getCurrZoom:function(){return this.getDrawOptions().zoom||1},zoomTo:function(e,t,r){return this.getDrawOptions().zoom=e,t||this.geometryOptionChanged(),this},zoomIn:function(e,t){var i=this.getCurrZoom(),o=r.getNextZoomInRatio(i,e||1);return this.zoomTo(o,null,t)},zoomOut:function(e,t){var i=this.getCurrZoom(),o=r.getNextZoomOutRatio(i,e||1);return this.zoomTo(o,null,t)},resetZoom:function(e){return this.zoomTo(this.getInitialZoom()||1,null,e)},getDefaultMoleculeDisplayType:function(e){return e===Kekule.Render.RendererType.R3D?Kekule.Render.Molecule3DDisplayType.DEFAULT:Kekule.Render.Molecule2DDisplayType.DEFAULT},getCurrMoleculeDisplayType:function(){var e=this.getDrawOptions().moleculeDisplayType;return e||(e=this.getDefaultMoleculeDisplayType(this.getRenderType())),e},setHideHydrogens:function(e){return this.getDrawOptions().hideHydrogens=e,this.drawOptionChanged(),this},exportToDataUri:function(e,t){return this.getDrawBridge().exportToDataUri(this.getDrawContext(),e,t)},createConfigurator:function(){var e=this.tryApplySuper("createConfigurator");return e.addEventListener("configChange",function(e){this.repaint()},this),e},clearBoundMap:function(){this.getBoundInfoRecorder().clear(this.getDrawContext())},findTopmostBoundInfo:function(e,t){if(e&&e.length){var r=null,i=e.length-1;for(r=e[i];i>=0&&t&&t.indexOf(r.obj)>=0;)r=e[--i];return r}return null},getBoundInfosAtCoord:function(e,t,r){var i=this.getBoundInfoRecorder(),o=r,n=this.screenCoordToContext(e),a=this.getRenderType()===Kekule.Render.RendererType.R3D?{x:0,y:0}:null;return i.getIntersectionInfos(this.getDrawContext(),n,a,o,t)},getTopmostBoundInfoAtCoord:function(e,t,r){return this.findTopmostBoundInfo(this.getBoundInfosAtCoord(e,null,r),t,r)},getBasicObjectsAtCoord:function(e,r,i,o){var n=this.getBoundInfosAtCoord(e,null,r),a=[];if(n){i&&(n=t.filter(n,function(e){var t=n[s].obj;return!!t&&!(t&&i&&i.indexOf(t)>=0)}));for(var s=n.length-1;s>=0;--s){var l=n[s].obj;l&&i&&i.indexOf(l)>=0||a.push(l)}a&&o&&(a=t.filter(a,function(e){for(var t=0,r=o.length;t<r;++t)if(e instanceof o[t])return!0;return!1}))}return a},getTopmostBasicObjectAtCoord:function(e,t,r){var i=this.getBasicObjectsAtCoord(e,t,null,r);return i&&i[0]},translateCoord:function(e,t,r){if(!e)return null;var i=Kekule.Render.CoordSystem;if(t===i.SCREEN){if(r===i.SCREEN)return e;if(r===i.CONTEXT)return this.getDrawBridge()?this.getDrawBridge().transformScreenCoordToContext(this.getDrawContext(),e):e;var o=this.getDrawBridge()?this.getDrawBridge().transformScreenCoordToContext(this.getDrawContext(),e):e;return this.getDrawContext()?this.getRootRenderer().transformCoordToObj(this.getDrawContext(),this.getChemObj(),o):e}if(t===i.CONTEXT)return r===i.SCREEN?this.getDrawBridge()?this.getDrawBridge().transformContextCoordToScreen(this.getDrawContext(),e):e:r===i.CONTEXT?e:this.getDrawContext()?this.getRootRenderer().transformCoordToObj(this.getDrawContext(),this.getChemObj(),e):e;if(r===i.SCREEN){o=this.getRootRenderer().transformCoordToContext(this.getDrawContext(),this.getChemObj(),e);return this.getDrawBridge()?this.getDrawBridge().transformContextCoordToScreen(this.getDrawContext(),o):e}return r===i.CONTEXT&&this.getDrawContext()?this.getRootRenderer().transformCoordToContext(this.getDrawContext(),this.getChemObj(),e):e},translateDistance:function(e,t,r){var i={x:e,y:0,z:0},o=this.translateCoord({x:0,y:0,z:0},t,r),n=this.translateCoord(i,t,r);return Kekule.CoordUtils.getDistance(o,n)},objCoordToContext:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.CHEM,t.CONTEXT)},contextCoordToObj:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.CONTEXT,t.CHEM)},objCoordToScreen:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.CHEM,t.SCREEN)},screenCoordToObj:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.SCREEN,t.CHEM)},screenCoordToContext:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.SCREEN,t.CONTEXT)},contextCoordToScreen:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.CONTEXT,t.SCREEN)},screenBoxToContext:function(e){var t=this.screenCoordToContext({x:e.x1,y:e.y1}),r=this.screenCoordToContext({x:e.x2,y:e.y2});return{x1:t.x,y1:t.y,x2:r.x,y2:r.y}},clearSubViews:function(){var e=this.getSubViews();if(e)for(var t=0,r=e.length;t<r;++t)e[t].finalize();this.setPropStoreFieldValue("subViews",void 0)},iterateSubViews:function(e){var t=this.getSubViews();if(t)for(var r=0,i=t.length;r<i;++r)e(t[r],r);return this},getSubView:function(e,t,r){var i,o=this.getSubViews();if(o)for(var n=0,a=o.length;n<a;++n){var s=o[n];if(s.getTarget()===e&&s instanceof t){i=s;break}}!i&&r&&(ClassEx.getPrototype(t).appliableToTarget(e)&&(i=new t(this,e),this.getSubViews(!0).push(i)));return i},fetchSubView:function(e,t){return this.getSubView(e,t,!0)}}),Kekule.ChemWidget.ChemObjDisplayerSubView=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerSubView",initialize:function(e,t){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("parent",e),this.setPropStoreFieldValue("target",t)},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1,setter:null}),this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:!1,getter:function(){return this.getPropStoreFieldValue("target")||this.getParent().getChemObj()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setBubbleEvent(!0)},getHigherLevelObj:function(){return this.getParent()},appliableToTarget:function(e){return!1}}),Kekule.ChemWidget.ChemObjDisplayer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Settings",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile"])},getDisplayer:function(){return this.getWidget()}}),Kekule.ChemWidget.ChemObjDisplayer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var e=this.tryApplySuper("getCategoryInfos"),t=this.getDisplayer(),r=[t.getDisplayerConfigs(),t.getRenderConfigs()],i=0,o=r.length;i<o;++i)for(var n=r[i],a=n.getPropListOfScopes([Class.PropertyScope.PUBLISHED]),s=0,l=a.getLength();s<l;++s){var d=a.getPropInfoAt(s),u=n.getPropValue(d.name);u&&e.push({obj:u,name:d.name,title:d.title,description:d.description})}return e},getDisplayer:function(){return this.getWidget()}}),Kekule.ChemWidget.ActionDisplayerLoadFile=Class.create(Kekule.ActionLoadFileData,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadFile",HTML_CLASSNAME:o.ACTION_LOADFILE,initialize:function(e){this.tryApplySuper("initialize"),this.setDisplayer(e),this.setText(Kekule.$L("ChemWidgetTexts.CAPTION_LOADFILE")),this.setHint(Kekule.$L("ChemWidgetTexts.HINT_LOADFILE"))},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1})},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(this.getEnabled()&&e&&e.getEnabled()&&e.getEnableLoadNewFile())},doDataLoaded:function(e,t,r){r&&this.getDisplayer().loadFromData(e,null,t)}}),Kekule.ChemWidget.ActionOnDisplayer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnDisplayer",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setDisplayer(e),this.setText(t),this.setHint(r)},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1})},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},execute:function(e,t){return!this.getDisplayer()&&e instanceof Kekule.ChemWidget.ChemObjDisplayer&&this.setDisplayer(e),this.tryApplySuper("execute",[e,t])}}),Kekule.ChemWidget.ActionDisplayerClear=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerClear",HTML_CLASSNAME:o.ACTION_CLEAROBJS,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_CLEAROBJS"),Kekule.$L("ChemWidgetTexts.HINT_CLEAROBJS")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(e&&e.getEnabled()&&e.getChemObj())},doExecute:function(e){this.getDisplayer().setChemObj(null)}}),Kekule.ChemWidget.ActionDisplayerLoadData=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadData",HTML_CLASSNAME:o.ACTION_LOADDATA,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA"),Kekule.$L("ChemWidgetTexts.HINT_LOADDATA")])},finalize:function(){this.tryApplySuper("finalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("dataDialog",{dataType:"Kekule.ChemWidget.LoadDataDialog",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("dataDialog");return e||(e=this.createDataDialog(),this.setPropStoreFieldValue("dataDialog",e)),e}}),this.defineProp("dialogShowType",{dataType:DataType.INT})},createDataDialog:function(){var e=this.getDisplayer().getDocument();return new Kekule.ChemWidget.LoadDataDialog(e)},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(e&&e.getEnabled()&&e.getEnableLoadNewFile())},doExecute:function(e){var t=this,r=this.getDataDialog();r.setAllowedFormatIds(this.getDisplayer().getAllowedInputFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds());r._formatSelector;var i=this.getDialogShowType();(i===Kekule.Widget.ShowHideType.DIALOG?r.openModal:r.open).apply(r,[function(e){if(r.isPositiveResult(e)){var i=r.getDataDetails()||{},o=t.getDisplayer();t.doLoadInDisplayer(o,i,r)}},e,i])},doLoadInDisplayer:function(e,t,r){return e.loadFromData(t.data,t.mimeType,t.fileName,t.formatId)}}),Kekule.ChemWidget.ActionDisplayerSaveFile=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerSaveFile",HTML_CLASSNAME:o.ACTION_SAVEFILE,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEFILE"),Kekule.$L("ChemWidgetTexts.HINT_SAVEFILE")]),this._saveAction=new Kekule.ActionFileSave},finalize:function(){this._saveAction.finalize(),this.tryApplySuper("finalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("formatDialog",{dataType:"Kekule.Widget.Dialog",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("formatDialog");return e||(e=this.createFormatDialog(),this.setPropStoreFieldValue("formatDialog",e)),e}}),this.defineProp("lastFormat",{dataType:DataType.STRING,serializable:!1}),this.defineProp("currSaveData",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("dialogShowType",{dataType:DataType.INT})},getChemObjSrcInfo:function(e){var t=this.getDisplayer();return t.getChemObjSrcInfo?t.getChemObjSrcInfo(e):e.getSrcInfo?e.getSrcInfo():null},getChemObjSrcFormat:function(e){var t=this.getChemObjSrcInfo(e);return t?t.format:null},createFormatDialog:function(){var e=this.getDisplayer().getDocument(),t=new Kekule.Widget.Dialog(e,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEDATA_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);t.addClassName(o.DIALOG_CHOOSE_FILE_FORAMT),t.setAutoAdjustSizeOnPopup(!0),(r=e.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_SELECT_FORMAT"),t.getClientElem().appendChild(r),r=e.createElement("div"),t.getClientElem().appendChild(r);var r,i=new Kekule.Widget.SelectBox(t);i.addClassName(o.DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX),i.appendToElem(r),i.addEventListener("valueChange",this.reactFormatSelectorChange,this),t._formatSelector=i,(r=e.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_PREVIEW_FILE_CONTENT"),t.getClientElem().appendChild(r),(r=e.createElement("div")).className=o.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER_REGION,t.getClientElem().appendChild(r);var n=new Kekule.Widget.TextEditor(t);return n.setReadOnly(!0),n.setWrap("off").setAutoWrapThreshold(!0),n.setToolbarPos(Kekule.Widget.Position.BOTTOM),n.addClassName(o.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER),n.appendToElem(r),t._previewTextArea=n,t.setResizable&&t.setResizable(!0),t},getAvailableWriterInfos:function(e){return e?Kekule.IO.ChemDataWriterManager.getAvailableWriterInfos(null,e):[]},getFormatSelectorItems:function(e,t){for(var r=[],i=[],o=this.getChemObjSrcInfo(e),n=o?o.format:null,a=0,s=t.length;a<s;++a){var l=t[a];Kekule.ArrayUtils.pushUnique(i,l.formatId)}for(a=0,s=(i=Kekule.ArrayUtils.intersect(this.getAllowedFormatIds(),i)).length;a<s;++a){var d=Kekule.IO.DataFormatsManager.getFormatInfo(i[a]);if(d){for(var u=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(d.fileExts)),c=0,p=u.length;c<p;++c)u[c]="*."+u[c];var h=u.join(", "),g=d.title;h&&(g+=" ("+h+")");var C=n?i[a]===n:this.getLastFormat()?this.getLastFormat()===i[a]:0===a;r.push({value:d.id,text:g,title:d.mimeType,data:d,selected:C})}}return r.sort(function(e,t){return e.text<t.text?-1:e.text>t.text?1:0}),r},getAllowedFormatIds:function(){return this.getDisplayer().getAllowedOutputFormatIds()||Kekule.IO.ChemDataWriterManager.getAllWritableFormatIds()},getFileFilters:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r],n=o.data,a=o.text||o.title||o.value,s=Kekule.ArrayUtils.toArray(n.fileExts);t.push({title:a,filter:"."+s.join(",.")})}return t.push(Kekule.NativeServices.FILTER_ALL_SUPPORT),t.push(Kekule.NativeServices.FILTER_ANY),t},updateFormatItems:function(e){this._formatItems=this.getFormatSelectorItems(e,this.getAvailableWriterInfos()),this._formatSelector.setItems(this._formatItems);var t=this.getFileFilters(this._formatItems);this._saveAction.setFilters(t)},reactFormatSelectorChange:function(){var e=this.getFormatDialog()._formatSelector.getValue();this.updatePreview(e,this.getFormatDialog())},updatePreview:function(e,t){var r=t._previewTextArea;if(r.setValue(""),e){var i=Kekule.IO.DataFormatsManager.getFormatInfo(e),o=this.getTargetObj(),n=this.getChemObjSrcInfo(o);if(n&&n.format===e&&n.data)r.setValue(n.data),this.setCurrSaveData(n.data);else{var a=this.getDisplayer().saveData(e,i.dataType,o);r.setValue(a),this.setCurrSaveData(a)}}},getTargetObj:function(e){return this.getDisplayer().getSavingTargetObj()},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this._saveAction&&this._saveAction.update(),this.setEnabled(e&&e.getEnabled()&&e.getChemObj())},doExecute:function(e){var t=this,r=this.getFormatDialog(),i=this.getTargetObj(),o=r._formatSelector,n=this.getAvailableWriterInfos(i),a=this.getFormatSelectorItems(i,n);o.setItems(a),this.reactFormatSelectorChange();var s=!1;this._saveAction&&(s=this._saveAction.getEnabled());var l=r.getDialogButton(Kekule.Widget.DialogButtons.OK);l&&l.setEnabled(s);var d=this.getDialogShowType();(d===Kekule.Widget.ShowHideType.DIALOG?r.openModal:r.open).apply(r,[function(i){if(i===Kekule.Widget.DialogButtons.OK){var o=t.getCurrSaveData();t._saveAction.setData(o);var n=r._formatSelector.getValue();t.setLastFormat(n);var a=Kekule.IO.DataFormatsManager.getFormatInfo(n),s=a.fileExts,l=Kekule.ArrayUtils.toArray(s[0]||s),d=[{title:a.title||a.mimeType,filter:"."+l.join(",.")},Kekule.NativeServices.FILTER_ANY],u=Kekule.$L("ChemWidgetTexts.S_DEF_SAVE_FILENAME")+"."+l;t._saveAction.setFileName(u),t._saveAction.setFilters(d),t._saveAction.execute(e)}},e,d])}}),Kekule.ChemWidget.ActionDisplayerCopy=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerCopy",HTML_CLASSNAME:o.ACTION_COPY,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_COPY_WHOLE"),Kekule.$L("ChemWidgetTexts.HINT_COPY_WHOLE")])},doUpdate:function(){if(this.tryApplySuper("doUpdate"),this.getEnabled()){var e=this.getDisplayer().getChemObj();this.setEnabled(e&&e.clone)}},doExecute:function(){var e=this.getDisplayer();if(e){var t=e.getChemObj();t&&Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,[t])}}}),Kekule.ChemWidget.ActionDisplayerReset=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerReset",HTML_CLASSNAME:o.ACTION_RESET,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_RESETVIEW"),Kekule.$L("ChemWidgetTexts.HINT_RESETVIEW")])},doExecute:function(){this.getDisplayer().resetDisplay()}}),Kekule.ChemWidget.ActionDisplayerZoomIn=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomIn",HTML_CLASSNAME:o.ACTION_ZOOMIN,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMIN"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMIN")])},doExecute:function(){this.getDisplayer().zoomIn()}}),Kekule.ChemWidget.ActionDisplayerZoomOut=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomOut",HTML_CLASSNAME:o.ACTION_ZOOMOUT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMOUT"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMOUT")])},doExecute:function(){this.getDisplayer().zoomOut()}}),Kekule.ChemWidget.ActionDisplayerResetZoom=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerResetZoom",HTML_CLASSNAME:o.ACTION_RESET_ZOOM,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_RESETZOOM"),Kekule.$L("ChemWidgetTexts.HINT_RESETZOOM")])},doExecute:function(){this.getDisplayer().resetZoom()}}),Kekule.ChemWidget.ActionDisplayerHideHydrogens=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerHideHydrogens",HTML_CLASSNAME:o.ACTION_MOL_HIDE_HYDROGENS,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_HIDEHYDROGENS"),Kekule.$L("ChemWidgetTexts.HINT_HIDEHYDROGENS")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=e&&e.getRenderType()===Kekule.Render.RendererType.R3D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)},doExecute:function(){var e=!this.getChecked();this.setChecked(e),this.getDisplayer().setHideHydrogens(e)}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,t,r]),this._displayType=i,this.setCheckGroup("__molDisplayType__")},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setChecked(e&&e.getCurrMoleculeDisplayType()===this.getMolDisplayType())},doExecute:function(){this.getDisplayer().setMoleculeDisplayType(this._displayType),this.setChecked(!0)},getMolDisplayType:function(){return this._displayType}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=e&&e.getRenderType()===Kekule.Render.RendererType.R2D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=e&&e.getRenderType()===Kekule.Render.RendererType.R3D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal",HTML_CLASSNAME:o.ACTION_MOL_DISPLAY_SKELETAL,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_SKELETAL"),Kekule.$L("ChemWidgetTexts.HINT_SKELETAL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE=Kekule.Render.Molecule2DDisplayType.SKELETAL,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed",HTML_CLASSNAME:o.ACTION_MOL_DISPLAY_CONDENSED,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_CONDENSED"),Kekule.$L("ChemWidgetTexts.HINT_CONDENSED"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE=Kekule.Render.Molecule2DDisplayType.CONDENSED,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire",HTML_CLASSNAME:o.ACTION_MOL_DISPLAY_WIRE,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_WIRE"),Kekule.$L("ChemWidgetTexts.HINT_WIRE"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE=Kekule.Render.Molecule3DDisplayType.WIRE,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks",HTML_CLASSNAME:o.ACTION_MOL_DISPLAY_STICKS,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_STICKS"),Kekule.$L("ChemWidgetTexts.HINT_STICKS"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE=Kekule.Render.Molecule3DDisplayType.STICKS,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick",HTML_CLASSNAME:o.ACTION_MOL_DISPLAY_BALLSTICK,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_BALLSTICK"),Kekule.$L("ChemWidgetTexts.HINT_BALLSTICK"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE=Kekule.Render.Molecule3DDisplayType.BALL_STICK,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill",HTML_CLASSNAME:o.ACTION_MOL_DISPLAY_SPACEFILL,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_SPACEFILL"),Kekule.$L("ChemWidgetTexts.HINT_SPACEFILL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE=Kekule.Render.Molecule3DDisplayType.SPACE_FILL,Kekule.ChemWidget.ActionDisplayerAutoGenerateCoordsForMolecule=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerAutoGenerateCoordsForMolecule",HTML_CLASSNAME:o.ACTION_MOL_AUTO_COORD_GENERATION,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_AUTO_COORD_GENERATION"),Kekule.$L("ChemWidgetTexts.HINT_AUTO_COORD_GENERATION")])},getCoordMode:function(){return null},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=this.getEnabled()&&!!e.canAutoGenerateCoordForChemObj(e.getChemObj(),Kekule.oneOf(this.getCoordMode(),e.getCoordMode()));this.setDisplayed(t).setEnabled(t)},doExecute:function(){this.getDisplayer().autoGenerateChemObjCoords()}})}(),function(){"use strict";var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEM_STRUCT_TREE_VIEW:"K-Chem-Struct-TreeView",CHEM_STRUCT_TREE_VIEW_ITEM_TITLE:"K-Chem-Struct-TreeView-ItemTitle",CHEM_STRUCT_TREE_VIEW_ITEM_TYPE:"K-Chem-Struct-TreeView-ItemType"}),Kekule.ChemWidget.StructureTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.ChemWidget.StructureTreeView",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("objMap",new Kekule.MapEx(!0)),this.setEnableLiveUpdate(!0),this.setEnableMultiSelect(!0),this.setRootObj(t),this._pauseLiveUpdateFlag=0,this._changedObjects=[]},initProperties:function(){this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("rootObj");this.setPropStoreFieldValue("rootObj",e),this.rootObjChanged(e,t)}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:!1})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.CHEM_STRUCT_TREE_VIEW},rootObjChanged:function(e,t){this.clearChildItems(),this.getObjMap().clear(),t&&this._uninstallRootEventHandler(t),e&&(this._fillTree(e),this._installRootEventHandler(e))},pauseLiveUpdate:function(){return this._pauseLiveUpdateFlag>=0&&(this._pauseLiveUpdateFlag=0,this._changedObjects=[]),--this._pauseLiveUpdateFlag,this},resumeLiveUpdate:function(){if(++this._pauseLiveUpdateFlag,this._pauseLiveUpdateFlag>=0){this._pauseLiveUpdateFlag=0;for(var e=0,t=this._changedObjects.length;e<t;++e)this.refreshObject(this._changedObjects[e])}},isLiveUpdatePaused:function(){return this._pauseLiveUpdateFlag<0},_installRootEventHandler:function(e){e.addEventListener("change",this.reactChemObjChange,this)},_uninstallRootEventHandler:function(e){e.removeEventListener("change",this.reactChemObjChange,this)},reactChemObjChange:function(e){this.getEnableLiveUpdate()&&(this.isLiveUpdatePaused()?this.getObjMap().get(e.target)&&Kekule.ArrayUtils.pushUnique(this._changedObjects,e.target):this.refreshObject(e.target))},refreshObject:function(e){var t=this.getObjMap().get(e);return t&&this._updateTreeItem(t,e),this},_fillTree:function(e){e&&(this.clearChildItems(),this._updateTreeItem(this.appendChildItem(),e))},_updateTreeItem:function(e,t){var r={text:this._getChemObjDisplayTitle(t),obj:t};this.setItemData(e,r),this.getObjMap().set(t,e);for(var i=this.getChildItemCount(e),o=t.getChildCount(),n=0;n<o;++n){var a,s=t.getChildAt(n);a=n<i?this.getChildItemAt(e,n):this.appendChildItem(e),this._updateTreeItem(a,s)}if(i>o)for(n=i-1;n>=o;--n)this.removeChildItemAt(e,n)},_getChemObjDisplayTitle:function(t){var r="",i=t.getId();i&&(r+='<span class="'+e.CHEM_STRUCT_TREE_VIEW_ITEM_TITLE+'">'+i+"</span>");var o=t.getClassName(),n=o.split("."),a=n.length?n[n.length-1]:o;return r+('<span class="'+e.CHEM_STRUCT_TREE_VIEW_ITEM_TYPE+'">('+a+")</span>")},selectChemObjs:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r],n=this.getObjMap().get(o);n&&t.push(n)}return this.select(t),this},getSelectedChemObjs:function(){var e=[],t=this.getSelection();if(t&&t.length)for(var r=0,i=t.length;r<i;++r){var o=this.getItemData(t[r]);o&&o.obj&&e.push(o.obj)}return e}})}(),function(){"use strict";Kekule.oneOf;Kekule.ChemWidget.AbstractUIMarker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.AbstractUIMarker",initialize:function(){this.tryApplySuper("initialize"),this.setVisible(!0)},initProperties:function(){this.defineProp("drawStyles",{dataType:DataType.OBJECT}),this.defineProp("visible",{dataType:DataType.BOOL}),this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("groups",{dataType:DataType.ARRAY})}}),Kekule.ChemWidget.MetaShapeUiMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setShapeInfo(e)},initProperties:function(){this.defineProp("shapeInfo",{dataType:DataType.OBJECT}),this.defineProp("shapeType",{dataType:DataType.INT,serializable:!1,setter:null,getter:function(){var e=this.getShapeInfo();return e?e.shapeType:null}})}}),Kekule.ChemWidget.MetaShapeUIMarker=Kekule.ChemWidget.MetaShapeUiMarker,Kekule.ChemWidget.TextUiMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker",initialize:function(e,t){this.tryApplySuper("initialize"),e&&this.setText(e),t&&this.setCoord(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING}),this.defineProp("coord",{dataType:DataType.HASH})}}),Kekule.ChemWidget.UiMarkerCollection=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection",initProperties:function(){this.defineProp("markers",{dataType:DataType.ARRAY,getter:function(){var e=this.getPropStoreFieldValue("markers");return e||(e=[],this.setPropStoreFieldValue("markers",e)),e},setter:null})},getMarkerCount:function(){return this.getMarkers().length},getMarkerAt:function(e){return this.getMarkers()[e]},getMarkerOfName:function(e){for(var t=0,r=this.getMarkerCount();t<r;++t){var i=this.getMarkerAt(t);if(i.getName()===e)return i}return null},getMarkersOfGroup:function(e){for(var t=Kekule.ArrayUtils.toArray(e),r=[],i=0,o=this.getMarkerCount();i<o;++i){for(var n=this.getMarkerAt(i),a=n.getGroups(),s=!0,l=0,d=t.length;l<d;++l)if(a.indexOf(t[l])<0){s=!1;break}s&&r.push(n)}return r},addMarker:function(e){return this.getMarkers().push(e)},indexOfMarker:function(e){return this.getMarkers().indexOf(e)},removeMarker:function(e){var t=this.getMarkers(),r=t.indexOf(e);r>=0&&t.splice(r,1)},clearMarkers:function(){this.setPropStoreFieldValue("markers",[])}}),Kekule.ChemWidget.UiMarker2DRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerRenderer"}),Kekule.ChemWidget.MetaShapeUiMarker2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker2DRenderer",doDrawSelf:function(e,t,r){var i=this.getChemObj(),o=i.getShapeInfo();if(!o)return null;var n,a=Object.create(r);if((a=Object.extend(a,i.getDrawStyles()||{})).color&&(a.strokeColor||(a.strokeColor=a.color),a.fillColor||(a.fillColor=a.color)),Kekule.Render.MetaShapeUtils.isCompositeShape(o))if(o.length>1){n=this.createDrawGroup(e);for(var s=0,l=o.length;s<l;++s){var d=o[s];this.doDrawShape(e,n,d,a)}}else{if(1!==o.length)return null;n=this.doDrawShape(e,null,o[0],a)}else n=this.doDrawShape(e,null,o,a);return n},doDrawShape:function(e,t,r,i){var o,n=Kekule.Render.MetaShapeType;if(Kekule.Render.MetaShapeUtils.isCompositeShape(r)){o=this.createDrawGroup(e);for(var a=0,s=r.length;a<s;++a)this.doDrawShape(e,o,r[a],i)}else{var l=r.coords;switch(r.shapeType){case n.POINT:o=this.drawCircle(e,l[0],1,i);break;case n.CIRCLE:o=this.drawCircle(e,l[0],r.radius,i);break;case n.LINE:var d=i;r.width&&((d=Object.create(i)).strokeWidth=r.width),o=this.drawLine(e,l[0],l[1],d);break;case n.RECT:o=this.drawRect(e,l[0],l[1],i);break;case n.ARC:(d=Object.extend({},i)).strokeWidth=r.width,d.fillColor=null,o=this.drawArc(e,l[0],r.radius,r.startAngle,r.endAngle,r.anticlockwise,d);break;case n.POLYGON:case n.POLYLINE:var u=[];for(a=0,s=l.length;a<s;++a){var c=0===a?"M":"L";u.push(c);var p=[l[a].x,l[a].y];u.push(p)}r.shapeType===n.POLYGON&&(u.push("L"),p=[l[0].x,l[0].y],u.push(p));var h=Kekule.Render.DrawPathUtils.makePath.apply(this,u);o=this.drawPath(e,h,i)}}return t&&this.addToDrawGroup(o,t),o}}),Kekule.ChemWidget.TextUiMarker2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker2DRenderer",doDrawSelf:function(e,t,r){var i=this.getChemObj(),o={textBoxXAlignment:Kekule.Render.BoxXAlignment.CENTER,textBoxYAlignment:Kekule.Render.BoxYAlignment.CENTER};o=Object.extend(o,r),o=Object.extend(o,i.getDrawStyles()||{});var n=i.getCoord();return i.getText()&&n?this.drawText(e,n,i.getText(),o):null}}),Kekule.ChemWidget.UiMarkerCollection2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection2DRenderer",getChildObjs:function(){for(var e=this.getChemObj().getMarkers(),t=[],r=0,i=e.length;r<i;++r)e[r].getVisible()&&t.push(e[r]);return t}}),Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.MetaShapeUiMarker,Kekule.ChemWidget.MetaShapeUiMarker2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.TextUiMarker,Kekule.ChemWidget.TextUiMarker2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.UiMarkerCollection,Kekule.ChemWidget.UiMarkerCollection2DRenderer),Kekule.ChemWidget.UiMarkersRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkersRenderer",DRAW_ELEM_FIELD:"__$drawElem__",initialize:function(e,t){this.tryApplySuper("initialize",[e,t]),this._drawGroup=null},initProperties:function(){},getObjDrawElem:function(e,t){return this.getExtraProp2(e,t,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(e,t,r){this.setExtraProp2(e,t,this.DRAW_ELEM_FIELD,r)},doEstimateRenderBox:function(e,t,r,i){return null},doDraw:function(e,t,r){this.tryApplySuper("doDraw",[e,t,r]);var i=this.getChemObj(),o=this.createDrawGroup(e);return this.setObjDrawElem(e,i,o),i.getMarkerCount()>0&&this.doDrawMarkers(e,o,i.getMarkers(),r),o},doUpdate1:function(e,t,r){if(this.canModifyGraphic(e)){var i=!1,o=Kekule.Render.ObjectUpdateType;switch(r){case o.ADD:i=this.doAddNew(e,t);break;case o.MODIFY:i=this.doModify(e,t);break;case o.REMOVE:var n=this._extractObjsOfUpdateObjDetails(t);i=this.doRemove(e,n);break;default:return this.tryApplySuper("doUpdate1",[e,t,r])}return i}return this.tryApplySuper("doUpdate1",[e,t,r])},doAddNew:function(e,t){return!!this.canRemoveElem()&&this.doModify(e,t)},doModify:function(e,t){if(!this.canRemoveElem())return!1;var r=this._extractObjsOfUpdateObjDetails(t);this.remove(e,r);var i=this.getChemObj(),o=this.getObjDrawElem(i),n=this.getDrawParams();r.indexOf(i)>=0?this.draw(e,n.baseCoord,n.options):this.doDrawMarkers(e,o,r,n.options)},doRemove:function(e,t){if(!this.canRemoveElem())return!1;var r=this.getObjDrawElem(t);if(r){var i=this.getObjDrawElem(this.getChemObj());this.doRemoveFromGroup(r,i),this.doRemoveElem(e,r),this.setObjDrawElem(t,null)}},doDrawMarkers:function(e,t,r,i){for(var o=0,n=r.length;o<n;++o){var a=r[o];a.getVisible()&&this.doDrawMarker(e,t,a,i)}},doDrawMarker:function(e,t,r,i){var o=r.getShapeInfo();if(!o)return null;var n,a=Object.create(i);if((a=Object.extend(r.getDrawStyles()||{})).color&&(a.strokeColor||(a.strokeColor=a.color),a.fillColor||(a.fillColor=a.color)),Kekule.ArrayUtils.isArray(o))if(o.length>1){n=this.createDrawGroup(e);for(var s=0,l=o.length;s<l;++s){var d=o[s];this.doDrawShape(e,n,d,a)}}else{if(1!==o.length)return null;n=this.doDrawShape(e,null,o[0],a)}else n=this.doDrawShape(e,null,o,a);return n&&(this.setObjDrawElem(e,r,n),t&&this.addToDrawGroup(n,t)),n},doDrawShape:function(e,t,r,i){var o,n=Kekule.Render.MetaShapeType;if(Kekule.Render.MetaShapeUtils.isCompositeShape(r)){o=this.createDrawGroup(e);for(var a=0,s=r.length;a<s;++a)this.doDrawShape(e,o,r[a],i)}else{var l=r.coords;switch(r.shapeType){case n.POINT:o=this.drawCircle(e,l[0],1,i);break;case n.CIRCLE:o=this.drawCircle(e,l[0],r.radius,i);break;case n.LINE:var d=i;r.width&&((d=Object.create(i)).strokeWidth=r.width),o=this.drawLine(e,l[0],l[1],d);break;case n.RECT:o=this.drawRect(e,l[0],l[1],i);break;case n.POLYGON:case n.POLYLINE:var u=[];for(a=0,s=l.length;a<s;++a){var c=0===a?"M":"L";u.push(c);var p=[l[a].x,l[a].y];u.push(p)}r.shapeType===n.POLYGON&&(u.push("L"),p=[l[0].x,l[0].y],u.push(p));var h=Kekule.Render.DrawPathUtils.makePath.apply(this,u);o=this.drawPath(e,h,i)}}return t&&this.addToDrawGroup(o,t),o}}),Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.ChemWidget.UiMarkersRenderer)}(),function(){"use strict";var e=Class.PropertyScope,t=Kekule.ArrayUtils,r=(Kekule.ZoomUtils,Kekule.ChemWidget.ComponentWidgetNames),i=Kekule.ChemWidget,o=Kekule.Widget.EvokeMode;Kekule.globalOptions.add("chemWidget.viewer",{toolButtons:[r.loadData,r.saveData,r.molDisplayType,r.molHideHydrogens,r.zoomIn,r.zoomOut,r.rotateX,r.rotateY,r.rotateZ,r.rotateLeft,r.rotateRight,r.reset,r.copy,r.openEditor],menuItems:[r.loadData,r.saveData,Kekule.Widget.MenuItem.SEPARATOR_TEXT,r.molDisplayType,r.molHideHydrogens,r.zoomIn,r.zoomOut,{text:Kekule.$L("ChemWidgetTexts.CAPTION_ROTATE"),hint:Kekule.$L("ChemWidgetTexts.HINT_ROTATE"),children:[r.rotateLeft,r.rotateRight,r.rotateX,r.rotateY,r.rotateZ]},r.reset,Kekule.Widget.MenuItem.SEPARATOR_TEXT,r.copy,r.openEditor,r.config],toolbar:{evokeModes:[o.EVOKEE_CLICK,o.EVOKEE_MOUSE_ENTER,o.EVOKEE_TOUCH],revokeModes:[o.EVOKEE_MOUSE_LEAVE,o.EVOKER_TIMEOUT],pos:Kekule.Widget.Position.AUTO,marginHorizontal:10,marginVertical:10},editor:{modal:!0,restrainEditorWithCurrObj:!0,shareEditorInstance:!0},enableToolbar:!1,enableDirectInteraction:!0,enableTouchInteraction:!1,enableGestureInteraction:!1,showCaption:!1,useNormalBackground:!1,enableCustomCssProperties:!0,restraintRotation3DEdgeRatio:.18,enableRestraintRotation3D:!0}),Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER:"K-Chem-Viewer",VIEWER2D:"K-Chem-Viewer2D",VIEWER3D:"K-Chem-Viewer3D",VIEWER_CLIENT:"K-Chem-Viewer-Client",VIEWER_CAPTION:"K-Chem-Viewer-Caption",VIEWER_EMBEDDED_TOOLBAR:"K-Chem-Viewer-Embedded-Toolbar",VIEWER_UICONTEXT_PARENT:"K-Chem-Viewer-UiContext-Parent",VIEWER_MENU_BUTTON:"K-Chem-Viewer-Menu-Button",VIEWER_EDITOR_FULLCLIENT:"K-Chem-Viewer-Editor-FullClient",ACTION_ROTATE_LEFT:"K-Chem-RotateLeft",ACTION_ROTATE_RIGHT:"K-Chem-RotateRight",ACTION_ROTATE_X:"K-Chem-RotateX",ACTION_ROTATE_Y:"K-Chem-RotateY",ACTION_ROTATE_Z:"K-Chem-RotateZ",ACTION_VIEWER_EDIT:"K-Chem-Viewer-Edit"});var n=Kekule.Widget.HtmlClassNames,a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ViewerUiMarkerGroup={HOTTRACK:"hotTrack",SELECT:"select"},Kekule.ChemWidget.Viewer=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.ChemWidget.Viewer",BINDABLE_TAG_NAMES:["div","span","img"],DEF_BGCOLOR_2D:null,DEF_BGCOLOR_3D:"#000000",DEF_TOOLBAR_EVOKE_MODES:[o.EVOKEE_CLICK,o.EVOKEE_MOUSE_ENTER,o.EVOKEE_TOUCH],DEF_TOOLBAR_REVOKE_MODES:[o.EVOKEE_MOUSE_LEAVE,o.EVOKER_TIMEOUT],OBSERVING_GESTURES:["pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout"],initialize:function(e,t,r,i){this.setPropStoreFieldValue("renderType",r||Kekule.Render.RendererType.R2D),this.setPropStoreFieldValue("useCornerDecoration",!0);var o=Kekule.oneOf,n=Kekule.globalOptions.get("chemWidget.viewer")||{};this.setPropStoreFieldValue("enableToolbar",o(n.enableToolbar)),this.setPropStoreFieldValue("enableDirectInteraction",o(n.enableDirectInteraction,!0)),this.setPropStoreFieldValue("showCaption",o(n.showCaption,!1)),n=n.toolbar||{},this.setPropStoreFieldValue("toolbarEvokeModes",o(n.evokeModes,this.DEF_TOOLBAR_EVOKE_MODES)),this.setPropStoreFieldValue("toolbarRevokeModes",o(n.revokeModes,this.DEF_TOOLBAR_REVOKE_MODES)),this.setPropStoreFieldValue("toolbarPos",o(n.pos,Kekule.Widget.Position.AUTO)),this.setPropStoreFieldValue("toolbarMarginHorizontal",o(n.marginHorizontal,10)),this.setPropStoreFieldValue("toolbarMarginVertical",o(n.marginVertical,10)),this.tryApplySuper("initialize",[e,t,r]),this.setPropStoreFieldValue("viewerConfigs",i||this.createDefaultConfigs()),this.beginUpdate();try{this.setPadding(this.getRenderConfigs().getLengthConfigs().getActualLength("autofitContextPadding")),this._isContinuousRepainting=!1;var a=Kekule.Render.RendererType,s=this.getRenderType()===a.R2D&&this.getBackgroundColor()||this.DEF_BGCOLOR_2D,l=this.getRenderType()===a.R3D&&this.getBackgroundColor()||this.DEF_BGCOLOR_3D;this.setBackgroundColorOfType(s,a.R2D),this.setBackgroundColorOfType(l,a.R3D),this.useCornerDecorationChanged(),this.doResize()}finally{this.endUpdate()}var d=Kekule.globalOptions.get("chemWidget.viewer")||{};this.setEnableGesture(o(d.enableGestureInteraction,!1)),this.addIaController("default",new Kekule.ChemWidget.ViewerBasicInteractionController(this),!0)},doFinalize:function(){var e=this.getUiMarkers();e&&e.finalize();var t=this.getToolbar();this.tryApplySuper("doFinalize"),t&&t.finalize(),this._composerDialog&&this._composerDialog.finalize(),this._composerPanel&&this._composerPanel.finalize()},initProperties:function(){this.defineProp("viewerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:!1,getter:function(){return this.getDisplayerConfigs()},setter:function(e){return this.setDisplayerConfigs(e)}}),this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){if(!this.getEnableUiContext())return null;var e=this.getPropStoreFieldValue("uiDrawBridge");return e||this.__$uiDrawBridgeInitialized$__||(this.__$uiDrawBridgeInitialized$__=!0,e=this.createUiDrawBridge(),this.setPropStoreFieldValue("uiDrawBridge",e)),e}}),this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:!1,getter:function(){if(!this.getEnableUiContext())return null;var e=this.getPropStoreFieldValue("uiContext");if(!e){var t=this.getUiDrawBridge();if(t){var r=this.getUiContextParentElem();if(!r)return null;var i=Kekule.HtmlElementUtils.getElemScrollDimension(r);e=t.createContext(r,i.width,i.height),this.setPropStoreFieldValue("uiContext",e)}}return e}}),this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiPainter");if(!e){var t=this.getUiMarkers();return(e=new Kekule.Render.ChemObjPainter(Kekule.Render.RendererType.R2D,t,this.getUiDrawBridge())).setCanModifyTargetObj(!0),this.setPropStoreFieldValue("uiPainter",e),e}return e}}),this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,setter:null,getter:function(){var e=this.getUiPainter();return e?(e.getRenderer()||e.prepareRenderer(),e.getRenderer()||null):null}}),this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiMarkers");return e||(e=new Kekule.ChemWidget.UiMarkerCollection,this.setPropStoreFieldValue("uiMarkers",e)),e}}),this.defineProp("allowedMolDisplayTypes",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("allowedMolDisplayTypes",e),this.updateUiComps()}}),this.defineProp("retainAspect",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).retainAspect},setter:function(e){var t=this.getDrawOptions()||{};return t.retainAspect=!!e,this.setDrawOptions(t)}}),this.defineProp("enableRestraintRotation3D",{dataType:DataType.BOOL}),this.defineProp("restraintRotation3DEdgeRatio",{dataType:DataType.FLOAT}),this.defineProp("enableHotKey",{dataType:DataType.FLOAT}),this.defineProp("enableEdit",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableEdit")&&this.getCoordMode()!==Kekule.CoordMode.COORD3D}}),this.defineProp("shareEditorInstance",{dataType:DataType.BOOL}),this.defineProp("enableEditFromVoid",{dataType:DataType.BOOL}),this.defineProp("restrainEditorWithCurrObj",{dataType:DataType.BOOL}),this.defineProp("modalEdit",{dataType:DataType.BOOL}),this.defineProp("editorProperties",{dataType:DataType.HASH}),this.defineProp("toolButtons",{dataType:DataType.ARRAY,scope:e.PUBLIC,getter:function(){return this.getPropStoreFieldValue("toolButtons")},setter:function(e){this.setPropStoreFieldValue("toolButtons",e),this.updateToolbar()}}),this.defineProp("menuItems",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("menuItems",e),this.updateMenu()}}),this.defineProp("menu",{dataType:"Kekule.Widget.Menu",serializable:!1,scope:e.PRIVATE,setter:function(e){var t=this.getMenu();e!==t&&(t&&(t.finalize(),t=null),this.setPropStoreFieldValue("menu",e))}}),this.defineProp("toolbar",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,scope:e.PRIVATE,setter:function(e){var t=this.getToolbar(),r=this.getToolbarEvokeHelper();if(e!==t){if(t){t.finalize();var i=this.getToolbarEvokeHelper();i&&i.finalize(),t=null}r&&r.finalize(),this.setPropStoreFieldValue("toolbar",e),e&&this.setPropStoreFieldValue("toolbarEvokeHelper",new Kekule.Widget.DynamicEvokeHelper(this,e,this.getToolbarEvokeModes(),this.getToolbarRevokeModes()))}}}),this.defineProp("enableToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableToolbar",e),this.updateToolbar()}}),this.defineProp("toolbarPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(e){this.setPropStoreFieldValue("toolbarPos",e),this.adjustToolbarPos()}}),this.defineProp("toolbarMarginVertical",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarMarginVertical",e),this.adjustToolbarPos()}}),this.defineProp("toolbarMarginHorizontal",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarMarginHorizontal",e),this.adjustToolbarPos()}}),this.defineProp("toolbarEvokeHelper",{dataType:"Kekule.Widget.DynamicEvokeHelper",serializable:!1,setter:null,scope:e.PRIVATE}),this.defineProp("toolbarEvokeModes",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("toolbarEvokeModes",e||[]),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setEvokeModes(e||[])}}),this.defineProp("toolbarRevokeModes",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("toolbarRevokeModes",e||[]),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setRevokeModes(e||[])}}),this.defineProp("toolbarRevokeTimeout",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarRevokeTimeout",e),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setTimeout(e)}}),this.defineProp("toolbarParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getToolbarParentElem()!==e&&(this.setPropStoreFieldValue("toolbarParentElem",e),this.updateToolbar())}}),this.defineProp("caption",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("caption",e),Kekule.DomUtils.setElementText(this.getCaptionElem(),e||""),this.captionChanged()}}),this.defineProp("showCaption",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showCaption",e),this.captionChanged()}}),this.defineProp("captionPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(e){this.setPropStoreFieldValue("captionPos",e),this.captionChanged()}}),this.defineProp("autoCaption",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoCaption",e),e&&this.autoDetectCaption()}}),this.defineProp("captionElem",{dataType:DataType.OBJECT,scope:e.PRIVATE,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("captionElem");return t||e||(t=this.doCreateCaptionElem(),this.setPropStoreFieldValue("captionElem",t)),t}}),this.defineProp("actions",{dataType:"Kekule.ActionList",serializable:!1,scope:e.PUBLIC,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actions");return e||(e=new Kekule.ActionList,this.setPropStoreFieldValue("actions",e)),e}}),this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actionMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("actionMap",e)),e}}),this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL}),this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableTouchInteraction",!!e),this.setTouchAction(e?"none":null)}}),this.defineProp("enableGesture",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this.getEnableGesture()!==t&&(this.setPropStoreFieldValue("enableGesture",t),this.startObservingGestureEvents(this.OBSERVING_GESTURES))}}),this.defineProp("hotTrackedObjects",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("hotTrackedObjects")||[]},setter:function(e){this.changeHotTrackedObjects(e&&t.toArray(e),!0)}}),this.defineProp("selectedObjects",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("selectedObjects")||[]},setter:function(e){this.changeSelectedObjects(e&&t.toArray(e),!0)}})},initPropValues:function(){this.setStyleMode(Kekule.Widget.StyleMode.INHERITED);var e=Kekule.oneOf,t=Kekule.globalOptions.get("chemWidget.viewer")||{};this.setUseNormalBackground(e(t.useNormalBackground,!1)),this.setEnableCustomCssProperties(e(t.enableCustomCssProperties,!0)),this.setRestraintRotation3DEdgeRatio(e(t.restraintRotation3DEdgeRatio,.18)),this.setEnableRestraintRotation3D(e(t.enableRestraintRotation3D,!0)),this.setEnableTouchInteraction(e(t.enableTouchInteraction,!1)),t=t.editor||{},this.setModalEdit(e(t.modal,!0)),this.setRestrainEditorWithCurrObj(e(t.restrainEditorWithCurrObj,!0)),this.setShareEditorInstance(e(t.shareEditorInstance,!0))},createDefaultConfigs:function(){return new Kekule.ChemWidget.ViewerConfigs},canUsePlaceHolderOnElem:function(e){var t=e.getAttribute("src");return"img"===e.tagName.toLowerCase()&&!!t},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),this.updateActions()},doSetElement:function(e){var t=e;t&&("img"===t.tagName.toLowerCase()&&(t=Kekule.DomUtils.replaceTagName(t,"span")));return this.tryApplySuper("doSetElement",[t])},doUnbindElement:function(e){return this._drawContextParentElem&&this._drawContextParentElem.parentNode&&(this._drawContextParentElem.parentNode.removeChild(this._drawContextParentElem),this._drawContextParentElem=null),this.tryApplySuper("doUnbindElement",[e])},elementBound:function(e){this.setObserveElemResize(!0)},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=e.createElement("div");return r.className=a.VIEWER_CLIENT,this._clientElement=r,t.appendChild(r),[r]},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+a.VIEWER;try{var t=this.getRenderType();e+=" "+this._getRenderTypeSpecifiedHtmlClassName(t)}catch(e){}return e},_getRenderTypeSpecifiedHtmlClassName:function(e){return e===Kekule.Render.RendererType.R3D?a.VIEWER3D:a.VIEWER2D},getClientElement:function(){return this._clientElement},getResizerElement:function(){return this.getElement()},doResize:function(){this.adjustDrawParentDim(),this.adjustToolbarPos(),this.tryApplySuper("doResize")},doWidgetShowStateChanged:function(e){e&&this.updateActions()},refitDrawContext:function(e){this.tryApplySuper("refitDrawContext",[e]),this.adjustToolbarPos()},changeContextDimension:function(e){return this.getEnableUiContext()&&this.getUiDrawBridge()&&this.getUiContext()&&this.doChangeContextDimension(this.getUiContext(),this.getUiDrawBridge(),e,!0),this.tryApplySuper("changeContextDimension",[e])},getAllowRenderTypeChange:function(){return!0},resetRenderType:function(e,t){this.tryApplySuper("resetRenderType",[e,t]);var r=this._getRenderTypeSpecifiedHtmlClassName(e),i=this._getRenderTypeSpecifiedHtmlClassName(t);this.removeClassName(r),this.addClassName(i),this.updateUiComps()},doLoad:function(e){this.beginUpdateUiMarkers();try{this.clearHotTrackedItems(),this.clearSelectedItems(),this.clearUiMarkers()}finally{this.endUpdateUiMarkers()}this.tryApplySuper("doLoad",[e])},doLoadEnd:function(e){this.updateActions(),this.autoDetectCaption()},_repaintCore:function(e){this.tryApplySuper("_repaintCore",[e])},chemObjRendered:function(e,t){var r=this.tryApplySuper("chemObjRendered",[e,t]);return this.updateUiMarkers(!0),r},doSetUseCornerDecoration:function(e){this.tryApplySuper("doSetUseCornerDecoration",[e]),this.useCornerDecorationChanged()},useCornerDecorationChanged:function(){var e=this.getDrawContextParentElem();e&&(this.getUseCornerDecoration()?Kekule.HtmlElementUtils.addClass(e,n.CORNER_ALL):Kekule.HtmlElementUtils.removeClass(e,n.CORNER_ALL))},getBoundInfosAtCoord:function(e,t,r){var i=this.tryApplySuper("getBoundInfosAtCoord",[e,t,r]),o=this.getViewerConfigs().getInteractionConfigs().getEnableTrackOnNearest();if(i&&i.length&&o){var n=new Kekule.MapEx;try{for(var a=Kekule.Render.MetaShapeUtils,s=i.length-1;s>=0;--s){var l=i[s],d=l.boundInfo,u=a.getDistance(e,d);n.set(l,u)}i.sort(function(e,t){var r=-(e.boundInfo.shapeType-t.boundInfo.shapeType);return 0===r&&(r=-(n.get(e)-n.get(t))),r})}finally{n.finalize()}}return i},getEnableUiContext:function(){return!0},getUiContextParentElem:function(e){if(!this.getEnableUiContext())return null;var t=this._uiContextParentElem;if(!t&&!e){t=this.getDocument().createElement("div"),this._uiContextParentElem=t,Kekule.HtmlElementUtils.addClass(t,n.DYN_CREATED),Kekule.HtmlElementUtils.addClass(t,a.VIEWER_UICONTEXT_PARENT),t.style.width="100%",t.style.height="100%";var r=this.getDrawContextParentElem(),i=r?r.parentNode:this.getElement(),o=r&&r.nextSibling;o?i.insertBefore(t,o):i.appendChild(t)}return t},createUiDrawBridge:function(){var e=Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!e){var t=Kekule.Render.DrawBridge2DMananger.getUnavailableMessage()||Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));t&&this.reportException(t,Kekule.ExceptionLevel.NOT_FATAL_ERROR)}return e},adjustDrawParentDim:function(){var e=this.getDrawContextParentElem(),t=e.parentNode,r=this.getCaptionElem(!0);Kekule.HtmlElementUtils.getElemClientDimension(t);if(r&&this.captionIsShown()&&r.parentNode===t){var i=Kekule.HtmlElementUtils.getElemClientDimension(r).height||0;this.getCaptionPos()&Kekule.Widget.Position.TOP?(e.style.top=i+"px",e.style.bottom="0px"):(e.style.top="0px",e.style.bottom=i+"px"),Kekule.StyleUtils.removeStyleProperty(e.style,"height")}else Kekule.StyleUtils.removeStyleProperty(e.style,"top"),Kekule.StyleUtils.removeStyleProperty(e.style,"bottom"),e.style.height="100%"},getInteractionReceiverElem:function(){return this.getClientElement()},setDrawDimension:function(e,t){var r=t;this.captionIsShown()&&(r+=Kekule.HtmlElementUtils.getElemClientDimension(this.getCaptionElem()).height||0);this.tryApplySuper("setDrawDimension",[e,r])},doCreateCaptionElem:function(){var e=this.getDocument().createElement("span");return e.className=n.DYN_CREATED+"  "+n.SELECTABLE+" "+a.VIEWER_CAPTION,this.getElement().appendChild(e),e},captionChanged:function(){if(this.captionIsShown()){var e=(t=this.getCaptionElem()).style;this.getCaptionPos()&Kekule.Widget.Position.TOP?(e.top=0,e.bottom="auto"):(e.bottom=0,e.top="auto"),e.display="block"}else{var t;(t=this.getCaptionElem(!0))&&(t.style.display="none")}this.doResize()},captionIsShown:function(){return this.getCaption()&&this.getShowCaption()},beginUpdateUiMarkers:function(){Kekule.ObjUtils.isUnset(this._uiMarkerUpdateFlag)&&(this._uiMarkerUpdateFlag=0),--this._uiMarkerUpdateFlag,this.beginUpdate()},endUpdateUiMarkers:function(){this.endUpdate(),++this._uiMarkerUpdateFlag,this._uiMarkerUpdateFlag>0&&(this._uiMarkerUpdateFlag=0),this.isUpdatingUiMarkers()||this.repaintUiMarker()},isUpdatingUiMarkers:function(){return this._uiMarkerUpdateFlag<0},_getUiMarkerOfName:function(e,t,r){var i=this.getUiMarkers().getMarkerOfName(e);return!i&&r&&(i=r.apply(this))&&(i.setName(e),i.setGroups(t)),i},_getDefaultHotTrackUiMarker:function(e){var t;return e&&(t=this.createShapeBasedMarker),this._getUiMarkerOfName("hotTrackMarker",[Kekule.ChemWidget.ViewerUiMarkerGroup.HOTTRACK],t)},_getDefaultSelectionUiMarker:function(e){var t;return e&&(t=this.createShapeBasedMarker),this._getUiMarkerOfName("selectionMarker",[Kekule.ChemWidget.ViewerUiMarkerGroup.SELECT],t)},recalcUiMarkers:function(){if(this.getUiDrawBridge()){this.beginUpdateUiMarkers();try{var e,t=this.getHotTrackedObjects();if(t&&t.length){var r=this._calcBoundsOfObjects(t),i=this.getViewerConfigs().getUiMarkerConfigs().getHotTrackMarkerStyles()||{};e=this._getDefaultHotTrackUiMarker(!0),this.modifyShapeBasedMarker(e,r,i,!1),this.showUiMarker(e)}else(e=this._getDefaultHotTrackUiMarker(!1))&&this.hideUiMarker(e,!1);var o=this.getSelectedObjects();if(o&&o.length){r=this._calcBoundsOfObjects(o),i=this.getViewerConfigs().getUiMarkerConfigs().getSelectionMarkerStyles()||{};e=this._getDefaultSelectionUiMarker(!0),this.modifyShapeBasedMarker(e,r,i,!1),this.showUiMarker(e)}else(e=this._getDefaultSelectionUiMarker(!1))&&this.hideUiMarker(e,!1)}finally{this.endUpdateUiMarkers()}}},repaintUiMarker:function(){if(!this.isUpdatingUiMarkers()&&this.getUiDrawBridge()&&this.getUiContext()){this.clearUiContext();var e=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),e.baseCoord,e.drawOptions)}},updateUiMarkers:function(e){this.doUpdateUiMarkers(),e&&this.repaintUiMarker()},doUpdateUiMarkers:function(){this.recalcUiMarkers()},createShapeBasedMarker:function(e,t,r,i){var o=new Kekule.ChemWidget.MetaShapeUiMarker;return e&&o.setShapeInfo(e),t&&o.setDrawStyles(t),r&&o.setPropValues(r),this.getUiMarkers().addMarker(o),i&&this.repaintUiMarker(),o},modifyShapeBasedMarker:function(e,t,r,i){Kekule.Render.ObjectUpdateType.MODIFY;t&&e.setShapeInfo(t),r&&e.setDrawStyles(r),i&&this.repaintUiMarker()},createTextBasedMarker:function(e,t,r,i,o){var n=new Kekule.ChemWidget.TextUiMarker;return e&&n.setCoord(e),t&&n.setText(t),r&&n.setDrawStyles(r),i&&n.setPropValues(i),this.getUiMarkers().addMarker(n),o&&this.repaintUiMarker(),n},modifyTextBasedMarker:function(e,t,r,i,o){Kekule.Render.ObjectUpdateType.MODIFY;t&&e.setCoord(t),r&&e.setText(r),i&&e.setDrawStyles(i),o&&this.repaintUiMarker()},getUiMarkersOfGroup:function(e){return this.getUiMarkers().getMarkersOfGroup(e)},modifyUiMarkers:function(e,r){for(var i=e instanceof Kekule.ChemWidget.UiMarkerCollection?e.getMarkers():t.toArray(e),o=0,n=i.length;o<n;++o)i[o].setPropValues(r)},setVisibleOfUiMarkers:function(e,t,r){return this.modifyUiMarkers(e,{visible:t}),r&&this.repaintUiMarker(),this},setVisibleOfUiMarkerGroup:function(e,t,r){var i=this.getUiMarkersOfGroup(e);return this.setVisibleOfUiMarkers(i,t,r)},hideUiMarker:function(e,t){e.setVisible(!1),t&&this.repaintUiMarker()},showUiMarker:function(e,t){e.setVisible(!0),t&&this.repaintUiMarker()},removeUiMarker:function(e){e&&(this.getUiMarkers().removeMarker(e),this.repaintUiMarker())},clearUiMarkers:function(){this.getUiMarkers().clearMarkers(),this.repaintUiMarker()},clearUiContext:function(){this.getUiContext()&&this.getUiDrawBridge()&&this.getUiDrawBridge().clearContext(this.getUiContext())},getEnableObjectSelect:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getViewerConfigs().getInteractionConfigs().getEnableBasicObjectSelect()},getEnableObjectHotTrack:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getViewerConfigs().getInteractionConfigs().getEnableBasicObjectHotTrack()},addToSelection:function(e){for(var r=t.clone(this.getSelectedObjects()),i=e?t.toArray(e):[],o=!1,n=0,a=i.length;n<a;++n){var s=i[n];r.indexOf(s)>=0||(r.push(s),o=!0)}o&&this.changeSelectedObjects(r,!0)},removeFromSelection:function(e){for(var r=t.clone(this.getSelectedObjects()),i=e?t.toArray(e):[],o=!1,n=0,a=i.length;n<a;++n){var s=i[n],l=r.indexOf(s);l>=0&&(r.splice(l,1),o=!0)}o&&this.changeSelectedObjects(r,!0)},toggleSelectingState:function(e){for(var r=t.clone(this.getSelectedObjects()),i=t.toArray(e),o=0,n=i.length;o<n;++o){var a=i[o],s=r.indexOf(a);s>=0?r.splice(s,1):r.push(a)}this.changeSelectedObjects(r,!0)},select:function(e){var r=e?t.toArray(e):[];this.changeSelectedObjects(r,!0)},clearHotTrackedItems:function(e,t){this.iterateSubViews(function(t){(!e||e.indexOf(t)<0)&&t.doClearHotTrackedItems()}),(!e||e.indexOf(this)<0)&&this.doClearHotTrackedItems(),t&&this.repaintUiMarker()},doClearHotTrackedItems:function(e){this.changeHotTrackedObjects([],e)},clearSelectedItems:function(e,t){this.iterateSubViews(function(t){e&&e.indexOf(t)<0&&t.doClearSelectedItems()}),e&&e.indexOf(this)<0&&this.doClearSelectedItems(),t&&this.repaintUiMarker()},doClearSelectedItems:function(e){this.changeSelectedObjects([],e)},_isSameHotTrackedOrSelectedObjs:function(e,r){var i=e,o=r;return i&&!i.length&&(i=null),o&&!o.length&&(o=null),i==o||!(!i||!o)&&0===t.compare(i,o,function(e,t){return e===t?0:-1})},_changeHotTrackOrSelectObjectRenderStyles:function(e,t,r,i){var o=!1,n=r?"_selectedObjectRenderStyles":"_hotTrackedObjectRenderStyles";if(e&&e.length){var a=this[n];if(a)for(var s=0,l=e.length;s<l;++s){(u=e[s]).removeOverrideRenderOptionItem&&(u.removeOverrideRenderOptionItem(a),o=!0)}}if(t&&t.length){var d=r?this.getViewerConfigs().getUiMarkerConfigs().getSelectedObjectStyles():this.getViewerConfigs().getUiMarkerConfigs().getHotTrackedObjectStyles();if(d){this[n]=d;for(s=0,l=t.length;s<l;++s){var u;(u=t[s]).addOverrideRenderOptionItem&&(u.addOverrideRenderOptionItem(d),o=!0)}}}else this[n]=null;i&&o&&this.requestRepaint()},changeHotTrackedObjects:function(e,r){var i=this.getHotTrackedObjects()||[],o=e?t.toArray(e):[];if(!this._isSameHotTrackedOrSelectedObjs(i,o)){r&&this.beginUpdateUiMarkers();try{this._changeHotTrackOrSelectObjectRenderStyles(i,o,!1,r),this.setPropStoreFieldValue("hotTrackedObjects",o),o&&o.length&&this.clearHotTrackedItems([this],!1),r&&this.updateUiMarkers(!0),this.invokeEvent("hotTrackOnObjects",{objects:o,prevObjects:i})}finally{r&&this.endUpdateUiMarkers()}}},changeSelectedObjects:function(e,r){var i=this.getSelectedObjects(),o=e?t.toArray(e):[];if(!this._isSameHotTrackedOrSelectedObjs(i,o)){r&&this.beginUpdateUiMarkers();try{this._changeHotTrackOrSelectObjectRenderStyles(i,o,!0,r),this.setPropStoreFieldValue("selectedObjects",o),o&&o.length&&this.clearSelectedItems([this],!1),r&&this.updateUiMarkers(!0),this.invokeEvent("selectionChange",{objects:o,prevObjects:i})}finally{r&&this.endUpdateUiMarkers()}}},_calcBoundsOfObjects:function(e,t){var r=[];Kekule.ObjUtils.isUnset(t)&&(t=this.getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation());for(var i=0;i<e.length;++i){var o=e[i],n=this.getBoundInfoRecorder().getBelongedInfos(this.getDrawContext(),o);if(n&&n.length)for(var a=0,s=n.length;a<s;++a){var l=n[a].boundInfo;l&&(l=Kekule.Render.MetaShapeUtils.inflateShape(l,t),Kekule.ArrayUtils.pushUnique(r,l))}}return r},getAllowEditing:function(){return this.getCoordMode()!==Kekule.CoordMode.COORD3D&&this.getEnableEdit()&&(this.getChemObj()||this.getEnableEditFromVoid())},getComposerDialog:function(){var e;return(e=this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerDialog:this._composerDialog)||Kekule.Editor.ComposerDialog&&(e=new Kekule.Editor.ComposerDialog(this.getDocument(),Kekule.$L("ChemWidgetTexts.CAPTION_EDIT_OBJ"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL])),this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerDialog=e:this._composerDialog=e,e},getComposerPanel:function(){var e;if(!(e=this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerPanel:this._composerPanel)&&Kekule.Editor.Composer){(e=new Kekule.Editor.Composer(this.getDocument())).addClassName(a.VIEWER_EDITOR_FULLCLIENT),e.setUseNormalBackground(!0);var i=Kekule.Editor.Composer.getMinPreferredDimension();e.setMinDimension(i),e.setEnableDimensionTransform(!0),e.setAutoResizeConstraints({width:1,height:1});var o=Kekule.globalOptions.chemWidget.composer.commonToolButtons;o=t.exclude(o,[r.cut,r.config,r.objInspector]),e.setCommonToolButtons(o);var n=[{text:Kekule.$L("ChemWidgetTexts.CAPTION_EDITOR_DONE"),hint:Kekule.$L("ChemWidgetTexts.HINT_EDITOR_DONE"),htmlClass:"K-Res-Button-YesOk",showText:!0,"#execute":function(){e._doneEditCallback(),e.hide()}},{text:Kekule.$L("ChemWidgetTexts.CAPTION_EDITOR_CANCEL"),hint:Kekule.$L("ChemWidgetTexts.HINT_EDITOR_CANCEL"),htmlClass:"K-Res-Button-NoCancel",showText:!0,"#execute":function(){e.hide()}}];e._customEndEditButtons=n}return this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerPanel=e:this._composerPanel=e,e._invokerViewer=this,e._doneEditCallback=null,e},openEditor:function(e){if(this.getAllowEditing()){var t=this.getChemObj(),r=!t,i=t&&t.isEmpty&&t.isEmpty(),o=this.getRestrainEditorWithCurrObj(),n=Kekule.DocumentUtils.getClientDimension(this.getDocument()),a=Kekule.Editor.Composer.getMinPreferredDimension();n.width<=a.width+50||n.height<a.height+100?this._openEditComposer(e,t,o,r,i):this._openEditComposerDialog(e,t,o,r,i)}},_prepareEditComposer:function(e,t,r,i){e.setEnableCreateNewDoc(r||!t),e.setEnableLoadNewFile(r||!t),e.setAllowCreateNewChild(r||!t);var o=this.getEditorProperties();o&&e.setPropValues(o)},_feedbackEditResult:function(e,t,r){if(e.isDirty()){var i=e.getSavingTargetObj();r?this.setChemObj(i.clone()):this.getRestrainEditorWithCurrObj()?(t.getClass()===i.getClass()?t.assign(i.clone()):t.assign(i),t.setSrcInfo(null),this.setChemObj(t)):this.setChemObj(i),this.invokeEvent("editingDone",{obj:this.getChemObj()})}},_openEditComposerDialog:function(e,t,r,i,o){var n=this.getComposerDialog();if(n){var a,s=n.getComposer();this._prepareEditComposer(s,r,i,o),i||o?n.getComposer().newDoc():(a=t.clone(),n.setChemObj(a));var l=this,d=function(e){e===Kekule.Widget.DialogButtons.OK&&n.getComposer().isDirty()&&l._feedbackEditResult(n.getComposer(),t,i)};this.getModalEdit()?n.openModal(d,e||this):n.openPopup(d,e||this)}else Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"))},_openEditComposer:function(e,t,r,i,o){var n=this.getComposerPanel();if(n){this._prepareEditComposer(n,r,i,o);for(var a=n._customEndEditButtons,s=n.getCommonToolButtons()||[],l=!1,d=0,u=a.length;d<u;++d){var c=a[d];s.indexOf(c)<0&&(s.push(c),l=!0)}if(l&&n.setCommonToolButtons(s),i||o)n.newDoc();else{var p=t.clone();n.setChemObj(p)}var h=this;n._doneEditCallback=function(){h._feedbackEditResult(n,t,i)},n.show(e,function(){i||o||n.setChemObj(p)},Kekule.Widget.ShowHideType.POPUP)}else Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"))},resetView:function(){return this.resetDisplay()},getCurr2DRotationAngle:function(){return this.getDrawOptions().rotateAngle||0},rotate2DBy:function(e,t){return this.rotate2DTo(this.getCurr2DRotationAngle()+e,t)},rotate2DTo:function(e,t){return this.getDrawOptions().rotateAngle=e,t||this.geometryOptionChanged(),this},getCurr3DRotationInfo:function(){for(var e={},t=["rotateMatrix","rotateX","rotateY","rotateZ","rotateAngle"],r=this.getDrawOptions(),i=0,o=t.length;i<o;++i){var n=t[i];e[n]=r[n]||0}return e.rotateAxisVector=r.rotateAxisVector||null,e},setRotate3DMatrix:function(e,t){return this.getDrawOptions().rotateMatrix=e,t||this.geometryOptionChanged(),this},rotate3DBy:function(e,t,r,i){var o=this.getCurr3DRotationInfo().rotateMatrix||Kekule.MatrixUtils.createIdentity(4),n=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:e,rotateY:t,rotateZ:r}),a=Kekule.MatrixUtils.multiply(n,o);return this.setRotate3DMatrix(a,i),this},rotate3DByAxis:function(e,t,r){var i=this.getCurr3DRotationInfo().rotateMatrix||Kekule.MatrixUtils.createIdentity(4),o=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:e,rotateAxisVector:t}),n=Kekule.MatrixUtils.multiply(o,i);return this.setRotate3DMatrix(n,r),this},getDefaultToolBarButtons:function(){return Kekule.globalOptions.chemWidget.viewer.toolButtons},isToolbarEmbedded:function(){return!this.getToolbarParentElem()},adjustToolbarPos:function(){var e=this.getToolbar();if(e)if(this.isToolbarEmbedded()){var t=Kekule.Widget.Position,r=Kekule.HtmlElementUtils.getElemPageRect(this.getDrawContextParentElem()),i=Kekule.HtmlElementUtils.getElemPageRect(e),o=this.getToolbarPos(),n=this.getToolbarMarginHorizontal(),a=this.getToolbarMarginVertical(),s="left",l="top",d="right",u="bottom",c=(r.width-i.width)/2,p=(r.height-i.height)/2;if(o===t.AUTO||!o){var h=2*(n>0?n:0)+i.width,g=2*(a>0?a:0)+i.height;h>r.width?(o|=t.LEFT,n=0):o|=t.RIGHT,g>r.height/2?(o|=t.BOTTOM,a=-1):o|=t.BOTTOM}o&t.LEFT?(s="left",d="right",c=n>=0?n:n-i.width):o&t.RIGHT&&(s="right",d="left",c=n>=0?n:n-i.width),o&t.TOP?(l="top",u="bottom",p=a>=0?a:a-i.height):o&t.BOTTOM&&(l="bottom",u="top",p=a>=0?a:a-i.height),e.removeStyleProperty(d),e.removeStyleProperty(u),e.setStyleProperty(s,c+"px"),e.setStyleProperty(l,p+"px")}else e.removeStyleProperty("left"),e.removeStyleProperty("top"),e.removeStyleProperty("width"),e.removeStyleProperty("height")},updateToolbar:function(){this.getEnableToolbar()?(this.createToolbar(),this.adjustToolbarPos()):this.setToolbar(null)},updateMenu:function(){this.createMenu()},updateUiComps:function(){this.updateToolbar(),this.updateMenu()},updateActions:function(){this.getActions()&&this.getActions().updateAll()},clearActions:function(){this.getActions().clear(),this.getActionMap().clear()},getCompActionClass:function(e){return this.getChildActionClass(e,!0)},_getActionOfComp:function(e,t,r){var i=this.getActionMap(),o=i.get(e);if(!o&&t){var n=this.getCompActionClass(e)||r;n&&(o=new n(this),i.set(e,o),this.getActions().add(o))}return o},getChildAction:function(e,t){var r=this._getActionOfComp(e,!0);return r||(r=this.tryApplySuper("getChildAction",[e,t])),r},createToolbar:function(){this.clearActions();var e=new Kekule.Widget.ButtonGroup(this);e.addClassName(n.DYN_CREATED),e.setDisplayed(!1),e.setShowText(!1),e.doSetShowGlyph(!0);for(var t=this.getToolButtons()||this.getDefaultToolBarButtons(),r=0,i=t.length;r<i;++r){var o=t[r];this.createToolButton(o,e)}return e.addClassName(a.INNER_TOOLBAR),this.isToolbarEmbedded()&&e.addClassName(a.VIEWER_EMBEDDED_TOOLBAR),e.appendToElem(this.getToolbarParentElem()||this.getElement()),this.setToolbar(e),e},createToolButton:function(e,t){var i=null,o=this.beginContinuousRepainting.bind(this),n=this.endContinuousRepainting.bind(this),a=[r.rotateX,r.rotateY,r.rotateZ,r.rotateLeft,r.rotateRight];if(DataType.isObjectValue(e)){var s=Object.extend({widget:Kekule.Widget.Button},e);if(i=Kekule.Widget.Utils.createFromHash(t,s),(d=s.actionClass)&&"string"==typeof d&&(d=ClassEx.findClass(s.actionClass)),d)(l=this._getActionOfComp(i,!0,d))&&i.setAction(l)}else{if(e===r.molDisplayType)return this.createMolDisplayTypeButton(t);if(e===r.menu)return this.createMenuButton(t);var l,d=this.getCompActionClass(e),u=Kekule.Widget.Button;e===r.molHideHydrogens&&(u=Kekule.Widget.CheckButton),i=new u(t),(l=this._getActionOfComp(e,!0))&&i.setAction(l),a.indexOf(e)>=0&&(i.setPeriodicalExecInterval(20),i.setEnablePeriodicalExec(!0),i.addEventListener("activate",o),i.addEventListener("deactivate",n))}return i},createMenuButton:function(e){var t=new Kekule.Widget.DropDownButton(e);return t.setText(Kekule.$L("WidgetTexts.CAPTION_MENU")).setHint(Kekule.$L("WidgetTexts.HINT_MENU")),t.addClassName(a.VIEWER_MENU_BUTTON),this.getMenu()||this.createMenu(),t.setDropDownWidget(this.getMenu()),t},createMolDisplayTypeButton:function(e){var t=new Kekule.Widget.CompactButtonSet(e);t.getButtonSet().addClassName(a.INNER_TOOLBAR),t.setShowText(!1);var i=this._getActionOfComp(r.molDisplayType,!0);t.setAction(i),this.getActions().add(i);for(var o=this.getDocument(),n=this.getAllowedMolDisplayTypes(),s=this._getUsableMolDisplayActionClasses(n),l=0,d=s.length;l<d;++l){var u=s[l].TYPE,c=new Kekule.Widget.RadioButton(o);i=this._getActionOfComp(r.molDisplayType+u,!0,s[l]);c.setAction(i),t.append(c,u===this.getCurrMoleculeDisplayType())}return t},_getUsableMolDisplayActionClasses:function(e){for(var t=[],r=this.getRenderType()===Kekule.Render.RendererType.R3D?i.Viewer.molDisplayType3DActionClasses:i.Viewer.molDisplayType2DActionClasses,o=0,n=r.length;o<n;++o){var a=r[o].TYPE;e&&e.indexOf(a)<0&&a!==this.getCurrMoleculeDisplayType()||t.push(r[o])}return t},getDefaultMenuItems:function(){return Kekule.globalOptions.chemWidget.viewer.menuItems},prepareMenuItems:function(e){for(var t=[],r=Kekule.Widget.MenuItem.SEPARATOR_TEXT,i=0,o=e.length;i<o;++i){var n=e[i];if("string"==typeof n){if(n!==r){var a=this.createPredefinedMenuItemDefHash(n);a&&t.push(a)}}else{var s=Object.extend({},n);if(n.widget||n.widgetClass||(s.widget=Kekule.Widget.MenuItem),n.children&&n.children.length){var l=this.prepareMenuItems(n.children);s.children=l}t.push(s)}}return t},createPredefinedMenuItemDefHash:function(e){if(e===r.molDisplayType)return this.createMolDisplayMenuDefHash();var t=[r.rotateX,r.rotateY,r.rotateZ,r.rotateLeft,r.rotateRight],i=this.beginContinuousRepainting.bind(this),o=this.endContinuousRepainting.bind(this),n=(this.getCompActionClass(e),Kekule.Widget.MenuItem),a=null,s=this._getActionOfComp(e,!0);return s&&(a={widget:n,action:s},t.indexOf(e)>=0&&(a=Object.extend(a,{periodicalExecInterval:20,enablePeriodicalExec:!0,"#activate":i,"@deactivate":o}))),a},createMolDisplayMenuDefHash:function(){for(var e=this._getActionOfComp(r.molDisplayType,!0),t={widget:Kekule.Widget.MenuItem,action:e},i=[],o=this.getAllowedMolDisplayTypes(),n=this._getUsableMolDisplayActionClasses(o),a=0,s=n.length;a<s;++a){var l=n[a].TYPE;e=this._getActionOfComp(r.molDisplayType+l,!0,n[a]);i.push({widget:Kekule.Widget.MenuItem,action:e})}return i.length&&(t.children=[{widget:Kekule.Widget.PopupMenu,children:i}]),t},createMenu:function(){var e=this.getMenu();e?e.clearMenuItems():((e=new Kekule.Widget.PopupMenu(this)).addClassName(n.DYN_CREATED),e.setDisplayed(!1));var t=this.getMenuItems()||this.getDefaultMenuItems();return t=this.prepareMenuItems(t),e.createChildrenByDefs(t),this.setMenu(e),e},autoDetectCaption:function(){if(this.getAutoCaption()){var e=this.getChemObj();if(e){var t=e&&e.getInfo(),r=e&&e.getSrcInfo();if(t&&r){var i=t.title||t.caption||e.getName()||r.fileName;i&&this.setCaption(i)}}}},reactHotKeys:function(e){if(this.getEnableHotKey()){for(var t=this.getCoordMode()||Kekule.CoordMode.COORD2D,r=this.getViewerConfigs().getHotKeyConfigs().getHotKeys(),i=Kekule.Widget.KeyboardUtils.getKeyParamsFromEvent(e),o=!1,n=r.length-1;n>=0;--n){var a=r[n],s=Kekule.Widget.KeyboardUtils.shortcutLabelToKeyParams(r[n].key,null,!1);if(s.repeat=a.repeat,Kekule.Widget.KeyboardUtils.matchKeyParams(i,s,!1)){var l=a.action;if(l&&(!a.coordMode||a.coordMode===t)){var d=this.getChildAction(l,!0);d&&(o=d.execute(this,e)||o)}}}if(o)return e.stopPropagation(),e.preventDefault(),!0}},react_keydown:function(e){if(!this.tryApplySuper("react_keydown",[e]))return this.reactHotKeys(e)}}),Kekule.ChemWidget.ViewerSubView=Class.create(Kekule.ChemWidget.ChemObjDisplayerSubView,{CLASS_NAME:"Kekule.ChemWidget.ViewerSubView",initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null,getter:function(){return this.getParent()}})},doClearHotTrackedItems:function(e){},doClearSelectedItems:function(e){}});var s=Kekule.X.Event;Kekule.ChemWidget.ViewerBasicInteractionController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.ChemWidget.ViewerBasicInteractionController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._enableMouseRotate=!0,this._transformInfo={isTransforming:!1,lastCoord:null,lastZoom:null},this._restraintCoord=null,this._doInteractiveTransformStepBind=this._doInteractiveTransformStep.bind(this)},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,getter:function(){return this.getWidget()},setter:function(e){this.setWidget(e)}})},getViewerRenderType:function(){return this.getViewer().getRenderType()},getEnableInteraction:function(){var e=this.getViewer();return!!(e&&e.getEnableDirectInteraction()&&e.getChemObjLoaded())},getEnableTouchInteraction:function(){var e=this.getViewer();return!!(e&&e.getEnableDirectInteraction()&&e.getEnableTouchInteraction()&&e.getChemObjLoaded())},getEnableGestureManipulation:function(){var e=this.getViewer();return!!(e&&e.getEnableDirectInteraction()&&e.getEnableTouchInteraction()&&e.getEnableGesture()&&e.getChemObjLoaded())},_initTransform:function(){var e,t=this.getViewer(),r=t.getOffsetWidth(),i=t.getOffsetHeight(),o=this._transformInfo,n=this._restraintCoord;n?(e="x"===n?i:r,o.angleRatio=1/e*Math.PI*2):(e=Math.min(r,i),o.angleRatio=1/e*Math.PI)},zoomViewer:function(e,t){var r=this.getViewer();r&&r.getChemObj()&&(e>0?r.zoomIn&&r.zoomIn(e,t):e<0&&r.zoomOut&&r.zoomOut(-e,t))},isEventFromInteractionArea:function(e){var t=e.getTarget(),r=this.getViewer().getInteractionReceiverElem();return t===r||Kekule.DomUtils.isDescendantOf(t,r)},_beginInteractTransformAtCoord:function(e,t,r,i,o,n){var a=this.getViewer();if(a&&a.getChemObj()){var s=this._transformInfo;s.isTransforming=!0,s.interactingPointerId=n,s.lastCoord={x:e,y:t},s.transformInitCoord={x:e,y:t},this.getViewerRenderType()!==Kekule.Render.RendererType.R3D&&(s.initBaseCoordOffset=a.getBaseCoordOffset()||{}),this._restraintCoord=this._calcRestraintRotateCoord(r,i),this._initTransform(),this._requestInteractiveTransform(e,t)}},_beginGestureInteractTransform:function(e){var t=this.getViewer();if(t&&t.getChemObj()){var r=this._transformInfo;r.isGestureTransforming=!0,r.isTransforming=!1,r.initialGestureZoomLevel=t.getCurrZoom(),this._requestInteractiveTransform()}},_clearInteractionTransformInfo:function(){this._transformInfo.interactingPointerId=null,this._transformInfo.isTransforming=!1,this._transformInfo.lastCoord=null,this._transformInfo.transformInitCoord=null,this._transformInfo.initBaseCoordOffset=null,this._transformInfo.isGestureTransforming=!1,this._transformInfo.initialGestureZoomLevel=null},_endInteractTransform:function(){this._clearInteractionTransformInfo(),this._doInteractiveTransformEnd()},isTransforming:function(){return this._transformInfo.isTransforming},_calcRestraintRotateCoord:function(e,t){var r=this.getViewer(),i=null,o=this._getRestraintRotate3DEdgeSize();if(o>0){var n,a,s,l,d=r.getDrawContextParentElem(!0),u=Kekule.HtmlElementUtils.getElemPageRect(d,!0),c=e-u.left,p=t-u.top,h=u.right-e,g=u.bottom-t;c<=h?(s=1,n=c):(s=-1,n=h),p<=g?(l=1,a=p):(l=-1,a=g);var C=Math.min(n,a);if(C>o)return null;a>C?s<0&&(i="x"):i=l>0?"z":"y"}return i},_interactTransformAtCoord:function(e,t,r){if(r===this._transformInfo.interactingPointerId){var i=this._transformInfo.lastCoord;if(i){var o={x:e,y:t};if(Kekule.CoordUtils.getDistance(i,o)<5)return}this._requestInteractiveTransform(e,t)}},_requestInteractiveTransform:function(e,t){this._transformInfo.interactScreenCoord={x:e,y:t},!this._interactiveTransformStepId&&Kekule.$jsRoot.requestAnimationFrame&&(this._interactiveTransformStepId=Kekule.$jsRoot.requestAnimationFrame(this._doInteractiveTransformStepBind))},_doInteractiveTransformStep:function(){if(this._transformInfo){if(this._transformInfo.isTransforming){var e=this._transformInfo.interactScreenCoord;this.getViewerRenderType()===Kekule.Render.RendererType.R3D?this.rotateByXYDistance(e.x,e.y):this.moveByXYDistance(e.x,e.y)}else this._transformInfo.isGestureTransforming&&this._doGestureInteractTransformStep();this._interactiveTransformStepId=window.requestAnimationFrame(this._doInteractiveTransformStepBind)}},_doGestureInteractTransformStep:function(){var e=this.getViewer();if(e&&e.getChemObj()){var t=this._transformInfo;if(t.isGestureTransforming&&t.pinchScale){var r=t.pinchScale;if(r){var i=t.initialGestureZoomLevel*r;e.zoomTo(i)}}}},_doInteractiveTransformEnd:function(){this._interactiveTransformStepId&&(Kekule.$jsRoot.cancelAnimationFrame&&Kekule.$jsRoot.cancelAnimationFrame(this._interactiveTransformStepId),this._interactiveTransformStepId=null)},_getRestraintRotate3DEdgeSize:function(){var e=this.getViewer();if(e.getEnableRestraintRotation3D()&&e.getRenderType()===Kekule.Render.RendererType.R3D){var t=e.getDimension();return Math.min(t.width,t.height)*(e.getRestraintRotation3DEdgeRatio()||0)}return 0},tryHotTrackBasicObject:function(e,t){return this.doTryHotTrackBasicObject(e,t)},doTryHotTrackBasicObject:function(e,t){var r=this.getViewer();if(r.getEnableObjectHotTrack()){var i=r.getTopmostBasicObjectAtCoord(e,t);r.setHotTrackedObjects(i||null)}},trySelectBasicObject:function(e,t,r){return this.doTrySelectBasicObject(e,t,r)},doTrySelectBasicObject:function(e,t,r){var i=this.getViewer();if(i.getEnableObjectSelect()){var o=i.getTopmostBasicObjectAtCoord(e,r);t&&this.getViewer().getViewerConfigs().getInteractionConfigs().getEnableBasicObjectMultiSelect()?o&&i.toggleSelectingState(o):i.select(o||null)}},needReactEvent:function(e){return this.getEnableInteraction()&&this.isEventFromInteractionArea(e)},react_dblclick:function(e){this.needReactEvent(e)&&this.getViewer().resetDisplay()},react_mousewheel:function(e){if(this.needReactEvent(e)){var t=e.wheelDeltaY||e.wheelDelta;t&&(t/=120);var r=e.getOffsetCoord();return this.zoomViewer(t,r),e.preventDefault(),!0}},react_pointerdown:function(e){this.needReactEvent(e)&&e.getButton()===s.MouseButton.LEFT&&(e.getPointerType()!==s.PointerType.TOUCH||this.getEnableTouchInteraction())&&(this._pointerLeftButtonDownInitCoord={x:e.getScreenX(),y:e.getScreenY()},this._beginInteractTransformAtCoord(e.getScreenX(),e.getScreenY(),e.getClientX(),e.getClientY(),e,e.pointerId))},react_pointerhold:function(e){this.needReactEvent(e)&&e.getPointerType()===s.PointerType.TOUCH&&(e.getButton(),s.MouseButton.LEFT)},react_pointerleave:function(e){this._transformInfo.isTransforming&&this._endInteractTransform(),this.getViewer().clearHotTrackedItems(null,!0)},react_pointerup:function(e){if(e.getButton()===s.MouseButton.LEFT&&(this._transformInfo.isTransforming&&this._endInteractTransform(),this._pointerLeftButtonDownInitCoord)){var t={x:e.getScreenX(),y:e.getScreenY()};if(Kekule.CoordUtils.getDistance(t,this._pointerLeftButtonDownInitCoord)<3){var r=this._getEventMouseCoord(e),i=e.getShiftKey()||e.getCtrlKey();this.trySelectBasicObject(r,i,this.getViewer().getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation())}this._pointerLeftButtonDownInitCoord=null}},react_pointermove:function(e){if(this.needReactEvent(e)){if(this._transformInfo.isTransforming){this._interactTransformAtCoord(e.getScreenX(),e.getScreenY(),e.pointerId);try{e.preventDefault()}catch(e){}}var t=this._getEventMouseCoord(e);this.tryHotTrackBasicObject(t,this.getViewer().getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation())}},moveByXYDistance:function(e,t){var r=this._transformInfo;if(r&&r.isTransforming&&!r.calculating){var i=this.getViewer();if(i.getRenderType()===Kekule.Render.RendererType.R3D)return;r.calculating=!0;try{var o={x:e,y:t};if(r.lastCoord&&Kekule.CoordUtils.isEqual(o,r.lastCoord));else{var n=Kekule.CoordUtils.substract(o,r.transformInitCoord),a=r.initBaseCoordOffset;a=Kekule.CoordUtils.add(a,n),i.setBaseCoordOffset(a),r.lastCoord=o}}finally{r.calculating=!1}}},rotateByXYDistance:function(e,t){var r=this._transformInfo;if(r&&r.isTransforming&&!r.calculating){var i=this.getViewer();if(i.getRenderType()!==Kekule.Render.RendererType.R3D)return;r.calculating=!0;try{var o={x:e,y:t};if(r.lastCoord&&Kekule.CoordUtils.isEqual(o,r.lastCoord));else{var n,a,s,l=Kekule.CoordUtils.substract(o,r.lastCoord);if(l.y=-l.y,this._restraintCoord){var d=this._restraintCoord;"x"===d?(n=l.y,s={x:1,y:0,z:0}):(n=l.x,s="y"===d?{x:0,y:-1,z:0}:{x:0,y:0,z:1}),a=-n*r.angleRatio}else a=(n=Kekule.CoordUtils.getDistance({x:0,y:0},l))*r.angleRatio,s={x:-l.y,y:l.x,z:0};i.rotate3DByAxis(a,s),r.lastCoord=o,r.calculating=!1}}catch(e){}finally{r.calculating=!1}}},doTestMouseCursor:function(e,t){var r="";return this._transformInfo.isTransforming&&(r="move"),r},react_pinchstart:function(e){this.getEnableGestureManipulation()&&this._beginGestureInteractTransform(e)},react_pinchmove:function(e){if(this.getEnableGestureManipulation()){var t=this._transformInfo;t.isGestureTransforming&&(t.pinchScale=e.scale)}},react_pinchend:function(e){this.getEnableGestureManipulation()&&this._transformInfo.isGestureTransforming&&this._endInteractTransform()},react_pinchcancel:function(e){this.getEnableGestureManipulation()&&this._transformInfo.isGestureTransforming&&this._endGestureInteractTransform()}}),Kekule.ChemWidget.Viewer2D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer2D",initialize:function(e,t){this.tryApplySuper("initialize",[e,t,Kekule.Render.RendererType.R2D])},getAllowRenderTypeChange:function(){return!1}}),Kekule.ChemWidget.Viewer3D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer3D",initialize:function(e,t){this.tryApplySuper("initialize",[e,t,Kekule.Render.RendererType.R3D])},getAllowRenderTypeChange:function(){return!1}});var l=Kekule.ObjPropSettingManager;l.register("Kekule.ChemWidget.Viewer.fullFunc",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,enableEdit:!0,toolButtons:null}),l.register("Kekule.ChemWidget.Viewer.basic",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[r.saveData,r.molDisplayType,r.zoomIn,r.zoomOut],menuItems:[r.saveData,"-",r.molDisplayType,r.zoomIn,r.zoomOut]}),l.register("Kekule.ChemWidget.Viewer.mini",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[r.menu],menuItems:[r.saveData,"-",r.molDisplayType,r.zoomIn,r.zoomOut]}),l.register("Kekule.ChemWidget.Viewer.static",{enableToolbar:!1,enableDirectInteraction:!1,enableTouchInteraction:!1,toolButtons:[],menuItems:[]}),l.register("Kekule.ChemWidget.Viewer.editOnly",{enableToolbar:!0,enableEdit:!0,toolButtons:[r.openEditor],menuItems:[r.openEditor]}),Kekule.ChemWidget.Viewer.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.ChemWidget.Viewer.Settings",initProperties:function(){this.defineDelegatedProps(["enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","enableEdit","modalEdit"])},getViewer:function(){return this.getWidget()}}),Kekule.ChemWidget.ViewerConfigs=Class.create(Kekule.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerConfigs",initProperties:function(){this.addConfigProp("interactionConfigs","Kekule.ChemWidget.ViewerInteractionConfigs"),this.addConfigProp("hotKeyConfigs","Kekule.ChemWidget.ViewerHotKeyConfigs"),this.addConfigProp("uiMarkerConfigs","Kekule.ChemWidget.ViewerUiMarkerConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("interactionConfigs",new Kekule.ChemWidget.ViewerInteractionConfigs),this.setPropStoreFieldValue("hotKeyConfigs",new Kekule.ChemWidget.ViewerHotKeyConfigs),this.setPropStoreFieldValue("uiMarkerConfigs",new Kekule.ChemWidget.ViewerUiMarkerConfigs)}}),Kekule.ChemWidget.ViewerInteractionConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerInteractionConfigs",initProperties:function(){this.addBoolConfigProp("enableBasicObjectHotTrack",!1),this.addHashConfigProp("enableBasicObjectSelect",!1),this.addHashConfigProp("enableBasicObjectMultiSelect",!1),this.addBoolConfigProp("enableTrackOnNearest",!0),this.addIntConfigProp("objBoundTrackInflation",5)}}),Kekule.ChemWidget.ViewerHotKeyConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerHotKeyConfigs",initProperties:function(){this.defineProp("hotKeys",{dataType:DataType.ARRAY})},initPropValues:function(){var e=Kekule.ChemWidget.ComponentWidgetNames;this.tryApplySuper("initPropValues"),this.setHotKeys([{key:"Ctrl+C",action:e.copy},{key:"+",action:e.zoomIn},{key:"-",action:e.zoomOut},{key:"Space",action:e.reset},{key:"R",action:e.rotateLeft,repeat:null,coordMode:2},{key:"Shift-R",action:e.rotateRight,repeat:null,coordMode:2},{key:"X",action:e.rotateX,repeat:null,coordMode:3},{key:"Shift+X",action:e.rotateX,repeat:null,coordMode:3},{key:"Y",action:e.rotateY,repeat:null,coordMode:3},{key:"Shift+Y",action:e.rotateY,repeat:null,coordMode:3},{key:"Z",action:e.rotateZ,repeat:null,coordMode:3},{key:"Shift+Z",action:e.rotateZ,repeat:null,coordMode:3},{key:"H",action:e.molHideHydrogens,coordMode:3},{key:"1",action:e.molDisplayTypeSkeletal,coordMode:2},{key:"1",action:e.molDisplayTypeCondensed,coordMode:2},{key:"1",action:e.molDisplayTypeWire,coordMode:3},{key:"2",action:e.molDisplayTypeSticks,coordMode:3},{key:"3",action:e.molDisplayTypeBallStick,coordMode:3},{key:"4",action:e.molDisplayTypeSpaceFill,coordMode:3}])}}),Kekule.ChemWidget.ViewerUiMarkerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs",initProperties:function(){this.addHashConfigProp("hotTrackMarkerStyles",void 0),this.addHashConfigProp("selectionMarkerStyles",void 0),this.addHashConfigProp("hotTrackedObjectStyles",void 0),this.addHashConfigProp("selectedObjectStyles",void 0)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setHotTrackMarkerStyles({strokeColor:"#0000FF",opacity:.2}),this.setSelectionMarkerStyles({opacity:.35,strokeColor:"#0000FF",strokeWidth:2})}}),Kekule.ChemWidget.ActionOnViewer=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionOnViewer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},getViewer:function(){var e=this.getDisplayer();return e instanceof Kekule.ChemWidget.Viewer?e:null}}),Kekule.ChemWidget.ActionViewerRotateBase=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this.setDelta(2*Math.PI/180)},initProperties:function(){this.defineProp("delta",{dataType:DataType.FLOAT})},isShiftModified:function(e){return e&&e.getShiftKey()}}),Kekule.ChemWidget.ActionViewerRotateBase2D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase2D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getViewer(),t=e&&e.getRenderType()===Kekule.Render.RendererType.R2D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),Kekule.ChemWidget.ActionViewerRotateBase3D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase3D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getViewer(),t=e&&e.getRenderType()===Kekule.Render.RendererType.R3D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),Kekule.ChemWidget.ActionViewerRotateLeft=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateLeft",HTML_CLASSNAME:a.ACTION_ROTATE_LEFT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATELEFT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATELEFT")])},doExecute:function(e,t){var r=this.getDelta();this.getViewer().rotate2DBy(r)}}),Kekule.ChemWidget.ActionViewerRotateRight=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateRight",HTML_CLASSNAME:a.ACTION_ROTATE_RIGHT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATERIGHT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATERIGHT")])},doExecute:function(e,t){var r=-this.getDelta();this.getViewer().rotate2DBy(r)}}),Kekule.ChemWidget.ActionViewerRotateX=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateX",HTML_CLASSNAME:a.ACTION_ROTATE_X,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEX"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEX")])},doExecute:function(e,t){var r=this.isShiftModified(t),i=-this.getDelta();r&&(i=-i),this.getViewer().rotate3DBy(i,0,0)}}),Kekule.ChemWidget.ActionViewerRotateY=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateY",HTML_CLASSNAME:a.ACTION_ROTATE_Y,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEY"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEY")])},doExecute:function(e,t){var r=this.isShiftModified(t),i=-this.getDelta();r&&(i=-i),this.getViewer().rotate3DBy(0,i,0)}}),Kekule.ChemWidget.ActionViewerRotateZ=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateZ",HTML_CLASSNAME:a.ACTION_ROTATE_Z,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEZ"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEZ")])},doExecute:function(e,t){var r=this.isShiftModified(t),i=-this.getDelta();r&&(i=-i),this.getViewer().rotate3DBy(0,0,i)}}),Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub",initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_MOL_DISPLAY_TYPE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_DISPLAY_TYPE")])},doExecute:function(e){},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(this.getEnabled()&&this._isMolInViewer(e))},_isMolInViewer:function(e){if(e){var t=e.getChemObj();if(t){if(t instanceof Kekule.ChemStructureNode)return!0;var r=Kekule.ChemStructureUtils.getAllStructFragments(t);return!(!r||!r.length)}return!1}return!1}}),Kekule.ChemWidget.ActionViewerEdit=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerEdit",HTML_CLASSNAME:a.ACTION_VIEWER_EDIT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_OPENEDITOR"),Kekule.$L("ChemWidgetTexts.HINT_OPENEDITOR")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getViewer();this.setEnabled(e&&e.getAllowEditing()&&e.getEnabled()),this.setDisplayed(e&&e.getEnableEdit())},doExecute:function(e){this.getViewer().openEditor(e)}}),Kekule.ChemWidget.Viewer.rotate2DActionClasses=[i.ActionViewerRotateLeft,i.ActionViewerRotateRight],Kekule.ChemWidget.Viewer.rotate3DActionClasses=[i.ActionViewerRotateX,i.ActionViewerRotateY,i.ActionViewerRotateZ],Kekule.ChemWidget.Viewer.molDisplayType2DActionClasses=[i.ActionDisplayerChangeMolDisplayTypeSkeletal,i.ActionDisplayerChangeMolDisplayTypeCondensed],Kekule.ChemWidget.Viewer.molDisplayType3DActionClasses=[i.ActionDisplayerChangeMolDisplayTypeWire,i.ActionDisplayerChangeMolDisplayTypeSticks,i.ActionDisplayerChangeMolDisplayTypeBallStick,i.ActionDisplayerChangeMolDisplayTypeSpaceFill],Kekule._registerAfterLoadSysProc(function(){var e=Kekule.ActionManager,t=Kekule.ChemWidget,i=Kekule.ChemWidget.Viewer,o=e.registerNamedActionClass;o(r.loadFile,t.ActionDisplayerLoadFile,i),o(r.loadData,t.ActionDisplayerLoadData,i),o(r.saveData,t.ActionDisplayerSaveFile,i),o(r.clearObjs,t.ActionDisplayerClear,i),o(r.zoomIn,t.ActionDisplayerZoomIn,i),o(r.zoomOut,t.ActionDisplayerZoomOut,i),o(r.rotateLeft,t.ActionViewerRotateLeft,i),o(r.rotateRight,t.ActionViewerRotateRight,i),o(r.rotateX,t.ActionViewerRotateX,i),o(r.rotateY,t.ActionViewerRotateY,i),o(r.rotateZ,t.ActionViewerRotateZ,i),o(r.reset,t.ActionDisplayerReset,i),o(r.molHideHydrogens,t.ActionDisplayerHideHydrogens,i),o(r.molAutoGenerateCoords,t.ActionDisplayerAutoGenerateCoordsForMolecule,i),o(r.molDisplayType,t.ActionViewerChangeMolDisplayTypeStub,i),o(r.copy,t.ActionDisplayerCopy,i),o(r.openEditor,t.ActionViewerEdit,i),o(r.config,Kekule.Widget.ActionOpenConfigWidget,i),o(r.molDisplayTypeCondensed,t.ActionDisplayerChangeMolDisplayTypeCondensed,i),o(r.molDisplayTypeSkeletal,t.ActionDisplayerChangeMolDisplayTypeSkeletal,i),o(r.molDisplayTypeWire,t.ActionDisplayerChangeMolDisplayTypeWire,i),o(r.molDisplayTypeSticks,t.ActionDisplayerChangeMolDisplayTypeSticks,i),o(r.molDisplayTypeBallStick,t.ActionDisplayerChangeMolDisplayTypeBallStick,i),o(r.molDisplayTypeSpaceFill,t.ActionDisplayerChangeMolDisplayTypeSpaceFill,i)})}(),function(){"use strict";Kekule._registerAfterLoadSysProc(function(){if(Kekule.ChemWidget&&Kekule.Spectroscopy){var e=Kekule.ArrayUtils,t=Kekule.ObjUtils,r=Kekule.ZoomUtils;Kekule.globalOptions.add("chemWidget.viewer",{enableSpectrumView:!0,enableLocalSpectrumView:!0}),Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs",initProperties:function(){this.addBoolConfigProp("enableSpectrumView",void 0),this.addBoolConfigProp("enableLocalSpectrumView",void 0),this.addNumConfigProp("spectrumAxisLabelFontSizeMin",15),this.addNumConfigProp("spectrumAxisLabelFontSizeMax",35),this.addNumConfigProp("spectrumAxisLabelFontSizeFixed",18),this.addNumConfigProp("spectrumAxisScaleLabelFontSizeMin",13),this.addNumConfigProp("spectrumAxisScaleLabelFontSizeMax",32),this.addNumConfigProp("spectrumAxisScaleLabelFontSizeFixed",15),this.addHashConfigProp("enableSpectrumDataHotTrackOnMode",void 0),this.addHashConfigProp("enableSpectrumDataSelectOnMode",void 0),this.addHashConfigProp("enableSpectrumDataMultiSelectOnMode",void 0),this.addHashConfigProp("spectrumDataHotTrackUiMarkersOnMode",void 0),this.addHashConfigProp("spectrumDataSelectUiMarkersOnMode",void 0),this.addHashConfigProp("spectrumHotTrackDataPointMarkerDrawStyles",void 0),this.addHashConfigProp("spectrumSelectDataPointMarkerDrawStyles",void 0),this.addHashConfigProp("spectrumHotTrackedDataPointDetailMarkerDrawStyles",void 0),this.addHashConfigProp("spectrumSelectedDataPointDetailMarkerDrawStyles",void 0),this.addIntConfigProp("spectrumDataPointMarkerSize",15),this.addIntConfigProp("spectrumDataPointMarkerWidth",2),this.addIntConfigProp("spectrumDataPointDetailMarkerValuePrecision",8),this.addIntConfigProp("spectrumDataPointDetailMarkerPadding",5),this.addHashConfigProp("spectrumPeakHotTrackStyles",void 0),this.addHashConfigProp("spectrumPeakSelectStyles",void 0),this.addNumConfigProp("spectrumDataPointSelectInflation",1.5),this.defineProp("spectrumZoomPrimaryModifierKeys",{dataType:DataType.ARRAY}),this.defineProp("spectrumZoomSecondaryModifierKeys",{dataType:DataType.ARRAY}),this.defineProp("spectrumZoomBothModifierKeys",{dataType:DataType.ARRAY})},initPropDefValues:function(){this.tryApplySuper("initPropDefValues");var e=Kekule.Spectroscopy.DataMode,t={default:!0};this.setEnableSpectrumDataHotTrackOnMode(t);t={default:!1};this.setEnableSpectrumDataSelectOnMode(t);t={default:!1};this.setEnableSpectrumDataMultiSelectOnMode(t),(t={})[e.CONTINUOUS]=[i.DATA_POINT,i.DATA_DETAIL],t[e.PEAK]=[i.PEAK,i.DATA_DETAIL],this.setSpectrumDataHotTrackUiMarkersOnMode(t),(t={})[e.CONTINUOUS]=[i.DATA_POINT],t[e.PEAK]=[i.PEAK],this.setSpectrumDataSelectUiMarkersOnMode(t),this.setSpectrumHotTrackDataPointMarkerDrawStyles({color:"#c21717",strokeWidth:1,opacity:1}),this.setSpectrumSelectDataPointMarkerDrawStyles({color:"#0077d6",strokeWidth:1,opacity:1}),this.setSpectrumHotTrackedDataPointDetailMarkerDrawStyles({fontFamily:"Arial, Helvetica, sans-serif",fontSize:15,color:"#c21717",strokeWidth:2,opacity:1}),this.setSpectrumSelectedDataPointDetailMarkerDrawStyles({fontFamily:"Arial, Helvetica, sans-serif",fontSize:15,color:"#0077d6",strokeWidth:2,opacity:1}),this.setSpectrumPeakHotTrackStyles({color:"#c21717"}),this.setSpectrumPeakSelectStyles({color:"#0077d6",spectrum_dataStrokeWidthRatio:.05}),this.setSpectrumZoomPrimaryModifierKeys([]),this.setSpectrumZoomSecondaryModifierKeys(["shift"]),this.setSpectrumZoomBothModifierKeys(["alt"])},initPropValues:function(){this.tryApplySuper("initPropValues")},getActualEnableSpectrumView:function(){return Kekule.oneOf(this.getEnableSpectrumView(),Kekule.globalOptions.chemWidget.viewer.enableSpectrumView)},getActualEnableLocalSpectrumView:function(){return Kekule.oneOf(this.getEnableLocalSpectrumView(),Kekule.globalOptions.chemWidget.viewer.enableLocalSpectrumView)},getDataModeSpecifiedConfigValue:function(e,t){var r=this.getPropValue(e);if(DataType.isObjectValue(r)){var i=r[t];return void 0===i&&(i=r.default),i}return r},setDataModeSpecifiedConfigValue:function(e,t,r){var i=this.getPropValue(e);i||(i={},this.setPropValue(e,i)),Kekule.ObjUtils.notUnset(r)?i[r]=t:i.default=t},getDataModeSpecifiedBoolConfigValueOfModeList:function(t,r,i){var o=e.toArray(r),n=this.getDataModeSpecifiedConfigValue(t,o[0]);if(!n&&i)return n;for(var a=0,s=o.length;a<s;++a)if(i){if(!(n=n&&this.getDataModeSpecifiedConfigValue(t,o[a])))return n}else n=n||this.getDataModeSpecifiedConfigValue(t,o[a]);return n}}),ClassEx.extendMethods(Kekule.ChemWidget.ChemObjDisplayerConfigs,{initProperties:function($origin){$origin(),this.addConfigProp("spectrumViewConfigs","Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs")},initPropDefValues:function($origin){$origin(),this.setPropStoreFieldValue("spectrumViewConfigs",new Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs)}}),Kekule.ChemWidget.Viewer.SpectrumSubView=Class.create(Kekule.ChemWidget.ViewerSubView,{CLASS_NAME:"Kekule.ChemWidget.Viewer.SpectrumSubView",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("spectrum",{dataType:"Kekule.Spectroscopy.Spectrum",serializable:!1,getter:function(){return this.getTarget()},setter:function(e){this.setTarget(e)}}),this.defineProp("viewportRanges",{dataType:DataType.HASH,serializable:!1}),this.defineProp("hotTrackedDataItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getHotTrackedDataItemEx();return e&&e.dataItem},setter:function(e){var t=e&&this._findSectionOfDataItem(e,!0),r=t?{section:t,dataValue:e}:null;this.changeHotTrackedDataItem(r,!0)}}),this.defineProp("hotTrackedDataItemEx",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getHotTrackedDataItemsEx();return e&&e[0]},setter:function(e){var t=this._fetchDataItemsEx(e);this.changeHotTrackedDataItems(t,!0)}}),this.defineProp("hotTrackedDataItemsEx",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("hotTrackedDataItemsEx")||[]},setter:function(e){this.changeHotTrackedDataItems(e,!0)}}),this.defineProp("selectedDataItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(e){var t=this.getSelectedDataItemEx();return t&&t.dataItem},setter:function(e){var t=e&&this._findSectionOfDataItem(e,!0),r=t?{section:t,dataValue:e}:null;this.changeSelectedDataItems(r&&[r],!0)}}),this.defineProp("selectedDataItems",{dataType:DataType.ARRAY,serializable:!1,getter:function(e){var t=this.getSelectedDataItemsEx();if(t){for(var r=[],i=0,o=t.length;i<o;++i)r.push(t[i].dataItem);return r}return[]},setter:function(e){var t=this._fetchDataItemsEx(e);this.changeSelectedDataItems(t,!0)}}),this.defineProp("selectedDataItemEx",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getSelectedDataItemsEx();return e&&e[0]},setter:function(e){this.changeSelectedDataItems(e&&[e],!0)}}),this.defineProp("selectedDataItemsEx",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("selectedDataItemsEx")||[]},setter:function(e){this.changeSelectedDataItems(e,!0)}}),this.defineProp("isSpectrumWithReversedAxises",{dataType:DataType.BOOL,serializable:!1,setter:null,getter:function(){var e=this._getSpectrumRenderCache();return!(!e||!e.spectrum_reversedAxises)}})},appliableToTarget:function(e){return e instanceof Kekule.Spectroscopy.Spectrum},_getSpectrumRenderer:function(){var e=this.getSpectrum();if(e){var t=this.getViewer().getDrawContext(),r=this.getViewer().getRootRenderer();return r&&r.getDirectRendererForChildObj&&r.getDirectRendererForChildObj(t,e)}return null},_getSpectrumRenderCache:function(){var e=this._getSpectrumRenderer(),t=this.getViewer().getDrawContext();return e&&e.getRenderCache(t)},getDisplayedDataModes:function(){for(var e=this.getSpectrum(),t=e&&e.getDisplayedDataSections()||[],r=[],i=0,o=t.length;i<o;++i)r.push(t[i].getMode());return r},getClientScreenBox:function(){var e=this.getViewer(),t=this.getSpectrum();if(t){var r=e.getBoundInfoRecorder(),i=r&&r.getBound(e.getDrawContext(),t.getPseudoRenderSubObject("data"));return i.shapeType===Kekule.Render.MetaShapeType.RECT?Kekule.BoxUtils.createBox(i.coords[0],i.coords[1]):null}return null},fetchViewportRanges:function(){var e={},t=Kekule.VarDependency;return e[t.INDEPENDENT]=this.getViewportRange(t.INDEPENDENT),e[t.DEPENDENT]=this.getViewportRange(t.DEPENDENT),e},getViewportRange:function(e){var t=(this.getViewportRanges()||{})[e]||{};return Object.extend({rangeFrom:0,rangeTo:1},t)},setViewportRange:function(e,t,r){var i=this.getViewportRanges();i||(i={},this.setViewportRanges(i));var o=i[e];return o||(o={},i[e]=o),o.rangeFrom=Kekule.oneOf(t,0),o.rangeTo=Kekule.oneOf(r,1),this.applyToRenderOptions(),this},resetViewportRange:function(e){if(Kekule.ObjUtils.isUnset(e))this.setViewportRanges(void 0);else{var t=this.getViewportRange(e);t&&t[e]&&delete t[e]}this.applyToRenderOptions()},getViewportZoomInfo:function(e){e||(e=Kekule.VarDependency.INDEPENDENT);var t=this.getViewportRange(e);return{zoom:1/Math.abs(t.rangeTo-t.rangeFrom),center:(t.rangeTo+t.rangeFrom)/2}},setViewportZoom:function(e,t,r){(e||(e=Kekule.VarDependency.INDEPENDENT),Kekule.ObjUtils.isUnset(r))&&(r=this.getViewportZoomInfo(e).center);var i=1/t/2,o={rangeFrom:r-i,rangeTo:r+i};this.setViewportRange(e,o.rangeFrom,o.rangeTo)},_zoomViewportTo:function(e,t,r,i){var o,n=this.getClientScreenBox(),a=this.getViewportRange(i),s=1/e-(a.rangeTo-a.rangeFrom);o=t?"x"===r?(t.x-n.x1)/(n.x2-n.x1):(n.y2-t.y)/(n.y2-n.y1):.5;var l=a.rangeFrom-s*o,d=a.rangeTo+s*(1-o);return this.setViewportRange(i,l,d),this},zoomViewportByDelta:function(e,t,i){var o=this.getViewer();o.beginUpdate();try{for(var n=0,a=i.length;n<a;++n){var s=i[n],l="x"===s;this.getIsSpectrumWithReversedAxises()&&(l=!l);var d,u=l?Kekule.VarDependency.INDEPENDENT:Kekule.VarDependency.DEPENDENT,c=this.getViewportZoomInfo(u).zoom;e>0?d=r.getNextZoomInRatio(c,e):e<0&&(d=r.getNextZoomOutRatio(c,-e)),this._zoomViewportTo(d,t,s,u)}}finally{o.endUpdate()}},_applyViewportRanges:function(){this.getViewer();for(var e=[Kekule.VarDependency.INDEPENDENT,Kekule.VarDependency.DEPENDENT],t=["independent","dependent"],r=this.getTarget(),i=0,o=t.length;i<o;++i){var n=this.getViewportRange(e[i]),a="spectrum_viewport"+t[i].upperFirst()+"DataRangeFrom",s="spectrum_viewport"+t[i].upperFirst()+"DataRangeTo",l={};l[a]=n.rangeFrom,l[s]=n.rangeTo,r.addOverrideRenderOptionItem(l)}},applyToRenderOptions:function(){this._applyViewportRanges(),this.doRepaintSpectrum()},doRepaintSpectrum:function(){var e=this.getViewer(),t=e.getRootRenderer();t&&(t.update(e.getDrawContext(),[{obj:this.getTarget()}]),this.updateSpectrumDataItemUiMarkers())},_getHotTrackedDataItemRenderStyles:function(){var e=this.getViewer();return e&&e.getDisplayerConfigs().getSpectrumViewConfigs().getSpectrumPeakHotTrackStyles()},_getSelectedDataItemRenderStyles:function(){var e=this.getViewer();return e&&e.getDisplayerConfigs().getSpectrumViewConfigs().getSpectrumPeakSelectStyles()},_findSectionOfDataItem:function(e,t){for(var r=this.getSpectrum(),i=t?r.getDisplayedDataSections():r.getDataSections(),o=0,n=i.length;o<n;++o){var a=i[o];if(a.indexOfDataItem(e)>=0)return a}return null},_fetchDataItemsEx:function(t){for(var r=t?e.toArray(t):[],i=[],o=0,n=r.length;o<n;++o){var a,s=r[o];if(DataType.isObjectValue(s)&&s.section&&s.dataValue)a=s;else{var l=s&&this._findSectionOfDataItem(s,!0);a=l?{section:l,dataValue:s}:null}a&&i.push(a)}return i},_indexOfDataItemEx:function(e,r){var i=r.indexOf(e);if(i<=0)for(var o=0,n=r.length;o<n;++o){var a=r[o];if(e.section&&a.section===e.section)if(e.section.isPeakSection()){var s=a.section._getDataValueSrc(a.dataValue);if(s&&e.section._getDataValueSrc(e.dataValue)===s){i=o;break}}else if(t.equal(e.dataValue,a.dataValue)){i=o;break}}return i},addToSelection:function(t){for(var r=e.clone(this.getSelectedDataItemsEx()),i=this._fetchDataItemsEx(t),o=0,n=i.length;o<n;++o){var a=i[o];this._indexOfDataItemEx(a,r)>=0||r.push(a)}this.changeSelectedDataItems(r,!0)},removeFromSelection:function(t){for(var r=e.clone(this.getSelectedDataItemsEx()),i=this._fetchDataItemsEx(t),o=0,n=i.length;o<n;++o){var a=i[o],s=this._indexOfDataItemEx(a,r);s>=0&&r.splice(s,1)}this.changeSelectedDataItems(r,!0)},toggleSelectingState:function(t){for(var r=e.clone(this.getSelectedDataItemsEx()),i=this._fetchDataItemsEx(t),o=0,n=i.length;o<n;++o){var a=i[o],s=this._indexOfDataItemEx(a,r);s>=0?r.splice(s,1):r.push(a)}this.changeSelectedDataItems(r,!0)},select:function(e){var t=this._fetchDataItemsEx(e);this.changeSelectedDataItems(t,!0)},doClearHotTrackedItems:function(){this.changeHotTrackedDataItems(null,!1)},doClearSelectedItems:function(){this.changeSelectedDataItems(null,!1)},_hotTrackedDataItemsChanged:function(e,t){this._hotTrackedOrSelectDataItemsChanged(e,t,!1),this.invokeEvent("hotTrackOnSpectrumData",{spectrum:this.getSpectrum(),dataItems:t,prevDataItems:e})},_selectedDataItemsChanged:function(e,t){this._hotTrackedOrSelectDataItemsChanged(e,t,!0),this.invokeEvent("spectrumDataSelectionChange",{spectrum:this.getSpectrum(),dataItems:t,prevDataItems:e})},_hotTrackedOrSelectDataItemsChanged:function(e,t,r){var i=this.getViewer(),o=this.getSpectrum(),n=!1,a=r?"_selectDataItemRenderStyles":"_hotTrackedDataItemRenderStyles";if(t&&t.length&&(r?i.clearSelectedItems([this],!1):i.clearHotTrackedItems([this],!1)),e)for(var s=0,l=e.length;s<l;++s)this._updateHotTrackOrSelectUiMarkerToDataItem(null,r,s),this[a]&&(o.removeDataItemOverrideRenderOptionItem(e[s].dataValue,this[a]),n=!0);if(t)for(s=0,l=t.length;s<l;++s){this._updateHotTrackOrSelectUiMarkerToDataItem(t[s],r,s).needRepaintSpectrum&&(n=!0)}else this._updateHotTrackOrSelectUiMarkerToDataItem(null,r);n&&i.requestRepaint()},_updateHotTrackOrSelectUiMarkerToDataItem:function(e,t,r){var o=this.getViewer(),n=this.getViewer().getDisplayerConfigs().getSpectrumViewConfigs(),a=t?"_selectDataItemRenderStyles":"_hotTrackedDataItemRenderStyles",s=e&&e.dataValue?t?this._getSpectrumDataSelectElements(n,e.section):this._getSpectrumDataHotTrackElements(n,e.section):[],l=s.indexOf(i.DATA_POINT)>=0,d=s.indexOf(i.DATA_DETAIL)>=0,u=t?"selectDataDetail":"hotTrackDataDetail";u+=r||0;var c=t?"selectDataPoint":"hotTrackDataPoint";c+=r||0;var p=o.getSpectrumUiMarker(u,!!d),h=o.getSpectrumUiMarker(c,!!l),g=!1;if(e&&s.length){var C=this.getSpectrum(),_=e.dataValue;if(e.section.isPeakSection()&&s.indexOf(i.PEAK)>=0){var m=t?this._getSelectedDataItemRenderStyles():this._getHotTrackedDataItemRenderStyles();m&&(C.addDataItemOverrideRenderOptionItem(e.dataValue,m),this[a]=m,g=!0)}if(l||d){var f=this.getClientScreenBox(),S=this.calcCoordAtSpectrumData(_,Kekule.Render.CoordSystem.CONTEXT),y=null;d&&(y=this._formatSpectrumDataValueString(_,n.getSpectrumDataPointDetailMarkerValuePrecision()))}var O=t?n.getSpectrumSelectedDataPointDetailMarkerDrawStyles():n.getSpectrumHotTrackedDataPointDetailMarkerDrawStyles(),E=t?n.getSpectrumSelectDataPointMarkerDrawStyles():n.getSpectrumHotTrackDataPointMarkerDrawStyles();this._updateDataDetailMarker(p,S,{text:y},d,O,f,!1),this._updateDataPointMarker(h,S,null,l,E,f,!1)}else p&&o.hideUiMarker(p,!1),h&&o.hideUiMarker(h,!1);return{needRepaintSpectrum:g}},updateSpectrumDataItemUiMarkers:function(e){var t=this.getHotTrackedDataItemsEx();if(t)for(var r=0,i=t.length;r<i;++r){var o=t[r];this._updateHotTrackOrSelectUiMarkerToDataItem(o,!1,r)}else e||this._updateHotTrackOrSelectUiMarkerToDataItem(null,!1,0);var n=this.getSelectedDataItemsEx();if(n)for(r=0,i=n.length;r<i;++r){var a=n[r];this._updateHotTrackOrSelectUiMarkerToDataItem(a,!0,r)}else e||this._updateHotTrackOrSelectUiMarkerToDataItem(null,!0,0)},_isSameHotTrackedOrSelectedItems:function(t,r){var i=t,o=r;return i&&!i.length&&(i=null),o&&!o.length&&(o=null),i==o||!(!i||!o)&&0===e.compare(i,o,function(e,t){return e===t?0:-1})},changeHotTrackedDataItems:function(e,t){var r=this.getHotTrackedDataItemsEx();if(!this._isSameHotTrackedOrSelectedItems(r,e)){var i=this.getViewer();t&&i.beginUpdateUiMarkers();try{this.setPropStoreFieldValue("hotTrackedDataItemsEx",e),this._hotTrackedDataItemsChanged(r,e),t&&i.updateUiMarkers(!0)}finally{t&&i.endUpdateUiMarkers()}}},changeSelectedDataItems:function(e,t){var r=this.getSelectedDataItemsEx();if(!this._isSameHotTrackedOrSelectedItems(r,e)){var i=this.getViewer();t&&i.beginUpdateUiMarkers();try{this.setPropStoreFieldValue("selectedDataItemsEx",e),this._selectedDataItemsChanged(r,e),t&&i.updateUiMarkers(!0)}finally{t&&i.endUpdateUiMarkers()}}},_getSpectrumDataHotTrackElements:function(e,t){var r=e,i=t.getMode();return r.getDataModeSpecifiedConfigValue("enableSpectrumDataHotTrackOnMode",i)?r.getDataModeSpecifiedConfigValue("spectrumDataHotTrackUiMarkersOnMode",i):[]},_getSpectrumDataSelectElements:function(e,t){var r=e,i=t.getMode();return r.getDataModeSpecifiedConfigValue("enableSpectrumDataSelectOnMode",i)?r.getDataModeSpecifiedConfigValue("spectrumDataSelectUiMarkersOnMode",i):[]},_formatSpectrumDataValueString:function(e,t){for(var r=Kekule.ObjUtils.getOwnedFieldNames(e),i=[],o=0,n=r.length;o<n;++o)Kekule.NumUtils.isNormalNumber(e[r[o]])&&i.push(r[o]+": "+e[r[o]].toPrecision(t));return i.join(", ")},_updateDataPointMarker:function(e,t,r,i,o,n,a){if(e){var s=this.getViewer(),l=i&&t;if(l)l=!!Kekule.CoordUtils.isInsideBox(t,n);if(l){var d,u=s.getDisplayerConfigs().getSpectrumViewConfigs(),c=s.getRenderConfigs().getLengthConfigs().getUnitLength()||1,p=(u.getSpectrumDataPointMarkerWidth()||1)*c,h=t;if(u.getSpectrumDataPointMarkerSize()){var g=u.getSpectrumDataPointMarkerSize()/2*c;d=[Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:h.x-g,y:h.y},{x:h.x+g,y:h.y}],{width:p}),Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:h.x,y:h.y-g},{x:h.x,y:h.y+g}],{width:p})]}else n&&(d=[Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:n.x1,y:h.y},{x:n.x2,y:h.y}],{width:p}),Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:h.x,y:n.y1},{x:h.x,y:n.y2}],{width:p})]);var C=Object.create(o);C.strokeWidth*=c,s.modifyShapeBasedMarker(e,d,C,!1),s.showUiMarker(e,a)}else s.hideUiMarker(e,a)}},_updateDataDetailMarker:function(e,t,r,i,o,n,a){if(e){var s=this.getViewer(),l=r.text,d=i&&t&&l;if(d)d=!!Kekule.CoordUtils.isInsideBox(t,n);if(d){var u=s.getDisplayerConfigs().getSpectrumViewConfigs(),c=s.getRenderConfigs().getLengthConfigs().getUnitLength()||1,p=Object.create(o);if(p.fontSize*=c,l){var h,g=s.getDrawBridge(),C=g.canMeasureText&&g.canMeasureText(),_=g.canMeasureDrawnText&&g.canMeasureDrawnText(),m=g.canMeasureText&&g.canModifyText();if(C)h=g.measureText(s.getDrawContext(),l,p);else if(_&&m){var f=this.getViewer().getUiContext(),S=g.drawText(f,{x:0,y:0},l,p);h=g.measureDrawnText(f,S),g.removeDrawnElem(f,S)}var y,O,E=(u.getSpectrumDataPointDetailMarkerPadding()||0)*c,T={x1:t.x-n.x1,x2:n.x2-t.x,y1:t.y-n.y1,y2:n.y2-t.y},A={};T.x2-E>=h.width?(A.x=t.x+E,y=Kekule.Render.BoxXAlignment.LEFT):T.x1-E>=h.width?(A.x=t.x-E,y=Kekule.Render.BoxXAlignment.RIGHT):T.x2>=T.x1?(A.x=n.x2-h.width,y=Kekule.Render.BoxXAlignment.LEFT):(A.x=n.x1+h.width,y=Kekule.Render.BoxXAlignment.RIGHT),T.y1-E>=h.height?(A.y=t.y-E,O=Kekule.Render.BoxYAlignment.BOTTOM):T.y2-E>=h.height?(A.y=t.y+E,O=Kekule.Render.BoxYAlignment.TOP):T.y1>=T.y2?(A.y=n.y1+h.height,O=Kekule.Render.BoxYAlignment.BOTTOM):(A.y=n.y2-h.height,O=Kekule.Render.BoxYAlignment.TOP),p.textBoxXAlignment=y,p.textBoxYAlignment=O}s.modifyTextBasedMarker(e,A,l,p,!1),s.showUiMarker(e,a)}else s.hideUiMarker(e,a)}},resetView:function(){this.changeHotTrackedDataItems(null,!1),this.changeSelectedDataItems(null,!1),this.resetViewportRange()},getSpectrumDataValueInfoFromIndependent:function(e,t,r){for(var i=this.getSpectrum(),o=t||i.getDisplayedDataSections()||[],n=0,a=o.length;n<a;++n){var s=o[n],l=s.getDataValueFromIndependent(e,r);if(Kekule.ObjUtils.notUnset(l))return{value:l,section:s}}return null},calcValueFromIndependent:function(e,t){var r={};return r="number"==typeof e?this._convArrayToSymboledHash([e],this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):DataType.isArrayValue(e)?this._convArrayToSymboledHash(e,this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):e,this.doCalcValueFromIndependent(r,t)},translateCoordToSpectrum:function(e,t){var r=this.getViewer().translateCoord(e,t,Kekule.Render.CoordSystem.CONTEXT),i=this._getSpectrumRenderCache().spectrumInvDataTransformMatrix,o=this.getViewer().getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix;return i?o(r,i):r},translateCoordFromSpectrum:function(e,t){var r=this._getSpectrumRenderCache().spectrumDataTransformMatrix,i=this.getViewer().getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix,o=r?i(e,r):e;return this.getViewer().translateCoord(o,Kekule.Render.CoordSystem.CONTEXT,t)},getSpectrumDataValueItemInfoAtCoord:function(e,t,r){for(var i=this.translateCoordToSpectrum(e,t),o=this.getIsSpectrumWithReversedAxises()?i.y:i.x,n=this.getSpectrum().getDisplayedDataSections()||[],a=0,s=n.length;a<s;++a){var l=n[a],d=l.getDataValueFromIndependent(o,r);if(d)return{dataValue:d,dataSection:l}}return null},calcSpectrumDataAtCoord:function(e,t,r){for(var i=this.translateCoordToSpectrum(e,t),o=this.getIsSpectrumWithReversedAxises()?i.y:i.x,n=this.getSpectrum().getDisplayedDataSections()||[],a=0,s=n.length;a<s;++a){var l=n[a].calcValueFromIndependent(o,r);if(l)return l}return null},calcSpectrumDataRangeInCoordRange:function(e,t,r){for(var i=this.getIsSpectrumWithReversedAxises()?"y":"x",o=Kekule.Spectroscopy.Utils.expandDataRange({},e),n=[this.translateCoordToSpectrum({x:o.x.min,y:o.y.min},t),this.translateCoordToSpectrum({x:o.x.max,y:o.y.max},t)],a=[n[0][i],n[1][i]],s={min:Math.min(a[0],a[1]),max:Math.max(a[0],a[1])},l=this.getSpectrum().getDisplayedDataSections()||[],d=0,u=l.length;d<u;++d){var c=l[d],p=c.calcValueRangeFromIndependentRangeEx([s],r);if(p&&p.range)return p.dataSection=c,p}return null},calcSpectrumPrimaryDataValueInCoordRangeEx:function(e,t,r){var i=Object.create(r||null);i.findNearest=!0,i.findInReversedOrder=!0;var o=this.calcSpectrumDataRangeInCoordRange(e,t,i);if(!o)return null;var n,a=o.dataSection;if(a.isPeakSection()&&o.nearest)n=o.nearest.dataValue;else{var s=a.getLocalVarSymbolsOfDependency(Kekule.VarDependency.DEPENDENT)[0];if(s){for(var l=this.getSpectrum(),d=Kekule.Spectroscopy.Utils.getSpectrumPeakPosition(l),u=o.dataValues,c=u[0],p=u.length-1;p>=0;--p){var h=u[p];(d===Kekule.Spectroscopy.DataPeakPosition.MIN&&h[s]<c[s]||h[s]>c[s])&&(c=h)}n=c}else n=u[Math.round((u.length-1)/2)+1]}return{dataValue:n,dataSection:a}},calcSpectrumPrimaryDataValueInCoordRange:function(e,t,r){return this.calcSpectrumPrimaryDataValueInCoordRangeEx(e,t,r).dataValue},calcCoordAtSpectrumData:function(e,t,r){var i=this.getIsSpectrumWithReversedAxises(),o=(this.getSpectrum().getDisplayedDataSections()||[])[0];if(o){var n=this._spectrumSectionDataValueToSpectrumCoord(e,o,i);return n&&this.translateCoordFromSpectrum(n,t)}return null},calcCoordAtSpectrumDataFromIndependent:function(e,t,r){for(var i=this.getSpectrum().getDisplayedDataSections()||[],o=this.getIsSpectrumWithReversedAxises(),n=0,a=i.length;n<a;++n){var s=i[n],l=s.calcValueFromIndependent(indepValue,r);if(l){var d=this._spectrumSectionDataValueToSpectrumCoord(l,s,o);return d&&this.translateCoordFromSpectrum(d,t)}}return null},_spectrumSectionDataValueToSpectrumCoord:function(e,t,r){var i=t.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT),o=t.getLocalVarSymbolsOfDependency(Kekule.VarDependency.DEPENDENT),n=function(e,t){for(var r=0,i=t.length;r<i;++r){var o=e[t[r]];if(Kekule.ObjUtils.notUnset(o))return o}return null},a=n(e,i),s=n(e,o);return{x:r?s:a,y:r?a:s}}}),Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP="spectrum",ClassEx.extend(Kekule.ChemWidget.Viewer,{createShapeBasedSpectrumUiMarker:function(e,t){return this.createShapeBasedMarker(null,null,{name:e,groups:[t,Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP]},!1)},createTextBasedSpectrumUiMarker:function(e,t){return this.createTextBasedMarker(null,null,null,{name:e,groups:[t,Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP]},!1)},getSpectrumUiMarker:function(e,t){var r=this.getUiMarkers().getMarkerOfName(e);if(!r&&t){var i=e.indexOf("DataDetail")>=0,o=e.indexOf("select")>=0?Kekule.ChemWidget.ViewerUiMarkerGroup.SELECT:e.indexOf("hotTrack")>=0?Kekule.ChemWidget.ViewerUiMarkerGroup.HOTTRACK:null;r=i?this.createTextBasedSpectrumUiMarker(e,o):this.createShapeBasedSpectrumUiMarker(e,o)}return r},getSpectrumUiMarkers:function(){return this.getUiMarkers().getMarkersOfGroup(Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP)},_hideAllSpectrumUiMarkers:function(e){this.setVisibleOfUiMarkerGroup(Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP,!1,e)},updateSpectrumViewDataItemUiMarkers:function(){try{this._hideAllSpectrumUiMarkers(!1),this.iterateSubViews(function(e){e instanceof Kekule.ChemWidget.Viewer.SpectrumSubView&&e.updateSpectrumDataItemUiMarkers(!0)})}finally{}}}),ClassEx.extendMethods(Kekule.ChemWidget.Viewer,{_createSpectrumView:function($origin){return this.fetchSubView(this.getChemObj(),Kekule.ChemWidget.Viewer.SpectrumSubView)},_isDisplayingSingleSpectrum:function($origin){var e=this.getChemObj();return!!(e&&e instanceof Kekule.Spectroscopy.Spectrum)},getSpectrumView:function($origin,e){return this.fetchSubView(e||this.getChemObj(),Kekule.ChemWidget.Viewer.SpectrumSubView)},isInSpectrumMode:function($origin){return!(!Kekule.Spectroscopy||!Kekule.Spectroscopy.Spectrum)&&(this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getDisplayerConfigs().getSpectrumViewConfigs().getActualEnableSpectrumView()&&this._isDisplayingSingleSpectrum())},isLocalSpectrumViewEnabled:function($origin){return!(!Kekule.Spectroscopy||!Kekule.Spectroscopy.Spectrum)&&(this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getDisplayerConfigs().getSpectrumViewConfigs().getActualEnableLocalSpectrumView())},enableSpectrumInteraction:function($origin){return this.isInSpectrumMode()||this.isLocalSpectrumViewEnabled()},getEnableUiContext:function($origin){return!0},allowAutoSize:function($origin){return!this.isInSpectrumMode()&&$origin()},getActualDrawOptions:function($origin){var e=$origin();if(this.isInSpectrumMode()&&this.getSpectrumView()){var t=Object.create(e);return Kekule.ObjUtils.isUnset(e.retainAspect)&&(t.retainAspect=!1),t.autofit=!0,t}return e},doLoad:function($origin,e){if(this.isInSpectrumMode()){var t=this.getSpectrumView();t&&t.resetView()}return $origin(e)},_repaintCore:function($origin,e){var t=this.isInSpectrumMode(),r=this.isLocalSpectrumViewEnabled();if(t||r){var i=Object.create(e||{});if(i._spectrum_render_enable_sub_bounds=!0,t){var o=this.getDisplayerConfigs().getSpectrumViewConfigs();i.spectrum_axisLabelFontSizeMin=o.getSpectrumAxisLabelFontSizeMin(),i.spectrum_axisLabelFontSizeMax=o.getSpectrumAxisLabelFontSizeMax(),i.spectrum_axisLabelFontSizeFixed=o.getSpectrumAxisLabelFontSizeFixed(),i.spectrum_axisScaleLabelFontSizeMin=o.getSpectrumAxisScaleLabelFontSizeMin(),i.spectrum_axisScaleLabelFontSizeMax=o.getSpectrumAxisScaleLabelFontSizeMax(),i.spectrum_axisScaleLabelFontSizeFixed=o.getSpectrumAxisScaleLabelFontSizeFixed()}return $origin(i)}return $origin(e)},doUpdateUiMarkers:function($origin){return this.updateSpectrumViewDataItemUiMarkers(),$origin()},repaintUiMarker:function($origin){return $origin()},getCurrZoom:function($origin){return this.isInSpectrumMode()&&this.getSpectrumView()?this.getSpectrumView().getViewportZoomInfo().zoom:$origin()},zoomTo:function($origin,e,t,r){if(this.isInSpectrumMode()){var i=this.getSpectrumView();if(i){var o=i.getClientScreenBox(),n=i.getViewportRange(Kekule.VarDependency.INDEPENDENT),a=1/e-(n.rangeTo-n.rangeFrom),s=r?(r.x-o.x1)/(o.x2-o.x1):.5,l=n.rangeFrom-a*s,d=n.rangeTo+a*(1-s);i.setViewportRange(Kekule.VarDependency.INDEPENDENT,l,d),t||this.geometryOptionChanged()}else $origin(e,t,r)}else $origin(e,t,r);return this},resetZoom:function($origin,e){if(this.isInSpectrumMode()){var t=this.getSpectrumView();return t?(t.resetViewportRange(),this):$origin(e)}return $origin(e)},resetDisplay:function($origin){if(this.isInSpectrumMode()){var e=this.getSpectrumView();e&&e.resetView()}return $origin()}}),Kekule.ChemWidget.Viewer.SpectrumSubView.UiMarker={DATA_POINT:1,DATA_DETAIL:2,PEAK:4};var i=Kekule.ChemWidget.Viewer.SpectrumSubView.UiMarker;ClassEx.extend(Kekule.ChemWidget.ViewerBasicInteractionController,{getSpectrumUiMarker:function(e,t){return this.getViewer().getSpectrumUiMarker(e,t)},_setSpectrumUiMarkersVisible:function(e,t){var r=this.getViewer(),i=this.getSpectrumUiMarker("hotTrackDataPoint",e),o=this.getSpectrumUiMarker("hotTrackDataDetail",e);e?(i&&r.showUiMarker(i,!1),o&&r.showUiMarker(o,!1)):(i&&r.hideUiMarker(i,!1),o&&r.hideUiMarker(o,!1)),t&&r.repaintUiMarker()},hideSpectrumUiMarkers:function(e){this._setSpectrumUiMarkersVisible(!1,e)},showSpectrumUiMarkers:function(e){this._setSpectrumUiMarkersVisible(!0,e)},_getAncestorSpectrumObj:function(e){if(e instanceof Kekule.Spectroscopy.Spectrum)return e;if(e){var t=e.getParent?e.getParent():e.parent;return t?this._getAncestorSpectrumObj(t):null}return null},_getSpectrumObjAtScreenCoord:function(e,t){var r=this.getViewer().getTopmostBasicObjectAtCoord(e,t||0);return this._getAncestorSpectrumObj(r)},getActiveSpectrumViewAtScreenCoord:function(e){var t,r=this.getViewer();if(r.enableSpectrumInteraction()){var i=r.getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation()||0,o=this._getSpectrumObjAtScreenCoord(e,i);o&&(t=r.getSpectrumView(o))}return t},isTransformingSpectrum:function(){return!!this._transformInfo.currSpectrum}}),ClassEx.extendMethods(Kekule.ChemWidget.ViewerBasicInteractionController,{_beginInteractTransformAtCoord:function($origin,e,t,r,i,o,n){$origin(e,t,r,i,o,n);var a=this.getActiveSpectrumViewAtScreenCoord(this._getEventMouseCoord(o));if(a){var s=a.getSpectrum();this._transformInfo.currSpectrum=s,this._transformInfo.spectrumActuallyTransformed=!1,this._transformInfo.initSpectrumViewportRanges=a.fetchViewportRanges()}else this._transformInfo.currSpectrum=void 0,this._transformInfo.initSpectrumViewportRanges=void 0},_endInteractTransform:function($origin){this._transformInfo.currSpectrum=void 0,this._transformInfo.initSpectrumViewportRanges=void 0,$origin()},moveByXYDistance:function($origin,e,t){var r=this.getViewer();if(!r.enableSpectrumInteraction())return $origin(e,t);var i=this._transformInfo;if(i&&i.isTransforming&&!i.calculating){var o=i.currSpectrum&&r.getSpectrumView(i.currSpectrum);if(!o)return $origin(e,t);i.calculating=!0;try{var n={x:e,y:t};if(Kekule.CoordUtils.isEqual(n,i.lastCoord));else{var a=Kekule.CoordUtils.substract(n,i.transformInitCoord),s=o.getClientScreenBox(),l=[a.x/(s.x2-s.x1),-a.y/(s.y2-s.y1)],d=o.getIsSpectrumWithReversedAxises()?[Kekule.VarDependency.DEPENDENT,Kekule.VarDependency.INDEPENDENT]:[Kekule.VarDependency.INDEPENDENT,Kekule.VarDependency.DEPENDENT];r.beginUpdate();try{for(var u=0,c=l.length;u<c;++u){var p=l[u],h=i.initSpectrumViewportRanges[d[u]]||{},g=h.rangeFrom||0,C=h.rangeTo||1,_=(C-g)*p;o.setViewportRange(d[u],g-_,C-_)}}finally{r.endUpdate()}i.lastCoord=n,i.spectrumActuallyTransformed=!0}}finally{i.calculating=!1}}},doZoomSpectrumViewer:function($origin,e,t,r,i){var o=this.getViewer();if(o.enableSpectrumInteraction()){var n=o.getSpectrumView(e);n&&n.zoomViewportByDelta(t,r,i)}},_mayNeedSpectrumDataHotTrack:function($origin,e,t){var r=e.getDisplayedDataModes();return t&&t.getDataModeSpecifiedBoolConfigValueOfModeList("enableSpectrumDataHotTrackOnMode",r)},_getSpectrumDataSelectCoordInflationRange:function($origin,e,t){var r=t.getSpectrumDataPointSelectInflation(),i={x:r,y:r};return[Kekule.CoordUtils.substract(e,i),Kekule.CoordUtils.add(e,i)]},doTrySelectSpectrumData:function($origin,e,t,r,i,o){var n=i;if(n){var a=null,s=o,l=n.getClientScreenBox();if(Kekule.CoordUtils.isInsideBox(e,l)){var d=this._getSpectrumDataSelectCoordInflationRange(e,s),u=n.calcSpectrumPrimaryDataValueInCoordRangeEx(d,Kekule.Render.CoordSystem.SCREEN);if(u)a={section:u.dataSection,dataValue:u.dataValue}}t&&s.getDataModeSpecifiedBoolConfigValueOfModeList("enableSpectrumDataMultiSelectOnMode",n.getDisplayedDataModes())?n.toggleSelectingState(a):n.select(a),r.requestRepaint()}},doTryHotTrackSpectrumData:function($origin,e,t,r,i){var o=r,n=i,a=null,s=o.getClientScreenBox();if(Kekule.CoordUtils.isInsideBox(e,s)){var l=this._getSpectrumDataSelectCoordInflationRange(e,n),d=o.calcSpectrumPrimaryDataValueInCoordRangeEx(l,Kekule.Render.CoordSystem.SCREEN);if(d)a={section:d.dataSection,dataValue:d.dataValue}}o.setHotTrackedDataItemsEx(a&&[a])},doTryHotTrackBasicObject:function($origin,e,t){var r=this.getViewer(),i=r.getDisplayerConfigs().getSpectrumViewConfigs(),o=this.getActiveSpectrumViewAtScreenCoord(e);return o&&r.getRenderType()===Kekule.Render.RendererType.R2D&&this._mayNeedSpectrumDataHotTrack(o,i)?this.doTryHotTrackSpectrumData(e,r,o,i):$origin(e,t)},doTrySelectBasicObject:function($origin,e,t,r){var i=this.getViewer(),o=i.getDisplayerConfigs().getSpectrumViewConfigs(),n=this.getActiveSpectrumViewAtScreenCoord(e);return n&&i.getRenderType()===Kekule.Render.RendererType.R2D&&o.getDataModeSpecifiedBoolConfigValueOfModeList("enableSpectrumDataSelectOnMode",n.getDisplayedDataModes())?this.doTrySelectSpectrumData(e,t,i,n,o):$origin(e,t,r)},react_dblclick:function($origin,e){if(this.needReactEvent(e)){var t=this.getActiveSpectrumViewAtScreenCoord(this._getEventMouseCoord(e));if(t){var r=this.getViewer();r.beginUpdate();try{t&&t.resetView()}finally{r.endUpdate()}}else $origin(e)}},react_pointerleave:function($origin,e){return this.hideSpectrumUiMarkers(!0),$origin(e)},react_mousewheel:function($origin,e){if(this.needReactEvent(e)){var t=this.getActiveSpectrumViewAtScreenCoord(this._getEventMouseCoord(e));if(t){var r=this.getViewer(),i=t.getSpectrum();this.hideSpectrumUiMarkers(!0);var o=r.getDisplayerConfigs().getSpectrumViewConfigs(),n=e.wheelDeltaY||e.wheelDelta;n&&(n/=120);var a=this._getEventMouseCoord(e),s=Kekule.ChemWidget.SpectrumViewUtils.getZoomDirectionsFromEvent(e,o);return this.doZoomSpectrumViewer(i,n,a,s),e.preventDefault(),!0}}return $origin(e)}}),ClassEx.extendMethods(Kekule.ChemWidget.ActionDisplayerZoomIn,{doExecute:function($origin,e,t){var r=this.getDisplayer();if(r.isInSpectrumMode&&r.isInSpectrumMode()){var i=Kekule.ChemWidget.SpectrumViewUtils.getZoomDirectionsFromEvent(t,r.getDisplayerConfigs().getSpectrumViewConfigs()),o=r.getSpectrumView();o?o.zoomViewportByDelta(1,null,i):$origin()}else $origin()}}),ClassEx.extendMethods(Kekule.ChemWidget.ActionDisplayerZoomOut,{doExecute:function($origin,e,t){var r=this.getDisplayer();if(r.isInSpectrumMode&&r.isInSpectrumMode()){var i=Kekule.ChemWidget.SpectrumViewUtils.getZoomDirectionsFromEvent(t,r.getDisplayerConfigs().getSpectrumViewConfigs()),o=r.getSpectrumView();o?o.zoomViewportByDelta(-1,null,i):$origin()}else $origin()}}),Kekule.ChemWidget.SpectrumCorrelationConnector=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.SpectrumCorrelationConnector",initialize:function(e,t){this.reactLoadEventOnSpectrumViewerBind=this.reactLoadEventOnSpectrumViewer.bind(this),this.reactEventOnSpectrumViewerBind=this.reactEventOnSpectrumViewer.bind(this),this.reactEventOnMoleculeViewerBind=this.reactEventOnMoleculeViewer.bind(this),this.tryApplySuper("initialize"),e&&this.setSpectrumViewer(e),t&&this.setMoleculeViewer(t)},initProperties:function(){this.defineProp("spectrumViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:function(e){var t=this.getSpectrumViewer();t!==e&&(this.doSpectrumViewerChange(e,t),this.setPropStoreFieldValue("spectrumViewer",e))}}),this.defineProp("moleculeViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:function(e){var t=this.getMoleculeViewer();t!==e&&(this.doMoleculeViewerChange(e,t),this.setPropStoreFieldValue("moleculeViewer",e))}}),this.defineProp("autoLoadCorrelatedMolecule",{dataType:DataType.BOOL}),this.defineProp("fromSpectrumToMolecule",{dataType:DataType.BOOL}),this.defineProp("fromMoleculeToSpectrum",{dataType:DataType.BOOL}),this.defineProp("enabled",{dataType:DataType.BOOL})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoLoadCorrelatedMolecule(!0),this.setFromSpectrumToMolecule(!0),this.setFromMoleculeToSpectrum(!0),this.setEnabled(!0)},doFinalize:function(){this.setMoleculeViewer(null),this.setSpectrumViewer(null),this.tryApplySuper("doFinalize")},_getLoadedSpectrums:function(e){if(!e){var t=this.getSpectrumViewer();e=t&&t.getChemObj()}return e?e instanceof Kekule.Spectroscopy.Spectrum?[e]:e.filterChildren(function(e){return e&&e instanceof Kekule.Spectroscopy.Spectrum},!0):[]},_getRefMoleculesOfSpectrum:function(e){return e.getRefMolecules()||[]},_getDisplayedSpectrumDataSections:function(){for(var e=[],t=this._getLoadedSpectrums(),r=0,i=t.length;r<i;++r)if(t[r].getVisible()){var o=t[r].getDisplayedDataSections();e=e.concat(o)}return e},_getSpectrumDataItemAssignments:function(e,t){var r,i;return(i="number"==typeof t?e.getExtraInfoAt(t):e.getExtraInfoOf(t))&&(i.getAssignments||i.assignments)&&(r=i.getAssignments()||i.assignments),r},_getDataItemsExOfCorrelatedMolObject:function(e,t){for(var r=[],i=[],o=0,n=t.length;o<n;++o){var a=t[o],s=a.getParentSpectrum(),l=r.indexOf(s);l<0&&(l=r.length,r.push(s),i[l]={spectrum:s,dataItemsEx:[]});var d=i[l].dataItemsEx;if(a.isPeakSection())for(o=0,n=a.getDataCount();o<n;++o){var u=this._getSpectrumDataItemAssignments(a,o);if(u&&u.length)u.indexOf(e)>=0&&d.push({section:a,dataValue:a.getValueAt(o)})}}return i},doSpectrumViewerChange:function(e,t){t&&(t.removeEventListener("load",this.reactLoadEventOnSpectrumViewerBind),t.removeEventListener("hotTrackOnSpectrumData",this.reactEventOnSpectrumViewerBind),t.removeEventListener("spectrumDataSelectionChange",this.reactEventOnSpectrumViewerBind)),e&&(e.addEventListener("load",this.reactLoadEventOnSpectrumViewerBind),e.addEventListener("hotTrackOnSpectrumData",this.reactEventOnSpectrumViewerBind),e.addEventListener("spectrumDataSelectionChange",this.reactEventOnSpectrumViewerBind),this.doTryLoadSpectrumRefMoleculeInViewer(e.getChemObj()))},doMoleculeViewerChange:function(e,t){t&&(t.removeEventListener("hotTrackOnObjects",this.reactEventOnMoleculeViewerBind),t.removeEventListener("selectionChange",this.reactEventOnMoleculeViewerBind)),e&&(e.addEventListener("hotTrackOnObjects",this.reactEventOnMoleculeViewerBind),e.addEventListener("selectionChange",this.reactEventOnMoleculeViewerBind))},doSelectOrHotTrackSpectrumAssignments:function(t,r,i){for(var o,n=[],a=0,s=t.length;a<s;++a){var l=t[a];if(l instanceof Kekule.ChemStructureObject){var d=l.getRootFragment();if(d){if(o){if(o!==d)continue}else o=d;e.pushUnique(n,l)}}}var u=this.getMoleculeViewer();o&&u.getChemObj()!==o&&i&&this.doLoadMoleculeInViewer(o),r?u.setSelectedObjects(n):u.setHotTrackedObjects(n)},doSelectOrHotTrackSpectrumPeaks:function(t,r){var i=this._getDisplayedSpectrumDataSections(),o=new Kekule.MapEx;try{for(var n=[],a=[],s=0,l=t.length;s<l;++s){var d=this._getDataItemsExOfCorrelatedMolObject(t[s],i);if(d&&d.length)for(var u=0,c=d.length;u<c;++u){var p=d[u].spectrum;(C=o.get(p))||(n.push(p),C=[],o.set(p,C)),e.pushUnique(C,d[u].dataItemsEx),a.push({assignments:[t[s]],spectrum:p,dataSection:C.section,dataValue:C.dataValue})}}var h=!1,g=this.getSpectrumViewer();for(s=0,l=n.length;s<l;++s){var C=o.get(n[s]),_=g.getSubView(n[s],Kekule.ChemWidget.Viewer.SpectrumSubView,!0);if(_){r?_.setSelectedDataItemsEx(C):_.setHotTrackedDataItemsEx(C),h=!0;break}}h||(r?g.clearSelectedItems(null,!0):g.clearHotTrackedItems(null,!0)),this._invokeHotTrackOrSelectAssignmentPairEvent(a,r)}finally{o.finalize()}},_invokeHotTrackOrSelectAssignmentPairEvent:function(e,t){t?this.invokeEvent("assignmentSelected",{assignmentDetails:e}):this.invokeEvent("assignmentHotTracked",{assignmentDetails:e})},doLoadMoleculeInViewer:function(e){e&&e.setVisible(!0),this.getMoleculeViewer().setChemObj(e)},doTryLoadSpectrumRefMoleculeInViewer:function(e){if(this.getSpectrumViewer()&&this.getMoleculeViewer()&&this.getAutoLoadCorrelatedMolecule()){for(var t=this._getLoadedSpectrums(e)||[],r=null,i=0,o=t.length;i<o;++i){var n=this._getRefMoleculesOfSpectrum(t[i]);if(n.length){r=n[0];break}}this.doLoadMoleculeInViewer(r)}},reactLoadEventOnSpectrumViewer:function(e){this.getEnabled()&&this.doTryLoadSpectrumRefMoleculeInViewer(e.obj)},reactEventOnSpectrumViewer:function(t){if(this.getEnabled()&&this.getFromSpectrumToMolecule()&&!this._isReactingSpectrumViewerEvent){this._isReactingSpectrumViewerEvent=!0;try{for(var r=t.name,i=t.dataItems||[],o=[],n=[],a=0,s=i.length;a<s;++a){var l=i[a].section;if(l.isPeakSection()){var d=i[a].dataValue,u=this._getSpectrumDataItemAssignments(l,d);u&&(e.pushUnique(o,u),n.push({spectrum:l.getParentSpectrum(),dataSection:l,dataValue:d,assignments:u}))}}var c="spectrumDataSelectionChange"===r;this.doSelectOrHotTrackSpectrumAssignments(o,c,this.getAutoLoadCorrelatedMolecule()),this._invokeHotTrackOrSelectAssignmentPairEvent(n,c)}finally{this._isReactingSpectrumViewerEvent=!1}}},reactEventOnMoleculeViewer:function(e){if(this.getEnabled()&&this.getFromMoleculeToSpectrum()&&!this._isReactingMoleculeViewerEvent){this._isReactingMoleculeViewerEvent=!0;try{var t=e.name,r=e.objects||[];this.doSelectOrHotTrackSpectrumPeaks(r,"selectionChange"===t)}finally{this._isReactingMoleculeViewerEvent=!1}}}}),Kekule.ChemWidget.SpectrumViewUtils={getZoomDirectionsFromEvent:function(e,t){var r=Kekule.Widget.KeyboardUtils,i=r.getKeyParamsFromEvent(e,!0);return r.matchKeyParams(i,r.createModifierKeyParamsFromArray(t.getSpectrumZoomSecondaryModifierKeys()),!0)?["y"]:r.matchKeyParams(i,r.createModifierKeyParamsFromArray(t.getSpectrumZoomBothModifierKeys()),!0)?["x","y"]:["x"]}}}})}(),function(){"use strict";Kekule._registerAfterLoadSysProc(function(){if(Kekule.ChemWidget&&Kekule.Spectroscopy){Kekule.ObjUtils;var e=Kekule.ArrayUtils,t=Class.PropertyScope;Kekule.ChemWidget.ComponentWidgetNames=Object.extend(Kekule.ChemWidget.ComponentWidgetNames,{changeSpectrumSection:"changeSpectrumSection",correlateSpectrumDataAndObject:"correlateSpectrumDataAndObject"});var r=Kekule.ChemWidget.ComponentWidgetNames;Kekule.globalOptions.add("chemWidget.spectrumInspector",{toolButtons:[r.loadData,r.saveData,r.changeSpectrumSection,r.zoomIn,r.zoomOut,r.reset,r.copy,r.config],assocViewerToolButtons:[r.saveData,r.copy],assocViewerSize:"25%",enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,enableGestureInteraction:!1}),Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{SPECTRUM_INSPECTOR:"K-SpectrumInspector",SPECTRUM_INSPECTOR_ASSOC_LEADING:"K-SpectrumInspector-AssocLeading",SPECTRUM_INSPECTOR_ASSOC_TAILING:"K-SpectrumInspector-AssocTailing",SPECTRUM_INSPECTOR_IN_EDITING:"K-SpectrumInspector-Editing",SPECTRUM_INSPECTOR_CLIENT:"K-SpectrumInspector-Client",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER:"K-SpectrumInspector-ClientComponentHolder",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_SPECTRUM_VIEWER:"K-SpectrumInspector-ClientComponentHolder-SpectrumViewer",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_ASSOC_VIEWER:"K-SpectrumInspector-ClientComponentHolder-AssocViewer",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_MODIFIER_PANEL:"K-SpectrumInspector-ClientComponentHolder-ModifierPanel",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_HIDDEN_CANVAS:"K-SpectrumInspector-ClientComponentHolder-HiddenCanvas",SPECTRUM_INSPECTOR_SPECTRUM_VIEWER:"K-SpectrumInspector-SpectrumViewer",SPECTRUM_INSPECTOR_ASSOC_VIEWER:"K-SpectrumInspector-AssocViewer",SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM:"K-SpectrumInspector-MenuItem-Spectrum",SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM_DATASECTION:"K-SpectrumInspector-MenuItem-SpectrumDataSection",ACTION_SPECTRUM_INSPECTOR_CHANGE_SECTION:"K-SpectrumInspector-Change-Section",ACTION_SPECTRUM_INSPECTOR_CORRELATOR:"K-SpectrumInspector-Correlator"});var i=Kekule.Widget.HtmlClassNames,o=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.SpectrumInspector=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.SpectrumInspector",SPECTRUM_SELECT_MENU_SPECTRUM_FIELD:"__$spectrumIndex$__",SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD:"__$spectrumDataSectionIndex$__",initialize:function(e){this._spectrumViewerSetChemObjOverwriteBind=this._spectrumViewerSetChemObjOverwrite.bind(this),this._spectrumViewerCreateToolButtonOverwriteBind=this._spectrumViewerCreateToolButtonOverwrite.bind(this),this._spectrumViewerGetSavingTargetObjOverwriteBind=this._spectrumViewerGetSavingTargetObjOverwrite.bind(this),this._reactChildViewerShowStateChangeBind=this._reactChildViewerShowStateChange.bind(this),this.setPropStoreFieldValue("autoSyncUiMarkerStyles",!0),this.setPropStoreFieldValue("assocViewerVisualMode",n.AUTO),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("spectrumViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null}),this.defineProp("assocViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null}),this.defineProp("correlationConnector",{dataType:"Kekule.ChemWidget.SpectrumCorrelationConnector",serializable:!1,setter:null}),this.defineProp("autoSyncUiMarkerStyles",{dataType:DataType.BOOL,setter:function(e){e!=this.getAutoSyncUiMarkerStyles()&&(this.setPropStoreFieldValue("autoSyncUiMarkerStyles",!!e),e&&this.syncHotTrackAndSelectStylesBetweenViewers())}}),this.defineProp("assocViewerVisualMode",{dataType:DataType.INT,enumSource:Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode,setter:function(e){var t=this.getAssocViewerVisualMode();e!==t&&(this.setPropStoreFieldValue("assocViewerVisualMode",e),this.doAssocViewerVisualModeChange(e,t))}}),this.defineProp("autoShowHideAssocViewer",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getAssocViewerVisualMode()===n.AUTO},setter:function(e){var t=!!e;if(t!==this.getAutoShowHideAssocViewer())if(t)this.setAssocViewerVisualMode(n.AUTO);else{var r=this.getAssocViewer(),i=r&&r.isShown();this.setAssocViewerVisualMode(i?n.VISIBLE:n.INVISIBLE)}}}),this.defineProp("assocViewerPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(e){this.setPropStoreFieldValue("assocViewerPosition",e),this.doChangeAssocViewerPosition(e)}}),this.defineProp("assocViewerSize",{dataType:DataType.STRING,getter:function(){var e=this.getClientComponentHolderElems(),t=e&&e.assocViewer;return t&&this.getStyleProperty("flexBasis",t)},setter:function(e){var t=this.getClientComponentHolderElems(),r=t&&t.assocViewer;r&&this.setStyleProperty("flexBasis",e,r)}}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",e),this.chemObjChanged(e,t)}}),this.defineProp("spectrums",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){return this.getPropStoreFieldValue("spectrums")||[]}}),this.defineProp("activeSpectrum",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getSpectrums()[this.getActiveSpectrumIndex()]},setter:function(e){var t=this.getSpectrums().indexOf(e);this.setActiveSpectrumIndex(t)}}),this.defineProp("activeSpectrumIndex",{dataType:DataType.INT,serializable:!1,setter:function(e){var t=this.getActiveSpectrum();this.setPropStoreFieldValue("activeSpectrumIndex",e);var r=this.getActiveSpectrum();this.activeSpectrumChanged(r,t)}}),this.defineProp("activeDataSection",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getActiveSpectrum();return e&&e.getActiveDataSection()},setter:function(e){var t=this.getActiveSpectrum();if(t){var r=t.indexOfDataSection(e);r>=0&&this.setActiveDataSectionIndex(r)}}}),this.defineProp("activeDataSectionIndex",{dataType:DataType.INT,serializable:!1,setter:function(e){var t=this.getActiveSpectrum();if(t){var r=this.getActiveDataSection();t.setActiveDataSectionIndex(e);var i=t.getActiveDataSection();r!=i&&this.activeSpectrumDataSectionChanged(i,r)}}}),this.defineProp("spectrumViewportRanges",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getSpectrumSubView();return e&&e.getViewportRanges()},setter:function(e){var t=this.getSpectrumSubView();t&&(t.setViewportRanges(e),t.applyToRenderOptions())}}),this.defineProp("backgroundColor",{dataType:DataType.STRING,scope:t.PUBLISHED,setter:function(e){this.setPropStoreFieldValue("backgroundColor",e);var t=this.getSpectrumViewer();t&&t.setBackgroundColor(e);var r=this.getAssocViewer();r&&r.setBackgroundColor(e)}}),this.defineProp("clientElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("clientComponentHolderElems",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("spectrumDataSectionSelectMenu",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("enableHotTrack",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyEnablePropertyToChildViewerConfigs("enableHotTrack",t),this.setPropStoreFieldValue("enableHotTrack",t)}}),this.defineProp("enableSelect",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyEnablePropertyToChildViewerConfigs("enableSelect",t),this.setPropStoreFieldValue("enableSelect",t)}}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyEnablePropertyToChildViewerConfigs("enableMultiSelect",t),this.setPropStoreFieldValue("enableMultiSelect",t)}}),this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyPropertyToChildViewerProperty("enableDirectInteraction",t),this.setPropStoreFieldValue("enableDirectInteraction",t)}}),this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyPropertyToChildViewerProperty("enableTouchInteraction",t),this.setPropStoreFieldValue("enableTouchInteraction",t)}}),this.defineProp("enableGestureInteraction",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyPropertyToChildViewerProperty("enableGesture",t),this.setPropStoreFieldValue("enableGesture",t)}}),this.defineProp("enableEdit",{dataType:DataType.BOOL,scope:t.PRIVATE}),this.defineProp("isEditing",{dataType:DataType.BOOL,serializable:!1,setter:null,scope:t.PRIVATE}),this._defineSubWidgetDelegatedProperties(["autoLoadCorrelatedMolecule",["enableOperationFromSpectrumToMolecule","fromSpectrumToMolecule"],["enableOperationFromMoleculeToSpectrum","fromMoleculeToSpectrum"]],"correlationConnector"),this._defineSubWidgetDelegatedProperties(["viewerConfigs","enableHotKey","toolButtons","toolbar","enableToolbar","toolbarPos","toolbarMarginVertical","toolbarMarginHorizontal","toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","toolbarParentElem","menuItems","menu","caption","showCaption","captionPos","autoCaption","captionElem","renderConfigs","enableLoadNewFile","allowedInputFormatIds","allowedOutputFormatIds","resetAfterLoad","zoom","initialZoom","padding","chemObjData","chemObjLoaded",["spectrumViewerConfigs","viewerConfigs"],["spectrumViewerRenderConfigs","renderConfigs"],["spectrumViewerDrawOptions","drawOptions"],["spectrumViewerbackgroundColor","backgroundColor"]],"spectrumViewer"),this._defineSubWidgetDelegatedProperties([["assocViewerConfigs","viewerConfigs"],["assocViewerbackgroundColor","backgroundColor"],["assocViewerAllowedMolDisplayTypes","allowedMolDisplayTypes"],["assocViewerRenderConfigs","renderConfigs"],["assocViewerDrawOptions","drawOptions"],["assocViewerAllowCoordBorrow","allowCoordBorrow"],["assocViewerAutoSize","autoSize"],["assocViewerAutofit","autofit"],["assocViewerAutoShrink","autoShrink"]],"assocViewer")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableHotTrack(!0).setEnableSelect(!0).setEnableMultiSelect(!1).setUseCornerDecoration(!0);var e=Kekule.oneOf,t=Kekule.globalOptions.get("chemWidget.spectrumInspector")||{};this.setEnableToolbar(e(t.enableToolbar,!0)).setEnableDirectInteraction(e(t.enableDirectInteraction,!0)).setEnableTouchInteraction(e(t.enableTouchInteraction,!0)).setEnableGestureInteraction(e(t.enableGestureInteraction,!0))},doFinalize:function(){this._finalizeSubWidgets(),this.tryApplySuper("doFinalize")},_finalizeSubWidgets:function(){var e=this.getCorrelationConnector();e&&e.finalize();var t=this.getSpectrumDataSectionSelectMenu();t&&t.finalize();var r=this.getAssocViewer();r&&r.finalize();var i=this.getSpectrumViewer();i&&i.finalize()},_defineSubWidgetDelegatedMethods:function(t,r){r||(r="spectrumViewer");for(var i,o,n=ClassEx.getPrototype(this.getClass()),a=0,s=t.length;a<s;++a){var l=t[a];e.isArray(l)?(i=l[0],o=l[1]):i=l,o||(o=i),n[i]=function(){var e=this.getPropValue(r),t=e[o].apply(e,arguments);return t===e&&(t=this),t}}},_defineSubWidgetDelegatedProperties:function(t,r){r||(r="spectrumViewer");for(var i,o,n=this.getPropInfo(r),a=ClassEx.findClass(n.dataType),s=this,l=0,d=t.length;l<d;++l){var u=t[l];o=null,e.isArray(u)?(i=u[0],o=u[1]):i=u,o||(o=i),function(e,t,i){var o=ClassEx.getPropInfo(e,i),n=Object.create(o);n.getter=null,n.setter=null,n.serializable=!1,o.getter&&(n.getter=function(){var e=this.getPropValue(r);return e?e.getPropValue(i):void 0}),o.setter&&(n.setter=function(e){var t=this.getPropValue(r);t&&t.setPropValue(i,e)}),s.defineProp(t,n)}(a,i,o)}},doObjectChange:function(t){var r=this.tryApplySuper("doObjectChange",[t]),i=this.getAssocViewer();if(i)for(var o=e.intersect(t,["toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","enableToolbar","enableHotKey"]),n=0,a=o.length;n<a;++n)i.setPropValue(o[n],this.getPropValue(o[n]));return r},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r){var i=Kekule.IO.loadTypedData(t.data,t.resType,t.resUri);this.setChemObj(i)}else Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+o.SPECTRUM_INSPECTOR},canUsePlaceHolderOnElem:function(e){var t=e.getAttribute("src");return"img"===e.tagName.toLowerCase()&&!!t},doSetElement:function(e){var t=e;t&&("img"===t.tagName.toLowerCase()&&(t=Kekule.DomUtils.replaceTagName(t,"span")));return this.tryApplySuper("doSetElement",[t])},getChildrenHolderElement:function(){return this.getClientElem()},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);this._finalizeSubWidgets();var i=this._createClientElem(e,t);this.setPropStoreFieldValue("clientElem",i),r.push(i);var n={spectrumViewer:this._createClientComponentHolderElem(e,i,o.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_SPECTRUM_VIEWER),modifierPanel:this._createClientComponentHolderElem(e,i,o.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_MODIFIER_PANEL),assocViewer:this._createClientComponentHolderElem(e,i,o.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_ASSOC_VIEWER),hiddenCanvas:this._createClientComponentHolderElem(e,i,o.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_HIDDEN_CANVAS)};this.setPropStoreFieldValue("clientComponentHolderElems",n),this.setPropStoreFieldValue("spectrumDataSectionSelectMenu",this._createSpectrumDataSectionSelectMenu());var a=this._createSubSpectrumViewer(n.spectrumViewer);this.setPropStoreFieldValue("spectrumViewer",a),a.setToolButtons(this.getDefaultToolBarButtons()).setEnableToolbar(!0);var s=this._createSubAssocViewer(n.assocViewer);this.setPropStoreFieldValue("assocViewer",s);var l=Kekule.globalOptions.get("chemWidget.spectrumInspector")||{};return Kekule.ObjUtils.notUnset(l.assocViewerSize)&&this.setAssocViewerSize(l.assocViewerSize),this._applyAllEnablePropertiesToChildViewerConfigs(),this._createCorrelationConnector(a,s),r},_createClientElem:function(e,t){var r=e.createElement("div");return r.className=o.SPECTRUM_INSPECTOR_CLIENT,t.appendChild(r),r},_createClientComponentHolderElem:function(e,t,r){var i=e.createElement("div"),n=o.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER;return r&&(n+=" "+r),i.className=n,t.appendChild(i),i},_createCorrelationConnector:function(e,t){var r=this,i=new Kekule.ChemWidget.SpectrumCorrelationConnector(e,t);i.addEventListener("assignmentSelected",function(e){r.getSpectrumViewer().updateActions(),r.invokeEvent("spectrumAssignmentSelected",{assignmentDetails:e.assignmentDetails})}),i.addEventListener("assignmentHotTracked",function(e){r.invokeEvent("spectrumAssignmentHotTracked",{assignmentDetails:e.assignmentDetails})}),this.setPropStoreFieldValue("correlationConnector",i)},_createSubSpectrumViewer:function(e){var t=new Kekule.ChemWidget.Viewer2D(this,null,Kekule.Render.RendererType.R2D);this._overwriteSubSpectrumViewerMethods(t),t.setViewerConfigs(new Kekule.ChemWidget.ViewerConfigs),t.setPadding(20),t.setUseCornerDecoration(!1).setBackgroundColor(this.getBackgroundColor()),t.addClassName(o.SPECTRUM_INSPECTOR_SPECTRUM_VIEWER);var r=this;return t.addEventListener("showStateChange",this._reactChildViewerShowStateChangeBind),t.addEventListener("load",function(e){e.widget===r.getSpectrumViewer()&&r.invokeEvent("loadSpectrum",{spectrum:e.obj})}),t.appendToElem(e),t},_overwriteSubSpectrumViewerMethods:function(e){e.overwriteMethod("doSetChemObj",this._spectrumViewerSetChemObjOverwriteBind),e.overwriteMethod("createToolButton",this._spectrumViewerCreateToolButtonOverwriteBind),e.overwriteMethod("getSavingTargetObj",this._spectrumViewerGetSavingTargetObjOverwriteBind),e.overwriteMethod("getDefaultToolBarButtons",this.getDefaultToolBarButtons.bind(this))},_createSubAssocViewer:function(e){var t=new Kekule.ChemWidget.Viewer(this);t.setViewerConfigs(new Kekule.ChemWidget.ViewerConfigs);var r=t.getViewerConfigs().getInteractionConfigs();r.setEnableBasicObjectHotTrack(!0),r.setEnableBasicObjectSelect(!0),r.setEnableBasicObjectMultiSelect(!0),t.addClassName(o.SPECTRUM_INSPECTOR_ASSOC_VIEWER),t.setAutoShrink(!0),t.setToolButtons(Kekule.globalOptions.chemWidget.spectrumInspector.assocViewerToolButtons).setEnableToolbar(!0),t.setUseCornerDecoration(!1).setBackgroundColor(this.getBackgroundColor()),t.setDisplayed(!1),t.addEventListener("load",this._reactAssocViewerLoad.bind(this));var i=this;return t.addEventListener("showStateChange",this._reactChildViewerShowStateChangeBind),t.addEventListener("load",function(e){e.widget===i.getAssocViewer()&&i.invokeEvent("loadAssoc",{obj:e.obj})}),t.appendToElem(e),t},_reactAssocViewerLoad:function(e){var t=this.getAssocViewer();e.widget===t&&this.getAutoShowHideAssocViewer()&&this.doAutoShowHideAssocViewer()},doChangeAssocViewerPosition:function(e){var t=Kekule.Widget.Position;e&t.BOTTOM||e&t.RIGHT?(this.removeClassName(o.SPECTRUM_INSPECTOR_ASSOC_LEADING),this.addClassName(o.SPECTRUM_INSPECTOR_ASSOC_TAILING)):(this.removeClassName(o.SPECTRUM_INSPECTOR_ASSOC_TAILING),this.addClassName(o.SPECTRUM_INSPECTOR_ASSOC_LEADING))},getAssocViewerActualPosition:function(){var e=Kekule.Widget.Layout,t=Kekule.Widget.Position,r=this.getLayout(),i=this.getAssocViewerPosition();return r===e.VERTICAL?i&t.BOTTOM||i&t.RIGHT?t.BOTTOM:t.TOP:i&t.BOTTOM||i&t.RIGHT?t.RIGHT:t.LEFT},doAssocViewerVisualModeChange:function(e,t){var r=this.getAssocViewer();if(r){var i=Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode;if(e===i.AUTO)this.doAutoShowHideAssocViewer();else if(e===i.VISIBLE||e===i.INVISIBLE){var o=e===i.VISIBLE;r.setDisplayed(o),o&&r.setVisible(o)}}},doAutoShowHideAssocViewer:function(){var e=this.getAssocViewer();if(e){var t=!!e.getChemObj();e.setDisplayed(t),t&&e.setVisible(t),Kekule.StyleUtils.setDisplay(this.getClientComponentHolderElems().assocViewer,t)}},_reactChildViewerShowStateChange:function(e){var t,r=e.isShown;e.widget===this.getAssocViewer()?t=this.getClientComponentHolderElems().assocViewer:e.widget===this.getSpectrumViewer()&&(t=this.getClientComponentHolderElems().spectrumViewer),t&&Kekule.StyleUtils.setDisplay(t,!!r)},_createSpectrumDataSectionSelectMenu:function(){var e=new Kekule.Widget.PopupMenu(this);return e.addClassName(i.DYN_CREATED),e.setDisplayed(!1),e.addEventListener("execute",this._reactSpectrumDataSectionSelectMenuItemExecute.bind(this)),e},_reactSpectrumDataSectionSelectMenuItemExecute:function(e){var t=e.widget,r=t[this.SPECTRUM_SELECT_MENU_SPECTRUM_FIELD],i=t[this.SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD],o=this.getSpectrumViewer();o.beginUpdate();try{r!==this.getActiveSpectrum()?(r.setActiveDataSection(i||r.getDataSectionAt(0)),this.setActiveSpectrum(r)):i&&i!==this.getActiveDataSection()&&this.setActiveDataSection(i)}finally{o.endUpdate()}},_refillSpectrumDataSectionSelectMenu:function(){var e=this.getSpectrums(),t=this.getSpectrumDataSectionSelectMenu();t.clearMenuItems();for(var r=0,i=e.length;r<i;++r){var n=e[r],a=n.getDataSectionCount(),s=this._getSpectrumTexts(n,r,i,!0);if(!(a<=0))if(a<=1){(u=this._getSpectrumDataSectionTexts(n,n.getDataSectionAt(0),0,a,!1)).caption&&(s.caption=s.caption+" - "+u.caption),u.hint&&(s.hint=s.hint+" - "+u.hint);var l=this._createSpectrumDataSectionSelectMenuSubItem(t,n,n.getDataSectionAt(0),s.caption,s.hint,o.SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM);t.appendMenuItem(l)}else{l=this._createSpectrumDataSectionSelectMenuSubItem(t,n,null,s.caption,s.hint,o.SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM);t.appendMenuItem(l);for(var d=0;d<a;++d){var u=this._getSpectrumDataSectionTexts(n,n.getDataSectionAt(d),d,a,!0);l=this._createSpectrumDataSectionSelectMenuSubItem(t,n,n.getDataSectionAt(d),u.caption,u.hint,o.SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM_DATASECTION),t.appendMenuItem(l)}}}return this._updateSpectrumDataSectionSelectMenuCheckState(),t},_updateSpectrumDataSectionSelectMenuCheckState:function(){for(var e=this.getActiveSpectrum(),t=e&&e.getActiveDataSection(),r=this.getSpectrumDataSectionSelectMenu().getMenuItems(),i=0,o=r.length;i<o;++i){var n=r[i],a=n[this.SPECTRUM_SELECT_MENU_SPECTRUM_FIELD],s=n[this.SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD];a===e&&s===t?n.setChecked(!0):n.setChecked(!1)}},_createSpectrumDataSectionSelectMenuSubItem:function(e,t,r,i,o,n){var a=new Kekule.Widget.MenuItem(e,i);return a.addClassName(n),a[this.SPECTRUM_SELECT_MENU_SPECTRUM_FIELD]=t,a[this.SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD]=r,a},_getSpectrumTexts:function(e,t,r,i){var o=e.getTitle()||e.getName();return!o&&i&&(o=this._getDefaultSpectrumCaption(e,t,r)),{caption:o,hint:o}},_getDefaultSpectrumCaption:function(e,t,r){return Kekule.$L("ChemWidgetTexts.CAPTION_SPECTRUM_WITH_INDEX").format(t+1)},_getSpectrumDataSectionTexts:function(e,t,r,i,o){var n=t.getTitle()||t.getName();return!n&&o&&(n=this._getDefaultSpectrumDataSectionCaption(e,t,r,i)),{caption:n,hint:n}},_getDefaultSpectrumDataSectionCaption:function(e,t,r,i){return Kekule.$L("ChemWidgetTexts.CAPTION_SPECTRUM_DATASECTION_WITH_INDEX").format(r+1)},_spectrumViewerSetChemObjOverwrite:function($origin,e){this._isLoadingFromSubSpectrumViewer?$origin(e):this.load(e)},_spectrumViewerCreateToolButtonOverwrite:function($origin,e,t){if(this._isCompActionDelegatableToSpectrumViewer(e)){this.getChildActionClass(e);var i=new(e===r.changeSpectrumSection?Kekule.Widget.DropDownButton:Kekule.Widget.Button)(t),o=this._getActionOfComp(e,!0);return o&&i.setAction(o),e===r.changeSpectrumSection&&i.setDropDownWidget(this.getSpectrumDataSectionSelectMenu()),i}return $origin(e,t)},_spectrumViewerGetSavingTargetObjOverwrite:function($origin){return this.getChemObj()},_isCompActionDelegatableToSpectrumViewer:function(e){return[r.changeSpectrumSection,r.correlateSpectrumDataAndObject,r.reset,r.config].indexOf(e)>=0},_getActionOfComp:function(e,t,r){if(this._isCompActionDelegatableToSpectrumViewer(e)){var i=this.getSpectrumViewer(),o=i.getActionMap(),n=o.get(e);if(!n&&t){var a=this.getChildActionClass(e)||r;a&&(n=new a(this),o.set(e,n),i.getActions().add(n))}return n}return null},getDefaultToolBarButtons:function(){return Kekule.globalOptions.chemWidget.spectrumInspector.toolButtons},getSpectrumBaseClass:function(){return Kekule.Spectroscopy.Spectrum},chemObjChanged:function(e,t){var r=this.getSpectrumBaseClass();if(e){var i;i=e instanceof r?[e]:e.filterChildren(function(e){return e&&e instanceof r});var o=this.getSpectrums();this.invokeEvent("load",{obj:e,spectrums:i||[]}),this.spectrumsChanged(i,o)}else{o=this.getSpectrums();this.spectrumsChanged([],o)}},spectrumsChanged:function(e,t){this.setPropStoreFieldValue("spectrums",e),this.setActiveSpectrumIndex(0),this._refillSpectrumDataSectionSelectMenu()},activeSpectrumChanged:function(e,t){this._loadInSpectrumViewer(e),this._updateSpectrumDataSectionSelectMenuCheckState(),this.getAutoSyncUiMarkerStyles()&&this.syncHotTrackAndSelectStylesBetweenViewers()},activeSpectrumDataSectionChanged:function(e,t){e!=t&&(this._repaintSpectrumViewer(),this._updateSpectrumDataSectionSelectMenuCheckState(),this.getAutoSyncUiMarkerStyles()&&this.syncHotTrackAndSelectStylesBetweenViewers())},_loadInSpectrumViewer:function(e){this._isLoadingFromSubSpectrumViewer=!0;try{this.getSpectrumViewer().load(e)}finally{this._isLoadingFromSubSpectrumViewer=!1}},_repaintSpectrumViewer:function(){this.getSpectrumViewer().requestRepaint()},getSpectrumViewerConfigs:function(){var e=this.getSpectrumViewer();return e&&e.getViewerConfigs()},getAssocViewerConfigs:function(){var e=this.getAssocViewer();return e&&e.getViewerConfigs()},_applyPropertyToChildViewerProperty:function(e,t){var r=this.getSpectrumViewer();r&&r.setPropValue(e,t),(r=this.getAssocViewer())&&r.setPropValue(e,t)},_applyEnablePropertyToChildViewerConfigs:function(e,t){var r,i;if("enableHotTrack"===e?(r="enableSpectrumDataHotTrackOnMode",i="enableBasicObjectHotTrack"):"enableSelect"===e?(r="enableSpectrumDataSelectOnMode",i="enableBasicObjectSelect"):"enableMultiSelect"===e&&(r="enableSpectrumDataMultiSelectOnMode",i="enableBasicObjectMultiSelect"),r&&i){var o=this.getSpectrumViewerConfigs(),n=o&&o.getSpectrumViewConfigs(),a=o&&o.getInteractionConfigs(),s=this.getAssocViewerConfigs(),l=s&&s.getInteractionConfigs();if(l&&l.setPropValue(i,t),a&&a.setPropValue(i,t),n){var d=n.getPropValue(r);d?d.default=t:n.setPropValue({default:t})}}},_applyAllEnablePropertiesToChildViewerConfigs:function(){for(var e=["enableSelect","enableMultiSelect","enableHotTrack"],t=0,r=e.length;t<r;++t){var i=e[t],o=this.getPropValue(i);this._applyEnablePropertyToChildViewerConfigs(i,o)}},syncHotTrackAndSelectStylesBetweenViewers:function(){var e=this.getActiveDataSection();if(e){var t,r,i=this.getSpectrumViewer().getViewerConfigs().getSpectrumViewConfigs(),o=this.getAssocViewer().getViewerConfigs().getUiMarkerConfigs(),n=e.getMode(),a=i.getDataModeSpecifiedConfigValue("spectrumDataHotTrackUiMarkersOnMode",n)&&i.getDataModeSpecifiedConfigValue("spectrumHotTrackDataPointMarkerDrawStyles",n),s=i.getDataModeSpecifiedConfigValue("spectrumDataSelectUiMarkersOnMode",n)&&i.getDataModeSpecifiedConfigValue("spectrumSelectDataPointMarkerDrawStyles",n);n===Kekule.Spectroscopy.DataMode.PEAK&&(t=i.getSpectrumPeakHotTrackStyles(),r=i.getSpectrumPeakSelectStyles());var l={opacity:0,color:"transparent"};a?o.setHotTrackMarkerStyles(Object.extend({},a)):o.setHotTrackMarkerStyles(l),s?o.setSelectionMarkerStyles(Object.extend({},s)):o.setSelectionMarkerStyles(l),t?o.setHotTrackedObjectStyles(Object.extend({nodeDisplayMode:Kekule.Render.NodeLabelDisplayMode.SHOWN},t)):o.setHotTrackedObjectStyles({}),r?o.setSelectedObjectStyles(Object.extend({nodeDisplayMode:Kekule.Render.NodeLabelDisplayMode.SHOWN},r)):o.setSelectedObjectStyles({})}},getSpectrumSubView:function(){var e=this.getSpectrumViewer();return e&&e.getSubView(this.getActiveSpectrum(),Kekule.ChemWidget.Viewer.SpectrumSubView,!0)},resetDisplay:function(){var e;(e=this.getSpectrumViewer())&&e.resetDisplay(),(e=this.getAssocViewer())&&e.resetDisplay()},load:function(e){return this.doLoad(e)},doLoad:function(e){this.setChemObj(e)},loadFromData:function(e,t,r,i,o){try{var n;return e?(i?n=Kekule.IO.loadFormatData(e,i):(t||r)&&(n=Kekule.IO.loadTypedData(e,t,r)),n?this.load(n):Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED")),n):(this.setChemObj(null),null)}catch(e){this.reportException(e)}},loadFromFile:function(e){if(e){var t=this;try{Kekule.IO.loadFileData(e,function(e,r){r&&t.load(e)})}catch(e){this.reportException(e)}}else this.setChemObj(null)},getSavingTargetObj:function(){return this.getChemObj()},saveData:function(e,t,r){r=r||this.getSavingTargetObj();this.prepareSaveData(r);var i=Kekule.IO.ChemDataWriterManager.getWriterByFormat(e,null,r);if(i){if(!t)t=Kekule.IO.DataFormatsManager.getFormatInfo(e).dataType;return i.writeData(r,t,e)}return Kekule.error(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")),null},prepareSaveData:function(e){},getSelectedSpectrumDataItemsEx:function(){var e=this.getSpectrumSubView();return e&&e.getSelectedDataItemsEx()},getSelectedSpectrumDataItems:function(){var e=this.getSpectrumSubView();return e&&e.getSelectedDataItems()},getSelectedAssocObjects:function(){return this.getAssocViewer()&&this.getAssocViewer().getSelectedObjects()},doSetSpectrumDataAssignments:function(e,t){if(!(e&&e.length&&t&&t.length))return this;for(var r=0,i=e.length;r<i;++r){var o=e[r].dataValue,n=e[r].section,a=n.getExtraInfoOf(o);a&&a.setAssignments?a.setAssignments(t):((a=Kekule.Spectroscopy.Utils.createDefaultDataExtraInfoObject(n)).setAssignments(t),n.setExtraInfoOf(o,a))}return this},setSpectrumDataAssignmentsBySelectedObjects:function(){var e=this.getSelectedSpectrumDataItemsEx(),t=this.getSelectedAssocObjects();return this.doSetSpectrumDataAssignments(e,t)},exportToDataUriAsync:function(e,t,r){var i=t||{},o=this.getSpectrumViewer(),n=this.getAssocViewer();if(n.isShown())if(o.isShown()){var a=n.exportToDataUri(e,i),s=o.exportToDataUri(e,i),l=this.getAssocViewerActualPosition(),d=this._calcSubViewerOffsetsAndDimensionsForExportDataUri(o,n,l),u=this.getClientComponentHolderElems().hiddenCanvas,c=o.getDrawBridge(),p=c.createContext(u,d.totalDimension.width,d.totalDimension.height),h={},g=function(e,t){if(h[e]=t,!t){_();var r="assocViewer"===e?Kekule.$L("ErrorMsg.FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_ASSOC"):Kekule.$L("ErrorMsg.FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_SPECTRUM");Kekule.warn(r)}h.spectrumViewer&&h.assocViewer&&C()},C=function(){var t=c.exportToDataUri(p,e,i);r&&r(t,d.totalDimension),_()},_=function(){p&&c.releaseContext(p),p=null};c.drawImage(p,s,d.spectrumViewerOffset,{x:d.spectrumViewerDimension.width,y:d.spectrumViewerDimension.height},{},function(e){g("spectrumViewer",e)}),c.drawImage(p,a,d.assocViewerOffset,{x:d.assocViewerDimension.width,y:d.assocViewerDimension.height},{},function(e){g("assocViewer",e)})}else{m=n.isShown()?n.exportToDataUri(e,i):"";r(m,n.getContextDimension())}else{var m=o.isShown()?o.exportToDataUri(e,i):"";r(m,o.getContextDimension())}},_calcSubViewerOffsetsAndDimensionsForExportDataUri:function(e,t,r){var i,o,n,a=t.getContextDimension(),s=e.getContextDimension(),l=Kekule.Widget.Position;return r&l.TOP?(i={x:0,y:0},o={x:0,y:a.height},n={width:Math.max(s.width,a.width),height:s.height+a.height}):r&l.BOTTOM?(i={x:0,y:s.height},o={x:0,y:0},n={width:Math.max(s.width,a.width),height:s.height+a.height}):r&l.RIGHT?(i={x:s.width,y:0},o={x:0,y:0},n={width:s.width+a.width,height:Math.max(s.height,a.height)}):(i={x:0,y:0},o={x:a.width,y:0},n={width:s.width+a.width,height:Math.max(s.height,a.height)}),{spectrumViewerOffset:o,assocViewerOffset:i,spectrumViewerDimension:s,assocViewerDimension:a,totalDimension:n}},repaint:function(e){var t=this.getSpectrumViewer();t&&t.repaint(e),(t=this.getAssocViewer())&&t.repaint(e)},requestRepaint:function(e){var t=this.getSpectrumViewer();t&&t.requestRepaint(e),(t=this.getAssocViewer())&&t.requestRepaint(e)},beginEditing:function(){return this.getEnableEdit()&&this.doBeginEditing(),this},doBeginEditing:function(){this.getCorrelationConnector().setEnabled(!1),this.__enablePropValueStorage__={enableHotTrack:this.getEnableHotTrack(),enableSelect:this.getEnableSelect(),enableMultiSelect:this.getEnableMultiSelect()},this.setEnableHotTrack(!0),this.setEnableSelect(!0),this.setEnableMultiSelect(!0),this.addClassName(o.SPECTRUM_INSPECTOR_IN_EDITING),this.setPropStoreFieldValue("isEditing",!0)},endEditing:function(){this.getIsEditing()&&this.doEndEditing()},doEndEditing:function(){var e=this.__enablePropValueStorage__;e&&(this.setEnableHotTrack(e.enableHotTrack),this.setEnableSelect(e.enableSelect),this.setEnableMultiSelect(e.enableMultiSelect)),this.getCorrelationConnector().setEnabled(!0),this.removeClassName(o.SPECTRUM_INSPECTOR_IN_EDITING),this.setPropStoreFieldValue("isEditing",!1)}}),Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode={VISIBLE:1,INVISIBLE:2,AUTO:0};var n=Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode;Kekule.ChemWidget.SpectrumInspector.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.SpectrumInspector.Settings",initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile","enableHotTrack","enableSelect","enableMultiSelect","enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","autoSyncUiMarkerStyles","assocViewerVisualMode","assocViewerPosition","enableOperationFromSpectrumToMolecule","enableOperationFromMoleculeToSpectrum","assocViewerAutoSize","assocViewerAutofit","assocViewerAutoShrink"])},getSpectrumInspector:function(){return this.getWidget()}}),Kekule.ChemWidget.SpectrumInspector.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.SpectrumInspector.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var e=this.tryApplySuper("getCategoryInfos"),t=this.getSpectrumInspector(),r=["spectrumViewerConfigs","spectrumViewerRenderConfigs","assocViewerConfigs","assocViewerRenderConfigs"],i=0,o=r.length;i<o;++i){var n=t.getPropInfo(r[i]),a=t.getPropValue(r[i]);a&&e.push({obj:a,name:n.name,title:n.title,description:n.description})}return e},getSpectrumInspector:function(){return this.getWidget()}});var a=Kekule.ObjPropSettingManager;a.register("Kekule.ChemWidget.SpectrumInspector.fullFunc",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,enableEdit:!0,toolButtons:null}),a.register("Kekule.ChemWidget.SpectrumInspector.basic",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,toolButtons:[r.saveData,r.changeSpectrumSection,r.zoomIn,r.zoomOut]}),a.register("Kekule.ChemWidget.SpectrumInspector.mini",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[r.changeSpectrumSection]}),a.register("Kekule.ChemWidget.SpectrumInspector.static",{enableToolbar:!1,enableDirectInteraction:!1,enableTouchInteraction:!1,toolButtons:[],menuItems:[]}),Kekule.ChemWidget.ActionOnSpectrumInspector=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnSpectrumInspector",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setTargetWidget(e),this.setText(t),this.setHint(r)},initProperties:function(){this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},getSpectrumInspector:function(e){return e||(e=this.getTargetWidget()),e instanceof Kekule.ChemWidget.SpectrumInspector?e:e&&e.getParent()instanceof Kekule.ChemWidget.SpectrumInspector?e.getParent():void 0},doUpdate:function(){var e=this.getSpectrumInspector();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},execute:function(e,t){return!this.getSpectrumInspector()&&e instanceof Kekule.ChemWidget.SpectrumInspector&&this.setSpectrumInspector(e),this.tryApplySuper("execute",[e,t])}}),Kekule.ChemWidget.ActionSpectrumInspectorReset=Class.create(Kekule.ChemWidget.ActionOnSpectrumInspector,{CLASS_NAME:"Kekule.ChemWidget.ActionSpectrumInspectorReset",HTML_CLASSNAME:o.ACTION_RESET,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_RESETVIEW"),Kekule.$L("ChemWidgetTexts.HINT_RESETVIEW")])},doExecute:function(e){this.tryApplySuper("doExecute",[e]),this.getSpectrumInspector().resetDisplay()}}),Kekule.ChemWidget.ActionSpectrumInspectorChangeSpectrumSectionStub=Class.create(Kekule.ChemWidget.ActionOnSpectrumInspector,{CLASS_NAME:"Kekule.ChemWidget.ActionSpectrumInspectorChangeSpectrumSectionStub",HTML_CLASSNAME:o.ACTION_SPECTRUM_INSPECTOR_CHANGE_SECTION,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_CHANGE_SPECTRUM_SECTION"),Kekule.$L("ChemWidgetTexts.HINT_CHANGE_SPECTRUM_SECTION")])},doExecute:function(e){this.tryApplySuper("doExecute",[e])},doUpdate:function(){this.tryApplySuper("doUpdate")},_hasMultipleDisplayItems:function(e){var t=!1,r=e.getSpectrums();if(r.length>1)t=!0;else{var i=r[0];t=i&&i.getDataSectionCount()>1}return t}}),Kekule.ChemWidget.ActionSpectrumInspectorAssignmentCorrelate=Class.create(Kekule.ChemWidget.ActionOnSpectrumInspector,{CLASS_NAME:"Kekule.ChemWidget.ActionSpectrumInspectorAssignmentCorrelate",HTML_CLASSNAME:o.ACTION_SPECTRUM_INSPECTOR_CORRELATOR,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_SET_SPECTRUM_DATA_ASSIGNMENT"),Kekule.$L("ChemWidgetTexts.HINT_SET_SPECTRUM_DATA_ASSIGNMENT")])},doExecute:function(e){this.tryApplySuper("doExecute",[e]),this.getSpectrumInspector().setSpectrumDataAssignmentsBySelectedObjects()},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getSpectrumInspector(),t=e.getSelectedSpectrumDataItems(),r=e.getSelectedAssocObjects();this.setEnabled(this.getEnabled()&&t&&t.length&&r&&r.length)}}),Kekule._registerAfterLoadSysProc(function(){var e=Kekule.ActionManager,t=Kekule.ChemWidget,i=Kekule.ChemWidget.SpectrumInspector,o=e.registerNamedActionClass;o(r.reset,t.ActionSpectrumInspectorReset,i),o(r.changeSpectrumSection,t.ActionSpectrumInspectorChangeSpectrumSectionStub,i),o(r.correlateSpectrumDataAndObject,t.ActionSpectrumInspectorAssignmentCorrelate,i),o(r.config,Kekule.Widget.ActionOpenConfigWidget,i)})}})}(),function(){"use strict";var e=Class.PropertyScope;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER_GRID:"K-Chem-Viewer-Grid"});Kekule.Widget.HtmlClassNames;var t=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ViewerGrid=Class.create(Kekule.Widget.WidgetGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid",initialize:function(e,t,r){this.setPropStoreFieldValue("renderType",t),this.setPropStoreFieldValue("viewerConfigs",r),this.tryApplySuper("initialize",[e])},initProperties:function(){this._shadowedPropPairs=[],this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,setter:null,scope:e.PUBLIC}),this.defineProp("chemObjs",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){var e=[];return this.each(function(t){e.push(t.getChemObj())}),e}}),this.defineViewerShadowProps(["drawOptions","moleculeDisplayType","zoom","autoSize","enableLoadNewFile","viewerConfigs","allowedMolDisplayTypes","enableEdit","modalEdit","toolButtons","enableToolbar","toolbarPos","toolbarMarginVertical","toolbarMarginHorizontal","toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","caption","showCaption","autoCaption","captionPos","enableDirectInteraction","enableTouchInteraction"]),this.defineViewerShadowProps(["viewerPredefinedSetting"],["predefinedSetting"]),this.defineProp("actionLoadData",{dataType:"Kekule.ChemWidget.ActionDisplayerLoadData",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actionLoadData");return e||(e=new Kekule.ChemWidget.ActionDisplayerLoadData,this.setPropStoreFieldValue("actionLoadData",e)),e}})},defineViewerShadowProps:function(e,t){t||(t=[]);for(var r=0,i=e.length;r<i;++r){var o=e[r],n=t[r]||e[r];this.defineViewerShadowProp(o,n)}},defineViewerShadowProp:function(e,t){t||(t=e);var r=Kekule.ChemWidget.Viewer,i=ClassEx.getPropInfo(r,t);if(i){var o=Object.create(i);o.getter=void 0,o.setter=function(r){this.setPropStoreFieldValue(e,r),this.each(function(e){e.setPropValue(t,r)})},this.defineProp(e,o),this._shadowedPropPairs.push({prop:e,viewerProp:t})}},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.VIEWER_GRID},createWidget:function(){var e=this.getDocument(),t=new Kekule.ChemWidget.LoadDataDialog(e),r=this;t.openModal(function(i){if(t.isPositiveResult(i)){var o=t.getDataDetails();if(a=t.getChemObj()){var n=r.doCreateNewChildWidget(e,null,a),a=n.loadFromData(o.data,o.mimeType,o.fileName,o.formatId);n.setParent(r)}else o.data&&Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}},this.getAddingCell())},doCreateNewChildWidget:function(e,t){var r=new Kekule.ChemWidget.Viewer(e,null,this.getRenderType(),this.getViewerConfigs());return this.doSetShadowedPropValuesToViewer(r),t&&r.setChemObj(t),r},doSetShadowedPropValuesToViewer:function(e){for(var t=0,r=this._shadowedPropPairs.length;t<r;++t){var i=this._shadowedPropPairs[t],o=this.getPropValue(i.prop);void 0!==o&&e.setPropValue(i.viewerProp,o)}},addChemObj:function(e){return this.doCreateNewChildWidget(this.getDocument(),e).setParent(this),this},removeChemObj:function(e){var t=this;return this.each(function(r){r.getChemObj()===e&&t.removeWidget(r,!0)}),this}}),Kekule.ChemWidget.ViewerGrid2D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid2D",initialize:function(e,t){this.tryApplySuper("initialize",[e,Kekule.Render.RendererType.R2D,t])}}),Kekule.ChemWidget.ViewerGrid3D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid3D",initialize:function(e,t){this.tryApplySuper("initialize",[e,Kekule.Render.RendererType.R3D,t])}})}(),function(){"use strict";var e=Class.PropertyScope,t=Kekule.ObjUtils,r=Kekule.DomUtils,i=Kekule.ArrayUtils,o=(Kekule.ChemWidget,Kekule.ChemWidget.ComponentWidgetNames);Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMOBJSETTER:"K-Chem-Obj-Setter",CHEMOBJSETTER_FLEX_LAYOUT:"K-Chem-Obj-Setter-Flex-Layout",CHEMOBJSETTER_TOOLBAR_AREA:"K-Chem-Obj-Setter-Toolbar-Area",CHEMOBJSETTER_CLIENT:"K-Chem-Obj-Setter-Client",CHEMOBJSETTER_VIEWER:"K-Chem-Obj-Setter-Viewer",CHEMOBJSETTER_TABGROUP:"K-Chem-Obj-Setter-TabGroup",CHEMOBJSETTER_INFOLABEL:"K-Chem-Obj-Setter-InfoLabel",CHEMOBJSETTER_STATUSLABEL:"K-Chem-Obj-Setter-StatusLabel",CHEMOBJSETTER_REGION:"K-Chem-Obj-Setter-Region",CHEMOBJSETTER_REGION_LABEL:"K-Chem-Obj-Setter-Region-Label",CHEMOBJSETTER_LINE:"K-Chem-Obj-Setter-Line",CHEMOBJSETTER_CONFIGURATOR:"K-Chem-Obj-Setter-Configurator",SPECTRUMOBJ_INSERTER:"K-SpectrumObjInserter",SPECTRUMOBJ_INSERTER_CONTAINER_ELEM:"K-SpectrumObjInserter-Container",SPECTRUMOBJ_INSERTER_CLIENT:"K-SpectrumObjInserter-Client",SPECTRUMOBJ_INSERTER_TOOLBAR_AREA:"K-SpectrumObjInserter-Toolbar-Area",SPECTRUMOBJ_INSERTER_INFOLABEL:"K-SpectrumObjInserter-InfoLabel",SPECTRUMOBJ_INSERTER_SPECTRUM_INSPECTOR:"K-SpectrumObjInserter-SpectrumInspector",SPECTRUMOBJ_INSERTER_CONFIGURATOR:"K-SpectrumObjInserter-Configurator"});var n=Kekule.Widget.HtmlClassNames,a=Kekule.ChemWidget.HtmlClassNames;Kekule.globalOptions.add("chemWidget.chemObjInserter",{autoSizeExport:!0,backgroundColor3D:"#000000",exportViewerPredefinedSetting:"basic",enable3DStructureAutoGeneration:!1,toolButtons:[o.loadData,o.saveData,o.clearObjs,o.molDisplayType,o.molHideHydrogens,o.molAutoGenerateCoords,o.zoomIn,o.zoomOut,o.rotateX,o.rotateY,o.rotateZ,o.rotateLeft,o.rotateRight,o.reset,o.openEditor,o.config]}),Kekule.ChemWidget.ChemObjInserter=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter",DEF_BGCOLOR_2D:"transparent",DEF_BGCOLOR_3D:"#000000",initialize:function(e,t,r,i){this._configAction=new Kekule.Widget.ActionOpenConfigWidget(this),this._toolbarParentElem=null,this._infoLabel=null,this._infoLabelTemplate=Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH_HEIGHT"),this.tryApplySuper("initialize",[e]);var o=this.getViewer();r&&o.setRenderType(r),i&&o.setViewerConfigs(i),this.adjustChildrenSizes()},doFinalize:function(){this._configAction&&this._configAction.finalize();var e=this.getPropStoreFieldValue("viewer");e&&e.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("viewer");return e||(e=this.createViewer(),this.setPropStoreFieldValue("viewer",e)),e}}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PUBLIC,getter:function(){return this.getPropStoreFieldValue("chemObj")},setter:function(e){this.setPropStoreFieldValue("chemObj",e),this.getViewer()&&this.getViewer().setChemObj(e)}}),this.defineProp("assoc3DChemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PRIVATE,setter:function(e){if(e!==this.getAssoc3DChemObj()&&(this.setPropStoreFieldValue("assoc3DChemObj",e),this.getRenderType()===Kekule.Render.RendererType.R3D)){var t=this._getDisplayedChemObjForRenderType(this.getRenderType());this._changeDisplayedChemObj(t)}}}),this.defineProp("currDisplayedChemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("viewer");return e&&e.getChemObj()}}),this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,scope:e.PUBLIC,setter:function(e){var t=this.getRenderType();if(e!==t){this.setPropStoreFieldValue("renderType",e);var r=this._getDisplayedChemObjForRenderType(t),i=this._getDisplayedChemObjForRenderType(e);this.getViewer().setRenderType(e),r!==i&&this._changeDisplayedChemObj(i);var o=this.getTabs();if(o){var n=e===Kekule.Render.RendererType.R3D?1:0;o.getChildWidgets()[n].setChecked(!0)}}}}),this.defineProp("is3D",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getRenderType()===Kekule.Render.RendererType.R3D},setter:function(e){this.setRenderType(e?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D)}}),this.defineProp("enable3DStructureAutoGeneration",{dataType:DataType.BOOL}),this.defineProp("showInfo",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._infoLabel&&Kekule.StyleUtils.isShown(this._infoLabel)},setter:function(e){this._infoLabel&&Kekule.StyleUtils.setDisplay(this._infoLabel,e)}}),this.defineProp("statusMessage",{dataType:DataType.STRING,serializable:!1,scope:e.PUBLIC,getter:function(){var e=this._statusLabel;return e&&e.innerHTML},setter:function(e){this._updateStatusLabel(e)}}),this.defineProp("autoSizeExport",{dataType:DataType.BOOL}),this.defineProp("backgroundColor2D",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("backgroundColor2D",e),this.backgroundColorChange()}}),this.defineProp("backgroundColor3D",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("backgroundColor3D",e),this.backgroundColorChange()}}),this.defineProp("exportViewerPredefinedSetting",{dataType:DataType.STRING}),this.defineProp("clientPanel",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:e.PRIVATE}),this.defineProp("tabs",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:e.PRIVATE}),this._defineViewerDelegatedProp("chemObjLoaded"),this._defineViewerDelegatedProp("renderConfigs"),this._defineViewerDelegatedProp("drawOptions"),this._defineViewerDelegatedProp("allowCoordBorrow"),this._defineViewerDelegatedProp("autoSize"),this._defineViewerDelegatedProp("autofit"),this._defineViewerDelegatedProp("autoShrink"),this._defineViewerDelegatedProp("viewerConfigs"),this._defineViewerDelegatedProp("allowedMolDisplayTypes"),this._defineViewerDelegatedProp("enableEdit"),this._defineViewerDelegatedProp("enableEditFromVoid"),this._defineViewerDelegatedProp("modalEdit"),this._defineViewerDelegatedProp("restrainEditorWithCurrObj"),this._defineViewerDelegatedProp("editorProperties"),this._defineViewerDelegatedProp("toolButtons"),this._defineViewerDelegatedProp("enableDirectInteraction"),this._defineViewerDelegatedProp("enableTouchInteraction"),this._defineViewerDelegatedProp("enableGesture")},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Object.extend({autoSizeExport:!0,backgroundColor3D:this.DEF_BGCOLOR_3D,exportViewerPredefinedSetting:"basic",enable3DStructureAutoGeneration:!1},Kekule.globalOptions.get("chemWidget.chemObjInserter"),{});this.setAutoSizeExport(e.autoSizeExport),this.setBackgroundColor3D(e.backgroundColor3D),this.setExportViewerPredefinedSetting(e.exportViewerPredefinedSetting)},_defineViewerDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(Kekule.ChemWidget.Viewer,t),i=Object.create(r);return i.getter=null,i.setter=null,r.getter&&(i.getter=function(){return this.getViewer().getPropValue(t)}),r.setter&&(i.setter=function(e){this.getViewer().setPropValue(t,e)}),this.defineProp(e,i)},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r){var i=Kekule.IO.loadTypedData(t.data,t.resType,t.resUri);this.setChemObj(i)}else Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+a.CHEMOBJSETTER;return this._isUsingFlexLayout()&&(e+=" "+a.CHEMOBJSETTER_FLEX_LAYOUT),e},_isUsingFlexLayout:function(){return Kekule.BrowserFeature.cssFlex},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);this.createToolbarParent(t);var i=new Kekule.Widget.Panel(this);return i.addClassName(a.CHEMOBJSETTER_CLIENT),i.setUseCornerDecoration(!1),i.appendToElem(t),this.setPropStoreFieldValue("clientPanel",i),this.createViewer(i.getCoreElement()),this.createInfoLabel(t,this.getViewer()),this.createStatusLabel(t,this.getViewer()),this.createTabs(t),r},elementBound:function(e){this.setObserveElemResize(!0)},doResize:function(){this.adjustChildrenSizes()},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),this.adjustChildrenSizes()},getResizerElement:function(){return this.getClientPanel()?this.getClientPanel().getCoreElement():this.getCoreElement()},getBackgroundColor:function(e){var t=e===Kekule.Render.RendererType.R3D?this.getBackgroundColor3D():this.getBackgroundColor2D();return t===Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT&&(t="transparent"),t},setBackgroundColor:function(e,t){if(t===Kekule.Render.RendererType.R3D){var r=e||this.DEF_BGCOLOR_3D;this.setBackgroundColor3D(r)}else{r=e||this.DEF_BGCOLOR_2D;this.setBackgroundColor2D(r)}},backgroundColorChange:function(){var e=this.getBackgroundColor(this.getRenderType()),t=this.getPropStoreFieldValue("viewer");t&&t.setBackgroundColor(e)},adjustChildrenSizes:function(){if(this._isUsingFlexLayout());else{this.getPageRect();var e=Kekule.HtmlElementUtils.getElemPageRect(this._toolbarParentElem),t=this.getTabs(),r=(t&&t.getPageRect()).top-e.bottom;this.getClientPanel().setHeight(r+"px")}this.getViewer().resized()},createViewer:function(e){var t=Kekule.ChemWidget.ComponentWidgetNames,r=Kekule.Widget.EvokeMode,i=new Kekule.ChemWidget.Viewer(this,null,this.getRenderType());i.addClassName([n.DYN_CREATED,a.CHEMOBJSETTER_VIEWER]),i.setRenderType(Kekule.Render.RendererType.R2D),i.setEnableEdit(!0),i.setEnableEditFromVoid(!0),i.setRestrainEditorWithCurrObj(!1),i.setEnableToolbar(!0),i.setPredefinedSetting("fullFunc");var o=this;i.overwriteMethod("createToolButton",function($origin,e,r){if(e===t.config){var i=new Kekule.Widget.Button(r),n=o._configAction;return n&&i.setAction(n),i}return $origin(e,r)});var s=Kekule.globalOptions.chemWidget.chemObjInserter.toolButtons;return i.setToolbarParentElem(this._toolbarParentElem),i.setToolButtons(s),i.setToolbarPos(Kekule.Widget.Position.BOTTOM),i.setToolbarMarginVertical(-2),i.setToolbarEvokeModes([r.ALWAYS]),i.addEventListener("resize",this.updateInfoLabel,this),i.addEventListener("load",this._reactViewerLoad,this),i.appendToElem(e),i.setChemObj(this.getChemObj()),this.setPropStoreFieldValue("viewer",i),this.backgroundColorChange(),i},_reactViewerLoad:function(e){if(!this._changingDisplayedChemObjFlag||this._changingDisplayedChemObjFlag<=0){var t=e.obj||null;this.setPropStoreFieldValue("chemObj",t),this.setAssoc3DChemObj(null),this.tryAutoGenerate3DCoordsForChemObjInViewer()}},createToolbarParent:function(e){var t=e.ownerDocument.createElement("div");return t.className=a.CHEMOBJSETTER_TOOLBAR_AREA,e.appendChild(t),this._toolbarParentElem=t,t},createTabs:function(e){var t=[Kekule.$L("ChemWidgetTexts.CAPTION_2D"),Kekule.$L("ChemWidgetTexts.CAPTION_3D")],r=this.getRenderType()===Kekule.Render.RendererType.R3D?1:0,i=new Kekule.Widget.TabButtonGroup(this);i.setTabButtonPosition(Kekule.Widget.Position.BOTTOM),i.addClassName([n.DYN_CREATED,a.CHEMOBJSETTER_TABGROUP]);for(var o=[],s=0,l=t.length;s<l;++s){var d=new Kekule.Widget.RadioButton(i);d.setText(t[s]),s===r&&d.setChecked(!0),o.push(d)}return i.addEventListener("switch",function(e){var t=e.button,r=1===o.indexOf(t)?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(r),this.backgroundColorChange(),this.tryAutoGenerate3DCoordsForChemObjInViewer()},this),i.appendToElem(e),this.setPropStoreFieldValue("tabs",i),i},createInfoLabel:function(e,t){var r=this.getDocument().createElement("div");return r.className=n.DYN_CREATED+" "+a.CHEMOBJSETTER_INFOLABEL,t.getElement().appendChild(r),this._infoLabel=r,r},updateInfoLabel:function(){var e=this.getViewer();if(e&&this._infoLabel){var t=e.getContextDimension(),r=t?this._infoLabelTemplate.format(Math.round(t.width),Math.round(t.height)):"";Kekule.DomUtils.setElementText(this._infoLabel,r)}},createStatusLabel:function(e,t){var r=this.getDocument().createElement("div");return r.className=n.DYN_CREATED+" "+a.CHEMOBJSETTER_STATUSLABEL,t.getElement().appendChild(r),this._statusLabel=r,r},_updateStatusLabel:function(e){this._statusLabel&&(this._statusLabel.innerHTML=e)},getContextDimension:function(){return this.getViewer().getContextDimension()},setContextDimension:function(e){var t=this.getContextDimension(),r=e.width-t.width,i=e.height-t.height,o=this.getDimension(),n={width:o.width+r,height:o.height+i};return this.setDimension(n.width,n.height),this},_getDisplayedChemObjForRenderType:function(e){return e===Kekule.Render.RendererType.R3D&&this.getAssoc3DChemObj()||this.getChemObj()},_changeDisplayedChemObj:function(e){this._changingDisplayedChemObjFlag||(this._changingDisplayedChemObjFlag=0),++this._changingDisplayedChemObjFlag;try{this.getViewer().setChemObj(e)}finally{--this._changingDisplayedChemObjFlag}},_getContainingMoleculesWithCtab:function(e){if(e||(e=this.getChemObj()),e instanceof Kekule.StructureFragment)return e.hasCtab()?[e]:[];for(var t=[],r=Kekule.ChemStructureUtils.getAllStructFragments(e),i=0,o=r.length;i<o;++i){var n=r[i];n.hasCtab&&n.hasCtab()&&t.push(n)}return t},_get3DCoordGenerationTargetForChemObj:function(e){e||(e=this.getChemObj());var t=this._getContainingMoleculesWithCtab(e);if(t&&1===t.length){var r=t[0];return r.nodesHasCoord3D(!1)?null:r}return null},_isCoordGeneratorAvailable:function(e){return this.getViewer()._isCoordGeneratorAvailable(e)},doGenerate3DCoordsForChemObjInViewer:function(e){var t=this.getChemObj(),r=this,i=function(t,i){r.setStatusMessage(""),e&&e(t,i)};if(t&&this._isCoordGeneratorAvailable(Kekule.CoordMode.COORD3D)){var o=this._get3DCoordGenerationTargetForChemObj(t);if(o){r.setStatusMessage(Kekule.$L("ChemWidgetTexts.CAPTION_CHEMOBJINSERTER_GENERATING_3D_STRUCTURE"));try{this.getViewer().autoGenerateChemObjCoords(i.bind(this,null),o,Kekule.CoordMode.COORD3D)}catch(e){i(e,t)}return this}}return i(null,t),this},generate3DCoordsForChemObjInViewer:function(e){var t=this;this.doGenerate3DCoordsForChemObjInViewer(function(e,r){!e&&r&&t.setAssoc3DChemObj(r)})},_isMolContainingCoordsOfMode:function(e,t){return e.getNodeCount()<=0||e.nodesHasCoordOfMode(t,!1,!0)},tryAutoGenerate3DCoordsForChemObjInViewer:function(e){if(this.getEnable3DStructureAutoGeneration()&&(this.getRenderType()===Kekule.Render.RendererType.R3D&&!this.getAssoc3DChemObj())){var t=this.getChemObj(),r=this._get3DCoordGenerationTargetForChemObj(t);r&&!this._isMolContainingCoordsOfMode(r,Kekule.CoordMode.COORD3D)&&this.generate3DCoordsForChemObjInViewer(e)}},exportToDataUri:function(e,t){return this.getViewer().exportToDataUri(e,t)},exportDetails:function(e,t){this.getAutoSizeExport()&&this.setAutoSize(!0);var r=this.getViewer().getActualDrawOptions(),i=this.getViewer().getContextDimension(),o=this.getCurrDisplayedChemObj(),n=o?{dataUri:this.exportToDataUri(e,t),drawOptions:r,drawOptionsJson:JSON.stringify(r),chemObj:o,chemObjJson:Kekule.IO.saveMimeData(o,"chemical/x-kekule-json"),autoSize:this.getAutoSizeExport(),autofit:this.getAutofit(),width:Math.round(i.width),height:Math.round(i.height),renderType:this.getRenderType()||Kekule.Render.RendererType.R2D,backgroundColor:this.getBackgroundColor(this.getRenderType()),predefinedSetting:this.getExportViewerPredefinedSetting()}:null;if(this.getAutoSizeExport()){this.setAutoSize(!1);var a=this.getViewer().getElement();a.style.width="auto",a.style.height="auto",this.getViewer().resized()}return n},getImgExportDetailsAsync:function(e,t,r){r(this.exportDetails(e,t))},getExportImgElemAttributes:function(e,t){var r=this.exportDetails(e,t);if(!r)return null;var i="width:"+r.width+"px; height:"+r.height+"px",o={src:r.dataUri,style:i,width:r.width,height:r.height,"data-kekule-widget":"Kekule.ChemWidget.Viewer","data-render-type":r.renderType,"data-chem-obj":r.chemObjJson,"data-draw-options":r.drawOptionsJson,"data-predefined-setting":r.predefinedSetting};return Kekule.ObjUtils.notUnset(r.autoSize)&&(o["data-auto-size"]=r.autoSize),Kekule.ObjUtils.notUnset(r.autofit)&&(o["data-autofit"]=r.autofit),Kekule.ObjUtils.notUnset(r.backgroundColor)&&(o["data-background-color"]=r.backgroundColor),o},getExportImgElemAttributesAsync:function(e,t,r){r(this.getExportImgElemAttributes(e,t))},createExportImgElement:function(e,t,r){var i=this.getExportImgElemAttributes(t,r)||{};if(i){var o=e.createElement("img");return Kekule.DomUtils.setElemAttributes(o,i),o}return null},createExportHtmlElement:function(e,t,r){return this.createExportImgElement(e,t,r)},createExportHtmlElementAsync:function(e,t,r,i){try{var o=this.createExportImgElement(e,t,r);i&&i(o)}catch(e){throw i(null),e}},importChemObjWithDetails:function(e,t){return this.setChemObj(e),this.setRenderType(t.renderType||Kekule.Render.RendererType.R2D),Kekule.ObjUtils.notUnset(t.autoSize)&&this.setAutoSizeExport(!!t.autoSize),Kekule.ObjUtils.notUnset(t.autofit)&&this.setAutofit(!!t.autofit),!t.width||!t.height||t.autoSize&&t.renderType!==Kekule.Render.RendererType.R3D||this.setContextDimension({width:t.width,height:t.height}),t.drawOptions&&this.getViewer().setDrawOptions(t.drawOptions),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,this.getRenderType()),this},importFromDetails:function(e,t){return this.importChemObjWithDetails(e,details)},importFromElemAttribs:function(e){e.width=DataType.JsonUtility.parse(e.width),e.height=DataType.JsonUtility.parse(e.height);var t=e["data-chem-obj"],r=t?Kekule.IO.loadMimeData(t,"chemical/x-kekule-json"):null;return e["data-render-type"]&&(e.renderType=DataType.JsonUtility.parse(e["data-render-type"])),e["data-draw-options"]&&(e.drawOptions=DataType.JsonUtility.parse(e["data-draw-options"])),e["data-auto-size"]&&(e.autoSize=DataType.JsonUtility.parse(e["data-auto-size"])),e["data-autofit"]&&(e.autofit=DataType.JsonUtility.parse(e["data-autofit"])),e["data-background-color"]&&(e.backgroundColor=e["data-background-color"]),this.importChemObjWithDetails(r,e)},importFromElem:function(e){var t=Kekule.HtmlElementUtils.getElemPageRect(e),r=Kekule.DomUtils.fetchAttributeValuesToJson(e);return r.width||(r.width=t.width),r.height||(r.height=t.height),this.importFromElemAttribs(r)}}),Kekule.ChemWidget.ChemObjInserter.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter.Configurator",initialize:function(e){this._checkBoxAutoSize=null,this._checkBoxAutofit=null,this._checkBoxShowInfo=null,this._textBoxWidth=null,this._textBoxHeight=null,this._colorPicker=null,this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",function(e){this.saveConfigValues()},this)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoUpdate(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+a.CHEMOBJSETTER_CONFIGURATOR},doCreateSubElements:function(e,t){var i;(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(s=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOSIZE")),s.addClassName(a.CHEMOBJSETTER_LINE),s.appendToElem(l),this._checkBoxAutoSize=s,(i=e.createElement("span")).className=n.PART_ASSOC_TEXT_CONTENT,r.setElementText(i,Kekule.$L("ChemWidgetTexts.HINT_AUTOSIZE")),l.appendChild(i),(s=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOFIT")),s.addClassName(a.CHEMOBJSETTER_LINE),s.appendToElem(l),this._checkBoxAutofit=s,(i=e.createElement("span")).className=n.PART_ASSOC_TEXT_CONTENT,r.setElementText(i,Kekule.$L("ChemWidgetTexts.HINT_AUTOFIT")),l.appendChild(i),t.appendChild(l),(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(d=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(d,Kekule.$L("ChemWidgetTexts.CAPTION_LABEL_SIZE")),l.appendChild(d),l.appendChild(e.createElement("br")),(o=new Kekule.Widget.TextBox(this)).setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_WIDTH")),o.appendToElem(l),this._textBoxWidth=o;var o,s,l,d=e.createElement("span");r.setElementText(d,"Ã"),l.appendChild(d),(o=new Kekule.Widget.TextBox(this)).setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_HEIGHT")),o.appendToElem(l),this._textBoxHeight=o,(s=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_SHOWSIZEINFO")),s.appendToElem(l),this._checkBoxShowInfo=s,t.appendChild(l),(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(d=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(d,Kekule.$L("ChemWidgetTexts.CAPTION_BACKGROUND_COLOR")),l.appendChild(d),l.appendChild(e.createElement("br"));var u=new Kekule.Widget.ColorPicker(this);u.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT]),u.appendToElem(l),this._colorPicker=u,t.appendChild(l)},loadConfigValues:function(){this.tryApplySuper("loadConfigValues");var e=this.getWidget();if(e){var t=!e.getIs3D();this._checkBoxAutoSize.setChecked(t&&e.getAutoSizeExport()),this._checkBoxAutoSize.setEnabled(t),this._checkBoxAutofit.setChecked(t&&e.getAutofit()),this._checkBoxAutofit.setEnabled(t),this._checkBoxShowInfo.setChecked(e.getShowInfo());var r=e.getContextDimension();this._textBoxWidth.setText(Math.round(r.width)),this._textBoxHeight.setText(Math.round(r.height));var i=t?e.getBackgroundColor2D():e.getBackgroundColor3D();this._colorPicker.setValue(i||Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT)}},saveConfigValues:function(){this.tryApplySuper("saveConfigValues");var e=this.getWidget();if(e){!e.getIs3D()?(e.setAutoSizeExport(this._checkBoxAutoSize.getChecked()),e.setAutofit(this._checkBoxAutofit.getChecked()),e.setBackgroundColor2D(this._colorPicker.getValue())):e.setBackgroundColor3D(this._colorPicker.getValue()),e.setShowInfo(this._checkBoxShowInfo.getChecked());var t={width:parseInt(this._textBoxWidth.getText()),height:parseInt(this._textBoxHeight.getText())};e.setContextDimension(t),e.invokeEvent("configSave")}}}),Kekule._registerAfterLoadSysProc(function(){Kekule.ChemWidget&&Kekule.Spectroscopy&&(Kekule.globalOptions.add("chemWidget.spectrumObjInserter",{toolButtons:[o.loadData,o.saveData,o.clearObjs,o.changeSpectrumSection,o.zoomIn,o.zoomOut,o.reset,o.copy,o.config]}),Kekule.ChemWidget.SpectrumObjInserter=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.SpectrumObjInserter",DEF_BGCOLOR_2D:"transparent",initialize:function(e,t){this._configAction=new Kekule.Widget.ActionOpenConfigWidget(this),this._toolbarParentElem=null,this._infoLabel=null,this._infoLabelTemplate=Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH_HEIGHT"),this.tryApplySuper("initialize",[e])},doFinalize:function(){this._configAction&&this._configAction.finalize();var e=this.getPropStoreFieldValue("spectrumInspector");e&&e.finalize();var t=this.getPropStoreFieldValue("clientPanel");t&&t.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("spectrumInspector",{dataType:"Kekule.ChemWidget.SpectrumInspector",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("spectrumInspector");return e||(e=this.createSpectrumInspector(),this.setPropStoreFieldValue("spectrumInspector",e)),e}}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("spectrumInspector");return e?e.getChemObj():this.getPropStoreFieldValue("chemObj")},setter:function(e){this.setPropStoreFieldValue("chemObj",e),this.getSpectrumInspector()&&this.getSpectrumInspector().setChemObj(e)}}),this.defineProp("showInfo",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._infoLabel&&Kekule.StyleUtils.isShown(this._infoLabel)},setter:function(e){this._infoLabel&&Kekule.StyleUtils.setDisplay(this._infoLabel,e)}}),this.defineProp("clientPanel",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:e.PRIVATE}),this._defineSpectrumInspectorDelegatedProperties(["spectrumViewportRanges","backgroundColor","enableHotTrack","enableSelect","enableMultiSelect","enableDirectInteraction","enableTouchInteraction","enableGestureInteraction","chemObjLoaded","renderConfigs","viewerConfigs","toolButtons","spectrumViewerDrawOptions","assocViewerDrawOptions","assocViewerConfigs","assocViewerAllowCoordBorrow","assocViewerAutoSize","assocViewerAutofit","assocViewerAutoShrink","assocViewerAllowedMolDisplayTypes","assocViewerVisualMode","assocViewerSize"])},_defineSpectrumInspectorDelegatedProperties:function(e){for(var t,r,o=Kekule.ChemWidget.SpectrumInspector,n=this,a=0,s=e.length;a<s;++a){var l=e[a];r=null,i.isArray(l)?(t=l[0],r=l[1]):t=l,r||(r=t),function(e,t,r){var i=ClassEx.getPropInfo(e,r),o=Object.create(i);o.getter=null,o.setter=null,o.serializable=!1,i.getter&&(o.getter=function(){var e=this.getSpectrumInspector();return e?e.getPropValue(r):void 0}),i.setter&&(o.setter=function(e){var t=this.getSpectrumInspector();t&&t.setPropValue(r,e)}),n.defineProp(t,o)}(o,t,r)}},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r){var i=Kekule.IO.loadTypedData(t.data,t.resType,t.resUri);this.setChemObj(i)}else Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+a.SPECTRUMOBJ_INSERTER},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=e.createElement("div");i.className=a.SPECTRUMOBJ_INSERTER_CONTAINER_ELEM,this._containerElem=i,this.createToolbarParent(i);var o=new Kekule.Widget.Panel(this);return o.addClassName(a.SPECTRUMOBJ_INSERTER_CLIENT),o.setUseCornerDecoration(!1),o.appendToElem(i),this.setPropStoreFieldValue("clientPanel",o),this.createSpectrumInspector(o.getCoreElement()),this.createInfoLabel(o.getCoreElement(),this.getSpectrumInspector()),t.appendChild(i),this.setResizable&&this.setResizable(!0),r},getResizerElement:function(){return this.getClientPanel()?this.getClientPanel().getCoreElement():this.getCoreElement()},createSpectrumInspector:function(e){var t=Kekule.ChemWidget.ComponentWidgetNames,r=Kekule.Widget.EvokeMode,i=new Kekule.ChemWidget.SpectrumInspector(this);i.addClassName([n.DYN_CREATED,a.SPECTRUMOBJ_INSERTER_SPECTRUM_INSPECTOR]);var o=this;i.getSpectrumViewer().overwriteMethod("createToolButton",function($origin,e,r){if(e===t.config){var i=new Kekule.Widget.Button(r),n=o._configAction;return n&&i.setAction(n),i}return $origin(e,r)});var s=Kekule.globalOptions.chemWidget.spectrumObjInserter.toolButtons;return i.setToolbarParentElem(this._toolbarParentElem),i.setToolButtons(s),i.setToolbarPos(Kekule.Widget.Position.BOTTOM),i.setToolbarMarginVertical(-2),i.getSpectrumViewer().setToolbarEvokeModes([r.ALWAYS]),i.getAssocViewer().setToolbarEvokeModes([]),i.addEventListener("resize",this.updateInfoLabel,this),i.appendToElem(e),i.setChemObj(this.getChemObj()),this.setPropStoreFieldValue("spectrumInspector",i),i},createToolbarParent:function(e){var t=e.ownerDocument.createElement("div");return t.className=a.SPECTRUMOBJ_INSERTER_TOOLBAR_AREA,e.appendChild(t),this._toolbarParentElem=t,t},createInfoLabel:function(e,t){var r=this.getDocument().createElement("div");return r.className=n.DYN_CREATED+" "+a.SPECTRUMOBJ_INSERTER_INFOLABEL,e.appendChild(r),this._infoLabel=r,r},updateInfoLabel:function(){var e=this.getSpectrumInspector();if(e&&this._infoLabel){var t=e.getDimension(),r=t?this._infoLabelTemplate.format(Math.round(t.width),Math.round(t.height)):"";Kekule.DomUtils.setElementText(this._infoLabel,r)}},getSpectrumInspectorDimension:function(){return this.getSpectrumInspector().getDimension()},setSpectrumInspectorDimension:function(e){var t=this.getSpectrumInspectorDimension(),r=e.width-t.width,i=e.height-t.height,o=this.getDimension(),n={width:o.width+r,height:o.height+i};return this.setDimension(n.width,n.height),this},getImgExportDetailsAsync:function(e,t,r){try{var i=this.getSpectrumInspector(),o=i.getChemObj();if(o){var n={backgroundColor:i.getBackgroundColor(),enableHotTrack:i.getEnableHotTrack(),enableSelect:i.getEnableSelect(),enableMultiSelect:i.getEnableMultiSelect(),spectrumViewerDrawOptions:i.getSpectrumViewerDrawOptions(),spectrumViewerDrawOptionsJson:i.getSpectrumViewerDrawOptions()?JSON.stringify(i.getSpectrumViewerDrawOptions()):"",spectrumViewportRanges:i.getSpectrumViewportRanges(),spectrumViewportRangesJson:i.getSpectrumViewportRanges()?JSON.stringify(i.getSpectrumViewportRanges()):"",assocViewerDrawOptions:i.getAssocViewerDrawOptions(),assocViewerDrawOptionsJson:i.getAssocViewerDrawOptions()?JSON.stringify(i.getAssocViewerDrawOptions()):"",assocViewerVisualMode:i.getAssocViewerVisualMode(),assocViewerSize:i.getAssocViewerSize(),chemObj:o,chemObjJson:Kekule.IO.saveMimeData(this.getChemObj(),Kekule.IO.MimeType.KEKULE_JSON)};i.exportToDataUriAsync(e,t,function(e,t){n.dataUri=e,n.width=Math.round(t.width),n.height=Math.round(t.height),r(n)})}else r(null)}catch(e){throw r(null),e}},getExportImgElemAttributesAsync:function(e,r,i){this.getImgExportDetailsAsync(e,r,function(e){if(e){var r="width:"+e.width+"px; height:"+e.height+"px",o={src:e.dataUri,style:r,width:e.width,height:e.height,"data-kekule-widget":"Kekule.ChemWidget.SpectrumInspector","data-chem-obj":e.chemObjJson,"data-spectrum-viewer-draw-options":e.spectrumViewerDrawOptionsJson,"data-assoc-viewer-draw-options":e.assocViewerDrawOptionsJson};Kekule.ObjUtils.notUnset(e.assocViewerVisualMode)&&(o["data-assoc-viewer-visual-mode"]=JSON.stringify(e.assocViewerVisualMode)),Kekule.ObjUtils.notUnset(e.assocViewerSize)&&(o["data-assoc-viewer-size"]=e.assocViewerSize),e.spectrumViewportRangesJson&&(o["data-spectrum-viewport-ranges"]=e.spectrumViewportRangesJson),t.notUnset(e.enableHotTrack)&&(o["data-enable-hot-track"]=e.enableHotTrack),t.notUnset(e.enableSelect)&&(o["data-enable-select"]=e.enableSelect),t.notUnset(e.enableMultiSelect)&&(o["data-enable-multi-select"]=e.enableMultiSelect),Kekule.ObjUtils.notUnset(e.backgroundColor)&&(o["data-background-color"]=e.backgroundColor),i(o)}else i(null)})},exportToSingleImgElementAsync:function(e,t,r,i){this.getExportImgElemAttributesAsync(t,r,function(t){if(t){var r=e.createElement("img");Kekule.DomUtils.setElemAttributes(r,t),i(r)}else i(null)})},createExportHtmlElementAsync:function(e,t,r,i){this.exportToSingleImgElementAsync(e,t,r,function(e){i&&i(e)})},importFromDetails:function(e,r){this.setChemObj(e),this.getSpectrumInspector().beginUpdate();try{r.spectrumViewportRanges&&this.setSpectrumViewportRanges(r.spectrumViewportRanges),r.spectrumViewerDrawOptions&&this.setSpectrumViewerDrawOptions(r.spectrumViewerDrawOptions),r.assocViewerDrawOptions&&this.setAssocViewerDrawOptions(r.assocViewerDrawOptions),r.backgroundColor&&this.setBackgroundColor(r.backgroundColor),t.notUnset(r.enableHotTrack)&&this.setEnableHotTrack(r.enableHotTrack),t.notUnset(r.enableSelect)&&this.setEnableSelect(r.enableSelect),t.notUnset(r.enableMultiSelect)&&this.setEnableMultiSelect(r.enableMultiSelect),t.notUnset(r.assocViewerVisualMode)&&this.setAssocViewerVisualMode(r.assocViewerVisualMode),t.notUnset(r.assocViewerSize)&&this.setAssocViewerSize(r.assocViewerSize),r.width&&r.height&&this.setSpectrumInspectorDimension({width:r.width,height:r.height})}finally{this.getSpectrumInspector().endUpdate()}return this},importFromElemAttribs:function(e){e.width=DataType.JsonUtility.parse(e.width),e.height=DataType.JsonUtility.parse(e.height);var t=e["data-chem-obj"],r=t?Kekule.IO.loadMimeData(t,"chemical/x-kekule-json"):null;return e["data-spectrum-viewport-ranges"]&&(e.spectrumViewportRanges=DataType.JsonUtility.parse(e["data-spectrum-viewport-ranges"])),e["data-spectrum-viewer-draw-options"]&&(e.spectrumViewerDrawOptions=DataType.JsonUtility.parse(e["data-spectrum-viewer-draw-options"])),e["data-assoc-viewer-draw-options"]&&(e.assocViewerDrawOptions=DataType.JsonUtility.parse(e["data-assoc-viewer-draw-options"])),e["data-background-color"]&&(e.backgroundColor=e["data-background-color"]),e["data-enable-hot-track"]&&(e.enableHotTrack=DataType.JsonUtility.parse(e["data-enable-hot-track"])),e["data-enable-select"]&&(e.enableSelect=DataType.JsonUtility.parse(e["data-enable-select"])),e["data-enable-multi-select"]&&(e.enableMultiSelect=DataType.JsonUtility.parse(e["data-enable-multi-select"])),e["data-assoc-viewer-visual-mode"]&&(e.assocViewerVisualMode=DataType.JsonUtility.parse(e["data-assoc-viewer-visual-mode"])),this.importFromDetails(r,e)},importFromElem:function(e){var t=Kekule.HtmlElementUtils.getElemPageRect(e),r=Kekule.DomUtils.fetchAttributeValuesToJson(e);return r.width||(r.width=t.width),r.height||(r.height=t.height),this.importFromElemAttribs(r)}}),Kekule.ChemWidget.SpectrumObjInserter.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.SpectrumObjInserter.Configurator",initialize:function(e){this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this._reactInputWidgetValueChange.bind(this))},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoUpdate(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+a.SPECTRUMOBJ_INSERTER_CONFIGURATOR+" "+a.CHEMOBJSETTER_CONFIGURATOR},doCreateSubElements:function(e,t){var i;(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(d=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(d,Kekule.$L("ChemWidgetTexts.CAPTION_INTERACTIONS")),l.appendChild(d),l.appendChild(e.createElement("br")),(i=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_ENABLE_HOTTRACK")).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(l),this._checkBoxEnableHotTrack=i,(i=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_ENABLE_SELECT")).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(l),this._checkBoxEnableSelect=i,(i=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_ENABLE_MULTISELECT")).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(l),this._checkBoxEnableMultiSelect=i,t.appendChild(l),(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(d=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(d,Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE")),l.appendChild(d),l.appendChild(e.createElement("br"));var o=Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode,n=new Kekule.Widget.SelectBox(this);n.setItems([{text:Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE_AUTO"),value:o.AUTO},{text:Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE_VISIBLE"),value:o.VISIBLE},{text:Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE_INVISIBLE"),value:o.INVISIBLE}]).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(l),this._selectBoxAssocViewerVisualMode=n,(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(d=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(d,Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_SIZE")),l.appendChild(d),l.appendChild(e.createElement("br"));var s=e.createElement("input");s.setAttribute("type","range"),s.setAttribute("min","0"),s.setAttribute("max","100"),s.setAttribute("step","5");var l,d,u=this._reactRawInputElemValueChange.bind(this);Kekule.X.Event.addListener(s,"change",u),Kekule.X.Event.addListener(s,"input",u),this._assocViewerSizeInputElem=s,l.appendChild(s),t.appendChild(l),(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(d=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(d,Kekule.$L("ChemWidgetTexts.CAPTION_BACKGROUND_COLOR")),l.appendChild(d),l.appendChild(e.createElement("br"));var c=new Kekule.Widget.ColorPicker(this);c.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT]),c.appendToElem(l),this._colorPicker=c,t.appendChild(l)},_reactInputWidgetValueChange:function(e){this.saveConfigValues()},_reactRawInputElemValueChange:function(e){this.saveConfigValues()},_getSpectrumInspectorAssovViewerSizePercent:function(){var e=this.__$spectrumInspectorAssocViewerSizePercent$__;if(t.isUnset(e)){var r=this.getWidget();if(r=r&&r.getSpectrumInspector()){var i=r.getAssocViewerSize();if(i&&"string"==typeof i){var o=Kekule.StyleUtils.analysisUnitsValue(i);(o.units="%")&&(e=o.value)}if(t.isUnset(e)){var n=r.getDimension()||{},a=r.getAssocViewer().getDimension()||{},s=r.getLayout()===Kekule.Widget.Layout.VERTICAL?"height":"width";e=100*(a[s]||0)/(n[s]||1)}}}return e<0?e=0:e>100&&(e=100),e},_setSpectrumInspectorAssovViewerSizePercent:function(e){this.__$spectrumInspectorAssocViewerSizePercent$__=e;var t=this.getWidget();(t=t&&t.getSpectrumInspector())&&t.setAssocViewerSize(Math.round(e)+"%")},loadConfigValues:function(){this.tryApplySuper("loadConfigValues");var e=this.getWidget();if(e){this._checkBoxEnableHotTrack.setChecked(e.getEnableHotTrack()),this._checkBoxEnableSelect.setChecked(e.getEnableSelect()),this._checkBoxEnableMultiSelect.setChecked(e.getEnableMultiSelect());var t=e.getBackgroundColor();this._colorPicker.setValue(t||Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT),this._selectBoxAssocViewerVisualMode.setValue(e.getAssocViewerVisualMode()),this._assocViewerSizeInputElem.value=Math.round(this._getSpectrumInspectorAssovViewerSizePercent())}},saveConfigValues:function(){this.tryApplySuper("saveConfigValues");var e=this.getWidget();if(e){e.beginUpdate();try{e.setEnableHotTrack(this._checkBoxEnableHotTrack.getChecked()),e.setEnableSelect(this._checkBoxEnableSelect.getChecked()),e.setEnableMultiSelect(this._checkBoxEnableMultiSelect.getChecked()),e.setBackgroundColor(this._colorPicker.getValue()),e.setAssocViewerVisualMode(this._selectBoxAssocViewerVisualMode.getValue()),this._setSpectrumInspectorAssovViewerSizePercent(parseFloat(this._assocViewerSizeInputElem.value)),e.invokeEvent("configSave")}finally{e.endUpdate()}}}}))})}(),function(){Kekule;var e=Kekule.CoordMode,t=Kekule.ArrayUtils;ClassEx.extend(Kekule.ChemObject,{isStandalone:function(){return!this.getIsAttachedToParent()},getStandaloneAncestor:function(){for(var e=this;e.isStandalone&&!e.isStandalone()&&e.getParent&&e.getParent();)e=e.getParent();return e},getCascadeDeleteObjs:function(){return[]},cascadeRemove:function(e){var t=this.getParent();t&&t.notifyBeforeCascadeRemove&&t.notifyBeforeCascadeRemove(this),e?this.finalize():this.removeSelf(),t&&t.notifyAfterCascadeRemove&&t.notifyAfterCascadeRemove(this)},notifyBeforeCascadeRemove:function(e,t){},notifyAfterCascadeRemove:function(e,t){!this.getKeepEmptyEvenOnCascadeRemove()&&this.isEmpty()&&this.cascadeRemove(t)},isCoordDependent:function(){return!1},getCoordDependentObjects:function(){var e=[];return this.isCoordDependent()||e.push(this),e},getCoordDeterminateObjects:function(){var e=[];if(this.getAttachedMarkers)for(var r=this.getAttachedMarkers()||[],i=0,o=r.length;i<o;++i)e=e.concat(r[i].getCoordDependentObjects());var n=this.getAttachedCoordStickNodes();for(i=0,o=n.length;i<o;++i){var a=n[i];t.pushUnique(e,a),t.pushUnique(e,a.getCoordDeterminateObjects())}return e},getAllContainingConnectors:function(){return[]},getConstraintManipulationBaseObj:function(){if(this.isAttachedMarker&&this.isAttachedMarker()){var e=this.getParent();return e instanceof Kekule.StructureFragment?null:e}return null},transformAbsCoordByMatrix:function(e,t,r,i,o,n){if(this.getChildCount&&(i||Kekule.ObjUtils.isUnset(i)))for(var a=0,s=this.getChildCount();a<s;++a){var l=this.getChildAt(a);l&&l.transformAbsCoordByMatrix&&l.transformAbsCoordByMatrix(t,t,r,i,o,!0)}var d=r===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix;if(n){if(this.getCoordOfMode&&this.setCoordOfMode){var u=d(this.getCoordOfMode(r,o),e);this.setCoordOfMode(u,r)}}else if(this.getAbsCoordOfMode&&this.setAbsCoordOfMode){u=d(this.getAbsCoordOfMode(r,o),e);this.setAbsCoordOfMode(u,r)}},scaleSize:function(e,t,r,i){if(this.getSizeOfMode&&this.setSizeOfMode){var o=this.getSizeOfMode(t,i),n=Kekule.CoordUtils.multiply(o,e);this.setSizeOfMode(n,t)}if(this.getChildCount&&(r||Kekule.ObjUtils.isUnset(r)))for(var a=0,s=this.getChildCount();a<s;++a){var l=this.getChildAt(a);l&&l.scaleSize&&l.scaleSize(e,t,r,i)}}}),ClassEx.extendMethod(Kekule.ChemObject,"_attachedMarkerAdded",function($origin,e){var t=$origin(e);return e&&e.setIsAttachedToParent(!0),t}),ClassEx.extendMethod(Kekule.ChemObject,"_attachedMarkerRemoved",function($origin,e){var t=$origin(e);return e&&e.setIsAttachedToParent(!1),t}),ClassEx.defineProps(Kekule.ChemObject,[{name:"keepEmptyEvenOnCascadeRemove",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC},{name:"isAttachedToParent",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}]),ClassEx.extend(Kekule.ChemStructureObject,{getCascadeDeleteObjs:function(){for(var e=this.tryApplySuper("getCascadeDeleteObjs"),t=this.getLinkedConnectors?this.getLinkedConnectors():[],r=0,i=t.length;r<i;++r){var o=t[r];if(o.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(e,o);var n=o.getCascadeDeleteObjs();Kekule.ArrayUtils.pushUnique(e,n)}}return e},isStandalone:function(){return!1},getCoordDeterminateObjects:function(){for(var e=this.tryApplySuper("getCoordDeterminateObjects"),r=this.getLinkedConnectors(),i=0,o=r.length;i<o;++i){var n=r[i];t.pushUnique(e,n),t.pushUnique(e,n.getCoordDeterminateObjects())}return e}}),ClassEx.extend(Kekule.BaseStructureNode,{getCascadeDeleteObjs:function(){return this.tryApplySuper("getCascadeDeleteObjs")},isCoordDependent:function(){return!1},getCoordDependentObjects:function(){return this.tryApplySuper("getCoordDependentObjects")},move:function(e,t){var r=this.getCoordOfMode(t),i=Kekule.CoordUtils.add(r,e);return this.setCoordOfMode(i,t),i},move2D:function(t){return this.move(t,e.COORD2D)},move3D:function(t){return this.move(t,e.COORD3D)}}),ClassEx.extend(Kekule.BaseStructureConnector,{getCascadeDeleteObjs:function(){for(var e=this.tryApplySuper("getCascadeDeleteObjs"),t=this.getConnectedObjs(),r=0,i=t.length;r<i;++r){var o=t[r];o instanceof Kekule.BaseStructureNode&&o.getLinkedConnectors().length<=1&&Kekule.ArrayUtils.pushUnique(e,o)}return e},isCoordDependent:function(){return!0},getCoordDependentObjects:function(){for(var e=this.tryApplySuper("getCoordDependentObjects"),r=this.getConnectedObjs(),i=0,o=r.length;i<o;++i){var n=r[i];if(n.isExposed)var a=n.isExposed()?n:n.getExposedAncestor();else a=n;a&&t.pushUnique(e,a.getCoordDependentObjects())}return e},move:function(e,t){for(var r=0,i=this.getConnectedObjCount();r<i;++r){var o=this.getConnectedObjAt(r);o.move&&o.move(e,t)}},move2D:function(t){return this.move(t,e.COORD2D)},move3D:function(t){return this.move(t,e.COORD3D)},setAbsBaseCoord:function(e,t){var r=this.getAbsBaseCoord(),i=Kekule.CoordUtils.substract(e,r);this.move(i,t)},setAbsBaseCoord2D:function(e){this.setAbsCoordOfMode(e,Kekule.CoordMode.COORD2D)},setAbsBaseCoord3D:function(e){this.setAbsCoordOfMode(e,Kekule.CoordMode.COORD3D)}}),ClassEx.extend(Kekule.ChemStructureNode,{getConstraintManipulationBaseObj:function(){var e=this.getLinkedObjs();return 1===e.length?e[0]:this.tryApplySuper("getConstraintManipulationBaseObj")}}),ClassEx.extend(Kekule.Glyph.PathGlyphNode,{getCascadeDeleteObjs:function(){return[this.getParent()]},getConstraintManipulationBaseObj:function(){var e=this.getLinkedObjs();return 1===e.length?e[0]:this.tryApplySuper("getConstraintManipulationBaseObj")}}),ClassEx.extend(Kekule.Glyph.PathGlyphConnectorControlNode,{getCoordDeterminateObjects:function(){var e=this.tryApplySuper("getCoordDeterminateObjects"),t=this.getParentConnector();return t&&(e=(e||[]).concat([t])),e}}),ClassEx.extend(Kekule.Glyph.PathGlyphConnector,{getCascadeDeleteObjs:function(){return[this.getParent()]},getCoordDependentObjects:function(){var e=this.tryApplySuper("getCoordDependentObjects"),t=this.getControlPoints&&this.getControlPoints();return t&&t.length&&(e=(e||[]).concat(t)),e}}),ClassEx.extend(Kekule.StructureFragment,{isStandalone:function(){return!this.getCrossConnectors().length},notifyBeforeCascadeRemove:function(e,t){var r=this._getObjsNeedToBeCascadeRemoved(e);if(r&&r.length)for(var i=r.length-1;i>=0;--i){var o=r[i];t?o.finalize():o.removeSelf()}this.tryApplySuper("notifyBeforeCascadeRemove",[e,t])},getCoordDependentObjects:function(){if(this.isExpanded&&!this.isExpanded())return this.tryApplySuper("getCoordDependentObjects");if(this.hasCtab()){for(var e=[],r=this.getChildCount(),i=0;i<r;++i){var o=this.getChildAt(i);t.pushUnique(e,o.getCoordDependentObjects())}return e}return this.tryApplySuper("getCoordDependentObjects")},transformAbsCoordByMatrix:function(e,t,r,i,o,n){if(i||Kekule.ObjUtils.isUnset(i))for(var a=0,s=this.getNodeCount();a<s;++a){var l=this.getNodeAt(a);l&&l.transformAbsCoordByMatrix&&l.transformAbsCoordByMatrix(t,t,r,i,o,!0)}this.tryApplySuper("transformAbsCoordByMatrix",[e,t,r,!1,o,n])}}),ClassEx.extend(Kekule.Glyph.Base,{isStandalone:function(){return this.tryApplySuper("isStandalone")}}),ClassEx.extend(Kekule.Glyph.PathGlyph,{getCoordDependentObjects:function(){for(var e=[],t=this.getNodeCount(),r=0;r<t;++r){var i=this.getNodeAt(r);e.push(i)}return e},transformAbsCoordByMatrix:function(e,t,r,i,o,n){if(i||Kekule.ObjUtils.isUnset(i))for(var a=0,s=this.getNodeCount();a<s;++a){var l=this.getNodeAt(a);l&&l.transformAbsCoordByMatrix&&l.transformAbsCoordByMatrix(t,t,r,i,o,!0)}this.tryApplySuper("transformAbsCoordByMatrix",[e,t,r,!1,o,n])}}),ClassEx.extend(Kekule.Glyph.BaseArc,{ownerChanged:function(e,t){var r=!t&&e,i=this.tryApplySuper("ownerChanged",[e,t]);return r&&this.getIsEditing()&&this._autoAdjustClass(),i},_getChemStickTargets:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var i=this.getNodeAt(t).getCoordStickTarget();this._isValidChemNodeOrConnectorStickTarget(i)&&e.push(i)}return e},notifyChildCoordStickTargetChanged:function(e,t,r){this._autoAdjustClass()},_autoAdjustClass:function(){this.getIsEditing()&&(this._getChemStickTargets().length>=2?this instanceof Kekule.Glyph.ElectronPushingArrow||this.__changeClass__(Kekule.Glyph.ElectronPushingArrow):this instanceof Kekule.Glyph.ElectronPushingArrow&&this.__changeClass__(Kekule.Glyph.Arc))}}),ClassEx.extendMethod(Kekule.Glyph.BaseArc,"createDefaultStructure",function($origin,e,t){var r=$origin(e,t);return this._autoAdjustClass(),r}),ClassEx.extend(Kekule.Glyph.BaseTwinArc,{ownerChanged:function(e,t){var r=!t&&e,i=this.tryApplySuper("ownerChanged",[e,t]);return r&&this.getIsEditing()&&this._autoAdjustClass(),i},_getChemStickTargets:function(){for(var e=[],t=this._getArrowStartingNodes(),r=0,i=t.length;r<i;++r){var o=t[r].getCoordStickTarget();this._isValidChemNodeOrConnectorStickTarget(o)&&e.push(o)}return e},notifyChildCoordStickTargetChanged:function(e,t,r){this._autoAdjustClass()},_autoAdjustClass:function(){this.getIsEditing()&&(this._getChemStickTargets().length>=2?this instanceof Kekule.Glyph.BondFormingElectronPushingArrow||(this.__changeClass__(Kekule.Glyph.BondFormingElectronPushingArrow),this.getElectronCount()||this.setElectronCount(1)):this instanceof Kekule.Glyph.BondFormingElectronPushingArrow&&this.__changeClass__(Kekule.Glyph.TwinArc))}})}(),function(){"use strict";var e=Kekule.ObjUtils,t=Kekule.ArrayUtils,r=Kekule.HtmlElementUtils,i=Kekule.CoordUtils,o=Kekule.Widget.HtmlClassNames,n=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{EDITOR:"K-Chem-Editor",EDITOR_CLIENT:"K-Chem-Editor-Client",EDITOR_UIEVENT_RECEIVER:"K-Chem-Editor-UiEvent-Receiver",EDITOR2D:"K-Chem-Editor2D",EDITOR3D:"K-Chem-Editor3D"}),Kekule.ChemWidget.Editor={},Kekule.Editor=Kekule.ChemWidget.Editor,Kekule.Editor.CoordSys=Kekule.Render.CoordSystem,Kekule.Editor.BoxRegion={OUTSIDE:0,CORNER_TL:1,CORNER_TR:2,CORNER_BL:3,CORNER_BR:4,EDGE_TOP:11,EDGE_LEFT:12,EDGE_BOTTOM:13,EDGE_RIGHT:14,INSIDE:20},Kekule.Editor.SelectMode={RECT:0,POLYGON:1,POLYLINE:2,ANCESTOR:10},Kekule.globalOptions.add("chemWidget.editor",{enableIssueCheck:!0,enableCreateNewDoc:!0,enableOperHistory:!0,enableOperContext:!0,initOnNewDoc:!0,enableSelect:!0,enableMove:!0,enableResize:!0,enableAspectRatioLockedResize:!0,enableRotate:!0,enableGesture:!0}),Kekule.globalOptions.add("chemWidget.editor.issueChecker",{enableAutoIssueCheck:!0,enableAutoScrollToActiveIssue:!0,enableIssueMarkerHint:!0,durationLimit:50}),Kekule.Editor.BaseEditor=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.Editor.BaseEditor",BINDABLE_TAG_NAMES:["div","span"],OBSERVING_GESTURES:["rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout"],initialize:function(e,t,r,i){this._objSelectFlag=0,this._objectUpdateFlag=0,this._objectManipulateFlag=0,this._uiMarkerUpdateFlag=0,this._updatedObjectDetails=[],this._operatingObjs=[],this._operatingRenderers=[],this._initialRenderTransformParams=null,this._objChanged=!1,this._lengthCaches={};var o=Kekule.globalOptions.get;this.setPropStoreFieldValue("enableIssueCheck",o("chemWidget.editor.enableIssueCheck",!0)),this.setPropStoreFieldValue("enableCreateNewDoc",o("chemWidget.editor.enableCreateNewDoc",!0)),this.setPropStoreFieldValue("enableOperHistory",o("chemWidget.editor.enableOperHistory",!0)),this.setPropStoreFieldValue("enableOperContext",o("chemWidget.editor.enableOperContext",!0)),this.setPropStoreFieldValue("initOnNewDoc",o("chemWidget.editor.initOnNewDoc",!0)),this.tryApplySuper("initialize",[e,t,r]),!this.getChemObj()&&this.getInitOnNewDoc()&&this.getEnableCreateNewDoc()&&this.newDoc(),this.setPropStoreFieldValue("editorConfigs",i||this.createDefaultConfigs()),this.setEnableGesture(o("chemWidget.editor.enableGesture",!0))},initProperties:function(){this.defineProp("editorConfigs",{dataType:"Kekule.Editor.BaseEditorConfigs",serializable:!1,getter:function(){return this.getDisplayerConfigs()},setter:function(e){return this.setDisplayerConfigs(e)}}),this.defineProp("defBondLength",{dataType:DataType.FLOAT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("defBondLength");return e||(e=this.getEditorConfigs().getStructureConfigs().getDefBondLength()),e}}),this.defineProp("defBondScreenLength",{dataType:DataType.FLOAT,serializable:!1,setter:null,getter:function(){var e=this._lengthCaches.defBondScreenLength;if(e)return e;var t=this.getDefBondLength()||0,r=this.translateDistance(t,Kekule.Render.CoordSystem.CHEM,Kekule.Render.CoordSystem.SCREEN);return this._lengthCaches.defBondScreenLength=r,r}}),this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:!1,setter:null,getter:function(){var e=this.getCurrPointerType();return this.getInteractionBoundInflation(e)}}),this.defineProp("currPointerType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("operHistory");return e||(e=new Kekule.OperationHistory,this.setPropStoreFieldValue("operHistory",e),e.addEventListener("push",this.reactOperHistoryPush,this),e.addEventListener("pop",this.reactOperHistoryPop,this),e.addEventListener("undo",this.reactOperHistoryUndo,this),e.addEventListener("redo",this.reactOperHistoryRedo,this),e.addEventListener("clear",this.reactOperHistoryClear,this),e.addEventListener("change",this.reactOperHistoryChange,this)),e},setter:null}),this.defineProp("operationsInCurrManipulation",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,serializable:!1}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("selection");return e||(e=[],this.setPropStoreFieldValue("selection",e)),e},setter:function(e){this.setPropStoreFieldValue("selection",e),this.selectionChanged()}}),this.defineProp("selectMode",{dataType:DataType.INT,getter:function(){var e=this.getPropStoreFieldValue("selectMode");return Kekule.ObjUtils.isUnset(e)&&(e=Kekule.Editor.SelectMode.RECT),e},setter:function(e){this.getSelectMode()!==e&&(this.setPropStoreFieldValue("selectMode",e),this.hideSelectingMarker())}}),this.defineProp("isToggleSelectOn",{dataType:DataType.BOOL}),this.defineProp("hotTrackedObjs",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=e?Kekule.ArrayUtils.toArray(e):[];if(this.getEditorConfigs()&&this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){var r;if(this.setPropStoreFieldValue("hotTrackedObjs",t),t&&t.length){r=[];for(var i=0,o=t.length;i<o;++i){var n=this.getBoundInfoRecorder().getBound(this.getObjContext(),t[i]);r&&Kekule.ArrayUtils.pushUnique(r,n)}}r?this.changeHotTrackMarkerBounds(r):this.getUiHotTrackMarker().getVisible()&&this.hideHotTrackMarker()}}}),this.defineProp("hotTrackedObj",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getHotTrackedObjs()&&this.getHotTrackedObjs()[0]},setter:function(e){this.setHotTrackedObjs(e)}}),this.defineProp("hoveredBasicObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("enableOperContext",{dataType:DataType.BOOL,setter:function(e){if(this.setPropStoreFieldValue("enableOperContext",!!e),!e){var t=this.getPropStoreFieldValue("operContext"),r=this.getPropStoreFieldValue("drawBridge");r&&t&&r.releaseContext(t)}}}),this.defineProp("issueCheckExecutor",{dataType:"Kekule.IssueCheck.Executor",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("issueCheckExecutor");if(!e){e=this.createIssueCheckExecutor();var t=this;e.addEventListener("execute",function(e){t.setIssueCheckResults(e.checkResults)}),this.setPropStoreFieldValue("issueCheckExecutor",e)}return e}}),this.defineProp("issueCheckerIds",{dataType:DataType.ARRAY,getter:function(){return this.getIssueCheckExecutor().getCheckerIds()},setter:function(e){this.getIssueCheckExecutor().setCheckerIds(e)}}),this.defineProp("enableIssueCheck",{dataType:DataType.BOOL,getter:function(){return this.getIssueCheckExecutor().getEnabled()},setter:function(e){this.getIssueCheckExecutor().setEnabled(!!e),e||this.setIssueCheckResults(null)}}),this.defineProp("issueCheckDurationLimit",{dataType:DataType.NUMBER,getter:function(){return this.getIssueCheckExecutor().getDurationLimit()},setter:function(e){this.getIssueCheckExecutor().setDurationLimit(e)}}),this.defineProp("enableAutoIssueCheck",{dataType:DataType.BOOL,setter:function(e){!!e!==this.getEnableAutoIssueCheck()&&(this.setPropStoreFieldValue("enableAutoIssueCheck",!!e),e&&this.checkIssues(),this.setShowAllIssueMarkers(!!e))}}),this.defineProp("issueCheckResults",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=this.getActiveIssueCheckResult();this.setPropStoreFieldValue("issueCheckResults",e),t&&(e||[]).indexOf(t)<0&&this.setPropStoreFieldValue("activeIssueCheckResult",null),this.issueCheckResultsChanged()}}),this.defineProp("activeIssueCheckResult",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getActiveIssueCheckResult()!==e&&(this.setPropStoreFieldValue("activeIssueCheckResult",e),e&&this.deselectAll(),this.issueCheckResultsChanged())}}),this.defineProp("enableAutoScrollToActiveIssue",{dataType:DataType.BOOL}),this.defineProp("showAllIssueMarkers",{dataType:DataType.BOOL,setter:function(e){!!e!==this.getShowAllIssueMarkers()&&(this.setPropStoreFieldValue("showAllIssueMarkers",!!e),this.recalcIssueCheckUiMarkers())}}),this.defineProp("enableIssueMarkerHint",{dataType:DataType.BOOL}),this.defineProp("enableGesture",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this.getEnableGesture()!==t&&(this.setPropStoreFieldValue("enableGesture",t),this.startObservingGestureEvents(this.OBSERVING_GESTURES))}}),this.defineProp("uiEventReceiverElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("operContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("uiContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objContext",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){return this.getDrawContext()}}),this.defineProp("operContext",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){if(this.getEnableOperContext()){var e=this.getPropStoreFieldValue("operContext");if(!e){var t=this.getDrawBridge();if(t){var r=this.getOperContextParentElem();if(!r)return null;var i=Kekule.HtmlElementUtils.getElemScrollDimension(r);e=t.createContext(r,i.width,i.height),this.setPropStoreFieldValue("operContext",e)}}return e}return null}}),this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("uiContext");if(!e){var t=this.getUiDrawBridge();if(t){var r=this.getUiContextParentElem();if(!r)return null;var i=Kekule.HtmlElementUtils.getElemScrollDimension(r);e=t.createContext(r,i.width,i.height),this.setPropStoreFieldValue("uiContext",e)}}return e}}),this.defineProp("objDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){return this.getDrawBridge()}}),this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiDrawBridge");return e||this.__$uiDrawBridgeInitialized$__||(this.__$uiDrawBridgeInitialized$__=!0,e=this.createUiDrawBridge(),this.setPropStoreFieldValue("uiDrawBridge",e)),e}}),this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiPainter");if(!e){var t=this.getUiMarkers();return(e=new Kekule.Render.ChemObjPainter(Kekule.Render.RendererType.R2D,t,this.getUiDrawBridge())).setCanModifyTargetObj(!0),this.setPropStoreFieldValue("uiPainter",e),e}return e}}),this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,setter:null,getter:function(){var e=this.getUiPainter();return e?(e.getRenderer()||e.prepareRenderer(),e.getRenderer()||null):null}}),this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiMarkers");return e||(e=new Kekule.ChemWidget.UiMarkerCollection,this.setPropStoreFieldValue("uiMarkers",e)),e}}),this._defineUiMarkerProp("uiHotTrackMarker"),this._defineUiMarkerProp("uiSelectionAreaMarker"),this._defineUiMarkerProp("uiSelectingMarker"),this._defineIssueCheckUiMarkerGroupProps(),this.defineProp("uiSelectionAreaContainerBox",{dataType:DataType.Object,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("objRendererMap",{dataType:"Kekule.MapEx",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("objRendererMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("objRendererMap",e)),e}}),this.defineProp("zoomCenter",{dataType:DataType.HASH})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setOperationsInCurrManipulation([]);var e=Kekule.IssueCheck.CheckerIds,t=Kekule.globalOptions.get;this.setEnableAutoIssueCheck(t("chemWidget.editor.issueChecker.enableAutoIssueCheck",!0)),this.setEnableAutoScrollToActiveIssue(t("chemWidget.editor.issueChecker.enableAutoScrollToActiveIssue",!0)),this.setIssueCheckerIds(t("chemWidget.editor.issueChecker.issueCheckerIds",[e.ATOM_VALENCE,e.BOND_ORDER,e.NODE_DISTANCE_2D])),this.setIssueCheckDurationLimit(t("chemWidget.editor.issueChecker.durationLimit")||null),this.setEnableIssueMarkerHint(t("chemWidget.editor.issueChecker.enableIssueMarkerHint")||this.getEnableAutoIssueCheck())},_defineUiMarkerProp:function(e,t){return this.defineProp(e,{dataType:"Kekule.ChemWidget.AbstractUIMarker",serializable:!1,getter:function(){var t=this.getPropStoreFieldValue(e);return t||(t=this.createShapeBasedMarker(e,null,null,!1)),t},setter:function(r){t||(t=this.getUiMarkers());var i=this.getPropValue(e);i&&(t.removeMarker(i),i.finalize()),t.addMarker(r),this.setPropStoreFieldValue(e,r)}})},_defineIssueCheckUiMarkerGroupProps:function(e){for(var t=Kekule.ErrorLevel,r=function(e,r){return e+"_"+t.levelToString(r)},i="issueCheckUiMarker",o=[t.ERROR,t.WARNING,t.NOTE,t.LOG],n=0,a=o.length;n<a;++n){var s=r(i,o[n]);this._defineUiMarkerProp(s,e)}this._defineUiMarkerProp(i+"_active",e),this["get"+i.upperFirst()]=function(e){var t=r(i,e);return this.getPropValue(t)},this["set"+i.upperFirst()]=function(e,t){var o=r(i,e);return this.setPropValue(o,t)},this["getActive"+i.upperFirst()]=function(){return this.getPropValue(i+"_active")},this["getAll"+i.upperFirst()+"s"]=function(){for(var e=[],t=0,r=o.length;t<r;++t)e.push(this.getIssueCheckUiMarker(o[t]));var i=this.getActiveIssueCheckUiMarker();return i&&e.push(i),e}},doFinalize:function(){var e=this.getPropStoreFieldValue("operHistory");e&&(e.finalize(),this.setPropStoreFieldValue("operHistory",null));var t=this.getPropStoreFieldValue("objDrawBridge"),r=this.getPropStoreFieldValue("operContext");t&&r&&t.releaseContext(r),this.setPropStoreFieldValue("operContext",null);t=this.getPropStoreFieldValue("uiDrawBridge"),r=this.getPropStoreFieldValue("uiContext");t&&r&&t.releaseContext(r),this.setPropStoreFieldValue("uiDrawBridge",null),this.setPropStoreFieldValue("uiContext",null);var i=this.getPropStoreFieldValue("objRendererMap");i&&i.finalize(),this.setPropStoreFieldValue("objRendererMap",null);var o=this.getPropStoreFieldValue("issueCheckExecutor");o&&o.finalize(),this.setPropStoreFieldValue("issueCheckExecutor",null),this.tryApplySuper("doFinalize")},elementBound:function(e){this.setObserveElemResize(!0)},createDefaultConfigs:function(){return new Kekule.Editor.BaseEditorConfigs},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=e.createElement("div");return r.className=n.EDITOR_CLIENT,t.appendChild(r),this._editClientElem=r,[r]},getCoreElement:function(){return this._editClientElem||this.tryApplySuper("getCoreElement")},getEditClientElem:function(){return this._editClientElem},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+n.EDITOR;return e+=" "+(this.getRenderType()===Kekule.Render.RendererType.R3D?n.EDITOR3D:n.EDITOR2D)},doBindElement:function(e){this.createContextParentElems(),this.createUiEventReceiverElem()},doGetInitialZoom:function(){var e,t=this.getEditorConfigs();return t&&(e=t.getInteractionConfigs().getEditorInitialZoom()),e||(e=this.tryApplySuper("doGetInitialZoom")),e},doSetInitialZoom:function(e){var t=this.getEditorConfigs();t&&t.getInteractionConfigs().setEditorInitialZoom(e),this.tryApplySuper("doSetInitialZoom",[e])},zoomTo:function(e,t,r){var i=Kekule.CoordUtils,o=this.getCurrZoom(),n=e,a=this.tryApplySuper("zoomTo",[e,t]),s=this.getElement(),l={x:s.scrollLeft,y:s.scrollTop};r||(r=this.getZoomCenter()),r||(r=i.add(l,{x:s.clientWidth/2,y:s.clientHeight/2}));var d=i.multiply(r,n/o-1);return s.scrollLeft+=d.x,s.scrollTop+=d.y,a},changeClientSize:function(e,t,r){this._initialRenderTransformParams=null;var i=this.getCoreElement().style;r||(r=1);var o=e*r,n=t*r;o&&(i.width=o+"px"),n&&(i.height=n+"px");for(var a=[this.getObjContext(),this.getOperContext(),this.getUiContext()],s=0,l=a.length;s<l;++s){var d=a[s];d&&this.getDrawBridge().setContextDimension(d,o,n)}this.repaint()},getVisibleClientScreenBox:function(){var e=this.getEditClientElem().parentNode,t=Kekule.HtmlElementUtils.getElemClientDimension(e),r=this.getClientScrollPosition();return t.x1=r.x,t.y1=r.y,t.x2=t.x1+t.width,t.y2=t.y1+t.height,t},getVisibleClientBoxOfSys:function(e){var t=this.getVisibleClientScreenBox(),r=Kekule.BoxUtils.getMinMaxCoords(t),i=this.translateCoord(r.min,Kekule.Editor.CoordSys.SCREEN,e),o=this.translateCoord(r.max,Kekule.Editor.CoordSys.SCREEN,e);return Kekule.BoxUtils.createBox(i,o)},getVisibleClientObjBox:function(e){return this.getVisibleClientBoxOfSys(Kekule.Editor.CoordSys.CHEM)},isDirty:function(){return this.getEnableOperHistory()?this.getOperHistory().getCurrIndex()>=0:this._objChanged},getChemObjSrcInfo:function(e){return this.isDirty()?null:e.getSrcInfo?e.getSrcInfo():null},getActualDrawOptions:function(){var e=this.tryApplySuper("getActualDrawOptions");if(this._initialRenderTransformParams){var t=Object.extend({},this._initialRenderTransformParams);return t=Object.extend(t,e)}return e},repaint:function(e){var t=e,r=this.tryApplySuper("repaint",[t]);return this.isRenderable()&&(this._initialRenderTransformParams||(this._initialRenderTransformParams=this.getPainter().getActualInitialRenderTransformOptions(this.getObjContext())),this.recalcUiMarkers()),r},newDoc:function(){this.load(this.doCreateNewDocObj())},doCreateNewDocObj:function(){return new Kekule.Molecule},getExportableClasses:function(){var e=this.getChemObj();return e&&e.getClass?[e.getClass()]:[]},exportObj:function(e){return this.exportObjs(e)[0]},exportObjs:function(e){var t=this.getChemObj();return e?t&&t instanceof e?[t]:[]:[t]},doLoad:function(e){this.deselectAll(),this._initialRenderTransformParams=null,this.getObjRendererMap().clear(),this.getOperHistory()&&this.getOperHistory().clear(),this.tryApplySuper("doLoad",[e]),this._objChanged=!1,this.setPropStoreFieldValue("hoveredBasicObjs",null),this.setIssueCheckResults(null),this.requestAutoCheckIssuesIfNecessary()},doLoadEnd:function(e){this.tryApplySuper("doLoadEnd"),e||(this._initialRenderTransformParams=null)},doResize:function(){this._initialRenderTransformParams=null,this.tryApplySuper("doResize")},geometryOptionChanged:function(){var e=this.getDrawOptions().zoom;this.zoomChanged(e),this._clearLengthCaches(),this.tryApplySuper("geometryOptionChanged")},zoomChanged:function(e){},_clearLengthCaches:function(){this._lengthCaches={}},chemObjChanged:function(e,t){this.tryApplySuper("chemObjChanged",[e,t]),e!==t&&(t&&this._uninstallChemObjEventListener(t),e&&this._installChemObjEventListener(e))},_installChemObjEventListener:function(e){e.addEventListener("change",this.reactChemObjChange,this)},_uninstallChemObjEventListener:function(e){e.removeEventListener("change",this.reactChemObjChange,this)},createUiEventReceiverElem:function(){var e=this.getCoreElement();if(e){var t=e.ownerDocument.createElement("div");return t.className=n.EDITOR_UIEVENT_RECEIVER,e.appendChild(t),r.addClass(t,o.DYN_CREATED),this.setPropStoreFieldValue("uiEventReceiverElem",t),t}},createContextParentElems:function(){var e=this.getCoreElement();if(e){var t=e.ownerDocument;this._createContextParentElem(t,e,"objContextParentElem"),this._createContextParentElem(t,e,"operContextParentElem"),this._createContextParentElem(t,e,"uiContextParentElem")}},_createContextParentElem:function(e,t,r){var i=e.createElement("div");return i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.className=r+" "+o.DYN_CREATED,this.setPropStoreFieldValue(r,i),t.appendChild(i),i},createNewPainter:function(e){var t=this.tryApplySuper("createNewPainter",[e]);return t&&(t.setCanModifyTargetObj(!0),this.installPainterEventHandlers(t)),t},getDrawContextParentElem:function(){return this.getObjContextParentElem()},createUiDrawBridge:function(){var e=Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!e){var t=Kekule.Render.DrawBridge2DMananger.getUnavailableMessage()||Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));t&&this.reportException(t,Kekule.ExceptionLevel.NOT_FATAL_ERROR)}return e},changeContextDimension:function(e){var t=this.tryApplySuper("changeContextDimension",[e]);return t&&(this._resizeContext(this.getOperContext(),this.getObjDrawBridge(),e.width,e.height),this._resizeContext(this.getUiContext(),this.getUiDrawBridge(),e.width,e.height)),t},_clearSpecContext:function(e,t){t&&e&&t.clearContext(e)},_renderSpecContext:function(e,t){t&&e&&t.renderContext(e)},clearObjContext:function(){this._clearSpecContext(this.getObjContext(),this.getDrawBridge()),this.getBoundInfoRecorder()&&this.getBoundInfoRecorder().clear(this.getObjContext())},clearOperContext:function(){this._clearSpecContext(this.getOperContext(),this.getDrawBridge())},clearUiContext:function(){this._clearSpecContext(this.getUiContext(),this.getUiDrawBridge())},clearContext:function(){this.clearObjContext(),this._operatingRenderers&&this.clearOperContext()},repaintOperContext:function(e){if(this._operatingRenderers&&this._operatingObjs){this.clearOperContext();try{var t={partialDrawObjs:this._operatingObjs,doNotClear:!0};this.repaint(t)}finally{this._renderSpecContext(this.getOperContext(),this.getDrawBridge())}}},getOperatingRenderers:function(){return this._operatingRenderers||(this._operatingRenderers=[]),this._operatingRenderers},setOperatingRenderers:function(e){this._operatingRenderers=e},installPainterEventHandlers:function(e){e.addEventListener("prepareDrawing",this.reactChemObjPrepareDrawing,this),e.addEventListener("clear",this.reactChemObjClear,this)},reactChemObjPrepareDrawing:function(e){var r=e.context,i=e.obj;if(i&&(r===this.getObjContext()||r===this.getOperContext())){var o=e.target;if(this.getObjRendererMap().set(i,o),this.getEnableOperContext()){for(var n=this._operatingObjs||[],a=!1,s=0,l=n.length;s<l;++s)if(this._isChemObjDirectlyRenderedByRenderer(this.getObjContext(),n[s],o)){a=!0;break}a&&(this._setRendererToOperContext(o),t.pushUnique(this.getOperatingRenderers(),o))}}},reactChemObjClear:function(e){var r=e.context,i=e.obj;if(i&&(r===this.getObjContext()||r===this.getOperContext())){var o=e.target;this.getObjRendererMap().remove(i),t.remove(this.getOperatingRenderers(),o)}},reactChemObjChange:function(e){var t=e.target,r=e.changedPropNames||[];!(r=Kekule.ArrayUtils.exclude(r,["id","owner","ownedObjs"])).length&&e.changedPropNames||this.objectChanged(t,r)},reactOperHistoryPush:function(e){this.invokeEvent("operPush",e)},reactOperHistoryPop:function(e){this.invokeEvent("operPop",e)},reactOperHistoryUndo:function(e){this.invokeEvent("operUndo",e)},reactOperHistoryRedo:function(e){this.invokeEvent("operRedo",e)},reactOperHistoryClear:function(e){this.invokeEvent("operHistoryClear",e)},reactOperHistoryChange:function(e){this.invokeEvent("operChange",e)},beginUpdateObject:function(){this._objectUpdateFlag>=0&&this.invokeEvent("beginUpdateObject"),--this._objectUpdateFlag},endUpdateObject:function(){++this._objectUpdateFlag,this.isUpdatingObject()||(this._updatedObjectDetails&&this._updatedObjectDetails.length&&(this.objectsChanged(this._updatedObjectDetails),this._updatedObjectDetails=[]),this._execAfterUpdateObjectProcs(),this.invokeEvent("endUpdateObject"))},isUpdatingObject:function(){return this._objectUpdateFlag<0},_registerAfterUpdateObjectProc:function(e){this.isUpdatingObject()?(this.endUpdateObject.suspendedProcs||(this.endUpdateObject.suspendedProcs=[]),this.endUpdateObject.suspendedProcs.push(e)):e.apply(this)},_execAfterUpdateObjectProcs:function(){var e=this.endUpdateObject.suspendedProcs;if(e)for(;e.length;){var t=e.shift();t&&t.apply(this)}},_mergeObjUpdatedDetails:function(e,t){for(var r=0,i=t.length;r<i;++r)this._mergeObjUpdatedDetailItem(e,t[r])},_mergeObjUpdatedDetailItem:function(e,t){for(var r=0,i=e.length;r<i;++r){var o=e[r];if(o.obj===t.obj)return o.propNames||(o.propNames=[]),void(t.propNames&&Kekule.ArrayUtils.pushUnique(o.propNames,t.propNames))}e.push(t)},_logUpdatedDetail:function(e){var t="";e.forEach(function(e){t+="Obj: "+e.obj.getId()+"["+e.obj.getClassName()+"]     ",t+="Props: ["+e.propNames.join(", ")+"]",t+="\n"}),console.log(t)},objectChanged:function(e,t){var r={obj:e,propNames:t},i=this.objectsChanged(r);return this.invokeEvent("editObjChanged",Object.extend({},r)),i},objectsChanged:function(e){var r=DataType.isArrayValue(e)?e:[e];if(this.isUpdatingObject())this._mergeObjUpdatedDetails(this._updatedObjectDetails,r);else{var i=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(r);this.doObjectsChanged(r,i),this.requestAutoCheckIssuesIfNecessary(),this.invokeEvent("editObjsUpdated",{details:Object.extend({},e)})}this._objChanged=!0,this.invokeEvent("editObjsChanged",{details:Object.extend({},e)});var o=this.getSelection();if(o&&i){var n=t.intersect(o,i);n.length&&this.invokeEvent("selectedObjsUpdated",{objs:n})}},doObjectsChanged:function(e,t){var r=Kekule.ArrayUtils.clone(e);t||(t=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(r));var i=this._getAdditionalRenderRelatedObjs(t);if(i.length){var o=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(i);Kekule.ArrayUtils.pushUnique(r,o)}Kekule.ArrayUtils.pushUnique(t,i);var n=this._operatingRenderers,a=n&&this._isAllObjsRenderedByRenderers(this.getObjContext(),t,n);this.canModifyPartialGraphic()?(this.getRootRenderer().modify(this.getObjContext(),r),this.recalcUiMarkers()):a?this.repaintOperContext():this.repaint()},beginManipulateObject:function(){this._objectManipulateFlag>=0&&this.invokeEvent("beginManipulateObject"),--this._objectManipulateFlag},endManipulateObject:function(){++this._objectManipulateFlag,this.isManipulatingObject()||(this._objectManipulateFlag=0,this.doManipulationEnd(),this.requestAutoCheckIssuesIfNecessary())},isManipulatingObject:function(){return this._objectManipulateFlag<0},doManipulationEnd:function(){this.setOperationsInCurrManipulation([]),this.invokeEvent("endManipulateObject")},beginManipulateAndUpdateObject:function(){this.beginManipulateObject(),this.beginUpdateObject()},endManipulateAndUpdateObject:function(){this.endUpdateObject(),this.endManipulateObject()},_needToCanonicalizeBeforeSaving:function(){return!0},_getAdditionalRenderRelatedObjs:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r],n=o.getCoordDeterminateObjects?o.getCoordDeterminateObjects():[];Kekule.ArrayUtils.pushUnique(t,n)}return t},_isAllObjsRenderedByRenderers:function(e,t,r){for(var i=0,o=t.length;i<o;++i){for(var n=t[i],a=!1,s=0,l=r.length;s<l;++s){if(r[s].isChemObjRenderedBySelf(e,n)){a=!0;break}}if(!a)return!1}return!0},prepareOperatingObjs:function(e){this._operatingRenderers&&this._operatingRenderers.length&&this.endOperatingObjs(!0),this.getEnableOperContext()&&(this._prepareRenderObjsInOperContext(e),this._operatingObjs=e),this.repaint()},endOperatingObjs:function(e){this.getEnableOperContext()&&(this._endRenderObjsInOperContext(),this._operatingObjs=null,e||this.repaint())},_isChemObjDirectlyRenderedByRenderer:function(e,t,r){var i=t.getStandaloneAncestor?t.getStandaloneAncestor():t;return r.isChemObjRenderedDirectlyBySelf(e,i)},_getStandaloneRenderObjsInOperContext:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r];o.getStandaloneAncestor&&(o=o.getStandaloneAncestor()),Kekule.ArrayUtils.pushUnique(t,o)}return t},_prepareRenderObjsInOperContext:function(e){for(var t=[],r=this.getObjRendererMap().getValues(),i=this.getObjContext(),o=this._getStandaloneRenderObjsInOperContext(e),n=0,a=o.length;n<a;++n)for(var s=o[n],l=0,d=r.length;l<d;++l){(u=r[l]).isChemObjRenderedDirectlyBySelf(i,s)&&Kekule.ArrayUtils.pushUnique(t,u)}if(t.length>0){for(n=0,a=t.length;n<a;++n){var u=t[n];this._setRendererToOperContext(u)}this._operatingRenderers=t}else this._operatingRenderers=null},_endRenderObjsInOperContext:function(){var e=this._operatingRenderers;if(e&&e.length){for(var t=0,r=e.length;t<r;++t){var i=e[t];this._unsetRendererToOperContext(i)}this.clearOperContext()}this._operatingRenderers=null},_setRendererToOperContext:function(e){e.setRedirectContext(this.getOperContext())},_unsetRendererToOperContext:function(e){e.setRedirectContext(null)},getInteractionBoundInflation:function(e){var t=this._lengthCaches.interactionBoundInflations,r=e||"default";if(t&&t[r])return t[r];var i,o=this.getEditorConfigs().getInteractionConfigs(),n=o.getPropValue("objBoundTrackInflationRatio");if(e){var a=e.upperFirst(),s="objBoundTrackInflationRatio"+a;o.hasProperty(s)&&(i=o.getPropValue(s))}var l,d=i||n,u=d&&this.getDefBondScreenLength()*d,c=o.getPropValue("objBoundTrackMinInflation");if(e){var p="objBoundTrackMinInflation"+a;o.hasProperty(p)&&(l=o.getPropValue(p))}var h=l||c,g=Math.max(u||0,h);return t||(t={},this._lengthCaches.interactionBoundInflations=t),t[r]=g,g},getBoundInfosAtCoord:function(e,t,r){var i=r||this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation();return this.tryApplySuper("getBoundInfosAtCoord",[e,t,i])},getTopmostBoundInfoAtCoord:function(e,t,r){if(!this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest())return this.tryApplySuper("getTopmostBoundInfoAtCoord",[e,t,r]);for(var i,o,n,a=Kekule.Render.MetaShapeUtils,s=this.getBoundInfosAtCoord(e,null,r),l=function(t,r,s){i=t,o=r||t.boundInfo,n=Kekule.ObjUtils.notUnset(s)?s:a.getDistance(e,o)},d=s.length-1;d>=0;--d){var u=s[d];if(!(t&&t.indexOf(u.obj)>=0))if(i){var c=u.boundInfo;if(c.shapeType<o.shapeType)l(u,c);else if(c.shapeType===o.shapeType){var p=a.getDistance(e,c);p<n&&l(u,c,p)}}else l(u)}return i},getBasicObjectsAtCoord:function(e,r,i,o){var n=this.getBoundInfosAtCoord(e,null,r),a=[];if(n){i&&(n=t.filter(n,function(e){var t=n[d].obj;return!!t&&!(t&&i&&i.indexOf(t)>=0)}));var s=function(e){return e&&e.getCoordStickTarget&&e.getCoordStickTarget()?1:0};if(n.sort(function(e,t){return s(e.obj)-s(t.obj)}),this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest()){var l=Kekule.Render.MetaShapeUtils;n.sort(function(t,r){var i=0,o=t.boundInfo,n=r.boundInfo;(i=-(o.shapeType-n.shapeType))||(i=-(l.getDistance(e,o)-l.getDistance(e,n)));return i})}for(var d=n.length-1;d>=0;--d){var u=n[d].obj;u&&i&&i.indexOf(u)>=0||a.push(u)}a&&o&&(a=t.filter(a,function(e){for(var t=0,r=o.length;t<r;++t)if(e instanceof o[t])return!0;return!1}))}return a},getTopmostBasicObjectAtCoord:function(e,t,r){var i=this.getBasicObjectsAtCoord(e,t,null,r);return i&&i[0]},getChemObjBounds:function(e,t){var r=[],i=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),e);if(i&&i.length)for(var o=0,n=i.length;o<n;++o){var a=i[o].boundInfo;a&&(a=Kekule.Render.MetaShapeUtils.inflateShape(a,t),r.push(a))}return r},getUiMarkersAtCoord:function(e,t,r){for(var i=this.getUiMarkers(),o=r&&r.length?function(e){for(var t=0,i=r.length;t<i;++t)if(e instanceof r[t])return!0;return!1}:null,n=Kekule.Render.MetaShapeUtils,a=[],s=i.getMarkerCount()-1;s>=0;--s){var l=i.getMarkerAt(s);if(l.getVisible()&&(!o||o(l))){var d=l.shapeInfo;n.isCoordInside(e,d,t)&&a.push(l)}}return a},beginUpdateUiMarkers:function(){--this._uiMarkerUpdateFlag},endUpdateUiMarkers:function(){++this._uiMarkerUpdateFlag,this.isUpdatingUiMarkers()||this.repaintUiMarker()},isUpdatingUiMarkers:function(){return this._uiMarkerUpdateFlag<0},recalcUiMarkers:function(){if(this.getUiDrawBridge()){this.beginUpdateUiMarkers();try{this.recalcHotTrackMarker(),this.recalcSelectionAreaMarker(),this.recalcIssueCheckUiMarkers()}finally{this.endUpdateUiMarkers()}}},repaintUiMarker:function(){if(!this.isUpdatingUiMarkers()&&this.getUiDrawBridge()&&this.getUiContext()){this.clearUiContext();var e=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),e.baseCoord,e.drawOptions)}},createShapeBasedMarker:function(e,t,r,i){var o=new Kekule.ChemWidget.MetaShapeUIMarker;return t&&o.setShapeInfo(t),r&&o.setDrawStyles(r),this.setPropStoreFieldValue(e,o),this.getUiMarkers().addMarker(o),i&&this.repaintUiMarker(),o},modifyShapeBasedMarker:function(e,t,r,i){Kekule.Render.ObjectUpdateType.MODIFY;t&&e.setShapeInfo(t),r&&e.setDrawStyles(r),i&&this.repaintUiMarker()},hideUiMarker:function(e,t){e.setVisible(!1),t&&this.repaintUiMarker()},showUiMarker:function(e,t){e.setVisible(!0),t&&this.repaintUiMarker()},removeUiMarker:function(e){e&&(this.getUiMarkers().removeMarker(e),this.repaintUiMarker())},clearUiMarkers:function(){this.getUiMarkers().clearMarkers(),this.repaintUiMarker()},changeHotTrackMarkerBounds:function(e){for(var t=Kekule.ArrayUtils.toArray(e),r=this.getEditorConfigs().getUiMarkerConfigs(),i={color:r.getHotTrackerColor(),opacity:r.getHotTrackerOpacity()},o=this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation(),n=[],a=0,s=t.length;a<s;++a){var l=t[a],d=o?Kekule.Render.MetaShapeUtils.inflateShape(l,o):l;d&&n.push(d)}var u=this.getUiHotTrackMarker();return u.setVisible(!0),this.modifyShapeBasedMarker(u,n,i,!0),this},hideHotTrackMarker:function(){var e=this.getUiHotTrackMarker();return e&&this.hideUiMarker(e,!0),this},showHotTrackMarker:function(){var e=this.getUiHotTrackMarker();return e&&this.showUiMarker(e,!0),this},hotTrackOnCoord:function(e){return this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()&&this.setHotTrackedObj(this.getTopmostBasicObjectAtCoord(e,this.getCurrBoundInflation())),this},hotTrackOnObj:function(e){return this.setHotTrackedObj(e),this},hideHotTrack:function(e){return this.hideHotTrackMarker(),e||this.clearHotTrackedObjs(),this},clearHotTrackedObjs:function(){this.setHotTrackedObjs([])},addHotTrackedObj:function(e){var t=this.getHotTrackedObjs()||[];return Kekule.ArrayUtils.pushUnique(t,e),this.setHotTrackedObjs(t),this},recalcHotTrackMarker:function(){this.setHotTrackedObjs(this.getHotTrackedObjs())},updateHintForChemObject:function(e){var t=this.getEditClientElem();if(t){var r=e||"";r&&this.updateHintForChemObject._cache==r&&(r+="\f"),t.title=r,r&&(this.updateHintForChemObject._cache=r)}},getChemObjHint:function(e){return null},getChemObjsHint:function(e){for(var r=[],i=0,o=e.length;i<o;++i){var n=this.getChemObjHint(e[i]);n&&t.pushUnique(r,n)}var a=this._getChemObjsRelatedIssuesHints(e);return a.length&&t.pushUnique(r,a),r.length?r.join("\n"):null},_getChemObjsRelatedIssuesHints:function(e){var r=[];if(this.getEnableIssueMarkerHint()&&this.getEnableIssueCheck())for(var i=this.getObjectsRelatedIssueItems(e,!0)||[],o=0,n=i.length;o<n;++o){var a=i[o].getMessage();t.pushUnique(r,a)}return r},issueCheckResultsChanged:function(){this.recalcIssueCheckUiMarkers();var e=this.getActiveIssueCheckResult();if(e&&this.getEnableAutoScrollToActiveIssue()){var t=e.getTargets();if(t&&t.length){var r=this._getExposedSelfOrParentObjs(t);if(r&&r.length)this.getObjectsBoxAndClientBoxRelation(r)!==Kekule.IntersectionState.CONTAINED&&this.scrollClientToObject(r)}}},_needShowInactiveIssueMarkers:function(){return this.getEnableIssueCheck()&&this.getShowAllIssueMarkers()},recalcIssueCheckUiMarkers:function(){if(this.getChemObjLoaded()){this.beginUpdateUiMarkers();try{var e=this.getIssueCheckResults()||[];if(e.length&&this.getEnableIssueCheck()){var t=this._needShowInactiveIssueMarkers(),r=this.getActiveIssueCheckResult();this.getActiveIssueCheckUiMarker().setVisible(!!r);for(var i=this._groupUpIssueObjects(e,r,!0),o=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation(),n=Kekule.ErrorLevel.getAllLevels().concat("active"),a=0,s=n.length;a<s;++a){var l=[],d=n[a],u=i[d],c=u?u.level:d;if(u){var p="active"===d;if(p||t)for(var h=u.objs,g=0,C=h.length;g<C;++g)for(var _=h[g],m=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),_),f=0,S=m.length;f<S;++f){var y=m[f].boundInfo;y&&(y=Kekule.Render.MetaShapeUtils.inflateShape(y,o),l.push(y))}}this.changeIssueCheckUiMarkerBound(c,l,p)}}else this.hideIssueCheckUiMarkers()}finally{this.endUpdateUiMarkers()}}},changeIssueCheckUiMarkerBound:function(e,t,r){var i=r?this.getActiveIssueCheckUiMarker():this.getIssueCheckUiMarker(e);if(i)if(t&&t.length){var o=Kekule.ErrorLevel.levelToString(e),n=this.getEditorConfigs().getUiMarkerConfigs(),a=n.getIssueCheckMarkerColors()[o],s={strokeColor:r?a.activeStrokeColor:a.strokeColor,strokeWidth:r?n.getIssueCheckActiveMarkerStrokeWidth():n.getIssueCheckMarkerStrokeWidth(),fillColor:r?a.activeFillColor:a.fillColor,opacity:r?n.getIssueCheckActiveMarkerOpacity():n.getIssueCheckMarkerOpacity()};i.setVisible(!0),this.modifyShapeBasedMarker(i,t,s,!0)}else i.setVisible(!1);return this},_getExposedSelfOrParentObjs:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r];if(!o.isExposed||o.isExposed())t.push(o);else if(o.getExposedAncestor){var n=o.getExposedAncestor();n&&t.push(n)}}return t},_groupUpIssueObjects:function(e,r,i){for(var o={},n=0,a=e.length;n<a;++n){var s=e[n],l=s.getTargets(),d=s.getLevel();r&&s===r?o.active={level:d,objs:i?this._getExposedSelfOrParentObjs(l):l}:(o[d]||(o[d]={level:d,objs:[]}),o[d].objs=o[d].objs.concat(i?this._getExposedSelfOrParentObjs(l):l))}var u=Kekule.ErrorLevel,c=[u.LOG,u.NOTE,u.WARNING,u.ERROR,"active"];for(n=0,a=c.length;n<a;++n){var p=o[n]&&o[n].objs;if(p)for(var h=n+1,g=c.length;h<g;++h){var C=o[h]&&o[h].objs;if(C){var _=t.exclude(p,C);o[n].objs=_}}}return o},hideIssueCheckUiMarkers:function(){for(var e=this.getAllIssueCheckUiMarkers()||[],t=0,r=e.length;t<r;++t)this.hideUiMarker(e[t])},isObjectRelatedToIssue:function(e,t,r){if((t.getTargets()||[]).indexOf(e)>=0)return!0;if(r){var i=e.getParent();return!!i&&this.isObjectRelatedToIssue(i,t,r)}},getObjectIssueItems:function(e,t){var r=this.getIssueCheckResults()||[];if(r.length&&this.getEnableIssueCheck()){for(var i=[],o=0,n=r.length;o<n;++o){var a=r[o];this.isObjectRelatedToIssue(e,a,t)&&i.push(a)}return i}return[]},getObjectsRelatedIssueItems:function(e,r){if(!(this.getIssueCheckResults()||[]).length||!this.getEnableIssueCheck())return[];var i=[],o=[].concat(e);if(r)for(var n=0,a=e.length;n<a;++n)t.pushUnique(o,e[n].getParentList());for(n=0,a=o.length;n<a;++n){var s=this.getObjectIssueItems(o[n],!1);t.pushUnique(i,s)}return i},changeSelectionAreaMarkerBound:function(e,t){var r=this.getEditorConfigs().getUiMarkerConfigs();t||(t={strokeColor:r.getSelectionMarkerStrokeColor(),strokeWidth:r.getSelectionMarkerStrokeWidth(),fillColor:r.getSelectionMarkerFillColor(),opacity:r.getSelectionMarkerOpacity()});var i=this.getUiSelectionAreaMarker();return i&&(i.setVisible(!0),this.modifyShapeBasedMarker(i,e,t,!0)),this},hideSelectionAreaMarker:function(){var e=this.getUiSelectionAreaMarker();e&&this.hideUiMarker(e,!0)},showSelectionAreaMarker:function(){var e=this.getUiSelectionAreaMarker();e&&this.showUiMarker(e,!0)},recalcSelectionAreaMarker:function(e){this.beginUpdateUiMarkers();try{var t=this.getSelection(),r=t.length;if(r<=0)this.hideSelectionAreaMarker();else{for(var i=[],o=null,n=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation(),a=0;a<r;++a){var s=t[a],l=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),s);if(l&&l.length)for(var d=0,u=l.length;d<u;++d){var c=l[d].boundInfo;if(c){c=Kekule.Render.MetaShapeUtils.inflateShape(c,n),i.push(c);var p=Kekule.Render.MetaShapeUtils.getContainerBox(c);o=o?Kekule.BoxUtils.getContainerBox(o,p):p}}}if(this.setUiSelectionAreaContainerBox(o),o){var h=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:o.x1,y:o.y1},{x:o.x2,y:o.y2}]);i.push(h)}else this.hideSelectionAreaMarker();i.length&&this.changeSelectionAreaMarkerBound(i)}}finally{this.endUpdateUiMarkers()}},_highlightSelectionAreaMarker:function(){var e=this.getEditorConfigs().getUiMarkerConfigs(),t={strokeColor:e.getSelectionMarkerStrokeColor(),strokeWidth:e.getSelectionMarkerStrokeWidth(),fillColor:e.getSelectionMarkerFillColor(),opacity:e.getSelectionMarkerEmphasisOpacity()};this.changeSelectionAreaMarkerBound(null,t)},_restoreSelectionAreaMarker:function(){var e=this.getEditorConfigs().getUiMarkerConfigs(),t={strokeColor:e.getSelectionMarkerStrokeColor(),strokeWidth:e.getSelectionMarkerStrokeWidth(),fillColor:e.getSelectionMarkerFillColor(),opacity:e.getSelectionMarkerOpacity()};this.changeSelectionAreaMarkerBound(null,t)},pulseSelectionAreaMarker:function(e,t){if(this.getUiSelectionAreaMarker()){if(e||(e=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseDuration()||0),t||(t=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseCount()||1),!e)return;var r=e/t;this.doPulseSelectionAreaMarker(r,t)}return this},doPulseSelectionAreaMarker:function(e,t){this._highlightSelectionAreaMarker(),setTimeout(this._restoreSelectionAreaMarker.bind(this),e),t>1&&setTimeout(this.doPulseSelectionAreaMarker.bind(this,e,t-1),2*e)},startSelecting:function(e,t){void 0===t&&(t=this.getIsToggleSelectOn()),t||this.deselectAll();var r=Kekule.Editor.SelectMode,i=this.getSelectMode();return this._currSelectMode=i,i===r.POLYLINE||i===r.POLYGON?this.startSelectingCurveDrag(e,t):this.startSelectingBoxDrag(e,t)},addSelectingAnchorCoord:function(e){var t=Kekule.Editor.SelectMode,r=this._currSelectMode;return r===t.POLYLINE||r===t.POLYGON?this.dragSelectingCurveToCoord(e):this.dragSelectingBoxToCoord(e)},endSelecting:function(e,t){void 0===t&&(t=this.getIsToggleSelectOn());var r,i=Kekule.Editor.SelectMode,o=this._currSelectMode,n=this.getEditorConfigs().getInteractionConfigs().getEnablePartialAreaSelecting();if(o===i.POLYLINE||o===i.POLYGON){var a=this._selectingCurveCoords,s=this.getEditorConfigs().getInteractionConfigs().getSelectingCurveSimplificationDistanceThreshold(),l=Kekule.GeometryUtils.simplifyCurveToLineSegments(a,s);if(this.endSelectingCurveDrag(e,t),o===i.POLYLINE){var d=this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth();r=this.getObjectsIntersetExtendedPolyline(l,d)}else r=this.getObjectsInPolygon(l,n),this.endSelectingCurveDrag(e,t)}else{var u=this._selectingBoxStartCoord,c=Kekule.BoxUtils.createBox(u,e);r=this.getObjectsInScreenBox(c,n),this.endSelectingBoxDrag(e,t)}r=this._getActualSelectedObjsInSelecting(r),t?this.toggleSelectingState(r):this.select(r),this.hideSelectingMarker()},cancelSelecting:function(){this.hideSelectingMarker()},_getActualSelectedObjsInSelecting:function(e){return e&&e.length?(this._isInAncestorSelectMode()&&(e=this._getAllStandaloneAncestorObjs(e)),e):[]},_isInAncestorSelectMode:function(){return this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR},_getAllStandaloneAncestorObjs:function(e){for(var r=[],i=0,o=e.length;i<o;++i){var n=e[i];n&&n.getStandaloneAncestor&&(n=n.getStandaloneAncestor()),t.pushUnique(r,n)}return r},startSelectingBoxDrag:function(e,t){this._selectingBoxStartCoord=e},dragSelectingBoxToCoord:function(e){var t=this._selectingBoxStartCoord,r=e;this.changeSelectingMarkerBox(t,r)},endSelectingBoxDrag:function(e,t){this._selectingBoxStartCoord;this._selectingBoxEndCoord=e},startSelectingCurveDrag:function(e,t){this._selectingCurveCoords=[e]},dragSelectingCurveToCoord:function(e){this._selectingCurveCoords.push(e),this.changeSelectingMarkerCurve(this._selectingCurveCoords,this._currSelectMode===Kekule.Editor.SelectMode.POLYGON)},endSelectingCurveDrag:function(e,t){this._selectingCurveCoords.push(e)},selectOnCoord:function(e,t){void 0===t&&(t=this.getIsToggleSelectOn());var r=this.getTopmostBasicObjectAtCoord(e,this.getCurrBoundInflation());if(r){var i=this._getActualSelectedObjsInSelecting([r]);i&&(t?this.toggleSelectingState(i):this.select(i))}},changeSelectingMarkerBound:function(e,t){var r=this.getEditorConfigs().getUiMarkerConfigs();t||(t={strokeColor:r.getSelectingMarkerStrokeColor(),strokeWidth:r.getSelectingMarkerStrokeWidth(),strokeDash:r.getSelectingMarkerStrokeDash(),fillColor:r.getSelectingMarkerFillColor(),opacity:r.getSelectingMarkerOpacity()});var i=this.getUiSelectingMarker();return i.setVisible(!0),this.modifyShapeBasedMarker(i,e,t,!0),this},changeSelectingMarkerCurve:function(e,t){for(var r=[],i=0,o=e.length-1;i<o;++i)r.push(this.screenCoordToContext(e[i]));var n,a=Kekule.Render.MetaShapeUtils.createShapeInfo(t?Kekule.Render.MetaShapeType.POLYGON:Kekule.Render.MetaShapeType.POLYLINE,r);if(!t){var s=this.getEditorConfigs().getUiMarkerConfigs();n={strokeColor:s.getSelectingBrushMarkerStrokeColor(),strokeWidth:this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth(),strokeDash:s.getSelectingBrushMarkerStrokeDash(),lineCap:s.getSelectingBrushMarkerStrokeLineCap(),lineJoin:s.getSelectingBrushMarkerStrokeLineJoin(),opacity:s.getSelectingBrushMarkerOpacity()}}return this.changeSelectingMarkerBound(a,n)},changeSelectingMarkerBox:function(e,t){var r=this.screenCoordToContext(e),i=this.screenCoordToContext(t),o=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:Math.min(r.x,i.x),y:Math.min(r.y,i.y)},{x:Math.max(r.x,i.x),y:Math.max(r.y,i.y)}]);return this.changeSelectingMarkerBound(o)},hideSelectingMarker:function(){var e=this.getUiSelectingMarker();e&&this.hideUiMarker(e,!0)},showSelectingMarker:function(){var e=this.getUiSelectingMarker();e&&this.showUiMarker(e,!0)},getCoordRegionInSelectionMarker:function(e,t){var r=Kekule.Editor.BoxRegion,i=Kekule.CoordUtils,o=this.screenCoordToContext(e),n=this.getUiSelectionAreaMarker();if(n&&n.getVisible()){var a=this.getUiSelectionAreaContainerBox();Kekule.ObjUtils.isUnset(t)&&(t=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerEdgeInflation());var s=t/2||0,l=i.substract({x:a.x1,y:a.y1},{x:s,y:s}),d=i.add({x:a.x2,y:a.y2},{x:s,y:s});if(o.x<l.x||o.y<l.y||o.x>d.x||o.y>d.y)return r.OUTSIDE;var u=i.substract(o,l),c=i.substract(d,o),p=u.x,h=c.x,g=u.y,C=c.y;return g<C?p<h?g<=t?p<=t?r.CORNER_TL:r.EDGE_TOP:p<=t?r.EDGE_LEFT:r.INSIDE:g<=t?h<=t?r.CORNER_TR:r.EDGE_TOP:h<=t?r.EDGE_RIGHT:r.INSIDE:p<h?C<=t?p<=t?r.CORNER_BL:r.EDGE_BOTTOM:p<=t?r.EDGE_LEFT:r.INSIDE:C<=t?h<=t?r.CORNER_BR:r.EDGE_BOTTOM:h<=t?r.EDGE_RIGHT:r.INSIDE}return r.OUTSIDE},isCoordInSelectionMarkerBound:function(e){return this.getCoordRegionInSelectionMarker(e)!==Kekule.Editor.BoxRegion.OUTSIDE},getObjSelectedRenderOptions:function(){return this._selectedRenderOptions},_getObjRenderOptionItemAppendMethod:function(e){return this.getRenderType()===Kekule.Render.RendererType.R3D?e.addOverrideRender3DOptionItem:e.addOverrideRenderOptionItem},_getObjRenderOptionItemRemoveMethod:function(e){return this.getRenderType()===Kekule.Render.RendererType.R3D?e.removeOverrideRender3DOptionItem:e.removeOverrideRenderOptionItem},_addSelectRenderOptions:function(e){var t=this.getObjSelectedRenderOptions();return t?this._getObjRenderOptionItemAppendMethod(e).apply(e,[t]):null},_removeSelectRenderOptions:function(e){return this.getObjSelectedRenderOptions()?this._getObjRenderOptionItemRemoveMethod(e).apply(e,[this.getObjSelectedRenderOptions()]):null},beginUpdateSelection:function(){this.beginUpdateObject(),--this._objSelectFlag},endUpdateSelection:function(){++this._objSelectFlag,this._objSelectFlag>=0&&this.selectionChanged(),this.endUpdateObject()},isUpdatingSelection:function(){return this._objSelectFlag<0},selectionChanged:function(){if(!this.isUpdatingSelection())return this.notifyPropSet("selection",this.getSelection()),this.invokeEvent("selectionChange"),this.doSelectionChanged()},doSelectionChanged:function(){this.recalcSelectionAreaMarker()},isInSelection:function(e){return!!e&&this.getSelection().indexOf(e)>=0},addObjToSelection:function(e){if(!e)return this;var t=this.getSelection();return Kekule.ArrayUtils.pushUnique(t,e.getNearestSelectableObject()),this._addSelectRenderOptions(e),this.selectionChanged(),this},removeObjFromSelection:function(e,t){if(!e)return this;var r=this.getSelection(),i=e.getNearestSelectableObject&&e.getNearestSelectableObject();Kekule.ArrayUtils.remove(r,e),this._removeSelectRenderOptions(e),i&&(Kekule.ArrayUtils.remove(r,i),this._removeSelectRenderOptions(i));for(var o=r.length-1;o>=0;--o){var n=r[o];n.isChildOf&&(n.isChildOf(e)||i&&n.isChildOf(i))&&this.removeObjFromSelection(n,!0)}return t||this.selectionChanged(),this},selectAll:function(){var e=[],t=this.getChemObj();if(t){var r=t.getChildren()||[];e=r.length?r:[t]}return this.select(e)},deselectAll:function(){var e=this.getSelection();return this.removeFromSelection(e)},select:function(e){this.beginUpdateSelection();try{this.deselectAll(),this.addToSelection(e)}finally{this.endUpdateSelection()}return this},addToSelection:function(e){if(e){var t=DataType.isArrayValue(e)?e:[e];this.beginUpdateSelection();try{for(var r=0,i=t.length;r<i;++r)this.addObjToSelection(t[r])}finally{this.endUpdateSelection()}return this}},removeFromSelection:function(e){if(e&&e.length){var t=DataType.isArrayValue(e)?e:[e];this.beginUpdateSelection();try{for(var r=t.length-1;r>=0;--r)this.removeObjFromSelection(t[r])}finally{this.endUpdateSelection()}return this}},toggleSelectingState:function(e){if(e){var t=DataType.isArrayValue(e)?e:[e];this.beginUpdateSelection();try{for(var r=0,i=t.length;r<i;++r){var o=t[r],n=o.getNearestSelectableObject&&o.getNearestSelectableObject();this.isInSelection(o)?this.removeObjFromSelection(o):n&&this.isInSelection(n)?this.removeObjFromSelection(n):this.addObjToSelection(o)}}finally{this.endUpdateSelection()}return this}},hasSelection:function(){return!!this.getSelection().length},deleteSelectedObjs:function(){},requestAutoCheckIssuesIfNecessary:function(){this.getEnableAutoIssueCheck()&&this._tryCheckIssueOnIdle()},_tryCheckIssueOnIdle:function(){return this.isUpdatingObject()||this.isManipulatingObject()?null:this.checkIssues()},createIssueCheckExecutor:function(){return new Kekule.IssueCheck.ExecutorForEditor(this)},checkIssues:function(e){var t=null,r=e||this.getChemObj();r&&this.getEnableIssueCheck()&&(t=this.getIssueCheckExecutor(!0).execute(r));return t},getObjectsIntersetExtendedPolyline:function(e,t){for(var r=[],i=0,o=e.length;i<o;++i)r.push(this.screenCoordToContext(e[i]));var n=[],a=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),s=Kekule.Render.MetaShapeUtils.isIntersectingPolyline;for(i=0,o=a.length;i<o;++i){var l=a[i],d=l.boundInfo;d&&s(d,r,t)&&n.push(l.obj)}return n},getObjectsInPolygon:function(e,t){for(var r=[],i=0,o=e.length;i<o;++i)r.push(this.screenCoordToContext(e[i]));var n=[],a=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),s=t?Kekule.Render.MetaShapeUtils.isIntersectingPolygon:Kekule.Render.MetaShapeUtils.isInsidePolygon;for(i=0,o=a.length;i<o;++i){var l=a[i],d=l.boundInfo;d&&s(d,r)&&n.push(l.obj)}return n},getObjectsInScreenBox:function(e,t){for(var r=this.screenBoxToContext(e),i=[],o=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),n=t?Kekule.Render.MetaShapeUtils.isIntersectingBox:Kekule.Render.MetaShapeUtils.isInsideBox,a=0,s=o.length;a<s;++a){var l=o[a],d=l.boundInfo;d&&n(d,r)&&i.push(l.obj)}return i},selectObjectsInScreenBox:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.select(r),r},addObjectsInScreenBoxToSelection:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.addToSelection(r),r},removeObjectsInScreenBoxFromSelection:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.removeFromSelection(r),r},toggleSelectingStateOfObjectsInScreenBox:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.toggleSelectingState(r),r},getObjectsContainerBox:function(e,t){for(var r=Kekule.ArrayUtils.toArray(e),i=t||0,o=null,n=0,a=r.length;n<a;++n){var s=r[n],l=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),s);if(l&&l.length)for(var d=0,u=l.length;d<u;++d){var c=l[d].boundInfo;if(c){i&&(c=Kekule.Render.MetaShapeUtils.inflateShape(c,i));var p=Kekule.Render.MetaShapeUtils.getContainerBox(c);o=o?Kekule.BoxUtils.getContainerBox(o,p):p}}}return o},getObjectsBoxAndClientBoxRelation:function(e){var t=this.getObjectsContainerBox(e);if(t){var r=this.getVisibleClientScreenBox();return Kekule.BoxUtils.getIntersectionState(t,r)}},getSelectionContainerBox:function(e){return this.getObjectsContainerBox(this.getSelection(),e)},isSelectionVisible:function(){var e=this.getSelectionContainerBox();if(e){var t=this.getVisibleClientScreenBox();return Kekule.BoxUtils.hasIntersection(e,t)}return!1},getObjSize:function(e){return this.doGetObjSize(e)},doGetObjSize:function(e){var t=this.getCoordMode();return e.getSizeOfMode?e.getSizeOfMode(t):null},setObjSize:function(e,t){this.doSetObjSize(e,t),this.objectChanged(e)},doSetObjSize:function(e,t){e.setSizeOfMode&&e.setSizeOfMode(t,this.getCoordMode())},getObjCoord:function(e,t){return this.doGetObjCoord(e,t)},doGetObjCoord:function(e,t){if(!e)return null;var r=this.getCoordMode(),i=this.getAllowCoordBorrow(),o=e.getAbsBaseCoord?e.getAbsBaseCoord(r,i):e.getAbsCoordOfMode?e.getAbsCoordOfMode(r,i):e.getCoordOfMode?e.getCoordOfMode(r,i):null;if(r===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(t)&&t!==Kekule.Render.CoordPos.DEFAULT){i=this.getAllowCoordBorrow();var n=e.getExposedContainerBox?e.getExposedContainerBox(r,i):e.getContainerBox?e.getContainerBox(r,i):null;if(n&&t===Kekule.Render.CoordPos.CORNER_TL){var a={x:(n.x2-n.x1)/2,y:(n.y2-n.y1)/2};o.x=o.x-a.x,o.y=o.y+a.y}}return o},setObjCoord:function(e,t,r){this.doSetObjCoord(e,t,r),this.objectChanged(e)},doSetObjCoord:function(e,t,r){var i=Object.create(t),o=this.getCoordMode();if(o===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(r)&&r!==Kekule.Render.CoordPos.DEFAULT){var n=this.getAllowCoordBorrow(),a=e.getExposedContainerBox?e.getExposedContainerBox(o,n):e.getContainerBox?e.getContainerBox(o,n):null;if(a){var s={x:(a.x2-a.x1)/2,y:(a.y2-a.y1)/2};r===Kekule.Render.CoordPos.CORNER_TL&&(i.x=t.x+s.x,i.y=t.y-s.y)}}e.setAbsBaseCoord?e.setAbsBaseCoord(i,o):e.setAbsCoordOfMode?e.setAbsCoordOfMode(i,o):e.setAbsCoordOfMode&&e.setCoordOfMode(i,o)},getObjectContextCoord:function(e,t){var r=this.getObjCoord(e,t);return this.objCoordToContext(r)},setObjectContextCoord:function(e,t,r){var i=this.contextCoordToObj(t);i&&this.setObjCoord(e,i,r)},getObjectScreenCoord:function(e,t){var r=this.getObjCoord(e,t);return this.objCoordToScreen(r)},setObjectScreenCoord:function(e,t,r){var i=this.screenCoordToObj(t);i&&this.setObjCoord(e,i,r)},getCoord:function(e,t,r){var i=this.getObjCoord(e,r);return this.translateCoord(i,Kekule.Editor.CoordSys.OBJ,t)},setCoord:function(e,t,r,i){var o=this.translateCoord(t,r,Kekule.Editor.CoordSys.OBJ);this.setObjCoord(e,o,i)},getSize:function(e,t){var r=this.getObjSize(e);return this.translateCoord(r,Kekule.Editor.CoordSys.OBJ,t)},setSize:function(e,t,r){var i=this.translateCoord(t,r,Kekule.Editor.CoordSys.OBJ);this.setObjSize(e,i)},transformCoordAndSizeOfObjects:function(e,t){var r=this.getCoordMode(),i=this.getAllowCoordBorrow(),o=r===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(t):Kekule.CoordUtils.calcTransform2DMatrix(t),n=Object.extend({},t);n=Object.extend(n,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});for(var a=r===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(n):Kekule.CoordUtils.calcTransform2DMatrix(n),s=0,l=e.length;s<l;++s){var d=e[s];d.transformAbsCoordByMatrix(o,a,r,!0,i),d.scaleSize(t.scale,r,!0,i)}},createDefaultNode:function(e,t,r){var i=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId(),o=new Kekule.Atom;return o.setIsotopeId(i),r&&r.appendNode(o),this.setCoord(o,e,t),o},operationDone:function(e){this.doOperationDone(e)},doOperationDone:function(e){},clearOperHistory:function(){var e=this.getOperHistory();e&&e.clear()},pushOperation:function(e,t){if(e){var r=this.getOperHistory();if(r&&r.push(e),this.getOperationsInCurrManipulation().push(e),t){this.beginUpdateObject();try{e.execute()}finally{this.endUpdateObject()}}}},popOperation:function(e){var t,r=this.getOperHistory();if(r){if(t=r.pop(),e){this.beginUpdateObject();try{t.reverse()}finally{this.endUpdateObject()}}var i=this.getOperationsInCurrManipulation(),o=i.indexOf(t);return o>=0&&i.splice(o,1),t}return null},execOperation:function(e){var r=t.toArray(e);this.beginManipulateAndUpdateObject();try{for(var i=0,o=r.length;i<o;++i){var n=r[i];n.execute(),this.getEnableOperHistory()&&this.pushOperation(n,!1)}}finally{this.endManipulateAndUpdateObject()}return this},execOperations:function(e){if(1===e.length)return this.execOperation(e[0]);var t=new Kekule.MacroOperation(e);return this.execOperation(t)},replaceOperationInHistory:function(e,t){var r=this.getOperHistory();return r&&r.replaceOperation(e,t)},undo:function(){var e,t=this.getOperHistory();if(t){this.beginUpdateObject();try{e=t.undo()}finally{this.endUpdateObject(),e&&this.operationDone(e)}}return e},redo:function(){var e,t=this.getOperHistory();if(t){this.beginUpdateObject();try{e=t.redo()}finally{this.endUpdateObject(),e&&this.operationDone(e)}}return e},undoAll:function(){var e,t=this.getOperHistory();if(t){this.beginUpdateObject();try{e=t.undoAll()}finally{this.endUpdateObject()}}return e},canUndo:function(){var e=this.getOperHistory();return!!e&&e.canUndo()},canRedo:function(){var e=this.getOperHistory();return!!e&&e.canRedo()},modifyObjects:function(e,t,r){var i=Kekule.ArrayUtils.toArray(e);try{for(var o=new Kekule.MacroOperation,n=0,a=i.length;n<a;++n){var s=i[n],l=new Kekule.ChemObjOperation.Modify(s,t,this);o.add(l)}o.execute()}finally{r&&this.getEnableOperHistory()&&o.getChildCount()&&this.pushOperation(o)}return this},modifyObjectsRenderOptions:function(e,t,r,i){var o=Kekule.ArrayUtils.toArray(e),n=r?"render3DOptions":"renderOptions",a=r?"getRender3DOptions":"getRenderOptions";try{for(var s=new Kekule.MacroOperation,l=0,d=o.length;l<d;++l){var u=o[l];if(u[a]){var c=u[a](),p=Object.extend({},c);p=Object.extend(p,t);var h={};h[n]=p;var g=new Kekule.ChemObjOperation.Modify(u,h,this);s.add(g)}}this.beginManipulateAndUpdateObject(),s.execute()}finally{i&&this.getEnableOperHistory()&&s.getChildCount()&&this.pushOperation(s),this.endManipulateAndUpdateObject()}return this},getClientDimension:function(){var e=this.getElement();return{width:e.clientWidth,height:e.clientHeight}},getClientScrollPosition:function(){var e=this.getEditClientElem().parentNode;return e?{x:e.scrollLeft,y:e.scrollTop}:null},getClientScrollCoord:function(t){var r=this.getClientScrollPosition();return e.isUnset(t)||t===Kekule.Editor.CoordSys.SCREEN?r:this.translateCoord(r,Kekule.Editor.CoordSys.SCREEN,t)},getClientVisibleRect:function(){var e=this.getClientDimension(),t=this.getClientScrollPosition();return e.x1=e.left=t.x,e.y1=e.top=t.y,e.x2=e.x1+e.width,e.y2=e.y1+e.height,e},scrollClientTo:function(e,t){return this.scrollClientToCoord({y:e,x:t})},scrollClientToTop:function(){return this.scrollClientTo(0,null)},scrollClientToBottom:function(){var e=this.getEditClientElem(),t=Kekule.HtmlElementUtils.getElemClientDimension(e);return this.scrollClientTo(t.height,null)},scrollClientToCoord:function(t,r,i){var o,n=e.notUnset(t.x),a=e.notUnset(t.y),s=i&&i.scrollToCenter;if(o=e.isUnset(r)?t:this.translateCoord(t,r,Kekule.Editor.CoordSys.SCREEN),s){var l=this.getVisibleClientScreenBox(),d={x:l.width/2,y:l.height/2};o=Kekule.CoordUtils.substract(o,d)}var u=this.getEditClientElem().parentNode;return a&&(u.scrollTop=o.y),n&&(u.scrollLeft=o.x),this},scrollClientToObject:function(e,r){Kekule.BoxUtils;if(!e)return this;var i=this.getChemObj();if(!i)return this;var o=t.toArray(e),n=this._getTargetObjsExposedContainerBoxInfo(o,i),a=n.totalBox,s=n.boxes;if(a){var l=Object.extend({scrollToCenter:!0,coverMostObjs:!0},r||{});return this._scrollClientToContainerBox(a,s,l)}return this},_scrollClientToContainerBox:function(e,t,r){var i,o=Kekule.BoxUtils,n=this.getVisibleClientBoxOfSys(Kekule.Editor.CoordSys.CHEM);i=(e.x2-e.x1>n.x2-n.x1||e.y2-e.y1>n.y2-n.y1)&&r.coverMostObjs?this._getMostIntersectedContainerBox(n.x2-n.x1,n.y2-n.y1,t,e):e;var a=r.scrollToCenter?o.getCenterCoord(i):{x:i.x1,y:i.y2};return this.scrollClientToCoord(a,Kekule.Editor.CoordSys.CHEM,r)},_getTargetObjsExposedContainerBoxInfo:function(e,t){var r=Kekule.BoxUtils;if(t||(t=this.getChemObj()),t)for(var i=null,o=[],n=0,a=e.length;n<a;++n){var s=e[n];if(s.getExposedContainerBox&&s.isChildOf&&s.isChildOf(t)){var l=s.getExposedContainerBox(this.getCoordMode());l&&(o.push(l),i=i?r.getContainerBox(i,l):l)}}return{totalBox:i,boxes:o}},_getMostIntersectedContainerBox:function(e,t,r,o){for(var n,a=Kekule.BoxUtils,s=function(r,n){var s=i.add(r,{x:e*n.x,y:t*n.y});s.x<o.x1?s.x=o.x1:s.x>o.x2&&(s.x=o.x2),s.y<o.y1?s.y=o.y1:s.y>o.y2&&(s.y=o.y2);var l=i.add(s,{x:-e*n.x,y:-t*n.y});return a.createBox(l,s)},l=function(e,t){for(var r=0,i=0,o=t.length;i<o;++i){var n=t[i];a.hasIntersection(n,e)&&++r}return r},d=0,u=0,c=r.length;u<c;++u)for(var p=a.getCornerCoords(r[u]),h=[s(p[0],{x:1,y:1}),s(p[1],{x:1,y:-1}),s(p[2],{x:-1,y:1}),s(p[3],{x:-1,y:-1})],g=0,C=h.length;g<C;++g){var _=l(h[g],r);_>d&&(d=_,n=h[g])}return n},doBeforeDispatchUiEvent:function(e){var r=e.getType();if(["pointerdown","pointermove","pointerup"].indexOf(r)>=0&&(this.setCurrPointerType(e.pointerType),"pointermove"===r&&this.isRenderable())){var i=this._getEventMouseCoord(e,this.getCoreElement()),o=this.getBasicObjectsAtCoord(i,this.getCurrBoundInflation())||[],n=this.getHoveredBasicObjs();this.setPropStoreFieldValue("hoveredBasicObjs",o),n&&o.length===n.length&&t.intersect(n,o).length===o.length||this.notifyHoverOnObjs(o)}return this.tryApplySuper("doBeforeDispatchUiEvent",[e])},notifyHoverOnObjs:function(e){var t=this.getChemObjsHint(e);this.updateHintForChemObject(t),this.invokeEvent("hoverOnObjs",{objs:e})},reactHotKeys:function(e){if(this.getEditorConfigs().getInteractionConfigs().getEnableHotKey()){for(var t=this.getEditorConfigs().getHotKeyConfigs().getHotKeys(),r=Kekule.Widget.KeyboardUtils.getKeyParamsFromEvent(e),i=!1,o=[],n=t.length-1;n>=0;--n){var a=Kekule.Widget.KeyboardUtils.shortcutLabelToKeyParams(t[n].key,null,!1);if(a.repeat=t[n].repeat,Kekule.Widget.KeyboardUtils.matchKeyParams(r,a,!1)){var s=t[n].action;if(s){var l=this.getChildAction(s,!0);if(l)if(l instanceof Kekule.Editor.ActionOperationCreate.Base){var d=l.createOperations(this);(i=!(!d||!d.length)||i)&&(o=o.concat(d))}else i=l.execute(this,e)||i}}}if(o.length&&this.execOperations(o),i)return e.stopPropagation(),e.preventDefault(),!0}},react_keydown:function(e){if(!this.tryApplySuper("react_keydown",[e]))return this.reactHotKeys(e)}}),Kekule.Editor.BaseEditor.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.Editor.BaseEditor.Settings",initProperties:function(){this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableCreateNewDoc()},setter:function(e){this.getEditor().setEnableCreateNewDoc(e)}}),this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getInitOnNewDoc()},setter:function(e){this.getEditor().setInitOnNewDoc(e)}}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableOperHistory()},setter:function(e){this.getEditor().setEnableOperHistory(e)}}),this.defineProp("enableIssueCheck",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableIssueCheck()},setter:function(e){this.getEditor().setEnableIssueCheck(e)}})},getEditor:function(){return this.getDisplayer()}}),Kekule.Editor.IaControllerManager={_controllerMap:new Kekule.MapEx(!0),register:function(e,t){a._controllerMap.set(e,t)},unregister:function(e){a._controllerMap.remove(e)},getAllControllerClasses:function(){return a._controllerMap.getKeys()},getAvailableControllerClasses:function(e){for(var t=[],r=a.getAllControllerClasses(),i=0,o=r.length;i<o;++i){var n=r[i],s=a._controllerMap.get(n);s&&!ClassEx.isOrIsDescendantOf(e,s)||t.push(n)}return t}};var a=Kekule.Editor.IaControllerManager;Kekule.Editor.BaseEditorBaseIaController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},_defineEditorConfigBasedProperty:function(e,t,r){var i={dataType:DataType.VARIANT,serializable:!1,setter:null};r&&r.overwrite?(i.getter=function(){var r=this.getPropStoreFieldValue(e),i=this.getEditorConfigs();return r&&i.getCascadePropValue(t)},i.setter=function(t){this.setPropStoreFieldValue(e,t)}):i.getter=function(){return this.getEditorConfigs().getCascadePropValue(t)};var o=Object.extend(i,r||{});this.defineProp(e,o)},getDefId:function(){return Kekule.ClassUtils.getLastClassName(this.getClassName())},getEditor:function(){return this.getWidget()},setEditor:function(e){return this.setWidget(e)},getEditorConfigs:function(){var e=this.getEditor();return e?e.getEditorConfigs():null}}),Kekule.Editor.BaseEditorIaController=Class.create(Kekule.Editor.BaseEditorBaseIaController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("manuallyHotTrack",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:!1,getter:function(){return this.getEditor().getCurrBoundInflation()},setter:null}),this.defineProp("activePointerType",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getEditor();return e&&e.getCurrPointerType()||this.getPropStoreFieldValue("activePointerType")},setter:function(e){var t=this.getEditor();t?t.setCurrPointerType(e):this.setStoreFieldValue("activePointerType",e)}})},notifyEditorBeginManipulateObjects:function(){this.getEditor().beginManipulateObject()},notifyEditorEndManipulateObjects:function(){this.getEditor().endManipulateObject()},getInteractionBoundInflation:function(e){return this.getEditor().getInteractionBoundInflation(e)},handleUiEvent:function(e){var t=!1,r=e.getTarget&&e.getTarget()||e.target,i=this.getEditor().getUiEventReceiverElem();i?(r===i||Kekule.DomUtils.isDescendantOf(r,i))&&(t=!0):t=!0,t&&this.tryApplySuper("handleUiEvent",[e])},canInteractWithObj:function(e){return!!e},getInteractableTargetClasses:function(){return null},getAllInteractableObjsAtScreenCoord:function(e){return this.getEditor().getBasicObjectsAtCoord(e,this.getCurrBoundInflation(),null,this.getInteractableTargetClasses())},getTopmostInteractableObjAtScreenCoord:function(e){var t=this.getAllInteractableObjsAtScreenCoord(e);if(t)for(var r=0,i=t.length;r<i;++r)if(this.canInteractWithObj(t[r]))return t[r];return null},getTopmostInteractableObjAtCurrPointerPos:function(){var e=this.getEditor().getHoveredBasicObjs();if(e)for(var t=0,r=e.length;t<r;++t)if(this.canInteractWithObj(e[t]))return e[t];return null},hotTrackOnObj:function(e){this.getEditor().hotTrackOnObj(e)},zoomEditor:function(e,t){e>0?this.getEditor().zoomIn(e,t):e<0&&this.getEditor().zoomOut(-e,t)},_filterBasicObjectsInEditor:function(e){for(var t=this.getEditor().getChemObj(),r=[],i=0,o=e.length;i<o;++i){var n=e[i];n.isChildOf(t)&&r.push(n)}return r},doneInsertOrModifyBasicObjects:function(e){if(this.needAutoSelectNewlyInsertedObjects()){var t=this._filterBasicObjectsInEditor(e);this.getEditor().select(t)}},needAutoSelectNewlyInsertedObjects:function(){var e=this.getActivePointerType(),t=this.getEditorConfigs().getInteractionConfigs();return t.getAutoSelectNewlyInsertedObjectsOnTouch()&&"touch"===e||t.getAutoSelectNewlyInsertedObjects()},react_pointerdown:function(e){return this.setActivePointerType(e.pointerType),e.preventDefault(),!0},react_pointermove:function(e){var t=this.getTopmostInteractableObjAtCurrPointerPos();return this.getManuallyHotTrack()||(t?this.hotTrackOnObj(t):this.hotTrackOnObj(null)),e.preventDefault(),!0},react_mousewheel:function(e){if(e.getCtrlKey()){var t=this._getEventMouseCoord(e);try{var r=e.wheelDeltaY||e.wheelDelta;r&&(r/=120),this.zoomEditor(r,t)}finally{}return e.preventDefault(),!0}},_getEventMouseCoord:function(e,t){var r=t||this.getWidget().getCoreElement();return this.tryApplySuper("_getEventMouseCoord",[e,r])}}),Kekule.Editor.ClientDragScrollIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ClientDragScrollIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._isExecuting=!1},canInteractWithObj:function(e){return!1},doTestMouseCursor:function(e,t){return this.isExecuting()?["grabbing","-webkit-grabbing","-moz-grabbing","move"]:["grab","-webkit-grab","-moz-grab","pointer"]},isExecuting:function(){return this._isExecuting},startScroll:function(e){this._startCoord=e,this._originalScrollPos=this.getEditor().getClientScrollPosition(),this._isExecuting=!0},endScroll:function(){this._isExecuting=!1,this._startCoord=null,this._originalScrollPos=null},scrollTo:function(e){if(this.isExecuting()){var t=this._startCoord,r=Kekule.CoordUtils.substract(t,e),i=Kekule.CoordUtils.add(this._originalScrollPos,r);this.getEditor().scrollClientTo(i.y,i.x)}},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===Kekule.X.Event.MouseButton.LEFT){if(!this.isExecuting()){var t={x:e.getScreenX(),y:e.getScreenY()};this.startScroll(t),e.preventDefault()}}else e.getButton()===Kekule.X.Event.MouseButton.RIGHT&&this.isExecuting()&&(this.endScroll(),e.preventDefault())},react_pointerup:function(e){e.getButton()===Kekule.X.Event.MouseButton.LEFT&&this.isExecuting()&&(this.endScroll(),e.preventDefault())},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this.isExecuting()){var t={x:e.getScreenX(),y:e.getScreenY()};this.scrollTo(t),e.preventDefault()}return!0}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.ClientDragScrollIaController,Kekule.Editor.BaseEditor),Kekule.Editor.BasicEraserIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicEraserIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._isExecuting=!1},canInteractWithObj:function(e){return!!e},removeObjs:function(e){if(e&&e.length){var t=this.getEditor();t.beginUpdateObject();try{var r=this.doGetActualRemovedObjs(e);this.doRemoveObjs(r)}finally{t.endUpdateObject()}}},doRemoveObjs:function(e){},doGetActualRemovedObjs:function(e){return e},removeSelection:function(){var e=this.getEditor();this.removeObjs(e.getSelection()),e.deselectAll()},removeOnScreenCoord:function(e){var t=this.getEditor().getTopmostBasicObjectAtCoord(e);return!!t&&(this.removeObjs([t]),!0)},startRemove:function(){this._isExecuting=!0},endRemove:function(){this._isExecuting=!1},isRemoving:function(){return this._isExecuting},reactUiEvent:function(e){var t=this.tryApplySuper("reactUiEvent",[e]),r=e.getType();return["touchstart","touchend","touchcancel","touchmove"].indexOf(r)>=0&&e.preventDefault(),t},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.startRemove();var t=this._getEventMouseCoord(e);this.removeOnScreenCoord(t),e.preventDefault()}else e.getButton()===Kekule.X.Event.MOUSE_BTN_RIGHT&&(this.endRemove(),e.preventDefault())},react_pointerup:function(e){e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT&&(this.endRemove(),e.preventDefault())},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this.isRemoving()){var t=this._getEventMouseCoord(e);this.removeOnScreenCoord(t),e.preventDefault()}return!0}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicEraserIaController,Kekule.Editor.BaseEditor),Kekule.Editor.BasicManipulationIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicManipulationIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),this._suppressConstrainedResize=!1,this._manipulationStepBuffer={},this._suspendedOperations=null,this.execManipulationStepBind=this.execManipulationStep.bind(this)},initProperties:function(){this.defineProp("selectMode",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableSelect",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableRotate",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableGestureManipulation",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("state",{dataType:DataType.INT,serializable:!1}),this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("startCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("endCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("startBox",{dataType:DataType.HASH,serializable:!1}),this.defineProp("endBox",{dataType:DataType.HASH,serializable:!1}),this.defineProp("lastRotateAngle",{dataType:DataType.FLOAT,serializable:!1}),this.defineProp("rotateRefCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("rotateCenter",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("rotateCenter");if(!e){var t=this._getManipulateObjsCenterCoord();e=this.getEditor().objCoordToScreen(t),this.setPropStoreFieldValue("rotateCenter",e)}return e}}),this.defineProp("resizeStartingRegion",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableAspectRatioLockedResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("rotateStartingRegion",{dataType:DataType.INT,serializable:!1}),this.defineProp("manipulateOriginObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("manipulateObjs",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("manipulateObjs",e),e?this.getEditor().prepareOperatingObjs(e):this.getEditor().endOperatingObjs()}}),this.defineProp("manipulateObjInfoMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("manipulateObjInfoMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("manipulateObjInfoMap",e)),e}}),this.defineProp("manipulateObjCurrInfoMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("manipulateObjCurrInfoMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("manipulateObjCurrInfoMap",e)),e}}),this.defineProp("manipulationType",{dataType:DataType.INT,serializable:!1}),this.defineProp("isManipulatingSelection",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("isOffsetManipulating",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("manipulationPointerType",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getActivePointerType()},setter:function(e){this.setActivePointerType(e)}}),this.defineProp("activePointerId",{dataType:DataType.INT,serializable:!1}),this.defineProp("moveOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("moveWrapperOperation",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("objOperationMap",{dataType:"Kekule.MapEx",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("objOperationMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("objOperationMap",e)),e}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!1),this.setEnableGestureManipulation(!1);var e=Kekule.globalOptions.get("chemWidget.editor")||{},t=Kekule.oneOf;this.setEnableMove(t(e.enableMove,!0)),this.setEnableResize(t(e.enableResize,!0)),this.setEnableAspectRatioLockedResize(t(e.enableAspectRatioLockedResize,!0)),this.setEnableRotate(t(e.enableRotate,!0))},doFinalize:function(){var e=this.getPropStoreFieldValue("manipulateObjInfoMap");e&&e.clear(),(e=this.getPropStoreFieldValue("objOperationMap"))&&e.clear(),this.tryApplySuper("doFinalize")},hotTrackOnObj:function(e){if(this.getEnableSelect()&&this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR){var t=this.getStandaloneAncestor(e);return e&&e.getStandaloneAncestor&&e.getStandaloneAncestor(),this.tryApplySuper("hotTrackOnObj",[t])}return this.tryApplySuper("hotTrackOnObj",[e])},getStandaloneAncestor:function(e){return e&&e.getStandaloneAncestor?e.getStandaloneAncestor():e},isInAncestorSelectMode:function(){return this.getEnableSelect()&&this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR},isAspectRatioLockedResize:function(){return this.getEnableAspectRatioLockedResize()&&!this._suppressConstrainedResize},getCoordOnSelectionRotationRegion:function(e){var t=Kekule.Editor.BoxRegion,r=this.getEditor();if(r.getCoordRegionInSelectionMarker(e)!==t.OUTSIDE)return!1;var i=r.getEditorConfigs().getInteractionConfigs().getRotationRegionInflation(),o=r.getUiSelectionAreaContainerBox();if(o&&r.hasSelection()){for(var n=[t.CORNER_TL,t.CORNER_TR,t.CORNER_BR,t.CORNER_BL],a=[{x:o.x1,y:o.y1},{x:o.x2,y:o.y1},{x:o.x2,y:o.y2},{x:o.x1,y:o.y2}],s=!1,l=i,d=0,u=n.length;d<u;++d){var c=n[d],p=a[d],h=Kekule.CoordUtils.getDistance(p,e);h<=l&&(s=c,l=h)}return s}return!1},createManipulateOperation:function(){return this.doCreateManipulateMoveAndResizeOperation()},doCreateManipulateMoveAndResizeOperation:function(){var e=[];this.setMoveOperations(e);var t=this.getManipulateObjs(),r=this.getManipulateObjInfoMap();this.getObjOperationMap().clear();var i=new Kekule.ChemObjOperation.MoveAndResizeObjs([],[],this.getEditor().getCoordMode(),!0,this.getEditor());i.setDisableIndirectCoord(!0);for(var o=0,n=t.length;o<n;++o){var a=t[o],s=r.get(a),l=new Kekule.ChemObjOperation.MoveAndResize(a,null,null,this.getEditor().getCoordMode(),!0,this.getEditor());l.setAllowCoordBorrow(this.getEditor().getAllowCoordBorrow()),l.setOldCoord(s.objCoord),l.setOldDimension(s.size),e.push(l),i.getChildOperations().push(l),this.setMoveWrapperOperation(i)}return[i]},updateChildMoveOperation:function(e,t,r){this.getMoveOperations()[e].setNewCoord(r)},updateChildResizeOperation:function(e,t,r){this.getMoveOperations()[e].setNewDimension(r)},getAllObjOperations:function(e){var t=this.getMoveOperations(),r=t?Kekule.ArrayUtils.clone(t):[];if(r.length){var i=this.getMoveWrapperOperation();return i.setChildOperations(r),[i]}return[]},getActiveOperation:function(e){var t=this.getAllObjOperations(e);return(t=Kekule.ArrayUtils.toUnique(t)).length<=0?null:1===t.length?t[0]:new Kekule.MacroOperation(t)},reverseActiveOperation:function(){return this.getActiveOperation().reverse()},addOperationToEditor:function(){var e=this.getEditor();if(e&&e.getEnableOperHistory()){var t=this.getActiveOperation(!0);t&&e.pushOperation(t)}},getCurrAvailableManipulationTypes:function(){var e=Kekule.Editor.BasicManipulationIaController.ManipulationType,t=this.getEditor().getSelectionContainerBox();if(t){var r=[];return this.getEnableMove()&&r.push(e.MOVE),Kekule.NumUtils.isFloatEqual(t.x1,t.x2,1e-10)&&Kekule.NumUtils.isFloatEqual(t.y1,t.y2,1e-10)||(this.getEnableResize()&&r.push(e.RESIZE),this.getEnableRotate()&&r.push(e.ROTATE),(this.getEnableResize()||this.getEnableRotate())&&r.push(e.TRANSFORM)),r}return[]},getActualManipulatingObjects:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r],n=o.getCoordDependentObjects?o.getCoordDependentObjects():[o];Kekule.ArrayUtils.pushUnique(t,n)}return t},doPrepareManipulatingObjects:function(e,t){var r=this.getActualManipulatingObjects(e);this.setManipulateOriginObjs(e),this.setManipulateObjs(r);var i=this.getManipulateObjInfoMap();i.clear();this.getEditor();for(var o=0,n=r.length;o<n;++o){var a=r[o],s=this.createManipulateObjInfo(a,o,t);i.set(a,s)}},doPrepareManipulatingStartingCoords:function(e,t,r,i){this.setStartBox(t),this.setRotateCenter(r),this.setRotateRefCoord(i),this.setLastRotateAngle(null)},prepareManipulating:function(e,t,r,i,o,n){this.setManipulationType(e),this.doPrepareManipulatingObjects(t,r),this.doPrepareManipulatingStartingCoords(r,i,o,n),this.createManipulateOperation(),this._cachedTransformCompareThresholds=null,this._runManipulationStepId=Kekule.window.requestAnimationFrame(this.execManipulationStepBind)},cancelManipulate:function(){this.getEditor(),this.getManipulateObjs();this.reverseActiveOperation(),this.notifyCoordChangeOfObjects(this.getManipulateObjs()),this.manipulateEnd()},_getManipulateObjsCenterCoord:function(){var e=this.getManipulateObjs();if(!e||!e.length)return null;for(var t=this.getEditor().getCoordMode(),r=this.getEditor().getAllowCoordBorrow(),i={x:0,y:0,z:0},o=0,n=e.length;o<n;++o){var a=e[o],s=a.getAbsBaseCoord?a.getAbsBaseCoord(t,r):a.getAbsCoord?a.getAbsCoord(t,r):a.getCoordOfMode?a.getCoordOfMode(t,r):null;s&&(i=Kekule.CoordUtils.add(i,s))}return Kekule.CoordUtils.divide(i,e.length)},_maniplateObjsFrameEnd:function(e){},_addManipultingObjNewInfo:function(e,t){var r=this.getManipulateObjCurrInfoMap(),i=r.get(e)||{};i=Object.extend(i,t),r.set(e,i)},applyManipulatingObjsInfo:function(e){var t=this.getManipulateObjs(),r=this.getManipulateObjCurrInfoMap(),i=this._getIndirectCoordObjs(t);this._setEnableIndirectCoordOfObjs(i,!1);try{for(var o=0,n=t.length;o<n;++o){var a=t[o],s=r.get(a);this.applySingleManipulatingObjInfo(o,a,s,e)}}finally{this._setEnableIndirectCoordOfObjs(i,!0)}},_getIndirectCoordObjs:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r];o.getEnableIndirectCoord&&o.getEnableIndirectCoord()&&t.push(o)}return t},_setEnableIndirectCoordOfObjs:function(e,t){if(e)for(var r=0,i=e.length;r<i;++r)e[r].setEnableIndirectCoord(t)},applySingleManipulatingObjInfo:function(e,t,r,i){r&&(r.screenCoord&&this.doMoveManipulatedObj(e,t,r.screenCoord,i),r.size&&this.doResizeManipulatedObj(e,t,r.size))},_calcRotateAngle:function(e){var t,r=Kekule.CoordUtils,i=!1,o=this.getRotateCenter(),n=this.getRotateRefCoord()||this.getStartCoord(),a=this.getEditorConfigs().getInteractionConfigs().getRotationLocationPointDistanceThreshold();if(a){if(r.getDistance(n,o)<a)return t=0,i=!0,this.setStartCoord(e),!1;if(r.getDistance(e,o)<a)return t=0,i=!0,!1}if(!i){var s=r.substract(e,o),l=Math.atan2(s.y,s.x);s=r.substract(n,o);var d=Math.atan2(s.y,s.x);t=l-d}return{angle:t,startAngle:d,endAngle:l}},_calcActualRotateAngle:function(e,t,r,i){return t},_calcManipulateObjsRotationParams:function(e,t){if(!this.getEnableRotate())return!1;var r=this.getRotateCenter(),i=this._calcRotateAngle(t);if(!i)return!1;var o=this._calcActualRotateAngle(e,i.angle,i.startAngle,i.endAngle),n=this.getLastRotateAngle();return(!Kekule.ObjUtils.notUnset(n)||!Kekule.NumUtils.isFloatEqual(o,n,.0175))&&(this.setLastRotateAngle(o),{center:r,rotateAngle:o})},_calcActualResizeScales:function(e,t){return t},_calcManipulateObjsResizeParams:function(e,t,r){if(!this.getEnableResize())return!1;var i,o,n=Kekule.Editor.BoxRegion,a=Kekule.CoordUtils,s=this.getStartBox(),l=a.substract(r,this.getStartCoord());t===n.EDGE_TOP?(l.x=0,i={x:(s.x1+s.x2)/2,y:s.y2}):t===n.EDGE_BOTTOM?(l.x=0,i={x:(s.x1+s.x2)/2,y:s.y1}):t===n.EDGE_LEFT?(l.y=0,i={x:s.x2,y:(s.y1+s.y2)/2}):t===n.EDGE_RIGHT?(l.y=0,i={x:s.x1,y:(s.y1+s.y2)/2}):(this.isAspectRatioLockedResize()&&(o=!0),i=t===n.CORNER_TL?{x:s.x2,y:s.y2}:t===n.CORNER_TR?{x:s.x1,y:s.y2}:t===n.CORNER_BL?{x:s.x2,y:s.y1}:{x:s.x1,y:s.y1});var d,u,c=t===n.CORNER_TL||t===n.CORNER_BL||t===n.EDGE_LEFT,p=t===n.CORNER_TL||t===n.CORNER_TR||t===n.EDGE_TOP;if(d=Kekule.NumUtils.isFloatEqual(s.x1,s.x2,1e-10)?1:1+l.x/(s.x2-s.x1)*(c?-1:1),u=Kekule.NumUtils.isFloatEqual(s.y1,s.y2,1e-10)?1:1+l.y/(s.y2-s.y1)*(p?-1:1),o){var h=Math.abs(d),g=Math.abs(u);h>=g?u=(Math.sign(u)||1)*h:d=(Math.sign(d)||1)*g}var C=this._calcActualResizeScales(e,{scaleX:d,scaleY:u});return{center:i,scaleX:C.scaleX,scaleY:C.scaleY}},_calcManipulateObjsTransformInfo:function(e,t){for(var r=Kekule.CoordUtils,i=r.calcTransform2DMatrix(t),o=t.scaleX||t.scale,n=t.scaleY||t.scale,a=this._isManipulatingSingleStickedObj(e),s=0,l=e.length;s<l;++s){var d=e[s],u=this.getManipulateObjInfoMap().get(d),c={};if(!u.hasNoCoord){var p=u.screenCoord;if(!u.stickTarget||a){var h=r.transform2DByMatrix(p,i);c.screenCoord=h}else c.screenCoord=p}if(u.size&&(o||n)){var g={x:u.size.x*Math.abs(o||1),y:u.size.y*Math.abs(n||1)};c.size=g}this._addManipultingObjNewInfo(d,c)}return!0},_isStickedObj:function(e){return e&&e.getCoordStickTarget&&e.getCoordStickTarget()},_isManipulatingSingleStickedObj:function(e){var t=!1;if(1===e.length){var r=e[0];t=!!this.getManipulateObjInfoMap().get(r).stickTarget}return t},doTransformManipulatedObjs:function(e,t,r){var i=Kekule.Editor.BasicManipulationIaController.ManipulationType,o=this.getEditor(),n=this.getManipulateObjs(),a=r;if((a||(e===i.RESIZE?a=this._calcManipulateObjsResizeParams(n,this.getResizeStartingRegion(),t):e===i.ROTATE&&(a=this._calcManipulateObjsRotationParams(n,t))),!this._lastTransformParams||!this._isSameTransformParams(this._lastTransformParams,a,null,o.getCoordMode()))&&(a&&this._calcManipulateObjsTransformInfo(n,a))){this._lastTransformParams=a,o.beginUpdateObject();this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(t),this._maniplateObjsFrameEnd(n),this.notifyCoordChangeOfObjects(n)}finally{o.endUpdateObject(),this.manipulateStepDone()}}},_isSameTransformParams:function(e,t,r,o){return r||(r=this._cachedTransformCompareThresholds),r||(r=this._getTransformCompareThresholds(),this._cachedTransformCompareThresholds=r),o===Kekule.CoordMode.COORD2D?i.isSameTransform2DOptions(e,t,{translate:r.translate,scale:r.scale,rotate:r.rotate}):i.isSameTransform3DOptions(e,t,{translate:r.translate,scale:r.scale,rotate:r.rotate})},_getTransformCompareThresholds:function(e){return{translate:.1,scale:.1,rotate:.1}},_calcActualMovedScreenCoord:function(e,t,r){return r},_calcManipulateObjsMoveInfo:function(e,t){var r=Kekule.CoordUtils,i=(this.getManipulateObjCurrInfoMap(),this.getEditor()),o=this._isManipulatingSingleStickedObj(e),n=this.isDirectManipulating()&&1===e.length,a=!n||e[0]&&e[0].getSizeOfMode&&e[0].getSizeOfMode(i.getCoordMode(),i.getAllowCoordBorrow()),s=n&&!a&&this.getEditorConfigs().getInteractionConfigs().getFollowPointerCoordOnDirectManipulatingSingleObj();if(s){var l=this.getStartCoord();r.getDistance(t,l)<=this.getEditorConfigs().getInteractionConfigs().getFollowPointerCoordOnDirectManipulatingSingleObjDistanceThreshold()&&(s=!1)}for(var d=0,u=e.length;d<u;++d){var c,p=e[d],h=this.getManipulateObjInfoMap().get(p);if(!h.hasNoCoord)if(!h.stickTarget||o)c=s?t:r.add(t,h.screenCoordOffset),c=this._calcActualMovedScreenCoord(p,h,c),this._addManipultingObjNewInfo(p,{screenCoord:c})}},moveManipulatedObjs:function(e){Kekule.CoordUtils;var t=this.getEditor(),r=this.getManipulateObjs();this._calcManipulateObjsMoveInfo(r,e),t.beginUpdateObject();this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(e),this._maniplateObjsFrameEnd(r),this.notifyCoordChangeOfObjects(r)}finally{t.endUpdateObject(),this.manipulateStepDone()}},doMoveManipulatedObj:function(e,t,r,i){var o=this.getEditor();this.updateChildMoveOperation(e,t,o.screenCoordToObj(r)),o.setObjectScreenCoord(t,r)},doResizeManipulatedObj:function(e,t,r){this.updateChildResizeOperation(e,t,r),t.setSizeOfMode&&t.setSizeOfMode(r,this.getEditor().getCoordMode())},isDirectManipulating:function(){return this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING&&!this.getIsManipulatingSelection()},startDirectManipulate:function(e,t,r,i,o,n){return this.manipulateBegin(),this.doStartDirectManipulate(e,t,r,i,o,n)},doStartDirectManipulate:function(e,t,r,i,o,n){var a=Kekule.ArrayUtils.toArray(t);this.setState(Kekule.Editor.BasicManipulationIaController.State.MANIPULATING),this.setBaseCoord(r),this.setStartCoord(r),this.setRotateRefCoord(n),this.setIsManipulatingSelection(!1),this.prepareManipulating(e||Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE,a,r,i,o,n)},manipulateStepDone:function(){},doManipulateObjectsEnd:function(e){for(var t=this.getManipulateObjInfoMap(),r=e.length-1;r>=0;--r)this.doManipulateObjectEnd(e[r],t.get(e[r]))},doManipulateObjectEnd:function(e,t){},manipulateBegin:function(){this.notifyEditorBeginManipulateObjects()},manipulateEnd:function(){this._runManipulationStepId&&(Kekule.window.cancelAnimationFrame(this._runManipulationStepId),this._runManipulationStepId=null),this.doManipulateObjectsEnd(this.getManipulateObjs()),this._lastTransformParams=null,this.setIsOffsetManipulating(!1),this.setManipulateObjs(null),this.getManipulateObjInfoMap().clear(),this.getObjOperationMap().clear(),this.notifyEditorEndManipulateObjects()},manipulateBeforeStopping:function(){},stopManipulate:function(){this.manipulateEnd()},refreshManipulateObjs:function(){this.setManipulateObjs(this.getManipulateObjs())},createManipulateObjInfo:function(e,t,r){var i=this.getEditor(),o={objCoord:i.getObjCoord(e),screenCoord:i.getObjectScreenCoord(e),size:i.getObjSize(e),enableIndirectCoord:!(!e.getEnableIndirectCoord||!e.getEnableIndirectCoord())};return o.hasNoCoord=!o.objCoord,!o.hasNoCoord&&r&&(o.screenCoordOffset=Kekule.CoordUtils.substract(o.screenCoord,r)),e.getCoordStickTarget&&(o.stickTarget=e.getCoordStickTarget()),o},notifyCoordChangeOfObjects:function(e){for(var t=[],r=this.getEditor(),i=this.getEditor().getCoordMode()===Kekule.CoordMode.COORD3D?"coord3D":"coord2D",o=0,n=e.length;o<n;++o){var a=e[o];Kekule.ArrayUtils.pushUnique(t,{obj:a,propNames:[i]});for(var s=a.getCoordDeterminateObjects?a.getCoordDeterminateObjects():[a],l=0,d=s.length;l<d;++l)Kekule.ArrayUtils.pushUnique(t,{obj:s[l],propNames:[i]})}r.objectsChanged(t)},canInteractWithObj:function(e){return this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL&&e},doTestMouseCursor:function(e,t){if(!this.getEditor().isRenderable())return"";var r="",i=this._getEventMouseCoord(t,this.getEditor().getEditClientElem());if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL){var o=Kekule.Editor.BoxRegion,n=this.getEditor().getCoordRegionInSelectionMarker(i);if(this.getEnableSelect()){var a=Kekule.Editor.BasicManipulationIaController.ManipulationType,s=this.getCurrAvailableManipulationTypes();if(s.indexOf(a.MOVE)>=0&&(r=n===o.INSIDE?"move":""),!r&&s.indexOf(a.RESIZE)>=0)r=n===o.CORNER_TL?"nwse-resize":n===o.CORNER_TR?"nesw-resize":n===o.CORNER_BL?"nesw-resize":n===o.CORNER_BR?"nwse-resize":n===o.EDGE_TOP||n===o.EDGE_BOTTOM?"ns-resize":n===o.EDGE_LEFT||n===o.EDGE_RIGHT?"ew-resize":"";if(!r)if(s.indexOf(a.ROTATE)>=0)if(n=this.getCoordOnSelectionRotationRegion(i)){var l=Kekule.Widget.StyleResourceNames;r=n===o.CORNER_TL?l.CURSOR_ROTATE_NW:n===o.CORNER_TR?l.CURSOR_ROTATE_NE:n===o.CORNER_BL?l.CURSOR_ROTATE_SW:n===o.CORNER_BR?l.CURSOR_ROTATE_SE:l.CURSOR_ROTATE}}}return r},setSuspendedOperations:function(e,t,r){this._suspendedOperations&&this.haltSuspendedOperations();return this._suspendedOperations={immediate:e,delayed:t,delayExecId:setTimeout(this.execSuspendedDelayOperation.bind(this),r)},this._suspendedOperations},execSuspendedImmediateOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var e=this._suspendedOperations.immediate;return this._suspendedOperations=null,e.apply(this)}},execSuspendedDelayOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var e=this._suspendedOperations.delayed;return this._suspendedOperations=null,e.apply(this)}},haltSuspendedOperations:function(){this._suspendedOperations&&(clearTimeout(this._suspendedOperations.delayExecId),this._suspendedOperations=null)},_startNewSelecting:function(e,t){this.getEnableSelect()&&(this.getEditor().startSelecting(e,t||this.getEditor().getIsToggleSelectOn()),this.setState(Kekule.Editor.BasicManipulationIaController.State.SELECTING))},_startOffSelectionManipulation:function(e){this.setIsOffsetManipulating(!0),this.startManipulation(e,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE),this.getEditor().pulseSelectionAreaMarker()},startManipulation:function(e,t,r){var i=Kekule.Editor.BasicManipulationIaController.State,o=Kekule.Editor.BasicManipulationIaController.ManipulationType,n=this.getCurrAvailableManipulationTypes(),a=t&&"touch"===t.pointerType;t&&this.setManipulationPointerType(t&&t.pointerType),this.manipulateBegin(),this.setBaseCoord(e),this.setStartCoord(e),this._lastTransformParams=null;var s=e&&this.getEditor().getCoordRegionInSelectionMarker(e),l=Kekule.Editor.BoxRegion,d=e&&this.getCoordOnSelectionRotationRegion(e),u=n.indexOf(o.TRANSFORM)>=0&&r===o.TRANSFORM;if(u)this._availTransformTypes=n;else var c=!a&&n.indexOf(o.RESIZE)>=0&&(r===o.RESIZE||s!==l.INSIDE&&s!==l.OUTSIDE),p=!c&&n.indexOf(o.MOVE)>=0&&(r===o.MOVE||s!==l.OUTSIDE),h=!a&&!c&&!p&&n.indexOf(o.ROTATE)>=0&&(r===o.ROTATE||!!d);if(!u&&!c&&!h){var g=this.getEditor().getTopmostBasicObjectAtCoord(e,this.getCurrBoundInflation());if(g&&!a&&(this.isInAncestorSelectMode()&&(g=this.getStandaloneAncestor(g)),g=g.getNearestMovableObject(),this.getEnableMove()))return void this.doStartDirectManipulate(null,g,e)}if(u)this.setState(i.MANIPULATING),this.setIsManipulatingSelection(!0),this.setResizeStartingRegion(s),this.setRotateStartingRegion(d),this.prepareManipulating(o.TRANSFORM,this.getEditor().getSelection(),e,this.getEditor().getSelectionContainerBox());else if(c)this.setState(i.MANIPULATING),this.setIsManipulatingSelection(!0),this.setResizeStartingRegion(s),this.prepareManipulating(o.RESIZE,this.getEditor().getSelection(),e,this.getEditor().getSelectionContainerBox());else if(p)this.setState(i.MANIPULATING),this.setIsManipulatingSelection(!0),this.prepareManipulating(o.MOVE,this.getEditor().getSelection(),e);else if(h)this.setState(i.MANIPULATING),this.setIsManipulatingSelection(!0),this.setRotateStartingRegion(d),this.prepareManipulating(o.ROTATE,this.getEditor().getSelection(),e,this.getEditor().getSelectionContainerBox());else if(g)this.getEnableMove()&&this.startDirectManipulate(null,g,e);else if(this.getEnableMove()&&this.getEnableSelect()&&this.getEditorConfigs().getInteractionConfigs().getEnableOffSelectionManipulation()&&this.getEditor().hasSelection()&&this.getEditor().isSelectionVisible()){this.setState(i.SUSPENDING);var C=this.getEditorConfigs().getInteractionConfigs().getOffSelectionManipulationActivatingTimeThreshold(),_=t&&t.getShiftKey();this.setSuspendedOperations(this._startNewSelecting.bind(this,e,_),this._startOffSelectionManipulation.bind(this,e),C)}else if(this.getEnableSelect()){_=t&&t.getShiftKey();this._startNewSelecting(e,_)}},execManipulationStep:function(e){if(this.getState()!==Kekule.Editor.BasicManipulationIaController.State.MANIPULATING)return!1;var t=this._manipulationStepBuffer.coord,r=this._manipulationStepBuffer.event,i=this._manipulationStepBuffer.explicitTransformParams;i?this.doExecManipulationStepWithExplicitTransformParams(i,this._manipulationStepBuffer):t&&r&&this.doExecManipulationStep(t,r,this._manipulationStepBuffer),this._manipulationStepBuffer.coord=null,this._manipulationStepBuffer.event=null,this._manipulationStepBuffer.explicitTransformParams=null,this._runManipulationStepId=Kekule.window.requestAnimationFrame(this.execManipulationStepBind)},doExecManipulationStep:function(e,t,r){var i=Kekule.Editor.BasicManipulationIaController.ManipulationType,o=this.getManipulationType(),n=this.getEditor();n.beginUpdateObject();try{this._isBusy=!0,o===i.MOVE?this.moveManipulatedObjs(e):o===i.RESIZE?this.doTransformManipulatedObjs(o,e):o===i.ROTATE&&this.doTransformManipulatedObjs(o,e)}finally{n.endUpdateObject(),this._isBusy=!1}},doExecManipulationStepWithExplicitTransformParams:function(e,t){var r=Kekule.Editor.BasicManipulationIaController.ManipulationType,i=this.getManipulationType();if(i===r.TRANSFORM){var o=this.getEditor();o.beginUpdateObject();try{this._isBusy=!0,this.doTransformManipulatedObjs(i,null,e)}finally{o.endUpdateObject(),this._isBusy=!1}}},updateManipulationStepBuffer:function(e,t){Object.extend(e,t)},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this._isBusy)return!0;if(Kekule.ObjUtils.notUnset(this.getActivePointerId())&&e.pointerId!==this.getActivePointerId())return!0;var t,r=Kekule.Editor.BasicManipulationIaController.State,i=(Kekule.Editor.BasicManipulationIaController.ManipulationType,this.getState()),o=this._getEventMouseCoord(e);if((i===r.NORMAL||i===r.SUSPENDING)&&this._lastMouseMoveCoord){var n=Kekule.CoordUtils.getDistance(o,this._lastMouseMoveCoord);if(t=n,n<4)return!0}if(this._lastMouseMoveCoord=o,i===r.SUSPENDING){var a=this.getEditorConfigs().getInteractionConfigs().getUnmovePointerDistanceThreshold()||0;Kekule.ObjUtils.notUnset(t)&&t>a&&this.execSuspendedImmediateOperation()}return i===r.SELECTING?(this.getEnableSelect()&&this.getEditor().addSelectingAnchorCoord(o),e.preventDefault()):i===r.MANIPULATING&&(this.updateManipulationStepBuffer(this._manipulationStepBuffer,{coord:o,event:e}),e.preventDefault()),!0},react_pointerdown:function(e){this.tryApplySuper("react_pointerdown",[e]),this.setActivePointerId(e.pointerId);var t=Kekule.Editor.BasicManipulationIaController.State;if(e.getButton()===Kekule.X.Event.MouseButton.LEFT){this._lastMouseMoveCoord=null;var r=this._getEventMouseCoord(e);if(this.getState()===t.NORMAL){var i=this,o=function(){i.getState()!==t.NORMAL&&i.getState()!==t.SUSPENDING||(i.startManipulation(r,e),e.preventDefault())};this.setState(t.SUSPENDING),this.setSuspendedOperations(o,o,50)}}else e.getButton()===Kekule.X.Event.MouseButton.RIGHT&&(this.getState()===t.MANIPULATING?(this.cancelManipulate(),this.setState(t.NORMAL),e.stopPropagation(),e.preventDefault()):this.getState()===t.SUSPENDING&&this.haltSuspendedOperations());return!0},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MouseButton.LEFT){var t=this._getEventMouseCoord(e);this.setEndCoord(t);var r=this.getStartCoord(),i=t,o=e.getShiftKey(),n=Kekule.Editor.BasicManipulationIaController.State;this.getState()===n.SUSPENDING&&this.execSuspendedImmediateOperation();var a=this.getState();if(a===n.SELECTING)this.getEditor().endSelecting(t,o||this.getEditor().getIsToggleSelectOn()),this.setState(n.NORMAL),e.preventDefault(),this.getEditor().endManipulateObject();else a===n.MANIPULATING&&(r&&i&&Kekule.CoordUtils.isEqual(r,i)?this.getEnableSelect()&&this.getEditor().selectOnCoord(r,o||this.getEditor().getIsToggleSelectOn()):(this.manipulateBeforeStopping(),this.addOperationToEditor()),this.stopManipulate(),this.setState(n.NORMAL),e.preventDefault())}return!0},react_mousewheel:function(e){if(e.getCtrlKey()){if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL)return this.tryApplySuper("react_mousewheel",[e]);e.preventDefault()}},_isGestureManipulationEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureManipulation()},_isGestureZoomOnEditorEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureZoomOnEditor()},_isInGestureManipulation:function(){return!!this._initialGestureTransformParams},_isGestureZoomOnEditor:function(){return!!this._initialGestureZoomLevel},beginGestureTransform:function(e){this.getEditor().hasSelection()?(this._initialGestureZoomLevel=null,this._isGestureManipulationEnabled()?(this.haltSuspendedOperations(),this._initialGestureTransformParams={angle:e.rotation*Math.PI/180||0},this.getState()!==Kekule.Editor.BasicManipulationIaController.State.MANIPULATING?this.startManipulation(null,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM):this.getManipulationType()!==Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM&&this.startManipulation(null,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM)):this._initialGestureTransformParams=null):this._isGestureZoomOnEditorEnabled()&&(this.getEditor().cancelSelecting(),this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),this._initialGestureZoomLevel=this.getEditor().getZoom())},endGestureTransform:function(){this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING&&this._isInGestureManipulation()&&(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),this._initialGestureTransformParams=null),this._isGestureZoomOnEditor()&&(this._initialGestureZoomLevel=null)},doGestureTransformStep:function(e){var t=Kekule.Editor.BasicManipulationIaController.ManipulationType;if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING&&this.getManipulationType()===t.TRANSFORM&&this._isInGestureManipulation()){var r,i=this._availTransformTypes||[],o=this.getRotateCenter();if(i.indexOf(t.RESIZE)>=0){var n=e.scale;r=this._calcActualResizeScales(this.getManipulateObjs(),{scaleX:n,scaleY:n})}else r={scaleX:1,scaleY:1};if(i.indexOf(t.ROTATE)>=0){var a=e.rotation*Math.PI/180,s=a-this._initialGestureTransformParams.angle;s=this._calcActualRotateAngle(this.getManipulateObjs(),s,this._initialGestureTransformParams.angle,a)}else s=0;this.updateManipulationStepBuffer(this._manipulationStepBuffer,{explicitTransformParams:{center:o,scaleX:r.scaleX,scaleY:r.scaleY,rotateAngle:s}}),e.preventDefault()}else if(this._isGestureZoomOnEditor()){var l=this.getEditor(),d=(n=e.scale,this._initialGestureZoomLevel);l.zoomTo(d*n,null,e.center)}},react_rotatestart:function(e){this.getEnableGestureManipulation()&&this.beginGestureTransform(e)},react_rotate:function(e){this.getEnableGestureManipulation()&&this.doGestureTransformStep(e)},react_rotateend:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_rotatecancel:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_pinchstart:function(e){this.getEnableGestureManipulation()&&this.beginGestureTransform(e)},react_pinchmove:function(e){this.getEnableGestureManipulation()&&this.doGestureTransformStep(e)},react_pinchend:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_pinchcancel:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()}}),Kekule.Editor.BasicManipulationIaController.State={NORMAL:0,SELECTING:1,MANIPULATING:2,WAITING:10,SUSPENDING:11},Kekule.Editor.BasicManipulationIaController.ManipulationType={MOVE:0,ROTATE:1,RESIZE:2,TRANSFORM:4},Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicManipulationIaController,Kekule.Editor.BaseEditor)}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.ChemObjOperation={},Kekule.ChemObjOperation.Base=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemObjOperation.Base",initialize:function(e,t){this.tryApplySuper("initialize"),this.setTarget(e),t&&this.setEditor(t)},initProperties:function(){this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL}),this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},notifyBeforeAddingByEditor:function(e,t,r){e.beforeAddingByEditor&&e.beforeAddingByEditor(t,r)},notifyBeforeRemovingByEditor:function(e,t){e.beforeRemovingByEditor&&e.beforeRemovingByEditor(t)},notifyBeforeModifyingByEditor:function(e,t){e.beforeModifyingByEditor&&e.beforeModifyingByEditor(t)},notifyAfterAddingByEditor:function(e,t,r){e.afterAddingByEditor&&e.afterAddingByEditor(t,r)},notifyAfterRemovingByEditor:function(e,t){e.afterRemovingByEditor&&e.afterRemovingByEditor(t)},notifyAfterModifyingByEditor:function(e,t){e.afterModifyingByEditor&&e.afterModifyingByEditor(t)}}),Kekule.ChemObjOperation.ChangeClass=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.ChangeClass",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),t&&this.setNewClass(t)},initProperties:function(){this.defineProp("newClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("oldClass",{dataType:DataType.CLASS,serializable:!1})},doExecute:function(){var e=this.getTarget();e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,{}),this.getOldClass()||this.setOldClass(e.getClass()),e.__changeClass__(this.getNewClass()),this.notifyAfterModifyingByEditor(e,{})}finally{e.endUpdate()}},doReverse:function(){var e=this.getTarget();e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,{}),e.__changeClass__(this.getOldClass()),this.notifyAfterModifyingByEditor(e,{})}finally{e.endUpdate()}}}),Kekule.ChemObjOperation.Modify=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Modify",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),t&&this.setNewPropValues(t)},initProperties:function(){this.defineProp("newPropValues",{dataType:DataType.HASH}),this.defineProp("oldPropValues",{dataType:DataType.HASH})},doExecute:function(){var e={},t=this.getNewPropValues(),r=this.getTarget();r.beginUpdate();try{for(var i in this.notifyBeforeModifyingByEditor(r,t),t){var o=t[i];e[i]=r.getPropValue(i),r.setPropValue(i,o)}this.notifyAfterModifyingByEditor(r,t)}finally{r.endUpdate()}this.setOldPropValues(e)},doReverse:function(){var e=this.getOldPropValues(),t=this.getTarget();t.beginUpdate();try{for(var r in this.notifyBeforeModifyingByEditor(t,e),e){var i=e[r];t.setPropValue(r,i)}this.notifyAfterModifyingByEditor(t,e)}finally{t.endUpdate()}}}),Kekule.ChemObjOperation.ModifyHashProp=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.ModifyHashProp",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),t&&this.setPropName(t),r&&this.setNewPropValue(r)},initProperties:function(){this.defineProp("propName",{dataType:DataType.STRING}),this.defineProp("newPropValue",{dataType:DataType.HASH}),this.defineProp("oldPropValue",{dataType:DataType.HASH})},_extendHash:function(e,t){},doExecute:function(){var e=this.getTarget(),t=this.getPropName(),r=e.getPropValue(this.getPropName()),i=Object.extend(Object.extend({},r),this.getNewPropValue(),!1),o={};o[t]=i,e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,o),e.setPropValue(t,i),this.notifyAfterModifyingByEditor(e,o)}finally{e.endUpdate()}this.getOldPropValue()||this.setOldPropValue(r)},doReverse:function(){var e=this.getTarget(),t=this.getPropName(),r=this.getOldPropValue(),i=(e.getPropValue(t),r),o={};o[t]=i,e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,o),e.setPropValue(t,i),this.notifyAfterModifyingByEditor(e,o)}finally{e.endUpdate()}}}),Kekule.ChemObjOperation.MoveTo=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveTo",initialize:function(e,t,r,i,o){this.tryApplySuper("initialize",[e,o]),t&&this.setNewCoord(t),this.setCoordMode(r||Kekule.CoordMode.COORD2D),this.setUseAbsBaseCoord(!!i)},initProperties:function(){this.defineProp("newCoord",{dataType:DataType.HASH}),this.defineProp("oldCoord",{dataType:DataType.HASH}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("useAbsBaseCoord",{dataType:DataType.BOOL})},setObjCoord:function(e,t,r){if(e&&t&&r){var i=!1;if(this.getUseAbsBaseCoord()?e.setAbsBaseCoord&&(e.setAbsBaseCoord(t,r,this.getAllowCoordBorrow()),i=!0):e.setCoordOfMode&&(e.setCoordOfMode(t,r),i=!0),!i){var o=e.getClassName?e.getClassName():typeof e;Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_COORD_OF_CLASS").format(o))}}},getObjCoord:function(e,t){if(this.getUseAbsBaseCoord()){if(e.getAbsBaseCoord)return e.getAbsBaseCoord(t,this.getAllowCoordBorrow())}else if(e.getCoordOfMode)return e.getCoordOfMode(t,this.getAllowCoordBorrow());return null},doExecute:function(){var e=this.getTarget();this.getOldCoord()||this.setOldCoord(this.getObjCoord(e,this.getCoordMode())),this.getNewCoord()&&this.setObjCoord(this.getTarget(),this.getNewCoord(),this.getCoordMode())},doReverse:function(){this.getOldCoord()&&this.setObjCoord(this.getTarget(),this.getOldCoord(),this.getCoordMode())}}),Kekule.ChemObjOperation.MoveAndResize=Class.create(Kekule.ChemObjOperation.MoveTo,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResize",initialize:function(e,t,r,i,o,n){this.tryApplySuper("initialize",[e,r,i,o,n])},initProperties:function(){this.defineProp("newDimension",{dataType:DataType.HASH}),this.defineProp("oldDimension",{dataType:DataType.HASH})},setObjSize:function(e,t,r){if(e&&t)if(e.setSizeOfMode)e.setSizeOfMode(t,r);else{var i=e.getClassName?e.getClassName():typeof e;Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_DIMENSION_OF_CLASS").format(i))}},getObjSize:function(e,t){return e.getSizeOfMode?e.getSizeOfMode(t,this.getAllowCoordBorrow()):null},doExecute:function(){this.tryApplySuper("doExecute");var e=this.getTarget();this.getOldDimension()||this.setOldDimension(this.getObjSize(e,this.getCoordMode())),this.getNewDimension()&&this.setObjSize(this.getTarget(),this.getNewDimension(),this.getCoordMode())},doReverse:function(){this.getOldDimension()&&this.setObjSize(this.getTarget(),this.getOldDimension(),this.getCoordMode()),this.tryApplySuper("doReverse")}}),Kekule.ChemObjOperation.MoveAndResizeObjs=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResizeObjs",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[null,i]),e&&this.setObjCoordAndSizeInfo(e),this.setCoordMode(t||Kekule.CoordMode.COORD2D),this.setUseAbsCoord(!!r),this.setPropStoreFieldValue("childOperations",[])},initProperties:function(){this.defineProp("objCoordAndSizeInfo",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("useAbsCoord",{dataType:DataType.BOOL}),this.defineProp("disableIndirectCoord",{dataType:DataType.BOOL}),this.defineProp("childOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("indirectCoordObjs",{dataType:DataType.ARRAY,serializable:!1})},_setEnableIndirectCoordOfObjs:function(e,t){if(e)for(var r=0,i=e.length;r<i;++r)e[r].setEnableIndirectCoord(t)},_prepareIndirectCoordObjs:function(e){var t=[];if(this.getDisableIndirectCoord())for(var r=0,i=e.length;r<i;++r){var o=e[r];if(o&&o instanceof Kekule.ChemObjOperation.MoveAndResize){var n=o.getTarget();n.hasProperty("enableIndirectCoord")&&n.getEnableIndirectCoord()&&(n.setEnableIndirectCoord(!1),t.push(n))}}this.setIndirectCoordObjs(t)},_prepareExecute:function(){var e=this.getChildOperations();if(!e.length){e.length=0;for(var t=this.getObjCoordAndSizeInfo(),r=0,i=t.length;r<i;++r){var o=t[r],n=o.obj,a=new Kekule.ChemObjOperation.MoveAndResize(n,o.newDimension,o.newCoord,this.getCoordMode(),this.getUseAbsCoord(),this.getEditor());a.setAllowCoordBorrow(this.getAllowCoordBorrow()),o.oldDimension&&a.setOldDimension(o.oldDimension),o.oldCoord&&a.setOldCoord(o.oldCoord),e.push(a)}}this._prepareIndirectCoordObjs(e)},_prepareReverse:function(){this.getDisableIndirectCoord()&&(this.getIndirectCoordObjs()||this._prepareIndirectCoordObjs(this.getChildOperations()),this._setEnableIndirectCoordOfObjs(this.getIndirectCoordObjs(),!1))},_doneMoveAndResize:function(){this._setEnableIndirectCoordOfObjs(this.getIndirectCoordObjs(),!0)},doExecute:function(){this.tryApplySuper("doExecute");try{this._prepareExecute();for(var e=this.getChildOperations(),t=0,r=e.length;t<r;++t)e[t].execute()}finally{this._doneMoveAndResize()}},doReverse:function(){try{this._prepareReverse();for(var e=this.getChildOperations(),t=e.length-1;t>=0;--t)e[t].reverse()}finally{this._doneMoveAndResize()}this.tryApplySuper("doReverse")}}),Kekule.ChemObjOperation.StickTo=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.StickTo",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),t&&this.setStickTarget(t)},initProperties:function(){this.defineProp("stickTarget",{dataType:Kekule.ChemObject,serializable:!1}),this.defineProp("oldStickTarget",{dataType:Kekule.ChemObject,serializable:!1})},_canExecute:function(e){return e&&e.getAllowCoordStickTo&&e.getAllowCoordStickTo(this.getStickTarget())},doExecute:function(){this.tryApplySuper("doExecute");var e=this.getTarget();this._canExecute(e)&&(void 0===this.getOldStickTarget()&&this.setOldStickTarget(e.getCoordStickTarget()||null),e.setCoordStickTarget(this.getStickTarget()))},doReverse:function(){this.getTarget().setCoordStickTarget(this.getOldStickTarget()),this.tryApplySuper("doReverse")}}),Kekule.ChemObjOperation.StickTo.canStick=function(e,t,r,i){var o=e&&e.getAllowCoordStickTo&&e.getAllowCoordStickTo(t);if(t&&(o=(o=(o=(o=(o=o&&t&&t.getAbsCoordOfMode)&&t!==e)&&t.getAcceptCoordStickFrom&&t.getAcceptCoordStickFrom(e))&&(!t.getCoordStickTarget||t.getCoordStickTarget()!==e))&&(r||!(t instanceof Kekule.StructureFragment)))&&!i){var n=e.getParent(),a=t.getParent();o=n!==a||!n||!a}return o},Kekule.ChemObjOperation.Add=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Add",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),this.setParentObj(t),this.setRefSibling(r)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:!1})},doExecute:function(){var e=this.getParentObj(),t=this.getTarget();if(e&&t){var r=this.getRefSibling()||null;this.notifyBeforeAddingByEditor(t,e,r),e.insertBefore(t,r),this.notifyAfterAddingByEditor(t,e,r)}},doReverse:function(){var e=this.getTarget(),t=this.getParentObj();if(t&&e){var r=this.getRefSibling();r||(r=e.getNextSibling(),this.setRefSibling(r)),this.notifyBeforeRemovingByEditor(e,t),t.removeChild(e),this.notifyAfterRemovingByEditor(e,t)}}}),Kekule.ChemObjOperation.Remove=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Remove",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),this.setParentObj(t),this.setRefSibling(r)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("ownerObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("removedRelations",{dataType:DataType.ARRAY,serializable:!1})},_isInEditorSelection:function(e){var t=this.getEditor();return(t&&t.getSelection&&t.getSelection()||[]).indexOf(e)>=0},_getRelatedObjRefRelations:function(t){var r=[],i=t.getOwner();if(i){var o=i.findObjRefRelations({dest:t},{checkDestChildren:!0});if(o&&o.length)for(var n=0,a=o.length;n<a;++n){var s=Object.extend({},o[n]);e.isArray(s.dest)&&(s.dest=e.clone(s.dest)),r.push(s)}}return r},_restoreRelations:function(e){if(e)for(var t=0,r=e.length;t<r;++t){var i=e[t];i.srcObj.setPropValue(i.srcProp.name,i.dest)}},doExecute:function(){var e=this.getTarget(),t=this.getParentObj(),r=this.getOwnerObj();if(!t&&e.getParent&&(t=e.getParent(),this.setParentObj(t)),!r&&e.getOwner&&(r=e.getOwner(),this.setOwnerObj(r)),t&&e){if(!this.getRefSibling()){var i=e.getNextSibling?e.getNextSibling():null;this.setRefSibling(i)}var o=this._getRelatedObjRefRelations(e);this.setRemovedRelations(o);var n=this.getEditor(),a=this._isInEditorSelection(e);a&&n.beginUpdateSelection(),this.notifyBeforeRemovingByEditor(e,t),t.removeChild(e),this.notifyAfterRemovingByEditor(e,t),a&&(n.removeFromSelection(e),n.endUpdateSelection())}},doReverse:function(){var e=this.getParentObj(),t=this.getOwnerObj(),r=this.getTarget();if(e&&r){var i=this.getRefSibling();t&&r.setOwner(t),this.notifyBeforeAddingByEditor(r,e,i),e.insertBefore(r,i),this._restoreRelations(this.getRemovedRelations()),this.setRemovedRelations([]),this.notifyAfterAddingByEditor(r,e,i)}}}),Kekule.ChemStructOperation={},Kekule.ChemStructOperation.AddNode=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddNode"}),Kekule.ChemStructOperation.RemoveNode=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveNode",initProperties:function(){this.defineProp("linkedConnectorInfos",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){if(!this.getLinkedConnectorInfos()){for(var e=this.getTarget(),t=e.getLinkedConnectors(),r=[],i=0,o=t.length;i<o;++i){var n,a=t[i],s=e.getActualConnectedObjToConnector(a)||e,l=a.indexOfConnectedObj(e);n=l<0?null:a.getConnectedObjAt(l+1)||null,r.push({connector:a,refSibling:n}),s!==e&&(r.actualLinkedNode=s)}this.setLinkedConnectorInfos(r)}this.tryApplySuper("doExecute")},doReverse:function(){this.tryApplySuper("doReverse");var e=this.getLinkedConnectorInfos();if(e)for(var t=this.getTarget(),r=0,i=e.length;r<i;++r){var o=e[r].connector,n=e[r].refSibling,a=e[r].actualLinkedNode||t;o.insertConnectedObjBefore(a,n)}}}),Kekule.ChemStructOperation.ReplaceNode=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemStructOperation.ReplaceNode",initialize:function(e,t,r,i){this.tryApplySuper("initialize"),this.setOldNode(e),this.setNewNode(t),this.setParentObj(r),this.setEditor(i)},initProperties:function(){this.defineProp("oldNode",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("newNode",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("parentObj",{dataType:"Kekule.ChemStructureFragment",serializable:!1}),this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},_isInEditorSelection:function(e){var t=this.getEditor();return(t&&t.getSelection&&t.getSelection()||[]).indexOf(e)>=0},doExecute:function(){var e=this.getOldNode(),t=this.getNewNode();if(e&&t){var r=this.getParentObj();if(r||(r=e.getParent(),this.setParentObj(r)),r.replaceNode){var i=this.getEditor(),o=this._isInEditorSelection(e);o&&i.beginUpdateSelection(),r.replaceNode(e,t),o&&(i.removeFromSelection(e),i.addObjToSelection(t),i.endUpdateSelection())}}},doReverse:function(){var e=this.getOldNode(),t=this.getNewNode();if(e&&t){var r=this.getParentObj()||t.getParent();if(r.replaceNode){var i=this.getEditor(),o=this._isInEditorSelection(t);o&&i.beginUpdateSelection(),r.replaceNode(t,e),o&&(i.removeFromSelection(t),i.addObjToSelection(e),i.endUpdateSelection())}}}}),Kekule.ChemStructOperation.AddConnector=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddConnector",initialize:function(e,t,r,i,o){this.tryApplySuper("initialize",[e,t,r,o]),this.setConnectedObjs(i)},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){this.tryApplySuper("doExecute");var e=Kekule.ArrayUtils.clone(this.getConnectedObjs());e&&e.length&&this.getTarget().setConnectedObjs(e)},doReverse:function(){this.tryApplySuper("doReverse")}}),Kekule.ChemStructOperation.RemoveConnector=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveConnector",initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){this.getConnectedObjs()||this.setConnectedObjs(Kekule.ArrayUtils.clone(this.getTarget().getConnectedObjs())),this.tryApplySuper("doExecute")},doReverse:function(){this.tryApplySuper("doReverse");var e=this.getConnectedObjs();e&&e.length&&this.getTarget().setConnectedObjs(e)}}),Kekule.ChemStructOperation.MergeNodesBase=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesBase",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),this.setDest(t),this.setEnableStructFragmentMerge(r||!1),this._refSibling=null,this._nodeParent=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL}),this.defineProp("mergeConnectorPropsFromTarget",{dataType:DataType.BOOL})},getCommonSiblings:function(e,t){var r=e.getLinkedObjs(),i=t.getLinkedObjs();return Kekule.ArrayUtils.intersect(r,i)},doExecute:function(){},doReverse:function(){}}),Kekule.ChemStructOperation.MergeNodes=Class.create(Kekule.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodes",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,t,r,i]),this._refSibling=null,this._nodeParent=null,this._structFragmentMergeOperation=null,this._removeConnectorOperations=[],this._removeNodeOperation=null,this._modifyConnecorOperations=[]},initProperties:function(){this.defineProp("relinkedConnectors",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("removedConnectors",{dataType:DataType.ARRAY,serializable:!1})},getMergeConnPropsOperation:function(e,t){var r;if(e instanceof Kekule.Bond&&t instanceof Kekule.Bond&&(e.getBondType()===t.getBondType()&&e.getBondType()===Kekule.BondType.COVALENT)){var i=e.getBondOrder();i>t.getBondOrder()&&(r=new Kekule.ChemObjOperation.Modify(t,{bondOrder:i}))}return r},doExecute:function(){var e=this.getMergeConnectorPropsFromTarget(),t=this._modifyConnecorOperations||[],r=this.getTarget(),i=this.getDest(),o=r.getParentFragment(),n=i.getParentFragment();if(o!==n){if(!this.getEnableStructFragmentMerge())return null;this._structFragmentMergeOperation=new Kekule.ChemStructOperation.MergeStructFragment(o,n,this.getEditor()),this._structFragmentMergeOperation.execute(),o=n}this._nodeParent=o,o.beginUpdate();try{var a,s=this.getEditor();if(!(l=this.getRemovedConnectors())){t=[],a=this.getCommonSiblings(r,i);var l=[];if(a.length)for(var d=0,u=a.length;d<u;++d){var c=a[d];(f=r.getConnectorTo(c))&&2==f.getConnectedObjCount()&&l.push(f)}var p=r.getConnectorTo(i);p&&l.push(p),this.setRemovedConnectors(l)}if(!(h=this.getRelinkedConnectors())){var h=Kekule.ArrayUtils.clone(r.getLinkedConnectors())||[];h=Kekule.ArrayUtils.exclude(h,l),this.setRelinkedConnectors(h)}this._refSibling=r.getNextSibling();for(d=0,u=h.length;d<u;++d){var g=(f=h[d]).indexOfConnectedObj(r);f.removeConnectedObj(r),f.insertConnectedObjAt(i,g)}if(e&&!t.length&&l&&l.length){a||(a=this.getCommonSiblings(r,i));for(d=0,u=a.length;d<u;++d){c=a[d];var C=r.getConnectorTo(c);if(l.indexOf(C)>=0){var _=i.getConnectorTo(c);if(_){var m=this.getMergeConnPropsOperation(C,_);m&&t.push(m)}}}}this._removeConnectorOperations=[];for(d=0,u=l.length;d<u;++d){var f=l[d],S=new Kekule.ChemStructOperation.RemoveConnector(f,null,null,s);S.execute(),this._removeConnectorOperations.push(S)}if(this._removeNodeOperation=new Kekule.ChemStructOperation.RemoveNode(r,null,null,s),this._removeNodeOperation.execute(),t){this._modifyConnecorOperations=t;for(d=0,u=t.length;d<u;++d)t[d].execute()}}finally{o.endUpdate()}},doReverse:function(){var e=this.getTarget(),t=this.getDest(),r=this._nodeParent;r.beginUpdate();try{var i=this._modifyConnecorOperations;if(i)for(var o=0,n=i.length;o<n;++o)i[o].reverse();if(this._removeNodeOperation.reverse(),this._removeConnectorOperations.length)for(o=this._removeConnectorOperations.length-1;o>=0;--o){this._removeConnectorOperations[o].reverse()}this._removeConnectorOperations=[];var a=this.getRelinkedConnectors();for(o=0,n=a.length;o<n;++o){var s=a[o],l=s.indexOfConnectedObj(t);s.removeConnectedObj(t),s.insertConnectedObjAt(e,l)}}finally{r.endUpdate()}this._structFragmentMergeOperation&&this._structFragmentMergeOperation.reverse()}}),Kekule.ChemStructOperation.MergeNodes.canMerge=function(e,t,r,i){if(e instanceof Kekule.StructureFragment||t instanceof Kekule.StructureFragment)return!1;if(!(e instanceof Kekule.ChemStructureNode&&t instanceof Kekule.ChemStructureNode))return!1;var o=e.getParent()===t.getParent()||r;return i||(o=o&&!e.getConnectorTo(t)),o},Kekule.ChemStructOperation.MergeNodesPreview=Class.create(Kekule.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesPreview",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,t,r,i]),this._nodeParent=null},doExecute:function(){this._moveNodeOperations=[];var e=this.getTarget(),t=this.getDest(),r=e.getParentFragment(),i=Kekule.CoordMode,o=[i.COORD2D,i.COORD3D];r&&r.beginUpdate();try{for(var n=0,a=o.length;n<a;++n){var s=t.getAbsBaseCoord(o[n],!1),l=new Kekule.ChemObjOperation.MoveTo(e,s,o[n],!0,this.getEditor());l.execute(),this._moveNodeOperations.push(l)}this._nodeParent=r}finally{r&&r.endUpdate()}},doReverse:function(){var e=this._nodeParent;e&&e.beginUpdate();try{for(var t=this._moveNodeOperations,r=t.length-1;r>=0;--r)t[r].reverse()}finally{e&&e.endUpdate()}this._moveNodeOperations=null}}),Kekule.ChemStructOperation.MergeNodesPreview.canMerge=Kekule.ChemStructOperation.MergeNodes.canMerge,Kekule.ChemStructOperation.MergeConnectorsBase=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectorsBase",initialize:function(e,t,r,i,o){this.tryApplySuper("initialize",[e,o]),this.setDest(t),this.setCoordMode(r||Kekule.CoordMode.COORD2D),this.setEnableStructFragmentMerge(i||!1),this._refSibling=null,this._nodeParent=null,this._nodeMergeOperations=[]},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureConnector",serializable:!1}),this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL}),this.defineProp("coordMode",{dataType:DataType.INT})},getMergeNodeOperationClass:function(){},doExecute:function(){Kekule.ChemStructOperation.MergeConnectors.canMerge(this.getTarget(),this.getDest(),this.getEnableStructFragmentMerge())||Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_MERGE_CONNECTORS"));for(var e=this.getCoordMode(),t=[this.getTarget(),this.getDest()],r=Kekule.ArrayUtils,i=r.clone(this.getTarget().getConnectedObjs()),o=r.clone(this.getDest().getConnectedObjs()),n=this.getAllowCoordBorrow(),a=0,s=t.length;a<s;++a){var l=t[a],d=l.getConnectedObjAt(0).getAbsCoordOfMode(e,n),u=l.getConnectedObjAt(1).getAbsCoordOfMode(e,n),c=Kekule.CoordUtils.substract(d,u),p=Math.abs(c.x)>Math.abs(c.y)?"x":"y";Kekule.ObjUtils.notUnset(d.z)&&Math.abs(c.z)>Math.abs(c.x)&&(p="z"),(0===a?i:o).sort(function(t,r){var i=t.getAbsCoordOfMode(e,n),o=r.getAbsCoordOfMode(e,n);return i[p]-o[p]||0})}var h=r.intersect(i,o);i=r.exclude(i,h),o=r.exclude(o,h),this._nodeMergeOperations=[];var g=this.getMergeNodeOperationClass();for(a=0,s=i.length;a<s;++a){if(i[a]!==o[a]){var C=new g(i[a],o[a],this.getEnableStructFragmentMerge());C.execute()}this._nodeMergeOperations.push(C)}},doReverse:function(){for(var e=this._nodeMergeOperations.length-1;e>=0;--e){this._nodeMergeOperations[e].reverse()}this._nodeMergeOperations=[]}}),Kekule.ChemStructOperation.MergeConnectors=Class.create(Kekule.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return Kekule.ChemStructOperation.MergeNodes}}),Kekule.ChemStructOperation.MergeConnectors.canMerge=function(e,t,r){if(!r&&e.getParent()!==t.getParent())return!1;if(e.isConnectingConnector()||t.isConnectingConnector())return!1;var i=e.getConnectedExposedObjs(),o=t.getConnectedObjs();return i.length===o.length&&(2===i.length&&!(Kekule.ArrayUtils.intersect(i,o).length>=1))},Kekule.ChemStructOperation.MergeConnectorsPreview=Class.create(Kekule.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return Kekule.ChemStructOperation.MergeNodesPreview}}),Kekule.ChemStructOperation.MergeConnectorsPreview.canMerge=Kekule.ChemStructOperation.MergeConnectors.canMerge,Kekule.ChemStructOperation.MergeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeStructFragment",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),this.setDest(t),this._removeOperation=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("mergedNodes",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergedConnectors",{dataType:DataType.ARRAY,serializable:!1})},moveChildBetweenStructFragment:function(e,t,r,i){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(e,t,r,i)},doExecute:function(){var e=this.getTarget(),t=this.getDest();if(e&&t){var r=Kekule.ArrayUtils.clone(e.getNodes());this.setMergedNodes(r);var i=Kekule.ArrayUtils.clone(e.getConnectors());this.setMergedConnectors(i),this.moveChildBetweenStructFragment(e,t,r,i);var o=e.getParent();o&&(this._removeOperation=new Kekule.ChemObjOperation.Remove(e,o,null,this.getEditor()),this._removeOperation.execute())}},doReverse:function(){var e=this.getTarget(),t=this.getDest();if(e&&t){this._removeOperation&&(this._removeOperation.reverse(),this._removeOperation=null);var r=this.getMergedNodes(),i=this.getMergedConnectors();this.moveChildBetweenStructFragment(t,e,r,i)}}}),Kekule.ChemStructOperation.SplitStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.SplitStructFragment",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("splittedFragments",{dataType:DataType.ARRAY,serializable:!1,setter:null})},doExecute:function(){var e=Kekule.ChemStructureUtils.splitStructFragment(this.getTarget());if(e.length>1){this.setPropStoreFieldValue("splittedFragments",e);var t=this.getTarget().getParent(),r=this.getTarget().getNextSibling();t.beginUpdate();try{if(t)for(var i=1,o=e.length;i<o;++i){var n=e[i];t.insertBefore(n,r)}}finally{t.endUpdate()}}else this.setPropStoreFieldValue("splittedFragments",null)},doReverse:function(){var e=this.getSplittedFragments();if(e&&e.length)for(var t=this.getTarget(),r=0,i=e.length;r<i;++r){var o=e[r];if(o!==t){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(o,t,Kekule.ArrayUtils.clone(o.getNodes()),Kekule.ArrayUtils.clone(o.getConnectors()));var n=o.getParent();n&&n.removeChild(o),o.finalize()}}}}),Kekule.ChemStructOperation.StandardizeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.StandardizeStructFragment",initialize:function(e,t){this.tryApplySuper("initialize",[e,t]),this.setEnableSplit(!0),this.setEnableRemove(!0),this._concreteOper=null},initProperties:function(){this.defineProp("enableRemove",{dataType:DataType.BOOL}),this.defineProp("enableSplit",{dataType:DataType.BOOL})},doExecute:function(){var e=this.getTarget(),t=e.getNodeCount();this._concreteOper=null;var r=this.getEditor();return t<=0?this.getEnableRemove()&&(this._concreteOper=new Kekule.ChemObjOperation.Remove(e,null,null,r)):this.getEnableSplit()&&(this._concreteOper=new Kekule.ChemStructOperation.SplitStructFragment(e,r)),this._concreteOper?this._concreteOper.execute():null},doReverse:function(){return this._concreteOper?this._concreteOper.reverse():null}}),Kekule.ChemSpaceEditorOperation={},Kekule.ChemSpaceEditorOperation.ChangeSpaceSize=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ChangeSpaceSize",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),this.setCoordMode(r||Kekule.CoordMode.COORD2D),t&&this.setNewSize(t)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("newSize",{dataType:DataType.HASH}),this.defineProp("oldSize",{dataType:DataType.HASH})},doExecute:function(){var e=this.getEditor(),t=this.getTarget();try{var r=this.getCoordMode();this.getOldSize()||this.setOldSize(Object.extend({},t.getSizeOfMode(r,e.getAllowCoordBorrow()))),e.changeChemSpaceSize(this.getNewSize(),r)}finally{}},doReverse:function(){var e=this.getEditor();this.getTarget();if(this.getOldSize())try{var t=this.getCoordMode();e.changeChemSpaceSize(this.getOldSize(),t)}finally{}}}),Kekule.ChemSpaceEditorOperation.ShiftChildrenCoords=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ShiftChildrenCoords",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),this.setCoordMode(r||Kekule.CoordMode.COORD2D),t&&this.setCoordDelta(t)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("coordDelta",{dataType:DataType.HASH})},doExecute:function(){var e=this.getEditor(),t=(this.getTarget(),this.getCoordDelta()),r=this.getCoordMode();try{e._shiftChemSpaceChildCoord(t,r)}finally{}},doReverse:function(){var e=this.getEditor(),t=(this.getTarget(),Kekule.CoordUtils.multiply(this.getCoordDelta(),-1)),r=this.getCoordMode();try{e._shiftChemSpaceChildCoord(t,r)}finally{}}}),Kekule.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords",initialize:function(e,t,r,i,o){this.setPropStoreFieldValue("restoreScrollPosition",!0),this.tryApplySuper("initialize",[e,o]),this.setCoordMode(i||Kekule.CoordMode.COORD2D),t&&this.setNewSize(t),r&&this.setCoordDelta(r)},initProperties:function(){this.defineProp("restoreScrollPosition",{dataType:DataType.BOOL}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("coordDelta",{dataType:DataType.HASH}),this.defineProp("newSize",{dataType:DataType.HASH}),this.defineProp("oldSize",{dataType:DataType.HASH,serializable:!1})},doExecute:function(){var e=this.getEditor(),t=this.getTarget();try{var r,i=this.getCoordMode(),o=this.getRestoreScrollPosition();o&&(r=e.getClientScrollCoord(Kekule.Editor.CoordSys.CHEM)),this.getNewSize()&&(this.getOldSize()||this.setOldSize(Object.extend({},t.getSizeOfMode(i,e.getAllowCoordBorrow()))),e.changeChemSpaceSize(this.getNewSize(),i)),this.getCoordDelta()&&(e._shiftChemSpaceChildCoord(this.getCoordDelta(),i),r=Kekule.CoordUtils.add(r,this.getCoordDelta())),o&&e._registerAfterUpdateObjectProc(function(){e.scrollClientToCoord(r,Kekule.Editor.CoordSys.CHEM)})}finally{}},doReverse:function(){var e=this.getEditor();this.getTarget();if(this.getOldSize()||this.getCoordDelta())try{var t,r=this.getRestoreScrollPosition(),i=this.getCoordMode();r&&(t=e.getClientScrollCoord(Kekule.Editor.CoordSys.CHEM)),this.getCoordDelta()&&(e._shiftChemSpaceChildCoord(Kekule.CoordUtils.multiply(this.getCoordDelta(),-1),i),t=Kekule.CoordUtils.substract(t,this.getCoordDelta())),this.getOldSize()&&e.changeChemSpaceSize(this.getOldSize(),i),this.getRestoreScrollPosition()&&t&&e._registerAfterUpdateObjectProc(function(){e.scrollClientToCoord(t,Kekule.Editor.CoordSys.CHEM)})}finally{}}})}(),Kekule.Editor.StructureUtils={getCascadeDeleteObjs:function(e){return Kekule.ChemStructureUtils.getCascadeDeleteObjs(e)},getSurroundingObjs:function(e){var t=e.getLinkedObjs();if(e instanceof Kekule.ChemStructureConnector){var r=e.getConnectedObjs();Kekule.ArrayUtils.pushUnique(t,r)}return t},calcMostEmptyDirectionAngleOfChemObj:function(e,t,r){var i=[];t||(t=e.getLinkedObjs());for(var o=e.getAbsBaseCoord2D(r),n=0,a=t.length;n<a;++n){var s=t[n].getAbsBaseCoord2D(r);s=Kekule.CoordUtils.substract(s,o);var l=Math.atan2(s.y,s.x);l<0&&(l=2*Math.PI+l),i.push(l)}if(i.sort(),0===(a=i.length))return 0;if(1===a)return-i[0];var d=0,u=0;for(n=0;n<a;++n){var c=i[n],p=i[(n+1)%a]-c;p<0&&(p+=2*Math.PI),p>d&&(d=p,u=n)}return i[u]+d/2},calcPreferred2DBondGrowingDirection:function(e,t,r){var i=e.getAbsBaseCoord2D(r),o=Kekule.Editor.StructureUtils.getSurroundingObjs(e);switch(o?o.length:0){case 0:return t;case 1:var n=o[0].getAbsBaseCoord2D(r),a=Kekule.CoordUtils.substract(n,i),s=Math.atan2(a.y,a.x),l=s-t,d=s+t;return l<0&&(l+=2*Math.PI),d<0&&(d+=2*Math.PI),l!==d?Math.min(l>Math.PI?Math.abs(l-2*Math.PI):l,Math.abs(l-Math.PI))<=Math.min(d>Math.PI?Math.abs(d-2*Math.PI):d,Math.abs(d-Math.PI))?l:d:l;default:return Kekule.Editor.StructureUtils.calcMostEmptyDirectionAngleOfChemObj(e,o,r)}},calcPreferred2DBondGrowingLocation:function(e,t,r,i){var o=e.getAbsBaseCoord2D(i),n=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(e,r,i);return Kekule.CoordUtils.add(o,{x:t*Math.cos(n),y:t*Math.sin(n)})},isBondPropsMatch:function(e,t,r){var i=!0;return i&&r.indexOf("bondType")>=0&&(i=e.bondType==t.bondType||!e.bondType&&!t.bondType),i&&e.bondType===Kekule.BondType.COVALENT&&((i&&r.indexOf("bondOrder")>=0||!e.bondOrder&&!t.bondOrder)&&(i=e.bondOrder==t.bondOrder),i&&r.indexOf("stereo")>=0&&(i=e.stereo==t.stereo||!e.stereo&&!t.stereo)),i&&(i=Kekule.ObjUtils.equal(e,t,["bondType","bondOrder","stereo"])),i},getChemStructureNodeLabel:function(e,t,r){if(e.getIsotopeId){var i=e.getIsotopeId();if(r&&r.includeExplicitHydrogens){var o=e.getExplicitHydrogenCount&&e.getExplicitHydrogenCount();o>0&&(i+="H"),o>1&&(i+=o.toString())}return i}if(e instanceof Kekule.SubGroup){var n=e.getAbbr()||e.getFormulaText();return t&&(n=n||t.getRgroup()),n}var a=e.getCoreDisplayRichTextItem(null,null,t);return Kekule.Render.RichTextUtils.toText(a)},getAllChemStructureNodesLabel:function(e,t,r){for(var i,o=0,n=e.length;o<n;++o){var a=e[o],s=Kekule.Editor.StructureUtils.getChemStructureNodeLabel(a,t,r);if(i){if(i!==s)return null}else i=s}return i},getAllChemStructureNodesHtmlCode:function(e,t,r,i){for(var o,n=0,a=e.length;n<a;++n){var s=e[n].getCoreDisplayRichTextItem(t,r,i),l=Kekule.Render.RichTextUtils.toSimpleHtmlCode(s);if(o){if(o!==l)return null}else o=l}return o},getStructureCenterAbsBaseCoord:function(e,t,r){for(var i=null,o=Kekule.CoordUtils.add,n=e.getNodeCount(),a=0;a<n;++a){var s=e.getNodeAt(a).getAbsBaseCoord(t,r);i=i?o(i,s):s}return i=Kekule.CoordUtils.divide(i,n)}},Kekule.Editor.RepositoryStructureUtils={_calcNodeMergeAdjustRotateAngle:function(e,t,r){var i=0,o=e.getCoordMode();if(o!==Kekule.CoordMode.COORD3D){var n=e.getAllowCoordBorrow(),a=e.getEditorConfigs().getStructureConfigs(),s=Kekule.Editor.StructureUtils.getSurroundingObjs(t),l=Kekule.Editor.StructureUtils.getSurroundingObjs(r);if(1===s.length){var d=(p=t.getLinkedConnectorAt(0)).getBondOrder?p.getBondOrder():0,u=a.getNewBondDefAngle(r,d);h=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(r,u,n);var c=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(t,s[0],o,n);i=h-Math.atan2(c.y,c.x)}else if(1===l.length){d=(p=r.getLinkedConnectorAt(0)).getBondOrder?p.getBondOrder():0,u=a.getNewBondDefAngle(t,d);var p,h=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(t,u,n);c=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(r,l[0],o,n),i=Math.atan2(c.y,c.x)-h}else{u=a.getNewBondDefAngle(r,null),h=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(r,u,n);for(var g={},C=0,_=s.length;C<_;++C){c=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(t,s[C],o,n);var m=Math.atan2(c.y,c.x);(Kekule.ObjUtils.isUnset(g.min)||m<g.min)&&(g.min=m),(Kekule.ObjUtils.isUnset(g.max)||m>g.max)&&(g.max=m)}i=h-(g.max+g.min)/2}}return i},_calcConnectorMergeTransformParams:function(e,t,r){var i=t.getConnectedObjAt(0),o=t.getConnectedObjAt(1),n=r.getConnectedObjAt(0),a=r.getConnectedObjAt(1),s=e.getObjCoord(i),l=e.getObjCoord(o),d=e.getObjCoord(n),u=e.getObjCoord(a);return Kekule.CoordUtils.calcCoordGroup2DTransformParams(s,l,u,d)},calcRepObjInitialTransformParams:function(e,t,r,i,o){var n,a=r.baseObjCoord,s=e.getDefBondLength()/t.getRefLength(),l=a;if(r.mergeObj&&(i=r.mergeDest||i))if(o=e.getObjectScreenCoord(i),r.mergeObj instanceof Kekule.ChemStructureNode&&i instanceof Kekule.ChemStructureNode)n=Kekule.Editor.RepositoryStructureUtils._calcNodeMergeAdjustRotateAngle(e,r.mergeObj,i);else if(r.mergeObj instanceof Kekule.ChemStructureConnector&&i instanceof Kekule.ChemStructureConnector)return Kekule.Editor.RepositoryStructureUtils._calcConnectorMergeTransformParams(e,r.mergeObj,i);var d=e.translateCoord(o,Kekule.Editor.CoordSys.SCREEN,Kekule.Editor.CoordSys.CHEM);return a&&(d=Kekule.CoordUtils.substract(d,a)),{scale:s,translateX:d.x,translateY:d.y,translateZ:d.z,rotateAngle:n,center:l}},transformChemObjectsCoordAndSize:function(e,t,r){var i=e.getCoordMode(),o=e.getAllowCoordBorrow(),n=i===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(r):Kekule.CoordUtils.calcTransform2DMatrix(r),a=Object.extend({},r);a=Object.extend(a,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});for(var s=i===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(a):Kekule.CoordUtils.calcTransform2DMatrix(a),l=0,d=t.length;l<d;++l){var u=t[l];u.transformAbsCoordByMatrix(n,s,i,!0,o),u.scaleSize(r.scale,i,!0,o)}}},Kekule.Editor.OperationUtils={createNodeModificationOperation:function(e,t,r,i,o){var n,a,s=e.getClass();if(t&&!r&&(r=t.getClass()),t||r!==s){n=new Kekule.MacroOperation,t||(t=new r);var l=new Kekule.ChemStructureNode;l.assign(e),t.assign(l);var d=new Kekule.ChemStructOperation.ReplaceNode(e,t,null,o);n.add(d)}else t=e;return i&&(Kekule.ObjUtils.match(t,i)||(a=new Kekule.ChemObjOperation.Modify(t,i,o),n&&n.add(a))),n||a},createNodeModificationOperationFromData:function(e,t,r){if(!t)return null;var i,o=t.nodeClass,n=t.props,a=t.repositoryItem;if(a){var s=a.createObjects(e)||{},l=s.objects,d=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(r,a,s,e,null);r.transformCoordAndSizeOfObjects(l,d),o=(i=l[0]).getClass()}if(t.isUnknownPseudoatom&&!r.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()&&(o=null),o){if(n){var u=Object.extend({},n);if(e.getExplicitHydrogenCount&&e.getExplicitHydrogenCount()&&(u.explicitHydrogenCount=null),u.inputHydrogenCount&&u.isotopeId){var c,p=i||e;if(p&&p.getDisableImplicitHydrogenEstimation&&p.getDisableImplicitHydrogenEstimation())c=0;else{var h=e._getCurrCovalentBondsInfo&&e._getCurrCovalentBondsInfo()||{},g=e._getCurrIonicBondsInfo&&e._getCurrIonicBondsInfo()||{},C=Kekule.IsotopesDataUtil.getIsotopeIdDetail(u.isotopeId).symbol,_=Kekule.ChemicalElementsDataUtil.getAtomicNumber(C),m=Math.round(e.getCharge&&e.getCharge()||0),f=e.getRadical?Kekule.RadicalOrder.getRadicalElectronCount(e.getRadical()):0;c=Kekule.ChemStructureUtils.getImplicitHydrogenCount(_,{coValenceBondValenceSum:h.valenceSum||0,otherBondValenceSum:g.valenceSum||0,charge:m,radicalECount:f})}c!==u.inputHydrogenCount&&(u.explicitHydrogenCount=u.inputHydrogenCount,delete u.inputHydrogenCount)}}return Kekule.Editor.OperationUtils.createNodeModificationOperation(e,i,o,u,r)}return Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL")),null}},function(){"use strict";var e=Class.PropertyScope;Kekule.Editor.BaseEditorConfigs=Class.create(Kekule.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.Editor.BaseEditorConfigs",initProperties:function(){this.addConfigProp("uiMarkerConfigs","Kekule.EditorConfigs.UiMarkerConfigs"),this.addConfigProp("interactionConfigs","Kekule.EditorConfigs.InteractionConfigs"),this.addConfigProp("structureConfigs","Kekule.Editor.StructureConfigs"),this.addConfigProp("hotKeyConfigs","Kekule.Editor.HotKeyConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("uiMarkerConfigs",new Kekule.Editor.UiMarkerConfigs),this.setPropStoreFieldValue("interactionConfigs",new Kekule.Editor.InteractionConfigs),this.setPropStoreFieldValue("structureConfigs",new Kekule.Editor.StructureConfigs),this.setPropStoreFieldValue("hotKeyConfigs",new Kekule.Editor.HotKeyConfigs)}}),Kekule.Editor.ChemSpaceEditorConfigs=Class.create(Kekule.Editor.BaseEditorConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditorConfigs",initProperties:function(){this.addConfigProp("chemSpaceConfigs","Kekule.Editor.ChemSpaceConfigs"),this.addConfigProp("styleSetterConfigs","Kekule.Editor.StyleSetterConfigs",void 0,{scope:e.PUBLIC})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("chemSpaceConfigs",new Kekule.Editor.ChemSpaceConfigs),this.setPropStoreFieldValue("styleSetterConfigs",new Kekule.Editor.StyleSetterConfigs)}}),Kekule.ClassUtils.makeSingleton(Kekule.Editor.ChemSpaceEditorConfigs),Kekule.Editor.InteractionConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.InteractionConfigs",initProperties:function(){var t=Math.PI/180;this.addBoolConfigProp("enableTrackOnNearest",!0),this.addBoolConfigProp("enableHotTrack",!0),this.addBoolConfigProp("scrollToObjAfterLoading",!0),this.addBoolConfigProp("autoExpandClientSizeAfterLoading",!0),this.addBoolConfigProp("autoExpandClientSizeAfterManipulation",!1),this.addBoolConfigProp("autoSelectNewlyInsertedObjects",!1),this.addBoolConfigProp("autoSelectNewlyInsertedObjectsOnTouch",!0),this.addIntConfigProp("objBoundTrackMinInflation",5),this.addIntConfigProp("objBoundTrackMinInflationMouse",null),this.addIntConfigProp("objBoundTrackMinInflationPen",null),this.addIntConfigProp("objBoundTrackMinInflationTouch",10),this.addFloatConfigProp("objBoundTrackInflationRatio",.2),this.addFloatConfigProp("objBoundTrackInflationRatioMouse",null),this.addFloatConfigProp("objBoundTrackInflationRatioPen",null),this.addFloatConfigProp("objBoundTrackInflationRatioTouch",.33),this.addBoolConfigProp("enablePartialAreaSelecting",!1),this.addFloatConfigProp("selectingBrushWidth",12),this.addBoolConfigProp("enableOffSelectionManipulation",!0),this.addIntConfigProp("offSelectionManipulationActivatingTimeThreshold",800),this.addFloatConfigProp("unmovePointerDistanceThreshold",5,{scope:e.PUBLIC}),this.addIntConfigProp("selectingCurveSimplificationDistanceThreshold",2,{scope:e.PUBLIC}),this.addIntConfigProp("selectionMarkerInflation",5),this.addIntConfigProp("selectionMarkerEdgeInflation",5),this.addIntConfigProp("selectionMarkerDefPulseDuration",500),this.addIntConfigProp("selectionMarkerDefPulseCount",2),this.addBoolConfigProp("followPointerCoordOnDirectManipulatingSingleObj",!0),this.addIntConfigProp("followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold",2),this.addFloatConfigProp("constrainedResizeStep",.125),this.addIntConfigProp("rotationRegionInflation",10),this.addFloatConfigProp("constrainedRotateStep",7.5*t),this.addIntConfigProp("rotationLocationPointDistanceThreshold",10),this.addIntConfigProp("directedMoveDistanceThreshold",10),this.addBoolConfigProp("enableMergePreview",!0),this.addBoolConfigProp("enableMagneticMerge",!0),this.addBoolConfigProp("enableNodeMerge",!0),this.addBoolConfigProp("enableNeighborNodeMerge",!0),this.addBoolConfigProp("enableConnectorMerge",!0),this.addBoolConfigProp("enableStructFragmentMerge",!0),this.addBoolConfigProp("enableGestureManipulation",!0),this.addBoolConfigProp("enableGestureZoomOnEditor",!0),this.addBoolConfigProp("enableHotKey",!0),this.addIntConfigProp("clonedObjectScreenOffset",10),this.addIntConfigProp("atomSetterFontSize",14),this.addBoolConfigProp("allowUnknownAtomSymbol",!0),this.addBoolConfigProp("enableBondKekulizeHucklize",!0),this.addIntConfigProp("trackSimplifierDistanceThreshold",8),this.addIntConfigProp("trackSimplifierIgnoreSegmentThreshold",10),this.addIntConfigProp("trackMergeDistanceThreshold",20),this.addFloatConfigProp("trackOptimizationAngleConstraint",30*t),this.addConfigProp("trackOptimizationDistanceConstraints",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addIntConfigProp("trackOptimizationPrimaryDistanceConstraint",1),this.addFloatConfigProp("trackTouchRefLength",.5,{scope:e.PUBLIC}),this.addBoolConfigProp("autoAdjustZoomLevelOnTrackTouching",!1,{scope:e.PUBLIC}),this.addFloatConfigProp("editorInitialZoom",1.5)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setTrackOptimizationDistanceConstraints([.5,1,3,4,5])}}),Kekule.Editor.UiMarkerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.UiMarkerConfigs",initProperties:function(){this.addStrConfigProp("hotTrackerColor","#0000FF"),this.addFloatConfigProp("hotTrackerOpacity",.5),this.addStrConfigProp("selectionMarkerStrokeColor","#0000FF"),this.addFloatConfigProp("selectionMarkerStrokeWidth",2),this.addStrConfigProp("selectionMarkerFillColor","#0000FF"),this.addFloatConfigProp("selectionMarkerOpacity",.2),this.addFloatConfigProp("selectionMarkerEmphasisOpacity",.4),this.addFloatConfigProp("selectionTransformMarkerSize",8,{scope:e.PUBLIC}),this.addFloatConfigProp("selectionTransformMarkerOpacity",.4,{scope:e.PUBLIC}),this.addStrConfigProp("selectingMarkerStrokeColor","#000000"),this.addFloatConfigProp("selectingMarkerStrokeWidth",1),this.addStrConfigProp("selectingMarkerStrokeDash",!0),this.addStrConfigProp("selectingMarkerFillColor",null),this.addFloatConfigProp("selectingMarkerOpacity",.7),this.addStrConfigProp("selectingBrushMarkerStrokeColor","#0000FF"),this.addStrConfigProp("selectingBrushMarkerStrokeDash",!1),this.addFloatConfigProp("selectingBrushMarkerStrokeLineCap","round"),this.addFloatConfigProp("selectingBrushMarkerStrokeLineJoin","round"),this.addFloatConfigProp("selectingBrushMarkerOpacity",.3),this.addStrConfigProp("trackMarkerStrokeColor","#0000AA"),this.addFloatConfigProp("trackMarkerStrokeWidth",2),this.addStrConfigProp("trackMarkerStrokeDash",!1),this.addFloatConfigProp("trackMarkerOpacity",.5),this.addHashConfigProp("issueCheckMarkerColors",{error:{strokeColor:"#FF0000",fillColor:null,activeStrokeColor:"#FF0000",activeFillColor:"#FF6666"},warning:{strokeColor:"#f1a200",fillColor:null,activeStrokeColor:"#f1a200",activeFillColor:"#ffdb15"},note:{strokeColor:"#00b0f0",fillColor:null,activeStrokeColor:"#007ca8",activeFillColor:"#00b0f0"},log:{strokeColor:"#00b0f0",fillColor:null,activeStrokeColor:"#007ca8",activeFillColor:"#00b0f0"}}),this.addFloatConfigProp("issueCheckMarkerStrokeWidth",2),this.addFloatConfigProp("issueCheckActiveMarkerStrokeWidth",2),this.addStrConfigProp("issueCheckMarkerOpacity",.3),this.addStrConfigProp("issueCheckActiveMarkerOpacity",.6),this.addStrConfigProp("flexStructureAssocMarkerColor","#0000AA"),this.addFloatConfigProp("flexStructureAssocMarkerOpacity",.5),this.addIntConfigProp("flexStructureAssocMarkerFontSize",14),this.addStrConfigProp("flexStructureAssocMarkerFontFamily","Arial, Helvetica, sans-serif")}}),Kekule.Editor.StructureConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StructureConfigs",initProperties:function(){this.addStrConfigProp("defBondType",Kekule.BondType.DEFAULT,{enumSource:Kekule.BondType}),this.addIntConfigProp("defBondOrder",Kekule.BondOrder.SINGLE,{enumSource:Kekule.BondOrder}),this.addFloatConfigProp("defBondLength",Kekule.globalOptions.structure.defaultBondLength2D||.8),this.addConfigProp("defBondAngles",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addFloatConfigProp("bondConstrainedDirectionDelta",void 0,{scope:e.PUBLIC}),this.addConfigProp("bondConstrainedDirectionAngles",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addFloatConfigProp("bondConstrainedDirectionAngleThreshold",void 0,{scope:e.PUBLIC}),this.addFloatConfigProp("initialBondDirection",void 0,{scope:e.PUBLIC}),this.addStrConfigProp("defIsotopeId","C"),this.addConfigProp("primaryOrgChemAtoms",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addIntConfigProp("maxFlexChainAtomCount",0),this.addIntConfigProp("minFlexRingAtomCount",3),this.addIntConfigProp("maxFlexRingAtomCount",18),this.addHashConfigProp("enabledNonAtomNodeTypes",{RGroup:!0,pseudoatomDummy:!0,pseudoatomHetero:!0,pseudoatomAny:!0,variableAtomList:!0,variableAtomNotList:!0}),this.addHashConfigProp("enabledBondForms",{single:!0,double:!0,triple:!0,quad:!0,explicitAromatic:!0,up:!0,upInverted:!0,down:!0,downInverted:!0,upOrDown:!0,eOrZ:!0,closer:!0,ionic:!1,coordinate:!1,metallic:!1,hydrogen:!0})},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Math.PI/180,t=[],r=Kekule.BondOrder,i=2*Math.PI/3;t[0]=i,t[r.EXPLICIT_AROMATIC]=[i],t[r.TRIPLE]=[Math.PI],t[r.DOUBLE]=[i],t[r.DOUBLE][r.DOUBLE]=Math.PI,t[r.SINGLE]=[i],this.setDefBondAngles(t),this.setBondConstrainedDirectionDelta(10*Math.PI/180),this.setBondConstrainedDirectionAngles([0,90*e,180*e,270*e]),this.setBondConstrainedDirectionAngleThreshold(3*e),this.setInitialBondDirection(30*e),this.setPrimaryOrgChemAtoms(["C","H","O","N","P","S","F","Cl","Br","I","Si","D","C13"])},getDefAngleOfBonds:function(e,t){var r=e||0,i=t||0;r>i&&(r=t||0,i=e||0);var o=this.getDefBondAngles(),n=o[i];return n?n[r]||n[0]:o[0]},getNewBondDefAngle:function(e,t){var r;Kekule.ObjUtils.isUnset(t)&&(t=this.getDefBondOrder());var i=Kekule.Editor.StructureUtils.getSurroundingObjs(e);if(1===i.length){var o=e.getLinkedConnectorAt(0);if(o&&o.getConnectedObjs().indexOf(i[0])>=0){var n=o.getBondOrder?o.getBondOrder():null;Kekule.ObjUtils.notUnset(n)&&(r=this.getDefAngleOfBonds(t,n))}}else r=0===i.length?this.getInitialBondDirection():this.getDefAngleOfBonds(t,0);return r}}),Kekule.Editor.ChemSpaceConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceConfigs",initProperties:function(){this.addHashConfigProp("defScreenSize2D"),this.addHashConfigProp("defScreenSize3D"),this.addHashConfigProp("autoExpandScreenSize2D"),this.addHashConfigProp("autoExpandScreenSize3D"),this.addNumConfigProp("defPadding",50)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDefScreenSize2D({x:900,y:1500}),this.setDefScreenSize3D({x:600,y:600,z:600}),this.setAutoExpandScreenSize2D({x:200,y:200}),this.setAutoExpandScreenSize3D({x:100,y:100,z:100})}}),Kekule.Editor.StyleSetterConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StyleSetterConfigs",initProperties:function(){this.defineProp("listedFontSizes",{dataType:DataType.ARRAY}),this.defineProp("listedFontNames",{dataType:DataType.ARRAY})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setListedFontSizes([8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88,96]),this.setListedFontNames(Kekule.Widget.FontEnumerator.getAvailableFontFamilies())}}),Kekule.Editor.HotKeyConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.HotKeyConfigs",initProperties:function(){this.defineProp("hotKeys",{dataType:DataType.ARRAY})},initPropValues:function(){var e=Kekule.ChemWidget.ComponentWidgetNames;this.tryApplySuper("initPropValues"),this.setHotKeys([{key:"c",action:"atom_C"},{key:"h",action:"atom_H"},{key:"o",action:"atom_O"},{key:"n",action:"atom_N"},{key:"p",action:"atom_P"},{key:"s",action:"atom_S"},{key:"f",action:"atom_F"},{key:"Shift+C",action:"atom_Cl"},{key:"b",action:"atom_Br"},{key:"i",action:"atom_I"},{key:"Shift+B",action:"atom_B"},{key:"k",action:"atom_K"},{key:"Shift+N",action:"atom_Na"},{key:"d",action:"atom_D"},{key:"m",action:"subgroup_methyl"},{key:"e",action:"subgroup_ethyl"},{key:"t",action:"subgroup_TMS"},{key:"Shift+P",action:"subgroup_phenyl"},{key:"Shift+T",action:"subgroup_OTs"},{key:"Shift+E",action:"subgroup_COOCH3"},{key:"a",action:"atom_any"},{key:"q",action:"atom_hetero"},{key:"l",action:"atom_variable"},{key:"r",action:"subgroup_R"},{key:"1",action:"bond_single"},{key:"2",action:"bond_double"},{key:"3",action:"bond_triple"},{key:"4",action:"bond_quad"},{key:"b",action:"bond_closer"},{key:"w",action:"bond_up"},{key:"h",action:"bond_down"},{key:"Shift+W",action:"bond_down"},{key:"y",action:"bond_upOrDown"},{key:"Ctrl+A",action:e.selectAll},{key:"Ctrl+C",action:e.copy},{key:"Ctrl+X",action:e.cut},{key:"Ctrl+V",action:e.paste},{key:"Ctrl+Z",action:e.undo},{key:"Ctrl+Shift+Z",action:e.redo},{key:"+",action:e.zoomIn},{key:"-",action:e.zoomOut},{key:"Delete",action:e.eraseSelection},{key:"Backspace",action:e.eraseSelection}])}})}(),Kekule.Editor.RepositoryData={subGroups:[{name:"methyl",inputTexts:["Me","CH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Thu, 15 Sep 2016 15:49:02 GMT"},"__type__":"object"},"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Me","__type__":"Kekule.SubGroup"}'},{name:"ethyl",inputTexts:["Et","C2H5"],structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Et","__type__":"Kekule.SubGroup"}'},{name:"n-propyl",inputTexts:["n-Pr","nPr","C3H7"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Pr","formulaText":"C3H7","__type__":"Kekule.SubGroup"}'},{name:"i-propyl",inputTexts:["i-Pr","iPr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Pr","__type__":"Kekule.SubGroup"}'},{name:"n-butyl",inputTexts:["n-Bu","nBu","C4H9"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Bu","formulaText":"C4H9","__type__":"Kekule.SubGroup"}'},{name:"i-butyl",inputTexts:["i-Bu","iBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Bu","__type__":"Kekule.SubGroup"}'},{name:"s-butyl",inputTexts:["s-Bu","sBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"s-Bu","__type__":"Kekule.SubGroup"}'},{name:"t-butyl",inputTexts:["t-Bu","tBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"t-Bu","__type__":"Kekule.SubGroup"}'},{name:"phenyl",inputTexts:["Ph","C6H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ph","formulaText":"C6H5","__type__":"Kekule.SubGroup"}'},{name:"benzyl",inputTexts:["Bn"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bn","__type__":"Kekule.SubGroup"}'},{name:"benzoyl",inputTexts:["Bz"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bz","__type__":"Kekule.SubGroup"}'},{inputTexts:["CF3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CF3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CCl3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CCl3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CBr3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CBr3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CI3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CI3","__type__":"Kekule.SubGroup"}'},{inputTexts:["OMe","OCH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["OEt","OC2H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ot-Bu","OtBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275525,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275454,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.7763568394002505e-15,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ot-Bu","__type__":"Kekule.SubGroup"}'},{inputTexts:["CO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO","__type__":"Kekule.SubGroup"}'},{inputTexts:["CHO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CHO","__type__":"Kekule.SubGroup"}'},{name:"carboxyl",inputTexts:["COOH","CO2H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOH","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOOH","CO3H","CO2OH"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["COONa"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Na"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COONa","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOK"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"K"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOK","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOCH3","COOMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOC2H5","COOEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.039230484541326,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["COCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["COBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COBr","__type__":"Kekule.SubGroup"}'},{inputTexts:["CONH2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CONH2","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ac"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ac","__type__":"Kekule.SubGroup"}'},{inputTexts:["OAc"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OAc","__type__":"Kekule.SubGroup"}'},{inputTexts:["MeCO","COMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.3464101615137771,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.3464101615137771,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["EtCO","COEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COEt","__type__":"Kekule.SubGroup"}'},{name:"hydroxymethyl",inputTexts:["CH2OH"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999968,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CH2OH","__type__":"Kekule.SubGroup"}'},{inputTexts:["NMe2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NMe2","__type__":"Kekule.SubGroup"}'},{name:"nitro",inputTexts:["NO2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO2","__type__":"Kekule.SubGroup"}'},{name:"nitroso",inputTexts:["NO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO","__type__":"Kekule.SubGroup"}'},{name:"diazo",inputTexts:["N2","NN","N2 +"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Cl","NNCl","N2 +Cl-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +Cl-","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Br","NNBr","N2 +Br-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +Br-","__type__":"Kekule.SubGroup"}'},{name:"nitrile group",inputTexts:["CN"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CN","__type__":"Kekule.SubGroup"}'},{name:"pyridyl",inputTexts:["Py"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Py","__type__":"Kekule.SubGroup"}'},{name:"sulfonic group",inputTexts:["SO3H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000213,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000213,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.399999999999995,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Cl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Cl","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Br"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Br","__type__":"Kekule.SubGroup"}'},{inputTexts:["TMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"TMS","__type__":"Kekule.SubGroup"}'},{inputTexts:["OTMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTMS","__type__":"Kekule.SubGroup"}'},{name:"OTs",inputTexts:["OTs","OTS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":1.399999999999988,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":1.7999999999999936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275507,"y":1.399999999999988,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.SubGroup","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":-1.7999999999999936,"__type__":"object"},"charge":0,"parity":null}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[9,10]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTs","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgBr","__type__":"Kekule.SubGroup"}'}],fragments:[{name:"methane",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Sat, 25 Feb 2017 04:21:08 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"fischer1",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer2",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer3",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999972,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.6000000000000085,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,10]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"sawhorseStaggered",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:51:35 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34060000000000024,"y":-0.642199999999999,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.37219999999999764,"y":-1.0575999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.0877999999999997,"y":-0.648899999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3686000000000007,"y":-1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34060000000000024,"y":0.6422000000000061,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.0877999999999997,"y":0.6489000000000011,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3686000000000007,"y":1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"zIndex2D":0,"coord2D":{"x":0.3722000000000012,"y":1.0576000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-6","__type__":"Kekule.Molecule"}'},{name:"sawhorseEclipsed",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:50:51 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3022000000000009,"y":0.4405000000000001,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.4229000000000003,"y":0.8340999999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.1265,"y":0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"coord2D":{"x":0.44500000000000206,"y":1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.1265,"y":-1.6214000000000084,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.4015000000000004,"y":-1.2276999999999987,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3013999999999992,"y":-1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.38010000000000055,"y":-0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-5","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:43:26 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.5715736151962387,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9715297072546738,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.20235354281841378,"y":-0.12653156366939555,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.5714766561436155,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9715297072546738,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.20225658376579414,"y":0.1266285227220152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:44:10 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9716412105880998,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.5715992908679759,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.20239696641355032,"y":-0.14362717166194017,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9716412105880998,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.571696270727303,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.20239696641355032,"y":0.14372415152126905,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-2","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:47:35 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4999174283497734,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.4999174283497734,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:47:08 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.49991742834977515,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.49991742834977515,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":10,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:48:11 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.48039814732735664,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4815600495278858,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0006293636919529888,"y":-0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:48:04 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.4804171472781027,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":-1,"coord2D":{"x":-0.48158784071773564,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0005848625620670234,"y":-0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[4,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"substituentMark",dataFormat:"Kekule-JSON",scale:.7,structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Pseudoatom","coordPos2D":0,"coordPos3D":0,"renderOptions":{"nodeDisplayMode":-1,"__type__":"object"},"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"atomType":"any","symbol":"A"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"renderOptions":{"opacity":0.5,"__type__":"object"},"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'}]},function(){"use strict";Kekule.Editor.AbstractRepositoryItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.AbstractRepositoryItem",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAvailableCoordModes:function(){return[]},createObjects:function(e,t){},getScale:function(){return this.doGetScale()||1},doGetScale:function(){return 1},getRefLength:function(){return this.doGetRefLength()/(this.getScale()||1)},doGetRefLength:function(){},isOneStructureFragmentObj:function(){return!1}}),Kekule.Editor.MolRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.MolRepositoryItem2D",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("molScale",{dataType:DataType.FLOAT}),this.defineProp("molManipulationCenterCoord",{dataType:DataType.HASH}),this.defineProp("molManipulationDefDirectionCoord",{dataType:DataType.HASH})},doGetScale:function(){return this.getMolScale()||this.tryApplySuper("doGetScale")},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},isOneStructureFragmentObj:function(){return!0},createObjects:function(e,t){var r=this.doCreateObjects(e,t);if(!r)return null;var i=null,o=null,n={x:0,y:0};return e&&(i=e instanceof Kekule.ChemStructureNode?this.doGetMergableNode(r,e):e instanceof Kekule.ChemStructureConnector?this.doGetMergableConnector(r,e):null)&&(o=e,n=i.getAbsBaseCoord2D()),{objects:[r],mergeObj:i,mergeDest:o,baseObjCoord:n,centerCoord:{x:0,y:0}}},doCreateObjects:function(e,t){return null},doGetMergableNode:function(e,t){return null},doGetMergableConnector:function(e,t){return null}}),Kekule.Editor.StoredStructFragmentRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredStructFragmentRepositoryItem2D",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.beginUpdate();try{t&&this.setDataFormat(t),e&&this.setStructData(e),r&&this.setMolScale(r)}finally{this.endUpdate()}},initProperties:function(){this.defineProp("structureFragment",{dataType:"Kekule.StructureFragment",setter:null,serializable:!1}),this.defineProp("structData",{dataType:DataType.STRING}),this.defineProp("dataFormat",{dataType:DataType.STRING})},objectChange:function(e){if(this.tryApplySuper("objectChange",[e]),e.indexOf("structData")>=0||e.indexOf("dataFormat")>=0){var t=null;this.getStructData()&&(t=this._createTemplateStructFragment()),this.setPropStoreFieldValue("structureFragment",t)}},_createTemplateStructFragment:function(){var e=null;return this.getStructData()&&(e=Kekule.IO.loadFormatData(this.getStructData(),this.getDataFormat()||Kekule.IO.DataFormat.KEKULE_JSON)),e&&this._adjustTemplateStructureFragmentCoords(e),e},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var t=Kekule.Render.ObjUtils.getContainerBox(e,Kekule.CoordMode.COORD2D,!0);if(t){e.getCoordOfMode&&e.getCoordOfMode(Kekule.CoordMode.COORD2D,!0);var r={};r.x=-(t.x2+t.x1)/2,r.y=-(t.y2+t.y1)/2,e.beginUpdate();try{for(var i=0,o=e.getNodeCount();i<o;++i){var n=e.getNodeAt(i),a=n.getCoord2D(!0);a=Kekule.CoordUtils.add(a,r),n.setCoord2D(a)}}finally{e.endUpdate()}}},doGetRefLength:function(){var e=this.getStructureFragment();return e?e.getConnectorLengthMedian(Kekule.CoordMode.COORD2D,!0):0},doCreateObjects:function(e,t){var r=this.getStructureFragment();return r?r.clone():null},doGetMergableNode:function(e,t){return e.getAnchorNodeAt(0)||e.getNodeAt(0)},doGetMergableConnector:function(e,t){return null}}),Kekule.Editor.StoredSubgroupRepositoryItem2D=Class.create(Kekule.Editor.StoredStructFragmentRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredSubgroupRepositoryItem2D",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("inputTexts",{dataType:DataType.STRING})},doCreateObjects:function(e,t){var r=this.getStructureFragment();if(r){var i=new Kekule.SubGroup;return i.assign(r,!1),i}return null},createObjects:function(e){return this.tryApplySuper("createObjects",[e])},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var t=e.getCurrConnectableObj();if(t){var r=Kekule.CoordUtils.substract({x:0,y:0},t.getCoord2D(!0));e.beginUpdate();try{for(var i=0,o=e.getNodeCount();i<o;++i){var n=e.getNodeAt(i),a=n.getCoord2D(!0);a=Kekule.CoordUtils.add(a,r),n.setCoord2D(a)}}finally{e.endUpdate()}}}}),Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText=function(e){for(var t=Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[],r=0,i=t.length;r<i;++r){var o=t[r];if((o.getInputTexts()||[]).indexOf(e)>=0)return o}return null},Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems=function(){return Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[]},Kekule.Editor.MolRingRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolRingRepositoryItem2D",initialize:function(e,t){this.tryApplySuper("initialize"),this.setRingAtomCount(e),this.setBondLength(t||1)},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT}),this.defineProp("bondLength",{dataType:DataType.FLOAT,setter:function(e){e!==this.getBondLength()&&this.setPropStoreFieldValue("bondLength",e)}}),this.defineProp("isAromatic",{dataType:DataType.BOOL}),this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnableCoordCache()&&(this.setPropStoreFieldValue("enableCoordCache",e),e&&!this._coordCache&&this._initCoordCache())}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(e,t){var r=t&&t.originalStructFragment;return this.generateRing(r)},doGetMergableNode:function(e,t){return e.getNodeAt(0)},doGetMergableConnector:function(e,t){return e.getConnectorAt(0)},generateRing:function(e,t){var r;t||(t=Kekule.Molecule),r=e||new t;var i=this.getRingAtomCount();r.beginUpdate();try{r.setCoord2D({x:0,y:0});var o,n=r.getNodeCount();if(n>i)for(var a=n-1;a>=i;--a)r.removeNodeAt(a);for(a=r.getConnectorCount()-1;a>=0;--a)r.removeConnectorAt(a);o=this.getEnableCoordCache()&&this._hasCoordCache(i)?this._getCachedCoords(i):this._calcAtomCoords(i);var s,l,d,u=this.getBondLength();for(a=0;a<i;++a){var c=r.getNodeAt(a);c||(c=this._generateAtom(a),r.appendNode(c));var p=o[a];if(1!==u&&(p=Kekule.CoordUtils.multiply(p)),c.setCoord2D(p),0===a&&(d=c),s){var h=this._generateBond(l,a);r.appendConnector(h),h.appendConnectedObj(s),h.appendConnectedObj(c)}s=c,l=a}h=this._generateBond(i-1,0);r.appendConnector(h),h.appendConnectedObj(s),h.appendConnectedObj(d)}finally{r.endUpdate()}return r},_generateAtom:function(e){return new Kekule.Atom(null,"C")},_generateBond:function(e,t){var r=Kekule.BondOrder.SINGLE;return this.getIsAromatic()&&e%2&&(r=Kekule.BondOrder.DOUBLE),new Kekule.Bond(null,null,r)},_calcAtomCoords:function(e){for(var t=this.getEnableCoordCache(),r=Math.PI/e,i=2*r,o=.5/Math.sin(r),n=4===e||8===e?-Math.PI/2-i/2:-Math.PI/2,a=[],s=0;s<e;++s){var l={x:o*Math.cos(n),y:o*Math.sin(n)};a.push(l),t&&this._setCoordToCache(l,e,s),n+=i}return a},_initCoordCache:function(){this._coordCache=[];for(var e=3;e<13;++e)this._calcAtomCoords(e)},_clearCoordCache:function(){this._coordCache=[]},_setCoordToCache:function(e,t,r){var i=this._coordCache[t];i||(i=[],this._coordCache[t]=i),i[r]=e},_getCachedCoord:function(e,t){var r=this._coordCache[e];return r&&r[t]},_getCachedCoords:function(e){return this._coordCache[e]},_hasCoordCache:function(e){return!(!this._coordCache||!this._coordCache[e])}}),Kekule.Editor.MolChainRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolChainRepositoryItem2D",STEP_X_INC:Math.cos(30/180*Math.PI),STEP_Y_INC:Math.sin(30/180*Math.PI),initialize:function(e,t){this.tryApplySuper("initialize"),this.setAtomCount(e),this.setBondLength(t||1)},initProperties:function(){this.defineProp("atomCount",{dataType:DataType.INT}),this.defineProp("bondLength",{dataType:DataType.FLOAT}),this.defineProp("negativeDirection",{dataType:DataType.BOOL}),this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnableCoordCache()&&(this.setPropStoreFieldValue("enableCoordCache",e),e&&!this._coordCache&&this._initCoordCache())}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(e,t){var r=t&&t.originalStructFragment;return this.generateChain(r)},doGetMergableNode:function(e,t){return e.getNodeAt(0)},doGetMergableConnector:function(e,t){return null},generateChain:function(e,t){t||(t=Kekule.Molecule);var r=e||new t,i=this.getAtomCount(),o=this.getBondLength()||1,n=this.getNegativeDirection();r.beginUpdate();try{r.setCoord2D({x:0,y:0});var a=r.getNodeCount();if(a>i)for(var s=a-1;s>=i;--s)r.removeNodeAt(s);var l,d,u=r.getConnectorCount();if(u>i-1)for(s=u-1;s>=i-1;--s)r.removeConnectorAt(s);s=0;for(var c=i;s<c;++s){l=p;var p,h=!1;(p=r.getNodeAt(s))||(p=this._generateAtom(s),h=!0);var g=this._getCachedCoord(s);g||(g=this._calcAtomCoord(s)),1!==o&&(g=Kekule.CoordUtils.multiply(g,o)),n&&(g={x:g.x,y:-g.y}),p.setCoord2D(g),h&&r.appendNode(p),l&&h&&(d=this._generateBond(s-1,s),r.appendConnector(d),d.appendConnectedObj(l),d.appendConnectedObj(p))}}finally{r.endUpdate()}return this.setMolManipulationCenterCoord({x:0,y:0}),this.setMolManipulationDefDirectionCoord({x:1,y:0}),r},_generateAtom:function(e){return new Kekule.Atom(null,"C")},_generateBond:function(e,t){var r=Kekule.BondOrder.SINGLE;return new Kekule.Bond(null,null,r)},_calcAtomSetCoords:function(e){var t=this.getEnableCoordCache(),r={x:1*this.STEP_X_INC,y:1*this.STEP_Y_INC},i=[],o={x:0,y:0};i.push(o),this._coordCache[0]=o;for(var n=1,a=e;n<a;++n)o={x:o.x+r.x,y:n%2?r.y:0},i.push(o),t&&(this._coordCache[n]=o);return i},_calcAtomCoord:function(e){var t={x:1*this.STEP_X_INC,y:1*this.STEP_Y_INC},r={x:t.x*e,y:e%2?t.y:0};return this._coordCache&&(this._coordCache[e]=r),r},_initCoordCache:function(){this._coordCache=[];this._calcAtomSetCoords(30)},_clearCoordCache:function(){this._coordCache=[]},_getCachedCoord:function(e){return this._coordCache&&this._coordCache[e]}}),Kekule.Editor.PathGlyphRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.PathGlyphRepositoryItem2D",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setGlyphClass(e),this.setGlyphRefLength(t||1),this.setGlyphInitialParams(r)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT}),this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("glyphInitialParams",{dataType:DataType.HASH})},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},doGetRefLength:function(){return this.getGlyphRefLength()},createObjects:function(e){var t={x:0,y:0};return{objects:[this.generateGlyph()],mergeObj:null,mergeDest:null,baseObjCoord:t,centerCoord:t}},generateGlyph:function(){return new(this.getGlyphClass())(null,this.getGlyphRefLength(),this.getGlyphInitialParams())}}),Kekule.Editor.RepositoryItemManager={_itemClassMap:new Kekule.MapEx(!0),_itemNameMap:new Kekule.MapEx(!0),getAllItems:function(t){return e._itemClassMap.get(t)},getItem:function(t){return e._itemNameMap.get(t)},register:function(t){var r,i=t.getName();i&&(r=e.getItem(),e._itemNameMap.set(i,t));var o=t.getClass(),n=e.getAllItems(o);n?r?Kekule.ArrayUtils.replace(n,r,t):Kekule.ArrayUtils.pushUnique(n,t):(n=[t],e._itemClassMap.set(o,n))},unregister:function(t){var r=t.getClass(),i=e.getAllItems(r);i&&Kekule.ArrayUtils.remove(i,t);var o=t.getName();o&&e._itemNameMap.remove(o)}};var e=Kekule.Editor.RepositoryItemManager;Kekule._registerAfterLoadSysProc(function(){if(Kekule.Editor.RepositoryData){for(var t=0,r=(o=Kekule.Editor.RepositoryData.subGroups||[]).length;t<r;++t){var i=o[t];(n=new Kekule.Editor.StoredSubgroupRepositoryItem2D(i.structData,i.dataFormat,i.scale)).setInputTexts(i.inputTexts).setName(i.name||i.inputTexts[0]),e.register(n)}var o;for(t=0,r=(o=Kekule.Editor.RepositoryData.fragments||[]).length;t<r;++t){var n;i=o[t];(n=new Kekule.Editor.StoredStructFragmentRepositoryItem2D(i.structData,i.dataFormat,i.scale)).setName(i.name),e.register(n)}}})}(),function(){"use strict";var e=Kekule.ObjUtils,t=Kekule.ArrayUtils,r=Kekule.Widget.HtmlClassNames,i=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{STRUCTURE_NODE_SELECT_PANEL:"K-Chem-StructureNodeSelectPanel",STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureNodeSelectPanel-SetButton",STRUCTURE_NODE_SETTER:"K-Chem-StructureNodeSetter",STRUCTURE_NODE_SETTER_INPUTBOX:"K-Chem-StructureNodeSetter-InputBox",STRUCTURE_CONNECTOR_SELECT_PANEL:"K-Chem-StructureConnectorSelectPanel",STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureConnectorSelectPanel-SetButton",STRUCTURE_CONNECTOR_SELECT_PANEL_ADV:"K-Chem-StructureConnectorSelectPanelAdv",STRUCTURE_CONNECTOR_SELECT_PANEL_ADV_EXTRA_SECTION:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_KEKULIZE:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button-Kekulize",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_HUCKLIZE:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button-Hucklize",CHARGE_SELECT_PANEL:"K-Chem-Charge-SelectPanel",CHARGE_SELECT_PANEL_BTNGROUP:"K-Chem-Charge-SelectPanel-BtnGroup",CHARGE_SELECT_PANEL_CHARGE_BUTTON:"K-Chem-Charge-SelectPanel-ChargeButton",GLYPH_PATH_ARROW_SETTING_PANEL:"K-Chem-GlyphPath-Arrow-SettingPanel",GLYPH_PATH_ARROW_STYLE_BTNGROUP:"K-Chem-GlyphPath-Arrow-StyleButtonGroup",GLYPH_PATH_ARROW_STYLE_BUTTON:"K-Chem-GlyphPath-Arrow-StyleButton",GLYPH_PATH_ARROW_CONTINUOUS_SIDES_BTNGROUP:"K-Chem-GlyphPath-Arrow-ContinuousSidesButtonGroup",GLYPH_PATH_ARROW_CONTINUOUS_SIDES_BUTTON:"K-Chem-GlyphPath-Arrow-ContinuousSidesButton",GLYPH_Path_ARROW_SIZE_SETTER:"K-Chem-GlyphPath-Arrow-SizeSetter",GLYPH_REACTION_ARROW_PRESET_SELECTOR:"K-Chem-Glyph-ReactionArrow-PresetSelector",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonSet",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET_DROPDOWN:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonSet-DropDown",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON:"K-Chem-Glyph-ReactionArrow-PresetSelector-Button",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR:"K-Chem-Glyph-ElectronPushingArrow-PresetSelector",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BTNGROUP:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonGroup",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON:"K-Chem-Glyph-ElectronPushingArrow-PresetSelector-Button",GLYPH_PATH_LINE_SETTING_PANEL:"K-Chem-GlyphPath-Line-SettingPanel",GLYPH_PATH_SETTING_PANEL:"K-Chem-GlyphPath-SettingPanel",GLYPH_PATH_SETTING_PANEL_SECTION:"K-Chem-GlyphPath-SettingPanel-Section",GLYPH_PATH_SETTING_PANEL_SECTION_TITLE:"K-Chem-GlyphPath-SettingPanel-Section-Title",GLYPH_PATH_SETTING_PANEL_SECTION_PANEL:"K-Chem-GlyphPath-SettingPanel-Section-Panel",GLYPH_MULTIPATH_SETTING_PANEL:"K-Chem-GlyphMultiPath-SettingPanel",GLYPH_MULTIPATH_SETTING_PANEL_PATH_TABGROUP:"K-Chem-GlyphMultiPath-SettingPanel-PathTabGroup",GLYPH_MULTIPATH_SETTING_PANEL_PATH_SETTING_PANEL:"K-Chem-GlyphMultiPath-SettingPanel-PathSettingPanel",GLYPH_REACTION_ARROW_PATH_SETTING_PANEL:"K-Chem-ReactionArrow-SettingPanel",GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION:"K-Chem-ReactionArrow-SettingPanel-ArrowPresetSection",GLYPH_ARC_PATH_SETTING_PANEL:"K-Chem-ArcPath-SettingPanel",GLYPH_MULTIARC_PATH_SETTING_PANEL:"K-Chem-MultiArcPath-SettingPanel",GLYPH_ELECTRON_PUSHING_ARROW_SETTING_PANEL:"K-Chem-ElectronPusingArrow-SettingPanel",GLYPH_MULTI_ELECTRON_PUSHING_ARROW_SETTING_PANEL:"K-Chem-MultiElectronPusingArrow-SettingPanel"}),Kekule.ChemWidget.StructureNodeSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSelectPanel",BTN_DATA_FIELD:"__$btn_data__",initialize:function(e){this.setPropStoreFieldValue("displayElements",!0),this.setPropStoreFieldValue("displayNonElements",!0),this.setPropStoreFieldValue("displaySubgroups",!0),this.tryApplySuper("initialize",[e]),this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null}),this.defineProp("elementSymbols",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("nonElementInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("subGroupInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("subGroupRepItems",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("subGroupRepItems",e),this._updateSubGroupInfosFromRepItems(e)}}),this.defineProp("displayElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("displayNonElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("displaySubgroups",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("activeNode",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("activeNode",e),this.activeNodeChanged(e)}}),this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PRIVATE,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("periodicTableDialog");if(!t&&e){var r=this.getCoreElement(),i=this.getDocument();t=this._createPeriodicTableDialogWidget(i,r),this.setPropStoreFieldValue("periodicTableDialog",t)}return t}})},initPropValues:function(){return this.tryApplySuper("initPropValues")},doFinalize:function(){var e=this.getPeriodicTableDialog();e&&e.finalize(),this.tryApplySuper("doFinalize")},setSelectableInfos:function(e){this.beginUpdate();try{this.setPropValues(e)}finally{this.endUpdate()}},reactSelButtonExec:function(e){var t=this,r=e.target;if(this._selButtons.indexOf(r)>=0){var i=r[this.BTN_DATA_FIELD];i&&(i.isPeriodicTable?this._openPeriodicTableDialog(r,function(e){if(e===Kekule.Widget.DialogButtons.OK){var r=t._periodicTable.getSelectedSymbol();t.doValueChanged(t.generateSelectableDataFromElementSymbol(r))}},{isSimpleAtom:!0}):i.isVarList||i.isVarNotList?this._openPeriodicTableDialog(r,function(e){if(e===Kekule.Widget.DialogButtons.OK){var r=t._periodicTable.getSelectedSymbols(),o=Kekule.VariableAtom,n=i.isVarList?{allowedIsotopeIds:r,disallowedIsotopeIds:null}:{allowedIsotopeIds:null,disallowedIsotopeIds:r};t.doValueChanged({nodeClass:o,props:n})}},{isVarList:i.isVarList,isVarNotList:i.isVarNotList}):this.doValueChanged(i))}},doValueChanged:function(e){this.setPropStoreFieldValue("value",e),this.invokeEvent("valueChange",{value:{nodeClass:e.nodeClass,props:e.props,repositoryItem:e.repositoryItem}})},activeNodeChanged:function(e){},doObjectChange:function(e){Kekule.ArrayUtils.intersect(e,["elementSymbols","nonElementInfos","subGroupInfos","displayElements","displayNonElements","displaySubGroups"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.STRUCTURE_NODE_SELECT_PANEL},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updatePanelContent(e,this.getChildrenHolderElement()),r},_updateSubGroupInfosFromRepItems:function(e){var t=[];if(e&&e.length){for(var r=0,i=e.length;r<i;++r){var o=e[r],n=o.getStructureFragment(),a=n.getAbbr();if(!a){var s=n.getFormulaText(),l=Kekule.FormulaUtils.textToFormula(s).getDisplayRichText();a=Kekule.Render.RichTextUtils._toDebugHtml(l)}var d={text:a,repositoryItem:o,nodeClass:n.getClass(),node:n,hint:o.getName()};t.push(d)}this.setSubGroupInfos(t)}},updatePanelContent:function(e,t){if(this._selButtons)for(var r=this._selButtons.length-1;r>=0;--r){var i=this._selButtons[r];this.removeWidget(i)}this._selButtons=[],Kekule.DomUtils.clearChildContent(t);var o=this.generateSelectableData(),n=this._getDisplayedTabPageNames(),a=new Kekule.Widget.TabView(this);if(n.indexOf("atom")>=0){var s=a.createNewTabPage(Kekule.$L("ChemWidgetTexts.CAPTION_ATOM"));if(this.getDisplayElements())this.doCreateSelButtonSection(e,s.getCoreElement(),o.elementData);if(this.getDisplayNonElements())this.doCreateSelButtonSection(e,s.getCoreElement(),o.nonElementData,!0)}if(n.indexOf("subgroup")>=0){var l=a.createNewTabPage(Kekule.$L("ChemWidgetTexts.CAPTION_SUBGROUP"));this.doCreateSelButtonSection(e,l.getCoreElement(),o.subGroupData,!0)}a.setShowTabButtons(n.length>1)},_getDisplayedTabPageNames:function(){var e=[];return(this.getDisplayElements()||this.getDisplayNonElements())&&e.push("atom"),this.getDisplaySubgroups()&&e.push("subgroup"),e},generateSelectableDataFromElementSymbol:function(e){var t=e,r=Kekule.IsotopesDataUtil.getIsotopeInfoById(e);return r&&(t=r.isotopeAlias?r.isotopeAlias:"<sup>"+r.massNumber+"</sup>"+r.elementSymbol),{text:t,nodeClass:Kekule.Atom,props:{isotopeId:e}}},generateSelectableData:function(){for(var e=this.getElementSymbols()||[],t=[],r=0,i=e.length;r<i;++r){var o;o="..."===e[r]?{text:"â¦",nodeClass:null,hint:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE"),isPeriodicTable:!0}:this.generateSelectableDataFromElementSymbol(e[r]),t.push(o)}return{elementData:t,nonElementData:this.getNonElementInfos(),subGroupData:this.getSubGroupInfos()}},doCreateSelButton:function(e,t,r,o){var n=r.text;o&&r.description&&(n+='<span style="font-size:80%"> '+r.description+"</span>");var a=new(0,Kekule.Widget.Button)(e,n);return a.addClassName(i.STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON),a.setGroup&&a.setGroup(this.getClassName()),r.hint&&a.setHint(r.hint),a[this.BTN_DATA_FIELD]=r,this._selButtons.push(a),a},doCreateSectionSelButtons:function(e,t,r,i){if(r)for(var o=0,n=r.length;o<n;++o){var a=this.doCreateSelButton(e,t,r[o],i);a.setParent(this),a.appendToElem(t)}},doCreateSection:function(e,t){var i=e.createElement("div");return i.className=r.SECTION,t&&t.appendChild(i),i},doCreateSelButtonSection:function(e,t,r,i){var o=this.doCreateSection(e,t);return this.doCreateSectionSelButtons(e,o,r,i),o},_createPeriodicTableDialogWidget:function(e,t){var r=new Kekule.Widget.Dialog(e,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]),i=new Kekule.ChemWidget.PeriodicTable(e);return i.setUseMiniMode(!0).setEnableSelect(!0),i.setParent(r),i.appendToElem(r.getClientElem()),this._periodicTable=i,r},_openPeriodicTableDialog:function(e,t,r){var i=this.getPeriodicTableDialog(!0),o=r.isVarList||r.isVarNotList;this._periodicTable.setEnableMultiSelect(o).setSelectedSymbol(null);var n=this.getActiveNode();if((r.isVarList||r.isVarNotList)&&n instanceof Kekule.VariableAtom){var a=n.getAllowedIsotopeIds(),s=n.getDisallowedIsotopeIds();this._periodicTable.setSelectedSymbols(r.isVarList?a:s)}!o&&n instanceof Kekule.Atom&&this._periodicTable.setSelectedSymbol(n.getSymbol()),i.openPopup(t,e||this)}}),Kekule.ChemWidget.StructureNodeSetter=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSetter",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueSetBySelectPanel=!1},initProperties:function(){this.defineProp("enableHydrogenCountInput",{dataType:DataType.BOOL}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=Kekule.ArrayUtils.toArray(e);this.setPropStoreFieldValue("nodes",t),this.nodesChanged(t)}}),this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("value");if(!e&&!this._valueSetBySelectPanel){var t=this.getNodeInputBox().getValue();e=this._getValueFromDirectInputText(t)}return e}}),this.defineProp("nodeLabel",{dataType:DataType.STRING,serializable:!1,setter:null,getter:function(){return this.getNodeInputBox().getValue()}}),this.defineProp("nodeInputBox",{dataType:"Kekule.Widget.ButtonTextBox",serializable:!1,setter:!1}),this.defineProp("nodeInputBoxFontSize",{dataType:DataType.STRING,serializable:!1,setter:function(e){this.getNodeInputBox().getTextBox().getElement().style.fontSize=e,this.setPropStoreFieldValue("nodeInputBoxFontSize",e)}}),this.defineProp("nodeSelectPanel",{dataType:"Kekule.ChemWidget.StructureNodeSelectPanel",serializable:!1,setter:!1}),this.defineProp("showInputBox",{dataType:DataType.BOOL,getter:function(){return this.getNodeInputBox().getDisplayed()},setter:function(e){this.getNodeInputBox().setDisplayed(e)}}),this.defineProp("showSelectPanel",{dataType:DataType.BOOL,getter:function(){return this.getNodeSelectPanel().getDisplayed()},setter:function(e){this.getNodeSelectPanel().setDisplayed(e)}}),this.defineProp("useDropDownSelectPanel",{dataType:DataType.BOOL,setter:function(e){this.getUseDropDownSelectPanel()!==e&&(this.setPropStoreFieldValue("useDropDownSelectPanel",e),this._updateDropDownSettings(e))}}),this.defineProp("labelConfigs",{dataType:DataType.OBJECT,serializable:!1}),this._defineSelectPanelDelegatedProp("selectableElementSymbols","elementSymbols"),this._defineSelectPanelDelegatedProp("selectableNonElementInfos","nonElementInfos"),this._defineSelectPanelDelegatedProp("selectableSubGroupInfos","subGroupInfos"),this._defineSelectPanelDelegatedProp("selectableSubGroupRepItems","subGroupRepItems"),this._defineSelectPanelDelegatedProp("displaySelectableElements","displayElements"),this._defineSelectPanelDelegatedProp("displaySelectableNonElements","displayNonElements"),this._defineSelectPanelDelegatedProp("displaySelectableSubgroups","displaySubgroups")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableHydrogenCountInput(!0)},doFinalize:function(){var e=this.getNodeSelectPanel();e&&e.finalize();var t=this.getNodeInputBox();t&&t.finalize(),this.tryApplySuper("doFinalize")},_defineSelectPanelDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(Kekule.ChemWidget.StructureNodeSelectPanel,t),i=Object.create(r);return i.getter=null,i.setter=null,r.getter&&(i.getter=function(){return this.getNodeSelectPanel().getPropValue(t)}),r.setter&&(i.setter=function(e){this.getNodeSelectPanel().setPropValue(t,e)}),this.defineProp(e,i)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.STRUCTURE_NODE_SETTER},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),o=this,n=new Kekule.Widget.ButtonTextBox(this);this.setPropStoreFieldValue("nodeInputBox",n),n.addClassName(i.STRUCTURE_NODE_SETTER_INPUTBOX),n.appendToElem(this.getCoreElement()),n.addEventListener("valueChange",function(e){o._valueSetBySelectPanel=!1,e.stopPropagation()}),n.addEventListener("keyup",function(e){var t=e.htmlEvent.getKeyCode();t===Kekule.X.Event.KeyCode.ENTER&&o._applyDirectInput(),o.getUseDropDownSelectPanel()&&(t===Kekule.X.Event.KeyCode.DOWN?o.showNodeSelectPanel():t===Kekule.X.Event.KeyCode.UP&&o.hideNodeSelectPanel())}),n.addEventListener("blur",function(e){e.target===n.getTextBox()&&n.getIsDirty()&&o._applyDirectInput()}),n.getButton().addEventListener("execute",function(e){o.getUseDropDownSelectPanel()?o.toggleNodeSelectPanel():o._applyDirectInput()});var a=new Kekule.ChemWidget.StructureNodeSelectPanel(this);return this.setPropStoreFieldValue("nodeSelectPanel",a),a.appendToElem(this.getCoreElement()),a.addEventListener("valueChange",function(e){Object.extend({},e);e.stopPropagation(),o._valueSetBySelectPanel=!0,o.doValueChanged(e.value,!0),o.getUseDropDownSelectPanel()&&a.hide()}),this._updateDropDownSettings(this.getUseDropDownSelectPanel()),r},_updateDropDownSettings:function(e){var t=this.getNodeInputBox(),r=this.getNodeSelectPanel();e?(t.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),r.removeFromDom(),r.hide(null,null,Kekule.Widget.ShowHideType.DEFAULT)):(t.setButtonKind(Kekule.Widget.Button.Kinds.ENTER),r.appendToElem(this.getCoreElement()),r.setStyleProperty("position",""),r.show(null,null,Kekule.Widget.ShowHideType.DEFAULT))},_indexOfNonElementLabel:function(e){for(var t=this.getNonAtomLabelInfos(),r=0,i=t.length;r<i;++r){if(t[r].nodeLabel===e)return r}return-1},_getNonAtomInfo:function(e){var t=this.getSelectableNonElementInfos();if(t)for(var r=0,i=t.length;r<i;++r){var o=t[r];if(o.text===e)return o}return null},_getNodeWithExplicitHInfo:function(e){var t={},r=e.trim().match(/^(\d*[A-Z][a-z]?\d*)H(\d*)$/);return r?(t.core=r[1],t.explicitHCount=parseInt(r[2])||1):t.core=e,t},_getValueFromDirectInputText:function(e){var t,r,i,o,n,a=this._getNonAtomInfo(e);if(a)t=a.nodeClass,r=a.props;else{var s=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(e);if(i=s,s)t=s.getStructureFragment().getClass();else if(e){var l=e;if(!(t=Kekule.ChemStructureNodeFactory.getClassByLabel(l,null))){if(this.getEnableHydrogenCountInput()){var d=this._getNodeWithExplicitHInfo(l);d.explicitHCount&&(t=Kekule.ChemStructureNodeFactory.getClassByLabel(d.core,null))&&(n=d.explicitHCount,l=d.core)}t||(t=Kekule.Pseudoatom,o=!0)}r=t===Kekule.Atom?{isotopeId:l,inputHydrogenCount:n}:t===Kekule.Pseudoatom?{symbol:e}:{}}}return{nodeClass:t,props:r,repositoryItem:i,isUnknownPseudoatom:o}},_applyDirectInput:function(){this._valueSetBySelectPanel=!1;var e=this.getNodeInputBox();if(e.getIsDirty()){var t=e.getValue(),r=this._getValueFromDirectInputText(t);this.doValueChanged(r),e.setIsDirty(!1)}else this.doValueChanged(null)},_getVarAtomListLabel:function(){var e=this.getLabelConfigs();return e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var e=this.getLabelConfigs();return"~"+(e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM)},_getAllNodeLabels:function(e){var t={};return this.getEnableHydrogenCountInput()&&(t.includeExplicitHydrogens=!0),Kekule.Editor.StructureUtils.getAllChemStructureNodesLabel(e,this.getLabelConfigs(),t)},nodesChanged:function(e){var t=this._getAllNodeLabels(e)||"",r=t?e[0]:null;this.getNodeSelectPanel().setActiveNode(r),this.getNodeInputBox().setValue(t),this.getNodeInputBox().setIsDirty(!1),this.setPropStoreFieldValue("value",null),this._valueSetBySelectPanel=!1},doValueChanged:function(e,t){this.setPropStoreFieldValue("value",e);var r=e&&{nodeClass:e.nodeClass,props:e.props,repositoryItem:e.repositoryItem,isUnknownPseudoatom:e.isUnknownPseudoatom};t&&this.invokeEvent("valueSelect",{value:r}),this.invokeEvent("valueChange",{value:r})},setSelectableInfos:function(e){this.getNodeSelectPanel().setSelectableInfos(e)},showNodeSelectPanel:function(){var e=this.getNodeSelectPanel();e.isShown()||e.show(this.getNodeInputBox(),null,Kekule.Widget.ShowHideType.DROPDOWN)},hideNodeSelectPanel:function(){var e=this.getNodeSelectPanel();e.isShown()&&e.hide()},toggleNodeSelectPanel:function(){var e=this.getNodeSelectPanel();e.isShown()?e.hide():e.show(this.getNodeInputBox(),null,Kekule.Widget.ShowHideType.DROPDOWN)}}),Kekule.ChemWidget.StructureConnectorSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureConnectorSelectPanel",BTN_DATA_FIELD:"__$btn_data__",BTN_GROUP:"__$bond_btn_group__",initialize:function(e){this.tryApplySuper("initialize",[e]),this._selButtons=[],this._activeBtn=null,this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null}),this.defineProp("bondData",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("activeBondPropValues",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("activeBondPropValues",e),this.activeBondPropsChanged(e)}}),this.defineProp("activeBondHtmlClass",{dataType:DataType.STRING,scope:Class.PropertyScope.PRIVATE,setter:null,getter:function(){var e=this._activeBtn;if(e){var t=e[this.BTN_DATA_FIELD];return t&&t.htmlClass}return null}}),this.defineProp("bondPropNames",{dataType:DataType.ARRAY,serializable:!1})},doObjectChange:function(e){Kekule.ArrayUtils.intersect(e,["bondData"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.STRUCTURE_CONNECTOR_SELECT_PANEL},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updatePanelContent(e,t),r},activeBondPropsChanged:function(e){if(this._activeBtn&&(this._activeBtn.setChecked(!1),this._activeBtn=null),e)for(var t=this._selButtons,r=0,i=t.length;r<i;++r){var o=t[r][this.BTN_DATA_FIELD];if(o&&this._isBondPropsMatch(e,o.bondProps,this.getBondPropNames())){t[r].setChecked(!0),this._activeBtn=t[r];break}}},_isBondPropsMatch:function(e,t,r){return Kekule.Editor.StructureUtils.isBondPropsMatch(e,t,r)},reactSelButtonExec:function(e){var t=e.target;if(this._selButtons.indexOf(t)>=0){this._activeBtn=t;var r=t[this.BTN_DATA_FIELD];r&&(this.setPropStoreFieldValue("activeBondPropValues",r.bondProps),this.doValueChanged(r.bondProps))}},doValueChanged:function(e){this.setPropStoreFieldValue("value",e),this.invokeEvent("valueChange",{value:e})},updatePanelContent:function(e,r){if(this._selButtons)for(var i=this._selButtons.length-1;i>=0;--i){var o=this._selButtons[i];this.removeWidget(o)}var n=[];this._selButtons=[];var a=this.getBondData();if(a){i=0;for(var s=a.length;i<s;++i){var l=a[i],d=l.bondProps;(o=this._createBondSelButton(e,l)).appendToElem(r),this._selButtons.push(o),d&&t.pushUnique(n,Kekule.ObjUtils.getOwnedFieldNames(d))}}this.getBondPropNames()||this.setPropStoreFieldValue("bondPropNames",n)},_createBondSelButton:function(e,t){var r=new Kekule.Widget.RadioButton(this);return r.addClassName(i.STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON),r.setGroup(this.BTN_GROUP).setShowGlyph(!0).setShowText(!1),r.setText(t.text||null).setHint(t.hint||t.description||null),t.htmlClass&&r.addClassName(t.htmlClass),r[this.BTN_DATA_FIELD]=t,r}}),Kekule.ChemWidget.StructureConnectorSelectPanelAdv=Class.create(Kekule.ChemWidget.StructureConnectorSelectPanel,{CLASS_NAME:"Kekule.ChemWidget.StructureConnectorSelectPanelAdv",initialize:function(e){this.setPropStoreFieldValue("extraComponents",[Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE]),this._additionalCompWidgets=[],this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("extraComponents",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.STRUCTURE_CONNECTOR_SELECT_PANEL_ADV},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]);Kekule.ArrayUtils.intersect(e,["extraComponents"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},updatePanelContent:function(e,t){this.clearAdditionalSections(),this.tryApplySuper("updatePanelContent",[e,t]);var r=this.getExtraComponents();r&&r.indexOf(Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE)>=0&&this._createKekulizeSection(e,t).appendToElem(t)},reactSelButtonExec:function(e){this.tryApplySuper("reactSelButtonExec",[e]);var t=e.target;t._command&&this.invokeEvent("command",{command:t._command})},clearAdditionalSections:function(){if(this._additionalCompWidgets){for(var e=0,t=this._additionalCompWidgets.length;e<t;++e){this._additionalCompWidgets[e].finalize()}this._additionalCompWidgets=[]}},createAdditionalSection:function(e,t){var r=new Kekule.Widget.Container(e);return r.addClassName(i.STRUCTURE_CONNECTOR_SELECT_PANEL_ADV_EXTRA_SECTION),this._additionalCompWidgets.push(r),r.appendToElem(t),r.setParent(this),r},_createKekulizeSection:function(e,t){var r=this.createAdditionalSection(e,t),o=new Kekule.Widget.Button(r);o.addClassName([i.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON,i.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_KEKULIZE]).setText(Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_KEKULIZE")).setHint(Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_KEKULIZE")).setShowGlyph(!0).setShowText(!1),o._command=Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands.KEKULIZE,r.appendWidget(o);var n=e.createElement("span");Kekule.DomUtils.setElementText(n," â â¶ "),r.getElement().appendChild(n);var a=new Kekule.Widget.Button(r);return a.addClassName([i.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON,i.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_HUCKLIZE]).setText(Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_HUCKLIZE")).setHint(Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_HUCKLIZE")).setShowGlyph(!0).setShowText(!1),a._command=Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands.HUCKLIZE,r.appendWidget(a),r}}),Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components={KEKULIZE:"kekulize"},Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands={KEKULIZE:"kekulize",HUCKLIZE:"hucklize"},Kekule.ChemWidget.ChargeSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.ChargeSelectPanel",CHARGE_FIELD:"__$charge__",initialize:function(e){this._chargeBtnGroups={},this._selectedButton=null,this._chargeButtonMap=[],this.setPropStoreFieldValue("maxCharge",4),this.setPropStoreFieldValue("minCharge",-4),this.tryApplySuper("initialize",[e]),this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getValue();if(e!==t){var r=this._chargeButtonMap[t];r&&(r.setChecked(!1),r.blur()),this.setPropStoreFieldValue("value",e);var i=this._chargeButtonMap[e];i&&i.setChecked(!0),this._selectedButton=i}}}),this.defineProp("minCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!==this.getMinCharge()&&(this.setPropStoreFieldValue("minCharge",e),this.updateChargeButtons())}}),this.defineProp("maxCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!==this.getMaxCharge()&&(this.setPropStoreFieldValue("maxCharge",e),this.updateChargeButtons())}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.CHARGE_SELECT_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updateChargeButtons(e,t),r},updateChargeButtons:function(e,t){for(var r=this._chargeBtnGroups,o=["zero","positive","negative"],n=0,a=o.length;n<a;++n){(s=r[o[n]])?s.clearWidgets():((s=new Kekule.Widget.ButtonGroup(this)).addClassName(i.CHARGE_SELECT_PANEL_BTNGROUP),s.appendToElem(t),r[o[n]]=s)}var s,l=Math.floor(this.getMaxCharge()),d=Math.floor(this.getMinCharge()),u=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE"),c=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE");if(l>=1&&(s=this._chargeBtnGroups.positive))for(n=Math.max(d,1);n<=l;++n)this._createChargeButton(s,n,n+u);l>=0&&d<=0&&((s=this._chargeBtnGroups.zero)&&this._createChargeButton(s,0,Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NONE"),Kekule.$L("ChemWidgetTexts.HINT_CHARGE_NONE")));if(d<=-1&&(s=this._chargeBtnGroups.negative))for(n=Math.min(l,-1);n>=d;--n)this._createChargeButton(s,n,Math.abs(n)+c)},_createChargeButton:function(e,t,r,o){var n=new Kekule.Widget.RadioButton(e,r);return n[this.CHARGE_FIELD]=t,this._chargeButtonMap[t]=n,o&&n.setHint(o),n.addClassName(i.CHARGE_SELECT_PANEL_CHARGE_BUTTON),n.appendToWidget(e),this.getValue()===t&&(n.setChecked(!0),this._selectedButton=n),n},reactSelButtonExec:function(e){var t=e.target[this.CHARGE_FIELD];Kekule.ObjUtils.notUnset(t)&&(this.setValue(t),this.notifyValueChange(t))},notifyValueChange:function(e){this.invokeEvent("valueChange",{value:e})}}),Kekule.ChemWidget.GlyphPathArrowSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathArrowSettingPanel",DATA_FIELD:"__$data$__",initialize:function(e){this._isSettingValue=!1,this._arrowWidthInputter=null,this._arrowLengthInputter=null,this._arrowStyleButtons=null,this.setPropStoreFieldValue("arrowWidthMin",0),this.setPropStoreFieldValue("arrowWidthMax",.5),this.setPropStoreFieldValue("arrowWidthStep",.1),this.setPropStoreFieldValue("arrowLengthMin",0),this.setPropStoreFieldValue("arrowLengthMax",.5),this.setPropStoreFieldValue("arrowLengthStep",.1),this.setPropStoreFieldValue("showContinousArrowSidesSetter",!1),this.setPropStoreFieldValue("defaultValue",{arrowType:Kekule.Glyph.ArrowType.NONE,arrowSide:Kekule.Glyph.ArrowSide.BOTH}),this.tryApplySuper("initialize",[e]),this.addEventListener("check",this.reactArrowStyleButtonCheck.bind(this)),this.addEventListener("valueChange",this.reactArrowSizeInputterChange.bind(this)),this.addEventListener("valueInput",this.reactArrowSizeInputterInput.bind(this))},initProperties:function(){this.defineProp("defaultValue",{dataType:DataType.HASH,scope:Class.PropertyScope.PRIVATE}),this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("value");return e||(e={},this.setPropStoreFieldValue("value",e)),e},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e);for(var t=Object.extend(Object.extend({},this.getDefaultValue()),e,!1,!0),r=0,i=this._arrowStyleButtons.length;r<i;++r){var o=this._arrowStyleButtons[r],n=o[this.DATA_FIELD];n.arrowType!==t.arrowType||n.arrowSide!==t.arrowSide&&n.arrowType!==Kekule.Glyph.ArrowType.NONE?o.setChecked(!1):o.setChecked(!0)}this._arrowWidthInputter.setValue(t.arrowWidth||0),this._arrowLengthInputter.setValue(t.arrowLength||0)}finally{this._isSettingValue=!1}}}),this.defineProp("allowedArrowTypes",{dataType:DataType.ARRAY}),this.defineProp("allowedArrowSides",{dataType:DataType.ARRAY}),this.defineProp("arrowWidthMin",{dataType:DataType.NUMBER}),this.defineProp("arrowWidthMax",{dataType:DataType.NUMBER}),this.defineProp("arrowWidthStep",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthMin",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthMax",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthStep",{dataType:DataType.NUMBER})},doObjectChange:function(e){(e.indexOf("allowedArrowTypes")>=0||e.indexOf("allowedArrowSides")>=0)&&this._updateStyleButtons(),t.intersect(e,["arrowWidthMin","arrowWidthMax","arrowWidthStep"]).length&&this._updateWidthInputter(),t.intersect(e,["arrowLengthMin","arrowLengthMax","arrowLengthStep"]).length&&this._updateLengthInputter()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_PATH_ARROW_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.doCreateSectionElem(e,t),o=(this.doCreateArrowStyleButtons(e,i),this.doCreateSectionElem(e,t));this.doCreateArrowSizeControls(e,o);return r.concat(i).concat(o)},doCreateSectionElem:function(e,t){var r=e.createElement("div");return t.appendChild(r),r},doCreateArrowStyleButtons:function(e,t){var r=Kekule.Glyph.ArrowType,o=Kekule.Glyph.ArrowSide,n={};n[r.NONE]="None",n[r.OPEN]="Open",n[r.TRIANGLE]="Triangle";var a={};a[o.BOTH]="Both",a[o.SINGLE]="Single",a[o.REVERSED]="Reversed";var s=[r.NONE,r.OPEN,r.TRIANGLE],l=[o.BOTH,o.SINGLE,o.REVERSED],d=new Kekule.Widget.ButtonGroup(this);d.addClassName(i.GLYPH_PATH_ARROW_STYLE_BTNGROUP),this._arrowStyleButtons=[];var u=s.indexOf(r.NONE);if(u>=0){s.splice(u,1);var c=m=S=n[r.NONE],p=i.GLYPH_PATH_ARROW_STYLE_BUTTON+"-"+S;(f=new Kekule.Widget.RadioButton(d,m)).setHint(c).addClassName(p),f[this.DATA_FIELD]={arrowType:r.NONE,arrowSide:(this.getDefaultValue()||{}).arrowSide},this._arrowStyleButtons.push(f)}for(var h=0,g=s.length;h<g;++h)for(var C=0,_=l.length;C<_;++C){var m,f,S=n[s[h]],y=a[l[C]];c=m=S+" / "+y,p=i.GLYPH_PATH_ARROW_STYLE_BUTTON+"-"+S+"-"+y;(f=new Kekule.Widget.RadioButton(d,m)).setHint(c).addClassName(p),f[this.DATA_FIELD]={arrowType:s[h],arrowSide:l[C]},this._arrowStyleButtons.push(f)}return d.setShowGlyph(!0).setShowText(!1),this._updateStyleButtons(this._arrowStyleButtons),d.appendToElem(t),[d]},doCreateArrowSizeControls:function(e,t){var r=this._createArrowSizeSlider(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH")+":"),i=this._createArrowSizeSlider(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_LENGTH")+":");return this._arrowWidthInputter=r,this._arrowLengthInputter=i,this._updateWidthInputter(r),this._updateLengthInputter(i),[r,i]},_createArrowSizeSlider:function(e,t,r){var o=e.createElement("div");o.className=i.GLYPH_Path_ARROW_SIZE_SETTER;var n=e.createElement("label");Kekule.DomUtils.setElementText(n,r);var a=new Kekule.Widget.NumInput(this);return a.appendToElem(n),o.appendChild(n),t.appendChild(o),a},_updateStyleButtons:function(e){var t=this.getAllowedArrowTypes(),r=this.getAllowedArrowSides();if(e||(e=this._arrowStyleButtons),e)for(var i=0,o=e.length;i<o;++i){var n=e[i][this.DATA_FIELD],a=t&&t.indexOf(n.arrowType)<0||r&&r.indexOf(n.arrowSide)<0;e[i].setDisplayed(!a)}},_updateSizeInputter:function(t,r,i,o,n){var a=e.notUnset;a(i)&&t.setMinValue(i),a(o)&&t.setMaxValue(o),a(n)&&t.setStep(n),a(r)&&t.setValue(r)},_updateWidthInputter:function(e){e||(e=this._arrowWidthInputter),this._updateSizeInputter(e,this.getValue().arrowWidth,this.getArrowWidthMin(),this.getArrowWidthMax(),this.getArrowWidthStep())},_updateLengthInputter:function(e){e||(e=this._arrowLengthInputter),this._updateSizeInputter(e,this.getValue().arrowLength,this.getArrowLengthMin(),this.getArrowLengthMax(),this.getArrowLengthStep())},getDefaultAllowedArrowTypes:function(){var e=Kekule.Glyph.ArrowType;return[e.NONE,e.OPEN,e.TRIANGLE]},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})},notifyValueInput:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueInput",{value:e})},reactArrowStyleButtonCheck:function(e){if(!this._isSettingValue){var t=e.widget;if(t&&t[this.DATA_FIELD]){var r=this.getValue();r.arrowType=t[this.DATA_FIELD].arrowType,r.arrowSide=t[this.DATA_FIELD].arrowSide,this.notifyValueChange(r),e.stopPropagation()}}},reactArrowSizeInputterChange:function(t){if(!this._isSettingValue){var r=t.widget;if(r===this._arrowWidthInputter||r===this._arrowLengthInputter){var i=r.getValue()&&r.getValue();if(e.notUnset(i)){var o=this.getValue();r===this._arrowWidthInputter?o.arrowWidth=i:r===this._arrowLengthInputter&&(o.arrowLength=i),this.notifyValueChange(o),t.stopPropagation()}}}},reactArrowSizeInputterInput:function(t){if(!this._isSettingValue){var r=t.widget;if(r===this._arrowWidthInputter||r===this._arrowLengthInputter){var i=r.getValue()&&r.getValue();if(e.notUnset(i)){var o=this.getValue();r===this._arrowWidthInputter?o.arrowWidth=i:r===this._arrowLengthInputter&&(o.arrowLength=i),this.notifyValueInput(o),t.stopPropagation()}}}}}),Kekule.ChemWidget.GlyphReactionArrowPresetSelector=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.ChemWidget.GlyphReactionArrowPresetSelector",DATA_FIELD:"__$data$__",initialize:function(e){this._isSettingValue=!1,this._buttonSet=null,this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getPropStoreFieldValue("value")||""},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e);for(var t=this._buttonSet.getButtonSet().getChildWidgets(),r=0,i=t.length;r<i;++r){var o=t[r];o[this.DATA_FIELD].reactionArrowType===e?o.setChecked(!0):o.setChecked(!1)}}finally{this._isSettingValue=!1}}}),this.defineProp("allowedReactionArrowTypes",{dataType:DataType.ARRAY})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_REACTION_ARROW_PRESET_SELECTOR},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.doCreateButtonSet(e,t);return r.concat([i.getElement()])},doCreateButtonSet:function(e,t){var r=new Kekule.Widget.CompactButtonSet(this);r.addClassName(i.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET),r.getButtonSet().addClassName(i.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET_DROPDOWN);for(var o=this.getAllowedReactionArrowTypes()||this.getDefaultAllowedReactionTypes(),n=0,a=o.length;n<a;++n){var s=new Kekule.Widget.RadioButton(r),l=this._getPresetButtonDetails(o[n]);s.addClassName(l.className,!0).setText(l.caption).setHint(l.hint).setShowText(!0).setShowGlyph(!0),s[this.DATA_FIELD]={reactionArrowType:o[n]},r.append(s)}var d=this;return r.addEventListener("select",function(e){if(!d._isSettingValue&&e.target===r){var t=e.selected;if(t&&t[d.DATA_FIELD]){var i=t[d.DATA_FIELD].reactionArrowType;d.setPropStoreFieldValue("value",i),d.notifyValueChange(i)}}}),r.appendToElem(t),this._buttonSet=r,r},_getPresetButtonDetails:function(e){Kekule.Glyph.ReactionArrowType;var t=e?e.toUpperCase():"UNSET",r=e?e.upperFirst():"Unset",o="REACTION_ARROW_"+t;return{caption:Kekule.$L("ChemWidgetTexts.CAPTION_"+o),hint:Kekule.$L("ChemWidgetTexts.HINT_"+o),className:i.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON+" "+i.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON+"-"+r}},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})},getDefaultAllowedReactionTypes:function(){var e=Kekule.Glyph.ReactionArrowType;return[null,e.NORMAL,e.REVERSIBLE,e.RESONANCE,e.RETROSYNTHESIS,e.CUSTOM]}}),Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector",DATA_FIELD:"__$data$__",initialize:function(e){this._isSettingValue=!1,this._buttonGroup=null,this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("value",{dataType:DataType.INT,getter:function(){return this.getPropStoreFieldValue("value")||""},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e);for(var t=this._buttonGroup.getChildWidgets(),r=0,i=t.length;r<i;++r){var o=t[r];o[this.DATA_FIELD].electronCount===e?o.setChecked(!0):o.setChecked(!1)}}finally{this._isSettingValue=!1}}}),this.defineProp("allowedReactionArrowTypes",{dataType:DataType.ARRAY})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.doCreateButtonGroup(e,t);return r.concat([i.getElement()])},doCreateButtonGroup:function(e,t){var r=new Kekule.Widget.ButtonGroup(this);r.addClassName(i.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BTNGROUP);for(var o=[2,1],n=0,a=o.length;n<a;++n){var s=o[n],l=new Kekule.Widget.RadioButton(r),d=this._getPresetButtonDetails(s);l.addClassName(d.className,!0).setText(d.caption).setHint(d.hint).setShowText(!0).setShowGlyph(!0),l[this.DATA_FIELD]={electronCount:s},r.appendWidget(l)}var u=this;return r.addEventListener("check",function(e){if(!u._isSettingValue){var t=e.widget;if(t&&t[u.DATA_FIELD]){var r=t[u.DATA_FIELD].electronCount;u.setPropStoreFieldValue("value",r),u.notifyValueChange(r)}}}),r.appendToElem(t),this._buttonGroup=r,r},_getPresetButtonDetails:function(e){var t=e.toString(),r="ELECTRON_PUSHING_ARROW_"+e;return{caption:Kekule.$L("ChemWidgetTexts.CAPTION_"+r+"_ABBR"),hint:Kekule.$L("ChemWidgetTexts.HINT_"+r),className:i.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON+" "+i.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON+"-"+t}},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})}}),Kekule.ChemWidget.GlyphPathLineSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathLineSettingPanel",initialize:function(e){this._isSettingValue=!1,this.setPropStoreFieldValue("lineCountMin",1),this.setPropStoreFieldValue("lineCountMax",5),this.setPropStoreFieldValue("lineCountStep",1),this.setPropStoreFieldValue("lineGapMin",0),this.setPropStoreFieldValue("lineGapMax",.8),this.setPropStoreFieldValue("lineGapStep",.1),this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this.reactInputWidgetChange.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("value");return e||(e={},this.setPropStoreFieldValue("value",e)),e},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e),this._lineCountInput.setValue(e.lineCount),this._lineGapInput.setValue(e.lineGap)}finally{this._isSettingValue=!1}}}),this.defineProp("lineCountMin",{dataType:DataType.NUMBER}),this.defineProp("lineCountMax",{dataType:DataType.NUMBER}),this.defineProp("lineCountStep",{dataType:DataType.NUMBER}),this.defineProp("lineGapMin",{dataType:DataType.NUMBER}),this.defineProp("lineGapMax",{dataType:DataType.NUMBER}),this.defineProp("lineGapStep",{dataType:DataType.NUMBER})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_PATH_LINE_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.doCreateNumInputSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_LINE_COUNT")+":");this._lineCountInput=i.widget,this._updateLineCountInput();var o=this.doCreateNumInputSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_LINE_GAP")+":");return this._lineGapInput=o.widget,this._updateLineGapInput(),r.concat([i.elem,o.elem])},doCreateNumInputSection:function(e,t,r){var i=e.createElement("span"),o=e.createElement("label");Kekule.DomUtils.setElementText(o,r);var n=new Kekule.Widget.NumInput(this,null,null,null,"number");return n.appendToElem(o),i.appendChild(o),t.appendChild(i),{elem:i,widget:n}},_updateInputWidget:function(t,r,i,o,n){var a=e.notUnset;t&&(t.setValue(r),a(i)&&t.setMinValue(i),a(o)&&t.setMaxValue(o),a(n)&&t.setStep(n))},_updateLineCountInput:function(){this._updateInputWidget(this._lineCountInput,this.getValue().lineCount,this.getLineCountMin(),this.getLineCountMax(),this.getLineCountStep())},_updateLineGapInput:function(){this._updateInputWidget(this._lineGapInput,this.getValue().lineGap,this.getLineGapMin(),this.getLineGapMax(),this.getLineGapStep())},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})},reactInputWidgetChange:function(t){if(!this._isSettingValue){var r=t.widget;if(r===this._lineCountInput||r===this._lineGapInput){var i=r.getValue()&&r.getValue();if(e.notUnset(i)){var o=this.getValue();r===this._lineCountInput?o.lineCount=i:r===this._lineGapInput&&(o.lineGap=i),this.notifyValueChange(o),t.stopPropagation()}}}}}),Kekule.ChemWidget.GlyphPathSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow","line"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this.reactChildSetterValueChange.bind(this)),this.addEventListener("valueInput",this.reactChildSetterValueInput.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e={};return this._startingArrowSetter&&(e=Object.extend(e,this._addPropPrefix(this._startingArrowSetter.getValue(),"start"))),this._endingArrowSetter&&(e=Object.extend(e,this._addPropPrefix(this._endingArrowSetter.getValue(),"end"))),this._lineSetter&&(e=Object.extend(e,this._lineSetter.getValue())),e},setter:function(e){if(e){var t=this._splitChildSetterValues(e);this._startingArrowSetter&&this._startingArrowSetter.setValue(t.startingArrow),this._endingArrowSetter&&this._endingArrowSetter.setValue(t.endingArrow),this._lineSetter&&this._lineSetter.setValue(t.line)}}}),this.defineProp("components",{dataType:DataType.ARRAY})},doObjectChange:function(e){return e.indexOf("components")>=0&&this.updateComponents(),this.tryApplySuper("doObjectChange",[e])},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_PATH_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.doCreateArrowSettingSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_STARTING_ARROW"));this._startingArrowSetter=i.widget,this._startingArrowElem=i.elem;var o=this.doCreateArrowSettingSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_ENDING_ARROW"));this._endingArrowSetter=o.widget,this._endingArrowElem=o.elem;var n=this.doCreateLineSettingSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_LINE"));return this._lineSetter=n.widget,this._lineElem=n.elem,r=r.concat([i.elem,o.elem,n.elem]),this.updateComponents(),r},doCreateSectionElem:function(e,t,r,o){var n=e.createElement("div"),a=e.createElement("label");Kekule.DomUtils.setElementText(a,r),a.className=i.GLYPH_PATH_SETTING_PANEL_SECTION_TITLE,n.appendChild(a);var s=i.GLYPH_PATH_SETTING_PANEL_SECTION;return o&&(s+=" "+o),n.className=s,t.appendChild(n),n},doCreateArrowSettingSection:function(e,t,r){var o=this.doCreateSectionElem(e,t,r),n=new Kekule.ChemWidget.GlyphPathArrowSettingPanel(this);return n.addClassName(i.GLYPH_PATH_SETTING_PANEL_SECTION_PANEL),n.appendToElem(o),{elem:o,widget:n}},doCreateLineSettingSection:function(e,t,r){var o=this.doCreateSectionElem(e,t,r),n=new Kekule.ChemWidget.GlyphPathLineSettingPanel(this);return n.addClassName(i.GLYPH_PATH_SETTING_PANEL_SECTION_PANEL),n.appendToElem(o),{elem:o,widget:n}},updateComponents:function(){var e=this.getComponents()||this.DEF_COMPONENTS,t=Kekule.StyleUtils;t.setDisplay(this._startingArrowElem,e.indexOf("startingArrow")>=0),t.setDisplay(this._endingArrowElem,e.indexOf("endingArrow")>=0),t.setDisplay(this._lineElem,e.indexOf("line")>=0)},reactChildSetterValueChange:function(e){var t=e.widget;if(t&&this.getChildValueSetterWidgets().indexOf(t)>=0){var r=this.getValue();e.stopPropagation(),this.notifyPropSet("value",r),this.invokeEvent("valueChange",{value:r})}},reactChildSetterValueInput:function(e){var t=e.widget;if(t&&this.getChildValueSetterWidgets().indexOf(t)>=0){var r=this.getValue();e.stopPropagation(),this.notifyPropSet("value",r),this.invokeEvent("valueInput",{value:r})}},getChildValueSetterWidgets:function(e){return[this._startingArrowSetter,this._endingArrowSetter,this._lineSetter]},getStartingArrowSetter:function(){return this._startingArrowSetter},getEndingArrowSetter:function(){return this._endingArrowSetter},_addPropPrefix:function(t,r){for(var i={},o=e.getOwnedFieldNames(t,!1),n=0,a=o.length;n<a;++n){var s=t[o[n]];i[r+o[n].capitalizeFirst()]=s}return i},_splitChildSetterValues:function(t){for(var r={startingArrow:{},endingArrow:{},line:{}},i=e.getOwnedFieldNames(t),o=0,n=i.length;o<n;++o){var a,s=i[o],l=t[s];s.startsWith("startArrow")?(a="arrow"+s.substr(10),r.startingArrow[a]=l):s.startsWith("endArrow")?(a="arrow"+s.substr(8),r.endingArrow[a]=l):r.line[s]=l}return r}}),Kekule.ChemWidget.GlyphMultiPathSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiPathSettingPanel",DEF_PATH_COUNT:2,DEF_COMPONENTS:["endingArrow"],initialize:function(e){this.setPropStoreFieldValue("value",[]),this.tryApplySuper("initialize",[e]),this.getPathCount()||this.setPathCount(this.DEF_PATH_COUNT),this.setActivePathIndex(0);var t=this.reactChildSetterValueChange.bind(this),r=this.reactChildSetterValueInput.bind(this);this.addEventListener("valueChange",t),this.addEventListener("valueInput",r),this.addEventListener("switch",this.reactPathTabSwitch.bind(this))},initProperties:function(){this.defineProp("pathCount",{dataType:DataType.INT,getter:function(){return this.getPathTabGroup().getTabButtons().length},setter:function(e){this._updatePathTabGroup(e)}}),this.defineProp("pathSettingPanel",{dataType:"Kekule.ChemWidget.GlyphPathSettingPanel",serializable:!1,setter:null}),this.defineProp("pathTabGroup",{dataType:"Kekule.Widget.TabButtonGroup",serializable:!1,setter:null}),this.defineProp("activePathIndex",{dataType:DataType.INT,getter:function(){return this.getPathTabGroup().getActiveTabIndex()},setter:function(e){this.getPathTabGroup().setActiveTabIndex(e),this._switchToNewPathTab(e)}}),this.defineProp("value",{dataType:DataType.HASH,setter:function(e){if(e){var r=t.toArray(e);this.setPropStoreFieldValue("value",r),r.length>this.getActivePathIndex()&&this.getPathSettingPanel().setValue(r[this.getActivePathIndex()])}else this.setPropStoreFieldValue("value",[])}}),this.defineProp("components",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPathSettingPanel();return e&&e.getComponents()},setter:function(e){this.getPathSettingPanel().setComponents(e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_MULTIPATH_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),o=new Kekule.Widget.TabButtonGroup(this);o.setTabButtonPosition(Kekule.Widget.Position.TOP).addClassName(i.GLYPH_MULTIPATH_SETTING_PANEL_PATH_TABGROUP),this.setPropStoreFieldValue("pathTabGroup",o);var n=new Kekule.ChemWidget.GlyphPathSettingPanel(this);return n.addClassName(i.GLYPH_MULTIPATH_SETTING_PANEL_PATH_SETTING_PANEL),n.setComponents(this.DEF_COMPONENTS),this.setPropStoreFieldValue("pathSettingPanel",n),r},getStartingArrowSetter:function(){return this.getPathSettingPanel().getStartingArrowSetter()},getEndingArrowSetter:function(){return this.getPathSettingPanel().getEndingArrowSetter()},_updatePathTabGroup:function(e){this.getActivePathIndex();var t=this.getPathCount();if(t!==e){var r=this.getPathTabGroup(),i=r.getTabButtons();if(t>e)for(var o=t-1;o>=e;--o){var n=i[o];r.removeWidget(n)}else for(o=t;o<e;++o){n=new Kekule.Widget.RadioButton(r);var a=Kekule.$L("ChemWidgetTexts.CAPTION_PATH_INDEX").format(""+(o+1)),s=Kekule.$L("ChemWidgetTexts.HINT_PATH_INDEX").format(""+(o+1));n.setText(a).setHint(s)}}},_switchToNewPathTab:function(e){if(e>=0){var t=(this.getValue()||[])[e];this.getPathSettingPanel().setValue(t||{})}},reactChildSetterValueChange:function(e){var t=this.getActivePathIndex();if(t>=0){var r=e.widget;if(r===this.getPathSettingPanel()){var i=r.getValue();e.stopPropagation();var o=this.getValue()||[];o[t]=i,this.setPropStoreFieldValue("value",o),this.notifyPropSet("value",o),this.invokeEvent("valueChange",{value:o})}}},reactChildSetterValueInput:function(e){var t=this.getActivePathIndex();if(t>=0){var r=e.widget;if(r===this.getPathSettingPanel()){var i=r.getValue();e.stopPropagation();var o=this.getValue()||[];o[t]=i,this.setPropStoreFieldValue("value",o),this.notifyPropSet("value",o),this.invokeEvent("valueInput",{value:o})}}},reactPathTabSwitch:function(e){if(e.widget===this.getPathTabGroup()){var t=e.button,r=this.getPathTabGroup().getTabButtons().indexOf(t);this._switchToNewPathTab(r)}}}),Kekule.ChemWidget.GlyphReactionArrowPathSettingPanel=Class.create(Kekule.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphReactionArrowPathSettingPanel",doGetValue:function(){var e=this.tryApplySuper("doGetValue")||{};return this._reactionArrowPresetSelector&&(e.reactionArrowType=this._reactionArrowPresetSelector.getValue()),e},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._reactionArrowPresetSelector&&(this._reactionArrowPresetSelector.setValue(e.reactionArrowType),this._updateArrowSettingPanelEnableState())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.doCreateReactionArrowPresetSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_TYPE"));this._reactionArrowPresetSelector=r.widget,this._reactionArrowPresetElem=r.elem;var i=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updateComponents(),i},doCreateReactionArrowPresetSection:function(e,t,r){var o=this.doCreateSectionElem(e,t,r,i.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION),n=new Kekule.ChemWidget.GlyphReactionArrowPresetSelector(this);return n.appendToElem(o),{elem:o,widget:n}},updateComponents:function(){this.tryApplySuper("updateComponents"),this._updateArrowSettingPanelEnableState()},_updateArrowSettingPanelEnableState:function(){var e=Kekule.Glyph.ReactionArrowType,r=this._reactionArrowPresetSelector.getValue(),i=null,o=null,n=e.getDefPathParamOfArrowType(r);if(n){n.startArrowType,n.endArrowType;var a=n.hasOwnProperty("startArrowType")&&n.startArrowType,s=n.hasOwnProperty("endArrowType")&&n.endArrowType;if(a&&(i=this._startingArrowSetter.getDefaultAllowedArrowTypes(),i=t.exclude(i,[Kekule.Glyph.ArrowType.NONE])),s){o=this._endingArrowSetter.getDefaultAllowedArrowTypes();o=t.exclude(o,[Kekule.Glyph.ArrowType.NONE])}this._startingArrowSetter.setEnabled(a),this._endingArrowSetter.setEnabled(s)}else this._startingArrowSetter.setEnabled(!0),this._endingArrowSetter.setEnabled(!0);this._startingArrowSetter.setAllowedArrowTypes(i),this._endingArrowSetter.setAllowedArrowTypes(o)},_updatePathParamsByReactionArrowPreset:function(t){var r=Kekule.Glyph.ArrowType,i=Kekule.Glyph.ReactionArrowType.getDefPathParamOfArrowType(t);if(i||t||(i={startArrowType:r.NONE,endArrowType:r.NONE}),i){var o={},n={},a={};void 0!==i.startArrowType&&(o.arrowType=i.startArrowType),void 0!==i.startArrowSide&&(o.arrowSide=i.startArrowSide),void 0!==i.endArrowType&&(n.arrowType=i.endArrowType),void 0!==i.endArrowSide&&(n.arrowSide=i.endArrowSide),i.lineCount&&(a.lineCount=i.lineCount),i.lineGap&&(a.lineGap=i.lineGap),e.getOwnedFieldNames(o).length&&this._startingArrowSetter.setValue(Object.extend(this._startingArrowSetter.getValue(),o)),e.getOwnedFieldNames(n).length&&this._endingArrowSetter.setValue(Object.extend(this._endingArrowSetter.getValue(),n)),e.getOwnedFieldNames(a).length&&this._lineSetter.setValue(Object.extend(this._lineSetter.getValue(),a))}},getChildValueSetterWidgets:function(){var e=this.tryApplySuper("getChildValueSetterWidgets");return e.push(this._reactionArrowPresetSelector),e},reactChildSetterValueChange:function(e){e.widget===this._reactionArrowPresetSelector&&(this._updateArrowSettingPanelEnableState(),this._updatePathParamsByReactionArrowPreset(e.value)),this.tryApplySuper("reactChildSetterValueChange",[e])}}),Kekule.ChemWidget.GlyphArcPathSettingPanel=Class.create(Kekule.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphArcPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_ARC_PATH_SETTING_PANEL}}),Kekule.ChemWidget.GlyphMultiArcPathSettingPanel=Class.create(Kekule.ChemWidget.GlyphMultiPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiArcPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_MULTIARC_PATH_SETTING_PANEL}}),Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],initialize:function(e){this._glyphPathSettingPanel=null,this._endingArrowSetter=null,this._arrowPresetSelector=null,this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this.reactChildSetterValueChange.bind(this)),this.addEventListener("valueInput",this.reactChildSetterValueInput.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e=this._glyphPathSettingPanel.getValue()||{};return e.electronCount=this._arrowPresetSelector.getValue(),e},setter:function(e){this._glyphPathSettingPanel.setValue(e),this._arrowPresetSelector.setValue(e&&e.electronCount),this._updateArrowSettingPanel()}})},doCreateSubElements:function(e,t){var o=this.tryApplySuper("doCreateSubElements",[e,t]),n=this.doCreateArrowPresetSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));this._arrowPresetSelector=n.widget,this._arrowPresetElem=n.elem,Kekule.HtmlElementUtils.addClass(this._arrowPresetElem,i.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION);var a=this.doCreateGlyphPathSettingSection(e,t);if(this._glyphPathSettingPanel=a.widget,this._glyphPathSettingPanel&&(this._glyphPathSettingPanel.removeClassName(r.PANEL),this._glyphPathSettingPanel.setComponents&&this._glyphPathSettingPanel.setComponents(this.DEF_COMPONENTS),this._glyphPathSettingPanel.getEndingArrowSetter)){this._endingArrowSetter=this._glyphPathSettingPanel.getEndingArrowSetter();var s=Kekule.Glyph.ArrowType;this._endingArrowSetter.setAllowedArrowTypes([s.OPEN,s.TRIANGLE])}return o.concat([n.elem,a.elem])},doCreateSectionElem:function(e,t,r,o){var n=e.createElement("div");if(r){var a=e.createElement("label");Kekule.DomUtils.setElementText(a,r),a.className=i.GLYPH_PATH_SETTING_PANEL_SECTION_TITLE,n.appendChild(a)}var s=i.GLYPH_PATH_SETTING_PANEL_SECTION;return o&&(s+=" "+o),n.className=s,t.appendChild(n),n},doCreateArrowPresetSection:function(e,t,r){var i=this.doCreateSectionElem(e,t,r),o=new Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return o.appendToElem(i),{elem:i,widget:o}},doCreateGlyphPathSettingSection:function(e,t,r){var i=this.doCreateGlyphPathSettingWidget();if(i){var o=this.doCreateSectionElem(e,t,r);return i.appendToElem(o),{elem:o,widget:i}}return null},doCreateGlyphPathSettingWidget:function(){return null},reactChildSetterValueChange:function(e){var t=e.widget;t===this._arrowPresetSelector&&this._updateArrowSettingPanel(),[this._arrowPresetSelector,this._glyphPathSettingPanel].indexOf(t)>=0&&(e.stopPropagation(),this.invokeEvent("valueChange",{value:this.getValue()})),this.tryApplySuper("reactChildSetterValueChange",[e])},reactChildSetterValueInput:function(e){var t=e.widget;t===this._arrowPresetSelector&&this._updateArrowSettingPanel(),[this._arrowPresetSelector,this._glyphPathSettingPanel].indexOf(t)>=0&&(e.stopPropagation(),this.invokeEvent("valueInput",{value:this.getValue()})),this.tryApplySuper("reactChildSetterValueInput",[e])},_updateArrowSettingPanel:function(){var e=Kekule.Glyph.ArrowSide,t=this._endingArrowSetter,r=this._arrowPresetSelector.getValue(),i=[];i=r>=2?[e.BOTH]:1===r?[e.SINGLE,e.REVERSED]:[e.BOTH,e.SINGLE,e.REVERSED],t.setAllowedArrowSides(i)}}),Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel=Class.create(Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel",doCreateGlyphPathSettingWidget:function(){return new Kekule.ChemWidget.GlyphArcPathSettingPanel(this)}}),Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel=Class.create(Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel",doCreateGlyphPathSettingWidget:function(){return new Kekule.ChemWidget.GlyphMultiArcPathSettingPanel(this)}}),Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel_OLD=Class.create(Kekule.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],initialize:function(e){this.tryApplySuper("initialize",[e]);var t=Kekule.Glyph.ArrowType;this._endingArrowSetter.setAllowedArrowTypes([t.OPEN,t.TRIANGLE])},doGetValue:function(){var e=this.tryApplySuper("doGetValue")||{};return this._arrowPresetSelector&&(e.electronCount=this._arrowPresetSelector.getValue()),e},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._arrowPresetSelector&&(this._arrowPresetSelector.setValue(e.electronCount),this._updateArrowSettingPanel())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_ELECTRON_PUSHING_ARROW_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.doCreateArrowPresetSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));return this._arrowPresetSelector=r.widget,this._arrowPresetElem=r.elem,this.tryApplySuper("doCreateSubElements",[e,t])},doCreateArrowPresetSection:function(e,t,r){var i=this.doCreateSectionElem(e,t,r),o=new Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return o.appendToElem(i),{elem:i,widget:o}},getChildValueSetterWidgets:function(){var e=this.tryApplySuper("getChildValueSetterWidgets");return e.push(this._arrowPresetSelector),e.push(this._reversedArrowSideCheckBox),e},reactChildSetterValueChange:function(e){e.widget===this._arrowPresetSelector&&this._updateArrowSettingPanel(),this.tryApplySuper("reactChildSetterValueChange",[e])},_updateArrowSettingPanel:function(){var e=Kekule.Glyph.ArrowSide,t=this.getEndingArrowSetter(),r=this._arrowPresetSelector.getValue(),i=[];i=r>=2?[e.BOTH]:1===r?[e.SINGLE,e.REVERSED]:[e.BOTH,e.SINGLE,e.REVERSED],t.setAllowedArrowSides(i)}}),Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel_OLD=Class.create(Kekule.ChemWidget.GlyphMultiPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_MULTI_ELECTRON_PUSHING_ARROW_SETTING_PANEL},initialize:function(e){this.tryApplySuper("initialize",[e]);var t=Kekule.Glyph.ArrowType;this._endingArrowSetter=this.getPathSettingPanel().getEndingArrowSetter(),this._endingArrowSetter.setAllowedArrowTypes([t.OPEN,t.TRIANGLE])},doGetValue:function(){var e=this.tryApplySuper("doGetValue")||{};return this._arrowPresetSelector&&(e.electronCount=this._arrowPresetSelector.getValue()),e},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._arrowPresetSelector&&(this._arrowPresetSelector.setValue(e.electronCount),this._updateArrowSettingPanel())},doCreateSubElements:function(e,t){var r=this.doCreateArrowPresetSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));return this._arrowPresetSelector=r.widget,this._arrowPresetElem=r.elem,this.tryApplySuper("doCreateSubElements",[e,t])},doCreateSectionElem:function(e,t,r,o){var n=e.createElement("div"),a=e.createElement("label");Kekule.DomUtils.setElementText(a,r),n.appendChild(a);var s=i.GLYPH_PATH_SETTING_PANEL_SECTION;return o&&(s+=" "+o),n.className=s,t.appendChild(n),n},doCreateArrowPresetSection:function(e,t,r){var i=this.doCreateSectionElem(e,t,r),o=new Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return o.appendToElem(i),{elem:i,widget:o}},_updateArrowSettingPanel:function(){var e=Kekule.Glyph.ArrowSide,t=this.getEndingArrowSetter(),r=this._arrowPresetSelector.getValue(),i=[];i=r>=2?[e.BOTH]:1===r?[e.SINGLE,e.REVERSED]:[e.BOTH,e.SINGLE,e.REVERSED],t.setAllowedArrowSides(i)}})}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.CoordUtils,r=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMSPACE_EDITOR:"K-Chem-Space-Editor",CHEMSPACE_EDITOR2D:"K-Chem-Space-Editor2D",CHEMSPACE_EDITOR3D:"K-Chem-Space-Editor3D",CHEMEDITOR_ATOM_SETTER:"K-ChemEditor-Atom-Setter",CHEMEDITOR_TEXT_SETTER:"K-ChemEditor-Text-Setter",CHEMEDITOR_FORMULA_SETTER:"K-ChemEditor-Formula-Setter"}),Kekule.globalOptions.add("chemWidget.editor",{enableSelect:!0,enableFileDrop:!0,allowCreateNewChild:!0,autoCreateNewStructFragment:!0,allowAppendDataToCurr:!0,enableGesture:!0,initOnNewDoc:!0}),Kekule.globalOptions.add("chemWidget.editor.molManipulation",{enableNodeStick:!0,enableStructFragmentStick:!0,enableConstrainedMove:!0,enableConstrainedRotate:!0,enableConstrainedResize:!0,enableDirectedMove:!0}),Kekule.globalOptions.add("chemWidget.editor.bondManipulation",{enableBondModification:!0,allowBondingToBond:!1,autoSwitchBondOrder:!1}),Kekule.Editor.ChemSpaceEditor=Class.create(Kekule.Editor.BaseEditor,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor",initialize:function(e,t,r,i){var o=Kekule.globalOptions.get;this.setPropStoreFieldValue("allowCreateNewChild",o("chemWidget.editor.allowCreateNewChild",!0)),this.setPropStoreFieldValue("autoCreateNewStructFragment",o("chemWidget.editor.autoCreateNewStructFragment",!0)),this.setPropStoreFieldValue("allowAppendDataToCurr",o("chemWidget.editor.autoCreateNewStructFragment",!0)),this.tryApplySuper("initialize",[e,t,r,i]),this._containerChemSpace=null},initProperties:function(){this.defineProp("chemSpace",{dataType:"Kekule.ChemSpace",serializable:!1,getter:function(){return this.getChemObj()},setter:function(e){this.setChemObj(e)}}),this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("autoCreateNewStructFragment")&&this.canCreateNewChild()}}),this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setFileDroppable(Kekule.globalOptions.get("chemWidget.editor.enableFileDrop",!0))},canCreateNewChild:function(){return this.getChemSpace()&&(this.getAllowCreateNewChild()||this.getChemSpace().getChildCount()<=0)},getActualDrawOptions:function(){var e=this.tryApplySuper("getActualDrawOptions");return e.useExplicitSpaceSize=!0,e},doSetChemObj:function(e){var t=this.getChemObj();if(t!==e)if(t&&this._containerChemSpace&&(t.finalize(),this._containerChemSpace=null),e){if(e instanceof Kekule.ChemSpace)this._initChemSpaceDefProps(e),this.tryApplySuper("doSetChemObj",[e]);else{var r=this.createContainerChemSpace(null,e);this._containerChemSpace=r,this.tryApplySuper("doSetChemObj",[r])}if(this.getEditorConfigs().getInteractionConfigs().getAutoExpandClientSizeAfterLoading()&&this.autoExpandChemSpaceSize(),e instanceof Kekule.ChemSpace&&this.getEditorConfigs().getInteractionConfigs().getScrollToObjAfterLoading()){var i=e.getChildren();i&&i.length&&this.scrollClientToObject(i)}}else this.tryApplySuper("doSetChemObj",[e]);else this.tryApplySuper("doSetChemObj",[e])},getExportableClasses:function(){var e=this.tryApplySuper("getExportableClasses"),t=this.getChemSpace();if(t){t.iterateChildren(function(t){if(t.isStandalone&&t.isStandalone()&&t.getClass){var r=t.getClass();Kekule.ArrayUtils.pushUnique(e,r)}},!0)}return e},exportObjs:function(e){var t=this.tryApplySuper("exportObjs",[e]);if((!t||!t.length)&&e){t=[];t=this.getChemSpace().filterChildren(function(t){return t&&t instanceof e},!0)}return t},getSavingTargetObj:function(){var e=this.getChemSpace();return 1===e.getChildCount()?e.getChildAt(0):this.tryApplySuper("getSavingTargetObj")},_cloneSavingTargetObj:function(e){var t=this.getChemSpace();return 1===t.getChildCount()&&e===t.getChildAt(0)?t.clone(!0).getChildAt(0):this.tryApplySuper("_cloneSavingTargetObj",[e])},createDefaultConfigs:function(){return Kekule.Editor.ChemSpaceEditorConfigs.getInstance()},doCreateNewDocObj:function(){return this.createContainerChemSpace()},doLoad:function(e){this._supplyChemMarkersOnObj(e),this.tryApplySuper("doLoad",[e])},doLoadEnd:function(e){var t=this.tryApplySuper("doLoadEnd",[e]),r=null;if(e){var i=e.getAllContainingConnectors();if(i&&i.length){var o=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;r=Kekule.ChemStructureUtils.getConnectorLengthMedian(i,o,this.getAllowCoordBorrow())}}return this.setDefBondLength(r),t},resetDisplay:function(){this.tryApplySuper("resetDisplay"),this.resetClientDisplay()},resetClientDisplay:function(e){if(!this.isUpdatingObject())return this._resetClientDisplayCore(e);var t=this;this._registerAfterUpdateObjectProc(function(){t._resetClientDisplayCore(e)})},_resetClientDisplayCore:function(e){var t=this.getChemObj();if(t){var r;e&&(r=this.getClientScrollPosition());var i=t.getScreenSize();this.changeClientSize(i.x,i.y,this.getCurrZoom());var o=this.getEditClientElem().parentNode,n=Kekule.HtmlElementUtils.getElemClientDimension(o);e?this.scrollClientTo(r.y,r.x):this.scrollClientTo(0,(i.x*this.getCurrZoom()-n.width)/2)}},zoomChanged:function(e){this.tryApplySuper("zoomChanged");var t=this.getChemObj();if(t){var r=t.getScreenSize();this.changeClientSize(r.x,r.y,e)}},createNewBoundInfoRecorder:function(e){this.tryApplySuper("createNewBoundInfoRecorder",[e]);var t=this.getBoundInfoRecorder();t&&t.addEventListener("updateBasicDrawObject",this.reactUpdateBasicDrawObject,this)},reactUpdateBasicDrawObject:function(e){var t=e.obj;if(t&&t instanceof Kekule.TextBlock){var r=e.boundInfo;this.updateTextBlockSize(t,r)}},objectChanged:function(e,t){return this.tryApplySuper("objectChanged",[e,t])},doManipulationEnd:function(){if(this.getEditorConfigs().getInteractionConfigs().getAutoExpandClientSizeAfterManipulation()){var e=this._calcChemSpaceAutoExpandInfo();if(e){var t=this._createChemSpaceAutoExpandOperations(e);if(t){this.getEnableOperHistory()&&this._appendOpersToLastManipulationOperation(t);for(var r=0,i=t.length;r<i;++r)t[r].execute()}}}return this.tryApplySuper("doManipulationEnd")},_appendOpersToLastManipulationOperation:function(e){var t=this.getOperationsInCurrManipulation();if(t&&t.length){var r=t[t.length-1],i=this.getOperHistory();if(i){var o=i.getOperations(),n=o.indexOf(r);if(n>=0){var a;r instanceof Kekule.MacroOperation?a=r:(a=new Kekule.MacroOperation([r]),o.splice(n,1,a),t.splice(t.length-1,1,a));for(var s=0,l=e.length;s<l;++s)a.add(e[s])}}}},updateTextBlockSize:function(e,t){if(this.getCoordMode()===Kekule.CoordMode.COORD2D&&e.getNeedRecalcSize()){t.shapeType;Kekule.Render.BoundShapeType.RECT}},createContainerChemSpace:function(e,t){var r=new Kekule.ChemDocument(e);if(this._initChemSpaceDefProps(r,t),t){r.appendChild(t);var i,o=r.getSizeOfMode(this.getCoordMode(),this.getAllowCoordBorrow()),n=Kekule.Render.ObjUtils.getContainerBox(t,this.getCoordMode(),this.getAllowCoordBorrow());if(this.getCoordMode()===Kekule.CoordMode.COORD2D)var a=this.getEditorConfigs().getChemSpaceConfigs().getDefPadding(),s=r.getObjScreenLengthRatio();var l=t.getAbsBaseCoord&&t.getAbsBaseCoord(this.getCoordMode(),this.getAllowCoordBorrow())||{};if(s&&n){i=Kekule.CoordUtils.divide(o,2);var d={x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2},u={x:i.x,y:o.y-a*s-(n.y2-n.y1)/2},c=Kekule.CoordUtils.substract(u,d);i=Kekule.CoordUtils.add(l,c)}else i=Kekule.CoordUtils.divide(o,2);t.setAbsBaseCoord&&t.setAbsBaseCoord(i,this.getCoordMode())}return r},_initChemSpaceDefProps:function(e,t,r){var i=this.getEditorConfigs(),o=i.getChemSpaceConfigs();if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var n=e.getScreenSize();if(n.x||n.y||(n=o.getDefScreenSize2D(),e.setScreenSize(n)),!e.getDefAutoScaleRefLength()){var a,s;if(t&&t.getAllAutoScaleRefLengths)a=(s=t.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow()))&&s.length?Kekule.ArrayUtils.getMedian(s):null;else a=(s=e.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow())).length?Kekule.ArrayUtils.getMedian(s):null;a||(a=i.getStructureConfigs().getDefBondLength()),e.setDefAutoScaleRefLength(a)}if(!e.getSize2D()||r){var l=this.getRenderConfigs().getLengthConfigs().getDefBondLength(),d=e.getDefAutoScaleRefLength()/l;e.setObjScreenLengthRatio(d),e.setSize2D({x:n.x*d,y:n.y*d})}}e.setIsEditing&&e.setIsEditing(!0)},_getChemSpaceObjScreenLengthRatio:function(){var e=this.getChemSpace(),t=e.getObjScreenLengthRatio();if(!t){var r=this.getRenderConfigs().getLengthConfigs().getDefBondLength();t=e.getDefAutoScaleRefLength()/r}return t},changeChemSpaceSize:function(e,t){var r=this.getChemSpace();r.beginUpdate();try{if(r.setSizeOfMode(e,t),t===Kekule.CoordMode.COORD2D){var i=this._getChemSpaceObjScreenLengthRatio();i&&r.setScreenSize({x:e.x/i,y:e.y/i})}}finally{r.endUpdate()}this.resetClientDisplay(!0)},changeChemSpaceScreenSize:function(e){var t=this.getChemSpace();t.beginUpdate();try{var r=this._getChemSpaceObjScreenLengthRatio();r&&t.setSize2D({x:e.x*r,y:e.y*r}),t.setScreenSize(e)}finally{t.endUpdate()}this.resetClientDisplay(!0)},_shiftChemSpaceChildCoord:function(e,r,i){var o=this.getChemSpace(),n=o.getChildren();if(n){var a;i&&(a=this.getClientScrollCoord(Kekule.Editor.CoordSys.CHEM)),this.beginUpdateObject();try{o.beginUpdate();try{for(var s=this.getAllowCoordBorrow(),l=0,d=n.length;l<d;++l){var u=n[l];if(u&&u.setCoordOfMode){var c=u.getCoordOfMode(r,s)||{};u.setCoordOfMode(t.add(c,e))}}i&&this.scrollClientToCoord(a,Kekule.Editor.CoordSys.CHEM)}finally{o.endUpdate()}}finally{this.endUpdateObject()}}},_calcExpandChemSpaceSizeToTargetObjsInfo:function(e,t){if(e&&e.length){var r=this._getTargetObjsExposedContainerBoxInfo(e).totalBox;if(r)return this._calcExpandChemSpaceSizeToContainerBoxInfo(r,t)}return null},_calcExpandChemSpaceSizeToContainerBoxInfo:function(e,r){var i=Kekule.CoordMode,o=this.getChemSpace(),n=r===i.COORD3D,a=["x","y"];n&&a.push("z");for(var s=this.getEditorConfigs().getChemSpaceConfigs(),l=this._getChemSpaceObjScreenLengthRatio(),d=s.getDefPadding()*l,u=n?o.getSize3D():o.getSize2D(),c=Kekule.BoxUtils.getMinMaxCoords(e),p=c.min,h={},g=!1,C=0,_=a.length;C<_;++C){(y=p[a[C]])<d?(h[a[C]]=d-y,g=!0):h[a[C]]=0}var m=c.max,f={},S=!1;for(C=0,_=a.length;C<_;++C){var y;(y=m[a[C]])>u[a[C]]-d?(f[a[C]]=y-(u[a[C]]-d),S=!0):f[a[C]]=0}var O={},E={};if(g||S){var T=n?s.getAutoExpandScreenSize2D():s.getAutoExpandScreenSize3D(),A=t.multiply(T,l);for(C=0,_=a.length;C<_;++C){var k=a[C];O[k]=h[k]+f[k];var b=Math.ceil(O[k]/A[k]);E[k]=b*A[k]}var I={newSize:t.add(u,E)};return g&&(I.coordShift=h),I}return null},_expandChemSpaceSizeAndShiftChildrenCoords:function(e,t,r){this.beginUpdateObject();try{t&&this._shiftChemSpaceChildCoord(t,r,!0),this.changeChemSpaceSize(e,r)}finally{this.endUpdateObject()}},_expandChemSpaceSizeToContainerBox:function(e,t){var r=this._calcExpandChemSpaceSizeToContainerBoxInfo(e,t);return r&&this._expandChemSpaceSizeAndShiftChildrenCoords(r.newSize,r.coordShift,t),r},expandChemSpaceSizeToTargetObjs:function(e,t){if(Kekule.ObjUtils.isUnset(t)&&(t=this.getCoordMode()),e&&e.length){var r=this._getTargetObjsExposedContainerBoxInfo(e).totalBox;r&&this._expandChemSpaceSizeToContainerBox(r,t)}return this},autoExpandChemSpaceSize:function(){if(this._isAutoExpandingChemSpace)return this;this._isAutoExpandingChemSpace=!0;try{var e=this.getChemSpace().getChildren();e&&this.expandChemSpaceSizeToTargetObjs(e,this.getCoordMode())}finally{this._isAutoExpandingChemSpace=!1}return this},_calcChemSpaceAutoExpandInfo:function(){var e=this.getChemSpace().getChildren();return e?this._calcExpandChemSpaceSizeToTargetObjsInfo(e,this.getCoordMode()):null},_createChemSpaceAutoExpandOperations:function(e){if(e){var t=[],r=this.getChemSpace(),i=this.getCoordMode();return t.push(new Kekule.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords(r,e.newSize,e.coordShift,i,this)),t}return null},createNewStructFragmentAnchor:function(e){if(this.getAutoCreateNewStructFragment()){var t=new Kekule.Molecule(e);return this.getChemSpace().appendChild(t),t}return null},createStructStartingAtom:function(e,t,r,i){this.beginUpdateObject();try{if(e){i||(i=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId());var o=new Kekule.Atom(null,i);return e.appendNode(o),o.setAbsCoordOfMode(r,this.getCoordMode()),o}return null}finally{this.endUpdateObject()}},createNewStructFragmentAndStartingAtom:function(e,t,r){this.beginUpdateObject();try{var i;return(i=this.createNewStructFragmentAnchor(e))?this.createStructStartingAtom(i,e,t,r):null}finally{this.endUpdateObject()}},hasOnlyOneBlankStructFragment:function(){var e=!1;if(1===this.getChemSpace().getChildCount()){var t=this.getChemSpace().getChildAt(0);t instanceof Kekule.StructureFragment&&t.getNodeCount()<=0&&t.getConnectorCount()<=0&&!t.hasFormula()&&(e=!0)}return e},getOnlyOneBlankStructFragment:function(){if(this.hasOnlyOneBlankStructFragment())return this.getChemSpace().getChildAt(0)},canAddNewStandaloneObject:function(){return this.getAllowCreateNewChild()||this.getChemSpace().getChildCount()<=0},canAddUnconnectedStructFragment:function(){return this.canAddNewStandaloneObject()||this.hasOnlyOneBlankStructFragment()},canCloneObjects:function(){return this.getAllowCreateNewChild()},cloneObjects:function(t,r,i,o){var n=this;if(!this.getChemSpace())return null;for(var a=this.getAllowCreateNewChild(),s=function(e,t){for(var r=0,i=t.length;r<i;++r){if(t[r].isChildOf(e))return!0}return!1},l=function(t,r,i){if(i.indexOf(r)>=0)e.remove(i,r);else if(t.getChildAt&&r.getChildAt)for(var o=r.getChildCount()-1;o>=0;--o){var n=t.getChildAt(o);if(i.length){var a=r.getChildAt(o);i.indexOf(a)>=0?e.remove(i,a):s(a,i)?a.getChildObjs&&l(n,a,i):t.removeChild(n)}else t.removeChild(n)}},d=function(e,t){for(var r=0,i=t.length;r<i;++r){var o=t[r];if(e===o||e.isChildOf&&e.isChildOf(o))return o}return null},u=function(t,r,i){var o,n,a=t.relation,s=t.srcParent,l=t.destParents,d=[],u=i[r.indexOf(s)];if(a.srcObj===s?n=u:(o=s.indexStackOfChild&&s.indexStackOfChild(a.srcObj))&&(n=u.getChildAtIndexStack&&u.getChildAtIndexStack(o)),!n)return null;for(var c=e.isArray(a.dest),p=c?a.dest:[a.dest],h=0,g=l.length;h<g;++h){var C,_=l[h],m=i[r.indexOf(_)];_&&(_===p[h]?d.push(m):p[h]&&(o=_.indexStackOfChild&&_.indexStackOfChild(p[h]))&&(C=m.getChildAtIndexStack&&m.getChildAtIndexStack(o))&&d.push(C))}if(!d.length)return null;var f=c?d:d[0];return{srcObj:n,srcProp:a.srcProp,dest:f}},c=Kekule.ArrayUtils.toArray(t),p=[],h=new Kekule.MapEx,g=0,C=c.length;g<C;++g){var _=(T=c[g]).getStandaloneAncestor?T.getStandaloneAncestor():T;if(_.clone){Kekule.ArrayUtils.pushUnique(p,_);var m=h.get(_);m||(m=[],h.set(_,m)),m.push(T)}}var f=function(t,r){var i=[];r||(r=n.getChemObj());var o=r.getObjRefRelations&&r.getObjRefRelations();if(o)for(var a=0,s=o.length;a<s;++a){var l=o[a],u=l.srcObj,c=e.toArray(l.dest),p=d(u,t),h=[],g=!1;if(p){for(var C=0,_=c.length;C<_;++C){var m=c[C],f=d(m,t);f&&(g=!0),h.push(f)}g&&i.push({relation:l,srcParent:p,destParents:h})}}return i}(p,this.getChemSpace()),S=this.getChemSpace(),y=[],O=(this.getCoordMode(),this.getAllowCoordBorrow(),p.length);for(g=0;g<O;++g){(A=(T=p[g]).clone()).clearIds&&A.clearIds(),y.push(A)}var E=[];for(g=0,C=f.length;g<C;++g){(D=u(f[g],p,y))&&E.push(D)}for(g=0;g<O;++g){var T=p[g],A=y[g];if(l(A,T,h.get(T)),i&&a&&(S.appendChild(A),r)){var k=this.getObjectScreenCoord(A),b=Kekule.CoordUtils.add(k,r);this.setObjectScreenCoord(A,b)}}for(g=0,C=E.length;g<C;++g){var I,D=E[g];if(d(D.srcObj,y)){if(e.isArray(D.dest)){I=[];for(var P=0,v=D.dest.length;P<v;++P){var R=D.dest[P];d(R,y)&&I.push(R)}I.length||(I=null)}else d(D.dest,y)&&(I=D.dest);I&&D.srcObj.setPropValue(D.srcProp.name,I)}}return h.finalize(),y},cloneSelection:function(t,r,i){void 0===t&&(t=this.getDefaultCloneScreenCoordOffset());var o=this.getSelection();o=function(t,r){for(var i=[],o=0,n=t.length;o<n;++o){var a=t[o];if(a instanceof Kekule.ChemSpace&&!r){var s=a.getChildren();e.pushUnique(i,s)}else e.pushUnique(i,a)}return i}(o,i);var n=this.cloneObjects(o,t,r);return r&&this.setSelection(n),n},getDefaultCloneScreenCoordOffset:function(){var e=this.getEditorConfigs().getInteractionConfigs().getClonedObjectScreenOffset()||0,t={x:e,y:e};return this.getCoordMode()===Kekule.CoordMode.COORD3D&&(t.z=e),t},_supplyChemMarkersOnObj:function(e){if(e){var t=Kekule.ChemStructureUtils.getAllStructFragments(e,!0);if(t||t.length)for(var r=0,i=t.length;r<i;++r)this._createLosingChemMarkerOnStructFragment(t[r])}},_createLosingChemMarkerOnStructFragment:function(e){e.beginUpdate();try{e.getCharge&&e.getCharge()&&e.fetchChargeMarker(!0);e.getNodes();for(var t=0,r=e.getNodeCount();t<r;++t){var i=e.getNodeAt(t);i.beginUpdate();try{i.getCharge()&&i.fetchChargeMarker(!0),i.getRadical()&&i.fetchRadicalMarker(!0),i.getNodeAt&&this._createLosingChemMarkerOnStructFragment(i)}finally{i.endUpdate()}}}finally{e.endUpdate()}},getEnabledNonAtomInputData:function(){var e=[],t=this.getRenderConfigs().getDisplayLabelConfigs(),r=this.getEditorConfigs().getStructureConfigs().getEnabledNonAtomNodeTypes();return r.RGroup&&e.push({text:t.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")}),r.pseudoatomDummy&&e.push({text:t.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")}),r.pseudoatomHetero&&e.push({text:t.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")}),r.pseudoatomAny&&e.push({text:t.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")}),r.variableAtomList&&e.push({text:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,isVarList:!0,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")}),r.variableAtomNotList&&e.push({text:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,isVarNotList:!0,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")}),e},_getVarAtomListLabel:function(){var e=this.getRenderConfigs().getDisplayLabelConfigs();return e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var e=this.getRenderConfigs().getDisplayLabelConfigs();return"~"+(e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM)},getEnabledBondFormData:function(){for(var e=Kekule.BondType,t=Kekule.BondOrder,r=Kekule.BondStereo,i=Kekule.$L,o="K-Chem-MolBondIaController-",n={single:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),htmlClass:o+"Single",isDefault:!0,bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.NONE}},double:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),htmlClass:o+"Double",bondProps:{bondType:e.COVALENT,bondOrder:t.DOUBLE,stereo:r.NONE}},triple:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),htmlClass:o+"Triple",bondProps:{bondType:e.COVALENT,bondOrder:t.TRIPLE,stereo:r.NONE}},quad:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_QUAD"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_QUAD"),htmlClass:o+"Quad",bondProps:{bondType:e.COVALENT,bondOrder:t.QUAD,stereo:r.NONE}},explicitAromatic:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_EXPLICIT_AROMATIC"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_EXPLICIT_AROMATIC"),htmlClass:o+"Aromatic",bondProps:{bondType:e.COVALENT,bondOrder:t.EXPLICIT_AROMATIC,stereo:r.NONE}},up:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),htmlClass:o+"WedgeUp",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP}},upInverted:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP_INVERTED"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP_INVERTED"),htmlClass:o+"WedgeUpInverted",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP_INVERTED}},down:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),htmlClass:o+"WedgeDown",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.DOWN}},downInverted:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN_INVERTED"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN_INVERTED"),htmlClass:o+"WedgeDownInverted",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.DOWN_INVERTED}},upOrDown:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),htmlClass:o+"WedgeUpOrDown",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP_OR_DOWN}},closer:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),htmlClass:o+"Closer",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.CLOSER}},eOrZ:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),htmlClass:o+"Double-Either",bondProps:{bondType:e.COVALENT,bondOrder:t.DOUBLE,stereo:r.E_OR_Z}},ionic:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_IONIC"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_IONIC"),htmlClass:o+"Ionic",bondProps:{bondType:e.IONIC,bondOrder:t.SINGLE,stereo:r.NONE}},coordinate:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_COORDINATE"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_COORDINATE"),htmlClass:o+"Coordinate",bondProps:{bondType:e.COORDINATE,bondOrder:t.SINGLE,stereo:r.NONE}},metallic:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_METALLIC"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_METALLIC"),htmlClass:o+"Metallic",bondProps:{bondType:e.METALLIC,bondOrder:t.SINGLE,stereo:r.NONE}},hydrogen:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_HYDROGEN"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_HYDROGEN"),htmlClass:o+"Hydrogen",bondProps:{bondType:e.HYDROGEN,bondOrder:t.SINGLE,stereo:r.NONE}}},a=(i("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),i("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),this.getEditorConfigs().getStructureConfigs().getEnabledBondForms()),s=Kekule.ObjUtils.getOwnedFieldNames(a,!1),l=[],d=0,u=s.length;d<u;++d){var c=s[d];a[c]&&(DataType.isObjectValue(a[c])?l.push(a[c]):n[c]&&l.push(n[c]))}return l}}),Kekule.Editor.ChemSpaceEditor.Settings=Class.create(Kekule.Editor.BaseEditor.Settings,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor.Settings",initProperties:function(){this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAllowCreateNewChild()},setter:function(e){this.getEditor().setAllowCreateNewChild(e)}}),this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAutoCreateNewStructFragment()},setter:function(e){this.getEditor().setAutoCreateNewStructFragment(e)}}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAllowAppendDataToCurr()},setter:function(e){this.getEditor().setAllowAppendDataToCurr(e)}})}}),Kekule.Editor.BasicMolEraserIaController=Class.create(Kekule.Editor.BasicEraserIaController,{CLASS_NAME:"Kekule.Editor.BasicMolEraserIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},doGetActualRemovedObjs:function(e){for(var t=[],r=this.getEditor().getChemObj(),i=0,o=e.length;i<o;++i){var n,a=e[i];a instanceof Kekule.ChemSpace&&a===r?n=a.getChildren():(Kekule.ArrayUtils.pushUnique(t,a),n=a.getCascadeDeleteObjs?a.getCascadeDeleteObjs():[]),n&&Kekule.ArrayUtils.pushUnique(t,n)}return t},doRemoveObjs:function(e){if(e.length){for(var t=new Kekule.MacroOperation,r=[],i=0,o=e.length;i<o;++i){var n,a=e[i],s=(a.getParent(),this.getEditor());a instanceof Kekule.BaseStructureNode?(n=new Kekule.ChemStructOperation.RemoveNode(a,null,null,s),Kekule.ArrayUtils.pushUnique(r,a.getParent())):a instanceof Kekule.BaseStructureConnector?(n=new Kekule.ChemStructOperation.RemoveConnector(a,null,null,s),Kekule.ArrayUtils.pushUnique(r,a.getParent())):n=new Kekule.ChemObjOperation.Remove(a,null,null,s),n&&t.add(n)}for(i=0,o=r.length;i<o;++i){var l=r[i];if(l&&l instanceof Kekule.StructureFragment){var d=new Kekule.ChemStructOperation.StandardizeStructFragment(l,s);d.setEnableSplit(this.getEditor().canCreateNewChild()),t.add(d)}}s.execOperation(t)}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolEraserIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.BasicMolManipulationIaController=Class.create(Kekule.Editor.BasicManipulationIaController,{CLASS_NAME:"Kekule.Editor.BasicMolManipulationIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._suppressConstrainedMoving=!1,this._suppressConstrainedRotating=!1,this._isInDirectedMoving=!1,this._directedMovingDirection=null},initProperties:function(){this._defineEditorConfigBasedProperty("enableMagneticMerge","interactionConfigs.enableMagneticMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableNodeMerge","interactionConfigs.enableNodeMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableNeighborNodeMerge","interactionConfigs.enableNeighborNodeMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableConnectorMerge","interactionConfigs.enableConnectorMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableStructFragmentMerge","interactionConfigs.enableStructFragmentMerge",{overwrite:!0}),this.defineProp("allManipulateObjsMerged",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("isMergeDone",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableNodeStick",{dataType:DataType.BOOL}),this.defineProp("enableSiblingStick",{dataType:DataType.BOOL}),this.defineProp("enableStructFragmentStick",{dataType:DataType.BOOL}),this.defineProp("enableConstrainedMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableConstrainedRotate",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableConstrainedResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableDirectedMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("stickOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergeOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergePreviewOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergingDests",{dataType:DataType.ARRAY,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Kekule.globalOptions.get("chemWidget.editor.molManipulation",{});e=Object.extend({enableMagneticMerge:!0,enableNodeMerge:!0,enableNeighborNodeMerge:!0,enableConnectorMerge:!0,enableStructFragmentMerge:!0,enableNodeStick:!0,enableStructFragmentStick:!0,enableConstrainedMove:!0,enableConstrainedRotate:!0,enableConstrainedResize:!0,enableDirectedMove:!0},e),this.setEnableMagneticMerge(e.enableMagneticMerge),this.setEnableNodeMerge(e.enableNodeMerge),this.setEnableNeighborNodeMerge(e.enableNeighborNodeMerge),this.setEnableConnectorMerge(e.enableConnectorMerge),this.setEnableStructFragmentMerge(e.enableStructFragmentMerge),this.setEnableNodeStick(e.enableNodeStick),this.setEnableStructFragmentStick(e.enableStructFragmentStick),this.setEnableConstrainedMove(e.enableConstrainedMove),this.setEnableConstrainedRotate(e.enableConstrainedRotate),this.setEnableConstrainedResize(e.enableConstrainedResize),this.setEnableDirectedMove(e.enableDirectedMove)},canInteractWithObj:function(e){return this.tryApplySuper("canInteractWithObj",[e])||this._isMerging&&e},doSetManipulateObjs:function(t){var r=t?e.clone(t):[];this.getMergingDests()&&!this.useMergePreview()&&e.pushUnique(r,this.getMergingDests()),this.setPropStoreFieldValue("manipulateObjs",t),t?this.getEditor().prepareOperatingObjs(r):this.getEditor().endOperatingObjs()},isConstrainedRotate:function(){return this.getEnableConstrainedMove()},isConstrainedResize:function(){return this.getEnableConstrainedResize()},isConstrainedMove:function(){if(!this.getEnableConstrainedMove())return!1;var e=this.getManipulateObjs();if(1===e.length){var t=e[0],r=this.getEditor().getSelection();if(r&&r.indexOf(t)<0)return t.getConstraintManipulationBaseObj&&t.getConstraintManipulationBaseObj()}return!1},isInActualConstrainedRotation:function(){return this.isConstrainedRotate()&&!this._suppressConstrainedRotating},isDirectedMove:function(){return this.getEnableDirectedMove()&&!this.isConstrainedMove()&&this._isInDirectedMoving},useMergePreview:function(){return this._useMergePreview},setUseMergePreview:function(e){this._useMergePreview=e},getMergeOperationsInManipulating:function(){return this._useMergePreview?this.getMergePreviewOperations():this.getMergeOperations()},createManipulateObjInfo:function(e,t,r){var i=this.getEditor(),o=this.tryApplySuper("createManipulateObjInfo",[e,t,r]);if(this.isConstrainedMove()){var n=e.getConstraintManipulationBaseObj();if(n&&(o.isConstrained=!0,!o.hasNoCoord)){o.originScreenCoord=i.getObjectScreenCoord(e),o.refScreenCoord=i.getObjectScreenCoord(n),o.connectorScreenLength=Kekule.CoordUtils.getDistance(o.screenCoord,o.refScreenCoord),o.connectorObjLength=Kekule.CoordUtils.getDistance(i.getObjCoord(e),i.getObjCoord(n));var a=Kekule.CoordUtils.substract(o.originScreenCoord,o.refScreenCoord);o.originBondDirectionAngle=Math.atan2(a.y,a.x),o.constrainedBondDirectionDelta=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionDelta(),o.constrainedBondDirectionAngles=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngles(),o.constrainedBondDirectionAngleThreshold=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngleThreshold()}}return o},getAllowLengthChangeInConstrainedMoving:function(e){return e instanceof Kekule.Glyph.PathGlyphNode},_getTransformCompareThresholds:function(e){return e===Kekule.CoordMode.COORD3D?this.tryApplySuper("_getTransformCompareThresholds",[e]):{translate:this.getEditorConfigs().getStructureConfigs().getDefBondLength()||this.getEditor().getChemSpace().getAutoScaleRefLength()||.05,rotate:this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep()/5,scale:this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep()/5}},_calcActualMovedScreenCoord:function(e,t,r){var i,o=Kekule.CoordUtils,n=r;if(t.isConstrained&&!this._suppressConstrainedMoving){var a,s,l=t.constrainedBondDirectionDelta||null,d=t.constrainedBondDirectionAngles||null,u=t.constrainedBondDirectionAngleThreshold||null,c=!1,p=o.substract(r,t.refScreenCoord),h=Math.atan2(p.y,p.x),g=o.getDistance(p);if(d&&u)for(var C=0,_=d.length;C<_;++C){var m=d[C];Math.abs(m-h)<=u&&(c=!0,a=m)}if(!c&&l){var f=Math.round((h-t.originBondDirectionAngle)/l);a=t.originBondDirectionAngle+f*l,c=!0}if(c||(a=h),this.getAllowLengthChangeInConstrainedMoving(e)){var S=this.getEditor().getDefBondScreenLength(),y=g/S,O=this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep();s=S*(y=(Math.round(y/O)||1)*O)}else s=t.connectorScreenLength;i=o.add(t.refScreenCoord,{x:s*Math.cos(a),y:s*Math.sin(a)})}else i=n;return i},_calcActualRotateAngle:function(e,t,r,i){var o=this.isConstrainedRotate()&&!this._suppressConstrainedRotating?this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;return o?Math.round(t/o)*o:this.tryApplySuper("_calcActualRotateAngle",[e,t])},_calcActualResizeScales:function(e,t){if(this.isConstrainedResize()&&!this._suppressConstrainedResize){var r=this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep();return r?{scaleX:(Math.round(t.scaleX/r)||1)*r,scaleY:(Math.round(t.scaleY/r)||1)*r}:t}return t},prepareManipulating:function(e,t,r,i,o,n){this.setUseMergePreview(this.getEditorConfigs().getInteractionConfigs().getEnableMergePreview()),this.setMergeOperations([]),this.setMergePreviewOperations([]),this.setStickOperations([]),this.tryApplySuper("prepareManipulating",[e,t,r,i,o,n]),this._directedMovingDirection=null,this.setManuallyHotTrack(!0)},manipulateBeforeStopping:function(){if(this.tryApplySuper("manipulateBeforeStopping"),this.useMergePreview()){var e=this.getMergePreviewOperations();if(e&&e.length){for(var t=this.getMergeOperations(),r=0,i=e.length;r<i;++r){var o=e[r];if(o){var n=o instanceof Kekule.ChemStructOperation.MergeConnectorsBase?this.createConnectorMergeOperation(o.getTarget(),o.getDest()):this.createNodeMergeOperation(o.getTarget(),o.getDest());t.push(n)}}this.executeMergeOpers(t)}}},manipulateEnd:function(){this.tryApplySuper("manipulateEnd"),this.getEditor().hideHotTrack(),this.setManuallyHotTrack(!1)},createManipulateOperation:function(){this.tryApplySuper("createManipulateOperation"),this.setMergeOperations([]),this.setMergePreviewOperations([]),this.setStickOperations([])},getAllObjOperations:function(e){var t=this.getMergeOperations(),r=this.tryApplySuper("getAllObjOperations")||[];t&&t.length&&Kekule.ArrayUtils.pushUnique(r,t);var i=this.getStickOperations();if(i&&i.length)for(var o=0,n=i.length;o<n;++o){var a=i[o];a&&(a.getStickTarget&&!a.getStickTarget()?r.unshift(a):r.push(a))}return r},_objCanBeMagneticMerged:function(e){return!(e instanceof Kekule.StructureFragment)&&(e instanceof Kekule.ChemStructureNode||e instanceof Kekule.ChemStructureConnector)},_objCanBeMagneticSticked:function(e){return!(e instanceof Kekule.StructureFragment)&&(e instanceof Kekule.BaseStructureNode&&e.getAllowCoordStickTo())},_canStickNode:function(e,t){if(this.getEnableNodeStick()){var r=this.getEnableStructFragmentStick(),i=this.getEnableSiblingStick();return Kekule.ChemObjOperation.StickTo.canStick(e,t,r,i)}return!1},_canMergeNodes:function(e,t){if(this.getEnableNodeMerge()){var r=this.getEnableStructFragmentMerge(),i=this.getEnableNeighborNodeMerge();return Kekule.ChemStructOperation.MergeNodes.canMerge(e,t,r,i)}return!1},_canMergeConnectors:function(e,t){if(this.getEnableConnectorMerge()){var r=this.getEnableStructFragmentMerge();return Kekule.ChemStructOperation.MergeConnectors.canMerge(e,t,r)}return!1},_findSuitableMergeTargetBoundInfo:function(e,t,r,i){for(var o=e.length-1;o>=0;--o){var n=e[o],a=n.obj;if(!(t.indexOf(a)>=0)&&(a instanceof r&&(!i||i(a))))return n}return null},_getCoordStickActualTarget:function(e){for(var t=e,r=t.getCoordStickTarget&&t.getCoordStickTarget();r;)r=(t=r).getCoordStickTarget&&t.getCoordStickTarget();return t},_getMagneticNodeMergeOrStickDestInfo:function(e,t,r){var i=this.getEditor(),o=this;if(t){var n=i.getBoundInfosAtCoord(t,function(t){var i=t.obj,n=o._getCoordStickActualTarget(i);return e!==i&&r.indexOf(i)<0&&(i instanceof Kekule.BaseStructureNode&&o._canMergeNodes(e,i)||o._canStickNode(e,n))},this.getCurrBoundInflation()),a=n.length?n[n.length-1]:null;if(a){var s=a.obj,l=this._getCoordStickActualTarget(s);return this._canMergeNodes(e,s)?{obj:s,isMerge:!0}:this._canStickNode(e,l)?{obj:l,isStick:!0}:null}return null}return null},moveManipulatedObjs:function(e){var t;if(this.isDirectedMove()){var r=Kekule.CoordUtils,i=this.getStartCoord(),o=r.getDistance(i,e),n=r.substract(e,i),a=this._directedMovingDirection;this._directedMovingDirection||(a=Math.abs(n.x)>=Math.abs(n.y)?"x":"y",o<this.getEditor().getEditorConfigs().getInteractionConfigs().getDirectedMoveDistanceThreshold()||(this._directedMovingDirection=a)),(t=Object.extend({},i))[a]=e[a]}else t=e;return this.tryApplySuper("moveManipulatedObjs",[t])},applyManipulatingObjsInfo:function(e){var t={MERGE:0,MERGE_BOND:1,STICK:10,UNSTICK:20};this.setAllManipulateObjsMerged(!1);var r=this.useMergePreview(),i=this.getEditor();i.hotTrackOnObj(null);var o=Kekule.Editor.BasicManipulationIaController.ManipulationType,n=this.getManipulationType(),a=this.getManipulateOriginObjs(),s=this.getManipulateObjs(),l=[].concat(a);Kekule.ArrayUtils.pushUnique(l,s);var d=this.getMergeOperationsInManipulating(),u=this.getStickOperations(),c=this,p=1===a.length&&a[0]instanceof Kekule.ChemStructureConnector,h=1===s.length&&s[0]instanceof Kekule.BaseStructureNode&&(this._objCanBeMagneticMerged(s[0])||this._objCanBeMagneticSticked(s[0])),g=n===o.MOVE&&!this.getIsOffsetManipulating()&&(p&&this.getEnableConnectorMerge()||h&&this.getEnableNodeMerge()),C=!p&&this.getEnableMagneticMerge();if(C||g){var _=this.getManipulateObjCurrInfoMap(),m=this.getManipulateObjInfoMap(),f=[],S=[],y=[],O=[];if(g){var E=p?a[0]:s[0],T=this._calcMagneticMergeOrStickInfoOnScreenCoord(e,E,this._isManipulatingSingleStickedObj(s),_,m,l,t);if(T)f=[0],S=[T.magneticObj],y=[T.magneticDest],O=[T.magneticType];else if(p&&this.getEnableConnectorMerge()){var A=i.getBoundInfosAtCoord(e,null,this.getCurrBoundInflation()),k=Kekule.ChemStructureConnector,b=(E=a[0],this._findSuitableMergeTargetBoundInfo(A,l,k,function(e){return c._canMergeConnectors(E,e)}));b&&(f=[0],S=[E],y=[b.obj],O=[t.MERGE_BOND])}}if(!S.length&&C){var I=this._calcMagneticMergeOrStickInfos(s,_,m,l,t);f=I.magneticObjIndexes,S=I.magneticObjs,y=I.magneticDests,O=I.magneticTypes}if(S.length||u.length){var D=S.length;this.setAllManipulateObjsMerged(D===s.length);for(var P=1===D,v=!1,R=!1,K=[],M=[],N=0,L=S.length;N<L;++N){var x=S[N],B=y[N],w=f[N];if(O[N]===t.STICK){if(!R){if(!(V=u[w])||!this.isSameNodeStick(V,x,B)){R=!0;break}M.push(V)}}else if(!v)(j=d[w])&&this.isSameNodeMerge(j,x,B)?K.push(j):v=!0;if(v&&R)break}for(N=0,L=d.length;N<L;++N){var j;if(j=d[N]){if((w=K.indexOf(j))<0){v=!0;break}K.splice(w,1)}}for(N=0,L=u.length;N<L;++N){var V;if(V=u[N]){if((w=M.indexOf(V))<0){R=!0;break}M.splice(w,1)}}if(v||R||P){v&&this.reverseMergeOpers(this.getMergeOperationsInManipulating()),R&&this.reverseStickOpers(this.getStickOperations());var U=Kekule.CoordUtils;if(1===D||i.getCoordMode()===Kekule.CoordMode.COORD3D){if(O[0]!==t.MERGE_BOND){var W=(ie=_.get(S[0]))&&ie.screenCoord,F=i.getObjectScreenCoord(y[0]);if(W&&F){var H=U.substract(F,W),G=!1,z=Kekule.NumUtils.isFloatEqual;if(!z(H.x,0,1e-10)||!z(H.y,0,1e-10))for(N=0,L=s.length;N<L;++N){x=s[N];var $=_.get(x);if(x!==S[0]){if($&&$.screenCoord){var Y=U.add($.screenCoord,H);$.screenCoord=Y,this._getMagneticNodeMergeOrStickDestInfo(x,Y,l)&&(G=!0)}}else $&&$.screenCoord&&($.screenCoord=F)}if(G)return this.applyManipulatingObjsInfo(e);for(N=0,L=s.length;N<L;++N){x=s[N],$=_.get(x);this.applySingleManipulatingObjInfo(N,x,$,e)}}}}else if(D>1&&i.getCoordMode()!==Kekule.CoordMode.COORD3D){var X=S[0],J=S[1];if(X&&J){var Z=m.get(X).screenCoord,q=m.get(J).screenCoord,Q=i.getObjectScreenCoord(y[0]),ee=i.getObjectScreenCoord(y[1]),te=U.calcCoordGroup2DTransformParams(Z,q,Q,ee),re=U.calcTransform2DMatrix(te);for(G=!1,N=0,L=s.length;N<L;++N){x=s[N];if(S.indexOf(x)<0){$=m.get(x);var ie=_.get(x);if($.screenCoord){Y=U.transform2DByMatrix($.screenCoord,re);ie.screenCoord=Y,this._getMagneticNodeMergeOrStickDestInfo(x,Y,l)&&(G=!0)}$.size&&(ie.size=U.multiply($.size,te.scale))}}if(G)return this.applyManipulatingObjsInfo(e);for(N=0,L=s.length;N<L;++N){x=s[N];if(S.indexOf(x)<0){ie=_.get(x);this.applySingleManipulatingObjInfo(N,x,ie,e)}}}}if(v||R){var oe=[];this._mergeOperationsChanged(D,S,y);for(N=0,L=D;N<L;++N){x=S[N],B=y[N],w=f[N];var ne=O[N];if(ne===t.STICK){if(B!==m.get(x).stickTarget)var ae=this.createNodeStickOperation(x,B);this.getStickOperations()[w]=ae,B||oe.push({index:w,obj:x,newInfo:_.get(x)})}else if(r){var se=ne===t.MERGE_BOND?this.createConnectorMergeOperation(x,B,!0):this.createNodeMergeOperation(x,B,!0);this.getMergePreviewOperations()[w]=se}else{var le=ne===t.MERGE_BOND?this.createConnectorMergeOperation(x,B):this.createNodeMergeOperation(x,B);this.getMergeOperations()[w]=le}}if(v&&this.executeMergeOpers(this.getMergeOperationsInManipulating()),R&&this.executeStickOpers(this.getStickOperations()),oe.length)for(N=0,L=oe.length;N<L;++N){var de=oe[N];this.applySingleManipulatingObjInfo(de.index,de.obj,de.newInfo,e)}}}return void i.hotTrackOnObj(y)}}(d=this.getMergeOperationsInManipulating())&&d.length&&(this._mergeOperationsChanged(0,[],[]),this.reverseMergeOpers(d)),this.tryApplySuper("applyManipulatingObjsInfo",[e])},_calcMagneticMergeOrStickInfoOnScreenCoord:function(e,t,r,i,o,n,a){var s=this.getEditor(),l=(this._objCanBeMagneticMerged,this._objCanBeMagneticSticked,t),d=e;if(d){s.getBoundInfosAtCoord(d,null,this.getCurrBoundInflation());var u=this._getMagneticNodeMergeOrStickDestInfo(l,d,n),c=null,p=null;if(u&&(u.isStick?p=u.obj:u.isMerge&&(c=u.obj)),c||p)return{magneticObj:l,magneticDest:c||p,magneticType:p?a.STICK:a.MERGE};if(!p&&r&&o.get(l).stickTarget)return{magneticObj:l,magneticDest:null,magneticType:a.STICK}}},_calcMagneticMergeOrStickInfos:function(e,t,r,i,o){for(var n=this._isManipulatingSingleStickedObj(e),a=this._objCanBeMagneticMerged,s=this._objCanBeMagneticSticked,l=(this.getEditor(),[]),d=[],u=[],c=[],p=0,h=e.length;p<h;++p){var g=e[p];if(a(g)||s(g)){var C=t.get(g),_=C&&C.screenCoord;if(_){var m=this._calcMagneticMergeOrStickInfoOnScreenCoord(_,g,n,t,r,i,o);m&&(l.push(p),d.push(m.magneticObj),u.push(m.magneticDest),c.push(m.magneticType))}}}return{magneticObjIndexes:l,magneticObjs:d,magneticDests:u,magneticTypes:c}},_mergeOperationsChanged:function(e,t,r){},doMoveManipulatedObj_old:function(e,t,r,i){var o=this.getEditor(),n=(this.getManipulateObjInfoMap().get(t),r),a=this.getManipulateOriginObjs(),s=this.getManipulationType(),l=s===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE&&1===a.length&&a[0]instanceof Kekule.ChemStructureConnector,d=n,u=null,c=this.getMergeOperations(),p=c[e],h=this.getManipulateObjs();if(!l&&this.getEnableMagneticMerge()&&t instanceof Kekule.ChemStructureNode){var g=o.getBoundInfosAtCoord(d);if(g&&g.length){for(var C=g.length-1;C>=0;--C){var _=g[C].obj;if(_!==t&&(!(h.indexOf(_)>=0)&&_ instanceof Kekule.ChemStructureNode&&this._canMergeNodes(t,_))){if(o.addHotTrackedObj(_),this.isSameNodeMerge(p,t,_))return;u=this.createNodeMergeOperation(t,_);break}}u?(p&&this.reverseMergeOpers(e),this.getMergeOperations()[e]=u,this.executeMergeOpers()):o.hotTrackOnObj(null)}}d=i;if(s===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE){var m=a[0];if(a&&1===a.length){var f=o.getTopmostBoundInfoAtCoord(d,[m]);if(f){var S=f.obj;if(S&&h.indexOf(S)<0){if(l&&m instanceof Kekule.ChemStructureConnector&&S instanceof Kekule.ChemStructureConnector)this.getEnableConnectorMerge()&&(o.hotTrackOnObj(S),(!!this.getEnableStructFragmentMerge()||m.getParent()===S.getParent())&&(u=this.createConnectorMergeOperation(m,S)));else if(m instanceof Kekule.ChemStructureNode&&S instanceof Kekule.ChemStructureNode&&this._canMergeNodes(m,S)){if(o.hotTrackOnObj(S),this.isSameNodeMerge(p,m,S))return;u=this.createNodeMergeOperation(m,S)}if(u)return(p=c[e])&&this.reverseMergeOpers(e),this.getMergeOperations()[e]=u,void this.executeMergeOpers()}}}}u||(o.hideHotTrack(),!!this.getMergeOperations().length&&this.reverseMergeOpers(e),this.tryApplySuper("doMoveManipulatedObj_old",[e,t,r,i]))},createNodeMergeOperation:function(e,t,r){var i=this.getEnableStructFragmentMerge();return Kekule.ChemStructOperation.MergeNodes.canMerge(e,t,i,this.getEnableNeighborNodeMerge())?r?new Kekule.ChemStructOperation.MergeNodesPreview(e,t,i,this.getEditor()):new Kekule.ChemStructOperation.MergeNodes(e,t,i,this.getEditor()):null},createConnectorMergeOperation:function(e,t,r){var i=this.getEnableStructFragmentMerge();return Kekule.ChemStructOperation.MergeConnectors.canMerge(e,t,i)?new(r?Kekule.ChemStructOperation.MergeConnectorsPreview:Kekule.ChemStructOperation.MergeConnectors)(e,t,this.getEditor().getCoordMode(),i,this.getEditor()):null},createNodeStickOperation:function(e,t){this.getEnableStructFragmentStick();return this._canStickNode(e,t)?new Kekule.ChemObjOperation.StickTo(e,t,this.getEditor()):null},isSameConnectorMerge:function(e,t,r){return e&&e instanceof Kekule.ChemStructOperation.MergeConnectorsBase&&t===e.getTarget()&&r===e.getDest()},isSameNodeMerge:function(e,t,r){return e&&e instanceof Kekule.ChemStructOperation.MergeNodesBase&&t===e.getTarget()&&r===e.getDest()},isSameNodeStick:function(e,t,r){return e&&e instanceof Kekule.ChemObjOperation.StickTo&&t===e.getTarget()&&r===e.getStickTarget()},isSameNodeMergeOrStick:function(e,t,r){return this.isSameNodeMerge(e,t,r)||this.isSameNodeStick(e,t,r)},executeStickOpers:function(e){var t=this.getEditor(),r=Kekule.ArrayUtils.toUnique(e||this.getStickOperations());t.beginUpdateObject();try{for(var i=0,o=r.length;i<o;++i)r[i]&&r[i].execute()}finally{t.endUpdateObject()}},reverseStickOpers:function(e){var t=this.getEditor(),r=e||this.getStickOperations(),i=Kekule.ArrayUtils.toUnique(r);if(i&&i.length){t.beginUpdateObject();try{for(var o=i.length-1;o>=0;--o)i[o]&&i[o].reverse();r.length=0}finally{t.endUpdateObject()}}else;},executeMergeOpers:function(t){var r=this.getEditor(),i=Kekule.ArrayUtils.toUnique(t||this.getMergeOperationsInManipulating()),o=[];r.beginUpdateObject();try{for(var n=0,a=i.length;n<a;++n)if(i[n]){i[n].execute();var s=i[n].getDest?i[n].getDest():null;s&&e.pushUnique(o,s)}this.setMergingDests(o.length?o:null),this.refreshManipulateObjs(),this._mergeJustReversed=!1}finally{r.endUpdateObject()}},reverseMergeOpers:function(e){var t=this.getEditor();this.setMergingDests(null);var r=e||this.getMergeOperationsInManipulating(),i=Kekule.ArrayUtils.toUnique(r);if(i&&i.length){t.beginUpdateObject();try{for(var o=i.length-1;o>=0;--o)i[o]&&i[o].reverse();r.length=0,this._mergeJustReversed=!0,this.refreshManipulateObjs()}finally{t.endUpdateObject()}}else;},react_pointermove:function(e){return this._suppressConstrainedMoving=e.getAltKey(),this._suppressConstrainedRotating=e.getAltKey(),this._suppressConstrainedResize=e.getAltKey(),this._isInDirectedMoving=e.getShiftKey(),this.tryApplySuper("react_pointermove",[e])}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolManipulationIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.SelectIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.SelectIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Kekule.globalOptions.get;this.setEnableSelect(e("chemWidget.editor.enableSelect",!0)),this.setEnableGestureManipulation(e("chemWidget.editor.enableGesture",!0))}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.SelectIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.StructureInsertIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.StructureInsertIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._manipulatedBasicObjs=null},getInsertedObjs:function(){return this._manipulatedBasicObjs},doSetManipulateOriginObjs:function(e){return this._manipulatedBasicObjs=this._getManipulatedBasicObjects(e),this.tryApplySuper("doSetManipulateOriginObjs",[e])},_getManipulatedBasicObjects:function(t){for(var r=[],i=0,o=t.length;i<o;++i){var n=t[i];if(n instanceof Kekule.ChemStructureObject)if(n instanceof Kekule.StructureFragment&&n.isExpanded()){var a=[].concat(n.getNodes()).concat(n.getConnectors());e.pushUnique(r,a)}else e.pushUnique(r,n);else e.pushUniqueEx(r,n)}return r},stopManipulate:function(){if(this.needAutoSelectNewlyInsertedObjects()){var e=this.getInsertedObjs();this.doneInsertOrModifyBasicObjects(e)}return this.tryApplySuper("stopManipulate")}}),Kekule.Editor.MolBondIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.MolBondIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setState(i.State.INITIAL),this.setBondOrder(Kekule.BondOrder.SINGLE)},initProperties:function(){this.defineProp("allowBondingToBond",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("state",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableBondModification",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("autoSwitchBondOrder",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("startingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("endingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("structFragment",{dataType:"Kekule.ChemStructureFragment",serializable:!1}),this.defineProp("autoCreatedStructFragment",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("autoCreatedStartingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("bond",{dataType:"Kekule.Bond",serializable:!1}),this.defineProp("bondType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("bondOrder",{dataType:DataType.INT,serializable:!1}),this.defineProp("bondStereo",{dataType:DataType.INT,serializable:!1}),this.defineProp("initialBondDirection",{dataType:DataType.FLOAT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!1),this.setEnableMove(!0),this.setEnableNeighborNodeMerge(!1);var e=Kekule.globalOptions.get;this.setEnableBondModification(e("chemWidget.editor.bondManipulation.enableBondModification",!0)),this.setAllowBondingToBond(e("chemWidget.editor.bondManipulation.allowBondingToBond",!1)),this.setAutoSwitchBondOrder(e("chemWidget.editor.bondManipulation.autoSwitchBondOrder",!1))},_isBondDifferent:function(e){var t=this.getBondStereo(),r=Kekule.BondStereo;return t===r.UP||t===r.UP_INVERTED||t===r.DOWN||t===r.DOWN_INVERTED||(e.getBondType()!==this.getBondType()||e.getBondOrder()!==this.getBondOrder()||e.getStereo()!==this.getBondStereo())},_isBondOrderSwitchApplicable:function(e){return this.getAutoSwitchBondOrder()&&this.getBondOrder()===Kekule.BondOrder.SINGLE&&this.getBondType()===Kekule.BondType.COVALENT&&this.getBondStereo()===Kekule.BondStereo.NONE&&(!e.getBondType()||e.getBondType()===Kekule.BondType.COVALENT)&&(!e.getStereo()||e.getStereo()===Kekule.BondStereo.NONE)},canInteractWithObj:function(e){if(this.getState()!==i.State.INITIAL)return this.tryApplySuper("canInteractWithObj",[e]);if(e instanceof Kekule.ChemStructureNode)return!0;if(e instanceof Kekule.ChemStructureConnector){if(this.getAllowBondingToBond())return!0;if(!this.getEnableBondModification())return!1;if(e instanceof Kekule.Bond)return this._isBondDifferent(e)||this._isBondOrderSwitchApplicable(e)}},doTestMouseCursor:function(e,t){return""},getInsertedObjs:function(){var e=this.getBond();return e?[e]:this.tryApplySuper("getInsertedObjs")},isObjValidBondTerminator:function(e){return!!e&&(this.getAllowBondingToBond()?e instanceof Kekule.ChemStructureNode||e instanceof Kekule.ChemStructureConnector:e instanceof Kekule.ChemStructureNode)},isBond:function(e){return e instanceof Kekule.Bond},getNewBondDefAngle:function(e,t){return this.getEditorConfigs().getStructureConfigs().getNewBondDefAngle(e,t)},addDefBond:function(e,t,r){var i;(a=this.getEditor()).beginUpdateObject();try{if(t)this.setAutoCreatedStartingObj(null),this.setAutoCreatedStructFragment(null);else{if(!this.getEditor().canAddUnconnectedStructFragment())return null;var o=this.getEditor().screenCoordToObj(e),n=this.getEditor().getOnlyOneBlankStructFragment();n?(t=this.getEditor().createStructStartingAtom(n,null,o),this.setAutoCreatedStructFragment(null),this.setAutoCreatedStartingObj(t)):(t=this.getEditor().createNewStructFragmentAndStartingAtom(null,o),this.setAutoCreatedStartingObj(null),this.setAutoCreatedStructFragment(t?t.getParent():null))}if(this.isObjValidBondTerminator(t)){var a=this.getEditor();this.setStartingObj(t);var s=t.getParent();this.setStructFragment(s);var l=this.getEditorConfigs().getStructureConfigs(),d=Kekule.oneOf(this.getBondType(),l.getDefBondType()),u=Kekule.oneOf(this.getBondOrder(),l.getDefBondOrder()),c=Kekule.oneOf(this.getBondStereo(),Kekule.BondStereo.NONE),p=a.getDefBondLength?a.getDefBondLength():l.getDefBondLength(),h=this.getNewBondDefAngle(t,u),g=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingLocation(t,p,h,this.getEditor().getAllowCoordBorrow()),C=this.getEditor().createDefaultNode(g,Kekule.Editor.CoordSys.OBJ,s);this.setEndingObj(C);var _=new Kekule.Bond;_.setBondType(d),_.setBondOrder(u),_.setStereo(c),s.appendConnector(_),_.appendConnectedObj(t),_.appendConnectedObj(C),this.setBond(_),r&&this.getEditor().objectsChanged([{obj:_},{obj:C}]),i=g}else i=null}finally{a.endUpdateObject()}return i},addOperationToEditor:function(){return this.tryApplySuper("addOperationToEditor")},getAllObjOperations:function(e){var t=this.tryApplySuper("getAllObjOperations",[e])||[],r=this.getAddBondOperation();return r&&t.unshift(r),t},getAddBondOperation:function(){var e=new Kekule.MacroOperation,t=this.getEditor(),r=this.getAutoCreatedStructFragment();if(r){var i=new Kekule.ChemObjOperation.Add(r,this.getEditor().getChemObj(),null,this.getEditor());e.add(i)}var o=this.getStartingObj(),n=this.getEndingObj(),a=this.getBond(),s=this.getStructFragment(),l=(t=this.getEditor(),this.getAutoCreatedStartingObj());if(l){var d=new Kekule.ChemStructOperation.AddNode(l,s,null,t);e.add(d)}d=new Kekule.ChemStructOperation.AddNode(n,s,null,t);e.add(d);var u=new Kekule.ChemStructOperation.AddConnector(a,s,null,[o,n],t);return e.add(u),e},modifyBond:function(e){var t,r=this.getBondType(),i=Kekule.BondOrder,o=[i.SINGLE,i.DOUBLE,i.TRIPLE];if(this._isBondOrderSwitchApplicable(e)){var n=e.getBondOrder(),a=o.indexOf(n);t=o[a=a>=0?++a%o.length:0]}else t=this.getBondOrder();var s=e.getStereo(),l=this.getBondStereo();s===l&&(l=Kekule.BondStereo.getInvertedDirection(l));var d={bondType:r,bondOrder:t,stereo:l},u=!1;for(var c in d){if(e.getPropValue(c)!==d[c]){u=!0;break}}if(u){var p=this.getEditor();p.beginUpdateObject();try{var h=new Kekule.ChemObjOperation.Modify(e,d,this.getEditor());h.execute(),p.pushOperation(h);for(var g=[e].concat(e.getConnectedObjs()),C=[],_=0,m=g.length;_<m;++_)C.push({obj:g[_]});this.getEditor().objectsChanged(C)}finally{p.endUpdateObject()}}},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var t=i.State,r=this._getEventMouseCoord(e);if(this.getState()===t.INITIAL){var o=this.getEditor().getTopmostBoundInfoAtCoord(r,null,this.getCurrBoundInflation());if(o){var n=o.obj;if(this.isObjValidBondTerminator(n))return this.addDefBond(r,n,!0)&&(this.startDirectManipulate(null,this.getEndingObj(),r),this.moveManipulatedObjs(r)),!0;if(this.isBond(n)&&this.getEnableBondModification())return this.modifyBond(n),!0;e.preventDefault()}else if(this.getEditor().canAddUnconnectedStructFragment()){return this.addDefBond(r,null,!0)&&(this.startDirectManipulate(null,this.getEndingObj(),r),this.moveManipulatedObjs(r)),e.preventDefault(),!0}}}},react_pointerup:function(e){var t=this.getState(),r=this.getStartCoord(),i=this._getEventMouseCoord(e),o=Kekule.Editor.BasicManipulationIaController.State;return t===o.MANIPULATING&&e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT&&(e.preventDefault(),Kekule.CoordUtils.isEqual(r,i))?(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(o.NORMAL),!0):this.tryApplySuper("react_pointerup",[e])}}),Kekule.Editor.MolBondIaController.State={INITIAL:0,START_NODE_SET:21,ADJUSTING:22};var i=Kekule.Editor.MolBondIaController;Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolBondIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolAtomIaController_OLD=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController_OLD",initialize:function(e){this.tryApplySuper("initialize",[e]),this._createNonAtomLabelInfos(),this._setterShown=!1},finalize:function(){this.getAtomSetter()&&this.getAtomSetter().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("periodicTable",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:!1})},canInteractWithObj:function(e){return!!this.isValidNode(e)},isValidNode:function(e){return e instanceof Kekule.ChemStructureNode},getNodeLabel:function(e){var t=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();if(e.getIsotopeId)return e.getIsotopeId();if(e instanceof Kekule.SubGroup)return e.getAbbr()||e.getFormulaText()||t.getRgroup();if(e instanceof Kekule.VariableAtom){var r=e.getAllowedIsotopeIds(),i=e.getDisallowedIsotopeIds();return r&&r.length?this._getVarAtomListLabel():i&&i.length?this._getVarAtomNotListLabel():this._getVarAtomListLabel()}var o=e.getCoreDisplayRichTextItem(null,null,t);return Kekule.Render.RichTextUtils.toText(o)},_getVarAtomListLabel:function(){return this.getEditor().getRenderConfigs().getDisplayLabelConfigs().getVariableAtom()},_getVarAtomNotListLabel:function(){return"~"+this.getEditor().getRenderConfigs().getDisplayLabelConfigs().getVariableAtom()},_createNonAtomLabelInfos:function(){var e=[],t=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return e.push({nodeLabel:t.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")}),e.push({nodeLabel:t.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")}),e.push({nodeLabel:t.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")}),e.push({nodeLabel:t.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")}),e.push({nodeLabel:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")}),e.push({nodeLabel:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")}),this.setNonAtomLabelInfos(e),e},_indexOfNonAtomLabel:function(e){for(var t=this.getNonAtomLabelInfos(),r=0,i=t.length;r<i;++r){if(t[r].nodeLabel===e)return r}return-1},_getNonAtomInfo:function(e){var t=this._indexOfNonAtomLabel(e);return t<0?null:this.getNonAtomLabelInfos()[t]},getAtomSetterWidget:function(e){var t=this.getAtomSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createAtomSetterWidget(i,r),this.setAtomSetter(t)}return t},_createAtomSetterWidget:function(e,t){for(var r=new Kekule.Widget.ComboBox(e),i=this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms(),o=[],n=0,a=i.length;n<a;++n)o.push({value:i[n],data:{props:{isotopeId:i[n]}}});o.push({value:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")});var s=this.getNonAtomLabelInfos();for(n=0,a=s.length;n<a;++n){var l=s[n],d={value:l.nodeLabel,data:{props:l.props}};l.description&&(d.text=l.nodeLabel+" - "+l.description),o.push(d)}r.setItems(o),r.appendToElem(t);var u=this;return r.addEventListener("keyup",function(e){e.htmlEvent.getKeyCode()===Kekule.X.Event.KeyCode.ENTER&&(u.applySetter(r),r.dismiss())}),r.addEventListener("valueSelect",function(e){u.applySetter(r),r.dismiss()}),r.addEventListener("showStateChange",function(e){e.isShown||e.isDismissed||u.getAtomSetter()&&u.getAtomSetter().isShown()&&u.applySetter(r)}),r},getPeriodicTableDialogWidget:function(e){var t=this.getPeriodicTableDialog();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createPeriodicTableDialogWidget(i,r),this.setPeriodicTableDialog(t)}return t},_createPeriodicTableDialogWidget:function(e,t){var r=new Kekule.Widget.Dialog(e,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]),i=new Kekule.ChemWidget.PeriodicTable(e);return i.setUseMiniMode(!0),i.setEnableSelect(!0),i.appendToElem(r.getClientElem()),this.setPeriodicTable(i),r},openSetterUi:function(e,t){this.getAtomSetter();if(this.isValidNode(t)){this.setCurrAtom(t);var r=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0,i=r/1.5,o=this.getNodeLabel(t),n=this.getAtomSetterWidget(!0);n.setValue(o),n.setIsDirty(!1);var a=n.getElement().style;a.position="absolute",a.fontSize=r,a.left=e.x-i+"px",a.top=e.y-i+"px",n._applied=!1,n.setStandaloneOnShowHide(!0),n.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),function(){n.focus(),n.selectAll()}.defer()}},applySetter:function(e,t){if(!e._applied&&e.getIsDirty()){var r;t||(t=this.getCurrAtom());var i=null,o=e.getValue();if(o===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){(a=this.getPeriodicTableDialogWidget(!0)).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var n=t.getSymbol?t.getSymbol():null;this.getPeriodicTable().setEnableSelect(!0).setEnableMultiSelect(!1).setSelectedSymbol(n)}else if(o===this._getVarAtomListLabel()||o===this._getVarAtomNotListLabel()){var a,s=o===this._getVarAtomNotListLabel();(a=this.getPeriodicTableDialogWidget(!0)).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var l=t.getAllowedIsotopeIds?t.getAllowedIsotopeIds():null,d=t.getDisallowedIsotopeIds?t.getDisallowedIsotopeIds():null;this.getPeriodicTable().setEnableSelect(!0).setEnableMultiSelect(!0).setSelectedSymbols(s?d:l)}if(a){var u=this;a.openModal(function(e){if(e===Kekule.Widget.DialogButtons.OK){var r,i;if(o===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){var n=u.getPeriodicTable().getSelectedSymbol();r=Kekule.Atom,i={isotopeId:n}}if(o===u._getVarAtomListLabel()){var a=u.getPeriodicTable().getSelectedSymbols();r=Kekule.VariableAtom,i={allowedIsotopeIds:a,disallowedIsotopeIds:null}}if(o===u._getVarAtomNotListLabel()){a=u.getPeriodicTable().getSelectedSymbols();r=Kekule.VariableAtom,i={allowedIsotopeIds:null,disallowedIsotopeIds:a}}u.applyModification(t,null,r,i)}},this)}else{var c=null,p=this._getNonAtomInfo(o);if(p)r=p.nodeClass,i=p.props;else{var h=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(o);if(h){var g=h.createObjects(t)||{},C=g.objects,_=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),h,g,t,null);this.getEditor().transformCoordAndSizeOfObjects(C,_),r=(c=C[0]).getClass()}else(r=Kekule.ChemStructureNodeFactory.getClassByLabel(o,null))||this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()&&(r=Kekule.Pseudoatom),i=r===Kekule.Atom?{isotopeId:o}:r===Kekule.Pseudoatom?{symbol:o}:{}}r?(this.applyModification(t,c,r,i),e._applied=!0):Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL"))}}},applyModification:function(e,t,r,i){var o,n,a=e.getClass();if(t&&!r&&(r=t.getClass()),t||r!==a){o=new Kekule.MacroOperation,t||(t=new r);var s=new Kekule.ChemStructureNode;s.assign(e),t.assign(s);var l=new Kekule.ChemStructOperation.ReplaceNode(e,t,null,this.getEditor());o.add(l)}else t=e;i&&(n=new Kekule.ChemObjOperation.Modify(t,i,this.getEditor()),o&&o.add(n));var d=o||n;if(d){var u=this.getEditor();u.beginManipulateAndUpdateObject();try{d.execute()}catch(e){throw e}finally{u.endManipulateAndUpdateObject()}u&&u.getEnableOperHistory()&&d&&u.pushOperation(d)}},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var t=this._getEventMouseCoord(e),r=this.getEditor().getTopmostBoundInfoAtCoord(t,null,this.getCurrBoundInflation());if(r){var i=r.obj;if(this.isValidNode(i)){var o=this.getEditor().getObjectScreenCoord(i);e.preventDefault(),e.stopPropagation(),this.openSetterUi(o,i),this.getEditor().setSelection([i])}return!0}}}}),Kekule.Editor.MolAtomIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._createNonAtomLabelInfos(),this._setterShown=!1},finalize:function(){this.getAtomSetter()&&this.getAtomSetter().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){var t=this.getAtomSetter();t&&this.unbindAtomSetter(t),this.setPropStoreFieldValue("atomSetter",e),e&&this.bindAtomSetter(e)}})},canInteractWithObj:function(e){return!!this.isValidNode(e)},isValidNode:function(e){return e instanceof Kekule.ChemStructureNode&&!(e instanceof Kekule.StructureFragment&&e.isStandalone())},_createNonAtomLabelInfos:function(){var e=this.getEditor(),t=e&&e.getEnabledNonAtomInputData&&e.getEnabledNonAtomInputData();return this.setNonAtomLabelInfos(t),t},_indexOfNonAtomLabel:function(e){for(var t=this.getNonAtomLabelInfos(),r=0,i=t.length;r<i;++r){if(t[r].nodeLabel===e)return r}return-1},_getNonAtomInfo:function(e){var t=this._indexOfNonAtomLabel(e);return t<0?null:this.getNonAtomLabelInfos()[t]},getAtomSetterWidget:function(e){var t=this.getAtomSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createAtomSetterWidget(i,r),this.setAtomSetter(t)}return t},bindAtomSetter:function(e){this._initAtomSetterWidgetSettings(e),this._setAtomSetterEventListener(e,!0)},unbindAtomSetter:function(e){this._setAtomSetterEventListener(e,!1)},_createAtomSetterWidget:function(e,t){var r=new Kekule.ChemWidget.StructureNodeSetter(this.getEditor());return r.setUseDropDownSelectPanel(!0),r.appendToElem(t),r},_initAtomSetterWidgetSettings:function(t){if(t.addClassName(r.CHEMEDITOR_ATOM_SETTER),t.setSelectableInfos){var i=e.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());i.push("...");var o=this.getNonAtomLabelInfos();t.setSelectableInfos({elementSymbols:i,nonElementInfos:o,subGroupRepItems:Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()})}},_setAtomSetterEventListener:function(e,t){t?e.addEventListener("valueChange",this._reactAtomSetterValueChange,this):e.removeEventListener("valueChange",this._reactAtomSetterValueChange,this)},_reactAtomSetterValueChange:function(e){var t=this.getAtomSetter();t&&t.isShown()&&(e.value&&this.applySetter(t),t.dismiss())},_reactAtomSetterShowStateChange:function(e){var t=this.getAtomSetter();e.target!==t||e.byDomChange||e.isShown||e.isDismissed||t&&t.isShown()&&this.applySetter(t)},getPeriodicTableDialogWidget:function(e){var t=this.getPeriodicTableDialog();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createPeriodicTableDialogWidget(i,r),this.setPeriodicTableDialog(t)}return t},_createPeriodicTableDialogWidget:function(e,t){var r=new Kekule.Widget.Dialog(e,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]),i=new Kekule.ChemWidget.PeriodicTable(e);return i.setUseMiniMode(!0),i.setEnableSelect(!0),i.appendToElem(r.getClientElem()),this.setPeriodicTable(i),r},openSetterUi:function(e,t){var r=this.getAtomSetter();if(r&&r.isShown()&&(r.hide(),r._haltPrevShowHideProcess()),this.isValidNode(t)){this.setCurrAtom(t);var i=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0,o=(i*=this.getEditor().getZoom()||1)/1.5,n=this.getAtomSetterWidget(!0);n.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),n.setNodes([t]);var a=this.getEditor().getCoreElement();n.appendToElem(a);var s=n.getNodeInputBox(),l=n.getElement().style;l.position="absolute",l.left=e.x-o+"px",l.top=e.y-o+"px",l.opacity=1,n.setNodeInputBoxFontSize&&n.setNodeInputBoxFontSize(i+"px"),n._applied=!1,n.setStandaloneOnShowHide(!0),n.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),function(){s.focus(),s.selectAll()}.defer()}},applySetter:function(e,t){if(!e._applied){t||(t=this.getCurrAtom());var r=e.getValue();if(r){var i=Kekule.Editor.OperationUtils.createNodeModificationOperationFromData(t,r,this.getEditor());if(i){var o=this.getEditor();o.beginManipulateAndUpdateObject();try{i.execute()}catch(e){throw e}finally{o.endManipulateAndUpdateObject()}o&&o.getEnableOperHistory()&&i&&o.pushOperation(i)}}}},applyModification:function(e,t,r,i){var o=Kekule.Editor.OperationUtils.createNodeModificationOperation(e,t,r,i,this.getEditor());if(o){var n=this.getEditor();n.beginManipulateAndUpdateObject();try{o.execute()}catch(e){throw e}finally{n.endManipulateAndUpdateObject()}n&&n.getEnableOperHistory()&&o&&n.pushOperation(o)}},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var t=this._getEventMouseCoord(e),r=this.getTopmostInteractableObjAtScreenCoord(t),i=this.getEditor().getObjectScreenCoord(r);return e.preventDefault(),e.stopPropagation(),this.openSetterUi(i,r),this.doneInsertOrModifyBasicObjects([r]),!0}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolAtomIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.RepositoryIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.RepositoryIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._repObjStartingScreenCoord=null},initProperties:function(){this.defineProp("repositoryItem",{dataType:"Kekule.AbstractRepositoryItem",serializable:!1}),this.defineProp("addRepObjsOper",{dataType:"Kekule.MacroOperation",serializable:!1}),this.defineProp("initialTransformParams",{dataType:DataType.HASH,serializable:!1}),this.defineProp("currRepositoryObjects",{dataType:"Kekule.ChemObject",serializable:!1})},doTestMouseCursor:function(e,t){return""},canInteractWithObj:function(e){return this.tryApplySuper("canInteractWithObj",[e])},isValidStartingObj:function(e){return!0},calcInitialTransformParams:function(e,t,r,i){return Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),e,t,r,i)},getRepObjCreationOptions:function(){return null},createObjFromRepositoryItem:function(e,t){return t.createObjects(e,this.getRepObjCreationOptions())||{}},addRepositoryObj:function(e,t,r){var i=this.getEditor();this.setAddRepObjsOper(null);var o=null;i.beginUpdateObject();try{var n=i.getChemSpace(),a=this.getRepositoryItem(),s=(o=this.createObjFromRepositoryItem(e,a)).objects;this.setCurrRepositoryObjects(s);var l=a.isOneStructureFragmentObj(),d=!1,u=this.getEditor().getOnlyOneBlankStructFragment();if(!i.canCreateNewChild()&&!o.mergeObj&&!r){if(!l||!i.canAddUnconnectedStructFragment())return null;d=!0}for(var c=new Kekule.MacroOperation,p=0,h=s.length;p<h;++p){var g,C=s[p];g=d?new Kekule.ChemStructOperation.MergeStructFragment(C,u,i):new Kekule.ChemObjOperation.Add(C,n,null,i),c.add(g)}c.execute(),this.setAddRepObjsOper(c);var _=d?[u]:s,m=this.calcInitialTransformParams(a,o,e,t);this._transformObjectsCoordAndSize(_,m),this.setInitialTransformParams(m),o.objects=_;var f=a.getMolManipulationCenterCoord&&a.getMolManipulationCenterCoord();f&&(o.manipulationCenterCoord=Kekule.CoordUtils.transform2D(f,m));var S=a.getMolManipulationDefDirectionCoord&&a.getMolManipulationDefDirectionCoord();S&&(o.manipulationDefDirectionCoord=Kekule.CoordUtils.transform2D(S,m))}finally{i.endUpdateObject()}return o},doRefreshRepositoryObj:function(e,t,r,i,o){this.doPrepareManipulatingObjects(e,t),this.doPrepareManipulatingStartingCoords(t,r,i,o),this.doCreateManipulateMoveAndResizeOperation()},_transformObjectsCoordAndSize:function(e,t){return this.getEditor().transformCoordAndSizeOfObjects(e,t)},getAllObjOperations:function(e){var t=this.tryApplySuper("getAllObjOperations",[e])||[],r=this.getAddRepObjsOper();return r&&t.unshift(r),t},addOperationToEditor:function(){return this.tryApplySuper("addOperationToEditor")},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE},doInsertRepositoryObjToEditor:function(e,t,r,i){i||(this._initialStartingObj=r,this._repObjStartingScreenCoord=t);var o=e;if(o){var n=o.objects,a=null,s=null,l=this.getInitManipulationType();return o.mergeObj?(a=this.getEditor().getObjectScreenCoord(o.mergeObj),l=Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE):o.manipulationCenterCoord&&(a=this.getEditor().objCoordToScreen(o.manipulationCenterCoord)),o.manipulationDefDirectionCoord&&(s=this.getEditor().objCoordToScreen(o.manipulationDefDirectionCoord)),{objects:n,manipulateType:l,coord:t,box:this.getEditor().getObjectsContainerBox(n),rotateCenter:a,rotateRefCoord:s,startingObj:r}}return null},insertRepositoryObjToEditor:function(e,t,r){var i=this.addRepositoryObj(t,e);return this.doInsertRepositoryObjToEditor(i,e,t,r)},updateRepositoryObjInEditor:function(){var t=this.getEditor();t.beginUpdateObject();try{this.useMergePreview()||this.reverseActiveOperation();for(var r=this.getCurrRepositoryObjects(),i=this.addRepositoryObj(this._initialStartingObj,this._repObjStartingScreenCoord,!0),o=e.exclude(r,(i||{}).objects),n=0,a=o.length;n<a;++n){var s=o[n],l=s.getParent();l&&l.removeChild(s)}this.useMergePreview()&&!o.length||(this.setMergeOperations([]),this.setMergePreviewOperations([]));var d=this.doInsertRepositoryObjToEditor(i,this._repObjStartingScreenCoord,this._initialStartingObj,!0);d&&(this.doRefreshRepositoryObj(d.objects,d.coord,d.box,d.rotateCenter,d.rotateRefCoord),this.moveManipulatedObjs(this._repObjStartingScreenCoord))}finally{t.endUpdateObject()}return d},getDirectManipulateObjs:function(e,t){return e},react_pointerdown:function(t){if(this.setActivePointerType(t.pointerType),t.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var r=i.State,o=this._getEventMouseCoord(t);if(this.getState()===r.INITIAL){var n=this.getEditor().getTopmostBoundInfoAtCoord(o,null,this.getCurrBoundInflation()),a=n?n.obj:null,s=this.insertRepositoryObjToEditor(o,a);if(s){var l=s.objects||[],d=this.getDirectManipulateObjs(s.objects,s)||[];e.exclude(l,d).length||e.exclude(d,l).length?(this.startDirectManipulate(s.manipulateType,l,s.coord,s.box,s.rotateCenter),this.moveManipulatedObjs(o),this.startDirectManipulate(s.manipulateType,d,s.coord,s.box,s.rotateCenter),this.moveManipulatedObjs(o)):(this.startDirectManipulate(s.manipulateType,l,s.coord,s.box,s.rotateCenter),this.moveManipulatedObjs(o))}return t.preventDefault(),!0}}},react_pointerup:function(e){var t=this.getState(),r=this.getStartCoord(),i=this._getEventMouseCoord(e),o=Kekule.Editor.BasicManipulationIaController.State;return t===o.MANIPULATING&&e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT&&Kekule.CoordUtils.isEqual(r,i)?(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(o.NORMAL),e.preventDefault(),!0):this.tryApplySuper("react_pointerup",[e])}}),Kekule.Editor.RepositoryStructureFragmentIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.RepositoryStructureFragmentIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("repItemName",{dataType:DataType.STRING,setter:function(e){if(e!==this.getRepItemName()){var t=Kekule.Editor.RepositoryItemManager.getItem(e);t&&(this.setRepositoryItem(t),this.setPropStoreFieldValue("repItemName",e))}}})}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.RepositoryStructureFragmentIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolFlexStructureIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.MolFlexStructureIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1)},initProperties:function(){this.defineProp("assocMarker",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("assocMarker");return e||(e=new Kekule.ChemWidget.TextUiMarker,this.setPropStoreFieldValue("assocMarker",e)),e}})},manipulateEnd:function(){this.tryApplySuper("manipulateEnd"),this.hideAssocMarker()},initAssocMarker:function(){var e=this.getAssocMarker(),t=this.getEditorConfigs().getUiMarkerConfigs(),r={color:t.getFlexStructureAssocMarkerColor(),opacity:t.getFlexStructureAssocMarkerOpacity(),fontSize:t.getFlexStructureAssocMarkerFontSize(),fontFamily:t.getFlexStructureAssocMarkerFontFamily(),textBoxXAlignment:Kekule.Render.BoxXAlignment.CENTER,textBoxYAlignment:Kekule.Render.BoxYAlignment.CENTER};return e.setDrawStyles(r),e.setVisible(!0),this.getEditor().getUiMarkers().addMarker(e),e},hideAssocMarker:function(){var e=this.getPropStoreFieldValue("assocMarker");e&&(e.setVisible(!1),this.getEditor().getUiMarkers().removeMarker(e),this.repaintMarker())},updateAssocMarker:function(e,t,r){var i=this.getAssocMarker();e&&i.setCoord(e),t&&i.setPropValues(t),r||this.repaintMarker()},repaintMarker:function(){this.getEditor().repaintUiMarker()}}),Kekule.Editor.MolFlexChainIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexChainIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._deltaDistance=null,this._deltaCount=0,this._lastDeltaCount=1,this._repObjStartingScreenCoord=null,this._repObjNeedUpdate=!1,this._isForceReversedChainDirection=!1,this._assocMarkerInitCoord=null,this._manipulateObjInfoCache=[],this._chain=null;var t=new Kekule.Editor.MolChainRepositoryItem2D(2);t.setEnableCoordCache(!0),this.setRepositoryItem(t)},updateAssocMarker:function(e,r,i){var o=this.getEditor(),n=this.getAssocMarker().getDrawStyles(),a=this._chain,s=e;if(!s&&a){var l,d=a.getNodeAt(0),u=a.getNodeAt(a.getNodeCount()-1),c=o.getObjectContextCoord(d);if((s=o.getObjectContextCoord(u))&&c&&(l=t.substract(s,c)),l){var p=(n.fontSize||10)/2,h={x:0,y:0};if(s){var g=t.getDistance(l);h={x:p*(l.x/g),y:p*(l.y/g)};s=Kekule.CoordUtils.add(s,h)}}}this.tryApplySuper("updateAssocMarker",[s,r,i])},getChainMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexChainAtomCount(),0)},manipulateEnd:function(){this._clearManipulateObjInfoCache(),this.tryApplySuper("manipulateEnd")},createManipulateObjInfo:function(e,t,r){var i=this.getRepositoryItem().getNegativeDirection(),o=this._getCachedManipulateObjInfo(t,i);if(o)return o;var n=this.tryApplySuper("createManipulateObjInfo",[e,t,r]);return this._setCachedManipulateObjInfo(n,t,i),n},canInteractWithObj:function(e){return this.tryApplySuper("canInteractWithObj",[e])&&e instanceof Kekule.ChemStructureNode},getActualManipulatingObjects:function(t){var r=this.getCurrRepositoryObjects()[0];return r?e.clone(r.getNodes()):[]},_setCachedManipulateObjInfo:function(e,t,r){var i=r?1:0,o=this._manipulateObjInfoCache[i];o||(o=[],this._manipulateObjInfoCache[i]=o),o[t]=e},_getCachedManipulateObjInfo:function(e,t){var r=t?1:0,i=this._manipulateObjInfoCache[r];return i&&i[e]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var e=this.getRepositoryItem().getBondLength(),t=this.getInitialTransformParams(),r=this.getEditor(),i=r.objCoordToScreen(Kekule.CoordUtils.transform2D({x:0,y:0},t)),o=r.objCoordToScreen(Kekule.CoordUtils.transform2D({x:e*Math.cos(Math.PI/6),y:0},t));return Kekule.CoordUtils.getDistance(i,o)},getRepObjCreationOptions:function(){return this._isUpdateRepObj?{originalStructFragment:this.getCurrRepositoryObjects()[0]}:null},addRepositoryObj:function(e,t,r){var i=this.tryApplySuper("addRepositoryObj",[e,t,r]);return this._deltaDistance=this._calcStepDeltaDistance(),this._repObjNeedUpdate=!1,i},insertRepositoryObjToEditor:function(e,t,r){if(!r){this._deltaDistance=null,this._deltaCount=0,this._lastDeltaCount=1;var i=2;this.getRepositoryItem().setAtomCount(i)}this._isUpdateRepObj=r;var o=this.tryApplySuper("insertRepositoryObjToEditor",[e,t,r]);if(this._chain=o&&o.objects[0],o&&!r){this.initAssocMarker();this.updateAssocMarker(null,{text:""+i})}return o},_updateChain:function(){this._isUpdateRepObj=!0;var e=this.updateRepositoryObjInEditor();return this._chain=e.objects[0],this._repObjNeedUpdate=!1,e},doTransformManipulatedObjs:function(e,t,r){var i=t;if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){var o=this.getBaseCoord();if(o){var n=Kekule.CoordUtils.getDistance(i,o),a=Math.max(Math.round(n/this._deltaDistance),1);if(!this._lastDeltaCount||a!==this._lastDeltaCount){this._deltaCount=a;var s=this.getChainMaxAtomCount(),l=s?Math.min(s,a+1):a+1;this.getRepositoryItem().getAtomCount()!==l&&(this.getRepositoryItem().setAtomCount(l),this._repObjNeedUpdate=!0,this.updateAssocMarker(null,{text:""+l},!0)),this._lastDeltaCount=a}var d,u=this._calcRotateAngle(i),c=u&&u.angle,p=this.isInActualConstrainedRotation();if(p){var h=p?2*this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;d=Math.round(c/h)*h-c<0}else d=!1;this._isForceReversedChainDirection&&(d=!d),!!this.getRepositoryItem().getNegativeDirection()!==d&&(this.getRepositoryItem().setNegativeDirection(d),this._repObjNeedUpdate=!0)}}this._repObjNeedUpdate&&this._updateChain();var g=this.getCurrRepositoryObjects()[0];g.beginUpdate();try{var C=this.tryApplySuper("doTransformManipulatedObjs",[e,t,r]);this.updateAssocMarker(null,null,!1)}finally{g.endUpdate()}return C},react_pointermove:function(e){return this._isForceReversedChainDirection=!!e.getShiftKey(),this.tryApplySuper("react_pointermove",[e])}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolFlexChainIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolFlexRingIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexRingIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._deltaDistance=null,this._lastDeltaCount=1,this._repObjStartingScreenCoord=null,this._repObjNeedUpdate=!1,this._manipulateObjInfoCache=[];var t=new Kekule.Editor.MolRingRepositoryItem2D(3);t.setEnableCoordCache(!0),this.setRepositoryItem(t)},getRingMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexRingAtomCount(),0)},getRingMinAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount(),3)},getActualManipulatingObjects:function(t){var r=this.getCurrRepositoryObjects()[0];return r?e.clone(r.getNodes()):[]},manipulateEnd:function(){this._clearManipulateObjInfoCache(),this.tryApplySuper("manipulateEnd")},createManipulateObjInfo:function(e,t,r){var i=this.getRepositoryItem().getRingAtomCount(),o=this._getCachedManipulateObjInfo(t,i);if(o)return o;var n=this.tryApplySuper("createManipulateObjInfo",[e,t,r]);return this._setCachedManipulateObjInfo(n,t,i),n},_setCachedManipulateObjInfo:function(e,t,r){var i=this._manipulateObjInfoCache[r];i||(i=[],this._manipulateObjInfoCache[r]=i),i[t]=e},_getCachedManipulateObjInfo:function(e,t){var r=this._manipulateObjInfoCache[t];return r&&r[e]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var e=this.getRepositoryItem().getBondLength(),t=this.getInitialTransformParams(),r=this.getEditor(),i=r.objCoordToScreen(Kekule.CoordUtils.transform2D({x:0,y:0},t)),o=r.objCoordToScreen(Kekule.CoordUtils.transform2D({x:e,y:0},t));return Kekule.CoordUtils.getDistance(i,o)/3},getRepObjCreationOptions:function(){return this._isUpdateRepObj?{originalStructFragment:this.getCurrRepositoryObjects()[0]}:null},addRepositoryObj:function(e,t,r){var i=this.tryApplySuper("addRepositoryObj",[e,t,r]);return this._deltaDistance=this._calcStepDeltaDistance(),this._repObjNeedUpdate=!1,i},insertRepositoryObjToEditor:function(e,t,r){if(!r){this._deltaDistance=null,this._lastDeltaCount=1;var i=this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount();this.getRepositoryItem().setRingAtomCount(i)}this._isUpdateRepObj=r;var o=this.tryApplySuper("insertRepositoryObjToEditor",[e,t]);if(o&&!r){var n=o.objects[0];this.initAssocMarker(),this.updateAssocMarker(this._getRingCenterAbsContextCoord(n),{text:""+i})}return o},updateAssocMarker:function(e,t,r){if(!e){var i=this._getManipulateObjsCenterCoord();e=this.getEditor().objCoordToContext(i)}return this.tryApplySuper("updateAssocMarker",[e,t,r])},_getRingCenterAbsContextCoord:function(e){var t=this.getEditor(),r=Kekule.Editor.StructureUtils.getStructureCenterAbsBaseCoord(e,t.getCoordMode(),t.getAllowCoordBorrow());return t.objCoordToContext(r)},_updateRing:function(){this._isUpdateRepObj=!0;var e=this.updateRepositoryObjInEditor();return this._repObjNeedUpdate=!1,e},doTransformManipulatedObjs:function(e,t,r){var i=t;if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){var o=this.getBaseCoord();if(o){var n=this.getRingMinAtomCount(),a=Kekule.CoordUtils.getDistance(i,o),s=Math.round(a/this._deltaDistance)+n;if(!this._lastDeltaCount||s!==this._lastDeltaCount){var l=this.getRingMaxAtomCount(),d=l?Math.min(l,s):s;d=n?Math.max(d,n):d,this.getRepositoryItem().getRingAtomCount()!==d&&(this.getRepositoryItem().setRingAtomCount(d),this._repObjNeedUpdate=!0,this.updateAssocMarker(null,{text:""+d},!0)),this._lastDeltaCount=s}}}this._repObjNeedUpdate&&this._updateRing();var u=this.getCurrRepositoryObjects()[0];u.beginUpdate();try{var c=this.tryApplySuper("doTransformManipulatedObjs",[e,t,r]);this.updateAssocMarker(null,null,!1)}finally{u.endUpdate()}return c}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolFlexRingIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolRingIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolRingIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setRepositoryItem(new Kekule.Editor.MolRingRepositoryItem2D),this.setEnableSelect(!1),this._currBondOrders=null},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getRingAtomCount()},setter:function(e){this.getRepositoryItem().setRingAtomCount(e)}}),this.defineProp("isAromatic",{dataType:DataType.INT})},getActualManipulatingObjects:function(t){var r=this.getCurrRepositoryObjects()[0];return r?e.clone(r.getNodes()):[]},createNodeMergeOperation:function(e,t,r){var i=this.tryApplySuper("createNodeMergeOperation",[e,t,r]);return this.getIsAromatic()&&i&&i.setMergeConnectorPropsFromTarget&&i.setMergeConnectorPropsFromTarget(!0),i},manipulateBeforeStopping:function(){return this._currBondOrders&&this.useMergePreview()&&this._applyBondOrdersToSrcStruct(null,this._currBondOrders),this.tryApplySuper("manipulateBeforeStopping")},_mergeOperationsChanged:function(e,t,r){this.tryApplySuper("_mergeOperationsChanged",[e,t,r]);var i=this.getCurrRepositoryObjects(),o=i&&i[0];if(o){var n=this._getMergedDestObjs(o,e,t,r);this.updateRepStructureBondOrders(o,n,this.useMergePreview())}},createObjFromRepositoryItem:function(e,t){var r=this.tryApplySuper("createObjFromRepositoryItem",[e,t]);return this.updateRepStructureBondOrders(r.objects[0],null),this._currBondOrders=null,r},updateRepStructureBondOrders:function(e,t,r){if(this.getIsAromatic()){if(!e){var i=this.getCurrRepositoryObjects();e=i&&i[0]}t||(t={nodes:[],connectors:[],nodeCount:0,connectorCount:0});var o=this._calcSrcBondOrders(e,t),n=o.bondOrders,a=o.previewBondOrders;this._currBondOrders=n,this._applyBondOrdersToSrcStruct(e,r?a:n)}},_applyBondOrdersToSrcStruct:function(e,t){if(!e){var r=this.getCurrRepositoryObjects();e=r&&r[0]}var i=this.getEditor();try{i.beginUpdateObject(),e.beginUpdate();try{for(var o=0,n=e.getConnectorCount();o<n;++o){var a=e.getConnectorAt(o);if(a&&a.setBondOrder){var s=t[o];a.setBondOrder(s)}}}finally{e.endUpdate()}}finally{i.endUpdateObject()}},_getMergedDestObjs:function(e,t,r,i){var o=e;if(o){for(var n=function(e,t,r){for(var i=e.getConnectedChemNodes(),o=[],n=0,a=i.length;n<a;++n){var s=i[n],l=r[t.indexOf(s)];if(!l)return null;o.push(l)}if(2===o.length){var d=o[0].getLinkedConnectors();for(n=0,a=d.length;n<a;++n){var u=d[n],c=u.getConnectedChemNodes();if(2===c.length&&c.indexOf(o[1])>=0)return u}}return null},a={nodes:[],connectors:[],nodeCount:0,connectorCount:0},s=0,l=o.getNodeCount();s<l;++s){var d=o.getNodeAt(s),u=r.indexOf(d),c=u>=0?i[u]:null;a.nodes.push(c),c&&++a.nodeCount}for(s=0,l=o.getConnectorCount();s<l;++s){var p=n(o.getConnectorAt(s),o.getNodes(),a.nodes)||null;a.connectors.push(p),p&&++a.connectorCount}}return a},_calcSrcBondOrders:function(t,r){if(t&&t.getNodeCount()){r&&r.nodeCount;for(var i=t.getConnectors(),o=r.connectors,n=t.getNodes(),a=r.nodes,s=function(e){return e>Kekule.BondOrder.SINGLE&&e<=Kekule.BondOrder.QUAD},l=function(e){var t=e.getLinkedBonds(Kekule.BondType.COVALENT),r=!1;if(t.length)for(var i=0,o=t.length;i<o;++i){if(t[i].getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC){r=!0;break}}return r},d=function(t,r){var o=t.getLinkedBonds(Kekule.BondType.COVALENT),n=e.exclude(o,r),a=!1;if((n=e.exclude(n,i)).length)for(var l=0,d=n.length;l<d;++l){var u=n[l].getBondOrder();if(s(u)){a=!0;break}}return a},u=function(t,r){var i=t.getLinkedBonds(Kekule.BondType.COVALENT),o=e.intersect(i,r),n=!1;if(o.length)for(var a=0,l=o.length;a<l;++a){var d=o[a].getBondOrder();if(s(d)){n=!0;break}}return n},c=function(e,t,r,i,o,n,a){var l,p,h=Kekule.BondOrder,g=e-1;g<0&&(g=t.length-1);var C,_=!!n[g],m=_?n[g]:null,f=t[e],S=i[e],y=S&&S.getBondOrder(),O=0;if(y&&s(y))l=[y],p=[h.SINGLE],m&&s(m)&&++O;else if(_&&s(m))l=[h.SINGLE];else{for(var E=f.getConnectedChemNodes(),T=!1,A=!1,k=0,b=E.length;k<b;++k){var I=o[r.indexOf(E[k])];if(I&&(T=d(I,i),A=u(I,i),T||A))break}l=T||A?[h.SINGLE]:[h.DOUBLE,h.SINGLE]}for(k=0,b=l.length;k<b;++k){var D=l[k];if(n[e]=D,a[e]=p&&p[k]||D,e<t.length-1&&(O+=c(++e,t,r,i,o,n,a),(Kekule.ObjUtils.isUnset(C)||C>O)&&(C=O,D),O<=0))break}return O},p=[],h=[],g=!1,C=0,_=a.length;C<_;++C){var m=a[C];if(m&&l(m)){g=!0;break}}if(g){p=[];for(C=0,_=i.length;C<_;++C)p[C]=Kekule.BondOrder.EXPLICIT_AROMATIC;return p}for(C=0,_=o.length;C<_;++C){var f=o[C];if(f){var S=f.getBondOrder();s(S)&&(p[C]=S)}}c(0,i,n,o,a,p,h);return{bondOrders:p,previewBondOrders:h}}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolRingIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.PathGlyphIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.PathGlyphIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},getDirectManipulateObjs:function(e,t){if(1===e.length){var r=e[0];if(r.getNodeAt&&r.getNodeCount){r.getNodeCount();if(r.getDirectManipulationTarget)return r.getDirectManipulationTarget()}}return this.tryApplySuper("getDirectManipulateObjs",[e,t])},getInsertedObjs:function(){return this.getCurrRepositoryObjects()}}),Kekule.Editor.ArrowLineIaController=Class.create(Kekule.Editor.PathGlyphIaController,{CLASS_NAME:"Kekule.Editor.ArrowLineIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setRepositoryItem(new Kekule.Editor.PathGlyphRepositoryItem2D)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT,getter:function(){return this.getRepositoryItem().getGlyphRefLength()},setter:function(e){this.getRepositoryItem().setGlyphRefLength(e)}}),this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:!1,getter:function(){return this.getRepositoryItem().getGlyphClass()},setter:function(e){this.getRepositoryItem().setGlyphClass(e)}}),this.defineProp("glyphInitialParams",{dataType:DataType.HASH,getter:function(){return this.getRepositoryItem().getGlyphInitialParams()},setter:function(e){this.getRepositoryItem().setGlyphInitialParams(e)}})},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE},addRepositoryObj:function(e,t,r){return this.getRepositoryItem().setGlyphRefLength(this.getEditor().getChemSpace().getDefAutoScaleRefLength()),this.tryApplySuper("addRepositoryObj",[e,t,r])}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.ArrowLineIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.FormulaIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.FormulaIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._operAddMol=null},initProperties:function(){this.defineProp("currMol",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:!1})},canInteractWithObj:function(e){return!(!e||!this.isValidMol(e))},isValidMol:function(e){return e instanceof Kekule.StructureFragment&&e.hasFormula()&&!e.hasCtab()},getFormulaText:function(e){return e.hasFormula()?e.getFormula().getText():""},createNewMol:function(e,t){var r=this.getEditor();if(!r.canCreateNewChild()&&!(i=r.getOnlyOneBlankStructFragment()))return null;r.beginUpdateObject();try{if(!i)var i=new Kekule.Molecule;i.getFormula(!0),e.appendChild(i),r.setObjectScreenCoord(i,t);var o=new Kekule.ChemObjOperation.Add(i,e,null,r);this._operAddBlock=o}finally{r.endUpdateObject()}return i},getTextSetterWidget:function(e){var t=this.getTextSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createTextSetterWidget(i,r),this.setTextSetter(t)}return t},_createTextSetterWidget:function(e,t){var i=new Kekule.Widget.TextBox(this.getEditor());i.addClassName(r.CHEMEDITOR_FORMULA_SETTER),i.appendToElem(t);var o=this;return i.addEventListener("keyup",function(e){var t=e.htmlEvent.getKeyCode();t===Kekule.X.Event.KeyCode.ENTER?(o.applySetter(i),i.dismiss()):t===Kekule.X.Event.KeyCode.ESC&&(i.dismiss(),o.cancelSetter())}),i.addEventListener("showStateChange",function(e){e.byDomChange||(e.isShown||e.isDismissed||o.applySetter(i),e.isShown&&(i._applied=!1))}),i},cancelSetter:function(){this._operAddBlock&&(this._operAddBlock.reverse(),this._operAddBlock=null)},applySetter:function(e,t){if(!e._applied){t||(t=this.getCurrMol());var r=e.getText();if(r)var i=new Kekule.ChemObjOperation.Modify(t.getFormula(),{text:r},this.getEditor());else this._operAddBlock?this.cancelSetter():i=new Kekule.ChemObjOperation.Remove(t,t.getParent(),null,this.getEditor());var o=this.getEditor();if(o&&i){o.beginManipulateAndUpdateObject();try{if(i.execute(),o.getEnableOperHistory()){if(this._operAddBlock){var n=new Kekule.MacroOperation;n.add(this._operAddBlock),n.add(i),o.pushOperation(n),this._operAddBlock=null}else o.pushOperation(i);this.doneInsertOrModifyBasicObjects([t])}}finally{o.endManipulateAndUpdateObject()}}e._applied=!0}},openSetterUi:function(e,t){var r=this.getTextSetter();if(r&&r.isShown()&&(this.applySetter(r,this.getCurrMol()),r.hide(),r._haltPrevShowHideProcess()),t||(t=this.createNewMol(this.getEditor().getChemObj(),e)),this.isValidMol(t)){this.setCurrMol(t),this.getEditor().setSelection([t]);var i=t.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();i*=this.getEditor().getZoom()||1;var o=t.getCascadedRenderOption("fontFamily")||"",n=this.getFormulaText(t),a=this.getTextSetterWidget(!0),s=this.getEditor().getCoreElement();a.appendToElem(s);var l=n||"";a.setValue(l);var d=a.getElement().style;d.position="absolute",d.fontSize=i+"px",d.left=e.x+"px",d.top=e.y+"px",d.fontFamily=o,a._applied=!1,a.setStandaloneOnShowHide(!0),a.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),a.selectAll(),a.focus()}},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var t,r=this._getEventMouseCoord(e),i=this.getTopmostInteractableObjAtScreenCoord(r);t=i;var o,n=i&&this.getEditor().getChemObjBounds(i),a=n&&n[0];return o=a&&a.boundInfo?a.boundInfo.coords[0]:r,e.preventDefault(),e.stopPropagation(),this.openSetterUi(o,t),!0}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.FormulaIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.ContentBlockIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ContentBlockIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("currBlock",{dataType:DataType.OBJECT,serializable:!1})},canInteractWithObj:function(e){return e&&this.isValidBlock(e)},isValidBlock:function(e){return e instanceof Kekule.ContentBlock},execute:function(e,t,r){},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MouseButton.LEFT){this.getEditor().setSelection(null);var t=this._getEventMouseCoord(e),r=this.getTopmostInteractableObjAtScreenCoord(t),i=r?this.getEditor().getObjectScreenCoord(r):t;return e.preventDefault(),e.stopPropagation(),this.execute(this.getEditor().getChemObj(),i,r),!0}}}),Kekule.Editor.TextBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.TextBlockIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._operAddBlock=null},initProperties:function(){this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:!1})},isValidBlock:function(e){return e instanceof Kekule.TextBlock},createNewBlock:function(e,t){var r=this.getEditor();if(!r.canCreateNewChild())return null;r.beginUpdateObject();try{var i=new Kekule.TextBlock;if(i){e.appendChild(i),r.setObjectScreenCoord(i,t,Kekule.Render.CoordPos.CORNER_TL);var o=new Kekule.ChemObjOperation.Add(i,e,null,r);this._operAddBlock=o}}finally{r.endUpdateObject()}return i},getBlockText:function(e){return e.getText()},execute:function(e,t,r){this.openSetterUi(t,r)},getTextSetterWidget:function(e){var t=this.getTextSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createTextSetterWidget(i,r),this.setTextSetter(t)}return t},_createTextSetterWidget:function(e,t){var i=new Kekule.Widget.TextArea(this.getEditor());i.setAutoSizeX(!0),i.setAutoSizeY(!0),i.setDisplayed(!1),i.addClassName(r.CHEMEDITOR_TEXT_SETTER),i.appendToElem(t);var o=this;return i.addEventListener("keyup",function(e){var t=e.htmlEvent,r=t.getKeyCode();r===Kekule.X.Event.KeyCode.ENTER&&t.getCtrlKey()?(o.applySetter(i),i.dismiss()):r===Kekule.X.Event.KeyCode.ESC&&(i.dismiss(),o.cancelSetter())}),i.addEventListener("showStateChange",function(e){e.byDomChange||(e.isShown||e.isDismissed||o.applySetter(i),e.isShown&&(i._applied=!1))}),i},cancelSetter:function(){this._operAddBlock&&(this._operAddBlock.reverse(),this._operAddBlock=null)},applySetter:function(e,t){if(!e._applied){t||(t=this.getCurrBlock());var r,i=e.getText();i?r=new Kekule.ChemObjOperation.Modify(t,{text:i},this.getEditor()):this._operAddBlock?this.cancelSetter():r=new Kekule.ChemObjOperation.Remove(t,t.getParent(),null,this.getEditor());var o=this.getEditor();if(r&&o){o.beginManipulateAndUpdateObject();try{if(r.execute(),o.getEnableOperHistory())if(this._operAddBlock){var n=new Kekule.MacroOperation;n.add(this._operAddBlock),n.add(r),o.pushOperation(n),this._operAddBlock=null}else o.pushOperation(r)}finally{o.endManipulateAndUpdateObject()}this.doneInsertOrModifyBasicObjects([t])}e._applied=!0}},openSetterUi:function(e,t){var r=this.getTextSetter();if(r&&r.isShown()&&(this.applySetter(r,this.getCurrBlock()),r._haltPrevShowHideProcess()),t||(t=this.createNewBlock(this.getEditor().getChemObj(),e)),this.isValidBlock(t)){this.setCurrBlock(t);var i=this.getEditor().getObjectScreenCoord(t,Kekule.Render.CoordPos.CORNER_TL),o=t.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();o*=this.getEditor().getZoom()||1;var n=t.getCascadedRenderOption("fontFamily")||"",a=this.getBlockText(t),s=this.getTextSetterWidget(!0);s._applied=!1,s.setValue(a);var l=a||Kekule.$L("ChemWidgetTexts.CAPTION_TEXTBLOCK_INIT");s.setPlaceholder(l);var d=this.getEditor().getCoreElement();s.appendToElem(d);var u=s.getElement().style;u.position="absolute",u.fontSize=o+"px",u.left=i.x+"px",u.top=i.y+"px",u.fontFamily=n,u.opacity=1,s.setStandaloneOnShowHide(!0),s.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),function(){s.selectAll(),s.focus()}.defer()}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.TextBlockIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.ImageBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.ImageBlockIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._operAddBlock=null,this._imgProbeElem=null,this._actionOpenFile=this.createOpenAction()},doFinalize:function(){this._actionOpenFile&&this.actionOpenFile.finalize()},initProperties:function(){},isValidBlock:function(e){return e instanceof Kekule.ImageBlock},createNewBlock:function(e,t,r,i){var o=this.getEditor();if(!o.canCreateNewChild())return null;o.beginUpdateObject();try{var n=new Kekule.ImageBlock;i&&n.setSrc(i),r&&n.setSize2D(r),o.setObjectScreenCoord(n,t,Kekule.Render.CoordPos.CORNER_TL);var a=new Kekule.ChemObjOperation.Add(n,e,null,o);this._operAddBlock=a}finally{o.endUpdateObject()}return n},_getImgFilters:function(){return[{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_PNG"),filter:".png"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_JPG"),filter:".jpg,.jpeg"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_GIF"),filter:".gif"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_SVG"),filter:".svg"},Kekule.NativeServices.FILTER_ALL_SUPPORT,Kekule.NativeServices.FILTER_ANY]},createOpenAction:function(){var e=new Kekule.ActionFileOpen;return e.setFilters(this._getImgFilters()),e.on("open",this.reactImageFileOpen,this),e},reactImageFileOpen:function(e){var t=e.file;if(t){var r=this,i=new FileReader;i.addEventListener("load",function(){var e=r._getImageProbeElem();e.ownerDocument;try{delete e.width,delete e.height}catch(e){}e.src=i.result;var t=r.getEditor();(function(){if((l={x:e.width,y:e.height}).x<=0||l.y<=0)Kekule.error(Kekule.$L("ErrorMsg.INVALID_OR_EMPTY_IMAGE"));else{var o=r._currCoord,n=t.objCoordToContext(o),a=Kekule.CoordUtils.add(n,l),s=t.contextCoordToObj(a),l=Kekule.CoordUtils.substract(s,o);l=Kekule.CoordUtils.absValue(l);var d,u=r.getCurrBlock(),c=t.getChemObj();if(u)d=new Kekule.ChemObjOperation.Modify(u,{src:i.result,size2D:l});else{var p=r.createNewBlock(r.getEditor().getChemObj(),r._currCoord,l,i.result);r.setCurrBlock(p),d=new Kekule.ChemObjOperation.Add(p,c,null,t)}if(d){t.beginManipulateAndUpdateObject();try{d.execute(),t&&t.getEnableOperHistory()&&t.pushOperation(d),r.doneInsertOrModifyBasicObjects([r.getCurrBlock()])}finally{t.endManipulateAndUpdateObject()}}}}).defer()}),i.readAsDataURL(t)}},_getImageProbeElem:function(){if(!this._imgProbeElem){var e=this.getEditor().getElement().ownerDocument;this._imgProbeElem=e.createElement("img")}return this._imgProbeElem},execute:function(e,t,r){this.setCurrBlock(r),this._currCoord=t,this._actionOpenFile.execute(this.getEditor())}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.ImageBlockIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.AttachedMarkerIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.AttachedMarkerIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("markerClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("targetClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("markerClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getMarkerClass())},setter:function(e){this.setMarkerClass(ClassEx.findClass(e))}}),this.defineProp("targetClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getTargetClass())},setter:function(e){this.setTargetClass(ClassEx.findClass(e))}}),this.defineProp("initialPropValues",{dataType:DataType.HASH})},canInteractWithObj:function(e){return this.isValidTarget(e)},isValidTarget:function(e){var t=this.getTargetClass();return e instanceof t||!t},createMarker:function(){var e,t=this.getMarkerClass();if(t){e=new t;var r=this.getInitialPropValues();r&&e&&e.setPropValues&&e.setPropValues(r)}return e},createOperations:function(e){var t,r=this.createMarker();return r&&(t=new Kekule.ChemObjOperation.Add(r,e,null,this.getEditor())),[t]},apply:function(e){var t=this.createOperations(e),r=t.length<=0?null:1===t.length?t[0]:new Kekule.MacroOperation(t);if(r){r.execute();var i=this.getEditor();i&&i.getEnableOperHistory()&&i.pushOperation(r)}},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MouseButton.LEFT){var t=this._getEventMouseCoord(e),r=this.getEditor().getTopmostBoundInfoAtCoord(t,null,this.getCurrBoundInflation());if(r){var i=r.obj;return this.isValidTarget(i)&&(this.apply(i),e.preventDefault(),e.stopPropagation()),!0}}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.AttachedMarkerIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolNodeChargeIaController=Class.create(Kekule.Editor.AttachedMarkerIaController,{CLASS_NAME:"Kekule.Editor.MolNodeChargeIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setChargeInc(1)},initProperties:function(){this.defineProp("chargeInc",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("charge",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("radical",{dataType:DataType.INT,serializable:!1}),this.defineProp("currNode",{dataType:DataType.OBJECT,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setTargetClass(Kekule.ChemStructureNode)},createOperations:function(e){var t=!1,r=!1,i={},o=e.getCharge();Kekule.ObjUtils.notUnset(this.getCharge())?o!==this.getCharge()&&(i.charge=this.getCharge(),t=!0):this.getChargeInc()&&(o+=this.getChargeInc(),i.charge=o,t=!0);var n=e.getRadical();this.getRadical()!==n&&(i.radical=this.getRadical(),r=!0);var a,s,l=[],d=[],u=this.getEditor();if(t){var c=e.fetchChargeMarker(!1);0===i.charge||c||((a=new Kekule.ChemMarker.Charge).setValue(i.charge),d.push(new Kekule.ChemObjOperation.Add(a,e,null,u))),0===i.charge&&c&&d.push(new Kekule.ChemObjOperation.Remove(c,null,null,u))}if(r){var p=e.fetchRadicalMarker(!1);0===i.radical||p||((a=new Kekule.ChemMarker.Radical).setValue(i.radical),d.push(new Kekule.ChemObjOperation.Add(a,e,null,u))),0===i.radical&&p&&d.push(new Kekule.ChemObjOperation.Remove(p,null,null,u))}return l=l.concat(d),(t||r)&&(s=new Kekule.ChemObjOperation.Modify(e,i,this.getEditor()),l.push(s)),l}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolNodeChargeIaController,Kekule.Editor.ChemSpaceEditor)}(),function(){"use strict";Kekule.Editor.EditorNexus=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.EditorNexus",initialize:function(e){this.tryApplySuper("initialize"),this._currInvoker=null,e&&(e.editor&&this.setEditor(e.editor),e.structureTreeView&&this.setStructureTreeView(e.structureTreeView),e.objectInspector&&this.setObjectInspector(e.objectInspector),e.issueInspector&&this.setIssueInspector(e.issueInspector))},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("editor");this.setPropStoreFieldValue("editor",e),this.editorChanged(e,t)}}),this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("structureTreeView");this.setPropStoreFieldValue("structureTreeView",e),this.structureTreeViewChanged(e,t)}}),this.defineProp("objectInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("objectInspector");this.setPropStoreFieldValue("objectInspector",e),this.objectInspectorChanged(e,t)}}),this.defineProp("issueInspector",{dataType:"Kekule.Editor.IssueInspector",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("issueInspector");this.setPropStoreFieldValue("issueInspector",e),this.issueInspectorChanged(e,t)}})},editorChanged:function(e,t){t&&this._uninstallEditorEventHandler(t),e&&this._installEditorEventHandler(e)},structureTreeViewChanged:function(e,t){t&&this._uninstallStructureTreeViewEventHandler(t),e&&(this._installStructureTreeViewEventHandler(e),this._updateByEditor())},objectInspectorChanged:function(e,t){var r=this.getEditor();r&&(t&&t.getOperHistory()===r.getOperHistory()&&t.setOperHistory(null),e&&(e.setOperHistory(r.getOperHistory()),e.setEnableOperHistory(r.getEnableOperHistory()),this._updateByEditor()))},issueInspectorChanged:function(e,t){t&&this._uninstallIssueInspectorEventHandler(t),e&&this._installIssueInspectorEventHandler(e),this.getEditor()&&e&&this._updateByEditor()},_installEditorEventHandler:function(e){e.addEventListener("change",this._reactEditorChanged,this),e.addEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this),e.addEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_uninstallEditorEventHandler:function(e){e.removeEventListener("change",this._reactEditorChanged,this),e.removeEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this),e.removeEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_installStructureTreeViewEventHandler:function(e){e.addEventListener("change",this._reactStructureTreeViewChanged,this)},_uninstallStructureTreeViewEventHandler:function(e){e.removeEventListener("change",this._reactStructureTreeViewChanged,this)},_installIssueInspectorEventHandler:function(e){e.addEventListener("selectResult",this._reactIssueInspectorSelectResult,this)},_uninstallIssueInspectorEventHandler:function(e){e.removeEventListener("selectResult",this._reactIssueInspectorSelectResult,this)},_reactEditorChanged:function(e){if(!this._currInvoker){var t=e.target;if(t===this.getEditor()){var r=e.changedPropNames;if(r.indexOf("chemObj")>=0&&this.changeRootObj(t.getChemObj(),t),r.indexOf("selection")>=0&&this.changeSelection(t.getSelection(),t),r.indexOf("operHistory")>=0||r.indexOf("enableOperHistory")>=0){var i=this.getObjectInspector();i&&(i.setOperHistory(t.getOperHistory()),i.setEnableOperHistory(t.getEnableOperHistory()))}var o=this.getIssueInspector();o&&(r.indexOf("issueCheckExecutor")>=0&&o.setIssueCheckExecutor(t.getIssueCheckExecutor()),r.indexOf("issueCheckResults")>=0&&o.setCheckResults(t.getIssueCheckResults()))}}},_reactEditorBeginUpdateObject:function(e){this.pauseLiveUpdate()},_reactEditorEndUpdateObject:function(e){this.resumeLiveUpdate()},_updateByEditor:function(){this._reactEditorChanged({target:this.getEditor(),changedPropNames:["chemObj","selection","operHistory","issueCheckExecutor","issueCheckResults"]})},_reactStructureTreeViewChanged:function(e){if(!this._currInvoker){var t=e.target;if(t===this.getStructureTreeView())if(e.changedPropNames.indexOf("selection")>=0){var r=t.getSelectedChemObjs();this.changeSelection(r,t)}}},_reactIssueInspectorSelectResult:function(e){var t=e.selectedResult,r=this.getEditor();r&&r.setActiveIssueCheckResult&&r.setActiveIssueCheckResult(t)},pauseLiveUpdate:function(){var e=this.getStructureTreeView();e&&e.pauseLiveUpdate()},resumeLiveUpdate:function(){var e=this.getStructureTreeView();e&&e.resumeLiveUpdate()},changeSelection:function(e,t){this._currInvoker=t;try{var r=this.getEditor();r&&this._currInvoker!==r&&r.setSelection(e);var i=this.getStructureTreeView();i&&this._currInvoker!==i&&i.selectChemObjs(e);var o=this.getObjectInspector();o&&this._currInvoker!==o&&o.setObjects(e)}finally{this._currInvoker=null}},changeRootObj:function(e,t){this._currInvoker=t;try{var r=this.getEditor();r&&this._currInvoker!==r&&r.setChemObj(e);var i=this.getStructureTreeView();i&&this._currInvoker!==i&&i.setRootObj(e);var o=this.getIssueInspector();o&&this._currInvoker!==o&&o.setRootObj(e)}finally{this._currInvoker=null}}})}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.ChemWidget.ComponentWidgetNames,r=Kekule.ChemWidget.HtmlClassNames,i=(Kekule.ActionManager,[]);function o(){!function(){for(var e=["C","H","O","N","P","S","Si","F","Cl","Br","I","B","K","Na","D"],t=["methyl","ethyl","phenyl","Ac","TMS","COOCH3","OTs"],r=Kekule.Editor.ActionOperationCreate.ChemNodeModify,i=Kekule.Editor.createEditorOperationCreateActionClass,o=0,n=e.length;o<n;++o)i(null,s="atom_"+e[o],r,{nodeClass:Kekule.Atom,props:{isotopeId:e[o]}});for(o=0,n=t.length;o<n;++o){var a=t[o],s="subgroup_"+a,l=Kekule.Editor.RepositoryItemManager.getItem(a),d=l.getStructureFragment&&l.getStructureFragment();d&&i(null,s,r,{nodeClass:d.getClass(),repositoryItem:l})}i(null,"subgroup_R",r,{nodeClass:Kekule.SubGroup}),i(null,"atom_variable",r,{nodeClass:Kekule.VariableAtom}),i(null,"atom_dummy",r,{nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY}}),i(null,"atom_hetero",r,{nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO}}),i(null,"atom_any",r,{nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY}})}(),function(){for(var e=Kekule.BondType,t=Kekule.BondOrder,r=Kekule.BondStereo,i={single:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.NONE},double:{bondType:e.COVALENT,bondOrder:t.DOUBLE,stereo:r.NONE},triple:{bondType:e.COVALENT,bondOrder:t.TRIPLE,stereo:r.NONE},quad:{bondType:e.COVALENT,bondOrder:t.QUAD,stereo:r.NONE},up:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP},down:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.DOWN},closer:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.CLOSER},upOrDown:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP_OR_DOWN}},o=Kekule.Editor.ActionOperationCreate.ChemConnectorModify,n=Kekule.Editor.createEditorOperationCreateActionClass,a=Kekule.ObjUtils.getOwnedFieldNames(i),s=0,l=a.length;s<l;++s)n(null,"bond_"+a[s],o,i[a[s]])}()}Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{ACTION_UNDO:"K-Chem-Undo",ACTION_REDO:"K-Chem-Redo",ACTION_NEWDOC:"K-Chem-NewDoc",ACTION_SELECT_ALL:"K-Chem-SelectAll",ACTION_CLONE_SELECTION:"K-Chem-Clone-Selection",ACTION_COPY:"K-Chem-Copy",ACTION_CUT:"K-Chem-Cut",ACTION_PASTE:"K-Chem-Paste",ACTION_TOGGLE_SELECT:"K-Chem-Toggle-Select-State",ACTION_ERASE_SELECTION:"K-Chem-Erase-Selection",ACTION_RECHECK_ISSUES:"K-Chem-Recheck-Issues",ACTION_TOGGLE_OBJ_INSPECTOR:"K-Chem-Toggle-ObjInspector",ACTION_TOGGLE_ISSUE_INSPECTOR:"K-Chem-Toggle-IssueInspector",ACTION_TOGGLE_SHOW_ISSUES:"K-Chem-Toggle-ShowIssues"}),Object.extend(Kekule.ChemWidget.ComponentWidgetNames,{manipulateMarquee:"manipulateMarquee",manipulateLasso:"manipulateLasso",manipulateBrush:"manipulateBrush",manipulateAncestor:"manipulateAncestor",molBondSingle:"bondSingle",molBondDouble:"bondDouble",molBondTriple:"bondTriple",molBondCloser:"bondCloser",molBondWedgeUp:"bondWedgeUp",molBondWedgeDown:"bondWedgeDown",molBondWedgeUpOrDown:"bondWedgeUpOrDown",molBondDoubleEither:"bondDoubleEither",molChargeClear:"chargeClear",molChargePositive:"chargePositive",molChargeNegative:"chargeNegative",molRadicalSinglet:"radicalSinglet",molRadicalTriplet:"radicalTriplet",molRadicalDoublet:"radicalDoublet",molElectronLonePair:"electronLonePair",molChain:"chain",molRing3:"ring3",molRing4:"ring4",molRing5:"ring5",molRing6:"ring6",molRing7:"ring7",molRing8:"ring8",molRingAr6:"ringAr6",molRingAr5:"ringAr5",molFlexRing:"flexRing",molRepCyclopentaneHaworth1:"repCyclopentaneHaworth1",molRepCyclopentaneHaworth2:"repCyclopentaneHaworth2",molRepCyclohexaneHaworth1:"repCyclohexaneHaworth1",molRepCyclohexaneHaworth2:"repCyclohexaneHaworth2",molRepCyclohexaneChair1:"repCyclohexaneChair1",molRepCyclohexaneChair2:"repCyclohexaneChair2",molRepSubBondMark:"subBondMark",molRepMethane:"methane",molRepFischer1:"repFischer1",molRepFischer2:"repFischer2",molRepFischer3:"repFischer3",molRepSawhorseStaggered:"repSawhorseStaggered",molRepSawhorseEclipsed:"repSawhorseEclipsed",glyphRepLine:"repLine",glyphRepOpenArrowLine:"repOpenArrowLine",glyphRepTriangleArrowLine:"repTriangleArrowLine",glyphRepDiOpenArrowLine:"repDiOpenArrowLine",glyphRepDiTriangleArrowLine:"repDiTriangleArrowLine",glyphRepReversibleArrowLine:"repReversibleArrowLine",glyphRepOpenArrowDiLine:"repOpenArrowDiLine",glyphRepOpenArrowArc:"repOpenArrowArc",glyphRepSingleSideOpenArrowArc:"repSingleSideOpenArrowArc",glyphRepHeatSymbol:"repHeatSymbol",glyphRepAddSymbol:"repAddSymbol",glyphElectronPushingArrow:"repElectronPushingArrow",glyphElectronPushingArrowDouble:"repElectronPushingArrowDouble",glyphElectronPushingArrowSingle:"repElectronPushingArrowSingle",glyphElectronPushingArrowBondForming:"repElectronPushingArrowBondForming",glyphRepSegment:"repGlyphSegment",glyphReactionArrowNormal:"repGlyphReactionArrowNormal",glyphReactionArrowReversible:"glyphReactionArrowReversible",glyphReactionArrowResonance:"glyphReactionArrowResonance",glyphReactionArrowRetrosynthesis:"glyphReactionArrowRetrosynthesis"}),Kekule.Editor.ActionOperUtils={getObjsCenterScreenCoord:function(e,t){for(var r=Kekule.BoxUtils,i=Kekule.CoordUtils,o=null,n=0,a=t.length;n<a;++n){var s=Kekule.Render.ObjUtils.getContainerBox(t[n],e.getCoordMode(),e.getAllowCoordBorrow());o=o?r.getContainerBox(s,o):s}var l=r.getMinMaxCoords(o),d={min:e.objCoordToScreen(l.min),max:e.objCoordToScreen(l.max)},u=i.add(d.min,d.max);return u=i.divide(u,2)},addObjectsToChemSpaceEditor:function(t,r,i){var o,n,a,s=Object.extend({autoAdjustPosition:!0},i),l=t.getChemSpace&&t.getChemSpace();if(t&&l&&t.canAddNewStandaloneObject&&t.canAddNewStandaloneObject()){for(var d=[],u=0,c=r.length;u<c;++u){var p=(o=r[u],n=void 0,a=void 0,n=[],(a=l)&&o&&(n=o.getClass()===a.getClass()||o instanceof Kekule.ChemSpace?e.clone(o.getChildren()):[o]),n);p&&p.length&&e.pushUnique(d,p)}t.beginManipulateAndUpdateObject();try{var h=new Kekule.MacroOperation;for(u=0,c=d.length;u<c;++u){var g=d[u],C=new Kekule.ChemObjOperation.Add(g,l,null,t);h.add(C)}h.execute();var _=s.screenCoordOffset;if(!_&&s.autoAdjustPosition){var m=t.getClientVisibleRect(),f={x:m.left+m.width/2,y:m.top+m.height/2},S=this.getObjsCenterScreenCoord(t,d);_=Kekule.CoordUtils.substract(f,S)}if(_)for(u=0,c=d.length;u<c;++u){g=d[u];var y=t.getObjectScreenCoord(g),O=Kekule.CoordUtils.add(y,_);t.setObjectScreenCoord(g,O)}t.pushOperation(h),s.autoSelect&&t.select(d)}finally{t.endManipulateAndUpdateObject()}}}},Kekule.Editor.ActionOnEditor=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.Editor.ActionOnEditor",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("explicitGroup",{dataType:DataType.STRING})},getPreferredWidgetClass:function(){return null},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},getEditor:function(){var e=this.getDisplayer();return e instanceof Kekule.Editor.BaseEditor?e:null}}),Kekule.Editor.ActionEditorUndo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorUndo",HTML_CLASSNAME:r.ACTION_UNDO,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_UNDO"),Kekule.$L("ChemWidgetTexts.HINT_UNDO")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getEnableOperHistory()&&this.getEditor().canUndo())},doExecute:function(){var e=this.getEditor();e&&e.undo()}}),Kekule.Editor.ActionEditorRedo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorRedo",HTML_CLASSNAME:r.ACTION_REDO,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_REDO"),Kekule.$L("ChemWidgetTexts.HINT_REDO")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getEnableOperHistory()&&this.getEditor().canRedo())},doExecute:function(){var e=this.getEditor();e&&e.redo()}}),Kekule.Editor.ActionEditorNewDoc=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorNewDoc",HTML_CLASSNAME:r.ACTION_NEWDOC,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_NEWDOC"),Kekule.$L("ChemWidgetTexts.HINT_NEWDOC")])},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getEnabled()&&e.getEnableCreateNewDoc())},doExecute:function(){var e=this.getEditor();e&&e.newDoc()}}),Kekule.Editor.ActionEditorLoadData=Class.create(Kekule.ChemWidget.ActionDisplayerLoadData,{CLASS_NAME:"Kekule.Editor.ActionEditorLoadData",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("enableAppend",{dataType:DataType.BOOL})},doExecute:function(e){var t=this.getDataDialog();return t&&t.setDisplayAppendCheckBox&&t.setDisplayAppendCheckBox(this._isEditorRootObjAppendable()&&!this._isEditorEmpty()),this.tryApplySuper("doExecute",[e])},_getEditorRootObj:function(){return this.getDisplayer().getChemObj()},_isEditorRootObjAppendable:function(){var e=this.getDisplayer(),t=this._getEditorRootObj();return t&&t instanceof Kekule.ChemSpace&&e.canAddNewStandaloneObject&&e.canAddNewStandaloneObject()&&e.getAllowAppendDataToCurr&&e.getAllowAppendDataToCurr()},_isEditorEmpty:function(){var e=this._getEditorRootObj();return!e||e.getChildCount&&0===e.getChildCount()},createDataDialog:function(){var e=this.getDisplayer().getDocument();return new Kekule.ChemWidget.LoadOrAppendDataDialog(e)},doLoadInDisplayer:function(e,t,r){var i=e||this.getDisplayer();if(!r.getIsAppending()||this._isEditorEmpty()||!this._isEditorRootObjAppendable())return this.tryApplySuper("doLoadInDisplayer",[e,t,r]);var o=this._getEditorRootObj();i.loadFromData(t.data,t.mimeType,t.fileName,t.formatId,function(e){if(e){i.beginUpdateObject();try{o.beginUpdate();try{Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(i,[e],{autoSelect:!0})}finally{o.endUpdate()}}finally{i.endUpdateObject()}}})}}),Kekule.Editor.ActionSelectAll=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionSelectAll",HTML_CLASSNAME:r.ACTION_SELECT_ALL,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_SELECT_ALL"),Kekule.$L("ChemWidgetTexts.HINT_SELECT_ALL")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getChemObj())},doExecute:function(){this.getEditor().selectAll()}}),Kekule.Editor.ActionCloneSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCloneSelection",HTML_CLASSNAME:r.ACTION_CLONE_SELECTION,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_CLONE_SELECTION"),Kekule.$L("ChemWidgetTexts.HINT_CLONE_SELECTION")])},_hasCloneMethod:function(){var e=this.getEditor();return e&&e.cloneSelection},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this._hasCloneMethod()&&this.getEditor().hasSelection()),this.setDisplayed(this._hasCloneMethod()&&this.getEditor().canCloneObjects())},doExecute:function(){var e=this.getEditor();if(e&&e.getChemSpace){var t=e.getDefaultCloneScreenCoordOffset&&e.getDefaultCloneScreenCoordOffset(),r=e.cloneSelection();Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(e,r,{screenCoordOffset:t,autoSelect:!0})}}}),Kekule.Editor.ActionCopySelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCopySelection",HTML_CLASSNAME:r.ACTION_COPY,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_COPY"),Kekule.$L("ChemWidgetTexts.HINT_COPY")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var e=this.getEditor(),t=e.getChemSpace&&e.getChemSpace();if(e&&t){var r=e.cloneSelection(),i=new Kekule.IntermediateChemSpace;try{i.appendChildren(r),Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,[i])}finally{i.finalize()}}}}),Kekule.Editor.ActionCutSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCutSelection",HTML_CLASSNAME:r.ACTION_CUT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_CUT"),Kekule.$L("ChemWidgetTexts.HINT_CUT")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var e=this.getEditor(),t=e.getChemSpace&&e.getChemSpace();if(e&&t){var r=e.cloneSelection(),i=new Kekule.IntermediateChemSpace;try{i.appendChildren(r),Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,[i])}finally{i.finalize()}var o=e.getIaController("BasicMolEraserIaController");o&&o.removeSelection()}}}),Kekule.Editor.ActionPaste=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionPaste",HTML_CLASSNAME:r.ACTION_PASTE,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_PASTE"),Kekule.$L("ChemWidgetTexts.HINT_PASTE")]),Kekule.Widget.clipboard.addEventListener("setData",this._reactClipboardChange,this)},finalize:function(){Kekule.Widget.clipboard.removeEventListener("setData",this._reactClipboardChange,this),this.tryApplySuper("finalize")},_reactClipboardChange:function(){this.update()},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(Kekule.Widget.clipboard.hasData(Kekule.IO.MimeType.JSON)&&this.getEditor().canAddNewStandaloneObject())},getObjsCenterScreenCoord:function(e,t){return Kekule.Editor.ActionOperUtils.getObjsCenterScreenCoord(e,t)},doExecute:function(){var t=this.getEditor();if(t&&t.getChemSpace){var r,i,o=Kekule.Widget.clipboard.getObjects(Kekule.IO.MimeType.JSON);1===o.length&&o[0]instanceof Kekule.IntermediateChemSpace?(r=o[0],i=e.clone(r.getChildren()),r.removeChildren(i)):i=o,r&&r.finalize();var n=null,a=t.getSelection();if(a&&a.length){n=t.getDefaultCloneScreenCoordOffset?t.getDefaultCloneScreenCoordOffset():null;var s=e.clone(a);if(s&&s.length&&n){var l=this.getObjsCenterScreenCoord(t,s),d=this.getObjsCenterScreenCoord(t,i),u=Kekule.CoordUtils.substract(l,d);n=Kekule.CoordUtils.add(n,u)}}Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(t,i,{screenCoordOffset:n,autoSelect:!0})}}}),Kekule.Editor.ActionToggleSelectState=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionToggleSelectState",HTML_CLASSNAME:r.ACTION_TOGGLE_SELECT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_SELECT"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_SELECT")]),this.setExplicitGroup("")},getPreferredWidgetClass:function(){return Kekule.Widget.CheckButton},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setChecked(this.getEditor().getIsToggleSelectOn())},checkedChanged:function(){this.tryApplySuper("checkedChanged")},doExecute:function(e,t){this.tryApplySuper("doExecute",[e,t]);var r=this.getChecked();this.getEditor().setIsToggleSelectOn(!r),this.setChecked(!r)}}),Kekule.Editor.ActionEraseSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEraseSelection",HTML_CLASSNAME:r.ACTION_ERASE_SELECTION,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ERASE_SELECTION"),Kekule.$L("ChemWidgetTexts.HINT_ERASE_SELECTION")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var e=this.getEditor();if(e){var t=e.getIaController("BasicMolEraserIaController");t&&t.removeSelection()}}}),Kekule.Editor.ActionRecheckIssues=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionRecheckIssues",HTML_CLASSNAME:r.ACTION_RECHECK_ISSUES,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_RECHECK_ISSUES"),Kekule.$L("ChemWidgetTexts.HINT_RECHECK_ISSUES")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getEditor();this.setEnabled(e.getEnableIssueCheck()).setDisplayed(e.getEnableIssueCheck())},doExecute:function(e,t){this.tryApplySuper("doExecute",[e,t]);var r=this.getEditor();r&&r.checkIssues()}}),Kekule.Editor.ActionToggleShowIssueMarkers=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionToggleShowIssueMarkers",HTML_CLASSNAME:r.ACTION_TOGGLE_SHOW_ISSUES,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_SHOW_ISSUE_MARKERS"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_SHOW_ISSUE_MARKERS")]),this.setExplicitGroup("")},getPreferredWidgetClass:function(){return Kekule.Widget.CheckButton},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getEditor();this.setChecked(e.getShowAllIssueMarkers()),this.setEnabled(e.getEnableIssueCheck()).setDisplayed(e.getEnableIssueCheck())},doExecute:function(e,t){this.tryApplySuper("doExecute",[e,t]);var r=this.getChecked();this.getEditor().setShowAllIssueMarkers(!r),this.setChecked(!r)}}),Kekule.Editor.ActionOperationCreate={},Kekule.Editor.ActionOperationCreate.Base=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.Base",initialize:function(e){this.tryApplySuper("initialize",[e])},applicable:function(e){var t=this.getOperationTargets();if(t&&t.length){for(var r=this.getData(),i=0,o=t.length;i<o;++i)if(this.applicableOnTarget(t[i],r,e))return!0;return!1}return!1},applicableOnTarget:function(e,t,r){return!1},getOperationTargets:function(e){return[]},getData:function(){return this.ACTION_DATA||{}},createOperations:function(e){for(var t=this.getOperationTargets(e),r=this.getData(),i=[],o=0,n=t.length;o<n;++o){var a=t[o];if(this.applicableOnTarget(a,r,e)){var s=this.doCreateOperationOnTarget(a,r,e);s&&i.push(s)}}return i},doCreateOperationOnTarget:function(e,t,r){return null},doExecute:function(){var e=this.getEditor(),t=this.getModificationTargets(e),r=this.createOperations(t,data,e);return!(!r||!r.length)&&(e.execOperations(r),!0)}}),Kekule.Editor.ActionOperationCreate.ChemObjModify=Class.create(Kekule.Editor.ActionOperationCreate.Base,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemObjModify",getOperationTargets:function(e){var t=e.getHotTrackedObjs();return t&&t.length||(t=e.getSelection()),t}}),Kekule.Editor.ActionOperationCreate.ChemNodeModify=Class.create(Kekule.Editor.ActionOperationCreate.ChemObjModify,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemNodeModify",applicableOnTarget:function(e,t,r){return e instanceof Kekule.ChemStructureNode&&!(e instanceof Kekule.Molecule)&&e.getLinkedBonds().length},doCreateOperationOnTarget:function(e,t,r){return Kekule.Editor.OperationUtils.createNodeModificationOperationFromData(e,t,r)}}),Kekule.Editor.ActionOperationCreate.ChemConnectorModify=Class.create(Kekule.Editor.ActionOperationCreate.ChemObjModify,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemConnectorModify",applicableOnTarget:function(e,t,r){return e instanceof Kekule.ChemStructureConnector},doCreateOperationOnTarget:function(e,t,r){return Kekule.ObjUtils.match(e,t)?null:new Kekule.ChemObjOperation.Modify(e,t,r)}}),Kekule.Editor.createEditorOperationCreateActionClass=function(e,t,r,o){var n={};e&&(n.CLASS_NAME="Kekule.Editor.ActionOperationCreate."+e),o&&(n.ACTION_DATA=o);var a=Class.create(r,n);return t&&i.push({name:t,actionClass:a}),a},Kekule.Editor.ActionOnComposer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Editor.ActionOnComposer",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setText(t),this.setHint(r),this.setComposer(e)},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1})},doUpdate:function(){var e=this.getComposer(),t=this.getEditor();this.setEnabled(e&&e.getEnabled()&&t&&t.getChemObj()&&t.getChemObjLoaded()&&t.getEnabled())},getEditor:function(){var e=this.getComposer();return e?e.getEditor():null}}),Kekule.Editor.ActionOnComposerAdv=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionOnComposerAdv",initialize:function(e,t,r){var i=new Kekule.ActionList;i.setOwnActions(!0),this.setPropStoreFieldValue("attachedActions",i),this.tryApplySuper("initialize",[e,t,r])},finalize:function(){this.getAttachedActions().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("attachedActionClasses",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("attachedActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null}),this.defineProp("defaultAttachedAction",{dataType:"Kekule.Action",serializable:!1})},checkedChanged:function(){this.tryApplySuper("checkedChanged");var e=this.getChecked();if(this.hasAttachedActions()){var t=this.getComposer();if(t)if(e){var r=this.getAttachedActions();t.bindAssocActions(r),t.showAssocToolbar();var i=r.getCheckedAction(this.getClassName());i||(i=this.getDefaultAttachedAction()),i&&(i.setChecked(!1),i.execute())}else t.hideAssocToolbar()}},hasAttachedActions:function(){return!!this.getAttachedActions().getActionCount()},setAttachedActionIndex:function(e,t){var r=this.getAttachedActions();return r&&r.setActionIndex(e,t),this},addAttachedAction:function(e,t){return this.getAttachedActions().add(e),t&&this.setDefaultAttachedAction(e),this},removeAttachedAction:function(e){return this.getDefaultAttachedAction()===e&&this.setDefaultAttachedAction(null),this.getAttachedActions().remove(e),this},clearAttachedActions:function(){this.setDefaultAttachedAction(null),this.getAttachedActions().clear()},doExecute:function(){},update:function(){this.tryApplySuper("update"),this.getAttachedActions().updateAll()}}),Kekule.Editor.ActionComposerToggleObjInspector=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleObjInspector",HTML_CLASSNAME:r.ACTION_TOGGLE_OBJ_INSPECTOR,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_OBJ_INSPECTOR"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_OBJ_INSPECTOR")])},doUpdate:function(){var e=this.getComposer();e&&this.setChecked(e.getShowObjInspector())},doExecute:function(){var e=this.getComposer();e&&(this.setChecked(!this.getChecked()),e.setShowObjInspector(this.getChecked()))}}),Kekule.Editor.ActionComposerToggleInspector=Kekule.Editor.ActionComposerToggleObjInspector,Kekule.Editor.ActionComposerToggleIssueInspector=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleIssueInspector",HTML_CLASSNAME:r.ACTION_TOGGLE_ISSUE_INSPECTOR,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_ISSUE_INSPECTOR"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_ISSUE_INSPECTOR")])},doUpdate:function(){var e=this.getComposer();e&&(this.setChecked(e.getShowIssueInspector()),this.setEnabled(e.getEnableIssueCheck()).setDisplayed(e.getEnableIssueCheck()))},doExecute:function(){var e=this.getComposer();e&&(this.setChecked(!this.getChecked()),e.setShowIssueInspector(this.getChecked()))}}),Kekule.Editor.ActionComposerSetIaController=Class.create(Kekule.Editor.ActionOnComposerAdv,{CLASS_NAME:"Kekule.Editor.ActionComposerSetIaController",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,t,r]),this.setPropStoreFieldValue("iaControllerId",i)},initProperties:function(){this.defineProp("iaControllerId",{dataType:DataType.STRING,serializable:!1,setter:null})},doExecute:function(){this.getEditor().setActiveIaControllerId(this.getIaControllerId())}}),Kekule.Editor.createComposerIaControllerActionClass=function(e,t,r,o,n,a,s,l,d,u){n||(n=o),n.startsWith(Kekule.ChemWidget.HtmlClassNames.PREFIX)||(n=Kekule.ChemWidget.HtmlClassNames.PREFIX+n);var c,p={CLASS_NAME:e,HTML_CLASSNAME:n,initialize:function(e){this.tryApplySuper("initialize",[e,t,r,o]),this.initAttachedActions&&this.initAttachedActions()}};(l&&(p=Object.extend(p,l)),a)&&(p.doExecute&&(c=p.doExecute),p.doExecute=function(){var e=this.getEditor().getIaController(o);e&&e.setPropValues(a),c?c.apply(this):this.tryApplySuper("doExecute")});s&&(p.initAttachedActions=function(){this.setPropStoreFieldValue("attachedActionClasses",s)});var h=Class.create(Kekule.Editor.ActionComposerSetIaController,p);return d&&i.push({name:d,actionClass:h,widgetClass:u}),h},Kekule.Editor.ActionComposerClientDragScrollController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerClientDragScrollController",Kekule.$L("ChemWidgetTexts.CAPTION_CLIENT_DRAGSCROLL"),Kekule.$L("ChemWidgetTexts.HINT_CLIENT_DRAGSCROLL"),"ClientDragScrollIaController",null,null,null,null,t.dragScroll),Kekule.Editor.ActionComposerSetManipulateControllerMarquee=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerMarquee",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_MARQUEE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_MARQUEE"),"SelectIaController","SelectIaController-Marquee",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.RECT},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.RECT)}},t.manipulateMarquee),Kekule.Editor.ActionComposerSetManipulateControllerLasso=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerLasso",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_LASSO"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_LASSO"),"SelectIaController","SelectIaController-Lasso",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.POLYGON},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.POLYGON)}},t.manipulateLasso),Kekule.Editor.ActionComposerSetManipulateControllerBrush=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerBrush",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_BRUSH"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_BRUSH"),"SelectIaController","SelectIaController-Brush",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.POLYLINE},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.POLYLINE)}},t.manipulateBrush),Kekule.Editor.ActionComposerSetManipulateControllerAncestor=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerAncestor",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_ANCESTOR"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_ANCESTOR"),"SelectIaController","SelectIaController-Ancestor",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.ANCESTOR},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.ANCESTOR)}},t.manipulateAncestor),Kekule.Editor.ActionComposerSetManipulateController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateController",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE"),"SelectIaController",null,null,[Kekule.Editor.ActionComposerSetManipulateControllerMarquee,Kekule.Editor.ActionComposerSetManipulateControllerLasso,Kekule.Editor.ActionComposerSetManipulateControllerBrush,Kekule.Editor.ActionComposerSetManipulateControllerAncestor,Kekule.Editor.ActionComposerClientDragScrollController,Kekule.Editor.ActionToggleSelectState],null,t.manipulate),Kekule.Editor.ActionComposerSetEraserController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetEraserController",Kekule.$L("ChemWidgetTexts.CAPTION_ERASE"),Kekule.$L("ChemWidgetTexts.HINT_ERASE"),"BasicMolEraserIaController",null,null,null,{doExecute:function(){this.tryApplySuper("doExecute");var e=this.getEditor();e.hasSelection()&&e.getActiveIaController().removeSelection()}},t.erase),Kekule.Editor.ActionComposerSetTrackController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTrackController",Kekule.$L("ChemWidgetTexts.CAPTION_TRACK_INPUT"),Kekule.$L("ChemWidgetTexts.HINT_TRACK_INPUT"),"TrackInputIaController",null,null,null,null,t.trackInput),Kekule.Editor.ActionComposerSetBondControllerSingle=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerSingle",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),"MolBondIaController","MolBondIaController-Single",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.NONE},null,null,t.molBondSingle),Kekule.Editor.ActionComposerSetBondControllerDouble=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDouble",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),"MolBondIaController","MolBondIaController-Double",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.NONE},null,null,t.molBondDouble),Kekule.Editor.ActionComposerSetBondControllerTriple=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerTriple",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),"MolBondIaController","MolBondIaController-Triple",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.TRIPLE,bondStereo:Kekule.BondStereo.NONE},null,null,t.molBondTriple),Kekule.Editor.ActionComposerSetBondControllerCloser=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerCloser",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),"MolBondIaController","MolBondIaController-Closer",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.CLOSER},null,null,t.molBondCloser),Kekule.Editor.ActionComposerSetBondControllerWedgeUp=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUp",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),"MolBondIaController","MolBondIaController-WedgeUp",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP},null,null,t.molBondWedgeUp),Kekule.Editor.ActionComposerSetBondControllerWedgeDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),"MolBondIaController","MolBondIaController-WedgeDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.DOWN},null,null,t.molBondWedgeDown),Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),"MolBondIaController","MolBondIaController-WedgeUpOrDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP_OR_DOWN},null,null,t.molBondWedgeUpOrDown),Kekule.Editor.ActionComposerSetBondControllerDoubleEither=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDoubleEither",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),"MolBondIaController","MolBondIaController-Double-Either",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.E_OR_Z},null,null,t.molBondDoubleEither),Kekule.Editor.ActionComposerSetRepositoryFischer1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer1",{repItemName:"fischer1"},null,null,t.molRepFischer1),Kekule.Editor.ActionComposerSetRepositoryFischer2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer2",{repItemName:"fischer2"},null,null,t.molRepFischer2),Kekule.Editor.ActionComposerSetRepositoryFischer3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER3"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer3",{repItemName:"fischer3"},null,null,t.molRepFischer3),Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_STAGGERED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_STAGGERED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseStaggered",{repItemName:"sawhorseStaggered"},null,null,t.molRepSawhorseStaggered),Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_ECLIPSED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_ECLIPSED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseEclipsed",{repItemName:"sawhorseEclipsed"},null,null,t.molRepSawhorseEclipsed),Kekule.Editor.ActionComposerSetRepositoryMethaneController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMethaneController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_METHANE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_METHANE"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Methane",{repItemName:"methane"},null,null,t.molRepMethane),Kekule.Editor.ActionComposerSetRepositorySubBondMarkController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySubBondMarkController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SUBBOND_MARK"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SUBBOND_MARK"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SubBondMark",{repItemName:"substituentMark"},null,null,t.molRepSubBondMark),Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FLEXCHAIN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FLEXCHAIN"),"MolFlexChainIaController","MolFlexChainIaController",null,null,null,t.molChain),Kekule.Editor.ActionComposerSetBondController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND"),"MolBondIaController",null,null,[Kekule.Editor.ActionComposerSetBondControllerSingle,Kekule.Editor.ActionComposerSetBondControllerDouble,Kekule.Editor.ActionComposerSetBondControllerTriple,Kekule.Editor.ActionComposerSetBondControllerWedgeUp,Kekule.Editor.ActionComposerSetBondControllerWedgeDown,Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController,Kekule.Editor.ActionComposerSetTrackController,Kekule.Editor.ActionComposerSetRepositoryFischer1Controller,Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController,Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController],null,t.molBond),Kekule.Editor.ActionComposerSetAtomController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM"),"MolAtomIaController",null,null,null,null,t.molAtom),Kekule.Editor.ActionComposerSetFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FORMULA"),"FormulaIaController",null,null,null,null,t.molFormula),Kekule.Editor.ActionComposerSetAtomAndFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomAndFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM_AND_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM_AND_FORMULA"),"MolAtomIaController",null,null,[Kekule.Editor.ActionComposerSetAtomController,Kekule.Editor.ActionComposerSetRepositoryMethaneController,Kekule.Editor.ActionComposerSetFormulaController],null,t.molAtomAndFormula),Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ELECTRON_LONEPAIR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ELECTRON_LONEPAIR"),"AttachedMarkerIaController","AttachedMarkerIaController-LonePair",{markerClassName:"Kekule.ChemMarker.UnbondedElectronSet",targetClassName:"Kekule.AbstractAtom",initialPropValues:{electronCount:2}},null,null,t.molElectronLonePair),Kekule.Editor.ActionComposerSetNodeChargeControllerClear=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerClear",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_CLEAR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_CLEAR"),"MolNodeChargeIaController","MolNodeChargeIaController-Clear",{charge:0,chargeInc:0,radical:Kekule.RadicalOrder.NONE},null,null,t.molChargeClear),Kekule.Editor.ActionComposerSetNodeChargeControllerPositive=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerPositive",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_POSITIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_POSITIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Positive",{charge:null,chargeInc:1,radical:Kekule.RadicalOrder.NONE},null,null,t.molChargePositive),Kekule.Editor.ActionComposerSetNodeChargeControllerNegative=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerNegative",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_NEGATIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_NEGATIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Negative",{charge:null,chargeInc:-1,radical:Kekule.RadicalOrder.NONE},null,null,t.molChargeNegative),Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_SINGLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_SINGLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Singlet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.SINGLET},null,null,t.molRadicalSinglet),Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_TRIPLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_TRIPLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Triplet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.TRIPLET},null,null,t.molRadicalTriplet),Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_DOUBLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_DOUBLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Doublet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.DOUBLET},null,null,t.molRadicalDoublet),Kekule.Editor.ActionComposerSetNodeChargeController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE"),"MolNodeChargeIaController",null,null,[Kekule.Editor.ActionComposerSetNodeChargeControllerClear,Kekule.Editor.ActionComposerSetNodeChargeControllerPositive,Kekule.Editor.ActionComposerSetNodeChargeControllerNegative,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet,Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair],null,t.molCharge),Kekule.Editor.ActionComposerSetTextBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_BLOCK"),"TextBlockIaController",null,null,null,null,t.textBlock),Kekule.Editor.ActionComposerSetImageBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetImageBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_IMAGE_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_IMAGE_BLOCK"),"ImageBlockIaController",null,null,null,null,t.imageBlock),Kekule.Editor.ActionComposerSetTextImageController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextImageController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_IMAGE"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_IMAGE"),"TextImageIaController","TextImageIaController",null,[Kekule.Editor.ActionComposerSetTextBlockController,Kekule.Editor.ActionComposerSetImageBlockController],null,t.textImage),Kekule.Editor.ActionComposerSetRepositoryRing3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_3"),"MolRingIaController","MolRingIaController-3",{ringAtomCount:3,isAromatic:!1},null,null,t.molRing3),Kekule.Editor.ActionComposerSetRepositoryRing4Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing4Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_4"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_4"),"MolRingIaController","MolRingIaController-4",{ringAtomCount:4,isAromatic:!1},null,null,t.molRing4),Kekule.Editor.ActionComposerSetRepositoryRing5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_5"),"MolRingIaController","MolRingIaController-5",{ringAtomCount:5,isAromatic:!1},null,null,t.molRing5),Kekule.Editor.ActionComposerSetRepositoryRing6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_6"),"MolRingIaController","MolRingIaController-6",{ringAtomCount:6,isAromatic:!1},null,null,t.molRing6),Kekule.Editor.ActionComposerSetRepositoryRing7Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing7Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_7"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_7"),"MolRingIaController","MolRingIaController-7",{ringAtomCount:7,isAromatic:!1},null,null,t.molRing7),Kekule.Editor.ActionComposerSetRepositoryRing8Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing8Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_8"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_8"),"MolRingIaController","MolRingIaController-8",{ringAtomCount:8,isAromatic:!1},null,null,t.molRing8),Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_6"),"MolRingIaController","MolRingIaController-Ar-6",{ringAtomCount:6,isAromatic:!0},null,null,t.molRingAr6),Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_5"),"MolRingIaController","MolRingIaController-Ar-5",{ringAtomCount:5,isAromatic:!0},null,null,t.molRingAr5),Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FLEXRING"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FLEXRING"),"MolFlexRingIaController","MolFlexRingIaController",null,null,null,t.molFlexRing),Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth1",{repItemName:"cyclopentaneHaworth1"},null,null,t.molRepCyclopentaneHaworth1),Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth2",{repItemName:"cyclopentaneHaworth2"},null,null,t.molRepCyclopentaneHaworth2),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth1",{repItemName:"cyclohexaneHaworth1"},null,null,t.molRepCyclohexaneHaworth1),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth2",{repItemName:"cyclohexaneHaworth2"},null,null,t.molRepCyclohexaneHaworth2),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair1",{repItemName:"cyclohexaneChair1"},null,null,t.molRepCyclohexaneChair1),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair2",{repItemName:"cyclohexaneChair2"},null,null,t.molRepCyclohexaneChair2),Kekule.Editor.ActionComposerSetRepositoryRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING"),"MolRingIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryRing3Controller,Kekule.Editor.ActionComposerSetRepositoryRing4Controller,Kekule.Editor.ActionComposerSetRepositoryRing5Controller,Kekule.Editor.ActionComposerSetRepositoryRing6Controller,Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController,Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller,Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller],null,t.molRing),Kekule.Editor.ActionComposerSetRepositoryPathLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathGlyphLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:null,lineLength:1.5},null,null,t.glyphRepLine),Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepOpenArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-TriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepTriangleArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiOpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowWidth:.25,startArrowLength:.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepDiOpenArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiTriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.TRIANGLE,startArrowWidth:.25,startArrowLength:.25,endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepDiTriangleArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_REV_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-ReversibleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowSide:Kekule.Glyph.ArrowSide.REVERSED,startArrowWidth:.25,startArrowLength:.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowSide:Kekule.Glyph.ArrowSide.SINGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1,lineCount:2}},null,null,t.glyphRepReversibleArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowDiLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1,lineCount:2}},null,null,t.glyphRepOpenArrowDiLine),Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowArcController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowArcController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC"),"ArrowLineIaController","ArrowLineIaController-OpenArrowArc",{glyphClass:Kekule.Glyph.BaseArc,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphRepOpenArrowArc),Kekule.Editor.ActionComposerSetRepositoryPathSingleSideOpenArrowArcController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathSingleSideOpenArrowArcController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC"),"ArrowLineIaController","ArrowLineIaController-SingleSideOpenArrowArc",{glyphClass:Kekule.Glyph.BaseArc,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowSide:Kekule.Glyph.ArrowSide.REVERSED,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphRepSingleSideOpenArrowArc),Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_HEAT_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_HEAT_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-HeatSymbol",{glyphClass:Kekule.Glyph.HeatSymbol,glyphInitialParams:{lineLength:1}},null,null,t.glyphRepHeatSymbol),Kekule.Editor.ActionComposerSetRepositoryAddSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryAddSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ADD_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ADD_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-AddSymbol",{glyphClass:Kekule.Glyph.AddSymbol,glyphInitialParams:{lineLength:1}},null,null,t.glyphRepAddSymbol),Kekule.Editor.ActionComposerSetRepositoryLineSegmentController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryLineSegmentController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:Kekule.Glyph.Segment,glyphInitialParams:{startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphRepSegment),Kekule.Editor.ActionComposerSetRepositoryNormalReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryNormalReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_NORMAL"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_NORMAL"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowNormal",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionArrowType:Kekule.Glyph.ReactionArrowType.NORMAL,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowNormal),Kekule.Editor.ActionComposerSetRepositoryReversibleReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryReversibleReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_REVERSIBLE"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_REVERSIBLE"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowReversible",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionType:Kekule.Glyph.ReactionArrowType.REVERSIBLE,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowReversible),Kekule.Editor.ActionComposerSetRepositoryResonanceReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryResonanceReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_RESONANCE"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_RESONANCE"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowResonance",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionType:Kekule.Glyph.ReactionArrowType.RESONANCE,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowResonance),Kekule.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_RETROSYNTHESIS"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_RETROSYNTHESIS"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowRetrosynthesis",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionType:Kekule.Glyph.ReactionArrowType.RETROSYNTHESIS,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowRetrosynthesis),Kekule.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_2"),Kekule.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_2"),"ArrowLineIaController","ArrowLineIaController-ElectronPushingArrowDouble",{glyphClass:Kekule.Glyph.ElectronPushingArrow,glyphInitialParams:{electronCount:2,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphElectronPushingArrowDouble),Kekule.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_1"),Kekule.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_1"),"ArrowLineIaController","ArrowLineIaController-ElectronPushingArrowSingle",{glyphClass:Kekule.Glyph.ElectronPushingArrow,glyphInitialParams:{electronCount:1,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphElectronPushingArrowSingle),Kekule.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1"),Kekule.$L("ChemWidgetTexts.HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1"),"ArrowLineIaController","ArrowLineIaController-BondFormingElectronPushingArrowSingle",{glyphClass:Kekule.Glyph.BondFormingElectronPushingArrow,glyphInitialParams:{endArrowWidth:.25,endArrowLength:.25,lineLength:1,pathEndGap:.1,lineCount:1}},null,null,t.glyphElectronPushingArrowBondForming),Kekule.Editor.ActionComposerSetRepositoryGlyphController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryGlyphController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ARROWLINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ARROWLINE"),"ArrowLineIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryNormalReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryReversibleReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryResonanceReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryLineSegmentController,Kekule.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController,Kekule.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController,Kekule.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController,Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController,Kekule.Editor.ActionComposerSetRepositoryAddSymbolController],null,t.glyph),Kekule._registerAfterLoadSysProc(function(){var e=Kekule.ActionManager,r=Kekule.ChemWidget,n=Kekule.Editor,a=Kekule.Editor.ChemSpaceEditor,s=e.registerNamedActionClass;s(t.newDoc,n.ActionEditorNewDoc,a),s(t.loadFile,r.ActionDisplayerLoadFile,a),s(t.loadData,n.ActionEditorLoadData,a),s(t.saveData,r.ActionDisplayerSaveFile,a),s(t.zoomIn,r.ActionDisplayerZoomIn,a),s(t.zoomOut,r.ActionDisplayerZoomOut,a),s(t.resetZoom,r.ActionDisplayerResetZoom,a),s(t.reset,r.ActionDisplayerReset,a),s(t.config,Kekule.Widget.ActionOpenConfigWidget,a),s(t.undo,n.ActionEditorUndo,a),s(t.redo,n.ActionEditorRedo,a),s(t.selectAll,n.ActionSelectAll,a),s(t.cloneSelection,n.ActionCloneSelection,a),s(t.copy,n.ActionCopySelection,a),s(t.cut,n.ActionCutSelection,a),s(t.paste,n.ActionPaste,a),s(t.toggleSelect,n.ActionToggleSelectState,a),s(t.eraseSelection,n.ActionEraseSelection,a),s(t.recheckIssues,n.ActionRecheckIssues,a),s(t.toggleShowAllIssues,n.ActionToggleShowIssueMarkers,a),s(t.objInspector,n.ActionComposerToggleObjInspector,a),s(t.issueInspector,n.ActionComposerToggleIssueInspector,a),o();for(var l=0,d=i.length;l<d;++l){var u=i[l];s(u.name,u.actionClass,u.widgetClass||a)}})}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.CoordUtils;Kekule.Editor.PointerTrackConstraint={NONE:0,LEADING:1,BOTH:2,CIRCLE:5},Kekule.Editor.TrackParser=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackParser",simplifyCurveToLineSegments:function(e,t){return Kekule.GeometryUtils.simplifyCurveToLineSegments(e,t)},addLineCrossPoints:function(e){for(var t=[],r=e.length,i=0;i<r-1;++i)for(var o={coord1:e[i],coord2:e[i+1]},n=i+2;n<r-1;++n){var a={coord1:e[n],coord2:e[n+1]},s=Kekule.GeometryUtils.getCrossPointOfLines(o.coord1,o.coord2,a.coord1,a.coord2);s&&(this._addInsertedPoint(i,s,t),this._addInsertedPoint(n,s,t))}for(i=0;i<r-1;++i)t[i]&&this._sortInsertedPointsInLine(t[i],e[i],e[i+1]);var l=[];for(i=0;i<r-1;++i)if(l.push(e[i]),t[i]){n=0;for(var d=t[i].length;n<d;++n)l.push(t[i][n])}return l.push(e[r-1]),l},addVertexToLineMergePoint:function(e,t){if(t<=0)return e;for(var r=e.length,i=[],o=0;o<r-1;++o)for(var n=e[o],a=0;a<r-1;++a)if(a<o-1||a>o+1){var s=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(n,e[a],e[a+1],!1);if(s)Kekule.CoordUtils.getDistance(n,s)<=t&&(n.x=s.x,n.y=s.y,this._addInsertedPoint(a,n,i))}var l=[];for(o=0;o<r-1;++o)if(l.push(e[o]),i[o]){this._sortInsertedPointsInLine(i[o],e[o],e[o+1]);a=0;for(var d=i[o].length;a<d;++a)l.push(i[o][a])}return l.push(e[r-1]),l},_addInsertedPoint:function(e,t,r){r[e]||(r[e]=[]),r[e].push(t)},_sortInsertedPointsInLine:function(e,t,r){if(e){var i=r.x-t.x,o=r.y-t.y;e.sort(function(e,t){return Math.abs(o)>Math.abs(i)?-(t.y-e.y)*o:-(t.x-e.x)*i})}},mergeNearbyTrackPoints:function(e,r){if(r<=0)return e;for(var i=e.length,o=e.concat([]),n=0;n<i;++n){var a=o[n];if(!a.__$merge_handled__)for(var s=n+1;s<i;++s){var l=o[s];if(!l.__$merge_handled__){var d=a.__$merge_weight__||1,u=l.__$merge_weight__||1;if(Kekule.CoordUtils.getDistance(a,l)<=r){var c,p=d+u;a.__$merge_weight__=p,a.boundObj?c=a:l.boundObj?(c=l,a.boundObj=l.boundObj):(c=1===d?a:t.multiply(a,d),c=t.add(c,1===u?l:t.multiply(l,u)),c=t.divide(c,p)),a.x=c.x,a.y=c.y,o.splice(s,1,a)}}}a.__$merge_handled__=!0}return o},mergeCloseVertexes:function(e,t){return(t=t||this.getVertexMergeRadius())<=0?e:this._doMergeCloseVertexes(e,t)},_doMergeCloseVertexes:function(e,t){for(var r=e.getVertexes(),i=r.length,o=!1,n=0;n<i;++n){for(var a=r[n],s=r[n].getData("coord"),l=n+1;l<i;++l){var d=r[l],u=d.getData("coord");if(Kekule.CoordUtils.getDistance(s,u)<=t){this._doMergeVertex(e,a,d),o=!0;break}}if(o)break}return o?this._doMergeCloseVertexes(e,t):e},_doMergeVertex:function(r,i,o){for(var n=i.getData("coord"),a=i.getData("weight")||1,s=o.getData("coord"),l=o.getData("weight")||1,d=e.clone(o.getEdges()),u=0,c=d.length;u<c;++u){d[u].replaceVertex(o,i)}r.removeVertex(o);var p=1===a?n:t.multiply(n,a);p+=1===l?s:t.multiply(s,l),p=t.divide(p,a+l),i.setData("coord",p)},removeRepetitivePoints:function(e){for(var t=[],r=null,i=0,o=e.length;i<o;++i)e[i]!==r&&(t.push(e[i]),r=e[i]);return t},refineTrack:function(e,t,r){var i=this.simplifyCurveToLineSegments(e,t);return i=this.addLineCrossPoints(i),i=this.addVertexToLineMergePoint(i,r),i=this.mergeNearbyTrackPoints(i,r),i=this.removeRepetitivePoints(i)},convertTrackToStructure:function(e,t,r,i){if(!t||!t.length)return null;var o=t.length;if(o<2)return null;for(var n,a=i||new Kekule.StructureFragment,s=0;s<o;++s){var l=t[s],d=l.__$structure_node__;if(d||((d=new Kekule.Atom).setIsotopeId(r),e.setObjectScreenCoord(d,l),l.__$structure_node__=d,a.appendNode(d)),n&&n!==d&&!d.getConnectorTo(n)){var u=new Kekule.Bond(null,[n,d]);u.setBondOrder(1),a.appendConnector(u)}n=d}return a},convertLinesToGraph:function(e){if(e&&e.length){for(var t,r=new Kekule.Graph,i=e.length,o=0;o<i;++o){var n,a=e[o];if((n=a.__$graph_vertex__)||((n=new Kekule.GraphVertex).setData("coord",a),a.__$graph_vertex__=n,r.addVertex(n)),t&&!n.getEdgeTo(t)){var s=new Kekule.GraphEdge;r.addEdge(s,t,n)}t=n}return r}return null}}),Kekule.Editor.TrackLayoutOptimizer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackLayoutOptimizer",OPTIMIZED_COORD_FIELD:"__$optimizedCoord__",COORD_INDEX_FIELD:"__$coordIndex__",RING_END_INDEX_FIELD:"__$ringEndIndex__",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){},initPropValues:function(){this.tryApplySuper("initPropValues")},splitTrackByRings:function(e){for(var t=[],r=function(e,r){for(var i=0,o=t.length;i<o;++i){var n=t[i];if(!(n.startIndex>r||n.endIndex<e))return!1}return!0},i=0,o=e.length;i<o;++i){var n=e[i];if(void 0===n[this.COORD_INDEX_FIELD])n[this.COORD_INDEX_FIELD]=i;else{var a=n[this.COORD_INDEX_FIELD],s=i;n[this.RING_END_INDEX_FIELD]=s,r(a,s)&&t.push({startIndex:a,endIndex:s})}}var l=[],d=t.length;if(d>0){var u=0;for(i=0;i<d;++i){var c=t[i];c.startIndex>u&&l.push({track:e.slice(u,c.startIndex+1),isRing:!1}),l.push({track:e.slice(c.startIndex,c.endIndex+1),isRing:!0}),u=c.endIndex}return u<e.length-1&&l.push({track:e.slice(u,e.length),isRing:!1}),l}return[{track:e,isRing:!1}]},optimize:function(t,r){var i,o=t,n=Kekule.Editor.PointerTrackConstraint,a=t[0],s=a.boundObj,l=t[t.length-1],d=l.boundObj;s&&d?i=s===d?n.CIRCLE:n.BOTH:s||d?(i=n.LEADING,d&&(o=e.reverse(t))):i=a===l?n.CIRCLE:n.LEADING;var u=Object.extend({},r);return u.preferredStartingAngles=r.preferredStartingAngles||[0],u.segmentsInfo=this._calcTrackSegmentsInfo(o),u.distanceMedian=e.getMedian(u.segmentsInfo.distances),i===n.CIRCLE?this.doOptimizeOnCircleConstraint(o,u):i===n.BOTH?this.doOptimizeOnBothConstraint(o,u):this.doOptimizeOnLeadingConstraint(o,u)},_calcTrackSegmentsInfo:function(e){for(var r=[],i=[],o=0,n=e.length;o<n-1;++o){var a=e[o],s=e[o+1],l=t.getDistance(a,s),d=t.substract(s,a),u=Math.atan2(d.y,d.x);r.push(l),i.push(u)}return{distances:r,angles:i}},doOptimizeOnLeadingConstraint:function(e,r,i){var o=Kekule.GeometryUtils,n=[];if(i){Kekule.Editor.PointerTrackConstraint;var a,s=this.splitTrackByRings(e);if(1===s.length)return s[l].isRing?this.doOptimizeOnCircleConstraint(u,r,!0):this.doOptimizeOnLeadingConstraint(u,r,!0);for(var l=0,d=s.length;l<d;++l){var u=s[l].track,c=s[l].isRing?this.doOptimizeOnCircleConstraint(u,r,!0):this.doOptimizeOnLeadingConstraint(u,r,!0);if(a){for(var p=c[0],h=t.substract(a,p),g=0,C=c.length;g<C;++g)c[g]=t.add(c[g],h);a=c[c.length-1],c.shift(),n=n.concat(c)}else a=c[c.length-1],n=n.concat(c)}return n}var _,m=r.preferredStartingAngles;n.push(e[0]);for(r.preferredIncludeAngle,r.preferredIncludeAngle,l=1,d=e.length;l<d;++l)if(e[l][this.OPTIMIZED_COORD_FIELD])n.push(e[l][this.OPTIMIZED_COORD_FIELD]);else{var f,S=e[l-1],y=n[l-1],O=e[l],E=(h=t.substract(O,S),t.getDistance(S,O)),T=this._optimizeLineSegmentDistance(E,r),A=Math.atan2(h.y,h.x);_=f=this._optimizeDirectionAngle(A,m,r,_);var k=Math.PI-r.preferredIncludeAngle,b=(m=[o.standardizeAngle(f-k),o.standardizeAngle(f+k)],{x:T*Math.cos(f),y:T*Math.sin(f)}),I=t.add(y,b);n.push(I),e[l][this.OPTIMIZED_COORD_FIELD]=I}return n},doOptimizeOnBothConstraint:function(e,r,i){var o=e.length,n=this.doOptimizeOnLeadingConstraint(e,r,i),a=n[o-1],s=e[o-1],l=e[0],d=t.substract(s,l),u=Math.atan2(d.y,d.x),c=t.substract(a,l),p=Math.atan2(c.y,c.x),h=t.getDistance(d)/t.getDistance(c);if(h<=2){var g=t.calcTransform2DMatrix({rotateAngle:-p,center:l}),C=t.calcTransform2DMatrix({scale:h,center:l}),_=t.calcTransform2DMatrix({rotateAngle:u,center:l}),m=Kekule.MatrixUtils.multiply(g,C);m=Kekule.MatrixUtils.multiply(m,_);for(var f=[n[0]],S=1;S<o-1;++S)f.push(t.transform2DByMatrix(n[S],m));f.push(e[o-1])}else{var y=t.divide(t.substract(s,a),o-1),O=(f=[n[0]],{x:0,y:0});for(S=0;S<o-1;++S)O=t.add(O,y),f.push(t.add(n[S],O));f.push(e[o-1])}return f},doOptimizeOnCircleConstraint:function(e,r,i){var o=e.length-1,n=Object.create(r);if(o<=8){var a=(1-2/o)*Math.PI;(n=Object.create(r)).preferredIncludeAngle=a}for(var s=e.length,l=this.doOptimizeOnLeadingConstraint(e,n,i),d=l[s-1],u=e[s-1],c=t.divide(t.substract(u,d),s-1),p=[l[0]],h={x:0,y:0},g=1;g<s-1;++g)h=t.add(h,c),p.push(t.add(l[g],h));return p.push(e[s-1]),p},_optimizeIncludeAngle:function(e,t,r){return this._optimizeDirectionAngle(e,t,r)},_optimizeDirectionAngle:function(e,t,r,i){var o=Kekule.GeometryUtils,n=null,a=null;if(t&&t.length){for(var s=null,l=0,d=t.length;l<d;++l){var u=Math.abs(o.standardizeAngle(e)-t[l]);(null===s||u<s)&&(a=t[l],s=u)}s<=Math.PI/6&&(n=a)}if(null===n){var c=r.angleConstraint;if(!c)return e;null===a&&(a=0);u=e-a;if(n=a+Math.round(u/c)*c,i){var p=5*Math.PI/180,h=Math.abs(o.standardizeAngle(n-i,-Math.PI));if(Kekule.NumUtils.isFloatEqual(h,0,p)||Kekule.NumUtils.isFloatEqual(h,Math.PI,p)){var g=n+c,C=n-c;n=Math.abs(e-g)<Math.abs(e-C)?g:C}}}return n},_optimizeLineSegmentDistance:function(e,t){var r=t.defBondScreenLength,i=t.distanceConstraints||[];if(!i)return e;if(e>i[i.length-1]*r)return Math.round(e/r)*r;var o,n=t.primaryDistanceConstraint,a=i.length,s=i.indexOf(n);s<0&&(s=0);for(var l=a-1;l>=s;--l){var d=i[l];if(e>(o=d*r))return o}for(l=0;l<=s;++l)if(e<(o=d*r))return o;return o}}),Kekule.Editor.TrackInputIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.TrackInputIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._isTracking=!1,this._trackCoordToObjBindings=null,this._trackParser=new Kekule.Editor.TrackParser,this._trackLayoutOptimizer=new Kekule.Editor.TrackLayoutOptimizer,this._addStructureOperation=null,this._editorScaled=!1,this._editorOriginalZoomLevel=1,this._lastRenderedMarkerCoord=null,this._debugMarkers={}},doFinalize:function(){this._trackLayoutOptimizer.finalize(),this._trackParser.finalize();var e=this.getPropStoreFieldValue("trackMarker");e&&e.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("trackMarker",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("trackMarker");return e||(e=new Kekule.ChemWidget.MetaShapeUIMarker({shapeType:Kekule.Render.MetaShapeType.POLYLINE,coords:[]}),this.setPropStoreFieldValue("trackMarker",e)),e}})},initPropValues:function(){this.tryApplySuper("initPropValues")},getEditorUiMarkers:function(){return this.getEditor().getUiMarkers()},refineTrackCoords:function(e){var r=this.getEditor(),i=this.getEditorConfigs(),o={angleConstraint:i.getInteractionConfigs().getTrackOptimizationAngleConstraint(),distanceConstraints:i.getInteractionConfigs().getTrackOptimizationDistanceConstraints(),primaryDistanceConstraint:i.getInteractionConfigs().getTrackOptimizationPrimaryDistanceConstraint(),preferredIncludeAngle:2*Math.PI/3},n=r.getDefBondLength?r.getDefBondLength():i.getStructureConfigs().getDefBondLength(),a=r.objCoordToScreen({x:0,y:0}),s=r.objCoordToScreen({x:n,y:0}),l=t.getDistance(a,s);o.defBondScreenLength=l;for(var d=this.getEditorConfigs().getInteractionConfigs().getTrackSimplifierDistanceThreshold(),u=this.getEditorConfigs().getInteractionConfigs().getTrackMergeDistanceThreshold(),c=this._mergeCoordsToBoundNodesAndSplitTrack(e),p=[],h=0,g=c.length;h<g;++h){var C=c[h],_=(C=this._trackParser.refineTrack(C,d,u))[0].obj||C[C.length-1].obj,m=_?i.getStructureConfigs.getNewBondDefAngle(_,1):-Math.PI/6;o.preferredStartingAngles=[m],C=this._trackLayoutOptimizer.optimize(C,o),p.push(C)}return p},_mergeCoordsToBoundNodesAndSplitTrack:function(e){var t=this._trackCoordToObjBindings,r=t.length;if(r){for(var i=this.getEditor(),o=[],n=t[0].obj,a=t[0].coordIndex,s=0,l=1;l<=r;++l){var d=t[l];if(l<r&&d&&(n!==d.obj||d.coordIndex-a>10)||l===r){a>s&&o.push(e.slice(s,a));var u=i.getObjectScreenCoord(n);u.boundObj=n,s=t[l-1].coordIndex+1,o.push([u]),l!==r&&(n=d.obj,a=d.coordIndex)}}e.length-1>t[r-1].coordIndex&&o.push(e.slice(t[r-1].coordIndex));for(var c=[],p=[],h=(l=0,o.length);l<h;++l){var g=o[l];c=c.concat(g),l===h-1?p.push(c):g[0].boundObj&&l>0&&(p.push(c),c=g)}return p}return[e]},convertTracksToStructure:function(e,t){var r=new Kekule.Molecule;r.setCoord2D({x:0,y:0});for(var i=this.getEditor(),o=0,n=e.length;o<n;++o)this._trackParser.convertTrackToStructure(i,e[o],t,r);return r.getNodeCount()<2?null:r},getStructureSelectableChildren:function(e){return[].concat(e.getNodes()).concat(e.getConnectors())},addStructureToEditor:function(e){var t=this.getEditor();this._addStructureOperation=null,t.beginUpdateObject();try{var r,i=t.getChemSpace();this._targetMol?(r=new Kekule.ChemStructOperation.MergeStructFragment(e,this._targetMol,t),this._targetMol=null):r=new Kekule.ChemObjOperation.Add(e,i,null,t),r.execute(),this._addStructureOperation=r}finally{t.endUpdateObject()}},getTrackCoords:function(){return this.getTrackMarker().getShapeInfo().coords},clearTrackCoords:function(){this.getTrackMarker().getShapeInfo().coords=[]},startTracking:function(e,t){this._targetMol=null;var r=this.getEditor(),i=this._getMergeDestObjAtCoord(t);if(!r.canCreateNewChild()&&!i){if(!r.canAddUnconnectedStructFragment())return null;var o=r.getOnlyOneBlankStructFragment();this._targetMol=o}this._isTracking=!0,this._trackCoordToObjBindings=[],this.setManuallyHotTrack(!0),this.clearTrackCoords();var n=this.getTrackMarker();this.getEditorUiMarkers().addMarker(n);var a=this.getEditorConfigs().getUiMarkerConfigs(),s={strokeColor:a.getTrackMarkerStrokeColor(),strokeWidth:a.getTrackMarkerStrokeWidth(),strokeDash:a.getTrackMarkerStrokeDash(),opacity:a.getTrackMarkerOpacity()};if(n.setDrawStyles(s),n.setVisible(!0),this.addTrackCoord(t,!1),this.getEditorConfigs().getInteractionConfigs().getAutoAdjustZoomLevelOnTrackTouching()){r=this.getEditor();var l=this.getEditorConfigs().getInteractionConfigs().getTrackTouchRefLength();if(l){var d=r.getDocument(),u=r.getDefBondScreenLength(),c=Kekule.DocumentUtils.getDevicePPI(d)*l/Kekule.DocumentUtils.getClientScaleLevel(d)/u;if(c>.9){var p=r.getCurrZoom();r.setZoomCenter(t),r.zoomTo(p*c);var h=this._getEventMouseCoord(e),g=this.getTrackCoords(),C=g[g.length-1];t=h,Object.extend(C,h),this._editorScaled=!0,this._editorOriginalZoomLevel=p,this._autoScaleStartCoord=h}else this._editorScaled=!1,this._editorOriginalZoomLevel=null}}this.repaintMarker(),this._lastRenderedMarkerCoord=t},endTracking:function(e){var t=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId()||"C";this._isTracking=!1,this.addTrackCoord(e);var r=this.refineTrackCoords(this.getTrackCoords());if(r.length){var i=this.convertTracksToStructure(r,t);if(i){this.addStructureToEditor(i),this.startDirectManipulate(null,i,e),this.moveManipulatedObjs(e),this.manipulateBeforeStopping(),this.stopManipulate();var o=this.getStructureSelectableChildren(i);this.doneInsertOrModifyBasicObjects(o)}}this.doneTracking()},cancelTracking:function(){this._isTracking=!1,this.getEditorUiMarkers().removeMarker(this.getTrackMarker()),this.doneTracking()},doneTracking:function(){if(this._editorScaled){var e=this.getTrackCoords();e[e.length-1];this._editorScaled=!1,this.getEditor().zoomTo(this._editorOriginalZoomLevel,null,this._autoScaleStartCoord),this._editorOriginalZoomLevel=null,this._autoScaleStartCoord=null}this.setManuallyHotTrack(!1),this.getEditor().hideHotTrack(),this.clearTrackCoords(),this.repaintMarker()},_getMergeDestObjAtCoord:function(e){for(var t=this.getEditor().getBasicObjectsAtCoord(e,this.getCurrBoundInflation()),r=0,i=t.length;r<i;++r){var o=t[r];if(this.isValidMergeDestObj(o))return o}return null},addTrackCoord:function(e,t){var r=this.getTrackCoords(),i=r&&r[r.length-1];if(!i||!Kekule.CoordUtils.isEqual(e,i)){var o=this._getMergeDestObjAtCoord(e);if(o&&(this._trackCoordToObjBindings.push({coord:e,obj:o,coordIndex:this.getTrackCoords().length}),this.getEditor().addHotTrackedObj(o)),r.push(e),!t)this._lastRenderedMarkerCoord?Kekule.CoordUtils.getDistance(this._lastRenderedMarkerCoord,e)>5&&(this.repaintMarker(),this._lastRenderedMarkerCoord=e):(this.repaintMarker(),this._lastRenderedMarkerCoord=e)}},repaintMarker:function(){this.getEditor().repaintUiMarker()},isValidMergeDestObj:function(e){return e instanceof Kekule.ChemStructureNode},canInteractWithObj:function(e){return e instanceof Kekule.ChemStructureNode},getAllObjOperations:function(e){var t=this.tryApplySuper("getAllObjOperations",[e])||[],r=this._addStructureOperation;return r&&t.unshift(r),t},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===Kekule.X.Event.MouseButton.LEFT){var t=this._getEventMouseCoord(e);return this.startTracking(e,t),e.preventDefault(),!0}if(e.getButton()===Kekule.X.Event.MouseButton.RIGHT)return this.cancelTracking(),e.preventDefault(),!0},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MouseButton.LEFT){if(this._isTracking){var t=this._getEventMouseCoord(e);this.endTracking(t),this.addOperationToEditor()}return this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),e.preventDefault(),!0}},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this._isTracking){var t=this._getEventMouseCoord(e);return this.addTrackCoord(t),e.preventDefault(),!0}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.TrackInputIaController,Kekule.Editor.ChemSpaceEditor)}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.Editor,Kekule.Widget.HtmlClassNames,Kekule.ChemWidget.HtmlClassNames,Kekule.ChemWidget.ComponentWidgetNames;Kekule.Editor.ObjModifier={},Kekule.Editor.ObjModifier.Category={GENERAL:"general",CHEM_STRUCTURE:"chemStruct",GLYPH:"glyph",STYLE:"style",MISC:"misc"},Kekule.Editor.ObjModifier.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.ObjModifier.Base",initialize:function(e){this.tryApplySuper("initialize"),this.setEditor(e),this.modifierWidgetValueChangedBind=this.modifierWidgetValueChanged.bind(this)},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1}),this.defineProp("targetObjs",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getEditor().getSelection()}}),this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("widget");return e||(e=this.createWidget(),this.setPropStoreFieldValue("widget",e)),e}})},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getModifierName:function(){return this.getClassLocalName().toLowerCase()},createWidget:function(){var e=this.doCreateWidget();return e&&this.installValueChangeEventHandler(e),e},doCreateWidget:function(){return null},installValueChangeEventHandler:function(e){e.on("valueChange",this.modifierWidgetValueChangedBind)},modifierWidgetValueChanged:function(){this.applyToTargets()},loadFromTargets:function(){var e=this.getEditor();if(e){var t=this.getTargetObjs();t&&this.doLoadFromTargets(e,t)}return this},doLoadFromTargets:function(e,t){},applyToTargets:function(){var e=this.getEditor();if(e){var t=this.getTargetObjs();t&&this.doApplyToTargets(e,t)}return this},doApplyToTargets:function(e,t){var r=this.createModificationOper();r&&e.execOperation(r)},createModificationOper:function(e){var t=[];if(e&&e.length)for(var r=0,i=e.length;r<i;++r){var o=this.createModificationOperOnTarget(e[r]);o&&t.push(o)}var n=t.length;return n<=0?null:1===n?t[0]:new Kekule.MacroOperation(t)},createModificationOperOnTarget:function(e){var t=this.getModifiedPropValues();return t?this.createModificationOperation(e,t):null},getModifiedPropValues:function(){return null},createModificationOperation:function(e,t){return new Kekule.ChemObjOperation.Modify(e,t,this.getEditor())}}),Kekule.Editor.ObjModifierManager={_modifierMap:new Kekule.MapEx(!0),register:function(r,i){if(i&&r)for(var o=e.toArray(i),n=e.toArray(r),a=0,s=n.length;a<s;++a){var l=n[a],d=t._modifierMap.get(l);d?e.pushUnique(d,o):(d=o,t._modifierMap.set(l,d))}},unregister:function(r){if(r)for(var i=e.toArray(r),o=t._modifierMap.getKeys(),n=0,a=o.length;n<a;++n){var s=t._modifierMap.get(o[n]);s&&s.length&&t._modifierMap.set(o[n],e.exclude(s,i))}},getModifierCategories:function(r){var i=r.getCategories&&r.getCategories()||[],o=ClassEx.getSuperClass(r);return o&&e.pushUnique(i,t.getModifierCategories(o)),i},getModifierClasses:function(r,i){var o=t._modifierMap.get(r)||[],n=ClassEx.getSuperClass(r);if(n&&e.pushUnique(o,t.getModifierClasses(n,i)),i&&i.length){var a=o;o=[];for(var s=0,l=a.length;s<l;++s){var d=t.getModifierCategories(a[s]);e.intersect(d,i).length&&o.push(a[s])}}return o}};var t=Kekule.Editor.ObjModifierManager}(),function(){"use strict";Kekule.ArrayUtils,Kekule.Editor;var e=Kekule.Widget.HtmlClassNames,t=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ComponentWidgetNames;Kekule.Editor.ObjModifier.BaseRenderOptionModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.BaseRenderOptionModifier",getRenderOptionValue:function(e,t,r){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(e,t,r)}}),Kekule.Editor.ObjModifier.BaseRenderOptionModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.STYLE]},Kekule.Editor.ObjModifier.Color=Class.create(Kekule.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Color",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:Kekule.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:e.COLORPICKER_SPEC_COLOR_MIXED},initProperties:function(){this.defineProp("colorBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new Kekule.Widget.ColorDropButton(this.getEditor());return e.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR")),e.setShowText(!1),e.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]),e.addClassName(t.COMPOSER_COLOR_BOX),this.setPropStoreFieldValue("colorBox",e),e},doLoadFromTargets:function(e,t){if(t&&t.length){var r=this.getColorBox();if(r){var i=this.getRenderOptionValue(t,"useAtomSpecifiedColor"),o=this.getRenderOptionValue(t,"color");i?(o=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value,r.setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className),r.setValue(o)):(r.setColorClassName(null),r.setValue(o))}}},doApplyToTargets:function(e,t){var r=this.getWidget().getValue();r===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value?e.modifyObjectsRenderOptions(t,{useAtomSpecifiedColor:!0,color:void 0},!1,!0):(r==Kekule.Widget.ColorPicker.SpecialColors.UNSET&&(r=void 0),e.modifyObjectsRenderOptions(t,{useAtomSpecifiedColor:!1,color:r},!1,!0))}}),Kekule.Editor.ObjModifierManager.register(Kekule.ChemObject,[Kekule.Editor.ObjModifier.Color])}(),function(){"use strict";var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames,Kekule.ChemWidget.HtmlClassNames),r=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_TEXTFORMAT_BUTTON:"K-Chem-Composer-TextFormat-Button",COMPOSER_MODIFIER_RICHTEXT_PANEL:"K-Chem-Composer-Modifier-RichText-Panel",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP:"K-Chem-Composer-Modifier-RichText-Panel-Group",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-LabelCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-CtrlCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABEL:"K-Chem-Composer-Modifier-RichText-Panel-Group-Label",COMPOSER_TEXTDIRECTION_BOX:"K-Chem-Composer-TextDirection-Box",COMPOSER_TEXTALIGN_BOX:"K-Chem-Composer-TextAlign-Box"}),Kekule.globalOptions.add("chemWidget.composer.objModifier.richText",{componentNames:[r.fontName,r.fontSize,r.textDirection,r.textAlign,r.nodeDisplayMode]}),Kekule.Editor.ObjModifier.RichText=Class.create(Kekule.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.RichText",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={},this._nodeLabelDisplayModeGroup=null},initProperties:function(){this.defineProp("fontPanel",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("fontNameBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textDirectionBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textHorizontalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textVerticalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("nodeLabelDisplayModeBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},_createCtrlGroup:function(r,i,o,n){var a=r.createElement("tr");a.className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP,(s=r.createElement("td")).className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL;var s,l=r.createElement("label");return l.className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUPLABEL,e.setElementText(l,o),s.appendChild(l),a.appendChild(s),(s=r.createElement("td")).className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL,n.appendToElem(s),a.appendChild(s),i.appendChild(a),a},_doCreateDropDownPanel:function(){var e=new Kekule.Widget.Panel(this.getEditor());e.addClassName(t.COMPOSER_MODIFIER_RICHTEXT_PANEL).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT"));var i,o=Kekule.globalOptions.chemWidget.composer.objModifier.richText.componentNames,n=this.getEditor().getDocument(),a=n.createElement("table");if(e.getContainerElement().appendChild(a),o.indexOf(r.fontName)>=0){var s=new Kekule.Widget.ComboBox(e);this.fillFontNameBox(s),s.addClassName(t.COMPOSER_FONTNAME_BOX),s.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME")),s.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontFamily:this.getFontNameBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("fontNameBox",s),this._createCtrlGroup(n,a,Kekule.$L("ChemWidgetTexts.CAPTION_FONTNAME"),s)}if(o.indexOf(r.fontSize)>=0&&(s=new Kekule.Widget.ComboBox(e),this.fillFontSizeBox(s),s.addClassName(t.COMPOSER_FONTSIZE_BOX),s.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE")),s.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontSize:this.getFontSizeBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("fontSizeBox",s),this._createCtrlGroup(n,a,Kekule.$L("ChemWidgetTexts.CAPTION_FONTSIZE"),s)),o.indexOf(r.textDirection)>=0){i=new Kekule.Widget.SelectBox(e);var l=Kekule.Render.TextDirection,d=[{value:l.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT")},{value:l.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR")},{value:l.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL")},{value:l.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB")},{value:l.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT")}];i.setItems(d),s.addClassName(t.COMPOSER_TEXTDIRECTION_BOX),i.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION")),i.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{charDirection:this.getTextDirectionBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("textDirectionBox",i),this._createCtrlGroup(n,a,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),i)}if(o.indexOf(r.textAlign)>=0){i=new Kekule.Widget.SelectBox(e);d=[{value:(u=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:u.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:u.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:u.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:u.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT")},{value:u.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT")}];i.setItems(d),s.addClassName(t.COMPOSER_TEXTALIGN_BOX),i.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN")),i.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{horizontalAlign:this.getTextHorizontalAlignBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("textHorizontalAlignBox",i),this._createCtrlGroup(n,a,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),i),i=new Kekule.Widget.SelectBox(e);var u;d=[{value:(u=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:u.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:u.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:u.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:u.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP")},{value:u.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM")}];i.setItems(d),s.addClassName(t.COMPOSER_TEXTALIGN_BOX),i.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN")),i.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{verticalAlign:this.getTextVerticalAlignBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("textVerticalAlignBox",i),this._createCtrlGroup(n,a,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),i)}if(o.indexOf(r.nodeDisplayMode)>=0){s=new Kekule.Widget.SelectBox(e);this.fillNodeDisplayModeBox(s),s.addClassName(t.COMPOSER_NODEDISPLAYMODE_BOX),s.setHint(Kekule.$L("ChemWidgetTexts.HINT_NODE_LABEL_DISPLAY_MODE")),s.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{nodeDisplayMode:this.getNodeLabelDisplayModeBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("nodeLabelDisplayModeBox",s),this._nodeLabelDisplayModeGroup=this._createCtrlGroup(n,a,Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE"),s)}this.setPropStoreFieldValue("fontPanel",e);var c=this._valueStorage;return c&&this._updateUiValuesFromStorage(c),e},doCreateWidget:function(){var e=new Kekule.Widget.DropDownButton(this.getEditor());return e.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_FORMAT")),e.setText(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT")),e.setShowText(!1),e.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),e.addClassName(t.COMPOSER_TEXTFORMAT_BUTTON),e.setDropDownWidgetGetter(this._doCreateDropDownPanel.bind(this)),e},_filterNodeLabelDisplayModeTargets:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r];o instanceof Kekule.ChemStructureNode&&(o instanceof Kekule.StructureFragment&&o.hasCtab(),t.push(o))}return t},_hasNodeLabelDisplayModeTarget:function(e){return!!this._filterNodeLabelDisplayModeTargets(e).length},_updateUiValuesFromStorage:function(e){this.getFontPanel()&&(this.getFontNameBox()&&this.getFontNameBox().setValue(e.fontName),this.getFontSizeBox()&&this.getFontSizeBox().setValue(e.fontSize),this.getTextDirectionBox()&&this.getTextDirectionBox().setValue(e.textDirection),this.getTextHorizontalAlignBox()&&this.getTextHorizontalAlignBox().setValue(e.textHAlign),this.getTextVerticalAlignBox()&&this.getTextVerticalAlignBox().setValue(e.textVAlign),this.getNodeLabelDisplayModeBox()&&this.getNodeLabelDisplayModeBox().setValue(e.nodeDisplayMode),this._nodeLabelDisplayModeGroup&&Kekule.StyleUtils.setDisplay(this._nodeLabelDisplayModeGroup,e.hasNodeLabelDisplayModeTarget))},doLoadFromTargets:function(e,t){if(t&&t.length){var r=this._valueStorage;r.fontName=this.getRenderOptionValue(t,"fontFamily")||"",r.fontSize=this.getRenderOptionValue(t,"fontSize")||void 0,r.textDirection=this.getRenderOptionValue(t,"charDirection")||Kekule.Render.TextDirection.DEFAULT,r.textHAlign=this.getRenderOptionValue(t,"horizontalAlign")||Kekule.Render.TextAlign.DEFAULT,r.textVAlign=this.getRenderOptionValue(t,"verticalAlign")||Kekule.Render.TextAlign.DEFAULT,r.nodeDisplayMode=this.getRenderOptionValue(this._filterNodeLabelDisplayModeTargets(t),"nodeDisplayMode")||Kekule.Render.NodeLabelDisplayMode.DEFAULT,r.hasNodeLabelDisplayModeTarget=this._hasNodeLabelDisplayModeTarget(t),this.getFontPanel()&&this._updateUiValuesFromStorage(r)}},doApplyToTargets:function(e,t){},fillFontSizeBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes(),r=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:void 0}],i=0,o=t.length;i<o;++i)r.push({text:t[i]+" px",value:t[i]});e.setItems(r)},fillFontNameBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames(),r=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}],i=0,o=t.length;i<o;++i)r.push({text:t[i],value:t[i]});e.setItems(r)},fillNodeDisplayModeBox:function(e){var t=Kekule.Render.NodeLabelDisplayMode,r=[{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT"),value:t.DEFAULT},{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN"),value:t.SHOWN},{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN"),value:t.HIDDEN},{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_SMART"),value:t.SMART}];e.setItems(r)}}),Kekule.Editor.ObjModifierManager.register(Kekule.ChemObject,[Kekule.Editor.ObjModifier.RichText])}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.DomUtils,r=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames),i=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_ATOM_MODIFIER_BUTTON:"K-Chem-Composer-AtomModifier-Button",COMPOSER_ATOM_MODIFIER_DROPDOWN:"K-Chem-Composer-AtomModifier-DropDown",COMPOSER_BOND_MODIFIER_BUTTON:"K-Chem-Composer-BondModifier-Button",COMPOSER_BOND_MODIFIER_DROPDOWN:"K-Chem-Composer-BondModifier-DropDown",COMPOSER_CHARGE_MODIFIER_BUTTON:"K-Chem-Composer-ChargeModifier-Button",COMPOSER_CHARGE_MODIFIER_DROPDOWN:"K-Chem-Composer-ChargeModifier-DropDown"}),Kekule.Editor.ObjModifier.ChemStructureModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.ChemStructureModifier",installValueChangeEventHandler:function(e){}}),Kekule.Editor.ObjModifier.ChemStructureModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.CHEM_STRUCTURE]},Kekule.Editor.ObjModifier.Atom=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Atom",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={}},initProperties:function(){this.defineProp("atomSetter",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new Kekule.Widget.DropDownButton(this.getEditor());return e.setHint(Kekule.$L("ChemWidgetTexts.HINT_ATOM_MODIFIER")),e.setText(Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER")),e.setShowText(!0),e.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),e.addClassName(i.COMPOSER_ATOM_MODIFIER_BUTTON),e.setDropDownWidgetGetter(this._createAtomSetter.bind(this)),e},_createAtomSetter:function(o){o||(o=this.getEditor());var n=this.getEditor(),a=new Kekule.ChemWidget.StructureNodeSetter(o);a.addClassName([r.PANEL,i.COMPOSER_ATOM_MODIFIER_DROPDOWN,r.CORNER_ALL]),a.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs());var s=o.getDocument().createElement("div");s.className=r.PANEL_CAPTION,t.setElementText(s,Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER"));var l=a.getElement();l.insertBefore(s,Kekule.DomUtils.getFirstChildElem(l));var d=e.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());d.push("...");var u=n&&n.getEnabledNonAtomInputData&&n.getEnabledNonAtomInputData();a.setSelectableInfos({elementSymbols:d,nonElementInfos:u,subGroupRepItems:Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()});var c=this;return a.addEventListener("valueChange",function(e){e.value&&c.applyToTargets(),a.dismiss()}),this.setPropStoreFieldValue("atomSetter",a),this._valueStorage.nodes&&a.setNodes(this._valueStorage.nodes),a},_filterStructureNodes:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r];o instanceof Kekule.ChemStructureNode&&t.push(o)}return t},_getActualModificationNodes:function(t,r){for(var i=[],o=0,n=t.length;o<n;++o){var a=t[o];if(a instanceof Kekule.StructureFragment&&a.isExpanded()){var s=this._getActualModificationNodes(a.getNodes(),!0);e.pushUnique(i,s)}else i.push(a)}return r||(i=this._filterStructureNodes(i)),i},doLoadFromTargets:function(e,t){var r,i=this._getActualModificationNodes(t);this._valueStorage.nodes=i,this.getAtomSetter()&&(this.getAtomSetter().setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),this.getAtomSetter().setNodes(i)),r=Kekule.Editor.StructureUtils.getAllChemStructureNodesHtmlCode(i,null,null,this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),this.getWidget().setText(r||Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER_MIXED")).setShowText(!0).setDisplayed(!!i.length)},doApplyToTargets:function(e,t){for(var r,i=this.getAtomSetter().getValue(),o=[],n=this._getActualModificationNodes(t),a=0,s=n.length;a<s;++a){var l=n[a];if(l instanceof Kekule.ChemStructureNode){var d=this._createNewDataToAtomOperation(i,l);d&&o.push(d)}}(r=o.length>1?new Kekule.MacroOperation(o):o[0])&&this.getEditor().execOperation(r)},_createNewDataToAtomOperation:function(e,t){return Kekule.Editor.OperationUtils.createNodeModificationOperationFromData(t,e,this.getEditor())},_createModificationOperation:function(e,t,r,i){return Kekule.Editor.OperationUtils.createNodeModificationOperation(e,t,r,i,this.getEditor())}}),Kekule.Editor.ObjModifier.Bond=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Bond",initialize:function(e){this.tryApplySuper("initialize",[e]),this._activeSelBtnHtmlClass=null,this._defaultBondTypeData=null,this._valueStorage={};var t=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=t[0]},initProperties:function(){this.defineProp("bondSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new Kekule.Widget.DropDownButton(this.getEditor());return e.setHint(Kekule.$L("ChemWidgetTexts.HINT_BOND_MODIFIER")),e.setText(Kekule.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER")),e.setShowText(!1),e.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),e.addClassName(i.COMPOSER_BOND_MODIFIER_BUTTON),e.setDropDownWidgetGetter(this._createBondSelector.bind(this)),this._defaultBondTypeData.htmlClass&&e.addClassName(this._defaultBondTypeData.htmlClass),e},_filterBond:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r];o instanceof Kekule.Bond&&t.push(o)}return t},_getActualModificationBonds:function(t,r){for(var i=[],o=0,n=t.length;o<n;++o){var a=t[o];if(a instanceof Kekule.StructureFragment&&a.isExpanded()){var s=this._getActualModificationBonds(a.getNodes(),!0);e.pushUnique(i,s),e.pushUnique(i,a.getConnectors())}else a instanceof Kekule.Bond&&i.push(a)}return r||(i=this._filterBond(i)),i},_createBondSelector:function(e){e||(e=this.getEditor());var t=new Kekule.ChemWidget.StructureConnectorSelectPanelAdv(e);if(t.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER")),t.addClassName(i.COMPOSER_BOND_MODIFIER_DROPDOWN),this.getEditor().getEnabledBondFormData){var r=this.getEditor().getEnabledBondFormData();t.setBondPropNames(this._getBondComparePropNames(r)),t.setBondData(r);var o=this.getEditor().getEditorConfigs().getInteractionConfigs().getEnableBondKekulizeHucklize();t.setExtraComponents(o?[Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE]:[])}this._valueStorage.bondsPropValues&&t.setActiveBondPropValues(this._valueStorage.bondsPropValues),this.setPropStoreFieldValue("bondSelector",t);var n=this;return t.addEventListener("valueChange",function(e){n.applyToTargets(),t.dismiss()}),t.addEventListener("command",function(e){n.execExtraCommand(e.command)}),t},_setActiveBondHtmlClass:function(e){var t=this._activeSelBtnHtmlClass;t&&this.getWidget().removeClassName(t),this._activeSelBtnHtmlClass=e,e||(e=this._defaultBondTypeData.htmlClass),e&&this.getWidget().addClassName(e)},_extractBondPropValues:function(e,t){return e.getPropValues(t)},_extractBondsPropValues:function(e,t){for(var r,i,o=0,n=e.length;o<n;++o)if(i=this._extractBondPropValues(e[o],t),r){if(!Kekule.Editor.StructureUtils.isBondPropsMatch(r,i,t)){r=null;break}}else r=i;return r},_getBondComparePropNames:function(t){for(var r=[],i=0,o=t.length;i<o;++i){var n=t[i].bondProps;n&&e.pushUnique(r,Kekule.ObjUtils.getOwnedFieldNames(n))}return r},_getMatchedBondData:function(e,t,r){if(!e)return null;for(var i=0,o=t.length;i<o;++i){var n=t[i];if(n&&Kekule.Editor.StructureUtils.isBondPropsMatch(e,n.bondProps,r))return n}return null},_createBondModificationOperation:function(e,t){return new Kekule.ChemObjOperation.Modify(t,e,this.getEditor())},_execModificationOperations:function(e){var t;(t=e.length>1?new Kekule.MacroOperation(e):e[0])&&this.getEditor().execOperation(t)},doLoadFromTargets:function(e,t){var r=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=r[0];var i=this._getActualModificationBonds(t);if(this._valueStorage.connectors=i,this.getBondSelector()){var o=this.getBondSelector().getBondPropNames(),n=this._extractBondsPropValues(i,o);this.getBondSelector().setActiveBondPropValues(n),this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())}else{this._valueStorage.bondPropNames=this._getBondComparePropNames(r),this._valueStorage.bondsPropValues=this._extractBondsPropValues(i,this._valueStorage.bondPropNames);var a=this._getMatchedBondData(this._valueStorage.bondsPropValues,r,this._valueStorage.bondPropNames);this._setActiveBondHtmlClass(a&&a.htmlClass)}this.getWidget().setDisplayed(!!i.length)},doApplyToTargets:function(e,t){for(var r=this.getBondSelector().getActiveBondPropValues(),i=[],o=this._getActualModificationBonds(t),n=0,a=o.length;n<a;++n){var s=o[n],l=this._createBondModificationOperation(r,s);l&&i.push(l)}this._execModificationOperations(i),this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())},execExtraCommand:function(e){var t=this._getActualModificationBonds(this.getTargetObjs());if(t&&t.length){var r=this.getEditor().getChemObj();if(r&&r.getKekulizationChanges){var i,o=Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands;if(e===o.KEKULIZE?i=r.getKekulizationChanges(t):e===o.HUCKLIZE&&(i=r.getHucklizationChanges(t)),i&&i.length){for(var n=[],a=0,s=i.length;a<s;++a){var l=i[a].bond,d=i[a].bondOrder,u=this._createBondModificationOperation({bondOrder:d},l);n.push(u)}this._execModificationOperations(n)}}}},_getKekulizeOrHucklizeBondModifications:function(e){this.getEditor()}}),Kekule.Editor.ObjModifier.Charge=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Charge",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={}},initProperties:function(){this.defineProp("chargeSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new Kekule.Widget.DropDownButton(this.getEditor());return e.setHint(Kekule.$L("ChemWidgetTexts.HINT_CHARGE_MODIFIER")).setText(Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN")).setShowText(!0).setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),e.addClassName(i.COMPOSER_CHARGE_MODIFIER_BUTTON),e.setDropDownWidgetGetter(this._createChargeSelector.bind(this)),e},_createChargeSelector:function(e){e||(e=this.getEditor());var t=new Kekule.ChemWidget.ChargeSelectPanel(e);t.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_CHARGE_MODIFIER")),t.addClassName(i.COMPOSER_CHARGE_MODIFIER_DROPDOWN),Kekule.ObjUtils.notUnset(this._valueStorage.charge)&&t.setValue(this._valueStorage.charge),this.setPropStoreFieldValue("chargeSelector",t);var r=this;return t.addEventListener("valueChange",function(e){r.applyToTargets(),t.dismiss()}),t},_filterStructureNodes:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var o=e[r];o instanceof Kekule.ChemStructureNode&&o.getCharge&&t.push(o)}return t},_getActualModificationNodes:function(t,r){for(var i=[],o=0,n=t.length;o<n;++o){var a=t[o];if(a instanceof Kekule.StructureFragment&&a.isExpanded()){var s=this._getActualModificationNodes(a.getNodes(),!0);e.pushUnique(i,s)}else i.push(a)}return r||(i=this._filterStructureNodes(i)),i},_getChargeOfNodes:function(e){for(var t=null,r=0,i=e.length;r<i;++r){var o=e[r];if(o.getCharge){var n=o.getCharge()||0;if(null===t)t=n;else if(t!==n)return null}}return t},doLoadFromTargets:function(e,t){var r=this._getActualModificationNodes(t),i=r.length>=0&&r.length<=1;if(i){var o,n=this._getChargeOfNodes(r);if(this._valueStorage.charge=n,this.getChargeSelector()&&this.getChargeSelector().setValue(n),n){var a=n>0?Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE"):Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE"),s=Kekule.NumUtils.toDecimals(n,1);o=Math.abs(s)+a}else o=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN");this.getWidget().setText(o).setShowText(!0)}this.getWidget().setDisplayed(i)},doApplyToTargets:function(e,t){for(var r,i=this.getChargeSelector().getValue(),o=[],n=this._getActualModificationNodes(t),a=(e=this.getEditor(),0),s=n.length;a<s;++a){var l=n[a];if(l instanceof Kekule.ChemStructureNode){var d=new Kekule.ChemObjOperation.Modify(l,{charge:i},e);d&&o.push(d)}}(r=o.length>1?new Kekule.MacroOperation(o):o[0])&&(e=this.getEditor()).execOperation(r)}});var o=Kekule.Editor.ObjModifierManager;o.register(Kekule.ChemStructureNode,[Kekule.Editor.ObjModifier.Atom]),o.register(Kekule.ChemStructureNode,[Kekule.Editor.ObjModifier.Charge]),o.register([Kekule.Bond,Kekule.StructureFragment],[Kekule.Editor.ObjModifier.Bond])}(),function(){"use strict";var e=Kekule.ObjUtils,t=Kekule.ArrayUtils,r=(Kekule.DomUtils,Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames,Kekule.ChemWidget.HtmlClassNames);Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_GLYPH_PATH_MODIFIER_BUTTON:"K-Chem-Composer-GlyphPathModifier-Button",COMPOSER_Glyph_PATH_MODIFIER_DROPDOWN:"K-Chem-Composer-GlyphPathModifier-DropDown",COMPOSER_GLYPH_REACTION_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-ReactionArrowModifier-Button",COMPOSER_GLYPH_ARC_PATH_MODIFIER_BUTTON:"K-Chem-Composer-ArcPathModifier-Button",COMPOSER_GLYPH_MULTI_ARC_PATH_MODIFIER_BUTTON:"K-Chem-Composer-MultiArcPathModifier-Button",COMPOSER_GLYPH_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-ElectronPushingArrowModifier-Button",COMPOSER_GLYPH_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-BondFormingElectronPushingArrowModifier-Button"}),Kekule.Editor.ObjModifier.GlyphModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.GlyphModifier"}),Kekule.Editor.ObjModifier.GlyphModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.GLYPH]},Kekule.Editor.ObjModifier.GlyphPath=Class.create(Kekule.Editor.ObjModifier.GlyphModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.GlyphPath",MIX_VALUE:"[mixed]",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={}},initProperties:function(){this.defineProp("pathParamSetter",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new Kekule.Widget.DropDownButton(this.getEditor());return e.setHint(this.getModifierHint()),e.setText(this.getModifierCaption()),e.setShowText(!0),e.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),e.addClassName(r.COMPOSER_GLYPH_PATH_MODIFIER_BUTTON+" "+this.getModifierClassName()),e.setDropDownWidgetGetter(this._createPathParamSetter.bind(this)),e},_createPathParamSetter:function(e){e||(e=this.getEditor());var t=new(this.getPathParamSetterClass())(e);t.setCaption(this.getModifierCaption()),t.addClassName(r.COMPOSER_GLYPH_PATH_MODIFIER_DROPDOWN),this.setPropStoreFieldValue("pathParamSetter",t),this._valueStorage.pathParams&&(t.setValue(this._valueStorage.pathParams),this._valueStorage.pathParams=null);var i=this;return t.addEventListener("showStateChange",function(e){e.widget===t&&(e.isShown?i._lastOperation=null:e.isDismissed&&(i._lastOperation&&i._lastOperation.reverse(),i._lastOperation=null))}),t.addEventListener("valueChange",function(e){e.widget===t&&(i.doModification(i.getEditor(),i.getTargetObjs(),!1),i._lastOperation=null,e.stopPropagation())}),t.addEventListener("valueInput",function(e){e.widget===t&&(i.doModification(i.getEditor(),i.getTargetObjs(),!1),e.stopPropagation())}),t},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_GLYPH_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_GLYPH_PATH_MODIFIER")},getModifierClassName:function(){return""},_mergeHashValues:function(r,i){if(!r)return i;if(i){var o=e.getOwnedFieldNames(r,!1),n=e.getOwnedFieldNames(i,!1),a=t.clone(o);if(t.pushUnique(a,n),a.length){for(var s={},l=0,d=a.length;l<d;++l){var u=a[l],c=r[u],p=i[u];s[u]=c===p?c:this.MIX_VALUE}return s}return null}return r},_extractPathParamsOfObjs:function(e){for(var t=null,r=0,i=e.length;r<i;++r){var o=e[r],n=o instanceof Kekule.Glyph.PathGlyphConnector?[o]:o instanceof Kekule.Glyph.PathGlyph?o.getConnectors():null;if(n){var a=this._extractPathParamOfConnectors(n);t=this._mergeHashValues(t,a)}}return t},_extractPathParamOfConnectors:function(e){for(var t=null,r=0,i=e.length;r<i;++r){var o=this._extractPathParamOfConnector(e[r]);o&&(t=this._mergeHashValues(t,o))}return t},_extractPathParamOfConnector:function(e){return e.getPathParams&&e.getPathParams()},getApplicableGlyphClasses:function(){return[Kekule.Glyph.PathGlyph]},isApplicableGlyph:function(e){if(this.getTargetPathGlyph(e)){var t=this.getApplicableGlyphClasses();if(t){for(var r=0,i=t.length;r<i;++r)if(e instanceof t[r])return!0;return!1}return!0}return!1},getTargetPathGlyph:function(e){return e instanceof Kekule.Glyph.PathGlyph?e:e instanceof Kekule.Glyph.PathGlyphConnector?e.getParent():null},_getActualModificationObjs:function(e){for(var r=[],i=0,o=e.length;i<o;++i){var n=e[i];this.isApplicableGlyph(n)&&t.pushUnique(r,n)}return r},_getActualModificationConnectors:function(e){for(var r=[],i=this._getActualModificationObjs(e),o=0,n=i.length;o<n;++o){var a=i[o];a instanceof Kekule.Glyph.PathGlyphConnector?r.push(a):a instanceof Kekule.Glyph.PathGlyph&&t.pushUnique(r,a.getConnectors())}return r},_getActualModificationGlyphs:function(e){for(var r=[],i=this._getActualModificationObjs(e),o=0,n=i.length;o<n;++o){var a=i[o],s=this.getTargetPathGlyph(a);s&&t.pushUnique(r,s)}return r},_filterAppliableParams:function(t){for(var r={},i=e.getOwnedFieldNames(t),o=0,n=i.length;o<n;++o){var a=t[i[o]];void 0!==a&&a!==this.MIX_VALUE&&(r[i[o]]=a)}return r},_splitPathParamValues:function(t){for(var r={},i=e.getOwnedFieldNames(t),o=0,n=i.length;o<n;++o){var a=i[o];if(!a.startsWith("_")){var s=this._getPathParamFieldCategory(a);r[s]||(r[s]={}),r[s][a]=t[a]}}return r},_getPathParamFieldCategory:function(e){return"connectorParams"},createModificationOperations:function(e,t,r){var i=this._splitPathParamValues(r);return this.doCreateModificationOperations(e,t,i)},doCreateModificationOperations:function(e,t,r){if(r.connectorParams){var i=this._getActualModificationConnectors(t);return this._createModificationOperationsOnConnectors(e,i,r.connectorParams)}return null},updateModificationOperations:function(e,t,r,i){var o,n=this._splitPathParamValues(r);return o=i.length?i:i instanceof Kekule.MacroOperation?i.getChildren():[i],this.doUpdateModificationOperations(e,o,t,n)},doUpdateModificationOperations:function(e,t,r,i){return this._updateModificationOperationsOnConnectors(e,r,i.connectorParams,t),t},_updateModificationOperationsOnConnectors:function(e,t,r,i){for(var o=0,n=i.length;o<n;++o){var a=i[o],s=a.getTarget();s instanceof Kekule.Glyph.PathGlyphConnector&&a instanceof Kekule.ChemObjOperation.ModifyHashProp&&this._updateModificationOperationOnConnector(e,s,a,r)}},_updateModificationOperationOnConnector:function(e,t,r,i){t instanceof Kekule.Glyph.PathGlyphConnector&&r instanceof Kekule.ChemObjOperation.ModifyHashProp&&r.setNewPropValue(i)},_createModificationOperationsOnConnectors:function(e,t,r){for(var i=[],o=0,n=t.length;o<n;++o){var a=t[o];if(a instanceof Kekule.Glyph.PathGlyphConnector){var s=this._createModificationOperationOnConnector(e,a,r);s&&i.push(s)}}return i},_createModificationOperationOnConnector:function(e,t,r){return t instanceof Kekule.Glyph.PathGlyphConnector?new Kekule.ChemObjOperation.ModifyHashProp(t,"pathParams",r,e):null},_createWrapperOperation:function(e){return e&&e.length>1?new Kekule.MacroOperation(e):e[0]},_execModificationOperationInEditor:function(e){var t=!this._lastOperation,r=this.getEditor();r.beginManipulateAndUpdateObject();try{e&&(t?r.execOperation(e):e.execute())}finally{r.endManipulateAndUpdateObject(),this._lastOperation=e}},doModification:function(e,t,r){var i,o=this.getPathParamSetter().getValue();o=this._filterAppliableParams(o),i=this._lastOperation?this.updateModificationOperations(e,t,o,this._lastOperation):this.createModificationOperations(e,t,o);var n=this._createWrapperOperation(i);this._execModificationOperationInEditor(n)},doLoadFromTargets:function(e,t){var r=this._getActualModificationObjs(t),i=r.length>0;if(this._lastOperation=null,i){var o=this._extractPathParamsOfObjs(r);this._valueStorage.pathParams=o;var n=this.getPathParamSetter();n&&n.setValue(o)}this.getWidget().setDisplayed(i)},doApplyToTargets:function(e,t){this.doModification(e,t,!1)}}),Kekule.Editor.ObjModifier.ReactionArrowAndSegmentPath=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.ReactionArrowAndSegmentPath",MIX_VALUE:"[mixed]",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphReactionArrowPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_REACTION_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.StraightLine,Kekule.Glyph.Segment,Kekule.Glyph.ReactionArrow]},_extractPathParamsOfObjs:function(e){for(var t,r=this.tryApplySuper("_extractPathParamsOfObjs",[e]),i=0,o=e.length;i<o;++i){var n=e[i],a=this.getTargetPathGlyph(n);if(a&&a.getReactionType){var s=a.getReactionType();if(t){if(t!==s){t=Kekule.Glyph.ReactionArrowType.CUSTOM;break}}else t=s}}return r.reactionArrowType=t,r},createModificationOperations_OLD:function(e,t,r){var i=[];if(r.reactionArrowType!==this.MIX_VALUE){for(var o=this._getActualModificationGlyphs(t),n=0,a=o.length;n<a;++n){var s=o[n];s.setReactionType?r.reactionArrowType||s instanceof Kekule.Glyph.ReactionArrow&&i.push(new Kekule.ChemObjOperation.ChangeClass(s,Kekule.Glyph.Segment,e)):r.reactionArrowType&&s instanceof Kekule.Glyph.StraightLine&&i.push(new Kekule.ChemObjOperation.ChangeClass(s,Kekule.Glyph.ReactionArrow,e))}i.push(new Kekule.ChemObjOperation.Modify(s,{reactionType:r.reactionArrowType},e))}var l=this.tryApplySuper("createModificationOperations_OLD",[e,t,r])||[];return i=i.concat(l)},doCreateModificationOperations:function(e,t,r){var i=[],o=r.connectorParams;if(o.reactionArrowType!==this.MIX_VALUE){for(var n=this._getActualModificationGlyphs(t),a=0,s=n.length;a<s;++a){var l=n[a];l.setReactionType?o.reactionArrowType||l instanceof Kekule.Glyph.ReactionArrow&&i.push(new Kekule.ChemObjOperation.ChangeClass(l,Kekule.Glyph.Segment,e)):o.reactionArrowType&&l instanceof Kekule.Glyph.StraightLine&&i.push(new Kekule.ChemObjOperation.ChangeClass(l,Kekule.Glyph.ReactionArrow,e))}i.push(new Kekule.ChemObjOperation.Modify(l,{reactionType:o.reactionArrowType},e))}var d=this.tryApplySuper("doCreateModificationOperations",[e,t,r])||[];return i=i.concat(d)}}),Kekule.Editor.ObjModifier.ArcPath=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.ArcPath",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphArcPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_ARC_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_ARC_PATH_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_ARC_PATH_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.Arc]}}),Kekule.Editor.ObjModifier.MultiArcPath=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.MultiArcPath",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphMultiArcPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_MULTI_ARC_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_MULTI_ARC_PATH_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_MULTI_ARC_PATH_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.TwinArc]},_filterAppliableParams:function(e){if(DataType.isArrayValue(e)){for(var t=[],r=0,i=e.length;r<i;++r)t.push(this.tryApplySuper("_filterAppliableParams",[e[r]]));return t}return this.tryApplySuper("_filterAppliableParams",[e])},_buildConnectorGroup:function(e,t){var r,i,o,n=[];t&&(r=new Kekule.MapEx,n.map=r);for(var a=0,s=e.length;a<s;++a)for(var l=e[a],d=l instanceof Kekule.Glyph.PathGlyphConnector?[l]:l instanceof Kekule.Glyph.PathGlyph?l.getConnectors():[],u=0,c=d.length;u<c;++u){var p=d[u];(i=u,o=void 0,o=n[i],o||(o=[],n[i]=o),o).push(p),t&&r.set(p,u)}return n},_extractPathParamsOfObjs:function(e){for(var t=[],r=this._buildConnectorGroup(e),i=0,o=r.length;i<o;++i){var n=r[i]||[],a=this._extractPathParamOfConnectors(n)||null;t.push(a)}return t},_splitPathParamValues:function(t){if(DataType.isArrayValue(t)){for(var r=[],i=0,o=t.length;i<o;++i){var n=this.tryApplySuper("_splitPathParamValues",[t[i]]);if(n)for(var a=e.getOwnedFieldNames(n),s=0,l=a.length;s<l;++s){var d=a[s];r[d]||(r[d]=[]),r[d][i]=n[d]}}return r}return this.tryApplySuper("_splitPathParamValues",[t])},_updateModificationOperationsOnConnectors:function(e,t,r,i){for(var o=this._buildConnectorGroup(t,!0).map,n=0,a=i.length;n<a;++n){var s=i[n],l=s.getTarget();if(l instanceof Kekule.Glyph.PathGlyphConnector&&s instanceof Kekule.ChemObjOperation.ModifyHashProp){var d=o.get(l);d>=0&&this._updateModificationOperationOnConnector(e,l,s,r[d])}}},doCreateModificationOperations:function(e,r,i){var o=[];if(i.connectorParams)for(var n=t.toArray(i.connectorParams),a=this._buildConnectorGroup(r),s=0,l=a.length;s<l;++s){var d=n[s];if(d){var u=a[s]||[],c=this._createModificationOperationsOnConnectors(e,u,d);c&&(o=o.concat(c))}}return o}}),Kekule.Editor.ObjModifier.BaseElectronPushingArrow=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.BaseElectronPushingArrow",getPathParamSetterClass:function(){return null},getModifierCaption:function(){return null},getModifierHint:function(){return null},getModifierClassName:function(){return""},getApplicableGlyphClasses:function(){return[]},_extractPathParamsOfObjs:function(t){for(var r,i=this.tryApplySuper("_extractPathParamsOfObjs",[t]),o=0,n=t.length;o<n;++o){var a=t[o],s=this.getTargetPathGlyph(a);if(s&&s.getElectronCount){var l=s.getElectronCount();if(e.isUnset(r))r=l;else if(r!==l){r=0;break}}}return i.electronCount=r,i},_getPathParamFieldCategory:function(e){return"electronCount"===e?"glyphParams":this.tryApplySuper("_getPathParamFieldCategory",[e])},doCreateModificationOperations:function(e,t,r){var i=this.tryApplySuper("doCreateModificationOperations",[e,t,r])||[];if(r.glyphParams&&r.glyphParams.electronCount)for(var o=this._getActualModificationGlyphs(t),n=0,a=o.length;n<a;++n){var s=o[n];s.hasProperty("electronCount")&&i.push(new Kekule.ChemObjOperation.Modify(s,{electronCount:r.glyphParams.electronCount},e))}return i},doUpdateModificationOperations:function(e,t,r,i){return this.tryApplySuper("doUpdateModificationOperations",[e,t,r,i]),this._updateGlyphModificationOperations(e,t,i),t},_updateGlyphModificationOperations:function(e,t,r){}}),Kekule.Editor.ObjModifier.ElectronPushingArrow=Class.create(Kekule.Editor.ObjModifier.BaseElectronPushingArrow,{CLASS_NAME:"Kekule.Editor.ObjModifier.ElectronPushingArrow",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.ElectronPushingArrow]}}),Kekule.Editor.ObjModifier.BondFormingElectronPushingArrow=Class.create(Kekule.Editor.ObjModifier.MultiArcPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.BondFormingElectronPushingArrow",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.BondFormingElectronPushingArrow]},_extractPathParamsOfObjs:function(t){for(var r,i=this.tryApplySuper("_extractPathParamsOfObjs",[t]),o=0,n=t.length;o<n;++o){var a=t[o],s=this.getTargetPathGlyph(a);if(s&&s.getElectronCount){var l=s.getConnectorCount()||1,d=Math.round((s.getElectronCount()||0)/l);if(e.isUnset(r))(r=d)<=0&&(r=1);else if(r!==d){r=0;break}}}return i.electronCount=r,i},_getPathParamFieldCategory:function(e){return"electronCount"===e?"glyphParams":this.tryApplySuper("_getPathParamFieldCategory",[e])},_filterAppliableParams:function(e){var t=this.tryApplySuper("_filterAppliableParams",[e])||[];return e.electronCount&&(t.electronCount=e.electronCount),t},_splitPathParamValues:function(e){var t=this.tryApplySuper("_splitPathParamValues",[e])||[];return e.electronCount&&(t.glyphParams||(t.glyphParams={}),t.glyphParams.electronCount=e.electronCount),t},doCreateModificationOperations:function(e,t,r){var i=this.tryApplySuper("doCreateModificationOperations",[e,t,r])||[];if(r.glyphParams&&r.glyphParams.electronCount)for(var o=this._getActualModificationGlyphs(t),n=0,a=o.length;n<a;++n){var s=o[n];if(s.hasProperty("electronCount")){var l=s.getConnectorCount()||1,d=Math.round(r.glyphParams.electronCount*l);d<=0&&(d=1),i.push(new Kekule.ChemObjOperation.Modify(s,{electronCount:d},e))}}return i}});var i=Kekule.Editor.ObjModifierManager;i.register([Kekule.Glyph.StraightLine,Kekule.Glyph.PathGlyphConnector],[Kekule.Editor.ObjModifier.ReactionArrowAndSegmentPath]),i.register([Kekule.Glyph.Arc],[Kekule.Editor.ObjModifier.ArcPath]),i.register([Kekule.Glyph.TwinArc],[Kekule.Editor.ObjModifier.MultiArcPath]),i.register([Kekule.Glyph.ElectronPushingArrow],[Kekule.Editor.ObjModifier.ElectronPushingArrow]),i.register([Kekule.Glyph.BondFormingElectronPushingArrow],[Kekule.Editor.ObjModifier.BondFormingElectronPushingArrow])}(),function(){"use strict";var e=Kekule.ErrorLevel;Kekule.IssueCheck={},Kekule.IssueCheck.IssueCode={ERROR_UNKNOWN:0,ERROR_ATOM_VALENCE_ABNORMAL:1101,ERROR_BOND_ORDER_EXCEED:1201};var t=Kekule.IssueCheck.IssueCode;Kekule.IssueCheck.CheckerIds={ATOM_VALENCE:"atomValence",BOND_ORDER:"bondOrder"};var r=Kekule.IssueCheck.CheckerIds;Kekule.IssueCheck.CheckerManager={_checkerMap:{},register:function(e,t){e||(e=ClassEx.getClassName(t));var r=i._checkerMap[e];r&&r.checkerClass===t||(i._checkerMap[e]={checkerClass:t})},unregister:function(e){i._checkerMap[e]=null},getCheckerClass:function(e){var t=i._checkerMap[e];return t&&t.checkerClass},getCheckerInstance:function(e){var t=null,r=i._checkerMap[e];if(r){if(!r.instance){var o=r.checkerClass;r.instance=new o}t=r.instance}return t}};var i=Kekule.IssueCheck.CheckerManager;Kekule.IssueCheck.Executor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.Executor",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("ignoreUnexposedObjs",{dataType:DataType.ARRAY}),this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("durationLimit",{dataType:DataType.NUMBER}),this.defineProp("allFinished",{dataType:DataType.BOOL,setter:null,serializable:!1}),this.defineProp("checkerIds",{dataType:DataType.ARRAY,setter:function(e){for(var t=[],r=Kekule.ArrayUtils.toArray(e),o=0,n=r.length;o<n;++o){var a=i.getCheckerInstance(r[o]);a&&t.push(a)}this.setPropStoreFieldValue("checkers",t)}}),this.defineProp("checkers",{dataType:DataType.ARRAY,serializable:!1,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setIgnoreUnexposedObjs(!0),this.setEnabled(!0)},doFinalize:function(){this.setPropStoreFieldValue("checkers",null),this.tryApplySuper("doFinalize")},execute:function(e,t){if(!this.getEnabled())return null;for(var r=this.getDurationLimit(),i=r&&Date.now()+r,o=this.doPrepareOptions(t),n=new Kekule.MapEx,a=this.getCheckers(),s=[],l=0,d=a.length;l<d;++l)a[l].getEnabled()&&s.push(a[l]);this._getAllObjsNeedCheck(e,e,s,n,o);var u=!0,c=[];for(l=0,d=s.length;l<d;++l){var p=s[l];p.setDeadline(i);var h=n.get(p);if(h&&h.length){var g=p.check(h,e,o);g&&g.length&&(c=c.concat(g)),u=u&&p.getAllFinished()}}return this.setPropStoreFieldValue("allFinished",u),this.invokeEvent("execute",{checkResults:c,allFinished:u}),c},recheck:function(e,t,r,i){var o;if(r){o=[];for(var n=0,a=t.length;n<a;++n)t[n].isChildOf(r)&&o.push(t[n])}else o=t;return o.length?e.check(t,i||{}):null},doPrepareOptions:function(e){return options||{}},_getAllObjsNeedCheck:function(e,t,r,i,o){var n=!this.getIgnoreUnexposedObjs();if(this._isObjExposed(e)||n)for(var a=0,s=t.getChildCount();a<s;++a){var l=t.getChildAt(a);if(this._isObjExposed(l)||n){for(var d=0,u=r.length;d<u;++d){var c=r[d];if(c.applicable(l,e,o)){var p=i.get(c);p?p.push(l):(p=[l],i.set(c,p))}}this._getAllObjsNeedCheck(e,l,r,i,o)}}},_isObjExposed:function(e){return!e.isExposed||e.isExposed()}}),Kekule.IssueCheck.CheckResult=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.CheckResult",DEF_ERROR_CODE:t.UNKNOWN,initialize:function(t,r,i,o,n){this.setPropStoreFieldValue("level",t||e.ERROR),this.setPropStoreFieldValue("code",r||this.DEF_ERROR_CODE),this.setPropStoreFieldValue("data",i),this.setPropStoreFieldValue("targets",o),this.setPropStoreFieldValue("reporter",n),this.tryApplySuper("initialize")},doFinalize:function(){this.setData(null),this.setTargets(null),this.setReporter(null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("level",{dataType:DataType.INT}),this.defineProp("code",{dataType:DataType.INT}),this.defineProp("data",{dataType:DataType.HASH}),this.defineProp("targets",{dataType:DataType.Array,serializable:!1}),this.defineProp("reporter",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("msg",{dataType:DataType.STRING,serializable:!1,setter:null,getter:function(){return this.getMessage()}})},getDataValue:function(e){return(this.getData()||{})[e]},getMessage:function(){return Kekule.$L("ErrorCheckMsg.GENERAL_ERROR_WITH_CODE").format(this.getErrorCode())}}),Kekule.IssueCheck.BaseChecker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.BaseChecker",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("deadline",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("allFinished",{dataType:DataType.BOOL,setter:null,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnabled(!0)},_createReport:function(e,t,r,i,o){return new e(t,r,i,o,this)},applicable:function(e,t,r){return this.doApplicable(e,t,r||{})},doApplicable:function(e,t,r){return!1},check:function(e,t,r){return this.doCheck(e,t,r||{})},doCheck:function(e,t,r){this.setPropStoreFieldValue("allFinished",!1);for(var i=[],o=this.getDeadline()||null,n=!1,a=0,s=e.length;a<s;++a){if(o)if(Date.now()>=o){n=!0;break}var l=this.doCheckOnTarget(e[a],a,e,t,r)||[];i=i.concat(l)}return this.setPropStoreFieldValue("allFinished",!!n),i},doCheckOnTarget:function(e,t,r,i,o){}}),Kekule.IssueCheck.AtomValenceChecker=Class.create(Kekule.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.AtomValenceChecker",initialize:function(){this.tryApplySuper("initialize")},doApplicable:function(e,t,r){return e instanceof Kekule.Atom&&e.isNormalAtom()},doCheckOnTarget:function(e,t,r,i,o){var n=this.checkValence(e);return n?[n]:null},checkValence:function(r){var i=r.getValence(),o=r.getCharge()||0,n=this._getPossibleValences(r.getAtomicNumber(),o);return n.length&&n.indexOf(i)<0?this._createReport(Kekule.IssueCheck.AtomValenceChecker.Result,e.ERROR,t.ERROR_ATOM_VALENCE_ABNORMAL,{currValence:i,possibleValences:n},[r]):null},_getPossibleValences:function(e,t){var r=[],i=Kekule.ValenceUtils.getPossibleMdlValenceInfo(e,t);return i&&i.valences&&!i.unexpectedCharge&&(r=[].concat(i.valences)),r}}),i.register(r.ATOM_VALENCE,Kekule.IssueCheck.AtomValenceChecker),Kekule.IssueCheck.AtomValenceChecker.Result=Class.create(Kekule.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.AtomValenceChecker.Result",DEF_ERROR_CODE:t.ERROR_ATOM_VALENCE_ABNORMAL,getMessage:function(){var e=this.getDataValue("currValence"),t=this.getDataValue("possibleValences"),r=t.length<=1?Kekule.$L("ErrorCheckMsg.ATOM_VALENCE_ERROR_WITH_SUGGEST"):Kekule.$L("ErrorCheckMsg.ATOM_VALENCE_ERROR_WITH_SUGGESTS"),i=this.getTargets()[0],o=(i.getId(),i.getLabel?i.getLabel():i.getSymbol()),n=t.join("/");return r.format(o,e,n)}}),Kekule.IssueCheck.BondOrderChecker=Class.create(Kekule.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker",doApplicable:function(e,t,r){return e instanceof Kekule.Bond&&e.isCovalentBond()},doCheckOnTarget:function(e,t,r,i,o){var n=this.checkBondOrder(e);return n?[n]:null},checkBondOrder:function(r){var i=r.getBondValence&&r.getBondValence();if(i){for(var o=r.getConnectedChemNodes(),n=0,a=0,s=o.length;a<s;++a){var l=this._getAllowedMaxBondOrder(o[a]);l>0&&(!n||l<n)&&(n=l)}if(n&&i>n)return this._createReport(Kekule.IssueCheck.BondOrderChecker.Result,e.ERROR,t.ERROR_BOND_ORDER_EXCEED,{currOrder:i,maxOrder:n},[r])}return null},_getAllowedMaxBondOrder:function(e){var t=0;if(e instanceof Kekule.Atom&&e.isNormalAtom()){var r=e.getValence(),i=Kekule.AtomTypeDataUtil.getAllAtomTypes(e.getAtomicNumber());if(i)for(var o=0,n=i.length;o<n;++o)if(r<=i[o].bondOrderSum){t=i[o].maxBondOrder;break}}return t}}),i.register(r.BOND_ORDER,Kekule.IssueCheck.BondOrderChecker),Kekule.IssueCheck.BondOrderChecker.Result=Class.create(Kekule.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker.Result",DEF_ERROR_CODE:t.ERROR_BOND_ORDER_EXCEED,getMessage:function(){for(var e=this.getDataValue("currOrder"),t=this.getDataValue("maxOrder"),r=this.getTargets()[0].getConnectedChemNodes(),i=[],o=0,n=r.length;o<n;++o){var a=r[o],s=a.getLabel&&a.getLabel();s&&i.push(s)}var l=i.length>1?i.join("-"):null;return l?Kekule.$L("ErrorCheckMsg.BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST").format(l,e,t):Kekule.$L("ErrorCheckMsg.BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST").format(e,t)}})}(),function(){"use strict";Kekule.IssueCheck.IssueCode=Object.extend(Kekule.IssueCheck.IssueCode,{WARNING_NODE_TOO_CLOSE:2101});var e=Kekule.IssueCheck.IssueCode;Kekule.IssueCheck.CheckerIds=Object.extend(Kekule.IssueCheck.CheckerIds,{NODE_DISTANCE_2D:"nodeDistance2D"});var t=Kekule.IssueCheck.CheckerIds,r=Kekule.IssueCheck.CheckerManager,i=Kekule.CoordUtils;Kekule.IssueCheck.ExecutorForEditor=Class.create(Kekule.IssueCheck.Executor,{CLASS_NAME:"Kekule.IssueCheck.ExecutorForEditor",initialize:function(e){this.setPropStoreFieldValue("editor",e),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},doPrepareOptions:function(e){var t=e?Object.create(e):{},r=this.getEditor();return r&&(t.editor=r),t}}),Kekule.IssueCheck.IssueResolver=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.IssueResolver",initialize:function(){this.tryApplySuper("initialize")},createSolutions:function(e,t){return this.doCreateSolutions(e,t)},doCreateSolutions:function(e,t){return[]},_createSolutionInstance:function(e,t,r,i,o){return o||(o=Kekule.IssueCheck.IssueSolution),new o(e,t,r,i)},_getEditorWidget:function(e){return e&&e instanceof Kekule.Editor.BaseEditor?e:null}}),Kekule.IssueCheck.IssueSolution=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.IssueSolution",initialize:function(e,t,r,i){this.setPropStoreFieldValue("issueResult",i),this.setPropStoreFieldValue("title",e),this.setPropStoreFieldValue("description",t),this.setPropStoreFieldValue("operation",r),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("issueResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1}),this.defineProp("title",{dataType:DataType.STRING}),this.defineProp("description",{dataType:DataType.STRING}),this.defineProp("operation",{dataType:"Kekule.Operation",serializable:!1})},doFinalize:function(){var e=this.getOperation();e&&e.finalize(),this.tryApplySuper("doFinalize")}}),Kekule.IssueCheck.ResolverManager={_resolverMap:new Kekule.MapEx,_resolverInstanceMap:new Kekule.MapEx,register:function(e,t){var r=o._resolverMap.get(e);r||(r=[],o._resolverMap.set(e,r)),r.indexOf(t)<0&&r.push(t)},unregister:function(e,t){var r=o._resolverMap.get(e),i=r.indexOf(t);i>=0&&r.splice(i,1)},getResolverClasses:function(e){return o._resolverMap.get(e)||[]},getResolverInstances:function(e){for(var t=[],r=o.getResolverClasses(e),i=0,n=r.length;i<n;++i){var a=r[i],s=o._resolverInstanceMap.get(a);s||(s=new a,o._resolverInstanceMap.set(a,s)),t.push(s)}return t}};var o=Kekule.IssueCheck.ResolverManager;ClassEx.extend(Kekule.IssueCheck.CheckResult,{getResolvers:function(){return o.getResolverInstances(this.getClass())},fetchSolutions:function(e){for(var t=this.getResolvers(),r=[],i=0,o=t.length;i<o;++i){var n=t[i].createSolutions(this,e);n&&n.length&&(r=r.concat(n))}return r}}),Kekule.IssueCheck.BondOrderChecker.Resolver=Class.create(Kekule.IssueCheck.IssueResolver,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker.Resolver",doCreateSolutions:function(e,t){var r=e.getTargets()[0],i=r.getBondOrder(),o=e.getData().maxOrder,n=this._getEditorWidget(t);if(r&&o&&n){var a=new Kekule.ChemObjOperation.Modify(r,{bondOrder:o},n),s=Kekule.$L("ErrorCheckMsg.TITLE_CHANGE_BOND_ORDER_TO").format(o),l=Kekule.$L("ErrorCheckMsg.DESCRIPTION_CHANGE_BOND_ORDER_TO").format(i,o);return[this._createSolutionInstance(s,l,a,e)]}return[]}}),o.register(Kekule.IssueCheck.BondOrderChecker.Result,Kekule.IssueCheck.BondOrderChecker.Resolver),Kekule.IssueCheck.Node2DDistanceChecker=Class.create(Kekule.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.Node2DDistanceChecker",doApplicable:function(e,t,r){return t instanceof Kekule.ChemSpace&&e instanceof Kekule.ChemStructureNode&&(!(e instanceof Kekule.Molecule)||!(e.isExpanded&&e.isExpanded))&&(!e.isExposed||e.isExposed())},doCheckOnTarget:function(e,t,r,i,o){for(var n=[],a=e,s=t+1,l=r.length;s<l;++s){var d=r[s];if(d){var u=this.doCheckDistance(a,d,i,o);u&&n.push(u)}}return n},doCheckDistance:function(t,r,i,o){var n=this._getDistanceRefLength(i)/5,a=o.editor,s=!!a&&a.getAllowCoordBorrow();return this._isNodesDistanceTooClose(t,r,n,s,a)?new Kekule.IssueCheck.Node2DDistanceChecker.Result(Kekule.ErrorLevel.WARNING,e.WARNING_NODE_TOO_CLOSE,null,[t,r],this):null},_getDistanceRefLength:function(e){return e.getDefAutoScaleRefLength()},_getEditor:function(e){return e.editor},_isNodesDistanceTooClose:function(e,t,r,i,o){if(o){var n=o.translateDistance(r,Kekule.Render.CoordSystem.CHEM,Kekule.Render.CoordSystem.SCREEN);return this._isNodesDistanceTooCloseByBound(e,t,r,n,o)}return this._getNodesDistanceByCoord(e,t,i)<distanceThreshold},_getNodesDistanceByCoord:function(e,t,r){var o=e.getAbsCoord2D(r),n=t.getAbsCoord2D(r);return i.getDistance(o,n)},_isNodesDistanceTooCloseByBound:function(e,t,r,o,n){Kekule.Render.BoundShapeType;var a=Kekule.Render.MetaShapeUtils,s=n.getChemObjBounds(e)[0],l=n.getChemObjBounds(t)[0];if(!s||!l)return!1;if(this._isPointOrCircleShape(s)&&this._isPointOrCircleShape(l))return i.getDistance(s.coords[0],l.coords[0])-(s.radius||0)-(s.radius||0)<o;if(this._isPointOrCircleShape(s)||this._isPointOrCircleShape(l)){var d=this._isPointOrCircleShape(s),u=d?s.coords[0]:l.coords[0],c=d?s.radius||0:l.radius||0,p=d?l:s,h=a.inflateShape(p,o);return a.getDistance(u,h)-c<0}for(var g=0,C=s.coords.length;g<C;++g){var _=s.coords[g];if(a.isCoordInside(_,l))return!0}for(g=0,C=l.coords.length;g<C;++g){_=l.coords[g];if(a.isCoordInside(_,s))return!0}return!1},_isPointOrCircleShape:function(e){var t=Kekule.Render.BoundShapeType;return e.shapeType===t.POINT||e.shapeType===t.CIRCLE}}),r.register(t.NODE_DISTANCE_2D,Kekule.IssueCheck.Node2DDistanceChecker),Kekule.IssueCheck.Node2DDistanceChecker.Result=Class.create(Kekule.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.NodeDistanceChecker.Result",DEF_ERROR_CODE:e.WARNING_NODE_TOO_CLOSE,getMessage:function(){var e=this.getTargets()[0],t=this.getTargets()[1],r=e.getLabel&&e.getLabel()||e.getId&&e.getId(),i=t.getLabel&&t.getLabel()||t.getId&&t.getId();return r&&r?Kekule.$L("ErrorCheckMsg.NODE_DISTANCE_TOO_CLOSE_WITH_LABEL").format(r+"/"+i):Kekule.$L("ErrorCheckMsg.NODE_DISTANCE_TOO_CLOSE")}}),Kekule.IssueCheck.Node2DDistanceChecker.Resolver=Class.create(Kekule.IssueCheck.IssueResolver,{CLASS_NAME:"Kekule.IssueCheck.Node2DDistanceChecker.Resolver",doCreateSolutions:function(e,t){var r=e.getTargets()[0],i=e.getTargets()[1],o=r.getLabel&&r.getLabel(),n=i.getLabel&&i.getLabel(),a=o===n;if(!o||a){var s=r.getId&&r.getId();s&&(o=o?o+"("+s+")":s)}if(!o||a){var l=i.getId&&i.getId();l&&(n=n?n+"("+l+")":l)}var d=this._getEditorWidget(t),u=[];if(r&&i&&d){var c=d.getEditorConfigs().getInteractionConfigs().getEnableStructFragmentMerge(),p=d.getEditorConfigs().getInteractionConfigs().getEnableNeighborNodeMerge();if(Kekule.ChemStructOperation.MergeNodes.canMerge(r,i,c,p)){var h=new Kekule.ChemStructOperation.MergeNodes(r,i,c,d);u.push(this._createSolutionInstance(Kekule.$L("ErrorCheckMsg.TITLE_MERGE_TO").format(o,n),Kekule.$L("ErrorCheckMsg.DESCRIPTION_MERGE_TO").format(o,n),h,e))}if(Kekule.ChemStructOperation.MergeNodes.canMerge(i,r,c,p)){h=new Kekule.ChemStructOperation.MergeNodes(i,r,c,d);u.push(this._createSolutionInstance(Kekule.$L("ErrorCheckMsg.TITLE_MERGE_TO").format(n,o),Kekule.$L("ErrorCheckMsg.DESCRIPTION_MERGE_TO").format(n,o),h,e))}}return u}}),o.register(Kekule.IssueCheck.Node2DDistanceChecker.Result,Kekule.IssueCheck.Node2DDistanceChecker.Resolver)}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,r=Kekule.Widget.HtmlClassNames,i=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHECK_RESULT_LIST_VIEW:"K-Chem-CheckResultListView",CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED:"K-Chem-CheckResultListView-SolutionEnabled",CHECK_RESULT_LIST_VIEW_ITEM:"K-Chem-CheckResultListView-Item",CHECK_RESULT_LIST_VIEW_ITEM_BODY:"K-Chem-CheckResultListView-ItemBody",CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_SECTION:"K-Chem-CheckResultListView-Item-SolutionSection",CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_WIDGET:"K-Chem-CheckResultListView-Item-SolutionWidget",ISSUE_INSPECTOR:"K-Chem-IssueInspector",ISSUE_INSPECTOR_FLEX_LAYOUT:"K-Chem-IssueInspector-Flex-Layout",ISSUE_INSPECTOR_SUBPART:"K-Chem-IssueInspector-SubPart",ISSUE_INSPECTOR_LIST_PANEL:"K-Chem-IssueInspector-ListPanel"}),Kekule.ChemWidget.CheckResultListView=Class.create(Kekule.Widget.ListView,{CLASS_NAME:"Kekule.ChemWidget.CheckResultListView",initProperties:function(){this.defineProp("checkResults",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("checkResults",e),this._updateListView()}}),this.defineProp("selectedCheckResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1,setter:null,getter:function(){var e,t=this.getSelectedItem();return t&&(e=this.getItemData(t).checkResult),e}}),this.defineProp("enableIssueSolutions",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this.getEnableIssueSolutions()!==t&&(this.setPropStoreFieldValue("enableIssueSolutions",t),t?this.addClassName(i.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED):this.removeClassName(i.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED))}}),this.defineProp("resolverCaller",{dataType:DataType.OBJECT,serialiazable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!0).setEnableMultiSelect(!1).setLayout(Kekule.Widget.Layout.VERTICAL)},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+i.CHECK_RESULT_LIST_VIEW;return e+=" "+this._getSolutionEnableRelatedClassName()},getItemClassName:function(){return this.tryApplySuper("getItemClassName")+" "+i.CHECK_RESULT_LIST_VIEW_ITEM},_getSolutionEnableRelatedClassName:function(){return this.getEnableIssueSolutions()?i.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED:""},selectionChanged:function(e,t){var r=this.tryApplySuper("selectionChanged",[e,t]);if(e&&this.getEnableIssueSolutions())for(var i=0,o=e.length;i<o;++i){var n=e[i],a=this.getItemData(n);a.solutions||(a.solutions=a.checkResult.fetchSolutions(this.getResolverCaller()),a.solutions&&this.doFillSolutionSection(n,a.solutions))}return r},createChildItem:function(e){var t;return t=e instanceof Kekule.IssueCheck.CheckResult?this._wrapCheckResultToItemData(e):e,this.tryApplySuper("createChildItem",[t])},doCreateChildItem:function(e){var t=this.getDocument(),r=t.createElement("li"),o=t.createElement("span");o.className=i.CHECK_RESULT_LIST_VIEW_ITEM_BODY,r.appendChild(o);var n=t.createElement("span");return n.className=i.CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_SECTION,r._solutionSecElem=n,r.appendChild(n),r},doFillSolutionSection:function(t,r){if(r&&this.getEnableIssueSolutions())for(var i=this.getDocument(),o=0,n=r.length;o<n;++o){this.doCreateSolutionWidget(i,r[o],t).appendToElem(t._solutionSecElem)}else e.clearChildContent(t._solutionSecElem)},doCreateSolutionWidget:function(e,t,r){var o=this,n=new Kekule.Widget.Button(this);return n.addClassName(i.CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_WIDGET),n.setText(t.getTitle()).setHint(t.getDescription()),n.addEventListener("execute",function(e){o.getEnableIssueSolutions()&&o.invokeEvent("resolveIssue",{solution:t,issueResult:t.getIssueResult()})}),n},setItemData:function(e,t){var r;r=t instanceof Kekule.IssueCheck.CheckResult?this._wrapCheckResultToItemData(t):t,this.tryApplySuper("setItemData",[e,r])},doSetItemData:function(r,o){var n=this.getItemData(r);if(n&&n.className&&t.removeClass(r,n.className),o){var a=o;a.text&&e.setElementText(r.getElementsByClassName(i.CHECK_RESULT_LIST_VIEW_ITEM_BODY)[0],a.text),a.hint&&r.setAttribute("title",a.hint),a.className&&t.addClass(r,a.className),this.doFillSolutionSection(r,a.solutions)}},_wrapCheckResultToItemData:function(e){var t=e.getMessage();return{text:t,hint:t,className:this._getErrorLevelHtmlClass(e.getLevel()),checkResult:e,solutions:null}},_updateListView:function(){for(var e=this.getItems(),t=e.length,r=this.getCheckResults()||[],i=r.length,o=0;o<i;++o)o<t?this.setItemData(e[o],r[o]):this.appendItem(r[o]);if(t>i)for(o=t-1;o>=i;--o){var n=e[o];this.removeItem(n)}},_getErrorLevelHtmlClass:function(e){var t=Kekule.ErrorLevel;return e===t.LOG||e===t.NOTE?r.MSG_INFO:e===t.WARNING?r.MSG_WARNING:r.MSG_ERROR}}),Kekule.Editor.IssueInspector=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Editor.IssueInspector",initialize:function(e){this._reactExecutorExecuteBind=this._reactExecutorExecute.bind(this),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("issueCheckExecutor",{dataType:"Kekule.IssueCheck.Executor",serializable:!1,setter:function(e){var t=this.getIssueCheckExecutor();e!==t&&(this.setPropStoreFieldValue("issueCheckExecutor",e),this._issueCheckExecutorChanged(t,e))}}),this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("checkResults",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getResultListView().getCheckResults()},setter:function(e){this.getResultListView().setCheckResults(e)}}),this.defineProp("selectedResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1,setter:null,getter:function(){return this.getResultListView().getSelectedResult()}}),this.defineProp("enableIssueSolutions",{dataType:DataType.BOOL,getter:function(){return this.getResultListView().getEnableIssueSolutions()},setter:function(e){this.getResultListView().setEnableIssueSolutions(e)}}),this.defineProp("resultListView",{dataType:"Kekule.ChemWidget.CheckResultListView",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("resolverCaller",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getResultListView().getResolverCaller()},setter:function(e){this.getResultListView().setResolverCaller(e)}})},doFinalize:function(){this._finalizeChildWidgets(),this.tryApplySuper("doFinalize")},_finalizeChildWidgets:function(){var e=this.getResultListView();e&&e.finalize(),this.setPropStoreFieldValue("resultListView",null)},_isUsingFlexLayout:function(){return!!Kekule.BrowserFeature.cssFlex},doGetWidgetClassName:function(){var e=i.ISSUE_INSPECTOR;return this._isUsingFlexLayout()&&(e+=" "+i.ISSUE_INSPECTOR_FLEX_LAYOUT),e},getChildrenHolderElement:function(){return this._listPanelElem||this.tryApplySuper("getChildrenHolderElement")},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,r){var o=this.tryApplySuper("doCreateSubElements",[e,r])||[],n=this._createSubPartElem(e);return t.addClass(n,i.ISSUE_INSPECTOR_LIST_PANEL),this._listPanelElem=n,r.appendChild(n),o.push(n),this._createChildWidgets(),o},_createSubPartElem:function(e){var t=e.createElement("div");return t.className=i.ISSUE_INSPECTOR_SUBPART,t},_createChildWidgets:function(){this._finalizeChildWidgets();var e=new Kekule.ChemWidget.CheckResultListView(this);e.setUseCornerDecoration(!0),e.appendToElem(this._listPanelElem);var t=this;e.addEventListener("selectionChange",function(r){if(r.target===e){var i,o=r.selectedItem;o&&(i=e.getItemData(o).checkResult),t.invokeEvent("selectResult",{selectedResult:i})}}),this.setPropStoreFieldValue("resultListView",e)},_issueCheckExecutorChanged:function(e,t){e&&e.removeEventListener("execute",this._reactExecutorExecuteBind),t&&t.addEventListener("execute",this._reactExecutorExecuteBind)},_reactExecutorExecute:function(e){this.setCheckResults(e.checkResults)},deselect:function(){this.getResultListView().clearSelection()}})}(),function(){"use strict";var e=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.ChemIdEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemIdEditor",getAttributes:function(){var t=this.tryApplySuper("getAttributes");return t&e.MULTIOBJS&&(t^=e.MULTIOBJS),t}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemIdEditor,null,Kekule.ChemObject,"id"),Kekule.PropertyEditor.ChemCoordSizeFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordSizeFieldEditor",initProperties:function(){this.defineProp("parentObjects",{dataType:DataType.Object,serializable:!1}),this.defineProp("parentPropName",{dataType:DataType.STRING,serializable:!1})},getCoordFieldValue:function(e,t,r){if(e.length){var i=e[0].getPropValue(t);if(i){for(var o=i[r],n=1,a=e.length;n<a;++n){if(e[n].getPropValue(t)[r]!==o)return}return o}}},getValue:function(){var e=this.getParentObjects(),t=this.getParentPropName();return e&&t?this.getCoordFieldValue(e,t,this.getPropertyName()):this.tryApplySuper("getValue")}}),Kekule.PropertyEditor.ChemCoordEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordEditor",is3DCoord:function(){return this.getPropertyName().indexOf("3")>=0},getFieldEditorClass:function(e,t){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function(e,t){var r=this.tryApplySuper("createFieldEditor",[e,t]);return r.setParentObjects&&r.setParentObjects(this.getObjects()),r.setParentPropName&&r.setParentPropName(this.getPropertyName()),r},getFieldValueType:function(e,t){return DataType.FLOAT},getObjFields:function(e){return this.is3DCoord()?["x","y","z"]:["x","y"]},getValueText:function(){var e=Kekule.Widget.ValueListEditor.ValueDisplayMode;if(this.getValueTextMode()===e.JSON)return this.tryApplySuper("getValueText");var t=this.getValue();if(t){for(var r=this.getObjFields(),i="",o=0,n=r.length;o<n;++o){var a=t[r[o]];Kekule.ObjUtils.notUnset(a)&&(i&&(i+=", "),i+=r[o]+": "+a)}return"{"+i+"}"}return""}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord2D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord3D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord2D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord3D"),Kekule.PropertyEditor.ChemSizeEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemSizeEditor",is3DSize:function(){return this.getPropertyName().indexOf("3")>=0},getFieldEditorClass:function(e,t){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function(e,t){var r=this.tryApplySuper("createFieldEditor",[e,t]);return r.setParentObjects&&r.setParentObjects(this.getObjects()),r.setParentPropName&&r.setParentPropName(this.getPropertyName()),r},getFieldValueType:function(e,t){return DataType.FLOAT},getObjFields:function(e){return this.is3DSize()?["x","y","z"]:["x","y"]},getValueText:function(){var e=Kekule.Widget.ValueListEditor.ValueDisplayMode;if(this.getValueTextMode()===e.JSON)return this.tryApplySuper("getValueText");var t=this.getValue();if(t){for(var r=this.getObjFields(),i="",o=0,n=r.length;o<n;++o){var a=t[r[o]];Kekule.ObjUtils.notUnset(a)&&(i&&(i+=", "),i+=r[o]+": "+a)}return"{"+i+"}"}return""}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size2D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size3D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"screenSize"),Kekule.PropertyEditor.ChemOptionObjectEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemOptionObjectEditor",CHILD_FIELD_INFOS:null,initialize:function(){this.tryApplySuper("initialize"),this.setAllowEmpty(!0)},getObjFieldInfos:function(e){for(var t=ClassEx.getCommonSuperClass(this.getObjects()),r=[],i=this.CHILD_FIELD_INFOS,o=0,n=i.length;o<n;++o){var a=i[o];a.targetClass&&t&&!ClassEx.isOrIsDescendantOf(t,a.targetClass)||r.push(a)}return r.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),r},notifyChildEditorValueChange:function(e,t){var r=this.getValue()||this._initialObjValue;r=Object.extend({},r),Kekule.ObjUtils.notUnset(t)?r[e]=t:delete r[e],this.setValue(r)}}),Kekule.PropertyEditor.ChemRender2DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender2DOptionsEditor",CHILD_FIELD_INFOS:Kekule.Render.RenderOptionUtils.getOptionDefinitions()}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender2DOptionsEditor,null,Kekule.ChemObject,"renderOptions"),Kekule.PropertyEditor.ChemRender3DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender3DOptionsEditor",CHILD_FIELD_INFOS:Kekule.Render.Render3DOptionUtils.getOptionDefinitions()}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender3DOptionsEditor,null,Kekule.ChemObject,"render3DOptions"),Kekule.PropertyEditor.GlyphPathParamsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathParamsEditor",CHILD_FIELD_INFOS:[{name:"lineCount",dataType:DataType.INT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"lineGap",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowType",dataType:DataType.STRING,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowType",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector}]}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.GlyphPathParamsEditor,null,Kekule.Glyph.PathGlyphConnector,"pathParams"),Kekule.PropertyEditor.GlyphPathNodeParamsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathNodeParamsEditor",CHILD_FIELD_INFOS:[{name:"useStickingOffset",dataType:DataType.BOOL,targetClass:Kekule.Glyph.PathGlyphNode},{name:"stickingOffsetRelLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphNode}]}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.GlyphPathNodeParamsEditor,null,Kekule.Glyph.PathGlyphNode,"pathNodeParams")}(),function(){Class.PropertyScope;var e=Kekule.ArrayUtils,t=(Kekule.ChemWidget,Kekule.Editor,Kekule.Widget.HtmlClassNames),r=Kekule.ChemWidget.HtmlClassNames,i=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER:"K-Chem-Composer",COMPOSER_GRID_LAYOUT:"K-Chem-Composer-Grid-Layout",COMPOSER_LANDSCAPE:"K-Chem-Composer-Landscape",COMPOSER_PORTRAIT:"K-Chem-Composer-Portrait",COMPOSER_EDITOR_STAGE:"K-Chem-Composer-Editor-Stage",COMPOSER_ADV_PANEL:"K-Chem-Composer-Adv-Panel",COMPOSER_ISSUE_PANEL:"K-Chem-Composer-Issue-Panel",COMPOSER_ISSUE_PANEL_WRAPPER:"K-Chem-Composer-Issue-Panel-Wrapper",COMPOSER_ISSUE_PANEL_TOOL_PANEL:"K-Chem-Composer-Issue-Panel-ToolPanel",COMPOSER_ISSUE_PANEL_INSPECTOR_REGION:"K-Chem-Composer-Issue-Panel-InspectorRegion",COMPOSER_TOP_REGION:"K-Chem-Composer-Top-Region",COMPOSER_LEFT_REGION:"K-Chem-Composer-Left-Region",COMPOSER_BOTTOM_REGION:"K-Chem-Composer-Bottom-Region",COMPOSER_TOOLBAR:"K-Chem-Composer-Toolbar",COMPOSER_COMMON_TOOLBAR:"K-Chem-Composer-Common-Toolbar",COMPOSER_ZOOM_TOOLBAR:"K-Chem-Composer-Zoom-Toolbar",COMPOSER_CHEM_TOOLBAR:"K-Chem-Composer-Chem-Toolbar",COMPOSER_ASSOC_TOOLBAR:"K-Chem-Composer-Assoc-Toolbar",COMPOSER_STYLE_TOOLBAR:"K-Chem-Composer-Style-Toolbar",COMPOSER_OBJMODIFIER_TOOLBAR:"K-Chem-Composer-ObjModifier-Toolbar",COMPOSER_FONTNAME_BOX:"K-Chem-Composer-FontName-Box",COMPOSER_FONTSIZE_BOX:"K-Chem-Composer-FontSize-Box",COMPOSER_NODEDISPLAYMODE_BOX:"K-Chem-Composer-NodeDisplayMode-Box",COMPOSER_COLOR_BOX:"K-Chem-Composer-Color-Box",COMPOSER_TEXTDIRECTION_BUTTON:"K-Chem-Composer-TextDirection-Button",COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT:"K-Chem-Composer-TextDirection-Button-Default",COMPOSER_TEXTDIRECTION_BUTTON_LTR:"K-Chem-Composer-TextDirection-Button-LTR",COMPOSER_TEXTDIRECTION_BUTTON_RTL:"K-Chem-Composer-TextDirection-Button-RTL",COMPOSER_TEXTDIRECTION_BUTTON_TTB:"K-Chem-Composer-TextDirection-Button-TTB",COMPOSER_TEXTDIRECTION_BUTTON_BTT:"K-Chem-Composer-TextDirection-Button-BTT",COMPOSER_TEXTALIGN_BUTTON:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL:"K-Chem-Composer-TextAlign-Button-Horizontal",COMPOSER_TEXTALIGN_BUTTON_VERTICAL:"K-Chem-Composer-TextAlign-Button-Vertical",COMPOSER_TEXTALIGN_BUTTON_DEFAULT:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_LEADING:"K-Chem-Composer-TextAlign-Button-Leading",COMPOSER_TEXTALIGN_BUTTON_TRAILING:"K-Chem-Composer-TextAlign-Button-Trailing",COMPOSER_TEXTALIGN_BUTTON_CENTER:"K-Chem-Composer-TextAlign-Button-Center",COMPOSER_TEXTALIGN_BUTTON_LEFT:"K-Chem-Composer-TextAlign-Button-Left",COMPOSER_TEXTALIGN_BUTTON_RIGHT:"K-Chem-Composer-TextAlign-Right",COMPOSER_TEXTALIGN_BUTTON_TOP:"K-Chem-Composer-TextAlign-Top",COMPOSER_TEXTALIGN_BUTTON_BOTTOM:"K-Chem-Composer-TextAlign-Bottom",COMPOSER_DIALOG:"K-Chem-ComposerDialog",COMPOSER_FRAME:"K-Chem-ComposerFrame",COMPOSER_FRAME_CONTENT_DOC:"K-Chem-ComposerFrame-ContentDoc",COMPOSER_FRAME_CONTENT_BODY:"K-Chem-ComposerFrame-ContentBody"}),Kekule.globalOptions.add("chemWidget.composer",{commonToolButtons:[i.newDoc,i.loadData,i.saveData,i.undo,i.redo,i.copy,i.cut,i.paste,i.zoomIn,i.zoomOut,i.config,i.objInspector],chemToolButtons:[i.manipulate,i.erase,i.molBond,i.molAtomAndFormula,i.molRing,i.molCharge,i.glyph,i.textImage],styleToolComponentNames:[i.fontName,i.fontSize,i.color,i.textDirection,i.textAlign]}),Kekule.Editor.ComposerStyleToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerStyleToolbar",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:Kekule.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:t.COLORPICKER_SPEC_COLOR_MIXED},LINKED_VALUE_FIELD:"__$value__",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("composer",e),this.createChildWidgets(),this.appendToWidget(e),this._relatedPropNames=e.getCoordMode()===Kekule.CoordMode.COORD3D?["renderOptions","render3DOptions"]:["renderOptions"],this.getEditor().addEventListener("selectionChange",function(e){this._isApplying||this.updateStyleValues()},this),this.getEditor().addEventListener("editObjChanged",function(e){var t=e.propNames;t&&t.length&&Kekule.ArrayUtils.intersect(this._relatedPropNames,t).length&&(this._isApplying||this.updateStyleValues())},this),this._isApplying=!1},doFinalize:function(){this.clearWidgets(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("fontNameBox",{dataType:"Kekule.Widget.ComboBox",serializable:!1,setter:null}),this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.ComboBox",serializable:!1,setter:null}),this.defineProp("colorBox",{dataType:"Kekule.Widget.ColorDropButton",serializable:!1,setter:null}),this.defineProp("textDirectionButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("textHorizontalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("textVerticalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("fontName",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getFontNameBox()?this.getFontNameBox().getValue():null},setter:function(e){this.getFontNameBox()&&this.getFontNameBox().setValue(e)}}),this.defineProp("fontSize",{dataType:DataType.NUMBER,serializable:!1,getter:function(){return this.getFontSizeBox()?parseFloat(this.getFontSizeBox().getValue()):null},setter:function(e){this.getFontSizeBox()&&this.getFontSizeBox().setValue(e)}}),this.defineProp("color",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getColorBox()?this.getColorBox().getValue():void 0},setter:function(e){this.getColorBox()&&this.getColorBox().setValue(e)}}),this.defineProp("textDirection",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextDirectionButtonSet())},setter:function(e){this._setButtonSetLinkedValue(this.getTextDirectionButtonSet(),e)}}),this.defineProp("textHorizontalAlign",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet())},setter:function(e){this._setButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet(),e)}}),this.defineProp("textVerticalAlign",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextVerticalAlignButtonSet())},setter:function(e){this._setButtonSetLinkedValue(this.getTextVerticalAlignButtonSet(),e)}}),this.defineProp("componentNames",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("componentNames");return e||(e=this.getDefaultComponentNames(),this.setPropStoreFieldValue("componentNames",e)),e},setter:function(e){this.setPropStoreFieldValue("componentNames",e),this.recreateComponents()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowGlyph(!0)},removeWidget:function(e,t){e===this.getFontNameBox()&&this.setPropStoreFieldValue("fontNameBox",null),e===this.getFontSizeBox()&&this.setPropStoreFieldValue("fontSizeBox",null),e===this.getColorBox()&&this.setPropStoreFieldValue("colorBox",null),e===this.getTextDirectionButtonSet()&&this.setPropStoreFieldValue("textDirectionButtonSet",null),e===this.getTextHorizontalAlignButtonSet()&&this.setPropStoreFieldValue("textHorizontalAlignButtonSet",null),e===this.getTextVerticalAlignButtonSet()&&this.setPropStoreFieldValue("textVerticalAlignButtonSet",null),this.tryApplySuper("removeWidget",[e,t])},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_TOOLBAR+" "+r.COMPOSER_STYLE_TOOLBAR},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},createChildWidgets:function(e){e||(e=this.getComponentNames());for(var t=0,o=e.length;t<o;++t){var n=e[t];if(n===i.fontName){var a=new Kekule.Widget.ComboBox(this);this.fillFontNameBox(a),a.addClassName(r.COMPOSER_FONTNAME_BOX),a.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME")),a.addEventListener("valueChange",function(e){this.applyFontName()},this),this.setPropStoreFieldValue("fontNameBox",a)}else if(n===i.fontSize)a=new Kekule.Widget.ComboBox(this),this.fillFontSizeBox(a),a.addClassName(r.COMPOSER_FONTSIZE_BOX),a.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE")),a.addEventListener("valueChange",function(e){this.applyFontSize()},this),this.setPropStoreFieldValue("fontSizeBox",a);else if(n===i.color){var s=new Kekule.Widget.ColorDropButton(this);s.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR")),s.setShowText(!1),s.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]),s.addClassName(r.COMPOSER_COLOR_BOX),s.addEventListener("valueChange",function(e){this.applyColor()},this),this.setPropStoreFieldValue("colorBox",s)}else if(n===i.textDirection){var l=Kekule.Render.TextDirection,d=[{value:l.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT},{value:l.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_LTR},{value:l.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_RTL},{value:l.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_TTB},{value:l.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_BTT}];(c=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION"),r.COMPOSER_TEXTDIRECTION_BUTTON,d)).addEventListener("select",function(e){this.applyTextDirection()},this),this.setPropStoreFieldValue("textDirectionButtonSet",c)}else if(n===i.textAlign){d=[{value:(u=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:r.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:u.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:r.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:u.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:r.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:u.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:r.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:u.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT"),className:r.COMPOSER_TEXTALIGN_BUTTON_LEFT},{value:u.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT"),className:r.COMPOSER_TEXTALIGN_BUTTON_RIGHT}];(c=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN"),r.COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL,d)).addEventListener("select",function(e){this.applyTextHorizontalAlign()},this),this.setPropStoreFieldValue("textHorizontalAlignButtonSet",c);var u,c;d=[{value:(u=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:r.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:u.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:r.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:u.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:r.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:u.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:r.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:u.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP"),className:r.COMPOSER_TEXTALIGN_BUTTON_TOP},{value:u.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM"),className:r.COMPOSER_TEXTALIGN_BUTTON_BOTTOM}];(c=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN"),r.COMPOSER_TEXTALIGN_BUTTON_VERTICAL,d)).addEventListener("select",function(e){this.applyTextVerticalAlign()},this),this.setPropStoreFieldValue("textVerticalAlignButtonSet",c)}}this.updateStyleValues()},_createStyleButtonSet:function(e,t,i,o){var n=new Kekule.Widget.CompactButtonSet(this);if(n.setText(e),n.setHint(t),n.addClassName(i),n.setShowText(!1),n.setShowCompactMark(!1),n.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),n.getButtonSet().addClassName(r.COMPOSER_STYLE_TOOLBAR),n.getButtonSet().setShowText(!0),o)for(var a=0,s=o.length;a<s;++a){var l=o[a],d=new Kekule.Widget.RadioButton(n,l.text||"");d.setHint(l.hint||""),d.addClassName(l.className),d[this.LINKED_VALUE_FIELD]=l.value,n.append(d,l.selected)}return n},_getButtonSetLinkedValue:function(e){var t=e?e.getSelected():null;return t?t[this.LINKED_VALUE_FIELD]:void 0},_setButtonSetLinkedValue:function(e,t){if(e){var r=e.getButtonSet().getChildWidgets();e.setSelected(null);for(var i=0,o=r.length;i<o;++i){var n=r[i];if(n.hasOwnProperty(this.LINKED_VALUE_FIELD)&&n[this.LINKED_VALUE_FIELD]==t){e.setSelected(n);break}}}},getDefaultComponentNames:function(){return Kekule.globalOptions.chemWidget.composer.styleToolComponentNames},recreateComponents:function(){var e=this.getComponentNames();this.clearWidgets(),this.createChildWidgets(e)},fillFontSizeBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes(),r=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:void 0}],i=0,o=t.length;i<o;++i)r.push({text:t[i]+" px",value:t[i]});e.setItems(r)},fillFontNameBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames(),r=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}],i=0,o=t.length;i<o;++i)r.push({text:t[i],value:t[i]});e.setItems(r)},applyStyle:function(e,t,r){this._isApplying=!0;try{this.getEditor().modifyObjectsRenderOptions(e,t,r,!0)}finally{this._isApplying=!1}},getStyleValue:function(e,t,r){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(e,t,r)},applyStyleToEditorSelection:function(e,t){var r=this.getEditor().getSelection();if(r&&r.length)return this.applyStyle(r,e,t)},applyFontName:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getFontName();this.applyStyle(e,{fontFamily:t})}},applyFontSize:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getFontSize();this.applyStyle(e,{fontSize:t})}},applyColor:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getColor();t===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value?this.applyStyle(e,{useAtomSpecifiedColor:!0,color:void 0}):(t==Kekule.Widget.ColorPicker.SpecialColors.UNSET&&(t=void 0),this.applyStyle(e,{useAtomSpecifiedColor:!1,color:t}))}},applyTextDirection:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getTextDirection();this.applyStyle(e,{charDirection:t})}},applyTextHorizontalAlign:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getTextHorizontalAlign();this.applyStyle(e,{horizontalAlign:t})}},applyTextVerticalAlign:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getTextVerticalAlign();this.applyStyle(e,{verticalAlign:t})}},updateStyleValues:function(e){e||(e=this.getEditor().getSelection()),e&&e.length&&(this.updateFontName(e),this.updateFontSize(e),this.updateColor(e),this.updateTextDirection(e),this.updateTextHorizontalAlign(e),this.updateTextVerticalAlign(e))},updateFontName:function(e){if(e&&e.length&&this.getFontNameBox()){var t=this.getStyleValue(e,"fontFamily");this.setFontName(t||"")}},updateFontSize:function(e){if(e&&e.length&&this.getFontSizeBox()){var t=this.getStyleValue(e,"fontSize");this.setFontSize(t||void 0)}},updateColor:function(e){if(e&&e.length&&this.getColorBox()){var t=this.getStyleValue(e,"useAtomSpecifiedColor"),r=this.getStyleValue(e,"color");this.getColorBox().setColorClassName(null),r?this.getColorBox().setColorClassName(null):t&&(r=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value,this.getColorBox().setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className)),this.setColor(r||void 0)}},updateTextDirection:function(e){if(e&&e.length&&this.getTextDirectionButtonSet()){var t=this.getStyleValue(e,"charDirection");this.setTextDirection(t)}},updateTextHorizontalAlign:function(e){if(e&&e.length&&this.getTextHorizontalAlignButtonSet()){var t=this.getStyleValue(e,"horizontalAlign");this.setTextHorizontalAlign(t)}},updateTextVerticalAlign:function(e){if(e&&e.length&&this.getTextVerticalAlignButtonSet()){var t=this.getStyleValue(e,"verticalAlign");this.setTextVerticalAlign(t)}},updateState:function(){var e=this.getEditor(),t=e&&e.hasSelection();this.getFontNameBox()&&this.getFontNameBox().setEnabled(t),this.getFontSizeBox()&&this.getFontSizeBox().setEnabled(t),this.getColorBox()&&this.getColorBox().setEnabled(t),this.getTextDirectionButtonSet()&&this.getTextDirectionButtonSet().setEnabled(t),this.getTextHorizontalAlignButtonSet()&&this.getTextHorizontalAlignButtonSet().setEnabled(t),this.getTextVerticalAlignButtonSet()&&this.getTextVerticalAlignButtonSet().setEnabled(t)}}),Kekule.Editor.ComposerObjModifierToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerObjModifierToolbar",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("modifiers",[]),this.setPropStoreFieldValue("modifierMap",new Kekule.MapEx),this.setPropStoreFieldValue("composer",e),this.appendToWidget(e),e.addEventListener("selectionChange",function(e){this._isApplying||this.updateModifierValues()},this),e.addEventListener("selectedObjsUpdated",function(t){this._isApplying||(e.getEditor().isManipulatingObject()?this._suppressUpdateModifierValuesInManipulation=!0:this.updateModifierValues())},this),e.addEventListener("endManipulateObject",function(e){this._suppressUpdateModifierValuesInManipulation&&(this.updateModifierValues(),this._suppressUpdateModifierValuesInManipulation=!1)},this),this._isApplying=!1},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("modifierMap",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("modifiers",{dataType:DataType.ARRAY,serializable:!1,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowGlyph(!0)},doFinalize:function(){this.clearWidgets(),this.getModifierMap().finalize();for(var e=this.getModifiers(),t=0,r=e.length;t<r;++t)e[t].finalize();this.tryApplySuper("doFinalize")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_TOOLBAR+" "+r.COMPOSER_OBJMODIFIER_TOOLBAR},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getAllowedModifierCategories:function(){var e=this.getComposer();return e&&e.getAllowedObjModifierCategories()},getTargetObjs:function(){return this.getEditor().getSelection()},getAvailableModifierClasses:function(){for(var t=[],r=this.getTargetObjs(),i=0,o=r.length;i<o;++i)r[i].getClass&&e.pushUnique(t,r[i].getClass());var n=[],a=this.getAllowedModifierCategories();for(i=0,o=t.length;i<o;++i){var s=Kekule.Editor.ObjModifierManager.getModifierClasses(t[i],a);s&&e.pushUnique(n,s)}return n.length&&n.sort(function(e,t){var r=e&&ClassEx.getPrototype(e),i=t&&ClassEx.getPrototype(t),o=r&&r.getModifierName&&r.getModifierName(),n=i&&i.getModifierName&&i.getModifierName();return o===n?0:o<n?-1:1}),n},getModifierInstanceOfClass:function(e,t){var r=this.getModifierMap(),i=r.get(e);return!i&&t&&(i=new e(this.getEditor()),r.set(e,i)),i},updateModifierWidgets:function(){var e=[];this.clearWidgets(!0);for(var r=this.getAvailableModifierClasses(),i=0,o=r.length;i<o;++i){var n=r[i],a=this.getModifierInstanceOfClass(n,!0),s=a.getWidget();s&&(this.appendWidget(s),e.push(a))}this.setPropStoreFieldValue("modifiers",e),this.updateModifierValues(),this._isAllModifierWidgetButtons(e)?this.removeClassName(t.TOOLBAR).addClassName(t.BUTTON_GROUP):this.removeClassName(t.BUTTON_GROUP).addClassName(t.TOOLBAR)},updateState:function(){this.updateModifierWidgets()},updateModifierValues:function(){for(var e=this.getModifiers(),t=0,r=e.length;t<r;++t)e[t].loadFromTargets()},_isAllModifierWidgetButtons:function(e){for(var t=0,r=e.length;t<r;++t){var i=e[t],o=i&&i.getWidget();if(o&&o.getDisplayed()&&!(o instanceof Kekule.Widget.Button))return!1}return!0}}),Kekule.Editor.Composer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.Composer",BINDABLE_TAG_NAMES:["div"],CHEM_TOOL_CHILD_FIELDS:"__$children__",initialize:function(e,t){this.updateSelectionAssocToolbarStateBind=this.updateSelectionAssocToolbarState.bind(this),this.setPropStoreFieldValue("enableIssueInspectorSolutions",!0),this.setPropStoreFieldValue("enableStyleToolbar",!0),this.setPropStoreFieldValue("enableObjModifierToolbar",!0),this.setPropStoreFieldValue("editor",t),this.setPropStoreFieldValue("editorNexus",new Kekule.Editor.EditorNexus),this.tryApplySuper("initialize",[e]),this.bindEditor(t);var r=this.getEditor();r&&r.setChemObj(r.getChemObj()),this.getCommonBtnGroup()||this.createCommonToolbar(),this.getChemBtnGroup()||this.createChemToolbar(),this.getZoomBtnGroup()||this.createZoomToolbar(),this.uiLayoutChanged()},doFinalize:function(){var e=this.getIssueInspector();e&&e.finalize();var t=this.getStructureTreeView();t&&t.finalize();var r,i=this.getObjInspector();i&&i.finalize(),(r=this.getCommonBtnGroup())&&r.finalize(),(r=this.getChemBtnGroup())&&r.finalize();var o=this.getPropStoreFieldValue("editor");o&&o.finalize(),this.getEditorNexus().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("editor");return e||(e=this.createDefaultEditor(),this.setPropStoreFieldValue("editor",e)),e}}),this.defineProp("autoSetMinDimension",{dataType:DataType.BOOL}),this.defineProp("showObjInspector",{dataType:DataType.BOOL,getter:function(){return(this.getAdvPanelDisplayedComponents()||[]).indexOf("objInspector")>=0},setter:function(t){if(this.getShowObjInspector()!==t){var r=this.getAdvPanelDisplayedComponents()||[];r=t?["objInspector"]:e.exclude(r,"objInspector"),this.setAdvPanelDisplayedComponents(r)}}}),this.defineProp("showIssueInspector",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getAdvPanelDisplayedComponents()||[]).indexOf("issueInspector")>=0},setter:function(t){if(this.getShowIssueInspector()!==t){var r=this.getAdvPanelDisplayedComponents()||[];if(r=t?["issueInspector"]:e.exclude(r,"issueInspector"),this.setAdvPanelDisplayedComponents(r),t){var i=this.getEditor();i&&(i.getEnableAutoIssueCheck()||i.checkIssues(),i.getIssueCheckResults()&&i.getIssueCheckResults().length&&i.deselectAll())}else{this.getIssueInspector().deselect()}}}}),this.defineProp("enableIssueInspectorSolutions",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableIssueInspectorSolutions",!!e),this.getIssueInspector()&&this.getIssueInspector().setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions())}}),this.defineProp("showInspector",{dataType:DataType.BOOL,getter:function(){return this.getShowObjInspector()},setter:function(e){this.setShowObjInspector(e)}}),this.defineProp("advPanelDisplayedComponents",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("advPanelDisplayedComponents",e),this.updateAdvPanelDisplayedComponents(e)}}),this.defineProp("editorStageElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("advPanelElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objInspectorHolderElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("issueInspectorHolderElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("topRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("leftRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("bottomRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("editorNexus",{dataType:"Kekule.Editor.EditorNexus",serializable:!1,setter:null}),this.defineProp("objInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:!1,setter:null}),this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:!1,setter:null}),this.defineProp("issueInspector",{dataType:"Kekule.Editor.IssueInspector",serializable:!1,setter:null}),this.defineProp("commonBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("zoomBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("chemBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("assocBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("styleToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("styleToolbar");return e||this.getEnableStyleToolbar()&&(e=this.createStyleToolbar(),this.setPropStoreFieldValue("styleToolbar",e)),e}}),this.defineProp("styleToolComponentNames",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getStyleToolbar();return e?e.getComponentNames():null},setter:function(e){var t=this.getStyleToolbar();return t&&t.setComponentNames(e),this}}),this.defineProp("enableStyleToolbar",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableStyleToolbar")&&!this.getEnableObjModifierToolbar()},setter:function(e){this.setPropStoreFieldValue("enableStyleToolbar",e),e&&this.setPropStoreFieldValue("enableObjModifierToolbar",!1),this.updateSelectionAssocToolbarState()}}),this.defineProp("objModifierToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("objModifierToolbar");return e||this.getEnableObjModifierToolbar()&&(e=this.createObjModifierToolbar(),this.setPropStoreFieldValue("objModifierToolbar",e)),e}}),this.defineProp("enableObjModifierToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableObjModifierToolbar",e),e&&this.setPropStoreFieldValue("enableStyleToolbar",!1),this.updateSelectionAssocToolbarState()}}),this.defineProp("allowedObjModifierCategories",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("allowedObjModifierCategories",e),this.updateObjModifierToolbarState()}}),this.defineProp("commonToolButtons",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("commonToolButtons");return e||(e=this.getDefaultCommonToolBarButtons(),this.setPropStoreFieldValue("commonToolButtons",e)),e},setter:function(e){this.setPropStoreFieldValue("commonToolButtons",e),this.updateCommonToolbar(),this.updateZoomToolbar()}}),this.defineProp("chemToolButtons",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("chemToolButtons");return e||(e=this.getDefaultChemToolBarButtons(),this.setPropStoreFieldValue("chemToolButtons",e)),e},setter:function(e){this.setPropStoreFieldValue("chemToolButtons",e),this.updateChemToolbar()}}),this.defineProp("styleBarComponents",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("styleBarComponents");return e||(e=null,this.setPropStoreFieldValue("styleBarComponents",e)),e},setter:function(e){this.setPropStoreFieldValue("styleBarComponents",e),this.getStyleToolbar()&&this.getStyleToolbar().setComponentNames(e)}}),this.defineProp("commonActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("commonActions");return e||(e=new Kekule.ActionList,this.setPropStoreFieldValue("commonActions",e)),e}}),this.defineProp("zoomActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("zoomActions");return e||(e=new Kekule.ActionList,this.setPropStoreFieldValue("zoomActions",e)),e}}),this.defineProp("chemActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("chemActions");return e||(e=new Kekule.ActionList,this.setPropStoreFieldValue("chemActions",e)),e}}),this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actionMap");return e||(e=new Kekule.MapEx,this.setPropStoreFieldValue("actionMap",e)),e}}),this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,getter:function(){var e=this.getEditor();return e&&e.getAllowCreateNewChild?e.getAllowCreateNewChild():null},setter:function(e){var t=this.getEditor();return t.setAllowCreateNewChild&&t.setAllowCreateNewChild(e),this}}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL,getter:function(){var e=this.getEditor();return e&&e.getAllowAppendDataToCurr?e.getAllowAppendDataToCurr():null},setter:function(e){var t=this.getEditor();return t.setAllowAppendDataToCurr&&t.setAllowAppendDataToCurr(e),this}}),this._defineEditorDelegatedProp("chemObj"),this._defineEditorDelegatedProp("chemObjData"),this._defineEditorDelegatedProp("chemObjLoaded"),this._defineEditorDelegatedProp("renderType"),this._defineEditorDelegatedProp("renderConfigs"),this._defineEditorDelegatedProp("drawOptions"),this._defineEditorDelegatedProp("allowCoordBorrow"),this._defineEditorDelegatedProp("editorConfigs"),this._defineEditorDelegatedProp("operHistory"),this._defineEditorDelegatedProp("enableOperHistory"),this._defineEditorDelegatedProp("selection"),this._defineEditorDelegatedProp("hotTrackedObjs"),this._defineEditorDelegatedProp("enableOperContext"),this._defineEditorDelegatedProp("enableCreateNewDoc"),this._defineEditorDelegatedProp("enableLoadNewFile"),this._defineEditorDelegatedProp("enableIssueCheck"),this._defineEditorDelegatedProp("enableAutoIssueCheck"),this._defineEditorDelegatedProp("initOnNewDoc")},_defineEditorDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(Kekule.Editor.BaseEditor,t),i=Object.create(r);return i.getter=null,i.setter=null,r.getter&&(i.getter=function(){return this.getEditor().getPropValue(t)}),r.setter&&(i.setter=function(e){this.getEditor().setPropValue(t,e)}),this.defineProp(e,i)},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r)try{var i=Kekule.IO.loadTypedData(t.data,t.resType,t.resUri);this.setChemObj(i)}catch(e){Kekule.raise(e,Kekule.ExceptionLevel.ERROR)}else Kekule.throwException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var i=[],o=this._doCreateSubElement(e,t,"div",r.COMPOSER_EDITOR_STAGE,"editorStageElem");return i.push(o),o=this._doCreateSubElement(e,t,"div",r.COMPOSER_ADV_PANEL,"advPanelElem"),this._doCreateSubElement(e,o,"div",null,"objInspectorHolderElem"),this._doCreateSubElement(e,o,"div",r.COMPOSER_ISSUE_PANEL,"issueInspectorHolderElem"),i.push(o),i.push(this._doCreateSubElement(e,t,"div",r.COMPOSER_TOP_REGION,"topRegionElem")),i.push(this._doCreateSubElement(e,t,"div",r.COMPOSER_LEFT_REGION,"leftRegionElem")),i.push(this._doCreateSubElement(e,t,"div",r.COMPOSER_BOTTOM_REGION,"bottomRegionElem")),i},_doCreateSubElement:function(e,t,r,i,o){var n=e.createElement(r);return i&&(n.className=i),t&&t.appendChild(n),o&&this.setPropStoreFieldValue(o,n),n},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER;return this._isUsingGridLayout()&&(e+=" "+r.COMPOSER_GRID_LAYOUT),e},_isUsingGridLayout:function(){return Kekule.BrowserFeature.cssGrid},elementBound:function(e){this.setObserveElemResize(!0)},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),e&&this.adjustComponentPositions()},getResizerElement:function(){return this.getEditorStageElem()},getChildActionClass:function(e,t){var r=this.tryApplySuper("getChildActionClass",[e,t]);return r||(r=this.getEditor().getChildActionClass(e,t)),r},getCoordMode:function(){return this.getEditor().getCoordMode()},isDirty:function(){return this.getEditor().isDirty()},newDoc:function(){return this.getEditor().newDoc()},load:function(e){return this.getEditor().load(e)},loadFromData:function(e,t,r,i,o){return this.getEditor().loadFromData(e,t,r,i)},loadFromFile:function(e){return this.getEditor().loadFromFile(e)},getSavingTargetObj:function(){var e=this.getEditor();return e?e.getSavingTargetObj():null},getExportableClasses:function(){return this.getEditor().getExportableClasses()},exportObj:function(e){return this.getEditor().exportObj(e)},exportObjs:function(e){return this.getEditor().exportObjs(e)},undo:function(){return this.getEditor().undo()},redo:function(){return this.getEditor().redo()},undoAll:function(){return this.getEditor().undoAll()},canUndo:function(){return this.getEditor().canUndo()},canRedo:function(){return this.getEditor().canRedo()},repaint:function(e){return this.getEditor().repaint(e),this},getBoundEditorAction:function(e){var t;return"string"==typeof e?t=this.getCompActionClass(e):ClassEx.isClass(e)&&(t=e),t?this.getActionMap().get(t):null},execBoundEditorAction:function(e){var t=this.getBoundEditorAction(e);return t&&t.execute(),t},uiLayoutChanged:function(){this.adjustComponentPositions()},doResize:function(){this.adjustComponentPositions()},adjustComponentPositions:function(){var e=this.getCommonBtnGroup()?this.getCommonBtnGroup().getElement():null,t=this.getZoomBtnGroup()?this.getZoomBtnGroup().getElement():null,i=this.getChemBtnGroup()?this.getChemBtnGroup().getElement():null;if(e&&i){if(e)var o=Kekule.HtmlElementUtils.getElemPageRect(e);if(t)var n=Kekule.HtmlElementUtils.getElemPageRect(t);if(i)var a=Kekule.HtmlElementUtils.getElemPageRect(i);if(o.width&&a.width){var s=o.height,l=a.width,d=n&&n.height||s,u=!this._isUsingGridLayout(),c=this.getTopRegionElem(),p=this.getBottomRegionElem(),h=this.getLeftRegionElem(),g=Kekule.HtmlElementUtils.getElemPageRect(this.getElement()),C=(Kekule.HtmlElementUtils.getElemPageRect(c),Kekule.HtmlElementUtils.getElemPageRect(p).width-(n?n.width:0)),_=Kekule.HtmlElementUtils.getElemPageRect(h).height-a.height,m=g.width;if(.85*g.height>m?(this.removeClassName(r.COMPOSER_LANDSCAPE),this.addClassName(r.COMPOSER_PORTRAIT)):(this.addClassName(r.COMPOSER_LANDSCAPE),this.removeClassName(r.COMPOSER_PORTRAIT)),u){(S=c.style).top="0px",S.left=l+"px",S.right="0px",S.height=s+"px",(S=p.style).bottom="0px",S.height=d+"px",S.left=l+"px",S.right="0px",(S=h.style).left="0px",S.top=s+"px",S.bottom="0px",S.width=l+"px";var f,S,y=s,O=l,E=d;if((this.getAdvPanelDisplayedComponents()||[]).length){var T=this.getAdvPanelElem();f=Kekule.HtmlElementUtils.getElemPageRect(T).width}else f=0;(S=this.getEditorStageElem().style).position="absolute",S.top=y+"px",S.left=O+"px",S.bottom=E+"px",S.right=f+"px",(S=(T=this.getAdvPanelElem()).style).position="absolute",S.top=y+"px",S.bottom=E+"px"}if(_/C>.9?this.changeAssocToolbarRegion(!0):this.changeAssocToolbarRegion(!1),this.getAutoSetMinDimension()){var A={width:l+o.width,height:s+a.height};A.width&&A.height&&this.setMinDimension(A)}}}},adjustAssocToolbarPositions:function(){this.adjustStyleAndObjModifierToolbarPosition()},adjustStyleAndObjModifierToolbarPosition:function(){},bindEditor:function(e){e?e.setParent(this):e=this.getEditor(),e.setTouchAction("none");var t=this.getCommonActions();this.getChemActions();this.createIaControllers(e),e.addEventListener("load",function(e){this.updateAllActions(),this.updateUiWidgets();var t=this.getChemActions().getActionAt(0);t&&t.execute()},this),e.addEventListener("operChange",function(e){t.updateAll(),this.updateUiWidgets()},this),e.addEventListener("selectionChange",function(e){t.updateAll(),this.updateUiWidgets()},this),e.addEventListener("change",function(e){e.changedPropNames.indexOf("enableAutoIssueCheck")>=0&&this.getIssueInspector().setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions())},this);var r=this;e.overwriteMethod("getChildAction",function(e,t,i){var o=r._getCreatedNamedAction(t);return o||(o=e(t,i)),o}),e.appendToElem(this.getEditorStageElem()),this.getEditorNexus().setEditor(e)},createDefaultEditor:function(){var e=new Kekule.Editor.ChemSpaceEditor(this,null,Kekule.Render.RendererType.R2D);return e.addClassName(t.DYN_CREATED),e},createIaControllers:function(e){for(var t=Kekule.Editor.IaControllerManager.getAvailableControllerClasses(e.getClass()),r=0,i=t.length;r<i;++r){var o=new(0,t[r])(e);e.addIaController(o.getDefId(),o)}},updateAdvPanelDisplayedComponents:function(e){if(e&&e.length){var t=e.indexOf("objInspector")>=0,r=e.indexOf("issueInspector")>=0;t||r?(t&&!this.getObjInspector()&&this._createObjInspectorControls(),r&&!this.getIssueInspector()&&this._createIssueInspectorControls(),this.getObjInspectorHolderElem().style.display=t?"block":"none",this.getIssueInspectorHolderElem().style.display=r?"block":"none",this.showAdvPanel()):this.hideAdvPanel()}else this.hideAdvPanel();this.uiLayoutChanged()},_createObjInspectorControls:function(e){e||(e=this.getObjInspectorHolderElem());var t=this.getDocument(),r=new Kekule.ChemWidget.StructureTreeView(t);r.setItemInitialExpanded(!0),r.appendToElem(e),r.setParent(this),this.setPropStoreFieldValue("structureTreeView",r);var i=new Kekule.Widget.ObjectInspector(t);i.setShowPropInfoPanel(!1),i.appendToElem(e),i.setParent(this),this.setPropStoreFieldValue("objInspector",i);var o=this.getEditorNexus();o.setObjectInspector(i),o.setStructureTreeView(r)},_createIssueInspectorControls:function(e){e||(e=this.getIssueInspectorHolderElem());var t=this.getDocument(),o=this._doCreateSubElement(t,e,"div",r.COMPOSER_ISSUE_PANEL_WRAPPER),n=this._doCreateSubElement(t,o,"div",r.COMPOSER_ISSUE_PANEL_TOOL_PANEL),a=this.getCommonActions();this.createToolButton(i.recheckIssues,this,a).setShowText(!1).setShowGlyph(!0).appendToElem(n),this.createToolButton(i.toggleShowAllIssues,this,a).setShowText(!1).setShowGlyph(!0).appendToElem(n);var s=this._doCreateSubElement(t,o,"div",r.COMPOSER_ISSUE_PANEL_INSPECTOR_REGION),l=new Kekule.Editor.IssueInspector(t);l.appendToElem(s),l.setParent(this).setResolverCaller(this.getEditor()).setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions());var d=this;l.addEventListener("resolveIssue",function(e){var t=e.solution;if(t){var r=t.getOperation();r&&d.getEditor().execOperation(r)}}),this.setPropStoreFieldValue("issueInspector",l),this.getEditorNexus().setIssueInspector(l)},getActualEnableIssueInspectorSolutions:function(){return this.getEnableIssueInspectorSolutions()&&this.getEnableAutoIssueCheck()},showAdvPanel:function(){this.getAdvPanelElem().style.display="block"},hideAdvPanel:function(){this.getAdvPanelElem().style.display="none"},getDefaultCommonToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.commonToolButtons},getZoomButtonNames:function(){return[i.zoomIn,i.zoomOut,i.reset,i.resetZoom]},getDefaultChemToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.chemToolButtons},getCompActionClass:function(e){return this.getChildActionClass(e,!0)},_getActionTargetWidget:function(e){return ClassEx.isOrIsDescendantOf(e,Kekule.Editor.ActionOnComposer)||ClassEx.isOrIsDescendantOf(e,Kekule.Widget.ActionOpenConfigWidget)?this:this.getEditor()},createToolButton:function(e,t,r,o){var n=null,a=DataType.isObjectValue(e)?e.name:e,s=this.getCompActionClass(a),l=this._createToolButtonAction(e,r,o);if(DataType.isObjectValue(e)&&!s){var d,u=o?Kekule.Widget.RadioButton:Kekule.Widget.Button;d=Object.extend({widget:u},e),n=Kekule.Widget.Utils.createFromHash(t,d)}else{var c=l.getPreferredWidgetClass&&l.getPreferredWidgetClass();n=new(c||(e===i.objInspector||e===i.issueInspector?Kekule.Widget.CheckButton:o?Kekule.Widget.RadioButton:Kekule.Widget.Button))(t)}return l&&(l.update(),n.setAction(l)),n},_createActionButton:function(e,t){var r=e.getCheckGroup(),i=e.getPreferredWidgetClass&&e.getPreferredWidgetClass(),o=new(i||(r?Kekule.Widget.RadioButton:Kekule.Widget.Button))(t);return e.update(),o.setAction(e),o},_createToolButtonAction:function(e,t,r){var i=DataType.isObjectValue(e),o=null,n=i?e.name:e,a=i?e.attached:null,s=this.getCompActionClass(n);if(i&&!s){var l=e;(s=l.actionClass)&&"string"==typeof s&&(s=ClassEx.findClass(l.actionClass))}if(s){var d=this.getActionMap();if(!(o=d.get(s))){o=new s(this._getActionTargetWidget(s));i&&(e.text&&o.setText(e.text),e.hint&&o.setHint(e.hint),(e.htmlClass||e.htmlClassName)&&o.setHtmlClassName((o.getHtmlClassName()||"")+(e.htmlClass||e.htmlClassName))),d.set(s,o)}var u=r||"",c=o.getExplicitGroup&&o.getExplicitGroup();if(Kekule.ObjUtils.notUnset(c)&&(u=c),u&&o.setCheckGroup(u),o&&t&&t.add(o),o&&o.addAttachedAction){var p=o.getClassName(),h=Kekule.ArrayUtils.clone(o.getAttachedActions().getActions()||[]),g=function(e,t,r,i,o){if(!t)return null;var n=r.indexOf(t);n>=0?r[n]=null:e.addAttachedAction(t,i),Kekule.ObjUtils.notUnset(o)&&e.setAttachedActionIndex(t,o)};if(a)for(var C=0,_=a.length;C<_;++C){var m=a[C];g(o,S=this._createToolButtonAction(m,null,p),h,0===C,C)}else{var f=o.getAttachedActionClasses();if(f)for(C=0,_=f.length;C<_;++C){var S,y=f[C];if(!(S=d.get(y))){var O=(S=new y(this._getActionTargetWidget(y))).getExplicitGroup&&S.getExplicitGroup();Kekule.ObjUtils.notUnset(O)?S.setCheckGroup(O):S.setCheckGroup(p),d.set(y,S)}g(o,S,h,0===C,C)}}if(h.length)for(C=0,_=h.length;C<_;++C){var E=h[C];E&&(o.removeAttachedAction(E),d.remove(E.getClass()))}}}return o},_getCreatedNamedAction:function(e){var t=this.getCompActionClass(e),r=this.getActionMap();return t&&r.get(t)},createInnerToolbar:function(e,i){var o=new Kekule.Widget.ButtonGroup(this);o.addClassName(r.COMPOSER_TOOLBAR),o.addClassName(r.INNER_TOOLBAR),o.addClassName(t.DYN_CREATED),o.setShowText(!1),o.doSetShowGlyph(!0);var n=e||this.getElement();if(i){var a=Kekule.DomUtils.getFirstChildElem(n);a?o.insertToElem(n,a):o.appendToElem(n)}else o.appendToElem(n);return o.setBubbleUiEvents(!0),o},createCommonToolbar:function(){var e=this.getTopRegionElem(),i=this.createInnerToolbar(e);i.addClassName(r.COMPOSER_COMMON_TOOLBAR);var o=this.getCommonToolButtons();o=Kekule.ArrayUtils.exclude(o,this.getZoomButtonNames());var n=this.getCommonActions();this.getEditor();n.clear();for(var a=0,s=o.length;a<s;++a){var l=o[a];this.createToolButton(l,i,n)}return this.setCommonBtnGroup(i),i.addClassName(t.DYN_CREATED),this.updateZoomToolbar(),this.adjustComponentPositions(),i},createZoomToolbar:function(){var e=Kekule.ArrayUtils.intersect(this.getCommonToolButtons(),this.getZoomButtonNames());if(e.length){var i=this.getBottomRegionElem(),o=this.createInnerToolbar(i);o.addClassName(r.COMPOSER_ZOOM_TOOLBAR);var n=this.getZoomActions();this.getEditor();n.clear();for(var a=0,s=e.length;a<s;++a){var l=e[a];this.createToolButton(l,o,n)}return this.setZoomBtnGroup(o),o.addClassName(t.DYN_CREATED),this.adjustComponentPositions(),o}return this.setZoomBtnGroup(null),null},updateCommonToolbar:function(){var e=this.getCommonBtnGroup();e&&e.finalize(),this.createCommonToolbar()},updateZoomToolbar:function(){var e=this.getZoomBtnGroup();e&&e.finalize(),this.createZoomToolbar()},createChemToolbar:function(){var e=this.getLeftRegionElem(),i=this.createInnerToolbar(e,!0);i.addClassName(r.COMPOSER_CHEM_TOOLBAR),i.setLayout(Kekule.Widget.Layout.VERTICAL);var o=this.getChemToolButtons(),n=this.getChemActions();n.clear();for(var a,s=0,l=o.length;s<l;++s){var d=o[s],u=this.createToolButton(d,i,n,"chemTools");0===s&&(a=u)}if(this.setChemBtnGroup(i),i.addClassName(t.DYN_CREATED),this.adjustComponentPositions(),a){var c=a.getAction();if(c){c.setChecked(!0);var p=c.getAttachedActions&&c.getAttachedActions();this.bindAssocActions(p||null)}}return i},updateChemToolbar:function(){var e=this.getChemBtnGroup();e&&e.finalize(),this.createChemToolbar()},createAssocToolbar:function(){var e=this.getBottomRegionElem(),i=this.createInnerToolbar(e);return i.addClassName(r.COMPOSER_ASSOC_TOOLBAR),this.setAssocBtnGroup(i),this.adjustAssocToolbarPositions(),i.addClassName(t.DYN_CREATED),i},changeAssocToolbarRegion:function(e){var t,r=this.getAssocBtnGroup();if(r||(r=this.createAssocToolbar()),e)t=this.getLeftRegionElem(),r.getElement().parentNode!==t&&(r.setLayout(Kekule.Widget.Layout.VERTICAL),r.appendToElem(t));else if(t=this.getBottomRegionElem(),r.getElement().parentNode!==t){r.setLayout(Kekule.Widget.Layout.HORIZONTAL);var i=Kekule.DomUtils.getFirstChildElem(t);t.insertBefore(r.getElement(),i)}},showAssocToolbar:function(){var e=this.getAssocBtnGroup();e||(e=this.createAssocToolbar());var t=this;return e.show(null,function(){t.uiLayoutChanged(),setTimeout(t.updateSelectionAssocToolbarStateBind,0)}),this},hideAssocToolbar:function(){var e=this.getAssocBtnGroup();if(e){var t=this;e.hide(null,function(){t.uiLayoutChanged(),setTimeout(t.updateSelectionAssocToolbarStateBind,0)})}return this},isAssocToolbarShown:function(){var e=this.getAssocBtnGroup();return e&&e.isShown()},bindAssocActions:function(e){var t=this.getAssocBtnGroup();if(t||(t=this.createAssocToolbar()),t.clearWidgets(),e)for(var r=0,i=e.getActionCount();r<i;++r){var o=e.getActionAt(r);this._createActionButton(o,t)}},createObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var e=new Kekule.Editor.ComposerObjModifierToolbar(this);return e.appendToElem(this.getBottomRegionElem()),e.setBubbleUiEvents(!0),this.setObjModifierToolbar(e),this.adjustAssocToolbarPositions(),this.updateObjModifierToolbarState(),e}return null},showObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var e=this.getObjModifierToolbar();if(!e.isShown()){var t=this;e.show(null,function(){t.uiLayoutChanged()})}}return this},hideObjModifierToolbar:function(){var e=this.getPropStoreFieldValue("objModifierToolbar");if(e&&e.isShown()){var t=this;e.hide(null,function(){t.uiLayoutChanged()},null,{instantly:!0})}return this},isObjModifierToolbarShown:function(){var e=this.getPropStoreFieldValue("objModifierToolbar");return e&&e.isShown()},updateObjModifierToolbarState:function(){var e=!1;this.getEnableObjModifierToolbar()&&this.needShowSelectionAssocToolbar()&&(e=!0),e?(this.showObjModifierToolbar(),this.getObjModifierToolbar().updateState()):this.hideObjModifierToolbar()},createStyleToolbar:function(){if(this.getEnableStyleToolbar()){var e=new Kekule.Editor.ComposerStyleToolbar(this);return e.setComponentNames(this.getStyleBarComponents()),e.appendToElem(this.getBottomRegionElem()),e.setBubbleUiEvents(!0),this.setStyleToolbar(e),this.adjustAssocToolbarPositions(),this.updateStyleToolbarState(),e}return null},showStyleToolbar:function(){if(this.getEnableStyleToolbar()){var e=this.getStyleToolbar();if(!e.isShown()){var t=this;e.show(null,function(){t.uiLayoutChanged()})}}return this},hideStyleToolbar:function(){var e=this.getPropStoreFieldValue("styleToolbar");if(e&&e.isShown()){var t=this;e.hide(null,function(){t.uiLayoutChanged()})}return this},isStyleToolbarShown:function(){var e=this.getPropStoreFieldValue("styleToolbar");return e&&e.isShown()},updateStyleToolbarState:function(){this.getEnableStyleToolbar()&&this.needShowSelectionAssocToolbar()?(this.showStyleToolbar(),this.getStyleToolbar().updateState()):this.hideStyleToolbar()},needShowSelectionAssocToolbar:function(){var e=this.getEditor();return e&&e.hasSelection()},updateSelectionAssocToolbarState:function(){this.adjustStyleAndObjModifierToolbarPosition(),this.updateStyleToolbarState(),this.updateObjModifierToolbarState()},updateAllActions:function(){this.getCommonActions().updateAll(),this.getZoomActions().updateAll(),this.getChemActions().updateAll()},updateUiWidgets:function(){this.updateStyleToolbarState(),this.updateObjModifierToolbarState()},createConfigurator:function(){var e=this.tryApplySuper("createConfigurator");return e.addEventListener("configChange",function(e){this.getEditor().repaint()},this),e},react_keydown:function(e){if(!this.tryApplySuper("react_keydown",[e])&&this._isAcceptableHotKeyEvent(e))return!!this.getEditor().reactHotKeys(e)},_isAcceptableHotKeyEvent:function(e){var t=!1,r=e.getTarget();if(r&&r.tagName&&["input","select"].indexOf(r.tagName.toLowerCase())<0){var i=e.getKey()||"";t=Kekule.Widget.KeyboardUtils.isPrintableKey(i)&&" "!==i||"Backspace"===i||"Delete"===i||"Del"===i}return t}}),Kekule.Editor.Composer.getMinPreferredDimension=function(){return{width:630,height:350}},Kekule.Editor.Composer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.Editor.Composer.Settings",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineDelegatedProps(["enableCreateNewDoc","enableLoadNewFile","initOnNewDoc","enableOperHistory","allowCreateNewChild","allowAppendDataToCurr","enableIssueCheck","enableStyleToolbar","enableObjModifierToolbar"])}}),Kekule.Editor.Composer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.Editor.Composer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var e=this.tryApplySuper("getCategoryInfos"),t=this.getComposer().getEditor(),r=[t.getDisplayerConfigs(),t.getRenderConfigs()],i=0,o=r.length;i<o;++i)for(var n=r[i],a=n.getPropListOfScopes([Class.PropertyScope.PUBLISHED]),s=0,l=a.getLength();s<l;++s){var d=a.getPropInfoAt(s),u=n.getPropValue(d.name);u&&e.push({obj:u,name:d.name,title:d.title,description:d.description})}return e},getComposer:function(){return this.getWidget()},getEditor:function(){return this.getComposer().getEditor()}}),Kekule._registerAfterLoadSysProc(function(){var e=Kekule.Editor.ObjModifier.Category,t=Kekule.ObjPropSettingManager;t.register("Kekule.Editor.Composer.fullFunc",{enableObjModifierToolbar:!0,enableOperHistory:!0,enableLoadNewFile:!0,enableCreateNewDoc:!0,allowCreateNewChild:!0,commonToolButtons:null,chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null}),t.register("Kekule.Editor.Composer.molOnly",{enableObjModifierToolbar:!0,enableOperHistor:!0,enableLoadNewFile:!0,enableCreateNewDoc:!0,allowCreateNewChild:!0,commonToolButtons:null,chemToolButtons:[i.manipulate,i.erase,i.molBond,i.molAtom,i.molRing,i.molCharge],styleToolComponentNames:null,allowedObjModifierCategories:[e.GENERAL,e.CHEM_STRUCTURE]}),t.register("Kekule.Editor.Composer.compact",{enableObjModifierToolbar:!0,commonToolButtons:[i.newDoc,i.loadData,i.saveData,i.undo,i.redo,i.zoomIn,i.zoomOut],chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null}),t.register("Kekule.Editor.Composer.singleObj",{allowCreateNewChild:!1})}),Kekule.Editor.ComposerDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.Editor.ComposerDialog",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,getter:function(){var e=this.getComposer();return e&&e.getChemObj()},setter:function(e){var t=this.getComposer();t&&t.setChemObj(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_DIALOG},doCreateClientContents:function(e){this.tryApplySuper("doCreateClientContents");var t=this.doCreateComposerWidget();this.setPropStoreFieldValue("composer",t),t.appendToElem(e)},getSavingTargetObj:function(){var e=this.getComposer();return e?e.getSavingTargetObj():null},doCreateComposerWidget:function(){var e=new Kekule.Editor.Composer(this);return e.addClassName(t.DYN_CREATED),e.setResizable&&e.setResizable(!0),e.getEditor().addClassName(t.DYN_CREATED),e}}),Kekule.Editor.ComposerFrame=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.ComposerFrame",BINDABLE_TAG_NAMES:["iframe"],initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null}),this.defineProp("frameDocument",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.getElement().contentDocument}}),this.defineProp("frameWindow",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return Kekule.DocumentUtils.getDefaultView(this.getFrameDocument())}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMinDimension({width:550,height:350}),this.setEnableDimensionTransform(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_FRAME},doCreateRootElement:function(e){return e.createElement("iframe")},doBindElement:function(e){(this.tryApplySuper("doBindElement",[e]),e.parentNode)||(this.setDisplayed(!1),e.ownerDocument.body.appendChild(e));this._createComposerWidgetInFrame()},_initFrame:function(){var e=this.getFrameDocument();e.open("text/htmlreplace"),e.write("<!DOCTYPE html><html><head></head><body></body></html>"),e.close()},_createComposerWidgetInFrame:function(e){this._initFrame();var t=this,i=this.getFrameDocument();i.documentElement.className=r.COMPOSER_FRAME_CONTENT_DOC,i.body.className=r.COMPOSER_FRAME_CONTENT_BODY,Kekule.X.Event.addListener(i.body,"kekuleload",function(r){var o=new Kekule.Editor.Composer(i);o.appendToElem(i.body),t.setPropStoreFieldValue("composer",o),e&&e(o)}),this._insertKekuleScriptAndStyleSheetFiles(i)},_insertKekuleScriptAndStyleSheetFiles:function(e,t){var r=e.head,i=e.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",Kekule.getStyleSheetUrl()),r.appendChild(i),Kekule.ScriptFileUtils.appendScriptFile(e,Kekule.getScriptSrc(),t)}})}();