Kekule.ChemWidget={};Kekule.ChemWidget.AbstractWidget=Kekule.Widget.BaseWidget;Kekule.ChemWidget.ComponentWidgetNames={menu:"menu",newDoc:"newDoc",clearObjs:"clearObjs",loadFile:"loadFile",loadData:"loadData",saveData:"saveData",zoomIn:"zoomIn",zoomOut:"zoomOut",rotateRight:"rotateRight",rotateLeft:"rotateLeft",rotateX:"rotateX",rotateY:"rotateY",rotateZ:"rotateZ",reset:"reset",molDisplayType:"molDisplayType",molDisplayTypeCondensed:"molDisplayTypeCondensed",molDisplayTypeSkeletal:"molDisplayTypeSkeletal",molDisplayTypeWire:"molDisplayTypeWire",molDisplayTypeSticks:"molDisplayTypeSticks",molDisplayTypeBallStick:"molDisplayTypeBallStick",molDisplayTypeSpaceFill:"molDisplayTypeSpaceFill",molHideHydrogens:"molHideHydrogens",openEditor:"openEditor",config:"config",objInspector:"objInspector",undo:"undo",redo:"redo",copy:"copy",cut:"cut",paste:"paste",cloneSelection:"cloneSelection",erase:"erase",manipulate:"manipulate",molBond:"bond",molAtom:"atom",molFormula:"formula",molCharge:"charge",textBlock:"textBlock",imageBlock:"imageBlock",molRing:"ring",glyph:"glyph",textImage:"textImage",fontName:"fontName",fontSize:"fontSize",color:"color",textDirection:"textDirection",textAlign:"textAlign"};Kekule.ChemWidget.HtmlClassNames={PREFIX:"K-Chem-",INNER_TOOLBAR:"K-Chem-InnerToolbar"};(function(){var d=Class.PropertyScope;var b=Kekule.ChemWidget;var a=Kekule.Widget.HtmlClassNames;var c=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DIALOG_LOADDATA:"K-Chem-Dialog-LoadData",DIALOG_LOADDATA_FORMATBOX:"K-Chem-Dialog-LoadData-FormatBox",DIALOG_LOADDATA_SRCEDITOR:"K-Chem-Dialog-LoadData-SrcEditor",DIALOG_LOADDATA_BTN_LOADFROMFILE:"K-Chem-Dialog-LoadData-Btn-LoadFromFile"});Kekule.ChemWidget.LoadDataDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.ChemWidget.LoadDataDialog",initialize:function($super,e,f,g){this._openFileAction=new Kekule.ActionLoadFileData();this._openFileAction.update();this._openFileAction.addEventListener("load",this.reactFileLoad,this);this._sBtnLoadFromFile=Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_FROM_FILE");this._formatItems=null;$super(e,f||Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG"),g||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL])},finalize:function($super){this._openFileAction.finalize();$super()},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,setter:null});this.defineProp("allowedFormatIds",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("allowedFormatIds",e);this.updateFormatItems()}})},initPropValues:function($super){$super()},doGetWidgetClassName:function($super){return $super()+" "+c.DIALOG_LOADDATA},doCreateClientContents:function($super,i){$super();var h=this.getDocument();var f=h.createElement("div");f.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_FORMAT");i.appendChild(f);f=h.createElement("div");i.appendChild(f);var e=new Kekule.Widget.SelectBox(this);e.addClassName(c.DIALOG_LOADDATA_FORMATBOX);e.appendToElem(f);this._formatSelector=e;this.updateFormatItems();var f=h.createElement("div");f.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_SRC");i.appendChild(f);f=h.createElement("div");i.appendChild(f);var g=new Kekule.Widget.TextEditor(this);g.setWrap("off");g.setToolbarPos(Kekule.Widget.Position.BOTTOM);g.addClassName(c.DIALOG_LOADDATA_SRCEDITOR);g.appendToElem(f);this._dataEditor=g},getFormatSelectorItems:function(e){var s=[];var p=this.getAllowedFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds();for(var n=0,g=p.length;n<g;++n){var f=Kekule.IO.DataFormatsManager.getFormatInfo(p[n]);if(f){var o=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(f.fileExts));for(var m=0,h=o.length;m<h;++m){o[m]="*."+o[m]}var r=o.join(", ");var q=f.title;if(r){q+=" ("+r+")"}s.push({value:f.mimeType,text:q,title:f.mimeType,data:f})}}s.sort(function(j,i){return(j.text<i.text)?-1:(j.text>i.text)?1:0});return s},getFileFilters:function(j){var e=[];for(var h=0,f=j.length;h<f;++h){var m=j[h];var k=m.data;var n=m.text||m.title||m.value;var g=Kekule.ArrayUtils.toArray(k.fileExts);e.push({title:n,filter:"."+g.join(",.")})}e.push(Kekule.NativeServices.FILTER_ALL_SUPPORT);e.push(Kekule.NativeServices.FILTER_ANY);return e},updateFormatItems:function(){this._formatItems=this.getFormatSelectorItems();this._formatSelector.setItems(this._formatItems);var e=this.getFileFilters(this._formatItems);this._openFileAction.setFilters(e)},doSetButtons:function($super,g){var f=g||[];if(f.indexOf(this._sBtnLoadFromFile)<0){f.unshift(this._sBtnLoadFromFile)}$super(f);var e=this.getDialogButton(this._sBtnLoadFromFile);e.setAction(this._openFileAction);e.linkStyleResource(Kekule.Widget.StyleResourceNames.BUTTON_LOAD_FILE);e.addClassName(c.DIALOG_LOADDATA_BTN_LOADFROMFILE);e.setEnabled(this._openFileAction.getEnabled())},reactFileLoad:function(i){var h=i.data;var k=i.fileName;var j;try{if(i.success&&h&&k){j=Kekule.IO.loadTypedData(h,null,k);this.setPropStoreFieldValue("chemObj",j);var f=Kekule.Widget.DialogButtons.OK;this.close(f)}else{j=null}}catch(g){Kekule.error(g)}},open:function($super,g,e,f){this.setPropStoreFieldValue("chemObj",null);return $super(g,e,f)},close:function($super,f){if(!this.getChemObj()){if(this.isPositiveResult(f)){var g=this._dataEditor.getValue();var i=this._formatSelector.getValue();try{var j=Kekule.IO.loadTypedData(g,i);if(j){this.setPropStoreFieldValue("chemObj",j)}else{Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}}catch(h){Kekule.raise(h,Kekule.ExceptionLevel.ERROR)}}}return $super(f)}})})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;var d=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{PERIODIC_TABLE:"K-Chem-Periodic-Table",PERIODIC_TABLE_MINI:"K-Chem-Periodic-Table-Mini",PERIODIC_TABLE_LEGEND:"K-Chem-Periodic-Table-Legend",PERIODIC_TABLE_LEGEND_CONTENT:"K-Chem-Periodic-Table-Legend-Content",PERIODIC_TABLE_LEGEND_COLORS:"K-Chem-Periodic-Table-Legend-Colors",PERIODIC_TABLE_LEGEND_COLOR:"K-Chem-Periodic-Table-Legend-Color",PERIODIC_TABLE_MAINTABLE:"K-Chem-Periodic-Table-MainTable",PERIODIC_TABLE_EXTRATABLE:"K-Chem-Periodic-Table-ExtraTable",PERIODIC_TABLE_ELEM_CELL:"K-Chem-Periodic-Table-Elem-Cell",PERIODIC_TABLE_ELEM_STUBSCELL:"K-Chem-Periodic-Table-Elem-StubsCell",PERIODIC_TABLE_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_HEAD_CELL:"K-Chem-Periodic-Table-Head-Cell",PERIODIC_TABLE_HEAD_CELL_CONTENT:"K-Chem-Periodic-Table-Head-Cell-Content",PERIODIC_TABLE_HEAD_CELL_GROUP:"K-Chem-Periodic-Table-Head-Cell-Group",PERIODIC_TABLE_HEAD_CELL_PERIOD:"K-Chem-Periodic-Table-Head-Cell-Period",ELEM_SYMBOL:"K-Chem-Elem-Symbol",ELEM_SYMBOL_STUBS:"K-Chem-Elem-Symbol-Stubs",ELEM_NAME:"K-Chem-Elem-Name",ATOMIC_NUM:"K-Chem-Atomic-Num",ATOMIC_WEIGHT:"K-Chem-Atomic-Weight"});Kekule.globalOptions.add("chemWidget.periodicTable",{displayedComponents:["symbol","name","atomicNumber","groupHead","legend"]});Kekule.ChemWidget.PeriodicTable=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.PeriodicTable",BINDABLE_TAG_NAMES:["span","div"],ELEM_DATA_FIELD:"__$elemData__",MAX_GROUP:18,MAX_PERIOD:7,LA_SERIES:["La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu"],AC_SERIES:["Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr"],initialize:function($super,e,f){this.setPropStoreFieldValue("displayedComponents",f||this.getDefaultDisplayedComponents());this._elemCells=[];this._selectedElemCells=[];$super(e);this.setEnableSelect(true);this.setEnableMultiSelect(true)},initProperties:function(){this.defineProp("displayedComponents",{dataType:DataType.ARRAY,getter:function(){return this.getPropStoreFieldValue("displayedComponents")||this.getDefaultDisplayedComponents()}});this.defineProp("startingAtomNum",{dataType:DataType.INT});this.defineProp("endingAtomNum",{dataType:DataType.INT});this.defineProp("useMiniMode",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useMiniMode",e);if(e){this.addClassName(d.PERIODIC_TABLE_MINI)}else{this.removeClassName(d.PERIODIC_TABLE_MINI)}}});this.defineProp("enableSelect",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableSelect")||this.getEnableMultiSelect()}});this.defineProp("enableMultiSelect",{dataType:DataType.BOOL});this.defineProp("selected",{dataType:DataType.HASH,serializable:false,setter:null,getter:function(){return this.getSelection()?this.getSelection()[0]:null}});this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,setter:null,getter:function(){var e=[];var g=this._selectedElemCells||[];for(var h=0,f=g.length;h<f;++h){var j=g[h][this.ELEM_DATA_FIELD];if(j){e.push(j)}}return e}});this.defineProp("selectedSymbol",{dataType:DataType.STRING,getter:function(){return this.getSelectedSymbols()[0]},setter:function(e){this.setSelectedSymbols([e])}});this.defineProp("selectedSymbols",{dataType:DataType.ARRAY,getter:function(){var h=this.getSelection();if(h){var e=[];for(var g=0,f=h.length;g<f;++g){e.push(h[g].symbol)}return e}return[]},setter:function(e){this.selectSymbols(e)}})},doGetWidgetClassName:function($super){return $super()+" "+d.PERIODIC_TABLE},doCreateRootElement:function(f){var e=f.createElement("div");return e},doCreateSubElements:function($super,g,e){$super(g,e);var f=this.createMainTable(g,e);return[f]},doObjectChange:function(e){var f=["displayedComponents","startingAtomNum","endingAtomNum"];if(Kekule.ArrayUtils.intersect(e,f).length){this.recreateMainTable()}},getDefaultDisplayedComponents:function(){return Kekule.globalOptions.chemWidget.periodicTable.displayedComponents},getShowElemSymbol:function(){var e=this.getDisplayedComponents();return e.indexOf("symbol")>=0},getShowElemName:function(){var e=this.getDisplayedComponents();return e.indexOf("name")>=0},getShowAtomicNum:function(){var e=this.getDisplayedComponents();return e.indexOf("atomicNumber")>=0},getShowAtomicWeight:function(){var e=this.getDisplayedComponents();return e.indexOf("atomicWeight")>=0},getShowGroupHead:function(){var e=this.getDisplayedComponents();return e.indexOf("groupHead")>=0},getShowPeriodHead:function(){var e=this.getDisplayedComponents();return e.indexOf("periodHead")>=0},getShowLegend:function(){var e=this.getDisplayedComponents();return e.indexOf("legend")>=0},recreateMainTable:function(){this.deselectAll();var e=this.getElement();b.clearChildContent(e);this.createMainTable(e.ownerDocument,e)},createMainTable:function(L,y){var E=Kekule.chemicalElementsData;var g=[];this._elemCells=[];var r=[];var u=[];var w=L.createElement("table");for(var n=0;n<=this.MAX_PERIOD;++n){var j=L.createElement("tr");var o=[];for(var h=0;h<=this.MAX_GROUP;++h){var s=L.createElement("td");j.appendChild(s);o.push(s)}w.appendChild(j);g.push(o)}var e=L.createElement("table");for(var n=0;n<2;++n){var j=L.createElement("tr");var o=[];for(var h=0;h<this.LA_SERIES.length;++h){var s=L.createElement("td");j.appendChild(s);o.push(s)}e.appendChild(j);r.push(o)}var J=this.getStartingAtomNum()||0;var f=this.getEndingAtomNum()||300000;for(var C=0,A=E.length;C<A;++C){var G=E[C];var q=G.atomicNumber;if(q<J||q>f){continue}var B=G.symbol;var D=G.period;var p=G.group;var k=G.chemicalSerie.replace(/\s/g,"");Kekule.ArrayUtils.pushUnique(u,G.chemicalSerie);var s;var v=this.LA_SERIES.indexOf(B);var t=this.AC_SERIES.indexOf(B);if(v>=0){s=r[0][v]}else{if(t>=0){s=r[1][t]}else{if(D&&p){s=g[D][p]}}}if(s){s.className=d.PERIODIC_TABLE_ELEM_CELL;s.appendChild(this.createElemCellContent(L,G,k.upperFirst()));s[this.ELEM_DATA_FIELD]=G;this._elemCells.push(s)}if((v===0)||(t===0)){s=g[D][p];s.className=d.PERIODIC_TABLE_ELEM_STUBSCELL;s.appendChild(this.createElemCellStubsContent(L,G,k.upperFirst()))}}if(this.getShowGroupHead()){var m=["IA","IIA","IIIB","IVB","VB","VIB","VIIB","","VIII","","IB","IIB","IIIA","IVA","VA","VIA","VIIA","VIIIA"];for(var h=1;h<=this.MAX_GROUP;++h){var n=(h===1)||(h===18)?0:(h===2)||(h>=13)?1:3;var s=g[n][h];s.className=d.PERIODIC_TABLE_HEAD_CELL+" "+d.PERIODIC_TABLE_HEAD_CELL_GROUP;s.appendChild(this.createHeadContent(L,m[h-1]))}}if(this.getShowPeriodHead()){for(var n=1;n<=this.MAX_PERIOD;++n){var s=g[n][0];s.className=d.PERIODIC_TABLE_HEAD_CELL+" "+d.PERIODIC_TABLE_HEAD_CELL_PERIOD;s.appendChild(this.createHeadContent(L,n))}}y.appendChild(w);if(this.getShowLegend()){var K=L.createElement("a");K.href="javascript:void(0)";K.className=d.PERIODIC_TABLE_LEGEND+" "+a.CORNER_ALL;b.setElementText(K,Kekule.$L("ChemWidgetTexts.LEGEND_CAPTION"));var x=L.createElement("div");x.className=d.PERIODIC_TABLE_LEGEND_CONTENT+" "+a.CORNER_ALL;var z={symbol:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_SYMBOL"),atomicNumber:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_NUM"),naturalMass:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_WEIGHT"),name:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_NAME")};var H=this.createElemCellContent(L,z,d.PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT);x.appendChild(H);var I=L.createElement("div");I.className=d.PERIODIC_TABLE_LEGEND_COLORS;for(var C=0,A=u.length;C<A;++C){var F=L.createElement("div");F.className=d.PERIODIC_TABLE_LEGEND_COLOR+" "+u[C].replace(/\s/g,"");b.setElementText(F,u[C]);I.appendChild(F)}x.appendChild(I);K.appendChild(x);y.appendChild(K)}y.appendChild(e);return w},createElemCellContent:function(j,g,k){var e=j.createElement("div");var i=d.PERIODIC_TABLE_ELEM_CELL_CONTENT;if(k){i+=" "+k}e.className=i;if(this.getShowAtomicNum()){e.appendChild(this.createElemContentComponent(j,g.atomicNumber,d.ATOMIC_NUM))}if(this.getShowAtomicWeight()){var h=g.naturalMass;if(h){var f=(typeof(h)==="number")?h.toFixed(3):h;e.appendChild(this.createElemContentComponent(j,f,d.ATOMIC_WEIGHT))}else{e.appendChild(this.createElemContentComponent(j,"\u00a0",d.ATOMIC_WEIGHT))}}if(this.getShowElemSymbol()){e.appendChild(this.createElemContentComponent(j,g.symbol,d.ELEM_SYMBOL))}if(this.getShowElemName()){e.appendChild(this.createElemContentComponent(j,g.name,d.ELEM_NAME))}return e},createElemCellStubsContent:function(i,f,k){var e=i.createElement("div");e.className=d.PERIODIC_TABLE_ELEM_CELL_CONTENT+" "+(k||"");var j,h,g;g=f.chemicalSerie;if(f.symbol==="La"){j="57-71";h="La-Lu"}else{j="89-103";h="Ac-Lr"}if(this.getShowAtomicNum()){e.appendChild(this.createElemContentComponent(i,j,d.ATOMIC_NUM))}if(this.getShowElemSymbol()){e.appendChild(this.createElemContentComponent(i,h,d.ELEM_SYMBOL_STUBS,true))}if(this.getShowElemName()){e.appendChild(this.createElemContentComponent(i,g,d.ELEM_NAME))}return e},createElemContentComponent:function(h,g,e,j){var f=h.createElement("span");f.className=e;if(j){var i=h.createElement("span");f.appendChild(i)}b.setElementText(i||f,g);return f},createHeadContent:function(f,g,h){var e=f.createElement("div");e.className=d.PERIODIC_TABLE_HEAD_CELL_CONTENT+" "+(h||"");b.setElementText(e,g);return e},_getAtomCellElem:function(f){var e=b.getNearestAncestorByTagName(f,"td",true);if(e&&(this._elemCells.indexOf(e)>=0)){return e}else{return null}},_getCellElemOfSymbol:function(k){var g=this._elemCells;for(var h=0,f=g.length;h<f;++h){var e=g[h];var j=e[this.ELEM_DATA_FIELD];if(j.symbol===k){return e}}return null},isCellSelected:function(e){return this._selectedElemCells.indexOf(e)>=0},selectCell:function(e){if(e){c.addClass(e,a.STATE_SELECTED);Kekule.ArrayUtils.pushUnique(this._selectedElemCells,e);this.invokeEvent("select",{elemData:e[this.ELEM_DATA_FIELD]})}},deselectCell:function(e){if(e){c.removeClass(e,a.STATE_SELECTED);Kekule.ArrayUtils.remove(this._selectedElemCells,e);this.invokeEvent("deselect",{elemData:e[this.ELEM_DATA_FIELD]})}},toggleCell:function(e){if(this.isCellSelected(e)){this.deselectCell(e)}else{this.selectCell(e)}},deselectAll:function(){var e=this._selectedElemCells;for(var f=e.length-1;f>=0;--f){this.deselectCell(e[f])}return this},selectSymbols:function(g){this.deselectAll();var j=Kekule.ArrayUtils.toArray(g);for(var h=0,f=j.length;h<f;++h){var e=this._getCellElemOfSymbol(j[h]);if(e){this.selectCell(e)}}return this},react_click:function($super,h){if(this.getEnableSelect()){var g=h.getTarget();var f=this._getAtomCellElem(g);if(f){if(!this.getEnableMultiSelect()){this.deselectAll();this.selectCell(f)}else{this.toggleCell(f)}return true}}$super(h)}})})();(function(){var f=Class.PropertyScope;var d=Kekule.DomUtils;var c=Kekule.ZoomUtils;var b=Kekule.ChemWidget;var a=Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DISPLAYER_DRAWCONTEXT_PARENT:"K-Chem-Displayer-DrawContext-Parent",ACTION_MOL_DISPLAY_TYPE:"K-Chem-MolDisplayType",ACTION_MOL_DISPLAY_SKELETAL:"K-Chem-MolDisplaySkeletal",ACTION_MOL_DISPLAY_CONDENSED:"K-Chem-MolDisplayCondensed",ACTION_MOL_DISPLAY_WIRE:"K-Chem-MolDisplayWire",ACTION_MOL_DISPLAY_BALLSTICK:"K-Chem-MolDisplayBallStick",ACTION_MOL_DISPLAY_STICKS:"K-Chem-MolDisplaySticks",ACTION_MOL_DISPLAY_SPACEFILL:"K-Chem-MolDisplaySpaceFill",ACTION_MOL_HIDE_HYDROGENS:"K-Chem-MolHideHydrogens",ACTION_ZOOMIN:"K-Chem-ZoomIn",ACTION_ZOOMOUT:"K-Chem-ZoomOut",ACTION_RESET:"K-Chem-Reset",ACTION_RESET_ZOOM:"K-Chem-ResetZoom",ACTION_LOADFILE:"K-Chem-LoadFile",ACTION_LOADDATA:"K-Chem-LoadData",ACTION_SAVEFILE:"K-Chem-SaveFile",ACTION_CLEAROBJS:"K-Chem-ClearObjs",ACTION_CONFIG:"K-Chem-Config",DIALOG_CHOOSE_FILE_FORAMT:"K-Chem-Dialog-Choose-File-Format",DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX:"K-Chem-Dialog-Choose-File-Format-FormatBox",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER:"K-Chem-Dialog-Choose-File-Format-Previewer"});Kekule.ChemWidget.ChemObjDisplayerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerConfigs",initProperties:function(){this.addConfigProp("ioConfigs","Kekule.ChemWidget.ChemObjDisplayerIOConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("ioConfigs",new Kekule.ChemWidget.ChemObjDisplayerIOConfigs())}});Kekule.ChemWidget.ChemObjDisplayerIOConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerIOConfigs",initProperties:function(){this.addBoolConfigProp("canonicalizeBeforeSave",true)}});Kekule.ChemWidget.ChemObjDisplayer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer",initialize:function($super,g,j,h,i){this._paintFlag=0;this._bgColorMap={};this._contextTransformOpsMap=new Kekule.MapEx();this.setPropStoreFieldValue("resetAfterLoad",true);this.setPropStoreFieldValue("renderType",h||Kekule.Render.RendererType.R2D);$super(g);if(j){this.setChemObj(j)}this.setEnableLoadNewFile(true);this.setPropStoreFieldValue("displayerConfigs",i||this.createDefaultConfigs())},doFinalize:function($super){this.setChemObj(null);this.getPainter().finalize();var g=this.getPropStoreFieldValue("drawBridge");var h=this.getPropStoreFieldValue("drawContext");if(h&&g){g.releaseContext(h)}if(g.finalize){g.finalize()}this.setPropStoreFieldValue("drawBridge",null);this.setPropStoreFieldValue("drawContext",null);if(this._contextTransformOpsMap){this._contextTransformOpsMap.finalize()}$super()},initProperties:function(){this.defineProp("displayerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:false,scope:f.PUBLIC});this.defineProp("enableLoadNewFile",{dataType:DataType.BOOL});this.defineProp("allowedInputFormatIds",{dataType:DataType.ARRAY});this.defineProp("allowedOutputFormatIds",{dataType:DataType.ARRAY});this.defineProp("standardizationOptions",{dataType:DataType.HASH});this.defineProp("resetAfterLoad",{dataType:DataType.BOOL});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,scope:f.PUBLIC,setter:function(h){var g=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",h);this.chemObjChanged(h,g)}});this.defineProp("chemObjLoaded",{dataType:DataType.BOOL,serializable:false,scope:f.PUBLIC,setter:null,getter:function(){return this.getChemObj()&&this.getPropStoreFieldValue("chemObjLoaded")}});this.defineProp("renderType",{dataType:DataType.INT,serializable:false,scope:f.PUBLISHED,setter:function(h){if(!this.getAllowRenderTypeChange()){Kekule.error(Kekule.$L("ErrorMsg.RENDER_TYPE_CHANGE_NOT_ALLOWED"));return}var g=this.getRenderType();if(h!==g){this.setPropStoreFieldValue("renderType",h);this.resetRenderType(g,h)}}});this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:false,scope:f.PUBLIC,getter:function(){var g=this.getPropStoreFieldValue("renderConfigs");if(!g){g=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()}return g}});this.defineProp("backgroundColor",{dataType:DataType.STRING,scope:f.PUBLISHED,setter:function(g){this.setPropStoreFieldValue("backgroundColor",g);this._bgColorMap[this.getRenderType().toString()]=g;this.backgroundColorChanged()}});this.defineProp("drawOptions",{dataType:DataType.HASH,serializable:false,scope:f.PUBLIC,getter:function(){var g=this.getPropStoreFieldValue("drawOptions");if(!g){g={};this.setPropStoreFieldValue("drawOptions",g)}return g},setter:function(g){this.setPropStoreFieldValue("drawOptions",g);this.drawOptionChanged()}});this.defineProp("zoom",{dataType:DataType.FLOAT,serializable:false,getter:function(){var g=this.getDrawOptions()||{};return g.zoom},setter:function(g){this.zoomTo(g);return this}});this.defineProp("autofit",{dataType:DataType.BOOL,serializable:false,getter:function(){var g=this.getDrawOptions()||{};return g.autofit},setter:function(g){var h=this.getDrawOptions()||{};h.autofit=g;return this.setDrawOptions(h)}});this.defineProp("moleculeDisplayType",{dataType:DataType.INT,serializable:false,getter:function(){var g=this.getDrawOptions()||{};return g.moleculeDisplayType},setter:function(g){this.getDrawOptions().moleculeDisplayType=g;this.drawOptionChanged();return this}});this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL,serializable:false,scope:f.PUBLIC,getter:function(){return Kekule.oneOf(this.getDrawOptions().allowCoordBorrow,this.getRenderConfigs().getGeneralConfigs().getAllowCoordBorrow())}});this.defineProp("autoSize",{dataType:DataType.BOOL,serializable:false,setter:function(g){if(g!=this.getAutoSize()){this.setPropStoreFieldValue("autoSize",g);if(g&&this.allowAutoSize()){this.drawOptionChanged()}}}});this.defineProp("padding",{dataType:DataType.INT,serializable:false,setter:function(g){if(g!=this.getPadding()){this.setPropStoreFieldValue("padding",g);this.getDrawOptions().autofitContextPadding=g;this.drawOptionChanged()}}});this.defineProp("baseCoordOffset",{dataType:DataType.Hash,serializable:false,setter:function(g){this.setPropStoreFieldValue("baseCoordOffset",g);if(this.getChemObjLoaded()){this.repaint()}}});this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:false,scope:f.PRIVATE,setter:null,getter:function(h){var g=this.getPropStoreFieldValue("drawBridge");if(!g){g=this.createDrawBridge(h);this.setPropStoreFieldValue("drawBridge",g)}return g}});this.defineProp("drawContext",{dataType:DataType.OBJECT,serializable:false,scope:f.PRIVATE,setter:null,getter:function(){var g=this.getPropStoreFieldValue("drawContext");if(!g){var j=this.getDrawBridge();if(j){var h=this.getDrawContextParentElem();if(!h){return null}else{var i=Kekule.HtmlElementUtils.getElemOffsetDimension(h);g=j.createContext(h,i.width,i.height);this.setPropStoreFieldValue("drawContext",g)}}}return g}});this.defineProp("painter",{dataType:"Kekule.Render.ChemObjPainter",serializable:false,scope:f.PRIVATE,setter:null,getter:function(){var g=this.getPropStoreFieldValue("painter");if(!g){g=this.createNewPainter()}return g}});this.defineProp("rootRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:false,scope:f.PRIVATE,setter:null,getter:function(){var g=this.getPainter();return g?g.getRenderer():null}})},initPropValues:function($super){$super();this.setStandardizationOptions({unmarshalSubFragments:false})},doWidgetShowStateChanged:function($super,g){$super(g);if(g){this.setChemObj(this.getChemObj())}},getAllowRenderTypeChange:function(){return false},resetRenderType:function(j,g){var l=this.getChemObj();var k=this.getPropStoreFieldValue("drawBridge");var i=this.getPropStoreFieldValue("drawContext");if(k){if(i){k.releaseContext(i)}}this.setPropStoreFieldValue("drawContext",null);this.setPropStoreFieldValue("drawBridge",null);var h=this.getBackgroundColorOfType(g);this.getDrawOptions().moleculeDisplayType=this.getDefaultMoleculeDisplayType(g);this.setPropStoreFieldValue("backgroundColor",h);this.backgroundColorChanged(true);this.setChemObj(l||null)},createDefaultConfigs:function(){return new Kekule.ChemWidget.ChemObjDisplayerConfigs()},getCoordMode:function(){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D},setCoordMode:function(h){var g=(h===Kekule.CoordMode.COORD3D)?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(g)},loadPredefinedResDataToProp:function(h,g,j){if(h==="chemObj"){if(j){try{var k=Kekule.IO.loadTypedData(g.data,g.resType,g.resUri);this.setChemObj(k)}catch(i){this.reportException(i)}}else{this.reportException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+g.resUri||"")}}},reportException:function(h,g){Kekule.raise(h,g||Kekule.ExceptionLevel.ERROR)},createDrawBridge:function(h){var i=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.DrawBridge3DMananger:Kekule.Render.DrawBridge2DMananger;var g=i.getPreferredBridgeInstance();if(!g){if(!h){Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"))}}return g},getDrawContextParentElem:function(j){var g=this._drawContextParentElem;if(!g&&!j){g=this.getDocument().createElement("div");this._drawContextParentElem=g;Kekule.HtmlElementUtils.addClass(g,a.DYN_CREATED);Kekule.HtmlElementUtils.addClass(g,e.DISPLAYER_DRAWCONTEXT_PARENT);g.style.width="100%";g.style.height="100%";var h=this.getElement();var i=Kekule.DomUtils.getFirstChildElem(h);if(i){h.insertBefore(g,i)}else{h.appendChild(g)}}return g},allowAutoSize:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D},canModifyPartialGraphic:function(h){var g=this.getDrawBridge();return g.canModifyGraphic?g.canModifyGraphic(h||this.getDrawContext()):false},doInsertedToDom:function(){this.doResize()},doResize:function(){this.refitDrawContext(this.isPainting())},refitDrawContext:function(h){if(this.getDrawBridge(true)&&this.getDrawContext()){var g=Kekule.HtmlElementUtils.getElemClientDimension(this.getDrawContextParentElem());var i=this.changeContextDimension(g);if(!h&&i){this.repaint()}}},getContextDimension:function(){if(this.getDrawBridge()&&this.getDrawContext()){return this.getDrawBridge().getContextDimension(this.getDrawContext())}else{return null}},changeContextDimension:function(g){if(this.getDrawBridge()&&this.getDrawContext()){this.getDrawBridge().setContextDimension(this.getDrawContext(),g.width,g.height);return true}else{return false}},clearContext:function(){var h=this.getPropStoreFieldValue("drawContext");if(h){var g=this.getPropStoreFieldValue("painter");if(g){g.clear(h)}this.getDrawBridge().clearContext(h)}},createNewPainter:function(i){var h=this.getPropStoreFieldValue("painter");if(h){h.finalize()}var g=new Kekule.Render.ChemObjPainter(this.getRenderType(),i,this.getDrawBridge());this.setPropStoreFieldValue("painter",g);return g},chemObjChanged:function(h,g){this.doLoad(h);if(this.getResetAfterLoad()&&g){this.resetDisplay()}},load:function(g){this.setChemObj(g)},doLoad:function(i){this.refitDrawContext(true);this.setPropStoreFieldValue("chemObjLoaded",false);try{if(i){var g=this.createNewPainter(i);g.setRenderConfigs(this.getRenderConfigs());this.repaint();this.setPropStoreFieldValue("chemObjLoaded",true)}else{this.clearContext()}this.invokeEvent("load",{obj:i})}catch(h){this.clearContext();this.reportException(h)}finally{this.doLoadEnd(this.getChemObj())}},doLoadEnd:function(g){},loadFromData:function(g,j,i){try{if(!g){this.setChemObj(null);return null}else{var k=Kekule.IO.loadTypedData(g,j,i);if(k){this.setChemObj(k)}else{Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}return k}}catch(h){this.reportException(h)}},loadFromFile:function(h){if(!h){this.setChemObj(null)}else{var g=this;try{Kekule.IO.loadFileData(h,function(k,j){if(j){g.setChemObj(k)}})}catch(i){this.reportException(i)}}},getSavingTargetObj:function(){return this.getChemObj()},saveData:function(l,g,j){var j=j||this.getSavingTargetObj();this.prepareSaveData(j);var i=Kekule.IO.ChemDataWriterManager.getWriterByFormat(l,null,j);if(i){var k=this._needToCanonicalizeBeforeSaving()&&this.getDisplayerConfigs().getIoConfigs().getCanonicalizeBeforeSave();if(k&&j.standardize){var j=j.clone?j.clone(true):j;j.standardize(this.getStandardizationOptions())}if(!g){var m=Kekule.IO.DataFormatsManager.getFormatInfo(l);g=m.dataType}var h=i.writeData(j,g,l);return h}else{Kekule.error(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT"));return null}},_needToCanonicalizeBeforeSaving:function(){return false},prepareSaveData:function(g){},getDrawClientDimension:function(){var g=Kekule.HtmlElementUtils.getElemClientDimension(this.getCoreElement());return g},setDrawDimension:function(h,g){this.setDimension(h,g)},calcDrawBaseCoord:function(q){var n;var h=this.getDrawContext();var o=this.getPainter();var i;if((!this._isContinuousRepainting)&&this.getAutoSize()&&this.allowAutoSize()){var m=this.getPadding()||0;var k=o.estimateScreenBox(h,n,q,this.getAllowCoordBorrow());if(k){var g=k.x2-k.x1+m*2;var p=k.y2-k.y1+m*2;this.changeContextDimension({width:g,height:p});this.setDrawDimension(g,p);i={width:g,height:p};n={x:g/2,y:p/2}}}else{n=q?q.baseCoord:null;if(!n){var l=this.getDrawClientDimension();n={x:l.width/2,y:l.height/2};var j=this.getBaseCoordOffset();if(j){n=Kekule.CoordUtils.add(n,j)}}}n=this.getDrawBridge().transformScreenCoordToContext(h,n);return{baseCoord:n,baseCoordPos:Kekule.Render.CoordPos.CENTER,newWidgetDimension:i}},getActualDrawOptions:function(){return this.getDrawOptions()},calcDrawParams:function(i){var h=this.getActualDrawOptions();if(i){h=Object.extend(h,i)}var g=this.calcDrawBaseCoord(h);return{drawOptions:h,baseCoord:g.baseCoord,baseCoordPos:g.baseCoordPos,newWidgetDimension:g.newWidgetDimension}},_savePainterInitialRenderTransformOptions:function(i,h){var g=h.getActualInitialRenderTransformOptions(i);this._contextTransformOpsMap.set(i,g)},repaint:function(l){this.beginPaint();try{if(!l||!l.doNotClear){this.clearContext()}if(!this.getChemObj()){return}var g=this.getPainter();var k=this.getDrawContext();var h;var i;var j=true;if(l&&l.preserveTransformOptions){i=this._contextTransformOpsMap.get(k)||null;j=false;h=this.calcDrawParams(i)}else{h=this.calcDrawParams(l)}this._lastBaseCoord=h.baseCoord;g.draw(k,h.baseCoord,h.drawOptions);if(j){this._savePainterInitialRenderTransformOptions(k,g)}}finally{this.endPaint()}},beginPaint:function(){if(!this._paintFlag){this._paintFlag=0}++this._paintFlag},endPaint:function(){if(this._paintFlag>0){--this._paintFlag}if(this._paintFlag<0){this._paintFlag=0}},isPainting:function(){return this._paintFlag>0},getBackgroundColorOfType:function(g){return this._bgColorMap[g.toString()]},setBackgroundColorOfType:function(g,h){this._bgColorMap[h.toString()]=g;if(h===this.getRenderType()){this.setBackgroundColor(g)}},backgroundColorChanged:function(i){var g=this.getBackgroundColor();if(g==="transparent"){g=null}var h=this.getDrawBridge(true);if(h&&h.setClearColor){h.setClearColor(this.getDrawContext(),g);if(!i){this.repaint()}}},drawOptionChanged:function(){this.repaint()},geometryOptionChanged:function(){var g=this.getPainter();var i=this.getDrawOptions();if(g.supportGeometryOptionChange()){var h=this.getDrawContext();g.changeGeometryOptions(h,i.baseCoord||this._lastBaseCoord,i);this._savePainterInitialRenderTransformOptions(h,g)}else{this.drawOptionChanged()}},beginContinuousRepainting:function(){this._isContinuousRepainting=true},endContinuousRepainting:function(){if(this._isContinuousRepainting){this._isContinuousRepainting=false;this.repaint()}},resetDisplay:function(){var g=this.getDrawOptions();g.zoom=1;g.rotateX=0;g.rotateY=0;g.rotateZ=0;g.rotateAngle=0;g.rotateAxisVector=null;g.rotateMatrix=null;this.setBaseCoordOffset(null);this.geometryOptionChanged();return this},getCurrZoom:function(){return this.getDrawOptions().zoom||1},zoomTo:function(h,g){this.getDrawOptions().zoom=h;if(!g){this.geometryOptionChanged()}return this},zoomIn:function(h){var i=this.getCurrZoom();var g=c.getNextZoomInRatio(i,h||1);return this.zoomTo(g)},zoomOut:function(h){var i=this.getCurrZoom();var g=c.getNextZoomOutRatio(i,h||1);return this.zoomTo(g)},resetZoom:function(){return this.zoomTo(1)},getDefaultMoleculeDisplayType:function(g){return(g===Kekule.Render.RendererType.R3D)?Kekule.Render.Molecule3DDisplayType.DEFAULT:Kekule.Render.Molecule2DDisplayType.DEFAULT},getCurrMoleculeDisplayType:function(){var g=this.getDrawOptions().moleculeDisplayType;if(!g){g=this.getDefaultMoleculeDisplayType(this.getRenderType())}return g},setHideHydrogens:function(g){this.getDrawOptions().hideHydrogens=g;this.drawOptionChanged();return this},exportToDataUri:function(g,h){return this.getDrawBridge().exportToDataUri(this.getDrawContext(),g,h)},createConfigurator:function($super){var g=$super();g.addEventListener("configChange",function(h){this.repaint()},this);return g}});Kekule.ChemWidget.ChemObjDisplayer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Settings",initialize:function($super,g){$super(g)},initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile"])},getDisplayer:function(){return this.getWidget()}});Kekule.ChemWidget.ChemObjDisplayer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function($super,g){$super(g)},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function($super){var u=$super();var t=this.getDisplayer();var n=[t.getDisplayerConfigs(),t.getRenderConfigs()];for(var o=0,m=n.length;o<m;++o){var g=n[o];var s=g.getPropListOfScopes([Class.PropertyScope.PUBLISHED]);for(var q=0,h=s.getLength();q<h;++q){var r=s.getPropInfoAt(q);var p=g.getPropValue(r.name);if(p){u.push({obj:p,name:r.name,title:r.title,description:r.description})}}}return u},getDisplayer:function(){return this.getWidget()}});Kekule.ChemWidget.ActionDisplayerLoadFile=Class.create(Kekule.ActionLoadFileData,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadFile",HTML_CLASSNAME:e.ACTION_LOADFILE,initialize:function($super,g){$super();this.setDisplayer(g);this.setText(Kekule.$L("ChemWidgetTexts.CAPTION_LOADFILE"));this.setHint(Kekule.$L("ChemWidgetTexts.HINT_LOADFILE"))},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:false})},doUpdate:function($super){$super();var g=this.getDisplayer();this.setEnabled(this.getEnabled()&&g&&g.getEnabled()&&g.getEnableLoadNewFile())},doDataLoaded:function(h,i,g){if(g){this.getDisplayer().loadFromData(h,null,i)}}});Kekule.ChemWidget.ActionOnDisplayer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnDisplayer",initialize:function($super,h,g,i){$super();this.setDisplayer(h);this.setText(g);this.setHint(i)},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:false})},doUpdate:function(){var g=this.getDisplayer();this.setEnabled(g&&g.getChemObj()&&g.getChemObjLoaded()&&g.getEnabled())}});Kekule.ChemWidget.ActionDisplayerClear=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerClear",HTML_CLASSNAME:e.ACTION_CLEAROBJS,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_CLEAROBJS"),Kekule.$L("ChemWidgetTexts.HINT_CLEAROBJS"))},doUpdate:function($super){$super();var g=this.getDisplayer();this.setEnabled(g&&g.getEnabled()&&g.getChemObj())},doExecute:function(h){var g=this.getDisplayer();g.setChemObj(null)}});Kekule.ChemWidget.ActionDisplayerLoadData=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadData",HTML_CLASSNAME:e.ACTION_LOADDATA,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA"),Kekule.$L("ChemWidgetTexts.HINT_LOADDATA"))},finalize:function($super){$super()},initPropValues:function($super){$super();this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("dataDialog",{dataType:"Kekule.ChemWidget.LoadDataDialog",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("dataDialog");if(!g){g=this.createDataDialog();this.setPropStoreFieldValue("dataDialog",g)}return g}});this.defineProp("dialogShowType",{dataType:DataType.INT})},createDataDialog:function(){var h=this.getDisplayer().getDocument();var g=new Kekule.ChemWidget.LoadDataDialog(h);return g},doUpdate:function($super){$super();var g=this.getDisplayer();this.setEnabled(g&&g.getEnabled()&&g.getEnableLoadNewFile())},doExecute:function(j){var g=this;var i=this.getDataDialog();i.setAllowedFormatIds(this.getDisplayer().getAllowedInputFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds());var h=i._formatSelector;var l=this.getDialogShowType();var k=(l===Kekule.Widget.ShowHideType.DIALOG)?i.openModal:i.open;k.apply(i,[function(m){if(i.isPositiveResult(m)){var n=g.getDisplayer();n.load(i.getChemObj())}},j,l])}});Kekule.ChemWidget.ActionDisplayerSaveFile=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerSaveFile",HTML_CLASSNAME:e.ACTION_SAVEFILE,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEFILE"),Kekule.$L("ChemWidgetTexts.HINT_SAVEFILE"));this._saveAction=new Kekule.ActionFileSave()},finalize:function($super){this._saveAction.finalize();$super()},initPropValues:function($super){$super();this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("formatDialog",{dataType:"Kekule.Widget.Dialog",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("formatDialog");if(!g){g=this.createFormatDialog();this.setPropStoreFieldValue("formatDialog",g)}return g}});this.defineProp("lastFormat",{dataType:DataType.STRING,serializable:false});this.defineProp("currSaveData",{dataType:DataType.VARIANT,serializable:false});this.defineProp("dialogShowType",{dataType:DataType.INT})},getChemObjSrcInfo:function(h){var g=this.getDisplayer();return g.getChemObjSrcInfo?g.getChemObjSrcInfo(h):h.getSrcInfo?h.getSrcInfo():null},getChemObjSrcFormat:function(h){var g=this.getChemObjSrcInfo(h);return g?g.format:null},createFormatDialog:function(){var k=this.getDisplayer().getDocument();var g=new Kekule.Widget.Dialog(k,Kekule.$L("ChemWidgetTexts.CAPTION_CHOOSEFILEFORMAT"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);g.addClassName(e.DIALOG_CHOOSE_FILE_FORAMT);var j=k.createElement("div");j.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_SELECT_FORMAT");g.getClientElem().appendChild(j);j=k.createElement("div");g.getClientElem().appendChild(j);var i=new Kekule.Widget.SelectBox(g);i.addClassName(e.DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX);i.appendToElem(j);i.addEventListener("valueChange",this.reactFormatSelectorChange,this);g._formatSelector=i;var j=k.createElement("div");j.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_PREVIEW_FILE_CONTENT");g.getClientElem().appendChild(j);j=k.createElement("div");g.getClientElem().appendChild(j);var h=new Kekule.Widget.TextEditor(g);h.setReadOnly(true);h.setWrap("off");h.setToolbarPos(Kekule.Widget.Position.BOTTOM);h.addClassName(e.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER);h.appendToElem(j);g._previewTextArea=h;return g},getAvailableWriterInfos:function(h){if(!h){return[]}else{var g=Kekule.IO.ChemDataWriterManager.getAvailableWriterInfos(null,h);return g}},getFormatSelectorItems:function(w,t){var z=[];var u=[];var q=this.getChemObjSrcInfo(w);var x=(q)?q.format:null;for(var r=0,m=t.length;r<m;++r){var h=t[r];Kekule.ArrayUtils.pushUnique(u,h.formatId)}u=Kekule.ArrayUtils.intersect(this.getAllowedFormatIds(),u);for(var r=0,m=u.length;r<m;++r){var g=Kekule.IO.DataFormatsManager.getFormatInfo(u[r]);if(g){var s=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(g.fileExts));for(var p=0,n=s.length;p<n;++p){s[p]="*."+s[p]}var y=s.join(", ");var v=g.title;if(y){v+=" ("+y+")"}var o=x?(u[r]===x):this.getLastFormat()?(this.getLastFormat()===u[r]):r===0;z.push({value:g.id,text:v,title:g.mimeType,data:g,selected:o})}}z.sort(function(j,i){return(j.text<i.text)?-1:(j.text>i.text)?1:0});return z},getAllowedFormatIds:function(){return this.getDisplayer().getAllowedOutputFormatIds()||Kekule.IO.ChemDataWriterManager.getAllWritableFormatIds()},getFileFilters:function(m){var g=[];for(var k=0,h=m.length;k<h;++k){var o=m[k];var n=o.data;var p=o.text||o.title||o.value;var j=Kekule.ArrayUtils.toArray(n.fileExts);g.push({title:p,filter:"."+j.join(",.")})}g.push(Kekule.NativeServices.FILTER_ALL_SUPPORT);g.push(Kekule.NativeServices.FILTER_ANY);return g},updateFormatItems:function(h){this._formatItems=this.getFormatSelectorItems(h,this.getAvailableWriterInfos());this._formatSelector.setItems(this._formatItems);var g=this.getFileFilters(this._formatItems);this._saveAction.setFilters(g)},reactFormatSelectorChange:function(){var g=this.getFormatDialog()._formatSelector.getValue();this.updatePreview(g,this.getFormatDialog())},updatePreview:function(j,m){var i=m._previewTextArea;i.setValue("");if(j){var l=Kekule.IO.DataFormatsManager.getFormatInfo(j);var h=this.getTargetObj();var k=this.getChemObjSrcInfo(h);if(k&&k.format===j&&k.data){i.setValue(k.data);this.setCurrSaveData(k.data)}else{var g=this.getDisplayer().saveData(j,l.dataType,h);i.setValue(g);this.setCurrSaveData(g)}}},getTargetObj:function(g){return this.getDisplayer().getSavingTargetObj()},doUpdate:function($super){$super();var g=this.getDisplayer();if(this._saveAction){this._saveAction.update()}this.setEnabled(g&&g.getEnabled()&&g.getChemObj())},doExecute:function(k){var q=this;var l=this.getFormatDialog();var p=this.getTargetObj();var h=l._formatSelector;var m=this.getAvailableWriterInfos(p);var i=this.getFormatSelectorItems(p,m);h.setItems(i);this.reactFormatSelectorChange();var n=false;if(this._saveAction){n=this._saveAction.getEnabled()}var g=l.getDialogButton(Kekule.Widget.DialogButtons.OK);if(g){g.setEnabled(n)}var j=this.getDialogShowType();var o=(j===Kekule.Widget.ShowHideType.DIALOG)?l.openModal:l.open;o.apply(l,[function(s){if(s===Kekule.Widget.DialogButtons.OK){var v=q.getCurrSaveData();q._saveAction.setData(v);var w=l._formatSelector.getValue();q.setLastFormat(w);var y=Kekule.IO.DataFormatsManager.getFormatInfo(w);var r=y.fileExts;var t=Kekule.ArrayUtils.toArray(r[0]||r);var u=[{title:y.title||y.mimeType,filter:"."+t.join(",.")},Kekule.NativeServices.FILTER_ANY];var x=Kekule.$L("ChemWidgetTexts.S_DEF_SAVE_FILENAME")+"."+t;q._saveAction.setFileName(x);q._saveAction.setFilters(u);q._saveAction.execute(k)}},k,j])}});Kekule.ChemWidget.ActionDisplayerReset=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerReset",HTML_CLASSNAME:e.ACTION_RESET,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_RESETVIEW"),Kekule.$L("ChemWidgetTexts.HINT_RESETVIEW"))},doExecute:function(){this.getDisplayer().resetDisplay()}});Kekule.ChemWidget.ActionDisplayerZoomIn=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomIn",HTML_CLASSNAME:e.ACTION_ZOOMIN,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMIN"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMIN"))},doExecute:function(){this.getDisplayer().zoomIn()}});Kekule.ChemWidget.ActionDisplayerZoomOut=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomOut",HTML_CLASSNAME:e.ACTION_ZOOMOUT,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMOUT"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMOUT"))},doExecute:function(){this.getDisplayer().zoomOut()}});Kekule.ChemWidget.ActionDisplayerResetZoom=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerResetZoom",HTML_CLASSNAME:e.ACTION_RESETZOOM,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_RESETZOOM"),Kekule.$L("ChemWidgetTexts.HINT_RESETZOOM"))},doExecute:function(){this.getDisplayer().resetZoom()}});Kekule.ChemWidget.ActionDisplayerHideHydrogens=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerHideHydrogens",HTML_CLASSNAME:e.ACTION_MOL_HIDE_HYDROGENS,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_HIDEHYDROGENS"),Kekule.$L("ChemWidgetTexts.HINT_HIDEHYDROGENS"))},doUpdate:function($super){$super();var h=this.getDisplayer();var g=h&&(h.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(g).setEnabled(this.getEnabled()&&g)},doExecute:function(){var g=!this.getChecked();this.setChecked(g);this.getDisplayer().setHideHydrogens(g)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase",initialize:function($super,h,g,j,i){$super(h,g,j);this._displayType=i;this.setCheckGroup("__molDisplayType__")},doUpdate:function($super){$super();var g=this.getDisplayer();this.setChecked(g&&g.getCurrMoleculeDisplayType()===this.getMolDisplayType())},doExecute:function(){this.getDisplayer().setMoleculeDisplayType(this._displayType);this.setChecked(true)},getMolDisplayType:function(){return this._displayType}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D",doUpdate:function($super){$super();var h=this.getDisplayer();var g=h&&(h.getRenderType()===Kekule.Render.RendererType.R2D);this.setDisplayed(g).setEnabled(this.getEnabled()&&g)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D",doUpdate:function($super){$super();var h=this.getDisplayer();var g=h&&(h.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(g).setEnabled(this.getEnabled()&&g)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_SKELETAL,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_SKELETAL"),Kekule.$L("ChemWidgetTexts.HINT_SKELETAL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE=Kekule.Render.Molecule2DDisplayType.SKELETAL;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_CONDENSED,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_CONDENSED"),Kekule.$L("ChemWidgetTexts.HINT_CONDENSED"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE=Kekule.Render.Molecule2DDisplayType.CONDENSED;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_WIRE,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_WIRE"),Kekule.$L("ChemWidgetTexts.HINT_WIRE"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE=Kekule.Render.Molecule3DDisplayType.WIRE;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_STICKS,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_STICKS"),Kekule.$L("ChemWidgetTexts.HINT_STICKS"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE=Kekule.Render.Molecule3DDisplayType.STICKS;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_BALLSTICK,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_BALLSTICK"),Kekule.$L("ChemWidgetTexts.HINT_BALLSTICK"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE=Kekule.Render.Molecule3DDisplayType.BALL_STICK;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_SPACEFILL,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_SPACEFILL"),Kekule.$L("ChemWidgetTexts.HINT_SPACEFILL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE=Kekule.Render.Molecule3DDisplayType.SPACE_FILL})();(function(){var a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEM_STRUCT_TREE_VIEW:"K-Chem-Struct-TreeView",CHEM_STRUCT_TREE_VIEW_ITEM_TITLE:"K-Chem-Struct-TreeView-ItemTitle",CHEM_STRUCT_TREE_VIEW_ITEM_TYPE:"K-Chem-Struct-TreeView-ItemType"});Kekule.ChemWidget.StructureTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.ChemWidget.StructureTreeView",initialize:function($super,b,c){$super(b);this.setPropStoreFieldValue("objMap",new Kekule.MapEx(true));this.setEnableLiveUpdate(true);this.setEnableMultiSelected(true);this.setRootObj(c)},initProperties:function(){this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:false,setter:function(c){var b=this.getPropStoreFieldValue("rootObj");this.setPropStoreFieldValue("rootObj",c);this.rootObjChanged(c,b)}});this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL});this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:false})},doGetWidgetClassName:function($super){return $super()+" "+a.CHEM_STRUCT_TREE_VIEW},rootObjChanged:function(c,b){this.clearChildItems();this.getObjMap().clear();if(b){this._uninstallRootEventHandler(b)}if(c){this._fillTree(c);this._installRootEventHandler(c)}},_installRootEventHandler:function(b){b.addEventListener("change",this.reactChemObjChange,this)},_uninstallRootEventHandler:function(b){b.removeEventListener("change",this.reactChemObjChange,this)},reactChemObjChange:function(d){if(this.getEnableLiveUpdate()){var c=d.target;var b=this.getObjMap().get(c);if(b){this._updateTreeItem(b,c)}}},_fillTree:function(b){if(b){this.clearChildItems();this._updateTreeItem(this.appendChildItem(),b)}},_updateTreeItem:function(g,k){var j=this._getChemObjDisplayTitle(k);var e={text:j,obj:k};this.setItemData(g,e);this.getObjMap().set(k,g);var b=this.getChildItemCount(g);var d=k.getChildCount();for(var f=0;f<d;++f){var c=k.getChildAt(f);if(!c.isSelectable()){continue}var h;if(f<b){h=this.getChildItemAt(g,f)}else{h=this.appendChildItem(g)}this._updateTreeItem(h,c)}if(b>d){for(var f=b-1;f>=d;--f){this.removeChildItemAt(g,f)}}},_getChemObjDisplayTitle:function(h){var b="";var g=h.getId();if(g){b+='<span class="'+a.CHEM_STRUCT_TREE_VIEW_ITEM_TITLE+'">'+g+"</span>"}var f=h.getClassName();var e=f.split(".");var d=e.length?e[e.length-1]:f;var c='<span class="'+a.CHEM_STRUCT_TREE_VIEW_ITEM_TYPE+'">('+d+")</span>";return b+c},selectChemObjs:function(d){var c=[];for(var e=0,b=d.length;e<b;++e){var g=d[e];var f=this.getObjMap().get(g);if(f){c.push(f)}}this.select(c);return this},getSelectedChemObjs:function(){var b=[];var d=this.getSelection();if(d&&d.length){for(var e=0,c=d.length;e<c;++e){var f=this.getItemData(d[e]);if(f&&f.obj){b.push(f.obj)}}}return b}})})();(function(){var a=Kekule.oneOf;Kekule.ChemWidget.AbstractUIMarker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.AbstractUIMarker",initialize:function($super){$super();this.setVisible(true)},initProperties:function(){this.defineProp("drawStyles",{dataType:DataType.OBJECT});this.defineProp("visible",{dataType:DataType.BOOL})}});Kekule.ChemWidget.MetaShapeUIMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUIMarker",initialize:function($super,b){$super();if(b){this.setShapeInfo(b)}},initProperties:function(){this.defineProp("shapeInfo",{dataType:DataType.OBJECT});this.defineProp("shapeType",{dataType:DataType.INT,serializable:false,setter:null,getter:function(){var b=this.getShapeInfo();return b?b.shapeType:null}})}});Kekule.ChemWidget.UiMarkerCollection=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection",initProperties:function(){this.defineProp("markers",{dataType:DataType.ARRAY,getter:function(){var b=this.getPropStoreFieldValue("markers");if(!b){b=[];this.setPropStoreFieldValue("markers",b)}return b},setter:null})},getMarkerCount:function(){return this.getMarkers().length},getMarkerAt:function(b){return this.getMarkers()[b]},addMarker:function(b){return this.getMarkers().push(b)},indexOfMarker:function(b){return this.getMarkers().indexOf(b)},removeMarker:function(b){var d=this.getMarkers();var c=d.indexOf(b);if(c>=0){d.splice(c,1)}},clearMarkers:function(){this.setPropStoreFieldValue("markers",[])}});Kekule.ChemWidget.UiMarkersRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkersRenderer",DRAW_ELEM_FIELD:"__$drawElem__",initialize:function($super,b,c){$super(b,c);this._drawGroup=null},initProperties:function(){this.defineProp("dummy",{dataType:DataType.OBJECT,serializable:false})},getObjDrawElem:function(b,c){return this.getExtraProp2(b,c,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(b,d,c){this.setExtraProp2(b,d,this.DRAW_ELEM_FIELD,c)},doEstimateRenderBox:function(d,e,c,b){return null},doDraw:function($super,c,d,b){$super(c,d,b);var f=this.getChemObj();var e=this.createDrawGroup(c);this.setObjDrawElem(c,f,e);if(f.getMarkerCount()>0){this.doDrawMarkers(c,e,f.getMarkers(),b)}return e},doUpdate:function($super,d,g,b){if(this.canModifyGraphic(d)){var e=false;var c=Kekule.Render.ObjectUpdateType;switch(b){case c.ADD:e=this.doAddNew(d,g);break;case c.MODIFY:e=this.doModify(d,g);break;case c.REMOVE:var f=this._extractObjsOfUpdateObjDetails(g);e=this.doRemove(d,f);break;default:return $super(d,g,b)}return e}else{return $super(d,updatedObjs,b)}},doAddNew:function(b,c){if(this.canRemoveElem()){return this.doModify(b,c)}else{return false}},doModify:function(b,g){if(this.canRemoveElem()){var e=this._extractObjsOfUpdateObjDetails(g);this.remove(b,e);var f=this.getChemObj();var c=this.getObjDrawElem(f);var d=this.getDrawParams();if(e.indexOf(f)>=0){this.draw(b,d.baseCoord,d.options)}else{this.doDrawMarkers(b,c,e,d.options)}}else{return false}},doRemove:function(b,d){if(this.canRemoveElem()){var c=this.getObjDrawElem(d);if(c){var e=this.getObjDrawElem(this.getChemObj());this.doRemoveFromGroup(c,e);this.doRemoveElem(b,c);this.setObjDrawElem(d,null)}}else{return false}},doDrawMarkers:function(f,g,h,d){for(var e=0,c=h.length;e<c;++e){var b=h[e];if(b.getVisible()){this.doDrawMarker(f,g,b,d)}}},doDrawMarker:function(b,h,f,k){var j=f.getShapeInfo();if(!j){return null}var c=Object.create(k);c=Object.extend(f.getDrawStyles()||{});if(c.color){if(!c.strokeColor){c.strokeColor=c.color}if(!c.fillColor){c.fillColor=c.color}}var m;if(Kekule.ArrayUtils.isArray(j)){if(j.length>1){m=this.createDrawGroup(b);for(var e=0,d=j.length;e<d;++e){var g=j[e];this.doDrawShape(b,m,g,c)}}else{if(j.length===1){m=this.doDrawShape(b,null,j[0],c)}else{return null}}}else{m=this.doDrawShape(b,null,j,c)}if(m){this.setObjDrawElem(b,f,m);if(h){this.addToDrawGroup(m,h)}}return m},doDrawShape:function(b,o,j,q){var f=Kekule.Render.MetaShapeType;var r;if(Kekule.Render.MetaShapeUtils.isCompositeShape(j)){r=this.createDrawGroup(b);for(var g=0,e=j.length;g<e;++g){var d=this.doDrawShape(b,r,j[g],q)}}else{var n=j.coords;switch(j.shapeType){case f.POINT:r=this.drawCircle(b,n[0],1,q);break;case f.CIRCLE:r=this.drawCircle(b,n[0],j.radius,q);break;case f.LINE:var c=q;if(j.width){c=Object.create(q);c.strokeWidth=j.width}r=this.drawLine(b,n[0],n[1],c);break;case f.RECT:r=this.drawRect(b,n[0],n[1],q);break;case f.POLYGON:var k=[];for(var g=0,e=n.length;g<e;++g){var h=(g===0)?"M":"L";k.push(h);var m=[n[g].x,n[g].y];k.push(m)}k.push("L");m=[n[0].x,n[0].y];k.push(m);var p=Kekule.Render.DrawPathUtils.makePath.apply(this,k);r=this.drawPath(b,p,q);break}}if(o){this.addToDrawGroup(r,o)}return r}});Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.ChemWidget.UiMarkersRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.UiMarkerCollection,Kekule.ChemWidget.UiMarkersRenderer)})();(function(){var b=Class.PropertyScope;var i=Kekule.ZoomUtils;var c=Kekule.ChemWidget.ComponentWidgetNames;var h=Kekule.ChemWidget;var d=Kekule.Widget.EvokeMode;Kekule.globalOptions.add("chemWidget.viewer",{toolButtons:[c.loadData,c.saveData,c.molDisplayType,c.molHideHydrogens,c.zoomIn,c.zoomOut,c.rotateX,c.rotateY,c.rotateZ,c.rotateLeft,c.rotateRight,c.reset,c.openEditor],menuItems:[c.loadData,c.saveData,Kekule.Widget.MenuItem.SEPARATOR_TEXT,c.molDisplayType,c.molHideHydrogens,c.zoomIn,c.zoomOut,{text:Kekule.$L("ChemWidgetTexts.CAPTION_ROTATE"),hint:Kekule.$L("ChemWidgetTexts.HINT_ROTATE"),children:[c.rotateLeft,c.rotateRight,c.rotateX,c.rotateY,c.rotateZ]},c.reset,Kekule.Widget.MenuItem.SEPARATOR_TEXT,c.openEditor,c.config]});Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER:"K-Chem-Viewer",VIEWER2D:"K-Chem-Viewer2D",VIEWER3D:"K-Chem-Viewer3D",VIEWER_CAPTION:"K-Chem-Viewer-Caption",VIEWER_EMBEDDED_TOOLBAR:"K-Chem-Viewer-Embedded-Toolbar",VIEWER_MENU_BUTTON:"K-Chem-Viewer-Menu-Button",ACTION_ROTATE_LEFT:"K-Chem-RotateLeft",ACTION_ROTATE_RIGHT:"K-Chem-RotateRight",ACTION_ROTATE_X:"K-Chem-RotateX",ACTION_ROTATE_Y:"K-Chem-RotateY",ACTION_ROTATE_Z:"K-Chem-RotateZ",ACTION_VIEWER_EDIT:"K-Chem-Viewer-Edit"});var f=Kekule.Widget.HtmlClassNames;var a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.Viewer=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.ChemWidget.Viewer",BINDABLE_TAG_NAMES:["div","span","img"],DEF_BGCOLOR_2D:null,DEF_BGCOLOR_3D:"#000000",DEF_TOOLBAR_EVOKE_MODES:[d.EVOKEE_CLICK,d.EVOKEE_MOUSE_ENTER,d.EVOKEE_TOUCH],DEF_TOOLBAR_REVOKE_MODES:[d.EVOKEE_MOUSE_LEAVE,d.EVOKER_TIMEOUT],initialize:function($super,j,p,m,l){this.setPropStoreFieldValue("renderType",m||Kekule.Render.RendererType.R2D);this.setPropStoreFieldValue("enableToolbar",false);this.setPropStoreFieldValue("toolbarEvokeModes",this.DEF_TOOLBAR_EVOKE_MODES);this.setPropStoreFieldValue("toolbarRevokeModes",this.DEF_TOOLBAR_REVOKE_MODES);this.setPropStoreFieldValue("enableDirectInteraction",true);this.setPropStoreFieldValue("enableTouchInteraction",true);this.setPropStoreFieldValue("toolbarPos",Kekule.Widget.Position.AUTO);this.setPropStoreFieldValue("toolbarMarginHorizontal",10);this.setPropStoreFieldValue("toolbarMarginVertical",10);this.setPropStoreFieldValue("showCaption",false);this.setPropStoreFieldValue("useCornerDecoration",true);$super(j,p,m,l);this.setPadding(this.getRenderConfigs().getLengthConfigs().getActualLength("autofitContextPadding"));this._isContinuousRepainting=false;var k=Kekule.Render.RendererType;var n=(this.getRenderType()===k.R2D)?(this.getBackgroundColor()||this.DEF_BGCOLOR_2D):this.DEF_BGCOLOR_2D;var o=(this.getRenderType()===k.R3D)?(this.getBackgroundColor()||this.DEF_BGCOLOR_3D):this.DEF_BGCOLOR_3D;this.setBackgroundColorOfType(n,k.R2D);this.setBackgroundColorOfType(o,k.R3D);this.useCornerDecorationChanged();this.doResize();this.addIaController("default",new Kekule.ChemWidget.ViewerBasicInteractionController(this),true)},doFinalize:function($super){var j=this.getToolbar();if(j){j.finalize()}$super()},initProperties:function(){this.defineProp("viewerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:false,getter:function(){return this.getDisplayerConfigs()},setter:function(j){return this.setDisplayerConfigs(j)}});this.defineProp("allowedMolDisplayTypes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(j){this.setPropStoreFieldValue("allowedMolDisplayTypes",j);this.updateUiComps()}});this.defineProp("enableRestraintRotation3D",{dataType:DataType.BOOL});this.defineProp("restraintRotation3DEdgeRatio",{dataType:DataType.FLOAT});this.defineProp("enableEdit",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableEdit")&&(this.getCoordMode()!==Kekule.CoordMode.COORD3D)}});this.defineProp("shareEditorInstance",{dataType:DataType.BOOL});this.defineProp("enableEditFromVoid",{dataType:DataType.BOOL});this.defineProp("restrainEditorWithCurrObj",{dataType:DataType.BOOL});this.defineProp("modalEdit",{dataType:DataType.BOOL});this.defineProp("editorProperties",{dataType:DataType.HASH});this.defineProp("toolButtons",{dataType:DataType.ARRAY,scope:b.PUBLIC,getter:function(){var j=this.getPropStoreFieldValue("toolButtons");return j},setter:function(j){this.setPropStoreFieldValue("toolButtons",j);this.updateToolbar()}});this.defineProp("menuItems",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(j){this.setPropStoreFieldValue("menuItems",j);this.updateMenu()}});this.defineProp("menu",{dataType:"Kekule.Widget.Menu",serializable:false,scope:b.PRIVATE,setter:function(k){var j=this.getMenu();if(k!==j){if(j){j.finalize();j=null}this.setPropStoreFieldValue("menu",k)}}});this.defineProp("toolbar",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,scope:b.PRIVATE,setter:function(m){var k=this.getToolbar();var j=this.getToolbarEvokeHelper();if(m!==k){if(k){k.finalize();var l=this.getToolbarEvokeHelper();if(l){l.finalize()}k=null}if(j){j.finalize()}this.setPropStoreFieldValue("toolbar",m);if(m){this.setPropStoreFieldValue("toolbarEvokeHelper",new Kekule.Widget.DynamicEvokeHelper(this,m,this.getToolbarEvokeModes(),this.getToolbarRevokeModes()))}}}});this.defineProp("enableToolbar",{dataType:DataType.BOOL,setter:function(j){this.setPropStoreFieldValue("enableToolbar",j);this.updateToolbar()}});this.defineProp("toolbarPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(j){this.setPropStoreFieldValue("toolbarPos",j);this.adjustToolbarPos()}});this.defineProp("toolbarMarginVertical",{dataType:DataType.INT,setter:function(j){this.setPropStoreFieldValue("toolbarMarginVertical",j);this.adjustToolbarPos()}});this.defineProp("toolbarMarginHorizontal",{dataType:DataType.INT,setter:function(j){this.setPropStoreFieldValue("toolbarMarginHorizontal",j);this.adjustToolbarPos()}});this.defineProp("toolbarEvokeHelper",{dataType:"Kekule.Widget.DynamicEvokeHelper",serializable:false,setter:null,scope:b.PRIVATE});this.defineProp("toolbarEvokeModes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(j){this.setPropStoreFieldValue("toolbarEvokeModes",j||[]);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setEvokeModes(j||[])}}});this.defineProp("toolbarRevokeModes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(j){this.setPropStoreFieldValue("toolbarRevokeModes",j||[]);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setRevokeModes(j||[])}}});this.defineProp("toolbarRevokeTimeout",{dataType:DataType.INT,setter:function(j){this.setPropStoreFieldValue("toolbarRevokeTimeout",j);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setTimeout(j)}}});this.defineProp("toolbarParentElem",{dataType:DataType.OBJECT,serializable:false,setter:function(j){if(this.getToolbarParentElem()!==j){this.setPropStoreFieldValue("toolbarParentElem",j);this.updateToolbar()}}});this.defineProp("caption",{dataType:DataType.STRING,setter:function(j){this.setPropStoreFieldValue("caption",j);Kekule.DomUtils.setElementText(this.getCaptionElem(),j||"");this.captionChanged()}});this.defineProp("showCaption",{dataType:DataType.BOOL,setter:function(j){this.setPropStoreFieldValue("showCaption",j);this.captionChanged()}});this.defineProp("captionPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(j){this.setPropStoreFieldValue("captionPos",j);this.captionChanged()}});this.defineProp("autoCaption",{dataType:DataType.BOOL,setter:function(j){this.setPropStoreFieldValue("autoCaption",j);if(j){this.autoDetectCaption()}}});this.defineProp("captionElem",{dataType:DataType.OBJECT,scope:b.PRIVATE,setter:null,getter:function(k){var j=this.getPropStoreFieldValue("captionElem");if(!j&&!k){j=this.doCreateCaptionElem();this.setPropStoreFieldValue("captionElem",j)}return j}});this.defineProp("actions",{dataType:"Kekule.ActionList",serializable:false,scope:b.PUBLIC,setter:null,getter:function(){var j=this.getPropStoreFieldValue("actions");if(!j){j=new Kekule.ActionList();this.setPropStoreFieldValue("actions",j)}return j}});this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:false,scope:b.PRIVATE,setter:null,getter:function(){var j=this.getPropStoreFieldValue("actionMap");if(!j){j=new Kekule.MapEx(true);this.setPropStoreFieldValue("actionMap",j)}return j}});this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL});this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL})},initPropValues:function($super){this.setModalEdit(true);this.setRestrainEditorWithCurrObj(true);this.setRestraintRotation3DEdgeRatio(0.18);this.setEnableRestraintRotation3D(true);this.setShareEditorInstance(true)},canUsePlaceHolderOnElem:function(k){var j=k.getAttribute("src");return(k.tagName.toLowerCase()==="img")&&(!!j)},doObjectChange:function($super,j){$super(j);this.updateActions()},doSetElement:function($super,k){var l=k;if(l){var j=l.tagName.toLowerCase();if(j==="img"){l=Kekule.DomUtils.replaceTagName(l,"span")}}return $super(l)},doUnbindElement:function($super,j){if(this._drawContextParentElem&&this._drawContextParentElem.parentNode){this._drawContextParentElem.parentNode.removeChild(this._drawContextParentElem);this._drawContextParentElem=null}return $super(j)},doCreateRootElement:function(k){var j=k.createElement("div");return j},doGetWidgetClassName:function($super){var k=$super()+" "+a.VIEWER;try{var l=this.getRenderType();var j=this._getRenderTypeSpecifiedHtmlClassName(l);k+=" "+j}catch(m){}return k},_getRenderTypeSpecifiedHtmlClassName:function(j){return(j===Kekule.Render.RendererType.R3D)?a.VIEWER3D:a.VIEWER2D},getResizerElement:function(){return this.getDrawContextParentElem()},doResize:function($super){this.adjustDrawParentDim();this.adjustToolbarPos();$super()},doWidgetShowStateChanged:function(j){if(j){this.updateActions()}},refitDrawContext:function($super,j){$super(j);this.adjustToolbarPos()},getAllowRenderTypeChange:function(){return true},resetRenderType:function($super,m,k){$super(m,k);var l=this._getRenderTypeSpecifiedHtmlClassName(m);var j=this._getRenderTypeSpecifiedHtmlClassName(k);this.removeClassName(l);this.addClassName(j);this.updateUiComps()},doLoadEnd:function(j){this.updateActions();this.autoDetectCaption()},doSetUseCornerDecoration:function($super,j){$super(j);this.useCornerDecorationChanged()},useCornerDecorationChanged:function(){var k=this.getDrawContextParentElem();if(k){var j=this.getUseCornerDecoration();if(j){Kekule.HtmlElementUtils.addClass(k,f.CORNER_ALL)}else{Kekule.HtmlElementUtils.removeClass(k,f.CORNER_ALL)}}},adjustDrawParentDim:function(){var m=this.getDrawContextParentElem();var k=m.parentNode;var p=this.getCaptionElem(true);var o=Kekule.HtmlElementUtils.getElemClientDimension(k);var l,n;if(p&&this.captionIsShown()&&p.parentNode===k){var j=Kekule.HtmlElementUtils.getElemClientDimension(p);n=Math.max(o.height-j.height,0);l=(this.getCaptionPos()&Kekule.Widget.Position.TOP)?j.height:0;m.style.top=l+"px";m.style.height=n+"px"}else{Kekule.StyleUtils.removeStyleProperty(m.style,"top");Kekule.StyleUtils.removeStyleProperty(m.style,"height")}},getInteractionReceiverElem:function(){return this.getDrawContextParentElem()},setDrawDimension:function($super,m,k){var l=k;if(this.captionIsShown()){var j=Kekule.HtmlElementUtils.getElemClientDimension(this.getCaptionElem());l+=j.height||0}$super(m,l)},doCreateCaptionElem:function(){var j=this.getDocument().createElement("span");j.className=f.DYN_CREATED+"  "+f.SELECTABLE+" "+a.VIEWER_CAPTION;this.getElement().appendChild(j);return j},captionChanged:function(){if(this.captionIsShown()){var k=this.getCaptionElem();var j=k.style;var l=this.getCaptionPos();if(l&Kekule.Widget.Position.TOP){j.top=0;j.bottom="auto"}else{j.bottom=0;j.top="auto"}j.display="block"}else{var k=this.getCaptionElem(true);if(k){k.style.display="none"}}this.doResize()},captionIsShown:function(){return this.getCaption()&&this.getShowCaption()},getAllowEditing:function(){return(this.getCoordMode()!==Kekule.CoordMode.COORD3D)&&this.getEnableEdit()&&(this.getChemObj()||this.getEnableEditFromVoid())},getComposerDialog:function(){var j;if(this.getShareEditorInstance()){j=Kekule.ChemWidget.Viewer._composerDialog}else{j=this._composerDialog}if(!j){if(Kekule.Editor.ComposerDialog){j=new Kekule.Editor.ComposerDialog(this,Kekule.$L("ChemWidgetTexts.CAPTION_EDIT_OBJ"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL])}}if(this.getShareEditorInstance()){Kekule.ChemWidget.Viewer._composerDialog=j}else{this._composerDialog=j}return j},openEditor:function(p){if(this.getAllowEditing()){var r=this.getChemObj();var m;var l=!r;var k=r&&r.isEmpty&&r.isEmpty();var s=this.getRestrainEditorWithCurrObj();var o=this.getComposerDialog();if(!o){Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"));return}var j=o.getComposer();j.setEnableCreateNewDoc(l||!s);j.setEnableLoadNewFile(l||!s);j.setAllowCreateNewChild(l||!s);var n=this.getEditorProperties();if(n){j.setPropValues(n)}if(!l&&!k){m=r.clone();o.setChemObj(m)}else{o.getComposer().newDoc()}var t=this;var q=function(v){if(v===Kekule.Widget.DialogButtons.OK&&o.getComposer().isDirty()){var u=o.getSavingTargetObj();if(l){t.setChemObj(u.clone())}else{if(t.getRestrainEditorWithCurrObj()){if(r.getClass()===u.getClass()){r.assign(u.clone())}else{r.assign(m)}r.setSrcInfo(null);t.setChemObj(r)}else{t.setChemObj(u)}}}};if(this.getModalEdit()){o.openModal(q,p||this)}else{o.openPopup(q,p||this)}}},resetView:function(){return this.resetDisplay()},getCurr2DRotationAngle:function(){return this.getDrawOptions().rotateAngle||0},rotate2DBy:function(k,j){return this.rotate2DTo(this.getCurr2DRotationAngle()+k,j)},rotate2DTo:function(k,j){this.getDrawOptions().rotateAngle=k;if(!j){this.geometryOptionChanged()}return this},getCurr3DRotationInfo:function(){var k={};var j=["rotateMatrix","rotateX","rotateY","rotateZ","rotateAngle"];var o=this.getDrawOptions();for(var n=0,m=j.length;n<m;++n){var p=j[n];k[p]=o[p]||0}k.rotateAxisVector=o.rotateAxisVector||null;return k},setRotate3DMatrix:function(j,k){this.getDrawOptions().rotateMatrix=j;if(!k){this.geometryOptionChanged()}return this},rotate3DBy:function(k,j,q,n){var o=this.getCurr3DRotationInfo();var p=o.rotateMatrix||Kekule.MatrixUtils.createIdentity(4);var m=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:k,rotateY:j,rotateZ:q});var l=Kekule.MatrixUtils.multiply(m,p);this.setRotate3DMatrix(l,n);return this},rotate3DByAxis:function(p,n,l){var m=this.getCurr3DRotationInfo();var o=m.rotateMatrix||Kekule.MatrixUtils.createIdentity(4);var k=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:p,rotateAxisVector:n});var j=Kekule.MatrixUtils.multiply(k,o);this.setRotate3DMatrix(j,l);return this},getDefaultToolBarButtons:function(){return Kekule.globalOptions.chemWidget.viewer.toolButtons},isToolbarEmbedded:function(){return !this.getToolbarParentElem()},adjustToolbarPos:function(){var v=this.getToolbar();if(!v){return}if(this.isToolbarEmbedded()){var m=Kekule.Widget.Position;var r=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getDrawContextParentElem());var p=v.getBoundingClientRect();var u=this.getToolbarPos();var j=this.getToolbarMarginHorizontal();var q=this.getToolbarMarginVertical();var k="left",t="top";var l="right",o="bottom";var s=(r.width-p.width)/2;var w=(r.height-p.height)/2;if(u===m.AUTO||!u){var n=((j>0)?j:0)*2+p.width;var x=((q>0)?q:0)*2+p.height;if(n>r.width){u|=m.LEFT;j=0}else{u|=m.RIGHT}if(x>r.height/2){u|=m.BOTTOM;q=-1}else{u|=m.BOTTOM}}if(u&m.LEFT){k="left";l="right";s=(j>=0)?j:j-p.width}else{if(u&m.RIGHT){k="right";l="left";s=(j>=0)?j:j-p.width}}if(u&m.TOP){t="top";o="bottom";w=(q>=0)?q:q-p.height}else{if(u&m.BOTTOM){t="bottom";o="top";w=(q>=0)?q:q-p.height}}v.removeStyleProperty(l);v.removeStyleProperty(o);v.setStyleProperty(k,s+"px");v.setStyleProperty(t,w+"px")}else{v.removeStyleProperty("left");v.removeStyleProperty("top");v.removeStyleProperty("width");v.removeStyleProperty("height")}},updateToolbar:function(){if(this.getEnableToolbar()){this.createToolbar();this.adjustToolbarPos()}else{this.setToolbar(null)}},updateMenu:function(){this.createMenu()},updateUiComps:function(){this.updateToolbar();this.updateMenu()},updateActions:function(){if(this.getActions()){this.getActions().updateAll()}},clearActions:function(){this.getActions().clear();this.getActionMap().clear()},getCompActionClass:function(j){return this.getChildActionClass(j,true)},_getActionOfComp:function(k,o,m){var l=this.getActionMap();var j=l.get(k);if(!j&&o){var n=this.getCompActionClass(k)||m;if(n){j=new n(this);l.set(k,j);this.getActions().add(j)}}return j},createToolbar:function(){this.clearActions();var k=new Kekule.Widget.ButtonGroup(this);k.addClassName(f.DYN_CREATED);k.setDisplayed(false);k.setShowText(false);k.doSetShowGlyph(true);var p=this.getToolButtons()||this.getDefaultToolBarButtons();for(var o=0,j=p.length;o<j;++o){var m=p[o];var n=this.createToolButton(m,k)}k.addClassName(a.INNER_TOOLBAR);if(this.isToolbarEmbedded()){k.addClassName(a.VIEWER_EMBEDDED_TOOLBAR)}k.appendToElem(this.getToolbarParentElem()||this.getElement());this.setToolbar(k);return k},createToolButton:function(r,p){var s=null;var m=this.beginContinuousRepainting.bind(this);var k=this.endContinuousRepainting.bind(this);var n=[c.rotateX,c.rotateY,c.rotateZ,c.rotateLeft,c.rotateRight];if(DataType.isObjectValue(r)){var q=Object.extend({widget:Kekule.Widget.Button},r);s=Kekule.Widget.Utils.createFromHash(p,q);var o=q.actionClass;if(o){if(typeof(o)==="string"){o=ClassEx.findClass(q.actionClass)}}if(o){var l=this._getActionOfComp(s,true,o);if(l){s.setAction(l)}}}else{if(r===c.molDisplayType){return this.createMolDisplayTypeButton(p)}else{if(r===c.menu){return this.createMenuButton(p)}}var o=this.getCompActionClass(r);var j=Kekule.Widget.Button;if(r===c.molHideHydrogens){j=Kekule.Widget.CheckButton}s=new j(p);var l=this._getActionOfComp(r,true);if(l){s.setAction(l)}if(n.indexOf(r)>=0){s.setPeriodicalExecInterval(20);s.setEnablePeriodicalExec(true);s.addEventListener("activate",m);s.addEventListener("deactivate",k)}}return s},createMenuButton:function(k){var j=new Kekule.Widget.DropDownButton(k);j.setText(Kekule.$L("WidgetTexts.CAPTION_MENU")).setHint(Kekule.$L("WidgetTexts.HINT_MENU"));j.addClassName(a.VIEWER_MENU_BUTTON);if(!this.getMenu()){this.createMenu()}j.setDropDownWidget(this.getMenu());return j},createMolDisplayTypeButton:function(r){var t=new Kekule.Widget.CompactButtonSet(r);t.getButtonSet().addClassName(a.INNER_TOOLBAR);t.setShowText(false);var m=this._getActionOfComp(c.molDisplayType,true);t.setAction(m);this.getActions().add(m);var s=this.getDocument();var p=this.getAllowedMolDisplayTypes();var q=this._getUsableMolDisplayActionClasses(p);for(var o=0,k=q.length;o<k;++o){var n=q[o].TYPE;var j=new Kekule.Widget.RadioButton(s);var m=this._getActionOfComp(c.molDisplayType+n,true,q[o]);j.setAction(m);t.append(j,n===this.getCurrMoleculeDisplayType())}return t},_getUsableMolDisplayActionClasses:function(p){var j=[];var o=(this.getRenderType()===Kekule.Render.RendererType.R3D)?h.Viewer.molDisplayType3DActionClasses:h.Viewer.molDisplayType2DActionClasses;for(var n=0,k=o.length;n<k;++n){var m=o[n].TYPE;if(p&&(p.indexOf(m)<0)&&(m!==this.getCurrMoleculeDisplayType())){continue}j.push(o[n])}return j},getDefaultMenuItems:function(){return Kekule.globalOptions.chemWidget.viewer.menuItems},prepareMenuItems:function(k){var o=Kekule.Widget.MenuItem.SEPARATOR_TEXT;for(var n=0,j=k.length;n<j;++n){var p=k[n];if(typeof(p)==="string"){if(p!==o){var q=this.createPredefinedMenuItemDefHash(p);if(q){k[n]=q}}}else{if(!p.widget&&!p.widgetClass){var m=Object.extend({},p);m.widget=Kekule.Widget.MenuItem;p=m;k[n]=m}if(p.children&&p.children.length){this.prepareMenuItems(p.children)}}}return k},createPredefinedMenuItemDefHash:function(l){if(l===c.molDisplayType){return this.createMolDisplayMenuDefHash()}var k=[c.rotateX,c.rotateY,c.rotateZ,c.rotateLeft,c.rotateRight];var n=this.beginContinuousRepainting.bind(this);var q=this.endContinuousRepainting.bind(this);var o=this.getCompActionClass(l);var p=Kekule.Widget.MenuItem;var j=null;var m=this._getActionOfComp(l,true);if(m){j={widget:p,action:m};if(k.indexOf(l)>=0){j=Object.extend(j,{periodicalExecInterval:20,enablePeriodicalExec:true,"#activate":n,"@deactivate":q})}}return j},createMolDisplayMenuDefHash:function(){var q=this._getActionOfComp(c.molDisplayType,true);var j={widget:Kekule.Widget.MenuItem,action:q};var p=[];var m=this.getAllowedMolDisplayTypes();var r=this._getUsableMolDisplayActionClasses(m);for(var o=0,k=r.length;o<k;++o){var n=r[o].TYPE;var q=this._getActionOfComp(c.molDisplayType+n,true,r[o]);p.push({widget:Kekule.Widget.MenuItem,action:q})}if(p.length){j.children=[{widget:Kekule.Widget.PopupMenu,children:p}]}return j},createMenu:function(){var j=this.getMenu();if(!j){j=new Kekule.Widget.PopupMenu(this);j.addClassName(f.DYN_CREATED);j.setDisplayed(false)}else{j.clearMenuItems()}var k=this.getMenuItems()||this.getDefaultMenuItems();k=this.prepareMenuItems(k);j.createChildrenByDefs(k);this.setMenu(j);return j},autoDetectCaption:function(){if(this.getAutoCaption()){var l=this.getChemObj();if(l){var k=l&&l.getInfo();var m=l&&l.getSrcInfo();if(k&&m){var j=k.title||k.caption||l.getName()||m.fileName;if(j){this.setCaption(j)}}}}}});var g=Kekule.X.Event;Kekule.ChemWidget.ViewerBasicInteractionController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.ChemWidget.ViewerBasicInteractionController",initialize:function($super,j){$super(j);this._enableMouseRotate=true;this._transformInfo={isTransforming:false,lastCoord:null,lastZoom:null};this._restraintCoord=null},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:false,getter:function(){return this.getWidget()},setter:function(j){this.setWidget(j)}})},getViewerRenderType:function(){return this.getViewer().getRenderType()},getEnableInteraction:function(){var k=this.getViewer();var j=!!(k&&k.getEnableDirectInteraction()&&k.getChemObjLoaded());return j},getEnableTouchInteraction:function(){var k=this.getViewer();var j=!!(k&&k.getEnableDirectInteraction()&&k.getEnableTouchInteraction()&&k.getChemObjLoaded());return j},_initTransform:function(){var o=this.getViewer();var k=o.getOffsetWidth();var l=o.getOffsetHeight();var j;var n=this._transformInfo;var m=this._restraintCoord;if(m){j=(m==="x")?l:k;n.angleRatio=1/j*Math.PI*2}else{j=Math.min(k,l);n.angleRatio=1/j*Math.PI}},zoomViewer:function(k){var j=this.getViewer();if(!j||!j.getChemObj()){return}if(k>0){if(j.zoomIn){j.zoomIn(k)}}else{if(k<0){if(j.zoomOut){j.zoomOut(-k)}}}},isEventFromInteractionArea:function(l){var k=l.getTarget();var j=this.getViewer().getInteractionReceiverElem();return(k===j)||Kekule.DomUtils.isDescendantOf(k,j)},_beginInteractTransformAtCoord:function(l,j,m,k){var o=this.getViewer();if(o&&o.getChemObj()){var n=this._transformInfo;n.isTransforming=true;n.lastCoord={x:l,y:j};this._restraintCoord=this._calcRestraintRotateCoord(m,k);this._initTransform()}},_calcRestraintRotateCoord:function(l,k){var s=this.getViewer();var y=null;var w=this._getRestraintRotate3DEdgeSize();if(w>0){var o=s.getInteractionReceiverElem();var v=Kekule.HtmlElementUtils.getElemBoundingClientRect(o,false);var m=l-v.left;var x=k-v.top;var j=v.right-l;var u=v.bottom-k;var p,n,r,q;if(m<=j){r=1;p=m}else{r=-1;p=j}if(x<=u){q=1;n=x}else{q=-1;n=u}var t=Math.min(p,n);if(t>w){return null}else{if(n>t){if(r<0){y="x"}}else{if(q>0){y="z"}else{y="y"}}}}return y},_interactTransformAtCoord:function(k,j){if(this.getViewerRenderType()===Kekule.Render.RendererType.R3D){this.rotateByXYDistance(k,j)}else{this.moveByXYDistance(k,j)}},_getRestraintRotate3DEdgeSize:function(){var l=this.getViewer();if(l.getEnableRestraintRotation3D()&&l.getRenderType()===Kekule.Render.RendererType.R3D){var k=l.getDimension();var j=Math.min(k.width,k.height);return j*(l.getRestraintRotation3DEdgeRatio()||0)}else{return 0}},needReactEvent:function(j){return this.getEnableInteraction()&&this.isEventFromInteractionArea(j)},needReactToTouchEvent:function(k){var j=k.getTouches();return this.getEnableTouchInteraction()&&j&&j.length>1},react_dblclick:function(j){if(this.needReactEvent(j)){this.getViewer().resetDisplay()}},react_mousewheel:function(j){if(this.needReactEvent(j)){var k=j.wheelDeltaY||j.wheelDelta;if(k){k/=120}this.zoomViewer(k);j.preventDefault();return true}},react_mousedown:function(j){if(!this.needReactEvent(j)){return}if(j.getButton()===g.MouseButton.LEFT){this._beginInteractTransformAtCoord(j.getScreenX(),j.getScreenY(),j.getClientX(),j.getClientY())}},react_touchstart:function(l){if(!this.needReactEvent(l)||!this.needReactToTouchEvent(l)){return}var j=l.getTouches()[0];var k=Kekule.ObjUtils.notUnset;if(j&&k(j.screenX)&&k(j.screenY)){this._beginInteractTransformAtCoord(j.screenX,j.screenY,j.clientX,j.clientY);l.stopPropagation();l.preventDefault()}},react_mouseleave:function(j){this._transformInfo.isTransforming=false},react_touchleave:function(j){this._transformInfo.isTransforming=false},react_touchcancel:function(j){this._transformInfo.isTransforming=false},react_mouseup:function(j){if(j.getButton()===g.MouseButton.LEFT){this._transformInfo.isTransforming=false}},react_touchend:function(j){this._transformInfo.isTransforming=false},react_mousemove:function(j){if(!this.needReactEvent(j)){return}this._interactTransformAtCoord(j.getScreenX(),j.getScreenY())},react_touchmove:function(l){if(!this.needReactEvent(l)||!this.needReactToTouchEvent(l)){return}var j=l.getTouches()[0];var k=Kekule.ObjUtils.notUnset;if(j&&k(j.screenX)&&k(j.screenY)){this._interactTransformAtCoord(j.screenX,j.screenY);l.stopPropagation();l.preventDefault()}},moveByXYDistance:function(l,k){var n=this._transformInfo;if(n&&n.isTransforming&&(!n.calculating)){var o=this.getViewer();if(o.getRenderType()===Kekule.Render.RendererType.R3D){return}n.calculating=true;try{var m={x:l,y:k};var p=Kekule.CoordUtils.substract(m,n.lastCoord);var j=o.getBaseCoordOffset()||{};j=Kekule.CoordUtils.add(j,p);o.setBaseCoordOffset(j);n.lastCoord=m}finally{n.calculating=false}}},rotateByXYDistance:function(m,l){var n=this._transformInfo;if(n&&n.isTransforming&&(!n.calculating)){var q=this.getViewer();if(q.getRenderType()!==Kekule.Render.RendererType.R3D){return}n.calculating=true;try{var k={x:m,y:l};var t=Kekule.CoordUtils.substract(k,n.lastCoord);t.y=-t.y;var o,p,s;if(this._restraintCoord){var j=this._restraintCoord;if(j==="x"){o=t.y;s={x:1,y:0,z:0}}else{o=t.x;if(j==="y"){s={x:0,y:-1,z:0}}else{s={x:0,y:0,z:1}}}p=-o*n.angleRatio}else{o=Kekule.CoordUtils.getDistance({x:0,y:0},t);p=o*n.angleRatio;s={x:-t.y,y:t.x,z:0}}q.rotate3DByAxis(p,s);n.lastCoord=k;n.calculating=false}catch(r){}finally{n.calculating=false}}},doTestMouseCursor:function(m,l){var j="";var k=this._transformInfo;if(k.isTransforming){j="move"}return j}});Kekule.ChemWidget.Viewer2D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer2D",initialize:function($super,j,k){$super(j,k,Kekule.Render.RendererType.R2D)},getAllowRenderTypeChange:function(){return false}});Kekule.ChemWidget.Viewer3D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer3D",initialize:function($super,j,k){$super(j,k,Kekule.Render.RendererType.R3D)},getAllowRenderTypeChange:function(){return false}});var e=Kekule.ObjPropSettingManager;e.register("Kekule.ChemWidget.Viewer.fullFunc",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:true,enableEdit:true,toolButtons:null});e.register("Kekule.ChemWidget.Viewer.basic",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:false,toolButtons:[c.saveData,c.molDisplayType,c.zoomIn,c.zoomOut],menuItems:[c.saveData,"-",c.molDisplayType,c.zoomIn,c.zoomOut]});e.register("Kekule.ChemWidget.Viewer.mini",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:false,toolButtons:[c.menu],menuItems:[c.saveData,"-",c.molDisplayType,c.zoomIn,c.zoomOut]});e.register("Kekule.ChemWidget.Viewer.static",{enableToolbar:false,enableDirectInteraction:false,enableTouchInteraction:false,toolButtons:[],menuItems:[]});e.register("Kekule.ChemWidget.Viewer.editOnly",{enableToolbar:true,enableEdit:true,toolButtons:[c.openEditor],menuItems:[c.openEditor]});Kekule.ChemWidget.Viewer.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.ChemWidget.Viewer.Settings",initProperties:function(){this.defineDelegatedProps(["enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","enableEdit","modalEdit"])},getViewer:function(){return this.getWidget()}});Kekule.ChemWidget.ActionOnViewer=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionOnViewer",initialize:function($super,l,j,k){$super(l,j,k)},doUpdate:function(){var j=this.getDisplayer();this.setEnabled(j&&j.getChemObj()&&j.getChemObjLoaded()&&j.getEnabled())},getViewer:function(){var j=this.getDisplayer();return(j instanceof Kekule.ChemWidget.Viewer)?j:null}});Kekule.ChemWidget.ActionViewerRotateBase=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase",initialize:function($super,l,j,k){$super(l,j,k);this.setDelta(2*Math.PI/180)},initProperties:function(){this.defineProp("delta",{dataType:DataType.FLOAT})},isShiftModified:function(j){return j&&j.getShiftKey()}});Kekule.ChemWidget.ActionViewerRotateBase2D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase2D",doUpdate:function($super){$super();var k=this.getViewer();var j=k&&(k.getRenderType()===Kekule.Render.RendererType.R2D);this.setDisplayed(j).setEnabled(this.getEnabled()&&j)}});Kekule.ChemWidget.ActionViewerRotateBase3D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase3D",doUpdate:function($super){$super();var k=this.getViewer();var j=k&&(k.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(j).setEnabled(this.getEnabled()&&j)}});Kekule.ChemWidget.ActionViewerRotateLeft=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateLeft",HTML_CLASSNAME:a.ACTION_ROTATE_LEFT,initialize:function($super,j){$super(j,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATELEFT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATELEFT"))},doExecute:function(k,j){var l=this.getDelta();this.getViewer().rotate2DBy(l)}});Kekule.ChemWidget.ActionViewerRotateRight=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateRight",HTML_CLASSNAME:a.ACTION_ROTATE_RIGHT,initialize:function($super,j){$super(j,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATERIGHT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATERIGHT"))},doExecute:function(k,j){var l=-this.getDelta();this.getViewer().rotate2DBy(l)}});Kekule.ChemWidget.ActionViewerRotateX=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateX",HTML_CLASSNAME:a.ACTION_ROTATE_X,initialize:function($super,j){$super(j,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEX"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEX"))},doExecute:function(l,k){var j=this.isShiftModified(k);var m=-this.getDelta();if(j){m=-m}this.getViewer().rotate3DBy(m,0,0)}});Kekule.ChemWidget.ActionViewerRotateY=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateY",HTML_CLASSNAME:a.ACTION_ROTATE_Y,initialize:function($super,j){$super(j,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEY"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEY"))},doExecute:function(l,k){var j=this.isShiftModified(k);var m=-this.getDelta();if(j){m=-m}this.getViewer().rotate3DBy(0,m,0)}});Kekule.ChemWidget.ActionViewerRotateZ=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateZ",HTML_CLASSNAME:a.ACTION_ROTATE_Z,initialize:function($super,j){$super(j,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEZ"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEZ"))},doExecute:function(l,k){var j=this.isShiftModified(k);var m=-this.getDelta();if(j){m=-m}this.getViewer().rotate3DBy(0,0,m)}});Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub",initialize:function($super,j){$super(j,Kekule.$L("ChemWidgetTexts.CAPTION_MOL_DISPLAY_TYPE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_DISPLAY_TYPE"))},doExecute:function(j){}});Kekule.ChemWidget.ActionViewerEdit=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerEdit",HTML_CLASSNAME:a.ACTION_VIEWER_EDIT,initialize:function($super,j){$super(j,Kekule.$L("ChemWidgetTexts.CAPTION_OPENEDITOR"),Kekule.$L("ChemWidgetTexts.HINT_OPENEDITOR"))},doUpdate:function($super){$super();var j=this.getViewer();this.setEnabled(j&&j.getAllowEditing()&&j.getEnabled());this.setDisplayed(j&&j.getEnableEdit())},doExecute:function(j){var k=this.getViewer();k.openEditor(j)}});Kekule.ChemWidget.Viewer.rotate2DActionClasses=[h.ActionViewerRotateLeft,h.ActionViewerRotateRight];Kekule.ChemWidget.Viewer.rotate3DActionClasses=[h.ActionViewerRotateX,h.ActionViewerRotateY,h.ActionViewerRotateZ];Kekule.ChemWidget.Viewer.molDisplayType2DActionClasses=[h.ActionDisplayerChangeMolDisplayTypeSkeletal,h.ActionDisplayerChangeMolDisplayTypeCondensed];Kekule.ChemWidget.Viewer.molDisplayType3DActionClasses=[h.ActionDisplayerChangeMolDisplayTypeWire,h.ActionDisplayerChangeMolDisplayTypeSticks,h.ActionDisplayerChangeMolDisplayTypeBallStick,h.ActionDisplayerChangeMolDisplayTypeSpaceFill];Kekule._registerAfterLoadProc(function(){var l=Kekule.ActionManager;var j=Kekule.ChemWidget;var m=Kekule.ChemWidget.Viewer;var k=l.registerNamedActionClass;k(c.loadFile,j.ActionDisplayerLoadFile,m);k(c.loadData,j.ActionDisplayerLoadData,m);k(c.saveData,j.ActionDisplayerSaveFile,m);k(c.clearObjs,j.ActionDisplayerClear,m);k(c.zoomIn,j.ActionDisplayerZoomIn,m);k(c.zoomOut,j.ActionDisplayerZoomOut,m);k(c.rotateLeft,j.ActionViewerRotateLeft,m);k(c.rotateRight,j.ActionViewerRotateRight,m);k(c.rotateX,j.ActionViewerRotateX,m);k(c.rotateY,j.ActionViewerRotateY,m);k(c.rotateZ,j.ActionViewerRotateZ,m);k(c.reset,j.ActionDisplayerReset,m);k(c.molHideHydrogens,j.ActionDisplayerHideHydrogens,m);k(c.molDisplayType,j.ActionViewerChangeMolDisplayTypeStub,m);k(c.openEditor,j.ActionViewerEdit,m);k(c.config,Kekule.Widget.ActionOpenConfigWidget,m);k(c.molDisplayTypeCondensed,j.ActionDisplayerChangeMolDisplayTypeCondensed,m);k(c.molDisplayTypeSkeletal,j.ActionDisplayerChangeMolDisplayTypeSkeletal,m);k(c.molDisplayTypeWire,j.ActionDisplayerChangeMolDisplayTypeWire,m);k(c.molDisplayTypeSticks,j.ActionDisplayerChangeMolDisplayTypeSticks,m);k(c.molDisplayTypeBallStick,j.ActionDisplayerChangeMolDisplayTypeBallStick,m);k(c.molDisplayTypeSpaceFill,j.ActionDisplayerChangeMolDisplayTypeSpaceFill,m)})})();(function(){var c=Class.PropertyScope;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER_GRID:"K-Chem-Viewer-Grid"});var a=Kekule.Widget.HtmlClassNames;var b=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ViewerGrid=Class.create(Kekule.Widget.WidgetGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid",initialize:function($super,d,f,e){this.setPropStoreFieldValue("renderType",f);this.setPropStoreFieldValue("viewerConfigs",e);$super(d)},initProperties:function(){this._shadowedPropPairs=[];this.defineProp("renderType",{dataType:DataType.INT,serializable:false,setter:null,scope:c.PUBLIC});this.defineProp("chemObjs",{dataType:DataType.ARRAY,serializable:false,setter:null,getter:function(){var d=[];this.each(function(e){d.push(e.getChemObj())});return d}});this.defineViewerShadowProps(["drawOptions","moleculeDisplayType","zoom","autoSize","enableLoadNewFile","viewerConfigs","allowedMolDisplayTypes","enableEdit","modalEdit","toolButtons","enableToolbar","toolbarPos","toolbarMarginVertical","toolbarMarginHorizontal","toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","caption","showCaption","autoCaption","captionPos","enableDirectInteraction","enableTouchInteraction"]);this.defineViewerShadowProps(["viewerPredefinedSetting"],["predefinedSetting"]);this.defineProp("actionLoadData",{dataType:"Kekule.ChemWidget.ActionDisplayerLoadData",serializable:false,scope:c.PRIVATE,setter:null,getter:function(){var d=this.getPropStoreFieldValue("actionLoadData");if(!d){d=new Kekule.ChemWidget.ActionDisplayerLoadData();this.setPropStoreFieldValue("actionLoadData",d)}return d}})},defineViewerShadowProps:function(j,f){if(!f){f=[]}for(var g=0,e=j.length;g<e;++g){var h=j[g];var d=f[g]||j[g];this.defineViewerShadowProp(h,d)}},defineViewerShadowProp:function(h,f){if(!f){f=h}var e=Kekule.ChemWidget.Viewer;var g=ClassEx.getPropInfo(e,f);if(g){var d=Object.create(g);d.getter=undefined;d.setter=function(i){this.setPropStoreFieldValue(h,i);this.each(function(j){j.setPropValue(f,i)})};this.defineProp(h,d);this._shadowedPropPairs.push({prop:h,viewerProp:f})}},doGetWidgetClassName:function($super){return $super()+" "+b.VIEWER_GRID},createWidget:function($super){var f=this.getDocument();var e=new Kekule.ChemWidget.LoadDataDialog(f);var d=this;e.openModal(function(g){if(e.isPositiveResult(g)){var i=e.getChemObj();if(i){var h=d.doCreateNewChildWidget(f,i);h.setParent(d)}}},this.getAddingCell())},doCreateNewChildWidget:function(e,f){var d=new Kekule.ChemWidget.Viewer(e,null,this.getRenderType(),this.getViewerConfigs());this.doSetShadowedPropValuesToViewer(d);if(!f){}else{d.setChemObj(f)}return d},doSetShadowedPropValuesToViewer:function(h){for(var e=0,d=this._shadowedPropPairs.length;e<d;++e){var g=this._shadowedPropPairs[e];var f=this.getPropValue(g.prop);h.setPropValue(g.viewerProp,f)}},addChemObj:function(d){this.doCreateNewChildWidget(this.getDocument(),d).setParent(this);return this},removeChemObj:function(e){var d=this;this.each(function(f){if(f.getChemObj()===e){d.removeWidget(f,true)}});return this}});Kekule.ChemWidget.ViewerGrid2D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid2D",initialize:function($super,d,e){$super(d,Kekule.Render.RendererType.R2D,e)}});Kekule.ChemWidget.ViewerGrid3D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid3D",initialize:function($super,d,e){$super(d,Kekule.Render.RendererType.R3D,e)}})})();(function(){var f=Class.PropertyScope;var d=Kekule.DomUtils;var a=Kekule.ArrayUtils;var c=Kekule.ChemWidget;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMOBJSETTER:"K-Chem-Obj-Setter",CHEMOBJSETTER_TOOLBAR_AREA:"K-Chem-Obj-Setter-Toolbar-Area",CHEMOBJSETTER_CLIENT:"K-Chem-Obj-Setter-Client",CHEMOBJSETTER_VIEWER:"K-Chem-Obj-Setter-Viewer",CHEMOBJSETTER_TABGROUP:"K-Chem-Obj-Setter-TabGroup",CHEMOBJSETTER_INFOLABEL:"K-Chem-Obj-Setter-InfoLabel",CHEMOBJSETTER_REGION:"K-Chem-Obj-Setter-Region",CHEMOBJSETTER_REGION_LABEL:"K-Chem-Obj-Setter-Region-Label",CHEMOBJSETTER_LINE:"K-Chem-Obj-Setter-Line",CHEMOBJSETTER_CONFIGURATOR:"K-Chem-Obj-Setter-Configurator"});var b=Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ChemObjInserter=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter",DEF_BGCOLOR_2D:"transparent",DEF_BGCOLOR_3D:"#000000",initialize:function($super,g,k,i,h){this._configAction=new Kekule.Widget.ActionOpenConfigWidget(this);this._toolbarParentElem=null;this._infoLabel=null;this._infoLabelTemplate=Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH_HEIGHT");$super(g);var j=this.getViewer();if(i){j.setRenderType(i)}if(h){j.setViewerConfigs(h)}this.adjustChildrenSizes()},doFinalize:function($super){if(this._configAction){this._configAction.finalize()}$super()},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("viewer");if(!g){g=this.createViewer();this.setPropStoreFieldValue("viewer",g)}return g}});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,scope:f.PUBLIC,getter:function(){var g=this.getPropStoreFieldValue("viewer");return g?g.getChemObj():this.getPropStoreFieldValue("chemObj")},setter:function(g){this.setPropStoreFieldValue("chemObj",g);if(this.getViewer()){this.getViewer().setChemObj(g)}}});this.defineProp("renderType",{dataType:DataType.INT,serializable:false,scope:f.PUBLIC,setter:function(j){var h=this.getRenderType();if(j!==h){this.setPropStoreFieldValue("renderType",j);this.getViewer().setRenderType(j);var i=this.getTabs();if(i){var g=(j===Kekule.Render.RendererType.R3D)?1:0;i.getChildWidgets()[g].setChecked(true)}}}});this.defineProp("is3D",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getRenderType()===Kekule.Render.RendererType.R3D},setter:function(g){this.setRenderType(g?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D)}});this.defineProp("showInfo",{dataType:DataType.BOOL,serializable:false,getter:function(){return this._infoLabel&&Kekule.StyleUtils.isShown(this._infoLabel)},setter:function(g){if(this._infoLabel){Kekule.StyleUtils.setDisplay(this._infoLabel,g)}}});this.defineProp("autoSizeExport",{dataType:DataType.BOOL});this.defineProp("backgroundColor2D",{dataType:DataType.STRING,setter:function(g){this.setPropStoreFieldValue("backgroundColor2D",g);this.backgroundColorChange()}});this.defineProp("backgroundColor3D",{dataType:DataType.STRING,setter:function(g){this.setPropStoreFieldValue("backgroundColor3D",g);this.backgroundColorChange()}});this.defineProp("exportViewerPredefinedSetting",{dataType:DataType.STRING});this.defineProp("clientPanel",{dataType:DataType.OBJECT,serializable:false,setter:false,scope:f.PRIVATE});this.defineProp("tabs",{dataType:DataType.OBJECT,serializable:false,setter:false,scope:f.PRIVATE});this._defineViewerDelegatedProp("chemObjLoaded");this._defineViewerDelegatedProp("renderConfigs");this._defineViewerDelegatedProp("drawOptions");this._defineViewerDelegatedProp("allowCoordBorrow");this._defineViewerDelegatedProp("autoSize");this._defineViewerDelegatedProp("autofit");this._defineViewerDelegatedProp("viewerConfigs");this._defineViewerDelegatedProp("allowedMolDisplayTypes");this._defineViewerDelegatedProp("enableEdit");this._defineViewerDelegatedProp("enableEditFromVoid");this._defineViewerDelegatedProp("modalEdit");this._defineViewerDelegatedProp("toolButtons");this._defineViewerDelegatedProp("enableDirectInteraction");this._defineViewerDelegatedProp("enableTouchInteraction")},initPropValues:function($super){$super();this.setAutoSizeExport(true);this.setBackgroundColor3D(this.DEF_BGCOLOR_3D);this.setExportViewerPredefinedSetting("basic")},_defineViewerDelegatedProp:function(j,g){if(!g){g=j}var h=ClassEx.getPropInfo(Kekule.ChemWidget.Viewer,g);var i=Object.create(h);i.getter=null;i.setter=null;if(h.getter){i.getter=function(){return this.getViewer().getPropValue(g)}}if(h.setter){i.setter=function(k){this.getViewer().setPropValue(g,k)}}return this.defineProp(j,i)},loadPredefinedResDataToProp:function(h,g,i){if(h==="chemObj"){if(i){var j=Kekule.IO.loadTypedData(g.data,g.resType,g.resUri);this.setChemObj(j)}else{Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+g.resUri||"")}}},doGetWidgetClassName:function($super){var g=$super()+" "+e.CHEMOBJSETTER;return g},doCreateRootElement:function(h){var g=h.createElement("div");return g},doCreateSubElements:function($super,j,h){var g=$super(j,h);this.createToolbarParent(h);var i=new Kekule.Widget.Panel(this);i.addClassName(e.CHEMOBJSETTER_CLIENT);i.setUseCornerDecoration(false);i.appendToElem(h);this.setPropStoreFieldValue("clientPanel",i);this.createViewer(i.getCoreElement());this.createInfoLabel(h,this.getViewer());this.createTabs(h);return g},doResize:function($super){this.adjustChildrenSizes()},doWidgetShowStateChanged:function($super,g){$super(g);this.adjustChildrenSizes()},getResizerElement:function(){return this.getClientPanel()?this.getClientPanel().getCoreElement():this.getCoreElement()},getBackgroundColor:function(h){var g=(h===Kekule.Render.RendererType.R3D)?this.getBackgroundColor3D():this.getBackgroundColor2D();if(g===Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT){g="transparent"}return g},setBackgroundColor:function(g,h){if(h===Kekule.Render.RendererType.R3D){var i=g||this.DEF_BGCOLOR_3D;this.setBackgroundColor3D(i)}else{var i=g||this.DEF_BGCOLOR_2D;this.setBackgroundColor2D(i)}},backgroundColorChange:function(){var g=this.getBackgroundColor(this.getRenderType());var h=this.getPropStoreFieldValue("viewer");if(h){h.setBackgroundColor(g)}},adjustChildrenSizes:function(){var g=this.getBoundingClientRect();var k=Kekule.HtmlElementUtils.getElemBoundingClientRect(this._toolbarParentElem);var i=this.getTabs();var l=i&&i.getBoundingClientRect();var j=l.top-k.bottom;this.getClientPanel().setHeight(j+"px");this.getViewer().resized()},createViewer:function(h){var k=Kekule.ChemWidget.ComponentWidgetNames;var i=Kekule.Widget.EvokeMode;var g=new Kekule.ChemWidget.Viewer(this,null,this.getRenderType());g.addClassName([b.DYN_CREATED,e.CHEMOBJSETTER_VIEWER]);g.setRenderType(Kekule.Render.RendererType.R2D);g.setEnableEdit(true);g.setEnableEditFromVoid(true);g.setRestrainEditorWithCurrObj(false);g.setEnableToolbar(true);g.setPredefinedSetting("fullFunc");var j=a.exclude(g.getDefaultToolBarButtons(),k.config);j.push({action:this._configAction});j.splice(2,0,k.clearObjs);g.setToolbarParentElem(this._toolbarParentElem);g.setToolButtons(j);g.setToolbarPos(Kekule.Widget.Position.BOTTOM);g.setToolbarMarginVertical(-2);g.setToolbarEvokeModes([i.ALWAYS]);g.addEventListener("resize",this.updateInfoLabel,this);g.appendToElem(h);g.setChemObj(this.getChemObj());this.setPropStoreFieldValue("viewer",g);this.backgroundColorChange();return g},createToolbarParent:function(h){var g=h.ownerDocument.createElement("div");g.className=e.CHEMOBJSETTER_TOOLBAR_AREA;h.appendChild(g);this._toolbarParentElem=g;return g},createTabs:function(k){var o=[Kekule.$L("ChemWidgetTexts.CAPTION_2D"),Kekule.$L("ChemWidgetTexts.CAPTION_3D")];var j=(this.getRenderType()===Kekule.Render.RendererType.R3D)?1:0;var g=new Kekule.Widget.TabButtonGroup(this);g.setTabButtonPosition(Kekule.Widget.Position.BOTTOM);g.addClassName([b.DYN_CREATED,e.CHEMOBJSETTER_TABGROUP]);var p=[];for(var n=0,h=o.length;n<h;++n){var m=new Kekule.Widget.RadioButton(g);m.setText(o[n]);if(n===j){m.setChecked(true)}p.push(m)}g.addEventListener("switch",function(r){var q=r.button;var i=p.indexOf(q);var l=(i===1)?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(l);this.backgroundColorChange()},this);g.appendToElem(k);this.setPropStoreFieldValue("tabs",g);return g},createInfoLabel:function(h,i){var g=this.getDocument().createElement("div");g.className=b.DYN_CREATED+" "+e.CHEMOBJSETTER_INFOLABEL;i.getElement().appendChild(g);this._infoLabel=g;return g},updateInfoLabel:function(){var i=this.getViewer();if(i&&this._infoLabel){var h=i.getContextDimension();var g=h?this._infoLabelTemplate.format(Math.round(h.width),Math.round(h.height)):"";Kekule.DomUtils.setElementText(this._infoLabel,g)}},getContextDimension:function(){return this.getViewer().getContextDimension()},setContextDimension:function(k){var g=this.getContextDimension();var h=k.width-g.width;var i=k.height-g.height;var j=this.getDimension();var l={width:j.width+h,height:j.height+i};this.setDimension(l.width,l.height);return this},exportToDataUri:function(h,i){var g=this.getViewer().exportToDataUri(h,i);return g},exportDetails:function(h,i){if(this.getAutoSizeExport()){this.setAutoSize(true)}var j=this.getViewer().getActualDrawOptions();var l=this.getViewer().getContextDimension();var g={dataUri:this.exportToDataUri(h,i),drawOptions:j,drawOptionsJson:JSON.stringify(j),chemObj:this.getChemObj(),chemObjJson:Kekule.IO.saveMimeData(this.getChemObj(),"chemical/x-kekule-json"),autoSize:this.getAutoSizeExport(),autofit:this.getAutofit(),width:Math.round(l.width),height:Math.round(l.height),renderType:this.getRenderType()||Kekule.Render.RendererType.R2D,backgroundColor:this.getBackgroundColor(this.getRenderType()),predefinedSetting:this.getExportViewerPredefinedSetting()};if(this.getAutoSizeExport()){this.setAutoSize(false);var k=this.getViewer().getElement();k.style.width="auto";k.style.height="auto";this.getViewer().resized()}return g},getExportImgElemAttributes:function(h,i){var k=this.exportDetails(h,i);var j="width:"+k.width+"px; height:"+k.height+"px";var g={src:k.dataUri,style:j,width:k.width,height:k.height,"data-kekule-widget":"Kekule.ChemWidget.Viewer","data-render-type":k.renderType,"data-chem-obj":k.chemObjJson,"data-draw-options":k.drawOptionsJson,"data-predefined-setting":k.predefinedSetting};if(Kekule.ObjUtils.notUnset(k.autoSize)){g["data-auto-size"]=k.autoSize}if(Kekule.ObjUtils.notUnset(k.autofit)){g["data-auto-fit"]=k.autofit}if(Kekule.ObjUtils.notUnset(k.backgroundColor)){g["data-background-color"]=k.backgroundColor}return g},createExportImgElement:function(j,h,i){var g=j.createElement("img");var k=this.getExportImgElemAttributes(h,i);Kekule.DomUtils.setElemAttributes(g,k);return g},importChemObjWithDetails:function(h,g){this.setChemObj(h);this.setRenderType(g.renderType||Kekule.Render.RendererType.R2D);if(Kekule.ObjUtils.notUnset(g.autoSize)){this.setAutoSizeExport(!!g.autoSize)}if(Kekule.ObjUtils.notUnset(g.autofit)){this.setAutofit(!!g.autofit)}if(g.width&&g.height&&(!g.autoSize||g.renderType===Kekule.Render.RendererType.R3D)){this.setContextDimension({width:g.width,height:g.height})}if(g.drawOptions){this.getViewer().setDrawOptions(g.drawOptions)}if(g.backgroundColor){this.setBackgroundColor(g.backgroundColor,this.getRenderType())}return this},importFromElemAttribs:function(h){h.width=JsonUtility.parse(h.width);h.height=JsonUtility.parse(h.height);var g=h["data-chem-obj"];var i=g?Kekule.IO.loadMimeData(g,"chemical/x-kekule-json"):null;if(h["data-render-type"]){h.renderType=JsonUtility.parse(h["data-render-type"])}if(h["data-draw-options"]){h.drawOptions=JsonUtility.parse(h["data-draw-options"])}if(h["data-auto-size"]){h.autoSize=JsonUtility.parse(h["data-auto-size"])}if(h["data-autofit"]){h.autofit=JsonUtility.parse(h["data-autofit"])}if(h.backgroundColor){h.backgroundColor=h.backgroundColor}return this.importChemObjWithDetails(i,h)},importFromElem:function(g){var h=Kekule.HtmlElementUtils.getElemBoundingClientRect(g);var i=Kekule.DomUtils.fetchAttributeValuesToJson(g);if(!i.width){i.width=h.width}if(!i.height){i.height=h.height}return this.importFromElemAttribs(i)}});Kekule.ChemWidget.ChemObjInserter.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter.Configurator",initialize:function($super,g){this._checkBoxAutoSize=null;this._checkBoxAutofit=null;this._checkBoxShowInfo=null;this._textBoxWidth=null;this._textBoxHeight=null;this._colorPicker=null;$super(g);this.addEventListener("valueChange",function(h){this.saveConfigValues()},this)},initPropValues:function($super){$super();this.setAutoUpdate(true)},doGetWidgetClassName:function($super){return $super()+" "+e.CHEMOBJSETTER_CONFIGURATOR},doCreateSubElements:function(m,k){var l=m.createElement("div");l.className=e.CHEMOBJSETTER_REGION;var j=new Kekule.Widget.CheckBox(this);j.setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOSIZE"));j.addClassName(e.CHEMOBJSETTER_LINE);j.appendToElem(l);this._checkBoxAutoSize=j;var h=m.createElement("span");h.className=b.PART_ASSOC_TEXT_CONTENT;d.setElementText(h,Kekule.$L("ChemWidgetTexts.HINT_AUTOSIZE"));l.appendChild(h);var j=new Kekule.Widget.CheckBox(this);j.setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOFIT"));j.addClassName(e.CHEMOBJSETTER_LINE);j.appendToElem(l);this._checkBoxAutofit=j;var h=m.createElement("span");h.className=b.PART_ASSOC_TEXT_CONTENT;d.setElementText(h,Kekule.$L("ChemWidgetTexts.HINT_AUTOFIT"));l.appendChild(h);k.appendChild(l);var l=m.createElement("div");l.className=e.CHEMOBJSETTER_REGION;var i=m.createElement("label");i.className=e.CHEMOBJSETTER_REGION_LABEL;d.setElementText(i,Kekule.$L("ChemWidgetTexts.CAPTION_LABEL_SIZE"));l.appendChild(i);l.appendChild(m.createElement("br"));var n=new Kekule.Widget.TextBox(this);n.setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_WIDTH"));n.appendToElem(l);this._textBoxWidth=n;var i=m.createElement("span");d.setElementText(i,"");l.appendChild(i);var n=new Kekule.Widget.TextBox(this);n.setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_HEIGHT"));n.appendToElem(l);this._textBoxHeight=n;var j=new Kekule.Widget.CheckBox(this);j.setText(Kekule.$L("ChemWidgetTexts.CAPTION_SHOWSIZEINFO"));j.appendToElem(l);this._checkBoxShowInfo=j;k.appendChild(l);var l=m.createElement("div");l.className=e.CHEMOBJSETTER_REGION;var i=m.createElement("label");i.className=e.CHEMOBJSETTER_REGION_LABEL;d.setElementText(i,Kekule.$L("ChemWidgetTexts.CAPTION_BACKGROUND_COLOR"));l.appendChild(i);l.appendChild(m.createElement("br"));var g=new Kekule.Widget.ColorPicker(this);g.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT]);g.appendToElem(l);this._colorPicker=g;k.appendChild(l)},loadConfigValues:function($super){$super();var g=this.getWidget();if(g){var i=!g.getIs3D();this._checkBoxAutoSize.setChecked(i&&g.getAutoSizeExport());this._checkBoxAutoSize.setEnabled(i);this._checkBoxAutofit.setChecked(i&&g.getAutofit());this._checkBoxAutofit.setEnabled(i);this._checkBoxShowInfo.setChecked(g.getShowInfo());var j=g.getContextDimension();this._textBoxWidth.setText(Math.round(j.width));this._textBoxHeight.setText(Math.round(j.height));var h=i?g.getBackgroundColor2D():g.getBackgroundColor3D();this._colorPicker.setValue(h||Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT)}},saveConfigValues:function($super){$super();var g=this.getWidget();if(g){var h=!g.getIs3D();if(h){g.setAutoSizeExport(this._checkBoxAutoSize.getChecked());g.setAutofit(this._checkBoxAutofit.getChecked());g.setBackgroundColor2D(this._colorPicker.getValue())}else{g.setBackgroundColor3D(this._colorPicker.getValue())}g.setShowInfo(this._checkBoxShowInfo.getChecked());var i={width:parseInt(this._textBoxWidth.getText()),height:parseInt(this._textBoxHeight.getText())};g.setContextDimension(i);g.invokeEvent("configSave")}}})})();(function(){var a=Kekule;var b=Kekule.CoordMode;ClassEx.extend(Kekule.ChemObject,{isStandalone:function(){return true},getStandaloneAncestor:function(){var c=this;while(c.isStandalone&&(!c.isStandalone())&&c.getParent&&c.getParent()){c=c.getParent()}return c},getCascadeDeleteObjs:function(){return[]},cascadeRemove:function(d){var c=this.getParent();if(c&&c.notifyBeforeCascadeRemove){c.notifyBeforeCascadeRemove(this)}if(d){this.finalize()}else{this.removeSelf()}if(c&&c.notifyAfterCascadeRemove){c.notifyAfterCascadeRemove(this)}},notifyBeforeCascadeRemove:function(c,d){},notifyAfterCascadeRemove:function(c,d){if((!this.getKeepEmptyEvenOnCascadeRemove())&&this.isEmpty()){this.cascadeRemove(d)}},getAllContainingConnectors:function(){return[]},transformAbsCoordByMatrix:function(g,j,f,m,d,p){if(this.getChildCount&&(m||Kekule.ObjUtils.isUnset(m))){for(var h=0,e=this.getChildCount();h<e;++h){var c=this.getChildAt(h);if(c&&c.transformAbsCoordByMatrix){c.transformAbsCoordByMatrix(j,j,f,m,d,true)}}}var o=(f===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix;if(p){if(this.getCoordOfMode&&this.setCoordOfMode){var k=this.getCoordOfMode(f,d);var n=o(k,g);this.setCoordOfMode(n,f)}}else{if(this.getAbsCoordOfMode&&this.setAbsCoordOfMode){var k=this.getAbsCoordOfMode(f,d);var n=o(k,g);this.setAbsCoordOfMode(n,f)}}},scaleSize:function(e,g,k,d){if(this.getSizeOfMode&&this.setSizeOfMode){var m=this.getSizeOfMode(g,d);var j=Kekule.CoordUtils.multiply(m,e);this.setSizeOfMode(j,g)}if(this.getChildCount&&(k||Kekule.ObjUtils.isUnset(k))){for(var h=0,f=this.getChildCount();h<f;++h){var c=this.getChildAt(h);if(c&&c.scaleSize){c.scaleSize(e,g,k,d)}}}}});ClassEx.defineProps(Kekule.ChemObject,[{name:"keepEmptyEvenOnCascadeRemove",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}]);ClassEx.extend(Kekule.ChemStructureObject,{getCascadeDeleteObjs:function($super){var c=$super();var h=this.getLinkedConnectors?this.getLinkedConnectors():[];for(var g=0,e=h.length;g<e;++g){var d=h[g];if(d.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(c,d);var f=d.getCascadeDeleteObjs();Kekule.ArrayUtils.pushUnique(c,f)}}return c},isStandalone:function(){return false},isCoordDependent:function(){return false},getCoordDependentObjects:function(){return[this]},getCoordDeterminateObjects:function(){return this.getLinkedConnectors()}});ClassEx.extend(Kekule.BaseStructureNode,{getCascadeDeleteObjs:function($super){return $super()},isCoordDependent:function(){return false},move:function(f,e){var d=this.getCoordOfMode(e);var c=Kekule.CoordUtils.add(d,f);this.setCoordOfMode(c,e);return c},move2D:function(c){return this.move(c,b.COORD2D)},move3D:function(c){return this.move(c,b.COORD3D)}});ClassEx.extend(Kekule.BaseStructureConnector,{getCascadeDeleteObjs:function($super){var c=$super();var g=this.getConnectedObjs();for(var e=0,d=g.length;e<d;++e){var f=g[e];if(f instanceof Kekule.BaseStructureNode){if(f.getLinkedConnectors().length<=1){Kekule.ArrayUtils.pushUnique(c,f)}}}return c},isCoordDependent:function(){return true},getCoordDependentObjects:function(){var c=[];var g=this.getConnectedObjs();for(var e=0,d=g.length;e<d;++e){var f=g[e];if(f.isExposed){if(f.isExposed()){c.push(f)}else{c.push(f.getExposedAncestor())}}else{c.push(f)}}return c},move:function(g,e){for(var d=0,c=this.getConnectedObjCount();d<c;++d){var f=this.getConnectedObjAt(d);if(f.move){f.move(g,e)}}},move2D:function(c){return this.move(c,b.COORD2D)},move3D:function(c){return this.move(c,b.COORD3D)},setAbsBaseCoord:function(e,d){var c=this.getAbsBaseCoord();var f=Kekule.CoordUtils.substract(e,c);this.move(f,d)},setAbsBaseCoord2D:function(c){this.setAbsCoordOfMode(c,Kekule.CoordMode.COORD2D)},setAbsBaseCoord3D:function(c){this.setAbsCoordOfMode(c,Kekule.CoordMode.COORD3D)}});ClassEx.extend(Kekule.Glyph.PathGlyphNode,{getCascadeDeleteObjs:function($super){var c=[this.getParent()];return c}});ClassEx.extend(Kekule.Glyph.PathGlyphConnector,{getCascadeDeleteObjs:function($super){var c=[this.getParent()];return c}});ClassEx.extend(Kekule.StructureFragment,{isStandalone:function(){return !this.getCrossConnectors().length},notifyBeforeCascadeRemove:function($super,e,g){var c=this._getObjsNeedToBeCascadeRemoved(e);if(c&&c.length){for(var d=c.length-1;d>=0;--d){var f=c[d];if(g){f.finalize()}else{f.removeSelf()}}}$super(e,g)},getCoordDependentObjects:function(){if(this.isExpanded&&!this.isExpanded()){return[this]}else{if(!this.hasCtab()){return[this]}else{var c=[];var d=this.getNodeCount();for(var e=0;e<d;++e){var f=this.getNodeAt(e);c.push(f)}return c}}},transformAbsCoordByMatrix:function($super,g,j,f,k,d,m){if(k||Kekule.ObjUtils.isUnset(k)){for(var h=0,e=this.getNodeCount();h<e;++h){var c=this.getNodeAt(h);if(c&&c.transformAbsCoordByMatrix){c.transformAbsCoordByMatrix(j,j,f,k,d,true)}}}$super(g,j,f,false,d,m)}});ClassEx.extend(Kekule.Glyph.Base,{isStandalone:function(){return true}});ClassEx.extend(Kekule.Glyph.PathGlyph,{getCoordDependentObjects:function(){var c=[];var d=this.getNodeCount();for(var e=0;e<d;++e){var f=this.getNodeAt(e);c.push(f)}return c},transformAbsCoordByMatrix:function($super,g,j,f,k,d,m){if(k||Kekule.ObjUtils.isUnset(k)){for(var h=0,e=this.getNodeCount();h<e;++h){var c=this.getNodeAt(h);if(c&&c.transformAbsCoordByMatrix){c.transformAbsCoordByMatrix(j,j,f,k,d,true)}}}$super(g,j,f,false,d,m)}})})();(function(){var a=Kekule.ArrayUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{EDITOR:"K-Chem-Editor",EDITOR_CLIENT:"K-Chem-Editor-Client",EDITOR_UIEVENT_RECEIVER:"K-Chem-Editor-UiEvent-Receiver",EDITOR2D:"K-Chem-Editor2D",EDITOR3D:"K-Chem-Editor3D"});Kekule.ChemWidget.Editor={};Kekule.Editor=Kekule.ChemWidget.Editor;Kekule.Editor.CoordSys=Kekule.Render.CoordSystem;Kekule.Editor.BoxRegion={OUTSIDE:0,CORNER_TL:1,CORNER_TR:2,CORNER_BL:3,CORNER_BR:4,EDGE_TOP:11,EDGE_LEFT:12,EDGE_BOTTOM:13,EDGE_RIGHT:14,INSIDE:20};Kekule.Editor.BaseEditor=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.Editor.BaseEditor",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,f,i,h,g){this._objSelectFlag=0;this._objectUpdateFlag=0;this._uiMarkerUpdateFlag=0;this._updatedObjectDetails=[];this._operatingObjs=[];this._operatingRenderers=[];this._initialRenderTransformParams=null;this._objChanged=false;this.setPropStoreFieldValue("enableCreateNewDoc",true);this.setPropStoreFieldValue("enableOperHistory",true);this.setPropStoreFieldValue("enableOperContext",true);this.setPropStoreFieldValue("initOnNewDoc",true);$super(f,i,h);if(!this.getChemObj()&&this.getInitOnNewDoc()&&this.getEnableCreateNewDoc()){this.newDoc()}this.setPropStoreFieldValue("editorConfigs",g||this.createDefaultConfigs())},initProperties:function(){this.defineProp("editorConfigs",{dataType:"Kekule.Editor.BaseEditorConfigs",serializable:false,getter:function(){return this.getDisplayerConfigs()},setter:function(f){return this.setDisplayerConfigs(f)}});this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:false});this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false});this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,getter:function(){var f=this.getPropStoreFieldValue("operHistory");if(!f){f=new Kekule.OperationHistory();this.setPropStoreFieldValue("operHistory",f);f.addEventListener("push",this.reactOperHistoryPush,this);f.addEventListener("pop",this.reactOperHistoryPop,this);f.addEventListener("undo",this.reactOperHistoryUndo,this);f.addEventListener("redo",this.reactOperHistoryRedo,this);f.addEventListener("clear",this.reactOperHistoryClear,this);f.addEventListener("change",this.reactOperHistoryChange,this)}return f},setter:null});this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("selection");if(!f){f=[];this.setPropStoreFieldValue("selection",f)}return f},setter:function(f){this.setPropStoreFieldValue("selection",f);this.selectionChanged()}});this.defineProp("hotTrackedObjs",{dataType:DataType.ARRAY,serializable:false,setter:function(k){var m=k?Kekule.ArrayUtils.toArray(k):[];if(this.getEditorConfigs()&&this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){this.setPropStoreFieldValue("hotTrackedObjs",m);var j;if(m&&m.length){j=[];for(var g=0,f=m.length;g<f;++g){var h=this.getBoundInfoRecorder().getBound(this.getObjContext(),m[g]);if(j){Kekule.ArrayUtils.pushUnique(j,h)}}}if(j){this.changeHotTrackMarkerBounds(j)}else{if(this.getUiHotTrackMarker().getVisible()){this.hideHotTrackMarker()}}}}});this.defineProp("hotTrackedObj",{dataType:DataType.OBJECT,serializable:false,getter:function(){return this.getHotTrackedObjs()&&this.getHotTrackedObjs()[0]},setter:function(f){this.setHotTrackedObjs(f)}});this.defineProp("enableOperContext",{dataType:DataType.BOOL,setter:function(h){this.setPropStoreFieldValue("enableOperContext",!!h);if(!h){var g=this.getPropStoreFieldValue("operContext");var f=this.getPropStoreFieldValue("drawBridge");if(f&&g){f.releaseContext(g)}}}});this.defineProp("uiEventReceiverElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("objContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("operContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("uiContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("objContext",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){return this.getDrawContext()}});this.defineProp("operContext",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){if(!this.getEnableOperContext()){return null}else{var f=this.getPropStoreFieldValue("operContext");if(!f){var i=this.getDrawBridge();if(i){var g=this.getOperContextParentElem();if(!g){return null}else{var h=Kekule.HtmlElementUtils.getElemScrollDimension(g);f=i.createContext(g,h.width,h.height);this.setPropStoreFieldValue("operContext",f)}}}return f}}});this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("uiContext");if(!f){var i=this.getUiDrawBridge();if(i){var g=this.getUiContextParentElem();if(!g){return null}else{var h=Kekule.HtmlElementUtils.getElemScrollDimension(g);f=i.createContext(g,h.width,h.height);this.setPropStoreFieldValue("uiContext",f)}}}return f}});this.defineProp("objDrawBridge",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){return this.getDrawBridge()}});this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("uiDrawBridge");if(!f){f=this.createUiDrawBridge();this.setPropStoreFieldValue("uiDrawBridge",f)}return f}});this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("uiPainter");if(!f){var g=this.getUiMarkers();f=new Kekule.Render.ChemObjPainter(Kekule.Render.RendererType.R2D,g,this.getUiDrawBridge());this.setPropStoreFieldValue("uiPainter",f);return f}return f}});this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:false,setter:null,getter:function(){var g=this.getUiPainter();if(g){var f=g.getRenderer();if(!f){g.prepareRenderer()}return g.getRenderer()||null}else{return null}}});this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("uiMarkers");if(!f){f=new Kekule.ChemWidget.UiMarkerCollection();this.setPropStoreFieldValue("uiMarkers",f)}return f}});this._defineUiMarkerProp("uiHotTrackMarker");this._defineUiMarkerProp("uiSelectionAreaMarker");this._defineUiMarkerProp("uiSelectingMarker");this.defineProp("uiSelectionAreaContainerBox",{dataType:DataType.Object,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("objRendererMap",{dataType:"Kekule.MapEx",serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("objRendererMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("objRendererMap",f)}return f}});this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:false,setter:null})},_defineUiMarkerProp:function(f,g){return this.defineProp(f,{dataType:"Kekule.ChemWidget.AbstractUIMarker",serializable:false,getter:function(){var h=this.getPropStoreFieldValue(f);if(!h){h=this.createShapeBasedMarker(f,null,null,false)}return h},setter:function(i){if(!g){g=this.getUiMarkers()}var h=this.getPropValue(f);if(h){g.removeMarker(h);h.finalize()}g.addMarker(i);this.setPropStoreFieldValue(f,i)}})},doFinalize:function($super){var j=this.getPropStoreFieldValue("operHistory");if(j){j.finalize();this.setPropStoreFieldValue("operHistory",null)}var g=this.getPropStoreFieldValue("objDrawBridge");var i=this.getPropStoreFieldValue("operContext");if(g&&i){g.releaseContext(i)}this.setPropStoreFieldValue("operContext",null);var g=this.getPropStoreFieldValue("uiDrawBridge");var i=this.getPropStoreFieldValue("uiContext");if(g&&i){g.releaseContext(i)}this.setPropStoreFieldValue("uiDrawBridge",null);this.setPropStoreFieldValue("uiContext",null);var k=this.getPropStoreFieldValue("boundInfoRecorder");if(k){k.finalize()}this.setPropStoreFieldValue("boundInfoRecorder",null);var f=this.getPropStoreFieldValue("objRendererMap");if(f){f.finalize()}this.setPropStoreFieldValue("objRendererMap",null);$super()},createDefaultConfigs:function(){return new Kekule.Editor.BaseEditorConfigs()},doCreateRootElement:function(g){var f=g.createElement("div");return f},doCreateSubElements:function(h,f){var g=h.createElement("div");g.className=e.EDITOR_CLIENT;f.appendChild(g);this._editClientElem=g;return[g]},getCoreElement:function($super){return this._editClientElem||$super()},getEditClientElem:function(){return this._editClientElem},doGetWidgetClassName:function($super){var g=$super()+" "+e.EDITOR;var f=(this.getRenderType()===Kekule.Render.RendererType.R3D)?e.EDITOR3D:e.EDITOR2D;g+=" "+f;return g},doBindElement:function(f){this.createContextParentElems();this.createUiEventReceiverElem()},changeClientSize:function(j,r,n){this._initialRenderTransformParams=null;var k=this.getCoreElement();var g=k.style;if(!n){n=1}var q=j*n;var p=r*n;if(q){g.width=q+"px"}if(p){g.height=p+"px"}var f=[this.getObjContext(),this.getOperContext(),this.getUiContext()];for(var o=0,m=f.length;o<m;++o){var s=f[o];if(s){this.getDrawBridge().setContextDimension(s,q,p)}}this.repaint()},isDirty:function(){if(this.getEnableOperHistory()){return this.getOperHistory().getCurrIndex()>=0}else{return this._objChanged}},getChemObjSrcInfo:function(f){if(this.isDirty()){return null}else{return f.getSrcInfo?f.getSrcInfo():null}},getActualDrawOptions:function($super){var g=$super();if(this._initialRenderTransformParams){var f=Object.extend({},this._initialRenderTransformParams);f=Object.extend(f,g);return f}else{return g}},repaint:function($super,h){var g=h;var f=$super(g);if(!this._initialRenderTransformParams){this._initialRenderTransformParams=this.getPainter().getActualInitialRenderTransformOptions(this.getObjContext())}this.recalcUiMarkers();return f},newDoc:function(){this.load(this.doCreateNewDocObj())},doCreateNewDocObj:function(){return new Kekule.Molecule()},getExportableClasses:function(){var f=this.getChemObj();if(!f){return[]}else{return f.getClass?f.getClass():null}},exportObj:function(f){return this.exportObjs(f)[0]},exportObjs:function(f){var g=this.getChemObj();if(!f){return[g]}else{return(g&&(g instanceof f))?[g]:[]}},doLoad:function($super,f){this.deselectAll();this._initialRenderTransformParams=null;this.getObjRendererMap().clear();if(this.getOperHistory()){this.getOperHistory().clear()}$super(f);this._objChanged=false},doLoadEnd:function($super,f){$super();if(!f){this._initialRenderTransformParams=null}},doResize:function($super){this._initialRenderTransformParams=null;$super()},geometryOptionChanged:function($super){var f=this.getDrawOptions().zoom;this.zoomChanged(f);$super()},zoomChanged:function(f){},chemObjChanged:function($super,g,f){$super(g,f);if(g!==f){if(f){this._uninstallChemObjEventListener(f)}if(g){this._installChemObjEventListener(g)}}},_installChemObjEventListener:function(f){f.addEventListener("change",this.reactChemObjChange,this)},_uninstallChemObjEventListener:function(f){f.removeEventListener("change",this.reactChemObjChange,this)},createUiEventReceiverElem:function(){var g=this.getCoreElement();if(g){var f=g.ownerDocument.createElement("div");f.className=e.EDITOR_UIEVENT_RECEIVER;g.appendChild(f);d.addClass(f,b.DYN_CREATED);this.setPropStoreFieldValue("uiEventReceiverElem",f);return f}},createContextParentElems:function(){var f=this.getCoreElement();if(f){var g=f.ownerDocument;this._createContextParentElem(g,f,"objContextParentElem");this._createContextParentElem(g,f,"operContextParentElem");this._createContextParentElem(g,f,"uiContextParentElem")}},_createContextParentElem:function(i,g,h){var f=i.createElement("div");f.style.position="absolute";f.style.width="100%";f.style.height="100%";f.className=h+" "+b.DYN_CREATED;this.setPropStoreFieldValue(h,f);g.appendChild(f);return f},createNewPainter:function($super,g){var f=$super(g);if(f){this.installPainterEventHandlers(f);this.createNewBoundInfoRecorder(this.getPainter())}return f},createNewBoundInfoRecorder:function(h){var f=this.getPropStoreFieldValue("boundInfoRecorder");if(f){f.finalize()}var g=new Kekule.Render.BoundInfoRecorder(h);this.setPropStoreFieldValue("boundInfoRecorder",g)},getDrawContextParentElem:function(){return this.getObjContextParentElem()},createUiDrawBridge:function(){var f=Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!f){Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"))}return f},changeContextDimension:function($super,g){var f=$super(g);if(f){this._resizeContext(this.getOperContext(),this.getObjDrawBridge(),g.width,g.height);this._resizeContext(this.getUiContext(),this.getUiDrawBridge(),g.width,g.height)}return f},_resizeContext:function(g,i,h,f){if(g&&i){i.setContextDimension(g,h,f)}},_clearSpecContext:function(f,g){if(g&&f){g.clearContext(f)}},clearObjContext:function(){this._clearSpecContext(this.getObjContext(),this.getDrawBridge());if(this.getBoundInfoRecorder()){this.getBoundInfoRecorder().clear(this.getObjContext())}},clearOperContext:function(){this._clearSpecContext(this.getOperContext(),this.getDrawBridge())},clearUiContext:function(){this._clearSpecContext(this.getUiContext(),this.getUiDrawBridge())},clearContext:function(){this.clearObjContext();if(this._operatingRenderers){this.clearOperContext()}},repaintOperContext:function(g){if(this._operatingRenderers&&this._operatingObjs){this.clearOperContext();var f={partialDrawObjs:this._operatingObjs,doNotClear:true};this.repaint(f)}},getOperatingRenderers:function(){if(!this._operatingRenderers){this._operatingRenderers=[]}return this._operatingRenderers},setOperatingRenderers:function(f){this._operatingRenderers=f},installPainterEventHandlers:function(f){f.addEventListener("prepareDrawing",this.reactChemObjPrepareDrawing,this);f.addEventListener("clear",this.reactChemObjClear,this)},reactChemObjPrepareDrawing:function(o){var h=o.context;var n=o.obj;if(n&&((h===this.getObjContext())||(h===this.getOperContext()))){var m=o.target;this.getObjRendererMap().set(n,m);if(this.getEnableOperContext()){var k=this._operatingObjs||[];var g=false;for(var j=0,f=k.length;j<f;++j){if(this._isChemObjDirectlyRenderedByRenderer(this.getObjContext(),k[j],m)){g=true;break}}if(g){this._setRendererToOperContext(m);a.pushUnique(this.getOperatingRenderers(),m)}}}},reactChemObjClear:function(i){var f=i.context;var h=i.obj;if(h&&((f===this.getObjContext())||(f===this.getOperContext()))){var g=i.target;this.getObjRendererMap().remove(h);a.remove(this.getOperatingRenderers(),g)}},reactChemObjChange:function(g){var f=g.target;var i=g.changedPropNames||[];var h=["owner","ownedObjs"];i=Kekule.ArrayUtils.exclude(i,h);if(i.length||!g.changedPropNames){this.objectChanged(f,i)}},reactOperHistoryPush:function(f){this.invokeEvent("operPush",f)},reactOperHistoryPop:function(f){this.invokeEvent("operPop",f)},reactOperHistoryUndo:function(f){this.invokeEvent("operUndo",f)},reactOperHistoryRedo:function(f){this.invokeEvent("operRedo",f)},reactOperHistoryClear:function(f){this.invokeEvent("operHistoryClear",f)},reactOperHistoryChange:function(f){this.invokeEvent("operChange",f)},beginUpdateObject:function(){--this._objectUpdateFlag},endUpdateObject:function(){++this._objectUpdateFlag;if(!this.isUpdatingObject()){if((this._updatedObjectDetails&&this._updatedObjectDetails.length)){this.objectsChanged(this._updatedObjectDetails);this._updatedObjectDetails=[]}}},isUpdatingObject:function(){return(this._objectUpdateFlag<0)},objectChanged:function(i,g){var h={obj:i,propNames:g};var f=this.objectsChanged(h);this.invokeEvent("editObjChanged",Object.extend({},h));return f},objectsChanged:function(g){var f=DataType.isArrayValue(g)?g:[g];if(this.isUpdatingObject()){Kekule.ArrayUtils.pushUnique(this._updatedObjectDetails,f)}else{this.doObjectsChanged(f);this.invokeEvent("editObjsUpdated",Object.extend({},g))}this._objChanged=true;this.invokeEvent("editObjsChanged",Object.extend({},g))},doObjectsChanged:function(m){var g=Kekule.ArrayUtils.clone(m);var j=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(g);var l=this._getAdditionalRenderRelatedObjs(j);if(l.length){var i=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(l);Kekule.ArrayUtils.pushUnique(g,i)}Kekule.ArrayUtils.pushUnique(j,l);var f=this._operatingRenderers;var h=f&&this._isAllObjsRenderedByRenderers(this.getObjContext(),j,f);var k=this.canModifyPartialGraphic();if(k){this.getRootRenderer().modify(this.getObjContext(),g);this.recalcUiMarkers()}else{if(h){this.repaintOperContext()}else{this.repaint()}}},_needToCanonicalizeBeforeSaving:function(){return true},_getAdditionalRenderRelatedObjs:function(m){var f=[];for(var h=0,g=m.length;h<g;++h){var j=m[h];var k=j.getCoordDeterminateObjects?j.getCoordDeterminateObjects():[];Kekule.ArrayUtils.pushUnique(f,k)}return f},_isAllObjsRenderedByRenderers:function(f,p,q){for(var o=0,g=p.length;o<g;++o){var n=p[o];var s=false;for(var m=0,h=q.length;m<h;++m){var r=q[m];if(r.isChemObjRenderedBySelf(f,n)){s=true;break}}if(!s){return false}}return true},prepareOperatingObjs:function(f){if(this._operatingRenderers&&this._operatingRenderers.length){this.endOperatingObjs(true)}if(this.getEnableOperContext()){this._prepareRenderObjsInOperContext(f);this._operatingObjs=f}this.repaint()},endOperatingObjs:function(f){if(this.getEnableOperContext()){this._endRenderObjsInOperContext();this._operatingObjs=null;if(!f){this.repaint()}}},_isChemObjDirectlyRenderedByRenderer:function(g,i,h){var f=i.getStandaloneAncestor?i.getStandaloneAncestor():i;return h.isChemObjRenderedDirectlyBySelf(g,f)},_getStandaloneRenderObjsInOperContext:function(k){var j=[];for(var g=0,f=k.length;g<f;++g){var h=k[g];if(h.getStandaloneAncestor){h=h.getStandaloneAncestor()}Kekule.ArrayUtils.pushUnique(j,h)}return j},_prepareRenderObjsInOperContext:function(t){var h=[];var f=this.getObjRendererMap();var p=f.getValues();var g=this.getObjContext();var m=this._getStandaloneRenderObjsInOperContext(t);for(var s=0,n=m.length;s<n;++s){var r=m[s];for(var q=0,o=p.length;q<o;++q){var u=p[q];if(u.isChemObjRenderedDirectlyBySelf(g,r)){Kekule.ArrayUtils.pushUnique(h,u)}}}if(h.length>0){for(var s=0,n=h.length;s<n;++s){var u=h[s];this._setRendererToOperContext(u)}this._operatingRenderers=h}else{this._operatingRenderers=null}},_endRenderObjsInOperContext:function(){var g=this._operatingRenderers;if(g&&g.length){for(var h=0,f=g.length;h<f;++h){var j=g[h];this._unsetRendererToOperContext(j)}this.clearOperContext()}this._operatingRenderers=null},_setRendererToOperContext:function(f){f.setRedirectContext(this.getOperContext())},_unsetRendererToOperContext:function(f){f.setRedirectContext(null)},clearBoundMap:function(){this.getBoundInfoRecorder().clear(this.getObjContext())},findTopmostBoundInfo:function(i,h){if(i&&i.length){var f=null;var g=i.length-1;f=i[g];while((g>=0)&&(h&&(h.indexOf(f.obj)>=0))){--g;f=i[g]}return f}else{return null}},getBoundInfosAtCoord:function(g,j){var f=this.getBoundInfoRecorder();var l=this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackInflation();var k=this.screenCoordToContext(g);var i=(this.getRenderType()===Kekule.Render.RendererType.R3D)?{x:0,y:0}:null;var h=f.getIntersectionInfos(this.getObjContext(),k,i,l,j);return h},getTopmostBoundInfoAtCoord:function(o,n){var f=this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest();if(!f){return this.findTopmostBoundInfo(this.getBoundInfosAtCoord(o),n)}var l=Kekule.Render.MetaShapeUtils;var g=this.getBoundInfosAtCoord(o);var s,j,m;var p=function(i,t,u){s=i;j=t||i.boundInfo;if(Kekule.ObjUtils.notUnset(u)){m=u}else{m=l.getDistance(o,j)}};for(var k=g.length-1;k>=0;--k){var h=g[k];if(n&&(n.indexOf(h.obj)>=0)){continue}if(!s){p(h)}else{var r=h.boundInfo;if(r.shapeType<j.shapeType){p(h,r)}else{if(r.shapeType===j.shapeType){var q=l.getDistance(o,r);if(q<m){p(h,r,q)}}}}}return s},getTopmostBasicObjectAtCoord:function(f){var g=this.getTopmostBoundInfoAtCoord(f);return g?g.obj:null},beginUpdateUiMarkers:function(){--this._uiMarkerUpdateFlag},endUpdateUiMarkers:function(){++this._uiMarkerUpdateFlag;if(!this.isUpdatingUiMarkers()){this.repaintUiMarker()}},isUpdatingUiMarkers:function(){return(this._uiMarkerUpdateFlag<0)},recalcUiMarkers:function(){this.beginUpdateUiMarkers();try{this.recalcHotTrackMarker();this.recalcSelectionAreaMarker()}finally{this.endUpdateUiMarkers()}},repaintUiMarker:function(){if(this.isUpdatingUiMarkers()){return}this.clearUiContext();var f=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),f.baseCoord,f.drawOptions)},createShapeBasedMarker:function(i,h,j,g){var f=new Kekule.ChemWidget.MetaShapeUIMarker();if(h){f.setShapeInfo(h)}if(j){f.setDrawStyles(j)}this.setPropStoreFieldValue(i,f);this.getUiMarkers().addMarker(f);if(g){this.repaintUiMarker()}return f},modifyShapeBasedMarker:function(g,h,j,i){var f=Kekule.Render.ObjectUpdateType.MODIFY;g.setShapeInfo(h);if(j){g.setDrawStyles(j)}if(i){this.repaintUiMarker()}},hideUiMarker:function(f,g){f.setVisible(false);if(g){this.repaintUiMarker()}},showUiMarker:function(f,g){f.setVisible(true);if(g){this.repaintUiMarker()}},removeUiMarker:function(f){if(f){this.getUiMarkers().removeMarker(f);this.repaintUiMarker()}},clearUiMarkers:function(){this.getUiMarkers().clearMarkers();this.repaintUiMarker()},changeHotTrackMarkerBounds:function(q){var o=Kekule.ArrayUtils.toArray(q);var g=this.getEditorConfigs().getUiMarkerConfigs();var n={color:g.getHotTrackerColor(),opacity:g.getHotTrackerOpacity()};var r=this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackInflation();var f=[];for(var k=0,h=o.length;k<h;++k){var m=o[k];var j=r?Kekule.Render.MetaShapeUtils.inflateShape(m,r):m;if(j){f.push(j)}}var p=this.getUiHotTrackMarker();p.setVisible(true);this.modifyShapeBasedMarker(p,f,n,true);return this},hideHotTrackMarker:function(){var f=this.getUiHotTrackMarker();if(f){this.hideUiMarker(f,true)}return this},showHotTrackMarker:function(){var f=this.getUiHotTrackMarker();if(f){this.showUiMarker(f,true)}return this},hotTrackOnCoord:function(f){if(this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){this.setHotTrackedObj(this.getTopmostBasicObjectAtCoord(f))}return this},hotTrackOnObj:function(f){this.setHotTrackedObj(f);return this},hideHotTrack:function(){this.hideHotTrackMarker();return this},addHotTrackedObj:function(g){var f=this.getHotTrackedObjs()||[];Kekule.ArrayUtils.pushUnique(f,g);this.setHotTrackedObjs(f);return this},recalcHotTrackMarker:function(){this.setHotTrackedObjs(this.getHotTrackedObjs())},changeSelectionAreaMarkerBound:function(i){var g=this.getEditorConfigs().getUiMarkerConfigs();var h={strokeColor:g.getSelectionMarkerStrokeColor(),strokeWidth:g.getSelectionMarkerStrokeWidth(),fillColor:g.getSelectionMarkerFillColor(),opacity:g.getSelectionMarkerOpacity()};var f=this.getUiSelectionAreaMarker();f.setVisible(true);this.modifyShapeBasedMarker(f,i,h,true);return this},hideSelectionAreaMarker:function(){var f=this.getUiSelectionAreaMarker();if(f){this.hideUiMarker(f,true)}},showSelectionAreaMarker:function(){var f=this.getUiSelectionAreaMarker();if(f){this.showUiMarker(f,true)}},recalcSelectionAreaMarker:function(o){this.beginUpdateUiMarkers();try{var v=this.getSelection();var t=v.length;if(t<=0){this.hideSelectionAreaMarker()}else{var f=[];var g=null;var w=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation();for(var r=0;r<t;++r){var q=v[r];var u=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),q);if(u&&u.length){for(var p=0,n=u.length;p<n;++p){var h=u[p];var m=h.boundInfo;if(m){m=Kekule.Render.MetaShapeUtils.inflateShape(m,w);f.push(m);var s=Kekule.Render.MetaShapeUtils.getContainerBox(m);g=g?Kekule.BoxUtils.getContainerBox(g,s):s}}}}this.setUiSelectionAreaContainerBox(g);if(g){var l=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:g.x1,y:g.y1},{x:g.x2,y:g.y2}]);f.push(l)}else{this.hideSelectionAreaMarker()}if(f.length){this.changeSelectionAreaMarkerBound(f)}}}finally{this.endUpdateUiMarkers()}},startSelectingBoxDrag:function(f,g){this._selectingBoxStartCoord=f;if(!g){this.deselectAll()}},dragSelectingBoxToCoord:function(f){var h=this._selectingBoxStartCoord;var g=f;this.changeSelectingMarkerBox(h,g)},endSelectingBoxDrag:function(f,j){var h=this._selectingBoxStartCoord;this._selectingBoxEndCoord=f;var i=Kekule.BoxUtils.createBox(h,f);var g=this.getEditorConfigs().getInteractionConfigs().getEnablePartialAreaSelecting();if(j){this.toggleSelectingStateOfObjectsInScreenBox(i,g)}else{this.selectObjectsInScreenBox(i,g)}this.hideSelectingMarker()},selectOnCoord:function(h,g){var f=this.getTopmostBasicObjectAtCoord(h);if(f){if(g){this.toggleSelectingState(f)}else{this.select(f)}}},changeSelectingMarkerBound:function(i){var g=this.getEditorConfigs().getUiMarkerConfigs();var h={strokeColor:g.getSelectingMarkerStrokeColor(),strokeWidth:g.getSelectingMarkerStrokeWidth(),strokeDash:g.getSelectingMarkerStrokeDash(),fillColor:g.getSelectingMarkerFillColor(),opacity:g.getSelectingMarkerOpacity()};var f=this.getUiSelectingMarker();f.setVisible(true);this.modifyShapeBasedMarker(f,i,h,true);return this},changeSelectingMarkerBox:function(h,f){var i=this.screenCoordToContext(h);var g=this.screenCoordToContext(f);var j=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:Math.min(i.x,g.x),y:Math.min(i.y,g.y)},{x:Math.max(i.x,g.x),y:Math.max(i.y,g.y)}]);return this.changeSelectingMarkerBound(j)},hideSelectingMarker:function(){var f=this.getUiSelectingMarker();if(f){this.hideUiMarker(f,true)}},showSelectingMarker:function(){var f=this.getUiSelectingMarker();if(f){this.showUiMarker(f,true)}},getCoordRegionInSelectionMarker:function(n,t){var i=Kekule.Editor.BoxRegion;var u=Kekule.CoordUtils;var o=this.screenCoordToContext(n);var j=this.getUiSelectionAreaMarker();if(j&&j.getVisible()){var l=this.getUiSelectionAreaContainerBox();if(Kekule.ObjUtils.isUnset(t)){t=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerEdgeInflation()}var h=(t/2)||0;var q=u.substract({x:l.x1,y:l.y1},{x:h,y:h});var p=u.add({x:l.x2,y:l.y2},{x:h,y:h});if((o.x<q.x)||(o.y<q.y)||(o.x>p.x)||(o.y>p.y)){return i.OUTSIDE}var g=u.substract(o,q);var f=u.substract(p,o);var s=g.x;var r=f.x;var m=g.y;var k=f.y;if(m<k){if(s<r){if(m<=t){return(s<=t)?i.CORNER_TL:i.EDGE_TOP}else{if(s<=t){return i.EDGE_LEFT}else{return i.INSIDE}}}else{if(m<=t){return(r<=t)?i.CORNER_TR:i.EDGE_TOP}else{if(r<=t){return i.EDGE_RIGHT}else{return i.INSIDE}}}}else{if(s<r){if(k<=t){return(s<=t)?i.CORNER_BL:i.EDGE_BOTTOM}else{if(s<=t){return i.EDGE_LEFT}else{return i.INSIDE}}}else{if(k<=t){return(r<=t)?i.CORNER_BR:i.EDGE_BOTTOM}else{if(r<=t){return i.EDGE_RIGHT}else{return i.INSIDE}}}}}return i.OUTSIDE},isCoordInSelectionMarkerBound:function(f){return(this.getCoordRegionInSelectionMarker(f)!==Kekule.Editor.BoxRegion.OUTSIDE)},getObjSelectedRenderOptions:function(){return this._selectedRenderOptions},_getObjRenderOptionItemAppendMethod:function(f){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?f.addOverrideRender3DOptionItem:f.addOverrideRenderOptionItem},_getObjRenderOptionItemRemoveMethod:function(f){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?f.removeOverrideRender3DOptionItem:f.removeOverrideRenderOptionItem},_addSelectRenderOptions:function(g){var f=this._getObjRenderOptionItemAppendMethod(g);return f.apply(g,[this.getObjSelectedRenderOptions()])},_removeSelectRenderOptions:function(g){var f=this._getObjRenderOptionItemRemoveMethod(g);return f.apply(g,[this.getObjSelectedRenderOptions()])},beginUpdateSelection:function(){this.beginUpdateObject();--this._objSelectFlag},endUpdateSelection:function(){++this._objSelectFlag;if(this._objSelectFlag>=0){this.selectionChanged()}this.endUpdateObject()},isUpdatingSelection:function(){return(this._objSelectFlag<0)},selectionChanged:function(){if(!this.isUpdatingSelection()){this.notifyPropSet("selection",this.getSelection());this.invokeEvent("selectionChange");return this.doSelectionChanged()}},doSelectionChanged:function(){this.recalcSelectionAreaMarker()},isInSelection:function(f){return this.getSelection().indexOf(f)>=0},addObjToSelection:function(g){var f=this.getSelection();Kekule.ArrayUtils.pushUnique(f,g.getNearestSelectableObject());this._addSelectRenderOptions(g);this.selectionChanged();return this},removeObjFromSelection:function(g){var f=this.getSelection();Kekule.ArrayUtils.remove(f,g);this._removeSelectRenderOptions(g);this.selectionChanged();return this},deselectAll:function(){var f=this.getSelection();return this.removeFromSelection(f)},select:function(f){this.beginUpdateSelection();try{this.deselectAll();this.addToSelection(f)}finally{this.endUpdateSelection()}return this},addToSelection:function(j){if(!j){return}var h=DataType.isArrayValue(j)?j:[j];this.beginUpdateSelection();try{for(var g=0,f=h.length;g<f;++g){this.addObjToSelection(h[g])}}finally{this.endUpdateSelection()}return this},removeFromSelection:function(h){if(!h){return}var g=DataType.isArrayValue(h)?h:[h];this.beginUpdateSelection();try{for(var f=g.length-1;f>=0;--f){this.removeObjFromSelection(g[f])}}finally{this.endUpdateSelection()}return this},toggleSelectingState:function(k){if(!k){return}var j=DataType.isArrayValue(k)?k:[k];this.beginUpdateSelection();try{for(var g=0,f=j.length;g<f;++g){var h=j[g];if(this.isInSelection(h)){this.removeObjFromSelection(h)}else{this.addObjToSelection(h)}}}finally{this.endUpdateSelection()}return this},hasSelection:function(){return !!this.getSelection().length},deleteSelectedObjs:function(){},getObjectsInScreenBox:function(q,h){var n=this.screenBoxToContext(q);var m=[];var g=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext());var f=h?Kekule.Render.MetaShapeUtils.isIntersectingBox:Kekule.Render.MetaShapeUtils.isInsideBox;for(var k=0,j=g.length;k<j;++k){var o=g[k];var p=o.boundInfo;if(p){if(f(p,n)){m.push(o.obj)}}}return m},selectObjectsInScreenBox:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.select(g)}return g},addObjectsInScreenBoxToSelection:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.addToSelection(g)}return g},removeObjectsInScreenBoxFromSelection:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.removeFromSelection(g)}return g},toggleSelectingStateOfObjectsInScreenBox:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.toggleSelectingState(g)}return g},getObjectsContainerBox:function(x,v){var u=Kekule.ArrayUtils.toArray(x);var h=v||0;var f=[];var g=null;for(var s=0,n=u.length;s<n;++s){var r=u[s];var w=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),r);if(w&&w.length){for(var q=0,p=w.length;q<p;++q){var m=w[q];var o=m.boundInfo;if(o){if(h){o=Kekule.Render.MetaShapeUtils.inflateShape(o,h)}var t=Kekule.Render.MetaShapeUtils.getContainerBox(o);g=g?Kekule.BoxUtils.getContainerBox(g,t):t}}}}return g},getSelectionContainerBox:function(f){return this.getObjectsContainerBox(this.getSelection(),f)},getObjSize:function(f){return this.doGetObjSize(f)},doGetObjSize:function(g){var f=this.getCoordMode();return g.getSizeOfMode?g.getSizeOfMode(f):null},setObjSize:function(g,f){this.doSetObjSize(g,f);this.objectChanged(g)},doSetObjSize:function(g,f){if(g.setSizeOfMode){g.setSizeOfMode(dimension,this.getCoordMode())}},getObjCoord:function(g,f){return this.doGetObjCoord(g,f)},doGetObjCoord:function(l,k){var j=this.getCoordMode();var h=this.getAllowCoordBorrow();var g=l.getAbsBaseCoord?l.getAbsBaseCoord(j,h):l.getAbsCoordOfMode?l.getAbsCoordOfMode(j,h):l.getCoordOfMode?l.getCoordOfMode(j,h):null;if(j===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(k)){var f=Kekule.Render.CoordPos.DEFAULT;if(k!==f){var h=this.getAllowCoordBorrow();var i=l.getExposedContainerBox?l.getExposedContainerBox(j,h):l.getContainerBox?l.getContainerBox(j,h):null;if(i){if(k===Kekule.Render.CoordPos.CORNER_TL){var m={x:(i.x2-i.x1)/2,y:(i.y2-i.y1)/2};g.x=g.x-m.x;g.y=g.y+m.y}}}}return g},setObjCoord:function(g,h,f){this.doSetObjCoord(g,h,f);this.objectChanged(g)},doSetObjCoord:function(j,l,f){var n=Object.create(l);var i=this.getCoordMode();if(i===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(f)){var g=Kekule.Render.CoordPos.DEFAULT;if(f!==g){var h=this.getAllowCoordBorrow();var k=j.getExposedContainerBox?j.getExposedContainerBox(i,h):j.getContainerBox?j.getContainerBox(i,h):null;if(k){var m={x:(k.x2-k.x1)/2,y:(k.y2-k.y1)/2};if(f===Kekule.Render.CoordPos.CORNER_TL){n.x=l.x+m.x;n.y=l.y-m.y}}}}if(j.setAbsBaseCoord){j.setAbsBaseCoord(n,i)}else{if(j.setAbsCoordOfMode){j.setAbsCoordOfMode(n,i)}else{if(j.setAbsCoordOfMode){j.setCoordOfMode(n,i)}}}},getObjectContextCoord:function(g,f){var h=this.getObjCoord(g,f);return this.objCoordToContext(h)},setObjectContextCoord:function(h,f,g){var i=this.contextCoordToObj(f);if(i){this.setObjCoord(h,i,g)}},getObjectScreenCoord:function(g,f){var h=this.getObjCoord(g,f);return this.objCoordToScreen(h)},setObjectScreenCoord:function(h,f,g){var i=this.screenCoordToObj(f);if(i){this.setObjCoord(h,i,g)}},getCoord:function(i,f,h){var g=this.getObjCoord(i,h);return this.translateCoord(g,Kekule.Editor.CoordSys.OBJ,f)},setCoord:function(j,i,f,h){var g=this.translateCoord(i,f,Kekule.Editor.CoordSys.OBJ);this.setObjCoord(j,g,h)},getSize:function(h,f){var g=this.getObjSize(h);return this.translateCoord(g,Kekule.Editor.CoordSys.OBJ,f)},setSize:function(i,g,f){var h=this.translateCoord(g,f,Kekule.Editor.CoordSys.OBJ);this.setObjSize(i,h)},translateCoord:function(j,g,h){if(!j){return null}var i=Kekule.Editor.CoordSys;if(g===i.SCREEN){if(h===i.SCREEN){return j}else{if(h===i.CONTEXT){return this.getObjDrawBridge().transformScreenCoordToContext(this.getObjContext(),j)}else{var f=this.getObjDrawBridge().transformScreenCoordToContext(this.getObjContext(),j);return this.getRootRenderer().transformCoordToObj(this.getObjContext(),this.getChemObj(),f)}}}else{if(g===i.CONTEXT){if(h===i.SCREEN){return this.getObjDrawBridge().transformContextCoordToScreen(this.getObjContext(),j)}else{if(h===i.CONTEXT){return j}else{return this.getRootRenderer().transformCoordToObj(this.getObjContext(),this.getChemObj(),j)}}}else{if(h===i.SCREEN){var f=this.getRootRenderer().transformCoordToContext(this.getObjContext(),this.getChemObj(),j);return this.getObjDrawBridge().transformContextCoordToScreen(this.getObjContext(),f)}else{if(h===i.CONTEXT){return this.getRootRenderer().transformCoordToContext(this.getObjContext(),this.getChemObj(),j)}else{return j}}}}},transformCoordAndSizeOfObjects:function(q,p){var k=this.getCoordMode();var h=this.getAllowCoordBorrow();var o=(k===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(p):Kekule.CoordUtils.calcTransform2DMatrix(p);var f=Object.extend({},p);f=Object.extend(f,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});var g=(k===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(f):Kekule.CoordUtils.calcTransform2DMatrix(f);for(var n=0,j=q.length;n<j;++n){var m=q[n];m.transformAbsCoordByMatrix(o,g,k,true,h);m.scaleSize(p.scale,k,true,h)}},objCoordToContext:function(g){var f=Kekule.Editor.CoordSys;return this.translateCoord(g,f.OBJ,f.CONTEXT)},contextCoordToObj:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.CONTEXT,g.OBJ)},objCoordToScreen:function(g){var f=Kekule.Editor.CoordSys;return this.translateCoord(g,f.OBJ,f.SCREEN)},screenCoordToObj:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.SCREEN,g.OBJ)},screenCoordToContext:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.SCREEN,g.CONTEXT)},contextCoordToScreen:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.CONTEXT,g.SCREEN)},screenBoxToContext:function(f){var h=this.screenCoordToContext({x:f.x1,y:f.y1});var g=this.screenCoordToContext({x:f.x2,y:f.y2});return{x1:h.x,y1:h.y,x2:g.x,y2:g.y}},createDefaultNode:function(j,f,g){var i=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId();var h=new Kekule.Atom();h.setIsotopeId(i);if(g){g.appendNode(h)}this.setCoord(h,j,f);return h},operationDone:function(f){this.doOperationDone(f)},doOperationDone:function(f){},clearOperHistory:function(){var f=this.getOperHistory();if(f){f.clear()}},pushOperation:function(f,i){var g=this.getOperHistory();if(g&&f){g.push(f)}if(i){f.execute()}},popOperation:function(f){var i;var g=this.getOperHistory();if(g){i=g.pop(operation);if(f){i.reverse()}}else{return null}},undo:function(){var g;var f=this.getOperHistory();if(f){this.beginUpdateObject();try{g=f.undo()}finally{this.endUpdateObject();if(g){this.operationDone(g)}}}return g},redo:function(){var g;var f=this.getOperHistory();if(f){this.beginUpdateObject();try{g=f.redo()}finally{this.endUpdateObject();if(g){this.operationDone(g)}}}return g},undoAll:function(){var g;var f=this.getOperHistory();if(f){this.beginUpdateObject();try{g=f.undoAll()}finally{this.endUpdateObject()}}return g},canUndo:function(){var f=this.getOperHistory();return f?f.canUndo():false},canRedo:function(){var f=this.getOperHistory();return f?f.canRedo():false},modifyObjects:function(f,j,p){var o=Kekule.ArrayUtils.toArray(f);try{var g=new Kekule.MacroOperation();for(var n=0,k=o.length;n<k;++n){var m=o[n];var h=new Kekule.ChemObjOperation.Modify(m,j);g.add(h)}g.execute()}finally{if(p&&this.getEnableOperHistory()&&g.getChildCount()){this.pushOperation(g)}}return this},modifyObjectsRenderOptions:function(h,p,o,u){var t=Kekule.ArrayUtils.toArray(h);var g=o?"render3DOptions":"renderOptions";var v=o?"getRender3DOptions":"getRenderOptions";try{var k=new Kekule.MacroOperation();for(var s=0,n=t.length;s<n;++s){var r=t[s];if(r[v]){var j=r[v]();var f=Object.extend({},j);f=Object.extend(f,p);var q={};q[g]=f;var m=new Kekule.ChemObjOperation.Modify(r,q);k.add(m)}}k.execute()}finally{if(u&&this.getEnableOperHistory()&&k.getChildCount()){this.pushOperation(k)}}return this},getClientScrollPosition:function(){var f=this.getEditClientElem().parentNode;return f?{x:f.scrollLeft,y:f.scrollTop}:null},scrollClientTo:function(g,h){var f=this.getEditClientElem().parentNode;if(Kekule.ObjUtils.notUnset(g)){f.scrollTop=g}if(Kekule.ObjUtils.notUnset(h)){f.scrollLeft=h}return this},scrollClientToTop:function(){return this.scrollClientTo(0,null)}});Kekule.Editor.BaseEditor.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.Editor.BaseEditor.Settings",initProperties:function(){this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getEnableCreateNewDoc()},setter:function(f){this.getEditor().setEnableCreateNewDoc(f)}});this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getInitOnNewDoc()},setter:function(f){this.getEditor().setInitOnNewDoc(f)}});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getEnableOperHistory()},setter:function(f){this.getEditor().setEnableOperHistory(f)}})},getEditor:function(){return this.getDisplayer()}});Kekule.Editor.IaControllerManager={_controllerMap:new Kekule.MapEx(true),register:function(g,f){c._controllerMap.set(g,f)},unregister:function(f){c._controllerMap.remove(f)},getAllControllerClasses:function(){return c._controllerMap.getKeys()},getAvailableControllerClasses:function(g){var f=[];var m=c.getAllControllerClasses();for(var k=0,h=m.length;k<h;++k){var n=m[k];var j=c._controllerMap.get(n);if(!j||ClassEx.isOrIsDescendantOf(g,j)){f.push(n)}}return f}};var c=Kekule.Editor.IaControllerManager;Kekule.Editor.BaseEditorIaController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function($super,f){$super(f)},initProperties:function(){this.defineProp("manuallyHotTrack",{dataType:DataType.BOOL,serializable:false})},getDefId:function(){return Kekule.ClassUtils.getLastClassName(this.getClassName())},getEditor:function(){return this.getWidget()},setEditor:function(f){return this.setWidget(f)},getEditorConfigs:function(){var f=this.getEditor();return f?f.getEditorConfigs():null},handleUiEvent:function($super,i){var g=false;var h=i.getTarget();var f=this.getEditor().getUiEventReceiverElem();if(f){if((h===f)||Kekule.DomUtils.isDescendantOf(h,f)){g=true}}else{g=true}if(g){$super(i)}},canInteractWithObj:function(f){return !!f},zoomEditor:function(f){if(f>0){this.getEditor().zoomIn(f)}else{if(f<0){this.getEditor().zoomOut(-f)}}},react_mousemove:function(g){var h=this._getEventMouseCoord(g);var f=this.getEditor().getTopmostBasicObjectAtCoord(h);if(!this.getManuallyHotTrack()){if(f&&this.canInteractWithObj(f)){this.getEditor().hotTrackOnObj(f)}else{this.getEditor().hotTrackOnObj(null)}}return true},react_mousewheel:function(f){if(f.getCtrlKey()){var g=f.wheelDeltaY||f.wheelDelta;if(g){g/=120}this.zoomEditor(g);f.preventDefault();return true}},_getEventMouseCoord:function($super,h,g){var f=g||this.getWidget().getCoreElement();return $super(h,f)}});Kekule.Editor.BasicEraserIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicEraserIaController",initialize:function($super,f){$super(f);this._isExecuting=false},canInteractWithObj:function(f){return !!f},removeObjs:function(g){if(g&&g.length){var f=this.getEditor();f.beginUpdateObject();try{var h=this.doGetActualRemovedObjs(g);this.doRemoveObjs(h)}finally{f.endUpdateObject()}}},doRemoveObjs:function(f){},doGetActualRemovedObjs:function(f){return f},removeSelection:function(){var f=this.getEditor();this.removeObjs(f.getSelection());f.deselectAll()},removeOnScreenCoord:function(g){var f=this.getEditor().getTopmostBasicObjectAtCoord(g);if(f){this.removeObjs([f]);return true}else{return false}},startRemove:function(){this._isExecuting=true},endRemove:function(){this._isExecuting=false},isRemoving:function(){return this._isExecuting},react_mousedown:function(f){if(f.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.startRemove();var g=this._getEventMouseCoord(f);this.removeOnScreenCoord(g)}else{if(f.getButton()===Kekule.X.Event.MOUSE_BTN_RIGHT){this.endRemove()}}},react_mouseup:function(f){if(f.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.endRemove()}},react_mousemove:function($super,f){$super(f);if(this.isRemoving()){var g=this._getEventMouseCoord(f);this.removeOnScreenCoord(g)}return true}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicEraserIaController,Kekule.Editor.BaseEditor);Kekule.Editor.BasicManipulationIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicManipulationIaController",initialize:function($super,f){$super(f);this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL);this.setEnableSelect(true);this.setEnableMove(true);this.setEnableResize(true);this.setEnableConstrainedResize(true);this.setEnableRotate(true);this._suppressConstrainedResize=false},initProperties:function(){this.defineProp("enableSelect",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableResize",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableRotate",{dataType:DataType.BOOL,serializable:false});this.defineProp("state",{dataType:DataType.INT,serializable:false});this.defineProp("startCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("endCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("startBox",{dataType:DataType.HASH,serializable:false});this.defineProp("endBox",{dataType:DataType.HASH,serializable:false});this.defineProp("lastRotateAngle",{dataType:DataType.FLOAT,serializable:false});this.defineProp("rotateCenter",{dataType:DataType.HASH,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("rotateCenter");if(!f){var g=this._getManipulateObjsCenterCoord();f=this.getEditor().objCoordToScreen(g);this.setPropStoreFieldValue("rotateCenter",f)}return f}});this.defineProp("resizeStartingRegion",{dataType:DataType.INT,serializable:false});this.defineProp("enableConstrainedResize",{dataType:DataType.BOOL,serializable:false});this.defineProp("rotateStartingRegion",{dataType:DataType.INT,serializable:false});this.defineProp("manipulateOriginObjs",{dataType:DataType.ARRAY,serializable:false});this.defineProp("manipulateObjs",{dataType:DataType.ARRAY,serializable:false,setter:function(f){this.setPropStoreFieldValue("manipulateObjs",f);if(!f){this.getEditor().endOperatingObjs()}else{this.getEditor().prepareOperatingObjs(f)}}});this.defineProp("manipulateObjInfoMap",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("manipulateObjInfoMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("manipulateObjInfoMap",f)}return f}});this.defineProp("manipulateObjCurrInfoMap",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("manipulateObjCurrInfoMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("manipulateObjCurrInfoMap",f)}return f}});this.defineProp("manipulationType",{dataType:DataType.INT,serializable:false});this.defineProp("isManipulatingSelection",{dataType:DataType.BOOL,serializable:false});this.defineProp("moveOperations",{dataType:DataType.ARRAY,serializable:false});this.defineProp("objOperationMap",{dataType:"Kekule.MapEx",serializable:false,getter:function(){var f=this.getPropStoreFieldValue("objOperationMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("objOperationMap",f)}return f}})},doFinalize:function($super){var f=this.getPropStoreFieldValue("manipulateObjInfoMap");if(f){f.clear()}f=this.getPropStoreFieldValue("objOperationMap");if(f){f.clear()}$super()},isConstrainedResize:function(){return this.getEnableConstrainedResize()&&(!this._suppressConstrainedResize)},getCoordOnSelectionRotationRegion:function(o){var k=Kekule.Editor.BoxRegion;var p=this.getEditor();var q=p.getCoordRegionInSelectionMarker(o);if(q!==k.OUTSIDE){return false}var f=p.getEditorConfigs().getInteractionConfigs().getRotationRegionInflation();var m=p.getUiSelectionAreaContainerBox();if(m&&p.hasSelection()){var n=[k.CORNER_TL,k.CORNER_TR,k.CORNER_BR,k.CORNER_BL];var v=[{x:m.x1,y:m.y1},{x:m.x2,y:m.y1},{x:m.x2,y:m.y2},{x:m.x1,y:m.y2}];var w=false;var u=f;for(var j=0,h=n.length;j<h;++j){var t=n[j];var s=v[j];var g=Kekule.CoordUtils.getDistance(s,o);if(g<=u){w=t;u=g}}return w}else{return false}},createManipulateOperation:function(){var m=[];this.setMoveOperations(m);var o=this.getManipulateObjs();var g=this.getManipulateObjInfoMap();var h=this.getObjOperationMap();h.clear();for(var n=0,j=o.length;n<j;++n){var k=o[n];var p=g.get(k);var f=new Kekule.ChemObjOperation.MoveAndResize(k,null,null,this.getEditor().getCoordMode(),true);f.setAllowCoordBorrow(this.getEditor().getAllowCoordBorrow());f.setOldCoord(p.objCoord);f.setOldDimension(p.size);m.push(f)}return m},updateChildMoveOperation:function(h,f,g){var i=this.getMoveOperations()[h];i.setNewCoord(g)},updateChildResizeOperation:function(h,g,f){var i=this.getMoveOperations()[h];i.setNewDimension(f)},getAllObjOperations:function(){var f=this.getMoveOperations();return f},getActiveOperation:function(){var f=this.getAllObjOperations();f=Kekule.ArrayUtils.toUnique(f);if(f.length<=0){return null}else{if(f.length===1){return f[0]}else{var g=new Kekule.MacroOperation(f);return g}}},reverseActiveOperation:function(){return this.getActiveOperation().reverse()},addOperationToEditor:function(){var f=this.getEditor();if(f&&f.getEnableOperHistory()){f.pushOperation(this.getActiveOperation())}},getActualManipulatingObjects:function(k){var f=[];for(var h=0,g=k.length;h<g;++h){var j=k[h];var m=j.getCoordDependentObjects?j.getCoordDependentObjects():[j];Kekule.ArrayUtils.pushUnique(f,m)}return f},prepareManipulating:function(p,q,n,j,s){this.setManipulationType(p);var o=this.getActualManipulatingObjects(q);this.setManipulateOriginObjs(q);this.setManipulateObjs(o);var f=this.getManipulateObjInfoMap();f.clear();this.getManipulateObjCurrInfoMap().clear();var r=this.getEditor();for(var m=0,h=o.length;m<h;++m){var k=o[m];var g=this.createManipulateObjInfo(k,n);f.set(k,g)}this.setStartBox(j);this.setRotateCenter(s);this.setLastRotateAngle(null);this.createManipulateOperation()},cancelManipulatingObjs:function(){var f=this.getEditor();var g=this.getManipulateObjs();this.reverseActiveOperation();this.notifyCoordChangeOfObjects(this.getManipulateObjs())},_getManipulateObjsCenterCoord:function(){var o=this.getManipulateObjs();if(!o||!o.length){return null}var m=this.getEditor().getCoordMode();var g=this.getEditor().getAllowCoordBorrow();var k={x:0,y:0,z:0};for(var h=0,f=o.length;h<f;++h){var n=o[h];var j=n.getAbsBaseCoord?n.getAbsBaseCoord(m,g):n.getAbsCoord?n.getAbsCoord(m,g):n.getCoordOfMode?n.getCoordOfMode(m,g):null;if(j){k=Kekule.CoordUtils.add(k,j)}}return Kekule.CoordUtils.divide(k,o.length)},_maniplateObjsFrameEnd:function(f){},_addManipultingObjNewInfo:function(i,g){var f=this.getManipulateObjCurrInfoMap();var h=f.get(i)||{};h=Object.extend(h,g);f.set(i,h)},applyManipulatingObjsInfo:function(n){var m=this.getManipulateObjs();var j=this.getManipulateObjCurrInfoMap();for(var g=0,f=m.length;g<f;++g){var k=m[g];var h=j.get(k);this.applySingleManipulatingObjInfo(g,k,h,n)}},applySingleManipulatingObjInfo:function(i,g,f,h){if(f){if(f.screenCoord){this.doMoveManipulatedObj(i,g,f.screenCoord,h)}if(f.size){this.doResizeManipulatedObj(i,g,f.size)}}},_calcActualRotateAngle:function(i,h,f,g){return h},_calcManipulateObjsRotationInfo:function(f,z){var q=Kekule.CoordUtils;var A;var h=false;var k=this.getRotateCenter();var s=this.getStartCoord();var j=this.getEditorConfigs().getInteractionConfigs().getRotationLocationPointDistanceThreshold();if(j){var u=q.getDistance(s,k);if(u<j){A=0;h=true;this.setStartCoord(z);return false}var y=q.getDistance(z,k);if(y<j){A=0;h=true;return false}}if(!h){var g=q.substract(z,k);var t=Math.atan2(g.y,g.x);g=q.substract(s,k);var w=Math.atan2(g.y,g.x);A=t-w;A=this._calcActualRotateAngle(f,A,w,t);var n=this.getLastRotateAngle();if(Kekule.ObjUtils.notUnset(n)&&Kekule.NumUtils.isFloatEqual(A,n,0.00001)){return false}this.setLastRotateAngle(A)}var m=Kekule.CoordUtils.calcTransform2DMatrix({center:k,rotateAngle:A});for(var x=0,v=f.length;x<v;++x){var p=f[x];var B=this.getManipulateObjInfoMap().get(p);if(!B.hasNoCoord){var r=B.screenCoord;var o=q.transform2DByMatrix(r,m);this._addManipultingObjNewInfo(p,{screenCoord:o})}if(B.size){}}return true},rotateManipulatedObjs:function(l){var i=Kekule.Editor.BoxRegion;var k=Kekule.CoordUtils;var h=this.getEditor();var j=this.getManipulateObjs();var g=[];var m=!this._calcManipulateObjsRotationInfo(j,l);if(m){return}var f=this.getManipulateObjCurrInfoMap();h.beginUpdateObject();try{this.applyManipulatingObjsInfo(l);this._maniplateObjsFrameEnd(j);this.notifyCoordChangeOfObjects(j)}finally{h.endUpdateObject();this.manipulateStepDone()}},_calcManipulateObjsResizeInfo:function(g,j,B){var k=Kekule.Editor.BoxRegion;var u=Kekule.CoordUtils;var o=this.getStartBox();var D=u.substract(B,this.getStartCoord());var p;if(j===k.EDGE_TOP){D.x=0;p={x:(o.x1+o.x2)/2,y:o.y2}}else{if(j===k.EDGE_BOTTOM){D.x=0;p={x:(o.x1+o.x2)/2,y:o.y1}}else{if(j===k.EDGE_LEFT){D.y=0;p={x:o.x2,y:(o.y1+o.y2)/2}}else{if(j===k.EDGE_RIGHT){D.y=0;p={x:o.x1,y:(o.y1+o.y2)/2}}else{if(this.isConstrainedResize()){var A=(o.x2-o.x1)/(o.y2-o.y1);var z=D.x/D.y;if(Math.abs(z)>A){D.x=D.y*A*(Math.sign(z)||1)}else{D.y=D.x/A*(Math.sign(z)||1)}}p=(j===k.CORNER_TL)?{x:o.x2,y:o.y2}:(j===k.CORNER_TR)?{x:o.x1,y:o.y2}:(j===k.CORNER_BL)?{x:o.x2,y:o.y1}:{x:o.x1,y:o.y1}}}}}var r=(j===k.CORNER_TL)||(j===k.CORNER_BL)||(j===k.EDGE_LEFT);var q=(j===k.CORNER_TL)||(j===k.CORNER_TR)||(j===k.EDGE_TOP);var G=1+D.x/(o.x2-o.x1)*(r?-1:1);var F=1+D.y/(o.y2-o.y1)*(q?-1:1);var x={center:p,scaleX:G,scaleY:F};var h=false;var n=h?u.calcTransform3DMatrix(x):u.calcTransform2DMatrix(x);for(var y=0,w=g.length;y<w;++y){var t=g[y];var E=this.getManipulateObjInfoMap().get(t);var m={};if(!E.hasNoCoord){var v=E.screenCoord;var s=h?u.transform3DByMatrix(v,n):u.transform2DByMatrix(v,n);m.screenCoord=s}if(E.size){var f={x:E.size.x*Math.abs(G),y:E.size.y*Math.abs(F)};m.size=f}this._addManipultingObjNewInfo(t,m)}},resizeManipulatedObjs:function(i){var f=this.getEditor();var h=this.getManipulateObjs();this._calcManipulateObjsResizeInfo(h,this.getResizeStartingRegion(),i);f.beginUpdateObject();var g=this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(i);this._maniplateObjsFrameEnd(h);this.notifyCoordChangeOfObjects(h)}finally{f.endUpdateObject();this.manipulateStepDone()}},_calcActualMovedScreenCoord:function(h,g,f){return f},_calcManipulateObjsMoveInfo:function(o,p){var f=Kekule.CoordUtils;var h=this.getManipulateObjCurrInfoMap();for(var m=0,j=o.length;m<j;++m){var k=o[m];var g=this.getManipulateObjInfoMap().get(k);if(g.hasNoCoord){continue}var n=f.add(p,g.screenCoordOffset);n=this._calcActualMovedScreenCoord(k,g,n);this._addManipultingObjNewInfo(k,{screenCoord:n})}},moveManipulatedObjs:function(k){var j=Kekule.CoordUtils;var g=this.getEditor();var i=this.getManipulateObjs();var f=[];this._calcManipulateObjsMoveInfo(i,k);g.beginUpdateObject();var h=this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(k);this._maniplateObjsFrameEnd(i);this.notifyCoordChangeOfObjects(i)}finally{g.endUpdateObject();this.manipulateStepDone()}},doMoveManipulatedObj:function(j,i,g,f){var h=this.getEditor();this.updateChildMoveOperation(j,i,h.screenCoordToObj(g));h.setObjectScreenCoord(i,g)},doResizeManipulatedObj:function(h,g,f){this.updateChildResizeOperation(h,g,f);if(g.setSizeOfMode){g.setSizeOfMode(f,this.getEditor().getCoordMode())}},startDirectManipulate:function(j,h,f,k,g){var i=Kekule.ArrayUtils.toArray(h);this.setState(Kekule.Editor.BasicManipulationIaController.State.MANIPULATING);this.setStartCoord(f);this.setIsManipulatingSelection(false);this.prepareManipulating(j||Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE,i,f,k,g)},manipulateStepDone:function(){},stopManipulate:function(){this.setManipulateObjs(null);this.getManipulateObjInfoMap().clear();this.getObjOperationMap().clear()},refreshManipulateObjs:function(){this.setManipulateObjs(this.getManipulateObjs())},createManipulateObjInfo:function(i,f){var g=this.getEditor();var h={objCoord:g.getObjCoord(i),screenCoord:g.getObjectScreenCoord(i),size:g.getObjSize(i)};h.hasNoCoord=!h.objCoord;if(!h.hasNoCoord){h.screenCoordOffset=Kekule.CoordUtils.substract(h.screenCoord,f)}return h},notifyCoordChangeOfObjects:function(n){var j=[];var h=this.getEditor();for(var g=0,f=n.length;g<f;++g){var k=n[g];Kekule.ArrayUtils.pushUnique(j,k);var m=k.getCoordDeterminateObjects?k.getCoordDeterminateObjects():[k];Kekule.ArrayUtils.pushUnique(j,m)}h.objectsChanged(j)},canInteractWithObj:function(f){return(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL)&&f},doTestMouseCursor:function(l,i){var f="";var k=this._getEventMouseCoord(i,this.getEditor().getEditClientElem());if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL){if(this.getEnableResize()){var g=Kekule.Editor.BoxRegion;var h=this.getEditor().getCoordRegionInSelectionMarker(k);var f=(h===g.INSIDE)?"move":(h===g.CORNER_TL)?"nwse-resize":(h===g.CORNER_TR)?"nesw-resize":(h===g.CORNER_BL)?"nesw-resize":(h===g.CORNER_BR)?"nwse-resize":(h===g.EDGE_TOP)||(h===g.EDGE_BOTTOM)?"ns-resize":(h===g.EDGE_LEFT)||(h===g.EDGE_RIGHT)?"ew-resize":""}if(!f){if(this.getEnableRotate()){var h=this.getCoordOnSelectionRotationRegion(k);if(!!h){var j=Kekule.Widget.StyleResourceNames;f=(h===g.CORNER_TL)?j.CURSOR_ROTATE_NW:(h===g.CORNER_TR)?j.CURSOR_ROTATE_NE:(h===g.CORNER_BL)?j.CURSOR_ROTATE_SW:(h===g.CORNER_BR)?j.CURSOR_ROTATE_SE:j.CURSOR_ROTATE}}}}return f},react_mousemove:function($super,j){$super(j);if(this._isBusy){return true}var l=this._getEventMouseCoord(j);if(this._lastMouseMoveCoord){var f=Kekule.CoordUtils.getDistance(l,this._lastMouseMoveCoord);if(f<2){return true}}this._lastMouseMoveCoord=l;var h=Kekule.Editor.BasicManipulationIaController.State;var g=Kekule.Editor.BasicManipulationIaController.ManipulationType;var i=this.getState();if(i===h.SELECTING){if(this.getEnableSelect()){this.getEditor().dragSelectingBoxToCoord(l)}}else{if(i===h.MANIPULATING){var k=this.getManipulationType();try{this._isBusy=true;if(k===g.MOVE){this.moveManipulatedObjs(l)}else{if(k===g.RESIZE){this._suppressConstrainedResize=j.getAltKey();this.resizeManipulatedObjs(l)}else{if(k===g.ROTATE){this.rotateManipulatedObjs(l)}}}}finally{this._isBusy=false}}}return true},react_mousedown:function(n){var j=Kekule.Editor.BasicManipulationIaController.State;var h=Kekule.Editor.BasicManipulationIaController.ManipulationType;if(n.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this._lastMouseMoveCoord=null;var m=this._getEventMouseCoord(n);if((this.getState()===j.NORMAL)){this.setStartCoord(m);var i=this.getEditor().getCoordRegionInSelectionMarker(m);var l=Kekule.Editor.BoxRegion;var o=this.getEnableResize()&&(i!==l.INSIDE)&&(i!==l.OUTSIDE);var p=!o&&this.getEnableMove()&&(i!==l.OUTSIDE);var g=this.getCoordOnSelectionRotationRegion(m);var q=!o&&!p&&this.getEnableRotate()&&!!g;if(o){this.setState(j.MANIPULATING);this.setIsManipulatingSelection(true);this.setResizeStartingRegion(i);this.prepareManipulating(h.RESIZE,this.getEditor().getSelection(),m,this.getEditor().getSelectionContainerBox())}else{if(p){this.setState(j.MANIPULATING);this.setIsManipulatingSelection(true);this.prepareManipulating(h.MOVE,this.getEditor().getSelection(),m)}else{if(q){this.setState(j.MANIPULATING);this.setIsManipulatingSelection(true);this.setRotateStartingRegion(g);this.prepareManipulating(h.ROTATE,this.getEditor().getSelection(),m,this.getEditor().getSelectionContainerBox())}else{var k=this.getEditor().getTopmostBasicObjectAtCoord(m);if(k){k=k.getNearestSelectableObject();if(this.getEnableMove()){this.startDirectManipulate(null,k,m)}}else{if(this.getEnableSelect()){var f=n.getShiftKey();this.getEditor().startSelectingBoxDrag(m,f);this.setState(j.SELECTING)}}}}}}}else{if(n.getButton()===Kekule.X.Event.MouseButton.RIGHT){if(this.getState()===j.MANIPULATING){this.cancelManipulatingObjs();this.setState(j.NORMAL);n.stopPropagation()}}}return true},react_mouseup:function(k){if(k.getButton()===Kekule.X.Event.MouseButton.LEFT){var l=this._getEventMouseCoord(k);this.setEndCoord(l);var h=this.getStartCoord();var f=l;var j=k.getShiftKey();var i=this.getState();var g=Kekule.Editor.BasicManipulationIaController.State;if(i===g.SELECTING){this.getEditor().endSelectingBoxDrag(l,j);this.setState(g.NORMAL)}else{if(i===g.MANIPULATING){if(Kekule.CoordUtils.isEqual(h,f)){if(this.getEnableSelect()){this.getEditor().selectOnCoord(h,j)}}else{if(this.getEnableMove()){this.addOperationToEditor()}}this.stopManipulate();this.setState(g.NORMAL)}}}return true}});Kekule.Editor.BasicManipulationIaController.State={NORMAL:0,SELECTING:1,MANIPULATING:2};Kekule.Editor.BasicManipulationIaController.ManipulationType={MOVE:0,ROTATE:1,RESIZE:2};Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicManipulationIaController,Kekule.Editor.BaseEditor)})();(function(){Kekule.ChemObjOperation={};Kekule.ChemObjOperation.Base=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemObjOperation.Base",initialize:function($super,a){$super();this.setTarget(a)},initProperties:function(){this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL})}});Kekule.ChemObjOperation.Modify=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Modify",initialize:function($super,b,a){$super(b);if(a){this.setNewPropValues(a)}},initProperties:function(){this.defineProp("newPropValues",{dataType:DataType.HASH});this.defineProp("oldPropValues",{dataType:DataType.HASH})},doExecute:function(){var a={};var d=this.getNewPropValues();var c=this.getTarget();c.beginUpdate();try{for(var e in d){var b=d[e];a[e]=c.getPropValue(e);c.setPropValue(e,b)}}finally{c.endUpdate()}this.setOldPropValues(a)},doReverse:function(){var c=this.getOldPropValues();var b=this.getTarget();for(var d in c){var a=c[d];b.setPropValue(d,a)}}});Kekule.ChemObjOperation.MoveTo=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveTo",initialize:function($super,d,a,b,c){$super(d);if(a){this.setNewCoord(a)}this.setCoordMode(b||Kekule.CoordMode.COORD2D);this.setUseAbsBaseCoord(!!c)},initProperties:function(){this.defineProp("newCoord",{dataType:DataType.HASH});this.defineProp("oldCoord",{dataType:DataType.HASH});this.defineProp("coordMode",{dataType:DataType.INT});this.defineProp("useAbsBaseCoord",{dataType:DataType.BOOL})},setObjCoord:function(c,e,b){if(c&&e&&b){var d=false;if(this.getUseAbsBaseCoord()){if(c.setAbsBaseCoord){c.setAbsBaseCoord(e,b,this.getAllowCoordBorrow());d=true}}else{if(c.setCoordOfMode){c.setCoordOfMode(e,b);d=true}}if(!d){var a=c.getClassName?c.getClassName():(typeof c);Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_COORD_OF_CLASS").format(a))}}},getObjCoord:function(b,a){if(this.getUseAbsBaseCoord()){if(b.getAbsBaseCoord){return b.getAbsBaseCoord(a,this.getAllowCoordBorrow())}}else{if(b.getCoordOfMode){return b.getCoordOfMode(a,this.getAllowCoordBorrow())}}return null},doExecute:function(){var a=this.getTarget();if(!this.getOldCoord()){this.setOldCoord(this.getObjCoord(a,this.getCoordMode()))}if(this.getNewCoord()){this.setObjCoord(this.getTarget(),this.getNewCoord(),this.getCoordMode())}},doReverse:function(){if(this.getOldCoord()){this.setObjCoord(this.getTarget(),this.getOldCoord(),this.getCoordMode())}}});Kekule.ChemObjOperation.MoveAndResize=Class.create(Kekule.ChemObjOperation.MoveTo,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResize",initialize:function($super,e,b,a,c,d){$super(e,a,c,d)},initProperties:function(){this.defineProp("newDimension",{dataType:DataType.HASH});this.defineProp("oldDimension",{dataType:DataType.HASH})},setObjSize:function(d,c,b){if(d&&c){if(d.setSizeOfMode){d.setSizeOfMode(c,b)}else{var a=d.getClassName?d.getClassName():(typeof d);Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_DIMENSION_OF_CLASS").format(a))}}},getObjSize:function(b,a){if(b.getSizeOfMode){return b.getSizeOfMode(a,this.getAllowCoordBorrow())}else{return null}},doExecute:function($super){$super();var a=this.getTarget();if(!this.getOldDimension()){this.setOldDimension(this.getObjSize(a,this.getCoordMode()))}if(this.getNewDimension()){this.setObjSize(this.getTarget(),this.getNewDimension(),this.getCoordMode())}},doReverse:function($super){if(this.getOldDimension()){this.setObjSize(this.getTarget(),this.getOldDimension(),this.getCoordMode())}$super()}});Kekule.ChemObjOperation.Add=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Add",initialize:function($super,c,b,a){$super(c);this.setParentObj(b);this.setRefSibling(a)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:false})},doExecute:function(){var b=this.getParentObj();var c=this.getTarget();if(b&&c){var a=this.getRefSibling()||null;b.insertBefore(c,a)}},doReverse:function(){var c=this.getTarget();var b=this.getParentObj();if(b&&c){var a=this.getRefSibling();if(!a){a=c.getNextSibling();this.setRefSibling(a)}b.removeChild(c)}}});Kekule.ChemObjOperation.Remove=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Remove",initialize:function($super,c,b,a){$super(c);this.setParentObj(b);this.setRefSibling(a)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("ownerObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:false})},doExecute:function(){var d=this.getTarget();var c=this.getParentObj();var a=this.getOwnerObj();if(!c&&d.getParent){c=d.getParent();this.setParentObj(c)}if(!a&&d.getOwner){a=d.getOwner();this.setOwnerObj(a)}if(c&&d){if(!this.getRefSibling()){var b=d.getNextSibling?d.getNextSibling():null;this.setRefSibling(b)}c.removeChild(d)}},doReverse:function(){var c=this.getParentObj();var a=this.getOwnerObj();var d=this.getTarget();if(c&&d){var b=this.getRefSibling();if(a){d.setOwner(a)}c.insertBefore(d,b)}}});Kekule.ChemStructOperation={};Kekule.ChemStructOperation.AddNode=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddNode"});Kekule.ChemStructOperation.RemoveNode=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveNode",initProperties:function(){this.defineProp("linkedConnectors",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){if(!this.getLinkedConnectors()){this.setLinkedConnectors(Kekule.ArrayUtils.clone(this.getTarget().getLinkedConnectors()))}$super()},doReverse:function($super){$super();var d=this.getLinkedConnectors();if(d&&d.length){var c=this.getTarget();for(var b=0,a=d.length;b<a;++b){c.appendLinkedConnector(d[b])}}}});Kekule.ChemStructOperation.ReplaceNode=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemStructOperation.ReplaceNode",initialize:function($super,c,a,b){$super();this.setOldNode(c);this.setNewNode(a);this.setParentObj(b)},initProperties:function(){this.defineProp("oldNode",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("newNode",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("parentObj",{dataType:"Kekule.ChemStructureFragment",serializable:false})},doExecute:function(){var c=this.getOldNode();var a=this.getNewNode();if(c&&a){var b=this.getParentObj();if(!b){b=c.getParent();this.setParentObj(b)}if(b.replaceNode){b.replaceNode(c,a)}}},doReverse:function(){var c=this.getOldNode();var a=this.getNewNode();if(c&&a){var b=this.getParentObj()||a.getParent();if(b.replaceNode){b.replaceNode(a,c)}}}});Kekule.ChemStructOperation.AddConnector=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddConnector",initialize:function($super,d,b,a,c){$super(d);this.setParentObj(b);this.setRefSibling(a);this.setConnectedObjs(c)},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){$super();var a=Kekule.ArrayUtils.clone(this.getConnectedObjs());if(a&&a.length){this.getTarget().setConnectedObjs(a)}},doReverse:function($super){$super()}});Kekule.ChemStructOperation.RemoveConnector=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveConnector",initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){if(!this.getConnectedObjs()){this.setConnectedObjs(Kekule.ArrayUtils.clone(this.getTarget().getConnectedObjs()))}$super()},doReverse:function($super){$super();var a=this.getConnectedObjs();if(a&&a.length){this.getTarget().setConnectedObjs(a)}}});Kekule.ChemStructOperation.MergeNodes=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodes",initialize:function($super,c,b,a){$super(c);this.setDest(b);this.setEnableStructFragmentMerge(a||false);this._refSibling=null;this._nodeParent=null;this._structFragmentMergeOperation=null;this._removeConnectorOperations=[]},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("changedConnectors",{dataType:DataType.ARRAY,serializable:false});this.defineProp("removedConnectors",{dataType:DataType.ARRAY,serializable:false});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL})},getCommonSiblings:function(c,b){var a=c.getLinkedObjs();var d=b.getLinkedObjs();return Kekule.ArrayUtils.intersect(a,d)},doExecute:function(){var n=this.getTarget();var h=this.getDest();var m=n.getParentFragment();var o=h.getParentFragment();if(m!==o){if(this.getEnableStructFragmentMerge()){this._structFragmentMergeOperation=new Kekule.ChemStructOperation.MergeStructFragment(m,o);this._structFragmentMergeOperation.execute();m=o}else{return null}}this._nodeParent=m;var e=this.getRemovedConnectors();if(!e){var b=this.getCommonSiblings(n,h);var e=[];if(b.length){for(var g=0,f=b.length;g<f;++g){var p=b[g];var d=n.getConnectorTo(p);if(d&&(d.getConnectedObjCount()==2)){e.push(d)}}}var k=n.getConnectorTo(h);if(k){e.push(k)}this.setRemovedConnectors(e)}var a=this.getChangedConnectors();if(!a){var a=Kekule.ArrayUtils.clone(n.getLinkedConnectors())||[];a=Kekule.ArrayUtils.exclude(a,e);this.setChangedConnectors(a)}this._refSibling=n.getNextSibling();for(var g=0,f=a.length;g<f;++g){var d=a[g];var j=d.indexOfConnectedObj(n);d.removeConnectedObj(n);d.insertConnectedObjAt(h,j)}this._removeConnectorOperations=[];for(var g=0,f=e.length;g<f;++g){var d=e[g];var c=new Kekule.ChemStructOperation.RemoveConnector(d);c.execute();this._removeConnectorOperations.push(c)}m.removeNode(n)},doReverse:function(){var j=this.getTarget();var f=this.getDest();var h=this._nodeParent;h.insertBefore(j,this._refSibling);if(this._removeConnectorOperations.length){for(var e=this._removeConnectorOperations.length-1;e>=0;--e){var b=this._removeConnectorOperations[e];b.reverse()}}this._removeConnectorOperations=[];var a=this.getChangedConnectors();for(var e=0,c=a.length;e<c;++e){var d=a[e];var g=d.indexOfConnectedObj(f);d.removeConnectedObj(f);d.insertConnectedObjAt(j,g)}if(this._structFragmentMergeOperation){this._structFragmentMergeOperation.reverse()}}});Kekule.ChemStructOperation.MergeNodes.canMerge=function(e,b,g,d){if((e instanceof Kekule.StructureFragment)||(b instanceof Kekule.StructureFragment)){return false}if(!((e instanceof Kekule.ChemStructureNode)&&(b instanceof Kekule.ChemStructureNode))){return false}var f=e.getParent();var c=b.getParent();var a=(f===c)||g;if(!d){a=a&&(!e.getConnectorTo(b))}return a};Kekule.ChemStructOperation.MergeConnectors=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",initialize:function($super,d,b,c,a){$super(d);this.setDest(b);this.setCoordMode(c||Kekule.CoordMode.COORD2D);this.setEnableStructFragmentMerge(a||false);this._refSibling=null;this._nodeParent=null;this._nodeMergeOperations=[]},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureConnector",serializable:false});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL});this.defineProp("coordMode",{dataType:DataType.INT})},doExecute:function(){var s=Kekule.ChemStructOperation.MergeConnectors.canMerge(this.getTarget(),this.getDest(),this.getEnableStructFragmentMerge());if(!s){Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_MERGE_CONNECTORS"))}var j=this.getCoordMode();var c=[this.getTarget(),this.getDest()];var p=Kekule.ArrayUtils;var o=p.clone(this.getTarget().getConnectedObjs());var q=p.clone(this.getDest().getConnectedObjs());var e=this.getAllowCoordBorrow();for(var k=0,h=c.length;k<h;++k){var g=c[k];var n=g.getConnectedObjAt(0).getAbsCoordOfMode(j,e);var m=g.getConnectedObjAt(1).getAbsCoordOfMode(j,e);var a=Kekule.CoordUtils.substract(n,m);var r=Math.abs(a.x)>Math.abs(a.y)?"x":"y";if(Kekule.ObjUtils.notUnset(n.z)){if(Math.abs(a.z)>Math.abs(a.x)){r="z"}}var b=(k===0)?o:q;b.sort(function(l,i){var u=l.getAbsCoordOfMode(j,e);var t=i.getAbsCoordOfMode(j,e);return(u[r]-t[r])||0})}var d=p.intersect(o,q);o=p.exclude(o,d);q=p.exclude(q,d);this._nodeMergeOperations=[];for(var k=0,h=o.length;k<h;++k){if(o[k]!==q[k]){var f=new Kekule.ChemStructOperation.MergeNodes(o[k],q[k],this.getEnableStructFragmentMerge());f.execute()}this._nodeMergeOperations.push(f)}},doReverse:function(){for(var a=this._nodeMergeOperations.length-1;a>=0;--a){var b=this._nodeMergeOperations[a];b.reverse()}this._nodeMergeOperations=[]}});Kekule.ChemStructOperation.MergeConnectors.canMerge=function(d,c,e){if(!e&&(d.getParent()!==c.getParent())){return false}if(d.isConnectingConnector()||c.isConnectingConnector()){return false}var a=d.getConnectedExposedObjs();var b=c.getConnectedObjs();if(a.length!==b.length){return false}if(a.length!==2){return false}if(Kekule.ArrayUtils.intersect(a,b).length>=1){return false}return true};Kekule.ChemStructOperation.MergeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeStructFragment",initialize:function($super,b,a){$super(b);this.setDest(a);this._removeOperation=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("mergedNodes",{dataType:DataType.ARRAY,serializable:false});this.defineProp("mergedConnectors",{dataType:DataType.ARRAY,serializable:false})},moveChildBetweenStructFragment:function(d,c,b,a){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(d,c,b,a)},doExecute:function(){var e=this.getTarget();var c=this.getDest();if(e&&c){var b=Kekule.ArrayUtils.clone(e.getNodes());this.setMergedNodes(b);var a=Kekule.ArrayUtils.clone(e.getConnectors());this.setMergedConnectors(a);this.moveChildBetweenStructFragment(e,c,b,a);var d=e.getParent();if(d){this._removeOperation=new Kekule.ChemObjOperation.Remove(e,d);this._removeOperation.execute()}}},doReverse:function(){var d=this.getTarget();var c=this.getDest();if(d&&c){if(this._removeOperation){this._removeOperation.reverse();this._removeOperation=null}var b=this.getMergedNodes();var a=this.getMergedConnectors();this.moveChildBetweenStructFragment(c,d,b,a)}}});Kekule.ChemStructOperation.SplitStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.SplitStructFragment",initialize:function($super,a){$super(a)},initProperties:function(){this.defineProp("splittedFragments",{dataType:DataType.ARRAY,serializable:false,setter:null})},doExecute:function(){var f=Kekule.ChemStructureUtils.splitStructFragment(this.getTarget());if(f.length>1){this.setPropStoreFieldValue("splittedFragments",f);var c=this.getTarget().getParent();var d=this.getTarget().getNextSibling();c.beginUpdate();try{if(c){for(var b=1,a=f.length;b<a;++b){var e=f[b];c.insertBefore(e,d)}}}finally{c.endUpdate()}}else{this.setPropStoreFieldValue("splittedFragments",null)}},doReverse:function(){var a=this.getSplittedFragments();if(a&&a.length){var e=this.getTarget();for(var c=0,b=a.length;c<b;++c){var f=a[c];if(f!==e){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(f,e,Kekule.ArrayUtils.clone(f.getNodes()),Kekule.ArrayUtils.clone(f.getConnectors()));var d=f.getParent();if(d){d.removeChild(f)}f.finalize()}}}}});Kekule.ChemStructOperation.StandardizeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.StandardizeStructFragment",initialize:function($super,a){$super(a);this.setEnableSplit(true);this.setEnableRemove(true);this._concreteOper=null},initProperties:function(){this.defineProp("enableRemove",{dataType:DataType.BOOL});this.defineProp("enableSplit",{dataType:DataType.BOOL})},doExecute:function(){var b=this.getTarget();var a=b.getNodeCount();this._concreteOper=null;if(a<=0){if(this.getEnableRemove()){this._concreteOper=new Kekule.ChemObjOperation.Remove(b)}}else{if(this.getEnableSplit()){this._concreteOper=new Kekule.ChemStructOperation.SplitStructFragment(b)}}if(this._concreteOper){return this._concreteOper.execute()}else{return null}},doReverse:function(){return this._concreteOper?this._concreteOper.reverse():null}})})();(function(){Kekule.Editor.StructureUtils={getCascadeDeleteObjs:function(a){return Kekule.ChemStructureUtils.getCascadeDeleteObjs(a)},getSurroundingObjs:function(c){var b=c.getLinkedObjs();if(c instanceof Kekule.ChemStructureConnector){var a=c.getConnectedObjs();Kekule.ArrayUtils.pushUnique(b,a)}return b},calcMostEmptyDirectionAngleOfChemObj:function(h,d,e){var n=[];if(!d){d=h.getLinkedObjs()}var p=h.getAbsBaseCoord2D(e);for(var j=0,g=d.length;j<g;++j){var m=d[j].getAbsBaseCoord2D(e);m=Kekule.CoordUtils.substract(m,p);var f=Math.atan2(m.y,m.x);if(f<0){f=Math.PI*2+f}n.push(f)}n.sort();var g=n.length;if(g===0){return 0}else{if(g===1){return -n[0]}else{var o=0;var k=0;for(var j=0;j<g;++j){var b=n[j];var a=n[(j+1)%g];var q=a-b;if(q<0){q+=Math.PI*2}if(q>o){o=q;k=j}}var r=n[k]+o/2;return r}}},calcPreferred2DBondGrowingDirection:function(e,b,d){var c=e.getAbsBaseCoord2D(d);var f=Kekule.Editor.StructureUtils.getSurroundingObjs(e);var m=f?f.length:0;switch(m){case 0:return b;case 1:var a=f[0];var n=a.getAbsBaseCoord2D(d);var o=Kekule.CoordUtils.substract(n,c);var l=Math.atan2(o.y,o.x);var i=l-b;var h=l+b;if(i<0){i+=Math.PI*2}if(h<0){h+=Math.PI*2}var g;if(i!==h){var k=Math.min((i>Math.PI)?Math.abs(i-Math.PI*2):i,Math.abs(i-Math.PI));var j=Math.min((h>Math.PI)?Math.abs(h-Math.PI*2):h,Math.abs(h-Math.PI));g=(k<=j)?i:h}else{g=i}return g;default:var g=Kekule.Editor.StructureUtils.calcMostEmptyDirectionAngleOfChemObj(e,f,d);return g}},calcPreferred2DBondGrowingLocation:function(a,e,f,b){var c=a.getAbsBaseCoord2D(b);var d=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(a,f,b);return Kekule.CoordUtils.add(c,{x:e*Math.cos(d),y:e*Math.sin(d)})}};Kekule.Editor.RepositoryStructureUtils={_calcNodeMergeAdjustRotateAngle:function(d,u,j){var h=0;var t=d.getCoordMode();if(t!==Kekule.CoordMode.COORD3D){var v=d.getAllowCoordBorrow();var k=d.getEditorConfigs().getStructureConfigs();var f=Kekule.Editor.StructureUtils.getSurroundingObjs(u);var e=Kekule.Editor.StructureUtils.getSurroundingObjs(j);if(f.length===1){var a=u.getLinkedConnectorAt(0);var o=a.getBondOrder?a.getBondOrder():0;var r=k.getNewBondDefAngle(j,o);w=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(j,r,v);var b=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(u,f[0],t,v);var c=Math.atan2(b.y,b.x);h=w-c}else{if(e.length===1){var a=j.getLinkedConnectorAt(0);var o=a.getBondOrder?a.getBondOrder():0;var r=k.getNewBondDefAngle(u,o);var w=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(u,r,v);var b=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(j,e[0],t,v);var n=Math.atan2(b.y,b.x);h=n-w}else{var r=k.getNewBondDefAngle(j,null);var w=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(j,r,v);var m={};for(var q=0,p=f.length;q<p;++q){var b=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(u,f[q],t,v);var s=Math.atan2(b.y,b.x);if(Kekule.ObjUtils.isUnset(m.min)||(s<m.min)){m.min=s}if(Kekule.ObjUtils.isUnset(m.max)||(s>m.max)){m.max=s}}var g=(m.max+m.min)/2;h=w-g}}}return h},_calcConnectorMergeTransformParams:function(d,b,i){var f=b.getConnectedObjAt(0);var e=b.getConnectedObjAt(1);var h=i.getConnectedObjAt(0);var g=i.getConnectedObjAt(1);var c=d.getObjCoord(f);var a=d.getObjCoord(e);var l=d.getObjCoord(h);var j=d.getObjCoord(g);var k=Kekule.CoordUtils.calcCoordGroup2DTransformParams(c,a,j,l);return k},calcRepObjInitialTransformParams:function(k,f,c,g,d){var i=c.baseObjCoord;var b=k.getDefBondLength();var j=b/f.getRefLength();var h;var a=i;if(c.mergeObj){var g=c.mergeDest||g;if(g){d=k.getObjectScreenCoord(g);if((c.mergeObj instanceof Kekule.ChemStructureNode)&&(g instanceof Kekule.ChemStructureNode)){h=Kekule.Editor.RepositoryStructureUtils._calcNodeMergeAdjustRotateAngle(k,c.mergeObj,g)}else{if((c.mergeObj instanceof Kekule.ChemStructureConnector)&&(g instanceof Kekule.ChemStructureConnector)){return Kekule.Editor.RepositoryStructureUtils._calcConnectorMergeTransformParams(k,c.mergeObj,g)}}}}var e=k.translateCoord(d,Kekule.Editor.CoordSys.SCREEN,Kekule.Editor.CoordSys.CHEM);if(i){e=Kekule.CoordUtils.substract(e,i)}var l={scale:j,translateX:e.x,translateY:e.y,translateZ:e.z,rotateAngle:h,center:a};return l},transformChemObjectsCoordAndSize:function(h,m,k){var e=h.getCoordMode();var c=h.getAllowCoordBorrow();var j=(e===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(k):Kekule.CoordUtils.calcTransform2DMatrix(k);var a=Object.extend({},k);a=Object.extend(a,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});var b=(e===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(a):Kekule.CoordUtils.calcTransform2DMatrix(a);for(var g=0,d=m.length;g<d;++g){var f=m[g];f.transformAbsCoordByMatrix(j,b,e,true,c);f.scaleSize(k.scale,e,true,c)}}}})();(function(){var a=Class.PropertyScope;Kekule.Editor.BaseEditorConfigs=Class.create(Kekule.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.Editor.BaseEditorConfigs",initProperties:function(){this.addConfigProp("uiMarkerConfigs","Kekule.EditorConfigs.UiMarkerConfigs");this.addConfigProp("interactionConfigs","Kekule.EditorConfigs.InteractionConfigs");this.addConfigProp("structureConfigs","Kekule.Editor.StructureConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("uiMarkerConfigs",new Kekule.Editor.UiMarkerConfigs());this.setPropStoreFieldValue("interactionConfigs",new Kekule.Editor.InteractionConfigs());this.setPropStoreFieldValue("structureConfigs",new Kekule.Editor.StructureConfigs())}});Kekule.Editor.ChemSpaceEditorConfigs=Class.create(Kekule.Editor.BaseEditorConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditorConfigs",initProperties:function(){this.addConfigProp("chemSpaceConfigs","Kekule.Editor.ChemSpaceConfigs");this.addConfigProp("styleSetterConfigs","Kekule.Editor.StyleSetterConfigs",undefined,{scope:a.PUBLIC})},initPropValues:function($super){$super();this.setPropStoreFieldValue("chemSpaceConfigs",new Kekule.Editor.ChemSpaceConfigs());this.setPropStoreFieldValue("styleSetterConfigs",new Kekule.Editor.StyleSetterConfigs())}});Kekule.ClassUtils.makeSingleton(Kekule.Editor.ChemSpaceEditorConfigs);Kekule.Editor.InteractionConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.InteractionConfigs",initProperties:function(){var b=Math.PI/180;this.addBoolConfigProp("enableTrackOnNearest",true);this.addBoolConfigProp("enableHotTrack",true);this.addIntConfigProp("objBoundTrackInflation",5);this.addBoolConfigProp("enablePartialAreaSelecting",false);this.addIntConfigProp("selectionMarkerInflation",5,{scope:a.PUBLIC});this.addIntConfigProp("selectionMarkerEdgeInflation",5,{scope:a.PUBLIC});this.addIntConfigProp("rotationRegionInflation",10,{scope:a.PUBLIC});this.addFloatConfigProp("constrainedRotateStep",b*15,{scope:a.PUBLIC});this.addIntConfigProp("rotationLocationPointDistanceThreshold",10);this.addIntConfigProp("directedMoveDistanceThreshold",10);this.addIntConfigProp("clonedObjectScreenOffset",10);this.addIntConfigProp("atomSetterFontSize",14);this.addBoolConfigProp("allowUnknownAtomSymbol",true)}});Kekule.Editor.UiMarkerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.UiMarkerConfigs",initProperties:function(){this.addStrConfigProp("hotTrackerColor","#0000FF");this.addFloatConfigProp("hotTrackerOpacity",0.5);this.addStrConfigProp("selectionMarkerStrokeColor","#0000FF");this.addFloatConfigProp("selectionMarkerStrokeWidth",2);this.addStrConfigProp("selectionMarkerFillColor","#0000FF");this.addFloatConfigProp("selectionMarkerOpacity",0.2);this.addFloatConfigProp("selectionTransformMarkerSize",8,{scope:a.PUBLIC});this.addFloatConfigProp("selectionTransformMarkerOpacity",0.4,{scope:a.PUBLIC});this.addStrConfigProp("selectingMarkerStrokeColor","#000000");this.addFloatConfigProp("selectingMarkerStrokeWidth",1);this.addStrConfigProp("selectingMarkerStrokeDash",true);this.addStrConfigProp("selectingMarkerFillColor",null);this.addFloatConfigProp("selectingMarkerOpacity",0.7)}});Kekule.Editor.StructureConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StructureConfigs",initProperties:function(){this.addStrConfigProp("defBondType",Kekule.BondType.DEFAULT,{enumSource:Kekule.BondType});this.addIntConfigProp("defBondOrder",Kekule.BondOrder.SINGLE,{enumSource:Kekule.BondOrder});this.addFloatConfigProp("defBondLength",0.8);this.addConfigProp("defBondAngles",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addFloatConfigProp("bondConstrainedDirectionDelta",undefined,{scope:a.PUBLIC});this.addConfigProp("bondConstrainedDirectionAngles",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addFloatConfigProp("bondConstrainedDirectionAngleThreshold",undefined,{scope:a.PUBLIC});this.addFloatConfigProp("initialBondDirection",undefined,{scope:a.PUBLIC});this.addStrConfigProp("defIsotopeId","C");this.addConfigProp("primaryOrgChemAtoms",DataType.ARRAY,undefined,{scope:a.PUBLIC})},initPropValues:function($super){$super();var b=Math.PI/180;var d=[];var c=Kekule.BondOrder;var e=Math.PI*2/3;d[0]=e;d[c.EXPLICIT_AROMATIC]=[e];d[c.TRIPLE]=[Math.PI];d[c.DOUBLE]=[e];d[c.DOUBLE][c.DOUBLE]=Math.PI;d[c.SINGLE]=[e];this.setDefBondAngles(d);this.setBondConstrainedDirectionDelta(10*Math.PI/180);this.setBondConstrainedDirectionAngles([0,90*b,180*b,270*b]);this.setBondConstrainedDirectionAngleThreshold(b*3);this.setInitialBondDirection(30*b);this.setPrimaryOrgChemAtoms(["C","H","O","N","P","S","F","Cl","Br","I"])},getDefAngleOfBonds:function(f,d){var c=f||0;var b=d||0;if(c>b){c=d||0;b=f||0}var h=this.getDefBondAngles();var g=h[b];if(!g){return h[0]}else{var e=g[c];return e||g[0]}},getNewBondDefAngle:function(d,e){if(Kekule.ObjUtils.isUnset(e)){e=this.getDefBondOrder()}var c;var f=Kekule.Editor.StructureUtils.getSurroundingObjs(d);if(f.length===1){var b=d.getLinkedConnectorAt(0);if(b&&(b.getConnectedObjs().indexOf(f[0])>=0)){var g=b.getBondOrder?b.getBondOrder():null;if(Kekule.ObjUtils.notUnset(g)){c=this.getDefAngleOfBonds(e,g)}}}else{if(f.length===0){c=this.getInitialBondDirection()}else{c=this.getDefAngleOfBonds(e,0)}}return c}});Kekule.Editor.ChemSpaceConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceConfigs",initProperties:function(){this.addHashConfigProp("defScreenSize2D");this.addHashConfigProp("defScreenSize3D");this.addNumConfigProp("defPadding",50)},initPropValues:function($super){$super();this.setDefScreenSize2D({x:900,y:1500});this.setDefScreenSize3D({x:600,y:600,z:600})}});Kekule.Editor.StyleSetterConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StyleSetterConfigs",initProperties:function(){this.defineProp("listedFontSizes",{dataType:DataType.ARRAY});this.defineProp("listedFontNames",{dataType:DataType.ARRAY})},initPropValues:function($super){$super();this.setListedFontSizes([8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88,96]);this.setListedFontNames(Kekule.Widget.FontEnumerator.getAvailableFontFamilies())}})})();(function(){Kekule.Editor.RepositoryData={subGroups:[{name:"methyl",inputTexts:["Me","CH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Thu,15 Sep 2016 15:49:02 GMT"},"__type__":"object"},"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Me","__type__":"Kekule.SubGroup"}'},{name:"ethyl",inputTexts:["Et","C2H5"],structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Et","__type__":"Kekule.SubGroup"}'},{name:"n-propyl",inputTexts:["n-Pr","nPr","C3H7"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Pr","formulaText":"C3H7","__type__":"Kekule.SubGroup"}'},{name:"i-propyl",inputTexts:["i-Pr","iPr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Pr","__type__":"Kekule.SubGroup"}'},{name:"n-butyl",inputTexts:["n-Bu","nBu","C4H9"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Bu","formulaText":"C4H9","__type__":"Kekule.SubGroup"}'},{name:"i-butyl",inputTexts:["i-Bu","iBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Bu","__type__":"Kekule.SubGroup"}'},{name:"s-butyl",inputTexts:["s-Bu","sBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"s-Bu","__type__":"Kekule.SubGroup"}'},{name:"t-butyl",inputTexts:["t-Bu","tBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"t-Bu","__type__":"Kekule.SubGroup"}'},{name:"phenyl",inputTexts:["Ph","C6H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ph","formulaText":"C6H5","__type__":"Kekule.SubGroup"}'},{name:"benzyl",inputTexts:["Bn"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bn","__type__":"Kekule.SubGroup"}'},{name:"benzoyl",inputTexts:["Bz"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bz","__type__":"Kekule.SubGroup"}'},{inputTexts:["CF3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CF3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CCl3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CCl3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CBr3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CBr3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CI3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CI3","__type__":"Kekule.SubGroup"}'},{inputTexts:["OMe","OCH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["OEt","OC2H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ot-Bu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275525,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275454,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.7763568394002505e-15,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"Ot-Bu","__type__":"Kekule.SubGroup"}'},{inputTexts:["CO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO","__type__":"Kekule.SubGroup"}'},{inputTexts:["CHO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CHO","__type__":"Kekule.SubGroup"}'},{name:"carboxyl",inputTexts:["COOH","CO2H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOH","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOOH","CO3H","CO2OH"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["COONa"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Na"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COONa","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOK"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"K"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOK","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOCH3","COOMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOC2H5","COOEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.039230484541326,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["COCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["COBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COBr","__type__":"Kekule.SubGroup"}'},{inputTexts:["CONH2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CONH2","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ac"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ac","__type__":"Kekule.SubGroup"}'},{inputTexts:["OAc"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OAc","__type__":"Kekule.SubGroup"}'},{inputTexts:["MeCO","COMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.3464101615137771,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.3464101615137771,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["EtCO","COEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COEt","__type__":"Kekule.SubGroup"}'},{name:"amino",inputTexts:["NH2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Thu,15 Sep 2016 15:49:26 GMT"},"__type__":"object"},"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NH2","name":"Untitled Document-1","__type__":"Kekule.SubGroup"}'},{inputTexts:["NMe2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NMe2","__type__":"Kekule.SubGroup"}'},{name:"nitro",inputTexts:["NO2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO2","__type__":"Kekule.SubGroup"}'},{name:"nitroso",inputTexts:["NO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO","__type__":"Kekule.SubGroup"}'},{name:"diazo",inputTexts:["N2","NN","N2 +"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2+","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Cl","NNCl","N2 +Cl-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2+Cl-","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Br","NNBr","N2 +Br-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2+Br-","__type__":"Kekule.SubGroup"}'},{name:"nitrile group",inputTexts:["CN"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CN","__type__":"Kekule.SubGroup"}'},{name:"pyridyl",inputTexts:["Py"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Py","__type__":"Kekule.SubGroup"}'},{name:"sulfonic group",inputTexts:["SO3H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000213,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000213,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.399999999999995,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Cl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Cl","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Br"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Br","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgBr","__type__":"Kekule.SubGroup"}'},{inputTexts:["TMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"TMS","__type__":"Kekule.SubGroup"}'},{inputTexts:["OTMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTMS","__type__":"Kekule.SubGroup"}'}],fragments:[{name:"methane",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Sat,25 Feb 2017 04:21:08 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"fischer1",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer2",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer3",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999972,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.6000000000000085,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,10]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"sawhorseStaggered",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:51:35 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34060000000000024,"y":-0.642199999999999,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.37219999999999764,"y":-1.0575999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.0877999999999997,"y":-0.648899999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3686000000000007,"y":-1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34060000000000024,"y":0.6422000000000061,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.0877999999999997,"y":0.6489000000000011,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3686000000000007,"y":1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"zIndex2D":0,"coord2D":{"x":0.3722000000000012,"y":1.0576000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-6","__type__":"Kekule.Molecule"}'},{name:"sawhorseEclipsed",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:50:51 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3022000000000009,"y":0.4405000000000001,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.4229000000000003,"y":0.8340999999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.1265,"y":0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"coord2D":{"x":0.44500000000000206,"y":1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.1265,"y":-1.6214000000000084,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.4015000000000004,"y":-1.2276999999999987,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3013999999999992,"y":-1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.38010000000000055,"y":-0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-5","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:43:26 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.5895,"y":0.3572,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":-1.002,"y":-0.3572,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.2087,"y":-0.1305,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.5894,"y":-0.3572,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.002,"y":0.3572,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.2086,"y":0.1306,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:44:10 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-1.0019000000000005,"y":0.3572,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.5894000000000005,"y":-0.3572,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.20869999999999955,"y":-0.1481,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":1.0019000000000005,"y":-0.35719999999999885,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.5894999999999996,"y":0.3572,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.20870000000000044,"y":0.1482,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-2","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:47:35 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.488900000000001,"y":0.4831000000000003,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.5145999999999997,"y":0.4831000000000003,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.155800000000001,"y":-0.002600000000001046,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":-1.1557999999999993,"y":-0.002600000000001046,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.488900000000001,"y":-0.4831000000000003,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.5145999999999997,"y":-0.4831000000000003,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:47:08 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.488900000000001,"y":0.4831000000000003,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.5145999999999997,"y":0.4831000000000003,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.155800000000001,"y":-0.002600000000001046,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.1557999999999993,"y":-0.002600000000001046,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.488900000000001,"y":-0.4831000000000003,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.5145999999999997,"y":-0.4831000000000003,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":10,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:48:11 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.4961500000000001,"y":0.24414999999999765,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.49734999999999907,"y":0.24414999999999765,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8043499999999995,"y":-0.05805000000000149,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":-0.8043499999999995,"y":-0.05805000000000149,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0006500000000002615,"y":-0.24414999999999765,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:48:04 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.496137,"y":0.24414099999999692,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4973460000000003,"y":0.24414100000000308,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.804334,"y":-0.058014000000003084,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.000604,"y":-0.24414100000000308,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.804334,"y":-0.058014000000003084,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[4,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"substituentMark",dataFormat:"Kekule-JSON",scale:0.7,structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Pseudoatom","coordPos2D":0,"coordPos3D":0,"renderOptions":{"nodeDisplayMode":-1,"__type__":"object"},"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"atomType":"any","symbol":"A"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"renderOptions":{"opacity":0.5,"__type__":"object"},"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'}]}})();(function(){Kekule.Editor.AbstractRepositoryItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.AbstractRepositoryItem",initialize:function($super){$super()},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAvailableCoordModes:function(){return[]},createObjects:function(b){},getScale:function(){return this.doGetScale()||1},doGetScale:function(){return 1},getRefLength:function(){return this.doGetRefLength()/(this.getScale()||1)},doGetRefLength:function(){},isOneStructureFragmentObj:function(){return false}});Kekule.Editor.MolRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.MolRepositoryItem2D",initialize:function($super){$super()},initProperties:function(){this.defineProp("molScale",{dataType:DataType.FLOAT})},doGetScale:function($super){return this.getMolScale()||$super()},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},isOneStructureFragmentObj:function(){return true},createObjects:function(c){var e=this.doCreateObjects(c);if(!e){return null}var b=null;var f=null;var d={x:0,y:0};if(c){b=(c instanceof Kekule.ChemStructureNode)?this.doGetMergableNode(e,c):(c instanceof Kekule.ChemStructureConnector)?this.doGetMergableConnector(e,c):null;if(b){f=c;d=b.getAbsBaseCoord2D()}}return{objects:[e],mergeObj:b,mergeDest:f,baseObjCoord:d,centerCoord:{x:0,y:0}}},doCreateObjects:function(b){return null},doGetMergableNode:function(b,c){return null},doGetMergableConnector:function(b,c){return null}});Kekule.Editor.StoredStructFragmentRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredStructFragmentRepositoryItem2D",initialize:function($super,b,d,c){$super();this.beginUpdate();try{if(d){this.setDataFormat(d)}if(b){this.setStructData(b)}if(c){this.setMolScale(c)}}finally{this.endUpdate()}},initProperties:function(){this.defineProp("structureFragment",{dataType:"Kekule.StructureFragment",setter:null,serializable:false});this.defineProp("structData",{dataType:DataType.STRING});this.defineProp("dataFormat",{dataType:DataType.STRING})},objectChange:function($super,b){$super(b);if((b.indexOf("structData")>=0)||(b.indexOf("dataFormat")>=0)){var c=null;if(this.getStructData()){c=this._createTemplateStructFragment()}this.setPropStoreFieldValue("structureFragment",c)}},_createTemplateStructFragment:function(){var b=null;if(this.getStructData()){b=Kekule.IO.loadFormatData(this.getStructData(),this.getDataFormat()||Kekule.IO.DataFormat.KEKULE_JSON)}if(b){this._adjustTemplateStructureFragmentCoords(b)}return b},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var f=Kekule.Render.ObjUtils.getContainerBox(e,Kekule.CoordMode.COORD2D,true);if(f){var j=e.getCoordOfMode?e.getCoordOfMode(Kekule.CoordMode.COORD2D,true)||{}:{};var h={};h.x=-(f.x2+f.x1)/2;h.y=-(f.y2+f.y1)/2;e.beginUpdate();try{for(var c=0,b=e.getNodeCount();c<b;++c){var d=e.getNodeAt(c);var g=d.getCoord2D(true);g=Kekule.CoordUtils.add(g,h);d.setCoord2D(g)}}finally{e.endUpdate()}}},doGetRefLength:function(){var b=this.getStructureFragment();return b?b.getConnectorLengthMedian(Kekule.CoordMode.COORD2D,true):0},doCreateObjects:function(b){var c=this.getStructureFragment();return c?c.clone():null},doGetMergableNode:function(b,c){return b.getAnchorNodeAt(0)||b.getNodeAt(0)},doGetMergableConnector:function(b,c){return null}});Kekule.Editor.StoredSubgroupRepositoryItem2D=Class.create(Kekule.Editor.StoredStructFragmentRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredSubgroupRepositoryItem2D",initialize:function($super,b,d,c){$super(b,d,c)},initProperties:function(){this.defineProp("inputTexts",{dataType:DataType.STRING})},doCreateObjects:function(c){var d=this.getStructureFragment();if(d){var b=new Kekule.SubGroup();b.assign(d,false);return b}else{return null}},createObjects:function($super,c){var b=$super(c);return b},_adjustTemplateStructureFragmentCoords:function(f){f.setCoord2D({x:0,y:0});var c=f.getCurrConnectableObj();if(c){var h=Kekule.CoordUtils.substract({x:0,y:0},c.getCoord2D(true));f.beginUpdate();try{for(var d=0,b=f.getNodeCount();d<b;++d){var e=f.getNodeAt(d);var g=e.getCoord2D(true);g=Kekule.CoordUtils.add(g,h);e.setCoord2D(g)}}finally{f.endUpdate()}}}});Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText=function(f){var e=Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[];for(var c=0,b=e.length;c<b;++c){var d=e[c];if((d.getInputTexts()||[]).indexOf(f)>=0){return d}}return null};Kekule.Editor.MolRingRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolRingRepositoryItem2D",initialize:function($super,c,b){$super();this.setRingAtomCount(c);this.setBondLength(b||1)},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT});this.defineProp("bondLength",{dataType:DataType.FLOAT});this.defineProp("isAromatic",{dataType:DataType.BOOL})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(b){return this.generateRing()},doGetMergableNode:function(b,c){return b.getNodeAt(0)},doGetMergableConnector:function(b,c){return b.getConnectorAt(0)},generateRing:function(m,n){if(!n){n=Kekule.Molecule}var r;if(m){r=m}else{r=new n()}var u=this.getRingAtomCount();var l=this.getBondLength();var f=Math.PI/u;var e=Math.sin(f);var t=2*f;var k=l/2/e;var h=((u===4)||(u===8))?-Math.PI/2-t/2:-Math.PI/2;var o;var q;var c;for(var p=0;p<u;++p){var b=this._generateAtom(p);var s=h+t*p;var j=k*Math.cos(s);var g=k*Math.sin(s);b.setCoord2D({x:j,y:g});r.appendNode(b);if(p===0){c=b}if(o){var d=this._generateBond(q,p);r.appendConnector(d);d.appendConnectedObj(o);d.appendConnectedObj(b)}o=b;q=p}var d=this._generateBond(u-1,0);r.appendConnector(d);d.appendConnectedObj(o);d.appendConnectedObj(c);return r},_generateAtom:function(b){return new Kekule.Atom(null,"C")},_generateBond:function(d,c){var b=Kekule.BondOrder.SINGLE;if(this.getIsAromatic()){if(d%2){b=Kekule.BondOrder.DOUBLE}}return new Kekule.Bond(null,null,b)}});Kekule.Editor.PathGlyphRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.PathGlyphRepositoryItem2D",initialize:function($super,c,d,b){$super();this.setGlyphClass(c);this.setGlyphRefLength(d||1);this.setGlyphInitialParams(b)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT});this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:false});this.defineProp("glyphInitialParams",{dataType:DataType.HASH})},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},doGetRefLength:function(){return this.getGlyphRefLength()},createObjects:function(b){var c=this.generateGlyph();var d={x:0,y:0};return{objects:[c],mergeObj:null,mergeDest:null,baseObjCoord:d,centerCoord:d}},generateGlyph:function(){var b=this.getGlyphClass();var c=new b(null,this.getGlyphRefLength(),this.getGlyphInitialParams());return c}});Kekule.Editor.RepositoryItemManager={_itemClassMap:new Kekule.MapEx(true),_itemNameMap:new Kekule.MapEx(true),getAllItems:function(b){return a._itemClassMap.get(b)},getItem:function(b){return a._itemNameMap.get(b)},register:function(e){var d=e.getName();var f;if(d){f=a.getItem();a._itemNameMap.set(d,e)}var c=e.getClass();var b=a.getAllItems(c);if(!b){b=[e];a._itemClassMap.set(c,b)}else{if(f){Kekule.ArrayUtils.replace(b,f,e)}else{Kekule.ArrayUtils.pushUnique(b,e)}}},unregister:function(e){var c=e.getClass();var b=a.getAllItems(c);if(b){Kekule.ArrayUtils.remove(b,e)}var d=e.getName();if(d){a._itemNameMap.remove(d)}}};var a=Kekule.Editor.RepositoryItemManager;Kekule._registerAfterLoadProc(function(){if(Kekule.Editor.RepositoryData){var f=Kekule.Editor.RepositoryData.subGroups||[];for(var c=0,b=f.length;c<b;++c){var d=f[c];var e=new Kekule.Editor.StoredSubgroupRepositoryItem2D(d.structData,d.dataFormat,d.scale);e.setInputTexts(d.inputTexts).setName(d.name||d.inputTexts[0]);a.register(e)}var f=Kekule.Editor.RepositoryData.fragments||[];for(var c=0,b=f.length;c<b;++c){var d=f[c];var e=new Kekule.Editor.StoredStructFragmentRepositoryItem2D(d.structData,d.dataFormat,d.scale);e.setName(d.name);a.register(e)}}})})();(function(){var a=Kekule.ArrayUtils;var c=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMSPACE_EDITOR:"K-Chem-Space-Editor",CHEMSPACE_EDITOR2D:"K-Chem-Space-Editor2D",CHEMSPACE_EDITOR3D:"K-Chem-Space-Editor3D",CHEMEDITOR_TEXT_SETTER:"K-ChemEditor-Text-Setter",CHEMEDITOR_FORMULA_SETTER:"K-ChemEditor-Formula-Setter"});Kekule.Editor.ChemSpaceEditor=Class.create(Kekule.Editor.BaseEditor,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor",initialize:function($super,d,g,f,e){this.setPropStoreFieldValue("allowCreateNewChild",true);this.setPropStoreFieldValue("autoCreateNewStructFragment",true);$super(d,g,f,e);this._containerChemSpace=null},initProperties:function(){this.defineProp("chemSpace",{dataType:"Kekule.ChemSpace",serializable:false,getter:function(){return this.getChemObj()},setter:function(d){this.setChemObj(d)}});this.defineProp("defBondLength",{dataType:DataType.FLOAT,serializable:false,getter:function(){var d=this.getPropStoreFieldValue("defBondLength");if(!d){d=this.getEditorConfigs().getStructureConfigs().getDefBondLength()}return d}});this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("autoCreateNewStructFragment")&&this.canCreateNewChild()}});this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL})},canCreateNewChild:function(){return this.getChemSpace()&&(this.getAllowCreateNewChild()||(this.getChemSpace().getChildCount()<=0))},getActualDrawOptions:function($super){var d=$super();d.useExplicitSpaceSize=true;return d},doSetChemObj:function($super,f){var d=this.getChemObj();if(d!==f){if(d&&this._containerChemSpace){d.finalize();this._containerChemSpace=null}if(f){if(f instanceof Kekule.ChemSpace){this._initChemSpaceDefProps(f);return $super(f)}else{var e=this.createContainerChemSpace(null,f);this._containerChemSpace=e;$super(e)}}else{$super(f)}}else{$super(f)}},getExportableClasses:function($super){var d=$super();var g=this.getChemSpace();if(g){for(var f=0,e=g.getChildCount();f<e;++f){var h=g.getChildAt(f);if(h&&h.getClass){Kekule.ArrayUtils.pushUnique(d,h.getClass())}}}return d},exportObjs:function($super,f){var d=$super(f);if((!d||!d.length)&&f){d=[];var h=this.getChemSpace();if(h){for(var g=0,e=h.getChildCount();g<e;++g){var j=h.getChildAt(g);if(j&&(j instanceof f)){d.push(j)}}}}return d},getSavingTargetObj:function($super){var e=this.getChemSpace();var d=e.getChildCount();if(d===1){return e.getChildAt(0)}else{return $super()}},createDefaultConfigs:function(){return Kekule.Editor.ChemSpaceEditorConfigs.getInstance()},doCreateNewDocObj:function(){return this.createContainerChemSpace()},doLoadEnd:function($super,i){var l=$super(i);var k=null;if(i){var f=i.getAllContainingConnectors();if(f&&f.length){var h=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;k=Kekule.ChemStructureUtils.getConnectorLengthMedian(f,h,this.getAllowCoordBorrow())}}this.setDefBondLength(k);var d=this.getChemObj();if(d){var e=d.getScreenSize();this.changeClientSize(e.x,e.y,this.getCurrZoom());var g=this.getEditClientElem().parentNode;var j=Kekule.HtmlElementUtils.getElemClientDimension(g);this.scrollClientTo(0,(e.x-j.width)/2)}return l},zoomChanged:function($super,f){$super();var e=this.getChemObj();if(e){var d=e.getScreenSize();this.changeClientSize(d.x,d.y,f)}},createNewBoundInfoRecorder:function($super,e){$super(e);var d=this.getBoundInfoRecorder();if(d){d.addEventListener("updateBasicDrawObject",this.reactUpdateBasicDrawObject,this)}},reactUpdateBasicDrawObject:function(g){var f=g.obj;if(f&&(f instanceof Kekule.TextBlock)){var d=g.boundInfo;this.updateTextBlockSize(f,d)}},objectChanged:function($super,e,d){if(this.getCoordMode()===Kekule.CoordMode.COORD2D){if(e instanceof Kekule.TextBlock){e.__$needRecalcSize__=true}}return $super(e,d)},updateTextBlockSize:function(e,h){if(this.getCoordMode()!==Kekule.CoordMode.COORD2D){return}if(!e.__$needRecalcSize__){return}var d=h.shapeType;if(d===Kekule.Render.BoundShapeType.RECT){var i=h.coords;var g=this.contextCoordToObj(i[0]);var f=this.contextCoordToObj(i[1]);var j=Kekule.CoordUtils.substract(f,g);e.setPropStoreFieldValue("size2D",{x:Math.abs(j.x),y:Math.abs(j.y)});delete e.__$needRecalcSize__}},createContainerChemSpace:function(d,g){var o=new Kekule.ChemDocument(d);this._initChemSpaceDefProps(o,g);if(g){o.appendChild(g);var f=o.getSizeOfMode(this.getCoordMode(),this.getAllowCoordBorrow());var j,k;var h=Kekule.Render.ObjUtils.getContainerBox(g,this.getCoordMode(),this.getAllowCoordBorrow());if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var m=this.getEditorConfigs().getChemSpaceConfigs().getDefPadding();var k=o.getObjScreenLengthRatio()}var i=g.getAbsBaseCoord?g.getAbsBaseCoord(this.getCoordMode(),this.getAllowCoordBorrow())||{}:{};if(k&&h){j=Kekule.CoordUtils.divide(f,2);var e={x:(h.x1+h.x2)/2,y:(h.y1+h.y2)/2};var n={x:j.x,y:f.y-m*k-(h.y2-h.y1)/2};var l=Kekule.CoordUtils.substract(n,e);j=Kekule.CoordUtils.add(i,l)}else{j=Kekule.CoordUtils.divide(f,2)}if(g.setAbsBaseCoord){g.setAbsBaseCoord(j,this.getCoordMode())}}return o},_initChemSpaceDefProps:function(g,h){var i=this.getEditorConfigs();var d=i.getChemSpaceConfigs();if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var e=g.getScreenSize();if(!e.x&&!e.y){e=d.getDefScreenSize2D();g.setScreenSize(e)}if(!g.getDefAutoScaleRefLength()){var l;if(h&&h.getAllAutoScaleRefLengths){var f=h.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow());l=f&&f.length?Kekule.ArrayUtils.getMedian(f):null}else{var f=g.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow());l=f.length?Kekule.ArrayUtils.getMedian(f):null}if(!l){l=i.getStructureConfigs().getDefBondLength()}g.setDefAutoScaleRefLength(l)}if(!g.getSize2D()){var k=this.getRenderConfigs().getLengthConfigs().getDefBondLength();var j=g.getDefAutoScaleRefLength()/k;g.setObjScreenLengthRatio(j);g.setSize2D({x:e.x*j,y:e.y*j})}}},createNewStructFragmentAnchor:function(e){if(this.getAutoCreateNewStructFragment()){var d=new Kekule.Molecule(e);this.getChemSpace().appendChild(d);return d}else{return null}},createStructStartingAtom:function(f,h,d,e){this.beginUpdateObject();try{if(f){if(!e){e=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId()}var g=new Kekule.Atom(null,e);f.appendNode(g);g.setAbsCoordOfMode(d,this.getCoordMode());return g}else{return null}}finally{this.endUpdateObject()}},createNewStructFragmentAndStartingAtom:function(g,d,e){this.beginUpdateObject();try{var f;f=this.createNewStructFragmentAnchor(g);if(f){return this.createStructStartingAtom(f,g,d,e)}else{return null}}finally{this.endUpdateObject()}},hasOnlyOneBlankStructFragment:function(){var d=false;if(this.getChemSpace().getChildCount()===1){var e=this.getChemSpace().getChildAt(0);if(e instanceof Kekule.StructureFragment){if(e.getNodeCount()<=0&&e.getConnectorCount()<=0&&!e.hasFormula()){d=true}}}return d},getOnlyOneBlankStructFragment:function(){if(this.hasOnlyOneBlankStructFragment()){return this.getChemSpace().getChildAt(0)}},canAddNewStandaloneObject:function(){return this.getAllowCreateNewChild()||(this.getChemSpace().getChildCount()<=0)},canAddUnconnectedStructFragment:function(){return this.canAddNewStandaloneObject()||this.hasOnlyOneBlankStructFragment()},canCloneObjects:function(){return this.getAllowCreateNewChild()},cloneObjects:function(d,e,k){if(!this.getChemSpace()){return null}var t=this.getAllowCreateNewChild();var p=function(E,D){for(var C=0,B=D.length;C<B;++C){var F=D[C];if((F.isChildOf(E))){return true}}return false};var o=function(E,D,B){if(B.indexOf(D)>=0){a.remove(B,D);return}if(E.getChildAt&&D.getChildAt){var l=D.getChildCount();for(var C=l-1;C>=0;--C){var G=E.getChildAt(C);if(!B.length){E.removeChild(G);continue}var F=D.getChildAt(C);if(B.indexOf(F)>=0){a.remove(B,F)}else{if(p(F,B)){if(F.getChildObjs){o(G,F,B)}}else{E.removeChild(G)}}}}};var y=Kekule.ArrayUtils.toArray(d);var z=[];var q=new Kekule.MapEx();for(var u=0,s=y.length;u<s;++u){var n=y[u];var A=n.getStandaloneAncestor?n.getStandaloneAncestor():n;if(A.clone){Kekule.ArrayUtils.pushUnique(z,A);var m=q.get(A);if(!m){m=[];q.set(A,m)}m.push(n)}}var w=this.getChemSpace();var h=[];var v=this.getCoordMode();var x=this.getAllowCoordBorrow();var f=z.length;for(var u=0;u<f;++u){var n=z[u];var g=n.clone();if(g.clearIds){g.clearIds()}o(g,n,q.get(n));if(k&&t){w.appendChild(g);if(e){var r=this.getObjectScreenCoord(g);var j=Kekule.CoordUtils.add(r,e);this.setObjectScreenCoord(g,j)}}h.push(g)}q.finalize();return h},cloneSelection:function(f,e){if(f===undefined){f=this.getDefaultCloneScreenCoordOffset()}var g=this.getSelection();var d=this.cloneObjects(g,f,e);if(e){this.setSelection(d)}return d},getDefaultCloneScreenCoordOffset:function(){var f=this.getEditorConfigs().getInteractionConfigs().getClonedObjectScreenOffset()||0;var d=this.getCoordMode();var e={x:f,y:f};if(d===Kekule.CoordMode.COORD3D){e.z=f}return e}});Kekule.Editor.ChemSpaceEditor.Settings=Class.create(Kekule.Editor.BaseEditor.Settings,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor.Settings",initProperties:function(){this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getAllowCreateNewChild()},setter:function(d){this.getEditor().setAllowCreateNewChild(d)}})}});Kekule.Editor.BasicMolEraserIaController=Class.create(Kekule.Editor.BasicEraserIaController,{CLASS_NAME:"Kekule.Editor.BasicMolEraserIaController",initialize:function($super,d){$super(d)},doGetActualRemovedObjs:function(h){var d=[];Kekule.ArrayUtils.pushUnique(d,h);for(var g=0,f=h.length;g<f;++g){var e=h[g].getCascadeDeleteObjs?h[g].getCascadeDeleteObjs():[];if(e){Kekule.ArrayUtils.pushUnique(d,e)}}return d},doRemoveObjs:function(m){if(!m.length){return}var d=new Kekule.MacroOperation();var o=[];for(var k=0,f=m.length;k<f;++k){var j=m[k];var p=j.getParent();var n=this.getEditor();var e;if(j instanceof Kekule.BaseStructureNode){e=new Kekule.ChemStructOperation.RemoveNode(j);Kekule.ArrayUtils.pushUnique(o,j.getParent())}else{if(j instanceof Kekule.BaseStructureConnector){e=new Kekule.ChemStructOperation.RemoveConnector(j);Kekule.ArrayUtils.pushUnique(o,j.getParent())}else{e=new Kekule.ChemObjOperation.Remove(j)}}if(e){d.add(e)}}for(var k=0,f=o.length;k<f;++k){var h=o[k];if(h&&(h instanceof Kekule.StructureFragment)){var g=new Kekule.ChemStructOperation.StandardizeStructFragment(h);g.setEnableSplit(this.getEditor().canCreateNewChild());d.add(g)}}d.execute();if(n&&n.getEnableOperHistory()){n.pushOperation(d)}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolEraserIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.BasicMolManipulationIaController=Class.create(Kekule.Editor.BasicManipulationIaController,{CLASS_NAME:"Kekule.Editor.BasicMolManipulationIaController",initialize:function($super,d){$super(d);this.setEnableMagneticMerge(true);this.setEnableNodeMerge(true);this.setEnableNeighborNodeMerge(true);this.setEnableConnectorMerge(true);this.setEnableStructFragmentMerge(true);this.setEnableConstrainedMove(true);this.setEnableConstrainedRotate(true);this.setEnableDirectedMove(true);this._suppressConstrainedMoving=false;this._suppressConstrainedRotating=false;this._isInDirectedMoving=false;this._directedMovingDirection=null},initProperties:function(){this.defineProp("enableMagneticMerge",{dataType:DataType.BOOL});this.defineProp("enableNodeMerge",{dataType:DataType.BOOL});this.defineProp("enableNeighborNodeMerge",{dataType:DataType.BOOL});this.defineProp("enableConnectorMerge",{dataType:DataType.BOOL});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL});this.defineProp("allManipulateObjsMerged",{dataType:DataType.BOOL,serializable:false});this.defineProp("isMergeDone",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableConstrainedMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableConstrainedRotate",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableDirectedMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("mergeOperations",{dataType:DataType.ARRAY,serializable:false});this.defineProp("mergingDests",{dataType:DataType.ARRAY,serializable:false})},canInteractWithObj:function($super,d){return $super(d)||(this._isMerging&&d)},doSetManipulateObjs:function($super,d){var e=d?a.clone(d):[];if(this.getMergingDests()){a.pushUnique(e,this.getMergingDests())}this.setPropStoreFieldValue("manipulateObjs",d);if(!d){this.getEditor().endOperatingObjs()}else{this.getEditor().prepareOperatingObjs(e)}},isConstrainedMove:function(){if(!this.getEnableConstrainedMove()){return false}var f=this.getManipulateObjs();if(f.length===1){var e=f[0];var d=this.getEditor().getSelection();if(d&&(d.indexOf(e)<0)){if(e instanceof Kekule.ChemStructureNode){return(e.getLinkedObjs().length===1)}}}return false},isConstrainedRotate:function(){return this.getEnableConstrainedMove()},isDirectedMove:function(){return(this.getEnableDirectedMove()&&(!this.isConstrainedMove())&&this._isInDirectedMoving)},createManipulateObjInfo:function($super,g,h){var i=this.getEditor();var e=$super(g,h);var j=this.isConstrainedMove();if(j){var f=g.getLinkedConnectors()[0];var d=g.getLinkedObjs()[0];if(f&&d){e.isConstrained=true;if(!e.hasNoCoord){e.originScreenCoord=i.getObjectScreenCoord(g);e.refScreenCoord=i.getObjectScreenCoord(d);e.connectorScreenLength=Kekule.CoordUtils.getDistance(e.screenCoord,e.refScreenCoord);e.connectorObjLength=f.getLength(this.getEditor().getCoordMode(),this.getEditor().getAllowCoordBorrow());var k=Kekule.CoordUtils.substract(e.originScreenCoord,e.refScreenCoord);e.originBondDirectionAngle=Math.atan2(k.y,k.x);e.constrainedBondDirectionDelta=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionDelta();e.constrainedBondDirectionAngles=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngles();e.constrainedBondDirectionAngleThreshold=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngleThreshold()}}}return e},_calcActualMovedScreenCoord:function($super,k,t,h){var m=Kekule.CoordUtils;var j;var r=h;if(t.isConstrained&&(!this._suppressConstrainedMoving)){var o=t.constrainedBondDirectionDelta||null;var p=t.constrainedBondDirectionAngles||null;var e=t.constrainedBondDirectionAngleThreshold||null;var d=false;var v;var u=m.substract(h,t.refScreenCoord);var n=Math.atan2(u.y,u.x);if(p&&e){for(var s=0,q=p.length;s<q;++s){var g=p[s];if(Math.abs(g-n)<=e){d=true;v=g}}}if(!d&&o){var f=Math.round((n-t.originBondDirectionAngle)/o);v=t.originBondDirectionAngle+f*o;d=true}if(!d){v=n}j=m.add(t.refScreenCoord,{x:t.connectorScreenLength*Math.cos(v),y:t.connectorScreenLength*Math.sin(v)})}else{j=r}return j},_calcActualRotateAngle:function($super,j,h,f,g){var d=(this.isConstrainedRotate()&&(!this._suppressConstrainedRotating));var e=d?this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;if(e){var i=Math.floor(h/e);return i*e}else{return $super(j,h,f,g)}},prepareManipulating:function($super,g,e,d,h,f){this.setMergeOperations([]);$super(g,e,d,h,f);this._directedMovingDirection=null;this.setManuallyHotTrack(true)},stopManipulate:function($super){$super();this.setManuallyHotTrack(false)},cancelManipulatingObjs:function($super){$super();this.setManuallyHotTrack(false)},createManipulateOperation:function($super){$super();this.setMergeOperations([])},getAllObjOperations:function($super){var d=$super()||[];var e=this.getMergeOperations();if(e&&e.length){Kekule.ArrayUtils.pushUnique(d,e)}return d},_canMergeNodes:function(f,g){var e=this.getEnableStructFragmentMerge();var d=this.getEnableNeighborNodeMerge();if(this.getEnableNodeMerge()){return Kekule.ChemStructOperation.MergeNodes.canMerge(f,g,e,d)}else{return false}},_canMergeConnectors:function(e,f){var d=this.getEnableStructFragmentMerge();if(this.getEnableConnectorMerge()){return Kekule.ChemStructOperation.MergeConnectors.canMerge(e,f,d)}else{return false}},_findSuitableMergeTargetBoundInfo:function(e,h,g,d){for(var f=e.length-1;f>=0;--f){var k=e[f];var j=k.obj;if(h.indexOf(j)>=0){continue}if(!(j instanceof g)){continue}if(d&&!d(j)){continue}return k}return null},_getMagneticNodeMergeDest:function(i,k,h){var g=this.getEditor();var e=this;var j=function(l){var m=l.obj;return(i!==m)&&(h.indexOf(m)<0)&&(m instanceof Kekule.ChemStructureNode)&&e._canMergeNodes(i,m)};if(k){var d=g.getBoundInfosAtCoord(k,j);var f=d.length?d[d.length-1]:null;return f?f.obj:null}else{return null}},moveManipulatedObjs:function($super,h){var d;if(this.isDirectedMove()){var g=Kekule.CoordUtils;var f=this.getStartCoord();var j=g.getDistance(f,h);var i=g.substract(h,f);var e=this._directedMovingDirection;if(this._directedMovingDirection){}else{e=(Math.abs(i.x)>=Math.abs(i.y))?"x":"y";if(j<this.getEditor().getEditorConfigs().getInteractionConfigs().getDirectedMoveDistanceThreshold()){}else{this._directedMovingDirection=e}}d=Object.extend({},f);d[e]=h[e]}else{d=h}return $super(d)},applyManipulatingObjsInfo:function($super,j){this.setAllManipulateObjsMerged(false);var e=this.getEditor();e.hotTrackOnObj(null);var ad=Kekule.Editor.BasicManipulationIaController.ManipulationType;var B=this.getManipulationType();var s=this.getManipulateOriginObjs();var p=this.getManipulateObjs();var U=[].concat(s);Kekule.ArrayUtils.pushUnique(U,p);var r=this.getMergeOperations();var o=this;var x=function(i){if(i instanceof Kekule.StructureFragment){return false}else{return(i instanceof Kekule.ChemStructureNode)||(i instanceof Kekule.ChemStructureConnector)}};var Q=(s.length===1)&&(s[0] instanceof Kekule.ChemStructureConnector);var aa=(p.length===1)&&(p[0] instanceof Kekule.ChemStructureNode)&&x(p[0]);if(!Q&&this.getEnableMagneticMerge()){var d=this.getManipulateObjCurrInfoMap();var f=this.getManipulateObjInfoMap();var o=this;var u=[];var V=[];var g=[];for(var X=0,W=p.length;X<W;++X){var h=p[X];if(!x(h)){continue}var z=d.get(h);var E=z.screenCoord;if(E){var O=e.getBoundInfosAtCoord(E);var K=this._getMagneticNodeMergeDest(h,E,U);if(K){u.push(X);V.push(h);g.push(K)}else{}}}if(V.length){var ab=V.length;this.setAllManipulateObjsMerged(ab===p.length);var ac=(ab<=1);if(!ac){for(var X=0,W=V.length;X<W;++X){var h=V[X];var L=g[X];var N=u[X];var C=r[N];if(!C||!this.isSameNodeMerge(C,h,L)){ac=true;break}}}if(ac){this.reverseMergeOpers();var q=Kekule.CoordUtils;if((ab===1)||(e.getCoordMode()===Kekule.CoordMode.COORD3D)){var z=d.get(V[0]);var E=z.screenCoord;var R=e.getObjectScreenCoord(g[0]);var T=q.substract(R,E);var Y=false;for(var X=0,W=p.length;X<W;++X){var h=p[X];if(h!==V[0]){var Z=d.get(h);if(Z.screenCoord){var w=q.add(Z.screenCoord,T);Z.screenCoord=w;if(this._getMagneticNodeMergeDest(h,w,U)){Y=true}}}}if(Y){return this.applyManipulatingObjsInfo(j)}else{for(var X=0,W=p.length;X<W;++X){var h=p[X];if(h!==V[0]){var Z=d.get(h);this.applySingleManipulatingObjInfo(X,h,Z,j)}}}}else{if((ab>1)&&(e.getCoordMode()!==Kekule.CoordMode.COORD3D)){var m=V[0];var k=V[1];var J=f.get(m).screenCoord;var H=f.get(k).screenCoord;var M=e.getObjectScreenCoord(g[0]);var I=e.getObjectScreenCoord(g[1]);var S=q.calcCoordGroup2DTransformParams(J,H,M,I);var G=q.calcTransform2DMatrix(S);var Y=false;for(var X=0,W=p.length;X<W;++X){var h=p[X];if(V.indexOf(h)<0){var Z=f.get(h);var z=d.get(h);if(Z.screenCoord){var w=q.transform2DByMatrix(Z.screenCoord,G);z.screenCoord=w;if(this._getMagneticNodeMergeDest(h,w,U)){Y=true}}if(Z.size){z.size=q.multiply(Z.size,S.scale)}}}if(Y){return this.applyManipulatingObjsInfo(j)}else{for(var X=0,W=p.length;X<W;++X){var h=p[X];if(V.indexOf(h)<0){var z=d.get(h);this.applySingleManipulatingObjInfo(X,h,z,j)}}}}}for(var X=0,W=ab;X<W;++X){var h=V[X];var L=g[X];var N=u[X];var y=this.createNodeMergeOperation(h,L);this.getMergeOperations()[N]=y}this.executeMergeOpers()}e.hotTrackOnObj(g);return}}if(B===ad.MOVE){var v=false;if((Q&&this.getEnableConnectorMerge())||(aa&&this.getEnableNodeMerge())){var D;var O=e.getBoundInfosAtCoord(j);var F=Q?Kekule.ChemStructureConnector:Kekule.ChemStructureNode;var n=Q?s[0]:p[0];var P=Q?function(i){return o._canMergeConnectors(n,i)}:function(i){return o._canMergeNodes(n,i)};var A=this._findSuitableMergeTargetBoundInfo(O,U,F,P);if(A){var t=A.obj;if(t){this.setAllManipulateObjsMerged(true);e.hotTrackOnObj(t);var C=r[0];if((Q&&this.isSameConnectorMerge(C,n,t))||(aa&&this.isSameNodeMerge(C,n,t))){return}else{if(C){this.reverseMergeOpers()}var y=Q?this.createConnectorMergeOperation(n,t):this.createNodeMergeOperation(n,t);this.getMergeOperations()[0]=y;this.executeMergeOpers();return}}}}}this.reverseMergeOpers();$super(j)},doMoveManipulatedObj_old:function($super,o,l,h,g){var e=this.getEditor();var x=this.getManipulateObjInfoMap().get(l);var t=h;var d=this.getManipulateOriginObjs();var s=this.getManipulationType();var p=(s===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE)&&(d.length===1)&&(d[0] instanceof Kekule.ChemStructureConnector);var r=t;var n=null;var z=this.getMergeOperations();var j=z[o];var A=this.getManipulateObjs();if(!p&&this.getEnableMagneticMerge()&&(l instanceof Kekule.ChemStructureNode)){var f=e.getBoundInfosAtCoord(r);if(f&&f.length){for(var u=f.length-1;u>=0;--u){var x=f[u];var q=x.obj;if(q===l){continue}if(A.indexOf(q)>=0){continue}if(q instanceof Kekule.ChemStructureNode){if(this._canMergeNodes(l,q)){e.addHotTrackedObj(q);if(this.isSameNodeMerge(j,l,q)){return}n=this.createNodeMergeOperation(l,q);break}}}if(!n){e.hotTrackOnObj(null)}else{if(j){this.reverseMergeOpers(o)}this.getMergeOperations()[o]=n;this.executeMergeOpers()}}}var r=g;var y=false;if((s===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE)){var m=d[0];if(d&&(d.length===1)){var w=e.getTopmostBoundInfoAtCoord(r,[m]);if(w){var k=w.obj;if(k&&(A.indexOf(k)<0)){if(p&&(m instanceof Kekule.ChemStructureConnector)&&(k instanceof Kekule.ChemStructureConnector)){if(this.getEnableConnectorMerge()){e.hotTrackOnObj(k);if(this.getEnableStructFragmentMerge()){y=true}else{y=(m.getParent()===k.getParent())}if(y){n=this.createConnectorMergeOperation(m,k)}}}else{if((m instanceof Kekule.ChemStructureNode)&&(k instanceof Kekule.ChemStructureNode)){if(this._canMergeNodes(m,k)){e.hotTrackOnObj(k);if(this.isSameNodeMerge(j,m,k)){return}else{}n=this.createNodeMergeOperation(m,k)}}}if(n){var j=z[o];if(j){this.reverseMergeOpers(o)}this.getMergeOperations()[o]=n;this.executeMergeOpers();return}}}}}if(!n){e.hideHotTrack();var v=!!this.getMergeOperations().length;if(v){this.reverseMergeOpers(o)}$super(o,l,h,g)}},createNodeMergeOperation:function(f,e){var d=this.getEnableStructFragmentMerge();if(!Kekule.ChemStructOperation.MergeNodes.canMerge(f,e,d,this.getEnableNeighborNodeMerge())){return null}else{var g=new Kekule.ChemStructOperation.MergeNodes(f,e,d);return g}},createConnectorMergeOperation:function(f,e){var d=this.getEnableStructFragmentMerge();if(!Kekule.ChemStructOperation.MergeConnectors.canMerge(f,e,d)){return null}else{var g=new Kekule.ChemStructOperation.MergeConnectors(f,e,this.getEditor().getCoordMode(),d);return g}},isSameConnectorMerge:function(e,f,d){return e&&(e instanceof Kekule.ChemStructOperation.MergeConnectors)&&(f===e.getTarget())&&(d===e.getDest())},isSameNodeMerge:function(e,f,d){return e&&(e instanceof Kekule.ChemStructOperation.MergeNodes)&&(f===e.getTarget())&&(d===e.getDest())},executeMergeOpers:function(){var h=Kekule.ArrayUtils.toUnique(this.getMergeOperations());var e=[];for(var g=0,d=h.length;g<d;++g){if(h[g]){h[g].execute();var f=h[g].getDest?h[g].getDest():null;if(f){a.pushUnique(e,f)}}}this.setMergingDests(e.length?e:null);this.refreshManipulateObjs();this._mergeJustReversed=false},reverseMergeOpers:function(f){this.setMergingDests(null);var e=Kekule.ArrayUtils.toUnique(this.getMergeOperations());if(!e||!e.length){}else{if(!f){f=0}for(var d=e.length-1;d>=f;--d){if(e[d]){e[d].reverse()}}this.getMergeOperations().length=f;this._mergeJustReversed=true;this.refreshManipulateObjs()}},react_mousemove:function($super,d){this._suppressConstrainedMoving=d.getAltKey();this._suppressConstrainedRotating=d.getAltKey();this._isInDirectedMoving=d.getShiftKey();return $super(d)}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolManipulationIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolBondIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.MolBondIaController",initialize:function($super,d){$super(d);this.setState(b.State.INITIAL);this.setBondOrder(Kekule.BondOrder.SINGLE);this.setAllowBondingToBond(false);this.setEnableBondModification(true);this.setEnableSelect(false);this.setEnableMove(true);this.setAutoSwitchBondOrder(false);this.setEnableNeighborNodeMerge(false)},initProperties:function(){this.defineProp("allowBondingToBond",{dataType:DataType.BOOL,serializable:false});this.defineProp("state",{dataType:DataType.INT,serializable:false});this.defineProp("enableBondModification",{dataType:DataType.BOOL,serializable:false});this.defineProp("autoSwitchBondOrder",{dataType:DataType.BOOL,serializable:false});this.defineProp("startingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("endingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("structFragment",{dataType:"Kekule.ChemStructureFragment",serializable:false});this.defineProp("autoCreatedStructFragment",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("autoCreatedStartingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("bond",{dataType:"Kekule.Bond",serializable:false});this.defineProp("bondType",{dataType:DataType.STRING,serializable:false});this.defineProp("bondOrder",{dataType:DataType.INT,serializable:false});this.defineProp("bondStereo",{dataType:DataType.INT,serializable:false});this.defineProp("initialBondDirection",{dataType:DataType.FLOAT})},_isBondDifferent:function(f){var d=this.getBondStereo();var e=Kekule.BondStereo;if(d===e.UP||d===e.UP_INVERTED||d===e.DOWN||d===e.DOWN_INVERTED){return true}else{return(f.getBondType()!==this.getBondType())||(f.getBondOrder()!==this.getBondOrder())||(f.getStereo()!==this.getBondStereo())}},canInteractWithObj:function($super,e){var d=this.getState();if(d===b.State.INITIAL){if(e instanceof Kekule.ChemStructureNode){return true}else{if(e instanceof Kekule.ChemStructureConnector){if(this.getAllowBondingToBond()){return true}else{if(this.getEnableBondModification()){if(e instanceof Kekule.Bond){return this._isBondDifferent(e)}}else{return false}}}}}else{return $super(e)}},doTestMouseCursor:function(f,d){return""},isObjValidBondTerminator:function(d){if(!d){return false}if(!this.getAllowBondingToBond()){return(d instanceof Kekule.ChemStructureNode)}else{return((d instanceof Kekule.ChemStructureNode)||(d instanceof Kekule.ChemStructureConnector))}},isBond:function(d){return(d instanceof Kekule.Bond)},getNewBondDefAngle:function(d,e){var f=this.getEditorConfigs().getStructureConfigs();return f.getNewBondDefAngle(d,e)},addDefBond:function(q,h,i){var t;var k=this.getEditor();k.beginUpdateObject();try{if(!h){if(!this.getEditor().canAddUnconnectedStructFragment()){return null}var f=this.getEditor().screenCoordToObj(q);var r=this.getEditor().getOnlyOneBlankStructFragment();if(!r){h=this.getEditor().createNewStructFragmentAndStartingAtom(null,f);this.setAutoCreatedStartingObj(null);this.setAutoCreatedStructFragment(h?h.getParent():null)}else{h=this.getEditor().createStructStartingAtom(r,null,f);this.setAutoCreatedStructFragment(null);this.setAutoCreatedStartingObj(h)}}else{this.setAutoCreatedStartingObj(null);this.setAutoCreatedStructFragment(null)}if(this.isObjValidBondTerminator(h)){var k=this.getEditor();this.setStartingObj(h);var n=h.getParent();this.setStructFragment(n);var d=this.getEditorConfigs().getStructureConfigs();var l=Kekule.oneOf(this.getBondType(),d.getDefBondType());var p=Kekule.oneOf(this.getBondOrder(),d.getDefBondOrder());var m=Kekule.oneOf(this.getBondStereo(),Kekule.BondStereo.NONE);var e=k.getDefBondLength?k.getDefBondLength():d.getDefBondLength();var o=this.getNewBondDefAngle(h,p);var j=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingLocation(h,e,o,this.getEditor().getAllowCoordBorrow());var g=this.getEditor().createDefaultNode(j,Kekule.Editor.CoordSys.OBJ,n);this.setEndingObj(g);var s=new Kekule.Bond();s.setBondType(l);s.setBondOrder(p);s.setStereo(m);n.appendConnector(s);s.appendConnectedObj(h);s.appendConnectedObj(g);this.setBond(s);if(i){this.getEditor().objectsChanged([s,g])}t=j}else{t=null}}finally{k.endUpdateObject()}return t},addOperationToEditor:function($super){return $super()},getAllObjOperations:function($super){var d=$super()||[];var e=this.getAddBondOperation();if(e){d.unshift(e)}return d},getAddBondOperation:function(){var m=new Kekule.MacroOperation();var i=this.getEditor();var h=this.getAutoCreatedStructFragment();if(h){var d=new Kekule.ChemObjOperation.Add(h,this.getEditor().getChemObj(),null);m.add(d)}var g=this.getStartingObj();var l=this.getEndingObj();var n=this.getBond();var k=this.getStructFragment();var f=this.getAutoCreatedStartingObj();if(f){var e=new Kekule.ChemStructOperation.AddNode(f,k);m.add(e)}var e=new Kekule.ChemStructOperation.AddNode(l,k);m.add(e);var j=new Kekule.ChemStructOperation.AddConnector(n,k,null,[g,l]);m.add(j);return m},modifyBond:function(r){var m=this.getBondType();var o;var l=Kekule.BondOrder;var g=[l.SINGLE,l.DOUBLE,l.TRIPLE];if(this.getAutoSwitchBondOrder()&&(m===Kekule.BondType.COVALENT)&&(r.getBondType===Kekule.BondType.COVALENT)){var i=r.getBondOrder();var k=g.indexOf(i);if(k>=0){k=(++k)%g.length}else{k=0}o=g[k]}else{o=this.getBondOrder()}var p=r.getStereo();var n=this.getBondStereo();if(p===n){n=Kekule.BondStereo.getInvertedDirection(n)}var q={bondType:m,bondOrder:o,stereo:n};var s=false;for(var f in q){var d=r.getPropValue(f);if(d!==q[f]){s=true;break}}if(s){var j=this.getEditor();j.beginUpdateObject();try{var h=new Kekule.ChemObjOperation.Modify(r,q);h.execute();j.pushOperation(h);var e=[r].concat(r.getConnectedObjs());this.getEditor().objectsChanged(e)}finally{j.endUpdateObject()}}},react_mousedown:function(j){if(j.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var g=b.State;var k=this._getEventMouseCoord(j);var h=this.getState();if(h===g.INITIAL){var d=this.getEditor().getTopmostBoundInfoAtCoord(k);if(d){var i=d.obj;if(this.isObjValidBondTerminator(i)){var f=this.addDefBond(k,i,true);if(f){this.startDirectManipulate(null,this.getEndingObj(),k)}return true}else{if(this.isBond(i)&&this.getEnableBondModification()){this.modifyBond(i);return true}}}else{if(this.getEditor().canAddUnconnectedStructFragment()){var f=this.addDefBond(k,null,true);if(f){this.startDirectManipulate(null,this.getEndingObj(),k)}return true}}}}},react_mouseup:function($super,i){var h=this.getState();var g=this.getStartCoord();var d=this._getEventMouseCoord(i);var f=Kekule.Editor.BasicManipulationIaController.State;if((h===f.MANIPULATING)&&(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT)){if(Kekule.CoordUtils.isEqual(g,d)){this.addOperationToEditor();this.stopManipulate();this.setState(f.NORMAL);return true}}return $super(i)}});Kekule.Editor.MolBondIaController.State={INITIAL:0,START_NODE_SET:21,ADJUSTING:22};var b=Kekule.Editor.MolBondIaController;Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolBondIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolAtomIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController",initialize:function($super,d){$super(d);this._createNonAtomLabelInfos();this._setterShown=false},finalize:function($super){if(this.getAtomSetter()){this.getAtomSetter().finalize()}$super()},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:false});this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:false});this.defineProp("periodicTable",{dataType:DataType.OBJECT,serializable:false});this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,serializable:false});this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:false})},canInteractWithObj:function($super,d){if(this.isValidNode(d)){return true}else{return false}},isValidNode:function(d){return d instanceof Kekule.ChemStructureNode},getNodeLabel:function(f){var e=this.getEditor();var i=e.getRenderConfigs().getDisplayLabelConfigs();if(f.getIsotopeId){return f.getIsotopeId()}else{if(f instanceof Kekule.SubGroup){var h=f.getAbbr()||f.getFormulaText();return h||i.getRgroup()}else{if(f instanceof Kekule.VariableAtom){var g=f.getAllowedIsotopeIds();var j=f.getDisallowedIsotopeIds();return(g&&g.length)?this._getVarAtomListLabel():(j&&j.length)?this._getVarAtomNotListLabel():this._getVarAtomListLabel()}else{var d=f.getCoreDisplayRichTextItem(null,null,i);return Kekule.Render.RichTextUtils.toText(d)}}}},_getVarAtomListLabel:function(){var d=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return d.getVariableAtom()},_getVarAtomNotListLabel:function(){var d=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return"~"+d.getVariableAtom()},_createNonAtomLabelInfos:function(){var d=[];var e=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();d.push({nodeLabel:e.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")});d.push({nodeLabel:e.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")});d.push({nodeLabel:e.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")});d.push({nodeLabel:e.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")});d.push({nodeLabel:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")});d.push({nodeLabel:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")});this.setNonAtomLabelInfos(d);return d},_indexOfNonAtomLabel:function(h){var g=this.getNonAtomLabelInfos();for(var e=0,d=g.length;e<d;++e){var f=g[e];if(f.nodeLabel===h){return e}}return -1},_getNonAtomInfo:function(e){var d=this._indexOfNonAtomLabel(e);return(d<0)?null:this.getNonAtomLabelInfos()[d]},getAtomSetterWidget:function(g){var e=this.getAtomSetter();if(!e&&g){var d=this.getEditor().getCoreElement();var f=d.ownerDocument;e=this._createAtomSetterWidget(f,d);this.setAtomSetter(e)}return e},_createAtomSetterWidget:function(n,m){var p=new Kekule.Widget.ComboBox(n);var f=this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms();var h=[];for(var k=0,j=f.length;k<j;++k){h.push({value:f[k],data:{props:{isotopeId:f[k]}}})}h.push({value:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")});var e=this.getNonAtomLabelInfos();for(var k=0,j=e.length;k<j;++k){var g=e[k];var d={value:g.nodeLabel,data:{props:g.props}};if(g.description){d.text=g.nodeLabel+" - "+g.description}h.push(d)}p.setItems(h);p.appendToElem(m);var o=this;p.addEventListener("keyup",function(l){var i=l.htmlEvent;if(i.getKeyCode()===Kekule.X.Event.KeyCode.ENTER){o.applySetter(p);p.dismiss()}});p.addEventListener("valueSelect",function(i){o.applySetter(p);p.dismiss()});p.addEventListener("showStateChange",function(i){if(!i.isShown&&!i.isDismissed){if(o.getAtomSetter()&&o.getAtomSetter().isShown()){o.applySetter(p)}}});return p},getPeriodicTableDialogWidget:function(g){var e=this.getPeriodicTableDialog();if(!e&&g){var d=this.getEditor().getCoreElement();var f=d.ownerDocument;e=this._createPeriodicTableDialogWidget(f,d);this.setPeriodicTableDialog(e)}return e},_createPeriodicTableDialogWidget:function(g,d){var e=new Kekule.Widget.Dialog(g,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);var f=new Kekule.ChemWidget.PeriodicTable(g);f.setUseMiniMode(true);f.setEnableSelect(true);f.appendToElem(e.getClientElem());this.setPeriodicTable(f);return e},openSetterUi:function(k,h){var i=this.getAtomSetter();if(!this.isValidNode(h)){return}this.setCurrAtom(h);var g=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0;var e=g/1.5;var d=this.getNodeLabel(h);var j=this.getAtomSetterWidget(true);j.setValue(d);j.setIsDirty(false);var f=j.getElement().style;f.position="absolute";f.fontSize=g;f.left=(k.x-e)+"px";f.top=(k.y-e)+"px";j._applied=false;j.show(null,null,Kekule.Widget.ShowHideType.POPUP);(function(){j.focus();j.selectAll()}).defer()},applySetter:function(i,l){if(i._applied){return}if(!i.getIsDirty()){return}if(!l){l=this.getCurrAtom()}var d;var m=null;var r=i.getValue();var j;if(r===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){var j=this.getPeriodicTableDialogWidget(true);j.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var h=l.getSymbol?l.getSymbol():null;this.getPeriodicTable().setEnableSelect(true).setEnableMultiSelect(false).setSelectedSymbol(h)}else{if(r===this._getVarAtomListLabel()||r===this._getVarAtomNotListLabel()){var k=r===this._getVarAtomNotListLabel();var j=this.getPeriodicTableDialogWidget(true);j.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var n=l.getAllowedIsotopeIds?l.getAllowedIsotopeIds():null;var e=l.getDisallowedIsotopeIds?l.getDisallowedIsotopeIds():null;this.getPeriodicTable().setEnableSelect(true).setEnableMultiSelect(true).setSelectedSymbols(k?e:n)}}if(j){var t=this;j.openModal(function(u){if(u===Kekule.Widget.DialogButtons.OK){var x;var w;if(r===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){var y=t.getPeriodicTable().getSelectedSymbol();x=Kekule.Atom;w={isotopeId:y}}if(r===t._getVarAtomListLabel()){var v=t.getPeriodicTable().getSelectedSymbols();x=Kekule.VariableAtom;w={allowedIsotopeIds:v,disallowedIsotopeIds:null}}if(r===t._getVarAtomNotListLabel()){var v=t.getPeriodicTable().getSelectedSymbols();x=Kekule.VariableAtom;w={allowedIsotopeIds:null,disallowedIsotopeIds:v}}t.applyModification(l,null,x,w)}},this);return}var p=null;var o=this._getNonAtomInfo(r);if(o){d=o.nodeClass;m=o.props}else{var g=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(r);if(g){var f=g.createObjects(l)||{};var s=f.objects;var q=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),g,f,l,null);this.getEditor().transformCoordAndSizeOfObjects(s,q);p=s[0];d=p.getClass()}else{d=Kekule.ChemStructureNodeFactory.getClassByLabel(r,null);if(!d){if(this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()){d=Kekule.Pseudoatom}}m=(d===Kekule.Atom)?{isotopeId:r}:(d===Kekule.Pseudoatom)?{symbol:r}:{}}}if(!d){Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL"))}else{this.applyModification(l,p,d,m);i._applied=true}},applyModification:function(f,n,p,l){var n;var g,h;var d=f.getClass();if(n&&!p){p=n.getClass()}if(n||p!==d){g=new Kekule.MacroOperation();if(!n){n=new p()}var i=new Kekule.ChemStructureNode();i.assign(f);n.assign(i);var o=new Kekule.ChemStructOperation.ReplaceNode(f,n);g.add(o)}else{n=f}if(l){h=new Kekule.ChemObjOperation.Modify(n,l);if(g){g.add(h)}}var j=g||h;if(j){var k=this.getEditor();k.beginUpdateObject();try{j.execute()}catch(m){throw (m)}finally{k.endUpdateObject()}if(k&&k.getEnableOperHistory()&&j){k.pushOperation(j)}}},react_mouseup:function(h){if(h.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var i=this._getEventMouseCoord(h);var d=this.getEditor().getTopmostBoundInfoAtCoord(i);if(d){var g=d.obj;if(this.isValidNode(g)){var f=this.getEditor().getObjectScreenCoord(g);h.preventDefault();h.stopPropagation();this.openSetterUi(f,g);this.getEditor().setSelection([g])}return true}}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolAtomIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolNodeChargeIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolNodeChargeIaController",initialize:function($super,d){$super(d);this.setChargeInc(1)},initProperties:function(){this.defineProp("chargeInc",{dataType:DataType.NUMBER,serializable:false});this.defineProp("charge",{dataType:DataType.NUMBER,serializable:false});this.defineProp("radical",{dataType:DataType.INT,serializable:false});this.defineProp("currNode",{dataType:DataType.OBJECT,serializable:false})},canInteractWithObj:function($super,d){if(this.isValidNode(d)){return true}else{return false}},isValidNode:function(d){return d instanceof Kekule.ChemStructureNode},apply:function(h){var e=false;var i={};var g=h.getCharge();if(Kekule.ObjUtils.notUnset(this.getCharge())){if(g!==this.getCharge()){i.charge=this.getCharge();e=true}}else{if(this.getChargeInc()){g+=this.getChargeInc();i.charge=g;e=true}}var d=h.getRadical();if(this.getRadical()!==d){i.radical=this.getRadical();e=true}if(e){var j=new Kekule.ChemObjOperation.Modify(h,i);j.execute();var f=this.getEditor();if(f&&f.getEnableOperHistory()){f.pushOperation(j)}}},react_mouseup:function(g){if(g.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var h=this._getEventMouseCoord(g);var d=this.getEditor().getTopmostBoundInfoAtCoord(h);if(d){var f=d.obj;if(this.isValidNode(f)){this.apply(f);g.preventDefault();g.stopPropagation()}return true}}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolNodeChargeIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.RepositoryIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.RepositoryIaController",initialize:function($super,d){$super(d)},initProperties:function(){this.defineProp("repositoryItem",{dataType:"Kekule.AbstractRepositoryItem",serializable:false});this.defineProp("addRepObjsOper",{dataType:"Kekule.MacroOperation",serializable:false})},doTestMouseCursor:function(f,d){return""},calcInitialTransformParams:function(f,e,d,g){return Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),f,e,d,g)},addRepositoryObj:function(s,q){var r=this.getEditor();this.setAddRepObjsOper(null);var e=null;r.beginUpdateObject();try{var g=r.getChemSpace();var k=this.getRepositoryItem();e=k.createObjects(s)||{};var v=e.objects;var d=k.isOneStructureFragmentObj();var f=false;var t=this.getEditor().getOnlyOneBlankStructFragment();if(!this.getEditor().canCreateNewChild()&&!e.mergeObj){if(!d||!this.getEditor().canAddUnconnectedStructFragment()){return null}else{f=true}}var p=new Kekule.MacroOperation();for(var o=0,j=v.length;o<j;++o){var n=v[o];var h;if(f){h=new Kekule.ChemStructOperation.MergeStructFragment(n,t)}else{h=new Kekule.ChemObjOperation.Add(n,g)}p.add(h)}p.execute();this.setAddRepObjsOper(p);var m=f?[t]:v;var u=this.calcInitialTransformParams(k,e,s,q);this._transformObjectsCoordAndSize(m,u);e.objects=m}finally{r.endUpdateObject()}return e},_transformObjectsCoordAndSize:function(d,e){return this.getEditor().transformCoordAndSizeOfObjects(d,e)},getAllObjOperations:function($super){var e=$super()||[];var d=this.getAddRepObjsOper();if(d){e.unshift(d)}return e},addOperationToEditor:function($super){if(this.getAllManipulateObjsMerged()){return null}else{return $super()}},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE},react_mousedown:function(o){if(o.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var j=b.State;var m=this._getEventMouseCoord(o);var d=this.getState();if(d===j.INITIAL){var h=this.getEditor().getTopmostBoundInfoAtCoord(m);var l=h?h.obj:null;var g=this.addRepositoryObj(l,m);if(g){var f=g.objects;var n=null;var i=this.getInitManipulationType();if(g.mergeObj){n=this.getEditor().getObjectScreenCoord(g.mergeObj);i=Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE}var k=this.getEditor().getObjectsContainerBox(f);this.startDirectManipulate(i,f,m,k,n);this.moveManipulatedObjs(m)}else{}return true}}},react_mouseup:function($super,i){var h=this.getState();var g=this.getStartCoord();var d=this._getEventMouseCoord(i);var f=Kekule.Editor.BasicManipulationIaController.State;if((h===f.MANIPULATING)&&(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT)){if(Kekule.CoordUtils.isEqual(g,d)){this.addOperationToEditor();this.stopManipulate();this.setState(f.NORMAL);return true}}return $super(i)}});Kekule.Editor.MolRingIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.MolRingIaController",initialize:function($super,d){$super(d);this.setRepositoryItem(new Kekule.Editor.MolRingRepositoryItem2D())},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getRingAtomCount()},setter:function(d){this.getRepositoryItem().setRingAtomCount(d)}});this.defineProp("isAromatic",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getIsAromatic()},setter:function(d){this.getRepositoryItem().setIsAromatic(d)}})}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolRingIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.RepositoryStructureFragmentIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.RepositoryStructureFragmentIaController",initialize:function($super,d){$super(d)},initProperties:function(){this.defineProp("repItemName",{dataType:DataType.STRING,setter:function(e){if(e!==this.getRepItemName()){var d=Kekule.Editor.RepositoryItemManager.getItem(e);if(d){this.setRepositoryItem(d);this.setPropStoreFieldValue("repItemName",e)}}}})}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.RepositoryStructureFragmentIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.ArrowLineIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.ArrowLineIaController",initialize:function($super,d){$super(d);this.setRepositoryItem(new Kekule.Editor.PathGlyphRepositoryItem2D())},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT,getter:function(){return this.getRepositoryItem().getGlyphRefLength()},setter:function(d){this.getRepositoryItem().setGlyphRefLength(d)}});this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:false,getter:function(){return this.getRepositoryItem().getGlyphClass()},setter:function(d){this.getRepositoryItem().setGlyphClass(d)}});this.defineProp("glyphInitialParams",{dataType:DataType.HASH,getter:function(){return this.getRepositoryItem().getGlyphInitialParams()},setter:function(d){this.getRepositoryItem().setGlyphInitialParams(d)}})},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE},addRepositoryObj:function($super,e,d){this.getRepositoryItem().setGlyphRefLength(this.getEditor().getChemSpace().getDefAutoScaleRefLength());return $super(e,d)}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.ArrowLineIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.FormulaIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.FormulaIaController",initialize:function($super,d){$super(d);this._operAddMol=null},initProperties:function(){this.defineProp("currMol",{dataType:DataType.OBJECT,serializable:false});this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:false})},canInteractWithObj:function($super,d){if(d&&this.isValidMol(d)){return true}else{return false}},isValidMol:function(d){return(d instanceof Kekule.StructureFragment)&&d.hasFormula()&&!d.hasCtab()},getFormulaText:function(d){return d.hasFormula()?d.getFormula().getText():""},createNewMol:function(g,h){var f;var e=this.getEditor();if(!e.canCreateNewChild()){f=e.getOnlyOneBlankStructFragment();if(!f){return null}}e.beginUpdateObject();try{if(!f){var f=new Kekule.Molecule()}f.getFormula(true);g.appendChild(f);e.setObjectScreenCoord(f,h);var d=new Kekule.ChemObjOperation.Add(f,g,null);this._operAddBlock=d}finally{e.endUpdateObject()}return f},getTextSetterWidget:function(g){var e=this.getTextSetter();if(!e&&g){var d=this.getEditor().getCoreElement();var f=d.ownerDocument;e=this._createTextSetterWidget(f,d);this.setTextSetter(e)}return e},_createTextSetterWidget:function(g,e){var d=new Kekule.Widget.TextBox(g);d.addClassName(c.CHEMEDITOR_FORMULA_SETTER);d.appendToElem(e);var f=this;d.addEventListener("keyup",function(j){var h=j.htmlEvent;var i=h.getKeyCode();if(i===Kekule.X.Event.KeyCode.ENTER){f.applySetter(d);d.dismiss()}else{if(i===Kekule.X.Event.KeyCode.ESC){d.dismiss();f.cancelSetter()}}});d.addEventListener("showStateChange",function(h){if(!h.isShown&&!h.isDismissed){f.applySetter(d)}});return d},cancelSetter:function(){if(this._operAddBlock){this._operAddBlock.reverse();this._operAddBlock=null}},applySetter:function(i,e){if(i._applied){return}if(!e){e=this.getCurrMol()}var h;var g=i.getText();if(!g){if(this._operAddBlock){this.cancelSetter()}else{h=new Kekule.ChemObjOperation.Remove(e,e.getParent())}}else{var h=new Kekule.ChemObjOperation.Modify(e.getFormula(),{text:g})}if(h){h.execute();var d=this.getEditor();if(d&&d.getEnableOperHistory()){if(this._operAddBlock){var f=new Kekule.MacroOperation();f.add(this._operAddBlock);f.add(h);d.pushOperation(f);this._operAddBlock=null}else{d.pushOperation(h)}}}i._applied=true},openSetterUi:function(j,i){var h=this.getTextSetter();if(h&&h.isShown()){this.applySetter(h,this.getCurrMol())}if(!i){i=this.createNewMol(this.getEditor().getChemObj(),j)}if(!this.isValidMol(i)){return}this.setCurrMol(i);this.getEditor().setSelection([i]);var l=i.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();var f=i.getCascadedRenderOption("fontFamily")||"";var k=this.getFormulaText(i);var g=this.getTextSetterWidget(true);g._applied=false;var d=k||"";g.setValue(d);var e=g.getElement().style;e.position="absolute";e.fontSize=l+"px";e.left=j.x+"px";e.top=j.y+"px";e.fontFamily=f;g.show(null,null,Kekule.Widget.ShowHideType.POPUP);g.selectAll();g.focus()},react_mouseup:function(i){if(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var j=this._getEventMouseCoord(i);var g;var d=this.getEditor().getTopmostBoundInfoAtCoord(j);if(d){var h=d.obj;if(this.isValidMol(h)){g=h}}var f;if(d&&d.boundInfo){f=d.boundInfo.coords[0]}else{f=j}i.preventDefault();i.stopPropagation();this.openSetterUi(f,g);return true}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.FormulaIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.ContentBlockIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ContentBlockIaController",initialize:function($super,d){$super(d)},initProperties:function(){this.defineProp("currBlock",{dataType:DataType.OBJECT,serializable:false})},canInteractWithObj:function($super,d){return(d&&this.isValidBlock(d))},isValidBlock:function(d){return d instanceof Kekule.ContentBlock},execute:function(e,d,f){},react_mousedown:function(h){if(h.getButton()===Kekule.X.Event.MouseButton.LEFT){this.getEditor().setSelection(null);var j=this._getEventMouseCoord(h);var i;var d=this.getEditor().getTopmostBoundInfoAtCoord(j);if(d){var g=d.obj;if(this.isValidBlock(g)){i=g}}var f=i?this.getEditor().getObjectScreenCoord(i):j;h.preventDefault();h.stopPropagation();this.execute(this.getEditor().getChemObj(),f,i);return true}}});Kekule.Editor.TextBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.TextBlockIaController",initialize:function($super,d){$super(d);this._operAddBlock=null},initProperties:function(){this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:false})},isValidBlock:function(d){return d instanceof Kekule.TextBlock},createNewBlock:function(f,h){var e=this.getEditor();if(!e.canCreateNewChild()){return null}e.beginUpdateObject();try{var g=new Kekule.TextBlock();if(g){f.appendChild(g);e.setObjectScreenCoord(g,h,Kekule.Render.CoordPos.CORNER_TL);var d=new Kekule.ChemObjOperation.Add(g,f,null);this._operAddBlock=d}}finally{e.endUpdateObject()}return g},getBlockText:function(d){return d.getText()},execute:function(e,d,f){this.openSetterUi(d,f)},getTextSetterWidget:function(g){var e=this.getTextSetter();if(!e&&g){var d=this.getEditor().getCoreElement();var f=d.ownerDocument;e=this._createTextSetterWidget(f,d);this.setTextSetter(e)}return e},_createTextSetterWidget:function(g,e){var d=new Kekule.Widget.TextArea(g);d.setAutoSizeX(true);d.setAutoSizeY(true);d.addClassName(c.CHEMEDITOR_TEXT_SETTER);d.appendToElem(e);var f=this;d.addEventListener("keyup",function(j){var h=j.htmlEvent;var i=h.getKeyCode();if((i===Kekule.X.Event.KeyCode.ENTER)&&(h.getCtrlKey())){f.applySetter(d);d.dismiss()}else{if(i===Kekule.X.Event.KeyCode.ESC){d.dismiss();f.cancelSetter()}}});d.addEventListener("showStateChange",function(h){if(!h.isShown&&!h.isDismissed){f.applySetter(d)}});return d},cancelSetter:function(){if(this._operAddBlock){this._operAddBlock.reverse();this._operAddBlock=null}},applySetter:function(i,g){if(i._applied){return}if(!g){g=this.getCurrBlock()}var f=i.getText();var h;if(!f){if(this._operAddBlock){this.cancelSetter()}else{h=new Kekule.ChemObjOperation.Remove(g,g.getParent())}}else{h=new Kekule.ChemObjOperation.Modify(g,{text:f})}if(h){h.execute();var d=this.getEditor();if(d&&d.getEnableOperHistory()){if(this._operAddBlock){var e=new Kekule.MacroOperation();e.add(this._operAddBlock);e.add(h);d.pushOperation(e);this._operAddBlock=null}else{d.pushOperation(h)}}}i._applied=true},openSetterUi:function(j,h){var i=this.getTextSetter();if(i&&i.isShown()){this.applySetter(i,this.getCurrBlock())}if(!h){h=this.createNewBlock(this.getEditor().getChemObj(),j)}if(!this.isValidBlock(h)){return}this.setCurrBlock(h);this.getEditor().setSelection([h]);var l=this.getEditor().getObjectScreenCoord(h,Kekule.Render.CoordPos.CORNER_TL);var m=h.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();var f=h.getCascadedRenderOption("fontFamily")||"";var k=this.getBlockText(h);var g=this.getTextSetterWidget(true);g._applied=false;var d=k||Kekule.$L("ChemWidgetTexts.CAPTION_TEXTBLOCK_INIT");g.setValue(d);var e=g.getElement().style;e.position="absolute";e.fontSize=m+"px";e.left=l.x+"px";e.top=l.y+"px";e.fontFamily=f;g.show(null,null,Kekule.Widget.ShowHideType.POPUP);g.selectAll();g.focus()}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.TextBlockIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.ImageBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.ImageBlockIaController",initialize:function($super,d){$super(d);this._operAddBlock=null;this._imgProbeElem=null;this._actionOpenFile=this.createOpenAction()},doFinalize:function(){if(this._actionOpenFile){this.actionOpenFile.finalize()}},initProperties:function(){},isValidBlock:function(d){return d instanceof Kekule.ImageBlock},createNewBlock:function(g,j,e,i){var f=this.getEditor();if(!f.canCreateNewChild()){return null}f.beginUpdateObject();try{var h=new Kekule.ImageBlock();if(i){h.setSrc(i)}if(e){h.setSize2D(e)}f.setObjectScreenCoord(h,j,Kekule.Render.CoordPos.CORNER_TL);var d=new Kekule.ChemObjOperation.Add(h,g,null);this._operAddBlock=d}finally{f.endUpdateObject()}return h},_getImgFilters:function(){var d=[{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_PNG"),filter:".png"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_JPG"),filter:".jpg,.jpeg"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_GIF"),filter:".gif"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_SVG"),filter:".svg"},Kekule.NativeServices.FILTER_ALL_SUPPORT,Kekule.NativeServices.FILTER_ANY];return d},createOpenAction:function(){var d=new Kekule.ActionFileOpen();d.setFilters(this._getImgFilters());d.on("open",this.reactImageFileOpen,this);return d},reactImageFileOpen:function(h){var g=h.file;if(g){var f=this;var d=new FileReader();d.addEventListener("load",function(){var j=f._getImageProbeElem();var l=j.ownerDocument;try{delete j.width;delete j.height}catch(k){}j.src=d.result;var i=f.getEditor();(function(){var t={x:j.width,y:j.height};if(t.x<=0||t.y<=0){Kekule.error(Kekule.$L("ErrorMsg.INVALID_OR_EMPTY_IMAGE"));return}var p=f._currCoord;var r=i.objCoordToContext(p);var q=Kekule.CoordUtils.add(r,t);var o=i.contextCoordToObj(q);var t=Kekule.CoordUtils.substract(o,p);t=Kekule.CoordUtils.absValue(t);var s=f.getCurrBlock();var m;var e=i.getChemObj();if(s){m=new Kekule.ChemObjOperation.Modify(s,{src:d.result,size2D:t})}else{var n=f.createNewBlock(f.getEditor().getChemObj(),f._currCoord,t,d.result);f.setCurrBlock(n);m=new Kekule.ChemObjOperation.Add(n,e,null)}if(m){try{m.execute();if(i&&i.getEnableOperHistory()){i.pushOperation(m)}}finally{}}}).defer()});d.readAsDataURL(g)}},_getImageProbeElem:function(){if(!this._imgProbeElem){var d=this.getEditor().getElement().ownerDocument;this._imgProbeElem=d.createElement("img")}return this._imgProbeElem},execute:function(e,d,f){this.setCurrBlock(f);this._currCoord=d;this._actionOpenFile.execute(this.getEditor())}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.ImageBlockIaController,Kekule.Editor.ChemSpaceEditor)})();(function(){Kekule.Editor.EditorNexus=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.StructureTreeView",initialize:function($super,a){$super();this._currInvoker=null;if(a){if(a.editor){this.setEditor(a.editor)}if(a.structureTreeView){this.setStructureTreeView(a.structureTreeView)}if(a.objectInspector){this.setObjectInspector(a.objectInspector)}}},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("editor");this.setPropStoreFieldValue("editor",b);this.editorChanged(b,a)}});this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("structureTreeView");this.setPropStoreFieldValue("structureTreeView",b);this.structureTreeViewChanged(b,a)}});this.defineProp("objectInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("objectInspector");this.setPropStoreFieldValue("objectInspector",b);this.objectInspectorChanged(b,a)}})},editorChanged:function(b,a){if(a){this._uninstallEditorEventHandler(a)}if(b){this._installEditorEventHandler(b)}},structureTreeViewChanged:function(b,a){if(a){this._uninstallStructureTreeViewEventHandler(a)}if(b){this._installStructureTreeViewEventHandler(b);this._updateByEditor()}},objectInspectorChanged:function(c,a){var b=this.getEditor();if(b){if(a){if(a.getOperHistory()===b.getOperHistory()){a.setOperHistory(null)}}if(c){c.setOperHistory(b.getOperHistory());c.setEnableOperHistory(b.getEnableOperHistory());this._updateByEditor()}}},_installEditorEventHandler:function(a){a.addEventListener("change",this._reactEditorChanged,this)},_uninstallEditorEventHandler:function(a){a.removeEventListener("change",this._reactEditorChanged,this)},_installStructureTreeViewEventHandler:function(a){a.addEventListener("change",this._reactStructureTreeViewChanged,this)},_uninstallStructureTreeViewEventHandler:function(a){a.removeEventListener("change",this._reactStructureTreeViewChanged,this)},_reactEditorChanged:function(b){if(this._currInvoker){return}var a=b.target;if(a!==this.getEditor()){return}var d=b.changedPropNames;if(d.indexOf("chemObj")>=0){this.changeRootObj(a.getChemObj(),a)}if(d.indexOf("selection")>=0){this.changeSelection(a.getSelection(),a)}if((d.indexOf("operHistory")>=0)||(d.indexOf("enableOperHistory")>=0)){var c=this.getObjectInspector();if(c){c.setOperHistory(a.getOperHistory());c.setEnableOperHistory(a.getEnableOperHistory())}}},_updateByEditor:function(){this._reactEditorChanged({target:this.getEditor(),changedPropNames:["chemObj","selection","operHistory"]})},_reactStructureTreeViewChanged:function(b){if(this._currInvoker){return}var a=b.target;if(a!==this.getStructureTreeView()){return}var d=b.changedPropNames;if(d.indexOf("selection")>=0){var c=a.getSelectedChemObjs();this.changeSelection(c,a)}},changeSelection:function(d,b){this._currInvoker=b;try{var c=this.getEditor();if(c){if(this._currInvoker!==c){c.setSelection(d)}}var a=this.getStructureTreeView();if(a){if(this._currInvoker!==a){a.selectChemObjs(d)}}var e=this.getObjectInspector();if(e){if(this._currInvoker!==e){e.setObjects(d)}}}finally{this._currInvoker=null}},changeRootObj:function(a,c){this._currInvoker=c;try{var d=this.getEditor();if(d&&this._currInvoker!==d){d.setChemObj(a)}var b=this.getStructureTreeView();if(b&&this._currInvoker!==b){b.setRootObj(a)}}finally{this._currInvoker=null}}})})();(function(){var g=Class.PropertyScope;var c=Kekule.ChemWidget;var e=Kekule.Editor;var b=Kekule.Widget.HtmlClassNames;var f=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER:"K-Chem-Composer",COMPOSER_EDITOR_STAGE:"K-Chem-Composer-Editor-Stage",COMPOSER_ADV_PANEL:"K-Chem-Composer-Adv-Panel",COMPOSER_TOOLBAR:"K-Chem-Composer-Toolbar",COMPOSER_COMMON_TOOLBAR:"K-Chem-Composer-Common-Toolbar",COMPOSER_ZOOM_TOOLBAR:"K-Chem-Composer-Zoom-Toolbar",COMPOSER_CHEM_TOOLBAR:"K-Chem-Composer-Chem-Toolbar",COMPOSER_ASSOC_TOOLBAR:"K-Chem-Composer-Assoc-Toolbar",COMPOSER_STYLE_TOOLBAR:"K-Chem-Composer-Style-Toolbar",COMPOSER_FONTNAME_BOX:"K-Chem-Composer-FontName-Box",COMPOSER_FONTSIZE_BOX:"K-Chem-Composer-FontSize-Box",COMPOSER_COLOR_BOX:"K-Chem-Composer-Color-Box",COMPOSER_TEXTDIRECTION_BUTTON:"K-Chem-Composer-TextDirection-Button",COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT:"K-Chem-Composer-TextDirection-Button-Default",COMPOSER_TEXTDIRECTION_BUTTON_LTR:"K-Chem-Composer-TextDirection-Button-LTR",COMPOSER_TEXTDIRECTION_BUTTON_RTL:"K-Chem-Composer-TextDirection-Button-RTL",COMPOSER_TEXTDIRECTION_BUTTON_TTB:"K-Chem-Composer-TextDirection-Button-TTB",COMPOSER_TEXTDIRECTION_BUTTON_BTT:"K-Chem-Composer-TextDirection-Button-BTT",COMPOSER_TEXTALIGN_BUTTON:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL:"K-Chem-Composer-TextAlign-Button-Horizontal",COMPOSER_TEXTALIGN_BUTTON_VERTICAL:"K-Chem-Composer-TextAlign-Button-Vertical",COMPOSER_TEXTALIGN_BUTTON_DEFAULT:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_LEADING:"K-Chem-Composer-TextAlign-Button-Leading",COMPOSER_TEXTALIGN_BUTTON_TRAILING:"K-Chem-Composer-TextAlign-Button-Trailing",COMPOSER_TEXTALIGN_BUTTON_CENTER:"K-Chem-Composer-TextAlign-Button-Center",COMPOSER_TEXTALIGN_BUTTON_LEFT:"K-Chem-Composer-TextAlign-Button-Left",COMPOSER_TEXTALIGN_BUTTON_RIGHT:"K-Chem-Composer-TextAlign-Right",COMPOSER_TEXTALIGN_BUTTON_TOP:"K-Chem-Composer-TextAlign-Top",COMPOSER_TEXTALIGN_BUTTON_BOTTOM:"K-Chem-Composer-TextAlign-Bottom",COMPOSER_DIALOG:"K-Chem-ComposerDialog"});Kekule.globalOptions.add("chemWidget.composer",{commonToolButtons:[d.newDoc,d.loadData,d.saveData,d.undo,d.redo,d.copy,d.cut,d.paste,d.zoomIn,d.reset,d.zoomOut,d.config,d.objInspector],chemToolButtons:[d.manipulate,d.erase,d.molBond,d.molAtom,d.molFormula,d.molRing,d.molCharge,d.glyph,d.textImage],styleToolComponentNames:[d.fontName,d.fontSize,d.color,d.textDirection,d.textAlign]});Kekule.Editor.ComposerStyleToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerStyleToolbar",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:"(use atom custom color)",value:"Atom",className:b.COLORPICKER_SPEC_COLOR_MIXED},LINKED_VALUE_FIELD:"__$value__",initialize:function($super,h){$super(h);this.setPropStoreFieldValue("composer",h);this.createChildWidgets();this.appendToWidget(h);this._relatedPropNames=(h.getCoordMode()===Kekule.CoordMode.COORD3D)?["renderOptions","render3DOptions"]:["renderOptions"];this.getEditor().addEventListener("selectionChange",function(i){if(!this._isApplying){this.updateStyleValues()}},this);this.getEditor().addEventListener("editObjChanged",function(i){var j=i.propNames;if(!j||!j.length||!Kekule.ArrayUtils.intersect(this._relatedPropNames,j).length){return}if(!this._isApplying){this.updateStyleValues()}},this);this._isApplying=false},doFinalize:function($super){this.clearWidgets();$super()},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false,setter:null});this.defineProp("fontNameBox",{dataType:"Kekule.Widget.ComboBox",serializable:false,setter:null});this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.ComboBox",serializable:false,setter:null});this.defineProp("colorBox",{dataType:"Kekule.Widget.ColorDropButton",serializable:false,setter:null});this.defineProp("textDirectionButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("textHorizontalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("textVerticalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("fontName",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getFontNameBox()?this.getFontNameBox().getValue():null},setter:function(h){if(this.getFontNameBox()){this.getFontNameBox().setValue(h)}}});this.defineProp("fontSize",{dataType:DataType.NUMBER,serializable:false,getter:function(){return this.getFontSizeBox()?parseFloat(this.getFontSizeBox().getValue()):null},setter:function(h){if(this.getFontSizeBox()){this.getFontSizeBox().setValue(h)}}});this.defineProp("color",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getColorBox()?this.getColorBox().getValue():undefined},setter:function(h){if(this.getColorBox()){this.getColorBox().setValue(h)}}});this.defineProp("textDirection",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextDirectionButtonSet())},setter:function(h){this._setButtonSetLinkedValue(this.getTextDirectionButtonSet(),h)}});this.defineProp("textHorizontalAlign",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet())},setter:function(h){this._setButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet(),h)}});this.defineProp("textVerticalAlign",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextVerticalAlignButtonSet())},setter:function(h){this._setButtonSetLinkedValue(this.getTextVerticalAlignButtonSet(),h)}});this.defineProp("componentNames",{dataType:DataType.ARRAY,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("componentNames");if(!h){h=this.getDefaultComponentNames();this.setPropStoreFieldValue("componentNames",h)}return h},setter:function(h){this.setPropStoreFieldValue("componentNames",h);this.recreateComponents()}})},initPropValues:function($super){$super();this.setShowGlyph(true)},removeWidget:function($super,i,h){if(i===this.getFontNameBox()){this.setPropStoreFieldValue("fontNameBox",null)}if(i===this.getFontSizeBox()){this.setPropStoreFieldValue("fontSizeBox",null)}$super(i,h)},doGetWidgetClassName:function($super){var h=$super()+" "+f.COMPOSER_TOOLBAR+" "+f.COMPOSER_STYLE_TOOLBAR;return h},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},createChildWidgets:function(n){if(!n){n=this.getComponentNames()}for(var m=0,k=n.length;m<k;++m){var h=n[m];if(h===d.fontName){var r=new Kekule.Widget.ComboBox(this);this.fillFontNameBox(r);r.addClassName(f.COMPOSER_FONTNAME_BOX);r.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME"));r.addEventListener("valueChange",function(i){this.applyFontName()},this);this.setPropStoreFieldValue("fontNameBox",r)}else{if(h===d.fontSize){r=new Kekule.Widget.ComboBox(this);this.fillFontSizeBox(r);r.addClassName(f.COMPOSER_FONTSIZE_BOX);r.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE"));r.addEventListener("valueChange",function(i){this.applyFontSize()},this);this.setPropStoreFieldValue("fontSizeBox",r)}else{if(h===d.color){var p=new Kekule.Widget.ColorDropButton(this);p.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR"));p.setShowText(false);p.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]);p.addClassName(f.COMPOSER_COLOR_BOX);p.addEventListener("valueChange",function(i){this.applyColor()},this);this.setPropStoreFieldValue("colorBox",p)}else{if(h===d.textDirection){var q=Kekule.Render.TextDirection;var o=[{value:q.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT},{value:q.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_LTR},{value:q.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_RTL},{value:q.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_TTB},{value:q.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_BTT}];var j=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION"),f.COMPOSER_TEXTDIRECTION_BUTTON,o);j.addEventListener("select",function(i){this.applyTextDirection()},this);this.setPropStoreFieldValue("textDirectionButtonSet",j)}else{if(h===d.textAlign){var s=Kekule.Render.TextAlign;var o=[{value:s.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:f.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:s.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:f.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:s.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:f.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:s.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:f.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:s.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT"),className:f.COMPOSER_TEXTALIGN_BUTTON_LEFT},{value:s.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT"),className:f.COMPOSER_TEXTALIGN_BUTTON_RIGHT}];var j=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN"),f.COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL,o);j.addEventListener("select",function(i){this.applyTextHorizontalAlign()},this);this.setPropStoreFieldValue("textHorizontalAlignButtonSet",j);var s=Kekule.Render.TextAlign;var o=[{value:s.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:f.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:s.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:f.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:s.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:f.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:s.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:f.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:s.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP"),className:f.COMPOSER_TEXTALIGN_BUTTON_TOP},{value:s.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM"),className:f.COMPOSER_TEXTALIGN_BUTTON_BOTTOM}];var j=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN"),f.COMPOSER_TEXTALIGN_BUTTON_VERTICAL,o);j.addEventListener("select",function(i){this.applyTextVerticalAlign()},this);this.setPropStoreFieldValue("textVerticalAlignButtonSet",j)}}}}}}this.updateStyleValues()},_createStyleButtonSet:function(r,n,p,q){var j=new Kekule.Widget.CompactButtonSet(this);j.setText(r);j.setHint(n);j.addClassName(p);j.setShowText(false);j.setShowCompactMark(false);j.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);j.getButtonSet().addClassName(f.COMPOSER_STYLE_TOOLBAR);j.getButtonSet().setShowText(true);if(q){for(var o=0,m=q.length;o<m;++o){var k=q[o];var h=new Kekule.Widget.RadioButton(j,k.text||"");h.setHint(k.hint||"");h.addClassName(k.className);h[this.LINKED_VALUE_FIELD]=k.value;j.append(h,k.selected)}}return j},_getButtonSetLinkedValue:function(h){var i=h?h.getSelected():null;return i?i[this.LINKED_VALUE_FIELD]:undefined},_setButtonSetLinkedValue:function(j,n){if(j){var o=j.getButtonSet();var m=o.getChildWidgets();j.setSelected(null);for(var k=0,h=m.length;k<h;++k){var p=m[k];if(p.hasOwnProperty(this.LINKED_VALUE_FIELD)){if(p[this.LINKED_VALUE_FIELD]==n){j.setSelected(p);break}}}}},getDefaultComponentNames:function(){return Kekule.globalOptions.chemWidget.composer.styleToolComponentNames},recreateComponents:function(){var h=this.getComponentNames();this.clearWidgets();this.createChildWidgets(h)},fillFontSizeBox:function(n){var m=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes();var j=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:undefined}];for(var k=0,h=m.length;k<h;++k){j.push({text:m[k]+" px",value:m[k]})}n.setItems(j)},fillFontNameBox:function(n){var m=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames();var j=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}];for(var k=0,h=m.length;k<h;++k){j.push({text:m[k],value:m[k]})}n.setItems(j)},applyStyle:function(h,j,k){this._isApplying=true;try{var i=this.getEditor();i.modifyObjectsRenderOptions(h,j,k,true)}finally{this._isApplying=false}},getStyleValue:function(h,j,i){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(h,j,i)},applyStyleToEditorSelection:function(h,i){var j=this.getEditor().getSelection();if(j&&j.length){return this.applyStyle(j,h,i)}},applyFontName:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getFontName();this.applyStyle(i,{fontFamily:h})}},applyFontSize:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getFontSize();this.applyStyle(i,{fontSize:h})}},applyColor:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getColor();if(h===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value){this.applyStyle(i,{useAtomSpecifiedColor:true,color:undefined})}else{if(h==Kekule.Widget.ColorPicker.SpecialColors.UNSET){h=undefined}this.applyStyle(i,{useAtomSpecifiedColor:false,color:h})}}},applyTextDirection:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getTextDirection();this.applyStyle(i,{charDirection:h})}},applyTextHorizontalAlign:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getTextHorizontalAlign();this.applyStyle(i,{horizontalAlign:h})}},applyTextVerticalAlign:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getTextVerticalAlign();this.applyStyle(i,{verticalAlign:h})}},updateStyleValues:function(h){if(!h){h=this.getEditor().getSelection()}if(h&&h.length){this.updateFontName(h);this.updateFontSize(h);this.updateColor(h);this.updateTextDirection(h);this.updateTextHorizontalAlign(h);this.updateTextVerticalAlign(h)}},updateFontName:function(i){if(i&&i.length&&this.getFontNameBox()){var h=this.getStyleValue(i,"fontFamily");this.setFontName(h||"")}},updateFontSize:function(i){if(i&&i.length&&this.getFontSizeBox()){var h=this.getStyleValue(i,"fontSize");this.setFontSize(h||undefined)}},updateColor:function(j){if(j&&j.length&&this.getColorBox()){var h;var i=this.getStyleValue(j,"useAtomSpecifiedColor");var h=this.getStyleValue(j,"color");this.getColorBox().setColorClassName(null);if(h){this.getColorBox().setColorClassName(null)}else{if(i){h=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value;this.getColorBox().setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className)}}this.setColor(h||undefined)}},updateTextDirection:function(i){if(i&&i.length&&this.getTextDirectionButtonSet()){var h=this.getStyleValue(i,"charDirection");this.setTextDirection(h)}},updateTextHorizontalAlign:function(i){if(i&&i.length&&this.getTextHorizontalAlignButtonSet()){var h=this.getStyleValue(i,"horizontalAlign");this.setTextHorizontalAlign(h)}},updateTextVerticalAlign:function(i){if(i&&i.length&&this.getTextVerticalAlignButtonSet()){var h=this.getStyleValue(i,"verticalAlign");this.setTextVerticalAlign(h)}},updateState:function(){var i=this.getEditor();var h=(i&&i.hasSelection());if(this.getFontNameBox()){this.getFontNameBox().setEnabled(h)}if(this.getFontSizeBox()){this.getFontSizeBox().setEnabled(h)}if(this.getColorBox()){this.getColorBox().setEnabled(h)}if(this.getTextDirectionButtonSet()){this.getTextDirectionButtonSet().setEnabled(h)}if(this.getTextHorizontalAlignButtonSet()){this.getTextHorizontalAlignButtonSet().setEnabled(h)}if(this.getTextVerticalAlignButtonSet()){this.getTextVerticalAlignButtonSet().setEnabled(h)}}});Kekule.Editor.Composer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.Composer",BINDABLE_TAG_NAMES:["div"],CHEM_TOOL_CHILD_FIELDS:"__$children__",initialize:function($super,h,i){this.updateStyleToolbarStateBind=this.updateStyleToolbarState.bind(this);this.setPropStoreFieldValue("enableStyleToolbar",true);this.setPropStoreFieldValue("editor",i);this.setPropStoreFieldValue("editorNexus",new Kekule.Editor.EditorNexus());$super(h);this.bindEditor(i);if(!this.getCommonBtnGroup()){this.createCommonToolbar()}if(!this.getChemBtnGroup()){this.createChemToolbar()}if(!this.getZoomBtnGroup()){this.createZoomToolbar()}this.uiLayoutChanged()},doFinalize:function($super){var h=this.getCommonBtnGroup();if(h){h.finalize()}var h=this.getChemBtnGroup();if(h){h.finalize()}var i=this.getPropStoreFieldValue("editor");if(i){i.finalize()}this.getEditorNexus().finalize();$super()},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("editor");if(!h){h=this.createDefaultEditor();this.setPropStoreFieldValue("editor",h)}return h}});this.defineProp("showInspector",{dataType:DataType.BOOL,setter:function(h){if(this.getShowInspector()!==h){this.setPropStoreFieldValue("showInspector",h);this.showInspectorChanged()}}});this.defineProp("editorStageElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("advPanelElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("editorNexus",{dataType:"Kekule.Editor.EditorNexus",serializable:false,setter:null});this.defineProp("objInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:false,setter:null});this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:false,setter:null});this.defineProp("commonBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("zoomBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("chemBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("assocBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("styleToolbar",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,getter:function(){var h=this.getPropStoreFieldValue("styleToolbar");if(!h){if(this.getEnableStyleToolbar()){h=this.createStyleToolbar();this.setPropStoreFieldValue("styleToolbar",h)}}return h}});this.defineProp("styleToolComponentNames",{dataType:DataType.ARRAY,serializable:false,getter:function(){var h=this.getStyleToolbar();return h?h.getComponentNames():null},setter:function(i){var h=this.getStyleToolbar();if(h){h.setComponentNames(i)}return this}});this.defineProp("enableStyleToolbar",{dataType:DataType.BOOL,setter:function(h){this.setPropStoreFieldValue("enableStyleToolbar",h);this.updateStyleToolbarState()}});this.defineProp("commonToolButtons",{dataType:DataType.HASH,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("commonToolButtons");if(!h){h=this.getDefaultCommonToolBarButtons();this.setPropStoreFieldValue("commonToolButtons",h)}return h},setter:function(h){this.setPropStoreFieldValue("commonToolButtons",h);this.updateCommonToolbar();this.updateZoomToolbar()}});this.defineProp("chemToolButtons",{dataType:DataType.HASH,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("chemToolButtons");if(!h){h=this.getDefaultChemToolBarButtons();this.setPropStoreFieldValue("chemToolButtons",h)}return h},setter:function(h){this.setPropStoreFieldValue("chemToolButtons",h);this.updateChemToolbar()}});this.defineProp("styleBarComponents",{dataType:DataType.ARRAY,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("styleBarComponents");if(!h){h=null;this.setPropStoreFieldValue("styleBarComponents",h)}return h},setter:function(h){this.setPropStoreFieldValue("styleBarComponents",h);if(this.getStyleToolbar()){this.getStyleToolbar().setComponentNames(h)}}});this.defineProp("commonActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("commonActions");if(!h){h=new Kekule.ActionList();this.setPropStoreFieldValue("commonActions",h)}return h}});this.defineProp("zoomActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("zoomActions");if(!h){h=new Kekule.ActionList();this.setPropStoreFieldValue("zoomActions",h)}return h}});this.defineProp("chemActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("chemActions");if(!h){h=new Kekule.ActionList();this.setPropStoreFieldValue("chemActions",h)}return h}});this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("actionMap");if(!h){h=new Kekule.MapEx();this.setPropStoreFieldValue("actionMap",h)}return h}});this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,getter:function(){var h=this.getEditor();return(h&&h.getAllowCreateNewChild)?h.getAllowCreateNewChild():null},setter:function(i){var h=this.getEditor();if(h.setAllowCreateNewChild){h.setAllowCreateNewChild(i)}return this}});this._defineEditorDelegatedProp("chemObj");this._defineEditorDelegatedProp("chemObjLoaded");this._defineEditorDelegatedProp("renderType");this._defineEditorDelegatedProp("renderConfigs");this._defineEditorDelegatedProp("drawOptions");this._defineEditorDelegatedProp("allowCoordBorrow");this._defineEditorDelegatedProp("editorConfigs");this._defineEditorDelegatedProp("operHistory");this._defineEditorDelegatedProp("enableOperHistory");this._defineEditorDelegatedProp("selection");this._defineEditorDelegatedProp("hotTrackedObjs");this._defineEditorDelegatedProp("enableOperContext");this._defineEditorDelegatedProp("enableCreateNewDoc");this._defineEditorDelegatedProp("enableLoadNewFile");this._defineEditorDelegatedProp("initOnNewDoc")},_defineEditorDelegatedProp:function(k,h){if(!h){h=k}var j=ClassEx.getPropInfo(Kekule.Editor.BaseEditor,h);var i=Object.create(j);i.getter=null;i.setter=null;if(j.getter){i.getter=function(){return this.getEditor().getPropValue(h)}}if(j.setter){i.setter=function(l){this.getEditor().setPropValue(h,l)}}return this.defineProp(k,i)},loadPredefinedResDataToProp:function(i,h,k){if(i==="chemObj"){if(k){try{var l=Kekule.IO.loadTypedData(h.data,h.resType,h.resUri);this.setChemObj(l)}catch(j){Kekule.raise(j,Kekule.ExceptionLevel.ERROR)}}else{Kekule.throwException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+h.resUri||"")}}},initPropValues:function($super){$super()},doCreateRootElement:function(i){var h=i.createElement("div");return h},doCreateSubElements:function(k,i){var h=[];var j=k.createElement("div");j.className=f.COMPOSER_EDITOR_STAGE;i.appendChild(j);this.setPropStoreFieldValue("editorStageElem",j);h.push(j);var j=k.createElement("div");j.className=f.COMPOSER_ADV_PANEL;i.appendChild(j);this.setPropStoreFieldValue("advPanelElem",j);h.push(j);return h},doGetWidgetClassName:function($super){var h=$super()+" "+f.COMPOSER;return h},doWidgetShowStateChanged:function($super,h){$super(h);if(h){this.adjustComponentPositions()}},getResizerElement:function(){return this.getEditorStageElem()},getChildActionClass:function($super,i,j){var h=$super(i,j);if(!h){h=this.getEditor().getChildActionClass(i,j)}return h},getCoordMode:function(){return this.getEditor().getCoordMode()},isDirty:function(){return this.getEditor().isDirty()},newDoc:function(){return this.getEditor().newDoc()},load:function(h){return this.getEditor().load(h)},getSavingTargetObj:function(){var h=this.getEditor();if(h){return h.getSavingTargetObj()}else{return null}},getExportableClasses:function(){return this.getEditor().getExportableClasses()},exportObj:function(h){return this.getEditor().exportObj(h)},exportObjs:function(h){return this.getEditor().exportObjs(h)},undo:function(){return this.getEditor().undo()},redo:function(){return this.getEditor().redo()},undoAll:function(){return this.getEditor().undoAll()},canUndo:function(){return this.getEditor().canUndo()},canRedo:function(){return this.getEditor().canRedo()},uiLayoutChanged:function(){this.adjustComponentPositions()},adjustComponentPositions:function(){var n=this.getCommonBtnGroup()?this.getCommonBtnGroup().getElement():null;var j=this.getZoomBtnGroup()?this.getZoomBtnGroup().getElement():null;var o=this.getChemBtnGroup()?this.getChemBtnGroup().getElement():null;if(!n||!o){return}if(n){var r=Kekule.HtmlElementUtils.getElemBoundingClientRect(n)}if(j){var u=Kekule.HtmlElementUtils.getElemBoundingClientRect(j)}if(o){var k=Kekule.HtmlElementUtils.getElemBoundingClientRect(o)}if(!r.width||!k.width){return}var i=n.style;i.top="0px";i.left=k.width+"px";i=o.style;i.top=r.height+"px";i.left="0px";var q,m,t,h;var p=r;q=p.height;var p=k;m=p.width;var h=u?u.height:0;if(!this.getShowInspector()){t=0}else{var l=this.getAdvPanelElem();var p=Kekule.HtmlElementUtils.getElemBoundingClientRect(l);t=p.width}var s=this.getEditorStageElem();var i=s.style;i.position="absolute";i.top=q+"px";i.left=m+"px";i.bottom=h+"px";i.right=t+"px";l=this.getAdvPanelElem();i=l.style;i.position="absolute";i.top=q+"px";i.bottom=h+"px"},adjustAssocToolbarPositions:function(){var j=this.getChemBtnGroup().getElement();var h=Kekule.HtmlElementUtils.getElemBoundingClientRect(j);if(this.isAssocToolbarShown()){var i=this.getAssocBtnGroup().getElement();i.style.left=h.width+"px"}if(this.isStyleToolbarShown()){var i=this.getStyleToolbar().getElement();i.style.left=h.width+"px"}},bindEditor:function(k){if(!k){k=this.getEditor()}else{k.setParent(this)}var i=this;var h=this.getCommonActions();var j=this.getChemActions();this.createIaControllers(k);k.addEventListener("load",function(m){this.updateAllActions();this.updateUiWidgets();var n=this.getChemActions();var l=n.getActionAt(0);if(l){l.execute()}},this);k.addEventListener("operChange",function(l){h.updateAll();this.updateUiWidgets()},this);k.addEventListener("selectionChange",function(l){h.updateAll();this.updateUiWidgets()},this);k.appendToElem(this.getEditorStageElem());this.getEditorNexus().setEditor(k)},createDefaultEditor:function(){var h=new Kekule.Editor.ChemSpaceEditor(this,null,Kekule.Render.RendererType.R2D);h.addClassName(b.DYN_CREATED);return h},createIaControllers:function(n){var m=Kekule.Editor.IaControllerManager.getAvailableControllerClasses(n.getClass());for(var k=0,j=m.length;k<j;++k){var o=m[k];var h=new o(n);n.addIaController(h.getDefId(),h)}},showInspectorChanged:function(){var h=this.getShowInspector();if(h){if(!this.getObjInspector()){this.createAdvControls()}this.showAdvPanel()}else{this.hideAdvPanel()}this.uiLayoutChanged()},createAdvControls:function(h){if(!h){h=this.getAdvPanelElem()}var k=this.getDocument();var i=new Kekule.ChemWidget.StructureTreeView(k);i.setItemInitialExpanded(true);i.appendToElem(h);this.setPropStoreFieldValue("structureTreeView",i);var l=new Kekule.Widget.ObjectInspector(k);l.setShowPropInfoPanel(false);l.appendToElem(h);this.setPropStoreFieldValue("objInspector",l);var j=this.getEditorNexus();j.setObjectInspector(l);j.setStructureTreeView(i)},showAdvPanel:function(){this.getAdvPanelElem().style.display="block"},hideAdvPanel:function(){this.getAdvPanelElem().style.display="none"},getDefaultCommonToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.commonToolButtons},getZoomButtonNames:function(){return[d.zoomIn,d.zoomOut,d.reset]},getDefaultChemToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.chemToolButtons},getCompActionClass:function(h){return this.getChildActionClass(h,true)},_getActionTargetWidget:function(h){if(ClassEx.isOrIsDescendantOf(h,Kekule.Editor.ActionOnComposer)||ClassEx.isOrIsDescendantOf(h,Kekule.Widget.ActionOpenConfigWidget)){return this}else{return this.getEditor()}},createToolButton:function(p,n,k,o){var q=null;var i=DataType.isObjectValue(p)?p.name:p;var l=this.getCompActionClass(i);var j=this._createToolButtonAction(p,k,o);if(DataType.isObjectValue(p)&&!l){if(!l){var m=Object.extend({widget:Kekule.Widget.Button},p)}q=Kekule.Widget.Utils.createFromHash(n,m)}else{var h=(p===d.objInspector)?Kekule.Widget.CheckButton:(!!o)?Kekule.Widget.RadioButton:Kekule.Widget.Button;q=new h(n)}if(j){q.setAction(j)}},_createToolButtonAction:function(u,A,y){var q=null;var B=DataType.isObjectValue(u)?u.name:u;var n=DataType.isObjectValue(u)?u.attached:null;var j=this.getCompActionClass(B);var q;if(DataType.isObjectValue(u)&&!j){var m=u;var j=m.actionClass;if(j){if(typeof(j)==="string"){j=ClassEx.findClass(m.actionClass)}}}if(j){var h=this.getActionMap();var q=h.get(j);if(!q){var q=new j(this._getActionTargetWidget(j));h.set(j,q)}if(y){q.setCheckGroup(y)}if(q&&A){A.add(q)}if(q&&q.addAttachedAction){var x=q.getClassName();var z=Kekule.ArrayUtils.clone(q.getAttachedActions().getActions()||[]);var k=function(D,C,i,l){if(!C){return null}var E=i.indexOf(C);if(E>=0){i[E]=null}else{D.addAttachedAction(C,l)}};if(n){for(var w=0,v=n.length;w<v;++w){var p=n[w];var o=this._createToolButtonAction(p,null,x);k(q,o,z,w===0)}}else{var s=q.getAttachedActionClasses();if(s){for(var w=0,v=s.length;w<v;++w){var t=s[w];var o=h.get(t);if(!o){o=new t(this._getActionTargetWidget(t));o.setCheckGroup(x);h.set(t,o)}k(q,o,z,w===0)}}}if(z.length){for(var w=0,v=z.length;w<v;++w){var r=z[w];if(r){q.removeAttachedAction(r);h.remove(r.getClass());console.log("remove action",r.getClassName(),r.getAttachedActions().getActions())}}}}}return q},createInnerToolbar:function(){var h=new Kekule.Widget.ButtonGroup(this);h.addClassName(f.COMPOSER_TOOLBAR);h.addClassName(f.INNER_TOOLBAR);h.addClassName(b.DYN_CREATED);h.setShowText(false);h.doSetShowGlyph(true);h.appendToElem(this.getElement());return h},createCommonToolbar:function(){var p=this.createInnerToolbar();p.addClassName(f.COMPOSER_COMMON_TOOLBAR);var o=this.getCommonToolButtons();o=Kekule.ArrayUtils.exclude(o,this.getZoomButtonNames());var q=this.getCommonActions();var n=this.getEditor();q.clear();for(var m=0,h=o.length;m<h;++m){var j=o[m];var k=this.createToolButton(j,p,q)}this.setCommonBtnGroup(p);p.addClassName(b.DYN_CREATED);this.updateZoomToolbar();this.adjustComponentPositions();return p},createZoomToolbar:function(){var p=Kekule.ArrayUtils.intersect(this.getCommonToolButtons(),this.getZoomButtonNames());if(p.length){var o=this.createInnerToolbar();o.addClassName(f.COMPOSER_ZOOM_TOOLBAR);var q=this.getZoomActions();var n=this.getEditor();q.clear();for(var m=0,h=p.length;m<h;++m){var j=p[m];var k=this.createToolButton(j,o,q)}this.setZoomBtnGroup(o);o.addClassName(b.DYN_CREATED);this.adjustComponentPositions();return o}else{this.setZoomBtnGroup(null);return null}},updateCommonToolbar:function(){var h=this.getCommonBtnGroup();if(h){h.finalize()}this.createCommonToolbar()},updateZoomToolbar:function(){var h=this.getZoomBtnGroup();if(h){h.finalize()}this.createZoomToolbar()},createChemToolbar:function(){var p=this.createInnerToolbar();p.addClassName(f.COMPOSER_CHEM_TOOLBAR);p.setLayout(Kekule.Widget.Layout.VERTICAL);var o=this.getChemToolButtons();var q=this.getChemActions();q.clear();var n="chemTools";for(var m=0,h=o.length;m<h;++m){var j=o[m];var k=this.createToolButton(j,p,q,n)}this.setChemBtnGroup(p);p.addClassName(b.DYN_CREATED);this.bindAssocActions(null);this.adjustComponentPositions();return p},updateChemToolbar:function(){var h=this.getChemBtnGroup();if(h){h.finalize()}this.createChemToolbar()},createAssocToolbar:function(){var h=this.createInnerToolbar();h.addClassName(f.COMPOSER_ASSOC_TOOLBAR);this.setAssocBtnGroup(h);this.adjustAssocToolbarPositions();h.addClassName(b.DYN_CREATED);return h},showAssocToolbar:function(){var i=this.getAssocBtnGroup();if(!i){i=this.createAssocToolbar()}var h=this;i.show(null,function(){h.uiLayoutChanged();setTimeout(h.updateStyleToolbarStateBind,0)});return this},hideAssocToolbar:function(){var i=this.getAssocBtnGroup();if(i){var h=this;i.hide(null,function(){h.uiLayoutChanged();setTimeout(h.updateStyleToolbarStateBind,0)})}return this},isAssocToolbarShown:function(){var h=this.getAssocBtnGroup();return h&&h.isShown()},bindAssocActions:function(q){var n=this.getAssocBtnGroup();if(!n){n=this.createAssocToolbar()}n.clearWidgets();if(q){for(var k=0,h=q.getActionCount();k<h;++k){var o=q.getActionAt(k);var m=o.getCheckGroup();var p=(!!m)?Kekule.Widget.RadioButton:Kekule.Widget.Button;var j=new p(n);j.setAction(o)}}},createStyleToolbar:function(){if(this.getEnableStyleToolbar()){var h=new Kekule.Editor.ComposerStyleToolbar(this);h.setComponentNames(this.getStyleBarComponents());this.setStyleToolbar(h);this.adjustAssocToolbarPositions();this.updateStyleToolbarState();return h}else{return null}},showStyleToolbar:function(){if(this.getEnableStyleToolbar()){var i=this.getStyleToolbar();if(!i.isShown()){var h=this;i.show(null,function(){h.uiLayoutChanged()})}}return this},hideStyleToolbar:function(){var i=this.getPropStoreFieldValue("styleToolbar");if(i){if(i.isShown()){var h=this;i.hide(null,function(){h.uiLayoutChanged()})}}return this},isStyleToolbarShown:function(){var h=this.getPropStoreFieldValue("styleToolbar");return(h&&h.isShown())},needShowStyleToolbar:function(){var h=this.getEditor();return h&&h.hasSelection()&&(!this.isAssocToolbarShown())},updateStyleToolbarState:function(){if(this.getEnableStyleToolbar()&&this.needShowStyleToolbar()){this.showStyleToolbar();this.getStyleToolbar().updateState()}else{this.hideStyleToolbar()}},updateAllActions:function(){this.getCommonActions().updateAll();this.getZoomActions().updateAll();this.getChemActions().updateAll()},updateUiWidgets:function(){this.updateStyleToolbarState()},createConfigurator:function($super){var h=$super();h.addEventListener("configChange",function(i){this.getEditor().repaint()},this);return h}});Kekule.Editor.Composer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.Editor.Composer.Settings",initialize:function($super,h){$super(h)},initProperties:function(){this.defineDelegatedProps(["enableCreateNewDoc","enableLoadNewFile","initOnNewDoc","enableOperHistory","allowCreateNewChild","enableStyleToolbar"])}});Kekule.Editor.Composer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.Editor.Composer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function($super,h){$super(h)},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function($super){var w=$super();var h=this.getComposer();var t=h.getEditor();var p=[t.getDisplayerConfigs(),t.getRenderConfigs()];for(var q=0,o=p.length;q<o;++q){var m=p[q];var v=m.getPropListOfScopes([Class.PropertyScope.PUBLISHED]);for(var s=0,n=v.getLength();s<n;++s){var u=v.getPropInfoAt(s);var r=m.getPropValue(u.name);if(r){w.push({obj:r,name:u.name,title:u.title,description:u.description})}}}return w},getComposer:function(){return this.getWidget()},getEditor:function(){return this.getComposer().getEditor()}});var a=Kekule.ObjPropSettingManager;a.register("Kekule.Editor.Composer.fullFunc",{enableStyleToolbar:true,enableOperHistory:true,enableLoadNewFile:true,enableCreateNewDoc:true,allowCreateNewChild:true,commonToolButtons:null,chemToolButtons:null,styleToolComponentNames:null});a.register("Kekule.Editor.Composer.molOnly",{enableStyleToolbar:true,enableOperHistor:true,enableLoadNewFile:true,enableCreateNewDoc:true,allowCreateNewChild:true,commonToolButtons:null,chemToolButtons:[d.manipulate,d.erase,d.molBond,d.molAtom,d.molFormula,d.molRing,d.molCharge],styleToolComponentNames:null});a.register("Kekule.Editor.Composer.compact",{enableStyleToolbar:false,commonToolButtons:[d.newDoc,d.loadData,d.saveData,d.undo,d.redo],chemToolButtons:null,styleToolComponentNames:null});a.register("Kekule.Editor.Composer.singleObj",{allowCreateNewChild:false});Kekule.Editor.ComposerDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.Editor.ComposerDialog",initialize:function($super,h,i,j){$super(h,i,j||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false,setter:null});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,getter:function(){var h=this.getComposer();return h&&h.getChemObj()},setter:function(h){var i=this.getComposer();if(i){i.setChemObj(h)}}})},initPropValues:function($super){$super()},doGetWidgetClassName:function($super){return $super()+" "+f.COMPOSER_DIALOG},doCreateClientContents:function($super,i){$super();var h=this.doCreateComposerWidget();this.setPropStoreFieldValue("composer",h);h.appendToElem(i)},getSavingTargetObj:function(){var h=this.getComposer();if(h){return h.getSavingTargetObj()}else{return null}},doCreateComposerWidget:function(){var h=new Kekule.Editor.Composer(this);h.addClassName(b.DYN_CREATED);if(h.setResizable){h.setResizable(true)}var i=h.getEditor();i.addClassName(b.DYN_CREATED);return h}})})();(function(){var a=Kekule.ArrayUtils;var c=Kekule.ChemWidget.ComponentWidgetNames;var e=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ActionManager;var b=[];Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{ACTION_UNDO:"K-Chem-Undo",ACTION_REDO:"K-Chem-Redo",ACTION_NEWDOC:"K-Chem-NewDoc",ACTION_CLONE_SELECTION:"K-Chem-Clone-Selection",ACTION_COPY:"K-Chem-Copy",ACTION_CUT:"K-Chem-Cut",ACTION_PASTE:"K-Chem-Paste",ACTION_TOGGLE_INSPECTOR:"K-Chem-Toggle-Inspector"});Object.extend(Kekule.ChemWidget.ComponentWidgetNames,{molBondSingle:"bondSingle",molBondDouble:"bondDouble",molBondTriple:"bondTriple",molBondCloser:"bondCloser",molBondWedgeUp:"bondWedgeUp",molBondWedgeDown:"bondWedgeDown",molBondWedgeUpOrDown:"bondWedgeUpOrDown",molBondDoubleEither:"bondDoubleEither",molChargeClear:"chargeClear",molChargePositive:"chargePositive",molChargeNegative:"chargeNegative",molRadicalSinglet:"radicalSinglet",molRadicalTriplet:"radicalTriplet",molRadicalDoublet:"radicalDoublet",molRing3:"ring3",molRing4:"ring4",molRing5:"ring5",molRing6:"ring6",molRing7:"ring7",molRing8:"ring8",molRingAr6:"ringAr6",molRingAr5:"ringAr5",molRepCyclopentaneHaworth1:"repCyclopentaneHaworth1",molRepCyclopentaneHaworth2:"repCyclopentaneHaworth2",molRepCyclohexaneHaworth1:"repCyclohexaneHaworth1",molRepCyclohexaneHaworth2:"repCyclohexaneHaworth2",molRepCyclohexaneChair1:"repCyclohexaneChair1",molRepCyclohexaneChair2:"repCyclohexaneChair2",molRepSubBondMark:"subBondMark",molRepMethane:"methane",molRepFischer1:"repFischer1",molRepFischer2:"repFischer2",molRepFischer3:"repFischer3",molRepSawhorseStaggered:"repSawhorseStaggered",molRepSawhorseEclipsed:"repSawhorseEclipsed",glyphRepLine:"repLine",glyphRepOpenArrowLine:"repOpenArrowLine",glyphRepTriangleArrowLine:"repTriangleArrowLine",glyphRepDiOpenArrowLine:"repDiOpenArrowLine",glyphRepDiTriangleArrowLine:"repDiTriangleArrowLine",glyphRepReversibleArrowLine:"repReversibleArrowLine",glyphRepOpenArrowDiLine:"repOpenArrowDiLine",glyphRepHeatSymbol:"repHeatSymbol",glyphRepAddSymbol:"repAddSymbol"});Kekule.Editor.ActionOperUtils={addObjectsToChemSpaceEditor:function(p,n,f){var g=p.getChemSpace&&p.getChemSpace();if(p&&g&&p.canAddNewStandaloneObject&&p.canAddNewStandaloneObject()){p.beginUpdateObject();try{var r=new Kekule.MacroOperation();for(var m=0,j=n.length;m<j;++m){var k=n[m];var h=new Kekule.ChemObjOperation.Add(n[m],g);r.add(h)}r.execute();if(f){for(var m=0,j=n.length;m<j;++m){var k=n[m];var o=p.getObjectScreenCoord(k);var q=Kekule.CoordUtils.add(o,f);p.setObjectScreenCoord(k,q)}}p.pushOperation(r);p.select(n)}finally{p.endUpdateObject()}}}};Kekule.Editor.ActionOnEditor=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.Editor.ActionOnEditor",initialize:function($super,g,f,h){$super(g,f,h)},doUpdate:function(){var f=this.getDisplayer();this.setEnabled(f&&f.getChemObj()&&f.getChemObjLoaded()&&f.getEnabled())},getEditor:function(){var f=this.getDisplayer();return(f instanceof Kekule.Editor.BaseEditor)?f:null}});Kekule.Editor.ActionEditorUndo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorUndo",HTML_CLASSNAME:e.ACTION_UNDO,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_UNDO"),Kekule.$L("ChemWidgetTexts.HINT_UNDO"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().canUndo())}},doExecute:function(){var f=this.getEditor();if(f){f.undo()}}});Kekule.Editor.ActionEditorRedo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorRedo",HTML_CLASSNAME:e.ACTION_REDO,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_REDO"),Kekule.$L("ChemWidgetTexts.HINT_REDO"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().canRedo())}},doExecute:function(){var f=this.getEditor();if(f){f.redo()}}});Kekule.Editor.ActionEditorNewDoc=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorNewDoc",HTML_CLASSNAME:e.ACTION_NEWDOC,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_NEWDOC"),Kekule.$L("ChemWidgetTexts.HINT_NEWDOC"))},doUpdate:function(){var f=this.getDisplayer();this.setEnabled(f&&f.getEnabled()&&f.getEnableCreateNewDoc())},doExecute:function(){var f=this.getEditor();if(f){f.newDoc()}}});Kekule.Editor.ActionCloneSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCloneSelection",HTML_CLASSNAME:e.ACTION_CLONE_SELECTION,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_CLONESELECTION"),Kekule.$L("ChemWidgetTexts.HINT_CLONE_SELECTION"))},_hasCloneMethod:function(){var f=this.getEditor();return f&&f.cloneSelection},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this._hasCloneMethod()&&this.getEditor().hasSelection())}this.setDisplayed(this._hasCloneMethod()&&this.getEditor().canCloneObjects())},doExecute:function(){var f=this.getEditor();if(f&&f.getChemSpace){var g=f.getDefaultCloneScreenCoordOffset&&f.getDefaultCloneScreenCoordOffset();var h=f.cloneSelection();Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(f,h,g)}}});Kekule.Editor.ActionCopySelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCopySelection",HTML_CLASSNAME:e.ACTION_COPY,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_COPY"),Kekule.$L("ChemWidgetTexts.HINT_COPY"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().hasSelection())}},doExecute:function(){var f=this.getEditor();var g=f.getChemSpace&&f.getChemSpace();if(f&&g){var h=f.cloneSelection();Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,h)}}});Kekule.Editor.ActionCutSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCutSelection",HTML_CLASSNAME:e.ACTION_CUT,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_CUT"),Kekule.$L("ChemWidgetTexts.HINT_CUT"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().hasSelection())}},doExecute:function(){var g=this.getEditor();var h=g.getChemSpace&&g.getChemSpace();if(g&&h){var i=g.cloneSelection();Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,i);var f=g.getIaController("BasicMolEraserIaController");if(f){f.removeSelection()}}}});Kekule.Editor.ActionPaste=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionPaste",HTML_CLASSNAME:e.ACTION_PASTE,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_PASTE"),Kekule.$L("ChemWidgetTexts.HINT_PASTE"));Kekule.Widget.clipboard.addEventListener("setData",this._reactClipboardChange,this)},finalize:function($super){Kekule.Widget.clipboard.removeEventListener("setData",this._reactClipboardChange,this);$super()},_reactClipboardChange:function(){this.update()},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(Kekule.Widget.clipboard.hasData(Kekule.IO.MimeType.JSON)&&this.getEditor().canAddNewStandaloneObject())}},getObjsCenterScreenCoord:function(m,o){var h=Kekule.BoxUtils;var r=Kekule.CoordUtils;var f=null;for(var j=0,g=o.length;j<g;++j){var k=Kekule.Render.ObjUtils.getContainerBox(o[j],m.getCoordMode(),m.getAllowCoordBorrow());if(!f){f=k}else{f=h.getContainerBox(k,f)}}var n=h.getMinMaxCoords(f);var q={min:m.objCoordToScreen(n.min),max:m.objCoordToScreen(n.max)};var p=r.add(q.min,q.max);var p=r.divide(p,2);return p},doExecute:function(){var i=this.getEditor();if(i&&i.getChemSpace){var l=Kekule.Widget.clipboard.getObjects(Kekule.IO.MimeType.JSON);var k=null;var m=i.getSelection();if(m&&m.length){k=i.getDefaultCloneScreenCoordOffset?i.getDefaultCloneScreenCoordOffset():null;var j=a.clone(m);if(j&&j.length&&k){var g=this.getObjsCenterScreenCoord(i,j);var h=this.getObjsCenterScreenCoord(i,l);var f=Kekule.CoordUtils.substract(g,h);k=Kekule.CoordUtils.add(k,f)}}Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(i,l,k)}}});Kekule.Editor.ActionOnComposer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Editor.ActionOnComposer",initialize:function($super,g,f,h){$super();this.setText(f);this.setHint(h);this.setComposer(g)},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false})},doUpdate:function(){var f=this.getComposer();var g=this.getEditor();this.setEnabled(f&&f.getEnabled()&&g&&g.getChemObj()&&g.getChemObjLoaded()&&g.getEnabled())},getEditor:function(){var f=this.getComposer();return f?f.getEditor():null}});Kekule.Editor.ActionOnComposerAdv=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionOnComposerAdv",initialize:function($super,g,f,i){var h=new Kekule.ActionList();h.setOwnActions(true);this.setPropStoreFieldValue("attachedActions",h);$super(g,f,i)},finalize:function($super){this.getAttachedActions().finalize();$super()},initProperties:function(){this.defineProp("attachedActionClasses",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("attachedActions",{dataType:"Kekule.ActionList",serializable:false,setter:null});this.defineProp("defaultAttachedAction",{dataType:"Kekule.Action",serializable:false})},checkedChanged:function($super){$super();var h=this.getChecked();if(this.hasAttachedActions()){var g=this.getComposer();if(g){if(h){var f=this.getAttachedActions();g.bindAssocActions(f);g.showAssocToolbar();var i=f.getCheckedAction(this.getClassName());if(!i){i=this.getDefaultAttachedAction()}if(i){i.setChecked(false);i.execute()}}else{g.hideAssocToolbar()}}}},hasAttachedActions:function(){return !!this.getAttachedActions().getActionCount()},addAttachedAction:function(g,f){this.getAttachedActions().add(g);if(f){this.setDefaultAttachedAction(g)}return this},removeAttachedAction:function(f){if(this.getDefaultAttachedAction()===f){this.setDefaultAttachedAction(null)}this.getAttachedActions().remove(f);return this},clearAttachedActions:function(){this.setDefaultAttachedAction(null);var f=this.getAttachedActions();f.clear()},doExecute:function(){},update:function($super){$super();this.getAttachedActions().updateAll()}});Kekule.Editor.ActionComposerToggleInspector=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleInspector",HTML_CLASSNAME:e.ACTION_TOGGLE_INSPECTOR,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_INSPECTOR"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_INSPECTOR"))},doUpdate:function(){var f=this.getComposer();if(f){this.setChecked(f.getShowInspector())}},doExecute:function(){var f=this.getComposer();if(f){this.setChecked(!this.getChecked());f.setShowInspector(this.getChecked())}}});Kekule.Editor.ActionComposerSetIaController=Class.create(Kekule.Editor.ActionOnComposerAdv,{CLASS_NAME:"Kekule.Editor.ActionComposerSetIaController",initialize:function($super,g,f,i,h){$super(g,f,i);this.setPropStoreFieldValue("iaControllerId",h)},initProperties:function(){this.defineProp("iaControllerId",{dataType:DataType.STRING,serializable:false,setter:null})},doExecute:function(){this.getEditor().setActiveIaControllerId(this.getIaControllerId())}});Kekule.Editor.createComposerIaControllerActionClass=function(o,p,j,m,l,i,f,g,n,h){if(!l){l=m}if(!l.startsWith(Kekule.ChemWidget.HtmlClassNames.PREFIX)){l=Kekule.ChemWidget.HtmlClassNames.PREFIX+l}var k={CLASS_NAME:o,HTML_CLASSNAME:l,initialize:function($super,r){$super(r,p,j,m);if(this.initAttachedActions){this.initAttachedActions()}}};if(i){k.doExecute=function($super){var s=this.getEditor();var r=s.getIaController(m);if(r){r.setPropValues(i)}$super()}}if(g){k=Object.extend(k,g)}if(f){k.initAttachedActions=function(){this.setPropStoreFieldValue("attachedActionClasses",f)}}var q=Class.create(Kekule.Editor.ActionComposerSetIaController,k);if(n){b.push({name:n,actionClass:q,widgetClass:h})}return q};Kekule.Editor.ActionComposerSetManipulateController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateController",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE"),"BasicMolManipulationIaController",null,null,null,null,c.manipulate);Kekule.Editor.ActionComposerSetEraserController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetEraserController",Kekule.$L("ChemWidgetTexts.CAPTION_ERASE"),Kekule.$L("ChemWidgetTexts.HINT_ERASE"),"BasicMolEraserIaController",null,null,null,{doExecute:function($super){$super();var f=this.getEditor();if(f.hasSelection()){f.getActiveIaController().removeSelection()}}},c.erase);Kekule.Editor.ActionComposerSetBondControllerSingle=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerSingle",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),"MolBondIaController","MolBondIaController-Single",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.NONE},null,null,c.molBondSingle);Kekule.Editor.ActionComposerSetBondControllerDouble=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDouble",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),"MolBondIaController","MolBondIaController-Double",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.NONE},null,null,c.molBondDouble);Kekule.Editor.ActionComposerSetBondControllerTriple=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerTriple",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),"MolBondIaController","MolBondIaController-Triple",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.TRIPLE,bondStereo:Kekule.BondStereo.NONE},null,null,c.molBondTriple);Kekule.Editor.ActionComposerSetBondControllerCloser=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerCloser",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),"MolBondIaController","MolBondIaController-Closer",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.CLOSER},null,null,c.molBondCloser);Kekule.Editor.ActionComposerSetBondControllerWedgeUp=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUp",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),"MolBondIaController","MolBondIaController-WedgeUp",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP},null,null,c.molBondWedgeUp);Kekule.Editor.ActionComposerSetBondControllerWedgeDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),"MolBondIaController","MolBondIaController-WedgeDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.DOWN},null,null,c.molBondWedgeDown);Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),"MolBondIaController","MolBondIaController-WedgeUpOrDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP_OR_DOWN},null,null,c.molBondWedgeUpOrDown);Kekule.Editor.ActionComposerSetBondControllerDoubleEither=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDoubleEither",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),"MolBondIaController","MolBondIaController-Double-Either",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.E_OR_Z},null,null,c.molBondDoubleEither);Kekule.Editor.ActionComposerSetRepositoryFischer1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer1",{repItemName:"fischer1"},null,null,c.molRepFischer1);Kekule.Editor.ActionComposerSetRepositoryFischer2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer2",{repItemName:"fischer2"},null,null,c.molRepFischer2);Kekule.Editor.ActionComposerSetRepositoryFischer3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER3"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer3",{repItemName:"fischer3"},null,null,c.molRepFischer3);Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_STAGGERED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_STAGGERED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseStaggered",{repItemName:"sawhorseStaggered"},null,null,c.molRepSawhorseStaggered);Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_ECLIPSED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_ECLIPSED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseEclipsed",{repItemName:"sawhorseEclipsed"},null,null,c.molRepSawhorseEclipsed);Kekule.Editor.ActionComposerSetRepositoryMethaneController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMethaneController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_METHANE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_METHANE"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Methane",{repItemName:"methane"},null,null,c.molRepMethane);Kekule.Editor.ActionComposerSetRepositorySubBondMarkController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySubBondMarkController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SUBBOND_MARK"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SUBBOND_MARK"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SubBondMark",{repItemName:"substituentMark"},null,null,c.molRepSubBondMark);Kekule.Editor.ActionComposerSetBondController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND"),"MolBondIaController",null,null,[Kekule.Editor.ActionComposerSetBondControllerSingle,Kekule.Editor.ActionComposerSetBondControllerDouble,Kekule.Editor.ActionComposerSetBondControllerTriple,Kekule.Editor.ActionComposerSetBondControllerCloser,Kekule.Editor.ActionComposerSetBondControllerWedgeUp,Kekule.Editor.ActionComposerSetBondControllerWedgeDown,Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown,Kekule.Editor.ActionComposerSetBondControllerDoubleEither,Kekule.Editor.ActionComposerSetRepositoryMethaneController,Kekule.Editor.ActionComposerSetRepositoryFischer1Controller,Kekule.Editor.ActionComposerSetRepositoryFischer2Controller,Kekule.Editor.ActionComposerSetRepositoryFischer3Controller,Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController,Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController],null,c.molBond);Kekule.Editor.ActionComposerSetAtomController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM"),"MolAtomIaController",null,null,null,null,c.molAtom);Kekule.Editor.ActionComposerSetFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FORMULA"),"FormulaIaController",null,null,null,null,c.molFormula);Kekule.Editor.ActionComposerSetNodeChargeControllerClear=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerClear",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_CLEAR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_CLEAR"),"MolNodeChargeIaController","MolNodeChargeIaController-Clear",{charge:0,chargeInc:0,radical:Kekule.RadicalOrder.NONE},null,null,c.molChargeClear);Kekule.Editor.ActionComposerSetNodeChargeControllerPositive=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerPositive",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_POSITIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_POSITIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Positive",{charge:null,chargeInc:1,radical:Kekule.RadicalOrder.NONE},null,null,c.molChargePositive);Kekule.Editor.ActionComposerSetNodeChargeControllerNegative=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerNegative",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_NEGATIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_NEGATIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Negative",{charge:null,chargeInc:-1,radical:Kekule.RadicalOrder.NONE},null,null,c.molChargeNegative);Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_SINGLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_SINGLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Singlet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.SINGLET},null,null,c.molRadicalSinglet);Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_TRIPLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_TRIPLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Triplet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.TRIPLET},null,null,c.molRadicalTriplet);Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_DOUBLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_DOUBLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Doublet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.DOUBLET},null,null,c.molRadicalDoublet);Kekule.Editor.ActionComposerSetNodeChargeController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE"),"MolNodeChargeIaController",null,null,[Kekule.Editor.ActionComposerSetNodeChargeControllerClear,Kekule.Editor.ActionComposerSetNodeChargeControllerPositive,Kekule.Editor.ActionComposerSetNodeChargeControllerNegative,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet],null,c.molCharge);Kekule.Editor.ActionComposerSetTextBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_BLOCK"),"TextBlockIaController",null,null,null,null,c.textBlock);Kekule.Editor.ActionComposerSetImageBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetImageBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_IMAGE_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_IMAGE_BLOCK"),"ImageBlockIaController",null,null,null,null,c.imageBlock);Kekule.Editor.ActionComposerSetTextImageController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextImageController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_IMAGE"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_IMAGE"),"TextImageIaController","TextImageIaController",null,[Kekule.Editor.ActionComposerSetTextBlockController,Kekule.Editor.ActionComposerSetImageBlockController],null,c.textImage);Kekule.Editor.ActionComposerSetRepositoryRing3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_3"),"MolRingIaController","MolRingIaController-3",{ringAtomCount:3,isAromatic:false},null,null,c.molRing3);Kekule.Editor.ActionComposerSetRepositoryRing4Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing4Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_4"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_4"),"MolRingIaController","MolRingIaController-4",{ringAtomCount:4,isAromatic:false},null,null,c.molRing4);Kekule.Editor.ActionComposerSetRepositoryRing5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_5"),"MolRingIaController","MolRingIaController-5",{ringAtomCount:5,isAromatic:false},null,null,c.molRing5);Kekule.Editor.ActionComposerSetRepositoryRing6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_6"),"MolRingIaController","MolRingIaController-6",{ringAtomCount:6,isAromatic:false},null,null,c.molRing6);Kekule.Editor.ActionComposerSetRepositoryRing7Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing7Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_7"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_7"),"MolRingIaController","MolRingIaController-7",{ringAtomCount:7,isAromatic:false},null,null,c.molRing7);Kekule.Editor.ActionComposerSetRepositoryRing8Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing8Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_8"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_8"),"MolRingIaController","MolRingIaController-8",{ringAtomCount:8,isAromatic:false},null,null,c.molRing8);Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_6"),"MolRingIaController","MolRingIaController-Ar-6",{ringAtomCount:6,isAromatic:true},null,null,c.molRingAr6);Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_5"),"MolRingIaController","MolRingIaController-Ar-5",{ringAtomCount:5,isAromatic:true},null,null,c.molRingAr5);Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth1",{repItemName:"cyclopentaneHaworth1"},null,null,c.molRepCyclopentaneHaworth1);Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth2",{repItemName:"cyclopentaneHaworth2"},null,null,c.molRepCyclopentaneHaworth2);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth1",{repItemName:"cyclohexaneHaworth1"},null,null,c.molRepCyclohexaneHaworth1);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth2",{repItemName:"cyclohexaneHaworth2"},null,null,c.molRepCyclohexaneHaworth2);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair1",{repItemName:"cyclohexaneChair1"},null,null,c.molRepCyclohexaneChair1);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair2",{repItemName:"cyclohexaneChair2"},null,null,c.molRepCyclohexaneChair2);Kekule.Editor.ActionComposerSetRepositoryRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING"),"MolRingIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryRing3Controller,Kekule.Editor.ActionComposerSetRepositoryRing4Controller,Kekule.Editor.ActionComposerSetRepositoryRing5Controller,Kekule.Editor.ActionComposerSetRepositoryRing6Controller,Kekule.Editor.ActionComposerSetRepositoryRing7Controller,Kekule.Editor.ActionComposerSetRepositoryRing8Controller,Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller,Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller,Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller],null,c.molRing);Kekule.Editor.ActionComposerSetRepositoryPathLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathGlyphLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:null,lineLength:1.5},null,null,c.glyphRepLine);Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepOpenArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-TriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepTriangleArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiOpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepDiOpenArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiTriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.TRIANGLE,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepDiTriangleArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_REV_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-ReversibleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowSide:Kekule.Glyph.ArrowSide.REVERSED,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowSide:Kekule.Glyph.ArrowSide.SINGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5,lineGap:0.1,lineCount:2}},null,null,c.glyphRepReversibleArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowDiLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5,lineGap:0.1,lineCount:2}},null,null,c.glyphRepOpenArrowDiLine);Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_HEAT_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_HEAT_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-HeatSymbol",{glyphClass:Kekule.Glyph.HeatSymbol,glyphInitialParams:{lineLength:1}},null,null,c.glyphRepHeatSymbol);Kekule.Editor.ActionComposerSetRepositoryAddSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryAddSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ADD_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ADD_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-AddSymbol",{glyphClass:Kekule.Glyph.AddSymbol,glyphInitialParams:{lineLength:1}},null,null,c.glyphRepAddSymbol);Kekule.Editor.ActionComposerSetRepositoryGlyphController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryGlyphController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ARROWLINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ARROWLINE"),"ArrowLineIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController,Kekule.Editor.ActionComposerSetRepositoryPathLineController,Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController,Kekule.Editor.ActionComposerSetRepositoryAddSymbolController],null,c.glyph);Kekule._registerAfterLoadProc(function(){var m=Kekule.ActionManager;var g=Kekule.ChemWidget;var o=Kekule.Editor;var n=Kekule.Editor.ChemSpaceEditor;var j=m.registerNamedActionClass;j(c.newDoc,o.ActionEditorNewDoc,n);j(c.loadFile,g.ActionDisplayerLoadFile,n);j(c.loadData,g.ActionDisplayerLoadData,n);j(c.saveData,g.ActionDisplayerSaveFile,n);j(c.zoomIn,g.ActionDisplayerZoomIn,n);j(c.zoomOut,g.ActionDisplayerZoomOut,n);j(c.reset,g.ActionDisplayerReset,n);j(c.config,Kekule.Widget.ActionOpenConfigWidget,n);j(c.undo,o.ActionEditorUndo,n);j(c.redo,o.ActionEditorRedo,n);j(c.cloneSelection,o.ActionCloneSelection,n);j(c.copy,o.ActionCopySelection,n);j(c.cut,o.ActionCutSelection,n);j(c.paste,o.ActionPaste,n);j(c.objInspector,o.ActionComposerToggleInspector,n);for(var h=0,f=b.length;h<f;++h){var k=b[h];j(k.name,k.actionClass,k.widgetClass||n)}})})();(function(){var a=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.ChemIdEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemIdEditor",getAttributes:function($super){var b=$super();if(b&a.MULTIOBJS){b=b^a.MULTIOBJS}return b}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemIdEditor,null,Kekule.ChemObject,"id");Kekule.PropertyEditor.ChemCoordSizeFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordSizeFieldEditor",initProperties:function(){this.defineProp("parentObjects",{dataType:DataType.Object,serializable:false});this.defineProp("parentPropName",{dataType:DataType.STRING,serializable:false})},getCoordFieldValue:function(j,g,h){if(!j.length){return undefined}var e=j[0].getPropValue(g);if(!e){return undefined}var b=e[h];for(var f=1,c=j.length;f<c;++f){var d=j[f].getPropValue(g)[h];if(d!==b){return undefined}}return b},getValue:function($super){var b=this.getParentObjects();var c=this.getParentPropName();if(b&&c){return this.getCoordFieldValue(b,c,this.getPropertyName())}else{return $super()}}});Kekule.PropertyEditor.ChemCoordEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordEditor",is3DCoord:function(){var b=this.getPropertyName();return(b.indexOf("3")>=0)},getFieldEditorClass:function(b,c){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function($super,d,c){var b=$super(d,c);if(b.setParentObjects){b.setParentObjects(this.getObjects())}if(b.setParentPropName){b.setParentPropName(this.getPropertyName())}return b},getFieldValueType:function(b,c){return DataType.FLOAT},getObjFields:function(b){return this.is3DCoord()?["x","y","z"]:["x","y"]},getValueText:function($super){var f=Kekule.Widget.ValueListEditor.ValueDisplayMode;var d=this.getValueTextMode();if(d===f.JSON){return $super()}var g=this.getValue();if(g){var e=this.getObjFields();var j="";for(var c=0,b=e.length;c<b;++c){var h=g[e[c]];if(Kekule.ObjUtils.notUnset(h)){if(!!j){j+=", "}j+=e[c]+": "+h}}return"{"+j+"}"}else{return""}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord3D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord3D");Kekule.PropertyEditor.ChemSizeEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemSizeEditor",is3DSize:function(){var b=this.getPropertyName();return(b.indexOf("3")>=0)},getFieldEditorClass:function(b,c){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function($super,d,c){var b=$super(d,c);if(b.setParentObjects){b.setParentObjects(this.getObjects())}if(b.setParentPropName){b.setParentPropName(this.getPropertyName())}return b},getFieldValueType:function(b,c){return DataType.FLOAT},getObjFields:function(b){return this.is3DSize()?["x","y","z"]:["x","y"]},getValueText:function($super){var f=Kekule.Widget.ValueListEditor.ValueDisplayMode;var d=this.getValueTextMode();if(d===f.JSON){return $super()}var g=this.getValue();if(g){var e=this.getObjFields();var j="";for(var c=0,b=e.length;c<b;++c){var h=g[e[c]];if(Kekule.ObjUtils.notUnset(h)){if(!!j){j+=", "}j+=e[c]+": "+h}}return"{"+j+"}"}else{return""}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size3D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"screenSize");Kekule.PropertyEditor.ChemOptionObjectEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemOptionObjectEditor",CHILD_FIELD_INFOS:null,initialize:function($super){$super();this.setAllowEmpty(true)},getObjFieldInfos:function(g){var e=ClassEx.getCommonSuperClass(this.getObjects());var b=[];var h=this.CHILD_FIELD_INFOS;for(var d=0,c=h.length;d<c;++d){var f=h[d];if(!f.targetClass||!e||ClassEx.isOrIsDescendantOf(e,f.targetClass)){b.push(f)}}b.sort(function(j,i){return(j.name>i.name)?1:(j.name<i.name)?-1:0});return b},notifyChildEditorValueChange:function($super,d,c){var b=this.getValue()||this._initialObjValue;b=Object.extend({},b);if(Kekule.ObjUtils.notUnset(c)){b[d]=c}else{delete b[d]}this.setValue(b)}});Kekule.PropertyEditor.ChemRender2DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender2DOptionsEditor",CHILD_FIELD_INFOS:[{name:"expanded",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"unitLength",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"moleculeDisplayType",dataType:DataType.INT,enumSource:Kekule.Render.MoleculeDisplayType,targetClass:Kekule.StructureFragment},{name:"renderType",dataType:DataType.INT,enumSource:Kekule.Render.BondRenderType,targetClass:Kekule.ChemStructureConnector},{name:"nodeDisplayMode",dataType:DataType.INT,enumSource:Kekule.Render.NodeLabelDisplayMode,targetClass:Kekule.ChemStructureNode},{name:"hydrogenDisplayLevel",dataType:DataType.INT,enumSource:Kekule.Render.HydrogenDisplayLevel,targetClass:Kekule.ChemStructureNode},{name:"showCharge",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkType",dataType:DataType.INT,enumSource:Kekule.Render.ChargeMarkRenderType,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkFontSize",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkMargin",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkCircleWidth",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"fontSize",dataType:DataType.NUMBER},{name:"fontFamily",dataType:DataType.STRING},{name:"supFontSizeRatio",dataType:DataType.FLOAT},{name:"subFontSizeRatio",dataType:DataType.FLOAT},{name:"superscriptOverhang",dataType:DataType.FLOAT},{name:"subscriptOversink",dataType:DataType.FLOAT},{name:"textBoxXAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxXAlignment},{name:"textBoxYAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxYAlignment},{name:"horizontalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"verticalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"charDirection",dataType:DataType.INT,enumSource:Kekule.Render.TextDirection},{name:"customLabel",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"boldBondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"hashSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingAbs",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondMaxAbsSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowLength",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeHashMinWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondLengthScaleRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"opacity",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"fillColor",dataType:DataType.STRING},{name:"strokeColor",dataType:DataType.STRING},{name:"strokeWidth",dataType:DataType.NUMBER},{name:"atomRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender2DOptionsEditor,null,Kekule.ChemObject,"renderOptions");Kekule.PropertyEditor.ChemRender3DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender3DOptionsEditor",CHILD_FIELD_INFOS:[{name:"displayMultipleBond",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"useVdWRadius",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"nodeRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"nodeRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"connectorLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"hideHydrogens",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"bondSpliceMode",dataType:DataType.INT,enumSource:Kekule.Render.Bond3DSpliceMode,targetClass:Kekule.ChemStructureObject}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender3DOptionsEditor,null,Kekule.ChemObject,"render3DOptions");Kekule.PropertyEditor.GlyphPathParamsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathParamsEditor",CHILD_FIELD_INFOS:[{name:"lineCount",dataType:DataType.INT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"lineGap",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowType",dataType:DataType.STRING,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowType",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.GlyphPathParamsEditor,null,Kekule.Glyph.PathGlyphConnector,"pathParams")})();