!function(){var e;"object"==typeof self?e=self:"object"==typeof window&&window&&window.document?e=window:"object"==typeof global&&(e=global),e.__$kekule_single_min_bundle__=!0}(),function(e){var t;t="object"==typeof window&&window&&window.document?window:"object"==typeof global?global:"object"==typeof self?self:e||{},Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){t||(t=0);var r=this.length;for(t<0&&(t=r+t);t<r;t++)if(this[t]===e)return t;return-1});var r=t.document;r||"undefined"!=typeof window&&(r=window.document);var i="undefined"!=typeof navigator&&"undefined"!=typeof window&&void 0!==r,n="object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node,o=n,a="function"==typeof __webpack_require__,s="undefined"!=typeof exports;if("function"!=typeof __webpack_require__&&o){var l={};try{var u=require("vm"),d=require("fs")}catch(e){}}if(!o)r&&r.readyState,window.attachEvent&&window.opera;o&&"undefined"!=typeof global&&(t=global);var c=[];function h(e,t,r){if(c.indexOf(t)>=0)r&&r(null);else{if(o){var i=function(e){if(o)try{var t=0===e.indexOf("file:///")?e.substr(8):e,r=d.readFileSync(t,"utf8");return u.runInThisContext(r,{filename:e}),!0}catch(e){return e}}(t);return r&&r(!0===i?null:i),i}try{var n=e.createElement("script");return n.src=t,n.onerror=function(e){r&&r(new Error("Loading script file "+t+" failed"))},n.onload=n.onreadystatechange=function(e){if(!n._loaded){var i=n.readyState;void 0!==i&&"loaded"!==i&&"complete"!==i||(n._loaded=!0,n.onload=n.onreadystatechange=null,c.push(t),r&&r(null))}},(e.getElementsByTagName("head")[0]||e.body).appendChild(n),n}catch(e){r&&r(e)}}}function p(e,t,r){!function e(t,r,i,n){if(r.length<=0)return void(i&&(n.length?i(new Error(n.join(", "))):i(null)));var o=r.shift();h(t,o,function(o){o&&n.push(o?o.message||o:""),e(t,r,i,n)})}(e,[].concat(t),r,[])}function g(e,t,i){if(o)p(r,e,function(e){(this.Kekule||l.Kekule)&&(this.Kekule||l.Kekule)._loaded(),i&&i(e)});else if(function(){if(o)return!0;var e=r&&r.readyState,t=window.attachEvent&&!window.opera;return"complete"===e||"loaded"===e||"interactive"===e&&!t}()||t)p(r,e,function(e){e||Kekule._loaded(),i&&i(e)});else try{for(var n=0,a=e.length;n<a;++n)s=r,u=e[n],s.write('<script type="text/javascript" src="'+u+'"><\/script>');r.write('<script type="text/javascript">if (this.Kekule) Kekule._loaded();<\/script>'),i&&i(null)}catch(e){i(e)}var s,u}var f={lan:{files:["lan/classes.js","lan/xmlJsons.js","lan/serializations.js"],category:"lan",minFile:"root.min.js"},root:{files:["core/kekule.root.js"],category:"root",minFile:"root.min.js"},localization:{requires:["lan","root"],files:["localization/kekule.localizations.js"],category:"localization",minFile:"localization.min.js"},localizationData:{requires:["localization"],files:["localization/en/kekule.localize.general.en.js","localization/en/kekule.localize.widget.en.js","localization/en/kekule.localize.objDefines.en.js"],category:"localization",minFile:"localization.min.js"},"localizationData.zh":{requires:["localization"],files:["localization/zh/kekule.localize.general.zh.js","localization/zh/kekule.localize.widget.zh.js"],category:"localizationData.zh",autoCompress:!1},common:{requires:["lan","root","localization"],files:["core/kekule.common.js","core/kekule.exceptions.js","utils/kekule.utils.js","utils/kekule.domHelper.js","utils/kekule.domUtils.js","core/kekule.externalResMgr.js","core/kekule.metrics.js"],category:"common",minFile:"common.min.js"},core:{requires:["lan","root","common","data"],files:["core/kekule.configs.js","core/kekule.elements.js","core/kekule.electrons.js","core/kekule.valences.js","core/kekule.structures.js","core/kekule.structureBuilder.js","core/kekule.reactions.js","core/kekule.chemUtils.js","chemdoc/kekule.glyph.base.js","chemdoc/kekule.glyph.utils.js","chemdoc/kekule.glyph.pathGlyphs.js","chemdoc/kekule.glyph.lines.js","chemdoc/kekule.glyph.chemGlyphs.js","chemdoc/kekule.contentBlocks.js","chemdoc/kekule.attachedMarkers.js","chemdoc/kekule.commonChemMarkers.js"],category:"core"},html:{requires:["lan","root","common"],files:["xbrowsers/kekule.x.js","html/kekule.nativeServices.js","html/kekule.predefinedResLoaders.js","utils/kekule.htmlDomUtils.js"],category:"core"},io:{requires:["lan","root","common","core","algorithm"],files:["utils/kekule.textHelper.js","io/kekule.io.js","io/cml/kekule.io.cml.js","io/mdl/kekule.io.mdlBase.js","io/mdl/kekule.io.mdl2000.js","io/mdl/kekule.io.mdl3000.js","io/mdl/kekule.io.mdlIO.js","io/smiles/kekule.io.smiles.js","io/native/kekule.io.native.js"],category:"io"},render:{requires:["lan","root","common","core","html"],files:["render/kekule.render.extensions.js","render/kekule.render.base.js","render/kekule.render.renderColorData.js","render/kekule.render.utils.js","render/kekule.render.configs.js","render/kekule.render.baseTextRender.js","render/kekule.render.boundInfoRecorder.js","render/2d/kekule.render.renderer2D.js","render/2d/kekule.render.glyphRender2D.js","render/2d/kekule.render.canvasRenderer.js","render/2d/kekule.render.raphaelRenderer.js","render/3d/kekule.render.renderer3D.js","render/3d/kekule.render.threeRenderer.js","render/kekule.render.painter.js"],category:"render"},spectroscopy:{requires:["root","common","io"],files:["spectroscopy/kekule.spectrum.core.js","io/jcamp/kekule.io.jcamp.base.js","io/jcamp/kekule.io.jcamp.labels.js","io/jcamp/kekule.io.jcamp.dx.js","io/jcamp/kekule.io.jcamp.cs.js","io/jcamp/kekule.io.jcampIO.js","io/cmlspect/kekule.io.cmlspect.js","spectroscopy/kekule.spectrum.render.js"]},widget:{requires:["lan","root","common","html"],files:["lib/hammer.js/hammer.min.js","widgets/operation/kekule.operations.js","widgets/operation/kekule.actions.js","widgets/kekule.widget.root.js","widgets/kekule.widget.bindings.js","widgets/kekule.widget.events.js","widgets/kekule.widget.base.js","widgets/kekule.widget.sys.js","widgets/kekule.widget.keys.js","widgets/kekule.widget.clipboards.js","widgets/kekule.widget.helpers.js","widgets/kekule.widget.styleResources.js","widgets/kekule.widget.autoLaunchers.js","widgets/transitions/kekule.widget.transitions.js","widgets/transitions/kekule.widget.transMgr.js","widgets/commonCtrls/kekule.widget.resizers.js","widgets/commonCtrls/kekule.widget.movers.js","widgets/commonCtrls/kekule.widget.images.js","widgets/commonCtrls/kekule.widget.containers.js","widgets/commonCtrls/kekule.widget.menus.js","widgets/commonCtrls/kekule.widget.buttons.js","widgets/commonCtrls/kekule.widget.formControls.js","widgets/commonCtrls/kekule.widget.nestedContainers.js","widgets/commonCtrls/kekule.widget.treeViews.js","widgets/commonCtrls/kekule.widget.listViews.js","widgets/commonCtrls/kekule.widget.dialogs.js","widgets/commonCtrls/kekule.widget.msgPanels.js","widgets/commonCtrls/kekule.widget.tabViews.js","widgets/advCtrls/kekule.widget.valueListEditors.js","widgets/advCtrls/kekule.widget.colorPickers.js","widgets/advCtrls/kekule.widget.textEditors.js","widgets/advCtrls/kekule.widget.widgetGrids.js","widgets/advCtrls/objInspector/kekule.widget.objInspectors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.propEditors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.operations.js","widgets/advCtrls/kekule.widget.configurators.js","widgets/advCtrls/grids/kekule.widget.dataSets.js","widgets/advCtrls/grids/kekule.widget.dataGrids.js","widgets/sys/kekule.widget.sysMsgs.js","widgets/operation/kekule.operHistoryTreeViews.js"],category:"widget"},chemWidget:{requires:["lan","root","common","core","html","io","render","algorithm","widget"],files:["widgets/chem/kekule.chemWidget.base.js","widgets/chem/kekule.chemWidget.dialogs.js","widgets/chem/periodicTable/kekule.chemWidget.periodicTables.js","widgets/chem/kekule.chemWidget.chemObjDisplayers.js","widgets/chem/structureTreeView/kekule.chemWidget.structureTreeViews.js","widgets/chem/uiMarker/kekule.chemWidget.uiMarkers.js","widgets/chem/viewer/kekule.chemWidget.viewers.js","widgets/chem/viewer/kekule.chemWidget.spectrumViewers.js","widgets/chem/viewer/kekule.chemWidget.spectrumInspectors.js","widgets/chem/viewer/kekule.chemWidget.viewerGrids.js","widgets/chem/viewer/kekule.chemWidget.chemObjInserters.js","widgets/chem/editor/kekule.chemEditor.extensions.js","widgets/chem/editor/kekule.chemEditor.baseEditors.js","widgets/chem/editor/kekule.chemEditor.operations.js","widgets/chem/editor/kekule.chemEditor.editorUtils.js","widgets/chem/editor/kekule.chemEditor.configs.js","widgets/chem/editor/kekule.chemEditor.repositoryData.js","widgets/chem/editor/kekule.chemEditor.repositories.js","widgets/chem/editor/kekule.chemEditor.utilWidgets.js","widgets/chem/editor/kekule.chemEditor.chemSpaceEditors.js","widgets/chem/editor/kekule.chemEditor.nexus.js","widgets/chem/editor/kekule.chemEditor.actions.js","widgets/chem/editor/kekule.chemEditor.trackParser.js","widgets/chem/editor/kekule.chemEditor.objModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.styleModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.textModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.structureModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.glyphModifiers.js","chemdoc/issueCheckers/kekule.issueCheckers.js","widgets/chem/editor/issueInspectors/kekule.chemEditor.issueCheckers.js","widgets/chem/editor/issueInspectors/kekule.chemEditor.issueInspectors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.chemPropEditors.js","widgets/chem/editor/kekule.chemEditor.composers.js"],category:"chemWidget"},webComponent:{requires:["lan","root","common","core","html","io","render","algorithm","widget","chemWidget"],files:["webComponents/kekule.webComponent.base.js","webComponents/kekule.webComponent.widgetWrappers.js"]},algorithm:{requires:["lan","root","common","core"],files:["algorithm/kekule.graph.js","algorithm/kekule.structures.helpers.js","algorithm/kekule.structures.canonicalizers.js","algorithm/kekule.structures.ringSearches.js","algorithm/kekule.structures.aromatics.js","algorithm/kekule.structures.standardizers.js","algorithm/kekule.structures.searches.js","algorithm/kekule.structures.stereos.js"],category:"algorithm"},calculation:{requires:["lan","root","common","core","algorithm"],files:["calculation/kekule.calc.base.js"]},data:{requires:["root"],files:["data/kekule.chemicalElementsData.js","data/kekule.isotopesData.organSet.js","data/kekule.structGenAtomTypesData.js","data/kekule.dataUtils.js"]},emscripten:{requires:["root","common"],files:["_extras/kekule.emscriptenUtils.js"],category:"extra"},openbabel:{requires:["lan","root","core","emscripten","io"],files:["localization/en/kekule.localize.extras.openbabel.en.js","_extras/OpenBabel/kekule.openbabel.base.js","_extras/OpenBabel/kekule.openbabel.io.js","_extras/OpenBabel/kekule.openbabel.structures.js"],category:"extra"},indigo:{requires:["lan","root","core","emscripten","io"],files:["_extras/Indigo/kekule.indigo.base.js","_extras/Indigo/kekule.indigo.io.js","_extras/Indigo/kekule.indigo.structures.js"],category:"extra"},inchi:{requires:["lan","root","core","emscripten","io"],files:["_extras/InChI/kekule.inchi.js"],category:"extra"}},C=["lan","root","localization","localizationData","common"],m=C.concat(["core","html","io","spectroscopy","render","widget","chemWidget","algorithm","calculation","data"]),T=(m.concat(["emscripten","inchi","openbabel","indigo"]),C.concat(["core","io","spectroscopy","algorithm","calculation","data"])),E=[];function _(e){var t=e||m;t=C.concat(t);for(var r=[],i=function(e,t){if(e.indexOf(t)<0){var r=f[t];if(r&&r.requires)for(var n=0,o=r.requires.length;n<o;++n){var a=r.requires[n];i(e,a)}e.push(t)}},n=0,o=t.length;n<o;++n){var a=t[n];i(r,a)}return r}function S(e,t,r){var i=[],n=f[e];if(n&&n.files)if(t){var o=n.minFile||e+".min.js";r&&(o=r+o),i.indexOf(o)<0&&i.push(o)}else i=i.concat(n.files);return i}function O(e,t,r){for(var i=_(e),n=[],o=0,a=i.length;o<a;++o){var s=i[o];n=n.concat(S(s,t,r))}return n}function y(e,t,r,i,n){void 0!==Kekule&&Kekule.LOADED&&(Kekule.LOADED=!1);for(var o=i.modules||[],a=[],s=_(e),l=0,u=s.length;l<u;++l)o.indexOf(s[l])<0&&a.push(s[l]);if(a.length){var d=[];for(l=0,u=s.length;l<u;++l)d=d.concat(S(a[l],t,i.dividedMinSubPath));var c=[],h=r,p=i.fileUrls||[],f=[];for(l=0,u=d.length;l<u;++l){var C=h+d[l];p.indexOf(C)<0&&(f.push(C),c.push(d[l]))}f.push(h+"kekule.loaded.js"),g(f,null,function(e){i.modules=i.modules.concat(a),i.files=i.files.concat(c),i.fileUrls=i.fileUrls.concat(f),n&&n(e)})}else n();return{modules:a,files:c,fileUrls:f}}a||function(){var e,a="object"==typeof _kekule_environment_?_kekule_environment_:"object"==typeof t._kekule_environment_?t._kekule_environment_:null;if(a&&!(e=a.scriptInfo)&&a.scriptPath&&(e={src:a.scriptSrc,path:a.scriptPath,dividedMinSubPath:a.ScriptdividedMinSubPath,modules:a.scriptModules,useMinFile:a.scriptUseMinFile}),!e){if(i){var u=(e=function(e){var t,r=/^(.*\/?)kekule(.min)?\.js(\?.*)?$/,i=/^domloader\=(.+)$/,n=/^min\=(.+)$/,o=/^modules\=(.+)$/,a=/^locals\=(.+)$/,l=/^language\=(.+)$/;if(!s)if(e&&e.currentScript&&e.currentScript.src)(c=decodeURIComponent(e.currentScript.src))&&(t=c.match(/^(.*[\/\\])([^\/\\]*)\.js(\?.*)?$/));else for(var u=e.getElementsByTagName("script"),d=u.length-1;d>=0;--d){var c,h=u[d];if((c=decodeURIComponent(h.src))&&(t=c.match(r)))break}if(t){t[2];var p=t[3];p&&(p=p.substr(1));var g={src:c,path:t[1],paramStr:p,useMinFile:!0};if(g.paramStr){for(var f=g.paramStr.split("&"),C=0,T=f.length;C<T;++C){var _=f[C].match(n);if(_){var S=_[1].toLowerCase(),O=["false","no","f","n"].indexOf(S)<0;g.useMinFile=O}else{var y=f[C].match(o);if(y)var A=y[1].split(",");else{var I=f[C].match(i);if(I)S=I[1].toLowerCase(),O=["false","no","f","n"].indexOf(S)<0,g.forceDomLoader=O;else{var k=f[C].match(a);if(k){var b=k[1].split(",");g.locals=b}else{var v=f[C].match(l);v&&(S=v[1],g.language=S)}}}}}if(g.modules=A||m,g.locals||(g.locals=E),g.locals||g.language){var R=[].concat(g.locals||[]);if(g.language&&R.indexOf(g.language)<0&&R.push(g.language),R.length){var D=g.modules.indexOf("localizationData");for(D<0&&(D=-1),C=0,T=R.length;C<T;++C){var N=R[C];"en"!==N&&g.modules.splice(D+1,0,"localizationData."+N)}}}}return g}return{src:"",path:"",modules:m,useMinFile:!0}}(r)).src&&e.path;u&&(o=!1),!u&&n&&(e.src=this.__filename||"",e.path=(("undefined"!=typeof __dirname?__dirname:"")||".")+"/",o=!0)}else o&&(e={src:this.__filename||"",path:("undefined"!=typeof __dirname?__dirname:"")+"/",modules:i?m:T,useMinFile:!0,nodeModule:"undefined"!=typeof module?module:this.module,nodeRequire:"undefined"!=typeof require?require:this.require});if(o){var c=e.path+f.root.minFile,g=!1;try{g=d.existsSync(c)}catch(e){g=!1}g||(e.useMinFile=!1)}}e.dividedMinSubPath||(e.dividedMinSubPath="mins/"),e.dividedModuleExporterSubPath||(e.dividedModuleExporterSubPath="jsmods/"),e.modules||(e.modules=i?m:T),void 0===e.useMinFile&&(e.useMinFile=!0),e.singleMinBundle=t&&t.__$kekule_single_min_bundle__,e.explicitModules=e.modules;var C=_(e.modules);e.modules=[],e.files=[],e.fileUrls=[],e.allModuleStructures=f,t.__$kekule_load_info__=e,t.__$kekule_scriptfile_utils__={appendScriptFile:h,appendScriptFiles:p,loadModuleScriptFiles:y,getModuleJsFiles:S,getEssentialFiles:O,getEssentialModules:_},e.manualLoadScriptFiles=a&&a.manualLoadScriptFiles,e.singleMinBundle&&void 0!==e.singleMinBundle||a&&a.manualLoadScriptFiles||y(C,e.useMinFile,e.path||"",e,function(t){"undefined"!=typeof exports&&(exports.Kekule=this.Kekule||l.Kekule,exports.Class=this.Class||l.Class,exports.ClassEx=this.ClassEx||l.ClassEx,exports.ObjectEx=this.ObjectEx||l.ObjectEx,exports.DataType=this.DataType||l.DataType,this.Class=exports.Class,this.ClassEx=exports.ClassEx,this.ObjectEx=exports.ObjectEx,this.DataType=exports.DataType,this&&this.Kekule&&(this.Kekule.scriptSrcInfo=e))})}()}(this),function(e){function t(){}function r(e){if(!e)return[];if(e.toArray)return e.toArray();for(var t=e.length||0,r=new Array(t);t--;)r[t]=e[t];return r}"object"==typeof self?e=self:"object"==typeof window&&window.document?e=window:"object"==typeof global&&(e=global);var i={createCore:function(){var e=null,n=r(arguments),o=n.length>1?n[1]:n[0],a=o&&o.CLASS_NAME;if(!n[0]&&n.length>1)throw"Can not create new class"+(a?" "+a:"")+" , base class not found";function s(){this.initialize.apply(this,arguments)}if(Object.isFunction(n[0])&&(e=n.shift()),Object.extend(s,i.Methods),s.superclass=e,s.subclasses=[],e){var l=function(){};l.prototype=e.prototype,s.prototype=new l,e.subclasses.push(s)}for(var u=0;u<n.length;u++)s.addMethods(n[u]);return s.prototype.initialize||(s.prototype.initialize=t),s.prototype.constructor=s,a&&(i._named_classes[a]=s),s},create:function(){return i.createCore.apply(this,arguments)},free:function(e){e.finalize&&e.finalize(),e=null},findClass:function(e,t){var r=i._named_classes[e];if(!r){var n=Object.getCascadeFieldValue(e,t);r=n&&Object.isFunction(n)&&(n.superclass||n.subclasses)?n:null}return r},_named_classes:{}};i.Methods={addMethods:function(e){if(!e)return this;var t=this.superclass&&this.superclass.prototype,r=Object.keys(e);Object.keys({toString:!0}).length||r.push("toString","valueOf");for(var i=function(){},o=0,a=r.length;o<a;o++){var s=r[o],l=e[s],u=Object.isFunction(l);if(t&&u&&"$super"===n.argumentNames(l)[0]){var d=l;(l=function(e){return function(){return(t[e]||i).apply(this,arguments)}}(s).wrap(d)).valueOf=d.valueOf.bind(d),l.toString=d.toString.bind(d)}this.prototype[s]=l}return this}},Object.extend=function(e,t,r,i){if(r||i)for(var n in t){var o=t[n];r&&null==o||(i&&""===o||(e[n]=o))}else for(var n in t)e[n]=t[n];return e},Object.extendEx=function(e,t,r){var i=r||{};for(var n in t){var o=t[n];if((!i.ignoreUnsetValue||null!=o)&&(!i.ignoreEmptyString||""!==o)){var a=e[n];if(!r.preserveExisted||!a){var s=a&&a.constructor&&a.constructor.prototype,l=o&&o.constructor&&o.constructor.prototype;a&&"object"==typeof a&&s===l?Object.extendEx(a,o,r):e[n]=o}}}return e},Object._extendSupportMethods=function(e,t){return Object.extendEx(e,t,{ignoreUnsetValue:!0,preserveExisted:!0})},Object.getCascadeFieldValue=function(t,r){var i,n;if(n=t.length&&t.splice?t:t.split("."),!r)r=e||this;for(var o=0,a=n.length;o<a&&(i=r[n[o]]);++o)r=i;return i},Object.setCascadeFieldValue=function(e,t,r,i){for(var n,o=r,a=0,s=(n=e.length&&e.splice?e:e.split(".")).length;a<s;++a){var l=n[a];if(a===s-1)return o[l]=t,t;var u=o[l];if(!u&&i&&(u={},o[l]=u),!u)return!1;o=u}},Object._inherit=function(e){null===e&&(e={});var t=typeof e;if(!a.isFunctionType(t)&&!a.isObjectType(t))throw TypeError();function r(){}return r.prototype=e,new r},Object.create||(Object.create=Object._inherit),Object.copyValues=function(e,t,r){if(r){for(var i=0,n=r.length;i<n;++i){var o=r[i],a=t[o];void 0!==a&&(e[o]=a)}return e}return Object.extend(e,t)},Object._extendSupportMethods(Object,{keys:function(e){var t=[];for(var r in e)t.push(r);return t},isFunction:function(e){return"function"==typeof e},isUndefined:function(e){return void 0===e}}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t});var n={argumentNames:function(e){var t=((e.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)||[])[1]||"").replace(/\s+/g,"").split(",");return 1!=t.length||t[0]?t:[]}};Object._extendSupportMethods(Function.prototype,{argumentNames:function(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return 1!=e.length||e[0]?e:[]},wrap:function(e){var t=this;return function(){return e.apply(this,[t.bind(this)].concat(r(arguments)))}},methodize:function(){if(this._methodized)return this._methodized;var e=this;return this._methodized=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),e.apply(null,t)}},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var e=this,t=r(arguments),i=t.shift();return function(){return e.apply(i,t.concat(r(arguments)))}},delay:function(){var t=this,i=r(arguments),n=i.shift();return e.setTimeout(function(){return t.apply(t,i)},n)},defer:function(){var t=this,i=r(arguments);i.shift();return e.setTimeout(function(){return t.apply(t,i)},10)}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){t||(t=0);var r=this.length;for(t<0&&(t=r+t);t<r;t++)if(this[t]===e)return t;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e,t){t=isNaN(t)?this.length:(t<0?this.length+t:t)+1;var r=this.slice(0,t).reverse().indexOf(e);return r<0?r:t-r-1}),Array.prototype.map&&(Array.prototype.map=function(e){var t,r,i;if(null==this)throw new TypeError("this is null or not defined");var n=Object(this),o=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),r=new Array(o),i=0;i<o;){var a,s;i in n&&(a=n[i],s=e.call(t,a,i,n),r[i]=s),i++}return r}),Object._extendSupportMethods(String.prototype,{gsub:function(e,t){for(var r="",i=this;i.length>0;)void 0===i.match(e)?(r+=i.slice(0,(void 0).index),r+=t,i=i.slice((void 0).index+(void 0)[0].length)):(r+=i,i="");return r},sub:function(e,t,r){return r=Object.isUndefined(r)?1:r,this.gsub(e,function(e){return--r<0?e[0]:t(e)})},scan:function(e,t){return this.gsub(e,t),String(this)},truncate:function(e,t){return e=e||30,t=Object.isUndefined(t)?"...":t,this.length>e?this.slice(0,e-t.length)+t:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var e=new RegExp(Prototype.ScriptFragment,"img"),t=new RegExp(Prototype.ScriptFragment,"im");return(this.match(e)||[]).map(function(e){return(e.match(t)||["",""])[1]})},escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />")},unescapeHTML:function(){return this.replace(/\<br \/\>/g,"\n").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},toQueryParams:function(e){var t=this.strip().match(/([^?#]*)(#.*)?$/);return t?t[1].split(e||"&").inject({},function(e,t){if((t=t.split("="))[0]){var r=decodeURIComponent(t.shift()),i=t.length>1?t.join("="):t[0];null!=i&&(i=decodeURIComponent(i)),r in e?(Object.isArray(e[r])||(e[r]=[e[r]]),e[r].push(i)):e[r]=i}return e}):{}},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(e){return e<1?"":new Array(e+1).join(this)},camelize:function(){var e=this.split("-"),t=e.length;if(1==t)return e[0];for(var r="-"==this.charAt(0)?e[0].charAt(0).toUpperCase()+e[0].substring(1):e[0],i=1;i<t;i++)r+=e[i].charAt(0).toUpperCase()+e[i].substring(1);return r},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},capitalizeFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1-$2").replace(/([a-z\d])([A-Z])/g,"$1-$2").replace(/-/g,"-").toLowerCase()},inspect:function(e){var t=this.gsub(/[\x00-\x1f\\]/,function(e){var t=String.specialChar[e[0]];return t||"\\u00"+e[0].charCodeAt().toPaddedString(2,16)});return e?'"'+t.replace(/"/g,'\\"')+'"':"'"+t.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(!0)},unfilterJSON:function(e){return this.sub(e||Prototype.JSONFilter,"#{1}")},isJSON:function(){var e=this;return!e.blank()&&(e=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""),/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(e))},include:function(e){return this.indexOf(e)>-1},startsWith:function(e){return 0===this.indexOf(e)},endsWith:function(e){var t=this.length-e.length;return t>=0&&this.lastIndexOf(e)===t},empty:function(){return""==this},blank:function(){return/^\s*$/.test(this)},interpolate:function(e,t){return new Template(this,t).evaluate(e)}}),Object._extendSupportMethods(String.prototype,{upperFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},format:function(){for(var e=this,t=0;t<arguments.length;t++){var r=new RegExp("\\{"+t+"\\}","gi");e=e.replace(r,arguments[t])}return e},trim:function(){return this.replace(/^\s*|\s*$/g,"")},ltrim:function(){return this.replace(/^\s+/,"")},rtrim:function(){return this.replace(/\s+$/,"")},trimLeft:function(){return this.ltrim()},trimRight:function(){return this.rtrim()},pad:function(e,t,r){for(var i=t||" ",n=[],o=0,a=e-this.length;o<a;++o)n.push(i);return r?this+n.join(""):n.join("")+this},lpad:function(e,t){return this.pad(e,t,!1)},rpad:function(e,t){return this.pad(e,t,!0)},reverse:function(){for(var e=[],t=this.length-1;t>=0;--t)e.push(this.charAt(t));return e.join("")},toCharArray:function(){for(var e=[],t=0,r=this.length;t<r;++t)e.push(this.charAt(t));return e},hyphenize:function(e){e||(e="-");for(var t=this.length,r=[],i=0;i<t;++i){var n=this.charAt(i);0!==i&&n>="A"&&n<="Z"?r.push(e+n.toLowerCase()):r.push(n)}return r.join("")}});var o={STRUE:"$TRUE",SFALSE:"$FALSE",SUNDEFINED:"$UNDEFINED",SNULL:"$NULL",SNAN:"$NAN",SPOSITIVE:"+",SNEGATIVE:"-",SDATEPREFIX:"@",isAllDigitalChar:function(e){for(var t=0,r=e.length;t<r;++t){var i=e.charAt(t);if(!(i>="0"&&i<="9")&&"."!=i)return!1}return!0},isNumbericStr:function(e){var t=Number(e);return!isNaN(t)},serializeValue:function(e,t){var r=t||[],i=a.getType(e);if(r.indexOf(i)>=0)return e.toString();if(null===e)return o.SNULL;if(void 0===e)return o.SUNDEFINED;if(e!=e)return o.SNAN;switch(i){case"boolean":return e?o.STRUE:o.SFALSE;case"number":case a.INT:case a.FLOAT:return(e>=0?o.SPOSITIVE:"")+e;case a.DATE:return o.SDATEPREFIX+e.toString();default:return e.toString()}},deserializeValue:function(e,t){if("string"!=typeof e)return e;switch(e){case o.STRUE:return!0;case o.SFALSE:return!1;case o.SNULL:return null;case o.SUNDEFINED:return;case o.SNAN:return NaN;default:if(t){if(!e&&[a.NUMBER,a.INT,a.FLOAT].indexOf(t)>=0)return;switch(t){case a.FLOAT:return parseFloat(e);case a.INT:return parseInt(e);case"number":return parseFloat(e);case"boolean":return!!e;default:return e}}else{switch(e.charAt(0)){case o.SPOSITIVE:case o.SNEGATIVE:var r=e.substring(1);return o.isNumbericStr(r)?parseFloat(e):e;case o.SDATEPREFIX:r=e.substr(1);try{var i=new Date(r);return isNaN(i.getTime())?e:i}catch(t){return e}default:return e}}}}};Object.extend(Date.prototype,{copyFrom:function(e){this.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),this.setTime(e.getTime())}}),Date.now||(Date.now=function(){return(new Date).getTime()}),Math.sqr||(Math.sqr=function(e){return e*e}),Math.sign||(Math.sign=function(e){return e>0?1:e<0?-1:0}),Math.log10||(Math.log10=function(e){return Math.log(e)*Math.LOG10E}),void 0===e.Node&&(e.Node=function(){}),e.Node.ELEMENT_NODE||Object.extend(e.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),i.PropertyScope={DEFAULT:3,PUBLISHED:3,PUBLIC:2,PRIVATE:1},i.PropList=function(){this.props=[]},i.PropList.prototype={addProperty:function(e,t){var r;return t||(t={}),(r=this.getPropInfo(e))||(r={},this.props.push(r)),void 0===(r=Object.extend(r,t)).serializable&&(r.serializable=!0),r.name=e,r},removeProperty:function(e){var t=this.indexOf(e);t>=0&&this.props.splice(t,1)},removePropAt:function(e){e>=0&&(this.props[e]&&this.props.splice(e,1))},getLength:function(){return this.props.length},indexOf:function(e){for(var t=0,r=this.props.length;t<r;++t)if(this.props[t].name===e)return t;return-1},getPropInfoAt:function(e){return e>=0?this.props[e]:null},getPropInfo:function(e){var t=this.indexOf(e);return this.getPropInfoAt(t)},hasProperty:function(e){return this.indexOf(e)>=0},clear:function(){this.props.clear()},clone:function(){var e=new i.PropList;return e.props=this.props.slice(),e},appendList:function(e){for(var t=0,r=e.props.length;t<r;++t)this.props.push(e.props[t])}},i.PropList.prototype.constructor=i.PropList,i.EventHandlerList=function(){this.handlers=[],this._$flag_="KekuleEventList"},i.EventHandlerList.prototype={add:function(e,t){t||(t=null),this.handlers.push({thisArg:t,handler:e})},remove:function(e,t){var r=this.indexesOf(e,t);if(r.length>0)for(var i=r.length-1;i>=0;--i)this.removeAt(r[i])},removeAt:function(e){for(var t=e,r=this.handlers.length;t<r;++t)this.handlers[t]=this.handlers[t+1];this.handlers.length=this.handlers.length-1},clear:function(){this.handlers=[]},getHandlerInfo:function(e){return this.handlers[e]},indexOf:function(e,t){for(var r=0,i=this.handlers.length;r<i;++r)if(this.handlers[r].handler==e){if(void 0!==t&&this.handlers[r].thisArg===t)return r;if(void 0===t)return r}return-1},indexesOf:function(e,t){for(var r=[],i=0,n=this.handlers.length;i<n;++i)this.handlers[i].handler==e&&(void 0!==t&&this.handlers[i].thisArg===t?r.push(i):void 0===t&&r.push(i));return r},getLength:function(){return this.handlers.length}},i.EventHandlerList.constructor=i.EventHandlerList;var a={UNKNOWN:null,VARIANT:null,PRIMARY:"primary",UNDEFINED:"undefined",BOOL:"boolean",BOOLEAN:"boolean",NUMBER:"number",INT:"int",INTEGER:"int",FLOAT:"float",STRING:"string",ARRAY:"array",FUNCTION:"function",DATE:"date",HASH:"object",OBJECT:"object",OBJECTEX:"objectex",CLASS:"class",isSimpleType:function(e){return e==a.STRING||e==a.NUMBER||e==a.INT||e==a.FLOAT||e==a.BOOL||e==a.UNDEFINED||e==a.PRIMARY},isComplexType:function(e){return!(a.isSimpleType(e)||a.isFunctionType(e))},isFunctionType:function(e){return e==a.FUNCTION},isObjectType:function(e){return e==a.OBJECT},isDateType:function(e){return e==a.DATE},isObjectExType:function(e){var t=a.isComplexType(e)&&!a.isObjectType(e)&&!a.isDateType(e);if(t){var r=l.findClass(e);t=r&&l.isOrIsDescendantOf(r,u)}return t},getType:function(e){var t=typeof e;switch(t){case"undefined":return a.UNDEFINED;case"function":return a.FUNCTION;case"boolean":return a.BOOL;case"string":return a.STRING;case"number":return Math.floor(e)==e?a.INT:a.FLOAT;case"object":return this.isDateValue(e)?a.DATE:a.isArrayValue(e)?a.ARRAY:l.isClass(e)?a.CLASS:a.isObjectExValue(e)&&e.getClassName?e.getClassName():a.OBJECT;default:return t}},isSimpleValue:function(e){return a.isSimpleType(typeof e)},isUndefinedValue:function(e){return void 0===e},isNullValue:function(e){return null===e},isFunctionValue:function(e){return"function"==typeof e},isObjectValue:function(e){return!!e&&("object"==typeof e&&!a.isArrayValue(e)&&!a.isDateValue(e))},isDateValue:function(e){return!!e&&("object"==typeof e&&void 0!==e.getFullYear)},isArrayValue:function(e){return!!e&&("object"==typeof e&&void 0!==e.length)},isObjectExValue:function(e){return e instanceof u},createInstance:function(e){switch(e){case a.UNDEFINED:return;case a.DATE:return new Date;case a.ARRAY:return new Array;case a.OBJECT:return new Object;case a.FUNCTION:return function(){};default:return new(l.findClass(e.capitalizeFirst()))}}},s=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}(),l={isClass:function(e){return!!e&&!(!e.superclass&&!e.subclasses)},findClass:function(t,r){return i.findClass(t,r||e)},getClassName:function(e){return e?e.prototype.CLASS_NAME:null},getClassLocalName:function(e){var t=l.getClassName(e),r=t.lastIndexOf(".");return r>=0?t.substring(r+1):t},getPrototype:function(e){return e.prototype},getSuperClass:function(e){return e.superclass||e.constructor.superclass},getSuperClassPrototype:function(e){return e.superclass?e.superclass.prototype:null},_getCommonSuperClass2:function(e,t){for(var r=e;r&&!l.isOrIsDescendantOf(t,r);)r=l.getSuperClass(r);return r},getCommonSuperClass:function(e){if(!e||!e.length)return null;var t=e[0].getClass?e[0].getClass():null;if(!t)return null;for(var r=1,i=e.length;r<i;++r){var n=e[r].getClass?e[r].getClass():null;if(!n)return null;t=l._getCommonSuperClass2(t,n)}return t},isDescendantOf:function(e,t){for(var r=l.getSuperClass(e);r&&r!==t;)r=l.getSuperClass(r);return!!r},isOrIsDescendantOf:function(e,t){return e===t||l.isDescendantOf(e,t)},isOrIsDescendantOfClasses:function(e,t){for(var r=0,i=t.length;r<i;++r)if(l.isOrIsDescendantOf(e,t[r]))return!0;return!1},_ensurePropertySystem:function(e){var t=l.getPrototype(e);if(t&&!t.hasOwnProperty("properties")){var r=l.getSuperClass(e);r&&l._ensurePropertySystem(r),l._createPropertyList(e),l._remapPropGetters(e),t.hasOwnProperty("initProperties")&&t.initProperties.apply(t)}},_createPropertyList:function(e){l.getPrototype(e).hasOwnProperty("properties")||(l.getPrototype(e).properties=new i.PropList)},_remapPropGetters:function(e,t){for(var r=l.getPrototype(e),i=t||Object.getOwnPropertyNames(r),n=0,o=i.length;n<o;++n){var a=i[n];if(a.length>5&&a.startsWith("doGet")){var u=r[a];if("function"==typeof u){var d=a.charAt(5).toLowerCase()+a.substr(6);if(r.hasDirectProperty(d))continue;var c=l.getPropInfo(e,d);if(c&&c.getter)if(r["get"+d.capitalizeFirst()]=u,s){var h=Object.extend({},c.descriptor);h.get=u;try{Object.defineProperty(r,d,h)}catch(e){throw e}}}}}},getOwnPropList:function(e){var t=l.getPrototype(e);return t?(t._initPropertySystem(),t.properties):null},getAllPropList:function(e){var t,r=l.getSuperClassPrototype(e);return r?(t=r.getAllPropList().clone()).appendList(l.getOwnPropList(e)):t=l.getOwnPropList(e),t},getPropListOfScopes:function(e,t){var r,n=function(e,t){var r=l.getOwnPropList(e).clone();if(r)for(var n=r.getLength()-1;n>=0;--n){var o=r.getPropInfoAt(n).scope||i.PropertyScope.DEFAULT;t.indexOf(o)<0&&r.removePropAt(n)}return r},o=l.getSuperClass(e);return o?(r=l.getPropListOfScopes(o,t).clone()).appendList(n(e,t)):r=n(e,t),r},defineProp:function(e,t,r){return l._ensurePropertySystem(e),l.getPrototype(e).defineProp(t,r)},defineProps:function(e,t){l._ensurePropertySystem(e);for(var r=l.getPrototype(e),i=0,n=t.length;i<n;++i){var o=t[i],a=o.name,s=o;r.defineProp(a,s)}},getPropInfo:function(e,t,r){return l.getPrototype(e).getPropInfo(t,r)},defineEvent:function(e,t){return l.getPrototype(e).defineEvent(t)},getUnusedMethodName:function(e,t,r){for(var i=r||0,n=l.getPrototype(e),o=t+Number(i).toString();n[o];)++i,o=t+Number(i).toString();return o},extendMethod:function(e,t,r){var i=l.getPrototype(e),n=i[t],o=l.getUnusedMethodName(e,"__$changed$_"+t+"__");i[o]=n;var a,s=(a=o,function(){return i[a].apply(this,arguments)}).wrap(r);i[t]=s,s.valueOf=r.valueOf.bind(r),s.toString=r.toString.bind(r)},extendMethods:function(e,t){for(var r=Object.keys(t),i=0,n=r.length;i<n;++i){var o=r[i],a=t[o];"function"==typeof a&&l.extendMethod(e,o,a)}},extend:function(e,t){var r=l.getPrototype(e),i=l.getSuperClassPrototype(e),o=Object.keys(t);Object.keys({toString:!0}).length||o.push("toString","valueOf");for(var a=0,s=o.length;a<s;a++){var u=o[a],d=t[u];if("function"==typeof d){var c=n.argumentNames(d),h=c[0];if("$origin"==h){var p=d,g=r[u],f=l.getUnusedMethodName(e,"__$changed$_"+u+"__");r[f]=g,(d=function(e){return function(){return r[e].apply(this,arguments)}}(f).wrap(p)).valueOf=p.valueOf.bind(p),d.toString=p.toString.bind(p),c.shift(),h=c.first()}if("$super"==h){p=d;(d=function(e){return function(){return i[e].apply(this,arguments)}}(u).wrap(p)).valueOf=p.valueOf.bind(p),d.toString=p.toString.bind(p)}}r[u]=d}return l._remapPropGetters(e,o),e}},u=i.create({CLASS_NAME:"ObjectEx",EVENT_HANDLERS_FIELD:"__$__k__eventhandlers__$__",initialize:function(){this._initPropertySystem(),this._updateStatus=0,this._childChangeEventSuppressed=!1,this._modifiedProps=[],this._finalized=!1,this.beginUpdate();try{this.initPropValues()}finally{this.endUpdate()}this.afterInitialization()},afterInitialization:function(){},finalize:function(){this._finalized||(this.doFinalize(),this.invokeEvent("finalize",{obj:this}),this[this.EVENT_HANDLERS_FIELD]=null,this._finalized=!0)},doFinalize:function(){},initProperties:function(){this.defineProp("enablePropValueGetEvent",{dataType:a.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("enablePropValueSetEvent",{dataType:a.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("enableObjectChangeEvent",{dataType:a.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("bubbleEvent",{dataType:a.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("suppressChildChangeEventInUpdating",{dataType:a.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("eventHandlers",{dataType:a.HASH,serializable:!1,scope:i.PropertyScope.PRIVATE,setter:null,getter:function(){var e=this[this.EVENT_HANDLERS_FIELD];return e||(e={},this[this.EVENT_HANDLERS_FIELD]=e),e}})},initPropValues:function(){},getHigherLevelObj:function(){return null},saved:function(e){},allSaved:function(e){},loaded:function(e){},allLoaded:function(e){},_initPropertySystem:function(){l._ensurePropertySystem(this.getClass())},_createPropertyList:function(){l._createPropertyList(this.getClass())},_remapPropGetters:function(){l._remapPropGetters(this.getClass())},getClass:function(){return this.constructor},getSuperClass:function(){return this.getClass().superclass},getClassName:function(){return this.getPrototype().CLASS_NAME},getClassLocalName:function(){return l.getClassLocalName(this.getClass())},getSerializationName:function(){return this.getClassName()},getPrototype:function(){return this.prototype?this.prototype:this.constructor.prototype},getSuperClassPrototype:function(){return this.constructor&&this.constructor.superclass?this.constructor.superclass.prototype:null},$super:function(e,t){var r=this.getSuperClassPrototype();return e?this.tryCallSuper.apply(this,arguments):r},applySuper:function(e,t,r){var i=this.__getLastSuperMethodCallTarget__(e),n=this.__getMethodBelongedPrototype__(e,i),o=this.__getMethodBelongedPrototype__(e,i.getSuperClassPrototype());o&&o===n&&(o=this.__getMethodBelongedPrototype__(e,o.getSuperClassPrototype()));var a=o&&o[e];if(a){var s;try{this.__pushSuperMethodCallTargetStack__(e,o),s=t?a.apply(this,t):a.apply(this)}finally{this.__popSuperMethodCallTargetStack__(e)}return s}if(!r)throw"Super method not found: "+e},tryApplySuper:function(e,t){return this.applySuper(e,t,!0)},tryCallSuper:function(){var e=r(arguments),t=e.shift();return this.tryApplySuper(t,e)},__getMethodBelongedPrototype__:function(e,t){if(!t)return null;if(t.hasOwnProperty(e))return t;var r=t.getSuperClassPrototype&&t.getSuperClassPrototype();return r&&r.__getMethodBelongedPrototype__?r.__getMethodBelongedPrototype__(e,r):null},__getSuperMethodCallTargetStack__:function(e){var t=this.__$superMethodCallTargetStacks__;t||(t={},this.__$superMethodCallTargetStacks__=t);var r=t[e];return r||(r=[],t[e]=r),r},__getLastSuperMethodCallTarget__:function(e){var t=this.__getSuperMethodCallTargetStack__(e);return t.length?t[t.length-1]:this.getPrototype()},__pushSuperMethodCallTargetStack__:function(e,t){this.__getSuperMethodCallTargetStack__(e).push(t)},__popSuperMethodCallTargetStack__:function(e){var t=null,r=this.__$superMethodCallTargetStacks__,i=r&&r[e];if(i){t=i.pop();i.length||delete r[e]}return t},__changeClass__:function(e){var t=l.getPrototype(e);return this.prototype=t,this.__proto__=t,this.constructor=e,this.objectChange(["__proto__"]),this},getOwnPropList:function(){return this._initPropertySystem(),this.getPrototype().properties},getAllPropList:function(){var e,t=this.getSuperClassPrototype();return t?(e=t.getAllPropList().clone()).appendList(this.getOwnPropList()):e=this.getOwnPropList().clone(),e},getPropListOfScopes:function(e){return l.getPropListOfScopes(this.getClass(),e)},getPropInfoHashKey:function(e){return u._PROPINFO_HASHKEY_PREFIX+e},getDefPropStoreFieldName:function(e){return u._PROP_STOREFIELD_PREFIX+e},defineProp:function(e,t){var r;void 0===(r=t?Object.extend({},t):{}).serializable&&(r.serializable=!0),r.storeField=this.getDefPropStoreFieldName(e);var i,n,o=this.getOwnPropList().addProperty(e,r);if(null!==r.getter&&!1!==r.getter&&(i=this.createPropGetter(o,r.getter),o.getter=i.doGetterName),null!==r.setter&&!1!==r.setter&&(n=this.createPropSetter(o,r.setter),o.setter=n.doSetterName),this[this.getPropInfoHashKey(e)]=o,s){var a={enumerable:r.enumerable,configurable:!1};void 0===a.enumerable&&(a.enumerable=!0),i&&(a.get=this[i.getterName]),n&&(a.set=this[n.setterName]),o.descriptor=a;try{Object.defineProperty(this,e,a)}catch(e){throw e}}return o},createPropGetter:function(e,t){var r=e.name.toString().upperFirst(),i="get"+r,n="doGet"+r,o=this[n];if(!o){var a=e.storeField;o=t||function(){return this[a]},this.getPrototype()[n]=o}return this.getPrototype()[i]=o,{getterName:i,doGetterName:n}},createPropSetter:function(e,t){var r=e.name.toString(),i=r.upperFirst(),n="set"+i,o="doSet"+i,a=this[o];if(!this[o]){var s=e.storeField;a=t||function(e){this[s]=e},this.getPrototype()[o]=a}return this.getPrototype()[n]=function(){var e=arguments[0];return this[o].apply(this,arguments),this.notifyPropSet(r,e),this},{setterName:n,doSetterName:o}},hasProperty:function(e){return null!=this.getPropInfo(e)},hasDirectProperty:function(e){return null!=this.getPropInfo(e,!0)},getPropInfo:function(e,t){var r,i=e||"";t||(r=this[this.getPropInfoHashKey(i)||""]);if(!r&&!(r=this.getOwnPropList().getPropInfo(i))&&!t){var n=this.getSuperClassPrototype();r=n&&n.getPropInfo?n.getPropInfo(i):null}return r},getPropertyDataType:function(e){var t=this.getPropInfo(e);return t?t.dataType:null},isPropertySerializable:function(e){var t=this.getPropInfo(e),r=t&&t.serializable;return void 0===r||!!r},getPropStoreFieldValue:function(e){return this[u._PROP_STOREFIELD_PREFIX+e]},getPropValue:function(e){var t,r=this.getPropInfo(e);if(r){if(r.getter){var i=Array.prototype.slice.call(arguments);i.shift(),t=this[r.getter].apply(this,i)}else t=this[r.storeField];return t}return null},getCascadePropValue:function(e){for(var t,r,i=this,n=0,o=(r=e.length&&e.splice?e:e.split(".")).length;n<o&&(t=i.getPropValue(r[n]));++n)i=t;return t},getPropValues:function(e){var t={};if(a.isArrayValue(e))for(var r=0,i=e.length;r<i;++r){t[n=e[r]]=this.getPropValue(n)}else if(a.isObjectValue(e))for(var n in e)e.hasOwnProperty(n)&&"function"!=typeof e[n]&&(t[n]=this.getPropValue(n));return t},setPropStoreFieldValue:function(e,t){this[u._PROP_STOREFIELD_PREFIX+e]=t},setPropValue:function(e,t,r){var i=this.getPropInfo(e);return i&&(i.setter?this[i.setter].apply(this,[t]):r&&(this[i.storeField]=t),this.notifyPropSet(e,t)),this},setPropValueX:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=this.getPropInfo(t);return r&&(r.setter&&this[r.setter].apply(this,e),this.notifyPropSet(t,this.getPropValue(t))),this},setPropValues:function(e,t){for(var r in e)if(e.hasOwnProperty(r)&&this.hasProperty(r)){var i=e[r];this.setPropValue(r,i,t)}return this},setCascadePropValue:function(e){for(var t,r=Array.prototype.slice.call(arguments),i=this,n=0,o=(t=(e=r.shift()).length&&e.splice?e:e.split(".")).length-1;n<o&&(i=i.getPropValue(t[n]));++n);return i&&(r.unshift(t[o]),i.setPropValueX.apply(i,r)),this},_isPropGetOrSetEvent:function(e){return"propValueGet"==e||"propValueSet"==e},notifyPropSet:function(e,t,r){this.isUpdating()?this._modifiedProps.indexOf(e)<0&&this._modifiedProps.push(e):this._isPropGetOrSetEvent(e)||this.isEventPropName(e)||(this.doPropChanged(e,t),this.getPropStoreFieldValue("enablePropValueSetEvent")&&this.invokeEvent("propValueSet",{propName:e,propValue:t}),r||this.objectChange([e]))},objectChange:function(e){var t=[].concat(e);if(this.doObjectChange(e),this.getEnableObjectChangeEvent()){var r=t.indexOf("enableObjectChangeEvent");r>=0&&t.splice(r,1),this.invokeEvent("change",{changedPropNames:t})}},doObjectChange:function(e){},doPropChanged:function(e,t){},defineEvent:function(e){},eventNameToPropName:function(e){return"__event_"+e},isEventPropName:function(e){return"string"==typeof e&&e.indexOf("__event_")>=0},isEventHandlerList:function(e){return e&&"object"==typeof e&&e instanceof i.EventHandlerList},getEventHandlerList:function(e){var t=this.getEventHandlers(),r=t[e];return r||(r=new i.EventHandlerList,t[e]=r),r},addEventListener:function(e,t,r){var i=this.getEventHandlerList(e);return this.isEventHandlerList(i)?("change"===e&&this.setEnableObjectChangeEvent(!0),i.add(t,r)):null},addOnceEventListener:function(e,t,r){var i=this,n=function(o){i.removeEventListener(e,n,r),t(o)};return this.addEventListener(e,n,r)},removeEventListener:function(e,t,r){var i=this.getEventHandlerList(e);if(this.isEventHandlerList(i))return i.remove(t,r)},on:function(e,t,r){return this.addEventListener(e,t,r)},once:function(e,t,r){return this.addOnceEventListener(e,t,r)},off:function(e,t,r){return this.removeEventListener(e,t,r)},invokeEvent:function(e,t){t?(t.name=e,t.target=this):t={name:e,target:this},t.stopImmediatePropagation||(t.stopImmediatePropagation=this._eventStopImmediatePropagation),t.stopPropagation||(t.stopPropagation=this._eventCancelBubble),t.preventDefault||(t.preventDefault=this._eventPreventDefault),this.dispatchEvent(e,t),this.dispatchEvent("eventInvoke",{event:t,target:this,name:"eventInvoke"})},_eventStopImmediatePropagation:function(){this._stopImmediatePropagation=!0,this._cancelBubble=!0},_eventCancelBubble:function(){this._cancelBubble=!0},_eventPreventDefault:function(){this._preventDefault=!0},relayEvent:function(e,t){t.currentTarget=this,"change"===e&&this.getSuppressChildChangeEventInUpdating()&&this.isUpdating()?this._childChangeEventSuppressed=!0:this.dispatchEvent(e,t)},dispatchEvent:function(e,t){for(var r=this.getEventHandlerList(e),i=0,n=r.getLength();i<n&&!t._stopImmediatePropagation;++i){var o=r.getHandlerInfo(i);o.handler.apply(o.thisArg,[t])}if(!t._cancelBubble&&this.getBubbleEvent()){var a=this.getHigherLevelObj();a&&a.relayEvent&&a.relayEvent(e,t)}},stopEventPropagation:function(e){e.cancelBubble=!0},overwriteMethod:function(e,t){var r=this,i=this[e];return this[e]=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(i&&i.bind(r)),t.apply(r,e)},this},assign:function(e){return e.assignTo(this)},assignTo:function(e){var t={};this.saveObj(t,"json"),e.loadObj(t,"json")},clone:function(){var e=new(this.getClass());return this.assignTo(e),e},beginUpdate:function(){this.doBeginUpdate()},doBeginUpdate:function(){++this._updateStatus},endUpdate:function(){if(--this._updateStatus,this.checkUpdateStatus(),!this.isUpdating()){var e=this._modifiedProps||[];this._modifiedProps=[],this._childChangeEventSuppressed&&(e.push("[children]"),this._childChangeEventSuppressed=!1),this.doEndUpdate(e)}},doEndUpdate:function(e){if(e.length){if(this.getPropStoreFieldValue("enablePropValueSetEvent"))for(var t=0,r=e.length;t<r;++t){var i=e[t],n=this.getPropValue(i);this.notifyPropSet(i,n,!0)}this.objectChange(e)}},isUpdating:function(){return this._updateStatus>0},isPropUpdated:function(e){return this._modifiedProps.indexOf(e)>=0},checkUpdateStatus:function(){this._updateStatus<=0&&(this._updateStatus=0)},copyPropsTo:function(e){for(var t=this.getAllPropList(),r=0,i=t.getLength();r<i;++r){var n=t.getPropInfoAt(r).name;if(e.hasProperty(n)){var o=this.getPropValue(n);e.setPropValue(n,o,!0)}}}});u._PROPINFO_HASHKEY_PREFIX="__$propInfo__",u._PROP_STOREFIELD_PREFIX="__$__k__p__",e.Class=i,e.ClassEx=l,e.ObjectEx=u,e.DataType=a,a.StringUtils=o}(this),function(e){"use strict";var t={parse:function(e){return JSON.parse(e)},serializeToStr:function(e,t){return t&&t.prettyPrint?JSON.stringify(e,null,t.indentSpaces||2):JSON.stringify(e)}},r={DOM_PARSER:null,DOM_IMPLEMENTATION:null,XML_SERIALIZER:null,DEF_INCLUDE_TAG_NAME:"include",DEF_INCLUDE_SRC_ATTRIB:"src",DEF_LOAD_TIMEOUT:2e4,DEF_BYPASS_ROOT_ELEM:!0,DEF_SERIALIZE_TO_JSCODE_VARNAME:"__xmlStr__",FILE_EXT_XML:".xml",FILE_EXT_XML_JS_WRAPPER:".xmljs",newDocument:function(e,t){if(e||(e=""),t||(t=""),r.DOM_IMPLEMENTATION)return i=(new r.DOM_IMPLEMENTATION).createDocument(t,e,null);if("undefined"!=typeof document){if(document.implementation&&document.implementation.createDocument)return i=document.implementation.createDocument(t,e,null);if("undefined"!=typeof ActiveXObject){var i=new ActiveXObject("MSXML2.DOMDocument");if(e){var n="",o=e,a=e.indexOf(":");-1!=a&&(n=e.substring(0,a),o=e.substring(a+1));var s="<"+(n?n+":":"")+o+(t?(n?" xmlns:":" xmlns")+n+'="'+t+'"':"")+"/>";i.loadXML(s)}return i}}},parse:function(e){if(r.DOM_PARSER)return(new r.DOM_PARSER).parseFromString(e,"application/xml");if("undefined"!=typeof document){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(e,"application/xml");if("undefined"!=typeof ActiveXObject){var t=r.newDocument();return t.loadXML(e),t}var i="data:text/xml;charset=utf-8,"+encodeURIComponent(e),n=new XMLHttpRequest;return n.open("GET",i,!1),n.send(null),n.responseXML}},load:function(e,t,i){return r.loadHelper.loadSimple(e,t,(i||{}).timeout)},loadHelper:{loadSimple:function(e,t,i){var n=null!=t;if(null==i&&(i=r.DEF_LOAD_TIMEOUT),document.implementation&&document.implementation.createDocument){var o=new XMLHttpRequest,a=null;i&&(a=setTimeout(function(){s(null,!1)},i));var s=function(e,r){a&&clearTimeout(a),t&&t(e,r)};n&&(o.onreadystatechange=function(){if(4==o.readyState){var e=o.responseXML;e&&e.documentElement?s(e,!0):s(null,!1)}});try{o.open("get",e,n),o.send(null)}catch(e){s(null,!1)}var l=o.responseXML;return l&&l.documentElement?l:null}return r.loadHelper.loadSimpleViaDoc(e,t)},loadSimpleViaDoc:function(e,t){var i=null!=t,n=r.newDocument("dummy_dummy_dummy_dummy");return n.async=i,i&&(n.onreadystatechange=function(){4==n.readyState&&(n.documentElement&&"dummy_dummy_dummy_dummy"!=n.documentElement.tag?t(n,!0):t(n,!1))}),n.load(e),n}},serializeNode:function(e,t){if(t&&t.prettyPrint)return r.serializeNodePretty(e);if(r.XML_SERIALIZER)return(new r.XML_SERIALIZER).serializeToString(e);if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(e);if(e.xml)return e.xml;throw"XML.serialize is not supported or can't serialize "+e},serializeNodePretty:function(e){try{return r.XML_SERIALIZER?(new r.XML_SERIALIZER).serializeToString(e).toXMLString():(new XMLSerializer).serializeToString(e).toXMLString()}catch(t){return r.serializeNode(e)}},getXmlDocUrl:function(e){return e.url||e.documentURI||e.URL||e.location}};DataType.JsonUtility=t,DataType.XmlUtility=r}(),function(){"use strict";var e=Class.create(ObjectEx,{CLASS_NAME:"ObjSerializer",SERIALIZER_NAME:null,getSerializerName:function(){return this.SERIALIZER_NAME},serializeValue:function(e){return e},deserializeValue:function(e,t){return e},propNameToStorageName:function(e){return e},storageNameToPropName:function(e){return e},getObjCustomSaveMethod:function(e){return e.doSaveObj},getObjCustomLoadMethod:function(e){return e.doLoadObj},getObjCustomPropSaveMethod:function(e){return e.doSaveProp},getObjCustomPropLoadMethod:function(e){return e.doLoadProp},isUndefined:function(e){return DataType.isUndefinedValue(e)},isNull:function(e){return null===e},isNaN:function(e){return e!=e},isFunction:function(e){return DataType.isFunctionValue(e)},isArray:function(e){return DataType.isArrayValue(e)},isDate:function(e){return DataType.isDateValue(e)},isObject:function(e){return DataType.isObjectValue(e)},isObjectEx:function(e){return DataType.isObjectExValue(e)},isSimpleType:function(e){var t=typeof e;return"string"==t||"number"==t||"boolean"==t||"undefined"==t||this.isNull(e)},isComplexType:function(e){return!this.isSimpleType(e)},createChildStorageNode:function(e,t,r){},appendArrayItemStorageNode:function(e,t,r){},getNameForArrayItemStorageNode:function(e){return this.getDefaultArrayItemStorageName()},getChildStorageNode:function(e,t){},getAllArrayItemStorageNodes:function(e){},getAllStoredStorageNames:function(e){},setStorageNodeExplicitType:function(e,t){},getStorageNodeExplicitType:function(e){},getStorageNodeName:function(e){},isComplexStorageNode:function(e){},isComplexArrayItemStorageNode:function(e){},isSimpleStorageNode:function(e){},getValueExplicitType:function(e){return e instanceof ObjectEx?e.getClassName():this.isObject(e)?DataType.OBJECT:this.isArray(e)?DataType.ARRAY:this.isDate(e)?DataType.DATE:typeof e},getDefaultArrayItemStorageName:function(){return"item"},getDefaultDateStorageName:function(){return"date"},save:function(e,t,r){var i=[],n=this.saveObj(e,t,r,e,t,i);if(n)for(var o=0,a=i.length;o<a;++o)i[o]&&this.isFunction(i[o].allSaved)&&i[o].allSaved(e);return n},saveObj:function(e,t,r,i,n,o){if("object"==typeof e){var a=this.getObjCustomSaveMethod(e);if(a)return a(e,t,r||{},this,i,n,o)}var s=this.doSave(e,t,r||{},i,n,o);return s&&(o||console.log(e,e.getClassName&&e.getClassName()),o.push(e),this.isFunction(e.saved)&&e.saved(i)),s},doSave:function(e,t,r,i,n,o){return"object"==typeof e&&(e instanceof ObjectEx?this.doSaveObjectEx(e,t,r,i,n,o):this.isArray(e)?this.doSaveArray(e,t,r,i,n,o):this.isDate(e)?this.doSaveDate(e,t,r,i,n,o):this.doSaveSimpleObject(e,t,r,i,n,o)),this.setStorageNodeExplicitType(t,this.getValueExplicitType(e)),e},doSaveSimpleObject:function(e,t,r,i,n,o){for(var a in e)if(e.hasOwnProperty(a)){var s,l=e[a];this.isComplexType(l)&&(s=this.getValueExplicitType(l)),this.doSaveFieldValue(e,a,l,t,s,r,i,n,o)}},doSaveArray:function(e,t,r,i,n,o){for(var a=0,s=e.length;a<s;++a){var l=e[a],u=this.getNameForArrayItemStorageNode(l);if(this.isComplexType(l)){var d=this.appendArrayItemStorageNode(t,this.propNameToStorageName(u),this.isArray(l));this.setStorageNodeExplicitType(d,this.getValueExplicitType(l)),this.saveObj(l,d,r,i,n,o)}else this.doAppendArrayItemSimpleValue(this.serializeValue(l),typeof l,t)}},doSaveDate:function(e,t,r,i,n,o){var a=e.toUTCString();this.doSaveSimpleValue(e,this.propNameToStorageName(this.getDefaultDateStorageName()),this.serializeValue(a),DataType.DATE,t,r,i,n)},doSaveObjectEx:function(e,t,r,i,n,o){for(var a=e.getAllPropList(),s=r.propFilter,l=0,u=a.getLength();l<u;++l){var d=a.getPropInfoAt(l);if(!s||s(d,e)){var c=this.getObjCustomPropSaveMethod(e),h=!1;if(c&&(h=c(e,d,t,r,this,i,n,o)),!h)if(d.serializable)("function"==typeof d.serializable?d.serializable.apply(e):d.serializable)&&this.doSaveObjectExProp(e,d,t,r,i,n,o)}}},doSaveObjectExProp:function(e,t,r,i,n,o,a){var s=t.name,l=t.dataType,u=e.getPropValue(s);if(i.saveDefaultValues||u!==t.defaultValue){var d;u instanceof ObjectEx?u.getClassName()!=l&&(d=u.getClassName()):this.isComplexType(u)&&(d=this.getValueExplicitType(u))==l&&(d=void 0);var c=e.getPropSerializationName(s,this.getSerializerName())||s;this.doSaveFieldValue(e,c,u,r,d,i,n,o,a)}},doSaveFieldValue:function(e,t,r,i,n,o,a,s,l){if("function"!=typeof r)if(this.isComplexType(r)){var u=this.createChildStorageNode(i,this.propNameToStorageName(t),this.isArray(r));n&&this.setStorageNodeExplicitType(u,n),this.saveObj(r,u,o,a,s,l)}else this.doSaveSimpleValue(e,this.propNameToStorageName(t),this.serializeValue(r),this.getValueExplicitType(r),i,o,a,s,l)},doSaveSimpleValue:function(e,t,r,i,n,o,a,s,l){},doAppendArrayItemSimpleValue:function(e,t,r){},load:function(e,t){var r=[],i=this.loadObj(e,t,e,t,r);if(i)for(var n=0,o=r.length;n<o;++n)r[n]&&this.isFunction(r[n].allLoaded)&&r[n].allLoaded(e||i);return i},loadObj:function(e,t,r,i,n){if(!e){var o=this.getStorageNodeExplicitType(t);if(!o)return this.doLoadUntypedNode?this.doLoadUntypedNode(t,r,i):null;e=DataType.createInstance(o)}if(r||(r=e),"object"==typeof e){var a=this.getObjCustomLoadMethod(e);if(a)return a(e,t,this,r,i,n)}var s=this.doLoad(e,t,r,i,n);if(s){var l=e||s;n.push(l),this.isFunction(l.loaded)&&l.loaded(r)}return s},doLoad:function(e,t,r,i,n){this.getStorageNodeExplicitType(t);if("object"==typeof e)if(e instanceof ObjectEx){e.beginUpdate();try{e=this.doLoadObjectEx(e,t,r,i,n)}finally{e.endUpdate()}}else e=this.isArray(e)?this.doLoadArray(e,t,r,i,n):this.isDate(e)?this.doLoadDate(e,t,r,i,n):this.doLoadSimpleObject(e,t,r,i,n);return e},doLoadArray:function(e,t,r,i,n){for(var o=this.getAllArrayItemStorageNodes(t),a=0,s=o.length;a<s;++a){var l=o[a];if(this.isComplexArrayItemStorageNode(l)){var u,d=this.getStorageNodeExplicitType(l)||this.getStorageNodeName(l);d?(u=DataType.createInstance(d),this.loadObj(u,l,r,i,n)):(u={},this.loadObj(u,l,r,i,n)),e.push(u)}else{var c=this.deserializeValue(this.doGetArrayItemSimpleStorageValue(l));e.push(c)}}return e},doLoadDate:function(e,t,r,i,n){var o=this.propNameToStorageName(this.getDefaultDateStorageName()),a=this.doLoadSimpleValue(e,o,DataType.DATE,t,r,i,n);if(a){var s=new Date(a);return e.copyFrom(s),e}},doLoadSimpleObject:function(e,t,r,i,n){for(var o=this.getAllStoredStorageNames(t),a=0,s=o.length;a<s;++a){var l=o[a],u=this.storageNameToPropName(l),d=this.getChildStorageNode(t,l);if(d){var c,h=this.getStorageNodeExplicitType(d);c=h?DataType.createInstance(h):{},this.loadObj(c,d,r,i,n),e[u]=c}else{var p=this.doLoadSimpleValue(e,l,null,t,r,i,n);e[u]=p}}return e},doLoadObjectEx:function(e,t,r,i,n){for(var o=e.getAllPropList(),a=0,s=o.getLength();a<s;++a){var l=o.getPropInfoAt(a);if(l.serializable){var u=this.getObjCustomPropLoadMethod(e),d=!1;u&&(d=u(e,l,t,this,r,i,n)),d||this.doLoadObjectExProp(e,l,t,r,i,n)}}return e},doLoadObjectExProp:function(e,t,r,i,n,o){var a=t.name,s=t.dataType,l=e.getPropSerializationName(a,this.getSerializerName())||a,u=this.doLoadFieldValue(e,l,r,s,i,n,o);null!=u&&e.setPropValue(a,u,!0)},doLoadFieldValue:function(e,t,r,i,n,o,a){var s,l=!1;if(DataType.isComplexType(i)){var u=this.getChildStorageNode(r,this.propNameToStorageName(t));if(u){var d=this.getStorageNodeExplicitType(u);s=d&&d!=i?DataType.createInstance(d):DataType.createInstance(i),this.loadObj(s,u,n,o,a),l=!0}}return!DataType.isSimpleType(i)&&l||(s=this.doLoadSimpleValue(e,this.propNameToStorageName(t),i,r,n,o,a)),s},doLoadSimpleValue:function(e,t,r,i,n,o,a){var s=this.doLoadSimpleStorageValue(t,i,n,o,a);return this.deserializeValue(s,r)},doLoadSimpleStorageValue:function(e,t,r,i,n){},doGetArrayItemSimpleStorageValue:function(e){}}),t=Class.create(e,{CLASS_NAME:"JsonObjSerializer",TYPE_TAG_NAME:"__type__",createChildStorageNode:function(e,t,r){var i=r?[]:{};return e[t]=i,i},appendArrayItemStorageNode:function(e,t,r){var i=r?[]:{};return e.push(i),i},getChildStorageNode:function(e,t){var r=e[t];return this.isSimpleType(r)&&(r=null),r},getAllArrayItemStorageNodes:function(e){return Array.prototype.slice.call(e)},getAllStoredStorageNames:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&r!=this.TYPE_TAG_NAME&&t.push(r);return t},isComplexStorageNode:function(e){return this.isComplexType(e)},isComplexArrayItemStorageNode:function(e){return this.isComplexStorageNode(e)},isSimpleStorageNode:function(e){return this.isSimpleType(e)},setStorageNodeExplicitType:function(e,t){this.isArray(e)||(e[this.TYPE_TAG_NAME]=t)},getStorageNodeExplicitType:function(e){var t=e[this.TYPE_TAG_NAME]||null;return!t&&this.isArray(e)?DataType.ARRAY:t},doSaveSimpleValue:function(e,t,r,i,n,o,a,s,l){n[t]=r},doAppendArrayItemSimpleValue:function(e,t,r){return r.push(e)},doLoadSimpleStorageValue:function(e,t,r,i,n){return t[e]},doLoadUntypedNode:function(e,t,r,i){return e},doGetArrayItemSimpleStorageValue:function(e){return e}}),r=Class.create(e,{CLASS_NAME:"XmlObjSerializer",TYPE_TAG_NAME:"dataType",UNSUIT_PROPNAME_PREFIX:"__.",getLocalName:function(e){return e.localName||e.baseName||e.nodeName},getElemTextValue:function(e){for(var t="",r=0,i=e.childNodes.length;r<i;++r)e.childNodes[r].nodeType==Node.TEXT_NODE&&(t+=e.childNodes[r].nodeValue);return t},serializeValue:function(e){return DataType.StringUtils.serializeValue(e)},deserializeValue:function(e,t){return DataType.StringUtils.deserializeValue(e,t)},propNameToStorageName:function(e){var t=e.toString().charAt(0).toLowerCase();return"_"===t||t>="a"&&t<="z"?e:this.UNSUIT_PROPNAME_PREFIX+e},storageNameToPropName:function(e){return"string"!=typeof e?e:0===e.indexOf(this.UNSUIT_PROPNAME_PREFIX)?e.substr(this.UNSUIT_PROPNAME_PREFIX.length):e},createChildStorageNode:function(e,t,r){var i=e.ownerDocument.createElement(t);return e.appendChild(i),i},appendArrayItemStorageNode:function(e,t,r){return this.createChildStorageNode(e,t,r)},getAllArrayItemStorageNodes:function(e){for(var t=[],r=0,i=e.childNodes.length;r<i;++r){var n=e.childNodes[r];n.nodeType==Node.ELEMENT_NODE&&t.push(n)}return t},getAllStoredStorageNames:function(e){for(var t=[],r=0,i=e.childNodes.length;r<i;++r){var n=e.childNodes[r];n.nodeType==Node.ELEMENT_NODE&&this.getLocalName(n)!=this.TYPE_TAG_NAME&&t.push(this.getLocalName(n))}for(r=0,i=e.attributes.length;r<i;++r){var o=e.attributes[r];this.getLocalName(o)!=this.TYPE_TAG_NAME&&t.push(this.getLocalName(o))}return t},getChildStorageNode:function(e,t){for(var r=null,i=0,n=e.childNodes.length;i<n;++i){var o=e.childNodes[i];o.nodeType==Node.ELEMENT_NODE&&this.getLocalName(o)==t&&(r=o)}return r},isComplexStorageNode:function(e){return e.nodeType==Node.ELEMENT_NODE},isComplexArrayItemStorageNode:function(e){return this.isComplexStorageNode(e)&&e.attributes.length&&!this.getElemTextValue(e).trim()},isSimpleStorageNode:function(e){return e.nodeType==Node.ATTRIBUTE_NODE},setStorageNodeExplicitType:function(e,t){e.setAttribute(this.TYPE_TAG_NAME,t)},getStorageNodeExplicitType:function(e){return e.getAttribute(this.TYPE_TAG_NAME)||null},getStorageNodeName:function(e){var t=e.tagName;return t==this.getDefaultArrayItemStorageName()?null:t},doSaveSimpleObject:function(e,t,r,i,n,o){return this.tryApplySuper("doSaveSimpleObject",[e,t,r,i,n,o])},doSaveSimpleValue:function(e,t,r,i,n,o,a,s,l){n.setAttribute(t,r)},doAppendArrayItemSimpleValue:function(e,t,r){var i=this.appendArrayItemStorageNode(r,this.propNameToStorageName(this.getDefaultArrayItemStorageName()),!1),n=i.ownerDocument.createTextNode(e);i.appendChild(n)},doLoadSimpleStorageValue:function(e,t,r,i,n){return t.getAttribute(e)||void 0},doGetArrayItemSimpleStorageValue:function(e){return this.getElemTextValue(e)}}),i={_serializerClasses:{},_defaultName:null,registerSerializer:function(e,t,r){var n="string"==typeof t?ClassEx.findClass(t):t;i._serializerClasses[e]=n,r&&(i._defaultName=e),ClassEx.getPrototype(t).SERIALIZER_NAME=e},getSerializer:function(e){var t=e||i._defaultName;if(t){var r=i._serializerClasses[t];return r?new r:null}return null}};i.registerSerializer("json",t,!0),i.registerSerializer("xml",r),Class.ObjSerializerFactory=i,ClassEx.extend(ObjectEx,{getPropSerializationName:function(e,t){return e},saveObj:function(e,t,r){return(t?"string"==typeof t?i.getSerializer(t):t:i.getSerializer()).save(this,e,r)},loadObj:function(e,t){var r,n;r=t?"string"==typeof t?i.getSerializer(t):t:i.getSerializer(),this.beginUpdate();try{n=r.load(this,e)}finally{this.endUpdate()}return n}}),Object.extend(ClassEx,{saveObj:function(e,t,r,n){return(r?"string"==typeof r?i.getSerializer(r):r:i.getSerializer()).save(e,t,n)},loadObj:function(e,t,r){return(r?"string"==typeof r?i.getSerializer(r):r:i.getSerializer()).load(e,t)}}),Object.extend(DataType,{valueToJson:function(e,t){if(DataType.isSimpleValue(e))return JSON.stringify(e);var r=DataType.isArrayValue(e)?[]:{};return ClassEx.saveObj(e,r,"json",t),JSON.stringify(r)},jsonToValue:function(e){var t=JSON.parse(e);return!t||DataType.isSimpleValue(t)?t:ClassEx.loadObj(null,t,"json")}})}();var Kekule="object"==typeof Kekule?Kekule:{};if((Kekule=Object.extend(Kekule,{LIBNAME:"Kekule.js",LIBNAME_CORE:"Kekule",VERSION:"1.0.2.25020100",LOADED:!1,_afterLoadSysProcedures:[],_afterLoadUserProcedures:[],PROP_AUTO_TITLE:!0}))._loaded=function(){if(!Kekule.LOADED){Kekule.LOADED=!0;for(var e=Kekule._afterLoadSysProcedures;e.length;){(t=e.shift())&&t()}for(e=Kekule._afterLoadUserProcedures;e.length;){var t;(t=e.shift())&&t()}var r=Kekule.$jsRoot&&Kekule.$jsRoot.document;if(r&&r.createEvent&&r.body&&r.body.dispatchEvent){var i=r.createEvent("Event");i.initEvent("kekuleload",!0,!0),r.body.dispatchEvent(i)}}},Kekule._isLoaded=function(){return Kekule.LOADED},Kekule._registerAfterLoadSysProc=function(e){e&&(Kekule.LOADED?e():Kekule._afterLoadSysProcedures.push(e))},Kekule._ready=function(e){e&&(Kekule.LOADED?e():Kekule._afterLoadUserProcedures.push(e))},Kekule._registerAfterLoadProc=Kekule._ready,Kekule.$jsRoot=this,"object"==typeof window&&window&&window.document?Kekule.$jsRoot=window:"object"==typeof global?Kekule.$jsRoot=global:"object"==typeof self&&(Kekule.$jsRoot=self),Kekule.$jsRoot.Kekule=Kekule,"object"==typeof window&&window&&window.document&&(Kekule.window=window),Kekule.$document=this&&this.document||null,Kekule.scriptSrcInfo||(Kekule.scriptSrcInfo=Kekule.$jsRoot.__$kekule_load_info__),Kekule.scriptSrcInfo&&Kekule.scriptSrcInfo.language&&(Kekule.language=Kekule.scriptSrcInfo.language),!Kekule.scriptSrcInfo&&Kekule.$jsRoot.document&&(Kekule.scriptSrcInfo=function(e){var t,r=/^(.*\/?)kekule\..*\.js(\?.*)?$/;if(e&&e.currentScript&&e.currentScript.src)(t=decodeURIComponent(e.currentScript.src))&&(o=t.match(/^(.*[\/\\])[^\/\\]*\.js(\?.*)?$/));else for(var i=document.getElementsByTagName("script"),n=i.length-1;n>=0;--n){var o,a=i[n];if(t=decodeURIComponent(a.src))if(o=t.match(r))break}if(o){var s=o[2];return s&&(s=s.substr(1)),{src:t,path:o[1],paramStr:s,useMinFile:!0}}return null}(Kekule.$jsRoot.document)),Kekule.scriptSrcInfo||(Kekule.scriptSrcInfo={useMinFile:!0}),Kekule.environment={scriptInfo:Kekule.scriptSrcInfo,isNode:!("object"!=typeof process||"object"!=typeof process.versions||void 0===process.versions.node),isWeb:!("object"!=typeof window||!window.document),variables:{},getEnvVar:function(e){var t=Kekule.environment.variables[e];return void 0===t&&(t=Kekule.$jsRoot._kekule_environment_&&Kekule.$jsRoot._kekule_environment_[e]),t},setEnvVar:function(e,t){Kekule.environment.variables[e]=t}},Kekule.scriptSrcInfo&&(Kekule.environment.nodeModule=Kekule.scriptSrcInfo.nodeModule,Kekule.environment.nodeRequire=Kekule.scriptSrcInfo.nodeRequire,Kekule.environment.setEnvVar("kekule.path",Kekule.scriptSrcInfo.path),Kekule.environment.setEnvVar("kekule.scriptSrc",Kekule.scriptSrcInfo.src),Kekule.environment.setEnvVar("kekule.useMinJs",Kekule.scriptSrcInfo.useMinFile),Kekule.environment.setEnvVar("kekule.language",Kekule.scriptSrcInfo.language)),Kekule.$jsRoot.__$kekule_scriptfile_utils__&&(Kekule._ScriptFileUtils_=Kekule.$jsRoot.__$kekule_scriptfile_utils__,Kekule.ScriptFileUtils=Kekule._ScriptFileUtils_,Kekule.modules=function(e,t){var r=[];r="string"==typeof e?[e]:e;var i=Kekule.scriptSrcInfo;if(i){Kekule._ScriptFileUtils_.loadModuleScriptFiles(r,Kekule.isUsingMinJs(),Kekule.getScriptPath(),i,function(e){t&&t(e)});return this}return t&&t(new Error("Kekule script src info not found, can not load modules dynamicly.")),this},Kekule.loadModules=Kekule.modules),Kekule.scriptSrcInfo&&(Kekule.scriptSrcInfo.getValue=function(e){return Kekule.scriptSrcInfo[e]},Kekule.scriptSrcInfo.setValue=function(e,t){Kekule.scriptSrcInfo[e]=t}),Kekule.getScriptPath=function(){return Kekule.environment.getEnvVar("kekule.path")||Kekule.scriptSrcInfo.path},Kekule.getScriptSrc=function(){return Kekule.environment.getEnvVar("kekule.scriptSrc")||Kekule.scriptSrcInfo.src},Kekule.getDividedMinSubPath=function(){return Kekule.environment.getEnvVar("kekule.dividedMinSubPath")||Kekule.scriptSrcInfo.dividedMinSubPath},Kekule.isUsingMinJs=function(){var e=Kekule.environment.getEnvVar("kekule.useMinJs");return void 0===e&&(e=Kekule.scriptSrcInfo.useMinFile),e},Kekule.getLanguage=function(){return Kekule.environment.getEnvVar("kekule.language")||Kekule.scriptSrcInfo.language},Kekule._getStyleSheetBasePath=function(){return Kekule.isUsingMinJs()?Kekule.getScriptPath():Kekule.getScriptPath()+"widgets/"},Kekule.getStyleSheetUrl=function(){var e=Kekule.environment.getEnvVar("kekule.themeUrl");e||(e=Kekule._getStyleSheetBasePath()+"themes/default/kekule.css");return e},Kekule.$jsRoot&&Kekule.$jsRoot.addEventListener&&Kekule.$jsRoot.postMessage&&Kekule.$jsRoot.addEventListener("message",function(e){"kekule-sys-info-query"===e.data&&Kekule.$jsRoot.postMessage({msg:"kekule-sys-info-result",libName:Kekule.LIBNAME,version:Kekule.VERSION},"*")},!1),Kekule.Dev={},Kekule.Class=Class,Kekule.ClassEx=ClassEx,Kekule.ObjectEx=ObjectEx,Kekule.DataType=DataType,function(e){"use strict";function t(e){var t=e.split(/[-|_]/);return{language:t[0],local:t[1]}}var r=Kekule.$jsRoot||e||{},i=Kekule,n=Kekule.getLanguage()||(r&&r.navigator?navigator.language||navigator.browserLanguage:"en-US");i.language=n;var o=t(n),a=t("en-US"),s=[o.language+"_"+o.local,o.language,a.language+a.local,a.language];Kekule.Localization={},Kekule.LocalizationRes={};var l=Kekule.LocalizationRes;function u(e,t,r){var i=r||l[e];return!i&&t&&(i={},l[e]=i),i}function d(e,t,r){var i=u(t,!1,r);if(i){var n=Object.getCascadeFieldValue(e,i);if(void 0!==n)return n}}function c(e,t,r){for(var i=(t?[t]:[]).concat(s),n=0,o=i.length;n<o;++n){var a=d(e,i[n],r);if(void 0!==a)return a}}function h(e,t,r){var i=c(e,t,r);if(void 0!==i)return i;Kekule.error("Can not find localization resource: "+e)}var p,g=[],f=!!(r||r.window).__kekuleMarkLocalizationModuleInfo__,C={};function m(e,t,r,i){if(r){var n=d(t,e,i);(function(e,t,r,i,n){var o=u(r,i,n);!!o&&Object.setCascadeFieldValue(e,t,o,i)})(t,n?Object.extendEx(n,r,{cascade:!0}):JSON.parse(JSON.stringify(r)),e,!0,i)}}Kekule.$L=h,Kekule.Localization.getLanguages=function(){var e=[];for(var t in l)e.push(t);return e},Kekule.Localization.getValue=h,Kekule.Localization.findValue=c,Kekule.Localization.getModuleInfos=function(){return C},Kekule.Localization.setCurrModule=function(e){p=e,g.indexOf(e)<0&&g.push(e)},Kekule.Localization.getModuleNames=function(){return g},Kekule.Localization.addResource=function(e,t,r){(m(e,t,r),f)&&m(e,t,r,function(e,t){e=e||"GLOBAL";var r=Object.getCascadeFieldValue(e,C);return!r&&t&&(r=Object.setCascadeFieldValue(e,{},C,!0)),r}(p,!0))}}(this),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("general"),Kekule.Localization.addResource("en","Texts",{UNNAMED:"unnamed"}),Kekule.Localization.addResource("en","ErrorMsg",{MODULE_NOT_LOADED:"Module {0} is not loaded",UNIT_NOT_FOUND:"Unit not found: {0}",STANDARD_UNIT_OF_CATEGORY_NOT_FOUND:"Standard unit of category {0} not found",UNABLE_TO_CONVERT_BETWEEN_UNITS:"Unable to convert between units {0} and {1}",NON_OWN_PROPERTY_CANNOT_BE_REPLACED:"Only directly owned property of object can be replaced",EMPTY_DOC:"Document is empty",ELEMENT_NOTSET:"Element not set",EMPTY_RESURI:"Resource URI is empty",CANNOT_LOAD_RES_OF_URI:"Can not load resource of URI: ",LIST_ITEM_CLASS_MISMATCH:"Mismatched item class, can not add to list",CANNOT_CLEAR_WEAKMAP:"Can not clear a weak map",CANNOT_GET_KEY_LIST_IN_WEAKMAP:"Can not get key array from a weak map",CANNOT_GET_VALUE_LIST_IN_WEAKMAP:"Can not get value array from a weak map",INVALID_CHEMELEMENT:"Invalid chemical element",INVALID_ISOTOPE:"Invalid isotope",COORD_STICK_NOT_ALLOWED_ON_CLASS:"Coordinate sticking is not allowed in this type of object",INVALID_STICK_TARGET_OBJ:"Invalid sticking target",UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ:"Unable to stick to object with a different owner",UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD:"Unable to stick to object without absolute coordinates",STICK_RECURSION_NOT_ALLOWED:"Stick recursion is not allowed",UNABLE_ADD_MISTYPED_NODE:"Unable to link mistyped node to connector",UNABLE_ADD_DIFF_OWNER_OBJ:"Object with different owner can not be linked to connector",CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH:"Mismatched group item class",SORT_FUNC_UNSET:"Sort function is not set",SOURCE_FRAGMENT_NOT_SET:"Source structure fragment not set",UNABLE_ADD_NONMOLECULE_MAP:"Unable to add non-molecule to reactants or products",CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER:"Can not add object other than node or connector to structure object container",REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND:"Can not find registered canonicalization executor",ERROR_LOADING_FILE:"Error loading file: ",READER_ID_ALREADY_EXISTS:"Can not register reader: id already exists",WRITER_ID_ALREADY_EXISTS:"Can not register writer: id already exists",FAIL_TO_READ_FORMAT:"Fail to load data of format: ",NO_SUITABLE_READER_FOR_FORMAT:"Can not read data of format: ",NO_SUITABLE_READER_FOR_MIMETYPE:"Can not read data of MIME type: ",NO_SUITABLE_READER_FOR_FILEEXT:"Can not read data of file extension: ",NO_SUITABLE_WRITER_FOR_FORMAT:"Can not write data of format: ",NO_SUITABLE_WRITER_FOR_MIMETYPE:"Can not write data of MIME type: ",NO_SUITABLE_WRITER_FOR_FILEEXT:"Can not write data of file extension: ",AJAX_FILELOADER_NOT_FOUND:"AJAX file loader not found, can not load URL",FAIL_TO_LOAD_FILE_URL:"Fail to load file of URL: ",CML_ELEM_READER_NOT_FOUND:"Reader for element <{0}> not found",ATOMID_NOT_EXISTS:"Atom id not exists: ",BONDID_NOT_EXISTS:"Bond id not exists: ",CML_ELEM_WRITER_TYPE_INPROPER:"{0} is not a proper CML element writer for {1}",CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT:"Can not output content to empty element",UNABLE_TO_OUTPUT_AS_CML:"Unable to output object <{0}> to CML data",MDL_CTAB_ATOM_CANNOT_CREATE:"Can not create atom from source MDL format data",MDL_CTAB_BOND_CANNOT_CREATE:"Can not create bond from source MDL format data",CAN_NOT_WRITE_NON_MOLECULE_TO_MOL:"Object is not a molecule and can not be output to connection table",MOLECULE_HAS_NO_CTAB_TO_OUTPUT:"Molecule has no connection table and can not be output to MDL format",NOT_MDL2000_FORMAT_DATA:"Data format wrong: not MDL 2000",NOT_MDL_RXN_DATA:"Not MDL Reaction(RXN) data",MALFORMED_MDL3000_COUNTLINE:"Malformed MDL 3000 count line",MDL3000_ATOMBLOCK_NOT_FOUND:"Atom block not found, malformed MDL 3000 data?",NOT_MDL_FORMAT_DATA:"Data format wrong: not MDL 2000 or 3000",NOT_MDL2000_RXN_DATA:"Not MDL RXN 2000 data",NOT_MDL3000_RXN_DATA:"Not MDL RXN 3000 data",NOT_MDL3000_RXN_COUNTLINE:"Error in reading RXN 3000 count line",MDL_OUTPUT_DATATYPE_NOT_TEXT:"MDL data can not be output to non text format",MDL_INPUT_DATATYPE_NOT_TEXT:"Non text format is not a legal MDL source data",UNABLE_TO_OUTPUT_AS_MDL:"Unable to output object <{0}> to MDL data",KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT:"Non text or JSON format data is not a legal KCJ source",KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT:"Can not output as non text or JSON data",KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT:"Non text or DOM data is not a legal KCX source",KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT:"Can not output as non text or DOM data",JSON_SERIALIZER_NOT_EXISTS:"Serializer for JSON not exists",XML_SERIALIZER_NOT_EXISTS:"Serializer for XML not exists",JCAMP_DATA_WITHOUT_TITLE_LINE:"Malformed JCAMP format data, not started with TITLE label",JCAMP_OTHER_LABEL_BEFORE_TITLE_LINE:"Malformed JCAMP format data, other labels before the TITLE label",JCAMP_MORE_THAN_ONE_ROOT_BLOCK:"Malformed JCAMP format data, root block not unique",JCAMP_MORE_THAN_TWO_NEST_LEVEL:"Malformed JCAMP format data, block nested level should not exceed 2",JCAMP_ASDF_FORMAT_ERROR_WITH_STR:"Malformed JCAMP ASDF String: {0}",JCAMP_DATA_TABLE_X_VALUE_CHECK_ERROR:"JCAMP data table X value check failed!",JCAMP_DATA_TABLE_Y_VALUE_CHECK_ERROR:"JCAMP data table Y value check failed!",JCAMP_DATA_TABLE_VALUE_FIRST_LAST_NOT_MATCH:"JCAMP data table first/last values not match",JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR:"Malformed JCAMP variable list format: {0}",JCAMP_DATA_TABLE_VAR_LIST_FORMAT_UNSUPPORTED:"Unsupported JCAMP variable list format: {0}",JCAMP_NTUPLES_BEGIN_END_NAME_NOT_MATCH:"Ntuples name not match in begin/end labels: {0} and {1}",JCAMP_NTUPLES_PAGE_DECLARATION_FORMAT_ERROR:"Malformed JCAMP ntuples page declaration: {0}",JCAMP_LDR_TARGET_UNIT_NOT_MATCH_WITH_DETAIL:"The unit of property {0} ({1}) can not be converted to the request one ({2}) for JCAMP {3} LDR",FAILED_TO_ASSIGN_SYMBOL_TO_VARIABLE:"Fail to assign a symbol to variable {0}",JCAMP_IMPLICIT_HYDROGEN_COUNT_NOT_MATCH_DETAIL:"Unmatched implicit hydrogen count for atom {0}({1}), expect {2} but found {3}",VISIBLE_DATA_RANGE_IS_EMPTY:"The visible range of data is empty, unable to draw the spectrum",INAVAILABLE_AUTOSCALE_REF_LENGTH:"Can not determine the length for calculation of auto scale",FORMULA_RENDERER_3D_NOT_AVAILABLE:"3D renderer for molecule formula is not available",CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ:"Can not find suitable renderer for object",THREEJS_LIB_NOT_UNAVAILABLE:"Three.js not available, try to include it through the <script> tag or import the module by Kekule.externalResourceManager.register method",THREEJS_DRAWING_NOT_UNAVAILABLE:"Webgl, Canvas or SVG is not supported in this browser, please upgrade to a modern one",CANVAS2D_NOT_UNAVAILABLE:"Canvas is not supported in this browser, please upgrade to a modern one",RAPHAEL_LIB_NOT_UNAVAILABLE:"Raphael.js not available, try to import it through the <script> tag",RAPHAEL_SVG_VML_UNAVAILABLE:"SVG or VML is not supported in this browser, please upgrade to a modern one",CALC_TERMINATED_BY_USER:"Calculation terminated by user",CALC_SERVICE_UNAVAILABLE:'Calculation service "{0}" is unavailable'}),Kekule.Localization.addResource("en","ErrorCheckMsg",{GENERAL_ERROR_WITH_CODE:"Error code: {0}",ATOM_VALENCE_ERROR_WITH_SUGGEST:"Abnormal valence {1} of atom {0}, the possible value is {2}",ATOM_VALENCE_ERROR_WITH_SUGGESTS:"Abnormal valence {1} of atom {0}, the possible values are {2}",BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"The bond order ({0}) exceeds the maximum allowed value ({1})",BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"The bond order of {0} ({1}) exceeds the maximum allowed value {2}",NODE_DISTANCE_TOO_CLOSE:"Atoms/subgroups are very close to each other",NODE_DISTANCE_TOO_CLOSE_WITH_LABEL:"Atoms/subgroups ({0}) are very close to each other",TITLE_CHANGE_BOND_ORDER_TO:"Change bond order to {0}",DESCRIPTION_CHANGE_BOND_ORDER_TO:"Change bond order from {0} to {1}",TITLE_MERGE_TO:"Merge {0} to {1}",DESCRIPTION_MERGE_TO:"Merge node {0} to {1}"}),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("widget"),Kekule.Localization.addResource("en","WidgetTexts",{CAPTION_OK:"OK",CAPTION_CANCEL:"Cancel",CAPTION_YES:"Yes",CAPTION_NO:"No",CAPTION_BROWSE_COLOR:"Browse colors",HINT_BROWSE_COLOR:"Browse more colors",S_COLOR_UNSET:"(unset)",S_COLOR_DEFAULT:"(default)",S_COLOR_MIXED:"(mixed)",S_COLOR_TRANSPARENT:"(transparent)",S_OBJECT_UNSET:"(none)",S_ITEMS:"item(s)",S_OBJECT:"object",S_VALUE_UNSET:"(Unset)",CAPTION_MENU:"Menu",HINT_MENU:"Open menu",S_INSPECT_NONE:"(none)",S_INSPECT_OBJECTS:"({0} objects)",S_INSPECT_ID_OBJECT:"{0}: {1}",S_INSPECT_ANONYMOUS_OBJECT:"({0})",CAPTION_TOGGLE_TEXTWRAP:"Toggle text wrapping",CAPTION_INC_TEXT_SIZE:"Increase text size",CAPTION_DEC_TEXT_SIZE:"Decrease text size",HINT_TOGGLE_TEXTWRAP:"Toggle the state of text wrapping",HINT_INC_TEXT_SIZE:"Increase text size",HINT_DEC_TEXT_SIZE:"Decrease text size",HINT_CHOOSE_FONT_FAMILY:"Choose font family",CAPTION_FIRST_PAGE:"First",CAPTION_LAST_PAGE:"Last",CAPTION_PREV_PAGE:"Prev",CAPTION_NEXT_PAGE:"Next",HINT_FIRST_PAGE:"First page",HINT_LAST_PAGE:"Last page",HINT_PREV_PAGE:"Previous page",HINT_NEXT_PAGE:"Next page",HINT_CURR_PAGE:"Current page",MSG_RETRIEVING_DATA:"Loading data...",CAPTION_DATATABLE_EDIT:"Edit",CAPTION_DATATABLE_DELETE:"Delete",CAPTION_DATATABLE_INSERT:"Insert",HINT_DATATABLE_EDIT:"Edit",HINT_DATATABLE_DELETE:"Delete",HINT_DATATABLE_INSERT:"Insert",CAPTION_ADD_CELL:"+",HINT_ADD_CELL:"Add new cell",CAPTION_REMOVE_CELL:"Remove",HINT_REMOVE_CELL:"Remove cell",CAPTION_CONFIG:"Settings...",HINT_CONFIG:"Change settings",TITLE_IMG_FORMAT_PNG:"PNG format image",TITLE_IMG_FORMAT_JPG:"Jpeg format image",TITLE_IMG_FORMAT_GIF:"GIF format image",TITLE_IMG_FORMAT_SVG:"SVG format image"}),Kekule.Localization.addResource("en","ChemWidgetTexts",{CAPTION_CLEAROBJS:"Clear",CAPTION_LOADFILE:"Load...",CAPTION_LOADDATA:"Load...",CAPTION_SAVEFILE:"Save...",CAPTION_ZOOMIN:"Zoom In",CAPTION_ZOOMOUT:"Zoom Out",CAPTION_RESETZOOM:"Reset Zoom",CAPTION_RESETVIEW:"Reset",CAPTION_ROTATE:"Rotate",CAPTION_ROTATELEFT:"Left Rotate",CAPTION_ROTATERIGHT:"Right Rotate",CAPTION_ROTATEX:"X Rotate",CAPTION_ROTATEY:"Y Rotate",CAPTION_ROTATEZ:"Z Rotate",CAPTION_MOL_DISPLAY_TYPE:"Molecule Display Style",CAPTION_SKELETAL:"Skeletal",CAPTION_CONDENSED:"Condensed",CAPTION_WIRE:"Wire Frame",CAPTION_STICKS:"Sticks",CAPTION_BALLSTICK:"Ball Stick",CAPTION_SPACEFILL:"Space Fill",CAPTION_HIDEHYDROGENS:"Show/hide hydrogens",CAPTION_AUTO_COORD_GENERATION:"Auto Coordinates Generation",CAPTION_OPENEDITOR:"Edit...",CAPTION_CHANGE_SPECTRUM_SECTION:"Switch Spectrum/Section",CAPTION_SET_SPECTRUM_DATA_ASSIGNMENT:"Set Spectrum Data Assignments",CAPTION_EDITOR_DONE:"Done",CAPTION_EDITOR_CANCEL:"Cancel",CAPTION_EDIT_OBJ:"Edit",HINT_CLEAROBJS:"Clear objects",HINT_LOADFILE:"Load from file",HINT_LOADDATA:"Load data",HINT_SAVEFILE:"Save to file",HINT_ZOOMIN:"Zoom in",HINT_ZOOMOUT:"Zoom out",HINT_RESETZOOM:"Reset zoom",HINT_RESETVIEW:"Reset zoom and rotation",HINT_ROTATE:"Rotate",HINT_ROTATELEFT:"Rotate in anticlockwise direction",HINT_ROTATERIGHT:"Rotate in clockwise direction",HINT_ROTATEX:"Rotate around X axis",HINT_ROTATEY:"Rotate around Y axis",HINT_ROTATEZ:"Rotate around Z axis",HINT_MOL_DISPLAY_TYPE:"Change molecule display style",HINT_SKELETAL:"Show molecule in skeletal style",HINT_CONDENSED:"Show molecule in condensed style",HINT_WIRE:"Show molecule in wire frame style",HINT_STICKS:"Show molecule in sticks style",HINT_BALLSTICK:"Show molecule in ball-stick style",HINT_SPACEFILL:"Show molecule in space-fill style",HINT_HIDEHYDROGENS:"Show/hide hydrogen atoms in model",HINT_AUTO_COORD_GENERATION:"Generate coordinates for molecule atoms",HINT_OPENEDITOR:"Open an editor to modify displayed object",HINT_CHANGE_SPECTRUM_SECTION:"Switch spectrum or data section",HINT_SET_SPECTRUM_DATA_ASSIGNMENT:"Link chem object to spectrum data as assignment",HINT_EDITOR_DONE:"Save the modification",HINT_EDITOR_CANCEL:"Discard the modification",CAPTION_NEWDOC:"New",CAPTION_UNDO:"Undo",CAPTION_REDO:"Redo",CAPTION_COPY:"Copy",CAPTION_COPY_WHOLE:"Copy",CAPTION_CUT:"Cut",CAPTION_PASTE:"Paste",CAPTION_TOGGLE_SELECT:"Toggle select",CAPTION_SELECT_ALL:"Select all",CAPTION_CLONE_SELECTION:"Clone selection",CAPTION_TOGGLE_OBJ_INSPECTOR:"Object inspector",CAPTION_TOGGLE_ISSUE_INSPECTOR:"Issue inspector",CAPTION_TOGGLE_SHOW_ISSUE_MARKERS:"Toggle issue markers",CAPTION_ERASE_SELECTION:"Erase selection",CAPTION_RECHECK_ISSUES:"Recheck issues",CAPTION_MANIPULATE:"Select",CAPTION_MANIPULATE_MARQUEE:"Marquee select",CAPTION_MANIPULATE_LASSO:"Lasso select",CAPTION_MANIPULATE_BRUSH:"Brush select",CAPTION_MANIPULATE_ANCESTOR:"Select molecule",CAPTION_CLIENT_DRAGSCROLL:"Scroll",CAPTION_ERASE:"Erase",CAPTION_TRACK_INPUT:"Track",CAPTION_MOL_BOND:"Bond",CAPTION_MOL_BOND_SINGLE:"Single bond",CAPTION_MOL_BOND_DOUBLE:"Double bond",CAPTION_MOL_BOND_TRIPLE:"Triple bond",CAPTION_MOL_BOND_QUAD:"Quad bond",CAPTION_MOL_BOND_EXPLICIT_AROMATIC:"Aromatic bond",CAPTION_MOL_BOND_WEDGEUP:"Wedge up bond",CAPTION_MOL_BOND_WEDGEUP_INVERTED:"Wedge up bond 2",CAPTION_MOL_BOND_WEDGEDOWN:"Wedge down bond",CAPTION_MOL_BOND_WEDGEDOWN_INVERTED:"Wedge down bond 2",CAPTION_MOL_BOND_CLOSER:"Outer bond",CAPTION_MOL_BOND_WAVY:"Wavy bond",CAPTION_MOL_BOND_DOUBLE_EITHER:"Double Either bond",CAPTION_MOL_BOND_IONIC:"Ionic bond",CAPTION_MOL_BOND_COORDINATE:"Coordinate bond",CAPTION_MOL_BOND_METALLIC:"Metallic bond",CAPTION_MOL_BOND_HYDROGEN:"Hydrogen bond",CAPTION_MOL_BOND_TRANSITION:"transition bond",CAPTION_MOL_BOND_KEKULIZE:"Kekulize",CAPTION_MOL_BOND_HUCKLIZE:"Hucklize",CAPTION_MOL_ATOM:"Atom",CAPTION_MOL_FORMULA:"Formula",CAPTION_MOL_ATOM_AND_FORMULA:"Atom & formula",CAPTION_MOL_CHARGE:"Charge",CAPTION_MOL_CHARGE_CLEAR:"Charge clear",CAPTION_MOL_CHARGE_POSITIVE:"Positive charge",CAPTION_MOL_CHARGE_NEGATIVE:"Negative charge",CAPTION_MOL_ELECTRONIC_BIAS_POSITIVE:"Positive electronic bias",CAPTION_MOL_ELECTRONIC_BIAS_NEGATIVE:"Negative electronic bias",CAPTION_MOL_CHARGE_SINGLET:"Singlet radical",CAPTION_MOL_CHARGE_DOUBLET:"Monoradical",CAPTION_MOL_CHARGE_TRIPLET:"Triplet radical",CAPTION_MOL_ELECTRON_LONEPAIR:"Lone pair",CAPTION_TEXT_BLOCK:"Text block",CAPTION_IMAGE_BLOCK:"Image block",CAPTION_TEXT_IMAGE:"Text & image",CAPTION_MOL_FLEXCHAIN:"Flex chain",CAPTION_MOL_FLEXRING:"Flex ring",CAPTION_REPOSITORY_RING:"Rings",CAPTION_REPOSITORY_RING_3:"Cyclopropane",CAPTION_REPOSITORY_RING_4:"Cyclobutane",CAPTION_REPOSITORY_RING_5:"Cyclopentane",CAPTION_REPOSITORY_RING_6:"Cyclohexane",CAPTION_REPOSITORY_RING_7:"Cycloheptane",CAPTION_REPOSITORY_RING_8:"Cyclooctane",CAPTION_REPOSITORY_RING_AR_6:"Benzene",CAPTION_REPOSITORY_RING_AR_5:"Cyclopentadiene",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1:"Cyclohexane chair 1",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2:"Cyclohexane chair 2",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1:"Cyclohexane Haworth 1",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2:"Cyclohexane Haworth 2",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1:"Cyclopentane Haworth 1",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2:"Cyclopentane Haworth 2",CAPTION_REPOSITORY_METHANE:"Methane",CAPTION_REPOSITORY_FISCHER1:"Fischer projection 1",CAPTION_REPOSITORY_FISCHER2:"Fischer projection 2",CAPTION_REPOSITORY_FISCHER3:"Fischer projection 3",CAPTION_REPOSITORY_SAWHORSE_STAGGERED:"Sawhorse staggered",CAPTION_REPOSITORY_SAWHORSE_ECLIPSED:"Sawhorse eclipsed",CAPTION_REPOSITORY_SUBBOND_MARK:"Substituent bond",CAPTION_REPOSITORY_ARROWLINE:"Arrows & symbols",CAPTION_REPOSITORY_GLYPH:"Glyphs",CAPTION_REPOSITORY_GLYPH_LINE:"Line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"Open arrow arc",CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"Single side open arrow arc",CAPTION_ELECTRON_PUSHING_ARROW:"Electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_DOUBLE:"Double electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_SINGLE:"Single electron pushing arrow",CAPTION_REPOSITORY_HEAT_SYMBOL:"Heat symbol",CAPTION_REPOSITORY_ADD_SYMBOL:"Add symbol",CAPTION_TEXT_FORMAT:"Text format",CAPTION_PICK_COLOR:"Color",CAPTION_FONTNAME:"Font name",CAPTION_FONTSIZE:"Font size",CAPTION_TEXT_DIRECTION:"Text direction",CAPTION_TEXT_DIRECTION_DEFAULT:"Default",CAPTION_TEXT_DIRECTION_LTR:"Left to right",CAPTION_TEXT_DIRECTION_RTL:"Right to left",CAPTION_TEXT_DIRECTION_TTB:"Top to bottom",CAPTION_TEXT_DIRECTION_BTT:"Bottom to top",CAPTION_TEXT_HORIZONTAL_ALIGN:"Text horizontal alignment",CAPTION_TEXT_VERTICAL_ALIGN:"Text vertical alignment",CAPTION_TEXT_ALIGN_DEFAULT:"Default",CAPTION_TEXT_ALIGN_LEADING:"Leading",CAPTION_TEXT_ALIGN_TRAILING:"Trailing",CAPTION_TEXT_ALIGN_CENTER:"Center",CAPTION_TEXT_ALIGN_LEFT:"Left",CAPTION_TEXT_ALIGN_RIGHT:"Right",CAPTION_TEXT_ALIGN_TOP:"Top",CAPTION_TEXT_ALIGN_BOTTOM:"Bottom",CAPTION_NODE_LABEL_DISPLAY_MODE:"Atom label display mode",CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT:"Default",CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN:"Show label",CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN:"Hide label",CAPTION_NODE_LABEL_DISPLAY_MODE_SMART:"Smart",CAPTION_ATOM_MODIFIER:"Atom",CAPTION_ATOM_MODIFIER_MIXED:"[A]",CAPTION_BOND_MODIFIER:"Bond",CAPTION_CHARGE_MODIFIER:"Charge",CAPTION_GLYPH_PATH_MODIFIER:"Path",CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"Reaction arrow & segment",CAPTION_ARC_PATH_MODIFIER:"Arc",CAPTION_MULTI_ARC_PATH_MODIFIER:"Multi-Arc",CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER:"Electron pushing arrow",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"Bond forming arrow",TEXT_CHARGE_POSITIVE:"+",TEXT_CHARGE_NEGATIVE:"-",TEXT_CHARGE_UNKNOWN:"<sup>+</sup>/<sub>-</sub>",TEXT_CHARGE_NONE:"&#8709;",HINT_NEWDOC:"Create new document",HINT_UNDO:"Undo",HINT_REDO:"Redo",HINT_COPY_WHOLE:"Copy objects to internal clipboard",HINT_COPY:"Copy selection to internal clipboard",HINT_CUT:"Cut selection to internal clipboard",HINT_PASTE:"Paste from internal clipboard",HINT_CLONE_SELECTION:"Clone selection",HINT_SELECT_ALL:"Select all",HINT_TOGGLE_SELECT:"Toggle select",HINT_TOGGLE_OBJ_INSPECTOR:"Show or hide object inspector panel",HINT_TOGGLE_ISSUE_INSPECTOR:"Show or hide error inspector panel",HINT_TOGGLE_SHOW_ISSUE_MARKERS:"Show or hide issue markers",HINT_ERASE_SELECTION:"Delete all selected objects",HINT_RECHECK_ISSUES:"Recheck objects in editor for issues",HINT_MANIPULATE:"Select tool",HINT_MANIPULATE_MARQUEE:"Marquee select",HINT_MANIPULATE_LASSO:"Lasso select",HINT_MANIPULATE_BRUSH:"Brush select",HINT_MANIPULATE_ANCESTOR:"Select molecule",HINT_CLIENT_DRAGSCROLL:"Scroll",HINT_ERASE:"Erase tool",HINT_TRACK_INPUT:"Track tool",HINT_MOL_BOND:"Bond tool",HINT_MOL_BOND_SINGLE:"Single bond",HINT_MOL_BOND_DOUBLE:"Double bond",HINT_MOL_BOND_TRIPLE:"Triple bond",HINT_MOL_BOND_QUAD:"Quad bond",HINT_MOL_BOND_EXPLICIT_AROMATIC:"Explicit aromatic bond",HINT_MOL_BOND_WEDGEUP:"Wedge up bond",HINT_MOL_BOND_WEDGEUP_INVERTED:"Wedge up bond 2",HINT_MOL_BOND_WEDGEDOWN:"Wedge down bond",HINT_MOL_BOND_WEDGEDOWN_INVERTED:"Wedge down bond 2",HINT_MOL_BOND_CLOSER:"Outer bond",HINT_MOL_BOND_WAVY:"Wavy bond",HINT_MOL_BOND_DOUBLE_EITHER:"Double either bond",HINT_MOL_BOND_IONIC:"Ionic bond",HINT_MOL_BOND_COORDINATE:"Coordinate bond",HINT_MOL_BOND_METALLIC:"Metallic bond",HINT_MOL_BOND_HYDROGEN:"Hydrogen bond",HINT_MOL_BOND_TRANSITION:"Transition bond",HINT_MOL_BOND_KEKULIZE:"Kekulize, convert explicit aromatic bonds to compartmental single and double ones",HINT_MOL_BOND_HUCKLIZE:"Hucklize, mark bonds on aromatic rings as explicit aromatic ones",HINT_MOL_ATOM:"Atom tool",HINT_MOL_FORMULA:"Formula tool",HINT_MOL_ATOM_AND_FORMULA:"Atom and formula tool",HINT_MOL_CHARGE:"Charge tool",HINT_MOL_CHARGE_CLEAR:"Clear charge and radical",HINT_MOL_CHARGE_POSITIVE:"Positive charge",HINT_MOL_CHARGE_NEGATIVE:"Negative charge",HINT_MOL_ELECTRONIC_BIAS_POSITIVE:"Positive electronic bias",HINT_MOL_ELECTRONIC_BIAS_NEGATIVE:"Negative electronic bias",HINT_MOL_CHARGE_SINGLET:"Singlet radical",HINT_MOL_CHARGE_DOUBLET:"Monoradical",HINT_MOL_CHARGE_TRIPLET:"Triplet radical",HINT_MOL_ELECTRON_LONEPAIR:"Lone pair electrons",HINT_TEXT_BLOCK:"Text block tool",HINT_IMAGE_BLOCK:"Image block tool",HINT_TEXT_IMAGE:"Text and image tool",HINT_MOL_FLEXCHAIN:"Flex carbon chain",HINT_MOL_FLEXRING:"Flex carbon ring",HINT_REPOSITORY_RING:"Ring structures tool",HINT_REPOSITORY_RING_3:"Cyclopropane",HINT_REPOSITORY_RING_4:"Cyclobutane",HINT_REPOSITORY_RING_5:"Cyclopentane",HINT_REPOSITORY_RING_6:"Cyclohexane",HINT_REPOSITORY_RING_7:"Cycloheptane",HINT_REPOSITORY_RING_8:"Cyclooctane",HINT_REPOSITORY_RING_AR_6:"Benzene",HINT_REPOSITORY_RING_AR_5:"Cyclopentadiene",HINT_REPOSITORY_CYCLOHEXANE_CHAIR1:"Cyclohexane chair 1",HINT_REPOSITORY_CYCLOHEXANE_CHAIR2:"Cyclohexane chair 2",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1:"Cyclohexane Haworth 1",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2:"Cyclohexane Haworth 2",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1:"Cyclopentane Haworth 1",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2:"Cyclopentane Haworth 2",HINT_REPOSITORY_SUBBOND_MARK:"Substituent bond",HINT_REPOSITORY_METHANE:"Methane",HINT_REPOSITORY_FISCHER1:"Fischer projection with one chiral center",HINT_REPOSITORY_FISCHER2:"Fischer projection with two chiral centers",HINT_REPOSITORY_FISCHER3:"Fischer projection with three chiral centers",HINT_REPOSITORY_SAWHORSE_STAGGERED:"Sawhorse staggered",HINT_REPOSITORY_SAWHORSE_ECLIPSED:"Sawhorse eclipsed",HINT_REPOSITORY_ARROWLINE:"Arrows and symbols tool",HINT_REPOSITORY_GLYPH:"Glyphs",HINT_REPOSITORY_GLYPH_LINE:"Line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",HINT_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"Open arrow arc",HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"Single side open arrow arc",HINT_REPOSITORY_HEAT_SYMBOL:"Heat symbol",HINT_REPOSITORY_ADD_SYMBOL:"Add symbol",HINT_ELECTRON_PUSHING_ARROW:"Electron pushing arrow",HINT_NODE_LABEL_DISPLAY_MODE:"Atom label display mode",HINT_TEXT_FORMAT:"Set text format",HINT_FONTNAME:"Set font name",HINT_FONTSIZE:"Set font size",HINT_PICK_COLOR:"Select color",HINT_TEXT_DIRECTION:"Set text direction",HINT_TEXT_HORIZONTAL_ALIGN:"Set text horizontal alignment",HINT_TEXT_VERTICAL_ALIGN:"Set text vertical alignment",HINT_CHARGE_NONE:"No charge",HINT_ATOM_MODIFIER:"Set atom",HINT_BOND_MODIFIER:"Set bond",HINT_CHARGE_MODIFIER:"Set charge",HINT_GLYPH_PATH_MODIFIER:"Set path properties",HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"Set reaction arrow and segment properties",HINT_ARC_PATH_MODIFIER:"Set arc properties",HINT_MULTI_ARC_PATH_MODIFIER:"Set multi-arc properties",HINT_ELECTRON_PUSHING_ARROW_MODIFIER:"Set electron pushing arrow properties",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"Set bond forming arrow properties",HINT_USE_ATOM_CUSTOM_COLOR:"(use atom custom color)",CAPTION_LOADDATA_DIALOG:"Load data",CAPTION_LOADDATA_DIALOG_APPENDMODE:"Append to current",CAPTION_SAVEDATA_DIALOG:"Save data",CAPTION_DATA_FORMAT:"Data format:",CAPTION_DATA_SRC:"Input or paste data below:",CAPTION_LOADDATA_FROM_FILE:"Load from file",CAPTION_CHOOSEFILEFORMAT:"Choose file format",CAPTION_SELECT_FORMAT:"Select format:",CAPTION_PREVIEW_FILE_CONTENT:"Preview: ",S_DEF_SAVE_FILENAME:"Unnamed",CAPTION_ATOMLIST_PERIODIC_TABLE:"more...",CAPTION_RGROUP:"Sub group",CAPTION_VARIABLE_ATOM:"Variable Atom (list)",CAPTION_VARIABLE_NOT_ATOM:"Variable Atom (not list)",CAPTION_PSEUDOATOM:"Pseudoatom",CAPTION_DUMMY_ATOM:"Dummy Atom",CAPTION_HETERO_ATOM:"Hetero Atom",CAPTION_ANY_ATOM:"Any Atom",CAPTION_ATOM:"Atom",CAPTION_SUBGROUP:"Subgroup",CAPTION_PERIODIC_TABLE_DIALOG:"Periodic table",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM:"Select element",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEMS:"Select elements",CAPTION_TEXTBLOCK_INIT:"Enter text here",CAPTION_WIDTH:"Width",CAPTION_LENGTH:"Length",CAPTION_PATH_INDEX:"Path {0}",HINT_PATH_INDEX:"Path {0}",CAPTION_REACTION_ARROW_UNSET:"(Unset)",CAPTION_REACTION_ARROW_CUSTOM:"Custom",CAPTION_REACTION_ARROW_NORMAL:"Normal",CAPTION_REACTION_ARROW_RESONANCE:"Resonance",CAPTION_REACTION_ARROW_REVERSIBLE:"Reversible",CAPTION_REACTION_ARROW_RETROSYNTHESIS:"Retrosynthesis",HINT_REACTION_ARROW_UNSET:"Unset",HINT_REACTION_ARROW_CUSTOM:"Custom",HINT_REACTION_ARROW_NORMAL:"Normal arrow",HINT_REACTION_ARROW_RESONANCE:"Resonance arrow",HINT_REACTION_ARROW_REVERSIBLE:"Reversible arrow",HINT_REACTION_ARROW_RETROSYNTHESIS:"Retrosynthesis arrow",CAPTION_LINE_COUNT:"Line count",CAPTION_LINE_GAP:"Line gap",CAPTION_LINE:"Line",CAPTION_STARTING_ARROW:"Starting arrow",CAPTION_ENDING_ARROW:"Ending arrow",CAPTION_REACTION_ARROW_TYPE:"Reaction arrow type",CAPTION_ELECTRON_PUSHING_ARROW_TYPE:"Arrow type",CAPTION_OPPOSITE_ARROW_SIDES:"Opposite arrow sides",CAPTION_SAME_ARROW_SIDES:"Same arrow sides",CAPTION_ELECTRON_PUSHING_ARROW_1:"Single electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_1_ABBR:"Single",HINT_ELECTRON_PUSHING_ARROW_1:"Single electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_2:"Double electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_2_ABBR:"Double",HINT_ELECTRON_PUSHING_ARROW_2:"Double electron pushing arrow",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"Bond forming electron pushing arrow",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"Bond forming electron pushing arrow",LEGEND_CAPTION:"Legend",LEGEND_ELEM_SYMBOL:"Symbol",LEGEND_ELEM_NAME:"name",LEGEND_ATOMIC_NUM:"atomic number",LEGEND_ATOMIC_WEIGHT:"atomic weight",CAPTION_2D:"2D",CAPTION_3D:"3D",CAPTION_AUTOSIZE:"Autosize",CAPTION_AUTOFIT:"Autofit",CAPTION_SHOWSIZEINFO:"Show size info",CAPTION_LABEL_SIZE:"Size: ",CAPTION_BACKGROUND_COLOR:"Background color: ",CAPTION_WIDTH_HEIGHT:"width: {0}, height: {1}",PLACEHOLDER_WIDTH:"width",PLACEHOLDER_HEIGHT:"height",HINT_AUTOSIZE:"Whether graph size is determined by object automatically",HINT_AUTOFIT:"Whether object is zoomed to fullfill the whole graph",CAPTION_CHEMOBJINSERTER_GENERATING_3D_STRUCTURE:"Generating molecule 3D structure...",CAPTION_SPECTRUM_WITH_INDEX:"Spectrum {0}",CAPTION_SPECTRUM_DATASECTION_WITH_INDEX:"Data section {0}",CAPTION_INTERACTIONS:"Interactions: ",CAPTION_ENABLE_HOTTRACK:"Enable hot track",CAPTION_ENABLE_SELECT:"Enable select",CAPTION_ENABLE_MULTISELECT:"Enable multi-select",CAPTION_ASSOC_VIEWER_SIZE:"Correlated molecule viewer size: ",CAPTION_ASSOC_VIEWER_VISUAL_MODE:"Correlated molecule display mode: ",CAPTION_ASSOC_VIEWER_VISUAL_MODE_AUTO:"Auto",CAPTION_ASSOC_VIEWER_VISUAL_MODE_VISIBLE:"Always displayed",CAPTION_ASSOC_VIEWER_VISUAL_MODE_INVISIBLE:"Always hidden",S_VALUE_DEFAULT:"(Default)"}),Kekule.Localization.addResource("en","ErrorMsg",{WIDGET_CLASS_NOT_FOUND:"Widget class not found",WIDGET_CAN_NOT_BIND_TO_ELEM:"Widget {0} can not be binded to element <{1}>",LOAD_CHEMDATA_FAILED:"Failed to load data",FILE_API_NOT_SUPPORTED:"File operations are not supported by your current web browser. Please update it.",DRAW_BRIDGE_NOT_SUPPORTED:"It seems that your web browser is not modern enough to support the drawing function. Please update it.",COMMAND_NOT_REVERSIBLE:"Command can not be undone",PAGE_INDEX_OUTOF_RANGE:"Page index out of range",FETCH_DATA_TIMEOUT:"Time out to fetch data",RENDER_TYPE_CHANGE_NOT_ALLOWED:"It is not allowed to change render type",CAN_NOT_CREATE_EDITOR:"Creating editor failed",CAN_NOT_LOAD_OBJ_OTHER_THAN_SPECTRUM:"Can not load non-spectrum object",FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_SPECTRUM:"Fail to export data URI for spectrum image",FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_ASSOC:"Fail to export data URI for associated image",CAN_NOT_SET_COORD_OF_CLASS:"Can not set coordinate of instance of {0}.",CAN_NOT_SET_DIMENSION_OF_CLASS:"Can not set dimension of instance of {0}.",CAN_NOT_MERGE_CONNECTORS:"Specified connectors can not be merged.",NOT_A_VALID_ATOM:"Not a valid atom",INVALID_ATOM_SYMBOL:"Invalid atom symbol",INVALID_OR_EMPTY_IMAGE:"Image is empty or invalidate"}),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("objDefines"),Kekule.OBJDEF_TEXTS={},Kekule.Localization.addResource("en","OBJDEF_TEXTS",{TITLE_PREFIX:"TITLE_",DESCRIPTION_PREFIX:"DES_",DES_ID:"Unique ID for object.",Render:{GeneralConfigs:{TITLE_drawOpacity:"Opacity",DES_drawOpacity:"Opacity (between 0-1) to draw objects"},Render2DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_displayLabelConfigs:"Display label settings",DES_displayLabelConfigs:"Settings of displayed label in molecule/chem object",TITLE_textFontConfigs:"Text and font settings",DES_textFontConfigs:"Settings about text and font of display",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule/chem object",TITLE_colorConfigs:"Color settings",DES_colorConfigs:"Color settings to display molecule/chem object",TITLE_spectrumDisplayConfigs:"Spectrum display settings",DES_spectrumDisplayConfigs:"Settings for displaying spectrum object"},MoleculeDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display mode",DES_defMoleculeDisplayType:"Default display type of molecule: in skeletal or in condensed mode",TITLE_defNodeDisplayMode:"Default atom display mode",DES_defNodeDisplayMode:"Default mode to display atom in molecule",TITLE_defHydrogenDisplayLevel:"Default hydrogen display level",DES_defHydrogenDisplayLevel:"How to display explicit or implicit hydrogens of atom",TITLE_defChargeMarkType:"Default charge mark type",DES_defChargeMarkType:null,TITLE_partialChargeDecimalsLength:"Decimal length of partial charge",DES_partialChargeDecimalsLength:"If an atom has a partical charge (e.g., +1.5), how many digits after decimal point should be displayed",TITLE_distinguishSingletAndTripletRadical:"Distinguish singlet/triplet radical",DES_distinguishSingletAndTripletRadical:"Whether use different mark to distinguish singlet(..) and triplet(^^) radical",TITLE_bondLineCap:"Bond line cap style",TITLE_bondLineJoin:"Bond line join style",TITLE_glyphLineCap:"Glyph line cap style",TITLE_glyphLineJoin:"Glyph line join style"},DisplayLabelConfigs:{TITLE_enableIsotopeAlias:"Enable isotope alias",DES_enableIsotopeAlias:"Whether isotope alias (e.g. D for 2H) is used to display atom label.",TITLE_unsetElement:"Unset element",DES_unsetElement:"Label for unset or unknown element",TITLE_dummyAtom:"Dummy atom",DES_dummyAtom:"Label for dummy atom",TITLE_heteroAtom:"Hetero atom",DES_heteroAtom:"Label for general hetero atom",TITLE_anyAtom:"Any atom",DES_anyAtom:"Label for atom wildcard",TITLE_variableAtom:"Variable atom",DES_variableAtom:"Label for variable atom or atom list",TITLE_rgroup:"RGroup",DES_rgroup:"Label for RGroup",TITLE_isoListLeadingBracket:"Atom list leading bracket",TITLE_isoListTailingBracket:"Atom list tailing bracket",TITLE_isoListDelimiter:"Atom delimiter in list",TITLE_isoListDisallowPrefix:"Prefix of not-atom list"},TextFontConfigs:{TITLE_labelFontFamily:"Label font",DES_labelFontFamily:"Font to draw general label",TITLE_atomFontFamily:"Atom font",DES_atomFontFamily:"Font to draw atom label",TITLE_supFontSizeRatio:"Superscript font size ratio",DES_supFontSizeRatio:"Ratio of Superscript text size to normal text size",TITLE_subFontSizeRatio:"Subscript font size ratio",DES_subFontSizeRatio:"Ratio of Subscript text size to normal text size",TITLE_superscriptOverhang:"Superscript text overhang",DES_superscriptOverhang:null,TITLE_subscriptOversink:"Subscript text oversink",DES_subscriptOversink:null,TITLE_textCharDirection:"Text direction",DES_textCharDirection:"Default text direction",TITLE_textHorizontalAlign:"Horizontal text alignment",DES_textHorizontalAlign:"Default horizontal text alignment of label",TITLE_textVerticalAlign:"Vertical text alignment",DES_textVerticalAlign:"Default vertical text alignment of label"},LengthConfigs:{TITLE_labelFontSize:"Label text size",DES_labelFontSize:"Size of general label text",TITLE_atomFontSize:"Atom text size",DES_atomFontSize:"Size of atom label text",TITLE_chemMarkerFontSize:"Chem marker text size",DES_chemMarkerFontSize:"Size of text in chem marker",TITLE_chemMarkerMargin:"Chem marker margin",DES_chemMarkerMargin:"Margin of chem marker to main object",TITLE_allenCenterAtomRadius:"Allen center radius",DES_allenCenterAtomRadius:"Radius to draw dot on center carbon atom in allen",TITLE_chargeMarkFontSize:"Charge mark size",DES_chargeMarkFontSize:"Font size of charge mark",TITLE_chargeMarkMargin:"Charge mark margin",DES_chargeMarkMargin:"Margin between charge mark and atom",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default length of a chemical bond",TITLE_bondLineWidth:"Bond line width",DES_bondLineWidth:"Line width to draw a chemical bond",TITLE_hashSpacing:"Hash spacing",DES_hashSpacing:"Spacing between small lines in hash bond",TITLE_multipleBondSpacingRatio:"Multiple bond spacing ratio",DES_multipleBondSpacingRatio:"Ratio of spacing between two lines in double or triple bond to bond length.",TITLE_multipleBondMaxAbsSpacing:"Max multiple bond spacing",DES_multipleBondMaxAbsSpacing:"Maximum spacing between multiple bond",TITLE_bondArrowLength:"Bond arrow length",DES_bondArrowLength:"The length of end triangle in arrow bond",TITLE_bondArrowWidth:"Bond arrow width",DES_bondArrowWidth:"The width of end triangle in arrow bond",TITLE_bondWedgeWidth:"Bond wedge max width",DES_bondWedgeWidth:"The width of ending point in wedge bond",TITLE_bondWedgeHashMinWidth:"Bond wedge min width",DES_bondWedgeHashMinWidth:"The width of starting point in wedge bond",TITLE_bondWavyRadius:"Bond wavy radius",DES_bondWavyRadius:"Radius to draw arc of wavy bond",TITLE_glyphStrokeWidth:"Glyph stroke width",DES_glyphStrokeWidth:"The default width of glyph strokes",TITLE_autofitContextPadding:"Autofit context padding",DES_autofitContextPadding:"Padding of autofit widget edge and drawn object",TITLE_glyphStickOffsetRelLength:"Glyph stick offset relative length",DES_glyphStickOffsetRelLength:"Glyph stick offset relative length",TITLE_defScaleRefLength:"Default scale reference length",DES_defScaleRefLength:"Length for calculating the auto-scale"},ColorConfigs:{TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element",TITLE_labelColor:"Label color",DES_labelColor:"Default color of general label",TITLE_atomColor:"Atom color",DES_atomColor:"Default color of atom label",TITLE_bondColor:"Bond color",DES_bondColor:"Default color of bond",TITLE_glyphStrokeColor:"Glyph stroke color",DES_glyphStrokeColor:"Default stroke color of glyph",TITLE_glyphFillColor:"Glyph fill color",DES_glyphFillColor:"Default fill color of glyph"},spectrumDisplayConfigs:{},Render3DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_environmentConfigs:"3D environment settings",DES_environmentConfigs:"Settings of 3D environment",TITLE_modelConfigs:"3D model settings",DES_modelConfigs:"Settings to render a 3D molecule model",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule"},Render3DEnvironmentConfigs:{TITLE_graphicQuality:"Graphic quality",DES_graphicQuality:"Quality of 3D graphic"},Molecule3DDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display type",DES_defMoleculeDisplayType:"Draw molecule in wire, stick, ball stick or space fill mode",TITLE_defBondSpliceMode:"Bond splice mode",DES_defBondSpliceMode:"How to draw a splice mode between two atoms with different color",TITLE_defDisplayMultipleBond:"Display multiple bond",DES_defDisplayMultipleBond:"Whether draw multiple bond lines for double or triple bond",TITLE_defBondColor:"Default bond color",DES_defBondColor:"Default bond color",TITLE_defAtomColor:"Default atom color",DES_defAtomColor:"Default atom color",TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element"},Model3DConfigs:{TITLE_hideHydrogens:"Hide hydrogens",DES_hideHydrogens:"Whether hide all hydrogen atoms in 3D model",TITLE_useVdWRadius:"Use von dar Waals radius",DES_useVdWRadius:"Whether use atom's von dar Waals radius to draw 3D model",TITLE_multiConnectorRadiusRatio:"Multi-bond radius ratio",DES_multiConnectorRadiusRatio:"If use multi-cylinder for multibond, this value is the radius ratio between multi and single bond",TITLE_multiConnectorMarginRatio:"Multi-bond margin ratio",DES_multiConnectorMarginRatio:"If multi-cylinder is used for multibond, ratio of margin between cylinders and radius of cylinder"},Length3DConfigs:{TITLE_fixedNodeRadius:"Fixed atom radius",DES_fixedNodeRadius:"If vdW radius of atom is not used, this value will be used for all atom's radius",TITLE_connectorRadius:"Bond radius",DES_connectorRadius:"Bond will be draw based on this radius in stick or ball_stick mode",TITLE_connectorLineWidth:"Bond line width",DES_connectorLineWidth:"Bond will be draw on this width in wire mode"}},Widget:{BaseWidget:{TITLE_settingFacade:"General settings",DES_settingFacade:"General settings"}},ChemWidget:{ChemObjDisplayer:{TITLE_enableLoadNewFile:"Enable load data",DES_enableLoadNewFile:"Whether loading new data is enabled"},ChemObjDisplayerConfigs:{TITLE_ioConfigs:"I/O settings",DES_ioConfigs:"Settings of input/output",TITLE_environment2DConfigs:"2D environment settings",DES_environment2DConfigs:"Settings of 2D drawing environment",TITLE_environment3DConfigs:"3D environment settings",DES_environment3DConfigs:"Settings of 3D drawing environment",TITLE_spectrumViewConfigs:"Spectrum view settings",DES_spectrumViewConfigs:"Display and interaction settings of spectrum sub view"},ChemObjDisplayerIOConfigs:{TITLE_canonicalizeBeforeSave:"Canonicalize before save",DES_canonicalizeBeforeSave:"Whether canonicalize molecule before saving it",TITLE_autoGenerateCoordsAfterLoad:"Auto generate coordinates after loading molecule",DES_autoGenerateCoordsAfterLoad:"Whether coordinates of atoms are automatically generated when loading a molecule without explicit coordinate information"},ChemObjDisplayerEnvironmentConfigs:{TITLE_antialias:"Antialias",DES_antialias:"Whether enable extra antialias strategy additional to the default one of browser",TITLE_antialiasBlurRatio:"Antialias blur ratio",DES_antialiasBlurRatio:"Antialias blur ratio",TITLE_overSamplingRatio:"Over sampling ratio",DES_overSamplingRatio:"Over sampling ratio of the drawing context"},ChemObjDisplayerSpectrumViewConfigs:{},Viewer:{TITLE_enableDirectInteraction:"Enable direct interaction",DES_enableDirectInteraction:"Whether interaction with chem object in viewer is enabled",TITLE_enableTouchInteraction:"Enable touch interaction",DES_enableTouchInteraction:"Whether touch interaction is enabled",TITLE_enableToolbar:"Enable toolbar",DES_enableToolbar:"Whether toolbar of viewer is displayed",TITLE_toolbarPos:"Toolbar Position",DES_toolbarPos:"Position of toolbar in viewer",TITLE_toolbarMarginHorizontal:"Toolbar horizontal margin",DES_toolbarMarginHorizontal:"Horizontal margin of toolbar to viewer edge",TITLE_toolbarMarginVertical:"Toolbar vertical margin",DES_toolbarMarginVertical:"Vertical margin of toolbar to viewer edge",TITLE_enableEdit:"Enable editing",DES_enableEdit:"Whether edit chem object in viewer is enabled",TITLE_modalEdit:"Modal editing",DES_modalEdit:"Using modal dialog or popup dialog to edit chem object"},ViewerConfigs:{TITLE_hotKeyConfigs:"Hot key settings",DES_hotKeyConfigs:"Setting of the hot key and action map"},ViewerHotKeyConfigs:{TITLE_hotKeys:"Hot keys",DES_hotKeys:"Hot key and action settings"}},Editor:{BaseEditorConfigs:{TITLE_uiMarkerConfigs:"UI marker settings",DES_uiMarkerConfigs:"Settings of interaction marker",TITLE_interactionConfigs:"Interaction settings",DES_interactionConfigs:"Settings about interaction of editor",TITLE_structureConfigs:"Structure settings",DES_structureConfigs:"Settings about creating molecule structure",TITLE_hotKeyConfigs:"Hot key settings",DES_hotKeyConfigs:"Setting of the hot key and action map"},ChemSpaceEditorConfigs:{TITLE_chemSpaceConfigs:"Chem space settings",DES_chemSpaceConfigs:"Settings about chem space/chem document",TITLE_styleSetterConfigs:"Style setter settings",DES_styleSetterConfigs:"Settings of style toolbar of editor"},InteractionConfigs:{TITLE_enableTrackOnNearest:"Enale track on nearest",DES_enableTrackOnNearest:"If setting to true, hot track or selection will focus on nearest object to current position, otherwise, the topmost object around will be focused.",TITLE_enableHotTrack:"Enable hot track",DES_enableHotTrack:"Whether highlighting objects under mouse position",TITLE_scrollToObjAfterLoading:"Scroll to object after loading",DES_scrollToObjAfterLoading:"Whether scroll to the newly loaded object after opening data",TITLE_autoExpandClientSizeAfterLoading:"Auto expand client size after loading",DES_autoExpandClientSizeAfterLoading:"Whether expand the client size automatically after loading a large object out of boundary",TITLE_autoExpandClientSizeAfterManipulation:"Auto expand client size after manipulation",DES_autoExpandClientSizeAfterManipulation:"Whether expand the client size automatically when moving a object out of the boundary of editor",TITLE_autoSelectNewlyInsertedObjects:"Auto select new inserted objects",DES_autoSelectNewlyInsertedObjects:"Whether select objects newly inserted or modified in editor automatically",TITLE_autoSelectNewlyInsertedObjectsOnTouch:"Auto select new inserted objects in touch device",DES_autoSelectNewlyInsertedObjectsOnTouch:"Whether select objects newly inserted or modified in editor automatically in touch device",TITLE_objBoundTrackMinInflation:"Object bound minimal inflation (default)",DES_objBoundTrackMinInflation:"The default minimal inflation of the bound of object to make it easier to select",TITLE_objBoundTrackMinInflationMouse:"Object bound minimal inflation (mouse)",DES_objBoundTrackMinInflationMouse:"The minimal inflation of the bound of object to make it easier to select when using mouse as pointer device",TITLE_objBoundTrackMinInflationTouch:"Object bound minimal inflation (touch)",DES_objBoundTrackMinInflationTouch:"The minimal inflation of the bound of object to make it easier to select when touching on screen",TITLE_objBoundTrackMinInflationPen:"Object bound minimal inflation (pen)",DES_objBoundTrackMinInflationPen:"The minimal inflation of the bound of object to make it easier to select when using pen as pointer device",TITLE_objBoundTrackInflationRatio:"Object bound inflation ratio (default)",DES_objBoundTrackInflationRatio:"The default inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select",TITLE_objBoundTrackInflationRatioMouse:"Object bound inflation ratio (mouse)",DES_objBoundTrackInflationRatioMouse:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when using mouse as pointer device",TITLE_objBoundTrackInflationRatioPen:"Object bound inflation ratio (pen)",DES_objBoundTrackInflationRatioPen:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when using pen as pointer device",TITLE_objBoundTrackInflationRatioTouch:"Object bound inflation ratio (touch)",DES_objBoundTrackInflationRatioTouch:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when touching on screen",TITLE_selectionMarkerInflation:"Selection marker inflation",DES_selectionMarkerInflation:"Inflation of object selection mark, makes it easier to see the containing objects",TITLE_selectionMarkerEdgeInflation:"Selection edge inflation",DES_selectionMarkerEdgeInflation:"Inflation when judging if a coord is on selection mark edge",TITLE_followPointerCoordOnDirectManipulatingSingleObj:"Follow pointer coordinate on direct manipulating object",DES_followPointerCoordOnDirectManipulatingSingleObj:"If true, the new coordinate of manipulating object will be set directly by the position of pointer (rather than the delta coordinate to the original position)",TITLE_followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold:"Threshold of following pointer coordinate on direct manipulating object",DES_followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold:"Threshold when following pointer coordinate on direct manipulating object",TITLE_constrainedResizeStep:"Constrained resize step",DES_constrainedResizeStep:"Constrained resize step",TITLE_constrainedRotateStep:"Constrained rotation step",DES_constrainedRotateStep:"Constrained rotation step, in arc",TITLE_rotationLocationPointDistanceThreshold:"Rotation starting min distance",DES_rotationLocationPointDistanceThreshold:"Rotation will occur only when mouse point distance (from rotation center) larger than this value",TITLE_directedMoveDistanceThreshold:"Direct move min distance",DES_directedMoveDistanceThreshold:"Direct moving will only be done if moved distance large than this value",TITLE_enablePartialAreaSelecting:"Enable partial selecting",DES_enablePartialAreaSelecting:"If this value is true, when drag a selecting rubber band, object partly in the band will be totally selected",TITLE_selectingBrushWidth:"Brush selecting Width",DES_selectingBrushWidth:"Width of brush in brush selecting",TITLE_enableOffSelectionManipulation:"Enable off-selection manipulation",DES_enableOffSelectionManipulation:"When setting to true, you can still move, resize or rotate selected objects by holding mouse or touch outside selection for a while",TITLE_offSelectionManipulationActivatingTimeThreshold:"Off-selection manipulation hold time",DES_offSelectionManipulationActivatingTimeThreshold:"The minimal time (in ms) need for holding mouse or touch to invoke off-selection manipulation",TITLE_selectionMarkerDefPulseDuration:"Default selection mark pulse duration",DES_selectionMarkerDefPulseDuration:"The duration (in ms) of selection mark pulse when the selection is been emphasised",TITLE_selectionMarkerDefPulseCount:"Default selection mark pulse count",DES_selectionMarkerDefPulseCount:"The pulse count when the selection is been emphasised",TITLE_rotationRegionInflation:"Rotation region inflation",DES_rotationRegionInflation:"User can rotate the selected objects by pressing and move mouse in this inflated region outside selection",TITLE_enableMergePreview:"Enable merge preview",DES_enableMergePreview:"Whether a preview operation is used rather then the actual merge operation when merge two objects in editor during manipulation. Turn on this option may improve the performance of object manipulation.",TITLE_enableGestureManipulation:"Enable gesture manipulation",DES_enableGestureManipulation:"Whether user can use touch gestures (e.g. pinch) to scale or rotate selected objects in editor",TITLE_enableGestureZoomOnEditor:"Enable gesture zoom on editor",DES_enableGestureZoomOnEditor:"Whether user can use pinch gesture to zoom in or out the editor when there is no selection existed",TITLE_trackSimplifierDistanceThreshold:"Track-input curve simplification threshold",DES_trackSimplifierDistanceThreshold:"Distance threshold in simplifying curve drawn by track-input tool",TITLE_trackSimplifierIgnoreSegmentThreshold:"Track-input ignored segment threshold",DES_trackSimplifierIgnoreSegmentThreshold:"Segment length less than this threshold drawn by track-input will be ignored in parsing",TITLE_trackMergeDistanceThreshold:"Track-input merge distance threshold",DES_trackMergeDistanceThreshold:"If a joint or end point of line segment drawn by track-inpu tool is close to another line segment (less than this threshold), it will be regarded on that line.",TITLE_trackOptimizationAngleConstraint:"Track-input optimization line cross angle constraint",DES_trackOptimizationAngleConstraint:null,TITLE_trackOptimizationDistanceConstraints:"Track-input optimization line length constraint",DES_trackOptimizationDistanceConstraints:null,TITLE_trackOptimizationPrimaryDistanceConstraint:"Track-input optimization primary line length",DES_trackOptimizationPrimaryDistanceConstraint:null,TITLE_autoAdjustZoomLevelOnTrackTouching:null,DES_autoAdjustZoomLevelOnTrackTouching:null,TITLE_editorInitialZoom:"Editor initial zoom level",DES_editorInitialZoom:"The initial zoom level of editor",TITLE_atomSetterFontSize:"Atom setter font size",DES_atomSetterFontSize:"Font size of atom setter",TITLE_allowUnknownAtomSymbol:"Allow unknown atom symbol",DES_allowUnknownAtomSymbol:"Allow inputting unknown symbol and handle it as pseudo atom in atom setter",TITLE_clonedObjectScreenOffset:"Copied object coord offset",DES_clonedObjectScreenOffset:"The distance between copied objects and origin objects when doing paste selection action in editor",TITLE_enableBondKekulizeHucklize:"Enable Kekulize and Hucklize function of bond",DES_enableBondKekulizeHucklize:"Whether Kekulize and Hucklize buttons are shown in bond modifier of editor",TITLE_enableHotKey:"Enable hot keys",DES_enableHotKey:"Whether shortcut with key pressing is enabled in editor"},UiMarkerConfigs:{TITLE_hotTrackerColor:"Hot track mark color",DES_hotTrackerColor:"Color of hot track mark",TITLE_hotTrackerOpacity:"Hot track mark opacity",DES_hotTrackerOpacity:"Opacity of hot track marker, value from 0 to 1",TITLE_selectionMarkerStrokeColor:"Selection mark stroke color",DES_selectionMarkerStrokeColor:"Stroke color of selection mark",TITLE_selectionMarkerStrokeWidth:"Selection mark stroke width",DES_selectionMarkerStrokeWidth:"Width of selection mark stroke",TITLE_selectionMarkerFillColor:"Selection mark fill color",DES_selectionMarkerFillColor:"Fill color of selection mark.",TITLE_selectionMarkerOpacity:"Selection mark opacity",DES_selectionMarkerOpacity:"Opacity of selection mark, value from 0 to 1",TITLE_selectionMarkerEmphasisOpacity:"Emphasised selection mark opacity",DES_selectionMarkerEmphasisOpacity:"Opacity of emphasised selection marker, value from 0 to 1",TITLE_selectingMarkerStrokeColor:"Selecting mark stroke color",DES_selectingMarkerStrokeColor:"Stroke color of selecting rubber band mark",TITLE_selectingMarkerStrokeWidth:"Selecting mark stroke width",DES_selectingMarkerStrokeWidth:"Stroke width of selection rubber band",TITLE_selectingMarkerStrokeDash:"Selecting mark dash style",DES_selectingMarkerStrokeDash:"Dash style of selecting rubber band",TITLE_selectingMarkerFillColor:"Selecting mark fill color",DES_selectingMarkerFillColor:"Fill color of selecting mark. Usually this value should be left blank (not filled)",TITLE_selectingMarkerOpacity:"Selecting mark opacity",DES_selectingMarkerOpacity:"Opacity of selecting mark, value from 0 to 1",TITLE_selectingBrushMarkerStrokeColor:"Brush selecting mark stroke color",DES_selectingBrushMarkerStrokeColor:"Stroke color of brush selecting mark",TITLE_selectingBrushMarkerStrokeDash:"Brush selecting mark dash style",DES_selectingBrushMarkerStrokeDash:"Dash style of brush selecting track",TITLE_selectingBrushMarkerStrokeLineCap:"Brushing selecting mark line-cap style",DES_selectingBrushMarkerStrokeLineCap:"Line-cap style of both ends of brush selecting track",TITLE_selectingBrushMarkerStrokeLineJoin:"Brushing selecting mark join point style",DES_selectingBrushMarkerStrokeLineJoin:"Join style of brush selection track segments",TITLE_selectingBrushMarkerOpacity:"Brush selecting mark opacity",DES_selectingBrushMarkerOpacity:"Opacity of brush selecting mark, value from 0 to 1",TITLE_trackMarkerStrokeColor:"Track-input mark stroke color",DES_trackMarkerStrokeColor:"Stroke color of track mark when using track-input tool to draw a structure",TITLE_trackMarkerStrokeWidth:"Track-input mark stroke width",DES_trackMarkerStrokeWidth:"Stroke width of track mark when using track-input tool to draw a structure",TITLE_trackMarkerStrokeDash:"Track-input mark dash style",DES_trackMarkerStrokeDash:"Dash style of track mark when using track-input tool to draw a structure",TITLE_trackMarkerOpacity:"Track-input mark opacity",DES_trackMarkerOpacity:"Opacity of track mark when using track-input tool to draw a structure",TITLE_flexStructureAssocMarkerColor:"Flex structure association mark color",DES_flexStructureAssocMarkerColor:"Color of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerOpacity:"Flex structure association mark opacity",DES_flexStructureAssocMarkerOpacity:"Opacity of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerFontSize:"Flex structure association mark font size",DES_flexStructureAssocMarkerFontSize:"Font size of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerFontFamily:"Flex structure association mark font family",DES_flexStructureAssocMarkerFontFamily:"Font family of mark showing atom count of flex ring/chain tool",TITLE_issueCheckMarkerColors:"Issue check markers color",DES_issueCheckMarkerColors:"Color of issue check markers, different colors are used for different issue levels",TITLE_issueCheckMarkerStrokeWidth:"Issue check marker stroke width",DES_issueCheckMarkerStrokeWidth:"Stroke width of issue check marker outline",TITLE_issueCheckActiveMarkerStrokeWidth:"Active issue check marker stroke width",DES_issueCheckActiveMarkerStrokeWidth:"Stroke width of active issue check marker outline",TITLE_issueCheckMarkerOpacity:"Issue check marker opacity",DES_issueCheckMarkerOpacity:"Opacity of issue check marker",TITLE_issueCheckActiveMarkerOpacity:"Active Issue check marker opacity",DES_issueCheckActiveMarkerOpacity:"Opacity of active issue check marker"},StructureConfigs:{TITLE_defBondType:"Default bond type",DES_defBondType:"Default type of bond",TITLE_defBondOrder:"Default bond order",DES_defBondOrder:"Default bond order",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default bond length",TITLE_defIsotopeId:"Default isotope",DES_defIsotopeId:"Default isotope when adding a new atom",TITLE_maxFlexChainAtomCount:"Maximum flex chain atom count",DES_maxFlexChainAtomCount:"Maximum atom count when inputting with flex chain tool",TITLE_minFlexChainAtomCount:"Minimal flex chain atom count",DES_minFlexChainAtomCount:"Minimal atom count when inputting with flex chain tool",TITLE_maxFlexRingAtomCount:"Maximum flex ring atom count",DES_maxFlexRingAtomCount:"Maximum atom count when inputting with flex ring tool",TITLE_minFlexRingAtomCount:"Minimal flex ring atom count",DES_minFlexRingAtomCount:"Minimal atom count when inputting with flex ring tool",TITLE_enabledNonAtomNodeTypes:"Available non-atom structure node types",DES_enabledNonAtomNodeTypes:"Non-atom structure node types available in editor",TITLE_enabledBondForms:"Available bond forms",DES_enabledBondForms:"Bond forms available in editor"},ChemSpaceConfigs:{TITLE_defScreenSize2D:"Default 2D screen size",TITLE_defScreenSize3D:"Default 3D screen size",TITLE_autoExpandScreenSize2D:"Auto expanding size 2D",DES_autoExpandScreenSize2D:"The size used when automatically expanding editor client in 2D mode",TITLE_autoExpandScreenSize3D:"Auto expanding size 3D",DES_autoExpandScreenSize3D:"The size used when automatically expanding editor client in 3D mode",TITLE_defPadding:"Default padding",DES_defPadding:"Padding on top when adding an unpositioned object to container chem space"},HotKeyConfigs:{TITLE_hotKeys:"Hot keys",DES_hotKeys:"Hot key and action settings"},BaseEditor:{TITLE_enableCreateNewDoc:"Enable create new document",DES_enableCreateNewDoc:"Whether creating a new document is allowed",TITLE_initOnNewDoc:"Starts with a new document",DES_initOnNewDoc:"Whether create a new document automatically when composer is initialized",TITLE_enableOperHistory:"Enable undo",DES_enableOperHistory:"Whether undo/redo is enabled",TITLE_enableIssueCheck:"Enable issue check",DES_enableIssueCheck:"Whether enable issue checker to detect errors and warning among objects in editor"},ChemSpaceEditor:{TITLE_allowAppendDataToCurr:"Allow appending data",DES_allowAppendDataToCurr:"Whether allow appending data to current document"},Composer:{TITLE_enableStyleToolbar:"Enable style toolbar",DES_enableStyleToolbar:"Whether display style toolbar to set color, font and size of objects",TITLE_enableObjModifierToolbar:"Enable object modifier toolbar",DES_enableObjModifierToolbar:"Whether display toolbar with a series of object modification tools",TITLE_allowCreateNewChild:"Enable create new child object",DES_allowCreateNewChild:"Whether new direct child of document can be created",TITLE_allowAppendDataToCurr:"Allow appending data",DES_allowAppendDataToCurr:"Whether allow appending data to current document"}}}),Kekule.Localization.setCurrModule("general"),Kekule.Localization.addResource("zh","Texts",{UNNAMED:"未命名"}),Kekule.Localization.addResource("zh","ErrorMsg",{MODULE_NOT_LOADED:"模块{0}未载入",UNIT_NOT_FOUND:"Unit not found: {0}",STANDARD_UNIT_OF_CATEGORY_NOT_FOUND:"类别{0}的标准单位未设置",UNABLE_TO_CONVERT_BETWEEN_UNITS:"无法在单位{0}与{1}间转换数据",NON_OWN_PROPERTY_CANNOT_BE_REPLACED:"只能替换对象的直接属性",EMPTY_DOC:"文档无内容",ELEMENT_NOTSET:"未设置元素",EMPTY_RESURI:"资源URI无内容",CANNOT_LOAD_RES_OF_URI:"无法载入资源URI：",LIST_ITEM_CLASS_MISMATCH:"条目类型错误，无法加入列表",CANNOT_CLEAR_WEAKMAP:"Can not clear a weak map",CANNOT_GET_KEY_LIST_IN_WEAKMAP:"Can not get key array from a weak map",CANNOT_GET_VALUE_LIST_IN_WEAKMAP:"Can not get value array from a weak map",INVALID_CHEMELEMENT:"无效的化学元素",INVALID_ISOTOPE:"无效的同位素",COORD_STICK_NOT_ALLOWED_ON_CLASS:"Coordinate sticking is not allowed in this type of object",INVALID_STICK_TARGET_OBJ:"Invalid sticking target",UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ:"Unable to stick to object with a different owner",UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD:"Unable to stick to object without absolute coordinates",STICK_RECURSION_NOT_ALLOWED:"Stick recursion is not allowed",UNABLE_ADD_MISTYPED_NODE:"无法向键/连接符上连接错误的原子/顶点",UNABLE_ADD_DIFF_OWNER_OBJ:"对象有着不同的宿主，无法连接在同一键/连接符上",CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH:"条目类型不符",SORT_FUNC_UNSET:"排序函数未设置",SOURCE_FRAGMENT_NOT_SET:"未指定源分子",UNABLE_ADD_NONMOLECULE_MAP:"仅能向反应物或生成物中添加分子",CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER:"仅能向结构中添加原子、键或顶点、连接符",REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND:"无法找到注册的归一化执行器",ERROR_LOADING_FILE:"文件载入错误：",READER_ID_ALREADY_EXISTS:"Can not register reader: id already exists",WRITER_ID_ALREADY_EXISTS:"Can not register writer: id already exists",FAIL_TO_READ_FORMAT:"读入数据失败，格式：",NO_SUITABLE_READER_FOR_FORMAT:"无法读入数据，格式：",NO_SUITABLE_READER_FOR_MIMETYPE:"无法读入数据，MIME类型：",NO_SUITABLE_READER_FOR_FILEEXT:"无法读入数据，文件后缀：",NO_SUITABLE_WRITER_FOR_FORMAT:"无法写入数据，格式：",NO_SUITABLE_WRITER_FOR_MIMETYPE:"无法写入数据，MIME类型：",NO_SUITABLE_WRITER_FOR_FILEEXT:"无法写入数据，文件后缀：",AJAX_FILELOADER_NOT_FOUND:"AJAX file loader not found, can not load URL",FAIL_TO_LOAD_FILE_URL:"载入文件或链接失败：",CML_ELEM_READER_NOT_FOUND:"CML元素<{0}>读入器不存在",ATOMID_NOT_EXISTS:"原子标识(ID)不存在：",BONDID_NOT_EXISTS:"键标识(ID)不存在：",CML_ELEM_WRITER_TYPE_INPROPER:"{0}不是合适的CML元素{1}的写入器",CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT:"无法向空的CML元素中输出内容",UNABLE_TO_OUTPUT_AS_CML:"无法将对象<{0}>输出至CML",MDL_CTAB_ATOM_CANNOT_CREATE:"无法从源MDL格式数据中创建原子",MDL_CTAB_BOND_CANNOT_CREATE:"无法从源MDL格式数据中创建化学键",CAN_NOT_WRITE_NON_MOLECULE_TO_MOL:"对象并非分子，无法输出至分子连接表",MOLECULE_HAS_NO_CTAB_TO_OUTPUT:"分子无连接表，无法输出至MDL格式数据",NOT_MDL2000_FORMAT_DATA:"数据格式错误：并非MDL 2000",NOT_MDL_RXN_DATA:"并非MDL反应(RXN)数据",MALFORMED_MDL3000_COUNTLINE:"MDL 3000计数行格式错误",MDL3000_ATOMBLOCK_NOT_FOUND:"无法找到原子块，错误的MDL 3000数据？",NOT_MDL_FORMAT_DATA:"数据格式错误：并非MDL 2000或3000",NOT_MDL2000_RXN_DATA:"并非MDL RXN 2000数据",NOT_MDL3000_RXN_DATA:"并非MDL RXN 3000数据",NOT_MDL3000_RXN_COUNTLINE:"读入RXN 3000计数行错误",MDL_OUTPUT_DATATYPE_NOT_TEXT:"MDL数据无法输出为非文本格式",MDL_INPUT_DATATYPE_NOT_TEXT:"非文本格式数据，非法的MDL源数据",UNABLE_TO_OUTPUT_AS_MDL:"无法将对象<{0}>输出至MDL格式数据",KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT:"非文本或JSON格式数据，非法的KCJ源数据",KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT:"无法输出为非文本或JSON格式",KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT:"非文本或DOM格式数据，非法的KCX源数据",KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT:"无法输出为非文本或DOM格式",JSON_SERIALIZER_NOT_EXISTS:"JSON序列化器不存在",XML_SERIALIZER_NOT_EXISTS:"XML序列化器不存在",JCAMP_DATA_WITHOUT_TITLE_LINE:"不正确的JCAMP格式数据：TITLE标签缺失",JCAMP_OTHER_LABEL_BEFORE_TITLE_LINE:"不正确的JCAMP格式数据：未以TITLE标签起始",JCAMP_MORE_THAN_ONE_ROOT_BLOCK:"不正确的JCAMP格式数据：存在多个根数据块",JCAMP_MORE_THAN_TWO_NEST_LEVEL:"不正确的JCAMP格式数据：超过两层数据块嵌套",JCAMP_ASDF_FORMAT_ERROR_WITH_STR:"不正确的JCAMP ASDF字符串: {0}",JCAMP_DATA_TABLE_X_VALUE_CHECK_ERROR:"JCAMP数据表X值校验失败!",JCAMP_DATA_TABLE_Y_VALUE_CHECK_ERROR:"JCAMP数据表Y值校验失败!",JCAMP_DATA_TABLE_VALUE_FIRST_LAST_NOT_MATCH:"JCAMP数据表起始/终止数据不匹配",JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR:"Malformed JCAMP variable list format: {0}",JCAMP_DATA_TABLE_VAR_LIST_FORMAT_UNSUPPORTED:"Unsupported JCAMP variable list format: {0}",JCAMP_NTUPLES_BEGIN_END_NAME_NOT_MATCH:"Ntuples name not match in begin/end labels: {0} and {1}",JCAMP_NTUPLES_PAGE_DECLARATION_FORMAT_ERROR:"Malformed JCAMP ntuples page declaration: {0}",JCAMP_LDR_TARGET_UNIT_NOT_MATCH_WITH_DETAIL:"The unit of property {0} ({1}) can not be converted to the request one ({2}) for JCAMP {3} LDR",FAILED_TO_ASSIGN_SYMBOL_TO_VARIABLE:"Fail to assign a symbol to variable {0}",JCAMP_IMPLICIT_HYDROGEN_COUNT_NOT_MATCH_DETAIL:"Unmatched implicit hydrogen count for atom {0}({1}), expect {2} but found {3}",VISIBLE_DATA_RANGE_IS_EMPTY:"The visible range of data is empty, unable to draw the spectrum",INAVAILABLE_AUTOSCALE_REF_LENGTH:"无法计算自动缩放所需的长度",FORMULA_RENDERER_3D_NOT_AVAILABLE:"分子式3D渲染器暂不可用",CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ:"无法找到合适的渲染器",THREEJS_LIB_NOT_UNAVAILABLE:"Three.js不可用，请使用<script>标签将其引入或使用Kekule.externalResourceManager.register方法指定Three实例",THREEJS_DRAWING_NOT_UNAVAILABLE:"浏览器不支持Webgl、Canvas或SVG，请将其升级或更换",CANVAS2D_NOT_UNAVAILABLE:"浏览器不支持Canvas，请将其升级或更换",RAPHAEL_LIB_NOT_UNAVAILABLE:"Raphael.js不可用，请使用<script>标签将其引入",RAPHAEL_SVG_VML_UNAVAILABLE:"浏览器不支持SVG或VML，请将其升级或更换。",CALC_TERMINATED_BY_USER:"计算过程被用户中断",CALC_SERVICE_UNAVAILABLE:"计算服务“{0}”不可用"}),Kekule.Localization.addResource("zh","ErrorCheckMsg",{GENERAL_ERROR_WITH_CODE:"错误代码: {0}",ATOM_VALENCE_ERROR_WITH_SUGGEST:"{0}原子价数（{1}）异于常见值（{2}）",ATOM_VALENCE_ERROR_WITH_SUGGESTS:"{0}原子价数（{1}）异于常见值（{2}）",BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"共价键键级（{0}）超出允许值（{1}）范围",BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"{0}键键级（{1}）超出允许值（{2}）范围",NODE_DISTANCE_TOO_CLOSE:"原子或基团位置过于接近",NODE_DISTANCE_TOO_CLOSE_WITH_LABEL:"原子或基团（{0}）位置过于接近",TITLE_CHANGE_BOND_ORDER_TO:"将键级修改为{0}",DESCRIPTION_CHANGE_BOND_ORDER_TO:"将键级由{0}修改为{1}",TITLE_MERGE_TO:"将{0}与{1}合并",DESCRIPTION_MERGE_TO:"将节点{0}与{1}合并"}),Kekule.Localization.setCurrModule("widget"),Kekule.Localization.addResource("zh","WidgetTexts",{CAPTION_OK:"确定",CAPTION_CANCEL:"取消",CAPTION_YES:"是",CAPTION_NO:"否",CAPTION_BROWSE_COLOR:"浏览颜色",HINT_BROWSE_COLOR:"浏览更多颜色",S_COLOR_UNSET:"(未设置)",S_COLOR_DEFAULT:"(缺省值)",S_COLOR_MIXED:"(多个值)",S_COLOR_TRANSPARENT:"(透明)",S_OBJECT_UNSET:"(无)",S_ITEMS:"条目",S_OBJECT:"对象",S_VALUE_UNSET:"(未设置)",CAPTION_MENU:"菜单",HINT_MENU:"打开菜单",S_INSPECT_NONE:"(无)",S_INSPECT_OBJECTS:"({0}个对象)",S_INSPECT_ID_OBJECT:"{0}: {1}",S_INSPECT_ANONYMOUS_OBJECT:"({0})",CAPTION_TOGGLE_TEXTWRAP:"切换文本换行",CAPTION_INC_TEXT_SIZE:"增大字号",CAPTION_DEC_TEXT_SIZE:"减小字号",HINT_TOGGLE_TEXTWRAP:"切换文本是否自动换行",HINT_INC_TEXT_SIZE:"增大字号",HINT_DEC_TEXT_SIZE:"减小字号",HINT_CHOOSE_FONT_FAMILY:"选择字体",CAPTION_FIRST_PAGE:"首页",CAPTION_LAST_PAGE:"末页",CAPTION_PREV_PAGE:"前一页",CAPTION_NEXT_PAGE:"后一页",HINT_FIRST_PAGE:"首页",HINT_LAST_PAGE:"末页",HINT_PREV_PAGE:"前一页",HINT_NEXT_PAGE:"后一页",HINT_CURR_PAGE:"当前页",MSG_RETRIEVING_DATA:"载入数据…",CAPTION_DATATABLE_EDIT:"编辑",CAPTION_DATATABLE_DELETE:"删除",CAPTION_DATATABLE_INSERT:"插入",HINT_DATATABLE_EDIT:"编辑数据",HINT_DATATABLE_DELETE:"删除数据",HINT_DATATABLE_INSERT:"插入数据",CAPTION_ADD_CELL:"+",HINT_ADD_CELL:"添加新单元格",CAPTION_REMOVE_CELL:"移除",HINT_REMOVE_CELL:"移除单元格",CAPTION_CONFIG:"设置…",HINT_CONFIG:"修改设置",TITLE_IMG_FORMAT_PNG:"PNG格式图像",TITLE_IMG_FORMAT_JPG:"Jpeg格式图像",TITLE_IMG_FORMAT_GIF:"GIF格式图像",TITLE_IMG_FORMAT_SVG:"SVG格式图像"}),Kekule.Localization.addResource("zh","ChemWidgetTexts",{CAPTION_CLEAROBJS:"清除",CAPTION_LOADFILE:"载入…",CAPTION_LOADDATA:"载入…",CAPTION_SAVEFILE:"保存…",CAPTION_ZOOMIN:"放大",CAPTION_ZOOMOUT:"缩小",CAPTION_RESETZOOM:"重置缩放",CAPTION_RESETVIEW:"重置",CAPTION_ROTATE:"旋转",CAPTION_ROTATELEFT:"向左旋转",CAPTION_ROTATERIGHT:"向右旋转",CAPTION_ROTATEX:"沿X轴旋转",CAPTION_ROTATEY:"沿Y轴旋转",CAPTION_ROTATEZ:"沿Z轴旋转",CAPTION_MOL_DISPLAY_TYPE:"分子显示样式",CAPTION_SKELETAL:"键线式",CAPTION_CONDENSED:"缩写式",CAPTION_WIRE:"单线模型",CAPTION_STICKS:"棍式模型",CAPTION_BALLSTICK:"球棍模型",CAPTION_SPACEFILL:"比例模型",CAPTION_HIDEHYDROGENS:"显示/隐藏氢原子",CAPTION_OPENEDITOR:"编辑…",CAPTION_EDITOR_DONE:"完成",CAPTION_EDITOR_CANCEL:"取消",CAPTION_EDIT_OBJ:"编辑",HINT_CLEAROBJS:"清除对象",HINT_LOADFILE:"自文件载入",HINT_LOADDATA:"载入数据",HINT_SAVEFILE:"存储到文件",HINT_ZOOMIN:"放大",HINT_ZOOMOUT:"缩小",HINT_RESETZOOM:"重置缩放",HINT_RESETVIEW:"重置缩放与旋转",HINT_ROTATE:"旋转",HINT_ROTATELEFT:"逆时针旋转",HINT_ROTATERIGHT:"顺时针旋转",HINT_ROTATEX:"沿X轴旋转",HINT_ROTATEY:"沿Y轴旋转",HINT_ROTATEZ:"沿Z轴旋转",HINT_MOL_DISPLAY_TYPE:"改变分子显示样式",HINT_SKELETAL:"以键线式显示",HINT_CONDENSED:"以缩写式显示",HINT_WIRE:"以单线模型显示",HINT_STICKS:"以棍式模型显示",HINT_BALLSTICK:"以球棍模型显示",HINT_SPACEFILL:"以比例模型显示",HINT_HIDEHYDROGENS:"模型中显示/隐藏氢原子",HINT_OPENEDITOR:"编辑当前对象",HINT_EDITOR_DONE:"关闭并保存编辑器中的修改",HINT_EDITOR_CANCEL:"关闭并取消编辑器中的修改",CAPTION_NEWDOC:"新建",CAPTION_UNDO:"撤销",CAPTION_REDO:"重做",CAPTION_COPY:"复制",CAPTION_COPY_WHOLE:"复制",CAPTION_CUT:"剪切",CAPTION_PASTE:"粘贴",CAPTION_TOGGLE_SELECT:"叠加选择",CAPTION_SELECT_ALL:"全选",CAPTION_CLONE_SELECTION:"克隆选区",CAPTION_TOGGLE_OBJ_INSPECTOR:"对象检视器",CAPTION_TOGGLE_ISSUE_INSPECTOR:"问题检视器",CAPTION_TOGGLE_SHOW_ISSUE_MARKERS:"显示问题标记",CAPTION_RECHECK_ISSUES:"重新检查问题",CAPTION_MANIPULATE:"选取",CAPTION_MANIPULATE_MARQUEE:"矩形选框",CAPTION_MANIPULATE_LASSO:"套索选择",CAPTION_MANIPULATE_BRUSH:"选择刷",CAPTION_MANIPULATE_ANCESTOR:"选择分子",CAPTION_CLIENT_DRAGSCROLL:"移动画布",CAPTION_ERASE:"删除",CAPTION_TRACK_INPUT:"手写输入",CAPTION_MOL_BOND:"键",CAPTION_MOL_BOND_SINGLE:"单键",CAPTION_MOL_BOND_DOUBLE:"双键",CAPTION_MOL_BOND_TRIPLE:"三键",CAPTION_MOL_BOND_QUAD:"四键",CAPTION_MOL_BOND_EXPLICIT_AROMATIC:"芳香键",CAPTION_MOL_BOND_WEDGEUP:"实楔线键",CAPTION_MOL_BOND_WEDGEUP_INVERTED:"实楔线键2",CAPTION_MOL_BOND_WEDGEDOWN:"虚楔线键",CAPTION_MOL_BOND_WEDGEDOWN_INVERTED:"虚楔线键2",CAPTION_MOL_BOND_CLOSER:"突出(加粗)键",CAPTION_MOL_BOND_WAVY:"波浪键",CAPTION_MOL_BOND_DOUBLE_EITHER:"顺或反式双键",CAPTION_MOL_BOND_IONIC:"离子键",CAPTION_MOL_BOND_COORDINATE:"配位键",CAPTION_MOL_BOND_METALLIC:"金属键",CAPTION_MOL_BOND_HYDROGEN:"氢键",CAPTION_MOL_BOND_KEKULIZE:"Kekulize",CAPTION_MOL_BOND_HUCKLIZE:"Hucklize",CAPTION_MOL_ATOM:"原子",CAPTION_MOL_FORMULA:"分子式",CAPTION_MOL_ATOM_AND_FORMULA:"原子与分子式",CAPTION_MOL_CHARGE:"电荷",CAPTION_MOL_CHARGE_CLEAR:"清除电荷",CAPTION_MOL_CHARGE_POSITIVE:"正电荷",CAPTION_MOL_CHARGE_NEGATIVE:"负电荷",CAPTION_MOL_CHARGE_SINGLET:"单线态",CAPTION_MOL_CHARGE_DOUBLET:"双线态自由基",CAPTION_MOL_CHARGE_TRIPLET:"三线态",CAPTION_MOL_ELECTRON_LONEPAIR:"孤对电子",CAPTION_TEXT_BLOCK:"文字",CAPTION_IMAGE_BLOCK:"图像",CAPTION_TEXT_IMAGE:"文字与图像",CAPTION_MOL_FLEXCHAIN:"可变碳链",CAPTION_MOL_FLEXRING:"可变碳环",CAPTION_REPOSITORY_RING:"环",CAPTION_REPOSITORY_RING_3:"环丙烷",CAPTION_REPOSITORY_RING_4:"环丁烷",CAPTION_REPOSITORY_RING_5:"环戊烷",CAPTION_REPOSITORY_RING_6:"环己烷",CAPTION_REPOSITORY_RING_7:"环庚烷",CAPTION_REPOSITORY_RING_8:"环辛烷",CAPTION_REPOSITORY_RING_AR_6:"苯",CAPTION_REPOSITORY_RING_AR_5:"环戊二烯",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1:"环己烷椅式1",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2:"环己烷椅式2",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1:"环己烷Haworth式1",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2:"环己烷Haworth式2",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1:"环戊烷Haworth式1",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2:"环戊烷Haworth式2",CAPTION_REPOSITORY_METHANE:"甲烷",CAPTION_REPOSITORY_FISCHER1:"单手性中心Fischer投影式",CAPTION_REPOSITORY_FISCHER2:"双手性中心Fischer投影式",CAPTION_REPOSITORY_FISCHER3:"三手性中心Fischer投影式",CAPTION_REPOSITORY_SAWHORSE_STAGGERED:"交叉式锯架式",CAPTION_REPOSITORY_SAWHORSE_ECLIPSED:"重叠式锯架式",CAPTION_REPOSITORY_SUBBOND_MARK:"取代基键",CAPTION_REPOSITORY_ARROWLINE:"线段与箭头",CAPTION_REPOSITORY_GLYPH:"图符",CAPTION_REPOSITORY_GLYPH_LINE:"直线",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"开放箭头线",CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"三角箭头线",CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"双向开放箭头线",CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"双向三角箭头线",CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE:"可逆箭头线",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"开放箭头双线",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"开放箭头弧线",CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"单侧开放箭头弧线",CAPTION_ELECTRON_PUSHING_ARROW:"电子转移箭头",CAPTION_ELECTRON_PUSHING_ARROW_DOUBLE:"双电子转移箭头",CAPTION_ELECTRON_PUSHING_ARROW_SINGLE:"单电子转移箭头",CAPTION_REPOSITORY_HEAT_SYMBOL:"加热符号",CAPTION_REPOSITORY_ADD_SYMBOL:"加号",CAPTION_TEXT_FORMAT:"文字格式",CAPTION_PICK_COLOR:"颜色",CAPTION_FONTNAME:"字体",CAPTION_FONTSIZE:"字号",CAPTION_TEXT_DIRECTION:"文字方向",CAPTION_TEXT_DIRECTION_DEFAULT:"缺省",CAPTION_TEXT_DIRECTION_LTR:"由左至右",CAPTION_TEXT_DIRECTION_RTL:"由右至左",CAPTION_TEXT_DIRECTION_TTB:"由上至下",CAPTION_TEXT_DIRECTION_BTT:"由下至上",CAPTION_TEXT_HORIZONTAL_ALIGN:"文字水平对齐",CAPTION_TEXT_VERTICAL_ALIGN:"文字垂直对齐",CAPTION_TEXT_ALIGN_DEFAULT:"缺省",CAPTION_TEXT_ALIGN_LEADING:"首对齐",CAPTION_TEXT_ALIGN_TRAILING:"尾对齐",CAPTION_TEXT_ALIGN_CENTER:"居中对齐",CAPTION_TEXT_ALIGN_LEFT:"左对齐",CAPTION_TEXT_ALIGN_RIGHT:"右对齐",CAPTION_TEXT_ALIGN_TOP:"上对齐",CAPTION_TEXT_ALIGN_BOTTOM:"下对齐",CAPTION_NODE_LABEL_DISPLAY_MODE:"原子标签显示模式",CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT:"默认",CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN:"显示文本",CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN:"隐藏文本",CAPTION_NODE_LABEL_DISPLAY_MODE_SMART:"智能",CAPTION_ATOM_MODIFIER:"原子",CAPTION_ATOM_MODIFIER_MIXED:"[A]",CAPTION_BOND_MODIFIER:"键",CAPTION_CHARGE_MODIFIER:"电荷",CAPTION_GLYPH_PATH_MODIFIER:"线段",CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"反应箭头与线段",CAPTION_ARC_PATH_MODIFIER:"弧线",CAPTION_MULTI_ARC_PATH_MODIFIER:"多弧线",CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER:"电子转移箭头",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"电子转移成键箭头",TEXT_CHARGE_POSITIVE:"+",TEXT_CHARGE_NEGATIVE:"-",TEXT_CHARGE_UNKNOWN:"<sup>+</sup>/<sub>-</sub>",TEXT_CHARGE_NONE:"&#8709;",HINT_NEWDOC:"创建新文档",HINT_UNDO:"撤销",HINT_REDO:"重做",HINT_COPY_WHOLE:"将对象复制至内部剪贴板",HINT_COPY:"将选定对象复制至内部剪贴板",HINT_CUT:"将选定对象剪切至内部剪贴板",HINT_PASTE:"自内部剪贴板复制",HINT_CLONE_SELECTION:"克隆当前选区",HINT_SELECT_ALL:"选择全部对象",HINT_TOGGLE_SELECT:"叠加选择",HINT_TOGGLE_OBJ_INSPECTOR:"显示或隐藏对象检视器",HINT_TOGGLE_ISSUE_INSPECTOR:"显示或隐藏问题检视器",HINT_TOGGLE_SHOW_ISSUE_MARKERS:"显示或隐藏问题标记",HINT_RECHECK_ISSUES:"重新检查编辑内容中的问题",HINT_MANIPULATE:"选择工具",HINT_MANIPULATE_MARQUEE:"矩形选框",HINT_MANIPULATE_LASSO:"套索选择",HINT_MANIPULATE_BRUSH:"选择刷",HINT_MANIPULATE_ANCESTOR:"选择分子",HINT_CLIENT_DRAGSCROLL:"移动画布",HINT_ERASE:"删除工具",HINT_TRACK_INPUT:"手写输入工具",HINT_MOL_BOND:"化学键工具",HINT_MOL_BOND_SINGLE:"单键",HINT_MOL_BOND_DOUBLE:"双键",HINT_MOL_BOND_TRIPLE:"叁键",HINT_MOL_BOND_QUAD:"四键",HINT_MOL_BOND_EXPLICIT_AROMATIC:"显式芳香键",HINT_MOL_BOND_WEDGEUP:"实楔线键",HINT_MOL_BOND_WEDGEUP_INVERTED:"实楔线键2",HINT_MOL_BOND_WEDGEDOWN:"虚楔线键",HINT_MOL_BOND_WEDGEDOWN_INVERTED:"虚楔线键2",HINT_MOL_BOND_CLOSER:"突出(加粗)键",HINT_MOL_BOND_WAVY:"波浪键",HINT_MOL_BOND_DOUBLE_EITHER:"顺或反式双键",HINT_MOL_BOND_IONIC:"离子键",HINT_MOL_BOND_COORDINATE:"配位键",HINT_MOL_BOND_METALLIC:"金属键",HINT_MOL_BOND_HYDROGEN:"氢键",HINT_MOL_BOND_KEKULIZE:"Kekulize, 将显式的芳香键转换为单双键间隔形式",HINT_MOL_BOND_HUCKLIZE:"Hucklize, 将芳环上的键转换为显式的芳香键",HINT_MOL_ATOM:"原子工具",HINT_MOL_FORMULA:"分子式工具",HINT_MOL_ATOM_AND_FORMULA:"原子与分子式工具",HINT_MOL_CHARGE:"电荷工具",HINT_MOL_CHARGE_CLEAR:"清除电荷或自由基",HINT_MOL_CHARGE_POSITIVE:"正电荷",HINT_MOL_CHARGE_NEGATIVE:"负电荷",HINT_MOL_CHARGE_SINGLET:"单线态自由基",HINT_MOL_CHARGE_DOUBLET:"双线态自由基",HINT_MOL_CHARGE_TRIPLET:"三线态自由基",HINT_MOL_ELECTRON_LONEPAIR:"孤对电子",HINT_TEXT_BLOCK:"文字工具",HINT_IMAGE_BLOCK:"图像工具",HINT_TEXT_IMAGE:"文字与图像工具",HINT_MOL_FLEXCHAIN:"可变碳链",HINT_MOL_FLEXRING:"可变碳环",HINT_REPOSITORY_RING:"环工具",HINT_REPOSITORY_RING_3:"环丙烷",HINT_REPOSITORY_RING_4:"环丁烷",HINT_REPOSITORY_RING_5:"环戊烷",HINT_REPOSITORY_RING_6:"环己烷",HINT_REPOSITORY_RING_7:"环庚烷",HINT_REPOSITORY_RING_8:"环辛烷",HINT_REPOSITORY_RING_AR_6:"苯",HINT_REPOSITORY_RING_AR_5:"环戊二烯",HINT_REPOSITORY_CYCLOHEXANE_CHAIR1:"环己烷椅式1",HINT_REPOSITORY_CYCLOHEXANE_CHAIR2:"环己烷椅式2",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1:"环己烷Haworth式1",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2:"环己烷Haworth式2",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1:"环戊烷Haworth式1",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2:"环戊烷Haworth式2",HINT_REPOSITORY_SUBBOND_MARK:"取代基键",HINT_REPOSITORY_METHANE:"甲烷",HINT_REPOSITORY_FISCHER1:"单手性中心Fischer投影式",HINT_REPOSITORY_FISCHER2:"双手性中心Fischer投影式",HINT_REPOSITORY_FISCHER3:"三手性中心Fischer投影式",HINT_REPOSITORY_SAWHORSE_STAGGERED:"交叉式锯架式",HINT_REPOSITORY_SAWHORSE_ECLIPSED:"重叠式锯架式",HINT_REPOSITORY_ARROWLINE:"线段与箭头",HINT_REPOSITORY_GLYPH:"图符",HINT_REPOSITORY_GLYPH_LINE:"直线",HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"开放箭头线",HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"三角箭头线",HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"双向开放箭头线",HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"双向三角箭头线",HINT_REPOSITORY_GLYPH_REV_ARROW_LINE:"可逆箭头线",HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"开放箭头双线",HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"开放箭头弧线",HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"单侧开放箭头弧线",HINT_REPOSITORY_HEAT_SYMBOL:"加热符号",HINT_REPOSITORY_ADD_SYMBOL:"加号",HINT_ELECTRON_PUSHING_ARROW:"电子转移箭头",HINT_NODE_LABEL_DISPLAY_MODE:"原子标签显示模式",HINT_TEXT_FORMAT:"设置文字格式",HINT_FONTNAME:"设置字体",HINT_FONTSIZE:"设置字号",HINT_PICK_COLOR:"选择颜色",HINT_TEXT_DIRECTION:"设置文字方向",HINT_TEXT_HORIZONTAL_ALIGN:"设置文字水平对齐方式",HINT_TEXT_VERTICAL_ALIGN:"设置文字水平垂直方式",HINT_CHARGE_NONE:"无电荷",HINT_ATOM_MODIFIER:"设置原子",HINT_BOND_MODIFIER:"设置键",HINT_CHARGE_MODIFIER:"设置电荷",HINT_GLYPH_PATH_MODIFIER:"设置线段",HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"设置反应箭头与线段",HINT_ARC_PATH_MODIFIER:"设置弧线",HINT_MULTI_ARC_PATH_MODIFIER:"设置多重弧线",HINT_ELECTRON_PUSHING_ARROW_MODIFIER:"设置电子转移箭头",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"设置电子转移成键箭头",HINT_USE_ATOM_CUSTOM_COLOR:"(使用原子特征颜色)",CAPTION_LOADDATA_DIALOG:"载入数据",CAPTION_LOADDATA_DIALOG_APPENDMODE:"附加到当前文档",CAPTION_SAVEDATA_DIALOG:"保存数据",CAPTION_DATA_FORMAT:"数据格式：",CAPTION_DATA_SRC:"在下方输入或粘贴数据：",CAPTION_LOADDATA_FROM_FILE:"载入文件",CAPTION_CHOOSEFILEFORMAT:"选择文件格式",CAPTION_SELECT_FORMAT:"选择格式：",CAPTION_PREVIEW_FILE_CONTENT:"预览文件内容…",S_DEF_SAVE_FILENAME:"Unnamed",CAPTION_ATOMLIST_PERIODIC_TABLE:"更多…",CAPTION_RGROUP:"取代基",CAPTION_VARIABLE_ATOM:"(包含)原子列表",CAPTION_VARIABLE_NOT_ATOM:"(不包含)原子列表",CAPTION_PSEUDOATOM:"赝原子(Pseudoatom)",CAPTION_DUMMY_ATOM:"虚原子(Dummy atom)",CAPTION_HETERO_ATOM:"杂原子",CAPTION_ANY_ATOM:"任意原子",CAPTION_ATOM:"原子",CAPTION_SUBGROUP:"基团",CAPTION_PERIODIC_TABLE_DIALOG:"元素周期表",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM:"选择元素",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEMS:"选择多个元素",CAPTION_TEXTBLOCK_INIT:"在此输入文字",CAPTION_WIDTH:"宽",CAPTION_LENGTH:"长",CAPTION_PATH_INDEX:"Path {0}",HINT_PATH_INDEX:"Path {0}",CAPTION_REACTION_ARROW_UNSET:"(未设置)",CAPTION_REACTION_ARROW_CUSTOM:"自定义",CAPTION_REACTION_ARROW_NORMAL:"普通反应箭头",CAPTION_REACTION_ARROW_RESONANCE:"共振式箭头",CAPTION_REACTION_ARROW_REVERSIBLE:"可逆反应箭头",CAPTION_REACTION_ARROW_RETROSYNTHESIS:"逆合成分析箭头",HINT_REACTION_ARROW_UNSET:"未设置",HINT_REACTION_ARROW_CUSTOM:"自定义",HINT_REACTION_ARROW_NORMAL:"普通反应箭头",HINT_REACTION_ARROW_RESONANCE:"共振式箭头",HINT_REACTION_ARROW_REVERSIBLE:"可逆反应箭头",HINT_REACTION_ARROW_RETROSYNTHESIS:"逆合成分析箭头",CAPTION_LINE_COUNT:"直线数目",CAPTION_LINE_GAP:"直线间隙",CAPTION_LINE:"直线",CAPTION_STARTING_ARROW:"起始箭头",CAPTION_ENDING_ARROW:"终止箭头",CAPTION_REACTION_ARROW_TYPE:"反应箭头类型",CAPTION_ELECTRON_PUSHING_ARROW_TYPE:"电子转移箭头类型",CAPTION_OPPOSITE_ARROW_SIDES:"箭头位置相反",CAPTION_SAME_ARROW_SIDES:"箭头位置相同",CAPTION_ELECTRON_PUSHING_ARROW_1:"单电子转移箭头",CAPTION_ELECTRON_PUSHING_ARROW_1_ABBR:"单电子",HINT_ELECTRON_PUSHING_ARROW_1:"单电子转移箭头",CAPTION_ELECTRON_PUSHING_ARROW_2:"双电子转移箭头",CAPTION_ELECTRON_PUSHING_ARROW_2_ABBR:"双电子",HINT_ELECTRON_PUSHING_ARROW_2:"双电子转移箭头",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"电子转移成键箭头",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"电子转移成键箭头",LEGEND_CAPTION:"图例",LEGEND_ELEM_SYMBOL:"元素符号",LEGEND_ELEM_NAME:"名称",LEGEND_ATOMIC_NUM:"原子序数",LEGEND_ATOMIC_WEIGHT:"原子量",CAPTION_2D:"2D",CAPTION_3D:"3D",CAPTION_AUTOSIZE:"自动尺寸",CAPTION_AUTOFIT:"自动缩放",CAPTION_SHOWSIZEINFO:"显示尺寸信息",CAPTION_LABEL_SIZE:"尺寸：",CAPTION_BACKGROUND_COLOR:"背景颜色：",CAPTION_WIDTH_HEIGHT:"宽：{0}、高：{1}",PLACEHOLDER_WIDTH:"宽",PLACEHOLDER_HEIGHT:"高",HINT_AUTOSIZE:"图形尺寸是否由对象大小自动调整",HINT_AUTOFIT:"对象是否填满图形区域",S_VALUE_DEFAULT:"(缺省)",CAPTION_TOGGLE_INSPECTOR:"对象检视器",HINT_TOGGLE_INSPECTOR:"显示或隐藏对象检视器"}),Kekule.Localization.addResource("zh","ErrorMsg",{WIDGET_CLASS_NOT_FOUND:"控件类不存在",WIDGET_CAN_NOT_BIND_TO_ELEM:"控件{0}无法绑定到HTML元素<{1}>",LOAD_CHEMDATA_FAILED:"载入数据失败",FILE_API_NOT_SUPPORTED:"您当前的浏览器不支持HTML文件操作，请升级浏览器。",DRAW_BRIDGE_NOT_SUPPORTED:"您当前的浏览器不支持该绘图功能，请升级浏览器。",COMMAND_NOT_REVERSIBLE:"命令无法撤销",PAGE_INDEX_OUTOF_RANGE:"页面超出范围",FETCH_DATA_TIMEOUT:"加载数据超时",RENDER_TYPE_CHANGE_NOT_ALLOWED:"渲染类型无法改变",CAN_NOT_CREATE_EDITOR:"创建编辑器失败",CAN_NOT_SET_COORD_OF_CLASS:"无法设置对象{0}实例的坐标",CAN_NOT_SET_DIMENSION_OF_CLASS:"无法设置对象{0}实例的尺寸",CAN_NOT_MERGE_CONNECTORS:"化学键或连接符无法合并",NOT_A_VALID_ATOM:"无效的原子",INVALID_ATOM_SYMBOL:"原子符号无效",INVALID_OR_EMPTY_IMAGE:"空白或不合法的图像"}),function(){if(Kekule.PROP_AUTO_TITLE){var e=ClassEx.getPrototype(ObjectEx).defineProp;ClassEx.getPrototype(ObjectEx).defineProp=function(t,r){if(!r.title&&!r.description){var i=this.getClassName();i.startsWith("Kekule.")&&(i=i.substr(7));var n="TITLE_"+t,o="DES_"+t,a=Kekule.Localization.findValue("OBJDEF_TEXTS."+i+"."+n),s=Kekule.Localization.findValue("OBJDEF_TEXTS."+i+"."+o);r.title=a,r.description=s}return e.apply(this,[t,r])}}Kekule.ExceptionLevel={ERROR:-1,NOT_FATAL_ERROR:-10,WARNING:-2,NOTE:-3,LOG:-4,getAllLevels:function(){var e=Kekule.ExceptionLevel;return[e.ERROR,e.NOT_FATAL_ERROR,e.WARNING,e.NOTE,e.LOG]},levelToString:function(e){var t=Kekule.ExceptionLevel;return e===t.ERROR||e===t.NOT_FATAL_ERROR?"error":e===t.WARNING?"warning":e===t.NOTE?"note":"log"}},Kekule.ErrorLevel=Kekule.ExceptionLevel,Kekule.throwException=function(e,t){if(Kekule.exceptionHandler)return Kekule.exceptionHandler.throwException(e,t);var r=Kekule.ExceptionLevel;if(!t||t===r.ERROR)throw"string"==typeof e&&(e=new Kekule.Exception(e)),e;if("undefined"!=typeof console){"string"!=typeof e&&(e=e.message);var i=t===r.NOT_FATAL_ERROR?console.error:t===r.WARNING?console.warn:t===r.NOTE?console.info:console.log;i?i(e):console.log(e)}},Kekule.getExceptionMsg=function(e){return"string"==typeof e?e:"object"==typeof e?e.message:""},Kekule.raise=Kekule.throwException,Kekule.error=function(e,t){var r=t?Kekule.ExceptionLevel.NOT_FATAL_ERROR:Kekule.ExceptionLevel.ERROR;return Kekule.raise(e,r)},Kekule.chemError=function(e,t){return"string"==typeof e&&(e=new Kekule.ChemError(e)),Kekule.error(e,t)},Kekule.warn=function(e){return Kekule.raise(e,Kekule.ExceptionLevel.WARNING)},Kekule.notify=function(e){return Kekule.raise(e,Kekule.ExceptionLevel.NOTE)},Kekule.log=function(e){return Kekule.raise(e,Kekule.ExceptionLevel.LOG)},Kekule.hasLocalRes=function(){return!!Kekule.LOCAL_RES},Kekule.globalOptions={add:function(e,t){var r=Object.getCascadeFieldValue(e,Kekule.globalOptions);r&&DataType.isObjectValue(r)&&DataType.isObjectValue(t)?Object.extend(r,t):Object.setCascadeFieldValue(e,t,Kekule.globalOptions,!0)},get:function(e,t){var r=Object.getCascadeFieldValue(e,Kekule.globalOptions);return void 0===r&&(r=t),r}},Kekule.HashEx=Class.create({CLASS_NAME:"Kekule.HashEx",PROP_NAME_PREFIX:"__$key$__",initialize:function(){this._map={}},finalize:function(){this._map=null},keyToPropName:function(e){return this.PROP_NAME_PREFIX+e},has:function(e){return this._map.hasOwnProperty(this.keyToPropName(e))},set:function(e,t){return this._map[this.keyToPropName(e)]=t,this},get:function(e,t){var r=this.keyToPropName(e);return this._map.hasOwnProperty(r)?this._map[r]:t},remove:function(e){var t=this.keyToPropName(e);return this._map.hasOwnProperty(t)&&delete this._map[t],this},clear:function(){this._map={}}}),Kekule.MapEx=Class.create({CLASS_NAME:"Kekule.MapEx",initialize:function(e,t){this.isWeak=!e,Kekule.MapEx._inited||Kekule.MapEx._init();var r=e?Kekule.MapEx._implementationNonWeak:Kekule.MapEx._implementationWeak;r?this._implementation=new r:(this._keys=[],this._values=[]),t&&(this._cache={})},finalize:function(){this._implementation||(this._keys=null,this._values=null,this._cache=null)},set:function(e,t){if(this._implementation)this._implementation.set(e,t);else{var r=this._keys.indexOf(e);r>=0?this._values[r]=t:(this._keys.push(e),this._values.push(t))}return this._cache&&this._cache.key===e&&(this._cache.value=t),this},get:function(e,t){if(this._cache&&this._cache.key===e)return this._cache.value;var r,i=!1;if(this._implementation)this._implementation.has(e)&&(r=this._implementation.get(e),i=!0);else{var n=this._keys.indexOf(e);n>=0&&(r=this._values[n],i=!0)}return i&&this._cache&&(this._cache.key=e,this._cache.value=r),i?r:t},has:function(e){return this._implementation?this._implementation.has(e):this._keys.indexOf(e)>=0},remove:function(e){if(this._cache&&this._cache.key===e&&(this._cache={}),this._implementation)return this._implementation[!this._implementation||"delete"](e);var t=this._keys.indexOf(e);return t>=0&&(this._keys.splice(t,1),this._values.splice(t,1)),this},clear:function(){return this._cache&&(this._cache={}),this._implementation&&!this._debug||(this._keys=[],this._values=[]),this._implementation&&(this.isWeak?Kekule.error(Kekule.$L("ErrorMsg.CANNOT_CLEAR_WEAKMAP")):this._implementation.clear()),this},getKeys:function(){if(this._implementation){if(this.isWeak)return Kekule.error(Kekule.$L("ErrorMsg.CANNOT_GET_KEY_LIST_IN_WEAKMAP")),[];var e,t=this._implementation.keys();if(Array.from)e=Array.from(t);else if(t.next){e=[];for(var r=t.next();!r.done;)e.push(r.value),r=t.next()}else for(var i in e=[],t)e.push(i);return e}return[].concat(this._keys)},getValues:function(){if(this._implementation){if(this.isWeak)return Kekule.error(Kekule.$L("ErrorMsg.CANNOT_GET_VALUE_LIST_IN_WEAKMAP")),[];var e,t=this._implementation.values();if(Array.from)e=Array.from(t);else if(t.next){e=[];for(var r=t.next();!r.done;)e.push(r.value),r=t.next()}else for(var i in e=[],t)e.push(i);return e}return this._values},getLength:function(){return this.getKeys().length}}),Kekule.MapEx._init=function(){Kekule.MapEx._implementationWeak=null,Kekule.MapEx._implementationNonWeak=null,Kekule.$jsRoot.WeakMap&&(Kekule.MapEx._implementationWeak=Kekule.$jsRoot.WeakMap),Kekule.$jsRoot.Map&&Kekule.$jsRoot.Map.prototype.keys&&(Kekule.MapEx._implementationNonWeak=Kekule.$jsRoot.Map),Kekule.MapEx._inited=!0},Kekule.MapEx._inited=!1,Kekule.TwoTupleMapEx=Class.create({CLASS_NAME:"Kekule.TwoTupleMapEx",initialize:function(e,t){this.nonWeak=e,this.map=new Kekule.MapEx(e,t),t&&(this._level1Cache={})},finalize:function(){this._level1Cache=null,this.map.finalize()},getSecondLevelMap:function(e,t){if(e&&this._level1Cache&&e===this._level1Cache.key&&this._level1Cache.value)return this._level1Cache.value;var r=this.map.get(e);return!r&&t&&(r=new Kekule.MapEx(this.nonWeak),this.map.set(e,r)),r},set:function(e,t,r){return this.getSecondLevelMap(e,!0).set(t,r),this},get:function(e,t,r){var i=this.getSecondLevelMap(e,!1);return i?i.get(t,r):r},has:function(e,t){var r=this.getSecondLevelMap(e,!1);return!!r&&r.has(t)},remove:function(e,t){var r=this.getSecondLevelMap(e,!1);if(r)return r.remove(t)},clear:function(){this.map.clear(),this._level1Cache&&(this._level1Cache={})}}),Kekule.CoordMode={UNKNOWN:0,COORD2D:2,COORD3D:3},Kekule.ObjAnchorPosition={CORNER:0,CENTER:1,DEFAULT:0},Kekule.ClassDefineUtils={CommonSizeMethods:{getSizeOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getSize3D(t):this.getSize2D(t)},setSizeOfMode:function(e,t){return t===Kekule.CoordMode.COORD3D?this.setSize3D(e):this.setSize2D(e)},getBoxOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getBox3D(t):this.getBox2D(t)}},Size2DMethods:{fetchSize2D:function(){var e=this.getPropStoreFieldValue("size2D");return e||(e={},this.setPropStoreFieldValue("size2D",e)),e},notifySize2DChanged:function(e){this.notifyPropSet("size2D",e)},hasSize2D:function(e){var t=this.getPropStoreFieldValue("size2D"),r=t&&(void 0!==t.x||void 0!==t.y);return!r&&e&&(r=!!this.hasSize3D&&this.hasSize3D()),r},getBox2D:function(e){var t=this.getCoord2D(e)||{x:0,y:0},r=this.getSize2D(e);if(r&&(r.x||r.y)){var i={x:r.x,y:-r.y},n=Kekule.CoordUtils.add(t,i);return{x1:t.x,y1:t.y,x2:n.x,y2:n.y}}return{x1:t.x,y1:t.y,x2:t.x,y2:t.y}},get2DSizeX:function(e){var t=this.getSize2D(e);return t&&t.x||0},set2DSizeX:function(e){var t=this.fetchSize2D();t.x!=e&&(t.x=e,this.notifySize2DChanged(t))},get2DSizeY:function(e){var t=this.getSize2D(e);return t&&t.y||0},set2DSizeY:function(e){var t=this.fetchSize2D();t.y!=e&&(t.y=e,this.notifySize2DChanged(t))}},Size3DMethods:{fetchSize3D:function(){var e=this.getPropStoreFieldValue("size3D");return e||(e={},this.setPropStoreFieldValue("size3D",e)),e},notifySize3DChanged:function(e){this.notifyPropSet("size3D",e)},hasSize3D:function(e){var t=this.getPropStoreFieldValue("size3D"),r=t&&(void 0!==t.x||void 0!==t.y||void 0!==t.z);return!r&&e&&(r=!!this.hasSize2D&&this.hasSize2D()),r},getBox3D:function(e){var t=this.getCoord3D(e),r=this.getSize3D(e);if(t&&r){var i=Kekule.CoordUtils.add(t,r);return{x1:t.x,y1:t.y,z1:t.z,x2:i.x,y2:i.y,z2:i.z}}},get3DSizeX:function(e){var t=this.getSize3D(e);return t&&t.x||0},set3DSizeX:function(e){var t=this.fetchSize3D();t.x!=e&&(t.x=e,this.notifySize3DChanged(t))},get3DSizeY:function(e){var t=this.getSize3D(e);return t&&t.y||0},set3DSizeY:function(e){var t=this.fetchSize3D();t.y!=e&&(t.y=e,this.notifySize3DChanged(t))},get3DSizeZ:function(e){var t=this.getSize3D(e);return t&&t.z||0},set3DSizeZ:function(e){var t=this.fetchSize3D();t.z!=e&&(t.z=e,this.notifySize3DChanged(t))}},addStandardSizeSupport:function(e,t){ClassEx.extend(e,Kekule.ClassDefineUtils.CommonSizeMethods),(!t||t.indexOf("size2D")>=0)&&(ClassEx.defineProp(e,"size2D",{dataType:DataType.HASH,getter:function(e,t){var r=this.getPropStoreFieldValue("size2D");!r&&e&&this.hasSize3D()&&(r=this.getSize3D()),!r&&t&&(r={x:0,y:0},this.setPropStoreFieldValue("size2D",r));var i=r?{x:r.x,y:r.y}:void 0;return i&&(i=Kekule.CoordUtils.absValue(i)),i},setter:function(e){var t=this.fetchSize2D();void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),this.notifySize2DChanged(t)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Size2DMethods)),(!t||t.indexOf("size3D")>=0)&&(ClassEx.defineProp(e,"size3D",{dataType:DataType.HASH,getter:function(e,t){var r=this.getPropStoreFieldValue("size3D");return!r&&e&&this.hasSize2D()&&((r=this.getSize2D()).z=0),!r&&t&&(r={x:0,y:0,z:0},this.setPropStoreFieldValue("size3D",r)),r?{x:r.x,y:r.y,z:r.z}:void 0},setter:function(e){var t=this.fetchSize3D();void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),void 0!==e.z&&(t.z=e.z),this.notifySize3DChanged(t)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Size3DMethods))},CommonCoordMethods:{getObjAnchorPosition:function(e){var t=this.doGetObjAnchorPosition&&this.doGetObjAnchorPosition(e);return t=t||Kekule.ObjAnchorPosition.DEFAULT},getCoordParent:function(e){return this.getParent&&this.getParent()||null},getCoordOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getCoord3D(t):this.getCoord2D(t)},setCoordOfMode:function(e,t){return t===Kekule.CoordMode.COORD3D?this.setCoord3D(e):this.setCoord2D(e)},getAbsCoordOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getAbsCoord3D(t):this.getAbsCoord2D(t)},setAbsCoordOfMode:function(e,t){return t===Kekule.CoordMode.COORD3D?this.setAbsCoord3D(e):this.setAbsCoord2D(e)},hasCoordOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.hasCoord3D(t):this.hasCoord2D(t)},getIndirectCoordStorageOfMode:function(e){var t=this.getIndirectCoordStorage&&this.getIndirectCoordStorage();return t&&t[e]},setIndirectCoordStorageOfMode:function(e,t){var r=this.getIndirectCoordStorage&&this.getIndirectCoordStorage();return r&&(r[e]=t),this},calcIndirectCoordValue:function(e,t){var r=["x","y"];e===Kekule.CoordMode.COORD3D&&r.push("z");var i=this.getIndirectCoordStorage()[e],n=this.getIndirectCoordRefCoords(e,t);Kekule.ArrayUtils.isArray(n)&&(n=n[0]);var o=this.getIndirectCoordRefLengths(e,t);if(i&&n&&o){for(var a={},s=Kekule.ObjUtils.notUnset,l=0,u=r.length;l<u;++l){var d,c=r[l],h=i[c],p=n[c],g=o[c];if(s(h)&&s(p)&&s(g))d=0===g?p:p+g*h,a[c]=d}return a}return null},calcIndirectCoordStorage:function(e,t,r,i){var n=["x","y"];e===Kekule.CoordMode.COORD3D&&n.push("z");var o=this.getIndirectCoordStorageOfMode(e),a=this.getIndirectCoordRefCoords(e,i);Kekule.ArrayUtils.isArray(a)&&(a=a[0]);var s=this.getIndirectCoordRefLengths(e,i);if(o&&a&&s){for(var l={},u=Kekule.ObjUtils.notUnset,d=0,c=n.length;d<c;++d){var h,p=n[d],g=t[p],f=a[p],C=s[p];if(!(u(g)&&u(f)&&u(C)))return null;h=0!==C?(g-f)/C:1,l[p]=h}return l}return null},saveIndirectCoordValue:function(e,t,r,i){if(t){var n=this.calcIndirectCoordStorage(e,t,r,i);if(n)return this.setIndirectCoordStorageOfMode(e,n),n}return null},getIndirectCoordRefLengths:function(e,t){return null},getIndirectCoordRefCoords:function(e,t){return null}},Coord2DMethods:{fetchCoord2D:function(){var e=this.getPropStoreFieldValue("coord2D");return e||(e={},this.setPropStoreFieldValue("coord2D",e)),e},notifyCoord2DChanged:function(e){this.notifyPropSet("coord2D",e)},hasCoord2D:function(e){var t=this.getPropStoreFieldValue("coord2D"),r=t&&(void 0!==t.x||void 0!==t.y);return!r&&e&&(r=!!this.hasCoord3D&&this.hasCoord3D()),r},get2DX:function(e){var t=this.getCoord2D(e);return t&&t.x||0},set2DX:function(e){var t=this.fetchCoord2D();t.x!=e&&(t.x=e,this.notifyCoord2DChanged(t))},get2DY:function(e){var t=this.getCoord2D(e);return t&&t.y||0},set2DY:function(e){var t=this.fetchCoord2D();t.y!=e&&(t.y=e,this.notifyCoord2DChanged(t))}},Coord3DMethods:{fetchCoord3D:function(){var e=this.getPropStoreFieldValue("coord3D");return e||(e={},this.setPropStoreFieldValue("coord3D",e)),e},notifyCoord3DChanged:function(e){this.notifyPropSet("coord3D",e)},hasCoord3D:function(e){var t=this.getPropStoreFieldValue("coord3D"),r=t&&(void 0!==t.x||void 0!==t.y||void 0!==t.z);return!r&&e&&(r=!!this.hasCoord2D&&this.hasCoord2D()),r},get3DX:function(e){var t=this.getCoord3D(e);return t&&t.x||0},set3DX:function(e){var t=this.fetchCoord3D();t.x!=e&&(t.x=e,this.notifyCoord3DChanged(t))},get3DY:function(e){var t=this.getCoord3D(e);return t&&t.y||0},set3DY:function(e){var t=this.fetchCoord3D();t.y!=e&&(t.y=e,this.notifyCoord3DChanged(t))},get3DZ:function(e){var t=this.getCoord3D(e);return t&&t.z||0},set3DZ:function(e){var t=this.fetchCoord3D();t.z!=e&&(t.z=e,this.notifyCoord3DChanged(t))}},addStandardCoordSupport:function(e,t){ClassEx.extend(e,Kekule.ClassDefineUtils.CommonCoordMethods),(!t||t.indexOf("coord2D")>=0)&&(ClassEx.defineProp(e,"coord2D",{dataType:DataType.HASH,getter:function(e,t){if(this.getEnableIndirectCoord()){var r=this.calcIndirectCoordValue(Kekule.CoordMode.COORD2D,e);if(r)return r}var i=this.getPropStoreFieldValue("coord2D");return!i&&e&&this.hasCoord3D()&&(i=this.getCoord3D()),!i&&t&&(i={x:0,y:0},this.setPropStoreFieldValue("coord2D",i)),i?{x:i.x,y:i.y}:void 0},setter:function(e){var t=this.fetchCoord2D();this.getEnableIndirectCoord()&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD2D,e,t),void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),this.notifyCoord2DChanged(t)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Coord2DMethods)),(!t||t.indexOf("coord3D")>=0)&&(ClassEx.defineProp(e,"coord3D",{dataType:DataType.HASH,getter:function(e,t){if(this.getEnableIndirectCoord()){var r=this.calcIndirectCoordValue(Kekule.CoordMode.COORD2D,e);if(r)return r}var i=this.getPropStoreFieldValue("coord3D");return!i&&e&&this.hasCoord2D()&&((i=this.getCoord2D()).z=0),!i&&t&&(i={x:0,y:0,z:0},this.setPropStoreFieldValue("coord3D",i)),i?{x:i.x,y:i.y,z:i.z}:void 0},setter:function(e){var t=this.fetchCoord3D();this.getEnableIndirectCoord()&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD3D,e,t),void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),void 0!==e.z&&(t.z=e.z),this.notifyCoord3DChanged(t)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Coord3DMethods)),(!t||t.indexOf("absCoord2D")>=0)&&ClassEx.defineProp(e,"absCoord2D",{dataType:DataType.HASH,serializable:!1,getter:function(e){var t=this.getCoord2D(e)||{},r=this.getCoordParent(Kekule.CoordMode.COORD2D);return r&&r.getAbsCoord2D?Kekule.CoordUtils.add(t,r.getAbsCoord2D(e)||{}):{x:t.x,y:t.y}},setter:function(e,t){var r=e,i=this.getCoordParent(Kekule.CoordMode.COORD2D);i&&i.getAbsCoord2D&&(r=Kekule.CoordUtils.substract(e,i.getAbsCoord2D(t))),this.setCoord2D(r)}}),(!t||t.indexOf("absCoord3D")>=0)&&ClassEx.defineProp(e,"absCoord3D",{dataType:DataType.HASH,serializable:!1,getter:function(e){var t=this.getCoord3D(e)||{},r=this.getCoordParent(Kekule.CoordMode.COORD3D);return r&&r.getAbsCoord3D?Kekule.CoordUtils.add(t,r.getAbsCoord3D(e)||{}):{x:t.x,y:t.y,z:t.z}},setter:function(e,t){var r=e,i=this.getCoordParent(Kekule.CoordMode.COORD2D);i&&i.getAbsCoord3D&&(r=Kekule.CoordUtils.substract(e,i.getAbsCoord3D(t))),this.setCoord3D(r)}}),(!t||t.indexOf("enableIndirectCoord")>=0)&&ClassEx.defineProp(e,"enableIndirectCoord",{scope:Class.PropertyScope.PUBLIC,dataType:DataType.BOOL,serializable:!0,setter:function(e){if(this.getPropStoreFieldValue("enableIndirectCoord")!=e){if(e){var t=this.getCoord2D(),r=this.getCoord3D();t&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD2D,t,t,!0),r&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD3D,r,r,!0)}this.setPropStoreFieldValue("enableIndirectCoord",e)}}}),(!t||t.indexOf("indirectCoordStorage")>=0)&&ClassEx.defineProp(e,"indirectCoordStorage",{dataType:DataType.HASH,serializable:function(){return!!this.getEnableIndirectCoord()},setter:null,getter:function(){var e=this.getPropStoreFieldValue("indirectCoordStorage");return e||((e={})[Kekule.CoordMode.COORD2D]={},e[Kekule.CoordMode.COORD3D]={},this.setPropStoreFieldValue("indirectCoordStorage",e)),e}})},ExtraObjMapMethods:{getExtraProp:function(e,t){var r=this.getExtraObjMap().get(e);return r?t?r[t]:r:void 0},setExtraProp:function(e,t,r){var i;(i=this.getExtraProp(e))?i[t]=r:((i={})[t]=r,this.getExtraObjMap().set(e,i))},removeExtraProp:function(e,t){if(t){var r=this.getExtraProp(e);r[t]=void 0,delete r[t]}else this.getExtraObjMap().remove(e)}},addExtraObjMapSupport:function(e){ClassEx.defineProp(e,"extraObjMap",{dataType:"Kekule.MapEx",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("extraObjMap");return e||(e=new Kekule.MapEx(!0,!0),this.setPropStoreFieldValue("extraObjMap",e)),e}}),ClassEx.extend(e,Kekule.ClassDefineUtils.ExtraObjMapMethods)},ExtraTwoTupleObjMapMethods:{getExtraProp2:function(e,t,r){var i=(this.__$__k__extraTwoTupleObjMap__$__||this.getExtraTwoTupleObjMap()).get(e,t);return i?r?i[r]:i:void 0},setExtraProp2:function(e,t,r,i){var n;(n=this.getExtraProp2(e,t))?n[r]=i:((n={})[r]=i,(this.__$__k__extraTwoTupleObjMap__$__||this.getExtraTwoTupleObjMap()).set(e,t,n))},removeExtraProp2:function(e,t,r){if(r){var i=this.getExtraProp2(e,t);i[r]=void 0,delete i[r]}else this.getExtraTwoTupleObjMap().remove(e,t)}},addExtraTwoTupleObjMapSupport:function(e){var t="extraTwoTupleObjMap";ClassEx.defineProp(e,t,{dataType:"Kekule.TwoTupleMapEx",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue(t);return e||(e=new Kekule.TwoTupleMapEx(!0,!0),this.setPropStoreFieldValue(t,e),this.__$__k__extraTwoTupleObjMap__$__=e),e}}),ClassEx.extend(e,Kekule.ClassDefineUtils.ExtraTwoTupleObjMapMethods)}},Kekule.ObjPropSettingManager={_items:new Kekule.MapEx(!0),register:function(e,t){Kekule.ObjPropSettingManager._items.set(e,t)},unregister:function(e){Kekule.ObjPropSettingManager._items.remove(e)},getSetting:function(e){return Kekule.ObjPropSettingManager._items.get(e)}},ClassEx.defineProp(ObjectEx,"predefinedSetting",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=Kekule.StrUtils.splitTokens(e||"",",");if(t.length){for(var r=0,i=t.length;r<i;++r){for(var n=this.getClass(),o=t[r],a=null,s="";n&&!a;){s=ClassEx.getClassName(n)+"."+o;a=Kekule.ObjPropSettingManager.getSetting(s),n=ClassEx.getSuperClass(n)}a||(a=Kekule.ObjPropSettingManager.getSetting(o)),a&&this.setPropValues(a)}this.setPropStoreFieldValue("predefinedSetting",s)}}}),Kekule.ObjectTreeOperation={MODIFY:0,ADD:1,REMOVE:2},Kekule.ChemObjInteractMode={DEFAULT:0,UNMOVABLE:1,UNSELECTABLE:2,HIDDEN:3},Kekule.ComparisonMethod={DEFAULT:0,PROPERTIES:1,CHEM_STRUCTURE:10},Kekule.ObjComparer={equal:function(e,t,r){return 0===Kekule.ObjComparer.compare(e,t,r)},compare:function(e,t,r){return Kekule.ObjComparer._compareValue(e,t,r)},_compareValue:function(e,t,r){var i=DataType;if(e===t)return 0;var n=i.getType(e),o=i.getType(t);if("number"===n&&Kekule.NumUtils.isFloatEqual(e,t))return 0;if(e<t&&!(e>t))return-1;if(e>t&&!(e<t))return 1;var a=null;if(n!==o){var s=[i.UNKNOWN,i.VARIANT,i.UNDEFINED,i.BOOL,i.NUMBER,i.INT,i.FLOAT,i.STRING,i.ARRAY,i.FUNCTION,i.DATE,i.OBJECT,i.OBJECTEX,i.CLASS],l=s.indexOf(n),u=s.indexOf(o);a=l<0&&u<0?null:l-u}else if(!e&&t)a=-1;else if(e&&!t)a=1;else if(e.doCompare)a=e.doCompare(t,r);else if(t.doCompare)a=-t.doCompare(e,r);else if(n===DataType.ARRAY){if(!(a=e.length-t.length))for(var d=0,c=e.length;d<c&&!(a=Kekule.ObjComparer._compareValue(e[d],t[d],r));++d);}else a=n===DataType.OBJECT?Kekule.ObjComparer._compareHash(e,t,r):null;if(null===a){var h=e.toString&&e.toString()||"",p=t.toString&&t.toString()||"";null===(a=h<p?-1:h>p?1:null)&&(a=-1)}return a},_compareHash:function(e,t,r){var i=Kekule.ObjUtils.getOwnedFieldNames(e)||[],n=Kekule.ObjUtils.getOwnedFieldNames(t)||[],o=i.length-n.length;if(!(o||(i.sort(),n.sort(),o=Kekule.ArrayUtils.compare(i,n))))for(var a=0,s=i.length;a<s;++a){var l=i[a],u=e[l],d=t[l];if(o=Kekule.ObjComparer.compare(u,d,r)){console.log(l,o,u,d);break}}return o}};Kekule.ChemObject=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemObject",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setId(e),this.setBubbleEvent(!0),this.__load_owner_objRef_props__=null,this.__load_parent_objRef_props__=null,this.__load_parentRoot_objRef_props__=null,this.addEventListener("change",function(e){var t=this.getPropStoreFieldValue("srcInfo");if(t&&t.data){for(var r=e.target,i=e.changedPropNames,n=!1,o=0,a=i.length;o<a;++o){var s=i[o];if(s&&"srcInfo"!==s&&r.isPropertySerializable(s)){n=!0;break}if("[children]"===s){n=!0;break}}n&&(t.data=null)}},this)},doFinalize:function(){this.__load_owner_objRef_props__=null,this.__load_parent_objRef_props__=null,this.__load_parentRoot_objRef_props__=null,this.setPropStoreFieldValue("attachedCoordStickNodes",null),this.removeSelf(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("id",{dataType:DataType.STRING}),this.defineProp("interactMode",{dataType:DataType.INT,enumSource:Kekule.ChemObjInteractMode}),this.defineProp("info",{dataType:DataType.HASH,getter:function(e){var t=this.getPropStoreFieldValue("info");return!t&&e&&(t={},this.setPropStoreFieldValue("info",t)),t}}),this.defineProp("scalarAttribs",{dataType:DataType.ARRAY,setter:null}),this.defineProp("parent",{dataType:"Kekule.ChemObject",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getParent();t!==e&&(t&&t._removeChildObj&&(t._removeChildObj(this),this.invokeEvent("removeFromObjTree",{obj:this,parent:t})),this.setPropStoreFieldValue("parent",e),e&&e._appendChildObj&&(e._appendChildObj(this),this.invokeEvent("addToObjTree",{obj:this,parent:e})),this.parentChanged(e,t))}}),this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getOwner();t!==e&&(t&&(t._removeOwnedObj(this),this.invokeEvent("removeFromSpace",{obj:this,owner:t})),this.setPropStoreFieldValue("owner",e),e&&(e._appendOwnedObj(this),this.invokeEvent("addToSpace",{obj:this,owner:t})),this.ownerChanged(e,t))}}),this.defineProp("srcInfo",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("srcInfo");return e||(e={},this.setPropStoreFieldValue("srcInfo",e)),e}}),this.defineProp("isEditing",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getOwner();return e&&e.getIsEditing?e.getIsEditing():this.getPropStoreFieldValue("isEditing")}}),this.defineProp("attachedCoordStickNodes",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("attachedCoordStickNodes");return e||(e=[],this.setPropStoreFieldValue("attachedCoordStickNodes",e)),e}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableObjectChangeEvent(!0)},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},getAutoIdPrefix:function(){return"o"},_parentObjectLoaded:function(e){},_ownerObjectLoaded:function(e){},_handleObjRefProps:function(e,t){var r=t;if(r)for(var i=Kekule.ObjUtils.getOwnedFieldNames(r),n=0,o=i.length;n<o;++n){var a=i[n],s=this.getPropInfo(a),l=this._doGetPropObjRefObjInfo(this,s,e).rootObj,u=r[a];if(DataType.isArrayValue(u)){var d=[];for(n=0,o=u.length;n<o;++n){if(p=this._doUnwrapObjRefSerializationStr(this,u[n])){var c=l.getChildAtIndexStack(p);d.push(c)}else d.push(void 0)}this.setPropValue(a,d)}else{var h,p;(p=this._doUnwrapObjRefSerializationStr(this,u))&&(h=l.getChildAtIndexStack(p)),h&&this.setPropValue(a,h)}try{delete r[a]}catch(e){}}},doSaveProp:function(e,t,r,i,n,o,a,s){if(t.serializable&&(e._doGetObjRefSerializationValue&&!!t.objRef)){var l=e._doGetPropObjRefObjInfo(e,t,o);if(l){var u=l.rootObj;if(u){var d=e.getPropValue(t.name);if(d){if(Kekule.ArrayUtils.isArray(d)){for(var c=[],h=0,p=d.length;h<p;++h){var g=e._doGetObjRefSerializationValue(u,e,d[h],l.objRefRoot);g?c.push(g):c.push(d[h])}return n.doSaveFieldValue(e,t.name,c,r,n.getValueExplicitType(c),i,u,a,s),!0}var f=e._doGetObjRefSerializationValue(u,e,d,l.objRefRoot);if(f)return n.doSaveFieldValue(e,t.name,f,r,n.getValueExplicitType(f),i,u,a,s),!0}}}}},_doGetObjRefSerializationValue:function(e,t,r,i){var n=e.indexStackOfChild&&e.indexStackOfChild(r);if(n&&n.length){return"@"+JSON.stringify(n)}return null},doLoadProp:function(e,t,r,i,n,o,a){if(t.serializable&&!!t.objRef){var s=i.doLoadFieldValue(e,t.name,r,null,n,o,a);if(s){var l=(e._doGetPropObjRefObjInfo&&e._doGetPropObjRefObjInfo(e,t,o)).storageObjName,u=e[l];return u||(u={},e[l]=u),u[t.name]=s,!0}}},_doUnwrapObjRefSerializationStr:function(e,t){try{var r=t.startsWith("@")?t.substr("@".length):t,i=JSON.parse(r);return DataType.isArrayValue(i)?i:null}catch(e){Kekule.error(e)}},_doGetPropObjRefObjInfo:function(e,t,r){var i=t.objRefRoot,n="owner"===i,o="storageRoot"===i,a="parent"===i?e.getParent&&e.getParent():n?e.getOwner&&e.getOwner():o?r:null;if(!a){var s=e.getOwner&&e.getOwner();s?(i="owner",n=!0,a=s):(i="storageRoot",o=!0,a=r)}return{objRefRoot:i,rootObj:a,storageObjName:"__load_objRef_props__"}},loaded:function(e){this.tryApplySuper("loaded",[e]),this.notifyParentLoaded()},allLoaded:function(e){this.tryApplySuper("allLoaded",[e]),this._handleObjRefProps(e,this.__load_objRef_props__)},notifyParentLoaded:function(){for(var e=0,t=this.getChildCount();e<t;++e){var r=this.getChildAt(e);r&&r._parentObjectLoaded&&r._parentObjectLoaded(this)}},isObjRefProperty:function(e){return!(!e||!e.objRef)},notifyPropSet:function(e,t,r){this.tryApplySuper("notifyPropSet",[e,t,r]);var i=this.getPropInfo(e);if(i&&this.isObjRefProperty(i)){var n=this.getOwner();n&&n.modifyObjRefRelation&&n.modifyObjRefRelation(this,i,this.getPropValue(i.name))}},getObjRefProperties:function(){for(var e=[],t=this.getAllPropList(),r=0,i=t.getLength();r<i;++r){var n=t.getPropInfoAt(r);this.isObjRefProperty(n)&&e.push(n)}return e},_registerObjRefRelations:function(e){if(e&&e.modifyObjRefRelation){var t=this.getObjRefProperties();if(t.length)for(var r=0,i=t.length;r<i;++r){var n=t[r],o=this.getPropValue(n.name);e.modifyObjRefRelation(this,n,o)}}},_unregisterObjRefRelations:function(e){if(e&&e.releaseObjRefRelation){var t=this.getObjRefProperties();if(t.length)for(var r=0,i=t.length;r<i;++r){var n=t[r];e.releaseObjRefRelation(this,n)}}},isSelectable:function(){var e=Kekule.ChemObjInteractMode;return!((this.getInteractMode()||e.DEFAULT)&e.UNSELECTABLE)},isMovable:function(){var e=Kekule.ChemObjInteractMode;return!((this.getInteractMode()||e.DEFAULT)&e.UNMOVABLE)},getNearestSelectableObject:function(){return this.isSelectable()?this:this.getParent()?this.getParent().getNearestSelectableObject():null},getNearestMovableObject:function(){return this.isMovable()?this:this.getParent()?this.getParent().getNearestMovableObject():null},getNearestAncestorOfType:function(e){var t=this.getParent();return t?t instanceof e?t:t.getNearestAncestorOfType?t.getNearestAncestorOfType(e):null:null},removeSelf:function(){this.setParent(null),this.setOwner(null)},notifyScalarAttribsChange:function(){this.notifyPropSet("scalarAttribs",this.getPropStoreFieldValue("scalarAttribs"))},notifyInfoChange:function(){this.notifyPropSet("info",this.getPropStoreFieldValue("info"))},_removeChildObj:function(e){this._notifyOwnerObjTreeOperation(e,this,Kekule.ObjectTreeOperation.REMOVE)},_appendChildObj:function(e){this._notifyOwnerObjTreeOperation(e,this,Kekule.ObjectTreeOperation.ADD)},_notifyOwnerObjTreeOperation:function(e,t,r){var i=this.getOwner();i&&i._notifyObjTreeOperation&&i._notifyObjTreeOperation(e,t,r)},objTreeOfOwnerUpdated:function(e,t,r){},objSpaceOfOwnerUpdated:function(e,t,r){},ownerChanged:function(e,t){for(var r=0,i=this.getScalarAttribCount();r<i;++r)this.getScalarAttribAt(r).setOwner(e);for(r=0,i=this.getChildCount();r<i;++r){var n=this.getChildAt(r);n&&n.setOwner&&n.setOwner(e)}},parentChanged:function(e,t){},getParentList:function(){var e=[],t=this.getParent();return t&&(t.getParentList&&(e=t.getParentList()||[]),e.unshift(t)),e},getParentRoot:function(){var e=this.getParent();return e&&e.getParentRoot&&(e=e.getParentRoot()||e),e},isChildOf:function(e){for(var t=this.getParent();t&&t!==e;)t=t.getParent?t.getParent():null;return!!t},getNextSibling:function(){var e=this.getParent();return e&&e.getNextSiblingOfChild?e.getNextSiblingOfChild(this):null},isSiblingWith:function(e){var t=this.getParent(),r=e.getParent&&e.getParent();return t&&r&&t===r},getChildHolder:function(){return this},getChildSubgroupNames:function(){return[]},getBelongChildSubGroupName:function(e){return null},_getPrevSubgroupChildrenCount:function(e){for(var t=this.getChildSubgroupNames(),r=0,i=0,n=t.length;i<n;++i){if(t[i]===e)return r;var o=this._getSubGroupChildCountMethod(t[i]);r+=o&&o.apply(this)||0}return r},_getSubgroupChildIndexInfoFromChildIndex:function(e){for(var t=this.getChildSubgroupNames(),r=0,i=0,n=t.length;i<n;++i){var o=this._getSubGroupChildCountMethod(t[i]),a=o&&o.apply(this)||0;if(e<r+a)return{name:t[i],index:e-r};r+=a}return null},_getSubGroupChildCountMethod:function(e){return this["get"+e.upperFirst()+"Count"]},_getSubGroupChildAtMethod:function(e){return this["get"+e.upperFirst()+"At"]},_getSubGroupChildIndexOfMethod:function(e){return this["indexOf"+e.upperFirst()]},_getSubGroupChildRemoveMethod:function(e){return this["remove"+e.upperFirst()]},_getSubGroupChildRemoveAtMethod:function(e){return this["remove"+e.upperFirst()+"At"]},_getSubGroupChildAppendMethod:function(e){return this["append"+e.upperFirst()]},_getSubGroupChildInsertBeforeMethod:function(e){return this["insert"+e.upperFirst()+"Before"]},_getSubGroupChildInsertAtMethod:function(e){return this["insert"+e.upperFirst()+"At"]},_ensureSubGroupChildMethodsExist:function(){for(var e=["_getSubGroupChildCountMethod","_getSubGroupChildAtMethod","_getSubGroupChildIndexOfMethod","_getSubGroupChildRemoveMethod","_getSubGroupChildRemoveAtMethod","_getSubGroupChildInsertBeforeMethod","_getSubGroupChildInsertAtMethod"],t=this.getChildSubgroupNames(),r=0,i=t.length;r<i;++r)for(var n=0,o=e.length;n<o;++n){this[e[n]].apply(this,[t[r]])||Kekule.warn("Subgroup child method not exisits: "+e[n]+" / "+this.getClassName())}},getChildCount:function(){var e=this.getChildHolder();return e&&e!==this?e.getChildCount():this.doGetChildCount()},doGetChildCount:function(){for(var e=0,t=this.getChildSubgroupNames(),r=0,i=t.length;r<i;++r){var n=this._getSubGroupChildCountMethod(t[r]);n&&(e+=n.apply(this))}return e},getChildAt:function(e){var t=this.getChildHolder();return t&&t!==this?t.getChildAt(e):this.doGetChildAt(e)},doGetChildAt:function(e){var t=this._getSubgroupChildIndexInfoFromChildIndex(e);if(t){var r=this._getSubGroupChildAtMethod(t.name);return r&&r.apply(this,[t.index])}return null},indexOfChild:function(e){var t=this.getChildHolder();return t&&t!==this?t.indexOfChild(e):this.doIndexOfChild(e)},doIndexOfChild:function(e){for(var t=this.getChildSubgroupNames(),r=0,i=t.length;r<i;++r){var n=this._getSubGroupChildIndexOfMethod(t[r]);if(n){var o=n.apply(this,[e]);if(o>=0)return this._getPrevSubgroupChildrenCount(t[r])+o}}return-1},hasChild:function(e){return this.indexOfChild(e)>=0},filterChildren:function(e,t){for(var r=[],i=0,n=this.getChildCount();i<n;++i){var o=this.getChildAt(i);if(o)if(e(o,i))r.push(o);else if(t&&o.filterChildren){var a=o.filterChildren(e,t);a&&a.length&&(r=r.concat(a))}}return r},iterateChildren:function(e,t){for(var r=0,i=this.getChildCount();r<i;++r){var n=this.getChildAt(r);n&&(e(n,r),t&&n.iterateChildren&&n.iterateChildren(e,t))}},removeChildAt:function(e){return this.doRemoveChildAt(e)},doRemoveChildAt:function(e){var t=this._getSubgroupChildIndexInfoFromChildIndex(e);if(t){var r=this._getSubGroupChildRemoveAtMethod(t.name);return r&&r.apply(this,[t.index])}return null},removeChild:function(e){var t=this.getChildHolder();return t&&t!==this?t.removeChild(e):this.doRemoveChild(e)},doRemoveChild:function(e){for(var t,r=this.getChildSubgroupNames(),i=0,n=r.length;i<n;++i){var o=this._getSubGroupChildRemoveMethod(r[i]);if(o&&(t=o.apply(this,[e])))return t}return null},removeChildren:function(e){for(var t=e.length-1;t>=0;--t)this.removeChild(e[t])},insertChildAt:function(e,t){var r=this.getChildHolder();return r&&r!==this?r.insertChildAt(e,t):this.doInsertChildAt(e,t)},doInsertChildAt:function(e,t){if(t>=this.getChildCount())return this.appendChild(e);var r=this._getSubgroupChildIndexInfoFromChildIndex(t);if(r){var i=this._getSubGroupChildInsertAtMethod(r.name);if(i){var n=i.apply(this,[e,r.index]);if(n>=0)return this._getPrevSubgroupChildrenCount(r.name)+n}}return-1},insertBefore:function(e,t){return this.insertChildBefore(e,t)},insertChildBefore:function(e,t){var r=this.getChildHolder();return r&&r!==this?r.insertChildBefore(e,t):this.doInsertChildBefore(e,t)},doInsertChildBefore:function(e,t){var r=this.getBelongChildSubGroupName(e);if(!r)return-1;if(t&&r!==this.getBelongChildSubGroupName(t))return-1;this.getChildSubgroupNames();var i=this._getSubGroupChildInsertBeforeMethod(r);return i?this._getPrevSubgroupChildrenCount(r)+i.apply(this,[e,t]):-1},appendChild:function(e){return this.insertChildBefore(e,null)},appendChildren:function(e){for(var t=0,r=e.length;t<r;++t)this.appendChild(e[t])},cascadeOnChildren:function(e){if(!e)return this;for(var t=0,r=this.getChildCount();t<r;++t){var i=this.getChildAt(t);i.cascadeOnChildren&&i.cascadeOnChildren(e),e(i)}return this},cascade:function(e){return e?(this.cascadeOnChildren(e),e(this),this):this},indexStackOfChild:function(e){var t=e.getParentList&&e.getParentList(),r=-1;if(t&&t.length&&(r=t.indexOf(this)),r<0)return null;for(var i,n=[],o=this,a=r-1;a>=0;--a){var s=t[a];if(!((i=o.indexOfChild(s))>=0))return null;n.push(i),o=s}return(i=o.indexOfChild(e))>=0?(n.push(i),n):null},getChildAtIndexStack:function(e){if(!e)return null;if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getChildAt(e[0]),r=1,i=e.length;r<i;++r){if(!t||!t.getChildAt)return null;t=t.getChildAt(e[r])}return t},isEmpty:function(){return!1},clearIds:function(){this.setId(void 0);for(var e=0,t=this.getChildCount();e<t;++e){var r=this.getChildAt(e);r.clearIds&&r.clearIds()}},assignTo:function(e,t){var r=this.tryApplySuper("assignTo",[e]);return!t&&e.clearIds&&e.clearIds(),r},assign:function(e,t){return e.assignTo(this,t)},clone:function(e){var t=new(this.getClass());return this.assignTo(t,e),t},getScalarAttribCount:function(){var e=this.getScalarAttribs();return e?e.length:0},getScalarAttribAt:function(e){var t=this.getScalarAttribs();return t?t[e]:null},appendScalarAttrib:function(e){this.getScalarAttribs()||this.setPropStoreFieldValue("scalarAttribs",[]);var t=Kekule.ArrayUtils.pushUniqueEx(this.getScalarAttribs(),e);return t.isPushed&&(e.setParent(this),this.notifyScalarAttribsChange()),t.index},removeScalarAttribAt:function(e){if(this.getScalarAttribs()){var t=Kekule.ArrayUtils.removeAt(this.getScalarAttribs(),e);return t&&(t.setParent(null),this.notifyScalarAttribsChange()),t}return null},removeScalarAttrib:function(e){if(this.getScalarAttribs()){var t=Kekule.ArrayUtils.remove(this.getScalarAttribs(),e);return t&&(t.setParent(null),this.notifyScalarAttribsChange()),t}return null},getInfoKeys:function(){return this.getInfo()?Kekule.ObjUtils.getOwnedFieldNames(this.getInfo()):[]},getInfoValue:function(e){return this.getInfo()?this.getInfo()[e]:null},setInfoValue:function(e,t){this.doGetInfo(!0)[e]=t,this.notifyInfoChange()},getContainerBox:function(e,t){if(this.getAbsCoordOfMode){var r=this.getAbsCoordOfMode(e,t)||{},i=r;if(this.getSizeOfMode){var n=this.getSizeOfMode(e,t)||{};if(this.getObjAnchorPosition(e)===Kekule.ObjAnchorPosition.CENTER){var o=Kekule.CoordUtils.divide(n,2);e!==Kekule.CoordMode.COORD3D&&(o.y=-o.y),r=Kekule.CoordUtils.substract(r,o)}i=e===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.add(r,this.getSizeOfMode(e,t)||{}):{x:(r.x||0)+(n.x||0),y:(r.y||0)-(n.y||0)}}return Kekule.BoxUtils.createBox(r,i)}return null},equal:function(e,t){return 0===this.compare(e,t)},compare:function(e,t){if(e===this)return 0;if(!e)return 1;var r,i=this.doGetActualCompareOptions(t);return 0===(r=i.customMethod?i.customMethod(this,e,i):this.doCompare(e,i))?0:r<0?-1:1},doGetActualCompareOptions:function(e){return e||{}},doCompare:function(e,t){if(e===this)return 0;if(this.getClass()!==(e.getClass&&e.getClass()))return this.getClassName()<(e.getClassName&&e.getClassName()||"")?-1:1;var r=this.doCompareOnProperties(e,t);if(!r&&t.extraComparisonProperties)for(var i=0,n=t.extraComparisonProperties.length;i<n;++i){var o=t.extraComparisonProperties[i];if(this.hasProperty(o)&&e.hasProperty&&e.hasProperty(o)){var a=this.getPropValue(o),s=e.getPropValue(o);if(0!==(r=this.doCompareOnValue(a,s,t)))break}}return r},doCompareOnProperties:function(e,t){var r;r=t.properties?t.properties:this.getComparisonPropNames(t);for(var i=t&&t.ignoredProperties,n=0,o=0,a=r.length;o<a;++o){var s=r[o];if(!(i&&i.indexOf(s)>=0)&&0!==(n=this.doCompareProperty(e,r[o],t)))return n}return 0},getComparisonPropNames:function(e){var t=this.doGetComparisonPropNames(e);return t||(t=this.doGetDefaultComparisonPropNames()),t},doGetComparisonPropNames:function(e){return null},doGetDefaultComparisonPropNames:function(){for(var e=[],t=this.getPropListOfScopes([Class.PropertyScope.PUBLIC,Class.PropertyScope.PUBLISHED]),r=0,i=t.getLength();r<i;++r){var n=t.getPropInfoAt(r);e.push(n.name)}return e},doCompareProperty:function(e,t,r){var i=e.getPropValue&&e.getPropValue(t),n=this.getPropValue(t);return n===i?0:this.doCompareOnValue(n,i,r)},doCompareOnValue:function(e,t,r){return Kekule.ObjComparer._compareValue(e,t,r)},attachCoordStickNodes:function(e){var t=Kekule.ArrayUtils,r=t.toArray(e),i=this.getAttachedCoordStickNodes();return t.pushUnique(i,r),this},detachCoordStickNodes:function(e){for(var t=Kekule.ArrayUtils,r=t.toArray(e),i=this.getAttachedCoordStickNodes(),n=0,o=r.length;n<o;++n)t.remove(i,r[n]);return this}}),Kekule.VarDependency={INDEPENDENT:0,DEPENDENT:1},Kekule.VarDefinition=Class.create(ObjectEx,{CLASS_NAME:"Kekule.VarDefinition",initialize:function(e){this.tryApplySuper("initialize"),this.beginUpdate();try{e&&this.setPropValues(e),Kekule.ObjUtils.isUnset(this.getDependency())&&this.setDependency(Kekule.VarDependency.INDEPENDENT)}finally{this.endUpdate()}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("symbol",{dataType:DataType.STRING}),this.defineProp("unit",{dataType:DataType.STRING}),this.defineProp("units",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getUnit()},setter:function(e){this.setUnit(e)}}),this.defineProp("dependency",{dataType:DataType.INT,enumSource:Kekule.VarDependency}),this.defineProp("displayLabel",{dataType:DataType.VARIANT}),this.defineProp("description",{dataType:DataType.STRING}),this.defineProp("info",{dataType:DataType.HASH,getter:function(e){var t=this.getPropStoreFieldValue("info");return!t&&e&&(t={},this.setPropStoreFieldValue("info",t)),t}})},isIndependent:function(){return this.getDependency()!==Kekule.VarDependency.DEPENDENT},getInfoKeys:function(){return this.getInfo()?Kekule.ObjUtils.getOwnedFieldNames(this.getInfo()):[]},getInfoValue:function(e){return this.getInfo()?this.getInfo()[e]:null},setInfoValue:function(e,t){this.doGetInfo(!0)[e]=t,this.notifyInfoChange()},notifyInfoChange:function(){this.notifyPropSet("info",this.getPropStoreFieldValue("info"))},doCompare:function(e,t){for(var r,i=0,n=0,o=(r=t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE?["unit","dependency","info"]:["name","symbol","unit","dependency","info","displayLabel","description"]).length;n<o;++n){var a=r[n],s=this.getPropValue(a),l=e.getPropValue(a);if(!(i=Kekule.ObjComparer._compareValue(s,l,t)))break}return i}}),Kekule.Scalar=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Scalar",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e]),t&&this.setName(t),void 0!==r&&this.setValue(r),i&&this.setUnit(i)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("value",{dataType:DataType.PRIMARY}),this.defineProp("errorValue",{dataType:DataType.PRIMARY}),this.defineProp("unit",{dataType:DataType.STRING}),this.defineProp("title",{dataType:DataType.STRING})},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE?(t||[]).concat(["name","value","errorValue","unit","title"]):t}}),Kekule.Scalar.create=function(e,t,r){var i=new Kekule.Scalar(null,null,e,t);return void 0!==r&&i.setErrorValue(r),i},Kekule.ChemObjList=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemObjList",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("itemBaseClass",t),this.setPropStoreFieldValue("items",[]),this._transparent=!!r},initProperties:function(){this.defineProp("itemBaseClass",{dataType:DataType.CLASS,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("items",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("items");return!t&&e&&(t=[],this.setPropStoreFieldValue("items",t)),t}})},loaded:function(e){this.ownerChanged(this.getOwner()),this.parentChanged(this.getParent()),this.tryApplySuper("loaded",[e])},parentChanged:function(e,t){this.changeAllItemsParent(),this.tryApplySuper("parentChanged",[e,t])},isEmpty:function(){return this.getItemCount()<=0},isValidItemType:function(e){var t=this.getItemBaseClass();return!t||e instanceof t},checkItemType:function(e){var t=this.isValidItemType(e);return t||Kekule.raise(Kekule.$L("ErrorMsg.LIST_ITEM_CLASS_MISMATCH")),t},notifyItemsChange:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},getItemOwner:function(){return this.getOwner()},changeAllItemsOwner:function(){var e=this.getItems();if(e)for(var t=this.getItemOwner(),r=0,i=e.length;r<i;++r){var n=e[r];n&&n.setOwner&&n.setOwner(t)}},getItemParent:function(){return this._transparent&&this.getParent()||this},changeAllItemsParent:function(){var e=this.getItems();if(e)for(var t=this.getItemParent(),r=0,i=e.length;r<i;++r){var n=e[r];n&&n.setParent&&n.setParent(t)}},getItemCount:function(){var e=this.getPropStoreFieldValue("items");return e?e.length:0},getItemAt:function(e){var t=this.getPropStoreFieldValue("items");return t?t[e]:null},indexOf:function(e){var t=this.getPropStoreFieldValue("items");return t?t.indexOf(e):-1},indexOfItem:function(e){return this.indexOf(e)},getNextSiblingOfChild:function(e){var t=this.indexOf(e);return t>=0?this.getItemAt(t+1):null},getChildSubgroupNames:function(){return["item"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return this.isValidItemType(e)?"item":this.tryApplySuper("getBelongChildSubGroupName",[e])},append:function(e){if(this.checkItemType(e),e){var t=Kekule.ArrayUtils.pushUniqueEx(this.doGetItems(!0),e);return t.isPushed&&(this.notifyItemsChange(),e.setOwner&&e.setOwner(this.getItemOwner()),e.setParent&&e.setParent(this.getItemParent())),t.index}return-1},insert:function(e,t){if(this.checkItemType(e),e){var r=Kekule.ArrayUtils.insertUniqueEx(this.doGetItems(!0),e,t);return r.isInserted&&(this.notifyItemsChange(),e.setOwner&&e.setOwner(this.getItemOwner()),e.setParent&&e.setParent(this.getItemParent())),r.index}return-1},insertItemAt:function(e,t){return this.insert(e,t)},insertItemBefore:function(e,t){if(t){var r=this.indexOfItem(t);return r>=0?this.insertItemAt(e,r):this.appendItem(e)}return this.append(e)},removeAt:function(e){if(this.getItems()){var t=Kekule.ArrayUtils.removeAt(this.getItems(),e);return t&&(t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyItemsChange()),t}},removeItemAt:function(e){return this.removeAt(e)},remove:function(e){if(this.getItems()){var t=Kekule.ArrayUtils.remove(this.getItems(),e);return t&&(t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyItemsChange()),t}},removeItem:function(e){return this.remove(e)},toArray:function(){return this.getItems()||[]},getContainerBox:function(e,t){for(var r,i=this.toArray(),n=0,o=i.length;n<o;++n){var a=i[n],s=a.getContainerBox?a.getContainerBox(e,t):null;s&&(r=r?Kekule.BoxUtils.getContainerBox(r,s):Kekule.BoxUtils.clone(s))}return r},getComparisonPropNames:function(e){var t=this.tryApplySuper("getComparisonPropNames",[e]);return t&&this._transparent&&(t=Kekule.ArrayUtils.exclude(t,["parent","owner"])),t}}),Kekule.ChemSpaceElement=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpaceElement",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=new Kekule.ChemObjList(null,Kekule.ChemObject,!0);t.setParent(this),t.addEventListener("change",function(){this.objectChange(["children"])},this),this.setPropStoreFieldValue("children",t)},initProperties:function(){this.defineProp("children",{dataType:"Kekule.ChemObjList",scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getChildren();t&&t.finalize(),e&&(e.setParent(this),e.setOwner(this.getOwner()),e._transparent=!0),this.setPropStoreFieldValue("children",e)}})},loaded:function(e){var t=this.getChildren();t&&(t.parentChanged(this),t.ownerChanged(this.getOwner())),this.tryApplySuper("loaded",[e])},ownerChanged:function(e,t){this.getChildren().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){var t=this.indexOfChild(e);t>=0&&this.removeChildAt(t),this.tryApplySuper("_removeChildObj",[e])},getChildHolder:function(){return this.getChildren()},getNextSiblingOfChild:function(e){return this.getChildren().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.getChildren().insert(e,t)}}),Kekule.ChemSpace=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpace",initialize:function(e){this.tryApplySuper("initialize",[e]),this._autoIdMap={},this._enableObjRefRelations=!0,this._autoUpdateObjRefRelations=!0,this.setPropStoreFieldValue("enableAutoId",!0),this.setPropStoreFieldValue("ownedObjs",[]);var t=new Kekule.ChemSpaceElement;this.setPropStoreFieldValue("root",t),this.setPropStoreFieldValue("objRefRelationManager",new Kekule.ObjRefRelationManager(this)),t.setParent(this),t.setOwner(this)},initProperties:function(){this.defineProp("ownedObjs",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("root",{dataType:"Kekule.ChemSpaceElement",setter:null}),this.defineProp("enableAutoId",{dataType:DataType.BOOL}),this.defineProp("objScreenLengthRatio",{dataType:DataType.FLOAT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("screenSize",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("screenSize")||{};return{x:e.x,y:e.y}},setter:function(e){var t=this.getPropStoreFieldValue("screenSize");t||(t={},this.setPropStoreFieldValue("screenSize",t)),t.x=e.x,t.y=e.y}}),this.defineProp("objRefRelationManager",{dataType:"Kekule.ObjRefRelationManager",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null})},loaded:function(e){var t=this.getRoot();t&&(t.setParent(this),t.setOwner(this)),this.tryApplySuper("loaded",[e]),this.notifyOwnerLoaded()},notifyOwnedObjsChange:function(){this.notifyPropSet("ownedObjs",this.getPropStoreFieldValue("ownedObjs"))},_notifyOwnedObjsSpaceUpdate:function(e,t,r){for(var i=0,n=this.getOwnedObjCount();i<n;++i){var o=this.getOwnedObjAt(i);o&&o.objSpaceOfOwnerUpdated&&o.objSpaceOfOwnerUpdated(e,t,r)}if(this._enableObjRefRelations&&this._autoUpdateObjRefRelations&&r===Kekule.ObjectTreeOperation.REMOVE){var a=Kekule.ArrayUtils,s=this.findObjRefRelations({dest:e})||[];for(i=0,n=s.length;i<n;++i){var l=s[i];if(l.srcProp.autoUpdate){var u=l.dest,d=a.isArray(u)?a.exclude(u,[e]):null;l.srcObj.setPropValue(l.srcProp.name,d)}}}},notifyOwnerLoaded:function(){for(var e=this.getOwnedObjs()||[],t=0,r=e.length;t<r;++t){var i=e[t];i&&i._ownerObjectLoaded&&i._ownerObjectLoaded(this)}},getChildren:function(){return this.getRoot().getChildren().toArray()},getChildHolder:function(){return this.getRoot()},getNextSiblingOfChild:function(e){return this.getRoot().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.getRoot().insertChild(e,t)},indexStackOfChild:function(e){return this.getRoot().indexStackOfChild(e)},getChildAtIndexStack:function(e){return this.getRoot().getChildAtIndexStack(e)},getObjById:function(e){for(var t=0,r=this.getOwnedObjCount();t<r;++t){var i=this.getOwnedObjAt(t);if(i.getId&&i.getId()===e)return i}return null},getAutoId:function(e,t){r=e&&e.getAutoIdPrefix?e.getAutoIdPrefix():"o";var r=e.getAutoIdPrefix?e.getAutoIdPrefix():"o";i=Kekule.ObjUtils.notUnset(t)?t:1;var i=this._getAutoIdIndex(r,i);return this._autoIdMap[r]=i,r+Number(i).toString()},_getAutoIdIndex:function(e,t){for(var r=t||0,i=e+Number(r).toString();this.getObjById(i);)++r,i=e+Number(r).toString();return r},assignAutoIdToObj:function(e){if(e.setId){var t=this.getAutoId(e);e.setId(t)}},getOwnedObjCount:function(){return this.getOwnedObjs().length},getOwnedObjAt:function(e){return this.getOwnedObjs()[e]},indexOfOwnedObj:function(e){return this.getOwnedObjs().indexOf(e)},_appendOwnedObj:function(e){this.indexOfOwnedObj(e)>=0||(this.getEnableAutoId()&&e.getId&&!e.getId()&&this.assignAutoIdToObj(e),this.getOwnedObjs().push(e),e._registerObjRefRelations&&e._registerObjRefRelations(this),this._notifyOwnedObjsSpaceUpdate(e,this,Kekule.ObjectTreeOperation.ADD),this.notifyOwnedObjsChange())},_removeOwnedObjAt:function(e){var t=this.getOwnedObjAt(e);t&&(this.getOwnedObjs().splice(e,1),t._unregisterObjRefRelations&&t._unregisterObjRefRelations(this),this._notifyOwnedObjsSpaceUpdate(t,this,Kekule.ObjectTreeOperation.REMOVE),this.notifyOwnedObjsChange())},_removeOwnedObj:function(e){var t=this.getOwnedObjs().indexOf(e);t>=0&&this._removeOwnedObjAt(t)},_notifyObjTreeOperation:function(e,t,r){for(var i=0,n=this.getOwnedObjCount();i<n;++i){var o=this.getOwnedObjAt(i);o.objTreeOfOwnerUpdated&&o.objTreeOfOwnerUpdated(e,t,r)}},getObjRefRelations:function(){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelations():null},createObjRefRelation:function(e,t,r){return this._enableObjRefRelations?this.getObjRefRelationManager().createRelation(e,t,r):null},modifyObjRefRelation:function(e,t,r){return this._enableObjRefRelations?this.getObjRefRelationManager().modifyRelation(e,t,r):null},getObjRefRelationIndex:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelationIndex(e,t):-1},getObjRefRelation:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelation(e,t):null},releaseObjRefRelation:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().releaseRelation(e,t):null},findObjRefRelations:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().findRelations(e,t):[]}}),Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.ChemSpace),Kekule.IntermediateChemSpace=Class.create(Kekule.ChemSpace,{CLASS_NAME:"Kekule.IntermediateChemSpace",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("enableAutoId",!1),this._enableObjRefRelations=!1,this._autoUpdateObjRefRelations=!1}}),Kekule.ChemDocument=Class.create(Kekule.ChemSpace,{CLASS_NAME:"Kekule.ChemDocument",initProperties:function(){},getAutoIdPrefix:function(){return"d"}}),Kekule.ObjRefRelationManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ObjRefRelationManager",initialize:function(e){this.tryApplySuper("initialize"),this.setOwner(e),this.setPropStoreFieldValue("relations",[])},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("relations",{dataType:DataType.ARRAY,serializable:!1,setter:null})},createRelation:function(e,t,r){var i={srcObj:e,srcProp:t,dest:r};return this.getRelations().push(i),i},modifyRelation:function(e,t,r){var i=!r||Kekule.ArrayUtils.isArray(r)&&!r.length,n=this.getRelation(e,t);return i?(n&&this.removeRelation(n),null):(n?n.dest=r:n=this.createRelation(e,t,r),n)},getRelationIndex:function(e,t){for(var r=this.getRelations(),i=0,n=r.length;i<n;++i){var o=r[i];if(o.srcObj===e&&o.srcProp===t)return i}return-1},getRelation:function(e,t){var r=this.getRelations(),i=this.getRelationIndex(e,t);return i>=0?r[i]:null},releaseRelation:function(e,t){var r=this.getRelations(),i=this.getRelationIndex(e,t);i>=0&&r.splice(i,1)},removeRelation:function(e){var t=this.getRelations(),r=t.indexOf(e);r>=0&&t.splice(r,1)},findRelations:function(e,t){var r,i=t||{},n=[],o=Object.extend({},e),a=!1;o.dest&&(delete o.dest,a=!0,r=Kekule.ArrayUtils.toArray(e.dest));for(var s=this.getRelations(),l=0,u=s.length;l<u;++l){var d=s[l],c=!1;if((c=Kekule.ObjUtils.match(d,o))&&a){var h=Kekule.ArrayUtils.toArray(d.dest);c=i.checkDestChildren?this._hasChildOrSelfOfParents(h,r):Kekule.ArrayUtils.intersect(h,r).length===r.length}c&&n.push(d)}return n},_hasChildOrSelfOfParents:function(e,t){for(var r=0,i=e.length;r<i;++r)for(var n=e[r],o=0,a=t.length;o<a;++o){var s=t[o];if(n===s||n.isChildOf&&n.isChildOf(s))return!0}return!1}})}(),Kekule.ExceptionHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExceptionHandler",initProperties:function(){this.defineEvent("exceptionThrown")},notifyExceptionThrown:function(e,t){var r={exception:e,level:t};return this.invokeEvent("exceptionThrown",r),r},throwException:function(e,t){var r=Kekule.ExceptionLevel;if(t||(t=r.ERROR),!this.notifyExceptionThrown(e,t||r.ERROR).stop){if(!t||t===r.ERROR){var i=e;throw"string"==typeof e&&(i=new Kekule.Exception(e)),i}if("undefined"!=typeof console){"string"!=typeof e&&(e=e.message);var n=t===r.NOT_FATAL_ERROR?"error":t===r.WARNING?"warn":t===r.NOTE?"info":"log";n?console[n](e):console.log(e)}}},raise:function(e,t){return this.throwException(e,t||Kekule.ExceptionLevel.ERROR)}}),Kekule.ExceptionHandler.getInstance=function(){return this.instance||(this.instance=new Kekule.ExceptionHandler),this.instance},Kekule.exceptionHandler=Kekule.ExceptionHandler.getInstance(),Kekule.Exception=function(e,t){this.message=e,this.name=t},Kekule.Exception.prototype=new Error,Kekule.Exception.prototype.constructor=Kekule.Exception,Object.extend(Kekule.Exception.prototype,{getMessage:function(){return this.message}}),Kekule.Error=function(e,t){this.message=e,this.name=t},Kekule.Error.prototype=Kekule.Exception.prototype,Kekule.Error.prototype.constructor=Kekule.Error,Kekule.ChemError=function(e,t){this.message=e,this.name=t},Kekule.ChemError.prototype=Kekule.Error.prototype,Kekule.ChemError.prototype.constructor=Kekule.ChemError,"undefined"==typeof console&&(console={log:function(){},warn:function(){},info:function(){},error:function(){}}),Kekule.oneOf=function(){for(var e=arguments,t=Kekule.ObjUtils.notUnset,r=0,i=e.length;r<i;++r)if(t(e[r]))return e[r];return null},Kekule.ClassUtils={getShortClassName:function(e){var t=e.indexOf(".");return t>=0?e.substring(t+1):e},getLastClassName:function(e){var t=e.lastIndexOf(".");return t>=0?e.substring(t+1):e},makeSingleton:function(e){return Object.extend(e,{_instance:null,getInstance:function(t,r,i,n,o,a,s,l,u,d){return e._instance||(e._instance=new e(t,r,i,n,o,a,s,l,u,d)),e._instance}})}},Kekule.NumUtils={isNormalNumber:function(e){return"number"==typeof e&&!isNaN(e)},isInteger:function(e){return"number"==typeof e&&parseInt(e,10)===parseFloat(e)},toDecimals:function(e,t){if(Kekule.NumUtils.isInteger(e))return e.toString();var r=Math.pow(10,t),i=Math.round(e*r);i/=r;var n=parseInt(i),o=(i-n).toString();return o.length>t+2?(o=o.substr(2,t),n.toString()+"."+o):i.toString()},toPrecision:function(e,t,r,i){var n,o=Math.sign(e),a=Math.abs(e),s=Kekule.NumUtils.getDecimalPointPos(a)+1-t;if(s>=0)n=i?Math.round(a):a.toPrecision(t);else{var l=Math.round(a*Math.pow(10,-s)).toString(),u=l.length,d=Math.abs(s);if(n=u===d?"0."+l:u>d?l.substr(0,u-d)+"."+l.substr(u-d):(0).toFixed(d-u)+l,r){for(var c=0,h=n.charAt(n.length-1-c);("0"===h||"."===h)&&(++c,"."!==h);)h=n.charAt(n.length-1-c);n=n.substr(0,n.length-c)}}return o<0&&(n="-"+n),n},getDecimalPointPos:function(e){if(Kekule.NumUtils.isFloatEqual(e,0))return 0;for(var t=Math.abs(e),r=t>1?10:.1,i=t>1?1:-1,n=1,o=0;t>1&&n<=t||t<1&&n>t;)n*=r,o+=i;return t>1?o-1:o},getHeadingDigit:function(e){if(Kekule.NumUtils.isFloatEqual(e,0))return 0;var t=Math.abs(e),r=Kekule.NumUtils.getDecimalPointPos(t),i=Math.pow(10,r);return Math.floor(t/i)},isFloatEqual:function(e,t,r){return Kekule.ObjUtils.isUnset(r)&&(r=1e-15*Math.min(Math.abs(e),Math.abs(t))),Math.abs(e-t)<=r},compareFloat:function(e,t,r){return Kekule.NumUtils.isFloatEqual(e,t,r)?0:e<t?-1:1},getPrimes:function(e){var t,r,i=[],n=[];for(t=2;t<=e;++t)if(!i[t])for(n.push(t),r=t<<1;r<=e;r+=t)i[r]=!0;return n}},Kekule.ObjUtils={getPrototypeOf:function(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.prototype||e.__proto__},getPropertyDescriptor:function(e,t,r){var i=Object.getOwnPropertyDescriptor;if(i){var n=i(e,t);return!n&&r&&(e.prototype||e.__proto__)&&(n=Kekule.ObjUtils.getPropertyDescriptor(e.prototype||e.__proto__,t,r)),n}return null},getOwnedFieldNames:function(e,t){var r=[];for(var i in e)e.hasOwnProperty(i)&&(t||"function"!=typeof e[i])&&r.push(i);return r},replacePropName:function(e,t,r){return void 0!==e[t]&&(e.hasOwnProperty(t)?(e[r]=e[t],delete e[t]):Kekule.raise(Kekule.$L("ErrorMsg.NON_OWN_PROPERTY_CANNOT_BE_REPLACED"))),e},isUnset:function(e){return null==e},notUnset:function(e){return null!=e},equal:function(e,t,r){var i=[];for(var n in e)if(!(r&&r.indexOf(n)>=0)){if(e[n]!==t[n])return!1;i.push(n)}for(var n in t)if(!(r&&r.indexOf(n)>=0)&&i.indexOf(n)<0)return!1;return!0},match:function(e,t){var r=e instanceof ObjectEx;for(var i in t){if(t.hasOwnProperty(i))if((r?e.getPropValue(i):e[i])!==t[i])return!1}return!0},isInstanceOf:function(e,t){if(DataType.isArrayValue(t)){for(var r=0,i=t.length;r<i;++r)if(e instanceof t[r])return!0;return!1}return e instanceof t},getLeafFieldCascadeNames:function(e,t){var r=function(e,t,i,n){for(var o in i)if(i.hasOwnProperty(o)&&(n||"function"!=typeof i[o])){var a=i[o];"object"==typeof a?r(e,t+o+".",a,n):e.push(t+o)}},i=[];return r(i,"",e,t),i}},Kekule.ArrayUtils={isArray:function(e){return!!e&&("object"==typeof e&&void 0!==e.length)},toArray:function(e){return Kekule.ArrayUtils.isArray(e)?e:[e]},clone:function(e){return e.slice(0)},filter:function(e,t,r){if(!t)return Kekule.ArrayUtils.clone(e);if(e.filter)return e.filter(t,r);for(var i=[],n=0,o=e.length;n<o;++n){var a=e[n];t.apply(r,[a,n,e])&&i.push(a)}return i},divide:function(e,t){for(var r=[],i=[],n=0,o=0,a=e.length;o<a;++o)i.push(e[o]),++n>=t&&(r.push(i),i=[],n=0);return i.length&&r.push(i),r},pushUnique:function(e,t,r){var i=Kekule.ArrayUtils.pushUniqueEx(e,t,r);return i?i.index:null},pushUniqueEx:function(e,t,r){if(DataType.isArrayValue(t)){for(var i,n=r?Kekule.ArrayUtils._pushUniqueItemEx:Kekule.ArrayUtils.pushUniqueEx,o=0,a=t.length;o<a;++o)Kekule.ObjUtils.isUnset(i)?i=n(e,t[o],r):n(e,t[o],r);return i}return Kekule.ArrayUtils._pushUniqueItemEx(e,t)},_pushUniqueItemEx:function(e,t){if(!t)return{index:-1,isPushed:!1};var r=e.indexOf(t);return r<0?{index:e.push(t),isPushed:!0}:{index:r,isPushed:!1}},insertUnique:function(e,t,r){return Kekule.ArrayUtils.insertUniqueEx(e,t,r).index},insertUniqueEx:function(e,t,r){if(!t)return{index:-1,isInserted:!1};(Kekule.ObjUtils.isUnset(r)||r<0)&&(r=e.length);var i=e.indexOf(t);return i<0?(e.splice(r,0,t),{index:r,isInserted:!0}):i!=r?(e.splice(i,1),e.splice(r,0,t),{index:r,isInserted:!1}):void 0},removeAt:function(e,t){var r=e[t];return void 0!==r?(e.splice(t,1),r):null},remove:function(e,t,r){var i=e.indexOf(t);return i>=0?(Kekule.ArrayUtils.removeAt(e,i),r&&Kekule.ArrayUtils.remove(e,t,r),t):null},replace:function(e,t,r,i){var n=e.indexOf(t);return n>=0?(e[n]=r,i&&Kekule.ArrayUtils.replace(e,t,r,i),t):null},changeIndex:function(e,t,r){if(t>=0&&t<=e.length){var i=e[t];return e.splice(t,1),e.splice(r,0,i),i}return null},changeItemIndex:function(e,t,r){var i=e.indexOf(t);return Kekule.ArrayUtils.changeIndex(e,i,r)},toUnique:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r];t.indexOf(n)<0&&t.push(n)}return t},getUniqueElemCount:function(e){return Kekule.ArrayUtils.toUnique(e).length},reverse:function(e){for(var t=[],r=0,i=e.length;r<i;++r)Kekule.ObjUtils.notUnset(e[r])&&(t[i-r-1]=e[r]);return t},randomize:function(e){if(!e)return null;if(!e.length)return[];for(var t=[],r=e.slice(0);r.length>1;){var i=Math.round(Math.random()*(r.length-1));t.push(r.splice(i,1)[0])}return t.push(r[0]),t},exclude:function(e,t){for(var r=[],i=Kekule.ArrayUtils.toArray(t),n=0,o=e.length;n<o;++n){var a=e[n];i.indexOf(a)<0&&r.push(a)}return r},intersect:function(e,t){for(var r=[],i=0,n=e.length;i<n;++i)t.indexOf(e[i])>=0&&r.push(e[i]);return r},flatten:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r];if(Kekule.ArrayUtils.isArray(n)){var o=Kekule.ArrayUtils.flatten(n);t=t.concat(o)}else t.push(n)}return t},compare:function(e,t,r){r||(r=function(e,t){return e>t?1:e<t?-1:0});for(var i=Math.min(e.length,t.length),n=0;n<i;++n){var o=r(e[n],t[n]);if(0!==o)return o}return e.length>i?1:t.length>i?-1:0},compareNestedArray:function(e,t,r){var i=Math.min(e.length,t.length);r||(r=function(e,t){return e-t});for(var n=0;n<i;++n){var o=0,a=e[n],s=t[n],l=DataType.isArrayValue(a),u=DataType.isArrayValue(s);if(0!=(o=l&&u?Kekule.ArrayUtils.compareNestedArray(a,s,r):l?1:u?-1:r(a,s)))return o}return e.length>i?1:t.length>i?-1:0},group:function(e,t){t||(t=function(e,t){return e<t?-1:e>t?1:0});var r=Kekule.ArrayUtils.clone(e);r.sort(t);for(var i,n=[],o=0,a=r.length;o<a;++o){var s=r[o];if(i&&0===t(s,i)){var l=n.length?n[n.length-1]:null;Kekule.ArrayUtils.isArray(l)||(n.pop(),l=[i],n.push(l)),l.push(s)}else n.push(s);i=s}return n},indexStackOfElem:function(e,t){for(var r=0,i=t.length;r<i;++r){var n=t[r];if(n===e)return[r];if(Kekule.ArrayUtils.isArray(n)){var o=Kekule.ArrayUtils.indexStackOfElem(e,n);if(o)return o.unshift(r),o}}return null},getElemByIndexStack:function(e,t){var r=Kekule.ArrayUtils.isArray(t)?Kekule.ArrayUtils.clone(t):[t],i=e[r.shift()];return i?r.length?Kekule.ArrayUtils.isArray(i)?Kekule.ArrayUtils.getElemByIndexStack(i,r):null:i:null},getMedian:function(e){var t=[].concat(e),r=t.length;return 0===r?null:r<=1?t[0]:(t.sort(function(e,t){return e-t}),r%2?t[r+1>>1]:(t[r>>1]+t[(r>>1)-1])/2)},sortHashArray:function(e,t){for(var r=[],i=0,n=t.length;i<n;++i){var o={},a=t[i]||"";a.startsWith("!")?(o.field=a.substr(1),o.desc=!0):(o.field=a,o.desc=!1),r.push(o)}return e.sort(function(e,t){for(var i=0,n=0,o=r.length;n<o;++n){var a=r[n].field,s=e[a]||"",l=t[a]||"";if(i=s>l?1:s<l?-1:0,r[n].desc&&(i=-i),0!==i)break}return i}),e}},Kekule.StrUtils={STR_TRUES:["true","yes","t","y"],STR_FALSES:["false","no","f","n"],trim:function(e){return e.replace(/^\s*|\s*$/g,"")},normalizeSpace:function(e){return e.replace(/^\s*|\s(?=\s)|\s*$/g,"")},convertToStr:function(e){return""+e},convertToType:function(e,t){if("string"!=typeof e)return e;switch(t){case DataType.FLOAT:case DataType.NUMBER:return parseFloat(e);case DataType.INT:return parseInt(e);case DataType.BOOL:return Kekule.StrUtils.strToBool(e);default:return e}},boolToStr:function(e){return e?Kekule.StrUtils.STR_TRUES[0]:Kekule.StrUtils.STR_FALSES[0]},strToBool:function(e){for(var t=e.toLowerCase(),r=0,i=Kekule.StrUtils.STR_FALSES.length;r<i;++r)if(t==Kekule.StrUtils.STR_FALSES[r])return!1;return!!e},removeAroundPair:function(e,t,r){return e.startsWith(t)&&e.endsWith(r)?e.substring(t.length,e.length-t.length-r.length+1):e},unquote:function(e){var t=Kekule.StrUtils.removeAroundPair,r=e;return r=t(r,"'","'"),r=t(r,'"','"')},splitTokens:function(e,t){if(!e)return[];if(DataType.isArrayValue(e))return e;var r=t?new RegExp(t,"g"):/\s+/g;return e.split(r)},hasToken:function(e,t,r){return Kekule.StrUtils.splitTokens(e,r).indexOf(t)>=0},addTokens:function(e,t,r){for(var i=Kekule.StrUtils.splitTokens(e,r),n=Kekule.StrUtils.splitTokens(t,r),o=0,a=n.length;o<a;++o)i.indexOf(n[o])<0&&i.push(n[o]);return i.join(r||" ")},removeTokens:function(e,t,r){for(var i=Kekule.StrUtils.splitTokens(e,r),n=Kekule.StrUtils.splitTokens(t,r),o=0,a=n.length;o<a;++o){var s=i.indexOf(n[o]);s>=0&&i.splice(s,1)}return i.join(r||" ")},toggleTokens:function(e,t,r){for(var i=Kekule.StrUtils.splitTokens(e,r),n=Kekule.StrUtils.splitTokens(t,r),o=[],a=0,s=n.length;a<s;++a){var l=i.indexOf(n[a]);l>=0?i.splice(l,1):o.push(n[a])}return(i=i.concat(o)).join(r||" ")},getLineCount:function(e,t){return t||(t="\n"),e.split(t).length},getMaxLineCharCount:function(e,t){t||(t="\n");for(var r=e.split(t),i=0,n=0,o=r.length;n<o;++n){var a=r[n];i=Math.max(a.length,i)}return i},isNumbericStr:function(e){var t=Number(e);return!isNaN(t)},splitIndexEndingStr:function(e){for(var t=e.length-1,r=e.charAt(t),i="";r&&Kekule.StrUtils.isNumbericStr(r);)--t,i=r+i,r=e.charAt(t);return i?{prefix:e.substring(0,t+1),index:parseInt(i)}:null}},Kekule.RoleMapUtils={KEY_ITEM:"item",KEY_ROLE:"role",NON_EXPLICIT_ROLE:null,createMap:function(e,t){var r={};return t=t||Kekule.RoleMapUtils.NON_EXPLICIT_ROLE,r[Kekule.RoleMapUtils.KEY_ITEM]=e,r[Kekule.RoleMapUtils.KEY_ROLE]=t,r},getItem:function(e){return e[Kekule.RoleMapUtils.KEY_ITEM]},setItem:function(e,t){e[Kekule.RoleMapUtils.KEY_ITEM]=t},getRole:function(e){return e[Kekule.RoleMapUtils.KEY_ROLE]},setRole:function(e,t){e[Kekule.RoleMapUtils.KEY_ROLE]=t}},Kekule.FactoryUtils={MATCH_EXACTLY:0,MATCH_BY_CLASS:1,DEF_ITEM_STORE_FIELD_NAME:"_items",createSimpleFactory:function(e){var t=Kekule.FactoryUtils,r={_items:new Kekule.MapEx(!0),_matchMethod:e||Kekule.FactoryUtils.MATCH_EXACTLY,register:function(e,t){r._items.set(e,t)},unregister:function(e){r._items.remove(e)},getClass:function(e){if(r._matchMethod===t.MATCH_EXACTLY)return r._items.get(e);if(r._matchMethod===t.MATCH_BY_CLASS){var i=r._items.get(e);if(!i){var n=e&&ClassEx.getSuperClass(e);n&&(i=r.getClass(n))}return i}},getInstance:function(e,t,i,n,o,a,s,l,u,d){var c=r.getClass(e);if(c)return new c(t,i,n,o,a,s,l,u,d)}};return r}},Kekule.UrlUtils={PROTOCAL_DELIMITER:"://",EXT_DELIMITER:".",PATH_DELIMITER:"/",SEARCH_DELIMITER:"?",SEARCH_PAIR_DELIMITER:"&",KEY_VALUE_DELIMITER:"=",HASH_DELIMITER:"#",normalizePath:function(e){return e.replace(/\\/g,"/")},extractProtocal:function(e){if(!e)return null;var t=e.indexOf(Kekule.UrlUtils.PROTOCAL_DELIMITER);return t>=0?e.substr(0,t):""},extractFileName:function(e){if(!e)return null;var t=e.lastIndexOf(Kekule.UrlUtils.PATH_DELIMITER);return t>=0?e.substr(t+1):e},extractFileExt:function(e){var t=Kekule.UrlUtils.extractFileName(e);if(t){var r=t.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);return r>=0?t.substr(r+1):""}return null},extractFileCoreName:function(e){var t=Kekule.UrlUtils.extractFileName(e);if(t){var r=t.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);return r>=0?t.substr(0,r):""}return null},extractSearch:function(e){if(!e)return null;var t=e.lastIndexOf(Kekule.UrlUtils.SEARCH_DELIMITER);return t>=0?e.substr(t):null},analysisSearch:function(e,t){for(var r=Kekule.UrlUtils.extractSearch(e)||"",i=(r=r.substr(1)).split(Kekule.UrlUtils.SEARCH_PAIR_DELIMITER),n=t?{}:[],o=0,a=i.length;o<a;++o){var s=i[o].split(Kekule.UrlUtils.KEY_VALUE_DELIMITER);s[0]&&(t?n[s[0]]=s[1]:n.push({key:s[0],value:s[1]}))}return n},generateSearchString:function(e){for(var t=Kekule.UrlUtils,r=[],i=Kekule.ObjUtils.getOwnedFieldNames(e),n=0,o=i.length;n<o;++n){var a=i[n],s=e[a];if(Kekule.ObjUtils.notUnset(s)){s=encodeURIComponent(""+s);r.push(a+t.KEY_VALUE_DELIMITER+s)}}return r.join(t.SEARCH_PAIR_DELIMITER)},generateUrl:function(e,t,r){var i=Kekule.UrlUtils,n=e;if(t){var o=i.generateSearchString(t);n+=i.SEARCH_DELIMITER+o}return r&&(n+=i.HASH_DELIMITER+r),n}},Kekule.MatrixUtils={create:function(e,t,r){var i=!1,n=!1,o=Kekule.ObjUtils;o.notUnset(r)&&(i=!0,Kekule.ArrayUtils.isArray(r)&&(n=!0));for(var a=0,s=new Array(e),l=0,u=s.length;l<u;++l){var d=new Array(t);if(i)for(var c=0,h=d.length;c<h;++c)n&&o.notUnset(r[a])?(d[c]=r[a],++a):d[c]=r;s[l]=d}return s},createIdentity:function(e){for(var t=Kekule.MatrixUtils.create(e,e,0),r=0;r<e-1;++r)t[r][r]=1;return t},getRowCount:function(e){return e.length},getColCount:function(e){return Kekule.MatrixUtils.getRowCount(e)>0?e[0].length:0},getValue:function(e,t,r){return e[t-1][r-1]||0},setValue:function(e,t,r,i){e[t-1][r-1]=i},transpose:function(e){for(var t=Kekule.MatrixUtils,r=t.getColCount(e),i=t.getRowCount(e),n=t.create(r,i),o=1;o<=r;++o)for(var a=n[o-1],s=1;s<=i;++s)a[s-1]=t.getValue(e,s,o);return n},minus:function(e){for(var t=Kekule.MatrixUtils,r=t.getRowCount(e),i=t.getColCount(e),n=this.create(r,i),o=0;o<r;++o)for(var a=n[o],s=e[o],l=0;l<i;++l)a[l]=-(s[l]||0);return n},add:function(e,t){for(var r=Kekule.MatrixUtils,i=r.getRowCount(e),n=r.getColCount(e),o=this.create(i,n),a=1;a<=i;++a)for(var s=1;s<=n;++s)r.setValue(o,a,s,r.getValue(e,a,s)+r.getValue(t,a,s));return o},substract:function(e,t){var r=Kekule.MatrixUtils;return r.add(e,r.minus(t))},multiply:function(e,t){for(var r=Kekule.MatrixUtils,i=r.getRowCount(e),n=r.getColCount(t),o=r.getRowCount(t),a=r.create(i,n),s=1;s<=i;++s)for(var l=1;l<=n;++l){for(var u=0,d=1;d<=o;++d)u+=r.getValue(e,s,d)*r.getValue(t,d,l);r.setValue(a,s,l,u)}return a}},Kekule.CoordUtils={create:function(e,t,r){var i={x:e,y:t};return(r||0===r)&&(i.z=r),i},clone:function(e){var t={x:e.x,y:e.y};return(e.z||0===e.z)&&(t.z=e.z),t},is3D:function(e){return e.z||0===e.z},isEqual:function(e,t){var r=e.x===t.x&&e.y===t.y,i=Kekule.ObjUtils;return r&&(i.notUnset(e.z)||i.notUnset(t.z))&&(r=e.z===t.z),r},isZero:function(e,t){var r=Kekule.ObjUtils.notUnset(t)?t:0;return Math.abs(e.x||0)<=r&&Math.abs(e.y||0)<=r&&Math.abs(e.z||0)<=r},absValue:function(e){if(e){var t={};return Kekule.ObjUtils.isUnset(e.x)||(t.x=Math.abs(e.x)),Kekule.ObjUtils.isUnset(e.y)||(t.y=Math.abs(e.y)),Kekule.ObjUtils.isUnset(e.z)||(t.z=Math.abs(e.z)),t}},add:function(e,t){var r={};return Kekule.ObjUtils.isUnset(e.x)&&Kekule.ObjUtils.isUnset(t.x)||(r.x=(e.x||0)+(t.x||0)),Kekule.ObjUtils.isUnset(e.y)&&Kekule.ObjUtils.isUnset(t.y)||(r.y=(e.y||0)+(t.y||0)),Kekule.ObjUtils.isUnset(e.z)&&Kekule.ObjUtils.isUnset(t.z)||(r.z=(e.z||0)+(t.z||0)),r},substract:function(e,t){var r={};return Kekule.ObjUtils.isUnset(e.x)&&Kekule.ObjUtils.isUnset(t.x)||(r.x=(e.x||0)-(t.x||0)),Kekule.ObjUtils.isUnset(e.y)&&Kekule.ObjUtils.isUnset(t.y)||(r.y=(e.y||0)-(t.y||0)),Kekule.ObjUtils.isUnset(e.z)&&Kekule.ObjUtils.isUnset(t.z)||(r.z=(e.z||0)-(t.z||0)),r},multiply:function(e,t){var r={};return Kekule.ObjUtils.isUnset(e.x)||(r.x=e.x*t),Kekule.ObjUtils.isUnset(e.y)||(r.y=e.y*t),Kekule.ObjUtils.isUnset(e.z)||(r.z=e.z*t),r},divide:function(e,t){return Kekule.CoordUtils.multiply(e,1/t)},standardize:function(e){var t=Math.sqrt(Math.sqr(e.x||0)+Math.sqr(e.y||0)+Math.sqr(e.z||0));return Kekule.CoordUtils.divide(e,t||1)},toArray:function(e){var t=[];t.push(e.x,e.y),Kekule.CoordUtils.is3D(e)&&t.push(e.z)},isSameTransform2DOptions:function(e,t,r){var i=Kekule.ObjUtils.isUnset,n=Kekule.NumUtils.isFloatEqual;r||(r={});var o=r.translate||.01,a=r.scale||.01,s=r.rotate||.01,l=!1,u=e.center,d=t.center;if(l=!(!u||!d)&&(n(u.x,d.x,o)&&n(u.y,d.y,o)))for(var c=["scale","scaleX","scaleY","rotateAngle","translateX","translateY"],h=0,p=c.length;h<p;++h){var g=c[h],f=e[g],C=t[g];if(!i(f)||!i(C))if(!(l=!i(f)&&!i(C)&&n(f,C,0===g.indexOf("scale")?a:0===g.indexOf("rotate")?s:o)))break}return l},isSameTransform3DOptions:function(e,t,r){var i=Kekule.ObjUtils.isUnset,n=Kekule.NumUtils.isFloatEqual;r||(r={});var o=r.translate||.01,a=r.scale||.01,s=r.rotate||.01,l=!1,u=e.center,d=t.center;if(l=u&&d?n(u.x,d.x,o)&&n(u.y,d.y,o)&&n(u.z,d.z,o):!u&&!d){var c=e.rotateAxisVector,h=t.rotateAxisVector;l=c&&h?n(c.x,h.x,o)&&n(c.y,h.y,o)&&n(c.z,h.z,o):!c&&!h}if(l)for(var p=["scale","scaleX","scaleY","scaleZ","rotateAngle","rotateX","rotateY","rotateZ","translateX","translateY","translateZ"],g=0,f=p.length;g<f;++g){var C=p[g],m=e[C],T=t[C];if(!i(m)||!i(T))if(!(l=!i(m)&&!i(T)&&n(m,T,0===C.indexOf("scale")?a:0===C.indexOf("rotate")?s:o)))break}return l},transform2D:function(e,t){var r=Kekule.CoordUtils.calcTransform2DMatrix(t);return Kekule.CoordUtils.transform2DByMatrix(e,r)},inverseTransform2D:function(e,t){var r=Kekule.CoordUtils.calcInverseTransform2DMatrix(t);return Kekule.CoordUtils.transform2DByMatrix(e,r)},transform2DByMatrix:function(e,t){var r=Kekule.MatrixUtils,i=r.create(3,1,[e.x||0,e.y||0,1]);return{x:(i=r.multiply(t,i))[0][0],y:i[1][0]}},calcTransform2DMatrix:function(e,t){var r=Kekule.MatrixUtils,i=Kekule.ObjUtils.notUnset,n=e||{},o=n.center;if(o)var a=r.create(3,3,[1,0,-(o.x||0),0,1,-(o.y||0),0,0,1]),s=r.create(3,3,[1,0,o.x||0,0,1,o.y||0,0,0,1]);if(n.rotateAngle)var l=n.rotateAngle,u=Math.cos(l),d=Math.sin(l),c=r.create(3,3,[u,-d,0,d,u,0,0,0,1]);var h=n.scale,p=n.scaleX,g=n.scaleY,f=Kekule.oneOf(h,1);if(i(h)||i(p)||i(g)){var C=r.create(3,3);r.setValue(C,1,1,Kekule.oneOf(p,f)),r.setValue(C,2,2,Kekule.oneOf(g,f)),r.setValue(C,3,3,1)}var m=n.translateX,T=n.translateY;if(m||T){var E=r.create(3,3);r.setValue(E,1,1,1),r.setValue(E,2,2,1),r.setValue(E,3,3,1),r.setValue(E,1,3,m||0),r.setValue(E,2,3,T||0)}var _=r.create(3,3,[1,0,0,0,1,0,0,0,1]);return t?(a&&(_=r.multiply(a,_)),E&&(_=r.multiply(E,_)),C&&(_=r.multiply(C,_)),c&&(_=r.multiply(c,_)),s&&(_=r.multiply(s,_))):(a&&(_=r.multiply(a,_)),c&&(_=r.multiply(c,_)),C&&(_=r.multiply(C,_)),E&&(_=r.multiply(E,_)),s&&(_=r.multiply(s,_))),_},calcInverseTransform2DMatrix:function(e){var t=Kekule.ObjUtils.notUnset,r=Object.create(e);return e.center&&(r.center={x:e.center.x,y:e.center.y}),t(r.scale)&&(r.scale=1/r.scale),t(r.scaleX)&&(r.scaleX=1/r.scaleX),t(r.scaleY)&&(r.scaleY=1/r.scaleY),r.translateX&&(r.translateX=-r.translateX),r.translateY&&(r.translateY=-r.translateY),r.rotateAngle&&(r.rotateAngle=-r.rotateAngle),Kekule.CoordUtils.calcTransform2DMatrix(r,!0)},transform3D:function(e,t){var r=Kekule.CoordUtils.calcTransform3DMatrix(t);return Kekule.CoordUtils.transform3DByMatrix(e,r)},transform3DByMatrix:function(e,t){var r=Kekule.MatrixUtils,i=r.create(4,1,[e.x||0,e.y||0,e.z||0,1]);return{x:(i=r.multiply(t,i))[0][0],y:i[1][0],z:i[2][0]}},_calcRotateXYZ3DMatrixCore:function(e){var t=Kekule.MatrixUtils,r=t.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),i=[];if(e.rotateAngle&&e.rotateAxisVector){var n=Kekule.CoordUtils.standardize(e.rotateAxisVector);i.push({vector:[n.x,n.y,n.z],angle:-e.rotateAngle})}else{var o=e.rotateX,a=e.rotateY,s=e.rotateZ;o&&i.push({vector:[1,0,0],angle:-o}),a&&i.push({vector:[0,1,0],angle:-a}),s&&i.push({vector:[0,0,1],angle:-s})}for(var l=0,u=i.length;l<u;++l){var d,c=t.create(4,4),h=i[l].angle,p=i[l].vector,g=Math.cos(h),f=Math.sin(h);for(l=1;l<=4;++l)for(var C=1;C<=4;++C){if(l<4&&C<4){for(var m=1;m<=3&&(m===l||m===C);++m);var T=p[l-1]*p[C-1];d=l<C?T*(1-g)-Math.pow(-1,l+C)*p[m-1]*f:l>C?T*(1-g)+Math.pow(-1,l+C)*p[m-1]*f:T+(1-T)*g}else d=l===C?1:0;t.setValue(c,l,C,d)}r=t.multiply(c,r)}return r},calcRotate3DMatrix:function(e){var t=Kekule.MatrixUtils,r=Object.create(e||{});if(r.rotateMatrix)a=r.rotateMatrix;else{var i=r.center;if(i)var n=t.create(4,4,[1,0,0,-(i.x||0),0,1,0,-(i.y||0),0,0,1,-(i.z||0),0,0,0,1]),o=t.create(4,4,[1,0,0,i.x||0,0,1,0,i.y||0,0,0,1,i.z||0,0,0,0,1]);var a=Kekule.CoordUtils._calcRotateXYZ3DMatrixCore(e);n&&(a=t.multiply(n,a)),o&&(a=t.multiply(o,a))}return a},calcTransform3DMatrix:function(e){var t=Kekule.ObjUtils.notUnset,r=Kekule.MatrixUtils,i=e||{},n=i.center;if(n)var o=r.create(4,4,[1,0,0,-(n.x||0),0,1,0,-(n.y||0),0,0,1,-(n.z||0),0,0,0,1]),a=r.create(4,4,[1,0,0,n.x||0,0,1,0,n.y||0,0,0,1,n.z||0,0,0,0,1]);var s=Object.copyValues({},i,["rotateX","rotateY","rotateZ","rotateAngle","rotateAxisVector","rotateMatrix"]),l=Kekule.CoordUtils.calcRotate3DMatrix(s),u=i.scale,d=i.scaleX,c=i.scaleY,h=i.scaleZ;if(t(u)||t(d)||t(c)||t(h)){var p=Kekule.oneOf(u,1),g=r.create(4,4);r.setValue(g,1,1,Kekule.oneOf(d,p)),r.setValue(g,2,2,Kekule.oneOf(c,p)),r.setValue(g,3,3,Kekule.oneOf(h,p)),r.setValue(g,4,4,1)}var f=i.translateX,C=i.translateY,m=i.translateZ;if(f||C||m){var T=r.create(4,4);r.setValue(T,1,1,1),r.setValue(T,2,2,1),r.setValue(T,3,3,1),r.setValue(T,4,4,1),r.setValue(T,1,4,f||0),r.setValue(T,2,4,C||0),r.setValue(T,3,4,m||0)}var E=r.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);return o&&(E=r.multiply(o,E)),l&&(E=r.multiply(l,E)),g&&(E=r.multiply(g,E)),T&&(E=r.multiply(T,E)),a&&(E=r.multiply(a,E)),E},calcInverseTransform3DMatrix:function(e){var t=Kekule.ObjUtils.notUnset,r=Object.create(e);return e.center&&(r.center={x:e.center.x,y:e.center.y,z:e.center.z}),t(r.scale)&&(r.scale=1/r.scale),t(r.scaleX)&&(r.scaleX=1/r.scaleX),t(r.scaleY)&&(r.scaleY=1/r.scaleY),t(r.scaleZ)&&(r.scaleZ=1/r.scaleZ),r.translateX&&(r.translateX=-r.translateX),r.translateY&&(r.translateY=-r.translateY),r.translateZ&&(r.translateZ=-r.translateZ),r.rotateAngle&&(r.rotateAngle=-r.rotateAngle),r.rotateX&&(r.rotateX=-r.rotateX),r.rotateX&&(r.rotateY=-r.rotateY),r.rotateZ&&(r.rotateZ=-r.rotateZ),Kekule.CoordUtils.calcTransform3DMatrix(r,!0)},calcCoordGroup2DTransformParams:function(e,t,r,i){var n=Kekule.CoordUtils,o=n.getDistance(e,t),a=n.substract(t,e),s=Math.atan2(a.y,a.x),l=n.getDistance(r,i),u=n.substract(i,r),d=Math.atan2(u.y,u.x),c=n.substract(r,e);return{translateX:c.x,translateY:c.y,scale:l/o,rotateAngle:d-s,center:e}},getDistance:function(e,t){t||(t={x:0,y:0,z:0});var r=Math.sqr(t.x-e.x)+Math.sqr(t.y-e.y);return Kekule.ObjUtils.notUnset(e.z)&&Kekule.ObjUtils.notUnset(t.z)&&(r+=Math.sqr(t.z-e.z)),Math.sqrt(r)},getCenter:function(e){var t=e.length;if(t<=0)return null;for(var r=Object.extend(e[0]),i=1;i<t;++i)r=Kekule.CoordUtils.add(r,e[i]);return Kekule.CoordUtils.divide(r,t)},insideRect:function(e,t,r){return(e.x-t.x)*(e.x-r.x)<=0&&(e.y-t.y)*(e.y-r.y)<=0},isInsideBox:function(e,t){var r=t,i=Math.sign(e.x-r.x1)*Math.sign(e.x-r.x2)<=0&&Math.sign(e.y-r.y1)*Math.sign(e.y-r.y2)<=0;return Kekule.ObjUtils.notUnset(e.z)&&(i=i&&Math.sign(e.z-r.z1)*Math.sign(e.z-r.z2)<=0),i},getContainerBoxCorners:function(e){var t={},r={},i=e.length;if(!(i>0))return null;t=Kekule.CoordUtils.clone(e[0]),r=Kekule.CoordUtils.clone(e[0]);for(var n=1;n<i;++n){var o=e[n];t.x=Math.min(t.x,o.x),t.y=Math.min(t.y,o.y),r.x=Math.max(r.x,o.x),r.y=Math.max(r.y,o.y),Kekule.ObjUtils.notUnset(t.z)&&(t.z=Math.min(t.z,o.z),r.z=Math.max(r.z,o.z))}return{min:t,max:r}},getContainerBox:function(e){var t=Kekule.CoordUtils.getContainerBoxCorners(e),r=t.min,i=t.max;return Kekule.BoxUtils.createBox(r,i)}},Kekule.GeometryUtils={standardizeAngle:function(e,t,r){t=t||0,Math.PI;return e-Math.floor((e-t)/Math.PI/2)*Math.PI*2},polarToCartesian:function(e,t,r,i){return{x:e+r*Math.cos(i),y:t+r*Math.sin(i)}},getVectorScalarProduct:function(e,t){return(e.x||0)*(t.x||0)+(e.y||0)*(t.y||0)+(e.z||0)*(t.z||0)},getVectorCrossProduct:function(e,t){return{x:(e.y||0)*(t.z||0)-(e.z||0)*(t.y||0),y:(e.z||0)*(t.x||0)-(e.x||0)*(t.z||0),z:(e.x||0)*(t.y||0)-(e.y||0)*(t.x||0)}},getVectorIncludedAngle:function(e,t){var r=Kekule.CoordUtils,i=Kekule.GeometryUtils.getVectorCrossProduct(e,t),n={x:0,y:0,z:0},o=r.getDistance(e,n)*r.getDistance(t,n),a=r.getDistance(i,n)/o;return Math.asin(a)},getVectorIncludedAngle2:function(e,t){return Kekule.GeometryUtils.standardizeAngle(Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x))},getDihedralAngleOfVectors:function(e,t,r){var i=Kekule.CoordUtils,n=Kekule.GeometryUtils,o=n.getVectorCrossProduct(e,t),a=n.getVectorCrossProduct(t,r),s=i.getDistance(t)/1e5;if(i.isZero(o,s)||i.isZero(a,s))return-1;var l=i.standardize(t),u=n.getVectorScalarProduct(n.getVectorCrossProduct(o,a),l),d=n.getVectorScalarProduct(o,a),c=Math.atan2(u,d);return c<0&&(c+=2*Math.PI),c},getDihedralAngleOfPoints:function(e,t,r,i){var n=Kekule.CoordUtils,o=n.substract(t,e),a=n.substract(r,t),s=n.substract(i,r);return Kekule.GeometryUtils.getDihedralAngleOfVectors(o,a,s)},getPerpendicularCrossPointFromCoordToLine:function(e,t,r,i){var n,o={};if(Math.abs(t.x-r.x)<1e-10)o.x=t.x,o.y=e.y;else{var a=(r.y-t.y)/(r.x-t.x);o.x=(a*a*t.x+a*(e.y-t.y)+e.x)/(a*a+1),o.y=a*(o.x-t.x)+t.y}if(i)n=!0;else{var s={x:t.x-r.x,y:t.y-r.y};n=Math.abs(s.y)>Math.abs(s.x)?Math.sign(o.y-t.y)*Math.sign(o.y-r.y)<=0:Math.sign(o.x-t.x)*Math.sign(o.x-r.x)<=0}return n?o:null},getDistanceFromPointToLine:function(e,t,r,i){var n=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(e,t,r,i);if(n)return Kekule.CoordUtils.getDistance(e,n);var o=Kekule.CoordUtils.getDistance(e,t),a=Kekule.CoordUtils.getDistance(e,r);return Math.min(o,a)},getCrossPointOfLines:function(e,t,r,i){var n=(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x),o=(e.x-i.x)*(t.y-i.y)-(e.y-i.y)*(t.x-i.x);if(n*o>=0)return null;var a=(r.x-e.x)*(i.y-e.y)-(r.y-e.y)*(i.x-e.x);if(a*(a+n-o)>=0)return null;var s=a/(o-n),l=s*(t.x-e.x),u=s*(t.y-e.y);return{x:e.x+l,y:e.y+u}},getCrossPointOfVectors:function(e,t){return Kekule.GeometryUtils.getCrossPointOfLines(e[0],e[1],t[0],t[1])},getCrossPointsOfVectorToCircle:function(e,t,r,i){var n=[],o=Kekule.CoordUtils,a=Kekule.NumUtils.isFloatEqual,s=i,l=[o.substract(e[0],t),o.substract(e[1],t)],u=l[1].y-l[0].y,d=l[0].x-l[1].x,c=l[1].x*l[0].y-l[0].x*l[1].y,h=r,p=[],g=4*u*u*c*c-4*(u*u+d*d)*(c*c-h*h*d*d);if(a(g,0,s))p=[-u*c/(u*u+d*d)];else if(g<0)p=[];else{var f=Math.sqrt(g);p=[(-2*u*c+f)/(2*(u*u+d*d)),(-2*u*c-f)/(2*(u*u+d*d))]}if(p&&p.length){var C=[];if(1===p.length&&a(d,0,s)){var m=Math.sqrt(h*h-p[0]*p[0]);a(m,0,s)?C=[0]:(C[0]=m,C[1]=-m,p[1]=p[0])}else for(var T=0,E=p.length;T<E;++T)C[T]=-(u*p[T]+c)/d;for(T=0,E=p.length;T<E;++T){var _=(p[T]-l[0].x)*(p[T]-l[1].x),S=(C[T]-l[0].y)*(C[T]-l[1].y);(a(u,0,s)&&_<=0||a(d,0,s)&&S<=0||_<=0&&S<=0)&&n.push(o.add({x:p[T],y:C[T]},t))}}return n},getCrossPointsOfCircles:function(e,t,r,i,n){if(Kekule.CoordUtils.getDistance(e,r)>t+i)return[];for(var o=t,a=i,s=e.x,l=r.x,u=e.y,d=r.y,c=(o*o-a*a+(l*l-s*s)+(d*d-u*u))/(2*(d-u)),h=(l-s)/(d-u),p=1+h*h,g=-(2*s+2*(c-u)*h),f=s*s+Math.sqr(c-u)-o*o,C=Math.sqrt(g*g-4*p*f),m=2*p,T=Kekule.NumUtils.isFloatEqual(C,0,n)?[-g]:[(-g+C)/m,(-g-C)/m],E=[],_=[],S=0,O=T.length;S<O;++S)E[S]=c-h*T[S],_.push({x:T[S],y:E[S]});return _},clipLineSegmentByBox:function(e,t){for(var r=t[0].x,i=t[0].y,n=t[1].x,o=t[1].y,a=e[0].x,s=e[0].y,l=e[1].x,u=e[1].y,d=function(e){var t=0;return e.x<r?t|=1:e.x>n&&(t|=2),e.y<i?t|=4:e.y>o&&(t|=8),t},c=d(e[0]),h=d(e[1]),p=!1;;){if(!(c|h)){p=!0;break}if(c&h){p=!1;break}var g,f,C=c||h;8&C?(g=a+(l-a)*(o-s)/(u-s),f=o):4&C?(g=a+(l-a)*(i-s)/(u-s),f=i):2&C?(f=s+(u-s)*(n-a)/(l-a),g=n):1&C&&(f=s+(u-s)*(r-a)/(l-a),g=r),C===c?(s=f,c=d(a=g)):(u=f,h=d(l=g))}if(p){var m=Kekule.CoordUtils.create;return[m(a,s),m(l,u)]}return null},simplifyCurveToLineSegments:function(e,t){return t?e.length<=2?Kekule.ArrayUtils.clone(e):Kekule.GeometryUtils._simplifyCurvePartToLineSegments(e,0,e.length-1,t):e},_simplifyCurvePartToLineSegments:function(e,t,r,i){var n=Kekule.GeometryUtils,o=e[t],a=e[r];if(r-t<=1)return[o,a];for(var s=i,l=null,u=t+1;u<r;++u){var d=Kekule.GeometryUtils.getDistanceFromPointToLine(e[u],o,a);d>s&&(s=d,l=u)}if(null===l)return[o,a];var c=n._simplifyCurvePartToLineSegments(e,t,l,i),h=n._simplifyCurvePartToLineSegments(e,l,r,i);return h.shift(),[].concat(c).concat(h)}},Kekule.IntersectionState={EQUAL:0,CONTAINING:1,CONTAINED:2,OVERLAPPED:3,SEPARATED:4},Kekule.BoxUtils={createBox:function(e,t){var r={},i=e.x||0,n=e.y||0,o=t.x||0,a=t.y||0;return i<=o?(r.x1=i,r.x2=o):(r.x1=o,r.x2=i),n<=a?(r.y1=n,r.y2=a):(r.y1=a,r.y2=n),Kekule.ObjUtils.notUnset(e.z)&&Kekule.ObjUtils.notUnset(t.z)&&(e.z<=t.z?(r.z1=e.z,r.z2=t.z):(r.z1=t.z,r.z2=e.z)),r},clone:function(e){var t={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2};return Kekule.ObjUtils.notUnset(e.z1)&&Kekule.ObjUtils.notUnset(e.z2)&&(t.z1=e.z1,t.z2=e.z2),t},convertToRect:function(e){var t=Kekule.BoxUtils.normalize(e);return Kekule.RectUtils.createRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)},normalize:function(e){var t={x1:Math.min(e.x1,e.x2),y1:Math.min(e.y1,e.y2),x2:Math.max(e.x1,e.x2),y2:Math.max(e.y1,e.y2)};return Kekule.ObjUtils.notUnset(e.z1)&&Kekule.ObjUtils.notUnset(e.z2)&&(t.z1=Math.min(e.z1,e.z2),t.z2=Math.max(e.z1,e.z2)),t},shiftBox:function(e,t,r,i){var n=t||0,o=r||0,a=i||0,s={x:e.x1+n,y:e.y1+o},l={x:e.x2+n,y:e.y2+o};return Kekule.ObjUtils.notUnset(e.z1)&&Kekule.ObjUtils.notUnset(e.z2)&&(s.z=e.z1+a,l.z=e.z2+a),Kekule.BoxUtils.createBox(s,l)},inflateBox:function(e,t,r,i){Kekule.ObjUtils.isUnset(r)&&(r=t),Kekule.ObjUtils.isUnset(i)&&(i=t);var n={x1:(n=Kekule.BoxUtils.normalize(e)).x1-t,y1:n.y1-r,x2:n.x2+t,y2:n.y2+r};return Kekule.ObjUtils.notUnset(n.z1)&&Kekule.ObjUtils.notUnset(n.z2)&&(n.z1=n.z1-i,n.z2=n.z2+i),n},getContainerBox:function(e,t){if(!e)return Kekule.BoxUtils.clone(t);if(!t)return Kekule.BoxUtils.clone(e);var r=Kekule.BoxUtils.normalize(e),i=Kekule.BoxUtils.normalize(t),n={x1:Math.min(r.x1,i.x1),y1:Math.min(r.y1,i.y1),x2:Math.max(r.x2,i.x2),y2:Math.max(r.y2,i.y2)};return Kekule.ObjUtils.notUnset(r.z1)&&Kekule.ObjUtils.notUnset(r.z2)&&Kekule.ObjUtils.notUnset(i.z1)&&Kekule.ObjUtils.notUnset(i.z2)&&(n.z1=Math.min(r.z1,i.z1),n.z2=Math.max(r.z2,i.z2)),n},getIntersection:function(e,t){var r=Kekule.BoxUtils.normalize(e),i=Kekule.BoxUtils.normalize(t),n={x1:Math.max(r.x1,i.x1),y1:Math.max(r.y1,i.y1),x2:Math.min(r.x2,i.x2),y2:Math.min(r.y2,i.y2)};return n.x1>n.x2||n.y1>n.y2?null:Kekule.ObjUtils.notUnset(r.z1)&&Kekule.ObjUtils.notUnset(r.z2)&&Kekule.ObjUtils.notUnset(i.z1)&&Kekule.ObjUtils.notUnset(i.z2)&&(n.z1=Math.max(r.z1,i.z1),n.z2=Math.min(r.z2,i.z2),n.z1>n.z2)?null:n},hasIntersection:function(e,t){return!!Kekule.BoxUtils.getIntersection(e,t)},isEqual:function(e,t){return Math.min(e.x1,e.x2)===Math.min(t.x1,t.x2)&&Math.max(e.x1,e.x2)===Math.max(t.x1,t.x2)&&Math.min(e.y1,e.y2)===Math.min(t.y1,t.y2)&&Math.max(e.y1,e.y2)===Math.max(t.y1,t.y2)},isInside:function(e,t){var r=e,i=t;return Math.min(r.x1,r.x2)>=Math.min(i.x1,i.x2)&&Math.max(r.x1,r.x2)<=Math.max(i.x1,i.x2)&&Math.min(r.y1,r.y2)>=Math.min(i.y1,i.y2)&&Math.max(r.y1,r.y2)<=Math.max(i.y1,i.y2)},getIntersectionState:function(e,t){var r=Kekule.BoxUtils,i=Kekule.IntersectionState;return r.isEqual(e,t)?i.EQUAL:r.isInside(e,t)?i.CONTAINED:r.isInside(t,e)?i.CONTAINING:r.hasIntersection(e,t)?i.OVERLAPPED:i.SEPARATED},getCenterCoord:function(e){var t={x:((e.x1||0)+(e.x2||0))/2,y:((e.y1||0)+(e.y2||0))/2};return(Kekule.ObjUtils.notUnset(e.z1)||Kekule.ObjUtils.notUnset(e.z2))&&(t.z=(e.z1||0+e.z2||0)/2),t},getMinMaxCoords:function(e){var t=Kekule.BoxUtils.normalize(e),r={min:{x:t.x1,y:t.y1},max:{x:t.x2,y:t.y2}};return Kekule.ObjUtils.notUnset(t.z1)&&(r.min.z=t.z1,r.max.z=t.z2),r},getCornerCoords:function(e){var t=Kekule.BoxUtils.normalize(e);return Kekule.ObjUtils.isUnset(t.z1)?[{x:t.x1,y:t.y1},{x:t.x1,y:t.y2},{x:t.x2,y:t.y1},{x:t.x2,y:t.y2}]:[{x:t.x1,y:t.y1,z:t.z1},{x:t.x1,y:t.y2,z:t.z1},{x:t.x2,y:t.y1,z:t.z1},{x:t.x2,y:t.y2,z:t.z1},{x:t.x1,y:t.y1,z:t.z2},{x:t.x1,y:t.y2,z:t.z2},{x:t.x2,y:t.y1,z:t.z2},{x:t.x2,y:t.y2,z:t.z2}]},transform2D:function(e,t){for(var r=Kekule.BoxUtils.getCornerCoords(e),i=[],n=0,o=r.length;n<o;++n)i.push(Kekule.CoordUtils.transform2D(r[n],t));return Kekule.CoordUtils.getContainerBox(i)},transform3D:function(e,t){for(var r=Kekule.BoxUtils.getCornerCoords(e),i=[],n=0,o=r.length;n<o;++n)i.push(Kekule.CoordUtils.transform3D(r[n],t));return Kekule.CoordUtils.getContainerBox(i)}},Kekule.RectUtils={createRect:function(e,t,r,i){return{left:e,top:t,width:r,height:i}},clone:function(e){return{left:e.left,top:e.top,width:e.width,height:e.height}},isZero:function(e){return 0===e.width&&0===e.height},convertToBox:function(e){var t=Kekule.CoordUtils.create(e.left,e.top),r=Kekule.CoordUtils.create(e.left+e.width,e.top+e.height);return Kekule.BoxUtils.createBox(t,r)},inflateRect:function(e,t,r){return Kekule.ObjUtils.isUnset(r)&&(r=t),Kekule.RectUtils.createRect(e.left,e.top,e.width+t,e.height+r)},shiftRect:function(e,t,r){var i=t||0,n=r||0;return Kekule.RectUtils.createRect(e.left+i,e.top+n,e.width,e.height)},getContainerRect:function(e,t){var r=Kekule.RectUtils.convertToBox(e),i=Kekule.RectUtils.convertToBox(t),n=Kekule.BoxUtils.getContainerBox(r,i);return Kekule.BoxUtils.convertToRect(n)},getIntersection:function(e,t){var r=Kekule.RectUtils.convertToBox(e),i=Kekule.RectUtils.convertToBox(t),n=Kekule.BoxUtils.getIntersection(r,i);return n?Kekule.BoxUtils.convertToRect(n):null},hasIntersection:function(e,t){return!!Kekule.RectUtils.getIntersection(e,t)}},Kekule.ZoomUtils={PREDEFINED_ZOOM_RATIOS:[.1,.3,.5,.66,.8,.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5,7,10,15,20],RATIO_INT_BASE:100,getNearestZoomLevel:function(e,t){var r=t||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS,i=r.length;if(e>r[i-1])return r[i-1];if(e<r[0])return r[0];for(var n=0;n<i-1;++n){var o=r[n],a=r[n+1];if(e>=o&&e<=a)return 1===o||1===a?1:(e-o)/(a-o)<=.5?o:a}},getNextZoomInRatio:function(e,t,r){t||(t=1);var i=r||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS,n=i.length,o=Math.round(e*Kekule.ZoomUtils.RATIO_INT_BASE);if(o<Math.round(i[n-1]*Kekule.ZoomUtils.RATIO_INT_BASE))for(var a=0;a<n;++a)if(Math.round(i[a]*Kekule.ZoomUtils.RATIO_INT_BASE)>o)return i[Math.min(a+t,n)-1];return e},getNextZoomOutRatio:function(e,t,r){t||(t=1);var i=r||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS,n=i.length,o=Math.round(e*Kekule.ZoomUtils.RATIO_INT_BASE);if(o>Math.round(i[0]*Kekule.ZoomUtils.RATIO_INT_BASE))for(var a=n-1;a>=0;--a)if(Math.round(i[a]*Kekule.ZoomUtils.RATIO_INT_BASE)<o)return i[Math.max(a-t+1,0)];return e}},Kekule.DomHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DomHelper",NAMESPACE_DEFINE_PREFIX:"xmlns",NAMESPACE_DELIMITER:":",XMLNS_URI:"http://www.w3.org/2000/xmlns/",ERR_EMPTY_DOC:"Document is empty",ERR_ELEMENT_NOTSET:"Element not set",initialize:function(e){this.tryApplySuper("initialize"),this._supportNsMethods=null,e&&this.setDocument(e)},initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("document");if(!e){var t=this.getPropStoreFieldValue("rootElement");e=t?t.ownerDocument:null}return e},setter:function(e){e!=this.getPropStoreFieldValue("document")&&(this.setPropStoreFieldValue("document",e),this.analysisRootElem())}}),this.defineProp("rootElement",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("rootElement");if(!e){var t=this.getPropStoreFieldValue("document");e=t?t.documentElement:null}return e},setter:function(e){this.setPropStoreFieldValue("rootElement",e),this.analysisRootElem()}}),this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("namespaces")||this.setPropStoreFieldValue("namespaces",[]),this.getPropStoreFieldValue("namespaces")}}),this.defineProp("defNamespaceURI",{dataType:DataType.STRING,serializable:!1}),this.defineProp("forceAnalysisDoc",{dataType:DataType.BOOL})},analysisRootElem:function(){this.setNamespaces([]),this.setDefNamespaceURI(null);var e=this.getRootElement();if(e){var t=e.ownerDocument;if(this._supportNsMethods=!!t.getElementsByTagNameNS,!this._supportNsMethods||this.getForceAnalysisDoc())for(var r=0,i=e.attributes.length;r<i;++r){var n=e.attributes[r],o=n.name;if(o&&o.indexOf(this.NAMESPACE_DEFINE_PREFIX)>=0){var a=n.value,s=o.indexOf(this.NAMESPACE_DELIMITER),l=s>=0?o.substring(s+1):null;this.getNamespaces().push({namespaceURI:a,prefix:l}),l||this.setDefNamespaceURI(a)}}}},_getEmptyDocErrorMsg:function(){return Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.EMPTY_DOC"):this.ERR_EMPTY_DOC},_getElementNotSetErrorMsg:function(){return Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.ELEMENT_NOTSET"):this.ELEMENT_NOTSET},assertDocAvailable:function(e){return!!e||(Kekule.raise(this._getEmptyDocErrorMsg()),!1)},assertElementAvailable:function(e){return!!e||(Kekule.raise(this._getElementNotSetErrorMsg()),!1)},getNsPrefix:function(e){if(e==this.getDefNamespaceURI())return"";for(var t=this.getNamespaces(),r=0,i=t.length;r<i;++r)if(t[r].namespaceURI==e)return t[r].prefix;return null},getQualifiedName:function(e,t){var r=this.getNsPrefix(e);return null===r?null:r?r+this.NAMESPACE_DELIMITER+t:t},addNamespace:function(e,t,r,i){i||(i=e.documentElement);var n=t?this.NAMESPACE_DEFINE_PREFIX+this.NAMESPACE_DELIMITER+t:this.NAMESPACE_DEFINE_PREFIX,o=this.XMLNS_URI;this.setAttributeNS(o,n,r,i)},createElementNS:function(e,t){var r=this.getDocument();return this.assertDocAvailable(r)?this._supportNsMethods?r.createElementNS(e,t):r.createElement(t):null},getElementsByTagNameNS:function(e,t,r){var i=this.getPropStoreFieldValue("document")||this.getPropStoreFieldValue("rootElement"),n=this.getDocument();if(!this.assertDocAvailable(n))return null;if(this._supportNsMethods)return e||(e="*"),r?r.getElementsByTagNameNS(e,t):i.getElementsByTagNameNS(e,t);var o=this.getQualifiedName(e,t);return null===o?[]:r?r.getElementsByTagName(o):i.getElementsByTagName(o)},getAttributeNodeNS:function(e,t,r){if(!this.assertElementAvailable(r))return null;if(this._supportNsMethods)return e||(e="*"),r.getAttributeNodeNS(e,t);var i=this.getQualifiedName(e,t);return null===i?null:r.getAttributeNode(i)},getAttributeNS:function(e,t,r){if(!this.assertElementAvailable(r))return null;if(this._supportNsMethods)return e||(e="*"),r.getAttributeNS(e,t);var i=this.getQualifiedName(e,t);return null===i?null:r.getAttribute(i)},setAttributeNS:function(e,t,r,i){if(!this.assertElementAvailable(i))return null;if(this._supportNsMethods)return i.setAttributeNS(e,t,r);var n=this.getQualifiedName(e,t);return null===n?null:i.setAttribute(n,r)}}),Kekule.DomUtils={namespaceMatched:function(e,t,r){return void 0===r&&(r=!0),e.namespaceURI==t||r&&!e.namespaceURI},isElement:function(e){return e&&e.tagName&&e.nodeType},getElementText:function(e){for(var t="",r=0,i=e.childNodes.length;r<i;++r)3==e.childNodes[r].nodeType&&(t+=e.childNodes[r].nodeValue);return t},setElementText:function(e,t,r){for(var i=0,n=e.childNodes.length;i<n;++i)if(3==e.childNodes[i].nodeType)return e.childNodes[i].nodeValue=t,t;var o=r?(t||"").split("\n"):[t||""];for(i=0,n=o.length;i<n;++i){if(i>0){var a=e.ownerDocument.createElement("br");e.appendChild(a)}var s=e.ownerDocument.createTextNode(o[i]);e.appendChild(s)}return t},getLocalName:function(e){return e.localName||e.baseName||e.nodeName},getChildNodesOfTypes:function(e,t){for(var r=[],i=Kekule.ArrayUtils.toArray(t),n=0,o=e.childNodes.length;n<o;++n){var a=e.childNodes[n];(!t||i.indexOf(a.nodeType)>=0)&&r.push(a)}return r},getFirstChildElem:function(e,t,r,i){for(var n=0,o=e.childNodes.length;n<o;++n){var a=e.childNodes[n];if(a.nodeType===Node.ELEMENT_NODE&&(t&&t.toLowerCase()===a.tagName.toLowerCase()||r&&r.toLowerCase()===Kekule.DomUtils.getLocalName(a).toLowerCase()||!t&&!r)&&(!i||Kekule.DomUtils.namespaceMatched(a,i)))return a}},getDirectChildElems:function(e,t,r,i){for(var n=[],o=0,a=e.childNodes.length;o<a;++o){var s=e.childNodes[o];s.nodeType===Node.ELEMENT_NODE&&(t&&t.toLowerCase()===s.tagName.toLowerCase()||r&&r.toLowerCase()===Kekule.DomUtils.getLocalName(s).toLowerCase()||!t&&!r)&&(i&&!Kekule.DomUtils.namespaceMatched(s,i)||n.push(s))}return n},getDirectChildElemsOfAttribValues:function(e,t,r,i,n){for(var o=Kekule.DomUtils.getDirectChildElems(e,r,i,n),a=[],s=0,l=o.length;s<l;++s){for(var u=!0,d=0,c=t.length;d<c;++d){var h=Kekule.ObjUtils.getOwnedFieldNames(t[d])[0];if(o[s].getAttribute(h)!=t[d][h]){u=!1;break}}u&&a.push(o[s])}return a},getParentNode:function(e,t){var r=t||{},i=e.parentNode;return i||(r.acrossShadowRoot&&e.host?e.host:null)},isDescendantOf:function(e,t,r){var i=r||{};try{if(e&&t){if(e.documentElement)return!1;if(e.ownerDocument===t)return!0;for(var n=Kekule.DomUtils.getParentNode,o=n(e,i);o;){if(o===t)return!0;o=n(o,i)}}return!1}catch(e){return!1}},isOrIsDescendantOf:function(e,t,r){return e===t||Kekule.DomUtils.isDescendantOf(e,t,r)},getNearestAncestorByTagName:function(e,t,r){var i=t.toLowerCase();if(r&&e.tagName&&e.tagName.toLowerCase()===i)return e;for(var n=e.parentNode;n&&n.tagName;){if(n.tagName.toLowerCase()===i)return n;n=n.parentNode}return null},getSameNSAttributeValue:function(e,t,r){return e.getAttribute(t)},setSameNSAttributeValue:function(e,t,r,i){return e.setAttribute(t,r)},fetchAttributeValuesToArray:function(e,t,r){for(var i=[],n=0,o=e.attributes.length;n<o;++n){var a=e.attributes[n];if(!t||Kekule.DomUtils.namespaceMatched(a,t,!0)){var s;if(r)try{s=Kekule.DomUtils.getLocalName(a)}catch(e){s=a.name}else s=a.name;i.push({name:s,value:a.value})}}return i},fetchAttributeValuesToJson:function(e,t,r){for(var i={},n=0,o=e.attributes.length;n<o;++n){var a=e.attributes[n];if(!t||Kekule.DomUtils.namespaceMatched(a,t,!0)){var s;if(r)try{s=Kekule.DomUtils.getLocalName(a)}catch(e){s=a.name}else s=a.name;i[s]=a.value}}return i},hasAttribute:function(e,t){return e.hasAttribute?e.hasAttribute(t):!!e.getAttribute(t)},isDataAttribName:function(e){return e.toString().startsWith("data-")},getDataAttribCoreName:function(e){return Kekule.DomUtils.isDataAttribName(e)?e.substr(5):null},getDataAttrib:function(e,t){return e.dataset?e.dataset[t]:e.getAttribute("data-"+t.toString().hyphenize())},setDataAttrib:function(e,t,r){e.dataset?e.dataset[t]=r:e.setAttribute("data-"+t.toString().hyphenize(),r)},getDataset:function(e){if(e.dataset)return e.dataset;for(var t={},r=e.attributes,i=0,n=r.length;i<n;++i){var o=r[i],a=o.name;0===a.toLowerCase().indexOf("data-")&&(t[a.substring(5).camelize()]=o.value)}return t},clearChildContent:function(e){for(var t=Kekule.ArrayUtils.toArray(e.childNodes),r=t.length-1;r>=0;--r){var i=t[r];i.nodeType!==Node.ATTRIBUTE_NODE&&e.removeChild(i)}return e},replaceTagName:function(e,t){if(e.tagName.toLowerCase()!==t.toLowerCase()){for(var r=e.ownerDocument.createElement(t),i=Kekule.DomUtils.fetchAttributeValuesToArray(e),n=0,o=i.length;n<o;++n)r.setAttribute(i[n].name,i[n].value);var a=Kekule.DomUtils.getDirectChildElems(e);for(n=0,o=a.length;n<o;++n)r.appendChild(a[n]);var s=e.parentNode,l=e.nextSibling;return s.removeChild(e),l?s.insertBefore(r,l):s.appendChild(r),r}return e},setElemAttributes:function(e,t){for(var r=Kekule.ObjUtils.getOwnedFieldNames(t),i=0,n=r.length;i<n;++i){var o=r[i],a=t[o];o&&a&&e.setAttribute(o,a)}return e},isInDomTree:function(e,t,r){var i=r||{};if(!e)return!1;if(t||(t=e.ownerDocument),t){if(!i.acrossShadowRoot&&e.getRootNode)return e.getRootNode()===t;var n=t.documentElement;return Kekule.DomUtils.isDescendantOf(e,n,r)||e===n}return!1},isInShadowRoot:function(e){if("undefined"==typeof ShadowRoot)return!1;try{return(e.getRootNode&&e.getRootNode())instanceof ShadowRoot}catch(e){return!1}}},Kekule.DataSrcAttribUtils={isUrlBasedValue:function(e){return 0===e.toLowerCase().indexOf("url(")},getUrl:function(e){var t=e.trim();if(0===t.toLowerCase().indexOf("url(")){var r=t.lastIndexOf(")");return t=t.substring(4,r)}return null},getElementContent:function(e){if(!e)return null;var t=e.innerHTML;return t=t.ltrim()},getElementMimeType:function(e){return e.getAttribute("type")}},Kekule.ScriptFileUtils={_existedScriptUrls:new Kekule.MapEx,appendScriptFile:function(e,t,r){var i;if(e){if((i=Kekule.ScriptFileUtils._existedScriptUrls.get(e))||(i=[],Kekule.ScriptFileUtils._existedScriptUrls.set(e,i)),i.indexOf(t)>=0)return void(r&&r(null));var n=e.createElement("script");return n.src=t,n.onerror=function(e){r&&r(e)},n.onload=n.onreadystatechange=function(e){if(!n._loaded){var o=n.readyState;void 0!==o&&"loaded"!==o&&"complete"!==o||(n._loaded=!0,n.onload=n.onreadystatechange=null,i.push(t),r&&r(null))}},(e.getElementsByTagName("head")[0]||e.body).appendChild(n),n}var o=Kekule.$jsRoot.__$kekule_scriptfile_utils__;if(o&&o.appendScriptFile)return o.appendScriptFile(e,t,r)},appendScriptFiles:function(e,t,r){var i=[].concat(t),n=function(e,t,r,i){if(t.length<=0)r&&(i.length?r(new Error("Error in loading: "+i.join("; "))):r(null));else{var o=t.shift();Kekule.ScriptFileUtils.appendScriptFile(e,o,function(a){a&&i.push(o+": "+a?a.message||a:""),n(e,t,r,i)})}};n(e,i,r,[])}},function(){"use strict";Kekule.ExternalResourceType={JS_OBJ:"jsObject",STYLESHEET:"stylesheet",DATA:"data",OTHER:"other"},Kekule.ExternalResourceType.DEFAULT=Kekule.ExternalResourceType.JS_OBJ,Kekule.ExternalResourceManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExternalResourceManager",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("resources",{})},doFinalize:function(){this.setPropStoreFieldValue("resources",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("resources",{dataType:DataType.HASH,serializable:!1,setter:null})},register:function(e,t,r,i){var n=this.getResources();n[e]&&this.unregister(e),n[e]={name:e,resource:t,resourceType:r||Kekule.ExternalResourceType.DEFAULT},this.invokeEvent("resourceRegistered",{name:e,resource:t,resourceType:r}),this.invokeEvent(e+"Registered",{name:e,resource:t,resourceType:r})},unregister:function(e){var t=this.getResources();if(t[e]){var r=t[e];this.invokeEvent("resourceUnregistered",r),this.invokeEvent(e+"Unregistered",r),delete t[e]}},getResourceDetails:function(e){return this.getResources()[e]},getResource:function(e){var t=this.getResourceDetails(e);return t&&t.resource}}),Kekule.ClassUtils.makeSingleton(Kekule.ExternalResourceManager),Kekule.externalResourceManager=Kekule.ExternalResourceManager.getInstance()}(),function(){"use strict";Kekule.Unit={ALL:{},_KEY_MAP:{},register:function(t,r,i,n,o){var a=e[i];a||(a=e._createCategoryObj(i),e[i]=a);var s=r.toUpperCase();return a[s]=e._createUnitObj(t,r,a,n,o),1===n&&a.setStandardUnit(a[s]),e.ALL[s]=a[s],e._KEY_MAP[a[s].getKey()]=a[s],a[s]},unregister:function(t){var r=e.getUnit(t);if(r){var i=r.getKey().toUpperCase();delete e.ALL[i],delete e._KEY_MAP[i],delete r.category[i]}},getUnit:function(t,r){if("object"==typeof t)return t.getKey?t:null;var i=e._KEY_MAP[t];if(!i&&r)for(var n=t.toLowerCase(),o=Kekule.ObjUtils.getOwnedFieldNames(e._KEY_MAP),a=0,s=o.length;a<s;++a)if(n===o[a].toLowerCase()){i=e._KEY_MAP[o[a]];break}return i},getUnitByName:function(t,r){for(var i=Kekule.ObjUtils.getOwnedFieldNames(e._KEY_MAP),n=r&&t.toLowerCase(),o=0,a=i.length;o<a;++o){var s=e._KEY_MAP[i[o]],l=s.name;if(t===l||r&&n===l.toLowerCase())return s}return null},_createCategoryObj:function(t){var r=Object.create(e._categoryObjProto);return r.name=t,r},_createUnitObj:function(e,t,r,i,n){var o=Object.create(Kekule.Unit._unitObjProto);return Object.extend(o,{symbol:e,name:t,category:r,rateToStandard:i}),n&&Object.extend(o,n),o}};var e=Kekule.Unit;Kekule.Unit._categoryObjProto={getName:function(){return this.name},getStandardUnit:function(){return this._standardUnit},setStandardUnit:function(e){this._standardUnit=e},getUnitsOf:function(e){for(var t=Kekule.ObjUtils.getOwnedFieldNames(this,!1),r=[],i=0,n=t.length;i<n;++i)if("_standardUnit"!==t[i]){var o=this[t[i]];Kekule.ObjUtils.getPrototypeOf(o)!==Kekule.Unit._unitObjProto||e&&!e(o)||r.push(o)}return r},getAllUnits:function(){return this.getUnitsOf()},getConvertableUnits:function(){return this.getUnitsOf(function(e){return!!e.rateToStandard})}},Kekule.Unit._unitObjProto={getKey:function(){return this.symbol||this.name},isStandard:function(){return 1===this.rateToStandard},canConvertValueTo:function(e,t){return e.category===this.category},convertValueTo:function(t,r,i){var n="string"==typeof r?e.getUnit(r):r;if(n)return this.doConvertValueTo(t,n,i);Kekule.error(Kekule.$L("ErrorMsg.UNIT_NOT_FOUND").format(r.symbol||r.name||r))},convertValueFromStandard:function(e,t){var r=this.category.getStandardUnit();if(r)return this._convFromStandard?this._convFromStandard(e,t):r.convertValueTo(e,this,t);Kekule.error(Kekule.$L("ErrorMsg.STANDARD_UNIT_OF_CATEGORY_NOT_FOUND").format(this.category.name))},convertValueToStandard:function(e,t){return this.convertValueToStandardEx(e,t).value},convertValueToStandardEx:function(e,t){var r=this.category.getStandardUnit();if(r)return{value:this._convToStandard?this._convToStandard(e,t):this.convertValueTo(e,r,t),unit:r};Kekule.error(Kekule.$L("ErrorMsg.STANDARD_UNIT_OF_CATEGORY_NOT_FOUND").format(this.category.name))},doConvertValueTo:function(e,t,r){if(t===this)return e;if(this.canConvertValueTo(t,r)){var i=t.rateToStandard,n=this.rateToStandard;if(i&&n)return e*n/i;var o=n||this._convToStandard,a=i||t._convFromStandard;if(o&&a){var s=this.convertValueToStandard(e,r);return t.convertValueFromStandard(s,r)}Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_CONVERT_BETWEEN_UNITS").format(this.getKey(),t.getKey()))}else Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_CONVERT_BETWEEN_UNITS").format(this.getKey(),t.getKey()))}},Kekule.UnitUtils={convertValue:function(t,r,i,n){return e.getUnit(r).convertValueTo(t,i,n)}};var t=e.register;t("unk","Unknown","Unknown",null),t("","counts","Counts",1),t("arb","arbitrary","Arbitrary",null),t("","one","Dimensionless",1),t("%","percent","Dimensionless",.01),t("‰","thousandth","Dimensionless",.001),t("ppm","parts_per_million","Dimensionless",1e-6),t("pH","pH","AcidicScake",1),t("sec","second","Time",1),t("hr","hour","Time",3600),t("min","minute","Time",60),t("ms","millisecond","Time",.001),t("μs","microsecond","Time",1e-6),t("ns","nanosecond","Time",1e-9),t("m","meter","Length",1),t("cm","centimeter","Length",.01),t("mm","millimeter","Length",.001),t("μm","micrometer","Length",1e-6),t("nm","nanometer","Length",1e-9),t("Å","Angstrom","Length",1e-10),t("A-1","Angstrom-1","InverseLength",1e10,{symbolHtml:"A<sup>-1</sup>"}),t("A","ampere","ElectricCurrent",1),t("μA","microampere","ElectricCurrent",1e-6),t("nA","nanoampere","ElectricCurrent",1e-9),t("pA","picoampere","ElectricCurrent",1e-12),t("kg","kilogram","Mass",1),t("g","gram","Mass",.001),t("K","kelvin","Temperature",1),t("℃","Celsius","Temperature",null,{_convToStandard:function(e){return e+273.15},_convFromStandard:function(e){return e-273.15}}),t("mol","mole","AmountOfSubstance",1),t("cd","candela","LuminousIntensity",1),t("rad","radian","Angle",1),t("deg","degree","Angle",.01745329,{symbolHtml:"°"}),t("sr","steradian","SolidAngle",1),t("Hz","Hertz","Frequency",1),t("kHz","kilohertz","Frequency",1e3),t("MHz","megahertz","Frequency",1e6),t("N","Newton","Force",1),t("kcal/Å","kilocalorie_per_angstrom","Force",null),t("J","Joule","Energy",1),t("cal","calorie","Energy",4.184),t("kcal","kilocalorie","Energy",4184),t("kcal/rad","kilocalorie_per_radian","Energy",null),t("eV","electron_volt","Energy",1.60217733e-19),t("hart","Hartree","Energy",4.3597482e-18),t("W","Watt","Power",1),t("Pa","Pascal","Pressure",1),t("GPa","gigaPascal","Pressure",1e9),t("bar","Bar","Pressure",1e5),t("kbar","kbar","Pressure",1e8),t("atm","Atmosphere","Pressure",101325.027),t("GPa-1","gigaPascal-1","InversePressure",1e-9,{symbolHtml:"GPa<sup>-1</sup>"}),t("C","Coulomb","ElectricCharge",1),t("e","electron_charge","ElectricCharge",1.60217733e-19),t("V","Volt","ElectricPotentialDifference",1),t("Ω","Ohm","ElectricResistance",1),t("F","Farad","ElectricCapacitance",1),t("S","Siemens","ElectricConductance",1),t("Wb","Weber","MagneticFlux",1),t("T","Tesla","MagneticFluxDensity",1),t("H","Henry","MagneticInductance",1),t("Bq","Becquerel","Radioactivity",1),t("Gy","Gray","RadioactiveAbsorbedDose",1),t("Sv","Sievert","RadioactiveEquivalentDose",1),t("kat","Katal","CatalyticActivity",1),t("cp","Centipoise","DynamicVicosity",null),t("mol/L","Molarity","Molarity",1),t("mol/kg","Molality","Molality",1),t("m2","Square_meter","Area",1,{symbolHtml:"m<sup>2</sup>"}),t("cm2","centimeter_squared","Area",1e-4,{symbolHtml:"cm<sup>2</sup>"}),t("m3","Cubic_meter","Volume",1,{symbolHtml:"m<sup>3</sup>"}),t("Å3","Angstrom_cubed","Volume",1e-30,{symbolHtml:"Å<sup>3</sup>"}),t("L","litre","Volume",.001),t("mL","millilitre","Volume",1e-6),t("m/s","Meter_per_second","Velocity",1),t("km/s","kilometers_per_second","Velcity",1e3),t("m·s-2","Meter_per_second_squared","Acceleration",1,{symbolHtml:"m·s<sup>-2</sup>"}),t("rad/s","radian_per_second","AngularVelocity",1),t("N·s","newton_second","Momentum",1),t("N·m·s","newton_meter_second","AngularMomentum",1),t("N·m","newton_meter","Torque",1),t("m-1","reciprocal_meter","WaveNumber",1,{symbolHtml:"m<sup>-1</sup>"}),t("cm-1","reciprocal_centimeter","WaveNumber",100,{symbolHtml:"cm<sup>-1</sup>"}),t("kg·m-3","Kilogram_per_cubic_meter","MassDensity",1,{symbolHtml:"kg·m<sup>-3</sup>"}),t("kg-1·m3","cubic_meter_per_kilogram","SpecificVolume",1,{symbolHtml:"kg<sup>-1</sup>·m<sup>3</sup>"}),t("m-3·mol","mole_per_cubic_meter","AmountConcentration",1,{symbolHtml:"m<sup>-3</sup>·mol"}),t("m3/mol","cubic_meter_per_mole","MolarVolume",1,{symbolHtml:"m<sup>3</sup>/mol"}),t("J/K","joule_per_kelvin","HeatCapacity",1),t("J·K-1·mol-1","joule_per_kelvin_mole","MolarHeatCapacity",1,{symbolHtml:"J·K<sup>-1</sup>·mol<sup>-1</sup>"}),t("J·K-1·kg-1","joule_per_kilogram_kelvin","SpecificHeatCapacity",1,{symbolHtml:"J·K<sup>-1</sup>·kg<sup>-1</sup>"}),t("J/mol","joule_per_mole","MolarEnergy",1),t("J/kg","joule_per_kilogram","SpecificEnergy",1),t("J·m-3","joule_per_cubic_meter","EnergyDensity",1,{symbolHtml:"J·m<sup>-3</sup>"}),t("N/m","newton_per_meter","SurfaceTension",1),t("W·m-2","watt_per_square_meter","HeatFluxDensity",1,{symbolHtml:"W·m<sup>-2</sup>"}),t("W·m-1·K-1","watt_per_meter_kelvin","ThermalConductivity",1,{symbolHtml:"W·m<sup>-1</sup>·K<sup>-1</sup>"}),t("m2/s","square_meter_per_second","KinematicViscosity",1,{symbolHtml:"m<sup>2</sup>/s"}),t("Pa·s","Pascal_second","DynamicViscosity",1),t("C·m-3","coulomb_per_cubic_meter","ElectricChargeDensity",1,{symbolHtml:"C·m<sup>-3</sup>"}),t("A·m-2","ampere_per_square_meter","ElectricCurrentDensity",1,{symbolHtml:"A·m<sup>-2</sup>"}),t("S/m","siemens_per_meter","ElectricalConductivity",1),t("S·m2/mol","siemens_square_meter_per_mole","MolarConductivity",1,{symbolHtml:"S·m<sup>2</sup>/mol"}),t("F/m","farad_per_meter","Permittivity",1),t("H/m","henry_per_meter","Permeability",1),t("V/m","volt_per_meter","ElectricFieldStrength",1),t("A/m","ampere_per_meter","MagneticFieldStrength",1),t("cd·m-2","candela_per_square_meter","Luminance",1,{symbolHtml:"cd·m<sup>-2</sup>"}),t("C/kg","coulomb_per_kilogram","Exposure",1),t("Gy/s","gray_per_second","AbsorbedDoseRate",1),t("J/m","joule_per_meter","EnergyLengthGradient",1),t("kj/mol","kj_per_mole","MolarEnergy",1e3),t("D","debye","Dipole",3.335641e-30)}(),Kekule.AbstractConfigs=Class.create(ObjectEx,{CLASS_NAME:"Kekule.AbstractConfigs",CONFIG_PROP_FLAG:"__$config_prop__",initialize:function(e){this.tryApplySuper("initialize"),void 0===e&&(e=!0),e&&this.initPropDefValues()},addConfigProp:function(e,t,r,i){var n={dataType:t};i&&(n=Object.extend(n,i)),void 0!==r&&(n.defaultValue=r);var o=this.defineProp(e,n);return o[this.CONFIG_PROP_FLAG]=!0,o},addHashConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.HASH,t,r)},addStrConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.STRING,t,r)},addNumConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.NUM,t,r)},addIntConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.INT,t,r)},addFloatConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.FLOAT,t,r)},addBoolConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.BOOL,t,r)},initPropDefValues:function(){this.beginUpdate();try{for(var e=this.getAllPropList(),t=0,r=e.getLength();t<r;++t){var i=e.getPropInfoAt(t),n=i.name,o=i.defaultValue;void 0!==o&&this.setPropValue(n,o)}}finally{this.endUpdate()}},isConfigProp:function(e){return!!e[this.CONFIG_PROP_FLAG]},assign:function(e){e.copyPropsTo(this)},doTransformPropNameToHash:function(e){return this.doGetPropNameToHashPrefix()+e},doGetPropNameToHashPrefix:function(){return""},toHash:function(e){var t={},r=this.CONFIG_PROP_FLAG;this.saveObj(t,"json",{saveDefaultValues:!0,propFilter:function(e,t){return e[r]}});for(var i=e||this.doTransformPropNameToHash.bind(this),n={},o=Kekule.ObjUtils.getOwnedFieldNames(t,!1),a=0,s=o.length;a<s;++a){n[i(o[a])]=t[o[a]]}return n}}),Kekule.ConfigPresetMap=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ConfigPresetMap",initialize:function(){this.tryApplySuper("initialize"),this.map=new Kekule.MapEx(!0)},doFinalize:function(){this.map=null,this.tryApplySuper("doFinalize")},set:function(e,t){this.map.set(e,t)},get:function(e){return this.map.get(e)},getHash:function(e){var t=this.get(e);return t?t.toHash?t.toHash():t:null},remove:function(e){this.map.remove(e)},has:function(e){return this.map.has(e)},clear:function(){this.map.clear()}}),Kekule.ElementSeries={NONMETAL:"Nonmetals",METAL:"Metals",ALKALI_METAL:"Alkali Metals",ALKALI_EARTH_METAL:"Alkali Earth Metals",TRANSITION_METAL:"Transition Metals",METALLOID:"Metalloids",HALOGEN:"Halogens",NOBLE_GAS:"Noble Gases",LANTHANIDE:"Lanthanides",ACTINIDE:"Actinides"},Kekule.ElementCategory={NONMETAL:1,METAL:21,ALKALI_METAL:22,ALKALI_EARTH_METAL:23,TRANSITION_METAL:24,METALLOID:11,HALOGEN:3,NOBLE_GAS:2,LANTHANIDE:25,ACTINIDE:26},Kekule.Element=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Element",initialize:function(e){if(this.tryApplySuper("initialize"),e!=Kekule.Element.UNSET_ELEMENT){var t=this.getElementInfo(e);t?(this.setPropStoreFieldValue("symbol",t.symbol),this.setPropStoreFieldValue("atomicNumber",t.atomicNumber),this.setPropStoreFieldValue("group",t.group),this.setPropStoreFieldValue("period",t.period),this.setPropStoreFieldValue("series",t.chemicalSerie),this.setPropStoreFieldValue("naturalMass",t.naturalMass),this.setPropStoreFieldValue("categories",this._getElementCategoriesFromSeries(t.chemicalSerie)),t.name&&this.setPropStoreFieldValue("name",t.name)):Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.INVALID_CHEMELEMENT")+": "+e:"Invalid chemical element: "+e)}else this.setPropStoreFieldValue("symbol",Kekule.Element.UNSET_ELEMENT),this.setPropStoreFieldValue("atomicNumber",Kekule.Element.UNSET_ELEMENT)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("atomicNumber",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("symbol",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("group",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("period",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("series",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("categories",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("naturalMass",{dataType:DataType.FLOAT,serializable:!1,setter:null})},getElementInfo:function(e){return e==Kekule.Element.UNSET_ELEMENT?{symbol:Kekule.Element.UNSET_ELEMENT,atomicNumber:Kekule.Element.UNSET_ELEMENT}:Kekule.Element.isDummyElement(e)?{symbol:Kekule.Element.DUMMY_ELEMENT,atomicNumber:Kekule.Element.DUMMY_ELEMENT_ATOMICNUM}:Kekule.Element.isRGroup(e)?{symbol:Kekule.Element.RGROUP_ELEMENT,atomicNumber:Kekule.Element.RGROUP_ELEMENT_ATMOICNUM}:Kekule.ChemicalElementsDataUtil.getElementInfo(e)},_getElementCategoriesFromSeries:function(e){var t=Kekule.ElementSeries,r=Kekule.ElementCategory,i=[];switch(e){case t.NONMETAL:i=[r.NONMETAL];break;case t.METAL:i=[r.METAL];break;case t.ALKALI_METAL:i=[r.METAL,r.ALKALI_METAL];break;case t.ALKALI_EARTH_METAL:i=[r.METAL,r.ALKALI_EARTH_METAL];break;case t.TRANSITION_METAL:i=[r.METAL,r.TRANSITION_METAL];break;case t.METALLOID:i=[r.METALLOID];break;case t.HALOGEN:i=[r.NONMETAL,r.HALOGEN];break;case t.NOBLE_GAS:i=[r.NONMETAL,r.NOBLE_GAS];break;case t.LANTHANIDE:i=[r.METAL,r.LANTHANIDE];break;case t.ACTINIDE:i=[r.METAL,r.ACTINIDE]}return i},getTheoreticValence:function(){return this.getGroup()?Kekule.Element.getTheoreticValenceOfGroup(this.getGroup()):null},isDummyElement:function(){return this.getAtomicNumber()==Kekule.Element.DUMMY_ELEMENT_ATOMICNUM},isRGroupElement:function(){return this.getAtomicNumber()==Kekule.Element.RGROUP_ELEMENT_ATMOICNUM},isNormalElement:function(){return Kekule.Element.isNormalElement(this.getAtomicNumber())},isSameElement:function(e){return e==Kekule.Element.UNSET_ELEMENT?this.getAtomicNumber()==Kekule.Element.UNSET_ELEMENT:"number"==typeof e?this.getAtomicNumber()==e:this.getSymbol()==e},isHetero:function(){return(this.getSeries()===Kekule.ElementSeries.NONMETAL||this.getSeries()===Kekule.ElementSeries.HALOGEN)&&6!==this.getAtomicNumber()&&1!==this.getAtomicNumber()},belongToCategory:function(e){return(this.getCategories()||[]).indexOf(e)>=0},getLabel:function(){return this.getSymbol()}}),Object.extend(Kekule.Element,Kekule.ChemicalElementsDataUtil),Kekule.Element.UNSET_ELEMENT=void 0,Kekule.Element.DUMMY_ELEMENT="DU",Kekule.Element.DUMMY_ELEMENT_ATOMICNUM=-1,Kekule.Element.RGROUP_ELEMENT="R",Kekule.Element.RGROUP_ELEMENT_ATOMICNUM=-2,Kekule.Element.DEUTERIUM="D",Kekule.Element.isNormalElement=function(e){return e!=Kekule.Element.UNSET_ELEMENT&&!Kekule.Element.isPseudoElement(e)},Kekule.Element.isPseudoElement=function(e){return"string"==typeof e?e==Kekule.Element.DUMMY_ELEMENT||e==Kekule.Element.RGROUP_ELEMENT:e==Kekule.Element.DUMMY_ELEMENT_ATOMICNUM||e==Kekule.Element.RGROUP_ELEMENT_ATMOICNUM},Kekule.Element.isDummyElement=function(e){return e===Kekule.Element.DUMMY_ELEMENT||e===Kekule.Element.DUMMY_ELEMENT_ATOMICNUM},Kekule.Element.isRGroup=function(e){return e===Kekule.Element.RGROUP_ELEMENT||e===Kekule.Element.RGROUP_ELEMENT_ATOMICNUM},Kekule.Element.getTheoreticValenceOfGroup=function(e){return e<=2?e:e<=12?null:e<=17?e-10:0},Kekule.Element.getTheoreticValence=function(e){var t=Kekule.ChemicalElementsDataUtil.getElementInfo(e);return t.group?Kekule.Element.getTheoreticValenceOfGroup(t.group):null},Object.extend(Kekule.Element,{isAtomicNumberAvailable:function(e){return Kekule.ChemicalElementsDataUtil.isAtomicNumberAvailable(e)},isElementSymbolAvailable:function(e){return Kekule.ChemicalElementsDataUtil.isElementSymbolAvailable(e)}}),Kekule.Isotope=Class.create(Kekule.Element,{CLASS_NAME:"Kekule.Isotope",initialize:function(e,t){var r=e,i=t,n=Kekule.IsotopesDataUtil.getIsotopeInfo(e,t);if(n&&(n.atomicNumber&&(r=n.atomicNumber),i=n.massNumber),this.tryApplySuper("initialize",[r]),this.setPropStoreFieldValue("massNumber",i),n&&n.isotopeAlias&&this.setPropStoreFieldValue("isotopeAlias",n.isotopeAlias),Kekule.Element.isNormalElement(r)&&i!==Kekule.Isotope.UNSET_MASSNUMBER){var o=Kekule.IsotopesDataUtil.getIsotopeInfo(this.getAtomicNumber(),i);o?(this.setPropStoreFieldValue("exactMass",o.exactMass),this.setPropStoreFieldValue("naturalAbundance",o.naturalAbundance)):Kekule.chemError((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.INVALID_ISOTOPE"):"Invalid isotope")+": "+this.getSymbol()+"/"+t)}},initProperties:function(){this.defineProp("massNumber",{dataType:DataType.INTEGER,serializable:!1,setter:null}),this.defineProp("exactMass",{dataType:DataType.FLOAT,serializable:!1,setter:null}),this.defineProp("naturalAbundance",{dataType:DataType.FLOAT,serializable:!1,setter:null}),this.defineProp("isotopeAlias",{dataType:DataType.STRING,serializable:!1,setter:null})},isSame:function(e){return e instanceof Kekule.Isotope&&(e===this||e.getAtomicNumber()==this.getAtomicNumber()&&e.getMassNumber()==this.getMassNumber())},getIsotopeId:function(){return Kekule.IsotopesDataUtil.getIsotopeId(this.getAtomicNumber(),this.getMassNumber())},getLabel:function(){return""+(this.getMassNumber()||"")+this.getSymbol()}}),Object.extend(Kekule.Isotope,Kekule.IsotopesDataUtil),Kekule.Isotope.UNSET_MASSNUMBER=void 0,Kekule.Isotope.getIsotopeId=function(e,t){return Kekule.IsotopesDataUtil.getIsotopeId(e,t)},Object.extend(Kekule.Isotope,{isMassNumberAvailable:function(e,t){return Kekule.IsotopesDataUtil.isMassNumberAvailable(e,t)}}),Kekule.IsotopeFactory={GENERIC_ELEMENT_ID:"__GENERIC__",_isotopes:{},getIsotopeId:function(e,t){return e?Kekule.IsotopesDataUtil.getIsotopeId(e,t):Kekule.IsotopeFactory.GENERIC_ELEMENT_ID},getIsotope:function(e,t){var r=Kekule.IsotopeFactory.getIsotopeId(e,t);if(!Kekule.IsotopeFactory._isotopes[r]){var i=new Kekule.Isotope(e,t);Kekule.IsotopeFactory._isotopes[r]=i}return Kekule.IsotopeFactory._isotopes[r]},getIsotopeById:function(e){if(Kekule.IsotopeFactory._isotopes[e])return Kekule.IsotopeFactory._isotopes[e];var t=Kekule.IsotopesDataUtil.getIsotopeIdDetail(e);return t?Kekule.IsotopeFactory.getIsotope(t.symbol,t.massNumber):null}},Kekule.AtomType={UNSET_ATOMTYPE:void 0},Kekule.ElectronSet=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ElectronSet",initialize:function(e){this.tryApplySuper("initialize"),this.setElectronCount(e||Kekule.ElectronSet.UNSET_ELECTRONCOUNT)},initProperties:function(){this.defineProp("electronCount",{dataType:DataType.FLOAT})}}),Kekule.ElectronSet.UNSET_ELECTRONCOUNT=null,Kekule.UnbondedElectronSet=Class.create(Kekule.ElectronSet,{CLASS_NAME:"Kekule.UnBondedElectronSet",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){}}),Kekule.BondType={COVALENT:"covalent",IONIC:"ionic",COORDINATE:"coordinate",METALLIC:"metallic",HYDROGEN:"hydrogen",TRANSITION:"transition",UNKNOWN:null,DEFAULT:"covalent"},Kekule.BondOrder={SINGLE:1,DOUBLE:2,TRIPLE:3,QUAD:4,EXPLICIT_AROMATIC:10,OTHER:20,UNSET:null,DEFAULT:1,getBondValence:function(e){return e===Kekule.BondOrder.UNSET?0:e==Kekule.BondOrder.EXPLICIT_AROMATIC?1.5:e}},Kekule.BondForm=Class.create(Kekule.ElectronSet,{CLASS_NAME:"Kekule.BondForm",initialize:function(e,t,r){this.tryApplySuper("initialize",[t]),this.setBondOrder(e||Kekule.BondOrder.DEFAULT),Kekule.ObjUtils.notUnset(r)&&this.setBondType(r),Kekule.ObjUtils.notUnset(t)&&this.setElectronCount(t)},initProperties:function(){this.defineProp("bondType",{dataType:DataType.STRING,enumSource:Kekule.BondType,getter:function(){var e=this.getPropStoreFieldValue("bondType");return e||Kekule.BondType.DEFAULT}}),this.defineProp("bondOrder",{dataType:DataType.FLOAT,enumSource:Kekule.BondOrder,setter:function(e){this.getPropStoreFieldValue("bondOrder")!=e&&(this.setPropStoreFieldValue("bondOrder",e),e?this.getBondType()==Kekule.BondType.COVALENT&&this.setElectronCount(2*this.getBondValence()):e===Kekule.BondOrder.UNSET&&this.setElectronCount(Kekule.ElectronSet.UNSET_ELECTRONCOUNT))}}),this.defineProp("electronCount",{dataType:DataType.FLOAT}),this.defineProp("bondValence",{dataType:DataType.FLOAT,serializable:!1,getter:function(){return Kekule.BondOrder.getBondValence(this.getBondOrder())},setter:null})}}),Kekule.BondFormFactory={_bondForms:{},getBondFormId:function(e,t,r){var i="";return r&&(i+=r+"_"),e&&(i+=Number(e).toString()),t&&(i+="_"+Number(t).toString()),i},getBondForm:function(e,t,r){if(e||t||r){if(r||(r=Kekule.BondType.DEFAULT),!t&&e&&r===Kekule.BondType.COVALENT)t=2*Kekule.BondOrder.getBondValence(e);var i=Kekule.BondFormFactory.getBondFormId(e,t,r);return Kekule.BondFormFactory._bondForms[i]||(Kekule.BondFormFactory._bondForms[i]=new Kekule.BondForm(e,t,r)),Kekule.BondFormFactory._bondForms[i]}}},Kekule.RadicalOrder={NONE:0,SINGLET:1,DOUBLET:2,TRIPLET:3,DEFAULT:0,getRadicalElectronCount:function(e){var t=Kekule.RadicalOrder;return Kekule.ObjUtils.isUnset(e)||e===t.NONE?0:e===t.DOUBLET?1:2}},Kekule.HybridizationType={UNKNOWN:null,SP:1,SP2:2,SP3:3,NONE:0},Kekule.ValenceUtils={getPossibleMdlValenceInfo:function(e,t){var r=Math.round(t),i=[],n=0,o=!1;switch(e){case 1:case 3:case 11:case 19:case 37:case 55:case 87:0===r?i=[1]:1===r?i=[0]:o=!0,n=1;break;case 4:case 12:case 20:case 38:case 56:case 88:switch(r){case 0:i=[2];break;case 1:i=[1];break;case 2:i=[0];break;default:o=!0}n=2;break;case 5:switch(r){case-4:i=[1];break;case-3:i=[2];break;case-2:i=[3,5];break;case-1:i=[4];break;case 0:i=[3];break;case 1:i=[2];break;case 2:i=[1];break;case 3:i=[0];break;default:o=!0}n=3;break;case 6:switch(r){case-4:i=[0];break;case-3:i=[1];break;case-2:i=[2];break;case-1:i=[3,5];break;case 0:i=[4];break;case 1:i=[3];break;case 2:i=[2];break;case 3:i=[1];break;case 4:i=[0];break;default:o=!0}n=4;break;case 7:switch(r){case-3:i=[0];break;case-2:i=[1];break;case-1:i=[2];break;case 0:i=[3,5];break;case 1:i=[4];break;case 2:i=[3];break;case 3:i=[2];break;case 4:i=[1];break;case 5:i=[0];break;default:o=!0}n=5;break;case 8:switch(r){case-2:i=[0];break;case-1:i=[1];break;case 0:i=[2];break;case 1:i=[3,5];break;case 2:i=[4];break;case 3:i=[3];break;case 4:i=[2];break;case 5:i=[1];break;case 6:i=[0];break;default:o=!0}n=6;break;case 9:switch(r){case-1:i=[0];break;case 0:i=[1];break;case 1:i=[2];break;case 2:i=[3,5];break;case 3:i=[4];break;case 4:i=[3];break;case 5:i=[2];break;case 6:i=[1];break;case 7:i=[0];break;default:o=!0}n=7;break;case 13:switch(r){case-4:i=[1,3,5,7];break;case-3:i=[2,4,6];break;case-2:i=[3,5];break;case-1:i=[4];break;case 0:i=[3];break;case 1:i=[2];break;case 2:i=[1];break;case 3:i=[0];break;default:o=!0}n=3;break;case 14:switch(r){case-4:i=[0];break;case-3:i=[1,3,5,7];break;case-2:i=[2,4,6];break;case-1:i=[3,5];break;case 0:i=[4];break;case 1:i=[3];break;case 2:i=[2];break;case 3:i=[1];break;case 4:i=[0]}n=4;break;case 15:switch(r){case-3:i=[0];break;case-2:i=[1,3,5,7];break;case-1:i=[2,4,6];break;case 0:i=[3,5];break;case 1:i=[4];break;case 2:i=[3];break;case 3:i=[2];break;case 4:i=[1];break;case 5:i=[0]}n=5;break;case 16:switch(r){case-2:i=[0];break;case-1:i=[1,3,5,7];break;case 0:i=[2,4,6];break;case 1:i=[3,5];break;case 2:i=[4];break;case 3:i=[3];break;case 4:i=[2];break;case 5:i=[1];break;case 6:i=[0]}n=6;break;case 17:switch(r){case-1:i=[0];break;case 0:i=[1,3,5,7];break;case 1:i=[2,4,6];break;case 2:i=[3,5];break;case 3:i=[4];break;case 4:i=[3];break;case 5:i=[2];break;case 6:i=[1];break;case 7:i=[0]}n=7;break;case 31:switch(r){case-4:i=[1,3,5,7];break;case-3:i=[2,4,6];break;case-2:i=[3,5];break;case-1:i=[4];break;case 0:i=[3];break;case 2:i=[1];break;case 3:i=[0];break;default:o=!0}n=3;break;case 32:switch(r){case-4:i=[0];break;case-3:i=[1,3,5,7];break;case-2:i=[2,4,6];break;case-1:i=[3,5];break;case 0:i=[4];break;case 1:i=[3];break;case 3:i=[1];break;case 4:i=[0]}n=4;break;case 33:switch(r){case-3:i=[0];break;case-2:i=[1,3,5,7];break;case-1:i=[2,4,6];break;case 0:i=[3,5];break;case 1:i=[4];break;case 2:i=[3];break;case 4:i=[1];break;case 5:i=[0]}n=5;break;case 34:switch(r){case-2:i=[0];break;case-1:i=[1,3,5,7];break;case 0:i=[2,4,6];break;case 1:i=[3,5];break;case 2:i=[4];break;case 3:i=[3];break;case 5:i=[1];break;case 6:i=[0]}n=6;break;case 35:switch(r){case-1:i=[0];break;case 0:i=[1,3,5,7];break;case 1:i=[2,4,6];break;case 2:i=[3,5];break;case 3:i=[4];break;case 4:i=[3];break;case 6:i=[1];break;case 7:i=[0]}n=7;break;case 49:switch(r){case-4:i=[1,3,5,7];break;case-3:i=[2,4,6];break;case-2:i=[3,5];break;case-1:i=[4];break;case 0:i=[3];break;case 2:i=[1];break;case 3:i=[0];break;default:o=!0}n=3;break;case 50:case 82:switch(r){case-4:i=[0];break;case-3:i=[1,3,5,7];break;case-2:i=[2,4,6];break;case-1:i=[3,5];break;case 0:i=[2,4];break;case 1:i=[3];break;case 3:i=[1];break;case 4:i=[0]}n=4;break;case 51:case 83:switch(r){case-3:i=[0];break;case-2:i=[1,3,5,7];break;case-1:i=[2,4,6];break;case 0:i=[3,5];break;case 1:i=[2,4];break;case 2:i=[3];break;case 4:i=[1];break;case 5:i=[0]}n=5;break;case 52:case 84:switch(r){case-2:i=[0];break;case-1:i=[1,3,5,7];break;case 0:i=[2,4,6];break;case 1:i=[3,5];break;case 2:i=[2,4];break;case 3:i=[3];break;case 5:i=[1];break;case 6:i=[0]}n=6;break;case 53:case 85:switch(r){case-1:i=[0];break;case 0:i=[1,3,5,7];break;case 1:i=[2,4,6];break;case 2:i=[3,5];break;case 3:i=[2,4];break;case 4:i=[3];break;case 6:i=[1];break;case 7:i=[0]}n=7;break;case 81:switch(r){case-4:i=[1,3,5,7];break;case-3:i=[2,4,6];break;case-2:i=[3,5];break;case-1:i=[2,4];break;case 0:i=[1,3];break;case 3:i=[0];break;default:o=!0}n=3}if(o){var a=n-t;(a<0||a>8)&&(i=[])}return{valences:i,valenceElectronCount:n,unexpectedCharge:o}},getMaxPossibleMdlValence:function(e,t){var r=Kekule.ValenceUtils.getPossibleMdlValenceInfo(e,t).valences;return r.length?r[r.length-1]:0},getImplicitMdlValence:function(e,t,r){var i=t,n=r;switch(e){case 1:case 3:case 11:case 19:case 37:case 55:case 87:if(0==i&&n<=1)return 1;break;case 4:case 12:case 20:case 38:case 56:case 88:switch(i){case 0:if(n<=2)return 2;break;case 1:if(n<=1)return 1}break;case 5:switch(i){case-4:if(n<=1)return 1;break;case-3:if(n<=2)return 2;break;case-2:if(n<=3)return 3;if(n<=5)return 5;break;case-1:if(n<=4)return 4;break;case 0:if(n<=3)return 3;break;case 1:if(n<=2)return 2;break;case 2:if(n<=1)return 1}break;case 6:switch(i){case-3:if(n<=1)return 1;break;case-2:if(n<=2)return 2;break;case-1:if(n<=3)return 3;if(n<=5)return 5;break;case 0:if(n<=4)return 4;break;case 1:if(n<=3)return 3;break;case 2:if(n<=2)return 2;break;case 3:if(n<=1)return 1}break;case 7:switch(i){case-2:if(n<=1)return 1;break;case-1:if(n<=2)return 2;break;case 0:if(n<=3)return 3;if(n<=5)return 5;break;case 1:if(n<=4)return 4;break;case 2:if(n<=3)return 3;break;case 3:if(n<=2)return 2;break;case 4:if(n<=1)return 1}break;case 8:switch(i){case-1:if(n<=1)return 1;break;case 0:if(n<=2)return 2;break;case 1:if(n<=3)return 3;if(n<=5)return 5;break;case 2:if(n<=4)return 4;break;case 3:if(n<=3)return 3;break;case 4:if(n<=2)return 2;break;case 5:if(n<=1)return 1}break;case 9:switch(i){case 0:if(n<=1)return 1;break;case 1:if(n<=2)return 2;break;case 2:if(n<=3)return 3;if(n<=5)return 5;break;case 3:if(n<=4)return 4;break;case 4:if(n<=3)return 3;break;case 5:if(n<=2)return 2;break;case 6:if(n<=1)return 1}break;case 13:switch(i){case-4:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case-3:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case-2:if(n<=3)return 3;if(n<=5)return 5;break;case-1:if(n<=4)return 4;break;case 0:if(n<=3)return 3;break;case 1:if(n<=2)return 2;break;case 2:if(n<=1)return 1}break;case 14:switch(i){case-3:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case-2:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case-1:if(n<=3)return 3;if(n<=5)return 5;break;case 0:if(n<=4)return 4;break;case 1:if(n<=3)return 3;break;case 2:if(n<=2)return 2;break;case 3:if(n<=1)return 1}break;case 15:switch(i){case-2:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case-1:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case 0:if(n<=3)return 3;if(n<=5)return 5;break;case 1:if(n<=4)return 4;break;case 2:if(n<=3)return 3;break;case 3:if(n<=2)return 2;break;case 4:if(n<=1)return 1}break;case 16:switch(i){case-1:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case 0:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case 1:if(n<=3)return 3;if(n<=5)return 5;break;case 2:if(n<=4)return 4;break;case 3:if(n<=3)return 3;break;case 4:if(n<=2)return 2;break;case 5:if(n<=1)return 1}break;case 17:switch(i){case 0:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case 1:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case 2:if(n<=3)return 3;if(n<=5)return 5;break;case 3:if(n<=4)return 4;break;case 4:if(n<=3)return 3;break;case 5:if(n<=2)return 2;break;case 6:if(n<=1)return 1}break;case 31:switch(i){case-4:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case-3:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case-2:if(n<=3)return 3;if(n<=5)return 5;break;case-1:if(n<=4)return 4;break;case 0:if(n<=3)return 3;break;case 2:if(n<=1)return 1}break;case 32:switch(i){case-3:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case-2:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case-1:if(n<=3)return 3;if(n<=5)return 5;break;case 0:if(n<=4)return 4;break;case 1:if(n<=3)return 3;break;case 3:if(n<=1)return 1}break;case 33:switch(i){case-2:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case-1:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case 0:if(n<=3)return 3;if(n<=5)return 5;break;case 1:if(n<=4)return 4;break;case 2:if(n<=3)return 3;break;case 4:if(n<=1)return 1}break;case 34:switch(i){case-1:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case 0:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case 1:if(n<=3)return 3;if(n<=5)return 5;break;case 2:if(n<=4)return 4;break;case 3:if(n<=3)return 3;break;case 5:if(n<=1)return 1}break;case 35:switch(i){case 0:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case 1:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case 2:if(n<=3)return 3;if(n<=5)return 5;break;case 3:if(n<=4)return 4;break;case 4:if(n<=3)return 3;break;case 6:if(n<=1)return 1}break;case 49:switch(i){case-4:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case-3:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case-2:if(n<=3)return 3;if(n<=5)return 5;break;case-1:if(n<=2)return 2;if(n<=4)return 4;break;case 0:if(n<=3)return 3;break;case 2:if(n<=1)return 1}break;case 50:case 82:switch(i){case-3:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case-2:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case-1:if(n<=3)return 3;if(n<=5)return 5;break;case 0:if(n<=2)return 2;if(n<=4)return 4;break;case 1:if(n<=3)return 3;break;case 3:if(n<=1)return 1}break;case 51:case 83:switch(i){case-2:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case-1:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case 0:if(n<=3)return 3;if(n<=5)return 5;break;case 1:if(n<=2)return 2;if(n<=4)return 4;break;case 2:if(n<=3)return 3;break;case 4:if(n<=1)return 1}break;case 52:case 84:switch(i){case-1:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case 0:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case 1:if(n<=3)return 3;if(n<=5)return 5;break;case 2:if(n<=2)return 2;if(n<=4)return 4;break;case 3:if(n<=3)return 3;break;case 5:if(n<=1)return 1}break;case 53:case 85:switch(i){case 0:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case 1:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case 2:if(n<=3)return 3;if(n<=5)return 5;break;case 3:if(n<=2)return 2;if(n<=4)return 4;break;case 4:if(n<=3)return 3;break;case 6:if(n<=1)return 1}break;case 81:switch(i){case-4:if(n<=1)return 1;if(n<=3)return 3;if(n<=5)return 5;if(n<=7)return 7;break;case-3:if(n<=2)return 2;if(n<=4)return 4;if(n<=6)return 6;break;case-2:if(n<=3)return 3;if(n<=5)return 5;break;case-1:if(n<=2)return 2;if(n<=4)return 4;break;case 0:if(n<=1)return 1;if(n<=3)return 3}}return n},getImplicitHydValence:function(e,t,r){var i=e,n=t,o=r,a=0;return 6==i?a=4-Math.abs(n):7==i||15==i?a=3+n:8!=i&&16!=i||(a=2+n),a<0&&(a=0),o>a&&(a=o),a}},Kekule.ValenceUtils.getImplicitValence=Kekule.ValenceUtils.getImplicitMdlValence,Kekule.ValenceUtils.getMaxPossibleValence=Kekule.ValenceUtils.getMaxPossibleMdlValence,function(){"use strict";var e=Kekule.ArrayUtils;Kekule.StructureComparationLevel={SKELETAL:1,CONSTITUTION:2,CONFIGURATION:3,EXACT:4,DEFAULT:4},Kekule.globalOptions.add("structure",{defaultBondLength2D:.8,defaultBondLength3D:1.5}),Kekule.globalOptions.add("algorithm.structureComparation",{structureComparationLevel:Kekule.StructureComparationLevel.DEFAULT}),Kekule.globalOptions.add("algorithm.structureClean",{structureCleanOptions:{orphanChemNode:!0,hangingChemConnector:!0}}),Kekule.globalOptions.add("structure.implicitHydrogenEstimationStrategy",{targetElementCategories:{},targetElements:{},targetOrphanAtomElementCategories:{},targetOrphanAtomElements:{}}),Kekule.globalOptions.structure.implicitHydrogenEstimationStrategy.targetOrphanAtomElementCategories[Kekule.ElementCategory.METAL]=!1,Kekule.ObjComparer.compareStructure=function(e,t,r){var i=Object.create(r||{});return i.method=Kekule.ComparisonMethod.CHEM_STRUCTURE,Kekule.ObjComparer.compare(e,t,i)},Kekule.ObjComparer.equalStructure=function(e,t,r){return 0===Kekule.ObjComparer.compareStructure(e,t,r)},Kekule.ObjComparer.getStructureComparisonDetailOptions=function(e){var t=Object.extend({},e);if(e){var r,i=Kekule.StructureComparationLevel,n=e.structureLevel||e.level||Kekule.globalOptions.algorithm.structureComparation.structureComparationLevel,o=["atom","mass","linkedConnectorCount","charge","radical","stereo","hydrogenCount","connectedObjCount","bondType","bondOrder"];n===i.SKELETAL?r={atom:!1,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!1,hydrogenCount:!1,connectedObjCount:!0,bondType:!1,bondOrder:!1}:n===i.CONSTITUTION?r={atom:!0,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!1,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0}:n===i.CONFIGURATION?r={atom:!0,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!0,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0}:n===i.EXACT&&(r={atom:!0,mass:!0,linkedConnectorCount:!0,charge:!0,radical:!0,stereo:!0,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0});for(var a=0,s=o.length;a<s;++a){var l=o[a],u="compare"+l.capitalizeFirst(),d=t[l];Kekule.ObjUtils.isUnset(d)&&(d=t[u]),Kekule.ObjUtils.isUnset(d)?(t[l]=r[l],t[u]=r[l]):(t[l]=d,t[u]=d)}}return t},Kekule.ChemStructureObject=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemStructureObject",initialize:function(e){this.setPropStoreFieldValue("autoClearStructureCache",!0),this.tryApplySuper("initialize",[e])},doFinalize:function(){this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("linkedConnectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null}),this.defineProp("linkedObjs",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t)for(var i=this.getLinkedConnectorAt(t).getConnectedObjs(),n=0,o=i.length;n<o;++n){var a=i[n];a===this||this.hasChildObj&&this.hasChildObj(a)||Kekule.ArrayUtils.pushUnique(e,i[n])}return e}}),this.defineProp("linkedSiblings",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=this.getParent(),r=0,i=this.getLinkedConnectorCount();r<i;++r)for(var n=this.getLinkedConnectorAt(r).getConnectedObjs(),o=0,a=n.length;o<a;++o){var s=n[o];s!==this&&e.indexOf(s)<0&&(s.getParent()!==t&&(s=t.getDirectChildOfNestedNode(s)),s&&e.push(s))}return e}}),this.defineProp("structureCache",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("structureCache");return!t&&e&&(t={},this.setPropStoreFieldValue("structureCache",t)),t}}),this.defineProp("autoClearStructureCache",{dataType:DataType.BOOL,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("linkedConnectors",[]),this.setSuppressChildChangeEventInUpdating(!0)},getAutoIdPrefix:function(){return"o"},getAcceptCoordStickFrom:function(e){return!1},doGetActualCompareOptions:function(e){if(e&&e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){var t=Kekule.ObjComparer.getStructureComparisonDetailOptions(e);return e.customMethod&&(t.customMethod=e.customMethod),e.extraComparisonProperties&&(t.extraComparisonProperties=e.extraComparisonProperties),t}return this.tryApplySuper("doGetActualCompareOptions",[e])},_getComparisonOptionFlagValue:function(e,t){var r=e["compare"+t.capitalizeFirst()];return Kekule.ObjUtils.isUnset(r)&&(r=e[t]),r},doGetComparisonPropNames:function(e){return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE?[]:this.tryApplySuper("doGetComparisonPropNames",[e])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"linkedConnectorCount")){var i=this.getLinkedNonHydrogenConnectors(),n=e.getLinkedNonHydrogenConnectors&&e.getLinkedNonHydrogenConnectors();r=this.doCompareOnValue(i.length,n&&n.length,t)}return r},compareStructure:function(e,t){var r=Object.create(t||{});return r.method=Kekule.ComparisonMethod.CHEM_STRUCTURE,this.compare(e,r)},equalStructure:function(e,t){return 0===this.compareStructure(e,t)},getParentFragment:function(){var e=this.getParent();return e instanceof Kekule.StructureFragment?e:null},getRootFragment:function(){var e=this.getParentFragment();return e&&e.getRootFragment()||e},getStructureCacheData:function(e){var t=this.getStructureCache();return t&&t[e]},setStructureCacheData:function(e,t){return this.getStructureCache(!0)[e]=t,this},clearStructureCache:function(){return this.setPropStoreFieldValue("structureCache",null),this},needAutoClearStructureCache:function(){var e=this.getParent();return this.getAutoClearStructureCache()&&(!e||!e.needAutoClearStructureCache||e.needAutoClearStructureCache())},notifyLinkedConnectorsChanged:function(){this.notifyPropSet("linkedConnectors",this.getPropStoreFieldValue("linkedConnectors"))},getCurrConnectableObj:function(){return this},getActualConnectedObjToConnector:function(e){return this},getLinkedConnectorCount:function(){return this.getLinkedConnectors().length},getLinkedConnectorAt:function(e){return this.getLinkedConnectors()[e]},indexOfLinkedConnector:function(e){return this.getLinkedConnectors().indexOf(e)},appendLinkedConnector:function(e){var t=this._doAppendLinkedConnector(e);return e&&e._doAppendConnectedObj(this),t},_doAppendLinkedConnector:function(e){if(!e)return-1;var t=this.getPropStoreFieldValue("linkedConnectors"),r=Kekule.ArrayUtils.pushUniqueEx(t,e);return r.isPushed&&this.notifyLinkedConnectorsChanged(),r.index},insertLinkedConnectorAt:function(e,t){t||(t=0);var r=this.indexOfLinkedConnector(e),i=this.getLinkedConnectors();r>=0?(i.splice(r,1),i.splice(t,0,e),this.notifyLinkedConnectorsChanged()):(i.splice(t,0,e),e&&e._doAppendConnectedObj(this),this.notifyLinkedConnectorsChanged())},insertLinkedConnectorBefore:function(e,t){var r=t?this.indexOfLinkedConnector(t):-1;return r<0?this.appendLinkedConnector(e):this.insertLinkedConnectorAt(e,r)},removeLinkedConnectorAt:function(e){var t=this.getLinkedConnectorAt(e);return t&&t._doRemoveConnectedObjAt(t.indexOfConnectedObj(this)),this._doRemoveLinkedConnectorAt(e)},_doRemoveLinkedConnectorAt:function(e){var t=Kekule.ArrayUtils.removeAt(this.getLinkedConnectors(),e);return t&&this.notifyLinkedConnectorsChanged(),t},removeLinkedConnector:function(e){var t=this.getLinkedConnectors().indexOf(e);t>=0&&this.removeLinkedConnectorAt(t)},getConnectorTo:function(e){for(var t=0,r=this.getLinkedConnectorCount();t<r;++t){var i=this.getLinkedConnectorAt(t);if(i.hasConnectedObj(e))return i}return null},removeThisFromLinkedConnector:function(){for(var e=this.getLinkedConnectorCount()-1;e>=0;--e){this.getLinkedConnectorAt(e).removeConnectedObj(this)}},getLinkedObjsOnConnector:function(e){for(var t=[],r=e.getConnectedObjs(),i=0,n=r.length;i<n;++i)r[i]!==this&&Kekule.ArrayUtils.pushUnique(t,r[i]);return t},filterConnector:function(e){for(var t=[],r=0,i=this.getLinkedConnectorCount();r<i;++r){var n=this.getLinkedConnectorAt(r);e(n)&&Kekule.ArrayUtils.pushUnique(t,n)}return t},getLinkedNonHydrogenConnectors:function(){var e=this;return this.filterConnector(function(t){var r=e.getLinkedObjsOnConnector(t);return r.length>1||!(r[0].isHydrogenAtom&&r[0].isHydrogenAtom())})},getLinkedHydrogenConnectors:function(){var e=this;return this.filterConnector(function(t){var r=e.getLinkedObjsOnConnector(t);return 1===r.length&&r[0].isHydrogenAtom&&r[0].isHydrogenAtom()})},getLinkedNonHydrogenObjs:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t)for(var i=this.getLinkedConnectorAt(t).getConnectedObjs(),n=0,o=i.length;n<o;++n)i[n]===this||i[n].isHydrogenAtom&&i[n].isHydrogenAtom()||Kekule.ArrayUtils.pushUnique(e,i[n]);return e},getLinkedHydrogenAtoms:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var i=this.getLinkedConnectorAt(t);if(i instanceof Kekule.Bond)for(var n=i.getConnectedObjs(),o=0,a=n.length;o<a;++o)n[o]!==this&&n[o].isHydrogenAtom&&n[o].isHydrogenAtom()&&Kekule.ArrayUtils.pushUnique(e,n[o])}return e},getLinkedHydrogenAtomsWithSingleBond:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var i=this.getLinkedConnectorAt(t);if(i instanceof Kekule.Bond&&i.isSingleBond()){var n=i.getConnectedObjs();if(2===n.length)for(var o=0,a=n.length;o<a;++o)n[o]!==this&&n[o].isHydrogenAtom&&n[o].isHydrogenAtom()&&Kekule.ArrayUtils.pushUnique(e,n[o])}}return e},getLinkedHydrogenAtomsWithSingleBondCount:function(e){var t=this.getLinkedHydrogenAtomsWithSingleBond().length||0;e&&(t+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0);return t},getPathesToDest:function(e){return this._doGetPathesToDest(e,[])},_doGetPathesToDest:function(t,r){if(t===this)return[];for(var i,n=[],o=e.clone(r),a=0,s=this.getLinkedConnectorCount();a<s;++a){var l=this.getLinkedConnectorAt(a);if(!(o.indexOf(l)>=0)){o.push(l);for(var u=l.getConnectedObjs(),d=0,c=u.length;d<c;++d){var h=u[d];if(h===t)i=[[]];else{if(h===this)continue;i=h&&h._doGetPathesToDest&&h._doGetPathesToDest(t,o)}if(i){for(var p={connector:l,object:h},g=0,f=i.length;g<f;++g)i[g].unshift(p);n=n.concat(i)}}}}return n.length||(n=null),n},getStructureRelatedPropNames:function(){return["linkedConnectors"]},structureChange:function(e){this.needAutoClearStructureCache()&&(this.clearStructureFlags(),this.clearStructureCache()),this.invokeEvent("structureChange",{origin:e||this})},clearStructureFlags:function(){},relayEvent:function(e,t){"structureChange"===e?this.structureChange(t.origin):this.tryApplySuper("relayEvent",[e,t])},doObjectChange:function(e){Kekule.ArrayUtils.intersect(e||[],this.getStructureRelatedPropNames()).length&&this.structureChange()}}),Kekule.SimpleStructureNode=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.SimpleStructureNode",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){this.defineProp("zIndex2D",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["coord2D","coord3D"])},getAutoIdPrefix:function(){return"n"},getContainerBox:function(e,t){var r=this.getAbsCoordOfMode(e,t);return Kekule.BoxUtils.createBox(r,r)},getContainerBox2D:function(e){return this.getContainerBox(Kekule.CoordMode.COORD2D,e)},getContainerBox3D:function(e){return this.getContainerBox(Kekule.CoordMode.COORD3D,e)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.SimpleStructureNode),Kekule.BaseStructureNode=Class.create(Kekule.SimpleStructureNode,{CLASS_NAME:"Kekule.BaseStructureNode",initProperties:function(){this.defineProp("coordStickTarget",{dataType:"Kekule.ChemStructureObject",objRef:!0,autoUpdate:!0,getter:function(){return this.getPropStoreFieldValue("coordStickTarget")},setter:function(e){if(e){if(!this.getAllowCoordStickTo(e))return void Kekule.chemError(Kekule.$L("ErrorMsg.COORD_STICK_NOT_ALLOWED_ON_CLASS"));var t=this.getOwner(),r=e.getOwner&&e.getOwner();if(r&&t!==r)return void Kekule.chemError(Kekule.$L("ErrorMsg.UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ"));if(!e.getAcceptCoordStickFrom&&!e.getAcceptCoordStickFrom(this))return void Kekule.chemError(Kekule.$L("ErrorMsg.INVALID_STICK_TARGET_OBJ"));if(!e.getAbsCoordOfMode)return void Kekule.chemError(Kekule.$L("ErrorMsg.UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD"));if(e.getCoordStickTarget&&e.getCoordStickTarget()===this)return void Kekule.chemError(Kekule.$L("ErrorMsg.STICK_RECURSION_NOT_ALLOWED"))}var i=this.getCoordStickTarget();this.setPropStoreFieldValue("coordStickTarget",e),this._coordStickTargetChanged(i,e)}})},getAllowCoordStickTo:function(e){return!1},notifyCoordStickTargetChanged:function(e,t){},_getParentAbsCoord:function(e,t){var r=this.getCoordParent();return r&&r.getAbsCoordOfMode&&r.getAbsCoordOfMode(e,t)},_coordStickTargetChanged:function(e,t){e&&!t?this._copyAbsCoordFromStickedTarget(e,this.getCoordParent()):t&&this._copyAbsCoordFromStickedTarget(t,this.getCoordParent()),e&&e.detachCoordStickNodes&&e.detachCoordStickNodes(this),t&&t.attachCoordStickNodes&&t.attachCoordStickNodes(this),this.notifyCoordStickTargetChanged(e,t)},_copyAbsCoordFromStickedTarget:function(e,t,r){var i=Kekule.CoordUtils,n=Kekule.CoordMode;t||(t=this.getCoordParent());var o=r&&r!==n.COORD2D?null:e.getAbsCoord2D(),a=r&&r!==n.COORD2D?null:e.getAbsCoord3D();if(t){if(o){var s=t.getAbsCoord2D&&t.getAbsCoord2D();s&&(o=i.substract(o,s))}if(a){var l=t.getAbsCoord3D&&t.getAbsCoord3D();l&&(a=i.substract(a,l))}}o&&this.setPropStoreFieldValue("coord2D",o),a&&this.setPropStoreFieldValue("coord3D",a)},doGetCoord2D:function(e,t){var r=this.getCoordStickTarget();if(r&&r.getAbsCoord2D){var i=r.getAbsCoord2D(e,t),n=this._getParentAbsCoord(Kekule.CoordMode.COORD2D,e);return n&&(i=Kekule.CoordUtils.substract(i,n)),i}return this.tryApplySuper("doGetCoord2D",[e,t])},doGetCoord3D:function(e,t){var r=this.getCoordStickTarget();if(r&&r.getAbsCoord3D){var i=r.getAbsCoord3D(e,t),n=this._getParentAbsCoord(Kekule.CoordMode.COORD3D,e);return n&&(i=Kekule.CoordUtils.substract(i,n)),i}return this.tryApplySuper("doGetCoord3D",[e,t])},isOrphan:function(){var e=this.getParent();return!e||e.getChildCount()<=1}}),Kekule.StereoParity={NONE:null,ODD:1,EVEN:2,UNKNOWN:0},Kekule.ChemStructureNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.ChemStructureNode",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}}),this.defineProp("electronicBias",{dataType:DataType.INT}),this.defineProp("radical",{dataType:DataType.INT}),this.defineProp("parity",{dataType:DataType.INT}),this.defineProp("isAnchor",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getParent();return!(!e||!e.indexOfAnchorNode)&&e.indexOfAnchorNode(this)>=0},setter:function(e){if(e!==this.getIsAnchor()){var t=this.getParent();t&&(e&&t.appendAnchorNode()?t.appendAnchorNode(this):!e&&t.removeAnchorNode&&t.removeAnchorNode(this))}}}),this.defineProp("chargeEx",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PRIVATE,serializable:!1,getter:function(){return{charge:this.getCharge(),electronicBias:this.getElectronicBias()}},setter:function(e){this.beginUpdate();try{e&&Kekule.ObjUtils.notUnset(e.charge)&&this.setCharge(e.charge),e&&Kekule.ObjUtils.notUnset(e.electronicBias)&&this.setElectronicBias(e.electronicBias)}finally{this.endUpdate()}}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["charge","radical"])},getLabel:function(){return null},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof Kekule.ChemStructureNode)},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(e,"charge")&&t.push("charge"),this._getComparisonOptionFlagValue(e,"radical")&&t.push("radical")),t},doCompareProperty:function(e,t,r){if(r.method!==Kekule.ComparisonMethod.CHEM_STRUCTURE||"charge"!==t&&"radical"!==t)return this.tryApplySuper("doCompareProperty",[e,t,r]);var i=e.getPropValue&&e.getPropValue(t)||0;return(this.getPropValue(t)||0)-i},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"stereo")){var i=this.getParity()||Kekule.StereoParity.UNKNOWN,n=e.getParity&&e.getParity()||Kekule.StereoParity.UNKNOWN;r=this.doCompareOnValue(i,n,t)}return r},getPrimaryIsotope:function(){return null},getLinkedChemNodes:function(e){for(var t=this.getLinkedObjs(),r=[],i=0,n=t.length;i<n;++i){var o=t[i];!(o instanceof Kekule.ChemStructureNode)||e&&o.isHydrogenAtom&&o.isHydrogenAtom()||r.push(o)}return r},getLinkedBonds:function(e){for(var t=[],r=0,i=this.getLinkedConnectorCount();r<i;++r){var n=this.getLinkedConnectorAt(r);n instanceof Kekule.Bond&&(!e||n.getBondType()===e)&&t.push(n)}return t},getLinkedMultiCenterBonds:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var i=this.getLinkedConnectorAt(t);i instanceof Kekule.Bond&&i.getConnectedObjCount()>2&&e.push(i)}return e},getLinkedMultipleBonds:function(){for(var e=Kekule.BondOrder,t=[],r=0,i=this.getLinkedConnectorCount();r<i;++r){var n=this.getLinkedConnectorAt(r);if(n instanceof Kekule.Bond&&n.getBondType()===Kekule.BondType.COVALENT){var o=n.getBondOrder();o!==e.DOUBLE&&o!==e.TRIPLE&&o!==e.QUAD&&o!==e.EXPLICIT_AROMATIC||t.push(n)}}return t},getLinkedDoubleBonds:function(){for(var e=Kekule.BondOrder,t=[],r=0,i=this.getLinkedConnectorCount();r<i;++r){var n=this.getLinkedConnectorAt(r);if(n instanceof Kekule.Bond&&n.getBondType()===Kekule.BondType.COVALENT)n.getBondOrder()===e.DOUBLE&&t.push(n)}return t},clearStructureFlags:function(){this.setPropStoreFieldValue("parity",Kekule.StereoParity.NONE)},isHydrogenAtom:function(){return!1},hasExplicitChargeOrElectronicBias:function(){return!(!this.getCharge()&&!this.getElectronicBias())},_getBondsValenceInfo:function(e){for(var t=0,r=0,i=this.getStructureCacheData("piElectronCount")||null,n=0,o=e.length;n<o;++n){var a,s=e[n];if(s instanceof Kekule.Bond)t+=a=s.getBondType()==Kekule.BondType.COVALENT&&s.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC&&i>=2?1:s.getBondValence(),a>r&&(r=a)}return{valenceSum:t,maxValence:r}},_getCurrCovalentBondsInfo:function(){return this._getBondsValenceInfo(this.filterConnector(function(e){return e instanceof Kekule.Bond&&e.getBondType()==Kekule.BondType.COVALENT}))},_getCurrIonicBondsInfo:function(e){return this._getBondsValenceInfo(this.filterConnector(function(e){return e instanceof Kekule.Bond&&e.getBondType()==Kekule.BondType.IONIC}))}}),Kekule.RadicalType=Kekule.RadicalOrder,Kekule.AbstractAtom=Class.create(Kekule.ChemStructureNode,{CLASS_NAME:"Kekule.AbstractAtom",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("explicitHydrogenCount",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=parseFloat(e),r=isNaN(t)||t<0?void 0:t;this.setPropStoreFieldValue("explicitHydrogenCount",r)}})},getAutoIdPrefix:function(){return"a"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["explicitHydrogenCount"])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"hydrogenCount")){var i=this.getHydrogenCount(!0),n=e.getHydrogenCount&&e.getHydrogenCount(!0);r=this.doCompareOnValue(i,n,t)}return r},getHydrogenCount:function(e){var t=this.getExplicitHydrogenCount()||0;return e&&(t+=this.getLinkedHydrogenAtomsWithSingleBondCount(!1)),t+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0},setHydrogenCount:function(e){return this.setExplicitHydrogenCount(e)},hasExplicitHydrogens:function(){return Kekule.ObjUtils.notUnset(this.getExplicitHydrogenCount())},isSaturated:function(){return!this.getLinkedMultipleBonds().length},mayContainElement:function(e){var t;return t="string"==typeof e?Kekule.ChemicalElementsDataUtil.getAtomicNumber(e):e,this.doMayContainElement(t)},doMayContainElement:function(e){return!1}}),Kekule.Atom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.Atom",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,i,n]),(t||r)&&this.changeIsotope(t,r)},initProperties:function(){this.defineProp("isotope",{dataType:"Kekule.Isotope",serializable:!1}),this.defineProp("isotopeId",{dataType:DataType.STRING,serializable:!0,getter:function(){var e=this.getIsotope();return e?e.getIsotopeId():Kekule.Element.UNSET_ELEMENT},setter:function(e){var t=Kekule.IsotopeFactory.getIsotopeById(e);t&&this.setIsotope(t)}}),this.defineProp("symbol",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getIsotope();return e?e.getSymbol():Kekule.Element.UNSET_ELEMENT},setter:function(e){this.changeElement(e)}}),this.defineProp("atomicNumber",{dataType:DataType.INTEGER,serializable:!1,getter:function(){var e=this.getIsotope();return e?e.getAtomicNumber():0},setter:function(e){this.changeElement(e)}}),this.defineProp("massNumber",{dataType:DataType.INTEGER,getter:function(){var e=this.getIsotope();return e?e.getMassNumber():Kekule.Isotope.UNSET_MASSNUMBER},setter:function(e){this.changeMassNumber(e)}}),this.defineProp("isotopeAlias",{dataType:DataType.STRING,getter:function(){var e=this.getIsotope();return e?e.getIsotopeAlias():void 0},setter:function(e){this.changeElement(e)}}),this.defineProp("atomType",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("atomTypeId",{dataType:DataType.STRING,getter:function(){var e=this.getPropStoreFieldValue("atomType");return e?e.id:Kekule.AtomType.UNSET_ATOMTYPE},setter:function(e){if(this.isNormalAtom()){var t=Kekule.AtomTypeDataUtil.getAtomTypeFromId(this.getAtomicNumber(),e);this.setAtomType(t)}}}),this.defineProp("hybridizationType",{dataType:DataType.INT,enumSource:Kekule.HybridizationType}),this.defineProp("disableImplicitHydrogenEstimation",{dataType:DataType.BOOL})},getAutoIdPrefix:function(){return"a"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["isotope","atomType"])},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(e,"mass")&&t.unshift("massNumber"),this._getComparisonOptionFlagValue(e,"atom")&&t.unshift("atomicNumber")),t},getPrimaryIsotope:function(){return this.getIsotope()},getLabel:function(){return""+(this.getMassNumber()||"")+this.getSymbol()},doMayContainElement:function(e){return this.getAtomicNumber()===e},changeIsotope:function(e,t){e===Kekule.Element.UNSET_ELEMENT?t=Kekule.Isotope.UNSET_MASSNUMBER:e||(e=this.getAtomicNumber()),t||(t=Kekule.Isotope.UNSET_MASSNUMBER),this.getAtomicNumber()!==e&&this.setAtomType(Kekule.AtomType.UNSET_ATOMTYPE);var r=Kekule.IsotopeFactory.getIsotope(e,t);this.setIsotope(r)},changeElement:function(e){return this.changeIsotope(e,Kekule.Isotope.UNSET_MASSNUMBER)},changeMassNumber:function(e){return this.changeIsotope(null,e)},isElement:function(e){return this.getSymbol()===e||this.getAtomicNumber()===e},getElementSeries:function(){var e=this.getIsotope();return e&&e.getSeries()},isNormalAtom:function(){var e=this.getIsotope();return!!e&&e.isNormalElement()},isHydrogenAtom:function(){return this.isElement(1)&&(!this.getMassNumber()||this.getMassNumber()<=1)},guessAtomType:function(){if(this.isNormalAtom()){var e=null,t=null,r=this._getCurrCovalentBondsInfo(),i=Kekule.AtomTypeDataUtil.getAllAtomTypes(this.getAtomicNumber());if(i){for(var n=0,o=i.length;n<o;++n){var a=i[n];if(t=a,a.bondOrderSum>=r.valenceSum&&(e=a,a.maxBondOrder>=r.maxValence))return a}return e||t}}return null},getProximalAtomType:function(){return this.getAtomType()||this.guessAtomType()},getImplicitValence:function(){if(this.isNormalAtom()){var e=this._getCurrCovalentBondsInfo().valenceSum,t=Math.round(this.getCharge()||0);return Kekule.ValenceUtils.getImplicitValence(this.getAtomicNumber(),t,e)}return 0},getExplicitValence:function(e){var t=e||{};if(this.isNormalAtom()){var r=this._getCurrCovalentBondsInfo().valenceSum;if(t.ignoreBondHydrogens)r-=(this.getLinkedHydrogenAtomsWithSingleBond()||[]).length;else r+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0;if(t.ignoreExplicitHydrogens);else r+=this.getExplicitHydrogenCount()||0;return r}return 0},getValence:function(e){var t=e||{};if(this.isNormalAtom()){var r,i=this.getExplicitValence(t);if(this.hasExplicitHydrogens())r=i;else{var n=t.ignoreCharge?0:Math.round(this.getCharge()||0);r=Kekule.ValenceUtils.getImplicitValence(this.getAtomicNumber(),n,i)}return r}return 0},getImplicitHydrogenCount:function(e){if(this.isNormalAtom()&&this._needToEsitmateImplicityHydrogens()){var t=this._getCurrCovalentBondsInfo(),r=this._getCurrIonicBondsInfo(),i=Math.round(this.getCharge()||0),n=Kekule.RadicalOrder.getRadicalElectronCount(this.getRadical()),o=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0;return Kekule.ChemStructureUtils.getImplicitHydrogenCount(this.getAtomicNumber()||0,{coValenceBondValenceSum:(t.valenceSum||0)+o,otherBondValenceSum:r.valenceSum||0,charge:i,radicalECount:n})}return 0},_needToEsitmateImplicityHydrogens:function(){var e=!this.getDisableImplicitHydrogenEstimation();if(e){var t=this.isOrphan(),r=this.getSymbol(),i=Kekule.globalOptions.get("structure.implicitHydrogenEstimationStrategy")||{};if((i.targetElements&&!1===i.targetElements[r]||t&&i.targetOrphanAtomElements&&!1===i.targetOrphanAtomElements[r])&&(e=!1),e)for(var n=i.targetElementCategories,o=i.targetOrphanAtomElementCategories,a=this.getIsotope().getCategories(),s=0,l=a.length;s<l;++s){var u=a[s];if(n&&!1===n[u]||t&&o&&!1===o[u]){e=!1;break}}}return e},getHydrogenCount:function(e){var t=this.tryApplySuper("getHydrogenCount",[e]);return Kekule.ObjUtils.isUnset(this.getExplicitHydrogenCount())&&(t+=this.getImplicitHydrogenCount()||0),t},getAtomicMass:function(){var e=null,t=this.getIsotope();return t&&(e=t.getExactMass()||t.getNaturalMass()),e}}),Kekule.PseudoatomType={DUMMY:"dummy",ANY:"any",HETERO:"hetero",CUSTOM:"custom"},Kekule.Pseudoatom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.Pseudoatom",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,i,n]),t&&this.setAtomType(t),r&&t==Kekule.PseudoatomType.CUSTOM&&this.setSymbol(r)},initProperties:function(){this.defineProp("atomType",{dataType:DataType.STRING,enumSource:Kekule.PseudoatomType}),this.defineProp("symbol",{dataType:DataType.STRING,getter:function(){var e=this.getAtomType(),t=Kekule.PseudoatomType,r=Kekule.ChemStructureNodeLabels;return e===t.DUMMY?r.DUMMY_ATOM:e===t.ANY?r.ANY_ATOM:e===t.HETERO?r.HETERO_ATOM:this.getPropStoreFieldValue("symbol")||r.CUSTOM_ATOM},setter:function(e){var t=Kekule.PseudoatomType,r=Kekule.ChemStructureNodeLabels;if(e){var i=e===r.DUMMY_ATOM?t.DUMMY:e===r.ANY_ATOM?t.ANY:e===r.HETERO_ATOM?t.HETERO:t.CUSTOM;this.setAtomType(i)}this.setPropStoreFieldValue("symbol",e)}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["atomType","symbol"])},getPrimaryIsotope:function(){return null},getLabel:function(){return this.getSymbol()},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(e,"atom")&&t.push("atomType"),t},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"atom")&&this.getAtomType()===Kekule.PseudoatomType.CUSTOM){var i=this.getSymbol(),n=e.getSymbol&&e.getSymbol();r=this.doCompareOnValue(i,n,t)}return r},doMayContainElement:function(e){var t=Kekule.PseudoatomType,r=this.getAtomType();return r===t.ANY||r===t.HETERO&&(!([1,6].indexOf(e)>=0)&&"Nonmetals"===Kekule.ChemicalElementsDataUtil.getElementInfo(e).chemicalSerie)}}),Kekule.VariableAtom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.VariableAtom",initProperties:function(){this.defineProp("allowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(e){var t=this.getPropStoreFieldValue("allowedIsotopeIds");return!t&&e&&(t=[],this.setPropStoreFieldValue("allowedIsotopeIds",t)),t}}),this.defineProp("disallowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(e){var t=this.getPropStoreFieldValue("disallowedIsotopeIds");return!t&&e&&(t=[],this.setPropStoreFieldValue("disallowedIsotopeIds",t)),t}}),this.defineProp("allowedIsotopes",{dataType:DataType.ARRAY,setter:null,getter:function(){return this._getIsotopesFromIds(this.getAllowedIsotopeIds())}}),this.defineProp("disallowedIsotopes",{dataType:DataType.ARRAY,setter:null,getter:function(){return this._getIsotopesFromIds(this.getDisallowedIsotopeIds())}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["allowedIsotopeIds","disallowedIsotopeIds"])},getPrimaryIsotope:function(){if(this.isDisallowedList())return null;var e=this.getAllowedIsotopeIds(),t=e?e[0]:null;return t?Kekule.IsotopeFactory.getIsotopeById(t):null},getLabel:function(){return Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"atom")){var i=Kekule.ArrayUtils,n=this.getAllowedIsotopeIds(),o=e.getAllowedIsotopeIds&&e.getAllowedIsotopeIds();if(n)n=i.clone(n).sort(),o&&o.length&&(o=i.clone(o).sort()),r=this.doCompareOnValue(n,o,t);else if(o)r=1;else{var a=this.getDisallowedIsotopeIds(),s=e.getDisallowedIsotopeIds&&e.getDisallowedIsotopeIds();a&&a.length&&(a=i.clone(a).sort()),s&&s.length&&(s=i.clone(s).sort()),r=this.doCompareOnValue(a,s,t)}}return r},doMayContainElement:function(e){var t=function(e,t){if(!t)return!1;for(var r=0,i=t.length;r<i;++r){var n=t[r],o=Kekule.IsotopesDataUtil.getIsotopeIdDetail(n).symbol;if(Kekule.ChemicalElementsDataUtil.getAtomicNumber(o)===e)return!0}return!1},r=this.getAllowedIsotopeIds();return r?t(e,r):(r=this.getDisallowedIsotopeIds())?!t(e,r):void 0},isDisallowedList:function(){return this.getDisallowedIsotopeIds()&&!this.getAllowedIsotopeIds()},isListEmpty:function(){var e=this.getAllowedIsotopeIds(),t=!e||!e.length;return t&&(t=!(e=this.getDisallowedIsotopeIds())||!e.length),t},fetchAllowedIsotopeIds:function(){return this.doGetAllowedIsotopeIds(!0)},fetchDisallowedIsotopeIds:function(){return this.doGetDisallowedIsotopeIds(!0)},_getIsotopesFromIds:function(e){if(!e)return null;for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r],o=Kekule.IsotopeFactory.getIsotopeById(n);o&&t.push(o)}return t}}),Kekule.MolecularFormula=Class.create(ObjectEx,{CLASS_NAME:"Kekule.MolecularFormula",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("sections",[]),e&&this.setPropStoreFieldValue("parent",e),this.setBubbleEvent(!0)},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("sections",{dataType:DataType.ARRAY,setter:null}),this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}}),this.defineProp("radical",{dataType:DataType.INT,getter:function(){return this.getPropStoreFieldValue("radical")||0}})},getHigherLevelObj:function(){return this.getParent()},isEmpty:function(){return this.getSectionCount()<=0},notifySectionsChanged:function(){this.notifyPropSet("sections",this.getPropStoreFieldValue("sections"))},createSectionItem:function(e,t,r){var i={obj:e,count:t||1};return r&&e.setCharge(r),e.setParent&&e.setParent(this.getParent()),i},getTotalCharge:function(){for(var e=0,t=this.getSections(),r=0,i=t.length;r<i;++r)t[r].obj.getCharge&&(e+=t[r].obj.getCharge()*(t.count||1));return this.getCharge()&&(e+=this.getCharge()),e},indexOfObj:function(e){for(var t=this.getSections(),r=0,i=t.length;r<i;++r)if(t[r].obj==e)return r;return-1},getSectionCount:function(){return this.getSections().length},getSectionAt:function(e){return this.getSections()[e]},getSectionCharge:function(e){var t,r=0;return(t="object"!=typeof e?this.getSectionAt(e):e).obj.getCharge&&(r+=t.obj.getCharge()||0),r},appendSection:function(e,t,r){var i=this.createSectionItem(e,t,r);return this.getSections().push(i),this.notifySectionsChanged(),i},insertSection:function(e,t,r,i){var n=this.createSectionItem(t,r,i);return this.getSections().splice(e,0,n),this.notifySectionsChanged(),n},removeSectionAt:function(e){var t=this.getSections().splice(e,1);return t&&this.notifySectionsChanged(),t},clear:function(){this.beginUpdate();try{this.setCharge(null),this.setRadical(null),this.setPropStoreFieldValue("sections",[]),this.notifySectionsChanged()}finally{this.endUpdate()}},removeObj:function(e){var t=this.indexOfObj(e);if(!(t>=0))return null;this.removeSectionAt(t);this.notifySectionsChanged()},getMaxNestedLevel:function(){for(var e=0,t=0,r=this.getSectionCount();t<r;++t){var i=this.getSectionAt(t);if(i.obj instanceof Kekule.MolecularFormula){var n=i.obj.getMaxNestedLevel()+1;n>e&&(e=n)}}return e},getSimpleIsotopeMaps:function(){}}),Kekule.StructureConnectionTable=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureConnectionTable",TRAVERS_VISITED_KEY:"__$ctabTraversVisited__",initialize:function(e,t){this.tryApplySuper("initialize"),e&&this.setOwner(e),t&&this.setPropStoreFieldValue("parent",t)},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!=this.getPropStoreFieldValue("owner")&&(this.setPropStoreFieldValue("owner",e),this.ownerChanged(e))}}),this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!=this.getPropStoreFieldValue("parent")&&(this.setPropStoreFieldValue("parent",e),this.parentChanged(e))}}),this.defineProp("nodes",{dataType:DataType.ARRAY}),this.defineProp("anchorNodes",{dataType:DataType.ARRAY,setter:null}),this.defineProp("connectors",{dataType:DataType.ARRAY}),this.defineProp("nonHydrogenNodes",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var i=this.getNodeAt(t);i instanceof Kekule.ChemStructureNode&&(i.isHydrogenAtom&&i.isHydrogenAtom()||e.push(i))}return e}}),this.defineProp("nonHydrogenConnectors",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){for(var e=[],t=0,r=this.getConnectorCount();t<r;++t){var i=this.getConnectorAt(t);i.isNormalConnectorToHydrogen&&i.isNormalConnectorToHydrogen()||e.push(i)}return e}}),this.defineProp("structureCache",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(e){var t=this.getParent();return t&&t.getStructureCache(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("nodes",[]),this.setPropStoreFieldValue("anchorNodes",[]),this.setPropStoreFieldValue("connectors",[])},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},doSaveProp:function(e,t,r,i,n,o,a,s){var l=t.name;switch(l){case"anchorNodes":for(var u=[],d=0,c=e.getAnchorNodeCount();d<c;++d){var h=e.getAnchorNodeAt(d),p=e.indexOfNode(h);u.push(p)}var g=n.createChildStorageNode(r,n.propNameToStorageName(l),!0);return n.saveObj(u,g,i,o,a,s),!0;case"connectors":for(g=n.createChildStorageNode(r,n.propNameToStorageName(l),!0),d=0,c=e.getConnectorCount();d<c;++d){var f=e.getConnectorAt(d),C=n.getNameForArrayItemStorageNode(f),m=n.appendArrayItemStorageNode(g,n.propNameToStorageName(C),n.isArray(f));n.setStorageNodeExplicitType(m,n.getValueExplicitType(f)),n.saveObj(f,m,i,o,a,s);for(var T=[],E=0,_=f.getConnectedObjCount();E<_;++E){var S=f.getConnectedObjAt(E);if((p=e.indexOfChild(S))>=0)T.push(p);else{var O=e.indexStackOfChild(S);null!=O&&T.push(O)}}if(T.length){var y=n.createChildStorageNode(m,n.propNameToStorageName("connectedObjs"),!0);n.saveObj(T,y,i,o,a,s)}}return!0;default:return!1}},doLoadProp:function(e,t,r,i,n,o,a){var s=t.name;switch(s){case"anchorNodes":var l=[],u=i.getChildStorageNode(r,i.propNameToStorageName(s));return i.loadObj(l,u,n,o,a),e.__load_anchorNodes_indexes=l,!0;case"connectors":u=i.getChildStorageNode(r,i.propNameToStorageName(s));for(var d,c=i.getAllArrayItemStorageNodes(u),h=0,p=c.length;h<p;++h){var g=c[h],f=i.getStorageNodeExplicitType(g)||i.getStorageNodeName(g);if(f){d=DataType.createInstance(f),i.loadObj(d,g,n,o,a);var C=i.getChildStorageNode(g,i.propNameToStorageName("connectedObjs"));if(C){var m=[];i.loadObj(m,C,n,o,a),d.__load_connectedObj_indexes=m}var T=i.getChildStorageNode(g,i.propNameToStorageName("connectedNodes"));if(T){var E=[];i.loadObj(E,T,n,o,a),d.__load_connectedNode_indexes=E}var _=i.getChildStorageNode(g,i.propNameToStorageName("connectedConnectors"));if(_){var S=[];i.loadObj(S,_,n,o,a),d.__load_connectedConnector_indexes=S}e.appendConnector(d)}}return!0;default:return!1}},loaded:function(e){if(this.__load_anchorNodes_indexes){for(var t=0,r=this.__load_anchorNodes_indexes.length;t<r;++t){var i=this.__load_anchorNodes_indexes[t];this.appendAnchorNode(this.getNodeAt(i))}delete this.__load_anchorNodes_indexes}for(t=0,r=this.getConnectorCount();t<r;++t){var n=this.getConnectorAt(t);if(n.__load_connectedObj_indexes){for(var o=0,a=n.__load_connectedObj_indexes.length;o<a;++o){var s;(s="object"==typeof(i=n.__load_connectedObj_indexes[o])?this.getChildAtIndexStack(i):this.getChildAt(i))&&n.appendConnectedObj(s)}delete n.__load_connectedObj_indexes}if(n.__load_connectedNode_indexes){for(o=0,a=n.__load_connectedNode_indexes.length;o<a;++o){"object"==typeof(i=n.__load_connectedNode_indexes[o])?n.appendConnectedObj(this.getNodeAtIndexStack(i)):n.appendConnectedObj(this.getNodeAt(i))}delete n.__load_connectedNode_indexes}if(n.__load_connectedConnector_indexes){for(o=0,a=n.__load_connectedConnector_indexes.length;o<a;++o){i=n.__load_connectedConnector_indexes[o];n.appendConnectedObj(this.getConnectorAt(i))}delete n.__load_connectedConnector_indexes}}this.ownerChanged(this.getOwner()),this.parentChanged(this.getParent()),this.tryApplySuper("loaded",[e])},notifyNodesChanged:function(){this.notifyPropSet("nodes",this.getPropStoreFieldValue("nodes"))},notifyAnchorNodesChanged:function(){this.notifyPropSet("anchorNodes",this.getPropStoreFieldValue("anchorNodes"))},notifyConnectorsChanged:function(){this.notifyPropSet("connectors",this.getPropStoreFieldValue("connectors"))},ownerChanged:function(e){for(var t=0,r=this.getNodeCount();t<r;++t)this.getNodeAt(t).setOwner(e);for(t=0,r=this.getConnectorCount();t<r;++t)this.getConnectorAt(t).setOwner(e)},parentChanged:function(e,t){for(var r=0,i=this.getNodeCount();r<i;++r)this.getNodeAt(r).setParent(e);for(r=0,i=this.getConnectorCount();r<i;++r)this.getConnectorAt(r).setParent(e)},isEmpty:function(){return this.getNodeCount()<=0&&this.getConnectorCount()<=0},getStructureCacheData:function(e){var t=this.getStructureCache();return t&&t[e]},setStructureCacheData:function(e,t){var r=this.getParent();return r&&r.setStructureCacheData&&r.setStructureCacheData(e,t),this},clearStructureCache:function(){var e=this.getParent();return e&&e.clearStructureCache(),this},getNodeById:function(e){for(var t=this.getNodes(),r=0,i=t.length;r<i;++r)if(t[r].getId()==e)return t[r];return null},getConnectorById:function(e){for(var t=this.getConnectors(),r=0,i=t.length;r<i;++r)if(t[r].getId()==e)return t[r];return null},getObjectById:function(e){var t=this.getNodeById(e);return t||this.getConnectorById(e)},getNodeCount:function(){return this.getNodes().length},getNodeAt:function(e){return this.getNodes()[e]},indexOfNode:function(e){return this.getNodes().indexOf(e)},hasNode:function(e,t){var r=this.indexOfNode(e)>=0;if(!r&&t)for(var i=0,n=this.getNodeCount();i<n;++i){var o=this.getNodeAt(i);if(o.hasNode&&(r=o.hasNode(e,!0)),r)break}return r},indexStackOfNode:function(e){var t=this.indexOfNode(e);if(t>=0)return t;for(var r=null,i=0,n=this.getNodeCount();i<n;++i){var o=this.getNodeAt(i);if(o.indexStackOfNode&&(r=o.indexStackOfNode(e),!Kekule.ObjUtils.isUnset(r)))return"object"!=typeof r&&(r=[r]),r.unshift(i),r}return r},getNodeAtIndexStack:function(e){if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getNodeAt(e[0]),r=1,i=e.length;r<i;++r){if(!t||!t.getNodeAt)return null;t=t.getNodeAt(e[r])}return t},insertNodeBefore:function(e,t){var r=this.indexOfNode(t);r?this.insertNodeAt(e,r):this.appendNode(e)},appendNode:function(e){var t=Kekule.ArrayUtils.pushUniqueEx(this.getNodes(),e);return t.isPushed&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent()),this.notifyNodesChanged()),t.index},insertNodeAt:function(e,t){var r=this.indexOfNode(e),i=this.getNodes();return(Kekule.ObjUtils.isUnset(t)||t<0)&&(t=i.length),r>=0?(i.splice(r,1),i.splice(t,0,e)):(i.splice(t,0,e),e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent())),this.notifyNodesChanged(),t},setNodeIndex:function(e,t){var r=this.getNodes(),i=this.indexOfNode(e);i>=0&&(r.splice(i,1),r.splice(t,0,e))},removeNodeAt:function(e,t){var r=this.getNodes()[e];r&&(t||r.removeThisFromLinkedConnector(),this.getNodes().splice(e,1),r.setOwner&&r.setOwner(null),r.setParent&&r.setParent(null),this.notifyNodesChanged())},removeNode:function(e,t){var r=this.getNodes().indexOf(e);r>=0&&this.removeNodeAt(r,t)},replaceNode:function(e,t){if(!this.hasNode(e))return this;this.insertBefore(t,e);var r=this.getAnchorNodes(),i=r.indexOf(e);i>=0&&r.splice(i,1,[t]);for(var n=Kekule.ArrayUtils.clone(e.getLinkedConnectors()),o=0,a=n.length;o<a;++o){(l=n[o]).replaceConnectedObj(e,t)}if(e.getNodes&&e.getCrossConnectors){var s=Kekule.ArrayUtils.clone(e.getCrossConnectors());for(o=0,a=s.length;o<a;++o){var l=s[o];if(this.indexOfConnector(l)>=0)for(var u=0,d=l.getConnectedObjCount();u<d;++u){var c=l.getConnectedObjAt(u);e.indexOfChild(c)>=0&&l.replaceConnectedObj(c,t)}l.replaceConnectedObj(e,t)}}this.removeNode(e)},clearNodes:function(){this.clearAnchorNodes(),this.setPropStoreFieldValue("nodes",[]),this.notifyAnchorNodesChanged(),this.notifyNodesChanged()},sortNodes:function(e){e?(this.getNodes().sort(e),this.notifyNodesChanged()):Kekule.error(Kekule.$L("ErrorMsg.SORT_FUNC_UNSET"))},nodesHasCoord2D:function(e,t){return this.nodesHasCoordOfMode(Kekule.CoordMode.COORD2D,e,t)},nodesHasCoord3D:function(e,t){return this.nodesHasCoordOfMode(Kekule.CoordMode.COORD3D,e,t)},nodesHasCoordOfMode:function(e,t,r){for(var i=Kekule.CoordUtils.isZero,n=0,o=this.getNodes(),a=0,s=o.length;a<s;++a)if(o[a].hasCoordOfMode(e,t)){if(!r)return!0;if(!i(o[a].getCoordOfMode(e,t)))return!0;++n}return!!(r&&n===o.length&&n<=1)},_createAtom:function(e,t,r,i){return new Kekule.Atom(null,e,t,r,i)},appendAtom:function(e,t,r,i){var n=this._createAtom(e,t,r,i);return n&&this.appendNode(n),n},getAnchorNodeCount:function(){return this.getAnchorNodes().length},indexOfAnchorNode:function(e){return this.getAnchorNodes().indexOf(e)},getAnchorNodeAt:function(e){return this.getAnchorNodes()[e]},appendAnchorNode:function(e){if(!e)return-1;if(this.getNodes().indexOf(e)>=0){var t=Kekule.ArrayUtils.pushUniqueEx(this.getAnchorNodes(),e);return t.isPushed&&this.notifyAnchorNodesChanged(),t.index}return-1},removeAnchorNodeAt:function(e){this.getAnchorNodes()[e]&&(this.getAnchorNodes().splice(e,1),this.notifyAnchorNodesChanged())},removeAnchorNode:function(e){var t=this.getAnchorNodes().indexOf(e);t>=0&&this.removeAnchorNodeAt(t)},clearAnchorNodes:function(){this.setPropStoreFieldValue("anchorNodes",[]),this.notifyAnchorNodesChanged()},getConnectorCount:function(){return this.getConnectors().length},indexOfConnector:function(e){return this.getConnectors().indexOf(e)},getConnectorAt:function(e){return this.getConnectors()[e]},indexStackOfConnector:function(e){var t=this.indexOfConnector(e);if(t>=0)return t;for(var r=null,i=0,n=this.getNodeCount();i<n;++i){var o=this.getNodeAt(i);if(o.indexStackOfConnector&&(r=o.indexStackOfConnector(e),!Kekule.ObjUtils.isUnset(r)))return"object"!=typeof r&&(r=[r]),r.unshift(i),r}return r},getConnectorAtIndexStack:function(e){if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;if(1===e.length)return this.getConnectorAt(e[0]);for(var t=e.length-1,r=this.getNodeAt(e[0]),i=1;i<t;++i){if(!r||!r.getNodeAt)return null;r=r.getNodeAt(e[i])}return r?r.getConnectorAt(e[t]):null},insertConnectorBefore:function(e,t){var r=this.indexOfConnector(t);r?this.insertConnectorAt(e,r):this.appendConnector(e)},appendConnector:function(e){var t=Kekule.ArrayUtils.pushUniqueEx(this.getConnectors(),e);return t.isPushed&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent()),this.notifyConnectorsChanged()),t.index},insertConnectorAt:function(e,t){var r=this.indexOfConnector(e),i=this.getConnectors();(Kekule.ObjUtils.isUnset(t)||t<0)&&(t=i.length),r>=0?(i.splice(r,1),i.splice(t,0,e)):(i.splice(t,0,e),e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent())),this.notifyConnectorsChanged()},setConnectorIndex:function(e,t){var r=this.getConnectors(),i=this.indexOfConnector(e);i>=0&&(r.splice(i,1),r.splice(t,0,e))},removeConnectorAt:function(e,t){var r=this.getConnectors()[e];r&&(t||r.removeThisFromConnectedObjs(),this.getConnectors().splice(e,1),r.setOwner&&r.setOwner(null),r.setParent&&r.setParent(null),this.notifyConnectorsChanged())},removeConnector:function(e,t){var r=this.getConnectors().indexOf(e);r>=0&&this.removeConnectorAt(r,t)},clearConnectors:function(){this.setPropStoreFieldValue("connectors",[]),this.notifyConnectorsChanged()},hasConnector:function(e,t){var r=this.indexOfConnector(e)>=0;if(!r&&t)for(var i=0,n=this.getNodeCount();i<n;++i){var o=this.getNodeAt(i);if(o.hasConnector&&(r=o.hasConnector(e,!0)),r)break}return r},sortConnectors:function(e){e?(this.getConnectors().sort(e),this.notifyConnectorsChanged()):Kekule.error(Kekule.$L("ErrorMsg.SORT_FUNC_UNSET"))},_createBond:function(e,t,r){for(var i=[],n=0,o=e.length;n<o;++n){var a=e[n];DataType.isSimpleValue(a)&&(a=this.getNodeAt(a)),i.push(a)}return new Kekule.Bond(null,i,t,null,r)},appendBond:function(e,t,r){var i=this._createBond(e,t,r);return i&&this.appendConnector(i),i},_getObjsNeedToBeCascadeRemoved:function(e,t){for(var r=[],i=e.getLinkedConnectors?e.getLinkedConnectors():[],n=0,o=i.length;n<o;++n){var a=i[n];(!t||t.indexOf(a)<0)&&a.getConnectedObjs().length<=2&&Kekule.ArrayUtils.pushUnique(r,a)}if(e instanceof Kekule.ChemStructureNode);else if(e instanceof Kekule.ChemStructureConnector){var s=e.getConnectedObjs();for(n=0,o=s.length;n<o;++n){var l=s[n];(!t||t.indexOf(l)<0)&&l instanceof Kekule.ChemStructureNode&&l.getLinkedConnectors().length<=1&&Kekule.ArrayUtils.pushUnique(r,l)}}var u=[].concat(r);u.push(e);var d=[];for(n=0,o=r.length;n<o;++n){if((l=r[n])!==e)var c=this._getObjsNeedToBeCascadeRemoved(l,u);Kekule.ArrayUtils.pushUnique(d,c)}return Kekule.ArrayUtils.pushUnique(r,d),r},removeChildObj:function(e,t,r){var i;t?(i=this._getObjsNeedToBeCascadeRemoved(e),Kekule.ArrayUtils.pushUnique(i,e)):i=[e];for(var n=0,o=i.length;n<o;++n){(a=i[n])instanceof Kekule.BaseStructureConnector?this.removeConnector(a):a instanceof Kekule.BaseStructureNode&&this.removeNode(a)}if(r)for(n=i.length-1;n>=0;--n){var a;(a=i[n]).finalize&&a.finalize()}},removeChild:function(e){return this.removeChildObj(e)||this.tryApplySuper("removeChild",[e])},deleteChildObj:function(e,t){return this.removeChildObj(e,t,!0)},hasChildObj:function(e){return this.hasNode(e)||this.hasConnector(e)},getNextSiblingOfChild:function(e){if(e instanceof Kekule.SimpleStructureNode){if((t=this.indexOfNode(e))>=0)return this.getNodeAt(t+1)}else if(e instanceof Kekule.BaseStructureConnector){var t;if((t=this.indexOfConnector(e))>=0)return this.getConnectorAt(t+1)}return null},insertBefore:function(e,t){if(e instanceof Kekule.SimpleStructureNode){var r=this.indexOfNode(t);return this.insertNodeAt(e,r)}if(e instanceof Kekule.BaseStructureConnector){r=this.indexOfConnector(t);return this.insertConnectorAt(e,r)}return-1},clear:function(){this.clearNodes(),this.clearConnectors()},getChildCount:function(){return this.getNodeCount()+this.getConnectorCount()},getChildAt:function(e){var t=this.getNodeCount();return e<t?this.getNodeAt(e):e<t+this.getConnectorCount()?this.getConnectorAt(e-t):null},indexOfChild:function(e){var t;if(e instanceof Kekule.BaseStructureNode)t=this.indexOfNode(e);else if(e instanceof Kekule.BaseStructureConnector){if((t=this.indexOfConnector(e))>=0)t+=this.getNodeCount()}else t=-1;return t},indexStackOfChild:function(e){var t;if(e instanceof Kekule.BaseStructureNode)t=this.indexStackOfNode(e);else if(e instanceof Kekule.BaseStructureConnector){var r=this.getNodeCount();(t=this.indexStackOfConnector(e)).length?t[t.length-1]+=r:t+=r}else t=-1;return t},getChildAtIndexStack:function(e){if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getChildAt(e[0]),r=1,i=e.length;r<i;++r){if(!t||!t.getChildAt)return null;t=t.getChildAt(e[r])}return t},isSubFragment:function(e){return e.getNodeCount&&e.getNodeCount()>0},getSubFragments:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var i=this.getNodeAt(t);this.isSubFragment(i)&&e.push(i)}return e},hasSubFragments:function(){var e=this.getSubFragments();return e&&e.length},getLeafNodes:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var i=this.getNodeAt(t);if(this.isSubFragment(i)){if(i.getLeafNodes){var n=i.getLeafNodes();e=e.concat(n)}}else e.push(i)}return e},findDirectChildOfObj:function(e){for(var t=e;t&&this.indexOfChild(t)<0;)t=t.getParent?t.getParent():null;return t},getAllChildConnectors:function(){for(var e=[].concat(this.getConnectors()),t=this.getSubFragments(),r=0,i=t.length;r<i;++r)t[r].getAllChildConnectors&&(e=e.concat(t[r].getAllChildConnectors()));return e},getAllContainingConnectors:function(){return this.getAllChildConnectors()},getIsotopeMaps:function(){var e=this.getNodes();if(e.length<=0)return[];for(var t=function(e,t,r,i){for(var n=!1,a=0,s=e.length;a<s;++a)t.isSame(e[a].isotope)&&(n=!0,e[a].count+=r,e[a].charge+=i||0);if(!n){var l={isotope:t,count:r,charge:o.getCharge()||0};e.push(l)}return e},r=[],i=0,n=e.length;i<n;++i){var o=e[i];if(o instanceof Kekule.StructureFragment){var a=o.getIsotopeMaps();for(i=0,n=a.length;i<n;++i)r=t(r,a[i].isotope,a[i].count,a[i].charge||0)}else if(o instanceof Kekule.Atom){o.getIsotope();r=t(r,o.getIsotope(),1,o.getCharge()||0);var s=o.getHydrogenCount();if(s>0)r=t(r,Kekule.IsotopeFactory.getIsotope(1),s,0)}}return r},calcFormula:function(){var e=this.getIsotopeMaps();if(e.length<=0)return null;for(var t=new Kekule.MolecularFormula,r=0,i=e.length;r<i;++r){var n=new Kekule.Atom;n.setIsotope(e[r].isotope),t.appendSection(n,e[r].count,e[r].charge)}return t},getNodesContainBox:function(e,t,r){for(var i=t===Kekule.CoordMode.COORD3D,n={},o=0,a=e.length;o<a;++o){var s=e[o].getAbsCoordOfMode(t,r);0==o?(n.x1=n.x2=s.x,n.y1=n.y2=s.y,i&&(n.z1=n.z2=s.z)):(s.x<n.x1?n.x1=s.x:s.x>n.x2&&(n.x2=s.x),s.y<n.y1?n.y1=s.y:s.y>n.y2&&(n.y2=s.y),i&&(s.z<n.z1?n.z1=s.z:s.z>n.z2&&(n.z2=s.z)))}return n},getContainerBox:function(e,t){return this.getNodesContainBox(this.getNodes(),e,t)},getContainerBox2D:function(e){var t=this.getContainerBox(Kekule.CoordMode.COORD2D,e);return t.width=t.x2-t.x1,t.height=t.y2-t.y1,t},getContainerBox3D:function(e){var t=this.getContainerBox(Kekule.CoordMode.COORD3D,e);return t.deltaX=t.x2-t.x1,t.deltaY=t.y2-t.y1,t.deltaZ=t.z2-t.z1,t},traverse:function(t,r,i,n){for(var o={nodes:[],connectors:[]},a=e.clone(n||this.getNodes()),s=0,l=a.length;s<l;++s)a[s][this.TRAVERS_VISITED_KEY]=!1;for(;a.length;){var u;u=r&&a.indexOf(r)>=0?r:a[0];var d=this._doTravers(t,u,i,n);o.nodes=o.nodes.concat(d.nodes),o.connectors=o.connectors.concat(d.connectors),a=e.exclude(a,d.nodes)}return o},_doTravers:function(t,r,i,n){var o={nodes:[],connectors:[]},a=r;a[this.TRAVERS_VISITED_KEY]||(o.nodes.push(a),a[this.TRAVERS_VISITED_KEY]=!0,t&&t(a,!1));var s=e.clone(a.getLinkedConnectors()),l=this.getConnectors();s.sort(function(e,t){return l.indexOf(e)-l.indexOf(t)});for(var u=[],d=0,c=s.length;d<c;++d){var h=s[d],p=a.getLinkedObjsOnConnector(h);n&&(p=e.intersect(p,n));for(var g=0,f=p.length;g<f;++g){var C=p[g];if(C instanceof Kekule.BaseStructureNode)break}if(C&&!C[this.TRAVERS_VISITED_KEY])if(o.nodes.push(C),o.connectors.push(h),C[this.TRAVERS_VISITED_KEY]=!0,t&&(t(h,!0),t(C,!1)),i)u.push(C);else{var m=this._doTravers(t,C,i,n);o.nodes=o.nodes.concat(m.nodes),o.connectors=o.connectors.concat(m.connectors)}}if(i)for(d=0,c=u.length;d<c;++d){var T=u[d];m=this._doTravers(t,T,i,n);o.nodes=o.nodes.concat(m.nodes),o.connectors=o.connectors.concat(m.connectors)}return o}}),Kekule.StructureFragment=Class.create(Kekule.ChemStructureNode,{CLASS_NAME:"Kekule.StructureFragment",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},doFinalize:function(){this.hasFormula()&&this.getFormula().finalize(),this.hasCtab()&&this.getCtab().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("formula",{dataType:"Kekule.MolecularFormula",getter:function(e){return this.getPropStoreFieldValue("formula")||e&&this.createFormula(),this.getPropStoreFieldValue("formula")},setter:function(e){var t=this.getPropStoreFieldValue("formula");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.addEventListener("change",function(e){this.notifyPropSet("formula",this.getFormula())},this)),this.setPropStoreFieldValue("formula",e)}}),this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",getter:function(e){return this.getPropStoreFieldValue("ctab")||e&&this.createCtab(),this.getPropStoreFieldValue("ctab")},setter:function(e){var t=this.getPropStoreFieldValue("ctab");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.setOwner(this.getOwner()),e.addEventListener("propValueSet",function(e){"nodes"!=e.propName&&"anchorNodes"!=e.propName&&"connectors"!=e.propName||this.notifyPropSet(e.propName,e.propValue)},this),e.setEnablePropValueSetEvent(!0)),this.setPropStoreFieldValue("ctab",e)}}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}}),this.defineProp("anchorNodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getAnchorNodes():[]}}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}}),this.defineProp("crossConnectors",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){for(var e=[].concat(this.getPropStoreFieldValue("linkedConnectors")),t=0,r=this.getNodeCount();t<r;++t)for(var i=this.getNodeAt(t).getLinkedConnectors()||[],n=0,o=i.length;n<o;++n)this.indexOfConnector(i[n])<0&&Kekule.ArrayUtils.pushUnique(e,i[n]);return e}}),this.defineProp("nonHydrogenNodes",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNonHydrogenNodes():[]}}),this.defineProp("nonHydrogenConnectors",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNonHydrogenConnectors():[]}}),this.defineProp("canonicalizationInfo",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getStructureCacheData("canonicalizationInfo")},setter:function(e){this.setStructureCacheData("canonicalizationInfo",e)}}),this.defineProp("aromaticRings",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getStructureCacheData("aromaticRings");return e||(e=[],this.setStructureCacheData("aromaticRings",e)),e},setter:function(e){this.setStructureCacheData("aromaticRings",e)}}),this.defineProp("flattenedShadow",{dataType:"Kekule.StructureFragmentShadow",serializable:!1,scope:Class.PropertyScope.PRIVATE,getter:function(e){var t=null;if(Kekule.ObjUtils.isUnset(e)&&(e=!0),this.getFlattenedShadowOnSelf())return null;if(!(t=this.getPropStoreFieldValue("flattenedShadow"))&&e){var r=(t=new Kekule.StructureFragmentShadow(this)).getShadowFragment();r.unmarshalAllSubFragments(!0),this._copyAdditionalInfoToShadowFragment(r,t.getSourceToShadowMap(),t.getShadowToSourceMap()),this.setPropStoreFieldValue("flattenedShadow",t)}return t}}),this.defineProp("flattenedShadowOnSelf",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PROVATE,setter:null,getter:function(){var e=this.setPropStoreFieldValue("flattenedShadowOnSelf");return Kekule.ObjUtils.isUnset(e)&&(e=!this.hasSubFragments(),this.setPropStoreFieldValue("flattenedShadowOnSelf",e)),e}})},getAutoIdPrefix:function(){return"f"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["ctab","formula","nodes","anchorNodes","connectors"])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){var i=this.hasCtab(),n=e.hasCtab&&e.hasCtab();if(!(r=i?n?0:1:n?-1:0)){var o=this.hasFormula(),a=e.hasFormula&&e.hasFormula();r=o?a?0:1:a?-1:0}if(!r&&this.hasCtab()){if(0===r&&this.getNonHydrogenNodes&&e.getNonHydrogenNodes){var s=function(e,t){var r;e instanceof Kekule.ChemStructureConnector?r=e.getConnectedNonHydrogenObjs():e instanceof Kekule.ChemStructureNode&&(r=e.getLinkedNonHydrogenObjs());for(var i=[],n=0,o=r.length;n<o;++n){var a=r[n],s=t.indexOfNode(a);s>=0&&i.push(s)}return i.sort(),i},l=this.getNonHydrogenNodes(),u=e.getNonHydrogenNodes();if(0===(r=l.length-u.length))for(var d=0,c=l.length;d<c&&0===(r=this.doCompareOnValue(l[d],u[d],t));++d){var h=s(l[d],this),p=s(u[d],e);if(0!==(r=Kekule.ArrayUtils.compare(h,p)))break}}if(0===r&&this.getConnectors&&e.getConnectors){var g=this.getNonHydrogenConnectors(),f=e.getNonHydrogenConnectors();if(0===(r=g.length-f.length))for(d=0,c=g.length;d<c&&0===(r=this.doCompareOnValue(g[d],f[d],t));++d){h=s(g[d],this),p=s(f[d],e);if(0!==(r=Kekule.ArrayUtils.compare(h,p)))break}}if(0===r){var C=this.getNonHydrogenNodes(),m=e.getNonHydrogenNodes(),T=this.traverse(null,C[C.length-1],!0,C),E=e.traverse(null,m[m.length-1],!0,m);for(d=0,c=T.nodes.length;d<c;++d){var _=T.nodes[d],S=E.nodes[d];if(0!==(r=this.doCompareOnValue(_,S,t)))break}if(0===r)for(d=0,c=T.connectors.length;d<c;++d){var O=T.connectors[d],y=E.connectors[d];if(0!==(r=this.doCompareOnValue(O,y,t)))break}}}}return r},structureChange:function(e){this.setPropStoreFieldValue("flattenedShadowOnSelf",null);var t=this.getFlattenedShadow(!1);t&&(t.finalize(),this.setPropStoreFieldValue("flattenedShadow",null)),this.tryApplySuper("structureChange",[e])},clearStructureFlags:function(){this.tryApplySuper("clearStructureFlags");for(var e=0,t=this.getChildCount();e<t;++e){var r=this.getChildAt(e);r.clearStructureFlags&&r.clearStructureFlags()}},ownerChanged:function(e,t){this.hasCtab()&&this.getCtab().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){if(this.hasFormula())this.getFormula()===e&&this.removeFormula();else if(this.hasCtab()){var t=this.getCtab();t===e?this.removeCtab():t.hasChildObj(e)&&t.removeChildObj(e)}this.tryApplySuper("_removeChildObj",[e])},isEmpty:function(){var e;return(e=!this.hasFormula())&&((e=!this.hasCtab())||(e=this.getCtab().isEmpty())),e},isCtabEmpty:function(){return!this.hasCtab()||this.getCtab().isEmpty()},doGetLinkedConnectors:function(){return this.getCrossConnectors()},appendLinkedConnector:function(e){var t=this.getCurrConnectableObj();return t&&t!==this?t.appendLinkedConnector(e):this.tryApplySuper("appendLinkedConnector",[e])},getCurrConnectableObj:function(){var e=this.getAnchorNodeCount()>0?this.getAnchorNodes():this.getNodes();if(e.length<=0)return this;for(var t=this.getCrossConnectors(),r=null,i=null,n=0,o=e.length;n<o;++n){var a=e[n],s=a.getLinkedConnectors(),l=Kekule.ArrayUtils.intersect(s,t).length;(null===r||r>l)&&(r=l,i=a)}return i},getActualConnectedObjToConnector:function(e){if(this.indexOfConnector(e)>=0)return null;if(e.indexOfConnectedObj(this)>=0)return this;for(var t=0,r=e.getConnectedObjCount();t<r;++t){var i=e.getConnectedObjAt(t);if(i.isChildOf(this))return i}return null},createCtab:function(){var e=new Kekule.StructureConnectionTable(this.getOwner(),this);this.setCtab(e)},createFormula:function(){var e=new Kekule.MolecularFormula(this);this.setFormula(e)},hasCtab:function(){return!!this.getPropStoreFieldValue("ctab")},hasFormula:function(){return!!this.getPropStoreFieldValue("formula")},removeFormula:function(){var e=this.getPropStoreFieldValue("formula");return e&&(e.finalize(),e=null,this.setPropStoreFieldValue("formula",null)),this},removeCtab:function(){var e=this.getPropStoreFieldValue("ctab");return e&&(e.finalize(),e=null,this.setPropStoreFieldValue("ctab",null)),this},getContainerBox:function(e,t){return this.hasCtab()?this.getCtab().getContainerBox(e,t):this.tryApplySuper("getContainerBox",[e])},getNodeById:function(e){return this.hasCtab()?this.getCtab().getNodeById(e):null},getConnectorById:function(e){return this.hasCtab()?this.getCtab().getConnectorById(e):null},getObjectById:function(e){var t=this.getNodeById(e);return t||this.getConnectorById(e)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(e){return this.hasCtab()?this.getCtab().getNodeAt(e):null},indexOfNode:function(e){return this.hasCtab()?this.getCtab().indexOfNode(e):-1},hasNode:function(e,t){return this.hasCtab()?this.getCtab().hasNode(e,t):null},indexStackOfNode:function(e){return this.hasCtab()?this.getCtab().indexStackOfNode(e):null},getNodeAtIndexStack:function(e){return this.hasCtab()?this.getCtab().getNodeAtIndexStack(e):null},getDirectChildOfNestedNode:function(e){var t=e.getParent();if(t){if(t===this)return t;for(var r=e;t&&t.getParent&&t!==this;)r=t,t=t.getParent();return t===this?r:null}return null},insertNodeBefore:function(e,t){return this.doGetCtab(!0).insertNodeBefore(e,t)},appendNode:function(e){return this.doGetCtab(!0).appendNode(e)},insertNodeAt:function(e,t){return this.doGetCtab(!0).insertNodeAt(e,t)},removeNodeAt:function(e,t){return this.hasCtab()?this.getCtab().removeNodeAt(e,t):null},removeNode:function(e,t){return this.hasCtab()?this.getCtab().removeNode(e,t):null},replaceNode:function(e,t){return this.hasCtab()?this.getCtab().replaceNode(e,t):null},clearNodes:function(){if(this.hasCtab())return this.getCtab().clearNodes()},sortNodes:function(e){if(this.hasCtab())return this.getCtab().sortNodes(e)},nodesHasCoord2D:function(e,t){return!!this.hasCtab()&&this.getCtab().nodesHasCoord2D(e,t)},nodesHasCoord3D:function(e,t){return!!this.hasCtab()&&this.getCtab().nodesHasCoord3D(e,t)},nodesHasCoordOfMode:function(e,t,r){return!!this.hasCtab()&&this.getCtab().nodesHasCoordOfMode(e,t,r)},isNodeInAromaticRing:function(e){for(var t=this.getAromaticRings(),r=0,i=t.length;r<i;++r){if(t[r].nodes.indexOf(e)>=0)return!0}return!1},appendAtom:function(e,t,r,i){return this.doGetCtab(!0).appendAtom(e,t,r,i)},getAnchorNodeCount:function(){return this.hasCtab()?this.getCtab().getAnchorNodeCount():0},getAnchorNodeAt:function(e){return this.hasCtab()?this.getCtab().getAnchorNodeAt(e):null},indexOfAnchorNode:function(e){return this.hasCtab()?this.getCtab().indexOfAnchorNode(e):-1},appendAnchorNode:function(e){return this.doGetCtab(!0).appendAnchorNode(e)},removeAnchorNodeAt:function(e){return this.hasCtab()?this.getCtab().removeAnchorNodeAt(e):null},removeAnchorNode:function(e){return this.hasCtab()?this.getCtab().removeAnchorNode(e):null},clearAnchorNodes:function(){if(this.hasCtab())return this.getCtab().clearAnchorNodes()},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(e){return this.hasCtab()?this.getCtab().getConnectorAt(e):null},indexOfConnector:function(e){return this.hasCtab()?this.getCtab().indexOfConnector(e):-1},hasConnector:function(e,t){return this.hasCtab()?this.getCtab().hasConnector(e,t):null},insertConnectorBefore:function(e,t){return this.doGetCtab(!0).insertConnectorBefore(e,t)},appendConnector:function(e){return this.doGetCtab(!0).appendConnector(e)},insertConnectorAt:function(e,t){return this.doGetCtab(!0).insertConnectorAt(e,t)},removeConnectorAt:function(e,t){return this.hasCtab()?this.getCtab().removeConnectorAt(e,t):null},removeConnector:function(e,t){return this.hasCtab()?this.getCtab().removeConnector(e,t):null},clearConnectors:function(){if(this.hasCtab())return this.getCtab().clearConnectors()},sortConnectors:function(e){if(this.hasCtab())return this.getCtab().sortConnectors(e)},isConnectorInAromaticRing:function(e){for(var t=this.getAromaticRings(),r=0,i=t.length;r<i;++r){if(t[r].connectors.indexOf(e)>=0)return!0}return!1},appendBond:function(e,t,r){return this.doGetCtab(!0).appendBond(e,t,r)},_getObjsNeedToBeCascadeRemoved:function(e,t){return this.hasCtab()?this.getCtab()._getObjsNeedToBeCascadeRemoved(e,t):[]},removeChildObj:function(e,t,r){this.hasCtab()&&this.getCtab().removeChildObj(e,t,r)},hasChildObj:function(e){return!!this.hasCtab()&&this.getCtab().hasChildObj(e)},getNextSiblingOfChild:function(e){return this.hasCtab()&&this.getCtab().getNextSiblingOfChild(e)||this.tryApplySuper("getNextSiblingOfChild",[e])},getChildSubgroupNames:function(){return["node","connector"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.SimpleStructureNode?"node":e instanceof Kekule.BaseStructureConnector?"connector":this.tryApplySuper("getBelongChildSubGroupName",[e])},isSubFragment:function(e){return e.getNodeCount&&e.getNodeCount()>0},getSubFragments:function(){return this.hasCtab()?this.getCtab().getSubFragments():[]},hasSubFragments:function(){return!!this.hasCtab()&&this.getCtab().hasSubFragments()},getLeafNodes:function(){return this.hasCtab()?this.getCtab().getLeafNodes():[]},findDirectChildOfObj:function(e){return this.hasCtab()?this.getCtab().findDirectChildOfObj(e):null},getAllChildConnectors:function(){return this.hasCtab()?this.getCtab().getAllChildConnectors():[]},getAllContainingConnectors:function(){return this.hasCtab()?this.getCtab().getAllContainingConnectors():[]},getIsotopeMaps:function(){return this.hasCtab()?this.getCtab().getIsotopeMaps():[]},clear:function(){this.hasCtab()&&this.setCtab(void 0),this.hasFormula()&&this.setFormula(void 0)},clean:function(e){var t=Object.extend({},Kekule.globalOptions.algorithm.structureClean.structureCleanOptions);return t=Object.extend(t,e||{}),this.doClean(t)},doClean:function(e){if(e.hangingChemConnector)for(var t=this.getConnectorCount()-1;t>=0;--t){var r=this.getConnectorAt(t);r instanceof Kekule.ChemStructureConnector&&r.getConnectedObjCount()<2&&this.removeConnectorAt(t)}var i=this.getNodeCount();for(t=i-1;t>=0;--t){var n=this.getNodeAt(t);n instanceof Kekule.ChemStructureNode&&(this.isSubFragment(n)&&n.doClean?n.doClean(e):e.orphanChemNode&&n.getLinkedConnectorCount()<1&&i>1&&this.removeNodeAt(t))}return this},clearExplicitBondHydrogens:function(e,t,r){var i=this,n=function(e){var t=e.getLinkedConnectors(),r=1===t.length;if(r){var i=t[0];if(r=i.isSingleBond&&i.isSingleBond()&&i.getStereo&&(!i.getStereo()||i.getStereo()===Kekule.BondStereo.NONE)){var n=e.getLinkedObjsOnConnector(i);r=1===n.length&&(!n[0].isHydrogenAtom||!n[0].isHydrogenAtom())}}return r},o=function(e,t){for(var r=e.getLinkedConnectors(),n=r.length;n>=0;--n){var o=r[n];i.hasConnector(o,!0)&&i.removeConnector(o,!1)}i.removeNodeAt(t,!1)},a=function(e,t,r){for(var n=e.getLinkedConnectors(),o=n.length;o>=0;--o){var a=n[o];if(i.hasConnector(a,!0)){if(r){var s=e.getLinkedObjsOnConnector(a)[0],l=s.getStructureCacheData("omittedBondHydrogenAtomCount")||0;s.setStructureCacheData("omittedBondHydrogenAtomCount",l+1)}i.removeConnector(a,!1)}}i.removeNodeAt(t,!1)};if(e){var s=this.getAutoClearStructureCache();this.setAutoClearStructureCache(!1)}this.beginUpdate();try{for(var l=this.getNodeCount()-1;l>=0;--l){var u=this.getNodeAt(l);u instanceof Kekule.ChemStructureNode&&(this.isSubFragment(u)&&u.clearExplicitBondHydrogens?(u.clearExplicitBondHydrogens(e,t,r),u.getNodeCount()<=0&&o(u,l)):u.isHydrogenAtom()&&!u.getCharge()&&(t||n(u))&&a(u,l,!0))}}finally{this.endUpdate(),e&&this.setAutoClearStructureCache(s)}return this},calcFormula:function(){return this.hasCtab()?this.getCtab().calcFormula():this.hasFormula()?this.getFormula():null},marshalSubFragment:function(e,t){if(this.hasCtab()){this.beginUpdate();try{this.appendNode(t);for(var r=[],i=[],n=[],o=[],a=0,s=e.length;a<s;++a){var l=e[a];if(!(this.indexOfNode(l)<0)){for(var u=!1,d=l.getLinkedConnectors(),c=0,h=d.length;c<h;++c){for(var p=d[c],g=!1,f=p.getConnectedObjs(),C=0,m=f.length;C<m;++C){var T=f[C];T!=l&&e.indexOf(T)<0&&(u=!0,g=!0)}g?Kekule.ArrayUtils.pushUnique(o,p):Kekule.ArrayUtils.pushUnique(n,p)}Kekule.ArrayUtils.pushUnique(r,l),u&&Kekule.ArrayUtils.pushUnique(i,l)}}for(a=n.length-1;a>=0;--a)this.removeConnector(n[a],!0);for(a=r.length-1;a>=0;--a)this.removeNode(r[a],!0);t.beginUpdate();try{for(a=0,s=r.length;a<s;++a)t.appendNode(r[a]);for(a=0,s=i.length;a<s;++a)t.appendAnchorNode(i[a]);for(a=0,s=n.length;a<s;++a)t.appendConnector(n[a])}finally{t.endUpdate()}}finally{this.endUpdate()}return t}return null},unmarshalSubFragment:function(e,t){if(this.hasCtab()){this.beginUpdate();try{e.beginUpdate();try{t&&e.unmarshalAllSubFragments&&e.unmarshalAllSubFragments(t);var r=this.getCtab();Kekule.StructureFragment.moveChildBetweenStructFragment(e,this,e.getNodes(),e.getConnectors(),!0),e.clear(),r.removeNode(e)}finally{e.endUpdate(),e.finalize()}}finally{this.endUpdate()}}},unmarshalAllSubFragments:function(e){var t=this.getSubFragments();if(t)for(var r=0,i=t.length;r<i;++r)this.unmarshalSubFragment(t[r],e)},recalcCoords:function(){if(this.hasCtab()){this.beginUpdate();try{for(var e={},t={},r=this.getAnchorNodeCount(),i=0,n=r;i<n;++i){var o=this.getAnchorNodeAt(i);e=Kekule.CoordUtils.add(e,o.getCoord2D()||{}),t=Kekule.CoordUtils.add(t,o.getCoord3D()||{})}var a=Kekule.ObjUtils.notUnset,s=a(e.x)||a(e.y),l=a(t.x)||a(t.y)||a(t.z);if(s){var u=Kekule.CoordUtils.substract({},e);this.setCoord2D(Kekule.CoordUtils.substract(this.fetchCoord2D(),u))}if(l){var d=Kekule.CoordUtils.substract({},t);this.setCoord3D(Kekule.CoordUtils.substract(this.fetchCoord3D(),d))}for(i=0,n=this.getNodeCount();i<n;++i){o=this.getNodeAt(i);s&&o.setCoord2D(Kekule.CoordUtils.add(o.fetchCoord2D(),u)),l&&o.setCoord3D(Kekule.CoordUtils.add(o.fetchCoord3D(),d))}}finally{this.endUpdate()}}},_copyAdditionalInfoToShadowFragment:function(e,t,r){var i=this.getAromaticRings();if(i&&i.length){for(var n=[],o=0,a=i.length;o<a;++o){for(var s=i[o],l=[],u=[],d=0,c=s.nodes.length;d<c;++d){(h=t.get(s.nodes[d]))&&l.push(h)}for(d=0,c=s.connectors.length;d<c;++d){var h;(h=t.get(s.connectors[d]))&&u.push(h)}var p=Object.extend({},s);p.nodes=l,p.connectors=u,n.push(p)}e.setAromaticRings(n)}},getFlattenedShadowFragment:function(e){if(this.getFlattenedShadowOnSelf())return this;var t=this.getFlattenedShadow(e);return t?t.getShadowFragment():null},getFlatternedShadowShadowObj:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t);return r?r.getShadowObj(e):null},getFlatternedShadowSourceObj:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t);return r?r.getSourceObj(e):null},getFlatternedShadowShadowObjs:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t),i=[];if(r)for(var n=0,o=e.length;n<o;++n)i.push(r.getShadowObj(e[n]));return i},getFlatternedShadowSourceObjs:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t),i=[];if(r)for(var n=0,o=e.length;n<o;++n)i.push(r.getSourceObj(e[n]));return i},createShadow:function(){var e=new Kekule.StructureFragmentShadow(this);return this._copyAdditionalInfoToShadowFragment(e.getShadowFragment(),e.getSourceToShadowMap(),e.getShadowToSourceMap()),e},traverse:function(e,t,r,i){return this.hasCtab()?this.getCtab().traverse(e,t,r,i):null}}),Kekule.StructureFragment.moveChildBetweenStructFragment=function(e,t,r,i,n){var o=Kekule.CoordUtils;e.beginUpdate(),t.beginUpdate();var a=e.getAnchorNodes();try{for(var s=e.getAbsCoord2D(),l=e.getAbsCoord3D(),u=t.getAbsCoord2D(),d=t.getAbsCoord3D(),c=o.substract(s,u),h=o.substract(l,d),p=Kekule.ArrayUtils.clone(r),g=Kekule.ArrayUtils.clone(i),f=0,C=p.length;f<C;++f){var m=p[f];if((O=e.indexOfNode(m))>=0){e.removeNodeAt(O,!0);var T=m.getCoord2D();if(T){var E=o.add(T,c);m.setCoord2D(E)}var _=m.getCoord3D();if(_){var S=o.add(_,h);m.setCoord2D(S)}t.appendNode(m),a.indexOf(m)>=0&&(e.removeAnchorNode(m),n||t.appendAnchorNode(m))}}for(f=0,C=g.length;f<C;++f){var O,y=g[f];(O=e.indexOfConnector(y))>=0&&(e.removeConnectorAt(O,!0),t.appendConnector(y))}}finally{t.endUpdate(),e.endUpdate()}},Kekule.StructureFragmentShadow=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureFragmentShadow",initialize:function(e){if(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("shadowToSourceMap",new Kekule.MapEx),this.setPropStoreFieldValue("sourceToShadowMap",new Kekule.MapEx);var t=this._createShadowFragment(e,this.getSourceToShadowMap(),this.getShadowToSourceMap());this.setPropStoreFieldValue("shadowFragment",t)}else Kekule.error(Kekule.$L("ErrorMsg.SOURCE_FRAGMENT_NOT_SET"))},doFinalize:function(){this.getShadowToSourceMap().finalize(),this.getSourceToShadowMap().finalize(),this.getShadowFragment().finalize(),this.setPropStoreFieldValue("shadowToSourceMap",null),this.setPropStoreFieldValue("sourceToShadowMap",null),this.setPropStoreFieldValue("shadowFragment",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("shadowFragment",{dataType:"Kekule.StructureFragment",setter:null}),this.defineProp("sourceToShadowMap",{dataType:"Kekule.MapEx",setter:null}),this.defineProp("shadowToSourceMap",{dataType:"Kekule.MapEx",setter:null})},_createShadowFragment:function(e,t,r){var i=e.clone();return this._mapFragmentChildren(e,i,t,r),i},_mapFragmentChildren:function(e,t,r,i){for(var n=0,o=e.getChildCount();n<o;++n){var a=e.getChildAt(n),s=t.getChildAt(n);r.set(a,s),i.set(s,a),a.getChildCount&&s.getChildCount&&this._mapFragmentChildren(a,s,r,i)}},getShadowObj:function(e){return this.getSourceToShadowMap().get(e)},getSourceObj:function(e){return this.getShadowToSourceMap().get(e)}}),Kekule.SubGroup=Class.create(Kekule.StructureFragment,{CLASS_NAME:"Kekule.SubGroup",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,i,n]),this.setPropStoreFieldValue("abbr",t),this.setPropStoreFieldValue("name",r)},initProperties:function(){this.defineProp("abbr",{dataType:DataType.STRING}),this.defineProp("formulaText",{dataType:DataType.STRING}),this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"g"},doPropChanged:function(e,t){return"anchorNodes"==e&&this.recalcCoords(),this.tryApplySuper("doPropChanged",[e,t])},getLabel:function(){return this.getName()||this.getAbbr()||this.getFormulaText()||Kekule.ChemStructureNodeLabels.SUBGROUP}}),Kekule.RGroup=Kekule.SubGroup,Kekule.Molecule=Class.create(Kekule.StructureFragment,{CLASS_NAME:"Kekule.Molecule",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("name",t),r&&this.setCtab(new Kekule.StructureConnectionTable)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"m"}}),Kekule.BaseStructureConnector=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.BaseStructureConnector",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setConnectedObjs(t||[])},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=this.getPropStoreFieldValue("connectedObjs");t||(this.setPropStoreFieldValue("connectedObjs",[]),t=this.getPropStoreFieldValue("connectedObjs"));for(var r=0,i=t.length;r<i;++r)t[r].removeLinkedConnector(this);if(e){for(r=0,i=e.length;r<i;++r)this.assertConnectedObjLegal(e[r]);for(r=0,i=e.length;r<i;++r){var n=e[r],o=n.getCurrConnectableObj?n.getCurrConnectableObj():n;Kekule.ArrayUtils.pushUnique(t,o)}}else this.setPropStoreFieldValue("connectedObjs",[]);for(r=0,i=(t=this.getPropStoreFieldValue("connectedObjs")).length;r<i;++r)t[r].appendLinkedConnector(this);this.notifyConnectedObjsChanged()}}),this.defineProp("neighboringConnectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=this.getConnectedObjs(),r=0,i=t.length;r<i;++r){var n=t[r];n.getLinkedConnectors&&Kekule.ArrayUtils.pushUnique(e,n.getLinkedConnectors()||[])}return Kekule.ArrayUtils.remove(e,this),e}})},getAutoIdPrefix:function(){return"c"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["connectedObjs"])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"connectedObjCount")){var i=this.getConnectedObjCount(),n=e.getConnectedObjCount&&e.getConnectedObjCount();r=this.doCompareOnValue(i,n,t)}return r},notifyConnectedObjsChanged:function(){this.notifyPropSet("connectedObjs",this.getPropStoreFieldValue("connectedObjs"))},assertConnectedObjLegal:function(e){if(e&&e.getOwner)return!e.getOwner()||e.getOwner()==this.getOwner()||(Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.UNABLE_ADD_DIFF_OWNER_OBJ"):"Object with different owner can not be linked to connector"),!1);Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.UNABLE_ADD_MISTYPED_NODE"):"Unable to link mistyped node to connector")},connectedObjAdded:function(e){this.notifyConnectedObjsChanged()},getConnectedObjCount:function(){return this.getConnectedObjs().length},indexOfConnectedObj:function(e){return this.getConnectedObjs().indexOf(e)},getConnectedObjAt:function(e){return this.getConnectedObjs()[e]},setConnectedObjAt:function(e,t){this.assertConnectedObjLegal(t);var r=this.getConnectedObjs()[e];r&&r.removeLinkedConnector(this),this.insertConnectedObjAt(t,e),this.connectedObjAdded(t)},appendConnectedObj:function(e){this.assertConnectedObjLegal(e);var t=e.getCurrConnectableObj?e.getCurrConnectableObj():e,r=this._doAppendConnectedObj(t);return t&&t.appendLinkedConnector(this),r},_doAppendConnectedObj:function(e){var t=Kekule.ArrayUtils.pushUniqueEx(this.getConnectedObjs(),e);return t.isPushed&&this.connectedObjAdded(e),t.index},insertConnectedObjBefore:function(e,t){this.assertConnectedObjLegal(e);var r=t?t.getCurrConnectableObj?t.getCurrConnectableObj():t:null,i=r?this.indexOfConnectedObj(r):-1;return i<0?this.appendConnectedObj(e):this.insertConnectedObjAt(e,i)},insertConnectedObjAt:function(e,t){t||(t=0),this.assertConnectedObjLegal(e);var r=e.getCurrConnectableObj?e.getCurrConnectableObj():e,i=this.indexOfConnectedObj(r),n=this.getConnectedObjs();i>=0?(n.splice(i,1),n.splice(t,0,r),this.notifyConnectedObjsChanged()):(n.splice(t,0,r),r&&r.appendLinkedConnector(this),this.connectedObjAdded(r))},removeConnectedObjAt:function(e){var t=this.getConnectedObjs()[e];t&&(this._doRemoveConnectedObjAt(e),t._doRemoveLinkedConnectorAt(t.indexOfLinkedConnector(this)),this.notifyConnectedObjsChanged())},_doRemoveConnectedObjAt:function(e){this.getConnectedObjs().splice(e,1)},removeConnectedObj:function(e){var t=this.getConnectedObjs().indexOf(e);t>=0&&this.removeConnectedObjAt(t)},replaceConnectedObj:function(e,t){var r=this.indexOfConnectedObj(e);r>=0&&this.setConnectedObjAt(r,t)},clearConnectedObjs:function(){this.setConnectedObjs([])},hasConnectedObj:function(e){return this.getConnectedObjs().indexOf(e)>=0},isConnectingWithObj:function(e){return this.hasConnectedObj(e)},sortConnectedObjs:function(e){this.getConnectedObjs().sort(e)},reverseConnectedObjOrder:function(){this.setPropStoreFieldValue("connectedObjs",Kekule.ArrayUtils.reverse(this.getConnectedObjs())),this.notifyConnectedObjsChanged()},removeThisFromConnectedObjs:function(){for(var e=this.getConnectedObjCount()-1;e>=0;--e){this.getConnectedObjAt(e).removeLinkedConnector(this)}},getConnectedSiblings:function(){for(var e=this.getConnectedObjs(),t=[],r=this.getParent(),i=function(e){if(e.getParent){var t=e.getParent();return t===r?t:i(t)}return e},n=0,o=e.length;n<o;++n){var a=e[n];if(a.getParent&&a.getParent()!==r){var s=i(a);s&&t.push(s)}else t.push(a)}return t},isConnectingConnector:function(){for(var e=0,t=this.getConnectedObjCount();e<t;++e){if(this.getConnectedObjAt(e)instanceof Kekule.ChemStructureConnector)return!0}return!1}}),Kekule.ChemStructureConnector=Class.create(Kekule.BaseStructureConnector,{CLASS_NAME:"Kekule.ChemStructureConnector",initProperties:function(){this.defineProp("parity",{dataType:DataType.INT}),this.defineProp("connectedChemNodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=0,r=this.getConnectedObjCount();t<r;++t){var i=this.getConnectedObjAt(t);i instanceof Kekule.ChemStructureNode&&e.push(i)}return e}})},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof Kekule.ChemStructureNode||e instanceof Kekule.BaseStructureConnector)},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"stereo")){var i=this.getParity()||Kekule.StereoParity.UNKNOWN,n=e.getParity&&e.getParity()||Kekule.StereoParity.UNKNOWN;r=this.doCompareOnValue(i,n,t)}return r},clearStructureFlags:function(){this.setParity(Kekule.StereoParity.NONE)},getConnectedChemNodeCount:function(){return this.getConnectedChemNodes().length},getConnectedNonHydrogenObjs:function(){for(var e=[],t=this.getConnectedObjs(),r=0,i=t.length;r<i;++r){var n=t[r];n.isHydrogenAtom&&n.isHydrogenAtom()||e.push(n)}return e},isNormalConnectorToHydrogen:function(){return this.getConnectedNonHydrogenObjs().length<=1}}),Kekule.BondStereo={NONE:0,UP:1,UP_INVERTED:2,DOWN:3,DOWN_INVERTED:4,UP_OR_DOWN:8,UP_OR_DOWN_INVERTED:9,CLOSER:10,E_OR_Z:20,E:21,Z:22,E_Z_BY_COORDINATES:23,CIS_OR_TRANS:30,CIS:31,TRANS:32,getInvertedDirection:function(e){var t=Kekule.BondStereo;switch(e){case t.UP:return t.UP_INVERTED;case t.UP_INVERTED:return t.UP;case t.DOWN:return t.DOWN_INVERTED;case t.DOWN_INVERTED:return t.DOWN;case t.UP_OR_DOWN:return t.UP_OR_DOWN_INVERTED;default:return e}}},Kekule.Bond=Class.create(Kekule.ChemStructureConnector,{CLASS_NAME:"Kekule.Bond",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,t||[]]),(r||i||n)&&this.setBondForm(Kekule.BondFormFactory.getBondForm(r,i,n))},initProperties:function(){this.defineProp("bondForm",{dataType:"Kekule.BondForm",serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("bondType",{dataType:DataType.STRING,enumSource:Kekule.BondType,getter:function(){var e=this.getBondForm();return e?e.getBondType():Kekule.BondType.DEFAULT},setter:function(e){this.changeBondForm(this.getBondOrder(),Kekule.ElectronSet.UNSET_ELECTRONCOUNT,e)}}),this.defineProp("bondOrder",{dataType:DataType.INT,enumSource:Kekule.BondOrder,getter:function(){var e=this.getBondForm();return e?e.getBondOrder():Kekule.BondOrder.UNSET},setter:function(e){this.changeBondForm(e,Kekule.ElectronSet.UNSET_ELECTRONCOUNT,this.getBondType())}}),this.defineProp("bondValence",{dataType:DataType.INT,serializable:!1,getter:function(){var e=this.getBondForm();return e?e.getBondValence():0},setter:null}),this.defineProp("electronCount",{dataType:DataType.FLOAT,getter:function(){if(this.isAromatic())return 3;var e=this.getBondForm();return e?e.getElectronCount():Kekule.ElectronSet.UNSET_ELECTRONCOUNT},setter:function(e){var t=this.getBondOrder();this.changeBondForm(t,e,this.getBondType())}}),this.defineProp("stereo",{dataType:DataType.INT,enumSource:Kekule.BondStereo,defaultValue:Kekule.BondStereo.NONE}),this.defineProp("isInAromaticRing",{dataType:DataType.BOOL,setter:null,getter:function(){var e=this.getParent();return!(!e||!e.isConnectorInAromaticRing)&&e.isConnectorInAromaticRing(this)}}),this.defineProp("neighboringBonds",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=this.getNeighboringConnectors()||[],t=[],r=0,i=e.length;r<i;++r)e[r]instanceof Kekule.Bond&&t.push(e[r]);return t}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("stereo",Kekule.BondStereo.NONE)},getAutoIdPrefix:function(){return"b"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["bondForm","stereo"])},clearStructureFlags:function(){this.setPropStoreFieldValue("isInAromaticRing",null)},doGetParity:function(){return this.isDoubleBond()?this.tryApplySuper("doGetParity"):null},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(e,"bondType")&&t.push("bondType"),t},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(t,"connectedObjCount")){var i=this.getConnectedObjCount(),n=e.getConnectedObjCount&&e.getConnectedObjCount();r=this.doCompareOnValue(i,n,t)}if(!r&&this._getComparisonOptionFlagValue(t,"bondOrder")){var o=Math.round(this.getElectronCount()),a=Math.round(e.getElectronCount());r=this.doCompareOnValue(o,a,t)}}return r},changeBondForm:function(e,t,r){this.setBondForm(Kekule.BondFormFactory.getBondForm(e,t,r))},canInvertBondDirection:function(){var e=Kekule.BondType,t=this.getBondType();return[e.COVALENT,e.IONIC,e.METALLIC,e.HYDROGEN,e.UNKNOWN,e.TRANSITION].indexOf(t)>=0},invertBondDirection:function(){this.setStereo(Kekule.BondStereo.getInvertedDirection(this.getStereo()))},reverseConnectedObjOrder:function(){this.canInvertBondDirection()&&(this.tryApplySuper("reverseConnectedObjOrder"),this.invertBondDirection())},normalizeDirection:function(){var e=Kekule.BondStereo,t=[e.UP_INVERTED,e.DOWN_INVERTED,e.UP_OR_DOWN_INVERTED],r=this.getBondStereo();t.indexOf(r)>=0&&this.reverseConnectedObjOrder()},isCovalentBond:function(){return this.getBondType()===Kekule.BondType.COVALENT},isSingleBond:function(){return this.getBondType()===Kekule.BondType.COVALENT&&this.getBondOrder()===Kekule.BondOrder.SINGLE&&!this.getIsInAromaticRing()},isDoubleBond:function(){return this.getBondType()===Kekule.BondType.COVALENT&&this.getBondOrder()===Kekule.BondOrder.DOUBLE&&!this.getIsInAromaticRing()},isTripleBond:function(){return this.getBondType()===Kekule.BondType.COVALENT&&this.getBondOrder()===Kekule.BondOrder.TRIPLE},isAromatic:function(){return(!!this.getIsInAromaticRing()||this.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC)&&this.getBondType()===Kekule.BondType.COVALENT},isBondBetween:function(e,t){var r,i,n=this.getConnectedObjs();if(2!==n.length)return!1;for(var o=0,a=n.length;o<a;++o){var s=n[o];if(s instanceof Kekule.Atom&&(s.isElement(e)?r=!0:s.isElement(t)&&(i=!0),r&&i))return!0}return!1}}),Kekule.ChemStructureObjectGroup=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.ChemStructureObject","Kekule.ChemStructureObjectGroup"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("items",[]),this.setPropStoreFieldValue("raiseExceptionOnTypeMismatch",[])},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY}),this.defineProp("raiseExceptionOnTypeMismatch",{dataType:DataType.BOOL,defaultValue:!0,scope:Class.PropertyScope.PUBLIC})},getAutoIdPrefix:function(){return"sg"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["items"])},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&t.push("items"),t},ownerChanged:function(e,t){for(var r=this.getItems(),i=0,n=r.length;i<n;++i){var o=r[i].obj;o&&o.setOwner&&o.setOwner(e)}this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){var t=this.indexOfObj(e);t<0&&(t=this.indexOfItem(e)),t>=0&&this.removeObjAt(t),this.tryApplySuper("_removeChildObj",[e])},getObjectBaseClasses:function(){return this.getPrototype().ITEM_BASE_CLASSES},ensureItemClass:function(e){var t=this.getObjectBaseClasses();if(t.length>0){for(var r=0,i=t.length;r<i;++r)if(e instanceof ClassEx.findClass(t[r]))return!0;if(this.getRaiseExceptionOnTypeMismatch()){var n=Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH"):"Mismatched group item class";Kekule.raise(n)}return!1}return!0},notifyItemsChanged:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},indexOfItem:function(e){return this.getItems().indexOf(e)},indexOfObj:function(e){for(var t=this.getItems(),r=0,i=t.length;r<i;++r)if(t[r].obj==e)return r;return-1},hasObj:function(e){return this.indexOfObj(e)>=0},setAttributesAt:function(e,t){var r=this.getItems()[e];if(r)for(var i=Kekule.ObjUtils.getOwnedFieldNames(t),n=0,o=i.length;n<o;++n)r[i[n]]=t[i[n]]},getItemCount:function(){return this.getItems().length},getItemAt:function(e){return this.getItems()[e]},appendItem:function(e){return this.getItems().push(e),this},insertItem:function(e,t){return this.insertItemAt(e,t)},insertItemAt:function(e,t){return Kekule.ArrayUtils.insertUniqueEx(this.getItems(),e,t).index},removeItemAt:function(e){this.getItems()[e]&&(this.getItems().splice(e,1),this.notifyItemsChanged())},removeItem:function(e){var t=this.getItems().indexOf(e);t>=0&&this.removeItemAt(t)},getObjAt:function(e){var t=this.getItemAt(e);return t?t.obj:null},insertObj:function(e,t,r){return this.insertObjAt(e,t,r)},insertObjAt:function(e,t,r){if(e)if(this.indexOfObj(e)>=0);else if(this.ensureItemClass(e)){var i={obj:e};this.beginUpdate();try{var n=this.insertItem(i,t);r&&this.setAttributesAt(n,r),this.notifyItemsChanged()}finally{this.endUpdate()}return n}},appendObj:function(e,t){return this.insertObj(e,null,t)},removeObjAt:function(e){this.getItems()[e]&&(this.getItems().splice(e,1),this.notifyItemsChanged())},removeObj:function(e){var t=this.indexOfObj(e);t>=0&&this.removeObjAt(t)},getAllObjs:function(){for(var e=[],t=0,r=this.getItemCount();t<r;++t)e.push(this.getObjAt(t));return e},getChildSubgroupNames:function(){return["item"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return"item"},getNextSiblingOfChild:function(e){var t=this.indexOfItem(e);return t<0&&(t=this.indexOfObj(e)),t>=0?this.getChildAt(t+1):null},appendChild:function(e){return e instanceof Kekule.ChemObject?this.appendObj(e):this.appendItem(e)},insertChild:function(e,t){return e instanceof Kekule.ChemObject?this.insertObj(e,t):this.insertItem(e,t)},insertBefore:function(e,t){var r=this.indexOfItem(t);return r<0&&(r=this.indexOfObj(t)),this.insertChild(e,r)}}),Kekule.StructureFragmentGroup=Class.create(Kekule.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.StructureFragment","Kekule.StructureFragmentGroup"]}),Kekule.MoleculeGroup=Class.create(Kekule.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.MoleculeGroup",ITEM_BASE_CLASSES:["Kekule.Molecule","Kekule.MoleculeGroup"]}),Kekule.CompositeMolecule=Class.create(Kekule.Molecule,{CLASS_NAME:"Kekule.CompositeMolecule",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("subMolecules",{dataType:"Kekule.MoleculeGroup",getter:function(){return this.getPropStoreFieldValue("subMolecules")||this.setPropStoreFieldValue("subMolecules",new Kekule.MoleculeGroup),this.getPropStoreFieldValue("subMolecules")}})},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&t.push("subMolecules"),t},ownerChanged:function(e,t){var r=this.getPropStoreFieldValue("subMolecules");r&&r.setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},getSubMoleculeCount:function(){var e=this.getPropStoreFieldValue("subMolecules");return e?e.length:0},hasCtab:function(){return!1},hasFormula:function(){return!1},getAllContainingConnectors:function(){for(var e=this.getSubMolecules(),t=[],r=0,i=e.getItemCount();r<i;++r){var n=e.getObjAt(r);if(n.getAllContainingConnectors){var o=n.getAllContainingConnectors();o&&o.length&&(t=t.concat(o))}}return t},getContainerBox:function(e){var t=null,r=this.getPropStoreFieldValue("subMolecules");if(r)for(var i=0,n=r.getItemCount();i<n;++i){var o=r.getObjAt(i).getContainerBox(e);o&&(t=t?Kekule.BoxUtils.getContainerBox(t,o):Kekule.BoxUtils.clone(o))}return t},doGetCtab:function(){return null},doSetCtab:function(){},doGetFormula:function(){return null},doSetFormula:function(){},getChildSubgroupNames:function(){return["subMolecule"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.Molecule?"subMolecule":this.tryApplySuper("getBelongChildSubGroupName",[e])},getNextSiblingOfChild:function(e){return this.getSubMolecules().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.insertChildAt(e,t)}}),Kekule.MoleculeList=Class.create(Kekule.ChemObjList,{CLASS_NAME:"Kekule.MoleculeList",initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.Molecule])}}),Kekule.ChemStructureNodeLabels={ENABLE_ISOTOPE_ALIAS:!0,UNSET_ELEMENT:"?",DUMMY_ATOM:"Du",HETERO_ATOM:"Q",ANY_ATOM:"A",CUSTOM_ATOM:"@",VARIABLE_ATOM:"L",SUBGROUP:"R",ISO_LIST_LEADING_BRACKET:"[",ISO_LIST_TAILING_BRACKET:"]",ISO_LIST_DELIMITER:",",ISO_LIST_DISALLOW_PREFIX:"NOT",DEF_ELECTRONIC_BIAS_MARK:"δ"},Kekule.ChemStructureNodeFactory={CANDIDATE_CLASSES:[Kekule.SubGroup,Kekule.VariableAtom,Kekule.Pseudoatom],getClassByLabel:function(e,t){void 0===t&&(t=Kekule.Pseudoatom);for(var r,i=Kekule.ChemStructureNodeLabels,n=[[i.SUBGROUP],[i.VARIABLE_ATOM],[i.DUMMY_ATOM,i.HETERO_ATOM,i.ANY_ATOM,i.CUSTOM_ATOM]],o=Kekule.ChemStructureNodeFactory.CANDIDATE_CLASSES,a=0,s=o.length;a<s;++a){var l=o[a];if(n[a].indexOf(e)>=0){r=l;break}}return r||(r=Kekule.IsotopesDataUtil.isIsotopeIdAvailable(e)?Kekule.Atom:t),r},createByLabel:function(e){var t=new(Kekule.ChemStructureNodeFactory.getClassByLabel(e));return t instanceof Kekule.Pseudoatom?t.setSymbol(e):t instanceof Kekule.Atom&&t.setIsotopeId(e),t}}}(),Kekule.ChemStructureBuilder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructureBuilder",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setTarget(e)},initProperties:function(){this.defineProp("target",{dataType:"Kekule.StructureFragment"})},setNodeCoord:function(){for(var e=Array.prototype.slice.call(arguments),t=e.shift(),r=e,i=0,n=r.length;i<n&&i<2;++i){var o=r[i];void 0!==o.z?t.setCoordOfMode(o,Kekule.CoordMode.COORD3D):t.setCoordOfMode(o,Kekule.CoordMode.COORD2D)}},createNode:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=e.shift(),i=e,n=new t(r);return this.setNodeCoord(n,i),this.appendNode(n),n},createConnector:function(e,t,r){var i=new e(t);return i.setConnectedObjs(r),i},appendNode:function(e){return e&&this.getTarget()?this.getTarget().appendNode(e):null},appendConnector:function(e){return e&&this.getTarget()?this.getTarget().appendConnector(e):null},createAtom:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=e.shift(),i=e.shift(),n=new Kekule.Atom(t,r,i);return e.unshift(n),this.setNodeCoord.apply(this,e),this.appendNode(n),n},createBond:function(e,t,r,i,n){var o=new Kekule.Bond(e,t,r);return o.changeBondForm(r,null,n),i&&o.setStereo(i),this.appendConnector(o),o},deleteNode:function(){},marshalSubGroup:function(e,t){var r=this.getTarget();if(r&&r.hasCtab()){var i=new Kekule.SubGroup(t);return r.marshalSubFragment(e,i),i}return null}}),Kekule.ReactionComponent={REACTANT:"reactant",PRODUCT:"product",SUBSTANCE:"substance",CONDITION:"condition"},Kekule.ReactionRole={REAGENT:"reagent",CATALYST:"catalyst",SOLVENT:"solvent",TEMPERATURE:"temperature",DURATION:"duration"},Kekule.ReactionDirection={FORWARD:1,BACKWARD:-1,BIDIRECTION:0},Kekule.Reaction=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Reaction",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setDirection(Kekule.ReactionDirection.FORWARD)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("title",{dataType:DataType.STRING}),this.defineProp("reactionType",{dataType:DataType.STRING}),this.defineProp("yield",{dataType:DataType.FLOAT}),this.defineProp("direction",{dataType:DataType.INT,defaultValue:Kekule.ReactionDirection.FORWARD,enumSource:Kekule.ReactionDirection}),this.defineProp("reactants",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("reactants");return!t&&e&&(t=[],this.setPropStoreFieldValue("reactants",t)),t}}),this.defineProp("products",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("products");return!t&&e&&(t=[],this.setPropStoreFieldValue("products",t)),t}}),this.defineProp("substances",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("substances");return!t&&e&&(t=[],this.setPropStoreFieldValue("substances",t)),t}}),this.defineProp("conditions",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("conditions");return!t&&e&&(t=[],this.setPropStoreFieldValue("conditions",t)),t}})},ownerChanged:function(e,t){for(var r=["reactants","products","substances","conditions"],i=0,n=r.length;i<n;++i){var o=r[i],a=this.getComponentArray(o);if(a)for(var s=0,l=a.length;s<l;++s){var u=a[s].item;u.setOwner&&u.setOwner(e)}}this.tryApplySuper("ownerChanged",[e,t])},assertAddingMolecule:function(e){e instanceof Kekule.Molecule||Kekule.chemError(Kekule.$L("ErrorMsg.UNABLE_ADD_NONMOLECULE_MAP"))},notifyReactantsChange:function(){this.notifyPropSet("reactants",this.getPropStoreFieldValue("reactants"))},notifyProductsChange:function(){this.notifyPropSet("products",this.getPropStoreFieldValue("products"))},notifySubstancesChange:function(){this.notifyPropSet("substances",this.getPropStoreFieldValue("substances"))},notifyConditionsChange:function(){this.notifyPropSet("conditions",this.getPropStoreFieldValue("conditions"))},notifyComponentChange:function(e){var t=this.componentToPropName(e);t&&this.notifyPropSet(t,this.getPropStoreFieldValue(t))},componentToPropName:function(e){return e+"s"},getComponentArray:function(e,t){var r=this.componentToPropName(e);if(!r)return null;switch(r){case"reactants":return this.doGetReactants(t);case"products":return this.doGetProducts(t);case"substances":return this.doGetSubstances(t);case"conditions":return this.doGetConditions(t);default:return null}},getComponentItemCount:function(e){var t=this.getComponentArray(e);return t?t.length:0},getMapAt:function(e,t){var r=this.getComponentArray(e);return r?r[t]:null},getMapItemAt:function(e,t){var r=this.getMapAt(e,t);return r?r.item:null},indexOfMap:function(e,t){var r=this.getComponentArray(e);return r?r.indexOf(t):-1},indexOfItem:function(e,t,r){var i=this.getComponentArray(e);if(i)for(var n=0,o=i.length;n<o;++n)if(i[n].item==t){if(void 0===r)return n;if(r===i[n].role)return n}return-1},appendMap:function(e,t){e!=Kekule.ReactionComponent.PRODUCT&&e!=Kekule.ReactionComponent.REACTANT||this.assertAddingMolecule(t.item);var r=Kekule.ArrayUtils.pushUniqueEx(this.getComponentArray(e,!0),t);return r.isPushed&&this.notifyComponentChange(e),r.index},appendItem:function(e,t,r,i){var n=this.indexOfItem(e,t,r);if(n<0){e!=Kekule.ReactionComponent.PRODUCT&&e!=Kekule.ReactionComponent.REACTANT||this.assertAddingMolecule(t);var o=Kekule.RoleMapUtils.createMap(t,r);i&&Object.extend(o,i);var a=Kekule.ArrayUtils.pushUniqueEx(this.getComponentArray(e,!0),o);return this.notifyComponentChange(e),a.index}return n},removeMapAt:function(e,t){var r=null,i=this.getComponentArray(e);return i&&(r=Kekule.ArrayUtils.removeAt(i,t))&&this.notifyComponentChange(e),r},removeMap:function(e,t){var r=null,i=this.getComponentArray(e);return i&&(r=Kekule.ArrayUtils.remove(i,t))&&this.notifyComponentChange(e),r},removeItem:function(e,t,r){var i=this.indexOfItem(e,t,r);return i>=0?this.removeMapAt(e,i):null},clearComponent:function(e){this.getComponentArray(e);this.notifyComponentChange(e)},getReactantCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.REACTANT)},getProductCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.PRODUCT)},getSubstancesCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.SUBSTANCE)},getConditionCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.CONDITION)},getReactantMapAt:function(e){return this.getMapAt(Kekule.ReactionComponent.REACTANT,e)},getProductMapAt:function(e){return this.getMapAt(Kekule.ReactionComponent.PRODUCT,e)},getSubstanceMapAt:function(e){return this.getMapAt(Kekule.ReactionComponent.SUBSTANCE,e)},getConditionMapAt:function(e){return this.getMapAt(Kekule.ReactionComponent.CONDITION,e)},getReactantItemAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.REACTANT,e)},getReactantAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.REACTANT,e)},getProductItemAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.PRODUCT,e)},getProductAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.PRODUCT,e)},getSubstanceItemAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.SUBSTANCE,e)},getSubstanceAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.SUBSTANCE,e)},getConditionItemAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.CONDITION,e)},indexOfReactantMap:function(e){return this.indexOfMap(Kekule.ReactionComponent.REACTANT,e)},indexOfProductMap:function(e){return this.indexOfMap(Kekule.ReactionComponent.PRODUCT,e)},indexOfSubstanceMap:function(e){return this.indexOfMap(Kekule.ReactionComponent.SUBSTANCE,e)},indexOfConditionMap:function(e){return this.indexOfMap(Kekule.ReactionComponent.CONDITION,e)},indexOfReactant:function(e,t){return this.indexOfItem(Kekule.ReactionComponent.REACTANT,e,t)},indexOfProduct:function(e,t){return this.indexOfItem(Kekule.ReactionComponent.PRODUCT,e,t)},indexOfSubstance:function(e,t){return this.indexOfItem(Kekule.ReactionComponent.SUBSTANCE,e,t)},indexOfCondition:function(e,t){return this.indexOfItem(Kekule.ReactionComponent.CONDITION,e,t)},appendReactantMap:function(e){return this.appendMap(Kekule.ReactionComponent.REACTANT,e)},appendProductMap:function(e){return this.appendMap(Kekule.ReactionComponent.PRODUCT,e)},appendSubstanceMap:function(e){return this.appendMap(Kekule.ReactionComponent.SUBSTANCE,e)},appendConditionMap:function(e){return this.appendMap(Kekule.ReactionComponent.CONDITION,e)},appendReactant:function(e,t,r,i){var n=i||{};return r&&(n.amount=r),this.appendItem(Kekule.ReactionComponent.REACTANT,e,t,n)},appendProduct:function(e,t,r,i){var n=i||{};return r&&(n.amount=r),this.appendItem(Kekule.ReactionComponent.PRODUCT,e,t,n)},appendSubstance:function(e,t,r,i){var n=i||{};return r&&(n.amount=r),this.appendItem(Kekule.ReactionComponent.SUBSTANCE,e,t,n)},appendCondition:function(e,t,r){return this.appendItem(Kekule.ReactionComponent.CONDITION,e,t,r)},removeReactantAt:function(e){return this.removeMapAt(Kekule.ReactionComponent.REACTANT,e)},removeProductAt:function(e){return this.removeMapAt(Kekule.ReactionComponent.PRODUCT,e)},removeSubstanceAt:function(e){return this.removeMapAt(Kekule.ReactionComponent.SUBSTANCE,e)},removeConditionAt:function(e){return this.removeMapAt(Kekule.ReactionComponent.CONDITION,e)},removeReactantMap:function(e){return this.removeMap(Kekule.ReactionComponent.REACTANT,e)},removeProductMap:function(e){return this.removeMap(Kekule.ReactionComponent.PRODUCT,e)},removeSubstanceMap:function(e){return this.removeMap(Kekule.ReactionComponent.SUBSTANCE,e)},removeConditionMap:function(e){return this.removeMap(Kekule.ReactionComponent.CONDITION,e)},removeReactant:function(e,t){return this.removeItem(Kekule.ReactionComponent.REACTANT,e,t)},removeProduct:function(e,t){return this.removeItem(Kekule.ReactionComponent.PRODUCT,e,t)},removeSubstance:function(e,t){return this.removeItem(Kekule.ReactionComponent.SUBSTANCE,e,t)},removeCondition:function(e,t){return this.removeItem(Kekule.ReactionComponent.CONDITION,e,t)},clearReactants:function(){return this.clearComponent(Kekule.ReactionComponent.REACTANT)},clearProducts:function(){return this.clearComponent(Kekule.ReactionComponent.PRODUCT)},clearSubstance:function(){return this.clearComponent(Kekule.ReactionComponent.SUBSTANCE)},clearConditions:function(){return this.clearComponent(Kekule.ReactionComponent.CONDITION)},clearAll:function(){this.clearProducts(),this.clearProducts(),this.clearSubstance(),this.clearConditions()},getAllContainingConnectors:function(){for(var e=Kekule.ReactionComponent,t=[e.REACTANT,e.PRODUCT,e.SUBSTANCE],r=[],i=0,n=t.length;i<n;++i)for(var o=t[i],a=0,s=this.getComponentItemCount(o);a<s;++a){var l=this.getMapItemAt(o,a);if(l.getAllContainingConnectors){var u=l.getAllContainingConnectors();u&&u.length&&(r=r.concat(u))}}return r}}),Kekule.ReactionList=Class.create(Kekule.ChemObjList,{CLASS_NAME:"Kekule.ReactionList",initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.Reaction])}}),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.ChemStructureUtils={getConnectorLengthMedian:function(e,t,r){for(var i=[],n=0,o=e.length;n<o;++n){var a=e[n];if(a&&a.getLength){var s=a.getLength(t,r);s&&i.push(s)}}if(0===o)return 1;if(o<=1)return i[0];i.sort();var l=i.length;return l%2?i[l+1>>1]:(i[l>>1]+i[(l>>1)-1])/2},getChildStructureObjs:function(e,t){var r,i=!0;if(e instanceof Kekule.CompositeMolecule)r=e.getSubMolecules().getAllObjs();else if(e instanceof Kekule.ChemStructureObjectGroup)r=e.getAllObjs();else if(e instanceof Kekule.ChemObjList)r=e.getItems();else if(e instanceof Kekule.ChemSpaceElement)r=e.getChildren().getItems();else{if(!(e instanceof Kekule.ChemSpace))return i=!1,[e];r=e.getChildren()}if(r=[].concat(r),t&&i){for(var n=[],o=0,a=r.length;o<a;++o){var s=r[o],l=Kekule.ChemStructureUtils.getChildStructureObjs(s,t);!l.length||1===l.length&&l[0]===s?Kekule.ArrayUtils.pushUnique(n,s):Kekule.ArrayUtils.pushUnique(n,l)}r=n}return r},getAllStructFragments:function(e,t){if(e instanceof Kekule.StructureFragment)return[e];for(var r=Kekule.ChemStructureUtils.getChildStructureObjs(e,t),i=[],n=0,o=r.length;n<o;++n)r[n]instanceof Kekule.StructureFragment&&Kekule.ArrayUtils.pushUnique(i,r[n]);return i},getTotalStructFragment:function(e,t){var r=Kekule.ChemStructureUtils.getAllStructFragments(e,!0),i=r.length;return i<=0?null:1===i?r[0]:Kekule.ChemStructureUtils.mergeStructFragments(r,t)},getCascadeDeleteObjs:function(e){for(var t=[],r=e.getLinkedConnectors?e.getLinkedConnectors():[],i=0,n=r.length;i<n;++i){var o=r[i];if(o.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(t,o);var a=Kekule.ChemStructureUtils.getCascadeDeleteObjs(o);Kekule.ArrayUtils.pushUnique(t,a)}}if(e instanceof Kekule.ChemStructureNode);else if(e instanceof Kekule.ChemStructureConnector){var s=e.getConnectedObjs();for(i=0,n=s.length;i<n;++i){var l=s[i];l instanceof Kekule.ChemStructureNode&&l.getLinkedConnectors().length<=1&&Kekule.ArrayUtils.pushUnique(t,l)}}return t},moveChildBetweenStructFragment:function(e,t,r,i,n){return Kekule.StructureFragment.moveChildBetweenStructFragment(e,t,r,i,n)},_getCascadeConnectedNodesAndConnectors:function(e,t){for(var r=[],i=[],n=e.getConnectedObjs(),o=0,a=n.length;o<a;++o){var s=n[o];if(s!==e)if(t&&(s=t.findDirectChildOfObj(s)),s instanceof Kekule.ChemStructureNode)Kekule.ArrayUtils.pushUnique(i,s);else if(s instanceof Kekule.ChemStructureConnector){Kekule.ArrayUtils.pushUnique(r,s);var l=Kekule.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(s);Kekule.ArrayUtils.pushUnique(r,l.connectors),Kekule.ArrayUtils.pushUnique(i,l.nodes)}}return{connectors:r,nodes:i}},mergeStructFragments:function(e,t){if(e.length<=1)return e[0];for(var r=new(t||Kekule.Molecule),i=0,n=e.length;i<n;++i){var o=e[i].clone();Kekule.ChemStructureUtils.moveChildBetweenStructFragment(o,r,o.getNodes(),o.getConnectors())}return r},splitStructFragment:function(e){if(!e.hasCtab())return[e];var t=e.getNodes();if(t.length<=0)return[e];var r=e.getConnectors(),i=[],n=[t[0]],o=[],a=0;do{var s=n[a],l=s.getLinkedConnectors();s.getCrossConnectors&&l.concat(s.getCrossConnectors()||[]),Kekule.ArrayUtils.pushUnique(o,l);for(var u=0,d=l.length;u<d;++u){var c=Kekule.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(l[u],e);Kekule.ArrayUtils.pushUnique(o,c.connectors),Kekule.ArrayUtils.pushUnique(n,c.nodes)}++a}while(a<n.length);i.push(e);var h=Kekule.ArrayUtils.exclude(t,n),p=Kekule.ArrayUtils.exclude(r,o);if(h.length>0){var g=new(e.getClass());Kekule.ChemStructureUtils.moveChildBetweenStructFragment(e,g,h,p);var f=Kekule.ChemStructureUtils.splitStructFragment(g);i=i.concat(f)}return i},getAbsCoordVectorBetweenObjs:function(e,t,r,i){var n=e.getAbsCoordOfMode(r,i),o=t.getAbsCoordOfMode(r,i);return Kekule.CoordUtils.substract(o,n)},_getRef2DCoordOfObj:function(e,t){return e.getAbsBaseCoord2D?e.getAbsBaseCoord2D(t):e.getAbsCoord2D?e.getAbsCoord2D(t):e.getCoord2D(t)},_getStandardizedLinkedObj2DRelCoords:function(t,r,i,n,o){var a=[],s=Kekule.ChemStructureUtils._getRef2DCoordOfObj(t,i),l=o?t.getLinkedObjs():t.getLinkedExposedObjs();n&&t.getAttachedMarkers&&(l=l.concat(t.getAttachedMarkers()||[])),r&&r.length&&(l=e.exclude(l,r));for(var u=0,d=l.length;u<d;++u){var c=l[u],h=Kekule.ChemStructureUtils._getRef2DCoordOfObj(c,i),p=Kekule.CoordUtils.substract(h,s);p=Kekule.CoordUtils.standardize(p),a.push(p)}return a},_calcLinkedObj2DAnglesOfObj:function(e,t,r,i,n){for(var o=[],a=Kekule.ChemStructureUtils._getStandardizedLinkedObj2DRelCoords(e,t,r,i,n),s=0,l=a.length;s<l;++s){var u=a[s];if(0!==u.x||0!==u.y){var d=Math.atan2(u.y,u.x);d<0&&(d=2*Math.PI+d),o.push(d)}}return o.sort(),o},_getMostEmptyDirectionOfExistingAngles:function(e){var t=e.length;if(0===t)return 0;if(1===t)return Kekule.GeometryUtils.standardizeAngle(Math.PI+e[0]);for(var r=0,i=0,n=0;n<t;++n){var o=e[n],a=e[(n+1)%t]-o;a<0&&(a+=2*Math.PI),a>r&&(r=a,i=n)}return e[i]+r/2},getMostEmptyDirection2DAngleOfObj:function(e,t,r,i,n,o){var a=Kekule.ChemStructureUtils._calcLinkedObj2DAnglesOfObj(e,t,r,i,n);return o&&(a=a.concat(o)).sort(),Kekule.ChemStructureUtils._getMostEmptyDirectionOfExistingAngles(a)},isSameRing:function(t,r){return t.nodes.length===r.nodes.length&&(t.connectors.length===r.connectors.length&&(!(e.exclude(t.nodes,r.nodes).length>0)&&!(e.exclude(t.connectors,r.connectors).length>0)))},isInRings:function(e,t){for(var r=0,i=t.length;r<i;++r){var n=t[r];if(e===n)return!0;if(Kekule.ChemStructureUtils.isSameRing(e,n))return!0}return!1},getImplicitHydrogenCount:function(e,t){var r=Object.extend({coValenceBondValenceSum:0,otherBondValenceSum:0,charge:0,radicalECount:0},t||{},!0),i=Kekule.ValenceUtils.getImplicitValence(e,r.charge,r.coValenceBondValenceSum),n=(i-=r.radicalECount)-r.coValenceBondValenceSum-r.otherBondValenceSum;return r.allowNegative||(n=Math.max(i-r.coValenceBondValenceSum-r.otherBondValenceSum,0)),n}},Kekule.TokenAnalyzer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TokenAnalyzer",initialize:function(e){this.tryApplySuper("initialize"),this.setSrcText(e)},initProperties:function(){this.defineProp("srcText",{dataType:DataType.STRING,setter:function(e){var t=e||"";this.setPropStoreFieldValue("srcText",t),this.setPropStoreFieldValue("srcLength",t.length),this.setCurrPos(0)}}),this.defineProp("srcLength",{dataType:DataType.INT,setter:null,serializable:!1}),this.defineProp("currPos",{dataType:DataType.INT,serializable:!1})},getCharType:function(e){return 0},isCharTypeMatched:function(e,t){return e===t},nextCharInfo:function(){var e=this.getCurrPos();if(e>=this.getSrcLength())return null;var t=this.getSrcText().charAt(e);return this.setCurrPos(e+1),{char:t,charType:this.getCharType(t)}},nextTokenInfo:function(){var e=this.nextCharInfo();if(e){for(var t=e.char,r=e.charType,i=this.nextCharInfo();i&&this.isCharTypeMatched(i.charType,e.charType);)t+=i.char,e=i,i=this.nextCharInfo();return i&&this.setCurrPos(this.getCurrPos()-1),{token:t,tokenType:r}}return null},getAllTokenInfos:function(){for(var e=[],t=this.nextTokenInfo();t;)e.push(t),t=this.nextTokenInfo();return e}}),Kekule.ChemTextTypes={CT_ATOM_SYMBOL_LEADING:1,CT_ATOM_SYMBOL_FOLLOWING:2,CT_CHARGE_SYMBOL:3,CT_NUMBER:4,CT_BRACKET_LEADING:10,CT_BRACKET_TAILING:11,CT_SEPARATOR:20,CT_UNKNOWN:0};var t=Kekule.ChemTextTypes;Kekule.ChemTextAnalyzer=Class.create(Kekule.TokenAnalyzer,{CLASS_NAME:"Kekule.ChemTextAnalyzer",getCharType:function(e){return" "===e?t.CT_SEPARATOR:e>="0"&&e<="9"?t.CT_NUMBER:["+","-"].indexOf(e)>=0?t.CT_CHARGE_SYMBOL:["(","[","{"].indexOf(e)>=0?t.CT_BRACKET_LEADING:[")","]","}"].indexOf(e)>=0?t.CT_BRACKET_TAILING:e>="A"&&e<="Z"?t.CT_ATOM_SYMBOL_LEADING:e>="a"&&e<="z"?t.CT_ATOM_SYMBOL_FOLLOWING:t.CT_UNKNOWN},isCharTypeMatched:function(e,r){return!Kekule.ArrayUtils.intersect([t.CT_BRACKET_LEADING,t.CT_BRACKET_TAILING],[e,r]).length&&(e===r&&r!==t.CT_ATOM_SYMBOL_LEADING||r===t.CT_ATOM_SYMBOL_LEADING&&e===t.CT_ATOM_SYMBOL_FOLLOWING)}}),Kekule.FormulaUtils={FORMULA_BRACKETS:[["(",")"],["[","]"],["{","}"]],FORMULA_BRACKET_TYPE_COUNT:3,textToFormula:function(e,r,i){var n=i||null;n&&n.clear();var o=new Kekule.ChemTextAnalyzer(e);try{var a=o.getAllTokenInfos();n||(n=new Kekule.MolecularFormula(r));var s=a.length;if(s){var l,u,d=null,c=n;l={};for(var h=function(){l={}},p=function(){l&&l.obj&&c.appendSection(l.obj,l.count,l.charge)},g=0;g<s;++g){var f=a[g],C=f.tokenType,m=f.token,T=!1;if(C===t.CT_BRACKET_LEADING){p();var E=new Kekule.MolecularFormula(r);E._parentFormula=c,c=E,h(),T=!0}else if(C===t.CT_BRACKET_TAILING)p(),h(),l.obj=c,c=c._parentFormula,f.asSymbol=!0,T=!0;else if([t.CT_ATOM_SYMBOL_LEADING,t.CT_ATOM_SYMBOL_FOLLOWING].indexOf(C)>=0){l.obj&&(p(),h());var _=l.massNum;_||d&&!d.handled&&d.tokenType===t.CT_NUMBER&&(_=parseInt(d.token,10)||null);var S=""+(_||"")+m;l.obj=Kekule.ChemStructureNodeFactory.createByLabel(S),f.asSymbol=!0,T=!0}else if(C===t.CT_CHARGE_SYMBOL){if(u="+"===m?1:-1,f.asCharge=!0,d.tokenType===t.CT_NUMBER){var O;if(d.asCount)if(d.token.length>1){var y=d.token;O=y.substr(y.length-1),d.asCount&&(l.count=parseInt(y.substring(0,y.length-1),10))}else O=d.token,d.asCount&&(l.count=1);else O=d.token,d.asChargeCount=!0;u*=parseInt(O,10)}l.charge=u,T=!0}else if(C===t.CT_NUMBER){var A=parseInt(m,10);u&&d.tokenType===t.CT_CHARGE_SYMBOL&&d.asCharge?(u*=A,l.charge=u,f.asChargeCount=!0,T=!0):l.obj&&d.asSymbol?(l.count=A,f.asCount=!0,T=!0):l.obj||(l.massNum=A,T=!0)}f.handled=T,d=f}l&&l.obj&&p()}return n}finally{o.finalize()}},formulaToText:function(e,t,i){return Kekule.ObjUtils.isUnset(t)&&(t=!0),r._convFormulaToText(e,!1,t,i)},_convFormulaToText:function(e,t,i,n){var o="",a=e.getSections();if(t){var s=e.getMaxNestedLevel()%r.FORMULA_BRACKET_TYPE_COUNT,l=r.FORMULA_BRACKETS[s][0],u=r.FORMULA_BRACKETS[s][1];o+=l}for(var d=0,c=a.length;d<c;++d){var h=a[d].obj,p=e.getSectionCharge(a[d]),g=null;if(h instanceof Kekule.MolecularFormula)g=r._convFormulaToText(h,!0,!1,!1,n);else if(h.getLabel){g=h.getLabel();h.getMassNumber&&h.getMassNumber()&&(g=(o?" ":"")+g)}if(g){var f=!1;if(1!=a[d].count&&(g+=a[d].count,f=!0),i&&p)g+=(f?" ":"")+r._convChargeToText(p,n);o+=g}}(t&&(o+=u),i)&&((p=e.getCharge())&&(o+=r._convChargeToText(p,n)));return o},_convChargeToText:function(e,t){if(!e)return null;var r=e>0?"+":"-",i=Math.abs(e),n=r;return 1!=i&&(n=(t?Kekule.NumUtils.toDecimals(i,t):i.toString())+r),n}};var r=Kekule.FormulaUtils;ClassEx.defineProp(Kekule.MolecularFormula,"text",{dataType:DataType.STRING,serializable:!1,getter:function(){return r.formulaToText(this)},setter:function(e){r.textToFormula(e,this.getParent(),this)}})}(),function(){"use strict";Kekule.Glyph={},Kekule.Glyph.Base=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Glyph.Base",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){},getAutoIdPrefix:function(){return"g"},getAllowChildCoordStickTo:function(e,t){return!1},getChildAcceptCoordStickFrom:function(e,t){return!1},getChildUseCoordStickOffset:function(e,t){return null}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.Glyph.Base)}(),function(){"use strict";Kekule.Glyph.ElectronArrowGlyphUtils={isValidChemNodeOrConnectorStickTarget:function(e){var t=e instanceof Kekule.ChemStructureNode||e instanceof Kekule.ChemStructureConnector;if(!t&&e instanceof Kekule.ChemMarker.BaseMarker){var r=e.getParent&&e.getParent();r&&(t=r instanceof Kekule.ChemStructureNode||r instanceof Kekule.ChemStructureConnector)}return t},isValidElectronTarget:function(e){return Kekule.Glyph.ElectronArrowGlyphUtils.isValidChemNodeOrConnectorStickTarget(e)},getValidElectronTarget:function(e){var t=e&&e.getCoordStickTarget&&e.getCoordStickTarget();return t&&Kekule.Glyph.ElectronArrowGlyphUtils.isValidElectronTarget(t)?t:null},setValidElectronTarget:function(e,t){e.getAllowCoordStickTo&&e.getAllowCoordStickTo(t)&&(t?Kekule.Glyph.ElectronArrowGlyphUtils.isValidElectronTarget(t)&&e.setCoordStickTarget(t):e.setCoordStickTarget(null))},getValidElectronTargetNodeOrConnector:function(e){var t=null,r=Kekule.Glyph.ElectronArrowGlyphUtils.getValidElectronTarget(e);return r&&(t=r instanceof Kekule.ChemMarker.BaseMarker?r.getParent():r),t}}}(),function(){"use strict";var e=Kekule.CoordUtils,t=Kekule.CoordMode;Kekule.Glyph.PathGlyphNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphNode",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e]),r&&this.setCoord2D(r),i&&this.setCoord3D(i),this.setNodeType(t||Kekule.Glyph.NodeType.LOCATION)},initProperties:function(){this.defineProp("nodeType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC}),this.defineProp("pathNodeParams",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("pathNodeParams");return e||(e={},this.setPropStoreFieldValue("pathNodeParams",e)),e},setter:function(e){e?this.setPropStoreFieldValue("pathNodeParams",Object.extend({},e,!0)):this.setPropStoreFieldValue("pathNodeParams",null)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},getAllowCoordStickTo:function(e){if(!e||!this.isSiblingWith(e)){var t=this.getParent();if(t&&t.getAllowChildCoordStickTo)return t.getAllowChildCoordStickTo(this,e)}return!1},getAcceptCoordStickFrom:function(e){var t=this.getParent();return!(!t||!t.getChildAcceptCoordStickFrom)&&t.getChildAcceptCoordStickFrom(this,e)},notifyCoordStickTargetChanged:function(e,t){this.tryApplySuper("notifyCoordStickTargetChanged",[e,t]);var r=this.getParent();if(Kekule.ObjUtils.isUnset(this.getPathNodeParams().useStickingOffset)&&r.getChildUseCoordStickOffset){var i=r.getChildUseCoordStickOffset(this,t);Kekule.ObjUtils.notUnset(i)&&(this.getPathNodeParams().useStickingOffset=i)}r.notifyChildCoordStickTargetChanged&&r.notifyChildCoordStickTargetChanged(this.oldTarget,t)}}),Kekule.Glyph.NodeType={LOCATION:"location",CONTROLLER:"controller",HIDDEN:"hidden"},Kekule.Glyph.PathGlyphConnectorControlNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphConnectorControlNode",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setInteractMode(Kekule.ChemObjInteractMode.UNSELECTABLE)},getAutoIdPrefix:function(){return"cn"},getAcceptCoordStickFrom:function(e){return!1},getParentConnector:function(){var e=this.getParent();return e&&e instanceof Kekule.Glyph.PathGlyphConnector?e:null},isPositioned:function(e,r){return e||(e=t.COORD2D),this.doCheckIsPositioned(e,r)},doCheckIsPositioned:function(e,t){return!0},resetPosition:function(e){return e?this.doResetPosition(e):(this.doResetPosition(t.COORD2D),this.doResetPosition(t.COORD3D)),this},doResetPosition:function(e){}}),Kekule.Glyph.PathType={LINE:"L",ARC:"A"},Kekule.Glyph.ArrowType={NONE:null,OPEN:"open",TRIANGLE:"triangle"},Kekule.Glyph.ArrowSide={DEFAULT:0,BOTH:0,SINGLE:1,REVERSED:-1},Kekule.Glyph.PathGlyphConnector=Class.create(Kekule.BaseStructureConnector,{CLASS_NAME:"Kekule.Glyph.PathGlyphConnector",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),this.setPathType(t)},initProperties:function(){this.defineProp("pathType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,enumSource:Kekule.Glyph.PathType}),this.defineProp("pathParams",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("pathParams");return e||(e={},this.setPropStoreFieldValue("pathParams",e)),e},setter:function(e){e?this.setPropStoreFieldValue("pathParams",Object.extend({},e,!0)):this.setPropStoreFieldValue("pathParams",null)}}),this.defineProp("controlPoints",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLISHED,getter:function(e){var t=this.getPropStoreFieldValue("controlPoints");return!t&&e&&(t=[],this.setPropStoreFieldValue("controlPoints",t)),t&&!t.length&&this.doFillDefaultControlPoints(t),t},setter:function(e){this.clearControlPoints(),this.setPropStoreFieldValue("controlPoints",e),this._controlPointsChanged()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setInteractMode(Kekule.ChemObjInteractMode.UNSELECTABLE)},_appendChildObj:function(e){var t=this.tryApplySuper("_appendChildObj",[e]);return e instanceof Kekule.Glyph.PathGlyphConnectorControlNode&&this.tryResetControlPointPosition(e),t},doPropChanged:function(e,t){return"connectedObjs"===e&&this.tryResetAllControlPointPositions(),this.tryApplySuper("doPropChanged",[e,t])},getAbsCoord2D:function(e){return this.getAbsCoordOfMode(Kekule.CoordMode.COORD2D,e)},getAbsCoord3D:function(e){return this.getAbsCoordOfMode(Kekule.CoordMode.COORD2D,e)},getAbsCoordOfMode:function(e,t){for(var r=Kekule.CoordUtils,i={x:0,y:0},n=0,o=0,a=this.getConnectedObjCount();o<a;++o){var s=this.getConnectedObjAt(o);if(s&&s.getAbsCoordOfMode){var l=s.getAbsCoordOfMode(e,t);l&&(++n,i=r.add(i,l))}}return r.divide(i,n)},getChildSubgroupNames:function(){return["controlPoint"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.Glyph.PathGlyphArcConnectorControlNode?"controlPoint":this.tryApplySuper("getBelongChildSubGroupName",[e])},getControlPointCount:function(){var e=this.getControlPoints();return e&&e.length||0},getControlPointAt:function(e){return(this.getControlPoints()||[])[e]},indexOfControlPoint:function(e){var t=this.getControlPoints();return t?t.indexOf(e):-1},removeControlPointAt:function(e){var t=null,r=this.getControlPoints();return r&&e>=0&&e<r.length&&((t=r.splice(e,1)).setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyPropSet("controlPoints",this.getControlPoints())),t},removeControlPoint:function(e){var t=null,r=this.getControlPoints();if(r){var i=r.indexOf(e);i>=0&&(r.splice(i,1),e.setOwner&&e.setOwner(null),e.setParent&&e.setParent(null),t=e,this.notifyPropSet("controlPoints",this.getControlPoints()))}return t},insertControlPointAt:function(e,t){var r=this.getControlPoints();if(r&&t<r.length){var i=Kekule.ArrayUtils.insertUniqueEx(r,e,t);return i.isInserted&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this),this.notifyPropSet("controlPoints",this.getControlPoints())),i.index}return-1},insertControlPointBefore:function(e,t){var r=this.getControlPoints();if(r){var i=t?this.indexOfControlPoint(t):-1;return i<0&&(i=r.length),this.insertControlPointAt(e,i)}return-1},tryResetControlPointPosition:function(e){if(e.isPositioned&&e.resetPosition)for(var r=[t.COORD2D,t.COORD3D],i=0,n=r.length;i<n;++i){var o=r[i];e.isPositioned(o,!0)||e.resetPosition(o)}},tryResetAllControlPointPositions:function(){for(var e=0,t=this.getControlPointCount();e<t;++e){var r=this.getControlPointAt(e);this.tryResetControlPointPosition(r)}},doFillDefaultControlPoints:function(e){},removeChildObj:function(e){return this.removeControlPoint(e)},hasChildObj:function(e){return this.hasChild(e)},getNextSiblingOfChild:function(e){var t=this.indexOfChild(e);return++t,this.getChildAt(t)},_controlPointsChanged:function(){this._updateControlPointsOwner(),this._updateControlPointsParent()},_updateControlPointsOwner:function(e){e||(e=this.getOwner());var t=this.getControlPoints();if(t)for(var r=0,i=t.length;r<i;++r){var n=t[r];n.setOwner&&n.setOwner(e)}},_updateControlPointsParent:function(e){e||(e=this);var t=this.getControlPoints();if(t)for(var r=0,i=t.length;r<i;++r){var n=t[r];n.setParent&&n.setParent(e)}},clearControlPoints:function(){var e=this.getControlPoints();if(e&&(e=Kekule.ArrayUtils.clone(e)),this.setPropStoreFieldValue("controlPoints",null),e)for(var t=0,r=e.length;t<r;++t){var i=e[t];i.setOwner&&i.setOwner(null),i.setParent&&i.setParent(null)}return this.notifyPropSet("controlPoints",null),this},modifyPathParams:function(e){if(e){var t=this.getPathParams();return t=Object.extend(t,e||{}),this.setPathParams(t),t}return null}}),Kekule.Glyph.PathGlyphArcConnectorControlNode=Class.create(Kekule.Glyph.PathGlyphConnectorControlNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphArcConnectorControlNode",initProperties:function(){this.defineProp("distanceToChord",{dataType:DataType.FLOAT})},doCheckIsPositioned:function(e,t){return this.getIndirectCoordRefCoords(e,t)&&Kekule.ObjUtils.notUnset(this.getDistanceToChord())},doResetPosition:function(r){if(r===t.COORD2D){var i=this.getIndirectCoordRefCoords(r,!0);if(i&&i[0]&&i[1]){var n=e.getDistance(i[0],i[1]);this.setDistanceToChord(.5*n),this.notifyPropSet("coord2D",this.getCoord2D())}}},doGetEnableIndirectCoord:function(){return!0},getIndirectCoordRefCoords:function(e,t){var r=this.getParentConnector();return r&&r.getConnectedObjCount()>=2?[r.getConnectedObjAt(0).getAbsCoordOfMode(t),r.getConnectedObjAt(1).getAbsCoordOfMode(t)]:this.tryApplySuper("getIndirectCoordRefCoords",[e])},calcIndirectCoordValue:function(r,i){if(r===t.COORD2D){var n=this.getDistanceToChord();if(Kekule.ObjUtils.notUnset(n)){var o=this.getIndirectCoordRefCoords();if(o){var a=o[0],s=o[1];if(a&&s){var l=e.substract(s,a),u=Math.sign(l.x),d=Math.sign(l.y);if(Kekule.NumUtils.isFloatEqual(l.x,0,1e-10))h={x:-n*d,y:0};else if(Kekule.NumUtils.isFloatEqual(l.y,0,1e-10))h={x:0,y:n*u};else{var c=-1/(l.y/l.x),h={x:-d*n/Math.sqrt(1+Math.sqr(c))};h.y=h.x*c}return h}}}}return this.tryApplySuper("calcIndirectCoordValue",[r,i])},saveIndirectCoordValue:function(r,i,n,o){if(r===t.COORD2D){var a=n,s=this.getIndirectCoordRefCoords();if(s){var l=s[0],u=s[1],d=e.substract(u,l),c=Math.atan2(d.y,d.x),h=(e.getDistance(l,u),e.substract(i,a)),p=Math.atan2(h.y,h.x),g=e.getDistance(i,a)*Math.sin(p-c),f=(this.getDistanceToChord()||0)+g;return this.setDistanceToChord(f),f}}return this.tryApplySuper("saveIndirectCoordValue",[r,i])}}),Kekule.Glyph.PathGlyphArcConnector=Class.create(Kekule.Glyph.PathGlyphConnector,{CLASS_NAME:"Kekule.Glyph.PathGlyphArcConnector",initialize:function(e,t){this.tryApplySuper("initialize",[e,Kekule.Glyph.PathType.ARC,t]);var r=this._createDefaultControlPoints();this.setControlPoints(r)},getControlPoint:function(){return(this.getControlPoints()||[])[0]},doFillDefaultControlPoints:function(e){var t=this._createDefaultControlPoints();Kekule.ArrayUtils.pushUnique(e,t)},_createDefaultControlPoints:function(){return[new Kekule.Glyph.PathGlyphArcConnectorControlNode(null,{x:0,y:0})]}}),Kekule.Glyph.PathGlyph=Class.create(Kekule.Glyph.Base,{CLASS_NAME:"Kekule.Glyph.PathGlyph",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,i,n]),this.createDefaultStructure(t||1,r||{})},doFinalize:function(){this.hasCtab()&&this.getCtab().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",scope:Class.PropertyScope.PUBLIC,getter:function(e){return this.getPropStoreFieldValue("ctab")||e&&this.createCtab(),this.getPropStoreFieldValue("ctab")},setter:function(e){var t=this.getPropStoreFieldValue("ctab");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.setOwner(this.getOwner())),this.setPropStoreFieldValue("ctab",e)}}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}})},createDefaultStructure:function(e,t){e||(e=1);var r={},i=["startArrowLength","startArrowWidth","endArrowLength","endArrowWidth"];for(var n in t)i.indexOf(n)>=0?r[n]=t[n]*e:r[n]=t[n];return this.doCreateDefaultStructure(e,r)},doCreateDefaultStructure:function(e,t){},getAutoIdPrefix:function(){return"p"},ownerChanged:function(e,t){this.hasCtab()&&this.getCtab().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){if(this.hasCtab()){var t=this.getCtab();t===e?this.removeCtab():t.hasChildObj(e)&&t.removeChildObj(e)}this.tryApplySuper("_removeChildObj",[e])},isEmpty:function(){return this.getCtab().isEmpty()},createCtab:function(){var e=new Kekule.StructureConnectionTable(this.getOwner(),this);this.setPropStoreFieldValue("ctab",e),e.addEventListener("propValueSet",function(e){"nodes"==e.propName&&this.notifyPropSet(e.propName,e.propValue)},this),e.setEnablePropValueSetEvent(!0)},hasCtab:function(){return!!this.getPropStoreFieldValue("ctab")},getContainerBox:function(e,t){return this.hasCtab()?this.getCtab().getContainerBox(e,t):this.tryApplySuper("getContainerBox",[e])},getNodeById:function(e){return this.hasCtab()?this.getCtab().getNodeById(e):null},getConnectorById:function(e){return this.hasCtab()?this.getCtab().getConnectorById(e):null},getObjectById:function(e){var t=this.getNodeById(e);return t||this.getConnectorById(e)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(e){return this.hasCtab()?this.getCtab().getNodeAt(e):null},indexOfNode:function(e){return this.hasCtab()?this.getCtab().indexOfNode(e):-1},hasNode:function(e,t){return this.hasCtab()?this.getCtab().hasNode(e,t):null},appendNode:function(e){return this.doGetCtab(!0).appendNode(e)},insertNodeAt:function(e,t){return this.doGetCtab(!0).insertNodeAt(e,t)},insertNodeBefore:function(e,t){var r=t?this.indexOfNode(t):-1;return r<0?this.appendNode(e):this.doGetCtab(!0).insertNodeAt(e,r)},removeNodeAt:function(e,t){return this.hasCtab()?this.getCtab().removeNodeAt(e,t):null},removeNode:function(e,t){return this.hasCtab()?this.getCtab().removeNode(e,t):null},replaceNode:function(e,t){return this.hasCtab()?this.getCtab().replaceNode(e,t):null},clearNodes:function(){if(this.hasCtab())return this.getCtab().clearNodes()},nodesHasCoord2D:function(e){return!!this.hasCtab()&&this.getCtab().nodesHasCoord2D(e)},nodesHasCoord3D:function(e){return!!this.hasCtab()&&this.getCtab().nodesHasCoord3D(e)},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(e){return this.hasCtab()?this.getCtab().getConnectorAt(e):null},indexOfConnector:function(e){return this.hasCtab()?this.getCtab().indexOfConnector(e):-1},hasConnector:function(e,t){return this.hasCtab()?this.getCtab().hasConnector(e,t):null},appendConnector:function(e){return this.doGetCtab(!0).appendConnector(e)},insertConnectorAt:function(e,t){return this.doGetCtab(!0).insertConnectorAt(e,t)},insertConnectorBefore:function(e,t){var r=t?this.indexOfConnector(t):-1;return r<0?this.appendConnector(e):this.doGetCtab(!0).insertConnectorAt(e,r)},removeConnectorAt:function(e,t){return this.hasCtab()?this.getCtab().removeConnectorAt(e,t):null},removeConnector:function(e,t){return this.hasCtab()?this.getCtab().removeConnector(e,t):null},clearConnectors:function(){if(this.hasCtab())return this.getCtab().clearConnectors()},_getObjsNeedToBeCascadeRemoved:function(e,t){return this.hasCtab()?this.getCtab()._getObjsNeedToBeCascadeRemoved(e,t):[]},getChildSubgroupNames:function(){return["node","connector"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.Glyph.PathGlyphNode?"node":e instanceof Kekule.Glyph.PathGlyphConnector?"connector":this.tryApplySuper("getBelongChildSubGroupName",[e])},removeChildObj:function(e,t,r){this.hasCtab()&&this.getCtab().removeChildObj(e,t,r)},hasChildObj:function(e){return!!this.hasCtab()&&this.getCtab().hasChildObj(e)},getNextSiblingOfChild:function(e){return this.hasCtab()?this.getCtab().getNextSiblingOfChild(e):null},getDirectManipulationTarget:function(){return null}})}(),function(){"use strict";var e=Kekule.ObjUtils,t=(Kekule.Glyph.NodeType,Kekule.Glyph.PathType),r=Kekule.CoordUtils,i=Kekule.CoordMode;Kekule.Glyph.StraightLine=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.StraightLine",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,t,r,i,n])},doCreateDefaultStructure:function(e,r){var i=Kekule.CoordUtils,n={x:0,y:0},o={x:0,y:0,z:0},a={x:e*(r.lineLength||1)},s=new Kekule.Glyph.PathGlyphNode(null,null,n,o),l=new Kekule.Glyph.PathGlyphNode(null,null,i.add(n,a),i.add(o,a)),u=new Kekule.Glyph.PathGlyphConnector(null,t.LINE,[s,l]);this._applyParamsToConnector(u,r),this.appendNode(s),this.appendNode(l),this.appendConnector(u)},_applyParamsToConnector:function(e,t){var r=Object.create(t);Kekule.ObjUtils.isUnset(t.autoOffset)&&(r.autoOffset=!1),e.setPathParams(r)},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)}}),Kekule.Glyph.Polygon=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.Polygon",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,t,r,i,n])},getRefLengthRatio:function(){return 1},doCreateDefaultStructure:function(e,r){for(var i,n,o=Kekule.CoordUtils,a={x:0,y:0},s={x:0,y:0,z:0},l=r.nodeProps,u=r.connectorProps,d=e*(r.lineLength||1)*this.getRefLengthRatio(),c=r.edgeCount||3,h=2*Math.PI/c,p=c%2?0:-h/2,g=0;g<c;++g){var f={x:d*Math.sin(p),y:d*Math.cos(p)},C=new Kekule.Glyph.PathGlyphNode(null,null,o.add(a,f),o.add(s,f));if(l&&C.setPropValues(l),this.appendNode(C),0===g&&(i=C),n){var m=new Kekule.Glyph.PathGlyphConnector(null,t.LINE,[n,C]);u&&m.setPropValues(u),this._applyParamsToConnector(m,r),this.appendConnector(m)}n=C,p+=h}m=new Kekule.Glyph.PathGlyphConnector(null,t.LINE,[C,i]);u&&m.setPropValues(u),this._applyParamsToConnector(m,r),this.appendConnector(m)},_applyParamsToConnector:function(e,t){e.setPathParams(t)}}),Kekule.Glyph.BaseArc=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.BaseArc",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,t,r,i,n])},doCreateDefaultStructure:function(e,t){var r=Kekule.CoordUtils,i={x:0,y:0},n={x:0,y:0,z:0},o={x:e*(t.lineLength||1)},a=new Kekule.Glyph.PathGlyphNode(null,null,i,n),s=new Kekule.Glyph.PathGlyphNode(null,null,r.add(i,o),r.add(n,o));this.appendNode(a),this.appendNode(s);var l=new Kekule.Glyph.PathGlyphArcConnector(null,[a,s]);this._applyParamsToConnector(l,t),this.appendConnector(l),l.setInteractMode(Kekule.ChemObjInteractMode.HIDDEN)},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)},_isValidChemNodeOrConnectorStickTarget:function(e){return Kekule.Glyph.ElectronArrowGlyphUtils.isValidChemNodeOrConnectorStickTarget(e)},_applyParamsToConnector:function(e,t){e.setPathParams(t)},getAllowChildCoordStickTo:function(e,t){return!t||this._isValidChemNodeOrConnectorStickTarget(t,e)&&!this._isChildrenStickingTo(t,[e])},getChildUseCoordStickOffset:function(e,t){return t instanceof Kekule.ChemStructureNode||t instanceof Kekule.ChemStructureConnector},_isChildrenStickingTo:function(e,t){for(var r=this.getNodes(),i=0,n=(r=Kekule.ArrayUtils.exclude(r,t||[])).length;i<n;++i){if(r[i].getCoordStickTarget()===e)return!0}return!1}}),Kekule.Glyph.BaseTwinArc=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.BaseTwinArc",DEF_MIN_PATH_END_DISTANCE_RATIO:.05,DEF_INIT_PATH_END_GAP_RATIO:.2,FIELD_ARC_END_NODE_FLAG:"__$arcEndNode$__",initialize:function(e,t,r,i,n){this.setPropStoreFieldValue("minPathEndDistanceRatio",this.DEF_MIN_PATH_END_DISTANCE_RATIO),this.tryApplySuper("initialize",[e,t,r,i,n])},initProperties:function(){this.defineProp("minPathEndDistanceRatio",{dataType:DataType.FLOAT}),this.defineProp("oppositePathEndArrowSides",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._isPathArrowSideOpposite("end")},setter:function(e){this._setPathArrowSideOpposite("end",!!e)}}),this.defineProp("oppositePathStartArrowSides",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._isPathArrowSideOpposite("start")},setter:function(e){this._setPathArrowSideOpposite("start",!!e)}})},loaded:function(e){var t=this.tryApplySuper("loaded",[e]);return this._isTwinArcSetup()&&(this._setupArcEndNode(this.getNodeAt(1)),this._setupArcEndNode(this.getNodeAt(2))),t},_isPathArrowSideOpposite:function(t){var r=this.getConnectorCount();if(r<2)return null;for(var i,n=null,o=0;o<r;++o){var a=this.getConnectorAt(o).getPathParams();if(a[t+"ArrowType"]===Kekule.Glyph.ArrowType.NONE)return null;var s=a[t+"ArrowSide"];if(s===Kekule.Glyph.ArrowSide.BOTH)return null;if(0===o)i=s;else{var l=i!==s;if(e.isUnset(n))n=l;else if(n!==l)return null;i=s}}return n},_setPathArrowSideOpposite:function(t,r){var i=this.getConnectorCount();if(i<2)return null;for(var n,o=Kekule.Glyph.ArrowSide,a=!0,s=0;s<i;++s){var l=this.getConnectorAt(s).getPathParams();l[t+"ArrowType"]===Kekule.Glyph.ArrowType.NONE&&(a=!1);var u,d=l[t+"ArrowSide"];if(d===Kekule.Glyph.ArrowSide.BOTH&&(a=!1),a)if(e.isUnset(n))n=d;else u=r?n===o.SINGLE?o.REVERSED:o.SINGLE:n,l[t+"ArrowSide"]=u,n=u;else n=null}return null},_isTwinArcSetup:function(){return 2===this.getConnectorCount()&&4===this.getNodeCount()},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)},doCreateDefaultStructure:function(e,t){var i=Kekule.CoordUtils,n={x:0,y:0},o={x:0,y:0,z:0},a=t.lineLength||1,s=t.minPathEndDistanceRatio||this.getMinPathEndDistanceRatio()||this.DEF_MIN_PATH_END_DISTANCE_RATIO,l=a*s;this.setMinPathEndDistanceRatio(s);var u=t.pathEndGap||a*this.DEF_INIT_PATH_END_GAP_RATIO,d={x:e*((a-(u=Math.max(u,l)))/2)},c={x:e*u},h={x:e*a},p=new Kekule.Glyph.PathGlyphNode(null,null,n,o),g=new Kekule.Glyph.PathGlyphNode(null,null);this._setupArcEndNode(g);var f=new Kekule.Glyph.PathGlyphNode(null,null),C=new Kekule.Glyph.PathGlyphNode(null,null,i.add(n,h),i.add(o,h));this._setupArcEndNode(f),this.appendNode(p),this.appendNode(g),this.appendNode(f),this.appendNode(C),g.setCoord2D(i.add(n,d)).setCoord3D(i.add(o,d)),f.setCoord2D(i.add(n,r.add(d,c))).setCoord3D(i.add(o,r.add(d,c)));var m=new Kekule.Glyph.PathGlyphArcConnector(null,[p,g]),T=new Kekule.Glyph.PathGlyphArcConnector(null,[C,f]);this._applyParamsToConnector(m,t),this._applyParamsToConnector(T,t),T.getControlPointAt(0).setDistanceToChord(-T.getControlPointAt(0).getDistanceToChord()),this.appendConnector(m),this.appendConnector(T),m.setInteractMode(Kekule.ChemObjInteractMode.HIDDEN),T.setInteractMode(Kekule.ChemObjInteractMode.HIDDEN)},_applyParamsToConnector:function(e,t){e.setPathParams(t)},_setupArcEndNode:function(e){e[this.FIELD_ARC_END_NODE_FLAG]||(this._overwriteChildPathNodeMethods(e),e.setEnableIndirectCoord(!0),e[this.FIELD_ARC_END_NODE_FLAG]=!0)},_overwriteChildPathNodeMethods:function(e){e.overwriteMethod("getIndirectCoordRefLengths",this._insideNodeGetIndirectCoordRefLengths).overwriteMethod("getIndirectCoordRefCoords",this._insideNodeGetIndirectCoordRefCoords).overwriteMethod("calcIndirectCoordStorage",this._insideNodeCalcIndirectCoordStorage).overwriteMethod("calcIndirectCoordValue",this._insideNodeCalcIndirectCoordValue).overwriteMethod("_childPathNodeGetParentGlyph",this._childPathNodeGetParentGlyph).overwriteMethod("_childPathNodeGetGlyphMinPathEndDistanceRatio",this._childPathNodeGetGlyphMinPathEndDistanceRatio)},_getArrowStartingNodes:function(){var e=[];if(this._isTwinArcSetup())for(var t=0,r=this.getConnectorCount();t<r;++t){var i=this.getConnectorAt(t).getConnectedObjAt(0);i&&e.push(i)}return e},_childPathNodeGetParentGlyph:function(e){var t=this.getParent();return t instanceof Kekule.Glyph.BaseTwinArc?t:null},_childPathNodeGetGlyphMinPathEndDistanceRatio:function(e){var t=this._childPathNodeGetParentGlyph();return t&&t.getMinPathEndDistanceRatio()},_insideNodeGetIndirectCoordRefLengths:function(e,t,r){var i=this.getParent();if(!i||t!==Kekule.CoordMode.COORD2D)return e(t,r);var n=i.getNodeAt(0),o=i.getNodeAt(i.getNodeCount()-1);if(n&&o){var a=n.getAbsCoordOfMode(t),s=o.getAbsCoordOfMode(t),l=Kekule.CoordUtils.getDistance(s,a);return{x:l,y:l,length:l}}},_insideNodeGetIndirectCoordRefCoords:function(e,t,r){var n=this.getParent();if(!n||t!==i.COORD2D)return e(t,r);var o=n.getNodeAt(0),a=n.getNodeAt(n.getNodeCount()-1);return o&&a?[o.getCoordOfMode(t),a.getCoordOfMode(t)]:void 0},_insideNodeCalcIndirectCoordStorage:function(e,t,n,o,a){var s=this.getParent();if(s&&t===i.COORD2D){var l=this.getIndirectCoordRefCoords(t,a);if(l){var u=s.getNodeAt(0).getCoordOfMode(t),d=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(n,l[0],l[1],!1);if(!d)d=r.getDistance(n,l[0])<r.getDistance(n,l[1])?l[0]:l[1];var c=r.getDistance(u,d),h=r.getDistance(l[1],l[0]),p=h?c/h:0,g=this._childPathNodeGetGlyphMinPathEndDistanceRatio()||0;return p<g?p=g:p>1-g&&(p=1-g),{x:p,y:p,ratio:p}}}return e(t,n,o,a)},_insideNodeCalcIndirectCoordValue:function(e,t,n){var o=this.getParent();if(o&&t===i.COORD2D){var a=this.getIndirectCoordRefCoords(t,n);if(a){var s=r.substract(a[1],a[0]),l=o.getNodeAt(0).getCoordOfMode(t),u=this.getIndirectCoordStorageOfMode(t).ratio;if(Kekule.ObjUtils.notUnset(u)){var d=r.multiply(s,u);return r.add(l,d)}}}return e(t,n)},_isValidChemNodeOrConnectorStickTarget:function(e){var t=e instanceof Kekule.ChemStructureNode||e instanceof Kekule.ChemStructureConnector;if(!t&&e instanceof Kekule.ChemMarker.BaseMarker){var r=e.getParent&&e.getParent();r&&(t=r instanceof Kekule.ChemStructureNode||r instanceof Kekule.ChemStructureConnector)}return t},getAllowChildCoordStickTo:function(e,t){var r=this.indexOfNode(e);return(0===r||r===this.getNodeCount()-1)&&(!t||this._isValidChemNodeOrConnectorStickTarget(t,e)&&!this._isChildrenStickingTo(t,[e]))},getChildUseCoordStickOffset:function(e,t){return t instanceof Kekule.ChemStructureNode||t instanceof Kekule.ChemStructureConnector},_isChildrenStickingTo:function(e,t){for(var r=this._getArrowStartingNodes(),i=0,n=(r=Kekule.ArrayUtils.exclude(r,t||[])).length;i<n;++i){if(r[i].getCoordStickTarget()===e)return!0}return!1}}),Kekule.Glyph.Arc=Class.create(Kekule.Glyph.BaseArc,{CLASS_NAME:"Kekule.Glyph.Arc"}),Kekule.Glyph.TwinArc=Class.create(Kekule.Glyph.BaseTwinArc,{CLASS_NAME:"Kekule.Glyph.TwinArc"})}(),function(){"use strict";var e=Kekule.ObjUtils,t=(Kekule.Glyph.NodeType,Kekule.Glyph.PathType),r=Kekule.Glyph.ElectronArrowGlyphUtils;Kekule.Glyph.HeatSymbol=Class.create(Kekule.Glyph.Polygon,{CLASS_NAME:"Kekule.Glyph.HeatSymbol",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,t,r,i,n]),this.setRenderOption&&this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return.25},doCreateDefaultStructure:function(e,t){return t.edgeCount=3,t.nodeProps=Object.extend(t.nodeProps||{},{interactMode:Kekule.ChemObjInteractMode.HIDDEN}),t.connectorProps=Object.extend(t.connectorProps||{},{interactMode:Kekule.ChemObjInteractMode.HIDDEN}),this.tryApplySuper("doCreateDefaultStructure",[e,t])},_applyParamsToConnector:function(e,t){return this.tryApplySuper("_applyParamsToConnector",[e,t])}}),Kekule.Glyph.AddSymbol=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.AddSymbol",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,t,r,i,n]),this.setRenderOption&&this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return.5},doCreateDefaultStructure:function(e,r){var i={interactMode:Kekule.ChemObjInteractMode.HIDDEN},n={interactMode:Kekule.ChemObjInteractMode.HIDDEN},o=Kekule.CoordUtils,a={x:0,y:0},s={x:0,y:0,z:0},l=e*this.getRefLengthRatio()*(r.lineLength||1)/2,u=new Kekule.Glyph.PathGlyphNode(null,null,a,s);u.setPropValues(i),this.appendNode(u);for(var d=[{x:-l,y:0},{x:0,y:-l},{x:l,y:0},{x:0,y:l}],c=0,h=d.length;c<h;++c){var p=d[c],g=new Kekule.Glyph.PathGlyphNode(null,null,o.add(a,p),o.add(s,p));g.setPropValues(i);var f=new Kekule.Glyph.PathGlyphConnector(null,t.LINE,[u,g]);f.setPropValues(n),this._applyParamsToConnector(f,r),this.appendNode(g),this.appendConnector(f)}},_applyParamsToConnector:function(e,t){e.setPathParams(t)}}),Kekule.Glyph.Segment=Class.create(Kekule.Glyph.StraightLine,{CLASS_NAME:"Kekule.Glyph.Segment"}),Kekule.Glyph.ReactionArrowType={NORMAL:"normal",REVERSIBLE:"reversible",RESONANCE:"resonance",RETROSYNTHESIS:"retrosynthesis",CUSTOM:"custom"},Kekule.Glyph.ReactionArrowType.getDefPathParamOfArrowType=function(e){var t,r=Kekule.Glyph.ReactionArrowType,i=Kekule.Glyph.ArrowType,n=Kekule.Glyph.ArrowSide;switch(e){case r.NORMAL:t={startArrowType:i.NONE,endArrowType:i.OPEN,endArrowSide:n.BOTH,lineCount:1};break;case r.REVERSIBLE:t={startArrowType:i.OPEN,startArrowSide:n.REVERSED,endArrowType:i.OPEN,endArrowSide:n.SINGLE,lineGap:.1,lineCount:2};break;case r.RESONANCE:t={startArrowType:i.OPEN,startArrowSide:n.BOTH,endArrowType:i.OPEN,endArrowSide:n.BOTH,lineCount:1};break;case r.RETROSYNTHESIS:t={startArrowType:i.NONE,endArrowType:i.OPEN,endArrowSide:n.BOTH,lineGap:.1,lineCount:2};break;default:t=null}return t},Kekule.Glyph.ReactionArrow=Class.create(Kekule.Glyph.StraightLine,{CLASS_NAME:"Kekule.Glyph.ReactionArrow",initProperties:function(){this.defineProp("reactionType",{dataType:DataType.STRING,enumSource:Kekule.Glyph.ReactionArrowType,setter:function(e){this.setPropStoreFieldValue("reactionType",e),this.reactionTypeChanged(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setReactionType(Kekule.Glyph.ReactionArrowType.NORMAL)},doCreateDefaultStructure:function(e,t){var r=t,i=t.reactionType||this.getReactionType();if(i){var n=this._getPathParamOfArrowType(i);r=Object.extend(n,t)}var o=this.tryApplySuper("doCreateDefaultStructure",[e,r]);return i&&this.setReactionType(i),o},reactionTypeChanged:function(e){var t=this._getPathParamOfArrowType(e);if(t){var r=this.getConnectorAt(0);r&&r.modifyPathParams(t)}},_getPathParamOfArrowType:function(e){return Kekule.Glyph.ReactionArrowType.getDefPathParamOfArrowType(e)}}),Kekule.Glyph.ElectronPushingArrow=Class.create(Kekule.Glyph.BaseArc,{CLASS_NAME:"Kekule.Glyph.ElectronPushingArrow",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.INT,getter:function(){var e=this._getValidArrowSide(),t=Kekule.Glyph.ArrowSide;return e===t.BOTH?2:[t.SINGLE,t.REVERSED].indexOf(e)>=0?1:null},setter:function(e){var t=Kekule.Glyph.ArrowSide,r=this._getValidArrowPos(),i=this.getConnectorAt(0);r||(i.getPathParams().endArrowType=Kekule.Glyph.ArrowType.OPEN,r="end");var n=i.getPathParams();e>=2?n[r+"ArrowSide"]=t.BOTH:1===e&&(n[r+"ArrowSide"]=t.SINGLE),i.setPathParams(n)}}),this.defineProp("directReceptor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(1);return this._getValidElectronTarget(e)},setter:function(e){var t=this.getNodeAt(1);this._setValidElectronTarget(t,e)}}),this.defineProp("directDonor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(0);return this._getValidElectronTarget(e)},setter:function(e){var t=this.getNodeAt(0);this._setValidElectronTarget(t,e)}}),this.defineProp("receptor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(1);return this._getValidElectronTargetNodeOrConnector(e)},setter:function(e){var t=this.getNodeAt(1);this._setValidElectronTarget(t,e)}}),this.defineProp("donor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(0);return this._getValidElectronTargetNodeOrConnector(e)},setter:function(e){var t=this.getNodeAt(0);this._setValidElectronTarget(t,e)}})},doCreateDefaultStructure:function(e,t){var r=this.tryApplySuper("doCreateDefaultStructure",[e,t]);return t.electronCount&&this.setElectronCount(t.electronCount),r},_isValidElectronTarget:function(e){return this._isValidChemNodeOrConnectorStickTarget(e)},_getValidElectronTarget:function(e){return Kekule.Glyph.ElectronArrowGlyphUtils.getValidElectronTarget(e)},_setValidElectronTarget:function(e,t){return Kekule.Glyph.ElectronArrowGlyphUtils.setValidElectronTarget(e,t),this},_getValidElectronTargetNodeOrConnector:function(e){return Kekule.Glyph.ElectronArrowGlyphUtils.getValidElectronTargetNodeOrConnector(e)},_getValidArrowPos:function(){var e=this.getConnectorAt(0),t=e&&e.getPathParams();if(t){if(t.endArrowType)return"end";if(t.startArrowType)return"start"}return null},_getValidArrowSide:function(){var e=this.getConnectorAt(0),t=e&&e.getPathParams();if(t){if(t.endArrowType)return t.endArrowSide||Kekule.Glyph.ArrowSide.DEFAULT;if(t.startArrowType)return t.startArrowSide||Kekule.Glyph.ArrowSide.DEFAULT}return null},_applyParamsToConnector:function(e,t){var r=Object.create(t);Kekule.ObjUtils.isUnset(t.autoOffset)&&(r.autoOffset=!0),e.setPathParams(r)}}),Kekule.Glyph.BondFormingElectronPushingArrow=Class.create(Kekule.Glyph.BaseTwinArc,{CLASS_NAME:"Kekule.Glyph.BondFormingElectronPushingArrow",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.INT,getter:function(){for(var t=null,r=0,i=this.getConnectorCount();r<i;++r){var n=this._getConnectorElectronCount(this.getConnectorAt(r));if(e.notUnset(n))if(e.isUnset(t))t=n;else if(t!==n)return null}return t*this.getConnectorCount()},setter:function(e){if(e!==this.getElectronCount()){var t=this.getConnectorCount()?e/this.getConnectorCount():e;(t=Math.round(t))<=0&&(t=1);for(var r=Kekule.Glyph.ArrowSide,i=this.getConnectors(),n=0,o=i.length;n<o;++n){var a=i[n];a.getPathParams().endArrowType=Kekule.Glyph.ArrowType.OPEN,"end";var s=a.getPathParams();t>=2?s.endArrowSide=r.BOTH:1===t&&(s.endArrowSide=n%2?r.SINGLE:r.REVERSED),a.setPathParams(s)}}}}),this.defineProp("directDonors",{dataType:DataType.ARRAY,getter:function(){for(var e=this._getArrowStartingNodes(),t=[],i=0,n=e.length;i<n;++i){var o=r.getValidElectronTarget(e[i]);o&&t.push(o)}return t},setter:function(e){var t=this._getArrowStartingNodes();if(t.length)for(var i=0,n=t.length;i<n;++i){var o=t[i];e[i];r.setValidElectronTarget(o,e)}}}),this.defineProp("donors",{dataType:DataType.ARRAY,getter:function(){for(var e=this._getArrowStartingNodes(),t=[],i=0,n=e.length;i<n;++i){var o=r.getValidElectronTargetNodeOrConnector(e[i]);o&&t.push(o)}return t},setter:function(e){this.setDirectDonors(e)}})},_getConnectorElectronCount:function(e){var t=e&&e.getPathParams();if(t){var r=Kekule.Glyph.ArrowSide,i=t.endArrowType?t.endArrowSide||Kekule.Glyph.ArrowSide.DEFAULT:null;if(i===r.BOTH)return 2;if([r.SINGLE,r.REVERSED].indexOf(i)>=0)return 1}return null},doCreateDefaultStructure:function(e,t){var r=this.tryApplySuper("doCreateDefaultStructure",[e,t]);return this.setElectronCount(t.electronCount||1),r}})}(),function(){"use strict";Kekule.CoordMode,Kekule.CoordUtils;Kekule.ContentBlock=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ContentBlock",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){this.defineProp("needRecalcSize",{dataType:DataType.BOOL})},getAutoIdPrefix:function(){return"b"},getCornerCoord1:function(e,t){return this.getCoordOfMode(e,t)},getCornerCoord2:function(e,t){var r=this.getCornerCoord1(e,t),i=this.getSizeOfMode(e,t);return Kekule.CoordUtils.add(r,i)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ContentBlock),Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.ContentBlock),Kekule.TextBlock=Class.create(Kekule.ContentBlock,{CLASS_NAME:"Kekule.TextBlock",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,r,i]),this.setText(t||"")},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"t"},doObjectChange:function(e){Kekule.ArrayUtils.intersect(["text","renderOptions"],e).length&&this.setNeedRecalcSize(!0)}}),Kekule.ImageBlock=Class.create(Kekule.ContentBlock,{CLASS_NAME:"Kekule.ImageBlock",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,r,i]),t&&this.setSrc(t)},initProperties:function(){this.defineProp("src",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,setter:function(e){e!==this.getSrc()&&(this.setPropStoreFieldValue("src",e),this._clearCacheImg())}}),this.defineProp("cacheImg",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("cacheImg");return!e&&Kekule.$document&&(e=this._createCacheImg(this.getSrc())),e}})},getAutoIdPrefix:function(){return"g"},_createCacheImg:function(e){var t,r=Kekule.$document;return r&&r.body&&r.createElement&&((t=r.createElement("img")).src=e),t},_clearCacheImg:function(){var e=this.getPropStoreFieldValue("cacheImg");if(e){e.src="";try{delete e.width,delete e.height}catch(e){}}}})}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.ChemMarker={},ClassEx.extend(Kekule.ChemObject,{isAttachedMarker:function(){var e=this.getParent();return e&&e.hasMarker(this)},notifyAttachedMarkersChanged:function(){this.notifyPropSet("attachedMarkers",this.getPropStoreFieldValue("attachedMarkers"))},_attachedMarkerAdded:function(e){},_attachedMarkerRemoved:function(e){},getMarkerCount:function(){var e=this.getPropStoreFieldValue("attachedMarkers");return e?e.length:0},getMarkerAt:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return t?t[e]:null},getMarkerOfType:function(e,t){for(var r=0,i=this.getMarkerCount();r<i;++r){var n=this.getMarkerAt(r);if(t&&n.getClass()===e||n instanceof e)return n}return null},getMarkersOfType:function(e,t){for(var r=[],i=0,n=this.getMarkerCount();i<n;++i){var o=this.getMarkerAt(i);(t&&o.getClass()===e||o instanceof e)&&r.push(o)}return r},fetchMarkerOfType:function(e,t,r,i){var n=this.getMarkerOfType(e,r);if(!n&&t){(n=new e).beginUpdate();try{i&&n.setPropValues(i),this.appendMarker(n)}finally{n.endUpdate()}}return n},getUnplacedMarkers:function(e){for(var t=[],r=0,i=this.getMarkerCount();r<i;++r){var n=this.getMarkerAt(r);n.getCoordOfMode(e)||t.push(n)}return t},indexOfMarker:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return t?t.indexOf(e):-1},hasMarker:function(e){return this.indexOfMarker(e)>=0},hasMarkerOfType:function(e,t){return!!this.getMarkerOfType(e,t)},appendMarker:function(e){var t=this.indexOfMarker(e);if(t>=0)return t;var r=this.getAttachedMarkers(!0).push(e);e.beginUpdate();try{e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this),this._attachedMarkerAdded(e)}finally{e.endUpdate()}return this.notifyAttachedMarkersChanged(),r},insertMarkerBefore:function(e,t){var r=this.indexOfMarker(t);return this.insertMarkerAt(e,r)},insertMarkerAt:function(t,r){this.indexOfMarker(t);var i=this.getAttachedMarkers(!0);(Kekule.ObjUtils.isUnset(r)||r<0)&&(r=i.length);var n=e.insertUniqueEx(i,t,r);return n.isInserted&&(t.setOwner&&t.setOwner(this.getOwner()),t.setParent&&t.setParent(this),this._attachedMarkerAdded(t)),this.notifyAttachedMarkersChanged(),n.index},setMarkerIndex:function(e,t){var r=this.indexOfMarker(e);if(r>=0){var i=this.getPropStoreFieldValue("attachedMarkers");i.splice(r,1),i.splice(t,0,e)}},removeMarkerAt:function(e){var t=this.getMarkerAt(e);if(t){var r=this.getAttachedMarkers(!0).splice(e,1);return t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this._attachedMarkerRemoved(t),this.notifyAttachedMarkersChanged(),r}},removeMarker:function(e){var t=this.indexOfMarker(e);if(t>=0)return this.removeMarkerAt(t)},replaceMarker:function(e,t){var r=this.indexOfMarker(e);return r<0?this:(this.removeMarkerAt(r),this.insertMarkerAt(t,r),this)},clearMarkers:function(){var t=this.getPropStoreFieldValue("attachedMarkers");if(t&&(t=e.clone(t)),this.setPropStoreFieldValue("attachedMarkers",null),t)for(var r=0,i=t.length;r<i;++r){var n=t[r];n.setOwner&&n.setOwner(null),n.setParent&&n.setParent(null),this._attachedMarkerRemoved(n)}return this.notifyAttachedMarkersChanged(),this},autoSetMarker2DPos:function(e,t,r,i){if(this.hasMarker(e)){var n=Kekule.ChemStructureUtils.getMostEmptyDirection2DAngleOfObj(this,[e],r,!0,!1,i),o={x:t*Math.cos(n),y:t*Math.sin(n)};e.setCoord2D(o)}},_updateAttachedMarkersOwner:function(e){e||(e=this.getOwner());for(var t=0,r=this.getMarkerCount();t<r;++t){var i=this.getMarkerAt(t);i.setOwner&&i.setOwner(e)}},_updateAttachedMarkersParent:function(e){e||(e=this);for(var t=0,r=this.getMarkerCount();t<r;++t){var i=this.getMarkerAt(t);i.setParent&&i.setParent(e)}}}),ClassEx.extendMethod(Kekule.ChemObject,"ownerChanged",function($origin,e){$origin(e),this._updateAttachedMarkersOwner(e)}),ClassEx.extendMethod(Kekule.ChemObject,"removeChild",function($origin,e){var t=$origin(e);return t||(t=this.removeMarker(e)),t}),ClassEx.extendMethod(Kekule.ChemObject,"insertBefore",function($origin,e,t){var r=$origin(e,t);return r<0&&(t&&this.hasMarker(t)||e instanceof Kekule.ChemMarker.BaseMarker)&&(r=this.insertMarkerBefore(e,t)),r}),ClassEx.extendMethod(Kekule.ChemObject,"getChildSubgroupNames",function($origin){return $origin().concat("marker")}),ClassEx.defineProp(Kekule.ChemObject,"attachedMarkers",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLISHED,getter:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return!t&&e&&(t=[],this.setPropStoreFieldValue("attachedMarkers",t)),t},setter:function(e){this.clearMarkers(),this.setPropStoreFieldValue("attachedMarkers",e),this._updateAttachedMarkersOwner(),this._updateAttachedMarkersParent()}})}(),function(){"use strict";Kekule.ChemMarker.BaseMarker=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemMarker.BaseMarker",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},getAutoIdPrefix:function(){return"marker"},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof Kekule.ChemStructureNode||e instanceof Kekule.BaseStructureConnector)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ChemMarker.BaseMarker),Kekule.ChemMarker.UnbondedElectronSet=Class.create(Kekule.ChemMarker.BaseMarker,{CLASS_NAME:"Kekule.ChemMarker.UnbondedElectronSet",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.VARIANT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setElectronCount(2)},getAutoIdPrefix:function(){return"electron"}}),Kekule.ChemMarker.ChemPropertyMarker=Class.create(Kekule.ChemMarker.BaseMarker,{CLASS_NAME:"Kekule.ChemMarker.ChemPropertyMarker",initProperties:function(){this.defineProp("value",{dataType:DataType.VARIANT,serializable:!1,getter:function(){var e,t=this.getParent(),r=this.getPropertyName();return t&&r?(e=t.getPropValue(r),this.setPropStoreFieldValue("value",e)):e=this.getPropStoreFieldValue("value"),e},setter:function(e){this.setPropStoreFieldValue("value",e),this.setParentPropValue(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},setParentPropValue:function(e){var t=this.getParent();if(t){var r=this.getPropertyName();r&&t&&t.setPropValue(r,e)}return this},resetParentPropValue:function(){return this.setParentPropValue(void 0)},getPropertyName:function(){return null},beforAddingByEditor:function(e,t){if(e){var r=this.getPropStoreFieldValue("value");Kekule.ObjUtils.notUnset(r)&&this.setParentPropValue(r)}this.tryApplySuper("beforAddingByEditor")},beforeRemovingByEditor:function(e){this.setPropStoreFieldValue("value",this.getValue()),this.resetParentPropValue()}}),Kekule.ChemMarker.Charge=Class.create(Kekule.ChemMarker.ChemPropertyMarker,{CLASS_NAME:"Kekule.ChemMarker.Charge",getPropertyName:function(){return"chargeEx"},getAutoIdPrefix:function(){return"charge"},doSetValue:function(e){"number"==typeof e?this.tryApplySuper("doSetValue",[{precise:e}]):this.tryApplySuper("doSetValue",[e])}}),Kekule.ChemMarker.Radical=Class.create(Kekule.ChemMarker.ChemPropertyMarker,{CLASS_NAME:"Kekule.ChemMarker.Radical",getPropertyName:function(){return"radical"},getAutoIdPrefix:function(){return"radical"}}),ClassEx.extend(Kekule.ChemStructureNode,{fetchChargeMarker:function(e,t){return this.fetchMarkerOfType(Kekule.ChemMarker.Charge,e,!1,t)},fetchRadicalMarker:function(e,t){return this.fetchMarkerOfType(Kekule.ChemMarker.Radical,e,!1,t)}}),ClassEx.defineProp(Kekule.AbstractAtom,"lonePairCount",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED,serializable:!1,setter:null,getter:function(){for(var e=0,t=this.getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet),r=0,i=t.length;r<i;++r){2===t[r].getElectronCount()&&++e}return e}}),ClassEx.extendMethod(Kekule.AbstractAtom,"doCompare",function($origin,e,t){var r=$origin(e,t);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(t,"lonePair")||this._getComparisonOptionFlagValue(t,"unbondedElectron"))){var i=function(e){var t=[];if(e.getMarkersOfType)for(var r=e.getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet),i=0,n=r.length;i<n;++i){var o=r[i];t.push(o.getElectronCount())}return t.sort(),t},n=i(this),o=i(e);return Kekule.ArrayUtils.compare(n,o)}return r})}(),function(e){"use strict";"undefined"!=typeof window&&(e=window);var t,r,i,n=e,o=n&&n.document;void 0===Kekule&&(Kekule={}),"undefined"==typeof navigator?(Kekule.Browser={},Kekule.BrowserFeature={}):(Kekule.Browser={IE:!(!n.attachEvent||n.opera),Opera:!!n.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("like Gecko")<0&&-1==navigator.userAgent.indexOf("KHTML"),MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),language:navigator.language||navigator.browserLanguage},Kekule.Browser.IEVersion=Kekule.Browser.IE&&(-1!==(i=navigator.userAgent.toLowerCase()).indexOf("msie")&&parseInt(i.split("msie")[1])),Kekule.BrowserFeature={typedArray:"undefined"!=typeof ArrayBuffer,svg:!!n.SVGSVGElement,canvas:!!n.CanvasRenderingContext2D,webgl:!!function(){try{var e=o.createElement("canvas");return!!n.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(e){return!1}}(),htmlTemplate:!!n.HTMLTemplateElement,htmlSlot:!!n.HTMLSlotElement,downloadHref:"download"in o.createElement("a"),blob:!!n.Blob,workers:!!n.Worker,fileapi:!!(n.File&&n.FileReader&&n.FileList&&n.Blob),sessionStorage:function(){try{return!!n.sessionStorage}catch(e){return!1}}(),localStorage:function(){try{return!!n.localStorage}catch(e){return!1}}(),cssTransition:(r=o.createElement("div").style,"transition"in r||"WebkitTransition"in r||"MozTransition"in r||"msTransition"in r||"OTransition"in r),cssTranform:function(e){return"transform"in e||"WebkitTransform"in e||"MozTransform"in e||"msTransform"in e||"OTransform"in e}(o.createElement("div").style),cssFlex:function(e){return"flex"in e||"WebkitFlex"in e||"MozFlex"in e||"msFlex"in e||"OFlex"in e}(o.createElement("div").style),cssGrid:function(e){return"grid"in e||"WebkitGrid"in e||"MozGrid"in e||"msGrid"in e||"OGrid"in e}(o.createElement("div").style),html5Form:{placeholder:"placeholder"in o.createElement("input"),supportType:function(e){var t=o.createElement("input");t.setAttribute("type",e);var r=t.type===e;if(r&&["text","url","search"].indexOf(e.toLowerCase())<0){t.value=":)",r=":)"!==t.value}return r}},mutationObserver:n.MutationObserver||n.MozMutationObserver||n.WebkitMutationObserver,resizeObserver:!!n.ResizeObserver,touchEvent:!!n.touchEvent,pointerEvent:!!n.PointerEvent,draggable:(t=o.createElement("div"),"draggable"in t||"ondragstart"in t&&"ondrop"in t),webAssembly:"object"==typeof n.WebAssembly&&"function"==typeof n.WebAssembly.instantiate}),function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!n.requestAnimationFrame;++r)n.requestAnimationFrame=n[t[r]+"RequestAnimationFrame"],n.cancelAnimationFrame=n[t[r]+"CancelAnimationFrame"]||n[t[r]+"CancelRequestAnimationFrame"];n.requestAnimationFrame||(n.requestAnimationFrame=function(t,r){var i=(new Date).getTime(),o=Math.max(0,16-(i-e)),a=n.setTimeout(function(){t(i+o)},o);return e=i+o,a}),n.cancelAnimationFrame||(n.cancelAnimationFrame=function(e){clearTimeout(e)})}(),Kekule.X={};var a,s=Kekule.X,l=function(e){return!function(e){return null==e}(e)},u=function(e){var t=n.getComputedStyle?n.getComputedStyle(e,null).position:e.currentStyle?e.currentStyle.position:null;return!!t&&(!!t&&("relative"===(t=t.toString().toLowerCase())||"absolute"===t))};if(s.MutationObserver=n.MutationObserver||n.MozMutationObserver||n.WebkitMutationObserver,s.Event={MOUSE_BTN_LEFT:0,MOUSE_BTN_RIGHT:2,MOUSE_BTN_MID:1,MOUSE_BTN_LR:3},s.Event.PointerType={MOUSE:"mouse",TOUCH:"touch",PEN:"pen"},s.Event.MouseButton={LEFT:0,RIGHT:2,MID:1,LR:3},s.Event.KeyCode={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRTSC:44,INS:45,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145},s.Event.isSupported=(a={},function(e){if(0===e.indexOf("touch"))return Kekule.BrowserFeature.touchEvent;if(0===e.indexOf("pointer"))return Kekule.BrowserFeature.pointerEvent;var t={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img",unload:"win",resize:"win"},r=e.replace(/^on/,"");if(a[r])return a[r];var i="win"==t[r]?n:o.createElement(t[r]||"div"),s=(e="on"+r)in i;return s||(i.setAttribute(e,"return;"),s="function"==typeof i[e]),i=null,a[r]=s,s}),s.Event.Methods={getType:function(e){return e.__$type__||e.type},setType:function(e,t){e.__$type__=t;try{e.type=t}catch(e){}},getPointerType:function(e){return e.pointerType},getTarget:function(e){var t=e.__$target__||e.target||e.srcElement;return 3==t.nodeType&&(t=t.parentNode),t},setTarget:function(e,t){e.__$target__=t;try{e.target=t}catch(e){}},getCurrentTarget:function(e){return e.currentTarget},getEventPhase:function(e){return e.eventPhase},getAltKey:function(e){return e.altKey},getCtrlKey:function(e){return e.ctrlKey},getShiftKey:function(e){return e.shiftKey},getMetaKey:function(e){return e.metaKey},getRepeat:function(e){return e.repeat},getCharCode:function(e){return l(e.charCode)?e.charCode:e.keyCode},getKeyCode:function(e){return e.keyCode},getKey:function(e){return e.key},getCode:function(e){return e.code},getClientX:function(e){var t;if(e.touches){var r=e.touches[0];t=r&&r.clientX}return void 0===t&&(t=e.clientX),t},getClientY:function(e){var t;if(e.touches){var r=e.touches[0];t=r&&r.clientY}return void 0===t&&(t=e.clientY),t},getScreenX:function(e){var t;if(e.touches){var r=e.touches[0];t=r&&r.screenX}return void 0===t&&(t=e.screenX),t},getScreenY:function(e){var t;if(e.touches){var r=e.touches[0];t=r&&r.screenY}return void 0===t&&(t=e.screenY),t},getPageX:function(e){var t;if(e.touches){var r=e.touches[0];r&&l(r.pageX)&&(t=r.pageX)}if(void 0===t&&l(e.pageX)&&(t=e.pageX),void 0===t){var i=s.Event.getTarget(e).ownerDocument||s.Event.getTarget(e),n=i?i.body:null;t=s.Event.getClientX(e)+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0)}return t},getPageY:function(e){var t;if(e.touches){var r=e.touches[0];if(r&&l(r.pageY))return r.pageY}else if(void 0===t&&l(e.pageY))return e.pageY;if(void 0===t){var i=s.Event.getTarget(e).ownerDocument||s.Event.getTarget(e),n=i?i.body:null;t=s.Event.getClientY(e)+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)}return t},getOffsetX:function(e){if(l(e.offsetX))return e.offsetX;var t=s.Event.getTarget(e);if((t.defaultView||t.parentWindow)&&t.body&&(t=t.body),l(e.layerX)&&u(t)&&!e.touches)return e.layerX;var r=s.Event.getClientX(e);return Math.round(r-Kekule.HtmlElementUtils.getElemPagePos(t,!0).x)},getOffsetY:function(e){if(l(e.offsetY))return e.offsetY;var t=s.Event.getTarget(e);if((t.defaultView||t.parentWindow)&&t.body&&(t=t.body),l(e.layerY)&&u(t)&&!e.touches)return e.layerY;var r=s.Event.getClientY(e);return Math.round(r-Kekule.HtmlElementUtils.getElemPagePos(t,!0).y)},getOffsetCoord:function(e,t){var r,i=s.Event.getTarget(e);if(t&&Kekule.ObjUtils.isUnset(e.offsetX)&&(r=Kekule.StyleUtils.getTotalTransformMatrix(i)),r){var n=s.Event.getClientX(e),o=s.Event.getClientY(e),a={x:n-Kekule.HtmlElementUtils.getElemBoundingClientRect(i).x,y:o-Kekule.HtmlElementUtils.getElemBoundingClientRect(i).y},l=Kekule.StyleUtils.calcInvertTransformMatrix(r);if(l){var u=Kekule.MatrixUtils.create(3,1);u[0][0]=a.x,u[1][0]=a.y,u[2][0]=1;var d=Kekule.MatrixUtils.multiply(l,u);return a.x=d[0][0],a.y=d[1][0],a}}return{x:s.Event.getOffsetX(e),y:s.Event.getOffsetY(e)}},getWindowX:function(e){var t=s.Event.getPageX(e),r=e.target.ownerDocument||e.target,i=r&&(r.defaultView||r.parentWindow);return t-(i&&i.scrollX||0)},getWindowY:function(e){var t=s.Event.getPageY(e),r=e.target.ownerDocument||e.target,i=r&&(r.defaultView||r.parentWindow);return t-(i&&i.scrollY||0)},getRelXToCurrTarget:function(e){var t=s.Event.getCurrentTarget(e);(t.defaultView||t.parentWindow)&&t.body&&(t=t.body);var r=s.Event.getClientX(e);return Math.round(r-Kekule.HtmlElementUtils.getElemPagePos(t,!0).left)},getRelYToCurrTarget:function(e){var t=s.Event.getCurrentTarget(e);(t.defaultView||t.parentWindow)&&t.body&&(t=t.body);var r=s.Event.getClientY(e);return Math.round(r-Kekule.HtmlElementUtils.getElemPagePos(t,!0).top)},getTouches:function(e){return e.touches}},s.Event._MouseEventEx={isMouseEnterLeaveEvent:function(e){return"mouseenter"===e||"mouseleave"===e},addMouseEnterLeaveListener:function(e,t,r,i){if("mouseenter"===t&&s.Event.isSupported("mouseenter")||"mouseleave"===t&&s.Event.isSupported("mouseleave"))return e.addEventListener(t,r,i);var o=function(e){var i=e.getTarget?e.getTarget():e.target,o=e.getCurrentTarget?e.getCurrentTarget():e.currentTarget;if(i===o||Kekule.DomUtils.isDescendantOf(i,o)){var a=e.getRelatedTarget?e.getRelatedTarget():e.relatedTarget;if(!a||!Kekule.DomUtils.isDescendantOf(a,o)){var s=new MouseEvent(t,{view:n,bubbles:!1,cancelable:!0,target:o,currentTarget:o,relatedTarget:a});r.call(o,s)}}};r.__$mouseExListenerWrapper__=o;var a="mouseenter"===t?"mouseover":"mouseout";return e.addEventListener(a,o,i)},removeMouseEnterLeaveListener:function(e,t,r){if("mouseenter"===t&&s.Event.isSupported("mouseenter")||"mouseleave"===t&&s.Event.isSupported("mouseleave"))return e.removeEventListener(t,r);var i="mouseenter"===t?"mouseover":"mouseout";return e.removeEventListener(i,r.__$mouseExListenerWrapper__||r)}},s.Event._W3C={addListener:function(e,t,r,i){return s.Event._MouseEventEx.isMouseEnterLeaveEvent(t)?s.Event._MouseEventEx.addMouseEnterLeaveListener(e,t,r,i):e.addEventListener(t,r,i)},removeListener:function(e,t,r,i){return s.Event._MouseEventEx.isMouseEnterLeaveEvent(t)&&r.__$listenerWrapper__?s.Event._MouseEventEx.removeMouseEnterLeaveListener(e,t,r.__$listenerWrapper__):e.removeEventListener(t,r,i)},stopPropagation:function(e){e.stopPropagation()},preventDefault:function(e){e.preventDefault()}},s.Event._W3CMethods={getRelatedTarget:function(e){return e.relatedTarget},getButton:function(e){return e.button}},s.Event._Gecko={addListener:function(e,t,r,i){if(s.Event._MouseEventEx.isMouseEnterLeaveEvent(t))return s.Event._MouseEventEx.addMouseEnterLeaveListener(e,t,r,i);if("mousewheel"===t){var n=function(t){t.wheelDeltaY=t.wheelDelta=40*-t.detail,t.__$type__="mousewheel",r.call(e,t)};r.__$mousewheelListenerWrapper__=n,e.addEventListener("DOMMouseScroll",n,i)}else e.addEventListener(t,r,i)},removeListener:function(e,t,r,i){"mousewheel"===t&&r.__$mousewheelListenerWrapper__?e.removeEventListener("DOMMouseScroll",r.__$mousewheelListenerWrapper__,i):e.removeEventListener(t,r,i)}},s.Event._IE={_handlers:{},WIN_UNLOAD_FLAG_FIELD:"__$win_unload_linked__",addListener:function(e,t,r,i){if(!(s.Event.findHandlerIndex(e,t,r)>=0)){var n=function(t){t||(t=a.event),t.currentTarget=e,t.eventPhase=t.srcElement===e?2:3,h||Object.extend(t,p),r.call(e,t)};e.attachEvent(s.Event.getEventName(t),n),s.Event.registerHandler(e,t,r,n);var o=e.ownerDocument||e,a=o.parentWindow||o;s.Event._linkUnloadEvent(a)}},removeListener:function(e,t,r,i){var n=s.Event.findHandlerIndex(e,t,r);if(n>=0){var o=s.Event._handlers[t][n].wrapper;e.detachEvent(s.Event.getEventName(t),o),s.Event._handlers[t].splice(n,1)}},stopPropagation:function(e){e.cancelBubble=!0},preventDefault:function(e){e.returnValue=!1},removeAllListeners:function(e){var t=s.Event._handlers;if(t)for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];if(i&&i.length)for(var n=s.Event.getEventName(r),o=i.length-1;o>=0;--o){var a=i[o];e&&a.element.ownerDocument!==e||(a.element.detachEvent(n,a.wrapper),i.splice(o,1))}}},getEventName:function(e){return"on"+e},registerHandler:function(e,t,r,i){var n=s.Event._handlers;n[t]||(n[t]=[]),n[t].push({element:e,handler:r,wrapper:i})},unregisterHandler:function(e,t,r){if(r[t]){var i=r[t],n=s.Event.findHandlerIndex(e,t,r);n>=0&&i.splice(n,1)}},findHandlerIndex:function(e,t,r){var i=s.Event._handlers[t];if(!i)return-1;for(var n=0,o=i.length;n<o;++n){var a=i[n];if(a.element===e&&a.handler===r)return n}return-1},_linkUnloadEvent:function(e){var t=s.Event.WIN_UNLOAD_FLAG_FIELD;e[t]||(e.attachEvent("onunload",s.Event.reactWinUnload),e[t]=!0)},reactWinUnload:function(){var e=this.ownerDocument;s.Event.removeAllListeners(e)}},s.Event._IEMethods={getRelatedTarget:function(e){var t=e.type;return["focusin","mouseenter","mouseover","pointerenter","pointerover","dragenter"].indexOf(t)>=0?e.fromElement||e.toElement:e.toElement||e.fromElement},getButton:function(e){switch(e.button){case 1:return 0;case 2:return 2;case 4:return 1;case 3:return 3;default:return e.button}},stopPropagation:function(e){e.cancelBubble=!0},preventDefault:function(e){e.returnValue=!1}},o)if(o.addEventListener)s.Event=Object.extend(s.Event,s.Event._W3C),s.Event.Methods=Object.extend(s.Event.Methods,s.Event._W3CMethods),Kekule.Browser.Gecko&&(s.Event=Object.extend(s.Event,s.Event._Gecko));else if(o.attachEvent&&(s.Event=Object.extend(s.Event,s.Event._IE),s.Event.Methods=Object.extend(s.Event.Methods,s.Event._IEMethods),n.Element)){var d=n.Element.prototype;d.addEventListener=s.Event.addListener.methodize(),d.removeEventListener=s.Event.removeListener.methodize()}Object.extend(s.Event,s.Event.Methods);var c=null;n.Event&&(c=n.Event.prototype),c||o&&o.createEvent&&(c=o.createEvent("HTMLEvents").__proto__);var h=!!c,p={},g=s.Event.Methods;for(var f in g)g.hasOwnProperty(f)&&"function"==typeof g[f]&&(p[f]=g[f].methodize());c&&Object.extend(c,p),function(){if(void 0!==o){var e=o.createElement("div");!("draggable"in e)&&"ondragstart"in e&&"ondrop"in e&&Kekule.X.Event.addListener(o,"selectstart",function(e){for(var t=e.target;t;t=t.parentNode)if(t.attributes&&t.attributes.draggable)return e.preventDefault(),e.stopImmediatePropagation?e.stopImmediatePropagation():e.stopPropagation(),t.dragDrop(),!1})}}(),s.Ajax={XMLHttpFactories:[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],_availableFactoryIndex:-1,createXMLHTTPObject:function(){var e=!1,t=s.Ajax.XMLHttpFactories,r=s.Ajax._availableFactoryIndex;if(r>=0)e=t[r]();else for(var i=0;i<t.length;i++){try{e=t[i](),s.Ajax._availableFactoryIndex=i}catch(e){continue}break}return e},preparePostData:function(e){var t=e;return"object"==typeof e&&(t=Kekule.UrlUtils.generateSearchString(e)),t},request:function(e){return s.Ajax.sendRequest(e.url,e.callback,e.postData,e.xhrProps)},sendRequest:function(e,t,r,i,n){var o=!1,a=!0,l=s.Ajax.createXMLHTTPObject();if(l){var u,d,c=r?"POST":"GET";if(l.open(c,e,!0),l.setRequestHeader("User-Agent","XMLHTTP/1.0"),r&&l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i&&("object"==typeof i?(u=(d=i).responseType,n=d.overwriteMimeType):"string"==typeof i&&(u=i)),u){try{l.responseType=u}catch(e){}"arraybuffer"!==u&&"blob"!==u||(o=!0),l.responseType!==u&&(a=!1)}if(o&&!a&&l.overwriteMimeType&&l.overrideMimeType("text/plain; charset=x-user-defined"),n&&l.overwriteMimeType&&l.overwriteMimeType(n),d)for(var h in d)if(h in l)try{l[h]=d[h]}catch(e){}if(l.onreadystatechange=function(){if(4==l.readyState){if(200!=l.status&&304!=l.status)throw t(null,l,!1),"HTTP error "+l.status;t(l.response||l.responseText,l,!0)}},4!=l.readyState)return l.send(s.Ajax.preparePostData(r)),l}},getResponseMimeType:function(e){return e.getResponseHeader("content-type")||""}},Kekule.Ajax=Kekule.X.Ajax,Kekule.X.DomReady={isReady:!1,suspendFlag:0,funcs:[],domReady:function(e,t){if(t||(t=o),C.initReady(t),!C.isReady){var r=t&&t.readyState;("complete"===r||"loaded"===r||"interactive"===r&&!Kekule.Browser.IE)&&(C.isReady=!0)}C.isReady?e():C.funcs.push(e)},fireReady:function(){C.isReady||(C.isReady=!0,C._execFuncs())},_execFuncs:function(){var e=C.funcs;if(e&&e.length)for(;e.length&&!C.isSuspending();){var t=e.shift();t&&t()}},suspend:function(){++C.suspendFlag},resume:function(){C.suspendFlag>0&&--C.suspendFlag,C.isSuspending()||C._execFuncs()},isSuspending:function(){return C.suspendFlag>0},initReady:function e(t){t||(t=o),t&&t.addEventListener?t.addEventListener("DOMContentLoaded",function(){t.removeEventListener("DOMContentLoaded",e,!1),C.fireReady()},!1):t&&t.getElementById&&(t.write('<script id="ie-domReady" defer="defer" src="//:"><\/script>'),t.getElementById("ie-domReady").onreadystatechange=function(){"complete"===this.readyState&&(C.fireReady(),this.onreadystatechange=null,this.parentNode.removeChild(this))})}};var C=Kekule.X.DomReady;Kekule.X.domReady=C.domReady}(this),function(e){"use strict";var t=!0;"undefined"==typeof window&&(t=!1),Kekule.NativeServices={MODE_OPEN:"open",MODE_SAVE:"save",FILTER_ALL_SUPPORT:"all",FILTER_ANY:"any",showFilePickerDialog:function(e,t,r){if(Kekule.NativeServices.doShowFilePickerDialog)return Kekule.NativeServices.doShowFilePickerDialog(e,t,r)},canLoadFileData:function(e){return!!r.doLoadFileData||!!r.doShowFilePickerDialog},loadFileData:function(e,t,i){if(Kekule.NativeServices.doLoadFileData)return Kekule.NativeServices.doLoadFileData(e,t,i);var n=Object.create(i||{});n.multiple=!1,n.mode=r.MODE_OPEN;r.showFilePickerDialog(e,function(e,r,i){if(e&&r)if(Kekule.BrowserFeature.fileapi){var o=r.name,a=n.binaryDetector&&n.binaryDetector(o,r),s=new FileReader;s.onload=function(e){var r=s.result;t&&t(!0,r,o)},s.onerror=function(){t&&t(!1),Kekule.error(Kekule.$L("ErrorMsg.ERROR_LOADING_FILE"+o))},a?s.readAsArrayBuffer(r):s.readAsText(r)}else Kekule.error(Kekule.$L("ErrorMsg.FILE_API_NOT_SUPPORTED"));else t(e,null,null)},n)},canSaveFileData:function(e){return!!r.doSaveFileData},saveFileData:function(e,t,r,i){if(Kekule.NativeServices.doSaveFileData)return Kekule.NativeServices.doSaveFileData(e,t,r,i)}};var r=Kekule.NativeServices;Kekule.HtmlNativeServiceImpl={doShowFilePickerDialog:function(e,t,r){Kekule.HtmlNativeServiceImpl._createFileInputElem(e,t,r||{}).click()},_getFileInputElemForPickerDialog:function(e,t,r){},_createFileInputElem:function(e,t,r){var i=e.createElement("input");i.setAttribute("type","file");var n=r||{};if(n.multiple&&i.setAttribute("multiple","multiple"),n.filters){for(var o=[],a=0,s=n.filters.length;a<s;++a){var l=n.filters[a];if(l!==Kekule.NativeServices.FILTER_ALL_SUPPORT&&l!==Kekule.NativeServices.FILTER_ANY){var u=l.filter;u&&o.push(u)}}var d=o.join(",");i.setAttribute("accept",d)}var c=i.style;c.position="absolute",c.left="-100000px",c.opacity=0,e.body.appendChild(i);var h=function(e){var r=e.getTarget(),i=r.files,n=i&&i[0];t&&t(!0,n,i),Kekule.X.Event.removeListener(r,"change",h),r.ownerDocument.body.focus(),r.parentNode&&r.parentNode.removeChild(r)};return Kekule.X.Event.addListener(i,"change",h),i},doSaveFileData:function(e,t,r,i){var n=i.initialFileName||null,o=Kekule.HtmlNativeServiceImpl._createDataElem(e,t,n);o.click(),o.parentNode.removeChild(o),r&&r(null,null)},_createDataElem:function(e,t,r){var i=e.createElement("a"),n="data:application/octet-stream,"+encodeURIComponent(t);i.setAttribute("href",n),i.setAttribute("download",r||"");i.style;return i.position="absolute",i.left="-100000px",i.opacity=0,e.body.appendChild(i),i},doSaveFileDataIe:function(e,r,i,n){var o=n.initialFileName||null;if(Kekule.BrowserFeature.blob&&t&&window.navigator.msSaveOrOpenBlob){var a=new Blob([r]);window.navigator.msSaveBlob(a,o)}else{var s=Kekule.HtmlNativeServiceImpl._createAndExecDataIframe(e,r,o);s.parentNode.removeChild(s)}i&&i(null,null)},_createAndExecDataIframe:function(e,t,r){var i=e.createElement("iframe");e.body.appendChild(i);var n=i.contentWindow||i.contentDocument;n.document.open("text/html","replace");var o=t.toString();return n.document.write(o),n.document.close(),n.focus(),n.document.execCommand("SaveAs",!0,Kekule.UrlUtils.extractFileCoreName(r)),i}},Kekule.BrowserFeature.fileapi&&(r.doShowFilePickerDialog=Kekule.HtmlNativeServiceImpl.doShowFilePickerDialog),Kekule.Browser.IE||t&&window.navigator.msSaveOrOpenBlob?r.doSaveFileData=Kekule.HtmlNativeServiceImpl.doSaveFileDataIe:Kekule.BrowserFeature.downloadHref&&(r.doSaveFileData=Kekule.HtmlNativeServiceImpl.doSaveFileData)}(),Kekule.PredefinedResLoader=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PredefinedResLoader",initialize:function(e,t,r){this.tryApplySuper("initialize"),t?(this.setPropStoreFieldValue("resUri",t),this.setDoc(e),r&&this.setResType(r)):Kekule.Error(Kekule.$L("ErrorMsg.EMPTY_RESURI"))},initProperties:function(){this.defineProp("doc",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("resUri",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("resType",{dataType:DataType.STRING,serializable:!1})},getLinkedResUrl:function(e){var t=e.tagName.toLowerCase();return"link"===t?e.getAttribute("href"):"script"===t?e.getAttribute("src"):null},getElemResType:function(e){return e.getAttribute("type")},load:function(e){var t,r,i=this.getResUri(),n=Kekule.PredefinedResReferer.ID_MARK;if(i.startsWith(n)){var o=i.substr(n.length).trim();if(t=this.getDoc().getElementById(o)){r=this.getLinkedResUrl(t);var a=this.getElemResType(t);a&&this.setResType(a)}}else r=i;var s={resType:this.getResType(),resUri:i};if(r)Kekule.X.Ajax.sendRequest(r,function(t,i,n){if(n){if(!(s=Object.extend(s,{data:t,text:i.responseText,success:!0})).resType&&(s.resType=Kekule.X.Ajax.getResponseMimeType(i),s.resType===Kekule.IO.MimeType.OCTSTREAM)){var o=Kekule.UrlUtils.extractFileExt(r);if(o){var a=Kekule.IO.DataFormatsManager.findFormat(null,o);a&&(s.resType=a.mimeType)}}e(s,n)}else e(s,!1)},null,null,this.getResType()||null);else if(t){var l=t.innerHTML,u=2,d=l.indexOf("\r\n");d<0&&(d=l.indexOf("\n"),u=1),0===d&&(l=l.substring(u)),s=Object.extend(s,{data:l,text:l,resType:s.resType||"text/plain",success:!0}),e(s,!0)}else e(s,!1)}}),Kekule.PredefinedResReferer={REFER_PATTERN:/^\s*url\((\S+)\)\s*$/,ID_MARK:"#",isResValue:function(e){return Kekule.PredefinedResReferer.isResReferrer(e)},isResReferrer:function(e){return Kekule.PredefinedResReferer.REFER_PATTERN.test(e)},extractReferedValue:function(e){var t=Kekule.PredefinedResReferer.REFER_PATTERN.exec(e);if(t){var r=t[1];if(r)return r=Kekule.StrUtils.unquote(r)}return null},loadResource:function(e,t,r,i){i||(i=document);var n,o=Kekule.PredefinedResReferer.extractReferedValue(e);(n=new Kekule.PredefinedResLoader(i,o))&&(r&&n.setResType(r),n.load(t))}},Kekule._registerAfterLoadSysProc(function(){Kekule.IO&&(Kekule.IO.loadResourceData=function(e,t,r,i){Kekule.PredefinedResReferer.loadResource(e,function(e,r){var i;r&&(i=Kekule.IO.loadTypedData(e.data,e.resType,e.resUri)),t&&t(i,r)},r,i)})}),Kekule.StyleUtils={removeStyleProperty:function(e,t){e.removeProperty?e.removeProperty(t):e.removeAttribute?e.removeAttribute(t):e[t]=null},analysisUnitsValue:function(e){var t,r={};if(r.total=e,r.value=parseFloat(e),e&&e.length&&void 0!==r.value&&!isNaN(r.value)){t="";for(var i=e.length-1;i>=0;--i){var n=e.charAt(i);n>="0"&&n<="9"||"."===n||"-"===n||(t=n+t)}}return r.units=t||"",r},multiplyUnitsValue:function(e,t){var r=Kekule.StyleUtils.analysisUnitsValue(e);return r.value*=t,""+r.value+r.units},colorStrToValue:function(e){var t=Kekule.StyleUtils.analysisCssColor(e,!0);return(Math.round(t.r)<<16)+(Math.round(t.g)<<8)+Math.round(t.b)},analysisCssColor:function(e,t){var r=Kekule.StyleUtils,i=(e||"").toLowerCase();if(0===i.indexOf("#")){var n=i.substr(1);return r._analyisCssColorHex(n)}if(0===i.indexOf("rgb")){var o=i.indexOf("("),a=i.indexOf(")");return o<0||a<0?null:r._analysisCssColorRgbOrHsl(i.substring(o+1,a),!1)}if(0===i.indexOf("hsl")){if(o=i.indexOf("("),a=i.indexOf(")"),o<0||a<0)return null;var s=r._analysisCssColorRgbOrHsl(i.substring(o+1,a),!0);return t&&(s=Object.extend(s,r._convertHslToRgb(s))),s}return null},_analyisCssColorHex:function(e){for(var t=e.length,r=3===t,i=r?1:2,n=Math.min(4,Math.floor(t/i)),o=[],a=0;a<n;++a){var s=a*i,l=e.substr(s,i);r&&(l+=l),o.push(parseInt(l,16))}var u={r:o[0]||0,g:o[1]||0,b:o[2]||0};return Kekule.ObjUtils.notUnset(o[3])?u.a=o[3]/255:u.a=1,u},_analysisCssColorRgbOrHsl:function(e,t){var r,i=Kekule.StyleUtils._convertCssNumOrPercentageToNum,n=e.split(",");return r=t?{h:i(n[0],360),s:i(n[1]),l:i(n[2])}:{r:i(n[0],255),g:i(n[1],255),b:i(n[2],255)},Kekule.ObjUtils.notUnset(n[3])?r.a=i(n[3]):r.a=1,r},_convertHslToRgb:function(e,t){t||(t=255);var r,i,n,o=e.h,a=e.s,s=e.l;if(0===a)r=i=n=s;else{var l=s<.5?s*(1+a):s+a-s*a,u=2*s-l,d=o/360,c=[d+1/3,d,d-1/3],h=0;for(s=c.length;h<s;++h)c[h]<0?c[h]=c[h]+1:c[h]>1&&(c[h]=c[h]-1),6*c[h]<1?c[h]=u+6*(l-u)*c[h]:2*c[h]<1?c[h]=l:3*c[h]<2?c[h]=u+6*(l-u)*(2/3-c[h]):c[h]=u;r=c[0],i=c[1],n=c[2]}return{r:r*t,g:i*t,b:n*t}},_convertCssNumOrPercentageToNum:function(e,t){var r=parseFloat(e)||0;return e.endsWith("%")&&(r=r/100*(t||1)),r},getComputedStyle:function(e,t){var r,i=e.ownerDocument;if(!i)return null;var n=i.defaultView;return n&&n.getComputedStyle?r=n.getComputedStyle(e,null):e.currentStyle&&(r=e.currentStyle),r?t?t.indexOf("-")>=0&&r.getPropertyValue?r.getPropertyValue(t):r[t]:r:null},isShown:function(e){var t=Kekule.StyleUtils;return t.isDisplayed(e)&&t.isVisible(e)},isDisplayed:function(e){return"none"!==(Kekule.StyleUtils.getComputedStyle(e,"display")||"").toLowerCase()},getDisplayed:function(e){return Kekule.StyleUtils.getComputedStyle(e,"display")},setDisplay:function(e,t){e&&(e.style.display="string"==typeof t?t:t?"":"none")},isVisible:function(e){return"hidden"!==(Kekule.StyleUtils.getComputedStyle(e,"visibility")||"").toLowerCase()},getVisibility:function(e){return Kekule.StyleUtils.getComputedStyle(e,"visibility")},setVisibility:function(e,t){e&&(e.style.visibility="string"==typeof t?t:t?"":"hidden")},isBlockElem:function(e){var t=Kekule.StyleUtils.getComputedStyle(e,"display");return["block","list-item","table","flex","grid"].indexOf(t)>=0},isAbsOrFixPositioned:function(e){var t=Kekule.StyleUtils.getComputedStyle(e,"position")||"";return"absolute"===(t=t.toLowerCase())||"fixed"===t},_fillAbsOrFixedPositionStyleStack:function(e,t){if(Kekule.DomUtils.isElement(e)){var r=Kekule.StyleUtils.getComputedStyle(e,"position")||"";"absolute"!==(r=r.toLowerCase())&&"fixed"!==r||t.push(r.toLocaleLowerCase())}var i=e.parentNode;return i&&i.ownerDocument&&Kekule.StyleUtils._fillAbsOrFixedPositionStyleStack(i,t),t},isAncestorPositionFixed:function(e){return!!e.parentNode&&Kekule.StyleUtils.isSelfOrAncestorPositionFixed(e)},isSelfOrAncestorPositionFixed:function(e){var t=[];if(Kekule.StyleUtils._fillAbsOrFixedPositionStyleStack(e,t),!t.length)return null;for(var r=t.length-1;r>=0;--r)if("fixed"===t[r])return!0;return!1},setCursor:function(e,t){if(DataType.isArrayValue(t)){for(var r=0,i=t.length;r<i;++r){var n=t[r];if(e.style.cursor=n,e.style.cursor===n)return n}return e.style.cursor}return e.style.cursor=t,e.style.cursor},_cssTransformValuesToMatrix:function(e){var t=Kekule.MatrixUtils.create(3,3,0);return t[0][0]=e.a,t[1][0]=e.b,t[0][1]=e.c,t[1][1]=e.d,t[0][2]=e.tx,t[1][2]=e.ty,t},_matrixToCssTransformValues:function(e){return{a:e[0][0],b:e[1][0],c:e[0][1],d:e[1][1],tx:e[0][2],ty:e[1][2]}},hasTransform:function(e){var t=Kekule.StyleUtils.getComputedStyle(e,"transform");return t&&"none"!==t},getTransformMatrixValues:function(e){var t=(Kekule.StyleUtils.getComputedStyle(e,"transform")||"").match(/-?[\d\.]+/g);return t?{a:t[0],b:t[1],c:t[2],d:t[3],tx:t[4],ty:t[5]}:null},setTransformMatrixArrayValues:function(e,t){if(t){var r="matrix("+t.join(",")+")";e.style.transform=r}},getTransformMatrix:function(e){var t=Kekule.StyleUtils.getTransformMatrixValues(e);return t?Kekule.StyleUtils._cssTransformValuesToMatrix(t):null},getCascadeTranformMatrixes:function(e){for(var t=[],r=e;r;){if(1===r.nodeType){var i=Kekule.StyleUtils.getTransformMatrix(r);i&&t.unshift(i)}r=r.parentNode}return t},getTotalTransformMatrix:function(e){for(var t=Kekule.StyleUtils.getCascadeTranformMatrixes(e),r=null,i=t.length-1;i>=0;--i){var n=t[i];r=r?Kekule.MatrixUtils.multiply(r,n):n}return r},calcInvertTransformMatrix:function(e){var t=Kekule.StyleUtils._matrixToCssTransformValues(e),r=t.a*t.d-t.b*t.c;if(Math.abs(r)<1e-6)return!1;var i={a:t.d/r,b:-t.b/r,c:-t.c/r,d:t.a/r,tx:(t.c*t.ty-t.d*t.tx)/r,ty:(t.b*t.tx-t.a*t.ty)/r};return Kekule.StyleUtils._cssTransformValuesToMatrix(i)}},Kekule.HtmlElementUtils={getClassNames:function(e){return Kekule.StrUtils.splitTokens(e.getAttribute("class")||"")},hasClass:function(e,t){return Kekule.HtmlElementUtils.getClassNames(e).indexOf(t)>=0},addClass:function(e,t){for(var r=Kekule.HtmlElementUtils,i=Kekule.ArrayUtils.isArray(t)?t:Kekule.StrUtils.splitTokens(t),n=0,o=i.length;n<o;++n)r.hasClass(e,i[n])||(e.className+=" "+i[n]);return r},removeClass:function(e,t){for(var r=Kekule.HtmlElementUtils,i=Kekule.ArrayUtils.isArray(t)?t:Kekule.StrUtils.splitTokens(t),n=r.getClassNames(e),o=n.length;o>=0;--o)i.indexOf(n[o])>=0&&n.splice(o,1);return e.className=n.join(" "),r},toggleClass:function(e,t){for(var r=Kekule.HtmlElementUtils,i=Kekule.ArrayUtils.isArray(t)?t:Kekule.StrUtils.splitTokens(t),n=0,o=i.length;n<o;++n)r.hasClass(e,i[n])?r.removeClass(e,i[n]):r.addClass(e,i[n]);return r},getInnerText:function(e){return e.innerText||e.textContent},resizeElem:function(e,t,r,i){e.style.width=t+(i||"px"),e.style.height=r+(i||"px")},getElemClientDimension:function(e){return{width:e.clientWidth,height:e.clientHeight}},getElemScrollDimension:function(e){return{width:e.scrollWidth,height:e.scrollHeight}},getElemComputedDimension:function(e){var t=Kekule.StyleUtils,r={width:t.getComputedStyle(e,"width"),height:t.getComputedStyle(e,"height")},i=t.analysisUnitsValue(r.width),n=t.analysisUnitsValue(r.height),o={};return"px"===i.units&&(o.width=i.value),"px"===n.units&&(o.height=i.value),o},getElemOffsetDimension:function(e){return{width:e.offsetWidth,height:e.offsetHeight}},getViewportDimension:function(e){var t;if(e&&(t=e.ownerDocument?Kekule.DocumentUtils.getDefaultView(e.ownerDocument):e.defaultView?e.defaultView:e.parentWindow?e.parentWindow:e),null!=(t=t||window).innerWidth)return{width:t.innerWidth,height:t.innerHeight};var r=t.document;return"CSS1Compat"==r.compatMode?{width:r.documentElement.clientWidth,height:r.documentElement.clientHeight}:{width:r.body.clientWidth,height:r.body.clientHeight}},getViewportVisibleBox:function(e){var t;e&&(t=e.ownerDocument?Kekule.DocumentUtils.getDefaultView(e.ownerDocument):e.defaultView?e.defaultView:e.parentWindow?e.parentWindow:e);var r=(t=t||window).document,i=Kekule.HtmlElementUtils.getViewportDimension(t),n=Kekule.DocumentUtils.getScrollPosition(r),o={x1:n.left,y1:n.top,x2:i.width,y2:i.height};return o.left=o.x1,o.top=o.y1,o.right=o.x2,o.bottom=o.y2,o},getElemBoundingClientRect:function(e,t){var r=Object.extend({},e.getBoundingClientRect());if(Kekule.ObjUtils.isUnset(r.width)&&(r.width=r.right-r.left),Kekule.ObjUtils.isUnset(r.height)&&(r.height=r.bottom-r.top),t){var i=e.ownerDocument,n=i.documentElement.scrollTop||i.body.scrollTop||0,o=i.documentElement.scrollLeft||i.body.scrollLeft||0;r.left+=o,r.right+=o,r.top+=n,r.bottom+=n}var a=r;return a.x=a.left,a.y=a.top,a},getElemPagePos:function(e,t){for(var r=0,i=0,n=e;n;)r+=n.offsetLeft-n.scrollLeft+n.clientLeft,i+=n.offsetTop-n.scrollTop+n.clientTop,n=n.offsetParent;if(t){var o=e.ownerDocument,a=o.documentElement.scrollTop||o.body.scrollTop||0;r-=o.documentElement.scrollLeft||o.body.scrollLeft||0,i-=a}return{x:r,y:i}},getElemPageRect:function(e,t){var r=Kekule.HtmlElementUtils.getElemPagePos(e,t),i=Kekule.HtmlElementUtils.getElemClientDimension(e);return{x:r.x,y:r.y,left:r.x,top:r.y,right:r.x+i.width,bottom:r.y+i.height,width:i.width,height:i.height}},getElemViewportPos:function(e){var t=Kekule.HtmlElementUtils.getElemPagePos(e,!0);return{x:t.left,y:t.top}},makePositioned:function(e){var t=Kekule.StyleUtils.getComputedStyle(e,"position");t&&"static"!==t.toLowerCase()||(e.style.position="relative")},isFormCtrlElement:function(e){var t=e&&e.tagName.toLowerCase();return!!t&&["input","button","textarea","select"].indexOf(t)>=0},requestFullScreen:function(e){var t=e.requestFullScreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullScreen;return t?t.apply(e):null},exitFullScreen:function(e){var t=e.exitFullScreen||e.mozExitFullScreen||e.webkitExitFullScreen||e.msExitFullScreen;return t?t.apply(e):null}},Kekule.DocumentUtils={getDefaultView:function(e){return e.defaultView||e.parentWindow},getScrollPosition:function(e){var t=Kekule.DocumentUtils.getDefaultView(e),r={left:(void 0!==t.pageXOffset?t.pageXOffset:(e.documentElement||e.body.parentNode||e.body).scrollLeft)||0,top:(void 0!==t.pageYOffset?t.pageYOffset:(e.documentElement||e.body.parentNode||e.body).scrollTop)||0};return r.x=r.left,r.y=r.top,r},getClientDimension:function(e){return"BackCompat"==e.compatMode?{width:e.body.clientWidth,height:e.body.clientHeight}:{width:e.documentElement.clientWidth,height:e.documentElement.clientHeight}},getClientVisibleBox:function(e){var t=Kekule.DocumentUtils.getScrollPosition(e),r=Kekule.DocumentUtils.getInnerClientDimension(e),i={};return i.left=i.x1=t.left,i.top=i.y1=t.top,i.right=i.x2=r.width+t.left,i.bottom=i.y2=r.height+t.top,i.width=r.width,i.height=r.height,i},getWindowInnerDimension:function(e){var t=Kekule.DocumentUtils.getDefaultView(e);return{width:Math.min(t.innerWidth,t.outerWidth),height:Math.min(t.innerHeight,t.outerHeight)}},getInnerClientDimension:function(e){var t=Kekule.DocumentUtils.getClientDimension(e),r=Kekule.DocumentUtils.getWindowInnerDimension(e);return{width:r.width?Math.min(r.width,t.width):t.width,height:r.height?Math.min(r.height,t.height):t.height}},getClientScaleLevel:function(e){return"BackCompat"==e.compatMode?e.body.clientWidth/window.innerWidth:e.documentElement.clientWidth/window.innerWidth},getPixelZoomLevel:function(e){return Kekule.DocumentUtils.getClientScaleLevel(e)*(Kekule.DocumentUtils.getDefaultView(e).devicePixelRatio||1)},getDevicePPI:function(e){var t=Kekule.DocumentUtils.getDefaultView(e);if(t.matchMedia){for(var r=0,i=0,n=200;!i||i-r>1;)t.matchMedia("(min-resolution: "+n+"dpi)").matches?i?(r=n,n=Math.round((r+i)/2)):(r=n,n*=2):(i=n,n=Math.round((r+i)/2));return n}return 96}},Kekule.TextLinesBuffer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TextLinesBuffer",LINEBREAK:"\n",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("lines",[]),e&&("string"==typeof e?this.setText(e):this.setLines(e)),this.setCurrLineNo(0)},initProperties:function(){this.defineProp("lines",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getLines().join(this.LINEBREAK)},setter:function(e){this.setPropStoreFieldValue("lines",[]),this.reset(),this.appendText(e)}}),this.defineProp("currLineNo",{dataType:DataType.INT,serializable:!1})},getUnreadLines:function(){var e=[].concat(this.getLines());return e.splice(0,this.getCurrLineNo()),e},getUnreadText:function(){return this.getUnreadLines().join(this.LINEBREAK)},appendText:function(e){var t=e.split(this.LINEBREAK);this.appendLines(t)},appendLines:function(e){this.setPropStoreFieldValue("lines",this.getLines().concat(e)),this.notifyPropSet("lines",this.getPropStoreFieldValue("lines"))},clear:function(){this.setLines([]),this.setCurrLineNo(0)},incCurrLineNo:function(e){null==e&&(e=1);var t=this.getCurrLineNo();t+=e,this.setCurrLineNo(t)},getLineAt:function(e){var t=this.getLines()[e];return t&&t.length&&"\r"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t},getCurrLine:function(){return this.getLineAt(this.getCurrLineNo())},readLine:function(){var e=this.getLineAt(this.getCurrLineNo());return this.incCurrLineNo(),e},writeLine:function(e){this.getLines().splice(this.getCurrLineNo(),0,e),this.incCurrLineNo()},writeLines:function(e){for(var t=0,r=e.length;t<r;++t)this.writeLine(e[t])},writeText:function(e){var t=e.split(this.LINEBREAK);this.writeLines(t)},eof:function(){return this.getCurrLineNo()>=this.getLines().length},reset:function(){this.setCurrLineNo(0)}}),function(){Kekule.globalOptions.add("IO",{}),Kekule.IO={},Kekule.IO.ChemDataType={TEXT:"text",DOM:"dom",JSON:"json",BINARY:"bin",OTHER:"other",UNKNOWN:"unknown",isBinaryType:function(e){var t=Kekule.IO.ChemDataType;return!e||e===t.BINARY||e===t.OTHER||e===t.UNKNOWN}},Kekule.IO.DataFormat={},Kekule.IO.MimeType={TEXT:"text/plain",HTML:"text/html",XML:"text/xml",JSON:"application/json",JAVASCRIPT:"application/javascript",GIF:"image/gif",JPEG:"image/jpeg",PNG:"image/png",XPNG:"image/x-png",OCTSTREAM:"application/octet-stream"},Kekule.IO.DataFormatsManager={_formats:{},register:function(t,r,i,n,o,a,s){var l=null;l||(l=e._formats[t]),l||(l={id:t},e._formats[t]=l),l.mimeType=r;var u=DataType.isArrayValue(i)?i:[i];return u=u.map(function(e){return e?e.toLowerCase():e}),l.fileExts?Kekule.ArrayUtils.pushUnique(l.fileExts,u):l.fileExts=u,n&&n!==Kekule.IO.ChemDataType.UNKNOWN&&(l.dataType=n),l.title=o,l.description=a,s&&(l=Object.extend(l,s)),l},unregister:function(t){e._formats[t]&&delete e._formats[t]},getAllIds:function(){return Kekule.ObjUtils.getOwnedFieldNames(e._formats)},getFormatInfo:function(t){return e._formats[t]||null},getMimeType:function(t){var r=e.getFormatInfo(t);return r?r.mimeType:null},getFileExts:function(t){var r=e.getFormatInfo(t);return r?r.fileExts:null},findFormat:function(t,r){if(!t&&!r)return null;for(var i=e.getAllIds(),n=!1,o=0,a=i.length;o<a;++o){var s=e.getFormatInfo(i[o]);if((n=t&&t===s.mimeType)||(n=r&&s.fileExts.indexOf(r.toLowerCase())>=0),n)return s}return null},findFormatId:function(e,t){var r=Kekule.IO.DataFormatsManager.findFormat(e,t);return r?r.id:null}};var e=Kekule.IO.DataFormatsManager;Kekule.IO.dataFormatsManager=Kekule.IO.DataFormatsManager,Kekule.IO.ChemDataReader=Class.create(ObjectEx,{initialize:function(e){this.tryApplySuper("initialize")},CLASS_NAME:"Kekule.IO.ChemDataReader",readData:function(e,t,r,i){if(!t){var n=Kekule.IO.DataFormatsManager.getFormatInfo(r);(t=n?n.dataType:null)||(t="string"==typeof e?Kekule.IO.ChemDataType.TEXT:e.getElementsByTagName?Kekule.IO.ChemDataType.DOM:Kekule.IO.ChemDataType.BINARY)}var o=this.doReadData(e,t,r,i||{});if(o instanceof Kekule.ChemObject&&o.getSrcInfo){var a=o.getSrcInfo();a.data=e,a.dataType=t;var s=Kekule.IO.DataFormatsManager.getFormatInfo(r);s&&(a.format=r,a.mimeType=s.mimeType,a.possibleFileExts=s.fileExts)}return o},doReadData:function(e,t,r,i){}}),Kekule.IO.ChemDataWriter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.ChemDataWriter",initialize:function(e){this.tryApplySuper("initialize")},writeData:function(e,t,r,i){if(!t){var n=Kekule.IO.DataFormatsManager.getFormatInfo(r);t=n?n.dataType:null}return this.doWriteData(e,t,r,i||{})},doWriteData:function(e,t,r,i){}}),Kekule.IO.ChemDataReaderManager={_readers:[],register:function(e,t,r,i){if(e&&t&&r&&(!DataType.isArrayValue(r)||r.length)){if(Kekule.IO.ChemDataReaderManager.getReaderInfoById(e))return Kekule.raise(Kekule.$L("ErrorMsg.READER_ID_ALREADY_EXISTS")),null;var n={id:e,readerClass:t,formatId:DataType.isArrayValue(r)?r:[r]};return n=Object.extend(n,i),Kekule.IO.ChemDataReaderManager._readers.push(n),n}},unregister:function(e){for(var t=-1,r=Kekule.IO.ChemDataReaderManager._readers,i=0,n=r.length;i<n;++i){if(r[i].id===e){t=i;break}}if(t>=0){var o=r[t];return r.splice(t,1),o}return null},getAllReadableFormatIds:function(){for(var e=[],t=Kekule.IO.ChemDataReaderManager._readers,r=0,i=t.length;r<i;++r){var n=t[r].formatId;Kekule.ArrayUtils.pushUnique(e,n)}return e},getAllReadableFormats:function(){for(var t=[],r=Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds(),i=0,n=r.length;i<n;++i){var o=e.getFormatInfo(r[i]);o&&t.push(o)}return t},getAvailableReaderInfos:function(e){for(var t=[],r=Kekule.IO.ChemDataReaderManager._readers,i=r.length-1;i>=0;--i)Kekule.ObjUtils.match(r[i],e)&&t.push(r[i]);return t},getReaderInfo:function(e){for(var t=Kekule.IO.ChemDataReaderManager._readers,r=t.length-1;r>=0;--r)if(Kekule.ObjUtils.match(t[r],e))return t[r];return null},getReaderInfoById:function(e){return Kekule.IO.ChemDataReaderManager.getReaderInfo({id:e})},getReaderInfoByFormat:function(e,t){for(var r=Kekule.IO.ChemDataReaderManager._readers,i=r.length-1;i>=0;--i)if((!t||Kekule.ObjUtils.match(r[i],t))&&r[i].formatId.indexOf(e)>=0)return r[i];return null},getReaderInfoByFileExt:function(e,t){var r=Kekule.IO.DataFormatsManager.findFormatId(null,e);return r?Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(r,t):null},createReaderOfInfo:function(e){return new e.readerClass(e.createOptions)},getReaderOfInfo:function(e){return e.instance||(e.instance=Kekule.IO.ChemDataReaderManager.createReaderOfInfo(e)),e.instance},createReader:function(e){var t=Kekule.IO.ChemDataReaderManager.getReaderInfo(e);if(t)return Kekule.IO.ChemDataReaderManager.createReaderOfInfo(t)},getReader:function(e){var t=Kekule.IO.ChemDataReaderManager.getReaderInfo(e);if(t)return Kekule.IO.ChemDataReaderManager.getReaderOfInfo(t)},createReaderById:function(e){return Kekule.IO.ChemDataReaderManager.createReader({id:e})},getReaderById:function(e){return Kekule.IO.ChemDataReaderManager.getReader({id:e})},createReaderByFormat:function(e,t){var r=Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(e,t);return r?Kekule.IO.ChemDataReaderManager.createReaderOfInfo(r):null},getReaderByFormat:function(e,t){var r=Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(e,t);return r?Kekule.IO.ChemDataReaderManager.getReaderOfInfo(r):null},createReaderByFileExt:function(e,t){var r=Kekule.IO.ChemDataReaderManager.getReaderInfoByFileExt(e,t);return r?Kekule.IO.ChemDataReaderManager.createReaderOfInfo(r):null},getReaderByFileExt:function(e,t){var r=Kekule.IO.ChemDataReaderManager.getReaderInfoByFileExt(e,t);return r?Kekule.IO.ChemDataReaderManager.getReaderOfInfo(r):null},createReaderByMimeType:function(e){var t=Kekule.IO.DataFormatsManager.findFormatId(e,null);return t?Kekule.IO.ChemDataReaderManager.createReaderByFormat(t):null},getReaderByMimeType:function(e){var t=Kekule.IO.DataFormatsManager.findFormatId(e,null);return t?Kekule.IO.ChemDataReaderManager.getReaderByFormat(t):null}},Kekule.IO.ChemDataWriterManager={_writers:[],register:function(e,t,r,i,n){if(e&&t&&i&&(!DataType.isArrayValue(i)||i.length)){var o=Kekule.IO.ChemDataWriterManager.getWriterInfoById(e);if(o)return t===o.writerClass?(Kekule.ArrayUtils.pushUnique(o.srcClasses,r),Kekule.ArrayUtils.pushUnique(o.formatId,i),o):(Kekule.raise(Kekule.$L("ErrorMsg.WRITER_ID_ALREADY_EXISTS")),null);var a={id:e,writerClass:t,srcClasses:r,formatId:DataType.isArrayValue(i)?i:[i]};return a=Object.extend(a,n),Kekule.IO.ChemDataWriterManager._writers.push(a),a}},unregister:function(e){for(var t=-1,r=Kekule.IO.ChemDataWriterManager._writers,i=0,n=r.length;i<n;++i){if(r[i].id===e){t=i;break}}if(t>=0){var o=r[t];return r.splice(t,1),o}return null},getAllWritableFormatIds:function(){for(var e=[],t=Kekule.IO.ChemDataWriterManager._writers,r=0,i=t.length;r<i;++r){var n=t[r].formatId;Kekule.ArrayUtils.pushUnique(e,n)}return e},getAllWritableFormats:function(){for(var t=[],r=Kekule.IO.ChemDataWriterManager.getAllWritableFormatIds(),i=0,n=r.length;i<n;++i){var o=e.getFormatInfo(r[i]);o&&t.push(o)}return t},getAvailableWriterInfos:function(e,t){for(var r=[],i=ClassEx.isClass(t)?t:t.getClass?t.getClass():t?null:void 0,n=Kekule.IO.ChemDataWriterManager._writers,o=n.length-1;o>=0;--o)if(Kekule.ObjUtils.match(n[o],e))if(void 0!==i){if(i)for(var a=0,s=n[o].srcClasses.length;a<s;++a)ClassEx.isOrIsDescendantOf(i,n[o].srcClasses[a])&&r.push(n[o])}else r.push(n[o]);return r},getWriterInfo:function(e,t){for(var r=Kekule.IO.ChemDataWriterManager._writers,i=r.length-1;i>=0;--i)if(Kekule.ObjUtils.match(r[i],e)){if(t){for(var n=0,o=r[i].srcClasses.length;n<o;++n)if(t instanceof r[i].srcClasses[n])return r[i];return null}return r[i]}return null},getWriterInfoById:function(e,t){return Kekule.IO.ChemDataWriterManager.getWriterInfo({id:e},t)},getWriterInfoByFormat:function(e,t,r){for(var i=Kekule.IO.ChemDataWriterManager._writers,n=i.length-1;n>=0;--n)if((!t||Kekule.ObjUtils.match(i[n],t))&&i[n].formatId.indexOf(e)>=0){if(r){for(var o=0,a=i[n].srcClasses.length;o<a;++o)if(r instanceof i[n].srcClasses[o])return i[n];return null}return i[n]}return null},getWriterInfoByFileExt:function(e,t,r){var i=Kekule.IO.DataFormatsManager.findFormatId(null,e);return i?Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(i,t,r):null},createWriterOfInfo:function(e){return new e.writerClass(e.createOptions)},getWriterOfInfo:function(e){return e.instance||(e.instance=Kekule.IO.ChemDataWriterManager.createWriterOfInfo(e)),e.instance},createWriter:function(e,t){var r=Kekule.IO.ChemDataWriterManager.getWriterInfo(e,t);return r?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(r):null},getWriter:function(e,t){var r=Kekule.IO.ChemDataWriterManager.getWriterInfo(e,t);return r?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(r):null},createWriterById:function(e,t){return Kekule.IO.ChemDataWriterManager.createWriter({id:e},t)},getWriterById:function(e,t){return Kekule.IO.ChemDataWriterManager.getWriter({id:e},t)},createWriterByFormat:function(e,t,r){var i=Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,t,r);return i?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(i):null},getWriterByFormat:function(e,t,r){var i=Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,t,r);return i?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(i):null},createWriterByFileExt:function(e,t,r){var i=Kekule.IO.ChemDataWriterManager.getWriterInfoByFileExt(e,t,r);return i?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(i):null},getWriterByFileExt:function(e,t,r){var i=Kekule.IO.ChemDataWriterManager.getWriterInfoByFileExt(e,t,r);return i?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(i):null},createWriterByMimeType:function(e,t){var r=Kekule.IO.DataFormatsManager.findFormatId(e,null);return r?Kekule.IO.ChemDataWriterManager.createWriterByFormat(r,null,t):null},getWriterByMimeType:function(e){var t=Kekule.IO.DataFormatsManager.findFormatId(e,null);return t?Kekule.IO.ChemDataWriterManager.getWriterByFormat(t,null):null}},Kekule.IO.loadFormatData=function(e,t,r){var i=Kekule.IO.ChemDataReaderManager.getReaderByFormat(t);if(i){var n=i.readData(e,null,t,r);if(!1===n){var o=Kekule.$L("ErrorMsg.FAIL_TO_READ_FORMAT")+t;Kekule.raise(o)}return n}o=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FORMAT")+t;return Kekule.raise(o),null},Kekule.IO.loadMimeData=function(e,t,r){return Kekule.IO.loadTypedData(e,t,null,r)},Kekule.IO.loadTypedData=function(e,t,r,i){var n;r&&(n=Kekule.UrlUtils.extractFileExt(r));var o,a=Kekule.IO.DataFormatsManager.findFormatId(t||null,n);if(a&&(o=Kekule.IO.loadFormatData(e,a,i)),!1!==o){if(o instanceof Kekule.ChemObject&&o.getSrcInfo){var s=o.getSrcInfo();t&&(s.mimeType=t),n&&(s.fileExt=n),r&&(s.url=r,s.fileName=r)}return o}var l=t?Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_MIMETYPE")+t:Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+n;return Kekule.raise(l),null},Kekule.IO.loadFileData=function(e,t,r,i){if(Kekule.BrowserFeature.fileapi){var n,o=e.name,a=Kekule.UrlUtils.extractFileExt(o);if(!(n=r?Kekule.IO.DataFormatsManager.getFormatInfo(r):Kekule.IO.DataFormatsManager.findFormat(null,a))){var s=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+a;return void Kekule.raise(s)}var l=Kekule.IO.ChemDataType.isBinaryType(n.dataType),u=new FileReader;u.onload=function(e){var r=u.result,a=Kekule.IO.loadFormatData(r,n.id,i);a&&a.getSrcInfo&&(a.getSrcInfo().fileName=o);t(a,!1!==a,r)},l?u.readAsArrayBuffer(e):u.readAsText(e)}else Kekule.error(Kekule.$L("ErrorMsg.FILE_API_NOT_SUPPORTED"))},Kekule.IO.loadUrlData=function(e,t,r,i){if(!Kekule.Ajax)return Kekule.raise(Kekule.$L("ErrorMsg.AJAX_FILELOADER_NOT_FOUND")),null;Kekule.Ajax.sendRequest(e,function(n,o,a){if(n&&a){var s;if(r&&(s=Kekule.IO.DataFormatsManager.getFormatInfo(r)),!r){var l=Kekule.Ajax.getResponseMimeType(o);s=Kekule.IO.DataFormatsManager.findFormat(l)}if(!r){var u=Kekule.UrlUtils.extractFileExt(e);s=Kekule.IO.DataFormatsManager.findFormat(null,u)}if(!s){var d=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+u;return void Kekule.raise(d)}var c=Kekule.IO.loadFormatData(n,s.id,i);c.getSrcInfo().fileName=e,t(c,a=!1!==c,n)}else Kekule.raise(Kekule.$L("ErrorMsg.FAIL_TO_LOAD_FILE_URL")+e)})},Kekule.IO.saveFormatData=function(e,t,r){var i=Kekule.IO.ChemDataWriterManager.getWriterByFormat(t,null,e);if(i)return i.writeData(e,null,t,r);var n=Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")+t;return Kekule.raise(n),null},Kekule.IO.saveMimeData=function(e,t,r){return Kekule.IO.saveTypedData(e,t,null,r)},Kekule.IO.saveTypedData=function(e,t,r,i){var n;r&&((n=Kekule.UrlUtils.extractFileExt(r))||(n=r));var o,a=Kekule.IO.DataFormatsManager.findFormatId(t||null,n);if(a&&(o=Kekule.IO.saveFormatData(e,a,i)),Kekule.ObjUtils.isUnset(o)){var s=t?Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_MIMETYPE")+t:Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FILEEXT")+n;return Kekule.raise(s),null}return o}}(),function(){"use strict";Kekule.globalOptions.add("IO.cml",{prettyPrint:!0,enableReadRootObjList:!0,defaultRootObjListHolder:Kekule.ChemSpace}),Kekule.IO.CML={CML2CORE_NAMESPACE_URI:"http://www.xml-cml.org/schema/cml2/core",CML3_SCHEMA_NAMESPACE_URI:"http://www.xml-cml.org/schema",ARRAY_VALUE_DELIMITER:" ",TYPED_ELEM_NAMES:["string","integer","float"],TYPED_ARRAY_ELEM_NAMES:["stringArray","integerArray","floatArray"],ATOMS_REF_ATTRIBS:["atomRef","atomRefs2","atomRefs3","atomRefs4","atomRefs","atomRefArray"],BONDS_REF_ATTRIBS:["bondRef","bondRefs","bondRefArray"],MOL_REF_ATTRIBS:["moleculeRef","moleculeRefs"],DEFAULT_VALUE_DELIMITER_PATTERN:/\s+/gm},Kekule.IO.CML.LEGAL_CORE_NAMESPACE_URIS=[Kekule.IO.CML.CML2CORE_NAMESPACE_URI,Kekule.IO.CML.CML3_SCHEMA_NAMESPACE_URI],Kekule.IO.CmlUtils={_cmlUnitConvMap:[["m","m","m",!0],["second","s","sec",!0],["hour","h","hr",!1],["kg","kg","kg",!0],["k","K","K",!0],["mol","mol","mol",!0],["candela","cd","cd",!0],["radian","rad","rad",!0],["steradian","sr","sr",!0],["hertz","Hz","Hz",!0],["newton","N","N",!0],["joule","J","J",!0],["watt","W","W",!0],["pascal","Pa","Pa",!0],["coulomb","C","C",!0],["volt","V","V",!0],["ampere","A","A",!0],["ohm","[Omega]","Ω",!0],["farad","F","F",!0],["siemens","S","S",!0],["weber","Wb","Wb",!0],["tesla","T","T",!0],["henry","H","H",!0],["becquerel","Bq","Bq",!0],["gray","Gy","Gy",!0],["sievert","Sv","Sv",!0],["katal","kat","kat",!0],["molarity","_i_M__i_","mol/L",!0],["molality","_i_m__i_","mol/kg",!0],["m2","m2","m2",!0],["m3","m3","m3",!0],["m.s-1","m.s-1","m/s",!0],["m.s-2","m.s-2","m·s-2",!0],["rad.s-1","rad.s-1","rad/s",!0],["n.s","N.s","N·s",!0],["n.m.s","N.m.s","N·m·s",!0],["n.m","N.m","N·m",!0],["m-1","m-1","m-1",!0],["kg.m-3","kg.m-3","kg·m-3",!0],["kg-1.m3","kg-1.m3","kg-1·m3",!0],["m-3.mol","m-3.mol","m-3·mol",!0],["m3.mol-1","m3.mol-1","m3/mol",!0],["j.k-1","J.K-1","J/K",!0],["j.k-1.mol-1","J.K-1.mol-1","J·K-1·mol-1",!0],["j.k-1.kg-1","J.K-1.kg-1","J·K-1·kg-1",!0],["j.mol-1","J.mol-1","J/mol",!0],["j.kg-1","J.kg-1","J/kg",!0],["j.m-3","J.m-3","J·m-3",!0],["n.m-1","N.m-1 = J.m-2","N/m",!0],["w.m-2","W.m-2","W·m-2",!0],["w.m-1.k-1","W.m-1.K-1","W·m-1·K-1",!0],["m2.s-1","m2.s-1","m2/s",!0],["pa.s","Pa.s","Pa·s",!0],["pa.s","N.s.m-2","Pa·s",!0],["c.m-3","C.m-3","C·m-3",!0],["a.m-2","A.m-2","A·m-2",!0],["s.m-1","S.m-1","S/m",!0],["s.m2.mol-1","S.m2.mol-1","S·m2/mol",!0],["f.m-1","F.m-1","F/m",!0],["h.m-1","H.m-1","H/m",!0],["v.m-1","V.m-1","V/m",!0],["a.m-1","A.m-1","A/m",!0],["cd.m-2","cd.m-2","cd·m-2",!0],["c.kg-1","C.kg-1","C/kg",!0],["gy.s-1","Gy.s-1","Gy/s",!0],["j.m-1","J.m-1","J/m",!0],["ang","[Aring]","Å",!1],["deg","[deg]","deg",!1],["ang3","A3","Å3",!1],["celsius","[deg]C","℃",!1],["debye","D","D",!1],["electron","e","e",!1],["hartree","hart","hart",!1],["gpa","GPa","GPa",!1],["gpa-1","GPa-1","GPa-1",!1],["atmosphere","atm","atm",!1],["kcal.mol-1.ang-1","kcal mol-1 ang-1","kcal·mol-1·ang-1",!1],["kj.mol-1","kj mol-1","kj/mol",!1],["l","L","L",!1],["ml","mL","mL",!1],["kcal.ang-1","kcal.ang-1","kcal/Å",!1],["kcal.rad-1","kcal.rad-1","kcal/rad",!1],["ph","pH","pH",!1],["centipoise","cp","cp",!1],["km.s-1","km/s","km/s",!1],["arbitrary","arb","arb",!1]],tryParseFloat:function(e){var t=parseFloat(e);return Kekule.NumUtils.isNormalNumber(t)?t:e},convertSimpleValueByDataType:function(e,t,r){var i;switch(t){case"xsd:boolean":i=Kekule.StrUtils.strToBool(e);break;case"xsd:float":case"xsd:double":case"xsd:duration":case"xsd:decimal":i=parseFloat(e);break;case"xsd:integer":case"xsd:nonPositiveInteger":case"xsd:negativeInteger":case"xsd:long":case"xsd:int":case"xsd:short":case"xsd:byte":case"xsd:nonNegativeInteger":case"xsd:unsignedLong":case"xsd:unsignedInt":case"xsd:unsignedShort":case"xsd:unsignedByte":case"xsd:positiveInteger":i=parseInt(e);break;default:i=e}return i},getCmlTypeForDataType:function(e){return e==DataType.INT?"xsd:integer":e==DataType.FLOAT?"xsd:float":e==DataType.BOOL?"xsd:boolean":null},cmlNsTokenToKekule:function(e){return e.replace(/\:/g,".")},kekuleNsTokenToCml:function(e){return e.replace(/\./g,":")},getCmlNsValueDetails:function(e){var t=e.indexOf(":");return{namespace:t>=0?e.substring(0,t):"",localName:t>=0?e.substr(t+1):e}},getCmlNsValueLocalPart:function(e){var t=e.indexOf(":");return t>=0?e.substr(t+1):e},cmlUnitStrToMetricsUnitSymbol:function(e){for(var t,r,i=Kekule.IO.CmlUtils.getCmlNsValueLocalPart(e),n=i.toLowerCase(),o=n.length>3&&n.endsWith("s")?n.substr(0,n.length-1):null,a=(Kekule.Unit,Kekule.IO.CmlUtils._cmlUnitConvMap),s=0,l=a.length;s<l;++s)if(i===a[s][0]||i===a[s][1]){t=a[s][2];break}if(!t)for(s=0,l=a.length;s<l;++s)if(n===a[s][0].toLowerCase()||n===a[s][1].toLowerCase()){t=a[s][2];break}if(!t&&o)for(s=0,l=a.length;s<l;++s)if(o===a[s][0].toLowerCase()||o===a[s][1].toLowerCase()){t=a[s][2];break}t||(t=(r=Kekule.Unit.getUnit(i,!0))&&r.symbol);t||(t=(r=Kekule.Unit.getUnitByName(i,!0))&&r.symbol);!t&&o&&(t=(r=Kekule.Unit.getUnitByName(o,!0))&&r.symbol);return t||i},metricsUnitSymbolToCmlUnitStr:function(e){for(var t,r=Kekule.IO.CmlUtils._cmlUnitConvMap,i=0,n=r.length;i<n;++i){var o=r[i];if(e===o[2]){t=(o[3]?"siUnits:":"units:")+o[0];break}}return t||(t="units:"+e),t},cmlBondOrderToKekule:function(e){var t=parseInt(e);if(t!=t)switch(e.toUpperCase()){case"A":t=Kekule.BondOrder.EXPLICIT_AROMATIC;break;case"D":t=Kekule.BondOrder.DOUBLE;break;case"T":t=Kekule.BondOrder.TRIPLE;break;case"S":default:t=Kekule.BondOrder.SINGLE}return t},kekuleBondOrderToCml:function(e){switch(e){case Kekule.BondOrder.EXPLICIT_AROMATIC:return"A";case Kekule.BondOrder.QUAD:return"4";case Kekule.BondOrder.DOUBLE:return"D";case Kekule.BondOrder.TRIPLE:return"T";default:return"S"}},cmlBondStereoToKekule:function(e){var t;switch(e.toUpperCase()){case"E":t=Kekule.BondStereo.E;break;case"Z":t=Kekule.BondStereo.Z;break;case"C":t=Kekule.BondStereo.CIS;break;case"T":t=Kekule.BondStereo.TRANS;break;case"W":t=Kekule.BondStereo.UP;break;case"H":t=Kekule.BondStereo.DOWN;break;default:t=Kekule.BondStereo.NONE}return t},kekuleBondStereoToCml:function(e){switch(e){case Kekule.BondStereo.UP:return{value:"W"};case Kekule.BondStereo.UP_INVERTED:return{value:"W",invert:!0};case Kekule.BondStereo.DOWN:return{value:"H"};case Kekule.BondStereo.DOWN_INVERTED:return{value:"H",invert:!0};case Kekule.BondStereo.E:return{value:"E"};case Kekule.BondStereo.Z:return{value:"Z"};case Kekule.BondStereo.CIS:return{value:"C"};case Kekule.BondStereo.TRANS:return{value:"T"};default:return{value:null}}},reagentRoleToKekule:function(e){var t=Kekule.ReactionRole;switch(e){case"reagent":return t.REAGENT;case"catalyst":case"solvent":return t.CATALYST;default:return e}},kekuleReagentRoleToCml:function(e){var t=Kekule.ReactionRole;switch(e){case t.REAGENT:return"reagent";case t.CATALYST:return"catalyst";case t.SOLVENT:return"solvent";default:return e}},isDummyElementType:function(e){return"Du"==e||"Dummy"==e},isRGroupElementType:function(e){return"R"==e},isAtomListElementType:function(e){return"L"==e},getNodeElementType:function(e){if(e instanceof Kekule.Atom)return e.getSymbol();if(!(e instanceof Kekule.Pseudoatom))return e instanceof Kekule.VariableAtom?"R":e instanceof Kekule.StructureFragment?"R":e.getSymbol?e.getSymbol():"*";switch(e.getAtomType()){case Kekule.PseudoatomType.DUMMY:return"Du";case Kekule.PseudoatomType.ANY:return"A";case Kekule.PseudoatomType.HETERO:return"Q";case Kekule.PseudoatomType.CUSTOM:default:return e.getSymbol()}},createNodeByCmdElementType:function(e,t,r){return Kekule.IO.CmlUtils.isDummyElementType(t)?new Kekule.Pseudoatom(e,Kekule.PseudoatomType.DUMMY):Kekule.IO.CmlUtils.isRGroupElementType(t)?new Kekule.RGroup(e):Kekule.IO.CmlUtils.isAtomListElementType(t)?new Kekule.VariableAtom(e):Kekule.Element.isElementSymbolAvailable(t)||t==Kekule.Element.UNSET_ELEMENT?new Kekule.Atom(e,t,Math.round(r)):new Kekule.Pseudoatom(e,Kekule.PseudoatomType.CUSTOM,t)}};var e=Kekule.IO.CmlUtils;Kekule.IO.CmlDomUtils={splitCmlArrayValue:function(e){return"object"==typeof e&&e.length?e:Kekule.StrUtils.normalizeSpace(Kekule.StrUtils.trim(e)).split(Kekule.IO.CML.ARRAY_VALUE_DELIMITER)},mergeToCmlArrayValue:function(e){return e.join(" ")},analysisCmlFormulaConciseValue:function(e){for(var t,r=Kekule.IO.CmlDomUtils.splitCmlArrayValue(e),i=0,n=r.length,o=[],a=null;i<n;){var s=r[i],l=parseFloat(s);l!=l?(a&&o.push(a),a={elementType:s}):a?(a.count=l,o.push(a),a=null):i==n-1&&(t=l),++i}return{isotopes:o,formalCharge:t}},getCmlBuiltinElemInfo:function(e,t,r){var i=e.getAttribute("builtin");return!i&&t&&(e.getAttributeNS?i=e.getAttributeNS(t,"builtin"):r&&(i=r.getAttributeNS(t,"builtin",e))),i?{name:i,value:Kekule.DomUtils.getElementText(e)}:null},readCmlTypedPropertyElem:function(e,t,r){var i;if(!(i=e.getAttribute("builtin"))&&t&&(e.getAttributeNS?i=e.getAttributeNS(t,"builtin"):r&&(i=r.getAttributeNS(t,"builtin",e))),i){var n=Kekule.DomUtils.getElementText(e);switch(Kekule.DomUtils.getLocalName(e)){case"float":n=parseFloat(n);break;case"integer":n=parseInt(n)}return{name:i,value:n}}return null},readCmlTypedPropertyArrayElem:function(e,t,r){var i;if(!(i=e.getAttribute("builtin"))&&t&&(e.getAttributeNS?i=e.getAttributeNS(t,"builtin"):r&&(i=r.getAttributeNS(t,"builtin",e))),i){var n=Kekule.DomUtils.getElementText(e),o=Kekule.IO.CmlDomUtils.splitCmlArrayValue(n);switch(Kekule.DomUtils.getLocalName(e)){case"float":for(var a=0,s=o.length;a<s;++a)o[a]=parseFloat(o[a]);break;case"integer":for(a=0,s=o.length;a<s;++a)o[a]=parseInt(o[a])}return{name:i,values:o}}return null},hasDirectCmlTypedElemChildren:function(e,t){for(var r=0,i=Kekule.IO.CML.TYPED_ELEM_NAMES.length;r<i;++r){var n=Kekule.IO.CML.TYPED_ELEM_NAMES[r];if(Kekule.DomUtils.getDirectChildElems(e,null,n,t).length>0)return!0}return!1},hasDirectCmlTypedArrayElemChildren:function(e,t){for(var r=0,i=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES.length;r<i;++r){var n=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES[r];if(Kekule.DomUtils.getDirectChildElems(e,null,n,t).length>0)return!0}return!1},isCmlTypedElem:function(e,t){var r=Kekule.IO.CML.TYPED_ELEM_NAMES.indexOf(Kekule.DomUtils.getLocalName(e))>=0;return t&&(r=r&&e.namespaceURI==t),r},isCmlTypedArrayElem:function(e,t){var r=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES.indexOf(Kekule.DomUtils.getLocalName(e))>=0;return t&&(r=r&&e.namespaceURI==t),r},isCmlBuiltInMarkedElem:function(e,t){var r=Kekule.DomUtils.hasAttribute(e,"builtin");return t&&r&&(r=e.namespaceURI===t),r},FILTER_TYPED_ELEM:1,FILTER_TYPEDARRAY_ELEM:2,FILTER_ALL:3,getCmlTypedElem:function(e,t,r){var i=e.namespaceURI,n=Kekule.DomUtils.getDirectChildElemsOfAttribValues(e,[{builtin:t}],null,null,i);if(n&&n.length>0)for(var o=n.length-1;o>=0;--o){if(r&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedElem(n[o],i))return n[o];if(r&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(n[o],i))return n[o]}return null},getCmlTypedElems:function(e,t,r){var i=[],n=e.namespaceURI,o=Kekule.DomUtils.getDirectChildElemsOfAttribValues(e,[{builtin:t}],null,null,n);if(o&&o.length>0)for(var a=o.length-1;a>=0;--a)r&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedElem(o[a],n)?i.push(o[a]):r&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(o[a],n)&&i.push(o[a]);return i.length?i:null},getCmlTypedElemValue:function(e,t,r,i){r||(r=Kekule.IO.CmlDomUtils.FILTER_ALL);var n=Kekule.IO.CmlDomUtils.getCmlTypedElem(e,t,r);if(n)return Kekule.DomUtils.getElementText(n)},getMultipleCmlTypedElemValues:function(e,t,r,i){r||(r=Kekule.IO.CmlDomUtils.FILTER_ALL);var n=Kekule.IO.CmlDomUtils.getCmlTypedElems(e,t,r);if(n){for(var o=[],a=0,s=n.length;a<s;++a)o.push(Kekule.DomUtils.getElementText(n[a]));return o}return null},getCmlElemAttribute:function(e,t,r,i){r||(r=Kekule.IO.CmlDomUtils.FILTER_ALL);var n=Kekule.DomUtils.getSameNSAttributeValue(e,t,i);return n||(n=Kekule.IO.CmlDomUtils.getCmlTypedElemValue(e,t,r,i)),n},getMultipleCmlElemAttribute:function(e,t,r,i){r||(r=Kekule.IO.CmlDomUtils.FILTER_ALL);var n=Kekule.DomUtils.getSameNSAttributeValue(e,t,i);return n||(n=Kekule.IO.CmlDomUtils.getMultipleCmlTypedElemValues(e,t,r,i)),n},setCmlElemAttribute:function(e,t,r,i){return Kekule.DomUtils.setSameNSAttributeValue(e,t,r,i)},fetchCmlElemAttributeValuesToJson:function(e,t,r,i){t||(t=Kekule.IO.CmlDomUtils.FILTER_ALL);for(var n=e.namespaceURI,o=Kekule.DomUtils.fetchAttributeValuesToJson(e,n,!0),a=Kekule.DomUtils.getDirectChildElems(e,null,null,n),s=0,l=a.length;s<l;++s){var u=a[s];if(t&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM&&(Kekule.IO.CmlDomUtils.isCmlTypedElem(u,n)||Kekule.IO.CmlDomUtils.isCmlBuiltInMarkedElem(u,n)))(d=Kekule.IO.CmlDomUtils.readCmlTypedPropertyElem(u,n,i))&&(o[d.name]&&r?o[d.name]+=Kekule.IO.CML.ARRAY_VALUE_DELIMITER+d.value:o[d.name]=d.value);else if(t&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(u,n)){var d;(d=Kekule.IO.CmlDomUtils.getCmlBuiltinElemInfo(u,n,i))&&(o[d.name]&&r?o[d.name]+=Kekule.IO.CML.ARRAY_VALUE_DELIMITER+d.value:o[d.name]=d.value)}}return o},isScalarElem:function(e,t){var r="scalar"==Kekule.DomUtils.getLocalName(e);return t&&(r=r&&e.namespaceURI==t),r},getCmlId:function(e,t){return Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"id",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,t)},setCmlId:function(e,t,r){return Kekule.IO.CmlDomUtils.setCmlElemAttribute(e,"id",t,r)},getCmlTitle:function(e,t){return Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"title",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,t)},setCmlTitle:function(e,t,r){return Kekule.IO.CmlDomUtils.setCmlElemAttribute(e,"title",t,r)}};var t=Kekule.IO.CmlDomUtils;Kekule.IO.CmlElementReaderFactory={_readers:{},register:function(e,t){if(Kekule.ArrayUtils.isArray(e))for(var r=0,i=e.length;r<i;++r)Kekule.IO.CmlElementReaderFactory.register(e[r],t);else Kekule.IO.CmlElementReaderFactory._readers[e.toLowerCase()]=t},getReader:function(e){var t;t="string"!=typeof e?Kekule.DomUtils.getLocalName(e):e;var r=Kekule.IO.CmlElementReaderFactory._readers[t.toLowerCase()];return r?new r:null}},Kekule.IO.CmlElementWriterFactory={_writers:{},register:function(e,t){if(Kekule.ArrayUtils.isArray(e))for(var r=0,i=e.length;r<i;++r)Kekule.IO.CmlElementWriterFactory.register(e[r],t);else Kekule.IO.CmlElementWriterFactory._writers[e]=t},getWriter:function(e){var t;t="string"!=typeof e?DataType.getType(e):e;var r=Kekule.IO.CmlElementWriterFactory._writers[t];if(!r&&e.getClassName)for(var i=e,n=Kekule.ObjUtils.getOwnedFieldNames(Kekule.IO.CmlElementWriterFactory._writers),o=n.length-1;o>=0;--o){var a=ClassEx.findClass(n[o]);if(a&&i instanceof a){r=Kekule.IO.CmlElementWriterFactory._writers[n[o]];break}}return r?new r:null}},Kekule.IO.CmlElementHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.CmlElementHandler",initialize:function(){this.tryApplySuper("initialize"),this._childHandlers=[]},doFinalize:function(){for(var e=this._childHandlers.length-1;e>=0;--e){var t=this._childHandlers[e];t&&t.finalize&&t.finalize()}this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("domHelper",{dataType:"Kekule.DomHelper",serializable:!1,getter:function(){return this.getPropStoreFieldValue("domHelper")||this.setPropStoreFieldValue("domHelper",new Kekule.DomHelper),this.getPropStoreFieldValue("domHelper")}}),this.defineProp("coreNamespaceURI",{dataType:DataType.STRING,serializable:!1}),this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("rootEvoker",{dataType:DataType.Object,serializable:!1})},getPrefixForNamespaceUri:function(e){var t=this.getNamespaces();if(t)for(var r=0,i=t.length;r<i;++r)if(t[r].namespaceURI===e)return t[r].prefix},matchCoreNamespace:function(e){var t;return t=e?"string"!=typeof e?e.namespaceURI:e:"",!this.getCoreNamespaceURI()&&!t||this.getCoreNamespaceURI()&&this.getCoreNamespaceURI()==t},copySettingsToChildHandler:function(e){e.setDomHelper(this.getDomHelper()),e.setCoreNamespaceURI(this.getCoreNamespaceURI()),e.setNamespaces(this.getNamespaces()),e.setRootEvoker(this.getRootEvoker())},_appendChildHandler:function(e){Kekule.ArrayUtils.pushUnique(this._childHandlers,e)},_iterateChildHandlers:function(e,t,r){if(e)for(var i=0,n=this._childHandlers.length;i<n;++i){var o=this._childHandlers[i];o&&(e.apply(t,[o]),r&&o._iterateChildHandlers&&o._iterateChildHandlers(e,t,r))}}}),Kekule.IO.CmlElementReader=Class.create(Kekule.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementReader",readElement:function(e,t,r,i){var n=this.doReadElement(e,t,r,i);if(n&&n.getId&&!n.getId()&&n.setId){var o=Kekule.IO.CmlDomUtils.getCmlId(e,this.getDomHelper);o&&this.setObjId(n,o)}return n},doReadElement:function(e,t,r,i){},readChildElement:function(e,t,r){return this.doReadChildElement(e,t,r)},doReadChildElement:function(e,t,r){return this.doReadChildElementDef(e,t,r)},readChildElementDef:function(e,t,r){return this.doReadChildElementDef(e,t,r)},doReadChildElementDef:function(e,t,r){var i=this.doGetChildElementReader(e,t,r);if(!i)return null;try{return i.readElement(e,t,r)}finally{}},doGetChildElementReader:function(e,t,r){var i=Kekule.IO.CmlElementReaderFactory.getReader(e);return i&&(this.copySettingsToChildHandler(i),this._appendChildHandler(i)),i},iterateChildElements:function(e,t,r,i){for(var n=[],o=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),a=0,s=o.length;a<s;++a){var l=this.readChildElement(o[a],t,r);l&&(n.push({element:o[a],result:l}),i&&i(o[a],l,t,r))}return n},doneReadingDocument:function(e){this.doDoneReadingDocument(),e&&this._iterateChildHandlers(function(t){t&&t.doneReadingDocument&&t.doneReadingDocument(e)})},doDoneReadingDocument:function(){},getLoadedObjById:function(e){var t=this.getRootEvoker();return t&&t.getLoadedObjById&&t.getLoadedObjById(e)},setObjIdMapValue:function(e,t){var r=this.getRootEvoker();r.setObjIdMapValue&&r.setObjIdMapValue(e,t)},setObjId:function(e,t){e.setId&&e.setId(t);var r=e.getId&&e.getId();r&&this.setObjIdMapValue(r,e)},_createChildObjsHolder:function(e,t){for(var r=new t,i=0,n=e.length;i<n;++i)r.appendChild(e[i]);return r}}),Kekule.IO.CmlElementWriter=Class.create(Kekule.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementWriter",writeObject:function(e,t,r){if(!t&&!i)return Kekule.error(Kekule.$L("ErrorMsg.CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT")),null;var i=t.ownerDocument;this.getDomHelper().getDocument!=i&&this.getDomHelper().setDocument(i);var n=this.doCreateElem(e,t,i);n?t.appendChild(n):n=t;var o=this.doWriteObject(e,n,r)||n;return o&&e&&(this.writeObjId(e,o),this.writeObjAdditionalInfo(e,o,r)),o},writeObjId:function(e,t){if(e.getId){var r=e.getId();!r&&e.setId&&(r=this.autoIdentifyForObj(e)),Kekule.IO.CmlDomUtils.setCmlId(t,r,this.getDomHelper())}},autoIdentifyForObj:function(e){return e.getId&&!e.getId()&&e.setId&&(e.getOwner&&e.getOwner()&&e.getOwner().getAutoId?e.setId(e.getOwner().getAutoId(e)):e.setId(this.getAutoIdForObj(e))),e.getId&&e.getId()},getAutoIdForObj:function(e){var t=e.getAutoIdPrefix?e.getAutoIdPrefix():"obj";return Kekule.IO.CmlElementWriter._UID_SEED||(Kekule.IO.CmlElementWriter._UID_SEED=(new Date).getTime()),++Kekule.IO.CmlElementWriter._UID_SEED,""+t+Kekule.IO.CmlElementWriter._UID_SEED.toString()},writeScalarAttribs:function(e,t,r){if(e.getScalarAttribs){var i=this.doGetChildObjectWriter("Kekule.Scalar");if(i)for(var n=0,o=e.getScalarAttribCount();n<o;++n)i.writeObject(e.getScalarAttribAt(n),t,r)}},writeObjInfoValues:function(e,t,r){if(e.getInfo){var i,n=this.getObjInfoKeysNeedToSaveToMetaList(e);if(!n||!n.length)return;for(var o=0,a=n.length;o<a;++o){var s=n[o],l=e.getInfoValue(n[o]);s&&l&&!Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,s,this.getDomHelper())&&(i||(i=this.getOrCreateChildElem("metaDataList",t)),this.doWriteObjInfoValueItem(s,l,e,i,r))}}},doWriteObjInfoValueItem:function(e,t,r,i,n){return this.writeObjMetaValueToListElem(r,e,null,t,i)},writeObjMetaValueToListElem:function(e,t,r,i,n,o,a){o||(o="metaData");var s=this.createChildElem(o,n);return Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"name",t,this.getDomHelper()),Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"content",DataType.StringUtils.serializeValue(r),this.getDomHelper()),i&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"metadataType",i,this.getDomHelper()),s},getObjInfoKeysNeedToSaveToMetaList:function(e){return e.getInfoKeys?e.getInfoKeys():null},writeObjAdditionalInfo:function(e,t,r){this.writeScalarAttribs(e,t,r),this.writeObjInfoValues(e,t,r)},doCreateElem:function(e,t){},createChildElem:function(e,t,r){var i=r||this.getCoreNamespaceURI(),n=this.getDomHelper().createElementNS(i,e);return t&&t.appendChild(n),n},getOrCreateChildElem:function(e,t,r){var i=this.getDomHelper().getElementsByTagNameNS(r,e,t)[0];return i||(i=this.createChildElem(e,t,r)),i},doWriteObject:function(e,t,r){},doGetChildObjectWriter:function(e,t,r){var i=Kekule.IO.CmlElementWriterFactory.getWriter(e);return i&&(this.copySettingsToChildHandler(i),this._appendChildHandler(i)),i},reportTypeMismatchError:function(e){Kekule.error(Kekule.$L("ErrorMsg.CML_ELEM_WRITER_TYPE_INPROPER").format(this.getClassName(),DataType.getType(e)))},addNamespace:function(e,t,r,i){this.getDomHelper().addNamespace(e,t,r,i)},addNamespaces:function(e,t,r){for(var i=0,n=t.length;i<n;++i)this.addNamespace(e,t[i].prefix,t[i].namespaceURI,r)},doneWritingDocument:function(e){this.doDoneWritingDocument(),e&&this._iterateChildHandlers(function(t){t&&t.doneWritingDocument&&t.doneWritingDocument(e)})},doDoneWritingDocument:function(){}}),Kekule.IO.CmlBaseListReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlBaseListReader",doReadElement:function(e,t,r,i){var n=this.doCreateList(e);return n=this.doReadList(n,e,t,r,this.getDomHelper())},doCreateList:function(e){return[]},doAppendObjToList:function(e,t){return t&&t.push&&t.push(e),t},doReadChildElem:function(e,t,r,i,n){return t.readElement(e,n,this)},doReadList:function(e,t,r,i,n){var o=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI());if(o)for(var a=0,s=o.length;a<s;++a){var l=o[a],u=this.doGetChildElementReader(l,r,this);if(u){var d=this.doReadChildElem(l,u,r,i,e);d&&this.doAppendObjToList(d,e)}}return e}}),Kekule.IO.CmlBaseListWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlBaseListWriter",doCreateElem:function(e,t){var r=this.doGetListElemTagName(e,t);return r?this.createChildElem(r,t):null},doGetListElemTagName:function(e,t){return"list"},doWriteObject:function(e,t,r){var i=Kekule.ChemStructureUtils.getChildStructureObjs(e,!1);return this.writeList(i,t,r)},writeList:function(e,t,r){for(var i=0,n=e.length;i<n;++i){var o=e[i];if(o){var a=this.doGetChildObjectWriter(o);a&&a.writeObject(o,t,r)}}return t}}),Kekule.IO.CmlNameReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlNameReader",initialize:function(){this.tryApplySuper("initialize")},doReadElement:function(e,t,r,i){var n=Kekule.DomUtils.getElementText(e),o=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"convention");if(n){var a={};return a.name=n,o?a.convention=o:t&&t.setName&&t.setName(n),a}return null}}),Kekule.IO.CmlScalarReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlScalarReader",doReadElement:function(e,t,r,i){var n=this.readScalar(e);return t&&t.appendScalarAttrib&&t.appendScalarAttrib(n),n},readScalar:function(e){var t,r=Kekule.DomUtils.fetchAttributeValuesToJson(e,this.getCoreNamespaceURI(),!0);if((s=Kekule.DomUtils.getElementText(e))&&(r.value=s),r.value&&(r.dataType?(r.value=Kekule.IO.CmlUtils.convertSimpleValueByDataType(r.value,r.dataType),r.errorValue&&(r.errorValue=Kekule.IO.CmlUtils.convertSimpleValueByDataType(r.errorValue,r.dataType,!0))):r.value=Kekule.IO.CmlUtils.tryParseFloat(r.value)),r){t=new Kekule.Scalar;for(var i=Kekule.ObjUtils.getOwnedFieldNames(r),n=0,o=i.length;n<o;++n){var a=i[n],s=r[a];switch(a){case"value":t.setValue(s);break;case"errorValue":t.setErrorValue(s);break;case"units":t.setUnit(Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(s));break;case"title":t.setTitle(s);break;case"dictRef":t.setName(Kekule.IO.CmlUtils.cmlNsTokenToKekule(s)),t.setInfoValue("dictRef",s);break;default:t.setInfoValue(a,s)}}}return t}}),Kekule.IO.CmlScalarWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlScalarWriter",doCreateElem:function(e,t){return this.createChildElem("scalar",t)},doWriteObject:function(t,r,i){if(!(t instanceof Kekule.Scalar))return this.reportTypeMismatchError(t),null;var n;if(Kekule.ObjUtils.isUnset(t.getValue())||(Kekule.DomUtils.setElementText(r,t.getValue()),n=DataType.getType(t.getValue())),t.getName()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"dictRef",Kekule.IO.CmlUtils.kekuleNsTokenToCml(t.getName()),this.getDomHelper()),t.getErrorValue()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"errorValue",t.getErrorValue(),this.getDomHelper()),t.getUnit()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"units",Kekule.IO.CmlUtils.metricsUnitSymbolToCmlUnitStr(t.getUnit()),this.getDomHelper()),t.getTitle()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"title",t.getTitle(),this.getDomHelper()),n){var o=e.getCmlTypeForDataType(n);o&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"datatype",o,this.getDomHelper())}}}),Kekule.IO.CmlArrayReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlArrayReader",initProperties:function(){this.defineProp("expandSteppedArray",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("defaultItemDataType",{dataType:DataType.STRING,serializable:!1})},doReadElement:function(e,t,r,i){return this.readArray(e)},readArray:function(e){var t=Kekule.DomUtils.fetchAttributeValuesToJson(e,this.getCoreNamespaceURI(),!0);if(t.size&&(t.size=parseInt(t.size)),Kekule.ObjUtils.notUnset(t.start)&&Kekule.ObjUtils.notUnset(t.end))t.start=parseFloat(t.start),t.end=parseFloat(t.end),t.stepSize&&(t.stepSize=parseFloat(t.stepSize)),!t.size&&t.stepSize?t.size=Math.round(Math.abs((arrayJson.end-arrayJson.start)/t.stepSize)):t.size&&!t.stepSize&&(t.stepSize=(t.end-t.start)/t.size);else{var r=Kekule.DomUtils.getElementText(e);t.values=this._generateExplicitArray(t,r)}return t},_generateSteppedArray:function(e){var t=null;if(this.getExpandSteppedArray()){var r=e.size,i=e.stepSize,n=e.start;t=[n];for(var o=0;o<r;++o){if((n+=i)>e.end){t.push(e.end);break}t.push(n)}}return t},_generateExplicitArray:function(e,t){var r=!!e.delimiter,i=r?e.delimiter:Kekule.IO.CML.DEFAULT_VALUE_DELIMITER_PATTERN,n=t.split(i);r&&(n.shift(),n.pop());for(var o=e.dataType||this.getDefaultItemDataType(),a=[],s=0,l=n.length;s<l;++s){var u=n[s].trim();!r&&u&&(o?a.push(Kekule.IO.CmlUtils.convertSimpleValueByDataType(u,o)):a.push(u))}return a}}),Kekule.IO.CmlArrayWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlArrayWriter",DEF_TAGNAME:"array",DEF_DELIMITER:" ",initProperties:function(){this.defineProp("defaultItemDataType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("defaultItemDataUnit",{dataType:DataType.STRING,serializable:!1})},getArrayTagName:function(){return this.DEF_TAGNAME},getDefaultArrayValueDelimiter:function(){return this.DEF_DELIMITER},doCreateElem:function(e,t){return this.createChildElem(this.getArrayTagName(),t)},doWriteObject:function(e,t,r){var i;if(DataType.isObjectValue(e))i=Object.extend({},e);else{if(!DataType.isArrayValue(e))return this.reportTypeMismatchError(e),null;i={values:e}}return i=Object.extend(i,{unit:i.unit||r.unit||this.getDefaultItemDataUnit(),dataType:i.dataType||r.dataType||this.getDefaultItemDataType(),delimiter:i.delimiter||r.delimiter||this.getDefaultArrayValueDelimiter()}),this.writeArrayObj(i,t,r)},writeArrayObj:function(r,i,n){for(var o=this.getDomHelper(),a=["id","title","dictRef"],s=0,l=a.length;s<l;++s){var u=r[a[s]];Kekule.ObjUtils.notUnset(u)&&t.setCmlElemAttribute(i,a[s],u,o)}r.unit&&t.setCmlElemAttribute(i,"units",e.metricsUnitSymbolToCmlUnitStr(r.unit),o),r.dataType&&t.setCmlElemAttribute(i,"dataType",e.getCmlTypeForDataType(r.dataType),o);var d=r.values,c=d?d.length:r.size;if(c&&t.setCmlElemAttribute(i,"size",c,o),d){var h=r.delimiter||this.getDefaultArrayValueDelimiter();Kekule.DomUtils.setElementText(i,d.join(h)),h!==this.getDefaultArrayValueDelimiter()&&t.setCmlElemAttribute(i,"delimiter",h,o)}else Kekule.ObjUtils.notUnset(r.start)&&t.setCmlElemAttribute(i,"start",r.start,o),Kekule.ObjUtils.notUnset(r.end)&&t.setCmlElemAttribute(i,"end",r.end,o)}}),Kekule.IO.CmlMetaDataReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlMetaReader",doReadElement:function(e,t,r,i){var n=this.readMeta(e);return t&&t.setInfoValue&&n.key&&n.value&&t.setInfoValue(n.key,n.value),n},readMeta:function(e){var t=Kekule.DomUtils.fetchAttributeValuesToJson(e,this.getCoreNamespaceURI(),!0);return{key:t.name,value:DataType.StringUtils.deserializeValue(t.content),metadataType:t.metadataType}}}),Kekule.IO.CmlMetaDataListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlMetaListReader",doReadChildElem:function(e,t,r,i,n){return t.readElement(e,r,this)}}),Kekule.IO.CmlConditionListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlConditionListReader"}),Kekule.IO.CmlParameterReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlParameterReader",doReadElement:function(e,t,r,i){return this.readParameter(e,t,r)},readParameter:function(e,t,r){var i=Kekule.DomUtils.fetchAttributeValuesToJson(e,this.getCoreNamespaceURI(),!0),n={key:i.name||i.dictRef,value:DataType.StringUtils.deserializeValue(i.value),title:i.title};this.iterateChildElements(e,t,r,function(e,t){"scalar"===Kekule.DomUtils.getLocalName(e).toLowerCase()&&(n.value=t)});return n}}),Kekule.IO.CmlParameterListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlParameterListReader"}),Kekule.IO.CmlChemStructureReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlChemStructureReader",initialize:function(){this.tryApplySuper("initialize")},hasAtomChildren:function(e,t){return t.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",e).length},getAtomChildren:function(e,t){return t.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",e)},atomInfoToJSON:function(e,t){return Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(e,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,!0,t)},arrayedAtomInfosToJSON:function(e,t){for(var r=["id","atomID","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"],i=["id","id","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"],n=[],o=0,a=r.length;o<a;++o){var s,l=[];(s=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,r[o],Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,t))&&(l=Kekule.IO.CmlDomUtils.splitCmlArrayValue(s));for(var u=0,d=l.length;u<d;++u)n[u]||(n[u]={}),l[u]&&(n[u][i[o]]=l[u])}return n}}),Kekule.IO.CmlFormulaReader=Class.create(Kekule.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlFormulaReader",doReadElement:function(e,t,r,i){return this.readFormula(e,this.getDomHelper())},readFormula:function(e,t){var r=new Kekule.MolecularFormula,i=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"formalCharge",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,t);i&&r.setCharge(parseFloat(i));var n=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"concise",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,t),o=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"inline",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,t);if(n)this.setConcise(r,n);else if(o)this.setInlineFormula(r,o);else for(var a=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),s=0,l=a.length;s<l;++s)switch(Kekule.DomUtils.getLocalName(a[s])){case"formula":this.readSubFormula(r,a[s],t);break;case"atomArray":this.readAtomArray(r,a[s],t);break;default:Kekule.IO.CmlDomUtils.isCmlTypedElem(e)||Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(e)||this.readChildElementDef(e,r)}return r},readConsice:function(e){var t=null;return e&&(t=new Kekule.MolecularFormula,this.setConcise(t,e)),t},setConcise:function(e,t){var r=Kekule.IO.CmlDomUtils.analysisCmlFormulaConciseValue(t);return r.isotopes&&r.isotopes.length&&this.createSectionsFromAtomAttribs(e,r.isotopes),r.formalCharge&&e.setCharge(r.formalCharge),e},setInlineFormula:function(e,t){return Kekule.FormulaUtils.textToFormula(t,null,e),e},readAtomArray:function(e,t,r){var i=[],n=this.getAtomChildren(t,r);if(n.length>0)for(var o=0,a=n.length;o<a;++o){var s=n[o],l=this.atomInfoToJSON(s,r);i.push(l)}else i=this.arrayedAtomInfosToJSON(t,r);return this.createSectionsFromAtomAttribs(e,i),e},createSectionsFromAtomAttribs:function(e,t){for(var r=0,i=t.length;r<i;++r){var n=t[r].elementType;if(n){var o=Kekule.IO.CmlUtils.createNodeByCmdElementType(null,n),a=t[r].formalCharge||0,s=t[r].count;e.appendSection(o,s,a)}}},readSubFormula:function(e,t,r){var i=this.readElement(t,r),n=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"count",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,r);e.appendSection(i,parseFloat(n)||1,i.getCharge()||0)}}),Kekule.IO.CmlFormulaWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlFormulaWriter",doCreateElem:function(e,t){return this.createChildElem("formula",t)},doWriteObject:function(e,t,r){if(!(e instanceof Kekule.MolecularFormula))return this.reportTypeMismatchError(e),null;for(var i=[],n=[],o=[],a=0,s=e.getSectionCount();a<s;++a){var l=e.getSectionAt(a);if(l.obj instanceof Kekule.MolecularFormula){this.createAtomArrayElem(i,n,o,t),i=[],n=[],o=[];this.writeSubFormula(l.obj,l.count||1,t,r)}else i.push(Kekule.IO.CmlUtils.getNodeElementType(l.obj)),n.push(l.count||1),o.push(e.getSectionCharge(l)||0),a==s-1&&this.createAtomArrayElem(i,n,o,t)}e.getCharge()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"formalCharge",e.getCharge(),this.getDomHelper())},writeSubFormula:function(e,t,r,i){var n=this.createChildElem("formula",r);return this.doWriteObject(e,n,i),t>1&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"count",t,this.getDomHelper()),n},createAtomArrayElem:function(e,t,r,i){if(!(e.length<=0)){var n=this.createChildElem("atomArray",i),o=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(e),a=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(t);Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"elementType",o,this.getDomHelper()),Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"count",a,this.getDomHelper());for(var s=!1,l=0,u=r.length;l<u;++l)if(r[l]){s=!0;break}if(s){var d=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(t);Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"formalCharge",d,this.getDomHelper())}return n}}}),Kekule.IO.CmlMoleculeReader=Class.create(Kekule.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlMoleculeReader",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("structureBuilder",{dataType:"Kekule.ChemStructureBuilder",serializable:!1,getter:function(){return this.getPropStoreFieldValue("structureBuilder")||this.setPropStoreFieldValue("structureBuilder",new Kekule.ChemStructureBuilder),this.getPropStoreFieldValue("structureBuilder")},setter:null})},doReadElement:function(e,t,r,i){return this.readMolecule(e,r,this.getDomHelper())},doReadChildElement:function(e,t,r){if("molecule"==Kekule.DomUtils.getLocalName(e)&&this.matchCoreNamespace(e)){if(t&&t.getSubMolecules){var i=this.readElement(e,t,r);if(i){var n=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"amount",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM)||Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"count",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM),o=n?{amount:parseFloat(n)}:null;t.getSubMolecules().appendObj(i,o)}return i}return null}return this.tryApplySuper("doReadChildElement",[e,t,r])},hasSubMolecule:function(e){return Kekule.DomUtils.getDirectChildElems(e,null,"molecule",this.getCoreNamespaceURI()).length>0},readMolecule:function(e,t,r){var i;return this.hasSubMolecule(e)?(i=new Kekule.CompositeMolecule,this.iterateChildElements(e,i,t)):i=this.readMoleculeCore(e,r),this.readMoleculeAttribs(i,e,r),i},readMoleculeAttribs:function(e,t,r){for(var i=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,null,!0,r),n=Kekule.ObjUtils.getOwnedFieldNames(i),o=0,a=n.length;o<a;++o){var s=n[o],l=i[s];switch(s){case"id":this.setObjId(e,l);break;case"title":e.setInfoValue("title",l);break;case"formalCharge":l&&e.setCharge(parseFloat(l));break;case"formula":this.readFormulaAttrib(e,l);break;case"amount":case"count":break;default:e.setInfoValue(s,l)}}},readMoleculeCore:function(e,t){var r=new Kekule.Molecule;this.getStructureBuilder().setTarget(r);for(var i=e.firstChild;i;){if(i.nodeType!=Node.ELEMENT_NODE);else if(this.matchCoreNamespace(i))switch(Kekule.DomUtils.getLocalName(i)){case"atomArray":this.readMoleculeAtomArray(r,i,this.getStructureBuilder(),t);break;case"bondArray":this.readMoleculeBondArray(r,i,this.getStructureBuilder(),t);break;case"formula":this.readFormula(r,i,t);break;case"atom":this.getStructureBuilder().setTarget(r);var n=this.readAtom(i,t);this.getStructureBuilder().appendNode(n);break;case"bond":this.getStructureBuilder().setTarget(r);var o=this.readBond(r,i,t);this.getStructureBuilder().appendConnector(o);break;case"molecule":break;default:Kekule.IO.CmlDomUtils.isCmlTypedElem(i)||Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(i)||this.readChildElementDef(i,r)}else;i=i.nextSibling}return r.hasCtab()&&this.connectUpBondAndAtom(r),r},connectUpBondAndAtom:function(e){for(var t=e.getConnectors(),r=0,i=t.length;r<i;++r){var n=t[r],o=n[this._BOND_ATOM_REF_TEMP_FIELD];if(o&&o.length)for(var a=0,s=o.length;a<s;++a){var l=e.getNodeById(o[a]);l?n.appendConnectedObj(l):Kekule.raise((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.ATOMID_NOT_EXISTS"):"Atom id not exists: ")+o[a])}delete n[this._BOND_ATOM_REF_TEMP_FIELD];var u=n[this._BOND_BOND_REF_TEMP_FIELD];if(u&&u.length)for(a=0,s=u.length;a<s;++a){var d=e.getConnectorById(u[a]);d?n.appendConnectedObj(d):Kekule.raise((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.BONDID_NOT_EXISTS"):"Bond id not exists: ")+u[a])}delete n[this._BOND_BOND_REF_TEMP_FIELD]}},readMoleculeAtomArray:function(e,t,r,i){r.setTarget(e);var n=this.getAtomChildren(t,i);if(n.length>0)for(var o=0,a=n.length;o<a;++o){var s=n[o],l=this.readAtom(s,i);r.appendNode(l)}else{var u=this.readArrayedAtoms(t,i);for(o=0,a=u.length;o<a;++o)r.appendNode(u[o])}},readAtom:function(e,t){var r,i=!Kekule.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(e,this.getCoreNamespaceURI()),n=this.atomInfoToJSON(e,t);if(r=this.createStructureNodeOfAttribs(n),i)for(var o=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),a=0,s=o.length;a<s;++a){e=o[a];this.readChildElementDef(e,r)}return r},readArrayedAtoms:function(e,t){for(var r=this.arrayedAtomInfosToJSON(e,t),i=[],n=0,o=r.length;n<o;++n){var a=this.createStructureNodeOfAttribs(r[n]);a&&i.push(a)}return i},createStructureNodeOfAttribs:function(e){var t;e.elementType||(e.elementType=Kekule.Element.UNSET_ELEMENT);var r=null;void 0!==e.id&&(r=e.id),delete e.id;var i,n,o=e.isotope?Math.round(e.isotope):null;if(t=Kekule.IO.CmlUtils.createNodeByCmdElementType(r,e.elementType,o),delete e.elementType,void 0!==e.hydrogenCount&&t.setExplicitHydrogenCount&&t.setExplicitHydrogenCount(parseInt(e.hydrogenCount,10)),delete e.hydrogenCount,e.formalCharge&&t.setCharge(parseInt(e.formalCharge)),delete e.formalCharge,e.title&&t.setInfoValue("title",e.title),delete e.title,e.role&&t.setInfoValue("role",e.role),delete e.role,void 0!==e.x2&&void 0!==e.y2)i={x:parseFloat(e.x2),y:parseFloat(e.y2)};else if(e.xy2){var a=Kekule.IO.CmlDomUtils.splitCmlArrayValue(e.xy2);2==a.length&&(i={x:parseFloat(a[0]),y:parseFloat(a[1])})}if(delete e.x2,delete e.y2,delete e.xy2,void 0!==e.x3&&void 0!==e.y3&&void 0!==e.z3)n={x:parseFloat(e.x3),y:parseFloat(e.y3),z:parseFloat(e.z3)};else if(e.xyz3){var s=Kekule.IO.CmlDomUtils.splitCmlArrayValue(e.xyz3);3==s.length&&(i={x:parseFloat(s[0]),y:parseFloat(s[1]),z:parseFloat(s[2])})}for(var l in delete e.x3,delete e.y3,delete e.z3,delete e.xyz3,i&&t.setCoord2D(i),n&&t.setCoord3D(n),e)e.hasOwnProperty(l)&&"string"==typeof e[l]&&t.setInfoValue(l,e[l]);return t},_BOND_ATOM_REF_TEMP_FIELD:"__cml_atomRefs",_BOND_BOND_REF_TEMP_FIELD:"__cml_bondRefs",readMoleculeBondArray:function(e,t,r,i){r.setTarget(e);var n=i.getElementsByTagNameNS(this.getCoreNamespaceURI(),"bond",t);if(n.length>0)for(var o=0,a=n.length;o<a;++o){var s=n[o],l=this.readBond(e,s,i);r.appendConnector(l)}else{var u=this.readArrayedBonds(e,t,i);for(o=0,a=u.length;o<a;++o)r.appendConnector(u[o])}},readBond:function(e,t,r){var i,n,o;if(o=!Kekule.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(t,this.getCoreNamespaceURI()),n=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,Kekule.IO.CmlUtils.FILTER_TYPED_ELEM,!0,r),i=this.createStructureConnectorOfAttribs(e,n),o)for(var a=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI()),s=0,l=a.length;s<l;++s){t=a[s];if("bondStereo"==Kekule.DomUtils.getLocalName(t)){var u=Kekule.DomUtils.getElementText(t);u||(u=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"conversionValue",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,r)),u||(u=Kekule.IO.CmlUtils.getCmlNsValueLocalPart(Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"dictRef",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,r)));var d=Kekule.IO.CmlUtils.cmlBondStereoToKekule(u);d!=Kekule.BondStereo.NONE&&i.setStereo&&i.setStereo(d)}else this.readChildElementDef(t,i)}return i},readArrayedBonds:function(e,t,r){var i=["id","bondID","atomRef1","atomRef2","order","bondStereo"],n=["id","id","atomRefs2","atomRefs2","order","bondStereo"],o=[],a=Kekule.IO.CmlDomUtils.getMultipleCmlElemAttribute(t,"atomRefs",Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,r);if(a&&a.length)for(var s=0,l=a.length;s<l;++s)for(var u=a[s],d=0,c=(h=Kekule.IO.CmlDomUtils.splitCmlArrayValue(u)).length;d<c;++d)o[d]||(o[d]={}),null==o[d].atomRefs&&(o[d].atomRefs=[]),o[d].atomRefs.push(h[d]);for(s=0,l=i.length;s<l;++s){var h=[];(u=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,i[s],Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,r))&&(h=Kekule.IO.CmlDomUtils.splitCmlArrayValue(u));for(d=0,c=h.length;d<c;++d)o[d]||(o[d]={}),h[d]&&("atomRef1"==i[s]||"atomRef2"==i[s]?(null==o[d].atomRefs2&&(o[d].atomRefs2=[]),"atomRef1"==i[s]?o[d].atomRefs2[0]=h[d]:o[d].atomRefs2[1]=h[d]):o[d][n[s]]=h[d])}var p=[];for(s=0,l=o.length;s<l;++s){var g=this.createStructureConnectorOfAttribs(e,o[s]);g&&p.push(g)}return p},createStructureConnectorOfAttribs:function(e,t){var r,i,n;if(t.id&&(i=t.id),delete t.id,void 0!==t.order&&(n=Kekule.IO.CmlUtils.cmlBondOrderToKekule(t.order)),delete t.order,r=new Kekule.Bond(i,null,n),t.bondStereo){var o=Kekule.IO.CmlUtils.cmlBondStereoToKekule(t.bondStereo);o!=Kekule.BondStereo.NONE&&r.setStereo&&r.setStereo(o)}delete t.bondStereo;for(var a=0,s=Kekule.IO.CML.ATOMS_REF_ATTRIBS.length;a<s;++a){if(null!=t[u=Kekule.IO.CML.ATOMS_REF_ATTRIBS[a]]){var l=Kekule.IO.CmlDomUtils.splitCmlArrayValue(t[u]);l.length>0&&(r[this._BOND_ATOM_REF_TEMP_FIELD]=l),delete t[u];break}}for(a=0,s=Kekule.IO.CML.BONDS_REF_ATTRIBS.length;a<s;++a){var u;if(null!=t[u=Kekule.IO.CML.BONDS_REF_ATTRIBS[a]]){var d=Kekule.IO.CmlDomUtils.splitCmlArrayValue(t[u]);d.length>0&&(r[this._BOND_BOND_REF_TEMP_FIELD]=d),delete t[u];break}}for(var c in t)t.hasOwnProperty(c)&&"string"==typeof t[c]&&r.setInfoValue(c,t[c]);return r},readFormula:function(e,t,r){var i=this.doGetChildElementReader(t);if(i){this.copySettingsToChildHandler(i);var n=i.readElement(t,e,this);n&&e.setFormula(n)}},readFormulaAttrib:function(e,t){var r=this.doGetChildElementReader("formula");if(r){var i=r.readConsice?r.readConsice(t):null;i&&e.setFormula(i)}}}),Kekule.IO.CmlMoleculeWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlMoleculeWriter",initProperties:function(){this.defineProp("allowCascadeGroup",{dataType:DataType.BOOL})},doCreateElem:function(e,t){return this.createChildElem("molecule",t)},doWriteObject:function(e,t,r){return this.writeMolecule(e,t,r)},writeMolecule:function(e,t,r){return this.writeMoleculeAttribs(e,t),e instanceof Kekule.CompositeMolecule?this.writeCompositeMolecule(e,t,r):this.writeMoleculeCore(e,t,r)},writeMoleculeAttribs:function(e,t){var r=[];e.getCharge()&&r.push({key:"formalCharge",value:e.getCharge()});for(var i=["title","dictRef","chirality","ref","spinMultiplicity","symmetryOriented","role"],n=0,o=i.length;n<o;++n){var a=i[n],s=e.getInfoValue(a);Kekule.ObjUtils.isUnset(s)||r.push({key:a,value:e.getInfoValue(a)})}for(n=0,o=r.length;n<o;++n)Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,r[n].key,r[n].value,this.getDomHelper())},writeCompositeMolecule:function(e,t,r){for(var i=e.getSubMolecules(),n=0,o=i.getItemCount();n<o;++n){var a=i.getItemAt(n),s=a.obj,l=this.writeObject(s,t,r);a.amount&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(l,"amount",a.amount,this.getDomHelper())}return t},writeMoleculeCore:function(e,t,r){if(e.hasFormula()){var i=e.getFormula();this.doGetChildObjectWriter(i).writeObject(i,t,r)}e.hasCtab()&&this.writeCtab(e.getCtab(),e,t,r)},writeCtab:function(e,t,r,i){this.identifyObjsInCtab(e,t);var n=this.getAllowCascadeGroup()?e.getNodes():e.getLeafNodes();if(n.length>0)for(var o=this.createChildElem("atomArray",r),a=0,s=n.length;a<s;++a)this.writeCtabNode(n[a],o,i);var l=this.getAllowCascadeGroup()?e.getConnectors():e.getAllChildConnectors();if(l.length>0){var u=this.createChildElem("bondArray",r);for(a=0,s=l.length;a<s;++a)this.writeCtabConnector(l[a],u,i)}},writeCtabNode:function(e,t,r){var i=this.createChildElem("atom",t);this.writeObjId(e,i);var n=Kekule.IO.CmlUtils.getNodeElementType(e);Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"elementType",n,this.getDomHelper());var o=e.getMassNumber?e.getMassNumber():null;o&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"isotope",o,this.getDomHelper());var a=e.getExplicitHydrogenCount?e.getExplicitHydrogenCount():null;Kekule.ObjUtils.isUnset(a)||Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"hydrogenCount",a,this.getDomHelper());var s=e.getCharge?e.getCharge():null;s&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"formalCharge",s,this.getDomHelper());e.getParity&&e.getParity();var l=e.getInfoValue?e.getInfoValue("title"):null;l&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"title",l,this.getDomHelper());var u=e.getInfoValue?e.getInfoValue("role"):null;if(u&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"role",u,this.getDomHelper()),e.hasCoord2D&&e.hasCoord2D()){var d=e.getAbsCoord2D();!Kekule.ObjUtils.isUnset(d.x)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"x2",d.x,this.getDomHelper()),!Kekule.ObjUtils.isUnset(d.y)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"y2",d.y,this.getDomHelper())}if(e.hasCoord3D&&e.hasCoord3D()){var c=e.getAbsCoord3D();!Kekule.ObjUtils.isUnset(c.x)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"x3",c.x,this.getDomHelper()),!Kekule.ObjUtils.isUnset(c.y)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"y3",c.y,this.getDomHelper()),!Kekule.ObjUtils.isUnset(c.z)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,"z3",c.z,this.getDomHelper())}for(var h=["occupancy","xFract","xyzFract","yFract","convention","dictRef","ref"],p=0,g=h.length;p<g;++p){var f=h[p],C=e.getInfoValue(f);C&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(i,f,C,this.getDomHelper())}return this.writeObjAdditionalInfo(e,i,r),i},writeCtabConnector:function(e,t,r){var i=!1,n=this.createChildElem("bond",t);this.writeObjId(e,n);var o=e.getBondOrder?e.getBondOrder():null;if(o){var a=Kekule.IO.CmlUtils.kekuleBondOrderToCml(o);a&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"order",a,this.getDomHelper())}var s,l=e.getStereo?e.getStereo():null;if(l){var u=Kekule.IO.CmlUtils.kekuleBondStereoToCml(l);if(u.value){var d=this.createChildElem("bondStereo",n);Kekule.DomUtils.setElementText(d,u.value),u.invert&&(i=!0)}}for(var c=[],h=[],p=0,g=e.getConnectedObjCount();p<g;++p){var f=e.getConnectedObjAt(p);if(f.getId&&f.getId()){var C=f.getId();f instanceof Kekule.ChemStructureNode?i?c.unshift(C):c.push(C):f instanceof Kekule.ChemStructureConnector&&h.push(C)}}if(s=c.length){var m=1==s?"atomRefs":s>=2&&s<=4?"atomRefs"+s:"atomRefs";Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,m,Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(c),this.getDomHelper())}if(s=h.length){m="bondRefs";Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,m,Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(h),this.getDomHelper())}var T=["convention","dictRef","ref"];for(p=0,g=T.length;p<g;++p){var E=T[p],_=e.getInfoValue(E);_&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,E,_,this.getDomHelper())}return this.writeObjAdditionalInfo(e,n,r),n},identifyObjsInCtab:function(e,t){for(var r=0,i=e.getNodeCount();r<i;++r){var n=e.getNodeAt(r);n.getId()||this.autoIdentifyForObj(n,t),e.isSubFragment(n)&&n.hasCtab&&n.hasCtab()&&this.identifyObjsInCtab(n.getCtab(),t)}for(r=0,i=e.getConnectorCount();r<i;++r){var o=e.getConnectorAt(r);o.getId()||this.autoIdentifyForObj(o,t)}}}),Kekule.IO.CmlMoleculeWriter._UID_SEED=null,Kekule.IO.CmlReactionReagentReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReagentReader",doReadElement:function(e,t,r,i){return this.readReagent(e,r,this.getDomHelper())},readReagent:function(e,t,r){var i=null,n=Kekule.DomUtils.getDirectChildElems(e,null,"molecule",this.getCoreNamespaceURI());if(n&&n.length){var o=n[n.length-1],a=this.doGetChildElementReader(o).readElement(o,null,this);a&&(i={},Kekule.RoleMapUtils.setItem(i,a),this.readReagentAttribs(i,e,r))}return i},readReagentAttribs:function(e,t,r){for(var i=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,!0,r),n=Kekule.ObjUtils.getOwnedFieldNames(i),o=0,a=n.length;o<a;++o){var s=n[o],l=i[s];switch(s){case"role":e.role=Kekule.IO.CmlUtils.reagentRoleToKekule(l);break;case"amount":case"count":e.amount=parseFloat(l);break;default:e[s]=l}}return e}}),Kekule.IO.CmlReactionReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReader",doReadElement:function(e,t,r,i){return this.readReaction(e,this.getDomHelper())},readReaction:function(e,t){for(var r=new Kekule.Reaction,i=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),n=0,o=i.length;n<o;++n)this.isComponentListElem(i[n])?this.readComponentList(r,i[n],t):this.readChildElement(i[n],r);var a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(e,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,null,this.getDomHelper()),s=Kekule.ObjUtils.getOwnedFieldNames(a);for(n=0,o=s.length;n<o;++n){var l=s[n],u=a[l];switch(l){case"name":r.setName(u);break;case"title":r.setTitle(u);break;case"type":r.setReactionType(u);break;case"yield":r.setYield(parseFloat(u));break;default:r.setInfoValue(l,u)}}return r},readComponentList:function(e,t,r){var i=this.getListElemComponentName(t),n=e.getComponentArray(i,!0);if(n)for(var o=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI()),a=0,s=o.length;a<s;++a){var l=this.readChildElement(o[a],n);l&&(i==Kekule.ReactionComponent.CONDITION&&l instanceof ObjectEx?e.appendItem(i,l):e.appendMap(i,l))}},isComponentListElem:function(e){return["reactantList","productList","substanceList","conditionList"].indexOf(Kekule.DomUtils.getLocalName(e))>=0},getListElemComponentName:function(e){switch(Kekule.DomUtils.getLocalName(e)){case"reactantList":return Kekule.ReactionComponent.REACTANT;case"productList":return Kekule.ReactionComponent.PRODUCT;case"conditionList":return Kekule.ReactionComponent.CONDITION;default:return Kekule.ReactionComponent.SUBSTANCE}}}),Kekule.IO.CmlReactionWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlReactionWriter",doCreateElem:function(e,t){return this.createChildElem("reaction",t)},doWriteObject:function(e,t,r){return this.writeReaction(e,t,r)},writeReaction:function(e,t,r){for(var i=[Kekule.ReactionComponent.REACTANT,Kekule.ReactionComponent.PRODUCT,Kekule.ReactionComponent.SUBSTANCE,Kekule.ReactionComponent.CONDITION],n=0,o=i.length;n<o;++n)this.writeCompList(e,i[n],t,r);return this.writeReactionAttribs(e,t,r),t},writeReactionAttribs:function(e,t,r){var i=[];e.getName()&&i.push({key:"name",value:e.getName()}),e.getTitle()&&i.push({key:"title",value:e.getTitle()}),e.getReactionType()&&i.push({key:"type",value:e.getReactionType()}),e.getYield()&&i.push({key:"yield",value:e.getYield()});for(var n=["dictRef","convention","format","ref","role","type","state","yield","atomMap","electronMap"],o=0,a=n.length;o<a;++o)Kekule.ObjUtils.isUnset(e.getInfoValue(n[o]))||i.push({key:n[o],value:e.getInfoValue(n[o])});for(o=0,a=i.length;o<a;++o)Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,i[o].key,i[o].value,this.getDomHelper())},writeCompList:function(e,t,r,i){if(e.getComponentItemCount(t)<=0)return null;for(var n=this.getReactionComponentCmlName(t),o=this.createChildElem(n+"List",r),a=0,s=e.getComponentItemCount(t);a<s;++a){var l=e.getMapAt(t,a),u=e.getMapItemAt(t,a);if(l&&u){var d;t!=Kekule.ReactionComponent.CONDITION?(d=this.createChildElem(n,o),Kekule.ObjUtils.isUnset(l.amount)||Kekule.IO.CmlDomUtils.setCmlElemAttribute(d,"amount",l.amount,this.getDomHelper()),l.role&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(d,"role",Kekule.IO.CmlUtils.kekuleReagentRoleToCml(l.role),this.getDomHelper())):d=o;var c=this.doGetChildObjectWriter(u);c&&c.writeObject(u,d,i)}}},getReactionComponentCmlName:function(e){switch(e){case Kekule.ReactionComponent.REACTANT:return"reactant";case Kekule.ReactionComponent.PRODUCT:return"product";case Kekule.ReactionComponent.CONDITION:return"condition";default:return"substance"}}}),Kekule.IO.CmlListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlListReader",doCreateList:function(e){switch(Kekule.DomUtils.getLocalName(e)){case"moleculeList":return new Kekule.MoleculeList;case"reactionList":return new Kekule.ReactionList;default:return new Kekule.ChemObjList}},doAppendObjToList:function(e,t){return t&&t.append?t.append(e):this.tryApplySuper("doAppendObjToList",[e,t]),t}}),Kekule.IO.CmlListWriter=Class.create(Kekule.IO.CmlBaseListWriter,{CLASS_NAME:"Kekule.IO.CmlListWriter",doGetListElemTagName:function(e,t){var r;switch(DataType.getType(e)){case"Kekule.MoleculeList":r="moleculeList";break;case"Kekule.ReactionList":r="reactionList";break;default:r=this.tryApplySuper("doGetListElemTagName",[e,t])}return r}}),Kekule.IO.CmlTransparentListWriter=Class.create(Kekule.IO.CmlBaseListWriter,{CLASS_NAME:"Kekule.IO.CmlTransparentListWriter",doGetListElemTagName:function(e,t){return null}}),Kekule.IO.CmlRootReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlRootReader",doReadElement:function(e,t,r,i){var n;if(this.analysisElem(e),"cml"!=Kekule.DomUtils.getLocalName(e)&&(n=this.getReader(e)),n)return n.readElement(e,null,this,i);var o=i.defaultRootObjListHolder&&i.enableReadRootObjList,a=[],s=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI());if(s){for(var l=0,u=s.length;l<u;++l)if(n=this.getReader(s[l])){var d=n.readElement(s[l],null,this,i);if(!o)return d;a.push(d)}return a.length<=0?null:a.length<=1?a[0]:this._createChildObjsHolder(a,i.defaultRootObjListHolder)}return null},getReader:function(e){return this.doGetChildElementReader(e)},analysisElem:function(e){var t=this.getDomHelper();t.setForceAnalysisDoc(!0),this.getDomHelper().setRootElement(e);for(var r=t.getNamespaces(),i=null,n=0,o=r.length;n<o;++n){var a=r[n].namespaceURI;if(Kekule.IO.CML.LEGAL_CORE_NAMESPACE_URIS.indexOf(a)>=0){i=a;break}}this.setCoreNamespaceURI(i||null),this.setNamespaces(r)}}),Kekule.IO.CmlRootWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlRootWriter",getWriter:function(e){return this.doGetChildObjectWriter(e)},writeObject:function(e,t,r){var i;this.getDomHelper().setForceAnalysisDoc(!0),this.getDomHelper().setRootElement(t),i=e instanceof Kekule.ChemSpace?e.getRoot():e;var n=this.getWriter(i);return n?n.writeObject(i,t,r):null}}),Kekule.IO.CmlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.CmlReader",initProperties:function(){this.defineProp("objIdMap",{dataType:DataType.HASH,serializable:!1})},doReadData:function(e,t,r,i){var n,o;t!=Kekule.IO.ChemDataType.DOM?n=DataType.XmlUtility.parse(e).documentElement:n=e.documentElement?e.documentElement:e;var a=Kekule.IO.CmlElementReaderFactory.getReader("cml");if(a)try{this.setObjIdMap({}),a.setRootEvoker(this);var s=Object.extend({},Kekule.globalOptions.IO.cml);s=Object.extend(s,i||{}),o=a.readElement(n,null,null,s),a.doneReadingDocument(!0)}finally{a.finalize(),this.setObjIdMap(null)}return o},getLoadedObjById:function(e){var t=this.getObjIdMap();return t&&t[e]},setObjIdMapValue:function(e,t){var r=this.getObjIdMap();r&&(r[e]=t)}}),Kekule.IO.CmlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.CmlWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(t.prettyPrint)?Kekule.globalOptions.IO.cml.prettyPrint:t.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0}),this.defineProp("rootElemWriter",{dataType:DataType.OBJECT,setter:null,serializable:!1})},doWriteData:function(e,t,r,i){var n=Kekule.IO.CML.CML3_SCHEMA_NAMESPACE_URI,o=DataType.XmlUtility.newDocument("cml",n),a=Kekule.IO.CmlElementWriterFactory.getWriter("Kekule.ChemDocument");if(a){var s;try{this.setPropStoreFieldValue("rootElemWriter",a);var l=Object.extend({},Kekule.globalOptions.IO.cml);l=Object.extend(l,i||{}),a.setCoreNamespaceURI(n),s=a.writeObject(e,o.documentElement,l),a.doneWritingDocument(!0),t==Kekule.IO.ChemDataType.TEXT&&(s=DataType.XmlUtility.serializeNode(o.documentElement,{prettyPrint:l.prettyPrint||this.getPrettyPrint()}))}finally{this.setPropStoreFieldValue("rootElemWriter",null),a.finalize()}return s}return Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_OUTPUT_AS_CML").format(DataType.getType(e))),null}}),function(){Kekule.IO.MimeType.CML="chemical/x-cml";var e=Kekule.IO.CmlElementReaderFactory;e.register("name",Kekule.IO.CmlNameReader),e.register("scalar",Kekule.IO.CmlScalarReader),e.register("metaData",Kekule.IO.CmlMetaDataReader),e.register("metaDataList",Kekule.IO.CmlMetaDataListReader),e.register("formula",Kekule.IO.CmlFormulaReader),e.register("molecule",Kekule.IO.CmlMoleculeReader),e.register(["reactant","product","substance"],Kekule.IO.CmlReactionReagentReader),e.register("reaction",Kekule.IO.CmlReactionReader),e.register(["list","moleculeList","reactionList"],Kekule.IO.CmlListReader),e.register(["conditionlist"],Kekule.IO.CmlConditionListReader),e.register(["parameter"],Kekule.IO.CmlParameterReader),e.register(["parameterlist"],Kekule.IO.CmlParameterListReader),e.register(["array"],Kekule.IO.CmlArrayReader),e.register("cml",Kekule.IO.CmlRootReader);var t=Kekule.IO.CmlElementWriterFactory;t.register(DataType.ARRAY,Kekule.IO.CmlArrayWriter),t.register("Kekule.Scalar",Kekule.IO.CmlScalarWriter),t.register("Kekule.MolecularFormula",Kekule.IO.CmlFormulaWriter),t.register(["Kekule.ChemStructureFragment","Kekule.Molecule","Kekule.CompositeMolecule"],Kekule.IO.CmlMoleculeWriter),t.register("Kekule.Reaction",Kekule.IO.CmlReactionWriter),t.register(["Kekule.ChemObjList","Kekule.ChemStructureObjectGroup"],Kekule.IO.CmlListWriter),t.register(["Kekule.ChemSpaceElement","Kekule.ChemSpace"],Kekule.IO.CmlTransparentListWriter),t.register("Kekule.ChemDocument",Kekule.IO.CmlRootWriter),Kekule.IO.DataFormat.CML="cml",Kekule.IO.DataFormatsManager.register("cml",Kekule.IO.MimeType.CML,"cml",Kekule.IO.ChemDataType.TEXT,"Chemical Markup Language");var r=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.CML);Kekule.IO.ChemDataReaderManager.register("cml",Kekule.IO.CmlReader,[r]),Kekule.IO.ChemDataWriterManager.register("cml",Kekule.IO.CmlWriter,[Kekule.Scalar,Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemSpace],[r])}()}(),Kekule.IO.MdlVersion={V2000:2,V3000:3},Kekule.IO.MDL={VER2000:"V2000",VER3000:"V3000",SYMBOL_ANYATOM:"A",SYMBOL_STARATOM:"*",SYMBOL_HETEROATOM:"Q",SYMBOL_RGROUP:"R",SYMBOL_RGROUP2:"R#",SYMBOL_LONEPAIR:"LP",SYMBOL_ATOMLIST:"L",SYMBOL_DUMMYATOM:"Du",SD_DATA_HEAD_PREFIX:">",MOL_DELIMITER:"$$$$"},Kekule.IO.MdlUtils={isUnspecifiedAtomSymbol:function(e){return e===Kekule.IO.MDL.SYMBOL_ANYATOM||e===Kekule.IO.MDL.SYMBOL_STARATOM},isHeteroAtomSymbol:function(e){return e===Kekule.IO.MDL.SYMBOL_HETEROATOM},isRGroupSymbol:function(e){return e===Kekule.IO.MDL.SYMBOL_RGROUP||e===Kekule.IO.MDL.SYMBOL_RGROUP2},isLonePairSymbol:function(e){return e===Kekule.IO.MDL.SYMBOL_LONEPAIR},isAtomListSymbol:function(e){return e===Kekule.IO.MDL.SYMBOL_ATOMLIST},analysisMdlDateTimeStr:function(e,t){var r=new Date,i=0,n=2,o=(parseInt(e.substr(i,n).trim(),10)||1)-1;i+=n;var a=parseInt(e.substr(i,n).trim(),10)||0;i+=n,n=t?4:2;var s=parseInt(e.substr(i,n),10)||0;t||(s+=s>=70?1900:2e3),r.setFullYear(s,o,a),i+=n,n=2;var l=parseInt(e.substr(i,n),10)||0;i+=n;var u=parseInt(e.substr(i,n),10)||0;return r.setHours(l,u),r},generateMdlDateTimeStr:function(e,t){var r="";return r+=(e.getMonth()+1).toString().lpad(2,"0"),r+=e.getDate().toString().lpad(2,"0"),r+=t?e.getFullYear().toString().lpad(4,"0"):(e.getFullYear()%100).toString().lpad(2,"0"),r+=e.getHours().toString().lpad(2,"0"),r+=e.getMinutes().toString().lpad(2,"0")},mdlRadicalToKekule:function(e){return e},kekuleRadicalToMdl:function(e){return e},bondTypeToKekuleOrder:function(e){switch(e){case 1:return Kekule.BondOrder.SINGLE;case 2:return Kekule.BondOrder.DOUBLE;case 3:return Kekule.BondOrder.TRIPLE;case 4:return Kekule.BondOrder.EXPLICIT_AROMATIC;default:return Kekule.BondOrder.UNSET}},kekuleBondOrderToMdlType:function(e){switch(e){case Kekule.BondOrder.SINGLE:return 1;case Kekule.BondOrder.DOUBLE:return 2;case Kekule.BondOrder.TRIPLE:return 3;case Kekule.BondOrder.EXPLICIT_AROMATIC:return 4;default:return 1}},getRxnMarkVersion:function(e){var t=e.substr(0,4);return"$RXN"!=t?null:(t=e.substr(4).trim())==Kekule.IO.MDL.VER3000?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000},assertIlegalForCtabOutput:function(e){return e instanceof Kekule.StructureFragment?!!e.hasCtab()||(Kekule.error(Kekule.$L("ErrorMsg.MOLECULE_HAS_NO_CTAB_TO_OUTPUT")),!1):(Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_WRITE_NON_MOLECULE_TO_MOL")),!1)}},Kekule.IO.MdlStructureUtils={fillFragment:function(e,t,r){if(e.clear(),t){var i;if(i=r&&r!=Kekule.CoordMode.UNKNOWN?r==Kekule.CoordMode.COORD3D:t.atomInfos.isCoord3D,t.atomInfos)for(var n=0,o=t.atomInfos.length;n<o;++n){if(u=t.atomInfos[n]){var a=Kekule.IO.MdlStructureUtils.createStructureNode(e,u,i);a?e.appendNode(a):Kekule.raise(Kekule.$L("ErrorMsg.MDL_CTAB_ATOM_CANNOT_CREATE"))}}if(t.bondInfos)for(n=0,o=t.bondInfos.length;n<o;++n){if(u=t.bondInfos[n]){var s=Kekule.IO.MdlStructureUtils.createStructureConnector(e,u);s?e.appendConnector(s):Kekule.raise(Kekule.$L("ErrorMsg.MDL_CTAB_BOND_CANNOT_CREATE"))}}if(t.sgInfos&&t.sgInfos.length){var l=[];for(n=0,o=t.sgInfos.length;n<o;++n){var u;if((u=t.sgInfos[n])&&"SUP"==u.sgType){for(var d=[],c=0,h=u.atomIndexes.length;c<h;++c)d.push(e.getNodeAt(u.atomIndexes[c]));d.length&&l.push({atoms:d,text:u.label})}}for(n=0,o=l.length;n<o;++n){if((d=l[n].atoms).length){var p=e.marshalSubFragment(d,new Kekule.SubGroup),g=l[n].text;p.setFormulaText&&g.match(/.+\d/)?p.setFormulaText(l[n].text):p.setAbbr(l[n].text)}}}}return e},createStructureNode:function(e,t,r){var i;if(t.atomListInfo||Kekule.IO.MdlUtils.isAtomListSymbol(t.symbol)){i=new Kekule.VariableAtom;var n=[];t.atomListInfo&&t.atomListInfo.symbols&&(n=n.concat(t.atomListInfo.symbols),t.atomListInfo.isAllowList?i.setAllowedIsotopeIds(n):i.setDisallowedIsotopeIds(n))}else if(Kekule.IO.MdlUtils.isRGroupSymbol(t.symbol))i=new Kekule.RGroup;else if(Kekule.IO.MdlUtils.isHeteroAtomSymbol(t.symbol))i=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.HETERO);else if(Kekule.IO.MdlUtils.isUnspecifiedAtomSymbol(t.symbol))i=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY);else{var o=Kekule.ChemicalElementsDataUtil.getElementInfo(t.symbol);if(o){var a=null;if(t.massNumber)a=t.massNumber;else if(t.massDiff&&o){var s=o.naturalMass,l=(a=Math.round(s+t.massDiff),Kekule.IsotopesDataUtil.getIsotopeInfo(o.atomicNumber,a));l||(a=Math.floor(s+t.massDiff),l=Kekule.IsotopesDataUtil.getIsotopeInfo(o.atomicNumber,a)),l||(a=Math.ceil(s+t.massDiff),l=Kekule.IsotopesDataUtil.getIsotopeInfo(o.atomicNumber,a)),l||(a=null)}i=new Kekule.Atom(null,t.symbol,a)}else{var u=Kekule.IsotopesDataUtil.getIsotopeInfo(t.symbol);i=u?new Kekule.Atom(null,u.atomicNumber,u.massNumber):new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY)}}return t.charge&&i.setCharge(t.charge),t.radical&&i.setRadical(t.radical),t.parity&&i.setParity&&i.setParity(t.parity),void 0!==t.hydrongenCount&&i.setExplicitHydrogenCount&&i.setExplicitHydrogenCount(t.hydrongenCount),r?i.setCoord3D({x:t.x,y:t.y,z:t.z}):i.setCoord2D({x:t.x,y:t.y}),i},createStructureConnector:function(e,t){var r=e.getNodeAt(t.atomIndex1),i=e.getNodeAt(t.atomIndex2);if(r&&i){var n=[r,i];if(t.endAtomIndexes)for(var o=0,a=t.endAtomIndexes.length;o<a;++o){var s=e.getNodeAt(t.endAtomIndexes[o]);s&&n.push(s)}var l=new Kekule.Bond(null,n,t.order);return void 0!==t.stereo&&l.setStereo(t.stereo),l}return null},isNodeVariableAtom:function(e){return e instanceof Kekule.VariableAtom},getAtomTypeStr:function(e,t){if(e instanceof Kekule.Atom)return e.getSymbol();if(!(e instanceof Kekule.Pseudoatom)){if(e instanceof Kekule.RGroup)return Kekule.IO.MDL.SYMBOL_RGROUP;if(e instanceof Kekule.VariableAtom){if(t)return Kekule.IO.MDL.SYMBOL_ATOMLIST;var r="[",i=e.getAllowedIsotopeIds();if(i&&i.length||(r="NOT[",i=e.getDisallowedIsotopeIds()),i&&i.length){for(var n=[],o=0,a=i.length;o<a;++o){var s=Kekule.IsotopesDataUtil.getIsotopeIdDetail(i[o]);s&&s.symbol&&n.push(s.symbol)}return r=r+n.join(",")+"]"}return Kekule.IO.MDL.SYMBOL_ATOMLIST}return"?"}switch(e.getAtomType()){case Kekule.PseudoatomType.ANY:return Kekule.IO.MDL.SYMBOL_ANYATOM;case Kekule.PseudoatomType.HETERO:return Kekule.IO.MDL.SYMBOL_HETEROATOM;default:return Kekule.IO.MDL.SYMBOL_DUMMYATOM}},getMoleculeCtabStructureInfo:function(e,t){var r={};r.atoms=e.getLeafNodes(),r.bonds=e.getAllChildConnectors(),r.subGroups=e.getSubFragments();for(var i=0,n=0,o=0,a=r.atoms.length;o<a;++o)r.atoms[o].hasCoord3D()&&++n,r.atoms[o].hasCoord2D()&&++i,t.explicitChiralFlagInCountLine&&r.atoms[o].getParity&&r.atoms[o].getParity()&&(r.chiral=!0);return r.coordMode=i>n?Kekule.CoordMode.COORD2D:Kekule.CoordMode.COORD3D,r},splitConnectedNodes:function(e){for(var t={primaryNodes:[]},r=0,i=e.getConnectedObjs(),n=0,o=i.length;n<o;++n)i[n]instanceof Kekule.ChemStructureNode&&(r<2?(t.primaryNodes.push(i[n]),++r):(t.remainNodes||(t.remainNodes=[]),t.remainNodes.push(i[n])));return t},generateClassicStyleCountLine:function(e,t){if(t==Kekule.IO.MdlVersion.V3000)return"  0  0  0     0  0              0 V3000";var r="";r+=e.atoms.length.toString().lpad(3),r+=e.bonds.length.toString().lpad(3),r+="0".lpad(3),r+="0".lpad(3),r+=(e.chiral?"1":"0").lpad(3),r+="0".lpad(3);for(var i=0;i<4;++i)r+="0".lpad(3);return r+="999",r+=Kekule.IO.MDL.VER2000.lpad(6)}},Kekule.IO.MdlBlockHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.MdlBlockHandler",initProperties:function(){this.defineProp("textBuffer",{dataType:"Kekule.TextLinesBuffer",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("textBuffer");return e||(e=this.createTextBuffer(),this.setPropStoreFieldValue("textBuffer",e)),e},setter:null})},createTextBuffer:function(){return new Kekule.TextLinesBuffer}}),Kekule.IO.MdlBlockReader=Class.create(Kekule.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockReader",readBlock:function(e,t){return"string"==typeof e?this.getTextBuffer().setText(e):this.getTextBuffer().setLines(e),this.getTextBuffer().reset(),this.doReadBlock(this.getTextBuffer())},doReadBlock:function(e,t){}}),Kekule.IO.MdlBlockWriter=Class.create(Kekule.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockWriter",writeBlock:function(e,t){return this.getTextBuffer().clear(),this.doWriteBlock(e,this.getTextBuffer(),t),this.getTextBuffer().getText()},doWriteBlock:function(e,t,r){}}),Kekule.IO.Mdl2kUtils={atomLineChargeToKekule:function(e){switch(e){case 1:return 3;case 2:return 2;case 3:return 1;case 5:return-1;case 6:return-2;case 7:return-3;default:return 0}},chargeToMdlAtomLineValue:function(e){switch(e){case 1:return 3;case 2:return 2;case 3:return 1;case-1:return 5;case-2:return 6;case-3:return 7;default:return 0}},atomLineChargeToRadical:function(e){return 4==e?Kekule.RadicalOrder.DOUBLET:0},radicalToMdlAtomLineValue:function(e){return e==Kekule.RadicalOrder.DOUBLET?4:0},chargeOrRadicalToMdlAtomLineValue:function(e,t){return e?Kekule.IO.Mdl2kUtils.chargeToMdlAtomLineValue(e):t?Kekule.IO.Mdl2kUtils.radicalToMdlAtomLineValue(e):0},bondStereoToKekule:function(e,t){if(t==Kekule.BondOrder.SINGLE)switch(e){case 1:return Kekule.BondStereo.UP;case 4:return Kekule.BondStereo.UP_OR_DOWN;case 6:return Kekule.BondStereo.DOWN;default:return Kekule.BondStereo.NONE}else{if(t!=Kekule.BondOrder.DOUBLE)return Kekule.BondStereo.NONE;switch(e){case 3:return Kekule.BondStereo.E_Z_BY_COORDINATES;default:return Kekule.BondStereo.NONE}}},bondStereoToMdlBondLineValue:function(e,t,r){var i=Kekule.BondStereo,n={};if(t==Kekule.BondOrder.SINGLE)if(r&&[i.UP_INVERTED,i.DOWN_INVERTED].indexOf(e)>=0&&(n.inverted=!0),n.inverted)e===i.UP_INVERTED?n.stereo=1:e===i.DOWN_INVERTED&&(n.stereo=6);else switch(e){case i.DOWN_INVERTED:case i.UP:n.stereo=1;break;case i.UP_INVERTED:case i.DOWN:n.stereo=6;break;case i.UP_OR_DOWN_INVERTED:case i.UP_OR_DOWN:n.stereo=4;break;default:n.stereo=0}else if(t==Kekule.BondOrder.DOUBLE)switch(e){case Kekule.BondStereo.E_Z_BY_COORDINATES:n.stereo=3;break;default:n.stereo=0}else n.stereo=0;return n},coordToStr:function(e){return(e||0).toFixed(4)},getMassDiff:function(e){var t=Kekule.ChemicalElementsDataUtil.getElementInfo(e.getAtomicNumber()).naturalMass;return Math.round(e.getMassNumber()-t)},getAtomListPropLineValue:function(e){var t="",r=e.getAllowedIsotopeIds();if(r&&r.length?t=" F ":(t=" T ",r=e.getDisallowedIsotopeIds()),r&&r.length){for(var i=[],n=0,o=r.length;n<o;++n){var a=Kekule.IsotopesDataUtil.getIsotopeIdDetail(r[n]);a&&a.symbol&&i.push(a.symbol.rpad(4))}var s=i.join("");return t=i.length.toString().lpad(3)+t+s}return null},getCtabPropLineTag:function(e,t){return(t||"M")+"  "+e},getCtabPropLineCountTag:function(e,t,r){var i=(r||"M")+"  "+e;return t&&(i+=t.toString().lpad(3)),i},generateCtabPropLine:function(e,t,r,i){return Kekule.IO.Mdl2kUtils.getCtabPropLineCountTag(t,r,i)+" "+e.join(" ")}},Kekule.IO.Mdl2kCTabReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl2kCTabReader",doReadBlock:function(e,t){return this.analysisCTab(e)},analysisCTab:function(e){var t={},r=e.readLine(),i=this.analysisCountLine(r),n=[];n.isCoord3D=!1;for(var o=0;o<i.atomCount;++o){r=e.readLine();var a=this.analysisAtomLine(r);a.z&&(n.isCoord3D=!0),n.push(a)}var s=[];for(o=0;o<i.bondCount;++o){r=e.readLine();var l=this.analysisBondLine(r);s.push(l)}for(o=0;o<i.atomListCount;++o){r=e.readLine();var u=this.analysisAtomListInfoLine(r);n[u.atomIndex]&&(n[u.atomIndex].atomListInfo=u)}for(o=0;o<i.stextCount;++o)r=e.readLine(),r=e.readLine();for(var d=[];!e.eof();){r=e.readLine();var c=this.analysisPropertyLine(r,n,d);if("END"===c.prop)break;if("SKP"===c.prop)for(o=0;o<c.count&&!e.eof();++o)r=e.readLine();else if("A"===c.leading){if(e.eof())break;var h=c.atomIndex;r=e.readLine(),n[h].symbol=r.trim()}}return t.countInfo=i,t.atomInfos=n,t.bondInfos=s,t.sgInfos=d,t},analysisCountLine:function(e){var t={},r=e.substr(33,6).trim();return r&&r!=Kekule.IO.MDL.VER2000?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL2000_FORMAT_DATA")),null):(r=e.substr(0,3),t.atomCount=parseInt(r,10),r=e.substr(3,3),t.bondCount=parseInt(r,10),r=e.substr(12,3),t.isChiral=0!=parseInt(r,10),r=e.substr(15,3),t.stextCount=parseInt(r,10),t)},analysisAtomLine:function(e){var t={},r=e.substr(0,10);t.x=parseFloat(r),r=e.substr(10,10),t.y=parseFloat(r),r=e.substr(20,10),t.z=parseFloat(r),r=e.substr(31,3),t.symbol=r.trim(),r=e.substr(34,2),t.massDiff=parseInt(r,10),r=e.substr(36,3);var i=parseInt(r,10),n=Kekule.IO.Mdl2kUtils.atomLineChargeToRadical(i);return n?t.radical=n:t.charge=Kekule.IO.Mdl2kUtils.atomLineChargeToKekule(i),r=e.substr(39,3),(i=parseInt(r,10))&&(t.parity=i),r=e.substr(42,3),(i=parseInt(r,10))>0&&(t.hydrongenCount=i-1),t},analysisBondLine:function(e){var t={},r=e.substr(0,3);t.atomIndex1=parseInt(r,10)-1,r=e.substr(3,3),t.atomIndex2=parseInt(r,10)-1,r=e.substr(6,3),t.order=Kekule.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(r,10)),r=e.substr(9,3);var i=Kekule.IO.Mdl2kUtils.bondStereoToKekule(parseInt(r,10),t.order);return i&&(t.stereo=i),t},analysisAtomListInfoLine:function(e){var t={},r=e.substr(0,3);t.atomIndex=parseInt(r,10)-1,r=e.substr(4,1),t.isAllowList="f"==r.toLowerCase(),r=e.substr(9,1);var i=Math.min(parseInt(r,10),5);t.atomicNumbers=[];for(var n=11,o=0;o<i;++o){n+=4*o,r=e.substr(n,3);var a=parseInt(r,10);a&&t.atomicNumbers.push(a)}return t},analysisPropertyLine:function(e,t,r){var i={},n=e.substr(0,1);if(i.leading=n,"M"==n){var o,a,s=e.substr(3,3).trim();if(i.prop=s,"END"===s)return i;if(["CHG","RAD","ISO"].indexOf(s)>=0){var l=parseInt(e.substr(6,3).trim());i.entryCount=l,i.entries=[];for(var u="CHG"===s?"charge":"RAD"===s?"radical":"massNumber",d=10,c=0;c<l;++c){var h=parseInt(e.substr(d,3).trim(),10)-1,p=parseInt(e.substr(d+4,3).trim(),10);d+=8,i.entries.push({atomIndex:h,propName:p}),t[h][u]=p}}else["STY","SLB"].indexOf(s)>=0?a=r[o=parseInt(e.substr(10,3),10)-1]:["SAL","SBL","SMT","SCL","SAP","SBV"].indexOf(s)>=0&&(a=r[o=parseInt(e.substr(7,3),10)-1]);switch(s){case"ALS":var g={},f=e.substr(7,3).trim();g.atomIndex=parseInt(f,10)-1,i.atomIndex=g.atomIndex;var C=parseInt(e.substr(10,3)),m=e.substr(14,1);g.isAllowList="f"==m.toLowerCase(),g.symbols=[];for(c=0;c<C;++c)m=e.substr(16+4*c,4).trim(),g.symbols.push(m);i.atomListInfo=g;var T=t[g.atomIndex].atomListInfo;T?T.isAllowList!==g.isAllowList?t[g.atomIndex].atomListInfo=g:T.symbols=Kekule.ArrayUtils.pushUnique(T.symbols,g.symbols):t[g.atomIndex].atomListInfo=g;break;case"STY":"SUP"==e.substr(14,3)&&(r[o]={sgType:"SUP"});break;case"SLB":a&&(a.labelId=e.substr(14).trim());break;case"SAL":if(a){var E=parseInt(e.substr(10,3));a.atomIndexes||(a.atomIndexes=[]);for(c=0;c<E;++c){m=e.substr(14+4*c,3),h=parseInt(m)-1;a.atomIndexes.push(h)}}break;case"SBL":if(a&&"SUP"==a.sgType){var _=parseInt(e.substr(10,3));a.crossBondIndexes||(a.crossBondIndexes=[]);for(c=0;c<_;++c){m=e.substr(14+4*c,3);var S=parseInt(m)-1;a.crossBondIndexes.push(S)}}break;case"SMT":a&&("SUP"==a.sgType?a.label=e.substr(11).trim():a.subscript=e.substr(11).trim());break;case"SCL":a&&(a.sgClass=e.substr(11).trim());break;case"SBV":if(a){var O=parseInt(e.substr(11,3),10)-1;a.bondVectors||(a.bondVectors=[]),a.bondVectors[O]={bondIndex:O,x:parseFloat(e.substr(14,10)),y:parseFloat(e.substr(24,10))};var y=e.substr(34,10).trim();y&&(a.bondVectors[O].z=parseFloat(y)||0)}}}else if("A"===n){d=3,h=parseInt(e.substr(d,3).trim(),10)-1;i.atomIndex=h}else if("V"===n);else if("G"===n);else if("S"===n){s=e.substr(3,3).trim();i.prop=s,i.count=parseInt(e.substr(6,3),10)}return i}}),Kekule.IO.Mdl2kCTabWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl2kCTabWriter",initialize:function(e){this.tryApplySuper("initialize"),this.setCoordMode(e||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:Kekule.CoordMode.UNKNOWN})},doWriteBlock:function(e,t,r){return Kekule.IO.MdlUtils.assertIlegalForCtabOutput(e),this.outputCtab(e,t,r)},outputCtab:function(e,t,r){var i=[],n=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(e,r);if(this.getCoordMode()!=Kekule.CoordMode.UNKNOWN&&(n.coordMode=this.getCoordMode()),t.writeLine(this.generateCountLine(n)),this.outputAtomBlock(e,n,t,i),this.outputBondBlock(e,n,t),i.length)for(var o=0,a=i.length;o<a;++o)t.writeLine(i[o]);this.outputSubgroupsPropLines(e,n,t),t.writeLine(Kekule.IO.Mdl2kUtils.getCtabPropLineTag("END"))},generateCountLine:function(e){return Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(e,Kekule.IO.MdlVersion.V2000)},outputAtomBlock:function(e,t,r,i){for(var n=0,o=t.atoms.length;n<o;++n){var a=t.atoms[n],s=this.generateAtomLine(n,t.coordMode,a,i);r.writeLine(s)}},generateAtomLine:function(e,t,r,i){var n=Kekule.IO.Mdl2kUtils.coordToStr,o="",a=(e+1).toString().lpad(3),s=t==Kekule.CoordMode.COORD3D?r.getAbsCoord3D():r.getAbsCoord2D();if(o+=n(s.x).lpad(10)+n(s.y).lpad(10)+n(s.z).lpad(10),o+=" "+Kekule.IO.MdlStructureUtils.getAtomTypeStr(r,!0).rpad(3),Kekule.IO.MdlStructureUtils.isNodeVariableAtom(r)){var l=Kekule.IO.Mdl2kUtils.getAtomListPropLineValue(r);if(l){var u=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("ALS")+" "+a+l;i.push(u)}}if(r.getMassNumber&&r.getMassNumber()){o+=(Kekule.IO.Mdl2kUtils.getMassDiff(r.getIsotope())||0).toString().lpad(2);u=Kekule.IO.Mdl2kUtils.generateCtabPropLine([a,r.getMassNumber().toString().lpad(3)],"ISO",1);i.push(u)}else o+="0".lpad(2);if(o+=Kekule.IO.Mdl2kUtils.chargeOrRadicalToMdlAtomLineValue(r.getCharge?r.getCharge():null,r.getRadical?r.getRadical():null).toString().lpad(3),r.getCharge&&r.getCharge()){u=Kekule.IO.Mdl2kUtils.generateCtabPropLine([a,r.getCharge().toString().lpad(3)],"CHG",1);i.push(u)}if(r.getRadical&&r.getRadical()){u=Kekule.IO.Mdl2kUtils.generateCtabPropLine([a,Kekule.IO.MdlUtils.kekuleRadicalToMdl(r.getRadical()).toString().lpad(3)],"RAD",1);i.push(u)}o+=(r.getParity&&r.getParity()||0).toString().lpad(3);var d=r.getExplicitHydrogenCount?r.getExplicitHydrogenCount():null;o+=(Kekule.ObjUtils.isUnset(d)?"0":(d+1).toString()).lpad(3);for(var c=0,h="0".lpad(3);c<8;++c)o+=h;return o},outputBondBlock:function(e,t,r){for(var i=0,n=t.bonds.length;i<n;++i){var o=t.bonds[i],a=this.generateBondLine(i,o,t.atoms);r.writeLine(a)}},generateBondLine:function(e,t,r){var i,n,o="";t.getStereo&&t.getBondOrder?i=(n=Kekule.IO.Mdl2kUtils.bondStereoToMdlBondLineValue(t.getStereo(),t.getBondOrder(),!0)).stereo.toString().lpad(3):(n={},i+="0".lpad(3));var a,s,l=Kekule.IO.MdlStructureUtils.splitConnectedNodes(t);return a=(r.indexOf(l.primaryNodes[0])+1).toString().lpad(3),s=(r.indexOf(l.primaryNodes[1])+1).toString().lpad(3),n&&n.inverted?o+=s+a:o+=a+s,t.getBondOrder?o+=Kekule.IO.MdlUtils.kekuleBondOrderToMdlType(t.getBondOrder()).toString().lpad(3):o+="0".lpad(3),o+=i,o+="0".lpad(3),o+="0".lpad(3),o+="0".lpad(3)},outputSubgroupsPropLines:function(e,t,r){for(var i=0,n=t.subGroups.length;i<n;++i)for(var o=this.generateSgroupLines(i,t.subGroups[i],t),a=0,s=o.length;a<s;++a)r.writeLine(o[a])},generateSgroupLines:function(e,t,r){var i=[],n=(e+1).toString().lpad(3),o=Kekule.IO.Mdl2kUtils.generateCtabPropLine([n,"SUP"],"STY",1);i.push(o),o=Kekule.IO.Mdl2kUtils.generateCtabPropLine([n,n],"SLB",1),i.push(o);var a=t.getAbbr&&t.getAbbr()||t.getFormulaText&&t.getFormulaText()||t.getName&&t.getName();a&&(o=Kekule.IO.Mdl2kUtils.generateCtabPropLine([n,a],"SMT"),i.push(o));for(var s=[],l=0,u=(C=t.getLeafNodes()).length;l<u;++l){(e=r.atoms.indexOf(C[l]))>=0&&s.push((e+1).toString().lpad(3))}s=s.sort();var d=Kekule.ArrayUtils.divide(s,15);for(l=0,u=d.length;l<u;++l){var c=d[l];o=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SAL")+" "+n+c.length.toString().lpad(3)+" "+c.join(" "),i.push(o)}var h=t.getCrossConnectors(),p=[],g=[],f=Kekule.IO.Mdl2kUtils.coordToStr;for(l=0,u=h.length;l<u;++l){if((e=r.bonds.indexOf(h[l]))>=0){p.push((e+1).toString().lpad(3));var C,m=[e+1],T={};2==(C=Kekule.IO.MdlStructureUtils.splitConnectedNodes(h[l]).primaryNodes).length&&(r.coordMode==Kekule.CoordMode.COORD2D?(T=Kekule.CoordUtils.substract(C[0].getAbsCoord2D(),C[1].getAbsCoord2D()),m=m.concat([f(T.x).lpad(10),f(T.y).lpad(10)])):(T=Kekule.CoordUtils.substract(C[0].getAbsCoord3D(),C[1].getAbsCoord3D()),m=m.concat([f(T.x),f(T.y),f(T.z)]))),g.push(m)}}p=p.sort();var E=Kekule.ArrayUtils.divide(p,15);for(l=0,u=E.length;l<u;++l){var _=E[l];o=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SBL")+" "+n+_.length.toString().lpad(3)+" "+_.join(" "),i.push(o)}for(l=0,u=g.length;l<u;++l){var S=g[l].shift(),O=g[l].join("");o=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SBV")+" "+n+" "+S.toString().lpad(3)+O,i.push(o)}return i}}),Kekule.IO.Mdl3kUtils={get3kBlockStartTag:function(e){return"BEGIN "+e.toUpperCase()},get3kBlockEndTag:function(e){return"END "+e.toUpperCase()},isAtomList:function(e){return e.search(/\[.+\]/)>=0},analysisAtomList:function(e){var t=/\[(.+)\]/g.exec(e);if(t&&t.length>=2){t=t[1].split(",");var r={};r.isAllowList=!(0==e.trim().indexOf("NOT")),r.symbols=[];for(var i=0,n=t.length;i<n;++i)r.symbols.push(t[i].trim());return r}return null},bondCfgToKekule:function(e){switch(e){case 0:return Kekule.BondStereo.NONE;case 1:return Kekule.BondStereo.UP;case 2:return Kekule.BondStereo.UP_OR_DOWN;case 3:return Kekule.BondStereo.DOWN;default:return Kekule.BondStereo.NONE}},bondStereoToMdlCfg:function(e,t){var r=Kekule.BondStereo,i={};if(t&&[r.UP_INVERTED,r.DOWN_INVERTED].indexOf(e)>=0&&(i.inverted=!0),i.inverted)e===r.UP_INVERTED?i.cfg=1:e===r.DOWN_INVERTED&&(i.cfg=3);else switch(e){case r.UP:case r.DOWN_INVERTED:i.cfg=1;break;case r.UP_OR_DOWN:i.cfg=2;break;case r.DOWN:case r.UP_INVERTED:i.cfg=3;break;default:i.cfg=0}return i},coordToStr:function(e){return(e||0).toFixed(6)}},Kekule.IO.Mdl3kValueUtils={SEPARATOR:" ",KEYVALUE_CONNECTOR:"=",STR_QUOTE:'"',ESC_QUOTE:'""',VALUELIST_PATTERN:/\(.+\)/g,split:function(e,t){for(var r=t||Kekule.IO.Mdl3kValueUtils.SEPARATOR,i=Kekule.IO.Mdl3kValueUtils.STR_QUOTE,n=[],o=!1,a=!1,s=!1,l="",u=0,d=e.length;u<d;++u){var c=e.charAt(u);c==i?!o&&e.charAt(u+1)==i||o&&e.charAt(u-1)==i||(o=!o):"["==c?a=!0:"]"==c?a=!1:"("==c?s=!0:")"==c&&(s=!1),c==r?o||a||s||!l?l+=c:(n.push(l),l=""):l+=c}return l&&n.push(l),n},merge:function(e,t){var r=t||Kekule.IO.Mdl3kValueUtils.SEPARATOR;return e.join(r)},isKeyValuePair:function(e){return e.indexOf(Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR)>=0},splitKeyValue:function(e){var t={},r=Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR,i=e.indexOf(r);return i<0?t.value=e:(t.key=e.substr(0,i),t.value=e.substr(i+r.length)),t},mergeKeyValue:function(e,t){return t?""+t+Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR+e:e},isValueList:function(e){return e.search(Kekule.IO.Mdl3kValueUtils.VALUELIST_PATTERN)>=0},splitValueList:function(e){var t=/\((.+)\)/.exec(e);if(t&&t.length>1){var r=t[1],i=Kekule.IO.Mdl3kValueUtils.split(r);return i.shift(),i}return[e]},mergeValueList:function(e){for(var t="("+e.length,r=0,i=e.length;r<i;++r)t+=Kekule.IO.Mdl3kValueUtils.SEPARATOR+e[r];return t+=")"},unquoteValue:function(e){var t=Kekule.IO.Mdl3kValueUtils.STR_QUOTE,r=e.trim();r.substr(0,t.length)==t&&(r=r.substr(t.length)),r.substr(r.length-t.length)==t&&(r=r.substr(0,r.length-t.length));var i=new RegExp(t+t,"g");return r=r.replace(i,t),Kekule.IO.Mdl3kValueUtils.isValueList(r)&&(r=Kekule.IO.Mdl3kValueUtils.splitValueList(r)),r},quoteValue:function(e){var t=Kekule.IO.Mdl3kValueUtils.STR_QUOTE,r=""+e,i=new RegExp(t,"g");return(r=r.replace(i,t+t)).indexOf(Kekule.IO.Mdl3kValueUtils.SEPARATOR)>=0&&(r=t+r+t),r},splitValues:function(e){for(var t=[],r=Kekule.IO.Mdl3kValueUtils.split(e),i=0,n=r.length;i<n;++i){var o=Kekule.IO.Mdl3kValueUtils.splitKeyValue(r[i]);o.value&&(o.value=Kekule.IO.Mdl3kValueUtils.unquoteValue(o.value)),t.push(o)}return t},mergeValues:function(e){for(var t,r=0,i=e.length;r<i;++r){var n,o,a,s=e[r];"object"!=typeof s||Kekule.ArrayUtils.isArray(s)?o=s:(n=s.key,o=s.value),a=Kekule.ArrayUtils.isArray(o)?Kekule.IO.Mdl3kValueUtils.mergeValueList(o):Kekule.IO.Mdl3kValueUtils.quoteValue(o),n&&(a=Kekule.IO.Mdl3kValueUtils.mergeKeyValue(a,n)),t=Kekule.IO.Mdl3kValueUtils.appendToken(t,a)}return t},appendToken:function(e,t,r){var i=r||Kekule.IO.Mdl3kValueUtils.SEPARATOR,n=e||"";return n&&n.substr(n.length-i.length,i.length)!=i?n+=Kekule.IO.Mdl3kValueUtils.SEPARATOR+t:n=t,n}},Kekule.IO.Mdl3kTextBuffer=Class.create(Kekule.TextLinesBuffer,{CLASS_NAME:"Kekule.Mdl3kTextBuffer",LEADING_TAG:"M  V30 ",LINE_CONTI_MARK:"-",MAX_COL_WIDTH:80,initialize:function(e){this.tryApplySuper("initialize",[e])},isStartWithLeadingTag:function(e){return e.substr(0,this.LEADING_TAG.length)==this.LEADING_TAG},isEndWithContinueMark:function(e){var t=e.trim();return t.substr(t.length-this.LINE_CONTI_MARK.length)==this.LINE_CONTI_MARK},getLineWithout3kTag:function(e){if(!e)return e;var t=this.LEADING_TAG.length;return e.substr(0,t)==this.LEADING_TAG?e.substr(t):e},getLineAtEx:function(e){var t=this.getLineAt(e),r=1;if(t&&this.isEndWithContinueMark(t)&&this.isStartWithLeadingTag(this.getLines()[e])){var i=t.lastIndexOf(this.LINE_CONTI_MARK);t=t.substr(0,i);var n=this.getLineAtEx(e+1);t+=n.line,r+=n.lineCount}return{line:t,lineCount:r}},getLineAt:function(e){var t=this.tryApplySuper("getLineAt",[e]);return this.getLineWithout3kTag(t)},readLine:function(){var e=this.getLineAtEx(this.getCurrLineNo());return this.incCurrLineNo(e.lineCount),e.line||""},writeLine:function(e,t){if(t)return this.tryApplySuper("writeLine",[e]);var r,i=e;if(this.isStartWithLeadingTag(e)||(i=this.LEADING_TAG+i),i.length>this.MAX_COL_WIDTH){var n=this.LINE_CONTI_MARK,o=(Kekule.IO.Mdl3kValueUtils.SEPARATOR,this.MAX_COL_WIDTH-n.length);r=i.substr(o),i=i.substr(0,o),i+=n}var a=this.tryApplySuper("writeLine",[i]);return r&&(a=this.writeLine(r,t)),a},writeLines:function(e,t){for(var r=0,i=e.length;r<i;++r)this.writeLine(e[r],t)},getBlockBuffer:function(e,t){for(var r,i=Kekule.IO.Mdl3kUtils.get3kBlockStartTag(e),n=Kekule.IO.Mdl3kUtils.get3kBlockEndTag(e),o=this.getCurrLineNo(),a=this.readLine().trim();a!=i&&!this.eof();)a=this.readLine().trim();if(this.eof())r=null;else{var s=this.getCurrLineNo(),l=this.getCurrLineNo();for(a=this.readLine().trim();a!=n&&!this.eof();)l=this.getCurrLineNo(),a=this.readLine().trim();if(a==n)var u=this.getLines().slice(s,l);else u=this.getLines().slice(s);r=new Kekule.IO.Mdl3kTextBuffer(u)}return t&&this.setCurrLineNo(o),r}}),Kekule.IO.Mdl3kBlockReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kBlockReader",createTextBuffer:function(){return new Kekule.IO.Mdl3kTextBuffer},doReadBlock:function(e,t){var r,i=!(e instanceof Kekule.IO.Mdl3kTextBuffer);i?(r=new Kekule.IO.Mdl3kTextBuffer).setLines(e.getUnreadLines()):r=e;var n=r.getCurrLineNo(),o=this.doRead3kBlock(r,t),a=r.getCurrLineNo();if(i){var s=a-n;e.incCurrLineNo(s)}return o},doRead3kBlock:function(e,t){}}),Kekule.IO.Mdl3kBlockWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kBlockWriter",createTextBuffer:function(){return new Kekule.IO.Mdl3kTextBuffer},writeStartTag:function(e,t){t.writeLine(Kekule.IO.Mdl3kUtils.get3kBlockStartTag(e))},writeEndTag:function(e,t){t.writeLine(Kekule.IO.Mdl3kUtils.get3kBlockEndTag(e))},doWriteBlock:function(e,t,r){var i,n=!(t instanceof Kekule.IO.Mdl3kTextBuffer);n?((i=new Kekule.IO.Mdl3kTextBuffer).setLines(t.getUnreadLines()),i.reset()):i=t;var o=this.doWrite3kBlock(e,i,r);return n&&t.appendLines(n.getLines()),o},doWrite3kBlock:function(e,t,r){}}),Kekule.IO.Mdl3kCTabReader=Class.create(Kekule.IO.Mdl3kBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kCTabReader",doRead3kBlock:function(e,t){var r=e.getBlockBuffer("CTAB");return r||(r=e).reset(),this.analysisCTab(r)},analysisCTab:function(e){var t={},r=e.readLine(),i=this.analysisCountLine(r);if(!i)return null;var n,o,a=[],s=e.getBlockBuffer("ATOM");if(!s)return Kekule.raise(Kekule.$L("ErrorMsg.MDL3000_ATOMBLOCK_NOT_FOUND")),null;n=this.analysisAtomBlock(s,a);var l,u=e.getBlockBuffer("BOND");u&&(o=this.analysisBondBlock(u,a));var d=e.getBlockBuffer("SGROUP");return d&&(l=this.analysisSGroupBlock(d,a)),t.countInfo=i,t.atomInfos=n,t.atomIndexMap=a,o&&(t.bondInfos=o),l&&(t.sgInfos=l),t},analysisCountLine:function(e){var t={},r=Kekule.IO.Mdl3kValueUtils.splitValues(e);if("COUNTS"==r.shift().value){var i=r.shift().value;return t.atomCount=parseInt(i,10),i=r.shift().value,t.bondCount=parseInt(i,10),i=r.shift().value,t.sgroupCount=parseInt(i,10),i=r.shift().value,t.isChiral=0!=parseInt(i,10),t}Kekule.raise(Kekule.$L("ErrorMsg.MALFORMED_MDL3000_COUNTLINE"))},analysisAtomBlock:function(e,t){for(var r=Kekule.CoordMode.COORD2D,i=[];!e.eof();){var n=e.readLine(),o=this.analysisAtomLine(n),a=i.push(o)-1;t[o.index]=a,o.z&&(r=Kekule.CoordMode.COORD3D)}return i.coordMode=r,i.isCoord3D=r==Kekule.CoordMode.COORD3D,i},analysisAtomLine:function(e,t){var r={},i=Kekule.IO.Mdl3kValueUtils.splitValues(e);r.index=parseInt(i.shift().value,10);var n=i.shift().value.trim();if(Kekule.IO.Mdl3kUtils.isAtomList(n)){var o=Kekule.IO.Mdl3kUtils.analysisAtomList(n);o&&(r.atomListInfo=o,r.symbol="L")}else r.symbol=n;r.x=parseFloat(i.shift().value),r.y=parseFloat(i.shift().value),r.z=parseFloat(i.shift().value),i.shift();for(var a=0,s=i.length;a<s;++a){var l=i[a],u=l.key,d=l.value;switch(u){case"CHG":(c=parseInt(d,10))&&(r.charge=c);break;case"RAD":(c=parseInt(d,10))&&(r.radical=c);break;case"CFG":(c=parseInt(d,10))&&(r.parity=c);break;case"MASS":r.massNumber=parseFloat(d);break;case"VAL":break;case"HCOUNT":(c=parseInt(d,10))&&(r.hydrongenCount=-1==c?0:c-1);break;case"RGROUPS":var c;(c=parseInt(d,10))&&(r.rgroupCount=c)}}return r},analysisBondBlock:function(e,t){for(var r=[];!e.eof();){var i=e.readLine(),n=this.analysisBondLine(i,t);r[n.index]=n}return r},analysisBondLine:function(e,t){var r={},i=Kekule.IO.Mdl3kValueUtils.splitValues(e);r.index=parseInt(i.shift().value,10);var n=i.shift().value;r.order=Kekule.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(n,10)),r.atomIndex1=t[parseInt(i.shift().value,10)],r.atomIndex2=t[parseInt(i.shift().value,10)];for(var o=0,a=i.length;o<a;++o){var s=i[o].key,l=i[o].value;switch(s){case"CFG":var u=parseInt(l,10);r.stereo=Kekule.IO.Mdl3kUtils.bondCfgToKekule(u);break;case"ENDPTS":if(Kekule.ArrayUtils.isArray(l)){r.endAtomIndexes=[];for(var d=0,c=l.length;d<c;++d)r.endAtomIndexes.push(t[parseInt(l[d],10)])}else r.endAtomIndexes=[t[parseInt(l,10)]]}}return r},analysisSGroupBlock:function(e,t){var r=[],i=null,n=e.getCurrLineNo(),o=e.readLine();for("DEFAULT"==Kekule.IO.Mdl3kValueUtils.splitValues(o).shift().value?i=this.fetchSGroupOptionalValues(o,t):e.setCurrLineNo(n);!e.eof();){o=e.readLine();var a=this.analysisSGroupLine(o,t,i);r[a.index]=a}return r},analysisSGroupLine:function(e,t,r){var i={},n=Kekule.IO.Mdl3kValueUtils.splitValues(e);i.index=parseInt(n.shift().value,10),i.sgType=n.shift().value.trim(),i.extIndex=parseInt(n.shift().value,10);var o=this.fetchSGroupOptionalValues(n,t);return r&&(o=Object.extend(r,o)),i=Object.extend(i,o)},fetchSGroupOptionalValues:function(e,t){for(var r={},i=0,n=e.length;i<n;++i){var o=e[i].key,a=e[i].value;switch(o){case"ATOMS":r.atomIndexes=[];for(var s=0,l=a.length;s<l;s++)r.atomIndexes.push(t[a[s]]);break;case"XBONDS":r.crossBondIndexes=[].concat(a);break;case"SUBTYPE":r.subType=a;break;case"LABEL":r.label=a;break;case"CSTATE":r.bondVectors||(r.bondVectors=[]);var u=parseInt(a.shift(),10),d=parseFloat(a.shift())||0,c=parseFloat(a.shift())||0,h=parseFloat(a.shift())||0;r.bondVectors[u]={bondIndex:u,x:d,y:c,z:h};break;case"CLASS":r.sgClass=a}}return r}}),Kekule.IO.Mdl3kCTabWriter=Class.create(Kekule.IO.Mdl3kBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kCTabWriter",initialize:function(e){this.tryApplySuper("initialize"),this.setCoordMode(e||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:Kekule.CoordMode.UNKNOWN})},doWrite3kBlock:function(e,t,r){return Kekule.IO.MdlUtils.assertIlegalForCtabOutput(e),this.outputCtab(e,t,r)},outputCtab:function(e,t,r){var i=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(e,r);this.writeStartTag("CTAB",t),this.getCoordMode()!=Kekule.CoordMode.UNKNOWN&&(i.coordMode=this.getCoordMode()),t.writeLine(this.generateCountLine(i)),this.outputAtomBlock(e,i,t),this.outputBondBlock(e,i,t),this.outputSgroupBlock(e,i,t),this.writeEndTag("CTAB",t)},generateCompatibilityCountLine:function(e){return Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(e,Kekule.IO.MdlVersion.V3000)},generateCountLine:function(e){var t=["COUNTS"];t.push(e.atoms.length),t.push(e.bonds.length),t.push(e.subGroups.length),t.push(0);var r=e.chiral?1:0;return t.push(r),Kekule.IO.Mdl3kValueUtils.mergeValues(t)},outputAtomBlock:function(e,t,r){this.writeStartTag("ATOM",r);for(var i=0,n=t.atoms.length;i<n;++i){var o=t.atoms[i],a=this.generateAtomLine(i,t.coordMode,o);r.writeLine(a)}this.writeEndTag("ATOM",r)},generateAtomLine:function(e,t,r){var i=Kekule.IO.Mdl3kUtils.coordToStr,n=[e+1,Kekule.IO.MdlStructureUtils.getAtomTypeStr(r)];if(t==Kekule.CoordMode.COORD2D){var o=r.getAbsCoord2D();n=n.concat([i(o.x),i(o.y),i(0)])}else{o=r.getAbsCoord3D();n=n.concat([i(o.x),i(o.y),i(o.z)])}return n.push(0),r.getCharge&&r.getCharge()&&n.push({key:"CHG",value:r.getCharge()}),r.getRadical&&r.getRadical()&&n.push({key:"RAD",value:r.getRadical()}),r.getParity&&r.getParity()&&n.push({key:"CFG",value:r.getParity()}),r.getMassNumber&&r.getMassNumber()&&n.push({key:"MASS",value:r.getMassNumber()}),r.getExplicitHydrogenCount&&!Kekule.ObjUtils.isUnset(r.getExplicitHydrogenCount())&&n.push({key:"HCOUNT",value:r.getExplicitHydrogenCount()+1}),Kekule.IO.Mdl3kValueUtils.mergeValues(n)},outputBondBlock:function(e,t,r){if(!(t.bonds.length<=0)){this.writeStartTag("BOND",r);for(var i=0,n=t.bonds.length;i<n;++i){var o=t.bonds[i],a=this.generateBondLine(i,o,t.atoms);r.writeLine(a)}this.writeEndTag("BOND",r)}},generateBondLine:function(e,t,r){var i=[e+1,Kekule.IO.MdlUtils.kekuleBondOrderToMdlType(t.getBondOrder?t.getBondOrder():Kekule.BondOrder.UNSET)],n=t.getStereo&&t.getStereo()?Kekule.IO.Mdl3kUtils.bondStereoToMdlCfg(t.getStereo(),!0):{},o=[],a=[],s=Kekule.IO.MdlStructureUtils.splitConnectedNodes(t),l=r.indexOf(s.primaryNodes[0])+1,u=r.indexOf(s.primaryNodes[1])+1;if(o=n.inverted?[u,l]:[l,u],s.remainNodes&&s.remainNodes.length)for(var d=0,c=s.remainNodes.length;d<c;++d)a.push(r.indexOf(s.remainNodes[d])+1);return i=i.concat(o),n&&n.cfg&&i.push({key:"CFG",value:n.cfg}),a.length>0&&(i.push({key:"ENDPTS",value:a}),i.push({key:"ATTACH",value:"ALL"})),Kekule.IO.Mdl3kValueUtils.mergeValues(i)},outputSgroupBlock:function(e,t,r){if(!(t.subGroups.length<=0)){this.writeStartTag("SGROUP",r);for(var i=0,n=t.subGroups.length;i<n;++i){var o=this.generateSgroupLine(i,t.subGroups[i],t);r.writeLine(o)}this.writeEndTag("SGROUP",r)}},generateSgroupLine:function(e,t,r){for(var i=r.atoms,n=r.bonds,o=[e+1,"SUP",e+1],a=[],s=0,l=(g=t.getLeafNodes()).length;s<l;++s){(e=i.indexOf(g[s]))>=0&&a.push(e+1)}a=a.sort(),o.push({key:"ATOMS",value:a});var u=t.getAbbr&&t.getAbbr()||t.getFormulaText&&t.getFormulaText()||t.getName&&t.getName();u&&o.push({key:"LABEL",value:u});var d=t.getCrossConnectors(),c=[],h=[],p=Kekule.IO.Mdl3kUtils.coordToStr;for(s=0,l=d.length;s<l;++s){if((e=n.indexOf(d[s]))>=0){c.push(e+1);var g,f=[e+1],C={};2==(g=Kekule.IO.MdlStructureUtils.splitConnectedNodes(d[s]).primaryNodes).length&&(r.coordMode==Kekule.CoordMode.COORD2D?(C=Kekule.CoordUtils.substract(g[0].getAbsCoord2D(),g[1].getAbsCoord2D()),f=f.concat([p(C.x),p(C.y),0])):(C=Kekule.CoordUtils.substract(g[0].getAbsCoord3D(),g[1].getAbsCoord3D()),f=f.concat([p(C.x),p(C.y),p(C.z)]))),h.push(f)}}c=c.sort(),o.push({key:"XBONDS",value:c});for(s=0,l=h.length;s<l;++s)o.push({key:"CSTATE",value:h[s]});return Kekule.IO.Mdl3kValueUtils.mergeValues(o)}}),Kekule.globalOptions.add("IO.mdl",{mdlVersion:Kekule.IO.MdlVersion.V2000,coordMode:Kekule.CoordMode.UNKNOWN,explicitChiralFlagInCountLine:!0}),Kekule.IO.MdlStructureFragmentReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentReader",initialize:function(e){this.tryApplySuper("initialize"),this.setCoordMode(e||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},createFragment:function(e){},createCtabReader:function(e){return e==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kCTabReader:new Kekule.IO.Mdl2kCTabReader},getCtabVersion:function(e){var t=e.getCurrLineNo(),r=e.readLine();e.setCurrLineNo(t);var i=r.substr(33,6).trim();return"V3000"==i?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000},createStructureFromJson:function(e,t){var r=this.createFragment();return r&&Kekule.IO.MdlStructureUtils.fillFragment(r,e,this.getCoordMode()),r},doReadBlock:function(e,t){var r=this.getCtabVersion(e);if(!r)return null;var i=this.createCtabReader(r).doReadBlock(e,t);return i.atomInfos.coordMode&&(this._forceCoordMode=i.atomInfos.coordMode),this.createStructureFromJson(i,t)}}),Kekule.IO.MdlStructureFragmentWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentWriter",initialize:function(e,t){this.tryApplySuper("initialize"),this.setMdlVersion(e||Kekule.IO.MdlVersion.V2000),this.setCoordMode(t||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},createCtabWriter:function(e){return e==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kCTabWriter(this.getCoordMode()):new Kekule.IO.Mdl2kCTabWriter(this.getCoordMode())},doWriteBlock:function(e,t,r){var i=this.createCtabWriter(this.getMdlVersion()).writeBlock(e,r);t.writeText(i)}}),Kekule.IO.Mdl3kMoleculeCTabReader=Class.create(Kekule.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabReader",createFragment:function(e){return new Kekule.Molecule},doReadBlock:function(e,t){var r=this.createCtabReader(Kekule.IO.MdlVersion.V3000).doReadBlock(e,t);return this.createStructureFromJson(r,t)}}),Kekule.IO.Mdl3kMoleculeCTabWriter=Class.create(Kekule.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabWriter",initialize:function(e){this.tryApplySuper("initialize",[Kekule.IO.MdlVersion.V3000,e])},doWriteBlock:function(e,t,r){var i=new Kekule.IO.Mdl3kCTabWriter(this.getCoordMode()).writeBlock(e,r);t.writeText(i)}}),Kekule.IO.MdlMoleculeReader=Class.create(Kekule.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.MdlMoleculeReader",createFragment:function(e){return new Kekule.Molecule},readHeaderInfo:function(e,t){var r={},i=e.readLine();i&&(r.name=i);var n=e.readLine(),o=this.readInfoLine(n);o&&(r=Object.extend(r,o));var a=e.readLine();return a&&(r.comment=a),r},readInfoLine:function(e){var t={};if(e.trim()){var r=e.substr(0,2).trim();r&&(t.userAbbr=r),(r=e.substr(2,8).trim())&&(t.programName=r),(r=e.substr(10,10)).trim()&&(t.date=Kekule.IO.MdlUtils.analysisMdlDateTimeStr(r,!1)),r=e.substr(20,2),t.coordMode="3D"==r?Kekule.CoordMode.COORD3D:"2D"==r?Kekule.CoordMode.COORD2D:Kekule.CoordMode.UNKNOWN}return t},doReadBlock:function(e,t){var r=this.readHeaderInfo(e,t);r&&void 0!==r.coordMode&&this.setCoordMode(r.coordMode);var i=this.tryApplySuper("doReadBlock",[e,t]);(i&&r&&(r.name&&i.setName(r.name),r.userAbbr&&i.setInfoValue("author",r.userAbbr),r.programName&&i.setInfoValue("generator",r.programName),r.date&&i.setInfoValue("date",r.date),r.comment&&i.setInfoValue("comment",r.comment)),e.eof())||"M  END"===e.getCurrLine().trim().toUpperCase()&&e.readLine();return i}}),Kekule.IO.MdlMoleculeWriter=Class.create(Kekule.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.MdlMoleculeWriter",writeHeaderInfo:function(e,t,r){t.writeLine(e.getName()||Kekule.$L("Texts.UNNAMED")||"");var i=this.generateInfoLine(e);t.writeLine(i);var n=e.getInfoValue("comment");t.writeLine(n||"")},generateInfoLine:function(e){var t="",r=e.getInfoValue("author");t+=r?r.toString().substr(0,2).rpad(2):"  ";var i=e.getInfoValue("generator");t+=i?i.toString().substr(0,8).rpad(8):Kekule.LIBNAME_CORE.rpad(8);var n=e.getInfoValue("date")||new Date;return t+=Kekule.IO.MdlUtils.generateMdlDateTimeStr(n,!1),t+=this.getCoordMode()==Kekule.CoordMode.COORD3D?"3D":"2D"},getMolecule:function(e){return Kekule.ChemStructureUtils.getTotalStructFragment(e)},doWriteBlock:function(e,t,r){var i=this.getMolecule(e);if(i){var n=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(i,r);this.setCoordMode(n.coordMode),this.writeHeaderInfo(i,t,r),this.getMdlVersion()==Kekule.IO.MdlVersion.V3000&&t.writeLine(Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(n,this.getMdlVersion())),this.tryApplySuper("doWriteBlock",[i,t,r]),this.getMdlVersion()==Kekule.IO.MdlVersion.V3000&&t.writeLine("M  END")}}}),Kekule.IO.MdlStructDataReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructDataReader",DATA_HEAD_PREFIX:Kekule.IO.MDL.SD_DATA_HEAD_PREFIX,DATA_DBFIELD_PATTERN:/\bDT(\d+)\b/,DATA_KEY_NAME_PATTERN:/\<(.+)\>/,MOL_DELIMITER:Kekule.IO.MDL.MOL_DELIMITER,doReadBlock:function(e,t){var r=new Kekule.IO.MdlMoleculeReader;try{for(var i,n,o,a=[];!e.eof();){try{o=r.doReadBlock(e,null)}catch(e){o=null}if(!o)break;for(a.push(o),i=null,n=null;!e.eof();){var s=this.analysisDataLine(e.readLine());if(s){var l=s.lineType;if("dataheader"===l)i=s.key;else if("datavalue"===l)i&&(n=s.value,o.setInfoValue(i,n));else if("moldelimiter"===l)break}}}if(a.length>1){for(var u=new Kekule.ChemObjList,d=0,c=a.length;d<c;++d)u.append(a[d]);return u}return a[0]}finally{r.finalize()}},analysisDataLine:function(e){var t,r=e.trim();return r.startsWith(this.DATA_HEAD_PREFIX)?("dataheader",(t=this.getDataHeaderKey(e))?{lineType:"dataheader",key:t}:null):r.startsWith(this.MOL_DELIMITER)?{lineType:"moldelimiter"}:r?{lineType:"datavalue",value:e}:null},getDataHeaderKey:function(e){var t=this.DATA_KEY_NAME_PATTERN.exec(e);return t&&t.length>1?t[1]:(t=this.DATA_DBFIELD_PATTERN.exec(e))&&t.length>1?t[1]:e},doReadDataBlock:function(e,t){e.readLine()}}),Kekule.IO.MdlStructDataWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructDataWriter",IGNORED_INFO_FIELDS:["generator","author","date","comment"],initialize:function(e,t){this.tryApplySuper("initialize"),this.setMdlVersion(e||Kekule.IO.MdlVersion.V2000),this.setCoordMode(t||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteBlock:function(e,t,r){var i=this.getChildMols(e),n=new Kekule.IO.MdlMoleculeWriter;n.setMdlVersion(this.getMdlVersion()),n.setCoordMode(this.getCoordMode());for(var o=0,a=i.length;o<a;++o){var s=i[o];try{var l=n.writeBlock(s,r);t.writeText(l);var u=this.getMolData(s);this.doWriteDataBlock(u,t,r),t.writeLine(Kekule.IO.MDL.MOL_DELIMITER)}catch(e){}}},doWriteDataBlock:function(e,t,r){for(var i=Kekule.ObjUtils.getOwnedFieldNames(e),n=0,o=i.length;n<o;++n){var a=i[n];if(this.IGNORED_INFO_FIELDS.indexOf(a)<0){var s=Kekule.IO.MDL.SD_DATA_HEAD_PREFIX+" <"+a+">",l=e[a];s&&l&&(t.writeLine(s),t.writeLine(l),t.writeLine(""))}}},getChildMols:function(e){for(var t=Kekule.ChemStructureUtils.getChildStructureObjs(e,!0),r=[],i=0,n=t.length;i<n;++i){var o=t[i];o instanceof Kekule.StructureFragment&&r.push(o)}return r},getMolData:function(e){return e.getInfo?e.getInfo()||{}:null}}),Kekule.IO.MdlBaseReactionReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlBaseReactionReader",readHeaderBlock:function(e,t){var r,i={},n=e.readLine().trim();return"$RXN"!=(r=n.substr(0,4))?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL_RXN_DATA")),null):(r=n.substr(4).trim(),i.version="V3000"==r?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000,(n=e.readLine().trim())&&(i.name=n),(r=(n=e.readLine()).substr(0,6).trim())&&(i.userAbbr=r),(r=n.substr(6,9).trim())&&(i.programName=r),(r=n.substr(15,10)).trim()&&(i.date=Kekule.IO.MdlUtils.analysisMdlDateTimeStr(r,!0)),(n=e.readLine().trim())&&(i.comment=n),i)},readSubstanceCountLine:function(e){},readMolBlock:function(e){},doReadBlock:function(e,t){for(var r=this.readHeaderBlock(e,null),i=this.readSubstanceCountLine(e.readLine()),n=new Kekule.Reaction,o=0;o<i.reactantCount;++o){(a=this.readMolBlock(e))&&n.appendReactant(a)}for(o=0;o<i.productCount;++o){var a;(a=this.readMolBlock(e))&&n.appendProduct(a)}return n&&r&&(r.name&&n.setName(r.name),r.userAbbr&&n.setInfoValue("author",r.userAbbr),r.programName&&n.setInfoValue("generator",r.programName),r.date&&n.setInfoValue("date",r.date),r.comment&&n.setInfoValue("comment",r.comment)),n}}),Kekule.IO.Mdl2kReactionReader=Class.create(Kekule.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl2kReactionReader",readHeaderBlock:function(e,t){var r=this.tryApplySuper("readHeaderBlock",[e,t]);return r.version!=Kekule.IO.MdlVersion.V2000?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL2000_RXN_DATA")),null):r},readSubstanceCountLine:function(e){var t={};return t.reactantCount=parseInt(e.substr(0,3),10)||0,t.productCount=parseInt(e.substr(3,3),10)||0,t},readMolBlock:function(e){for(var t=e.readLine();"$MOL"!==t&&!e.eof();)t=e.readLine();if(e.eof())return null;var r=[];for(t=e.getCurrLine();"$MOL"!==t&&!e.eof();)r.push(t),e.incCurrLineNo(),t=e.getCurrLine();return(new Kekule.IO.MdlMoleculeReader).readBlock(r,null)}}),Kekule.IO.Mdl3kReactionReader=Class.create(Kekule.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl3kReactionReader",createTextBuffer:function(){return new Kekule.IO.Mdl3kTextBuffer},readHeaderBlock:function(e,t){var r=this.tryApplySuper("readHeaderBlock",[e,t]);return r.version!=Kekule.IO.MdlVersion.V3000?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL3000_RXN_DATA")),null):r},readSubstanceCountLine:function(e){var t={},r=Kekule.IO.Mdl3kValueUtils.splitValues(e);return"COUNTS"!=r.shift().value.trim()?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL3000_RXN_COUNTLINE")),null):(t.reactantCount=parseInt(r.shift().value,10)||0,t.productCount=parseInt(r.shift().value,10)||0,t)},readMolBlock:function(e){if(e.getBlockBuffer){var t=e.getBlockBuffer("CTAB");return(new Kekule.IO.Mdl3kMoleculeCTabReader).doReadBlock(t)}return null}}),Kekule.IO.MdlReactionReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlReactionReader",doReadBlock:function(e,t){return(Kekule.IO.MdlUtils.getRxnMarkVersion(e.getCurrLine())==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kReactionReader:new Kekule.IO.Mdl2kReactionReader).readBlock(e.getUnreadLines(),t)}}),Kekule.IO.MdlReactionWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlReactionWriter",initialize:function(e,t){this.tryApplySuper("initialize"),this.setMdlVersion(e||Kekule.IO.MdlVersion.V2000),this.setCoordMode(t||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},writeHeaderBlock:function(e,t,r){var i;i="$RXN"+(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?" "+Kekule.IO.MDL.VER3000:""),t.writeLine(i),t.writeLine(e.getName()||""),i=(e.getInfoValue("author")||"").substr(0,6).rpad(6),i+=(e.getInfoValue("generator")||"").substr(0,9).rpad(9);var n=e.getInfoValue("date")||new Date;i+=Kekule.IO.MdlUtils.generateMdlDateTimeStr(n,!0),t.writeLine(i);var o=e.getInfoValue("comment")||"";t.writeLine(o)},generateSubstanceCountLine:function(e){return this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?"M  V30 COUNTS "+Kekule.IO.Mdl3kValueUtils.mergeValues([e.getReactantCount(),e.getProductCount()]):e.getReactantCount().toString().lpad(3)+e.getProductCount().toString().lpad(3)},writeMolDelimiterLine:function(e){this.getMdlVersion()==Kekule.IO.MdlVersion.V2000&&e.writeLine("$MOL")},writeMolBlock:function(e,t,r){var i=(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kMoleculeCTabWriter(this.getCoordMode()):new Kekule.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode())).writeBlock(e,r);t.writeText(i)},doWriteBlock:function(e,t,r){var i=this.getMdlVersion()==Kekule.IO.MdlVersion.V3000;this.writeHeaderBlock(e,t,r);var n=this.generateSubstanceCountLine(e);t.writeLine(n),i&&t.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockStartTag("REACTANT"));for(var o=0;o<e.getReactantCount();++o)this.writeMolDelimiterLine(t),this.writeMolBlock(e.getReactantAt(o),t,r);i&&t.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockEndTag("REACTANT")),i&&t.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockStartTag("PRODUCT"));for(o=0;o<e.getProductCount();++o)this.writeMolDelimiterLine(t),this.writeMolBlock(e.getProductAt(o),t,r);i&&(t.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockEndTag("PRODUCT")),t.writeLine("M  END"))}}),Kekule.IO.BaseMdlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.BaseMdlReader",doReadData:function(e,t,r){return t!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT")),null):this.doReadMdlData(e)},doReadMdlData:function(e){return null}}),Kekule.IO.BaseMdlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.BaseMdlWriter",initialize:function(e){this.tryApplySuper("initialize",[e]),e||(e={}),this.setMdlVersion(e.mdlVersion||Kekule.globalOptions.IO.mdl.mdlVersion),this.setCoordMode(e.coordMode||Kekule.globalOptions.IO.mdl.coordMode)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},writeData:function(e,t,r,i){var n={explicitChiralFlagInCountLine:Kekule.globalOptions.IO.mdl.explicitChiralFlagInCountLine},o=i?Object.extend(n,i):n;return this.tryApplySuper("writeData",[e,t,r,o])},doWriteData:function(e,t,r,i){var n=t||Kekule.IO.ChemDataType.TEXT;return n!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.MDL_OUTPUT_DATATYPE_NOT_TEXT")),null):this.tryApplySuper("doWriteData",[e,n,r,i])}}),Kekule.IO.MdlMolReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlMolReader",doReadMdlData:function(e){return(new Kekule.IO.MdlMoleculeReader).readBlock(e,null)}}),Kekule.IO.MdlMolWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlMolWriter",doWriteData:function(e,t,r,i){return new Kekule.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(e,i)}}),Kekule.IO.MdlSdReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlSdReader",doReadMdlData:function(e){return(new Kekule.IO.MdlStructDataReader).readBlock(e,null)}}),Kekule.IO.MdlSdWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlSdWriter",doWriteData:function(e,t,r,i){return new Kekule.IO.MdlStructDataWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(e,i)}}),Kekule.IO.MdlRxnReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlRxnReader",doReadMdlData:function(e){return(new Kekule.IO.MdlReactionReader).readBlock(e,null)}}),Kekule.IO.MdlRxnWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlRxnWriter",doWriteData:function(e,t,r,i){return new Kekule.IO.MdlReactionWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(e,i)}}),Kekule.IO.MdlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.MdlReader",doReadData:function(e,t,r){return t!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT")),null):("$RXN"==e.substr(0,4)?new Kekule.IO.MdlReactionReader:new Kekule.IO.MdlMoleculeReader).readBlock(e,null)}}),Kekule.IO.MdlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.MdlWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setMdlVersion(t.mdlVersion||Kekule.globalOptions.IO.mdl.mdlVersion),this.setCoordMode(t.coordMode||Kekule.globalOptions.IO.mdl.coordMode)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteData:function(e,t,r,i){var n;if(e instanceof Kekule.Reaction)n=new Kekule.IO.MdlRxnWriter(this.getMdlVersion(),this.getCoordMode());else{if(!(e instanceof Kekule.StructureFragment)){var o=e&&e.getClassName?e.getClassName():typeof e;return Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_OUTPUT_AS_MDL").format(o)),null}n=new Kekule.IO.MdlMolWriter(this.getMdlVersion(),this.getCoordMode())}if(n)return n.writeData(e,t,i)}}),function(){Kekule.IO.DataFormat.MOL="mol",Kekule.IO.DataFormat.RXN="rxn",Kekule.IO.DataFormat.SD="sd",Kekule.IO.DataFormat.MOL3K="mol3k",Kekule.IO.DataFormat.RXN3K="rxn3k",Kekule.IO.MimeType.MDL_MOL="chemical/x-mdl-molfile",Kekule.IO.MimeType.MDL_RXN="chemical/x-mdl-rxnfile",Kekule.IO.MimeType.MDL_SD="chemical/x-mdl-sdfile",Kekule.IO.DataFormatsManager.register("mol",Kekule.IO.MimeType.MDL_MOL,"mol",Kekule.IO.ChemDataType.TEXT,"MDL Mol 2000 format"),Kekule.IO.DataFormatsManager.register("rxn",Kekule.IO.MimeType.MDL_RXN,"rxn",Kekule.IO.ChemDataType.TEXT,"MDL Reaction 2000 format"),Kekule.IO.DataFormatsManager.register("sd",Kekule.IO.MimeType.MDL_SD,["sd","sdf"],Kekule.IO.ChemDataType.TEXT,"MDL Structure-Data format"),Kekule.IO.DataFormatsManager.register("mol3k",Kekule.IO.MimeType.MDL_MOL,"mol",Kekule.IO.ChemDataType.TEXT,"MDL Mol 3000 format"),Kekule.IO.DataFormatsManager.register("rxn3k",Kekule.IO.MimeType.MDL_RXN,"rxn",Kekule.IO.ChemDataType.TEXT,"MDL Reaction 3000 format"),Kekule.IO.ChemDataReaderManager.register("MDL-mol",Kekule.IO.MdlMolReader,["mol","mol3k"]),Kekule.IO.ChemDataReaderManager.register("MDL-rxn",Kekule.IO.MdlRxnReader,["rxn","rxn3k"]),Kekule.IO.ChemDataReaderManager.register("MDL-general",Kekule.IO.MdlReader,["mol","mol3k","rxn","rxn3k"]),Kekule.IO.ChemDataReaderManager.register("MDL-sd",Kekule.IO.MdlSdReader,"sd");var e=[Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.ChemDataWriterManager.register("MDL-mol",Kekule.IO.MdlMolWriter,e,"mol"),Kekule.IO.ChemDataWriterManager.register("MDL-mol3k",Kekule.IO.MdlMolWriter,e,"mol3k",{createOptions:{mdlVersion:Kekule.IO.MdlVersion.V3000}}),Kekule.IO.ChemDataWriterManager.register("MDL-rxn",Kekule.IO.MdlRxnWriter,[Kekule.Reaction],"rxn"),Kekule.IO.ChemDataWriterManager.register("MDL-rxn3k",Kekule.IO.MdlRxnWriter,[Kekule.Reaction],"rxn3k"),Kekule.IO.ChemDataWriterManager.register("MDL-sd",Kekule.IO.MdlSdWriter,e,"sd")}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.IO.SMILES={ATOM_BRACKET_LEFT:"[",ATOM_BRACKET_RIGHT:"]",ATOM_WILDCARD:"*",ATOM_H:"H",ORGAN_SUBSET_ATOMS:["B","C","N","O","S","P","F","Cl","Br","I"],AROMATIC_SUBSET_ATOMS:["B","C","N","O","S","P"],BOND_SINGLE:"-",BOND_DOUBLE:"=",BOND_TRIPLE:"#",BOND_QUAD:"$",BOND_AROMATIC:":",BOND_FAKE:".",RING_BOND_TWO_DIGIT_NO_PREFIX:"%",BRANCH_BRACKET_LEFT:"(",BRANCH_BRACKET_RIGHT:")",ROTATION_DIR_CLOCKWISE:"@@",ROTATION_DIR_ANTICLOCKWISE:"@",DIRECTION_BOND_SYMBOLS:["/","\\"]};var t=Kekule.IO.SMILES;Kekule.IO.SMILES.PrimaryPathMode={LONGEST:0,HEAVIEST:1,RANDOM:2},Kekule.IO.SMILES.StartingVertexMode={MANUAL:0,HEAVIEST:1,LIGHTEST:2,RANDOM:3},Kekule.IO.SmilesGenerationMode={HEAVIEST_AND_LONGEST:0,HEAVIEST:1,LIGHTEST_AND_LONGEST:2,RANDOM:3},Kekule.IO.SmilesUtils={createGraphDepthSpanningTreesEx:function(e,r,i){var n=i&&i.primaryPathMode||t.PrimaryPathMode.LONGEST,o=i&&i.startingVertexMode||t.StartingVertexMode.MANUAL;return Kekule.IO.SmilesUtils.doCreateGraphDepthSpanningTreesEx(e,r,n,o)},doCreateGraphDepthSpanningTreesEx:function(r,i,n,o){for(var a=function(e){var r={vertexes:[],edges:[],primaryPath:{vertexes:[],edges:[],length:0}},i=e;i.getData("__$visitedEx__")||(r.vertexes.push(i),i.setData("__$visitedEx__",!0));for(var o,s=i.getEdges(),l=-1,u=n===t.PrimaryPathMode.RANDOM?Math.floor(Math.random()*s.length):-1,d=0,c=s.length;d<c;++d){var h=!1,p=s[d],g=i.getNeighborOnEdge(p);if(!g.getData("__$visitedEx__")){r.vertexes.push(g),r.edges.push(p),g.setData("__$visitedEx__",!0);var f=a(g);if(r.vertexes=r.vertexes.concat(f.vertexes),r.edges=r.edges.concat(f.edges),u>=0&&d===u)h=!0;else if(n===t.PrimaryPathMode.HEAVIEST){var C=g.getData("__$weight__");C>l&&(l=C,h=!0)}else(f.primaryPath.length>r.primaryPath.length||!r.primaryPath.length)&&(h=!0);h&&(r.primaryPath.vertexes=f.primaryPath.vertexes,r.primaryPath.edges=f.primaryPath.edges,r.primaryPath.length=f.primaryPath.length,o=p)}}return o&&(r.primaryPath.edges.unshift(o),r.primaryPath.length=(r.primaryPath.length||0)+1),r.primaryPath.vertexes.unshift(i),r},s=function(e,r){return r===t.StartingVertexMode.LIGHTEST?e[0]:r===t.StartingVertexMode.RANDOM?e[Math.floor(Math.random()*e.length)]:e[e.length-1]},l=e.clone(r.getVertexes()),u=n===t.PrimaryPathMode.HEAVIEST,d=0,c=l.length;d<c;++d)l[d].setData("__$visitedEx__",!1),u&&l[d].setData("__$weight__",d);for(var h=o===t.StartingVertexMode.MANUAL?i:s(l,o),p=[];l.length;){var g;g=h&&l.indexOf(h)>=0?h:s(l,o);var f={vertexes:[],edges:[],primaryPath:{vertexes:[],edges:[],length:0}},C=a(g);f.vertexes=f.vertexes.concat(C.vertexes),f.edges=f.edges.concat(C.edges),f.primaryPath.length=(f.primaryPath.length||0)+C.primaryPath.length,f.primaryPath.vertexes=f.primaryPath.vertexes.concat(C.primaryPath.vertexes),f.primaryPath.edges=f.primaryPath.edges.concat(C.primaryPath.edges),l=e.exclude(l,C.vertexes),p.push(f)}return p}},Kekule.IO.SmilesMolWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.SmilesMolWriter",doWriteData:function(e,t,r,i){var n=this.getMolecule(e);return i&&i.generationMode===Kekule.IO.SmilesGenerationMode.RANDOM&&i.randomOutputCount>1?n?this._outputRandomSmiles(n,i.randomOutputCount,i):[]:n?this.writeStructFragment(n,i):""},_outputRandomSmiles:function(e,t,r){var i=[],n=Math.round(1.5*t),o=Object.create(r);o.generationMode=Kekule.IO.SmilesGenerationMode.RANDOM;for(var a=0;a<n;++a){var s=this.writeStructFragment(e,o);if(i.indexOf(s)<0&&(i.push(s),i.length>=t))break}return i},getMolecule:function(e){return Kekule.ChemStructureUtils.getTotalStructFragment(e)},writeStructFragment:function(r,i){if(r.hasCtab()&&!r.isEmpty()){var n=r.clone();n.standardize&&(n.clean({hangingChemConnector:!0,orphanChemNode:!1}),n.standardize({cleanStructure:!1}));var o=[],a=[];if(n.getAromaticRings)for(var s=n.getAromaticRings(),l=0,u=s.length;l<u;++l){var d=s[l];e.pushUnique(o,d.nodes),e.pushUnique(a,d.connectors)}var c=Kekule.BondType,h=Kekule.GraphAdaptUtils.ctabToGraph(n.getCtab(),null,{expandSubStructures:!0,ignoreBondedHydrogen:!0,bondTypes:[c.COVALENT,c.UNKNOWN]}),p=h.getVertexes(),g=(h.getEdges(),p[p.length-1]),f=Kekule.IO.SmilesGenerationMode,C=i&&i.generationMode,m={primaryPathMode:C===f.HEAVIEST?t.PrimaryPathMode.HEAVIEST:C===f.RANDOM?t.PrimaryPathMode.RANDOM:t.PrimaryPathMode.LONGEST,startingVertexMode:C===f.RANDOM?t.StartingVertexMode.RANDOM:C===f.LIGHTEST_AND_LONGEST?t.StartingVertexMode.LIGHTEST:t.StartingVertexMode.HEAVIEST},T=Kekule.IO.SmilesUtils.createGraphDepthSpanningTreesEx(h,g,m),E=this._prepareStereoBondsInformation(n.getCtab(),i),_=[],S="";for(l=0,u=T.length;l<u;++l){var O,y=T[l],A=y.primaryPath,I=A.vertexes[0];O=this._writeMolVertex(I,null,A.edges,y.edges,_,o,a,{bondStereoDirMap:E},i),0===l?S=O:S+=t.BOND_FAKE+O}return S}return""},_prepareStereoBondsInformation:function(e,t){var r=t.ignoreStereoBond;if(Kekule.ObjUtils.isUnset(r)&&(r=t.ignoreStereo||!1),r)return null;for(var i=0,n=new Kekule.MapEx,o=0,a=e.getConnectorCount();o<a;++o){var s=e.getConnectorAt(o);if(s.getParity&&s.getParity()){++i;for(var l=Kekule.MolStereoUtils.getStereoBondKeyNeighborConnectors(s),u=this._getStereoDoubleBondInitialDirectionSymbols(s),d=[],c=0,h=0,p=l.length;h<p;++h)n.has(l[h])&&(d[h]=!0,u[h]!==n.get(l[h])&&++c);if(c<2)for(h=0,p=l.length;h<p;++h)if(!d[h]){var g=1===c?this._getInvertBondDirectionSymbol(u[h]):u[h];n.set(l[h],g)}}}return i?n:null},_writeMolVertex:function(e,r,i,n,o,a,s,l,u){var d,c,h=e.getData("object"),p=e.getEdges(),g=[],f=[],C=[],m=[],T=u.ignoreStereoBond;Kekule.ObjUtils.isUnset(T)&&(T=u.ignoreStereo||!1);for(var E=p.length-1;E>=0;--E){var _=p[E];if(_!==r){var S=_.getData("object");if(n.indexOf(_)>=0){var O=e.getNeighborOnEdge(_),y=this._writeMolVertex(O,_,i,n,o,a,s,l,u);i.indexOf(_)>=0?(c=O,d=y):(f.push(O),g.push(y))}else{var A=o.indexOf(_);A<0&&(A=o.length,o.push(_)),m.push(e.getNeighborOnEdge(_));var I=this._outputConnectorStr(S,_.getVertexes()[0].getData("object"),_.getVertexes()[1].getData("object"),a,s,l.bondStereoDirMap);I+=(A+=1)<10?A:t.RING_BOND_TWO_DIGIT_NO_PREFIX+A,C.push(I)}}}var k,b="";if(r){"",k=e.getNeighborOnEdge(r).getData("object");var v=r.getData("object");b+=this._outputConnectorStr(v,r.getVertexes()[0].getData("object"),r.getVertexes()[1].getData("object"),a,s,l.bondStereoDirMap)}for(var R=[],D=(E=0,m.length);E<D;++E)R.push(m[E].getData("object"));for(E=0,D=f.length;E<D;++E)R.push(f[E].getData("object"));c&&R.push(c.getData("object")),b+=this._outputNodeStr(h,a.indexOf(h)>=0,k,R,u);for(E=0,D=C.length;E<D;++E)b+=C[E];!d&&g.length&&(d=g.shift());for(E=0,D=g.length;E<D;++E)b+=t.BRANCH_BRACKET_LEFT+g[E]+t.BRANCH_BRACKET_RIGHT;return b+="",d&&(b+=d),b},_outputNodeStr:function(e,r,i,n,o){var a,s;e instanceof Kekule.Atom?(a=s=e.getSymbol(),r&&(a=a.toLowerCase())):a=t.ATOM_WILDCARD;var l,u=o.ignoreStereoAtom;if(Kekule.ObjUtils.isUnset(u)&&(u=o.ignoreStereo||!1),!u&&e.getParity&&e.getParity()&&n&&n.length){var d=e.getLinkedHydrogenAtomsWithSingleBond();d&&1===d.length&&n.indexOf(d[0])<0&&n.push(d[0]);var c=e.getHydrogenCount&&e.getHydrogenCount(!1)||0;if(d.length&&c)l="";else{var h=Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirection(null,e,i,n,!!c,!1,{allowExplicitHydrogen:!0,allowExplicitVerticalHydrogen:!0});l=h===Kekule.RotationDir.CLOCKWISE?t.ROTATION_DIR_CLOCKWISE:h===Kekule.RotationDir.ANTICLOCKWISE?t.ROTATION_DIR_ANTICLOCKWISE:""}l&&(a+=l)}var p=this._getNodeHydrogenCount(e,o),g=!0,f=e.getRadical?Math.round(e.getRadical()||0):0;if(l);else if(f);else if(e instanceof Kekule.Atom)if(p&&r&&"C"!==s);else if((o.ignoreExplicitHydrogens||o.ignoreImplicitHydrogens)&&p!==this._getNodeHydrogenCount(e,{}));else{var C=e.getValence&&e.getValence()||0,m=Kekule.ValenceUtils.getMaxPossibleValence(e.getAtomicNumber(),e.getCharge())||0;if(C)if(C>m&&p);else if(e.hasExplicitHydrogens())(e.getExplicitHydrogenCount()||0)===(e.getImplicitHydrogenCount()||0)&&(g=!1);else(e.getValence&&e.getValence({ignoreExplicitHydrogens:!0,ignoreBondHydrogens:!0})||0)<C||(g=!1)}g&&((c=Math.round(p))>0&&(a+=t.ATOM_H),c>1&&(a+=c));var T=Math.round(e.getCharge());if(T){var E=T>0?"+":"-";(T>1||T<-1)&&(E=Math.abs(T)+E),a+=E}var _=e.getMassNumber?e.getMassNumber():null;_&&(a=Math.abs(_)+a);var S=!1;return g||T||_||l||f||(!r&&t.ORGAN_SUBSET_ATOMS.indexOf(s)>=0||r&&t.AROMATIC_SUBSET_ATOMS.indexOf(s)>=0)&&(S=!0),S||(a=t.ATOM_BRACKET_LEFT+a+t.ATOM_BRACKET_RIGHT),a},_getNodeHydrogenCount:function(e,t){var r=e.getLinkedHydrogenAtomsWithSingleBondCount&&e.getLinkedHydrogenAtomsWithSingleBondCount(!0)||0,i=e.getExplicitHydrogenCount&&e.getExplicitHydrogenCount();(t.ignoreExplicitHydrogens||(r+=i||0),Kekule.ObjUtils.isUnset(i)&&!t.ignoreImplicitHydrogens)&&(r+=e.getImplicitHydrogenCount&&e.getImplicitHydrogenCount()||0);return r},_outputConnectorStr:function(e,r,i,n,o,a){if(e instanceof Kekule.Bond){if(e.getBondType()===Kekule.BondType.COVALENT){if(o.indexOf(e)>=0)return"";var s=n.indexOf(r)>=0&&n.indexOf(i)>=0,l=e.getBondOrder(),u=Kekule.BondOrder,d=l===u.DOUBLE?t.BOND_DOUBLE:l===u.TRIPLE?t.BOND_TRIPLE:l===u.QUAD?t.BOND_QUAD:s?t.BOND_SINGLE:"";return a&&a.has(e)&&(d+=a.get(e)),d}return""}return t.BOND_FAKE},_getStereoDoubleBondInitialDirectionSymbols:function(e){var r=e.getParity();return r?r===Kekule.StereoParity.EVEN?[t.DIRECTION_BOND_SYMBOLS[0],t.DIRECTION_BOND_SYMBOLS[0]]:[t.DIRECTION_BOND_SYMBOLS[0],t.DIRECTION_BOND_SYMBOLS[1]]:["",""]},_getInvertBondDirectionSymbol:function(e){return e===t.DIRECTION_BOND_SYMBOLS[1]?t.DIRECTION_BOND_SYMBOLS[0]:t.DIRECTION_BOND_SYMBOLS[1]}}),Kekule.IO.MimeType.SMILES="chemical/x-daylight-smiles",Kekule.IO.DataFormat.SMILES="smi";Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.SMILES,Kekule.IO.MimeType.SMILES,["smi","smiles"],Kekule.IO.ChemDataType.TEXT,"SMILES format");var r=[Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.ChemDataWriterManager.register("SMILES",Kekule.IO.SmilesMolWriter,r,[Kekule.IO.DataFormat.SMILES])}(),Kekule.globalOptions.add("IO.kekuleNative",{prettyPrint:!0}),Kekule.IO.KcjReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcjReader",readData:function(e,t){var r,i=t||Kekule.IO.ChemDataType.TEXT;return i==Kekule.IO.ChemDataType.JSON&&(r=e),i!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT")),null):(r=DataType.JsonUtility.parse(e),this.tryApplySuper("readData",[r,Kekule.IO.ChemDataType.JSON]))},doReadData:function(e,t){var r=Class.ObjSerializerFactory.getSerializer("json");return r?r.load(null,e):(Kekule.error(Kekule.$L("ErrorMsg.JSON_SERIALIZER_NOT_EXISTS")),null)}}),Kekule.IO.KcjWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcjWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(t.prettyPrint)?Kekule.globalOptions.IO.kekuleNative.prettyPrint:t.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0})},writeData:function(e,t,r,i){var n=t||Kekule.IO.ChemDataType.TEXT;if(n!=Kekule.IO.ChemDataType.JSON&&n!=Kekule.IO.ChemDataType.TEXT)return Kekule.error(Kekule.$L("ErrorMsg.KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT")),null;var o=this.tryApplySuper("writeData",[e,Kekule.IO.ChemDataType.JSON]);if(n==Kekule.IO.ChemDataType.JSON)return o;if(n==Kekule.IO.ChemDataType.TEXT){var a=i&&Kekule.ObjUtils.notUnset(i.prettyPrint)?i.prettyPrint:this.getPrettyPrint();return DataType.JsonUtility.serializeToStr(o,{prettyPrint:a})}},doWriteData:function(e,t,r,i){var n=Class.ObjSerializerFactory.getSerializer("json");if(!n)return Kekule.error(Kekule.$L("ErrorMsg.JSON_SERIALIZER_NOT_EXISTS")),null;var o={};return n.save(e,o),o}}),Kekule.IO.KcxReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcxReader",readData:function(e,t){var r,i=t||Kekule.IO.ChemDataType.TEXT;return i==Kekule.IO.ChemDataType.DOM&&(r=e),i!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT")),null):(r=DataType.XmlUtility.parse(e).documentElement,this.tryApplySuper("readData",[r,Kekule.IO.ChemDataType.DOM]))},doReadData:function(e,t){var r=Class.ObjSerializerFactory.getSerializer("xml");return r?r.load(null,e):(Kekule.error(Kekule.$L("ErrorMsg.XML_SERIALIZER_NOT_EXISTS")),null)}}),Kekule.IO.KcxWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcxWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(t.prettyPrint)?Kekule.globalOptions.IO.kekuleNative.prettyPrint:t.prettyPrint),this.setRootTag(t.rootTag||"kcx")},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0}),this.defineProp("rootTag",{dataType:DataType.STRING})},writeData:function(e,t){var r=t||Kekule.IO.ChemDataType.TEXT;if(r!=Kekule.IO.ChemDataType.DOM&&r!=Kekule.IO.ChemDataType.TEXT)return Kekule.error(Kekule.$L("ErrorMsg.KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT")),null;var i=this.tryApplySuper("writeData",[e,Kekule.IO.ChemDataType.DOM]);if(r==Kekule.IO.ChemDataType.DOM)return i;if(r==Kekule.IO.ChemDataType.TEXT){var n={prettyPrint:this.getPrettyPrint()};return DataType.XmlUtility.serializeNode(i,n)}},doWriteData:function(e,t){var r=Class.ObjSerializerFactory.getSerializer("xml");if(!r)return Kekule.error(Kekule.$L("ErrorMsg.XML_SERIALIZER_NOT_EXISTS")),null;var i=DataType.XmlUtility.newDocument(this.getRootTag());return r.save(e,i.documentElement),i.documentElement}}),function(){Kekule.IO.MimeType.KEKULE_JSON="chemical/x-kekule-json",Kekule.IO.MimeType.KEKULE_XML="chemical/x-kekule-xml",Kekule.IO.DataFormat.KEKULE_JSON="Kekule-JSON",Kekule.IO.DataFormat.KEKULE_XML="Kekule-XML",Kekule.IO.DataFormatsManager.register("JSON",Kekule.IO.MimeType.JSON,"json",Kekule.IO.ChemDataType.TEXT,"JSON format"),Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.KEKULE_JSON,Kekule.IO.MimeType.KEKULE_JSON,"kcj",Kekule.IO.ChemDataType.TEXT,"Kekule Chemical JSON format"),Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.KEKULE_XML,Kekule.IO.MimeType.KEKULE_XML,"kcx",Kekule.IO.ChemDataType.TEXT,"Kekule Chemical XML format");var e=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.JSON),t=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.KEKULE_JSON),r=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.KEKULE_XML);Kekule.IO.ChemDataReaderManager.register("json",Kekule.IO.KcjReader,e),Kekule.IO.ChemDataReaderManager.register("kcj",Kekule.IO.KcjReader,t),Kekule.IO.ChemDataReaderManager.register("kcx",Kekule.IO.KcxReader,r),Kekule.IO.ChemDataWriterManager.register("kcj",Kekule.IO.KcjWriter,[Kekule.ChemObject],t,{createOptions:{prettyPrint:!1}}),Kekule.IO.ChemDataWriterManager.register("kcx",Kekule.IO.KcxWriter,[Kekule.ChemObject],r,{createOptions:{prettyPrint:!0}})}(),function(){var e=Kekule,t=Kekule.ChemStructureNodeLabels,r=Kekule.CoordMode;ClassEx.extend(Kekule.ChemObject,{getDefCoordPos:function(e){return Kekule.Render.CoordPos.CENTER},getCoordPos:function(e){var t=e===Kekule.CoordMode.COORD3D?this.getPropStoreFieldValue("coordPos3D"):this.getPropStoreFieldValue("coordPos2D");return Kekule.ObjUtils.isUnset(t)&&(t=this.getDefCoordPos(e)),t},getOverrideRenderOptions:function(e){if(e&&e.length){for(var t={},r=0,i=e.length;r<i;++r)t=Object.extend(t,e[r]);return t}return null},_appendOverrideRenderOptionItem:function(e,t){var r=this.getPropStoreFieldValue(t);r||(r=[],this.setPropStoreFieldValue(t,r));var i=r.indexOf(e);return i>=0&&r.splice(i,1),r.push(e),this.notifyPropSet(t,r),this},_deleteOverrideRenderOptionItem:function(e,t){var r=this.getPropStoreFieldValue(t);if(r){var i=r.indexOf(e);return i>=0&&(r.splice(i,1),this.notifyPropSet(t,r)),this}},addOverrideRenderOptionItem:function(e){return this._appendOverrideRenderOptionItem(e,"overrideRenderOptionItems")},addOverrideRender3DOptionItem:function(e){return this._appendOverrideRenderOptionItem(e,"overrideRender3DOptionItems")},removeOverrideRenderOptionItem:function(e){return this._deleteOverrideRenderOptionItem(e,"overrideRenderOptionItems")},removeOverrideRender3DOptionItem:function(e){return this._deleteOverrideRenderOptionItem(e,"overrideRender3DOptionItems")},getOverriddenRenderOptions:function(){var e=this.getRenderOptions()||{},t=this.getOverrideRenderOptions(this.getOverrideRenderOptionItems());return t&&(e=Object.extend(e,t)),e},getOverriddenRender3DOptions:function(){var e=Object.create(this.getRender3DOptions()||null),t=this.getOverrideRenderOptions(this.getOverrideRender3DOptionItems());return t&&(e=Object.extend(e,t)),e},setRenderOption:function(e,t){var r;(r=this.getRenderOptions())||this.setRenderOptions({}),(r=this.getRenderOptions())[e]!==t&&(r[e]=t,this.notifyPropSet("renderOptions",r))},setRender3DOption:function(e,t){var r;(r=this.getRender3DOptions())||this.setRender3DOptions({}),(r=this.getRender3DOptions())[e]!==t&&(r[e]=t,this.notifyPropSet("render3DOptions",r))},getRenderOption:function(e){var t=this.getOverriddenRenderOptions();return t?t[e]:void 0},getRender3DOption:function(e){var t=this.getOverriddenRender3DOptions();return t?t[e]:void 0},getCascadedRenderOption:function(e){var t=this.getOverriddenRenderOptions(),r=t?t[e]:void 0;if(Kekule.ObjUtils.isUnset(r)){var i=this.getParent?this.getParent():null;r=i&&i.getCascadedRenderOption?i.getCascadedRenderOption(e):void 0}return r},getCascadedRender3DOption:function(e){var t=this.getOverriddenRender3DOptions(),r=t?t[e]:void 0;if(Kekule.ObjUtils.isUnset(r)){var i=this.getParent?this.getParent():null;r=i&&i.getCascadedRender3DOption?i.getCascadedRender3DOption(e):void 0}return r},getBaseCoord:function(e,t){var i=this.getCoordPos(e),n=this.getCoordOfMode?this.getCoordOfMode(e,t):null;if(n&&i!==Kekule.Render.CoordPos.CENTER&&i===Kekule.Render.CoordPos.CORNER_TL){var o=this.getExposedContainerBox(e,t),a={x:(o.x2-o.x1)/2,y:(o.y2-o.y1)/2};e===r.COORD3D&&(a.z=(o.z2-o.z1)/2),e===r.COORD3D?n=Kekule.CoordUtils.add(n,a):(n.x+=a.x,n.y-=a.y)}return n},getBaseCoord2D:function(e){return this.getBaseCoord(Kekule.CoordMode.COORD2D,e)},getBaseCoord3D:function(e){return this.getBaseCoord(Kekule.CoordMode.COORD3D,e)},getAbsBaseCoord:function(e,t){var i=this.getCoordPos(e),n=this.getAbsCoordOfMode?this.getAbsCoordOfMode(e,t):null;if(n&&i!==Kekule.Render.CoordPos.CENTER&&i===Kekule.Render.CoordPos.CORNER_TL){var o=this.getExposedContainerBox(e,t),a={x:(o.x2-o.x1)/2,y:(o.y2-o.y1)/2};e===r.COORD3D&&(a.z=(o.z2-o.z1)/2),e===r.COORD3D?n=Kekule.CoordUtils.add(n,a):(n.x+=a.x,n.y-=a.y)}return n},getAbsBaseCoord2D:function(e){return this.getAbsBaseCoord(Kekule.CoordMode.COORD2D,e)},getAbsBaseCoord3D:function(e){return this.getAbsBaseCoord(Kekule.CoordMode.COORD3D,e)},setAbsBaseCoord:function(e,t,i){var n=this.getCoordPos(t),o=Kekule.CoordUtils.clone(e);if(e&&n!==Kekule.Render.CoordPos.CENTER&&n===Kekule.Render.CoordPos.CORNER_TL){var a=this.getExposedContainerBox(t,i),s={x:(a.x2-a.x1)/2,y:(a.y2-a.y1)/2};t===r.COORD3D&&(s.z=(a.z2-a.z1)/2),t===r.COORD3D?o=Kekule.CoordUtils.substract(o,s):(o.x-=s.x,o.y+=s.y)}return this.setAbsCoordOfMode?this.setAbsCoordOfMode(o,t):this.setCoordOfMode&&this.setCoordOfMode(o,t),this},setAbsBaseCoord2D:function(e,t){return this.setAbsCoordOfMode(e,Kekule.CoordMode.COORD2D,t)},setAbsBaseCoord3D:function(e,t){return this.setAbsCoordOfMode(e,Kekule.CoordMode.COORD3D,t)},getExposedAncestor:function(){var e=this.getParent();return e?e.isExpanded()?this:e.getExposedAncestor():this},isExposed:function(){var e=this.getParent();return!e||e.isExpanded()},isExpanded:function(){return!0},setExpanded:function(e){},getLinkedExposedObjs:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var i=this.getLinkedConnectorAt(t);if(i.isExposed())for(var n=i.getConnectedExposedObjs(),o=0,a=n.length;o<a;++o)n[o]!==this&&Kekule.ArrayUtils.pushUnique(e,n[o])}return e},getExposedContainerBox:function(e,t){return this.getContainerBox(e,t)},getAllAutoScaleRefLengths:function(e,t){return[]},getAllContainingConnectors:function(){return this.getAllChildConnectors?this.getAllChildConnectors():[]},getConnectorLengthMedian:function(e,t){var r=this.getAllContainingConnectors();return Kekule.ChemStructureUtils.getConnectorLengthMedian(r,e,t)}}),ClassEx.defineProps(Kekule.ChemObject,[{name:"coordPos2D",dataType:DataType.INT,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getCoordPos(Kekule.CoordMode.COORD2D)}},{name:"coordPos3D",dataType:DataType.INT,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getCoordPos(Kekule.CoordMode.COORD3D)}},{name:"renderOptions",dataType:DataType.OBJECT},{name:"render3DOptions",dataType:DataType.OBJECT},{name:"overrideRenderOptionItems",dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1},{name:"overrideRender3DOptionItems",dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1},{name:"hidden",dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE},{name:"visible",dataType:DataType.BOOL,serializable:!1,getter:function(){return!this.getHidden()},setter:function(e){e?this.setHidden(void 0):this.setHidden(!0)}}]),ClassEx.extend(Kekule.ChemObjList,{getAllContainingConnectors:function(){for(var e=[],t=0,r=this.getItemCount();t<r;++t){var i=this.getItemAt(t);i.getAllContainingConnectors&&(e=e.concat(i.getAllContainingConnectors()))}return e},getAllAutoScaleRefLengths:function(e,t){for(var r=[],i=0,n=this.getItemCount();i<n;++i){var o=this.getItemAt(i);o.getAllAutoScaleRefLengths&&(r=r.concat(o.getAllAutoScaleRefLengths(e,t)))}return r},getExposedContainerBox:function(e,t){for(var r,i=this.toArray(),n=0,o=i.length;n<o;++n){var a=i[n];if(a.isExposed()){var s=a.getExposedContainerBox?a.getExposedContainerBox(e,t):a.getContainerBox?a.getContainerBox(e,t):null;s&&(r=r?Kekule.BoxUtils.getContainerBox(r,s):Kekule.BoxUtils.clone(s))}}return r}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ChemObjList),ClassEx.extend(Kekule.ChemSpaceElement,{getAllContainingConnectors:function(){return this.getChildren().getAllContainingConnectors()},getAllAutoScaleRefLengths:function(e,t){return this.getChildren().getAllAutoScaleRefLengths(e,t)}}),ClassEx.extend(Kekule.ChemSpace,{getAllContainingConnectors:function(){return this.getRoot().getAllContainingConnectors()},getAllAutoScaleRefLengths:function(e,t){return this.getDefAutoScaleRefLength()?[this.getDefAutoScaleRefLength()]:this.getRoot().getAllAutoScaleRefLengths(e,t)}}),ClassEx.defineProps(Kekule.ChemObject,[{name:"defAutoScaleRefLength",dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC}]),ClassEx.extend(Kekule.BaseStructureConnector,{getBaseCoord:function(e,t){for(var r=null,i=0,n=e===Kekule.CoordMode.COORD2D?{x:0,y:0}:{x:0,y:0,z:0},o=0,a=this.getConnectedObjCount();o<a;++o){var s=this.getConnectedObjAt(o),l=s.getBaseCoord?s.getBaseCoord(e,t):null;l&&(n=Kekule.CoordUtils.add(n,l),++i)}return i&&(r=Kekule.CoordUtils.divide(n,i)),r},getAbsBaseCoord:function(e,t){for(var r=null,i=0,n=e===Kekule.CoordMode.COORD2D?{x:0,y:0}:{x:0,y:0,z:0},o=0,a=this.getConnectedObjCount();o<a;++o){var s=this.getConnectedObjAt(o),l=s.getAbsBaseCoord?s.getAbsBaseCoord(e,t):null;l&&(n=Kekule.CoordUtils.add(n,l),++i)}return i&&(r=Kekule.CoordUtils.divide(n,i)),r},getAbsCoordOfMode:function(e,t){return this.getAbsBaseCoord(e,t)},getConnectedExposedObjs:function(){for(var e=this.getConnectedObjs(),t=[],r=0,i=e.length;r<i;++r){var n=e[r].getExposedAncestor();t.indexOf(n)<0&&t.push(n)}return t},getLength:function(e,t){var r=this.getConnectedObjs();if(2!==r.length)return null;var i=r[0].getAbsBaseCoord?r[0].getAbsBaseCoord(e,t):null,n=r[1].getAbsBaseCoord?r[1].getAbsBaseCoord(e,t):null;return Kekule.CoordUtils.getDistance(i,n)},getLength2D:function(e){return this.getLength(Kekule.CoordMode.COORD2D,e)},getLength3D:function(e){return this.getLength(Kekule.CoordMode.COORD3D,e)}}),ClassEx.defineProps(Kekule.BaseStructureConnector,[{name:"absCoord2D",dataType:DataType.HASH,serializable:!1,getter:function(e){return this.getAbsBaseCoord(Kekule.CoordMode.COORD2D,e)}},{name:"absCoord3D",dataType:DataType.HASH,serializable:!1,getter:function(e){return this.getAbsBaseCoord(Kekule.CoordMode.COORD3D,e)}}]),ClassEx.extend(Kekule.ChemStructureConnector,{getAllAutoScaleRefLengths:function(e,t){return[this.getLength(e,t)]}}),ClassEx.extend(Kekule.BaseStructureNode,{getBaseCoord:function(e,t){return this.getCoordOfMode(e,t)},getAbsBaseCoord:function(e,t){return this.getAbsCoordOfMode(e,t)},getExposedContainerBox:function(e,t){return this.getContainerBox(e,t)},getExposedContainerBox2D:function(e){var t=this.getExposedContainerBox(Kekule.CoordMode.COORD2D,e);return t.width=t.x2-t.x1,t.height=t.y2-t.y1,t},getExposedContainerBox3D:function(e){var t=this.getExposedContainerBox(Kekule.CoordMode.COORD3D,e);return t.deltaX=t.x2-t.x1,t.deltaY=t.y2-t.y1,t.deltaZ=t.z2-t.z1,t}}),ClassEx.extend(Kekule.ChemStructureNode,{getDisplayRichText:function(e,t,r,i,n,o){var a=Kekule.Render;Kekule.ObjUtils.isUnset(t)&&(t=!0);var s,l=a.RichTextUtils.create(),u=this.getRenderOption("customLabel");return(s=u?a.RichTextUtils.strToRichText(u):this.getCoreDisplayRichTextItem(e,t,r,i))&&(t&&(s=this.appendElectronStateDisplayText(s,i,n,o,r.getElectronicBiasMark())),s&&(a.RichTextUtils.append(l,s),l.anchorItem=s)),l},getCoreDisplayRichTextItem:function(e,t,r,i){return null},appendElectronStateDisplayText:function(e,t,r,i,n){var o=Kekule.Render,a=this.getCharge(),s=this.getElectronicBias&&this.getElectronicBias(),l=this.getRadical(),u=o.ChemDisplayTextUtils.createElectronStateDisplayTextSection(a,l,t,r,i,s,n);if(u){var d=o.RichTextUtils.createGroup();return o.RichTextUtils.append(d,e),o.RichTextUtils.append(d,u),d.charDirection=Kekule.Render.TextDirection.LTR,d.anchorItem=e,d}return e}}),ClassEx.extend(Kekule.AbstractAtom,{getDisplayRichText:function(e,t,r,i,n,o){var a=Kekule.Render;Kekule.ObjUtils.isUnset(e)&&(e=a.HydrogenDisplayLevel.DEFAULT);var s=this.tryApplySuper("getDisplayRichText",[e,t,r,i,n,o]),l=0;switch(e){case a.HydrogenDisplayLevel.NONE:l=0;break;case a.HydrogenDisplayLevel.ALL:l=this.getHydrogenCount();break;case a.HydrogenDisplayLevel.EXPLICIT:l=this.getExplicitHydrogenCount();break;case a.HydrogenDisplayLevel.UNMATCHED_EXPLICIT:this.getImplicitHydrogenCount&&this.getImplicitHydrogenCount()!==this.getExplicitHydrogenCount()&&(l=this.getExplicitHydrogenCount())}return l&&(s=this.appendHydrogenDisplayText(s,l)),s},appendHydrogenDisplayText:function(e,t){var r=Kekule.Render;if(t)if(t>1){var i=r.RichTextUtils.createGroup();i.charDirection=Kekule.Render.TextDirection.LTR;var n=r.RichTextUtils.appendText2(i,"H");r.RichTextUtils.appendText(i,t.toString(),{textType:r.RichText.SUB,refItem:n}),r.RichTextUtils.append(e,i)}else r.RichTextUtils.appendText(e,"H");return e}}),ClassEx.extend(Kekule.Atom,{getCoreDisplayRichTextItem:function(r,i,n,o){var a,s=Kekule.Render,l=s.RichTextUtils.createGroup(),u=this.getIsotopeAlias();this.getSymbol();u||this.getSymbol()!==e.Element.UNSET_ELEMENT?u&&Kekule.ChemStructureNodeLabels.ENABLE_ISOTOPE_ALIAS?(a=s.RichTextUtils.createSection(this.getIsotopeAlias(),{charDirection:Kekule.Render.TextDirection.LTR}),(l=s.RichTextUtils.append(l,a)).anchorItem=a):(a=s.RichTextUtils.createSection(this.getSymbol(),{charDirection:Kekule.Render.TextDirection.LTR}),(l=s.RichTextUtils.append(l,a)).anchorItem=a,this.getMassNumber()!==Kekule.Isotope.UNSET_MASSNUMBER&&((l=s.RichTextUtils.insertText(l,0,this.getMassNumber().toString(),{textType:s.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR,refItem:l.anchorItem})).charDirection=Kekule.Render.TextDirection.LTR)):l=s.RichTextUtils.appendText(l,n&&n.getUnsetElement()||t.UNSET_ELEMENT);return l}}),ClassEx.extend(Kekule.Pseudoatom,{getCoreDisplayRichTextItem:function(e,r,i,n){var o,a=Kekule.Render,s=i;return(o=this.getLabel())||(o=s&&s.getUnsetElement()||t.UNSET_ELEMENT),a.RichTextUtils.createSection(o,{charDirection:Kekule.Render.TextDirection.LTR})}});var i=function(e,t,r){var i,n=Kekule.Render,o=Kekule.IsotopesDataUtil.getIsotopeIdDetail(t);o.massNumber&&(i=n.RichTextUtils.appendText2(e,o.massNumber.toString(),{textType:Kekule.Render.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR}));var a=n.RichTextUtils.appendText2(e,o.symbol,{charDirection:Kekule.Render.TextDirection.LTR},r);return i&&(i.refItem=a),e.charDirection=Kekule.Render.TextDirection.LTR,e};ClassEx.extend(Kekule.VariableAtom,{getCoreDisplayRichTextItem:function(e,r,n,o){var a,s=Kekule.Render,l=n;if(this.isListEmpty())return(a=s.RichTextUtils.strToRichText(l&&l.getVariableAtom()||t.VARIABLE_ATOM)).charDirection=Kekule.Render.TextDirection.LTR,a;var u=this.getAllowedIsotopeIds()||this.getDisallowedIsotopeIds(),d=this.isDisallowedList();if((a=s.RichTextUtils.createGroup()).charDirection=Kekule.Render.TextDirection.LTR,d&&(a=s.RichTextUtils.appendText(a,l.getIsoListDisallowPrefix())),a=s.RichTextUtils.appendText(a,l.getIsoListLeadingBracket()),u&&u.length)for(var c=0,h=u.length;c<h;++c){var p=u[c];p&&(0!=c&&(a=s.RichTextUtils.appendText(a,l.getIsoListDelimiter())),a=i(a,p,0==c))}return a=s.RichTextUtils.appendText(a,l.getIsoListTailingBracket())}}),ClassEx.extend(Kekule.StructureConnectionTable,{exposedNodesHasCoord2D:function(e){for(var t=this.getExposedNodes(),r=0,i=t.length;r<i;++r)if(t[r].hasCoord2D(e))return!0;return!1},exposedNodesHasCoord3D:function(e){for(var t=this.getExposedNodes(),r=0,i=t.length;r<i;++r)if(t[r].hasCoord3D(e))return!0;return!1},getExposedNodes:function(){for(var e=[],t=this.getNodes(),r=0,i=t.length;r<i;++r){var n=t[r];if(n.getExposedNodes&&n.isExpanded()){var o=n.getExposedNodes();e=e.concat(o)}else n.isExposed()&&e.push(n)}return e},getExposedConnectors:function(){for(var e=this.getConnectors(),t=this.getNodes(),r=0,i=t.length;r<i;++r){var n=t[r];if(n.getConnectors&&n.isExpanded()){var o=n.getExposedConnectors();e=e.concat(o)}}return e},getExposedContainerBox:function(e,t){var r=this.getExposedNodes();return r.length?this.getNodesContainBox(r,e,t):null},getExposedContainerBox2D:function(e){var t=this.getExposedContainerBox(Kekule.CoordMode.COORD2D,e);return t.width=t.x2-t.x1,t.height=t.y2-t.y1,t},getExposedContainerBox3D:function(e){var t=this.getExposedContainerBox(Kekule.CoordMode.COORD3D,e);return t.deltaX=t.x2-t.x1,t.deltaY=t.y2-t.y1,t.deltaZ=t.z2-t.z1,t},getConnectorLengthMedian:function(e,t){var r=this.getAllContainingConnectors();return Kekule.ChemStructureUtils.getConnectorLengthMedian(r,e,t)},getAllAutoScaleRefLengths:function(e,t){for(var r=this.getAllContainingConnectors(),i=[],n=0,o=r.length;n<o;++n){var a=r[n];if(a&&a.getAllAutoScaleRefLengths){var s=a.getAllAutoScaleRefLengths(e,t);s&&(i=i.concat(s))}}return i}}),ClassEx.extend(Kekule.ContentBlock,{getDefCoordPos:function(e){return e!==r.COORD3D?Kekule.Render.CoordPos.CORNER_TL:this.tryApplySuper("getDefCoordPos",[e])}}),ClassEx.extend(Kekule.ChemMarker.ChemPropertyMarker,{getDefCoordPos:function(e){return e!==r.COORD3D?Kekule.Render.CoordPos.CENTER:this.tryApplySuper("getDefCoordPos",[e])}}),ClassEx.extend(Kekule.StructureFragment,{isExpanded:function(){var e=this.getOverriddenRenderOptions();return!!e&&!!e.expanded},setExpanded:function(e){this.setRenderOption("expanded",e)},getExposedNodes:function(){return this.hasCtab()?this.getCtab().getExposedNodes():[]},getExposedConnectors:function(){return this.hasCtab()?this.getCtab().getExposedConnectors():[]},exposedNodesHasCoord2D:function(e){return!!this.hasCtab()&&this.getCtab().exposedNodesHasCoord2D(e)},exposedNodesHasCoord3D:function(e){return!!this.hasCtab()&&this.getCtab().exposedNodesHasCoord3D(e)},getExposedContainerBox:function(e,t){if(this.hasCtab()){var r=this.getCtab().getExposedContainerBox(e,t);return r||(r=this.getContainerBox(e,t)),r}return this.getContainerBox(e,t)},getConnectorLengthMedian:function(e,t){return this.hasCtab()?this.getCtab().getConnectorLengthMedian(e,t):null},getAutoScaleRefLength:function(e,t){return this.getConnectorLengthMedian(e,t)},getAllAutoScaleRefLengths:function(e,t){return this.hasCtab()?this.getCtab().getAllAutoScaleRefLengths(e,t):null}}),ClassEx.extend(Kekule.SubGroup,{getCoreDisplayRichTextItem:function(e,r,i,n){var o,a=Kekule.Render,s=null,l=this.getAbbr();if(l||(s=this.getFormulaText()?Kekule.FormulaUtils.textToFormula(this.getFormulaText()):this.getFormula(!1)||this.calcFormula())&&!s.isEmpty()||(l=i&&i.getRgroup()||t.SUBGROUP),l)if(l.length<=3)(o=a.RichTextUtils.createSection(l)).charDirection=Kekule.Render.TextDirection.LTR;else{var u=this._indexOfFirstUppercaseLetter(l);u<0&&(u=0),(o=a.RichTextUtils.createGroup()).charDirection=Kekule.Render.TextDirection.LTR,u>0&&((d=a.RichTextUtils.createSection(l.substring(0,u))).charDirection=Kekule.Render.TextDirection.INHERIT,o=a.RichTextUtils.append(o,d));var d=a.RichTextUtils.createSection(l.charAt(u));(o=a.RichTextUtils.append(o,d)).anchorItem=d,u<l.length-1&&((d=a.RichTextUtils.createSection(l.substring(u+1))).charDirection=Kekule.Render.TextDirection.INHERIT,o=a.RichTextUtils.append(o,d))}else if(s){o=s.getDisplayRichText(r,i,n),(d=a.RichTextUtils.getFirstNormalTextSection(o))||(d=o.items[0]),o.anchorItem=d}return o},_indexOfFirstUppercaseLetter:function(e){for(var t=0,r=e.length;t<r;++t){var i=e.charAt(t);if(i>="A"&&i<="Z")return t}return-1},_autoSetSelfCoord:function(e,t){if(!this._isAutoSettingSelfCoord&&!(this.getCoordOfMode(e,t)||(a=this.getAnchorNodeCount())<=0)){this.beginUpdate();try{this._isAutoSettingSelfCoord=!0;for(var r={},i=0;i<a;++i){(s=this.getAnchorNodeAt(i))._autoSetSelfCoord&&s._autoSetSelfCoord(e,t),(l=s.getAbsCoordOfMode(e,t))&&(r=Kekule.CoordUtils.add(r,l))}var n=Kekule.CoordUtils.divide(r,a);this.setAbsCoordOfMode(n,e);var o=this.getCoordOfMode(e)||{},a=this.getNodeCount();for(i=0;i<a;++i){var s,l;(l=(s=this.getNodeAt(i)).getCoordOfMode(e,t))&&(l=Kekule.CoordUtils.substract(l,o),s.setCoordOfMode(l,e))}}finally{this._isAutoSettingSelfCoord=!1,this.endUpdate()}}},doGetAbsCoord2D:function(e){return this._autoSetSelfCoord(Kekule.CoordMode.COORD2D,e),this.tryApplySuper("doGetAbsCoord2D",[e])},doGetAbsCoord3D:function(e){return this._autoSetSelfCoord(Kekule.CoordMode.COORD3D,e),this.tryApplySuper("doGetAbsCoord3D",[e])},doSetAbsCoord2D:function(e){return this._autoSetSelfCoord(Kekule.CoordMode.COORD2D),this.tryApplySuper("doSetAbsCoord2D",[e])},doSetAbsCoord3D:function(e){return this._autoSetSelfCoord(Kekule.CoordMode.COORD3D),this.tryApplySuper("doSetAbsCoord3D",[e])}}),ClassEx.extend(Kekule.MolecularFormula,{getDisplayRichText:function(e,t,r,i,n){var o=Kekule.Render;return Kekule.ObjUtils.isUnset(e)&&(e=!0),o.ChemDisplayTextUtils.formulaToRichText(this,e,null,r,t,i,n)},getDisplayText:function(e,t,r){var i=this.getDisplayRichText();return Kekule.Render.RichTextUtils.toText(i)}}),ClassEx.extend(Kekule.Molecule,{afterInitialization:function(){this.setExpanded(!0)}}),ClassEx.extend(Kekule.CompositeMolecule,{getExposedContainerBox:function(e,t){var r=null,i=this.getPropStoreFieldValue("subMolecules");if(i)for(var n=0,o=i.length;n<o;++n){var a=i[n].getExposedContainerBox(e,t);a&&(r=r?Kekule.BoxUtils.getContainerBox(r,a):Kekule.BoxUtils.clone(a))}return r},getAllAutoScaleRefLengths:function(e,t){var r=[],i=this.getPropStoreFieldValue("subMolecules");if(i)for(var n=0,o=i.getItemCount();n<o;++n){var a=i.getObjAt(n).getAllAutoScaleRefLengths(e,t);a&&(r=r.concat(a))}return r}})}(),Kekule.Render={},Kekule.Render.CoordSystem={CHEM:0,CONTEXT:1,SCREEN:2},Kekule.Render.RendererType={R2D:2,R3D:3},Kekule.Render.CoordPos={CENTER:0,CORNER_TL:21,DEFAULT:0},Kekule.Render.DEF_ATOM_ATOMIC_NUM=6,Kekule.Render.MoleculeDisplayType={SKELETAL:1,CONDENSED:2,DEFAULT:1},Kekule.Render.Molecule2DDisplayType=Kekule.Render.MoleculeDisplayType,Kekule.Render.NodeLabelDisplayMode={HIDDEN:-1,SHOWN:1,SMART:0,DEFAULT:0},Kekule.Render.HydrogenDisplayLevel={NONE:0,EXPLICIT:1,UNMATCHED_EXPLICIT:2,ALL:10,LABELED:30,DEFAULT:30},Kekule.Render.TextDirection={DEFAULT:0,LTR:1,RTL:3,TTB:2,BTT:4,INHERIT:10},Kekule.Render.TextAlign={DEFAULT:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4,CENTER:5,LEADING:10,TRAILING:11,getAbsAlign:function(e,t){var r=e,i=Kekule.Render.TextAlign,n=Kekule.Render.TextDirection;if(e===i.LEADING||e===i.TRAILING){var o=e==i.LEADING;switch(t){case n.RTL:r=o?i.RIGHT:i.LEFT;break;case n.TTB:r=o?i.TOP:i.BOTTOM;break;case n.BTT:r=o?i.BOTTOM:i.TOP;break;case n.LTR:default:r=o?i.LEFT:i.RIGHT}}return r}},Kekule.Render.BoxXAlignment={LEFT:0,RIGHT:1,CENTER:2},Kekule.Render.BoxYAlignment={TOP:0,BOTTOM:1,CENTER:2},Kekule.Render.TextBoxAlignmentMode={BOX:0,ANCHOR:1},Kekule.Render.BondRenderType={DEFAULT:null,SINGLE:0,DOUBLE:1,TRIPLE:2,QUAD:3,DASHED:4,DASHED_DOUBLE:5,DASHED_TRIPLE:6,SOLID_DASH:7,ARROWED:8,ARROWED_INV:9,HASHED:10,BOLD:11,BOLD_DOUBLE:12,BOLD_TRIPLE:13,BOLD_QUAD:14,BOLD_DASH:16,WEDGED_SOLID:20,WEDGED_SOLID_INV:21,WEDGED_HOLLOW:22,WEDGED_HOLLOW_INV:23,WEDGED_HASHED:24,WEDGED_HASHED_INV:25,WEDGED_SOLID_BOTH:26,WEDGED_HOLLOW_BOTH:27,WAVY:30,SCISSORS_DOUBLE:40},Kekule.Render.ChargeMarkRenderType={NUM_WITH_SYMBOL:1,DEFAULT:1,CIRCLE_AROUND:3},Kekule.Render.Render3DGraphicQuality={EXTREME_LOW:1,LOW:2,MEDIUM:3,HIGH:4,EXTREME_HIGH:5},Kekule.Render.Molecule3DDisplayType={WIRE:31,STICKS:32,BALL_STICK:33,SPACE_FILL:34,DEFAULT:33},Kekule.Render.Bond3DRenderMode={NONE:0,WIRE:1,MULTI_WIRE:2,CYLINDER:3,MULTI_CYLINDER:4,isWireMode:function(e){var t=Kekule.Render.Bond3DRenderMode;return e===t.WIRE||e===t.MULTI_WIRE},isCylinderMode:function(e){var t=Kekule.Render.Bond3DRenderMode;return e===t.CYLINDER||e===t.MULTI_CYLINDER}},Kekule.Render.Bond3DSpliceMode={UNSPLIT:1,MID_SPLIT:2,WEIGHTING_SPLIT:3},Kekule.Render.Bond3DRenderType={SINGLE:1,DOUBLE:2,TRIPLE:3,DASH:-1,SOLID_DASH:-2},Kekule.Render.Node3DRenderMode={NONE:0,BALL:1,SPACE:2},Kekule.Render.MetaShapeType={POINT:0,CIRCLE:1,LINE:2,RECT:3,ARC:5,POLYLINE:11,POLYGON:10,SPHERE:101,CYLINDER:102,COMPOSITE:-1},Kekule.Render.BoundShapeType=Kekule.Render.MetaShapeType,Kekule.Render.ObjectUpdateType={MODIFY:0,ADD:1,REMOVE:2,CLEAR:3},Kekule.Render.AbstractRenderer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.AbstractRenderer",RENDER_CACHE_FIELD:"__$renderCache$__",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setPropValue("chemObj",e,!0),r&&this.setParent(r),this.setDrawBridge(t),this.setBubbleEvent(!0),this._suspendUpdateStatus=0,this._suspendUpdateInfos=[]},finalize:function(){var e=this.getPropStoreFieldValue("boundInfoRecorder");e&&e.finalize(),this.setPropValue("chemObj",null,!0),this.setDrawBridge(null),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:null}),this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("parent",{dateType:DataType.OBJECT,serializable:!1}),this.defineProp("parentRenderer",{dateType:"Kekule.Render.AbstractRenderer",serializable:!1,getter:function(){var e=this.getParent();return e instanceof Kekule.Render.AbstractRenderer?e:null},setter:function(e){this.setParent(e)}}),this.defineProp("redirectContext",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("canModifyTargetObj",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("canModifyTargetObj");if(Kekule.ObjUtils.isUnset(e)){var t=this.getParent();t&&t.getCanModifyTargetObj&&(e=t.getCanModifyTargetObj())}return e}}),this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:!1,setter:null,getter:function(e){if(this.isRootRenderer()){var t=this.getPropStoreFieldValue("boundInfoRecorder");return t||e||(t=this._createBoundInfoRecorder()),t}var r=this.getRootRenderer();return r&&r.getBoundInfoRecorder(e)}}),this.defineEvent("clear"),this.defineEvent("updateBasicDrawObject")},_createBoundInfoRecorder:function(){var e=this.getPropStoreFieldValue("boundInfoRecorder");e&&e.finalize();var t=new Kekule.Render.BoundInfoRecorder(this);return this.setPropStoreFieldValue("boundInfoRecorder",t),t},isRootRenderer:function(){return!this.getParentRenderer()},getHigherLevelObj:function(){return this.getParent()},getRootRenderer:function(){if(this.isRootRenderer())return this;var e=this.getParentRenderer();return e?e.getRootRenderer():this},getRendererType:function(){return Kekule.Render.RendererType.R2D},getCoordMode:function(){return this.getRendererType()===Kekule.Render.RendererType.R3D?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D},_getRenderSortIndex:function(){return 0},getRenderCache:function(e){var t=this.getExtraProp(e,this.RENDER_CACHE_FIELD);return t||(t={},this.setExtraProp(e,this.RENDER_CACHE_FIELD,t)),t},beginDraw:function(e,t,r){var i=this.getDrawBridge();i.prepareContext&&i.prepareContext(e)},endDraw:function(e,t,r){var i=this.getDrawBridge();i.renderContext&&i.renderContext(e)},updateDrawInfoInCache:function(e,t,r,i,n){var o=this.getRenderCache(t);t&&(o.context=t),r&&(o.baseCoord=r),e&&(o.chemObj=e),i&&(o.options=i),n&&(o.realDrawOptions=n)},_isCurrChemObjNeedToBeDrawn:function(e,t){for(var r=this.getChemObj(),i=0,n=e.length;i<n;++i){var o=e[i];if(o===r||o.isChildOf(r))return!0}return!1},getAutoBaseCoord:function(e){return this.doGetAutoBaseCoord(e)},doGetAutoBaseCoord:function(e){return null},getCachedDrawOptions:function(e){return this.getRenderCache(e).options},getCachedDrawnElem:function(e){return this.getRenderCache(e).drawnElem},isChemObjNeedToBeDrawn:function(){var e=this.getChemObj();return e&&(!e.getVisible||e.getVisible())},draw:function(e,t,r){if(!this.isChemObjNeedToBeDrawn())return null;try{this.__isDrawing=!0,this.getBoundInfoRecorder();var i={},n=this.getParentRenderer();if(n)var o=n.getRenderCache().options;o?(i=Object.create(o),i=Object.extend(i,r)):i=Object.create(r||null);var a=this.getChemObj(),s=i.partialDrawObjs;if(s&&!this._isCurrChemObjNeedToBeDrawn(s,e))return null;var l=this.getRendererType()===Kekule.Render.RendererType.R3D?"getRender3DOptions":"getRenderOptions",u=a[l]?a[l]():null,d=a[l=this.getRendererType()===Kekule.Render.RendererType.R3D?"getOverriddenRender3DOptions":"getOverriddenRenderOptions"]?a[l]():null;i=Kekule.Render.RenderOptionUtils.mergeRenderOptions(u||{},i),this.getRenderCache().options=i,i=Kekule.Render.RenderOptionUtils.mergeRenderOptions(d||{},i),this.updateDrawInfoInCache(this.getChemObj(),e,t,r,i);var c=this.isRootRenderer();this.doPrepareDraw(e,t,i),this.invokeEvent("prepareDrawing",{context:e,obj:this.getChemObj()}),c&&this.beginDraw(e,t,i);var h=this.doDraw(e,t,i);this.getRenderCache(e).drawnElem=h,c&&this.endDraw(e,t,i),this.invokeEvent("draw",{context:e,obj:this.getChemObj(),renderOptions:i})}finally{this.__isDrawing=!1}return h},doPrepareDraw:function(e,t,r){},doDraw:function(e,t,r){return this.doDrawSelf(e,t,r)},doDrawSelf:function(e,t,r){return null},redraw:function(e){if(!this.isChemObjNeedToBeDrawn())return null;var t=this.isRootRenderer();if(t){var r=this.getRenderCache(e)||{};this.beginDraw(e,r.baseCoord,r.options)}var i=this.doRedraw(e);return this.getRenderCache(e).drawnElem=i,t&&this.endDraw(e,r.baseCoord,r.options),i},doRedraw:function(e){var t=this.getRenderCache(e);return this.draw(e,t.baseCoord,t.options)},canModifyGraphic:function(e){var t=this.getDrawBridge();return!!t.canModifyGraphic&&t.canModifyGraphic(e)},beginUpdateRenderer:function(){++this._suspendUpdateStatus},endUpdateRenderer:function(){--this._suspendUpdateStatus,this._suspendUpdateStatus<=0&&(this._suspendUpdateStatus=0),this.isUpdatingRenderer()||this.doEndUpdateRenderer()},doEndUpdateRenderer:function(){this.updateEx(this._suspendUpdateInfos),this._suspendUpdateInfos=[]},isUpdatingRenderer:function(){return this._suspendUpdateStatus>0},updateEx:function(e){var t=!0;if(this.isUpdatingRenderer())return this._suspendUpdateInfos||(this._suspendUpdateInfos=[]),this._mergeRendererUpdateInfo(this._suspendUpdateInfos,e),!0;if(!this.canModifyGraphic(s)){if(this.isRootRenderer()){var r=[];for(n=0,o=e.length;n<o;++n){s=(a=e[n]).context;Kekule.ArrayUtils.pushUnique(r,s)}for(n=0,o=r.length;n<o;++n){this.getDrawBridge().clearContext(s);var i=this.getRenderCache(s);this.draw(s,i.baseCoord,i.options)}return!0}return this.getParentRenderer().updateEx(e)}for(var n=0,o=e.length;n<o;++n){for(var a,s=(a=e[n]).context,l=0,u=a.items.length;l<u;++l){var d=a.items[l];if(!(t=t&&this.doUpdate(s,d.updatedObjDetails,d.updateType)))break}if(!t)break}return t},_mergeRendererUpdateInfo:function(e,t){for(var r=0,i=t.length;r<i;++r){var n=t[r],o=this._indexOfContextInRendererUpdateInfos(n.context,e);if(o<0)e.push(n);else{var a=e[o];a.items=a.items.concat(n.items)}}return e},_indexOfContextInRendererUpdateInfos:function(e,t){for(var r=0,i=t.length;r<i;++r){if(t[r].context===e)return r}return-1},update:function(e,t,r){for(var i=[],n=0,o=t.length;n<o;++n){var a=t[n].obj;this.isChemObjRenderedBySelf(e,a)&&i.push(t[n])}return!i.length||this.updateEx([{context:e,items:[{updateType:r,updatedObjDetails:i}]}])},doUpdate:function(e,t,r){return this.doUpdateSelf(e,t,r)},doUpdateSelf:function(e,t,r){if(this.canModifyGraphic(e)){for(var i=!1,n=this.getChemObj(),o=0,a=t.length;o<a;++o){if(t[o].obj===n){i=!0;break}}if(i){if(r===Kekule.Render.ObjectUpdateType.CLEAR)return this.doClear(e);this.doClear(e);var s=this.getRenderCache(e);return this.draw(e,s.baseCoord,s.options)}}return!1},_extractObjsOfUpdateObjDetails:function(e){return Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(e)},_createUpdateObjDetailsFromObjs:function(e){return Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(e)},addNew:function(e,t){var r=this._createUpdateObjDetailsFromObjs(t);return this.update(e,r,Kekule.Render.ObjectUpdateType.ADD)},modify:function(e,t){return this.update(e,t,Kekule.Render.ObjectUpdateType.MODIFY)},remove:function(e,t){var r=this._createUpdateObjDetailsFromObjs(t);return this.update(e,r,Kekule.Render.ObjectUpdateType.REMOVE)},clear:function(e){this.doClear(e);this.invokeEvent("clear",{context:e,obj:this.getChemObj()})},doClear:function(e){return!!this.canModifyGraphic()&&this.doClearSelf(e)},doClearSelf:function(e){if(!this.canModifyGraphic())return!1;var t=this.getRenderCache(e).drawnElem;if(t)try{this.getDrawBridge().removeDrawnElem(e,t)}catch(e){}this.getRenderCache(e).drawnElem=null},estimateObjBox:function(e,t,r){var i=this.doEstimateObjBox(e,t,r);return i&&(i=this._fillBoxDefaultValue(i,this.getRendererType())),i},doEstimateObjBox:function(e,t,r){return this.doEstimateSelfObjBox(e,t,r)},doEstimateSelfObjBox:function(e,t,r){return null},estimateRenderBox:function(e,t,r,i){var n=this.doEstimateRenderBox(e,t,r,i);return n&&(n=this._fillBoxDefaultValue(n,this.getRendererType())),n},doEstimateRenderBox:function(e,t,r,i){return null},_fillBoxDefaultValue:function(e,t){e||(e={});var r=t===Kekule.Render.RendererType.R3D,i={x1:e.x1||0,x2:e.x2||0,y1:e.y1||0,y2:e.y2||0};return r&&(i.z1=e.z1||0,i.z2=e.z2||0),i},transformCoordToObj:function(e,t,r){return this.doTransformCoordToObj(e,t,r)},doTransformCoordToObj:function(e,t,r){return r},transformCoordToContext:function(e,t,r){return this.doTransformCoordToContext(e,t,r)},doTransformCoordToContext:function(e,t,r){return r},transformContextCoordToScreen:function(e,t){return this.doTransformContextCoordToScreen(e,t)},doTransformContextCoordToScreen:function(e,t){var r=this.getDrawBridge();return r&&r.transformContextCoordToScreen?r.transformContextCoordToScreen(e,t):t},basicDrawObjectUpdated:function(e,t,r,i,n){this.invokeEvent("updateBasicDrawObject",{context:e,obj:t,parentObj:r,boundInfo:i,updateType:n})},isChemObjRenderedBySelf:function(e,t){return t===this.getRenderCache(e).chemObj},isChemObjRenderedDirectlyBySelf:function(e,t){return!(!t||!this.getRenderCache(e).chemObj)&&t===this.getRenderCache(e).chemObj},getObjRenderBound:function(e,t,r){var i=this.getBoundInfoRecorder(),n=t;return r&&t.getCoordStickTarget&&(n=t.getCoordStickTarget()||n),i&&i.getBound(e,n)},getStickingTargetRenderBound:function(e,t){var r;if(t.getCoordStickTarget&&(r=t.getCoordStickTarget()),r){var i=this.getBoundInfoRecorder();return i&&i.getBound(e,r,!0)}return null},createBoundInfo:function(e,t,r){return Kekule.Render.MetaShapeUtils.createShapeInfo(e,t,r)},createPointBoundInfo:function(e){return this.createBoundInfo(Kekule.Render.BoundShapeType.POINT,[e])},createCircleBoundInfo:function(e,t){return this.createBoundInfo(Kekule.Render.BoundShapeType.CIRCLE,[e],{radius:t})},createArcBoundInfo:function(e,t,r,i,n,o){return this.createBoundInfo(Kekule.Render.BoundShapeType.ARC,[e],{radius:t,startAngle:r,endAngle:i,anticlockwise:n,width:o})},createLineBoundInfo:function(e,t,r){return this.createBoundInfo(Kekule.Render.BoundShapeType.LINE,[e,t],{width:r})},createRectBoundInfo:function(e,t){return this.createBoundInfo(Kekule.Render.BoundShapeType.RECT,[e,t])},createSphereBoundInfo:function(e,t){return this.createBoundInfo(Kekule.Render.BoundShapeType.SPHERE,[e],{radius:t})},createCylinderBoundInfo:function(e,t,r){return this.createBoundInfo(Kekule.Render.BoundShapeType.CYLINDER,[e,t],{radius:r})}}),Kekule.ClassDefineUtils.addExtraObjMapSupport(Kekule.Render.AbstractRenderer),Kekule.Render.DummyRenderer=Class.create(Kekule.Render.AbstractRenderer,{CLASS_NAME:"Kekule.Render.DummyRenderer",draw:function(e,t,r){},redraw:function(e){}}),Kekule.Render.CompositeRenderer=Class.create(Kekule.Render.AbstractRenderer,{CLASS_NAME:"Kekule.Render.CompositeRenderer",initProperties:function(){this.defineProp("targetChildObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("childRendererMap",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("childRendererMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("childRendererMap",e)),e}})},finalize:function(){this.reset(),this.tryApplySuper("finalize")},_getRenderSortIndex:function(){for(var e=this.tryApplySuper("_getRenderSortIndex"),t=this.prepareChildRenderers(),r=0,i=t.length;r<i;++r){var n=t[r]._getRenderSortIndex();n>e&&(e=n)}return e},doEstimateObjBox:function(e,t,r){for(var i=this.tryApplySuper("doEstimateObjBox",[e,t,r]),n=this.prepareChildRenderers(),o=Kekule.BoxUtils,a=0,s=n.length;a<s;++a){var l=n[a];if(l){var u=l.estimateObjBox(e,t,r);u&&(i=i?o.getContainerBox(i,u):o.clone(u))}}return i},isChemObjRenderedBySelf:function(e,t){var r=this.tryApplySuper("isChemObjRenderedBySelf",[e,t]);if(!r)for(var i=this.getChildRenderers(),n=0,o=i.length;n<o;++n){if(i[n].isChemObjRenderedBySelf(e,t))return!0}if(!r){this.refreshChildObjs();var a=this.getTargetChildObjs();r=a&&a.indexOf(t)>=0}return r},isChemObjRenderedDirectlyBySelf:function(e,t){return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[e,t])},doSetRedirectContext:function(e){this.tryApplySuper("doSetRedirectContext",[e]);var t=this.getChildRenderers();if(t&&t.length)for(var r=0,i=t.length;r<i;++r)t[r].setRedirectContext(e)},getChildObjs:function(){var e=this.getChemObj();return e&&e.getAttachedMarkers?[].concat(e.getAttachedMarkers()||[]):[]},prepareChildObjs:function(){var e=this.getTargetChildObjs();return e||(this.setTargetChildObjs(this.getChildObjs()),this.getTargetChildObjs())},refreshChildObjs:function(){this.setTargetChildObjs(null),this.prepareChildObjs()},getChildRenderers:function(){return this.getChildRendererMap().getValues()},getRendererForChild:function(e,t){var r=this.getRendererType()===Kekule.Render.RendererType.R3D?Kekule.Render.get3DRendererClass:Kekule.Render.get2DRendererClass,i=this.getChildRendererMap();if(!(o=i.get(e))&&t){var n=r(e)||Kekule.Render.DummyRenderer,o=n?new n(e,this.getDrawBridge(),this):null;i.set(e,o),o.setRedirectContext(this.getRedirectContext())}return o},prepareChildRenderers:function(){for(var e=this.getChildRendererMap(),t=this.prepareChildObjs()||[],r=e.getKeys(),i=0,n=r.length;i<n;++i){var o=r[i];t.indexOf(o)<0&&e.remove(o)}for(i=0,n=t.length;i<n;++i){var a=t[i];this.getRendererForChild(a,!0)}return e.getValues()},releaseChildRenderers:function(){var e=this.getChildRendererMap(),t=e.getValues();if(t){for(var r=0,i=t.length;r<i;++r)t[r].finalize();e.clear()}},hasChildRenderers:function(){var e=this.getChildRendererMap().getValues();return e&&e.length},getDirectRendererForChildObj:function(e,t){if(this.isChemObjRenderedDirectlyBySelf(e,t))return this;for(var r=this.getChildRenderers(),i=0,n=r.length;i<n;++i){var o=r[i];if(o.isChemObjRenderedBySelf(e,t))return o.isChemObjRenderedDirectlyBySelf(e,t)?o:o.getDirectRendererForChildObj?o.getDirectRendererForChildObj(e,t):null}return null},prepare:function(){this.prepareChildObjs(),this.prepareChildRenderers()},reset:function(){this.setTargetChildObjs(null),this.releaseChildRenderers()},_needWholelyDraw:function(e,t){var r=this.getChemObj();return!e||e.indexOf(r)>=0},doPrepareDraw:function(e,t,r){this.refreshChildObjs(),this.prepareChildRenderers();for(var i=this.getChildRenderers(),n=0,o=i.length;n<o;++n){i[n].doPrepareDraw(e,t,r)}},doDraw:function(e,t,r){var i=Object.create(r);if(r.partialDrawObjs&&this._needWholelyDraw(r.partialDrawObjs,e)&&(i.partialDrawObjs=null),this.getTargetChildObjs().length){var n=this.doDrawSelf(e,t,i),o=this.doDrawChildren(e,t,i);return n&&this.addToDrawGroup(n,o),o}return this.tryApplySuper("doDraw",[e,t,i])},doDrawChildren:function(e,t,r){var i=this.createDrawGroup(e),n=this.getChildRenderers();this._sortChildRenderers(n);var o=Object.create(r);this.getRenderCache(e).childDrawOptions=o;for(var a=0,s=n.length;a<s;++a){var l=n[a].draw(e,null,o);i&&l&&this.addToDrawGroup(l,i)}return i},_sortChildRenderers:function(e){e.sort(function(e,t){return e._getRenderSortIndex()-t._getRenderSortIndex()})},doClear:function(e){return this.tryApplySuper("doClear",[e]),this.hasChildRenderers()&&this.doClearChildren(e),!0},doClearChildren:function(e){for(var t=this.getChildRendererMap().getValues(),r=0,i=t.length;r<i;++r)t[r]&&t[r].clear(e)},doUpdate:function(e,t,r){return this.refreshChildObjs(),this.tryApplySuper("doUpdate",[e,t,r]),this.getTargetChildObjs().length&&this.doUpdateChildren(e,t,r),!0},doUpdateChildren:function(e,t,r){for(var i=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(t),n=this.getTargetChildObjs()||[],o=this.getChildRendererMap(),a=Kekule.ArrayUtils.toArray(i),s=new Kekule.MapEx(!1),l=[],u=!1,d=0,c=a.length;d<c;++d){var h=a[d];this.isChemObjRenderedDirectlyBySelf(e,h)&&(u=!0)}if(u)return this.doClear(e),this.redraw(e),!0;for(d=0,c=a.length;d<c;++d){h=a[d];if(T=o.get(h))r===Kekule.Render.ObjectUpdateType.REMOVE?(T.clear(),o.remove(h)):(Kekule.ArrayUtils.pushUnique(l,T),E=[h],s.set(T,E));else{var p=this._getRenderersForChildObj(e,h);if(!p.length&&n.indexOf(h)>=0){var g=(y=this.getRendererForChild(h,!0)).draw(e,null,this.getRenderCache(e).childDrawOptions);if(g){var f=this.getCachedDrawnElem(e);f&&this.addToDrawGroup(g,f)}}for(var C=0,m=p.length;C<m;++C){var T=p[C],E=s.get(T);E||(l.push(T),E=[],s.set(T,E)),E.push(h)}}}var _=!0;for(d=0,c=l.length;d<c;++d){T=l[d];var S=s.get(T),O=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(S),y=T.update(e,O,r);_=_&&y}return _},_getRenderersForChildObj:function(e,t){for(var r=[],i=this.getChildRenderers(),n=0,o=i.length;n<o;++n){var a=i[n];a.isChemObjRenderedBySelf(e,t)&&r.push(a)}return r}}),Kekule.Render.Renderer2DFactory=Kekule.FactoryUtils.createSimpleFactory(Kekule.FactoryUtils.MATCH_BY_CLASS),Kekule.Render.get2DRendererClass=function(e){var t=e instanceof ObjectEx?e.getClass():e;return Kekule.Render.Renderer2DFactory.getClass(t)},Kekule.Render.Renderer3DFactory=Kekule.FactoryUtils.createSimpleFactory(Kekule.FactoryUtils.MATCH_BY_CLASS),Kekule.Render.get3DRendererClass=function(e){var t=e instanceof ObjectEx?e.getClass():e;return Kekule.Render.Renderer3DFactory.getClass(t)},Kekule.Render.DrawBridgeManager=Class.create({CLASS_NAME:"Kekule.Render.DrawBridgeManager",initialize:function(){this._items=[],this._preferredItem=null},_indexOfBridgeClass:function(e){for(var t=0,r=this._items.length;t<r;++t){if(this._items[t].bridgeClass===e)return t}return-1},_sortItems:function(){this._items.sort(function(e,t){return(e.priorityLevel||0)-(t.priorityLevel||0)})},_reselectPreferred:function(){this._sortItems();for(var e=this._items.length-1;e>=0;--e){var t=this._items[e];if(t.isSupported)return this._preferredItem=t,t}return this._preferredItem=null,null},_recheckAvailabilityOfItem:function(e){var t=e.bridgeClass,r=t.getAvailabilityInformation&&t.getAvailabilityInformation();!r&&t.isSupported&&(r={available:t.isSupported(),message:null}),r?(e.isSupported=r.available,e.message=r.message):(e.isSupported=!1,e.message=null)},recheckAvailabilities:function(){for(var e=this._items,t=e.length-1;t>=0;--t){var r=e[t];this._recheckAvailabilityOfItem(r)}},register:function(e,t){t||(t=0);var r,i=this._indexOfBridgeClass(e);return i>=0&&this._items.splice(i,1),r={bridgeClass:e,priorityLevel:t},this._recheckAvailabilityOfItem(r),this._items.push(r),this._sortItems(),(!this._preferredItem||this._preferredItem.priorityLevel<t)&&r.isSupported&&(this._preferredItem=r),r},unregister:function(e){var t=null,r=this._indexOfBridgeClass(e);return r>=0&&(t=this._items[r],this._items.splice(r,1),t===this._preferredItem&&this._reselectPreferred()),t},getPreferredBridgeClass:function(){return this._preferredItem?this._preferredItem.bridgeClass:null},getPreferredBridgeInstance:function(){var e=this.getPreferredBridgeClass();return e?new e:null},getUnavailableMessages:function(){for(var e=[],t=this._items,r=t.length-1;r>=0;--r){var i=t[r];!i.isSupported&&i.message&&e.push(i.message)}return e},getUnavailableMessage:function(){var e=this._preferredItem||this._items[this._items.length-1];return!e.isSupported&&e.message?e.message:""}}),Kekule.Render.DrawBridge2DMananger=new Kekule.Render.DrawBridgeManager,Kekule.Render.DrawBridge3DMananger=new Kekule.Render.DrawBridgeManager,Kekule.Render.registerExternalModule=function(e,t){Kekule.externalResourceManager.register(e,t)},Kekule.Render.getExternalModule=function(e){return Kekule.externalResourceManager.getResource(e)},function(){var e=Kekule.Render;e.atomColorSets={jmol:["#000099","#FFFFFF","#D9FFFF","#CC80FF","#C2FF00","#FFB5B5","#909090","#3050F8","#FF0D0D","#90E050","#B3E3F5","#AB5CF2","#8AFF00","#BFA6A6","#F0C8A0","#FF8000","#FFFF30","#1FF01F","#80D1E3","#8F40D4","#3DFF00","#E6E6E6","#BFC2C7","#A6A6AB","#8A99C7","#9C7AC7","#E06633","#F090A0","#50D050","#C88033","#7D80B0","#C28F8F","#668F8F","#BD80E3","#FFA100","#A62929","#5CB8D1","#702EB0","#00FF00","#94FFFF","#94E0E0","#73C2C9","#54B5B5","#3B9E9E","#248F8F","#0A7D8C","#006985","#C0C0C0","#FFD98F","#A67573","#668080","#9E63B5","#D47A00","#940094","#429EB0","#57178F","#00C900","#70D4FF","#FFFFC7","#D9FFC7","#C7FFC7","#A3FFC7","#8FFFC7","#61FFC7","#45FFC7","#30FFC7","#1FFFC7","#00FF9C","#00E675","#00D452","#00BF38","#00AB24","#4DC2FF","#4DA6FF","#2194D6","#267DAB","#266696","#175487","#D0D0E0","#FFD123","#B8B8D0","#A6544D","#575961","#9E4FB5","#AB5C00","#754F45","#428296","#420066","#007D00","#70ABFA","#00BAFF","#00A1FF","#008FFF","#0080FF","#006BFF","#545CF2","#785CE3","#8A4FE3","#A136D4","#B31FD4","#B31FBA","#B30DA6","#BD0D87","#C70066","#CC0059","#D1004F","#D90045","#E00038","#E6002E","#EB0026","#000000","#000000"],cpk2D:["#000000","#000000","#FFC0CB","#B22222",null,"#00FF00","#000000","#8F8FFF","#F00000","#DAA520",null,"#0000FF","#228B22","#808090","#DAA520","#FFA500","#FFC832","#00FF00",null,"#0000FF","#808090","#808090","#808090","#808090","#808090","#808090","#FFA500","#A52A2A","#A52A2A","#A52A2A","#A52A2A"]};var t=e.atomColorSets.cpk2D,r=e.atomColorSets.jmol;t[35]="#A52A2A",t[47]="#808090",t[53]="#A020F0",t[56]="#FFA500",t[79]="#DAA520",t.SubGroup=r.SubGroup="#0000CC",e.atom3DColors=Kekule.Render.atomColorSets.jmol,e.atom2DColors=Kekule.Render.atomColorSets.cpk2D,e.atomColors=[],e.atomColors[e.RendererType.R2D]=e.atom2DColors,e.atomColors[e.RendererType.R3D]=e.atom3DColors}(),Kekule.Render.RichText={SECTION:"section",GROUP:"group",LINES:"lines",SUP:"superscript",SUB:"subscript",NORMAL:"normal"},Kekule.Render.RichTextUtils={STYLE_PROPS:["fontSize","fontFamily","fontWeight","fontStyle","color","opacity"],create:function(){return Kekule.Render.RichTextUtils.createGroup()},createGroup:function(e,t){var r={role:e||"group",items:[]};if(t)for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r},createSection:function(e,t){var r={text:e};if(t)for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r},strToRichText:function(e,t){e||(e="");var r=Kekule.Render.RichTextUtils,i=e.split("\n");if(i.length<=1)return Kekule.Render.RichTextUtils.appendText(r.create(),e,t);for(var n=r.createGroup(Kekule.Render.RichText.LINES),o=0,a=i.length;o<a;++o){var s=i[o]||" ";r.appendText(n,s,t)}return n},insertText:function(e,t,r,i,n){var o=Kekule.Render.RichTextUtils.createSection(r,i);return e.items.splice(t,0,o),n&&(e.anchorItem=o),e},appendText:function(e,t,r,i){var n=Kekule.Render.RichTextUtils.createSection(t,r);return e.items.push(n),i&&(e.anchorItem=n),e},appendText2:function(e,t,r,i){var n=Kekule.Render.RichTextUtils.createSection(t,r);return e.items.push(n),i&&(e.anchorItem=n),n},insert:function(e,t,r){return e.items.splice(t,0,r),e},append:function(e,t){return e.items.push(t),e},appendItems:function(e,t){return e.items=e.items.concat(Kekule.ArrayUtils.toArray(t)),e},getItemType:function(e){return e.items?e.role:Kekule.Render.RichText.SECTION},getItemRole:function(e){var t=Kekule.Render.RichText;return Kekule.Render.RichTextUtils.getItemType(e)===t.GROUP?t.GROUP:t.SECTION},getItemTextType:function(e){return e.textType||Kekule.Render.RichText.NORMAL},isSuperscript:function(e){return Kekule.Render.RichTextUtils.getItemTextType(e)==Kekule.Render.RichText.SUP},isSubscript:function(e){return Kekule.Render.RichTextUtils.getItemTextType(e)==Kekule.Render.RichText.SUB},isGroup:function(e){return Kekule.Render.RichTextUtils.getItemType(e)===Kekule.Render.RichText.GROUP},isSection:function(e){return Kekule.Render.RichTextUtils.getItemType(e)===Kekule.Render.RichText.SECTION},getFirstNormalTextSection:function(e){for(var t=0,r=e.items.length;t<r;++t){var i=e.items[t];if(Kekule.Render.RichTextUtils.getItemTextType(i)===Kekule.Render.RichText.NORMAL)return i}return null},getActualRefItem:function(e,t){var r=e.refItem;if(!r&&t.items.length>1){var i=t.items.indexOf(e);r=i>0?t.items[i-1]:0==i?t.items[1]:null}return r},getFinalAnchorItem:function(e){return e.anchorItem?Kekule.Render.RichTextUtils.getFinalAnchorItem(e.anchorItem):e},tidy:function(e){for(var t=Kekule.Render.RichTextUtils.createGroup(e.role),r=-1,i=0,n=e.items.length;i<n;++i){var o=e.items[i];if(o.items){var a=Kekule.Render.RichTextUtils.tidy(o);if(1==a.items.length){var s=Object.extend({},a);delete s.items,delete s.role,o=s=Object.extend(s,a.items[0])}else if(a.items.length>0){++r,t.items.push(a);continue}}var l=!1;if(r>=0){var u=t.items[r];u.items||Kekule.ObjUtils.equal(o,u,["text"])&&(u.text+=o.text,l=!0)}l||(++r,t.items.push(Object.extend({},o)))}return t},clone:function(e){var t={};if(Object.extend(t,e),e.items){t.items=[];for(var r=0,i=e.items.length;r<i;++r){var n={};n=Kekule.Render.RichTextUtils.clone(e.items[r]),t.items.push(n)}}if(t.items){if(e.anchorItem){var o=e.items.indexOf(e.anchorItem);t.anchorItem=o>=0?t.items[o]:null}for(r=0,i=t.items.length;r<i;++r){var a=e.items[r];n=t.items[r];if(a.refItem){o=e.items.indexOf(a.refItem);n.refItem=o>=0?t.items[o]:null}}}return t},toText:function(e){var t="";if(!e.items)return e.text||"";for(var r=0,i=e.items.length;r<i;++r){var n=e.items[r];n.items?t+=Kekule.Render.RichTextUtils.toText(n):n.text&&(t+=n.text)}return t},_toDebugHtml:function(e){if(!e.items)return e.text;for(var t="",r=0,i=e.items.length;r<i;++r){var n=e.items[r];if(n.items)t+=Kekule.Render.RichTextUtils._toDebugHtml(n);else if(n.text)switch(n.textType){case Kekule.Render.RichText.SUB:t+="<sub>"+n.text+"</sub>";break;case Kekule.Render.RichText.SUP:t+="<sup>"+n.text+"</sup>";break;default:t+=n.text}}return t},toSimpleHtmlCode:function(e){return Kekule.Render.RichTextUtils._toDebugHtml(e)},fromSimpleHtmlCode:function(e){for(var t,r=Kekule.Render.RichText,i=new RegExp("</?([a-z]+)/?>","ig"),n=[],o=0,a=r.NORMAL;null!==(t=i.exec(e));){var s=t.index,l=t[0],u=t[1].toLowerCase();o<s&&n.push({textType:a,text:e.substring(o,s)});var d=1===l.indexOf("/");if(!(l.lastIndexOf("/")===l.length-2)){var c="sup"===u?r.SUP:"sub"===u?r.SUB:null;c&&(d?a===c&&(a=r.NORMAL):a=c)}o=s+l.length}e.length>o&&n.push({textType:a,text:e.substring(o)});for(var h=Kekule.Render.RichTextUtils,p=h.createGroup(null,{charDirection:Kekule.Render.TextDirection.LTR}),g=0,f=n.length;g<f;++g){var C=n[g].textType,m=n[g].text;if(m){var T=h.createSection(m,{textType:C});h.append(p,T)}}return p},toHtml:function(e,t,r){var i,n,o=Kekule.Render.RichText;n=t.charDirection?t.charDirection===Kekule.Render.TextDirection.RTL||t.charDirection===Kekule.Render.TextDirection.BTT:r;var a=t.role;if(a===o.SECTION||t.text){var s=t.textType,l=s===o.SUB?"sub":s===o.SUP?"sup":"span";i=e.createElement(l);var u=t.text;n&&(u=u.reverse()),Kekule.DomUtils.setElementText(i,t.text||"")}else{var d,c,h=null;a===o.LINES?(i=e.createElement("div"),h="p",d="margin:0.2em 0;padding:0"):i=e.createElement("span");for(var p=0,g=t.items.length;p<g;++p){var f=t.items[p],C=Kekule.Render.RichTextUtils.toHtml(e,f,n);if(h){var m=e.createElement(h);d&&(m.style.cssText=d),m.appendChild(C),C=m}n&&c?i.insertBefore(C,c):i.appendChild(C),c=C}}var T=i.style,E=Kekule.Render.RichTextUtils.STYLE_PROPS;for(p=0,g=E.length;p<g;++p){var _=E[p];t[_]&&(T[_]=t[_])}return i},fromHtml:function(e){var t=Kekule.Render.RichText,r=Kekule.Render.RichTextUtils,i=Kekule.DomUtils,n=Kekule.StyleUtils;return function e(o,a){if(o.nodeType===Node.TEXT_NODE)return(y=(y=o.nodeValue).replace(/[\r\n]/g,"")).trim()?r.createSection(y):null;if(o.nodeType===Node.ELEMENT_NODE){var s=r.STYLE_PROPS;s.push("direction");for(var l={},u=0,d=s.length;u<d;++u){var c,h=s[u];(c=a?n.getComputedStyle(o,h):o.style[h])&&(l[h]=c)}if(l.direction?(l.charDirection="ltr"===l.direction?Kekule.Render.TextDirection.LTR:"rtl"===l.direction?Kekule.Render.TextDirection.RTL:"inherit"===l.direction?Kekule.Render.TextDirection.INHERIT:null,delete l.direction):l.charDirection=Kekule.Render.TextDirection.DEFAULT,i.getFirstChildElem(o)){var p=t.GROUP,g=i.getChildNodesOfTypes(o,[Node.ELEMENT_NODE,Node.TEXT_NODE]),f=[],C=!1;for(u=0,d=g.length;u<d;++u){var m=g[u],T=e(m,!1);m.nodeType===Node.ELEMENT_NODE&&("br"===m.tagName.toLowerCase()&&(f.push("br"),C=!0),n.isBlockElem(m)&&(C=!0,T._isLine=!0)),T&&f.push(T)}if(C){var E=[],_=[];for(u=0,d=f.length;u<d;++u)if((T=f[u])._isLine||"br"==T){if(_.length){if(_.length>1){var S=r.createGroup();r.appendItems(S,_),E.push(S)}else E.push(_[0]);_=[]}T._isLine&&(delete T._isLine,E.push(T))}else _.push(T);_.length&&(_.length>1?(S=r.createGroup(),r.appendItems(S,_),E.push(S)):E.push(_[0])),f=E}C&&(p=t.LINES);var O=r.createGroup(p,l);for(u=0,d=f.length;u<d;++u)r.append(O,f[u]);return O}var y=i.getElementText(o),A=o.tagName.toLowerCase();return l.textType="sub"===A?t.SUB:"sup"===A?t.SUP:t.NORMAL,y?r.createSection(y,l):null}}(e,!0)}},Kekule.Render.ChemDisplayTextUtils={RADICAL_LABELS:["","••","•","••"],RADICAL_TRIPLET_ALTER_LABEL:"^^",getRadicalDisplayText:function(e,t){return t&&e===Kekule.RadicalOrder.TRIPLET?Kekule.Render.ChemDisplayTextUtils.RADICAL_TRIPLET_ALTER_LABEL:Kekule.Render.ChemDisplayTextUtils.RADICAL_LABELS[e]},getChargeDisplayText:function(e,t,r){var i="";if(!!e&&(!t||Math.abs(e)>Math.pow(10,-t)/2)){var n=e>0?"+":"-",o=Math.abs(e);1!=o?i+=t?Kekule.NumUtils.toDecimals(o,t):o.toString():r===Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND&&(n=e>0?"⊕":"⊖"),i+=n}return i},getElectronicBiasDisplayText:function(e,t){var r="";if(e&&t){var i=e>0?"+":e<0?"-":null;if(i){r=t;for(var n=Math.abs(e),o=0;o<n;++o)r+=i}}return r},getChargeExDisplayText:function(e,t,r,i,n){return e?Kekule.Render.ChemDisplayTextUtils.getChargeDisplayText(e,r,n):t?Kekule.Render.ChemDisplayTextUtils.getElectronicBiasDisplayText(t,i):""},createElectronStateDisplayTextSection:function(e,t,r,i,n,o,a){var s=null,l="";return(e||o)&&(l=Kekule.Render.ChemDisplayTextUtils.getChargeExDisplayText(e,o,r,a,i)),t&&(l+=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(t,n)||""),l&&(s=Kekule.Render.RichTextUtils.createSection(l,{textType:Kekule.Render.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR})),s},formulaToRichText:function(e,t,r,i,n,o,a){return Kekule.Render.ChemDisplayTextUtils._convFormulaToRichTextGroup(e,!1,t,r,i,n,o,a)},_convFormulaToRichTextGroup:function(e,t,r,i,n,o,a,s){var l=Kekule.Render.RichTextUtils.createGroup(),u=e.getSections();if(t){var d=e.getMaxNestedLevel()%Kekule.FormulaUtils.FORMULA_BRACKET_TYPE_COUNT,c=Kekule.FormulaUtils.FORMULA_BRACKETS[d][0],h=Kekule.FormulaUtils.FORMULA_BRACKETS[d][1];l=Kekule.Render.RichTextUtils.appendText(l,c)}for(var p=0,g=u.length;p<g;++p){var f=u[p].obj,C=e.getSectionCharge(u[p]),m=null;if(f instanceof Kekule.MolecularFormula)m=Kekule.Render.ChemDisplayTextUtils._convFormulaToRichTextGroup(f,!0,!1,!1,n,o,a);else if(f.getDisplayRichText)m=f.getDisplayRichText(Kekule.Render.HydrogenDisplayLevel.NONE,!1,null,o,n,a);if(m){if(1!=u[p].count&&((m=Kekule.Render.RichTextUtils.appendText(m,u[p].count.toString(),{textType:Kekule.Render.RichText.SUB})).charDirection=Kekule.Render.TextDirection.LTR),r&&C)(T=Kekule.Render.ChemDisplayTextUtils.createElectronStateDisplayTextSection(C,null,n,a,s))&&Kekule.Render.RichTextUtils.append(m,T);l=Kekule.Render.RichTextUtils.append(l,m)}}if(t&&(l=Kekule.Render.RichTextUtils.appendText(l,h)),r||i){C=e.getCharge();var T,E=e.getRadical();(T=Kekule.Render.ChemDisplayTextUtils.createElectronStateDisplayTextSection(C,E,n,a))&&Kekule.Render.RichTextUtils.append(l,T)}return l}},Kekule.Render.TextDrawUtils={isHorizontalLine:function(e){return e==Kekule.Render.TextDirection.LTR||e==Kekule.Render.TextDirection.RTL||null==e},isVerticalLine:function(e){return e==Kekule.Render.TextDirection.TTB||e==Kekule.Render.TextDirection.BTT},getOppositeDirection:function(e){var t=Kekule.Render.TextDirection;switch(e){case t.LTR:return t.RTL;case t.RTL:return t.LTR;case t.TTB:return t.BTT;case t.BTT:return t.TTB}},isOppositeDirection:function(e,t){return Kekule.Render.TextDrawUtils.getOppositeDirection(e)===t},getActualDirection:function(e,t){var r=Kekule.Render.TextDirection;return e===r.LINE_BREAK?t===r.TTB||t===r.BTT?r.LTR:t===r.LTR||t===r.RTL?r.TTB:e:e},getActualAlign:function(e,t){var r=Kekule.Render.TextAlgin,i=Kekule.Render.TextDirection;switch(e){case r.LEFT:case r.RIGHT:case r.TOP:case r.BOTTOM:case r.CENTER:return e;case r.LEADING:switch(t){case i.TTB:return r.TOP;case i.BTT:return r.BOTTOM;case i.RTL:return r.RIGHT;case i.LTR:default:return r.LEFT}case r.TRAILING:switch(t){case i.BTT:return r.TOP;case i.TTB:return r.BOTTOM;case i.RTL:return r.LEFT;case i.LTR:default:return r.RIGHT}}}},Kekule.Render.DrawPathUtils={makePath:function(){for(var e,t=[],r=null,i=[],n=0,o=arguments.length;n<o;++n){var a=arguments[n];DataType.isArrayValue(a)?i=i.concat(a):"number"==typeof a?i.push(a):(r&&(e={method:r,params:i},t.push(e),r=null,i=[]),r=a.toString()),n===o-1&&r&&(e={method:r,params:i},t.push(e))}return t}},Kekule.Render.ConnectorDrawUtils={getPossibleConnectorRenderTypes:function(e){if(e instanceof Kekule.Bond)return Kekule.Render.ConnectorDrawUtils.getPossibleBondRenderTypes(e);var t=Kekule.Render.BondRenderType;return[t.SINGLE,t.DASHED,t.WAVY]},getDefConnectorRenderType:function(e){return Kekule.Render.ConnectorDrawUtils.getPossibleConnectorRenderTypes(e)[0]},getPossibleBondRenderTypes:function(e){var t=Kekule.Render.BondRenderType,r=Kekule.BondType;switch(e.getBondType()){case r.HYDROGEN:case r.TRANSITION:return[t.DASHED,t.ARROWED,t.WAVY];case r.COORDINATE:return[t.ARROWED,t.SINGLE,t.DASHED,t.WAVY];case r.IONIC:case r.METALLIC:case r.UNKNOWN:return[t.SINGLE,t.DASHED,t.WAVY];case r.COVALENT:break;default:return[t.SINGLE,t.DASHED,t.ARROWED,t.WAVY]}if(e.getConnectedObjCount()>2)return[t.DASHED,t.SINGLE];var i=Kekule.BondOrder;switch(e.getBondOrder()){case i.DOUBLE:var n=[t.DOUBLE,t.DASHED_DOUBLE,t.BOLD_DOUBLE,t.WAVY];return e.getStereo&&[Kekule.BondStereo.E_OR_Z,Kekule.BondStereo.CIS_OR_TRANS].indexOf(e.getStereo())>=0&&n.unshift(t.SCISSORS_DOUBLE),n;case i.TRIPLE:return[t.TRIPLE,t.BOLD_TRIPLE,t.WAVY];case i.QUAD:return[t.QUAD,t.BOLD_QUAD,t.WAVY];case i.EXPLICIT_AROMATIC:return[t.SOLID_DASH,t.WAVY];case i.SINGLE:var o=Kekule.BondStereo,a=[t.SINGLE,t.BOLD,t.WAVY];switch(e.getStereo()){case o.UP:a.unshift(t.WEDGED_SOLID,t.WEDGED_HOLLOW);break;case o.UP_INVERTED:a.unshift(t.WEDGED_SOLID_INV,t.WEDGED_HOLLOW_INV);break;case o.DOWN:a.unshift(t.WEDGED_HASHED,t.DASHED);break;case o.DOWN_INVERTED:a.unshift(t.WEDGED_HASHED_INV,t.DASHED);break;case o.UP_OR_DOWN:case o.UP_OR_DOWN_INVERTED:a=[t.WAVY,t.SINGLE];break;case o.CLOSER:a=[t.WEDGED_SOLID_BOTH,t.WEDGED_HOLLOW_BOTH]}return a;default:return[t.SINGLE,t.DASHED,t.ARROWED,t.WAVY]}},getDefBondRenderType:function(e){return Kekule.Render.ConnectorDrawUtils.getPossibleBondRenderTypes(e)[0]},getConnectorRender3DType:function(e,t){var r=Kekule.Render.Bond3DRenderType,i=Kekule.Render.Bond3DRenderMode;return(!t||t!==i.WIRE&&t!==i.CYLINDER)&&e instanceof Kekule.Bond?Kekule.Render.ConnectorDrawUtils.getBondRender3DTypes(e):r.SINGLE},getBondRender3DTypes:function(e){var t=Kekule.Render.Bond3DRenderType,r=Kekule.BondType;switch(e.getBondType()){case r.HYDROGEN:case r.TRANSITION:return t.DASH;case r.COVALENT:break;default:return t.SINGLE}var i=Kekule.BondOrder;switch(e.getBondOrder()){case i.DOUBLE:return t.DOUBLE;case i.TRIPLE:return t.TRIPLE;case i.EXPLICIT_AROMATIC:return t.SOLID_DASH;default:return t.SINGLE}}},Kekule.Render.ObjUtils={getContainerBox:function(e,t,r){var i;t||(t=Kekule.CoordMode.COORD2D);var n=e;if(n.getExposedContainerBox)i=n.getExposedContainerBox(t,r);else if(n.getContainerBox)i=n.getContainerBox(t,r);else{var o=n.getAbsCoordOfMode?n.getAbsCoordOfMode(t):null;i=o?Kekule.BoxUtils.createBox(o,o):null}return i}},Kekule.Render.MetaShapeUtils={createShapeInfo:function(e,t,r){var i={shapeType:e,coords:t};return r&&(i=Object.extend(i,r)),i},isCompositeShape:function(e){return DataType.isArrayValue(e)},inflateShape:function(e,t){if(!e)return null;var r,i=Kekule.Render.MetaShapeType,n=Kekule.Render.MetaShapeUtils;if(n.isCompositeShape(e)){for(var o=[],a=0,s=e.length;a<s;++a){var l=e[a],u=n.inflateShape(l,t);o.push(u)}return o}switch(e.shapeType){case i.POINT:r=n._inflatePointShape(e,t);break;case i.CIRCLE:r=n._inflateCircleShape(e,t);break;case i.LINE:r=n._inflateLineShape(e,t);break;case i.RECT:r=n._inflateRectShape(e,t);break;case i.POLYGON:r=n._inflatePolygonShape(e,t);break;case i.ARC:r=n._inflateArcShape(e,t)}return r},_inflatePointShape:function(e,t){return Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.CIRCLE,[e.coords[0]],{radius:t})},_inflateCircleShape:function(e,t){return Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.CIRCLE,[e.coords[0]],{radius:e.radius+t})},_inflateLineShape:function(e,t){return Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.LINE,[e.coords[0],e.coords[1]],{width:(e.width||0)+2*t})},_inflateArcShape:function(e,t){var r=Object.extend({},e);return r.width=(e.width||0)+2*t,r},_inflateRectShape:function(e,t){var r=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.RECT,[]),i=Kekule.Render.MetaShapeUtils._inflateCoords(e.coords,t);return r.coords=i,r},_inflatePolygonShape:function(e,t){var r=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.POLYGON,[]),i=Kekule.Render.MetaShapeUtils._inflateCoords(e.coords,t);return r.coords=i,r},_inflateCoords:function(e,t){for(var r=Kekule.CoordUtils,i=[],n=r.getCenter(e),o=0,a=e.length;o<a;++o){var s=e[o],l=r.substract(s,n),u=r.getDistance(l),d=r.multiply(l,t/u),c=r.add(s,d);i.push(c)}return i},getDistance:function(e,t,r){if(Kekule.Render.MetaShapeUtils.isCompositeShape(t)){for(var i=null,n=0,o=t.length;n<o;++n){var a=t[n],s=Kekule.Render.MetaShapeUtils.getDistance(e,a,r);(null===i||i>s)&&(i=s)}return i}var l=Kekule.Render.MetaShapeType,u=Kekule.Render.MetaShapeUtils,d=r?u.inflateShape(t,r):t;switch(t.shapeType){case l.POINT:return r?u._getDistanceToCircle(e,d):u._getDistanceToPoint(e,d);case l.CIRCLE:return u._getDistanceToCircle(e,d);case l.LINE:return u._getDistanceToLine(e,d);case l.RECT:return u._getDistanceToRect(e,d);case l.POLYGON:return u._getDistanceToPolygon(e,d);case l.ARC:return u._getDistanceToArc(e,d);default:return!1}},_getDistanceToPoint:function(e,t){return Kekule.CoordUtils.getDistance(e,t.coords[0])},_getDistanceToCircle:function(e,t){return Kekule.CoordUtils.getDistance(e,t.coords[0])-t.radius},_getDistanceToArc:function(e,t){var r=Kekule.CoordUtils,i=r.substract(e,t.coords[0]),n=Math.atan2(i.y,i.x);if(Kekule.Render.MetaShapeUtils.isAngleInArcRange(n,t.startAngle,t.endAngle,t.anticlockwise)){var o=r.getDistance(e,t.coords[0]);o=Math.abs(o-t.radius);return t.width&&t.width>1&&(o-=t.width/2),Math.max(0,o)}var a,s=t.coords[0];a=t.width&&t.width>1?[t.radius-t.width/2,t.radius+t.width/2]:[t.radius];for(var l=[],u=t.startAngle,d=t.endAngle,c=0,h=a.length;c<h;++c){var p=a[c],g=r.add(s,{x:p*Math.cos(u),y:p*Math.sin(u)}),f=r.add(s,{x:p*Math.cos(d),y:p*Math.sin(d)});l.push(g),l.push(f)}var C=null;for(c=0,h=l.length;c<h;++c){o=r.getDistance(l[c],e);(null===C||C>o)&&(C=o)}return C},_getDistanceToLine:function(e,t){var r=Kekule.Render.MetaShapeUtils,i=t.coords,n=Kekule.Render.MetaShapeUtils._calcVerticalLineCrossPoint(e,i[0],i[1]),o=Kekule.NumUtils;if(o.isFloatEqual(i[0].x,i[1].x)&&o.isFloatEqual(i[0].y,i[1].y)){var a={coords:[t.coords[0]],radius:t.width};return r._getDistanceToCircle(e,a)}var s=Kekule.CoordUtils.substract(i[1],i[0]);if(Math.abs(s.y)>Math.abs(s.x)?Math.sign(n.y-i[0].y)*Math.sign(n.y-i[1].y)<=0:Math.sign(n.x-i[0].x)*Math.sign(n.x-i[1].x)<=0)return Kekule.CoordUtils.getDistance(e,n)-(t.width||0)/2;var l={coords:[t.coords[0]],radius:t.width||0},u={coords:[t.coords[1]],radius:t.width||0},d=r._getDistanceToCircle(e,l),c=r._getDistanceToCircle(e,u);return Math.min(d,c)},_getDistanceToRect:function(e,t){var r=t.coords,i=Kekule.Render.MetaShapeUtils,n=Object.extend({},t);return n.shapeType=Kekule.Render.MetaShapeType.POLYGON,n.coords=[{x:r[0].x,y:r[0].y},{x:r[1].x,y:r[0].y},{x:r[1].x,y:r[1].y},{x:r[0].x,y:r[1].y}],i._getDistanceToPolygon(e,n)},_getDistanceToPolygon:function(e,t){Kekule.CoordUtils;for(var r=Kekule.Render.MetaShapeUtils,i=Kekule.Render.MetaShapeType,n=r._isInsidePolygon(e,t),o=t.coords,a=null,s=0,l=o.length;s<l;++s){var u=o[s],d=o[(s+1)%l],c=r.createShapeInfo(i.LINE,[u,d],{width:0}),h=r._getDistanceToLine(e,c);null===a?a=h:a>h&&(a=h)}return n&&(a=-a),a},_getDistanceOfTwoLines:function(e,t){Kekule.Render.MetaShapeUtils;var r=Kekule.GeometryUtils;if(r.getCrossPointOfLines(e[0],e[1],t[0],t[1]))return 0;var i=r.getDistanceFromPointToLine(e[0],t[0],t[1]),n=r.getDistanceFromPointToLine(e[1],t[0],t[1]),o=r.getDistanceFromPointToLine(t[0],e[0],e[1]),a=r.getDistanceFromPointToLine(t[1],e[0],e[1]);return Math.min(i,n,o,a)},isCoordInside:function(e,t,r){if(!e)return!1;if(Kekule.Render.MetaShapeUtils.isCompositeShape(t)){for(var i=0,n=t.length;i<n;++i){var o=t[i];if(Kekule.Render.MetaShapeUtils.isCoordInside(e,o,r))return!0}return!1}var a=Kekule.Render.MetaShapeType,s=Kekule.Render.MetaShapeUtils,l=r?s.inflateShape(t,r):t;if(!l)return!1;switch(t.shapeType){case a.POINT:return r?s._isInsideCircle(e,l):s._isInsidePoint(e,l);case a.CIRCLE:return s._isInsideCircle(e,l);case a.LINE:return s._isInsideLine(e,l);case a.RECT:return s._isInsideRect(e,l);case a.POLYGON:return s._isInsidePolygon(e,l);case a.ARC:return s._isInsideArc(e,l);default:return!1}},_isInsidePoint:function(e,t){return Kekule.CoordUtils.isEqual(e,t.coords[0])},_isInsideCircle:function(e,t){return Kekule.CoordUtils.getDistance(e,t.coords[0])<=t.radius},_isInsideLine:function(e,t){var r=t.coords,i=Kekule.Render.MetaShapeUtils._calcVerticalLineCrossPoint(e,r[0],r[1]),n=Kekule.NumUtils;if(n.isFloatEqual(r[0].x,r[1].x)&&n.isFloatEqual(r[0].y,r[1].y)){var o={coords:[t.coords[0]],radius:t.width};return Kekule.Render.MetaShapeUtils._isInsideCircle(e,o)}var a=Kekule.CoordUtils.substract(r[1],r[0]);return!!(Math.abs(a.y)>Math.abs(a.x)?Math.sign(i.y-r[0].y)*Math.sign(i.y-r[1].y)<=0:Math.sign(i.x-r[0].x)*Math.sign(i.x-r[1].x)<=0)&&Kekule.CoordUtils.getDistance(e,i)<=t.width/2},_isInsideArc:function(e,t){var r=Kekule.CoordUtils,i=Kekule.GeometryUtils,n=r.getDistance(e,t.coords[0]),o=Math.abs(n-t.radius)<t.width/2;if(o){var a=r.substract(e,t.coords[0]),s=i.standardizeAngle(Math.atan2(a.y,a.x),0);o=Kekule.Render.MetaShapeUtils.isAngleInArcRange(s,t.startAngle,t.endAngle,t.anticlockwise)}return o},_isInsideRect:function(e,t){var r=t.coords;return Kekule.CoordUtils.insideRect(e,r[0],r[1])},_isInsidePolygon:function(e,t){for(var r=e.x,i=e.y,n=t.coords,o={x:n[0].x,y:n[0].y},a={x:n[0].x,y:n[0].y},s=1,l=n.length;s<l;++s){var u=n[s];u.x<o.x?o.x=u.x:u.x>a.x&&(a.x=u.x),u.y<o.y?o.y=u.y:u.y>a.y&&(a.y=u.y)}if(!Kekule.CoordUtils.insideRect(e,o,a))return!1;for(var d=!1,c=(s=0,(l=n.length)-1);s<l;++s){var h=n[s],p=n[c];(h.y<i&&p.y>=i||p.y<i&&h.y>=i)&&(h.x<=r||p.x<=r)&&h.x+(i-h.y)/(p.y-h.y)*(p.x-h.x)<r&&(d=!d),c=s}return d},_calcVerticalLineCrossPoint:function(e,t,r){var i={};if(Math.abs(t.x-r.x)<1e-10)i.x=t.x,i.y=e.y;else{var n=(r.y-t.y)/(r.x-t.x);i.x=(n*n*t.x+n*(e.y-t.y)+e.x)/(n*n+1),i.y=n*(i.x-t.x)+t.y}return i},getContainerBox:function(e,t){var r=Kekule.Render.MetaShapeType,i=Kekule.Render.MetaShapeUtils,n=Kekule.BoxUtils;if(!e)return null;var o,a=e.coords;if(t=t||0,i.isCompositeShape(e)){o=null;for(var s=0,l=e.length;s<l;++s){var u=e[s],d=i.getContainerBox(u);o=o?n.getContainerBox(o,d):d}}else switch(e.shapeType){case r.POINT:case r.CIRCLE:var c=e.shapeType===r.POINT?0:e.radius||0,h=a[0];o=n.createBox({x:h.x-c,y:h.y-c},{x:h.x+c,y:h.y+c});break;case r.LINE:o=n.createBox(a[0],a[1]),o=Kekule.BoxUtils.inflateBox(o,(e.width||0)/2);break;case r.ARC:o=Kekule.Render.MetaShapeUtils._getArcContainerBox(e);break;case r.RECT:o=n.createBox(a[0],a[1]);break;case r.POLYGON:o=n.createBox(a[0],a[0]);for(s=1,l=a.length;s<l;++s){h=a[s];o={x1:Math.min(o.x1,h.x),y1:Math.min(o.y1,h.y),x2:Math.max(o.x2,h.x),y2:Math.max(o.y2,h.y)}}}return t&&(o=Kekule.BoxUtils.inflateBox(o,t)),o},_getArcContainerBox:function(e){var t,r=Kekule.Render.MetaShapeUtils,i=Kekule.CoordUtils;t=e.width&&e.width>1?[e.radius+e.width/2,e.radius-e.width/2]:[e.radius];for(var n=e.coords[0],o=Math.PI/2,a=function(e,t){return i.add(n,{x:t*Math.cos(e),y:t*Math.sin(e)})},s=[],l=0,u=t.length;l<u;++l){var d=t[l],c=a(e.startAngle,d),h=a(e.endAngle,d);s=s.concat([c,h]);for(var p=[0,o,2*o,3*o],g=0,f=p.length;g<f;++g)r.isAngleInArcRange(p[g],e.startAngle,e.endAngle,e.anticlockwise)&&s.push(a(p[g],d))}return i.getContainerBox(s)},isAngleInArcRange:function(e,t,r,i){var n=Kekule.GeometryUtils.standardizeAngle,o=n(t),a=n(r),s=n(e),l=Math.sign(s-o)*Math.sign(s-a)*Math.sign(a-o);return i?l>=0:l<=0},isIntersectingLine:function(e,t,r){var i=Kekule.Render.MetaShapeType,n=Kekule.Render.MetaShapeUtils;if(n.isCompositeShape(e)){for(var o=0,a=e.length;o<a;++o){var s=e[o];if(n.isIntersectingLine(s,t,r))return!0}return!1}var l=n.createShapeInfo(i.LINE,t),u=r/2,d=e.coords;switch(e.shapeType){case i.POINT:return(h=n._getDistanceToLine(d[0],l))<=u;case i.CIRCLE:return(h=n._getDistanceToLine(d[0],l))<=u+(l.radius||0);case i.LINE:return(h=n._getDistanceOfTwoLines(d,t))<=u+(l.width||0);case i.RECT:case i.POLYGON:var c=n._getCoordsForShapeInComparingWithPolygon(e),h=null,p=c.length-1;for(o=0,a=c.length;o<a;++o){var g=[c[o],c[p]],f=n._getDistanceOfTwoLines(g,t);(null===h||f<h)&&(h=f),p=o}return h<=u}return!1},isInsideBox:function(e,t){var r=Kekule.Render.MetaShapeUtils.getContainerBox(e);return Kekule.BoxUtils.isInside(r,t)},isIntersectingBox:function(e,t){if(!Kekule.Render.MetaShapeUtils.isCompositeShape(e)){var r=e.coords;for(n=0,o=r.length;n<o;++n){var i=r[n];if(Kekule.CoordUtils.isInsideBox(i,t))return!0}return!1}for(var n=0,o=e.length;n<o;++n){var a=e[n];if(Kekule.Render.MetaShapeUtils.isIntersectingBox(a,t))return!0}},isPointInsidePolygon:function(e,t){for(var r=!1,i=t.length,n=i-1,o=0;o<i;++o)t[o].y>e.y!=t[n].y>e.y&&e.x<(t[n].x-t[o].x)*(e.y-t[o].y)/(t[n].y-t[o].y)+t[o].x&&(r=!r),n=o;return r},isInsidePolygon:function(e,t){var r=Kekule.Render.MetaShapeUtils,i=r._getCoordsForShapeInComparingWithPolygon(e);if(!i)return!1;for(var n=0,o=i.length;n<o;++n){var a=i[n];if(!r.isPointInsidePolygon(a,t))return!1}return!0},isIntersectingPolygon:function(e,t){var r=Kekule.Render.MetaShapeUtils,i=r._getCoordsForShapeInComparingWithPolygon(e);if(!i)return!1;for(var n=0,o=i.length;n<o;++n){var a=i[n];if(r.isPointInsidePolygon(a,t))return!0}return!1},isIntersectingPolyline:function(e,t,r){for(var i=Kekule.Render.MetaShapeUtils,n=0,o=t.length-1;n<o;++n){var a=[t[n],t[n+1]];if(i.isIntersectingLine(e,a,r))return!0}return!1},_getCoordsForShapeInComparingWithPolygon:function(e){var t,r=Kekule.Render.MetaShapeType,i=Kekule.Render.MetaShapeUtils;if(i.isCompositeShape(e)){t=[];for(var n=0,o=e.length;n<o;++n){var a=e[n],s=i._getCoordsForShapeInComparingWithPolygon(a);t=t.concat(s)}return t}var l=e.coords;switch(e.shapeType){case r.POINT:t=[l[0]];break;case r.CIRCLE:var u=e.radius||0;if(u){var d=u,c=d/Math.sqrt(2);t=[{x:d,y:0},{x:c,y:c},{x:0,y:d},{x:-c,y:c},{x:-d,y:0},{x:-c,y:-c},{x:0,y:-d},{x:c,y:-c}]}else t=[l[0]];break;case r.LINE:t=[l[0],l[1]];break;case r.RECT:var h=l[0],p=l[1];t=[h,{x:p.x,y:h.y},p,{x:h.x,y:p.y}];break;case r.POLYGON:t=l}return t},getEdgeVectors:function(e){var t,r=Kekule.Render.MetaShapeType,i=Kekule.Render.MetaShapeUtils,n=Kekule.CoordUtils;if(i.isCompositeShape(e)){t=[];for(var o=0,a=e.length;o<a;++o){var s=e[o],l=i.getEdgeVectors(s);t=t.concat(l)}return t}var u=e.coords;switch(e.shapeType){case r.POINT:t=[[u[0],u[0]]];break;case r.CIRCLE:t=null;break;case r.LINE:var d=e.width;if(d){var c=u[0],h=u[1],p=n.substract(h,c),g=n.getDistance(c,h),f=d/2,C=f*(p.y/g),m=f*(p.x/g),T=[{x:c.x-C,y:c.y+m},{x:c.x+C,y:c.y-m},{x:h.x+C,y:h.y-m},{x:h.x-C,y:h.y+m}];t=[[T[0],T[1]],[T[1],T[2]],[T[2],T[3]],[T[3],T[0]]]}else t=[[u[0],u[1]]];break;case r.RECT:var E=u[0],_=(c={x:(h=u[1]).x,y:E.y},{x:E.x,y:h.y});t=[[E,c],[c,h],[h,_],[_,E]];break;case r.POLYGON:t=[];for(o=0,a=u.length-1;o<a;++o){var S=++o;S>=a&&(S=0),t.push([u[o],u[S]])}}return t},getEdgeBasicElements:function(e){var t=Kekule.Render.MetaShapeType,r=Kekule.Render.MetaShapeUtils,i={vectors:[],circles:[]};if(r.isCompositeShape(e)){for(var n=0,o=e.length;n<o;++n){var a=e[n],s=r.getEdgeBasicElements(a);i.vectors=i.concat(s.vectors),i.circles=i.concat(s.circles)}return i}var l=e.coords;switch(e.shapeType){case t.POINT:i.circles.push({center:l[0],radius:0});break;case t.CIRCLE:i.circles.push({center:l[0],radius:e.radius});break;default:i.vectors=i.vectors.concat(Kekule.Render.MetaShapeUtils.getEdgeVectors(e))}return i},getCrossPointsOfVectorToShapeEdges:function(e,t,r,i){for(var n=Kekule.Render.MetaShapeUtils.getEdgeBasicElements(t),o=n.vectors,a=n.circles,s=[],l=0,u=o.length;l<u;++l){var d=o[l],c=Kekule.GeometryUtils.getCrossPointOfVectors(e,d);if(c&&(s.push(c),r))return s}for(l=0,u=a.length;l<u;++l){var h=a[l],p=Kekule.GeometryUtils.getCrossPointsOfVectorToCircle(e,h.center,h.radius,i);if(p&&p.length&&(s=s.concat(p),r))return s}return s}},Kekule.Render.RenderOptionUtils={getOptionDefinitions:function(){return[{name:"expanded",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"unitLength",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"moleculeDisplayType",dataType:DataType.INT,enumSource:Kekule.Render.MoleculeDisplayType,targetClass:Kekule.StructureFragment},{name:"renderType",dataType:DataType.INT,enumSource:Kekule.Render.BondRenderType,targetClass:Kekule.ChemStructureConnector},{name:"nodeDisplayMode",dataType:DataType.INT,enumSource:Kekule.Render.NodeLabelDisplayMode,targetClass:Kekule.ChemStructureNode},{name:"hydrogenDisplayLevel",dataType:DataType.INT,enumSource:Kekule.Render.HydrogenDisplayLevel,targetClass:Kekule.ChemStructureNode},{name:"showCharge",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkType",dataType:DataType.INT,enumSource:Kekule.Render.ChargeMarkRenderType,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkFontSize",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkMargin",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chemMarkerFontSize",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chemMarkerMargin",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"distinguishSingletAndTripletRadical",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"fontSize",dataType:DataType.NUMBER},{name:"fontFamily",dataType:DataType.STRING},{name:"supFontSizeRatio",dataType:DataType.FLOAT},{name:"subFontSizeRatio",dataType:DataType.FLOAT},{name:"superscriptOverhang",dataType:DataType.FLOAT},{name:"subscriptOversink",dataType:DataType.FLOAT},{name:"textBoxXAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxXAlignment},{name:"textBoxYAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxYAlignment},{name:"horizontalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"verticalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"charDirection",dataType:DataType.INT,enumSource:Kekule.Render.TextDirection},{name:"customLabel",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"boldBondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"hashSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingAbs",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondMaxAbsSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowLength",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeHashMinWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondLengthScaleRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"opacity",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"fillColor",dataType:DataType.STRING},{name:"strokeColor",dataType:DataType.STRING},{name:"strokeWidth",dataType:DataType.NUMBER},{name:"atomRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject}]},mergeObjLocalRenderOptions:function(e,t){var r=e&&e.getOverriddenRenderOptions?e.getOverriddenRenderOptions():null;return Kekule.Render.RenderOptionUtils.mergeRenderOptions(r||{},t)},mergeObjLocalRender3DOptions:function(e,t){var r=e&&e.getOverriddenRender3DOptions?e.getOverriddenRender3DOptions():null;return Kekule.Render.RenderOptionUtils.mergeRenderOptions(r||{},t)},mergeRenderOptions:function(e,t){var r=Object.create(t);return r=Object.extend(r,e,!0,!0)},getColor:function(e){return e?e.color:null},getMoleculeDisplayType:function(e){return e?e.moleculeDisplayType:null},getNodeDisplayMode:function(e){return e?e.nodeDisplayMode:null},getHydrogenDisplayLevel:function(e){return e?e.hydrogenDisplayLevel:null},getShowCharge:function(e){return e?e.showCharge:null},getChargeDrawOptions:function(e){if(e){return Object.copyValues({},e,["showCharge","chargeMarkType","chargeMarkFontSize","chargeMarkMargin","chargeMarkCircleWidth","color","opacity"])}return null},getNodeLabelDrawOptions:function(e){if(e){return Object.copyValues({},e,["fontSize","fontFamily","supFontSizeRatio","subFontSizeRatio","superscriptOverhang","subscriptOversink","textBoxXAlignment","textBoxYAlignment","color","opacity"])}return null},getConnectorRenderType:function(e){return e?e.renderType:null},getConnectorDrawParams:function(e){if(e){return Object.copyValues({},e,["bondLineWidth","boldBondLineWidth","hashSpacing","multipleBondSpacingRatio","multipleBondSpacingAbs","multipleBondMaxAbsSpacing","bondArrowLength","bondArrowWidth","bondWedgeWidth","bondWedgeHashMinWidth","color","opacity"])}return null},getConfigPropNames:function(e){for(var t=[],r=e.getAllPropList(),i=0,n=r.getLength();i<n;++i){var o=r.getPropInfoAt(i);e.isConfigProp(o)&&t.push(o.name)}return t},convertConfigsToPlainHash:function(e){var t=Kekule.Render.RenderOptionUtils;return e instanceof Kekule.Render.Render3DConfigs?t.convert3DConfigsToPlainHash(e):t.convert2DConfigsToPlainHash(e)},convert2DConfigsToPlainHash:function(e){var t=Kekule.ObjUtils,r={};r._configs=e;for(var i=Kekule.Render.RenderOptionUtils.getConfigPropNames(e),n=["generalConfigs","moleculeDisplayConfigs","displayLabelConfigs","lengthConfigs"],o=0,a=i.length;o<a;++o){var s=i[o];if(!(n.indexOf(s)>=0)){var l=e.getPropValue(s);if(l.toHash){var u=l.toHash();r=Object.extend(r,u)}}}var d=e.getGeneralConfigs().toHash();return t.replacePropName(d,"drawOpacity","opacity"),r=Object.extend(r,d),d=e.getMoleculeDisplayConfigs().toHash(),t.replacePropName(d,"defMoleculeDisplayType","moleculeDisplayType"),t.replacePropName(d,"defNodeDisplayMode","nodeDisplayMode"),t.replacePropName(d,"defHydrogenDisplayLevel","hydrogenDisplayLevel"),t.replacePropName(d,"defChargeMarkType","chargeMarkType"),(r=Object.extend(r,d)).displayLabelConfigs=e.getDisplayLabelConfigs(),d=e.getLengthConfigs().toHash(),(r=Object.extend(r,d)).unitLength=r.unitLength||1,r},convert3DConfigsToPlainHash:function(e){var t=Kekule.ObjUtils,r={};r._configs=e;for(var i=Kekule.Render.RenderOptionUtils.getConfigPropNames(e),n=["generalConfigs","moleculeDisplayConfigs","environmentConfigs"],o=0,a=i.length;o<a;++o){var s=i[o];if(!(n.indexOf(s)>=0)){var l=e.getPropValue(s);if(l.toHash){var u=l.toHash();r=Object.extend(r,u)}}}var d=e.getGeneralConfigs().toHash();t.replacePropName(d,"drawOpacity","opacity"),r=Object.extend(r,d);d=e.getEnvironmentConfigs().toHash();r=Object.extend(r,d);d=e.getMoleculeDisplayConfigs().toHash();return t.replacePropName(d,"defMoleculeDisplayType","moleculeDisplayType"),t.replacePropName(d,"defBondSpliceMode","bondSpliceMode"),t.replacePropName(d,"defDisplayMultipleBond","displayMultipleBond"),t.replacePropName(d,"defBondColor","bondColor"),t.replacePropName(d,"defAtomColor","atomColor"),r=Object.extend(r,d)},getCascadeRenderOptionValueOfObjs:function(e,t,r){for(var i,n=!1,o=Kekule.ArrayUtils.toArray(e),a=r?"getCascadedRender3DOption":"getCascadedRenderOption",s=0,l=o.length;s<l;++s){var u=o[s];if(u[a]){var d=u[a](t);if(n){if(i!=d)return null}else i=d,n=!0}}return i},setRenderOptionValueOfObjs:function(e,t,r){for(var i=Kekule.ArrayUtils.toArray(e),n=0,o=i.length;n<o;++n){var a=i[n];if(a.setRenderOption)for(var s=Kekule.ObjUtils.getOwnedFieldNames(t),l=0,u=s.length;l<u;++l)a.setRenderOption(s[l],t[s[l]])}}},Kekule.Render.Render3DOptionUtils={getOptionDefinitions:function(){return[{name:"displayMultipleBond",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"useVdWRadius",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"nodeRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"nodeRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"connectorLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"hideHydrogens",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"bondSpliceMode",dataType:DataType.INT,enumSource:Kekule.Render.Bond3DSpliceMode,targetClass:Kekule.ChemStructureObject}]},getConnectorRenderType:function(e){return e?e.renderType:null},convertConfigsToPlainHash:function(e){}},Kekule.Render.RenderColorUtils={getActiveAtomColorSet:function(e){return Kekule.Render.atomColors[e]},setActiveAtomColorSet:function(e,t){var r=Kekule.Render.AtomColorSets[e];return r&&(Kekule.Render.atomColorSet[t]=r),r},getColor:function(e,t){var r=Kekule.Render.RenderColorUtils.getActiveAtomColorSet(t),i=r[e];return i||(i=r[0]),i}},Kekule.Render.UpdateObjUtils={_extractObjsOfUpdateObjDetails:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r];n.obj&&Kekule.ArrayUtils.pushUnique(t,n.obj)}return t},_createUpdateObjDetailsFromObjs:function(e){for(var t=[],r=0,i=e.length;r<i;++r)t.push({obj:e[r]});return t}},function(){"use strict";var e=Kekule.OBJDEF_TEXTS,t=Class.PropertyScope;Kekule.Render.PredefinedConfigsMap=Class.create(Kekule.ConfigPresetMap,{CLASS_NAME:"Kekule.Render.PredefinedConfigsMap"}),Kekule.Render.GeneralConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.GeneralConfigs",initProperties:function(){this.addBoolConfigProp("allowCoordBorrow",!0,{scope:t.PUBLIC}),this.addFloatConfigProp("drawOpacity",1,{title:e.TITLE_DRAWOPACITY,description:e.DES_DRAWOPACITY})}}),Kekule.Render.Render2DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render2DConfigs",initProperties:function(){this.addConfigProp("generalConfigs","Kekule.Render.GeneralConfigs"),this.addConfigProp("moleculeDisplayConfigs","Kekule.Render.MoleculeDisplayConfigs"),this.addConfigProp("displayLabelConfigs","Kekule.Render.DisplayLabelConfigs"),this.addConfigProp("textFontConfigs","Kekule.Render.TextFontConfigs"),this.addConfigProp("lengthConfigs","Kekule.Render.LengthConfigs"),this.addConfigProp("colorConfigs","Kekule.Render.ColorConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("generalConfigs",new Kekule.Render.GeneralConfigs),this.setPropStoreFieldValue("moleculeDisplayConfigs",new Kekule.Render.MoleculeDisplayConfigs),this.setPropStoreFieldValue("displayLabelConfigs",new Kekule.Render.DisplayLabelConfigs),this.setPropStoreFieldValue("textFontConfigs",new Kekule.Render.TextFontConfigs),this.setPropStoreFieldValue("lengthConfigs",new Kekule.Render.LengthConfigs),this.setPropStoreFieldValue("colorConfigs",new Kekule.Render.ColorConfigs),this.setPropStoreFieldValue("environmentConfigs",new Kekule.Render.Render2DEnvironmentConfigs)},initInteractStyleMap:function(){}}),Kekule.ClassUtils.makeSingleton(Kekule.Render.Render2DConfigs),Kekule.Render.getRender2DConfigs=function(){return Kekule.Render.Render2DConfigs.getInstance()},Kekule.Render.Render2DEnvironmentConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render2DEnvironmentConfigs",initProperties:function(){}}),Kekule.Render.MoleculeDisplayConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.MoleculeDisplayConfigs",initProperties:function(){this.addIntConfigProp("defMoleculeDisplayType",Kekule.Render.MoleculeDisplayType.SKELETAL,{enumSource:Kekule.Render.MoleculeDisplayType}),this.addIntConfigProp("defNodeDisplayMode",Kekule.Render.NodeLabelDisplayMode.SMART,{enumSource:Kekule.Render.NodeLabelDisplayMode}),this.addIntConfigProp("defHydrogenDisplayLevel",Kekule.Render.HydrogenDisplayLevel.DEFAULT,{enumSource:Kekule.Render.HydrogenDisplayLevel}),this.addIntConfigProp("defChargeMarkType",Kekule.Render.ChargeMarkRenderType.DEFAULT,{enumSource:Kekule.Render.ChargeMarkRenderType}),this.addBoolConfigProp("distinguishSingletAndTripletRadical",!1),this.addIntConfigProp("partialChargeDecimalsLength",2),this.addBoolConfigProp("autoCreateChargeAndRadicalMarker",!0,{scope:Class.PropertyScope.PUBLIC}),this.addStrConfigProp("bondLineCap","round"),this.addStrConfigProp("bondLineJoin","miter"),this.addStrConfigProp("glyphLineCap","round"),this.addStrConfigProp("glyphLineJoin","miter")}}),Kekule.Render.DisplayLabelConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.DisplayLabelConfigs",DEF_UNSET_ELEMENT:"?",DEF_DUMMY_ATOM:"Du",DEF_HETERO_ATOM:"Q",DEF_ANY_ATOM:"A",DEF_VARIABLE_ATOM:"L",DEF_RGROUP:"R",DEF_ISO_LIST_LEADING_BRACKET:"[",DEF_ISO_LIST_TAILING_BRACKET:"]",DEF_ISO_LIST_DELIMITER:",",DEF_ISO_LIST_DISALLOW_PREFIX:"NOT",initProperties:function(){var e=Kekule.ChemStructureNodeLabels;this.addBoolConfigProp("enableIsotopeAlias",e.ENABLE_ISOTOPE_ALIAS,{getter:function(){return e.ENABLE_ISOTOPE_ALIAS},setter:function(t){e.ENABLE_ISOTOPE_ALIAS=t}}),this.addStrConfigProp("unsetElement",e.UNSET_ELEMENT,{getter:function(){return e.UNSET_ELEMENT},setter:function(t){t&&(e.UNSET_ELEMENT=t)}}),this.addStrConfigProp("dummyAtom",e.DUMMY_ATOM,{getter:function(){return e.DUMMY_ATOM},setter:function(t){t&&(e.DUMMY_ATOM=t)}}),this.addStrConfigProp("heteroAtom",e.HETERO_ATOM,{getter:function(){return e.HETERO_ATOM},setter:function(t){t&&(e.HETERO_ATOM=t)}}),this.addStrConfigProp("anyAtom",e.ANY_ATOM,{getter:function(){return e.ANY_ATOM},setter:function(t){t&&(e.ANY_ATOM=t)}}),this.addStrConfigProp("variableAtom",e.VARIABLE_ATOM,{getter:function(){return e.VARIABLE_ATOM},setter:function(t){t&&(e.VARIABLE_ATOM=t)}}),this.addStrConfigProp("rgroup",e.SUBGROUP,{getter:function(){return e.SUBGROUP},setter:function(t){t&&(e.SUBGROUP=t)}}),this.addStrConfigProp("isoListLeadingBracket",e.ISO_LIST_LEADING_BRACKET,{getter:function(){return e.ISO_LIST_LEADING_BRACKET},setter:function(t){t&&(e.ISO_LIST_LEADING_BRACKET=t)}}),this.addStrConfigProp("isoListTailingBracket",e.ISO_LIST_TAILING_BRACKET,{getter:function(){return e.ISO_LIST_TAILING_BRACKET},setter:function(t){t&&(e.ISO_LIST_TAILING_BRACKET=t)}}),this.addStrConfigProp("isoListDelimiter",e.ISO_LIST_DELIMITER,{getter:function(){return e.ISO_LIST_DELIMITER},setter:function(t){t&&(e.ISO_LIST_DELIMITER=t)}}),this.addStrConfigProp("isoListDisallowPrefix",e.ISO_LIST_DISALLOW_PREFIX,{getter:function(){return e.ISO_LIST_DISALLOW_PREFIX},setter:function(t){t&&(e.ISO_LIST_DISALLOW_PREFIX=t)}}),this.addStrConfigProp("electronicBiasMark",e.DEF_ELECTRONIC_BIAS_MARK,{getter:function(){return e.DEF_ELECTRONIC_BIAS_MARK},setter:function(t){t&&(e.DEF_ELECTRONIC_BIAS_MARK=t)}})}}),Kekule.Render.TextFontConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.TextFontConfigs",DEF_LABEL_FONT_FAMILY:"",initProperties:function(){this.addStrConfigProp("labelFontFamily","Arial, Helvetica, sans-serif"),this.addStrConfigProp("atomFontFamily","Arial, Helvetica, sans-serif"),this.addFloatConfigProp("supFontSizeRatio",.66),this.addFloatConfigProp("subFontSizeRatio",.66),this.addFloatConfigProp("superscriptOverhang",.2),this.addFloatConfigProp("subscriptOversink",.2),this.addIntConfigProp("textCharDirection",Kekule.Render.TextDirection.LTR,{enumSource:Kekule.Render.TextDirection}),this.addIntConfigProp("textHorizontalAlign",Kekule.Render.TextAlign.LEADING,{enumSource:Kekule.Render.TextAlign}),this.addIntConfigProp("textVerticalAlign",Kekule.Render.TextAlign.LEADING,{enumSource:Kekule.Render.TextAlign}),this.addIntConfigProp("textBoxXAlignment",Kekule.Render.BoxXAlignment.LEFT,{enumSource:Kekule.Render.BoxXAlignment,scope:t.PUBLIC}),this.addIntConfigProp("textBoxYAlignment",Kekule.Render.BoxYAlignment.TOP,{enumSource:Kekule.Render.BoxYAlignment,scope:t.PUBLIC}),this.addIntConfigProp("textBoxAlignmentMode",Kekule.Render.TextBoxAlignmentMode.ANCHOR,{enumSource:Kekule.Render.TextBoxAlignmentMode,scope:t.PUBLIC})}}),Kekule.Render.LengthConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.LengthConfigs",initProperties:function(){this.addFloatConfigProp("unitLength",1,{scope:t.PUBLIC}),this.addFloatConfigProp("labelFontSize",14),this.addFloatConfigProp("atomFontSize",14),this.addFloatConfigProp("atomLabelBoxExpandRatio",1.2,{scope:t.PUBLIC}),this.addFloatConfigProp("chargeMarkFontSize",10),this.addFloatConfigProp("chargeMarkMargin",5),this.addFloatConfigProp("chemMarkerFontSize",10),this.addFloatConfigProp("chemMarkerMargin",5),this.addFloatConfigProp("allenCenterAtomRadius",3),this.addFloatConfigProp("defBondLength",25),this.addFloatConfigProp("bondLineWidth",1),this.addFloatConfigProp("boldBondLineWidthRatio",2,{scope:t.PUBLIC}),this.addFloatConfigProp("hashSpacing",3),this.addFloatConfigProp("multipleBondSpacingRatio",.18),this.addFloatConfigProp("multipleBondSpacingAbs",null,{scope:t.PUBLIC}),this.addFloatConfigProp("multipleBondMaxAbsSpacing",5),this.addFloatConfigProp("bondArrowLength",6),this.addFloatConfigProp("bondArrowWidth",6),this.addFloatConfigProp("bondWedgeWidth",6),this.addFloatConfigProp("bondWedgeHashMinWidth",2),this.addFloatConfigProp("bondWavyRadius",5),this.addFloatConfigProp("glyphStrokeWidth",1),this.addFloatConfigProp("glyphStickOffsetRelLength",.1),this.addFloatConfigProp("rxnMolMargin",10,{scope:t.PUBLIC}),this.addFloatConfigProp("defScaleRefLength",Kekule.globalOptions.structure.defaultBondLength2D||.8),this.addFloatConfigProp("autofitContextPadding",45)},getActualLength:function(e){var t=this.getPropValue(e);return null!=t?t*this.getUnitLength():null}}),Kekule.Render.ColorConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.ColorConfigs",initProperties:function(){this.addBoolConfigProp("useAtomSpecifiedColor",!1),this.addStrConfigProp("labelColor","#000000"),this.addStrConfigProp("atomColor","#000000"),this.addStrConfigProp("bondColor","#000000"),this.addStrConfigProp("glyphStrokeColor","#999999"),this.addStrConfigProp("glyphFillColor","#999999")}}),Kekule.Render.Render3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render3DConfigs",initProperties:function(){this.addConfigProp("generalConfigs","Kekule.Render.GeneralConfigs"),this.addConfigProp("moleculeDisplayConfigs","Kekule.Render.Molecule3DDisplayConfigs"),this.addConfigProp("lengthConfigs","Kekule.Render.Length3DConfigs"),this.addConfigProp("environmentConfigs","Kekule.Render.Render3DEnvironmentConfigs"),this.addConfigProp("modelConfigs","Kekule.Render.Model3DConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("generalConfigs",new Kekule.Render.GeneralConfigs),this.setPropStoreFieldValue("environmentConfigs",new Kekule.Render.Render3DEnvironmentConfigs),this.setPropStoreFieldValue("moleculeDisplayConfigs",new Kekule.Render.Molecule3DDisplayConfigs),this.setPropStoreFieldValue("modelConfigs",new Kekule.Render.Model3DConfigs),this.setPropStoreFieldValue("lengthConfigs",new Kekule.Render.Length3DConfigs)}}),Kekule.ClassUtils.makeSingleton(Kekule.Render.Render3DConfigs),Kekule.Render.getRender3DConfigs=function(){return Kekule.Render.Render3DConfigs.getInstance()},Kekule.Render.Render3DEnvironmentConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render3DEnvironmentConfigs",initProperties:function(){this.addIntConfigProp("graphicQuality",Kekule.Render.Render3DGraphicQuality.MEDIUM,{enumSource:Kekule.Render.Render3DGraphicQuality}),this.addBoolConfigProp("antialias",!0)}}),Kekule.Render.Molecule3DDisplayConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Molecule3DDisplayConfigs",initProperties:function(){this.addIntConfigProp("defMoleculeDisplayType",Kekule.Render.Molecule3DDisplayType.BALL_STICK,{enumSource:Kekule.Render.Molecule3DDisplayType}),this.addIntConfigProp("defBondSpliceMode",Kekule.Render.Bond3DSpliceMode.WEIGHTING_SPLIT,{enumSource:Kekule.Render.Bond3DSpliceMode}),this.addBoolConfigProp("defDisplayMultipleBond",!0),this.addStrConfigProp("defBondColor","#FFFFFF"),this.addStrConfigProp("defAtomColor","#000099"),this.addBoolConfigProp("useAtomSpecifiedColor",!0)}}),Kekule.Render.Model3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Model3DConfigs",initProperties:function(){this.addBoolConfigProp("showNodeLabel",!0,{scope:t.PUBLIC}),this.addBoolConfigProp("hideHydrogens",!1),this.addBoolConfigProp("useVdWRadius",!0),this.addFloatConfigProp("nodeRadiusRatio",.25,{scope:t.PUBLIC}),this.addFloatConfigProp("connectorRadiusRatio",.25,{scope:t.PUBLIC}),this.addFloatConfigProp("multiConnectorRadiusRatio",.5),this.addFloatConfigProp("multiConnectorMarginRatio",1)}}),Kekule.Render.Length3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Length3DConfigs",initProperties:function(){this.addFloatConfigProp("unitLength",1,{scope:t.PUBLIC}),this.addFloatConfigProp("fixedNodeRadius",1.7),this.addFloatConfigProp("connectorRadius",.6),this.addFloatConfigProp("connectorLineWidth",2),this.addFloatConfigProp("defBondLength",100,{scope:t.PUBLIC})},getActualLength:function(e){var t=this.getPropValue(e);return null!=t?t*this.getUnitLength():null}})}(),function(){var e=Kekule.Render.RichText,t=Kekule.Render.RichTextUtils,r=Kekule.Render.TextDirection,i=Kekule.Render.TextDrawUtils,n=Kekule.Render.TextAlign;Kekule.Render.AbstractTextDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.AbstractTextDrawBridge",drawText:function(e,t,r,i){return null},canMeasureText:function(e){return!1},measureText:function(e,t,r){return{}},canMeasureDrawnText:function(e){return!1},measureDrawnText:function(e,t,r){return{}},canModifyText:function(e){return!1},modifyDrawnTextCoord:function(e,t,r){},createGroup:function(e){},addToGroup:function(e,t){},removeFromGroup:function(e,t){}}),Kekule.Render.BaseRichTextDrawer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.BaseRichTextDrawer",ITEM_PARENT_FIELD:"__$parent__",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.options=t||{},e&&this.setDrawBridge(e),r&&this.setDrawConfigs(r)},initProperties:function(){this.defineProp("drawBridge",{dataType:"Kekule.Render.AbstractTextDrawBridge",serializable:!1}),this.defineProp("drawConfigs",{dataType:"Kekule.Render.Render2DConfigs",serializable:!1})},fillOptions:function(e){if(e){var t=e.getTextFontConfigs(),r=this.options;r.supFontSizeRatio=t.getSupFontSizeRatio(),r.subFontSizeRatio=t.getSubFontSizeRatio(),r.superscriptOverhang=t.getSuperscriptOverhang(),r.subscriptOversink=t.getSubscriptOversink(),r.textCharDirection=t.getTextCharDirection(),r.textLineDirection=t.getTextLineDirection(),r.textHorizontalAlign=t.getTextHorizontalAlign(),r.textVerticalAlign=t.getTextVerticalAlign(),r.textBoxXAlignment=t.getTextBoxXAlignment(),r.textBoxYAlignment=t.getTextBoxYAlignment(),r.textBoxAlignmentMode=t.getTextBoxAlignmentMode()}},cloneRichText:function(e){return Kekule.Render.RichTextUtils.clone(e)},_FONT_OPTION_FIELDS:["fontSize","fontFamily","fontWeight","fontStyle","color","overhang","oversink","opacity","zoom","transforms"],_DRAW_OPTIONS_FIELDS:["textType","charDirection","defaultCharDirection","fontSize","fontFamily","fontWeight","fontStyle","color","horizontalAlign","verticalAlign","zoom","transforms"],_fillLocalDrawOptions:function(e,t){for(var i=t||{},n=0,o=this._DRAW_OPTIONS_FIELDS.length;n<o;++n){var a=this._DRAW_OPTIONS_FIELDS[n],s=e[a];Kekule.ObjUtils.notUnset(s)&&(i[a]=s,0)}return Kekule.ObjUtils.isUnset(e.charDirection)?i.charDirection=r.DEFAULT:e.charDirection===r.INHERIT&&(i.charDirection=t.charDirection),i},RECT_INFO_FIELD:"__rectInfo__",ACTUAL_FONT_FIELD:"__drawFont__",RENDER_TEXT_FIELD:"__renderText__",RENDER_ELEM_FIELD:"__renderElem__",LOCAL_DRAW_OPTIONS_FIELD:"__drawOptions__",_setItemRectInfo:function(e,t,r){e[this.RECT_INFO_FIELD]={boundRect:Object.extend({},t),alignRect:Object.extend({},r)}},_getItemRectInfo:function(e){return e[this.RECT_INFO_FIELD]},_setActualFontInfo:function(e,t){e[this.ACTUAL_FONT_FIELD]=t},_getActualFontInfo:function(e){return e[this.ACTUAL_FONT_FIELD]},_setRenderText:function(e,t){e[this.RENDER_TEXT_FIELD]=t},_getRenderText:function(e){return e[this.RENDER_TEXT_FIELD]||e.text},_setRenderElem:function(e,t){e[this.RENDER_ELEM_FIELD]=t},_getRenderElem:function(e){return e[this.RENDER_ELEM_FIELD]},_itemHasNoAlignRect:function(e){return Kekule.ObjUtils.notUnset(e._noAlignRect)?!!e._noAlignRect:t.isSubscript(e)||t.isSuperscript(e)},drawEx:function(e,t,r,i,n){var o=this.doPrepareDrawOptions(e,r,i),a=this.cloneRichText(r),s=this.getDrawBridge(),l={delayDrawing:s.canMeasureText(),adjustDrawing:s.canModifyText()};this.doPrepare(e,t,a,o,l,[]);var u=this.doRenderRichText(e,a,o,l),d=this._getItemRectInfo(a);return{drawnObj:u,boundRect:d.boundRect,alignRect:d.alignRect}},draw:function(e,t,r,i,n){return this.drawEx(e,t,r,i,n).drawnObj},measure:function(e,t,r,i,n){var o=this.doPrepareDrawOptions(e,r,i);t||(t={x:0,y:0});var a=this.cloneRichText(r),s=this.getDrawBridge(),l={delayDrawing:s.canMeasureText(),adjustDrawing:s.canModifyText()},u=[];this.doPrepare(e,t,a,o,l,u);var d=this._getItemRectInfo(a);if(u.length&&s.removeDrawnElem)for(var c=0,h=u.length;c<h;++c){var p=u[c];s.removeDrawnElem(e,p)}return d.boundRect},doPrepareDrawOptions:function(e,t,r){var i;return r?(i=Object.create(this.options||{}),i=Object.extend(i,r)):i=this.options,i.defaultCharDirection||(i.defaultCharDirection=i.charDirection),i},doPrepare:function(e,t,r,i,n,o){var a=this.doPrepareItem(e,r,i,n,o),s=null;i.textBoxAlignmentMode===Kekule.Render.TextBoxAlignmentMode.ANCHOR&&(s=this.doGetRootAnchorItemAbsAlignRect(r));var l,u=this._getItemRectInfo(r);if(s){var d=this.doAlignRectToCoord(t,s,i.textBoxXAlignment,i.textBoxYAlignment);l={x:d.left-s.left,y:d.top-s.top}}else{var c=this.doAlignRectToCoord(t,u.alignRect,i.textBoxXAlignment,i.textBoxYAlignment);l={x:c.left-u.alignRect.left,y:c.top-u.alignRect.top}}var h=Kekule.RectUtils.shiftRect(u.alignRect,l.x,l.y),p=Kekule.RectUtils.shiftRect(u.boundRect,l.x,l.y);return this._setItemRectInfo(r,p,h),a},doAlignRectToCoord:function(e,t,r,i){var n=Kekule.Render.BoxXAlignment,o=Kekule.Render.BoxYAlignment,a=r===n.RIGHT?-1:r===n.CENTER?-.5:0,s=i===o.TOP?0:i===o.CENTER?-.5:-1,l=Object.extend({},t);return l.left=e.x+l.width*a,l.top=e.y+l.height*s,l},doGetRootAnchorItemAbsAlignRect:function(e){var t=e;if(t.anchorItem){for(var r=this._getItemRectInfo(t).alignRect,i={x:r.left,y:r.top};t.anchorItem;)t=t.anchorItem,r=this._getItemRectInfo(t).alignRect,i.x+=r.left,i.y+=r.top;return Kekule.RectUtils.createRect(i.x,i.y,r.width,r.height)}return null},doCalcActualDrawFontInfo:function(e,r){function i(e,t){if("string"==typeof e){var r=Kekule.StyleUtils.analysisUnitsValue(e);return r.value=Math.round(Math.max(r.value*t,1)),""+r.value+r.units}return e*t}for(var n={sizeScale:1},o=0,a=this._FONT_OPTION_FIELDS.length;o<a;++o){var s=this._FONT_OPTION_FIELDS[o];Kekule.ObjUtils.notUnset(r[s])&&(n[s]=r[s])}return Kekule.ObjUtils.notUnset(n.zoom)&&(n.fontSize=i(n.fontSize,n.zoom||1),n.zoom=null),t.isSuperscript(e)?(n.sizeScale=r.supFontSizeRatio,n.fontSize=i(n.fontSize,r.supFontSizeRatio),n.isSup=!0,Kekule.ObjUtils.isUnset(n.overhang)&&(n.overhang=r.superscriptOverhang||0)):t.isSubscript(e)&&(n.sizeScale=r.subFontSizeRatio,n.fontSize=i(n.fontSize,r.subFontSizeRatio),n.isSub=!0,Kekule.ObjUtils.isUnset(n.oversink)&&(n.oversink=r.subscriptOversink||0)),n},doPrepareItem:function(i,n,o,a,s){var l,u=t.getItemType(n),d=Object.create(o);switch(((d=this._fillLocalDrawOptions(n,d)).charDirection===r.DEFAULT||Kekule.ObjUtils.isUnset(d.charDirection))&&(d.charDirection=d.defaultCharDirection),u){case e.SECTION:l=this.doPrepareSection(i,n,d,a,s);break;case e.LINES:l=this.doPrepareLines(i,n,d,a,s);break;default:l=this.doPrepareGroup(i,n,d,a,s)}return l},doPrepareSection:function(e,n,o,a,s){var l=this.getDrawBridge(),u=this.doCalcActualDrawFontInfo(n,o);this._setActualFontInfo(n,u);var d,c=n.text;if(i.isVerticalLine(o.charDirection)&&c.length>1){var h=n;h.role="group",delete h.text,h.charDirection=o.charDirection;var p=Object.create(o);p=Object.extend(p,u),h.items=[];for(var g=0,f=c.length;g<f;++g)t.appendText(h,c.charAt(g));return this.doPrepareItem(e,h,p,a,s)}if(o.charDirection===r.RTL&&(c=c.reverse()),this._setRenderText(n,c),a.delayDrawing)d=l.measureText(e,c,u);else{var C=this.getDrawBridge().drawText(e,{x:-1e4,y:-1e4},c,u);this._setRenderElem(n,C),d=l.measureDrawnText(e,C,u),s.push(C)}var m={left:0,top:0,width:d.width||0,height:d.height||0};this._setItemRectInfo(n,m,m)},doPrepareLines:function(e,t,i,n,o){for(var a=i.charDirection||r.DEFAULT,s=t.items,l=a===r.TTB?r.RTL:a===r.BTT?r.LTR:r.TTB,u=0,d=s.length;u<d;++u){var c=s[u];c.charDirection||(c.charDirection=a)}return t.charDirection=l,i.charDirection=l,i._originCharDirection=a,this.doPrepareGroup(e,t,i,n,o)},doPrepareGroup:function(e,o,a,s,l){for(var u=0,d=(B=o.items).length;u<d;++u){var c=B[u];this.doPrepareItem(e,c,a,s,l)}var h,p=a.charDirection||r.DEFAULT,g=a._originCharDirection||p,f=i.isHorizontalLine(p),C=f?"x":"y",m=f?"y":"x",T=n.getAbsAlign(a.horizontalAlign,g),E=n.getAbsAlign(a.verticalAlign,g);h=f?E==n.TOP?0:E==n.CENTER?-.5:-1:T==n.RIGHT?-1:T==n.CENTER?-.5:0;var _={x:0,y:0},S=p===r.RTL||p===r.BTT?-1:1,O=f?"left":"top",y=f?"top":"left",A=[];for(u=0,d=B.length;u<d;++u){c=B[u];var I=(K=this._getItemRectInfo(c)).boundRect,k=K.alignRect;if(S>0){var b=_[C]-I[O];I[O]=_[C],k[O]+=b}var v={x:I.width,y:I.height};if(_[C]+=v[C]*S,S<0){b=_[C]-I[O];I[O]=_[C],k[O]+=b}v={x:k.width,y:k.height};if(!!(M=this._getActualFontInfo(c))&&(M.isSup||M.isSub)&&t.getActualRefItem(c,o))A.push(c);else{var R=M?M.oversink||-(M.overhang||0):0;f||(R=-R);var D=v[m]*(h+R),N=k[y]-D;k[y]=D,I[y]-=N}}for(u=0,d=A.length;u<d;++u){c=A[u];var P=t.getActualRefItem(c,o),M=this._getActualFontInfo(c),K=this._getItemRectInfo(c),L=this._getItemRectInfo(P).alignRect;I=K.boundRect,k=K.alignRect;if(M.isSup){var x=M.overhang;f?(k.top=L.top,k.height=L.height,I.top=L.top-L.height*x):(k.left=L.left,k.width=L.width,I.left=L.lefy+L.width-I.left+L.width*x)}else{R=M.oversink;f?(k.top=L.top,k.height=L.height,I.top=L.top+L.height-I.height+L.height*R):(k.left=L.left,k.width=L.width,I.left=L.left-L.width*R)}}var B,U=null,w=null;for(u=0,d=(B=o.items).length;u<d;++u){c=B[u];K=this._getItemRectInfo(c),this._itemHasNoAlignRect(c)&&(U||u!=d-1)||(U=U?Kekule.RectUtils.getContainerRect(U,K.alignRect):Object.extend({},K.alignRect)),w=w?Kekule.RectUtils.getContainerRect(w,K.boundRect):Object.extend({},K.boundRect)}if(B.length<=0&&(U=Kekule.RectUtils.createRect(0,0,0,0),w=Kekule.RectUtils.createRect(0,0,0,0)),0!==(N={x:-U.left,y:-U.top}).x||0!==N.y){for(u=0,d=B.length;u<d;++u)(K=this._getItemRectInfo(B[u])).alignRect=Kekule.RectUtils.shiftRect(K.alignRect,N.x,N.y),K.boundRect=Kekule.RectUtils.shiftRect(K.boundRect,N.x,N.y);U.left=0,U.top=0,w.left+=N.x,w.top+=N.y}this._setItemRectInfo(o,w,U)},doRenderRichText:function(e,t,r,i){var n=this.getDrawBridge().createGroup(e);return this.doRenderItem(e,{x:0,y:0},t,i,n),n},doRenderItem:function(r,i,n,o,a){var s;switch(t.getItemType(n)){case e.SECTION:s=this.doRenderSection(r,i,n,o,a);break;default:s=this.doRenderGroup(r,i,n,o,a)}return s},doRenderGroup:function(e,t,r,i,n){var o=r.items;if(o.length<=0)return null;for(var a=this._getItemRectInfo(r),s={x:t.x+a.alignRect.left,y:t.y+a.alignRect.top},l=0,u=o.length;l<u;++l)this.doRenderItem(e,s,o[l],i,n)},doRenderSection:function(e,t,r,i,n){var o=this._getItemRectInfo(r).boundRect,a={x:o.left,y:o.top};a=Kekule.CoordUtils.add(a,t);var s,l=this._getRenderText(r),u=this._getActualFontInfo(r),d=this.getDrawBridge();i.delayDrawing?s=d.drawText(e,a,l,u):i.adjustDrawing&&(s=this._getRenderElem(r),d.modifyDrawnTextCoord(e,s,a)),d.addToGroup(s,n)}})}(),Kekule.Render.BoundInfoRecorder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.BoundInfoRecorder",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("boundInfos",new Kekule.TwoTupleMapEx(!0)),this._renderer=e,e&&e.setBoundInfoRecorder&&e.setBoundInfoRecorder(this),this.installEventListener(e)},finalize:function(){this._renderer&&this.uninstallEventListener(this._renderer);var e=this.getPropStoreFieldValue("boundInfos");e&&e.clear(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("boundInfos",{dataType:"Kekule.TwoTupleMapEx",serializable:!1,setter:null}),this.defineProp("targetContext",{dataType:DataType.OBJECT,serializable:!1})},needRecordOnContext:function(e){var t=this.getTargetContext();return!t||t===e},installEventListener:function(e){e.addEventListener("updateBasicDrawObject",this._reactRendererUpdateBasicDrawObject,this),e.addEventListener("clear",this._reactRendererClear,this)},uninstallEventListener:function(e){e.removeEventListener("updateBasicDrawObject",this._reactRendererUpdateBasicDrawObject,this),e.removeEventListener("clear",this._reactRendererClear,this)},_reactRendererUpdateBasicDrawObject:function(e){var t=Kekule.Render.ObjectUpdateType;if(this.needRecordOnContext(e.context)){var r=e.updateType;r===t.ADD?this.add(e.context,e.obj,e.parentObj,e.boundInfo,e.target):r===t.MODIFY?this.modify(e.context,e.obj,e.parentObj,e.boundInfo,e.target):r===t.REMOVE?this.remove(e.context,e.obj):r===t.CLEAR&&this.clear(e.context),this.invokeEvent("updateBasicDrawObject",e)}},_reactRendererClear:function(e){this.needRecordOnContext(e.context)&&this.clearOnRenderer(e.context,e.target);this.getAllRecordedInfoOfContext(e.context)},getInfo:function(e,t){return this.getBoundInfos().get(e,t)},getBelongedInfos:function(e,t){if(a=this.getInfo(e,t))return[a];for(var r=[],i=this.getAllRecordedInfoOfContext(e),n=0,o=i.length;n<o;++n){var a,s=(a=i[n]).obj;(s===t||s.isChildOf&&s.isChildOf(t))&&r.push(a)}return r},getBound:function(e,t){var r=(u=this.getInfo(e,t))?u.boundInfo:null;if(!r){for(var i=Kekule.BoxUtils,n=Kekule.Render.MetaShapeUtils,o=this.getBelongedInfos(e,t),a=null,s=0,l=o.length;s<l;++s){var u=o[s],d=n.getContainerBox(u.boundInfo,0);a=a?i.getContainerBox(a,d):d}a&&(r=n.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:a.x1,y:a.y1},{x:a.x2,y:a.y2}]))}return r},clearOnRenderer:function(e,t){var r=(n=this.getBoundInfos()).getSecondLevelMap(e);if(r)for(var i=r.getKeys(),n=r.getValues(),o=i.length-1;o>=0;--o){var a=i[o];n[o].renderer===t&&r.remove(a)}},clear:function(e){var t=this.getBoundInfos().getSecondLevelMap(e);return t&&t.clear(),this},clearAll:function(){return this.getBoundInfos().clear(),this},add:function(e,t,r,i,n){return this.getBoundInfos().set(e,t,{obj:t,parentObj:r,boundInfo:i,renderer:n}),this},modify:function(e,t,r,i,n){var o=this.getBoundInfos().get(e,t);o||(o={},this.getBoundInfos.set(e,t,o));var a=Kekule.ObjUtils.notUnset;return a(r)&&(o.parentObj=r),a(i)&&(o.boundInfo=i),a(n)&&(o.renderer=n),this},remove:function(e,t,r){return this.getBoundInfos().remove(e,t),this},getAllRecordedInfoOfContext:function(e){var t=this.getBoundInfos().getSecondLevelMap(e);return t?t.getValues():[]},getAllBoundInfosOfContext:function(e){for(var t=this.getAllRecordedInfoOfContext(e),r=[],i=0,n=t.length;i<n;++i){var o=t[i].boundInfo;o&&r.push(o)}return r},getContainerBox:function(e){for(var t=Kekule.BoxUtils,r=Kekule.Render.MetaShapeUtils,i=null,n=this.getAllBoundInfosOfContext(e),o=0,a=n.length;o<a;++o){var s=r.getContainerBox(n[o],0);i=t.getContainerBox(i,s)}return i},getIntersectionInfos:function(e,t,r,i,n){for(var o=[],a=this.getAllRecordedInfoOfContext(e),s=0,l=a.length;s<l;++s){var u=a[s].boundInfo;n&&!n(a[s])||u&&Kekule.Render.MetaShapeUtils.isCoordInside(t,u,i)&&o.push(a[s])}return o}}),function(){var e=Kekule.Render.BondRenderType,t=Kekule.Render.TextDirection,r=Kekule.BoxUtils,i=Kekule.BondOrder,n=Kekule.CoordUtils,o=Kekule.oneOf;Kekule.Render.Abstract2DDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.Abstract2DDrawBridge",CONTEXT_PARAMS_FIELD:"__$context_params__",createContext:function(e,t,r,i){return null},releaseContext:function(e){},getContextParam:function(e,t){return(e[this.CONTEXT_PARAMS_FIELD]||{})[t]},setContextParam:function(e,t,r){e[this.CONTEXT_PARAMS_FIELD]||(e[this.CONTEXT_PARAMS_FIELD]={}),e[this.CONTEXT_PARAMS_FIELD][t]=r},_getOverSamplingRatio:function(e){return this.getContextParam(e,"overSamplingRatio")||null},getContextDimension:function(e){var t=this._getContextRawDimension(e),r=this._getOverSamplingRatio(e);return r&&(t.width/=r,t.height/=r),t},_getContextRawDimension:function(e){return{}},setContextDimension:function(e,t,r){var i={width:t,height:r},n=this._getOverSamplingRatio(e);n&&(i.width*=n,i.height*=n),this._setContextRawDimension(e,i.width,i.height)},_setContextRawDimension:function(e,t,r){return null},getContextElem:function(e){},setContextViewBox:function(e,t,r,i,n,o){},prepareContext:function(e){},clearContext:function(e){return null},setClearColor:function(e,t){},setFilter:function(e,t){},clearFilter:function(e){},transformContextCoordToScreen:function(e,t){var r=t,i=this._getOverSamplingRatio(e);return i&&(r=Kekule.CoordUtils.divide(r,i)),r},transformScreenCoordToContext:function(e,t){var r=t,i=this._getOverSamplingRatio(e);return i&&(r=Kekule.CoordUtils.multiply(r,i)),r},transformContextLengthToScreen:function(e,t){var r=t,i=this._getOverSamplingRatio(e);return i&&(r/=i),r},transformScreenLengthToContext:function(e,t){var r=t,i=this._getOverSamplingRatio(e);return i&&(r*=i),r},canModifyGraphic:function(e){return!1},drawPath:function(e,t,r){},drawLine:function(e,t,r,i){},drawTriangle:function(e,t,r,i,n){},drawRect:function(e,t,r,i){},drawRoundRect:function(e,t,r,i,n){},drawCircle:function(e,t,r,i){},drawArc:function(e,t,r,i,n,o,a){},drawImage:function(e,t,r,i,n,o){},drawImageElem:function(e,t,r,i,n){},createGroup:function(e){return null},addToGroup:function(e,t){},removeFromGroup:function(e,t){},removeDrawnElem:function(e,t){},exportToDataUri:function(e,t,r){}}),Kekule.Render.Base2DRenderer=Class.create(Kekule.Render.CompositeRenderer,{CLASS_NAME:"Kekule.Render.Base2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this.__$redirectContextDebug__=!1,this._richTextDrawer=null},initProperties:function(){this.defineProp("richTextDrawerClass",{dataType:DataType.CLASS,serializable:!1})},getActualTargetContext:function(e){return this.getRedirectContext()||e},getRendererType:function(){return Kekule.Render.RendererType.R2D},canMeasureText:function(e){return this.getDrawBridge().canMeasureText(e)},getAutoScaleRefDrawLength:function(e){return e.defBondLength},getAutoScaleRefObjLength:function(e,t){var r=e||this.getChemObj();if(!r.getAllAutoScaleRefLengths)return null;var i=r.getAllAutoScaleRefLengths(Kekule.CoordMode.COORD2D,t);return i&&i.length?Kekule.ArrayUtils.getMedian(i):void 0},getRichTextDrawer:function(){if(!this._richTextDrawer){var e=this.getRichTextDrawerClass()||Kekule.Render.BaseRichTextDrawer;this._richTextDrawer=new e(this.getDrawBridge())}return this._richTextDrawer},drawPath:function(e,t,r){return this.getDrawBridge().drawPath(this.getActualTargetContext(e),t,r)},drawLine:function(e,t,r,i){if(this.__$redirectContextDebug__){var n=Object.create(i);return this.getRedirectContext()&&(n.color=n.strokeColor="#ff0000"),this.getDrawBridge().drawLine(this.getActualTargetContext(e),t,r,n)}return this.getDrawBridge().drawLine(this.getActualTargetContext(e),t,r,i)},drawArrowLine:function(e,t,r,i,n){var o=this.getActualTargetContext(e);if(i){var a=this.createDrawGroup(o),s=this.drawLine(o,t,r,n);this.addToDrawGroup(s,a);var l=r.x-t.x,u=r.y-t.y,d=Math.atan(u/l),c=Math.sign(l)||1,h=(i.width||6)/2,p=i.length||3,g=Math.atan(h/p),f=Math.sqrt(Math.sqr(h)+Math.sqr(p))*c,C=Math.cos(d-g)*f,m=Math.sin(d-g)*f,T=Math.cos(d+g)*f,E=Math.sin(d+g)*f;return s=this.drawLine(o,r,{x:r.x-C,y:r.y-m},n),this.addToDrawGroup(s,a),s=this.drawLine(o,r,{x:r.x-T,y:r.y-E},n),this.addToDrawGroup(s,a),a}return this.drawLine(o,t,r,n)},drawTriangle:function(e,t,r,i,n){return this.getDrawBridge().drawTriangle(this.getActualTargetContext(e),t,r,i,n)},drawRect:function(e,t,r,i){var n={x:Math.min(t.x,r.x),y:Math.min(t.y,r.y)},o={x:Math.max(t.x,r.x),y:Math.max(t.y,r.y)};return this.getDrawBridge().drawRect(this.getActualTargetContext(e),n,o,i)},drawRoundRect:function(e,t,r,i,n){var o={x:Math.min(t.x,r.x),y:Math.min(t.y,r.y)},a={x:Math.max(t.x,r.x),y:Math.max(t.y,r.y)};return this.getDrawBridge().drawRoundRect(this.getActualTargetContext(e),o,a,i,n)},drawCircle:function(e,t,r,i){return this.getDrawBridge().drawCircle(this.getActualTargetContext(e),t,r,i)},drawArc:function(e,t,r,i,n,o,a){return this.getDrawBridge().drawArc(this.getActualTargetContext(e),t,r,i,n,o,a)},drawText:function(e,t,r,i){var n=this.getRichTextDrawer(),o=Kekule.Render.RichTextUtils.strToRichText(r,i);if(this.__$redirectContextDebug__){var a=Object.create(i||{});return this.getRedirectContext()&&(a.color=a.strokeColor="#ff0000"),n.drawEx(this.getActualTargetContext(e),t,o,a)}return n.drawEx(this.getActualTargetContext(e),t,o,i)},drawRichText:function(e,t,r,i){var n=this.getRichTextDrawer();if(this.__$redirectContextDebug__){var o=Object.create(i||{});return this.getRedirectContext()&&(o.color=o.strokeColor="#ff0000"),n.drawEx(this.getActualTargetContext(e),t,r,o)}return n.drawEx(this.getActualTargetContext(e),t,r,i)},measureRichText:function(e,t,r,i){return this.getRichTextDrawer().measure(e,t,r,i)},drawImage:function(e,t,r,i,n,o){var a=this;return this.getDrawBridge().drawImage(this.getActualTargetContext(e),t,r,i,n,o,function(){return a.getActualTargetContext(e)})},drawImageElem:function(e,t,r,i,n){if(t.complete)return this.getDrawBridge().drawImageElem(this.getActualTargetContext(e),t,r,i,n);var o=Kekule.X.Event;if(o){var a=this,s=function(){o.removeListener(t,"load",l)},l=function(){s(),a.update(a.getActualTargetContext(e),[{obj:a.getChemObj()}],Kekule.Render.ObjectUpdateType.MODIFY)};o.addListener(t,"load",l),o.addListener(t,"error",s)}},createDrawGroup:function(e){return this.getDrawBridge().createGroup(this.getActualTargetContext(e))},addToDrawGroup:function(e,t){return this.getDrawBridge().addToGroup(e,t)},removeFromDrawGroup:function(e,t){return this.getDrawBridge().removeFromGroup(e,t)},removeDrawnElem:function(e,t){return this.getDrawBridge().removeDrawnElem(this.getActualTargetContext(e),t)},transformScreenCoordToContext:function(e,t){return this.doTransformScreenCoordToContext(this.getActualTargetContext(e),t)},doTransformScreenCoordToContext:function(e,t){var r=this.getDrawBridge();return r&&r.transformScreenCoordToContext?r.transformScreenCoordToContext(this.getActualTargetContext(e),t):t}}),Kekule.Render.ChemObj2DRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.Render.ChemObj2DRenderer",_getRenderSortIndex:function(){var e=this.getChemObj();return e&&e.coordStickTarget&&e.getCoordStickTarget()?1:this.tryApplySuper("_getRenderSortIndex")},doEstimateSelfObjBox:function(e,t,r){return Kekule.Render.ObjUtils.getContainerBox(this.getChemObj(),this.getCoordMode(),r)},doEstimateRenderBox:function(e,t,i,n){var o=this.estimateObjBox(e,i,n);if(o){var a=this.prepareTransformParams(e,t,i,o);return r.transform2D(o,a)}return null},doGetAutoBaseCoord:function(e){var t=e.transformParams;if(t){var r=this.getChemObj(),i=r.getAbsBaseCoord?r.getAbsBaseCoord(Kekule.CoordMode.COORD2D):r.getAbsBaseCoord2D?r.getAbsBaseCoord2D():null;if(i)return Kekule.CoordUtils.transform2D(i,t)}return null},doDraw:function(e,t,r){var i=this.getAutoScaleRefObjLength(this.getChemObj(),r.allowCoordBorrow);return r.medianObjRefLength=i||r.defScaleRefLength,this.prepareTransformParams(e,t,r),this.prepareGeneralOptions(e,r),this.tryApplySuper("doDraw",[e,t,r])},prepareGeneralOptions:function(e,t){},prepareTransformParams:function(e,t,r,i){var n;if(r.transformParams)n=r.transformParams;else{r.unitLength||(r.unitLength=1);var o=this.getDrawBridge()._getOverSamplingRatio(e);o&&1!==o&&(r.unitLength*=o);var a=this.generateTransformParams(e,t,r,i);r.transformParams=a,n=a,r.transformParams.zoom&&(r.zoom=r.transformParams.zoom)}var s=Kekule.CoordUtils.calcTransform2DMatrix(n),l=Kekule.CoordUtils.calcInverseTransform2DMatrix(n);r.transformParams.transformMatrix=s,r.transformParams.invTransformMatrix=l,this.getRenderCache(e).transformParams=n,this.getRenderCache(e).transformMatrix=s,this.getRenderCache(e).invTransformMatrix=l;var u=this.calcContextRefLengthes(e,r,s);return r.contextRefLengthes={x:u.contextRefLengthX,y:u.contextRefLengthY,xy:u.contextRefLengthXY},n},calcContextRefLengthes:function(e,t,r){var i=t.defScaleRefLength,o=n.transform2DByMatrix({x:0,y:0},r),a=n.transform2DByMatrix({x:i,y:0},r),s=n.transform2DByMatrix({x:0,y:i},r),l=n.transform2DByMatrix({x:i,y:i},r);return{contextRefLengthX:n.getDistance(a,o),contextRefLengthY:n.getDistance(s,o),contextRefLengthXY:n.getDistance(l,o)/Math.sqrt(2)}},calcPreferedTransformOptions:function(e,t,r,i){var n={};n.allowCoordBorrow=o(r.allowCoordBorrow,!1),n.unitLength=r.unitLength||1,i||(i=this.estimateObjBox(e,r,n.allowCoordBorrow)),i||(i={x1:0,x2:1,y1:0,y2:1});var a={x:(i.x1+i.x2)/2,y:(i.y1+i.y2)/2},s=Kekule.ObjUtils;if(s.isUnset(r.translateX)&&s.isUnset(r.translateY)?t&&(n.translateX=t.x-a.x,n.translateY=t.y-a.y):(n.translateX=r.translateX||0,n.translateY=r.translateY||0),n.zoom=r.zoom||1,r.scale||r.scaleX||r.scaleY)n.scaleX=o(r.scaleX,r.scale,1),n.scaleY=o(r.scaleY,r.scale,1);else{var l,u=(o(r.refDrawLength,this.getAutoScaleRefDrawLength(r))||1)*n.unitLength,d=r.medianObjRefLength;if(Kekule.ObjUtils.isUnset(d)&&(d=r.defScaleRefLength),l=u/d||1,r.autofit||r.autoShrink){var c=this.getDrawBridge().getContextDimension(e);c.x=c.width,c.y=c.height,(c=this.getDrawBridge().transformScreenCoordToContext(e,c)).width=c.x,c.height=c.y;var h=r.autofitContextPadding;h*=2*n.unitLength,i.width=i.x2-i.x1,i.height=i.y2-i.y1;var p=Math.max(c.width-h,0)/(i.width||1),g=Math.max(c.height-h,0)/(i.height||1),f=Math.min(p,g),C=f/l;s.isUnset(r.retainAspect)||r.retainAspect?(n.scaleX=n.scaleY=l,r.autofit?n.zoom*=C:r.autoShrink&&f<l&&(n.zoom*=C)):r.autofit?(n.scaleX=(p<g?1:p/g)*l,n.scaleY=(g<p?1:g/p)*l,n.zoom*=C):r.autoShrink&&(n.zoom*=C,C<1?n.scaleX=n.scaleY=l:p<g?(n.scaleX=l,n.scaleY=l*g/p):(n.scaleY=l,n.scaleX=l*p/g))}else n.scaleX=n.scaleY=l}return s.notUnset(r.rotateAngle)&&(n.rotateAngle=r.rotateAngle),s.isUnset(r.center)?n.center=a:n.center=r.center,n.drawBaseCoord=t||Kekule.CoordUtils.transform2D(a,n),n},generateTransformParams:function(e,t,r,i){var n=this.calcPreferedTransformOptions(e,t,r,i),o=Object.extend({},n);return(n=this.getFinalTransformParams(e,n)).initialTransformOptions=o,n},getFinalTransformParams:function(e,t){var r=Object.create(t);return r.zoom&&(r.scaleX*=r.zoom,r.scaleY*=r.zoom),r.scaleY=-r.scaleY,r.unitLength,r},getRenderFinalTransformParams:function(e){return this.getRenderCache(e).transformParams},getRenderInitialTransformOptions:function(e){var t=this.getRenderFinalTransformParams(e);return t?t.initialTransformOptions:null},doTransformCoordToObj:function(e,t,r){var i=this.getRenderCache(e).invTransformMatrix;return Kekule.CoordUtils.transform2DByMatrix(r,i)},doTransformCoordToContext:function(e,t,r){var i=this.getRenderCache(e).transformMatrix;return Kekule.CoordUtils.transform2DByMatrix(r,i)}}),Kekule.Render.RichTextBased2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.RichTextBased2DRenderer",DRAWN_OBJ_FIELD:"__$drawnObj__",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this.__$alwaysRecalcSize__=!1,this.__$isRecalculatingSize=!1},getDrawnObj:function(e){return this.getExtraProp(e,this.DRAWN_OBJ_FIELD)},setDrawnObj:function(e,t){this.setExtraProp(e,this.DRAWN_OBJ_FIELD,t)},getRichText:function(e,t){return null},extractRichTextDrawOptions:function(e){var t=Object.create(e||{});return t.horizontalAlign=o(t.horizontalAlign,t.textHorizontalAlign),t.verticalAlign=o(t.verticalAlign,t.textVerticalAlign),t.charDirection=o(t.charDirection,t.textCharDirection),t},getDrawTextCoord:function(e,t){return t},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var i=this.getChemObj(),n=(r.transformParams,this.getRichText(this.getChemObj(),r));if(!n)return null;t||(t=this.getAutoBaseCoord(r));var o=this.getDrawTextCoord(e,t),a=this.extractRichTextDrawOptions(r);a.fontSize&&(a.fontSize*=a.unitLength||1);var s=this.drawRichText(e,o,n,a),l=s.boundRect,u=this.createRectBoundInfo({x:l.left,y:l.top},{x:l.left+l.width,y:l.top+l.height});return this.basicDrawObjectUpdated(e,i,i,u,Kekule.Render.ObjectUpdateType.ADD),this.getRenderCache(e).drawnObj=s.drawnObj,this.setDrawnObj(e,s.drawnObj),(this.getCanModifyTargetObj()&&i.getNeedRecalcSize&&i.getNeedRecalcSize()||this.__$alwaysRecalcSize__)&&this._autosetObjSize(e,i,u),s.drawnObj},_autosetObjSize:function(e,t,r){if(!this.__$isRecalculatingSize&&t.hasProperty("size2D")&&t.setNeedRecalcSize){this.__$isRecalculatingSize=!0;try{var i=r.coords,n=this.transformCoordToObj(e,t,i[0]),o=this.transformCoordToObj(e,t,i[1]),a=Kekule.CoordUtils.substract(o,n);t.setPropStoreFieldValue("size2D",{x:Math.abs(a.x),y:Math.abs(a.y)}),t.setNeedRecalcSize(!1)}finally{this.__$isRecalculatingSize=!1}}}}),Kekule.Render.TextBlock2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.TextBlock2DRenderer",getRichText:function(e,t){return Kekule.Render.RichTextUtils.strToRichText(e.getText())},doEstimateSelfObjBox:function(e,t,r){return this.getChemObj().getBox2D(r)},getDrawTextCoord:function(e,t){var r=this.getChemObj(),i=r.getExposedContainerBox(),n={x:i.x1,y:i.y2},o={x:i.x2,y:i.y1},a=this.transformCoordToContext(e,r,n),s=this.transformCoordToContext(e,r,o),l=Kekule.CoordUtils.substract(s,a);return{x:t.x-l.x/2,y:t.y-l.y/2}},extractRichTextDrawOptions:function(e){var t=this.tryApplySuper("extractRichTextDrawOptions",[e]);return t.fontSize=o(t.fontSize,t.labelFontSize),t.fontFamily=o(t.fontFamily,t.labelFontFamily),t.color=o(t.color,t.labelColor),t.textBoxXAlignment=Kekule.Render.BoxXAlignment.LEFT,t.textBoxYAlignment=Kekule.Render.BoxYAlignment.TOP,t}}),Kekule.Render.Formula2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.Formula2DRenderer",basicDrawObjectUpdated:function(e,t,r,i,n){return t===this.getChemObj()?this.tryApplySuper("basicDrawObjectUpdated",[e,t.getParent(),t.getParent(),i,n]):this.tryApplySuper("basicDrawObjectUpdated",[e,t,r,i,n])},getRichText:function(e,t){return e.getDisplayRichText(!0,t.displayLabelConfigs,t.partialChargeDecimalsLength,t.chargeMarkType)},doEstimateSelfObjBox:function(e,t,i){var n=this.getChemObj()?this.getChemObj().getParent():null;if(n){var o=n?n.getAbsBaseCoord2D(i):{x:0,y:0};return r.createBox(o,o)}return null},extractRichTextDrawOptions:function(e){var t=this.tryApplySuper("extractRichTextDrawOptions",[e]);return t.fontSize=o(t.fontSize,t.atomFontSize),t.fontFamily=o(t.fontFamily,t.atomFontFamily),t.color=o(t.color,t.labelColor,t.atomColor),t.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER,t.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER,t}}),Kekule.Render.TextBasedChemMarker2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.TextBasedChemMarker2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},doDrawSelf:function(e,t,r){return this.tryApplySuper("doDrawSelf",[e,t,r])},getRichText:function(e,t){var r,i=this.getChemObj();if(i instanceof Kekule.ChemMarker.Charge){var n=i.getValue();if(r=Kekule.Render.ChemDisplayTextUtils.getChargeExDisplayText(n&&n.charge,n&&n.electronicBias,t.partialChargeDecimalsLength,t.displayLabelConfigs.getElectronicBiasMark(),t.chargeMarkType))return Kekule.Render.RichTextUtils.createSection(r,{charDirection:Kekule.Render.TextDirection.LTR})}else if(i instanceof Kekule.ChemMarker.Radical){var o=i.getValue();if(r=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(o,t.distinguishSingletAndTripletRadical))return Kekule.Render.RichTextUtils.createSection(r,{charDirection:Kekule.Render.TextDirection.LTR})}return null},doEstimateSelfObjBox:function(e,t,r){return this.tryApplySuper("doEstimateSelfObjBox",[e,t,r])},extractRichTextDrawOptions:function(e){var t=this.tryApplySuper("extractRichTextDrawOptions",[e]),r=this.getChemObj();return t.fontSize=o(r.getRenderOption("fontSize"),t.chemMarkerFontSize,t.fontSize,t.atomFontSize),t.fontFamily=o(t.fontFamily,t.atomFontFamily),t.color=o(t.color,t.atomColor,t.labelColor),t.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER,t.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER,t}}),Kekule.Render.ImageBlock2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.ImageBlock2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var i=this.getChemObj();r.transformParams;if(!i||!i.getSrc||!i.getSrc())return null;t||(t=this.getAutoBaseCoord(r));var n,o=i.getExposedContainerBox(),a={x:o.x1,y:o.y2},s={x:o.x2,y:o.y1},l=this.transformCoordToContext(e,i,a),u=this.transformCoordToContext(e,i,s),d=Kekule.CoordUtils.substract(u,l),c={x:t.x-d.x/2,y:t.y-d.y/2},h=i.getCacheImg();return n=h?this.drawImageElem(e,h,c,d,r):this.drawImage(e,i.getSrc(),c,d,r),this.basicDrawObjectUpdated(e,i,i,this.createRectBoundInfo(c,Kekule.CoordUtils.add(c,d)),Kekule.Render.ObjectUpdateType.ADD),n}}),Kekule.Render.UnbondedElectronSetRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.UnbondedElectronSetRenderer",_extractActualDrawOptions:function(e){var t=Object.create(e),r=this.getChemObj();return t.fontSize=o(r.getRenderOption("fontSize"),t.chargeMarkFontSize,t.fontSize,t.atomFontSize),t.color=o(t.color,t.atomColor,t.labelColor),t.strokeColor=t.color,t.fillColor=t.color,t.electronGap=t.fontSize/3*(t.unitLength||1)*(t.zoom||1),t.electronRadius=t.fontSize/12*(t.unitLength||1)*(t.zoom||1),t},_drawSingleElectron:function(e,t,r,i){return this.drawCircle(e,t,r,i)},_drawElectrons:function(e,t,r,i,o){var a=n.substract(r,i),s=n.getDistance(a);if(0===s)var l=0,u=1;else l=a.x/s,u=a.y/s;for(var d,c,h=o.electronGap,p=o.electronRadius,g={x:h*u,y:-h*l},f=(t-1)/2,C=n.substract(r,n.multiply(g,f)),m=[],T=t>1?this.createDrawGroup(e):null,E=0;E<t;++E)m.push(C),d=this._drawSingleElectron(e,C,p,o),T&&this.addToDrawGroup(d,T),C=n.add(C,g);if(m.length<=1)c=this.createCircleBoundInfo(m[0],p);else{var _=n.multiply(g,2*p/h),S=n.substract(m[0],_),O=n.add(m[t-1],_);c=this.createLineBoundInfo(S,O,p)}return{electronCoords:m,drawnElem:T||d,electronRadius:p,boundInfo:c}},_doGetParentCoord:function(e,t,r){var i=r.transformParams;if(i){var o=t,a=o.getAbsBaseCoord?o.getAbsBaseCoord(Kekule.CoordMode.COORD2D):o.getAbsBaseCoord2D?o.getAbsBaseCoord2D():null;if(a)return n.transform2D(a,i)}return null},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var i=this._extractActualDrawOptions(r),n=this.getChemObj(),o=n.getParent();r.transformParams;if(!n||!o||!n.getElectronCount||(n.getElectronCount()||0)<=0)return null;t||(t=this.getAutoBaseCoord(r));var a=this._doGetParentCoord(e,o,r);if(!t||!a)return null;var s=this._drawElectrons(e,n.getElectronCount(),t,a,i);s.electronCoords,s.electronRadius;return this.basicDrawObjectUpdated(e,n,o,s.boundInfo,Kekule.Render.ObjectUpdateType.ADD),s.drawnElem}}),Kekule.Render.Ctab2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.Ctab2DRenderer",DRAW_ELEM_FIELD:"__$drawElem__",TRANSFORM_COORD_FIELD:"__$transCoord2D__",TRANSFORM_MATRIX_FIELD:"__$transMatrix__",RENDERED_OBJS_FIELD:"__$renderedObjs__",INV_TRANSFORM_MATRIX_FIELD:"__$inverseTransMatrix__",CHILD_TRANSFORM_MATRIX_FIELD:"__$childTransMatrix__",_getRenderSortIndex:function(){for(var e=this.getChemObj().getExposedNodes(),t=0,r=e.length;t<r;++t){var i=e[t];if(i&&i.coordStickTarget&&i.getCoordStickTarget())return 1}return this.tryApplySuper("_getRenderSortIndex")},doEstimateSelfObjBox:function(e,t,r){return this.getChemObj().getExposedContainerBox2D(r)},getObjDrawElem:function(e,t){return this.getExtraProp2(e,t,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(e,t,r){this.setExtraProp2(e,t,this.DRAW_ELEM_FIELD,r)},getRenderedObjs:function(e){return this.getExtraProp(e,this.RENDERED_OBJS_FIELD)},addRenderedObj:function(e,t){var r=this.getRenderedObjs(e);r?Kekule.ArrayUtils.pushUnique(r,t):(r=[t],this.setExtraProp(e,this.RENDERED_OBJS_FIELD,r))},removeRenderedObj:function(e,t){var r=this.getRenderedObjs(e);r&&Kekule.ArrayUtils.remove(r,t)},clearRenderedObj:function(e){this.setExtraProp(e,this.RENDERED_OBJS_FIELD,null)},prepareGeneralOptions:function(e,t){return this.tryApplySuper("prepareGeneralOptions",[e,t])},doPrepare:function(e,t,r,i){this.tryApplySuper("doPrepare",[e,t,r,i]),this.doPrepareLayout(e,t,r,i)},doPrepareLayout:function(e,t,r,i){},handleNodeSpecifiedRenderOptions:function(e,t){var r=(e.getOverriddenRenderOptions?e.getOverriddenRenderOptions():null)||{},i=Object.create(t);return i=Object.extend(i,r)},handleConnectorSpecifiedRenderOptions:function(e,t){var r=(e.getOverriddenRenderOptions?e.getOverriddenRenderOptions():null)||{},i=Object.create(t||null);return i=Object.extend(i,r)},isChemObjRenderedBySelf:function(e,t){var r=this.getRenderedObjs(e);return this.tryApplySuper("isChemObjRenderedBySelf",[e,t])||r&&r.indexOf(t)>=0||this.getChemObj().hasChildObj(t)&&(!t.isExposed||t.isExposed())},isChemObjRenderedDirectlyBySelf:function(e,t){var r=this.getRenderedObjs(e);return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[e,t])||r&&r.indexOf(t)>=0},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var i=this.getChemObj();this._ctab=i;var n=r.transformParams;return this.getRenderCache(e).transformOptions=n,this.transformCtabCoords2DToContext(e,i,n),this.doPrepare(e,i,t,r),this.getRenderCache(e).appliedOptions=r,this.doDrawCore(e,i,r,n)},doRedraw:function(e){var t=this.getRenderCache(e);return this.doDrawCore(e,this.getChemObj(),t.appliedOptions,t.transformOptions)},doDrawCore:function(e,t,r,i){this.clearRenderedObj(e);var n=this.createDrawGroup(e);return this.doDrawConnectors(e,n,t,r,i),this.doDrawNodes(e,n,t,r,i),this.setObjDrawElem(e,t,n),n},doUpdateSelf:function(e,t,r){if(this.canModifyGraphic(e)){var i=!1,n=Kekule.Render.ObjectUpdateType;switch(r){case n.ADD:i=this.doAddNew(e,t);break;case n.MODIFY:i=this.doModify(e,t);break;case n.REMOVE:i=this.doRemove(e,Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(t));break;default:return this.tryApplySuper("doUpdateSelf",[e,t,r])}return i}return this.tryApplySuper("doUpdateSelf",[e,t,r])},doAddNew:function(e,t){return!!this.canModifyGraphic()&&this.doModify(e,t)},doModify:function(e,t){if(this.canModifyGraphic()){var r=this._extractObjsOfUpdateObjDetails(t);this.remove(e,r);var i=this.getChemObj(),n=this.getObjDrawElem(e,i),o=this.getRenderCache(e),a=o.appliedOptions;r.indexOf(i)>=0&&this.draw(e,o.baseCoord,a);for(var s=0,l=r.length;s<l;++s){var u=r[s];if(!u.isExposed||u.isExposed())if(i.hasConnector(u)){var d=this.handleConnectorSpecifiedRenderOptions(u,a);this.doDrawConnector(e,n,u,this.getChemObj(),d,o.transformParams||{})}else if(i.hasNode(u)){d=this.handleNodeSpecifiedRenderOptions(u,a);this.doDrawNode(e,n,u,this.getChemObj(),d,o.transformParams)}}return!0}return!1},doRemove:function(e,t){if(this.canModifyGraphic()){for(var r=Kekule.ArrayUtils.toArray(t),i=0,n=r.length;i<n;++i){var o=r[i],a=this.getObjDrawElem(e,o);if(a){var s=this.getObjDrawElem(e,this.getChemObj());this.removeFromDrawGroup(a,s),this.removeDrawnElem(e,a)}this.removeRenderedObj(e,o),this.removeExtraProp2(e,o),this.basicDrawObjectUpdated(e,o,this.getChemObj(),null,Kekule.Render.ObjectUpdateType.REMOVE)}return!0}return!1},getCoordTransformOptions:function(e){return this.getRenderCache(e).transformOptions},transformCtabCoords2DToContext:function(e,t,r){var i=r.allowCoordBorrow,n=Object.extend({},r);n.centerX=0,n.centerY=0;var o=r.transformMatrix;this.setExtraProp2(e,t,this.TRANSFORM_MATRIX_FIELD,o);var a=o;this.setExtraProp2(e,t,this.CHILD_TRANSFORM_MATRIX_FIELD,o);var s=r.invTransformMatrix;this.setExtraProp2(e,t,this.INV_TRANSFORM_MATRIX_FIELD,s);for(var l=0,u=t.getNodeCount();l<u;++l){var d=t.getNodeAt(l);this.transformObjCoord2DToContext(e,d,o,a,i)}},transformObjCoord2DToContext:function(e,t,r,i,n){var o;if(t&&t.getAbsBaseCoord2D){var a=t.getAbsBaseCoord2D(n);if(a){var s=Kekule.CoordUtils.transform2DByMatrix(a,r);this.setTransformedCoord2D(e,t,s),o=s}if(t.getNodes)for(var l=0,u=t.getNodeCount();l<u;++l)this.transformObjCoord2DToContext(e,t.getNodeAt(l),i,i,n)}return o},getTransformedCoord2D:function(e,t,r){Kekule.ObjUtils.isUnset(r)&&(r=this.getRenderCache(e).options.transformParams.allowCoordBorrow);var i=t instanceof Kekule.BaseStructureNode,n=t.getParent(),o=i&&n&&n instanceof Kekule.BaseStructureConnector,a=i&&!o&&this.getExtraProp2(e,t,this.TRANSFORM_COORD_FIELD);if(!a){var s=this.getChemObj(),l=this.getExtraProp2(e,s,this.TRANSFORM_MATRIX_FIELD),u=this.getExtraProp2(e,s,this.CHILD_TRANSFORM_MATRIX_FIELD);a=s&&(s.hasNode(t,!1)||s.hasConnector(t,!1))?this.transformObjCoord2DToContext(e,t,l,u,r):this.transformObjCoord2DToContext(e,t,u,u,r)}return a},setTransformedCoord2D:function(e,t,r){this.setExtraProp2(e,t,this.TRANSFORM_COORD_FIELD,r)},doTransformCoordToObj:function(e,t,r){var i=this.getExtraProp2(e,t,this.INV_TRANSFORM_MATRIX_FIELD);return i?Kekule.CoordUtils.transform2DByMatrix(r,i):this.tryApplySuper("doTransformCoordToObj",[e,t,r])},doTransformCoordToContext:function(e,t,r){var i=this.getExtraProp2(e,t,this.TRANSFORM_MATRIX_FIELD);return i?Kekule.CoordUtils.transform2DByMatrix(r,i):this.tryApplySuper("doTransformCoordToContext",[e,t,r])},doDrawNodes:function(e,t,r,i,n){for(var o=r.getExposedNodes(),a=0,s=o.length;a<s;++a){var l=o[a],u=this.handleNodeSpecifiedRenderOptions(l,i);this.doDrawNode(e,t,l,r,u,n)}},doDrawNode:function(e,t,r,i,n,o){},doDrawConnectors:function(e,t,r,i,n){for(var o=r.getExposedConnectors(),a=0,s=o.length;a<s;++a){var l=o[a],u=this.handleConnectorSpecifiedRenderOptions(l,i);this.doDrawConnector(e,t,l,r,u,n)}},doDrawConnector:function(e,t,r,i,n,o){var a,s,l,u,d=r.getConnectedExposedObjs(),c=d.length;if(c<2)return null;for(var h,p=c>2?this.createDrawGroup(e):null,g=c>2?[]:null,f=n,C=0;C<c;++C)if(s=d[C],this.getTransformedCoord2D(e,s,o.allowCoordBorrow))for(var m=C+1;m<c;++m)if(l=d[m],this.getTransformedCoord2D(e,l,o.allowCoordBorrow)&&(h=this.doDrawConnectorShape(e,r,[s,l],f,o))){(u=h.element)&&p&&this.addToDrawGroup(u,p);var T=h.boundInfo;g&&T&&g.push(T)}return(a=p||u)&&t&&this.addToDrawGroup(a,t),a?this.setObjDrawElem(e,r,a):this.setObjDrawElem(e,r,null),this.addRenderedObj(e,r),(T||g)&&this.basicDrawObjectUpdated(e,r,i,g||T,Kekule.Render.ObjectUpdateType.ADD),a},doDrawConnectorShape:function(e,t,r,i,n){}}),Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.Render.Ctab2DRenderer),Kekule.Render.ChemCtab2DRenderer=Class.create(Kekule.Render.Ctab2DRenderer,{CLASS_NAME:"Kekule.Render.ChemCtab2DRenderer",OBJ_NEED_LABEL_FIELD:"__$needDrawLabel__",OBJ_NEED_DOT_FIELD:"__$needDrawDot__",getObjNeedDrawLabel:function(e,t){var r=this.getExtraProp2(e,t,this.OBJ_NEED_LABEL_FIELD);if(Kekule.ObjUtils.isUnset(r)){var i=this.getRenderCache(e).appliedOptions;r=!(t instanceof Kekule.ChemStructureConnector)&&this._needNodeDrawLabel(t,i),this.setObjNeedDrawLabel(e,t,r)}return r},setObjNeedDrawLabel:function(e,t,r){this.setExtraProp2(e,t,this.OBJ_NEED_LABEL_FIELD,r)},getObjNeedDrawDot:function(e,t){var r=this.getRenderCache(e).appliedOptions;return!(t instanceof Kekule.ChemStructureConnector)&&this._needNodeDrawDot(e,t,r)},doPrepare:function(e,t,r,i){i.fontSize||(i.fontSize=i.atomFontSize),i.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER,i.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER,this.tryApplySuper("doPrepare",[e,t,r,i])},doPrepareLayout:function(e,t,r,i){this.tryApplySuper("doPrepareLayout",[e,t,r,i]);for(var n=t.getExposedNodes(),o=0,a=n.length;o<a;++o){var s=n[o],l=this._needNodeDrawLabel(s,i);this.setObjNeedDrawLabel(e,s,l)}},handleNodeSpecifiedRenderOptions:function(e,t){var r=this.tryApplySuper("handleNodeSpecifiedRenderOptions",[e,t]);return!r.color&&r.atomColor&&(r.color=r.atomColor),!r.fontFamily&&r.atomFontFamily&&(r.fontFamily=r.atomFontFamily),!r.fontSize&&r.atomFontSize&&(r.fontSize=r.atomFontSize),r},handleConnectorSpecifiedRenderOptions:function(e,t){var r=this.tryApplySuper("handleConnectorSpecifiedRenderOptions",[e,t]);return!r.color&&r.bondColor&&(r.color=r.bondColor),r},doDrawNode:function(e,t,r,i,n,o){var a,s,l=this.getTransformedCoord2D(e,r,o.allowCoordBorrow),u=n,d=r.getAtomicNumber?r.getAtomicNumber():0,c=r.getOverriddenRenderOptions()||{},h=c.color||c.atomColor;if(h)u.color=h;else if(u.useAtomSpecifiedColor){var p;if(d<=0){var g=r.getClassLocalName();p=Kekule.Render.RenderColorUtils.getColor(g,this.getRendererType())}else p=Kekule.Render.RenderColorUtils.getColor(d,this.getRendererType());u.color=p}r.getCharge()||r.getRadical();var f=r.hasExplicitCharge&&r.hasExplicitCharge()&&!r.fetchChargeMarker(!1),C=r.getRadical()&&!r.fetchRadicalMarker(!1),m=!1;if(this.getObjNeedDrawLabel(e,r)){m=!0;var T=this._getNodeHydrogenDisplayLevel(r,u);T===Kekule.Render.HydrogenDisplayLevel.LABELED&&(T=Kekule.Render.HydrogenDisplayLevel.ALL);var E=!(!f&&!C),_=r.getDisplayRichText(T,E,u.displayLabelConfigs,u.partialChargeDecimalsLength,u.chargeMarkType,u.distinguishSingletAndTripletRadical),S=u.charDirection?u.charDirection:this._decideNodeLabelCharDirection(e,r);u.fontSize*=u.unitLength;var O=Object.create(u);O.charDirection=S;var y=(b=this.drawRichText(e,l,_,O)).drawnObj,A=b.boundRect;s=this.createRectBoundInfo({x:A.left,y:A.top},{x:A.left+A.width,y:A.top+A.height}),a=y}else{var I,k,b;if(this.getObjNeedDrawDot(e,r)&&Kekule.ObjUtils.isUnset(u.atomRadius)&&(u.atomRadius=u.allenCenterAtomRadius),u.atomRadius){var v=u.atomRadius*u.unitLength;u.strokeColor=u.color,u.fillColor=u.color,I=this.drawCircle(e,l,v,u),s=this.createCircleBoundInfo(l,v)}else s=this.createPointBoundInfo(l);if(f||C)(b=this.doDrawElectronStateMark(e,t,r,u.chargeMarkType,u.partialChargeDecimalsLength,u.distinguishSingletAndTripletRadical,u.fontFamily,u.chargeMarkFontSize*u.unitLength,u.chargeMarkMargin*u.unitLength,u.chargeMarkCircleWidth*u.unitLength,u.color,u.opacity,u.zoom||1))&&(k=b.drawnObj);I&&k?(a=this.createDrawGroup(e),this.addToDrawGroup(a,I),this.addToDrawGroup(a,k)):a=I||k}if(r.getUnplacedMarkers(this.getCoordMode()).length>=0){var R,D=u.chemMarkerMargin;if(m){D+=this._getNodeFontSize(e,r)*(o.zoom||1)*u.unitLength*1/2-D/2;var N=Kekule.Render.TextDirection,P=(N.LTR,N.RTL,N.TTB,N.BTT,S===N.LTR?{x:1,y:0}:S===N.RTL?{x:-1,y:0}:S===N.TTB?{x:0,y:1}:S===N.BTT?{x:0,y:-1}:{x:0,y:0}),M={x:P.x*o.scaleX,y:P.y*o.scaleY};R=M.x>0?0:M.x<0?Math.PI:M.y>0?Math.PI/2:M.y<0?3*Math.PI/2:null}var K=D/u.defBondLength*u.medianObjRefLength;this.doAdjustChemPropMarkerPos(r,K,o.allowCoordBorrow,Kekule.ObjUtils.notUnset(R)?[R]:[])}return a?(this.setObjDrawElem(e,r,a),t&&this.addToDrawGroup(a,t)):this.setObjDrawElem(e,r,null),this.addRenderedObj(e,r),this.basicDrawObjectUpdated(e,r,i,s,Kekule.Render.ObjectUpdateType.ADD),a},_getNodeFontSize:function(e,t,r){r||(r=this.getRenderCache(e).appliedOptions||this.getRenderCache(e).options);var i=Kekule.Render.RenderOptionUtils.getNodeLabelDrawOptions(t.getOverriddenRenderOptions())||{};return o(i.fontSize,r.fontSize,r.atomFontSize)},_getNodeHydrogenDisplayLevel:function(e,t){var r=e.getOverriddenRenderOptions(),i=Kekule.Render.RenderOptionUtils.getHydrogenDisplayLevel(r);return Kekule.ObjUtils.notUnset(i)?i:t.hydrogenDisplayLevel},_needNodeDrawDot:function(e,t,r){t.getOverriddenRenderOptions();if(t instanceof Kekule.Atom){if(t.getAtomicNumber()!==Kekule.Render.DEF_ATOM_ATOMIC_NUM)return!1;if(this.getObjNeedDrawLabel(e,t))return!1;if(2===t.getLinkedBonds().length){var n=t.getLinkedMultipleBonds();if(2===n.length&&n[0].getBondOrder()===n[1].getBondOrder()){var o=n[0].getBondOrder();return o>=i.DOUBLE&&o<i.EXPLICIT_AROMATIC}}return!1}return!1},_needNodeDrawLabel:function(e,t){var r=Kekule.Render.RenderOptionUtils,i=Kekule.Render.NodeLabelDisplayMode,n=e.getOverriddenRenderOptions(),o=r.getNodeDisplayMode(n)||t.nodeDisplayMode;if(!(e instanceof Kekule.ChemStructureNode))return!1;if(o===i.HIDDEN)return!1;if(o===i.SHOWN)return!0;if(t.moleculeDisplayType===Kekule.Render.MoleculeDisplayType.CONDENSED)return!0;if(e.getLinkedConnectors().length<=0)return!0;if(e instanceof Kekule.Atom&&e.getAtomicNumber()===Kekule.Render.DEF_ATOM_ATOMIC_NUM&&!e.getMassNumber()){if(e.getRenderOption("customLabel"))return!0;var a=this._getNodeHydrogenDisplayLevel(e,t),s=Kekule.Render.HydrogenDisplayLevel;if(a===s.ALL)return!0;if(a===s.UNMATCHED_EXPLICIT){var l=e.getExplicitHydrogenCount();return Kekule.ObjUtils.notUnset(l)&&e.getImplicitHydrogenCount()!==l}return Kekule.ObjUtils.notUnset(e.getExplicitHydrogenCount())}return!0},_isNodeHasConnectorToDirection:function(e,r,i){Kekule.ObjUtils.isUnset(i)&&(i=.2);for(var n=0,o=e.length;n<o;++n){var a=e[n];if(r===t.LTR&&a.x>i)return!0;if(r===t.RTL&&a.x<-i)return!0;if(r===t.TTB&&a.y>i)return!0;if(r===t.BTT&&a.y<-i)return!0}return!1},_calcConnectorVectorWeight:function(e){for(var t=0,r=0,i=function(e,t){return 0==t?100:Math.min(100,Math.pow(e/t,2))},n=0,o=e.length;n<o;++n)t+=e[n].x*i(e[n].x,e[n].y)*1,r+=e[n].y*i(e[n].y,e[n].x)*1;return{x:t,y:r}},_calcConnectorVectorOfNode:function(e,t){for(var r={x:0,y:0},i=this._getStandardizedLinkedObjRelCoords(e,t,null),n=0,o=i.length;n<o;++n)r.x+=i[n].x,r.y+=i[n].y;return r.x===r.y===0&&(r={x:1,y:0}),r},_calcVectorAxisDirection:function(e){return Math.abs(e.x)>=Math.abs(e.y)?e.x>0?t.LTR:t.RTL:e.y>0?t.TTB:t.BTT},_decideNodeLabelCharDirection:function(e,t){for(var r=this._getStandardizedLinkedObjRelCoords(e,t,null),i=Kekule.Render.TextDirection,n=[i.LTR,i.RTL,i.TTB,i.BTT],o=0,a=n.length;o<a;++o)if(!this._isNodeHasConnectorToDirection(r,n[o]))return n[o];var s=this._calcConnectorVectorWeight(r);return Math.abs(s.x)>Math.abs(s.y)?s.x<=0?i.LTR:i.RTL:s.y<=0?i.TTB:i.BTT},_calcConnectorAnglesOfNode:function(e,t){for(var r=[],i=this._getStandardizedLinkedObjRelCoords(e,t,null),n=0,o=i.length;n<o;++n){var a=i[n],s=Math.atan2(a.y,a.x);s<0&&(s=2*Math.PI+s),r.push(s)}return r.sort(),r},_getMostEmptyDirectionAngleOfNode:function(e,t){var r,i=this._calcConnectorAnglesOfNode(e,t),n=i.length;if(0===n)r=0;else if(1===n)r=-i[0];else{for(var o=0,a=0,s=0;s<n;++s){var l=i[s],u=i[(s+1)%n]-l;u<0&&(u+=2*Math.PI),u>o&&(o=u,a=s)}r=i[a]+o/2}return r},doAutoAdjustAttachedMarkerPos:function(e,t,r,i,n){t&&!t.getCoordOfMode(this.getCoordMode())&&e.autoSetMarker2DPos(t,r,i,n)},doAdjustChemPropMarkerPos:function(e,t,r,i){e.beginUpdate();try{var n=e.getMarkerOfType(Kekule.ChemMarker.Charge);this.doAutoAdjustAttachedMarkerPos(e,n,t,r,i);var o=e.getMarkerOfType(Kekule.ChemMarker.Radical);this.doAutoAdjustAttachedMarkerPos(e,o,t,r,i);for(var a=e.getUnplacedMarkers(this.getCoordMode()),s=0,l=a.length;s<l;++s)this.doAutoAdjustAttachedMarkerPos(e,a[s],t,r,i)}finally{e.endUpdate()}},doDrawElectronStateMark:function(e,t,r,i,n,o,a,s,l,u,d,c,h){var p=r.getCharge(),g=r.getRadical(),f="";if(!n||Math.abs(p)>Math.pow(10,-n)/2){Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND;var C=i===Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND;if(1===p)f=C?"⊕":"+";else if(-1===p)f=C?"⊖":"−";else{f=(n?Kekule.NumUtils.toDecimals(Math.abs(p),n):Math.abs(p).toString())+(p>0?"+":"−")}}if(g&&(f+=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(g,o)),!f)return null;var m=this.getTransformedCoord2D(e,r),T=this._getMostEmptyDirectionAngleOfNode(e,r),E=l/1,_={x:Math.cos(T)*E,y:Math.sin(T)*E};_=Kekule.CoordUtils.add(m,_);var S,O,y=Kekule.Render.BoxXAlignment,A=Kekule.Render.BoxYAlignment;return S=y.CENTER,O=A.CENTER,this.drawText(e,_,f,{fontFamily:a,fontSize:s,color:d,opacity:c,textBoxXAlignment:S,textBoxYAlignment:O,zoom:h||1})},doDrawConnectorShape:function(e,t,r,i,n){var o,a=Kekule.CoordUtils,s=r[0],l=r[1],u=this.getTransformedCoord2D(e,s,n.allowCoordBorrow),d=this.getTransformedCoord2D(e,l,n.allowCoordBorrow),c={x:u.x,y:u.y},h={x:d.x,y:d.y},p=(r=[s,l],[c,h]),g=a.getDistance(c,h),f=0,C=i.unitLength||1,m=Math.sqrt(Math.sqr(h.x-c.x)+Math.sqr(h.y-c.y)),T=[],E=i.bondLengthScaleRatio;if(Kekule.ObjUtils.notUnset(E)){var _=a.substract(h,c);!0,o=E>0?0:1;var S=1-Math.abs(E||1),O=1===o?-1:1;T[o]=a.multiply(_,O*S)}if(this.getObjNeedDrawLabel(e,s)||this.getObjNeedDrawLabel(e,l)){var y,A,I,k=i.atomLabelBoxExpandRatio,b=h.x-c.x,v=h.y-c.y,R=b>=0?1:-1,D=v>=0?1:-1,N=0===b;if(!N)var P=Math.abs(v/b);I=Math.abs(b)>=Math.abs(v);for(var M=0,K=r.length;M<K;++M){var L=r[M],x=p[M],B=null;if(this.getObjNeedDrawLabel(e,L))if(y=A=this._getNodeFontSize(e,L)*(n.zoom||1)*C*k/2,B=I?{x:y*R,y:y*P*D}:N?{x:0,y:A*D}:{x:A/P*R,y:A*D}){var U=T[M];U&&Math.abs(E)<=1?(Math.abs(B.x)>Math.abs(U.x)||Math.abs(B.y)>Math.abs(U.y))&&(T[M]=B):T[M]=B}R*=-1,D*=-1}}for(M=0,K=p.length;M<K;++M){x=p[M];if(B=T[M]){f+=a.getDistance(B,{x:0,y:0});var w=a.add(x,B);x.x=w.x,x.y=w.y}}if(f>=g)return null;var F=(i.bondLineWidth||i.strokeWidth||1)*(i.unitLength||1);i.strokeWidth=F;var V,j=i.renderType,W=Kekule.Render.ConnectorDrawUtils.getPossibleConnectorRenderTypes(t);return(Kekule.ObjUtils.isUnset(j)||W.indexOf(j)<0)&&(j=W[0]),this.isLineBasedConnector(j)?V=this.doDrawLineBasedConnector(e,j,s,l,c,h,m,i):this.isTriangleBasedConnector(j)?V=this.doDrawTriangleBasedConnector(e,j,s,l,c,h,m,i):this.isTriangleHashBasedConnector(j)?V=this.doDrawTriangleHashBasedConnector(e,j,s,l,c,h,m,i):this.isRectangleBasedConnector(j)?V=this.doDrawRectangleBasedConnector(e,j,s,l,c,h,m,i):this.isWavyBasedConnector(j)&&(V=this.doDrawWavyBasedConnector(e,j,s,l,c,h,m,i)),V},_lineBasedConnectorTypes:[e.SINGLE,e.DOUBLE,e.TRIPLE,e.QUAD,e.SCISSORS_DOUBLE,e.BOLD,e.BOLD_DOUBLE,e.BOLD_TRIPLE,e.DASHED,e.DASHED_DOUBLE,e.DASHED_TRIPLE,e.SOLID_DASH,e.BOLD_DASH,e.ARROWED],_triangleBasedConnectorTypes:[e.WEDGED_SOLID,e.WEDGED_SOLID_INV,e.WEDGED_HOLLOW,e.WEDGED_HOLLOW_INV],_triangleHashBasedConnectorTypes:[e.WEDGED_HASHED,e.WEDGED_HASHED_INV,e.HASHED],_rectangleBasedConnectorTypes:[e.WEDGED_SOLID_BOTH,e.WEDGED_HOLLOW_BOTH],isLineBasedConnector:function(e){return this._lineBasedConnectorTypes.indexOf(e)>=0},isTriangleBasedConnector:function(e){return this._triangleBasedConnectorTypes.indexOf(e)>=0},isTriangleHashBasedConnector:function(e){return this._triangleHashBasedConnectorTypes.indexOf(e)>=0},isRectangleBasedConnector:function(e){return this._rectangleBasedConnectorTypes.indexOf(e)>=0},isWavyBasedConnector:function(t){return e.WAVY},doDrawLineBasedConnector:function(t,r,i,n,o,a,s,l){var u=[],d={isBold:!1,isDash:!1},c={isBold:!0,isDash:!1},h={isBold:!1,isDash:!0};switch(r){case e.DOUBLE:case e.SCISSORS_DOUBLE:for(var p=0;p<2;++p,u.push(d));break;case e.TRIPLE:for(p=0;p<3;++p,u.push(d));break;case e.QUAD:for(p=0;p<4;++p,u.push(d));break;case e.BOLD:u.push(c);break;case e.BOLD_DOUBLE:u.push(c),u.push(d);break;case e.BOLD_TRIPLE:u.push(c);for(p=0;p<2;++p,u.push(d));break;case e.BOLD_QUAD:u.push(c);for(p=0;p<3;++p,u.push(d));break;case e.DASHED:u.push(h);break;case e.DASHED_DOUBLE:for(p=0;p<2;++p,u.push(h));break;case e.DASHED_TRIPLE:for(p=0;p<3;++p,u.push(h));break;case e.SOLID_DASH:u.push(d),u.push(h);break;case e.BOLD_DASH:u.push(c),u.push(h);break;case e.ARROWED:d.isArrow=!0,u.push(d);break;case e.SINGLE:default:u.push(d)}var g=r===e.SCISSORS_DOUBLE;return this.doDrawSymmetryLineConnector(t,i,n,o,a,s,u,g,l)},doDrawSymmetryLineConnector:function(e,t,r,i,n,o,a,s,l){var u=a.length,d=null,c=null;if(1===u){var h=l.strokeWidth;a[0].isBold&&(h*=l.boldBondLineWidthRatio);var p=null;a[0].isArrow&&(p={width:l.bondArrowWidth*l.unitLength,length:l.bondArrowLength*l.unitLength});var g=Object.create(l);g.strokeWidth=h,g.strokeColor=Kekule.Render.RenderOptionUtils.getColor(l),g.strokeDash=a[0].isDash,g.lineCap=l.bondLineCap,g.lineJoin=l.bondLineJoin;c=this.drawArrowLine(e,i,n,p,g);var f=this.createLineBoundInfo(i,n,h)}else if(u>1){d=this.createDrawGroup(e);var C=l.multipleBondSpacingAbs?l.multipleBondSpacingAbs:l.multipleBondSpacingRatio*o;l.multipleBondMaxAbsSpacing&&(C=Math.min(C,l.multipleBondMaxAbsSpacing)),C*=l.unitLength;var m=n.x-i.x,T=n.y-i.y,E=Math.sqrt(Math.sqr(m)+Math.sqr(T)),_=T/E,S=m/E,O=[],y=1;1&u||(y=s?0:Kekule.ObjUtils.isUnset(a.bondAlign)?this._decideEvenBondAlign(e,t,r):a.bondAlign);for(var A=0;A<u;++A)if(Kekule.ObjUtils.notUnset(a[A].offsetAdjust))O.push(a[A].offsetAdjust);else if(0===A&&0!==y)O.push(0);else{var I=1&A?1:-1;if(0!==y)var k=y*I*(A+1>>1);else k=(1*(A>>1)+.5)*I;O.push(k)}var b=C,v=0,R={x:0,y:0},D={x:0,y:0},N=[];for(A=0;A<u;++A){var P=Object.create(l),M=b*_,K=b*S,L={x:i.x-M*O[A],y:i.y+K*O[A]},x={x:n.x-M*O[A],y:n.y+K*O[A]};R=Kekule.CoordUtils.add(R,L),D=Kekule.CoordUtils.add(D,x);p=null;a[A].isArrow&&(p={width:l.bondArrowWidth*l.unitLength,length:l.bondArrowLength*l.unitLength});h=l.strokeWidth;a[A].isBold&&(h*=l.boldBondLineWidthRatio),P.strokeColor=l.color,P.strokeDash=a[A].isDash,P.lineCap=l.bondLineCap,P.lineJoin=l.bondLineJoin,N.push({coord1:L,coord2:x,arrowParams:p,drawOptions:P}),0!==A&&A!==u-1||(v+=h/2),b=a[A].isBold?C+Math.floor(h/2):C}if(s)for(A=0;A<u;++A){var B=N[A],U=N[u-A-1];c=this.drawArrowLine(e,B.coord1,U.coord2,B.arrowParams,B.drawOptions);this.addToDrawGroup(c,d)}else for(A=0;A<u;++A){var w=N[A];c=this.drawArrowLine(e,w.coord1,w.coord2,w.arrowParams,w.drawOptions);this.addToDrawGroup(c,d)}R=Kekule.CoordUtils.divide(R,u),D=Kekule.CoordUtils.divide(D,u);var F=C*Math.abs(O[O.length-1]-O[0])+v;f=this.createLineBoundInfo(R,D,F)}return{element:d||c,boundInfo:f}},_getStandardizedLinkedObjRelCoords:function(e,t,r){for(var i=[],n=this.getTransformedCoord2D(e,t),o=t.getLinkedExposedObjs(),a=0,s=o.length;a<s;++a){var l=o[a];if(l!==r){var u=this.getTransformedCoord2D(e,l),d=Kekule.CoordUtils.substract(u,n);d=Kekule.CoordUtils.standardize(d),i.push(d)}}return i},_decideEvenBondAlign:function(e,t,r){var i=Kekule.CoordUtils.substract(this.getTransformedCoord2D(e,r),this.getTransformedCoord2D(e,t));i=Kekule.CoordUtils.standardize(i);for(var n=this._getStandardizedLinkedObjRelCoords(e,t,r),o=this._getStandardizedLinkedObjRelCoords(e,r,t),a=0,s={x:0,y:0},l=0,u=n.length;l<u;++l)a+=this._calcSinglePointAlign(n[l],i),s.x+=n[l].x,s.y+=n[l].y;for(l=0,u=o.length;l<u;++l)a+=this._calcSinglePointAlign(o[l],i),s.x+=o[l].x,s.y+=o[l].y;return 0!==a?Math.sign(a):this._calcSinglePointAlign(s,i)},_calcSinglePointAlign:function(e,t){var r;if(Math.abs(t.x)<1e-4)return r=Math.abs(e.x)<1e-4?0:-Math.sign(e.x)*Math.sign(t.y);var i=t.y*e.x/t.x,n=e.y-i;return r=n>1e-4?1:n<-1e-4?-1:0,r*=Math.sign(t.x)},doDrawTriangleBasedConnector:function(t,r,i,n,o,a,s,l){var u=r===e.WEDGED_SOLID||r===e.WEDGED_SOLID_INV,d=r===e.WEDGED_SOLID_INV||r===e.WEDGED_HOLLOW_INV?[a,o]:[o,a],c=l.bondWedgeWidth*l.unitLength,h=this._calcTriangleBaselineCoords(d[0],d[1],c),p=Object.create(l);p.strokeColor=l.color,p.fillColor=u?l.color:null;var g={element:this.drawTriangle(t,d[0],h[0],h[1],p)};return g.boundInfo=this.createLineBoundInfo(d[0],d[1],c),g},doDrawTriangleHashBasedConnector:function(t,r,i,n,o,a,s,l){var u=r===e.WEDGED_HASHED_INV,d=r!==e.HASHED,c=u?[a,o]:[o,a],h=l.hashSpacing*l.unitLength,p=l.bondWedgeWidth*l.unitLength,g=d?l.bondWedgeHashMinWidth*l.unitLength:p,f=p-g,C=Kekule.CoordUtils.substract(c[1],c[0]),m=Math.sqrt(Math.sqr(C.x)+Math.sqr(C.y)),T=Math.floor(m/h),E=this.createDrawGroup(t),_=Object.create(l);_.strokeColor=l.color;for(var S=0;S<T;++S){var O=h*S/m,y={x:C.x*O,y:C.y*O};y=Kekule.CoordUtils.add(y,c[0]);var A=this._calcTriangleBaselineCoords(c[0],y,f*O+g),I=this.drawLine(t,A[0],A[1],_);this.addToDrawGroup(I,E)}var k={element:E};return k.boundInfo=this.createLineBoundInfo(c[0],c[1],p),k},_calcTriangleBaselineCoords:function(e,t,r){var i=Kekule.CoordUtils.substract(t,e),n=Math.sqrt(Math.sqr(i.x)+Math.sqr(i.y)),o=i.y/n,a=i.x/n,s=r/2,l=[];return l.push({x:t.x+s*o,y:t.y-s*a}),l.push({x:t.x-s*o,y:t.y+s*a}),l},doDrawRectangleBasedConnector:function(t,r,i,n,o,a,s,l){var u=r===e.WEDGED_SOLID_BOTH,d=l.bondWedgeWidth*l.unitLength,c=this._calcRectangleCornerCoords(o,a,d),h=Object.create(l);h.strokeColor=l.color,h.fillColor=u?l.color:null;var p=Kekule.Render.DrawPathUtils.makePath("M",[c[0].x,c[0].y],"L",[c[1].x,c[1].y],"L",[c[2].x,c[2].y],"L",[c[3].x,c[3].y],"Z"),g={element:this.drawPath(t,p,h)};return g.boundInfo=this.createLineBoundInfo(o,a,d),g},_calcRectangleCornerCoords:function(e,t,r){var i=Kekule.CoordUtils.substract(t,e),n=Math.sqrt(Math.sqr(i.x)+Math.sqr(i.y)),o=r/2,a=[],s=o*(i.y/n),l=o*(i.x/n);return a.push({x:e.x+s,y:e.y-l}),a.push({x:e.x-s,y:e.y+l}),a.push({x:t.x-s,y:t.y+l}),a.push({x:t.x+s,y:t.y-l}),a},doDrawWavyBasedConnector:function(e,t,r,i,n,o,a,s){for(var l,u=Kekule.CoordUtils,d=s.bondWavyRadius*s.unitLength,c=u.getDistance(n,o),h=Math.round(c/d),p=u.divide(u.substract(o,n),h),g=c/h,f=[],C=n,m=Math.atan2(p.y,p.x)+Math.PI,T={x:g/1.5*Math.sin(m),y:-g/1.5*Math.cos(m)},E=1,_=0;_<h;++_){E=-E,l=C,C=u.add(l,p);var S=u.multiply(T,E),O=u.add(l,S),y=u.add(C,S);0===_&&(f.push("M"),f.push([l.x,l.y])),f.push("C"),f.push([O.x,O.y,y.x,y.y,C.x,C.y])}var A=Kekule.Render.DrawPathUtils.makePath.apply(Kekule.Render.DrawPathUtils,f),I=Object.create(s);I.strokeColor=s.color,I.fillColor=null;var k={element:this.drawPath(e,A,I)};return k.boundInfo=this.createLineBoundInfo(n,o,g),k}}),Kekule.Render.StructFragment2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.StructFragment2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._concreteRenderer=null,this._concreteChemObj=null,this.initConcreteRenderer()},finalize:function(){this.tryApplySuper("finalize"),this._concreteRenderer&&(this._concreteRenderer.finalize(),this._concreteRenderer=null)},_getRenderSortIndex:function(){return this._concreteRenderer?this._concreteRenderer._getRenderSortIndex():this.tryApplySuper("_getRenderSortIndex")},initConcreteRenderer:function(){var e=this.getChemObj(),t=this.getDrawBridge();return this._isRendererMismatch(this._concreteRenderer,e)&&this._concreteRenderer&&(this._concreteRenderer.finalize(),this._concreteRenderer=null,this._concreteChemObj=null),!this._concreteRenderer&&e&&(e.hasCtab()?(this._concreteChemObj=e.getCtab(),this._concreteRenderer=new Kekule.Render.ChemCtab2DRenderer(e.getCtab(),t,this)):e.hasFormula()&&(this._concreteChemObj=e.getFormula(),this._concreteRenderer=new Kekule.Render.Formula2DRenderer(e.getFormula(),t,this))),this._concreteRenderer},_isRendererMismatch:function(e,t){return e&&!t||e instanceof Kekule.Render.ChemCtab2DRenderer&&!t.hasCtab()||e instanceof Kekule.Render.Formula2DRenderer&&!t.hasFormula()},getConcreteRenderer:function(){return this.initConcreteRenderer(),this._concreteRenderer},_getConcreteRendererDrawOptions:function(e){return e},isChemObjRenderedBySelf:function(e,t){var r=this.getConcreteRenderer();return this.tryApplySuper("isChemObjRenderedBySelf",[e,t])||t===this.getChemObj()||r&&r.isChemObjRenderedBySelf(e,t)},isChemObjRenderedDirectlyBySelf:function(e,t){this.getConcreteRenderer();return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[e,t])||t===this.getChemObj()||t===this._concreteChemObj},doSetRedirectContext:function(e){this.tryApplySuper("doSetRedirectContext",[e]);var t=this.getConcreteRenderer();t&&t.setRedirectContext(e)},getChildObjs:function(){var e=this.getChemObj();if(e){for(var t=[],r=(e.getExposedNodes()||[]).concat(e.getExposedConnectors()||[]),i=0,n=r.length;i<n;++i){var o=r[i];o.getAttachedMarkers&&(t=t.concat(o.getAttachedMarkers()||[]))}return t.concat(this.tryApplySuper("getChildObjs"))}return this.tryApplySuper("getChildObjs")},_needWholelyDraw:function(e,t){var r=this.tryApplySuper("_needWholelyDraw",[e,t]);if(!r){for(var i=this.getChemObj(),n=!1,o=0,a=e.length;o<a;++o){if(e[o].isChildOf(i)){n=!0;break}}r=n}return r},_createChargeAndRadicalMarkerOnStructFragment:function(e){e.beginUpdate();try{e.hasExplicitCharge&&e.hasExplicitCharge()&&e.fetchChargeMarker(!0);e.getNodes();for(var t=0,r=e.getNodeCount();t<r;++t){var i=e.getNodeAt(t);i.beginUpdate();try{i.hasExplicitChargeOrElectronicBias&&i.hasExplicitChargeOrElectronicBias()&&i.fetchChargeMarker(!0),i.getRadical()&&i.fetchRadicalMarker(!0),i.getNodeAt&&this._createChargeAndRadicalMarkerOnStructFragment(i)}finally{i.endUpdate()}}}finally{e.endUpdate()}},doDraw:function(e,t,r){var i=!!r.autoCreateChargeAndRadicalMarker;if(this.getCanModifyTargetObj()&&i){var n=this.getChemObj();this._createChargeAndRadicalMarkerOnStructFragment(n)}this.tryApplySuper("doDraw",[e,t,r])},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var i=this.getChemObj(),n=t,o=this.getConcreteRenderer();if(!n&&o instanceof Kekule.Render.Formula2DRenderer&&i.getAbsBaseCoord2D){var a=i.getAbsBaseCoord2D(r.allowCoordBorrow);n=Kekule.CoordUtils.transform2D(a,r.transformParams)}return i.hasFormula()||i.hasCtab()?o?o.draw(e,n,this._getConcreteRendererDrawOptions(r)):void 0:null},doRedraw:function(e){return this.tryApplySuper("doRedraw",[e])},doUpdateSelf:function(e,t,r){if(this._extractObjsOfUpdateObjDetails(t).indexOf(this.getChemObj())>=0){var i=this.getRenderCache(e);return this.doClear(e),this.draw(e,i.baseCoord,i.options)}var n=this.getConcreteRenderer();if(n)return n.doUpdate(e,t,r)},doClearSelf:function(e){var t=this.getConcreteRenderer();if(t)return t.clear(e)},estimateRenderBox:function(e,t,r,i){var n=this.getConcreteRenderer();return n?n.estimateRenderBox(e,t,this._getConcreteRendererDrawOptions(r),i):null},transformCoordToObj:function(e,t,r){return this.tryApplySuper("transformCoordToObj",[e,t,r])},transformCoordToContext:function(e,t,r){return this.tryApplySuper("transformCoordToContext",[e,t,r])}}),Kekule.Render.Mol2DRenderer=Kekule.Render.StructFragment2DRenderer,Kekule.Render.CompositeObj2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeObj2DRenderer"}),Kekule.Render.CompositeMolecule2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule2DRenderer",getChildObjs:function(){for(var e=[],t=this.getChemObj().getSubMolecules(),r=0,i=t.getItemCount();r<i;++r){var n=t.getObjAt(r);e.push(n)}return e.concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.ChemObjGroupList2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule2DRenderer",getChildObjs:function(){var e=this.getChemObj();if(e instanceof Kekule.ChemObjList)for(var t=[],r=0,i=e.getItemCount();r<i;++r)t.push(e.getItemAt(r));else e instanceof Kekule.ChemStructureObjectGroup&&(t=e.getAllObjs());return(t||[]).concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.Reaction2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.Reaction2DRenderer",getChildObjs:function(){for(var e=[],t=this.getChemObj(),r=(e=[],0),i=t.getReactantCount();r<i;++r){var n=t.getReactantAt(r);e.push(n)}for(r=0,i=t.getProductCount();r<i;++r){n=t.getProductAt(r);e.push(n)}return(e||[]).concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.ChemSpaceElement2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpaceElement2DRenderer",getChildObjs:function(){var e=this.tryApplySuper("getChildObjs")||[];return e=(this.getChemObj().getChildren().toArray()||[]).concat(e)}}),Kekule.Render.ChemSpace2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpace2DRenderer",getChildObjs:function(){return[this.getChemObj().getRoot()].concat(this.tryApplySuper("getChildObjs")||[])},doEstimateSelfObjBox:function(e,t,r){var i=this.getChemObj().getSize2D()||{};return i.x&&i.y&&t.useExplicitSpaceSize?{x1:0,y1:0,x2:i.x,y2:i.y}:this.tryApplySuper("doEstimateSelfObjBox",[e,t,r])}}),Kekule.Render.Renderer2DFactory.register(Kekule.ChemMarker.Charge,Kekule.Render.TextBasedChemMarker2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemMarker.Radical,Kekule.Render.TextBasedChemMarker2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemMarker.UnbondedElectronSet,Kekule.Render.UnbondedElectronSetRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.TextBlock,Kekule.Render.TextBlock2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ImageBlock,Kekule.Render.ImageBlock2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.StructureFragment,Kekule.Render.StructFragment2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.CompositeMolecule,Kekule.Render.CompositeMolecule2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.Reaction,Kekule.Render.Reaction2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemObjList,Kekule.Render.ChemObjGroupList2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemStructureObjectGroup,Kekule.Render.ChemObjGroupList2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemSpaceElement,Kekule.Render.ChemSpaceElement2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemSpace,Kekule.Render.ChemSpace2DRenderer)}(),function(){Kekule.Render.DrawPathUtils;var e=Kekule.CoordUtils,t=(Kekule.oneOf,Kekule.Glyph.NodeType),r=Kekule.Glyph.PathType;Kekule.Render.BaseGlyph2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.BaseGlyph2DRenderer",doDraw:function(e,t,r){var i=Object.create(r);return i.strokeColor=r.strokeColor||r.glyphStrokeColor,i.fillColor=r.fillColor||r.glyphFillColor,i.strokeWidth=r.strokeWidth||r.glyphStrokeWidth,i.lineCap=r.glyphLineCap,i.lineJoin=r.glyphLineJoin,this.tryApplySuper("doDraw",[e,t,i])}}),Kekule.Render.PathGlyphCtab2DRenderer=Class.create(Kekule.Render.Ctab2DRenderer,{CLASS_NAME:"Kekule.Render.PathGlyphCtab2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._nodeCoordOverrideMap=new Kekule.MapEx(!0)},doFinalize:function(){this._nodeCoordOverrideMap.finalize(),this.tryApplySuper("doFinalize")},extractGlyphDrawOptions:function(e){var t=e.unitLength||1;return{strokeColor:e.strokeColor||e.color||e.glyphStrokeColor,fillColor:e.fillColor||e.color||e.glyphFillColor,strokeWidth:(e.strokeWidth||e.glyphStrokeWidth)*t,lineCap:e.lineCap||e.glyphLineCap,lineJoin:e.lineJoin||e.glyphLineJoin}},doDraw:function(e,t,r){var i=this.tryApplySuper("doDraw",[e,t,r]);return this._nodeCoordOverrideMap.clear(),i},doDrawNode:function(e,r,i,n,o,a){var s,l=i.getNodeType();if(!l||l===t.LOCATION||l===t.CONTROLLER){var u=this._nodeCoordOverrideMap.get(i)||this.getTransformedCoord2D(e,i,a.allowCoordBorrow);s=this.createPointBoundInfo(u)}s&&this.basicDrawObjectUpdated(e,i,n,s,Kekule.Render.ObjectUpdateType.ADD)},doDrawConnector:function(e,t,r,i,n,o){var a=this.tryApplySuper("doDrawConnector",[e,t,r,i,n,o]),s=r.getControlPoints&&r.getControlPoints();if(s)for(var l=0,u=s.length;l<u;++l){var d=this.getTransformedCoord2D(e,s[l],o.allowCoordBorrow),c=this.createPointBoundInfo(d);this.basicDrawObjectUpdated(e,s[l],r,c,Kekule.Render.ObjectUpdateType.ADD)}return a},doDrawConnectorShape:function(t,i,n,o,a){var s,l=Kekule.Glyph.ArrowSide,u=n[0],d=n[1],c=e.clone(this.getTransformedCoord2D(t,u,a.allowCoordBorrow)),h=e.clone(this.getTransformedCoord2D(t,d,a.allowCoordBorrow)),p=this.extractGlyphDrawOptions(o),g=i.getPathType(),f=i.getPathParams()||{},C=this.getChemObj(),m=(f.lineGap||0)*o.defScaleRefLength,T=m&&f.lineCount||1,E=[];f.startArrowType&&f.startArrowWidth&&(s={arrowLength:(_=this._transformArrowLength(t,f.startArrowLength,f.startArrowWidth)).arrowLength,arrowWidth:_.arrowWidth,arrowType:f.startArrowType,arrowSide:f.startArrowSide,drawOnCenter:!f.startArrowSide||f.startArrowSide===l.BOTH});if(f.endArrowType&&f.endArrowWidth)var _,S={arrowLength:(_=this._transformArrowLength(t,f.endArrowLength,f.endArrowWidth)).arrowLength,arrowWidth:_.arrowWidth,arrowType:f.endArrowType,arrowSide:f.endArrowSide,drawOnCenter:!f.endArrowSide||f.endArrowSide===l.BOTH};for(var O=[],y=Kekule.Render.MetaShapeUtils.inflateShape,A=0,I=n.length;A<I;++A){var k=n[A].getPathNodeParams();if(k.useStickingOffset){var b=this.getStickingTargetRenderBound(t,n[A]);if(b){var v=k.stickingOffsetRelLength;if(Kekule.ObjUtils.isUnset(v)&&(v=o.glyphStickOffsetRelLength),v)b=y(b,this._doGetStickOffsetContextLength(t,v,o));O[A]=b}}}var R=[],D=[],N={y:0,x:m},P=e.substract(this.transformCoordToContext(t,C,{x:0,y:0}),this.transformCoordToContext(t,C,N)),M=e.getDistance(P,{x:0,y:0});if(g===r.LINE)R=(x=this._doDrawLineConnectorShape(t,C,i,n,c,h,T,M,s,S,O,p,o)).drawnElems,E=x.arrowElems,D=x.boundInfos;else if(g===r.ARC){var K=i.getControlPoints&&i.getControlPoints(),L=K&&K[0];if(L){var x,B=e.clone(this.getTransformedCoord2D(t,L,a.allowCoordBorrow));R=(x=this._doDrawArcConnectorShape(t,C,i,n,c,h,B,T,M,s,S,O,p,o)).drawnElems,E=x.arrowElems,D=x.boundInfos}}if(D.length||(D=null),T<=1&&!E.length)return{element:R&&R[0],boundInfo:D&&D[0]};var U=this.createDrawGroup(t);for(A=0;A<T;++A)R[A]&&this.addToDrawGroup(R[A],U);for(A=0,I=E.length;A<I;++A)E[A]&&this.addToDrawGroup(E[A],U);return{element:U,boundInfo:D}},_doGetStickOffsetContextLength:function(t,r,i){var n={x:r*i.medianObjRefLength,y:0},o=this.getRootRenderer(),a=o.transformCoordToContext(t,this.getChemObj(),{x:0,y:0}),s=o.transformCoordToContext(t,this.getChemObj(),n);return e.getDistance(a,s)},_doDrawLineConnectorShape:function(t,r,i,n,o,a,s,l,u,d,c,h,p){for(var g=[o,a],f=[o,a],C=(e.divide(e.add(o,a),2),0);C<2;++C){var m=c[C];if(m){var T=Kekule.Render.MetaShapeUtils.getCrossPointsOfVectorToShapeEdges(f,m,!0);T&&T.length&&(g[C]=T[0],this._nodeCoordOverrideMap.set(n[C],g[C]))}}var E=Kekule.Glyph.ArrowSide,_=[],S=[],O=[],y=e.substract(g[1],g[0]),A=y.x,I=y.y,k=e.getDistance(g[0],g[1]),b=k,v=(s-1)/2,R=l,D={y:R*(A/k),x:-R*(I/k)},N=(e.multiply(D,(s-1)/2),e.multiply(D,(s-1)/2)),P=e.substract(g[0],N),M=e.substract(g[1],N);for(C=0;C<s;++C){if(B=null,U=null,0!==C&&(P=e.add(P,D),M=e.add(M,D)),u||d){var K=C-v,L=R*Math.abs(K);if(u){if(u.drawOnCenter&&(!u.arrowSide||u.arrowSide===E.SINGLE&&K<0||u.arrowSide===E.REVERSED&&K>0))var x=u.arrowType===Kekule.Glyph.ArrowType.OPEN?u.arrowLength*L/(u.arrowWidth/2):u.arrowLength,B=e.add(P,e.multiply(y,x/b));u.drawOnCenter&&0===C&&Kekule.ArrayUtils.pushUnique(O,this.doDrawArrowShape(t,i,g[1],g[0],u,h,!0)),!u.drawOnCenter&&(u.arrowSide===E.SINGLE&&0===C||u.arrowSide===E.REVERSED&&C===s-1)&&Kekule.ArrayUtils.pushUnique(O,this.doDrawArrowShape(t,i,M,P,u,h,!0))}if(d){if(d.drawOnCenter&&(!d.arrowSide||d.arrowSide===E.SINGLE&&K<0||d.arrowSide===E.REVERSED&&K>0)){x=d.arrowType===Kekule.Glyph.ArrowType.OPEN?d.arrowLength*L/(d.arrowWidth/2):d.arrowLength;var U=e.substract(M,e.multiply(y,x/b))}d.drawOnCenter&&0===C&&Kekule.ArrayUtils.pushUnique(O,this.doDrawArrowShape(t,i,g[0],g[1],d,h)),!d.drawOnCenter&&(d.arrowSide===E.SINGLE&&0===C||d.arrowSide===E.REVERSED&&C===s-1)&&Kekule.ArrayUtils.pushUnique(O,this.doDrawArrowShape(t,i,P,M,d,h))}}var w=this.doDrawLineShape(t,i,B||P,U||M,h,p);_.push(w.element),S.push(w.boundInfo)}return{drawnElems:_,boundInfos:S,arrowElems:O}},_doDrawArcConnectorShape:function(t,r,i,n,o,a,s,l,u,d,c,h,p,g){for(var f=[],C=[],m=[],T=[o,a],E=e.divide(e.add(s,T[0]),2),_=e.divide(e.add(T[1],s),2),S=-(T[0].x-s.x)/(T[0].y-s.y),O=-(T[1].x-s.x)/(T[1].y-s.y),y={x:(_.y-E.y-O*_.x+S*E.x)/(S-O),y:E.y+S*(_.y-E.y-O*_.x+O*E.x)/(S-O)},A=e.getDistance(y,T[0]),I=e.substract(T[0],y),k=e.substract(T[1],y),b=e.substract(s,y),v=Kekule.GeometryUtils.standardizeAngle(Math.atan2(I.y,I.x)),R=Kekule.GeometryUtils.standardizeAngle(Math.atan2(k.y,k.x)),D=Kekule.GeometryUtils.standardizeAngle(Math.atan2(b.y,b.x)),N=[],P=0;P<2;++P){var M=h[P];if(M){var K=this._getCrossCoordsAndAnglesOfArcToShapeEdges(y,A,v,R,D,M);if(K&&K.length>=1){var L=K[0].coord,x=K[0].angle;N[P]=x,T[P]=L,this._nodeCoordOverrideMap.set(n[P],L)}}}N[0]&&(v=N[0]),N[1]&&(R=N[1]);var B,U,w=R-v,F=D-v,V=D-R,j=Math.sign(F)*Math.sign(V)*Math.sign(w)>0,W=10/A;if(d){var G=v-(j?W:-W);B={x:Math.cos(G),y:Math.sin(G)}}if(c){G=R+(j?W:-W);U={x:Math.cos(G),y:Math.sin(G)}}var H=A-u*((l-1)/2);for(P=0;P<l;++P){var z=H+P*u;if((d||c)&&l<=1){if(d&&0===P){var Y=e.add(y,e.multiply(B,z));Kekule.ArrayUtils.pushUnique(m,this.doDrawArrowShape(t,i,Y,T[0],d,p,!0))}if(c&&0===P){Y=e.add(y,e.multiply(U,z));Kekule.ArrayUtils.pushUnique(m,this.doDrawArrowShape(t,i,Y,T[1],c,p,!0))}}var X=this.doDrawArcShape(t,y,z,v,R,j,p);X.element&&f.push(X.element),X.boundInfo&&C.push(X.boundInfo)}return{drawnElems:f,boundInfos:C,arrowElems:m}},_getCrossCoordsAndAnglesOfArcToShapeEdges:function(t,r,i,n,o,a){for(var s=Kekule.Render.MetaShapeUtils.getEdgeBasicElements(a),l=s.vectors,u=[],d=0,c=l.length;d<c;++d){var h=l[d];(g=Kekule.GeometryUtils.getCrossPointsOfVectorToCircle(h,t,r,1e-4))&&g.length&&(u=u.concat(g))}var p=s.circles;for(d=0,c=p.length;d<c;++d){var g;h=p[d];(g=Kekule.GeometryUtils.getCrossPointsOfCircles(h.center,h.radius,t,r,1e-4))&&g.length&&(u=u.concat(g))}var f=[],C=Math.sign((o-i)*(o-n));for(d=0,c=u.length;d<c;++d){var m=e.substract(u[d],t),T=Kekule.GeometryUtils.standardizeAngle(Math.atan2(m.y,m.x));Math.sign((T-i)*(T-n))===C&&f.push({angle:T,coord:u[d]})}return f},_getNearestCoordToPoint:function(t,r){for(var i=null,n=null,o=0,a=r.length;o<a;++o){var s=e.getDistance(r[o],t);(!i||s<n)&&(i=r[o],n=s)}return i},_transformArrowLength:function(e,t,r){var i={x:t||0,y:r||0},n=Kekule.CoordUtils.substract(this.transformCoordToContext(e,this.getChemObj(),i),this.transformCoordToContext(e,this.getChemObj(),{x:0,y:0}));return{arrowLength:Math.abs(n.x),arrowWidth:Math.abs(n.y)}},doDrawArrowShape:function(t,r,i,n,o,a,s){var l,u,d=Kekule.Glyph.ArrowSide,c=Kekule.Glyph.ArrowType,h=e.substract(n,i),p=e.getDistance(n,i),g=h.y/p,f=h.x/p,C=o.arrowLength,m=o.arrowWidth/2,T=e.substract(n,e.multiply(h,C/p)),E={x:m*g,y:-m*f},_=Kekule.Render.DrawPathUtils,S=[];!o.arrowSide||!s&&o.arrowSide===d.SINGLE||s&&o.arrowSide===d.REVERSED?(l=e.add(T,E),S.push("M"),S.push([l.x,l.y]),S.push("L"),S.push([n.x,n.y])):(S.push("M"),S.push([n.x,n.y])),(!o.arrowSide||!s&&o.arrowSide===d.REVERSED||s&&o.arrowSide===d.SINGLE)&&(u=e.substract(T,E),S.push("L"),S.push([u.x,u.y]));var O=!1;if(o.arrowType===c.TRIANGLE){var y=l&&u?null:T;y&&(S.push("L"),S.push([y.x,y.y])),S.push("Z"),O=!0}var A=_.makePath.apply(this,S),I=Object.create(a);return O||(I.fillColor="transparent"),this.drawPath(t,A,I)},doDrawLineShape:function(e,t,r,i,n,o){return{element:this.drawLine(e,r,i,n),boundInfo:this.createLineBoundInfo(r,i,n.strokeWidth)}},doDrawArcShape:function(e,t,r,i,n,o,a){var s=Object.create(a);return s.fillColor=null,{element:this.drawArc(e,t,r,i,n,o,s),boundInfo:this.createArcBoundInfo(t,r,i,n,o,s.strokeWidth)}}}),Kekule.Render.PathGlyph2DRenderer=Class.create(Kekule.Render.BaseGlyph2DRenderer,{CLASS_NAME:"Kekule.Render.PathGlyph2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._concreteChemObj=e.getCtab(),this._concreteRenderer=new Kekule.Render.PathGlyphCtab2DRenderer(e.getCtab(),t,this)},finalize:function(){this.tryApplySuper("finalize"),this._concreteRenderer&&(this._concreteRenderer.finalize(),this._concreteRenderer=null)},_getRenderSortIndex:function(){return this._concreteRenderer?this._concreteRenderer._getRenderSortIndex():this.tryApplySuper("_getRenderSortIndex")},getRenderCache:function(e){return this._concreteRenderer.getRenderCache(e)},_getConcreteRendererDrawOptions:function(e){return e},isChemObjRenderedBySelf:function(e,t){return this.tryApplySuper("isChemObjRenderedBySelf",[e,t])||t===this.getChemObj()||this._concreteRenderer.isChemObjRenderedBySelf(e,t)},isChemObjRenderedDirectlyBySelf:function(e,t){return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[e,t])||t===this.getChemObj()},doSetRedirectContext:function(e){this.tryApplySuper("doSetRedirectContext",[e]),this._concreteRenderer.setRedirectContext(e)},doDraw:function(e,t,r){this.tryApplySuper("doDraw",[e,t,r]);this.getChemObj();var i=Object.create(r);return i.partialDrawObjs&&(i.partialDrawObjs=null),this._concreteRenderer.draw(e,t,this._getConcreteRendererDrawOptions(i))},doRedraw:function(e){return this._concreteRenderer.redraw(e)},doUpdate:function(e,t,r){if(this._extractObjsOfUpdateObjDetails(t).indexOf(this.getChemObj())>=0){var i=this.getRenderCache(e);return this.doClear(e),this.draw(e,i.baseCoord,i.options)}return this._concreteRenderer.doUpdate(e,t,r)},doClear:function(e){return this._concreteRenderer.clear(e)},estimateRenderBox:function(e,t,r){return this._concreteRenderer.estimateRenderBox(e,this._getConcreteRendererDrawOptions(t),r)},transformCoordToObj:function(e,t,r){var i=this.getChemObj()===t?this._concreteChemObj:t;return this._concreteRenderer.transformCoordToObj(e,i,r)},transformCoordToContext:function(e,t,r){var i=this.getChemObj()===t?this._concreteChemObj:t;return this._concreteRenderer.transformCoordToContext(e,i,r)}}),Kekule.Render.Renderer2DFactory.register(Kekule.Glyph.PathGlyph,Kekule.Render.PathGlyph2DRenderer)}(),Kekule.Render.CanvasRendererBridge=Class.create(Kekule.Render.Abstract2DDrawBridge,{CLASS_NAME:"Kekule.Render.CanvasRendererBridge",DEF_DOUBLE_BUFFERED:!1,SHADOW_CANVAS_FIELD:"__$shadow_canvas__",SHADOW_CONTEXT_FIELD:"__$shadow_context__",getShadowContext:function(e){return e[this.SHADOW_CONTEXT_FIELD]},getShadowCanvas:function(e){return e[this.SHADOW_CANVAS_FIELD]},getOperatingContext:function(e){return this.getShadowContext(e)||e},createContext:function(e,t,r,i){var n=i&&i.id,o=i&&i.doubleBuffered;void 0===o&&(o=this.DEF_DOUBLE_BUFFERED);e.ownerDocument;var a=document.createElement("canvas");n&&(a.id=n);var s={alpha:!0};i&&(s=Object.extend(s,i)),e.appendChild(a);var l=a.getContext("2d",s);if(o){var u=document.createElement("canvas");u.style.position="absolute",u.style.display="none",e.appendChild(u),l[this.SHADOW_CANVAS_FIELD]=u,l[this.SHADOW_CONTEXT_FIELD]=u.getContext("2d",s)}return i&&i.overSamplingRatio&&this.setContextParam(l,"overSamplingRatio",i.overSamplingRatio),this.setContextDimension(l,t,r),l},releaseContext:function(e){var t=e.canvas,r=this.getShadowCanvas(e),i=t.parentNode;i&&(i.removeChild(t),r&&i.removeChild(r))},_getContextRawDimension:function(e){return{width:e.canvas.width,height:e.canvas.height}},_setContextRawDimension:function(e,t,r){var i=this.getShadowCanvas(e);t&&(e.canvas.width=t,e.canvas.style.width=t+"px",i&&(i.width=t,i.style.width=t+"px")),r&&(e.canvas.height=r,e.canvas.style.height=r+"px",i&&(i.height=r,i.style.height=r+"px")),this.clearContext(e)},getContextElem:function(e){return e?e.canvas:null},setContextViewBox:function(e,t,r,i,n,o){},prepareContext:function(e){},clearContext:function(e){var t=e.canvas;t.setAttribute("width",t.width);var r=this.getShadowCanvas(e);r&&(r.width=t.width);var i=e.__$clearColor__;if(i){e.save();try{var n=this.getContextDimension(e);this.drawRect(e,{x:0,y:0},{x:n.width,y:n.height},{fillColor:i,strokeColor:i})}finally{e.restore()}}},setClearColor:function(e,t){e&&(e.__$clearColor__=t)},setFilter:function(e,t){var r=this.getContextElem(e);r&&(r.style.filter=t)},clearFilter:function(e){this.setFilter(e,"none")},renderContext:function(e){var t=this.getShadowCanvas(e);if(t){var r=this.getContextDimension(e);e.drawImage(t,0,0,r.width,r.height)}},canModifyGraphic:function(e){return!1},_drawDashLine:function(e,t,r,i){null==i&&(i=5),e.moveTo(t.x,t.y);for(var n=r.x-t.x,o=r.y-t.y,a=Math.floor(Math.sqrt(n*n+o*o)/i),s=n/a,l=o/a,u=0,d=t.x,c=t.y;u++<a;)d+=s,c+=l,e[u%2==0?"moveTo":"lineTo"](d,c);e[u%2==0?"moveTo":"lineTo"](r.x2,r.y)},drawLine:function(e,t,r,i){var n=this.getOperatingContext(e);n.beginPath(),this.setDrawStyle(n,i),i.strokeDash&&!this.isLineDashSupported(n)?this._drawDashLine(n,t,r,i.strokeDash):(n.moveTo(t.x,t.y),n.lineTo(r.x,r.y)),this.doneDraw(n,i)},drawTriangle:function(e,t,r,i,n){var o=this.getOperatingContext(e);o.beginPath(),this.setDrawStyle(o,n),o.moveTo(t.x,t.y),o.lineTo(r.x,r.y),o.lineTo(i.x,i.y),o.closePath(),this.doneDraw(o,n)},drawRect:function(e,t,r,i){var n=this.getOperatingContext(e);n.beginPath(),this.setDrawStyle(n,i),n.rect(t.x,t.y,r.x-t.x,r.y-t.y),this.doneDraw(n,i)},drawRoundRect:function(e,t,r,i,n){return this.drawRect(e,t,r,n)},drawCircle:function(e,t,r,i){var n=this.getOperatingContext(e);n.beginPath(),this.setDrawStyle(n,i),n.arc(t.x,t.y,r,0,2*Math.PI,!1),this.doneDraw(n,i)},drawArc:function(e,t,r,i,n,o,a){var s=this.getOperatingContext(e);s.beginPath(),this.setDrawStyle(s,a),s.arc(t.x,t.y,r,i,n,o),this.doneDraw(s,a)},_PATH_CMDS:["M","Z","L","C","Q"],_PATH_METHODS:["moveTo","closePath","lineTo","bezierCurveTo","quadraticCurveTo"],drawPath:function(e,t,r){var i=this.getOperatingContext(e);if(!(t.length<=0)){var n;i.beginPath(),this.setDrawStyle(i,r);for(var o=0,a=t.length;o<a;++o){n=[];var s=t[o],l=s.method.toUpperCase(),u=this._PATH_CMDS.indexOf(l);if(u>=0){var d=this._PATH_METHODS[u];n=s.params,i[d].apply(i,n)}}this.doneDraw(i,r)}},drawImage:function(e,t,r,i,n,o,a){var s=this.getOperatingContext(e),l=this.getContextElem(s).ownerDocument.createElement("img");l.src=t;var u=this;l.onload=function(){try{u.setDrawStyle(s,n);var t=e;a&&(t=a()),(t=u.getOperatingContext(t)).drawImage(l,r.x,r.y,i.x,i.y),o&&o(!0),u.doneDraw(s,n),l.onload=null}catch(e){throw o&&o(!1),e}},l.src=t},drawImageElem:function(e,t,r,i,n){var o=this.getOperatingContext(e);this.setDrawStyle(o,n),o.drawImage(t,r.x,r.y,i.x,i.y),this.doneDraw(o,n)},isLineDashSupported:function(e){return Kekule.ObjUtils.isUnset(this.isLineDashSupported._cachedValue)&&(this.isLineDashSupported._cachedValue=e.setLineDash&&"number"==typeof e.lineDashOffset),this.isLineDashSupported._cachedValue},setTransformSeq:function(e,t){for(var r=Kekule.CoordUtils,i=Kekule.MatrixUtils,n=i.createIdentity(3),o=0,a=t.length;o<a;++o){var s=t[o],l=Object.extend({rotateAngle:s.rotate},s),u=r.calcTransform2DMatrix(l);n=i.multiply(n,u)}e.setTransform(n[0][0],n[1][0],n[0][1],n[1][1],n[0][2],n[1][2])},setDrawStyle:function(e,t){if(Kekule.ObjUtils.notUnset(t.strokeWidth)?e.lineWidth=t.strokeWidth:e.lineWidth=1,t.strokeColor&&(e.strokeStyle=t.strokeColor),e.lineCap=t.lineCap||"butt",e.lineJoin=t.lineJoin||"miter",this.isLineDashSupported(e))if(t.strokeDash){var r=!0===t.strokeDash?[5]:Kekule.ArrayUtils.isArray(t.strokeDash)?t.strokeDash:[t.strokeDash];e.setLineDash(r)}else e.setLineDash([]);t.fillColor?e.fillStyle=t.fillColor:e.fillStyle="transparent",Kekule.ObjUtils.notUnset(t.opacity)?e.globalAlpha=t.opacity:e.globalAlpha=1,t.transforms&&t.transforms.length||t.transform?this.setTransformSeq(e,t.transforms||[t.transform]):e.setTransform(1,0,0,1,0,0)},doneDraw:function(e,t){e.stroke(),t.fillColor&&e.fill()},getCanvasFontStyle:function(e){var t="";return e.fontStyle&&(t+=e.fontStyle+" "),e.fontWeight&&(t+=e.fontWeight+" "),e.fontSize&&("string"==typeof e.fontSize?t+=e.fontSize+" ":t+=e.fontSize+"px "),e.fontFamily&&(t+=e.fontFamily+" "),t},drawText:function(e,t,r,i){var n=this.getOperatingContext(e),o=n.font,a=n.fillStyle,s=this.getCanvasFontStyle(i);this.setDrawStyle(n,i),n.font=s,i.color&&(n.fillStyle=i.color),n.textBaseline="top",n.fillText(r,t.x,t.y),n.fontStyle=o,n.fillStyle=a},canMeasureText:function(e){return!0},measureText:function(e,t,r){var i=this.getCanvasFontStyle(r);e.font=i;var n=e.measureText(t),o=r.fontSize;return"string"==typeof o&&(o=Kekule.StyleUtils.analysisUnitsValue(o).value),{width:n.width,height:o}},canMeasureDrawnText:function(e){return!1},canModifyText:function(e){return!1},createGroup:function(e){},addToGroup:function(e,t){},removeFromGroup:function(e,t){},exportToDataUri:function(e,t,r){var i=this.getContextElem(e);return i?i.toDataURL(t,r):null}}),Kekule.Render.CanvasRendererBridge.isSupported=function(){var e=!1,t=Kekule.$jsRoot.document;return t&&t.createElement&&(e=!!t.createElement("canvas").getContext),e},Kekule.Render.CanvasRendererBridge.getAvailabilityInformation=function(){var e=!1,t=Kekule.$jsRoot.document;return t&&t.createElement&&(e=!!t.createElement("canvas").getContext),{available:e,message:e?null:Kekule.$L("ErrorMsg.CANVAS2D_NOT_UNAVAILABLE")}},Kekule.Render.DrawBridge2DMananger.register(Kekule.Render.CanvasRendererBridge,20),function(){"use strict";var e;Kekule.Render.RaphaelRendererBridge=Class.create(Kekule.Render.Abstract2DDrawBridge,{CLASS_NAME:"Kekule.Render.RaphaelRendererBridge",createContext:function(t,r,i,n){return e(t,r,i)},releaseContext:function(e){e.remove()},getContextDimension:function(e){return{width:e.width,height:e.height}},setContextDimension:function(e,t,r){e.setSize(t,r),this.clearContext(e)},clearContext:function(e){e.clear();var t=e.__$clearColor__;if(t){var r=this.getContextDimension(e);this.drawRect(e,{x:0,y:0},{x:r.width,y:r.height},{fillColor:t,strokeColor:t})}},setClearColor:function(e,t){e&&(e.__$clearColor__=t)},setFilter:function(e,t){var r=this.getContextElem(e);r&&(r.style.filter=t)},clearFilter:function(e){this.setFilter(e,"none")},getContextElem:function(e){return e?e.canvas:null},transformContextCoordToScreen:function(e,t){return t},transformScreenCoordToContext:function(e,t){return t},canModifyGraphic:function(e){return!0},drawPath:function(e,t,r){for(var i="",n=0,o=t.length;n<o;++n){var a=t[n];if(i+=a.method,a.params&&a.params.length)for(var s=0,l=a.params.length;s<l;++s)i+=0===s?"":",",DataType.isArrayValue(a.params[s])?i+=a.params[s].join(","):i+=a.params[s]}var u=e.path(i);return this.setBasicElemAttribs(u,r),u},drawLine:function(e,t,r,i){var n=e.line(t.x,t.y,r.x,r.y);return this.setBasicElemAttribs(n,i),n},drawTriangle:function(e,t,r,i,n){var o=e.triangle(t.x,t.y,r.x,r.y,i.x,i.y);return this.setBasicElemAttribs(o,n),o},drawRect:function(e,t,r,i){var n=e.rect(t.x,t.y,r.x-t.x,r.y-t.y);return this.setBasicElemAttribs(n,i),n},drawRoundRect:function(e,t,r,i,n){var o=e.rect(t.x,t.y,r.x-t.x,r.y-t.y,i);return this.setBasicElemAttribs(o,n),o},drawCircle:function(e,t,r,i){var n=e.circle(t.x,t.y,r);return this.setBasicElemAttribs(n,i),n},drawArc:function(e,t,r,i,n,o,a){var s=Kekule.GeometryUtils.polarToCartesian,l=Kekule.GeometryUtils.standardizeAngle,u=(Kekule.CoordUtils,s(t.x,t.y,r,n)),d=s(t.x,t.y,r,i),c=l(i,0),h=l(n,0)-c,p=l(h)<=Math.PI&&!o||l(h)>Math.PI&&o?"0":"1",g=o?"1":"0",f=["M",u.x,u.y,"A",r,r,0,p,g,d.x,d.y].join(" "),C=e.path(f);return this.setBasicElemAttribs(C,a),C},drawImage:function(e,t,r,i,n,o){try{var a=e.image(t,r.x,r.y,i.x,i.y);this.setBasicElemAttribs(a,n),o&&o(!0)}catch(e){throw o&&o(!1),e}return a},drawImageElem:function(e,t,r,i,n){return this.drawImage(e,t.src,r,i,n)},setBasicElemAttribs:function(e,t){if(Kekule.ObjUtils.notUnset(t.strokeWidth)&&e.attr("stroke-width",t.strokeWidth),t.strokeColor&&e.attr("stroke",t.strokeColor),t.strokeDash){e.attr("stroke-dasharray","- ")}t.fillColor&&e.attr("fill",t.fillColor),t.opacity&&e.attr({"stroke-opacity":t.opacity,"fill-opacity":t.opacity}),t.lineCap&&e.attr("stroke-linecap",t.lineCap),t.lineJoin&&e.attr("stroke-linejoin",t.lineJoin),(t.transforms&&t.transforms.length||t.transform)&&this.setTransformSeq(e,t.transforms||[t.transform])},setTransformSeq:function(e,t){for(var r=0,i=t.length;r<i;++r){var n=Object.extend({rotateAngle:t[r].rotate},t[r]);this.setTransform(e,n)}},setTransform:function(e,t){var r=t.center||{x:0,y:0};t.rotateAngle&&e.rotate(t.rotateAngle/Math.PI*180,r.x,r.y);var i=Kekule.oneOf(t.scaleX,t.scale,1),n=Kekule.oneOf(t.scaleY,t.scale,1);1===i&&1===n||e.scale(i,n,r.x,r.y),(t.translateX||t.translateY)&&e.translate(t.translateX||0,t.translateY||0)},getRaphaelFontStyle:function(e){var t={};return e.fontStyle&&(t["font-style"]=e.fontStyle),e.fontWeight&&(t["font-weight"]=e.fontWeight),e.fontSize&&(t["font-size"]=e.fontSize+"px"),e.fontFamily&&(t["font-family"]=e.fontFamily),t},drawText:function(e,t,r,i){r.endsWith(" ")&&(r=r.substring(0,r.length-1)+" "),r.startsWith(" ")&&(r=" "+r.substr(1));var n=this.getRaphaelFontStyle(i),o=e.text(-1e4,-1e4,r);return o.attr(n),i.color&&o.attr({stroke:i.color,fill:i.color}),this.modifyDrawnTextCoord(e,o,t),this.setBasicElemAttribs(o,i),o},canMeasureText:function(e){return!1},canMeasureDrawnText:function(e){return!0},canModifyText:function(e){return!0},measureDrawnText:function(e,t,r){var i=Kekule.oneOf,n=t.getBBox(),o={};return o.width=i(n.width,n.x2-n.x1),o.height=i(n.height,n.y2-n.y1),o},modifyDrawnTextCoord:function(e,t,r){var i=this.measureDrawnText(e,t,null);t.attr({x:r.x+i.width/2,y:r.y+i.height/2})},createGroup:function(e){return e.set()},addToGroup:function(e,t){return t.push(e)},removeFromGroup:function(e,t){return e!==t&&t.exclude(e)},removeDrawnElem:function(e,t){t.remove()},exportToDataUri:function(e,t,r){if(e.toSVG){var i=e.toSVG();return"data:image/svg+xml;base64,"+btoa(i)}if(e.canvas&&"svg"===e.canvas.tagName.toLowerCase()){i=DataType.XmlUtility.serializeNode(e.canvas);return"data:image/svg+xml;base64,"+btoa(i)}}}),Kekule.Render.RaphaelRendererBridge.isSupported=function(){var t=!1;return Kekule.$jsRoot.Raphael&&(t=!(!e.svg&&!e.vml)),t},Kekule.Render.RaphaelRendererBridge.getAvailabilityInformation=function(){var e=!!Kekule.$jsRoot.Raphael,t=!(!e||!Kekule.$jsRoot.Raphael.svg&&!Kekule.$jsRoot.Raphael.vml);return{available:!!t,message:e?t?null:Kekule.$L("ErrorMsg.RAPHAEL_SVG_VML_UNAVAILABLE"):Kekule.$L("ErrorMsg.RAPHAEL_LIB_NOT_UNAVAILABLE")}},Kekule.Render.DrawBridge2DMananger.register(Kekule.Render.RaphaelRendererBridge,10);var t=function(){var e;t.registered||Kekule.$jsRoot.Raphael&&Kekule.$jsRoot.Raphael.el&&(e=Kekule.$jsRoot.Raphael,Kekule.Render.registerExternalModule("Raphael.js",e),t.registered=!0)};Kekule.externalResourceManager.on("Raphael.jsRegistered",function(){(e=Kekule.externalResourceManager.getResource("Raphael.js"))&&(e.fn.line=function(e,t,r,i){return this.path("M"+e+" "+t+" L"+r+" "+i)},e.fn.arrowLine=function(e,t,r,i,n){if(!n)return this.line(e,t,r,i);var o=this.set(),a=r-e,s=i-t,l=Math.atan(s/a),u=(n.width||6)/2,d=n.length||3,c=Math.atan(u/d),h=Math.sqrt(Math.sqr(u)+Math.sqr(d));return o.push(this.path("M"+r+" "+i+" L"+(r-h*Math.cos(l-c))+" "+(i-h*Math.sin(l-c))+" M"+r+" "+i+" L"+(r-h*Math.cos(l+c))+" "+(i-h*Math.sin(l+c))),this.path("M"+e+" "+t+" L"+r+" "+i)),o},e.fn.triangle=function(e,t,r,i,n,o){return this.path("M"+e+" "+t+" L"+r+" "+i+" L"+n+" "+o+" L"+e+" "+t)},e.fn.polygon=function(e){for(var t="M"+e[0].x+" "+e[0].y,r=1,i=e.length;r<i;++r)t+=" L"+e[r].x+" "+e[r].y;return t+="L"+e[0].x+" "+e[0].y,this.path(t)},e.el.translateCoord=function(e){if(this.forEach)this.forEach(function(t){t.translateCoord(e)});else{var t=this.attr(["x","y"]);void 0!==t.x&&void 0!==t.y&&this.attr({x:t.x+e.x,y:t.y+e.y})}return this},e.st.translateCoord=function(e){return this.forEach&&this.forEach(function(t){t.translateCoord(e)}),this},e.st.remove=function(e){this.forEach(function(e){e.remove()},this),this.clear()}),Kekule.Render.DrawBridge2DMananger.register(Kekule.Render.RaphaelRendererBridge,10)}),Kekule.externalResourceManager.on("Raphael.jsUnregistered",function(){}),t(),Kekule.X.domReady(t)}(),function(){var e=Kekule.ObjUtils,t=Kekule.BoxUtils,r=Kekule.Render.Molecule3DDisplayType,i=Kekule.Render.Bond3DRenderMode,n=Kekule.Render.Bond3DRenderType,o=Kekule.Render.Bond3DSpliceMode,a=Kekule.Render.Node3DRenderMode,s=Kekule.oneOf;Kekule.globalOptions.add("render.render3D",{autofitOnPrimaryDirection:!1}),Kekule.Render.Abstract3DDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.Abstract3DDrawBridge",CONTEXT_PARAMS_FIELD:"__$context_params__",getGraphicQualityLevel:function(){return null},setGraphicQualityLevel:function(e){},transformContextCoordToScreen:function(e,t){return{x:t.x,y:t.y}},canModifyGraphic:function(e){return!1},createContext:function(e,t,r){return null},getContextDimension:function(e){return{}},setContextDimension:function(e,t,r){return null},clearContext:function(e){return null},getContextParam:function(e,t){return(e[this.CONTEXT_PARAMS_FIELD]||{})[t]},setContextParam:function(e,t,r){e[this.CONTEXT_PARAMS_FIELD]||(e[this.CONTEXT_PARAMS_FIELD]={}),e[this.CONTEXT_PARAMS_FIELD][t]=r},_getOverSamplingRatio:function(e){return this.getContextParam(e,"overSamplingRatio")||null},setClearColor:function(e,t){},drawSphere:function(e,t,r,i){},drawCylinder:function(e,t,r,i,n){},drawLine:function(e,t,r,i){},createDrawGroup:function(e){},addToDrawGroup:function(e,t){},removeFromDrawGroup:function(e,t){},getCameraProps:function(e){},setCameraProps:function(e,t){},exportToDataUri:function(e,t,r){}}),Kekule.Render.Base3DRenderer=Class.create(Kekule.Render.CompositeRenderer,{CLASS_NAME:"Kekule.Render.Base3DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},getRendererType:function(){return Kekule.Render.RendererType.R3D},getActualTargetContext:function(e){return this.getRedirectContext()||e},getCameraProps:function(e){return this.getDrawBridge().getCameraProps(e)},setCameraProps:function(e,t){return this.getDrawBridge().setCameraProps(e,t)},getInitialLightPositions:function(e){return this.getDrawBridge().getInitialLightPositions&&this.getDrawBridge().getInitialLightPositions(e)},getLightCount:function(e){return this.getDrawBridge().getLightCount&&this.getDrawBridge().getLightCount(e)},getLightProps:function(e,t){return this.getDrawBridge().getLightProps&&this.getDrawBridge().getLightProps(e,t)},setLightProps:function(e,t,r){return this.getDrawBridge().setLightProps(e,t,r)},drawSphere:function(e,t,r,i){return this.getDrawBridge().drawSphere(this.getActualTargetContext(e),t,r,i)},drawCylinder:function(e,t,r,i,n){var o=this.getDrawBridge();return o?o.drawCylinder(this.getActualTargetContext(e),t,r,i,n):null},drawCylinderEx:function(e,t,r,i,n){var o=null,a=this.drawCylinder(e,t,r,i,n);if(a&&n.withEndCaps){o=this.createDrawGroup(e);var s=this.drawSphere(e,t,i);this.addToDrawGroup(s,o);s=this.drawSphere(e,r,i);this.addToDrawGroup(s,o)}return o||a},drawParallelCylinders:function(e,t,r){var i=this.getDrawBridge();if(i.drawParallelCylinders)return i.drawParallelCylinders(this.getActualTargetContext(e),t,r);for(var n=this.createDrawGroup(e),o=0,a=t.length;o<a;++o){var s=t[o],l=this.drawCylinderEx(e,s.coord1,s.coord2,s.radius,{color:s.color,withEndCaps:r});l&&this.addToDrawGroup(l,n)}return n},drawLine:function(e,t,r,i){var n=this.getDrawBridge();return n?n.drawLine(this.getActualTargetContext(e),t,r,i):null},drawParallelLines:function(e,t,r){var i=this.getDrawBridge();if(i.drawParallelLines)return i.drawParallelLines(this.getActualTargetContext(e),t,r);if(i.drawLine){for(var n,o=t.length,a=[],s=0;s<o;++s){var l=t[s],u=this.drawLine(e,l.coord1,l.coord2,{lineWidth:l.lineWidth,color:l.color,opacity:l.opacity});u&&a.push(u)}if(a.length<=1)n=a[0];else{n=this.createDrawGroup(e);s=0;for(var d=a.length;s<d;++s)this.addToDrawGroup(a[s],n)}return n}},createDrawGroup:function(e){return this.getDrawBridge().createGroup(this.getActualTargetContext(e))},addToDrawGroup:function(e,t){return this.getDrawBridge().addToGroup(e,t)},removeFromDrawGroup:function(e,t){return this.getDrawBridge().removeFromGroup(e,t)},removeDrawnElem:function(e,t){}}),Kekule.Render.ChemObj3DRenderer=Class.create(Kekule.Render.Base3DRenderer,{CLASS_NAME:"Kekule.Render.ChemObj3DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._enableTransformByCamera=!0},doEstimateSelfObjBox:function(e,t,r){return Kekule.Render.ObjUtils.getContainerBox(this.getChemObj(),this.getCoordMode(),r)},doEstimateRenderBox:function(e,r,i,n){var o=this.estimateObjBox(e,i,n);if(o){var a=this.prepareTransformParams(e,r,i,o);return t.transform3D(o,a)}return null},beginDraw:function(e,t,r){if(this.tryApplySuper("beginDraw",[e,t,r]),this.isRootRenderer()){var i=this.getDrawBridge();if(i&&i.setGraphicQualityLevel){var n=r.graphicQuality;i.setGraphicQualityLevel(n)}}},endDraw:function(e,t,r){this.isRootRenderer()&&this.adjustCamera(e,r.transformParams),this.tryApplySuper("endDraw",[e,t,r])},doDraw:function(e,t,r){return this.prepareTransformParams(e,t,r),this.tryApplySuper("doDraw",[e,t,r])},changeGeometryOptions:function(e,t,r){var i=Object.create(r);this.prepareTransformParams(e,t,i).pureCameraTransform?this.endDraw(e,t,i):(this.getDrawBridge().clearContext(e),this.draw(e,t,r))},prepareTransformParams:function(e,t,r,i){var n;if(r.transformParams)n=r.transformParams;else{var o=this.generateTransformParams(e,t,r,i);r.transformParams=o,n=o}var a=Kekule.CoordUtils.calcTransform3DMatrix(n),s=Kekule.CoordUtils.calcInverseTransform3DMatrix(n);return r.transformParams.transformMatrix=a,r.transformParams.invTransformMatrix=s,this.getRenderCache(e).transformParams=n,this.getRenderCache(e).transformMatrix=a,this.getRenderCache(e).invTransformMatrix=s,this.getRenderCache(e).transformParams=n,n},canDoPureCameraTransform:function(e,t){return this._enableTransformByCamera&&t.scaleX===t.scaleY&&t.scaleY===t.scaleZ&&!t.rotateAngle&&!t.rotateX&&!t.rotateY&&!t.rotateZ},generateTransformParams:function(t,r,i,n){var o={};o.allowCoordBorrow=s(i.allowCoordBorrow,!1),o.unitLength=i.unitLength||1,n||(n=this.estimateObjBox(t,i,o.allowCoordBorrow)),n||(n={x1:0,x2:1,y1:0,y2:1,z1:0,z2:1});var a={x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2,z:(n.z1+n.z2)/2},l=Kekule.ObjUtils;l.isUnset(i.translateX)&&l.isUnset(i.translateY)&&l.isUnset(i.translateZ)?r&&(o.translateX=r.x-a.x,o.translateY=r.y-a.y,o.translateZ=r.z||0-a.z||0):(o.translateX=i.translateX||0,o.translateY=i.translateY||0,o.translateZ=i.translateZ||0),o.zoom=i.zoom||1,o.scaleX=s(i.scaleX,i.scale,1),o.scaleY=s(i.scaleY,i.scale,1),o.scaleZ=s(i.scaleZ,i.scale,1);i.scaleX||i.scaleY||i.scaleZ||i.scale;e.notUnset(i.rotateMatrix)?o.rotateMatrix=i.rotateMatrix:e.notUnset(i.rotateAngle)&&e.notUnset(i.rotateAxisVector)?o.rotateMatrix=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:i.rotateAngle,rotateAxisVector:i.rotateAxisVector}):(o.rotateX||o.rotateY||o.rotateZ)&&(o.rotateMatrix=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:i.rotateX||0,rotateY:i.rotateY||0,rotateZ:i.rotateZ||0})),l.isUnset(i.center)&&(o.center=a),o.drawBaseCoord=r||Kekule.CoordUtils.transform3D(a,o);var u=Object.extend({},o);(o=this.getFinalTransformParams(t,o)).initialTransformOptions=u;var d=this.canDoPureCameraTransform(t,o);if(o.pureCameraTransform=d,this.isRootRenderer()&&(i.autofit||!i.cameraPos)){var c,h=this.getAutofitObjBoxInflation(t,this.getChemObj(),i),p=Kekule.BoxUtils.inflateBox(n,h.x,h.y,h.z),g=Math.max(Math.abs(p.x2-p.x1),Math.abs(p.y2-p.y1)),f=this.getCameraProps(t);c=Kekule.globalOptions.render.render3D.autofitOnPrimaryDirection?f.fov:f.fovMin||f.fov;var C=g/2/Math.tan(c/2),m=Math.sqrt(Math.sqr(C)-Math.sqr(g/2));if(d){m/=o.scaleX,o.cameraWidth=g/o.scaleX,o.cameraHeight=o.cameraWidth;var T,E,_,S,O=Kekule.MatrixUtils.create(4,1,[0,0,1,1]),y=Kekule.MatrixUtils.create(4,1,[0,1,1,1]);if(o.rotateMatrix){var A=Kekule.MatrixUtils.transpose(o.rotateMatrix);T=Kekule.MatrixUtils.multiply(A,O),_=Kekule.MatrixUtils.multiply(A,y),E={x:T[0],y:T[1],z:T[2]},S={x:_[0],y:_[1],z:_[2]}}else E={x:0,y:0,z:1},S={x:0,y:1,z:1};E=Kekule.CoordUtils.multiply(E,m),o.cameraPos={x:E.x,y:E.y,z:E.z},o.cameraPos=Kekule.CoordUtils.add(o.cameraPos,o.drawBaseCoord),o.cameraUp=S,o.scaleX=o.scaleY=o.scaleZ=1;var I=this.getInitialLightPositions(t);if(A){var k=this.getLightCount(t);if(I&&I.length&&k)for(var b=Math.min(I.length,k),v=[],R=0;R<b;++R){var D=I[R];if(D){var N=Kekule.MatrixUtils.create(4,1,[D.x,D.y,D.z,1]),P=Kekule.MatrixUtils.multiply(A,N),M={x:P[0],y:P[1],z:P[2]};v.push(M)}}}o.lightPositions=v||I,o.rotateMatrix=null}else o.cameraPos={x:o.drawBaseCoord.x,y:o.drawBaseCoord.y,z:m+o.drawBaseCoord.z},o.cameraUp={x:0,y:1,z:1};o.cameraLookAtVector=o.drawBaseCoord||{x:0,y:0,z:0};var K={x:-o.translateX,y:-o.translateY,z:-o.translateZ};o.translateX=o.translateY=o.translateZ=0,o.cameraPos=Kekule.CoordUtils.add(o.cameraPos,K),o.cameraLookAtVector=Kekule.CoordUtils.add(o.cameraLookAtVector,K)}return o},getFinalTransformParams:function(e,t){var r=Object.create(t);return r.zoom&&(r.scaleX*=r.zoom,r.scaleY*=r.zoom,r.scaleZ*=r.zoom),1!==r.unitLength&&(r.translateX*=r.unitLength,r.translateY*=r.unitLength,r.translateZ*=r.unitLength,r.drawBaseCoord&&(r.drawBaseCoord=Kekule.CoordUtils.multiply(r.drawBaseCoord,r.unitLength))),r},getRenderFinalTransformParams:function(e){return this.getRenderCache(e).transformParams},getRenderInitialTransformOptions:function(e){var t=this.getRenderFinalTransformParams(e);return t?t.initialTransformOptions:null},getAutofitObjBoxInflation:function(e,t,r){var i=r.fixedNodeRadius||0;return{x:i,y:i,z:i}},adjustCamera:function(e,t){var r=t.cameraWidth,i=t.cameraHeight,n={position:t.cameraPos,upVector:t.cameraUp,lookAtVector:t.cameraLookAtVector};if(r&&i){var o=r/2,a=i/2;n.left=-o,n.right=o,n.top=a,n.bottom=-a}this.setCameraProps(e,n),this.adjustLights(e,t)},adjustLights:function(e,t){for(var r=t.lightPositions||[],i=0,n=r.length;i<n;++i){var o=r[i];o&&this.setLightProps(e,i,{position:o})}}}),Kekule.Render.ChemCtab3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemCtab3DRenderer",TRANSFORM_COORD_FIELD:"__$transCoord3D__",DRAW_ELEM_FIELD:"__$drawElem__",DRAW_COLOR_FIELD:"__$drawColor__",BASE_RADIUS_FIELD:"__$baseRadius__",TRANSFORM_MATRIX_FIELD:"__$transMatrix__",INV_TRANSFORM_MATRIX_FIELD:"__$inverseTransMatrix__",CHILD_TRANSFORM_MATRIX_FIELD:"__$childTransMatrix__",HIDDEN_NODES_FIELD:"__$hiddenNodes__",HIDDEN_CONNECTORS_FIELD:"__$hiddenConnectors__",getObjDrawElem:function(e,t){return this.getExtraProp2(e,t,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(e,t,r){this.setExtraProp2(e,t,this.DRAW_ELEM_FIELD,r)},getObjDrawColor:function(e,t){return this.getExtraProp2(e,t,this.DRAW_COLOR_FIELD)},setObjDrawColor:function(e,t,r){this.setExtraProp2(e,t,this.DRAW_COLOR_FIELD,r)},getNodeBaseRadius:function(e,t){return this.getExtraProp2(e,t,this.BASE_RADIUS_FIELD)},setNodeBaseRadius:function(e,t,r){this.setExtraProp2(e,t,this.BASE_RADIUS_FIELD,r)},getHiddenNodes:function(e){return this.getExtraProp(e,this.HIDDEN_NODES_FIELD)||[]},setHiddenNodes:function(e,t){return this.setExtraProp(e,this.HIDDEN_NODES_FIELD,t)},getHiddenConnectors:function(e){return this.getExtraProp(e,this.HIDDEN_CONNECTORS_FIELD)||[]},setHiddenConnectors:function(e,t){return this.setExtraProp(e,this.HIDDEN_CONNECTORS_FIELD,t)},doEstimateSelfObjBox:function(e,t,r){return this.getChemObj().getExposedContainerBox3D(r)},doPrepare:function(e,t,n,o){var s,l,u=o,d=this.getRenderCache(e);switch(u.moleculeDisplayType){case r.WIRE:s=a.NONE,l=u.displayMultipleBond?i.MULTI_WIRE:i.WIRE;break;case r.STICKS:s=a.NONE,l=u.displayMultipleBond?i.MULTI_CYLINDER:i.CYLINDER;break;case r.SPACE_FILL:s=a.SPACE,l=i.NONE;break;case r.BALL_STICK:default:s=a.BALL,l=u.displayMultipleBond?i.MULTI_CYLINDER:i.CYLINDER}d.nodeRenderMode=s,d.connectorRenderMode=l,d.options=u;var c=t.getExposedNodes(),h=t.getExposedConnectors();return this.prepareHiddenObjects(e,c,h,u),this.prepareNodesDrawColor(e,c,u),this.prepareNodeBaseRadii(e,c,u),u},prepareHiddenObjects:function(e,t,r,i){var n=[];this.setHiddenNodes(e,n);for(var o=0,a=t.length;o<a;++o){var s=t[o];i.hideHydrogens&&s instanceof Kekule.Atom&&1===s.getAtomicNumber()&&n.push(s)}var l=[];this.setHiddenConnectors(e,l);for(o=0,a=r.length;o<a;++o){var u=r[o],d=u.getConnectedExposedObjs();Kekule.ArrayUtils.exclude(d,n)<2&&l.push(u)}},prepareNodesDrawColor:function(e,t,r){for(var i=r.useAtomSpecifiedColor,n=0,o=t.length;n<o;++n){var a=t[n],l=a.getOverriddenRender3DOptions()||{},u=l.color||l.atomColor;if(u&&!l.useAtomSpecifiedColor);else if(i||l.useAtomSpecifiedColor){var d=a.getAtomicNumber?a.getAtomicNumber():0;u=d>=0?Kekule.Render.RenderColorUtils.getColor(d,this.getRendererType()):Kekule.Render.RenderColorUtils.getColor(a.getClassLocalName(),this.getRendererType())}else u=s(l.color||r.atomColor);this.setObjDrawColor(e,a,u)}},prepareNodeBaseRadii:function(e,t,r){for(var i=0,n=t.length;i<n;++i){var o,a=t[i];o=this.calcNodeBaseRadius(a,r),this.setNodeBaseRadius(e,a,o)}},calcNodeBaseRadius:function(e,t){var r,i=e.getOverriddenRender3DOptions()||{},n=e.getAtomicNumber?e.getAtomicNumber():null;if(i.nodeRadius||t.nodeRadius)r=i.nodeRadius||t.nodeRadius;else if(s(i.useVdWRadius,t.useVdWRadius)&&n){r=Kekule.ChemicalElementsDataUtil.getElementProp(n,"radiiVdw")||i.fixedNodeRadius||t.fixedNodeRadius}else r=s(i.fixedNodeRadius,t.fixedNodeRadius);return r},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var i=this.getChemObj(),n=r.transformParams;this.getRenderCache(e).transformOptions=n,this.transformCtabCoords3DToContext(e,i,n);var o=this.doPrepare(e,i,t,r);return this.doDrawCore(e,i,o,n)},doRedraw:function(e){var t=this.getRenderCache(e);return this.doDrawCore(e,this.getChemObj(),t.options,t.transformOptions)},doDrawCore:function(e,t,r,i){var n=this.createDrawGroup(e);return this.doDrawConnectors(e,n,t,r,i),this.doDrawNodes(e,n,t,r,i),this.setObjDrawElem(e,t,n),n},transformCtabCoords3DToContext:function(e,t,r){var i=r.allowCoordBorrow;r.scaleX=r.scaleX||r.scale,r.scaleY=r.scaleY||r.scale,r.scaleZ=r.scaleZ||r.scale;var n=Object.extend({},r);n.centerX=0,n.centerY=0;var o=r.transformMatrix;this.setExtraProp2(e,t,this.TRANSFORM_MATRIX_FIELD,o);var a=o;this.setExtraProp2(e,t,this.CHILD_TRANSFORM_MATRIX_FIELD,o);var s=r.invTransformMatrix;this.setExtraProp2(e,t,this.INV_TRANSFORM_MATRIX_FIELD,s);for(var l=0,u=t.getNodeCount();l<u;++l){var d=t.getNodeAt(l);this.transformObjCoord3DToContext(e,d,o,a,i)}},transformObjCoord3DToContext:function(e,t,r,i,n){var o,a;if(t&&t.getAbsBaseCoord3D){if(a=t.getAbsBaseCoord3D(n)){var s=Kekule.CoordUtils.transform3DByMatrix(a,r);this.setTransformedCoord3D(e,t,s),o=s}if(t.getNodes)for(var l=0,u=t.getNodeCount();l<u;++l)this.transformObjCoord3DToContext(e,t.getNodeAt(l),i,i,n)}return o},getTransformedCoord3D:function(e,t,r){Kekule.ObjUtils.isUnset(r)&&(r=this.getRenderCache(e).options.transformParams.allowCoordBorrow);var i=t instanceof Kekule.BaseStructureNode&&this.getExtraProp2(e,t,this.TRANSFORM_COORD_FIELD);if(!i){var n=this.getChemObj(),o=this.getExtraProp2(e,n,this.TRANSFORM_MATRIX_FIELD),a=this.getExtraProp2(e,n,this.CHILD_TRANSFORM_MATRIX_FIELD);i=n&&(n.hasNode(t,!1)||n.hasConnector(t,!1))?this.transformObjCoord3DToContext(t,o,a,r):this.transformObjCoord3DToContext(t,a,a,r)}return i},setTransformedCoord3D:function(e,t,r){this.setExtraProp2(e,t,this.TRANSFORM_COORD_FIELD,r)},doTransformCoordToObj:function(e,t,r){var i=this.getExtraProp2(e,t,this.INV_TRANSFORM_MATRIX_FIELD);return Kekule.CoordUtils.transform3DByMatrix(r,i)},doTransformCoordToContext:function(e,t,r){var i=this.getExtraProp2(e,t,this.TRANSFORM_MATRIX_FIELD);return Kekule.CoordUtils.transform3DByMatrix(r,i)},doDrawNodes:function(e,t,r,i,n){for(var o=r.getExposedNodes(),a=this.getHiddenNodes(e),s=0,l=o.length;s<l;++s){var u=o[s];if(!(a.indexOf(u)>=0))this.doDrawNode(e,t,u,r,i,n)}},doDrawNode:function(e,t,r,i,n,o){var s,l,u,d=this.getRenderCache(e).nodeRenderMode;if(d===a.NONE)return null;l=Kekule.Render.RenderOptionUtils.mergeObjLocalRender3DOptions(r,n),u=this.getNodeBaseRadius(e,r),Kekule.ObjUtils.isUnset(u)&&(u=this.calcNodeBaseRadius(r,n)),d===a.SPACE?u*=o.scaleX:u*=l.nodeRadiusRatio*o.scaleX;var c=this.getObjDrawColor(e,r),h=this.getTransformedCoord3D(e,r,o.allowCoordBorrow);s=this.drawSphere(e,h,u,{color:c,opacity:l.opacity});var p=this.createSphereBoundInfo(h,u);this.basicDrawObjectUpdated(e,r,i,p,Kekule.Render.ObjectUpdateType.ADD),s&&(this.setObjDrawElem(e,r,s),t&&this.addToDrawGroup(s,t))},doDrawConnectors:function(e,t,r,n,o){if(this.getRenderCache(e).connectorRenderMode===i.NONE)return null;for(var a=r.getExposedConnectors(),s=this.getHiddenConnectors(e),l=0,u=a.length;l<u;++l){var d=a[l];if(!(s.indexOf(d)>=0))this.doDrawConnector(e,t,d,r,n,o)}},doDrawConnector:function(e,t,r,i,n,o){var a=Object.create(n);a=Kekule.Render.RenderOptionUtils.mergeObjLocalRender3DOptions(r,n);for(var s,l,u,d,c,h=this.getHiddenNodes(e),p=r.getConnectedExposedObjs(),g=(p=Kekule.ArrayUtils.exclude(p,h)).length,f=g>2?this.createDrawGroup(e):null,C=0;C<g;++C)if(s=p[C],u=this.getTransformedCoord3D(e,s,o.allowCoordBorrow))for(var m=C+1;m<g;++m)l=p[m],(d=this.getTransformedCoord3D(e,l,o.allowCoordBorrow))&&(c=this.doDrawConnectorShape(e,r,[s,l],i,u,d,a,o))&&f&&this.addToDrawGroup(c,f);return f?this.addToDrawGroup(f,t):this.addToDrawGroup(c,t),f||c},doDrawConnectorShape:function(e,t,r,a,l,u,d,c){var h=Kekule.CoordUtils,p=t.getOverriddenRender3DOptions()||{},g=(d.unitLength,r[0]),f=r[1],C=s(p.bondSpliceMode,d.bondSpliceMode),m=C===o.MID_SPLIT?.5:null;if(C===o.WEIGHTING_SPLIT){var T=this.getNodeBaseRadius(e,g),E=this.getNodeBaseRadius(e,f);m=T&&E?T/(T+E):.5}var _=null,S=!1,O=[];if(m){var y=s(d.color||d.bondColor),A=s(p.color||p.bondColor);if(S=!1,A)O.push(A);else{var I=s(this.getObjDrawColor(e,g),y),k=s(this.getObjDrawColor(e,f),y);I!==k?(O.push(I),O.push(k),S=!0):O.push(s(I,d.color,d.bondColor,d.defBondColor))}}else O.push(s(p.color,p.bondColor,d.color,d.bondColor,d.defBondColor));if(m&&S){var b=u.x-l.x,v=u.y-l.y,R=u.z-l.z;(_={}).x=l.x+b*m,_.y=l.y+v*m,_.z=l.z+R*m}var D=S?[[l,_],[_,u]]:[[l,u]],N=this.getRenderCache(e).connectorRenderMode,P=this._getBondRenderType(t,N),M=!1,K=s(p.connectorRadius,d.connectorRadius)*s(p.connectorRadiusRatio,d.connectorRadiusRatio)*d.unitLength;K*=c.scaleX;var L=s(p.connectorLineWidth,d.connectorLineWidth)*d.unitLength;P!==n.SINGLE&&P!==n.DASH?(K*=s(p.multiConnectorRadiusRatio,d.multiConnectorRadiusRatio),M=N===i.MULTI_CYLINDER):M=!1;var x,B=[],U=1;switch(P){case n.SINGLE:U=1;break;case n.DOUBLE:U=2;break;case n.TRIPLE:U=3;break;case n.DASH:case n.SOLID_DASH:}var w=null;if((x=U)>1){var F=s(p.multiConnectorMarginRatio,d.multiConnectorMarginRatio)*K;M&&(F+=2*K);var V=h.getDistance(l,u),j=h.substract(u,l),W={x:-F*(j.y/V),y:F*(j.x/V),z:0};w=(x%2?0:.5)-Math.floor(x/2);var G=h.multiply(W,w)}for(var H=0,z=D.length;H<z;++H){if(1===x)(J={}).coord1=D[H][0],J.coord2=D[H][1],S&&(J.jointCoordIndex=0===H?2:1),J.color=O[H],J.radius=K,J.lineWidth=L,J.opacity=d.opacity,B.push(J);else for(var Y=h.add(D[H][0],G),X=h.add(D[H][1],G),$=0;$<x;++$){var J;(J={}).coord1=Y,J.coord2=X,Y=h.add(Y,W),X=h.add(X,W),S&&(J.jointCoordIndex=0===H?2:1),J.color=O[H],J.radius=K,J.lineWidth=L,J.opacity=d.opacity,B.push(J)}}var q,Z=N;return q=Z===i.WIRE||Z===i.MULTI_WIRE?this.createLineBoundInfo(l,u,{width:L}):this.createCylinderBoundInfo(l,u,{radius:K}),this.basicDrawObjectUpdated(e,t,a,q,Kekule.Render.ObjectUpdateType.ADD),this.doDrawConnectorSet(e,B,Z,P,d)},doDrawConnectorSet:function(e,t,r,n,o){if(r===i.WIRE||r===i.MULTI_WIRE)return this.drawParallelLines(e,t);var s=this.getRenderCache(e).nodeRenderMode===a.NONE;return this.drawParallelCylinders(e,t,s)},_getBondRenderType:function(e,t){var r=e.getOverriddenRender3DOptions()||{},i=Kekule.Render.Render3DOptionUtils.getConnectorRenderType(r);return i||Kekule.Render.ConnectorDrawUtils.getConnectorRender3DType(e,t)}}),Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.Render.ChemCtab3DRenderer),Kekule.Render.StructFragment3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.StructFragment3DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._concreteRenderer=null,e.hasCtab()?this._concreteRenderer=new Kekule.Render.ChemCtab3DRenderer(e.getCtab(),t,this):(this._concreteRenderer=null,Kekule.raise(Kekule.$L("ErrorMsg.FORMULA_RENDERER_3D_NOT_AVAILABLE"))),this._concreteRenderer.setParentRenderer(this)},finalize:function(){this.tryApplySuper("finalize"),this._concreteRenderer&&this._concreteRenderer.finalize()},getRenderCache:function(e){return this._concreteRenderer.getRenderCache(e)},_getConcreteRendererDrawOptions:function(e){var t=Object.create(e||{}),r=this.getChemObj(),i=this.getRendererType()===Kekule.Render.RendererType.R3D?r.getOverriddenRender3DOptions():r.getOverriddenRenderOptions();return t=Object.extend(t,i||{})},isChemObjRenderedBySelf:function(e,t){return this.tryApplySuper("isChemObjRenderedBySelf",[e,t])||t===this.getChemObj()||this._concreteRenderer.isChemObjRenderedBySelf(e,t)},isChemObjRenderedDirectlyBySelf:function(e,t){return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[e,t])||t===this.getChemObj()},doSetRedirectContext:function(e){this.tryApplySuper("doSetRedirectContext",[e]),this._concreteRenderer.setRedirectContext(e)},doDrawSelf:function(e,t,r){return this.tryApplySuper("doDrawSelf",[e,t,r]),this._concreteRenderer.draw(e,t,this._getConcreteRendererDrawOptions(r))},doRedraw:function(e){return this._concreteRenderer.redraw(e)},doUpdateSelf:function(e,t,r){if(this._extractObjsOfUpdateObjDetails(t).indexOf(this.getChemObj())>=0){var i=this.getRenderCache(e);return this.doClear(e),this.draw(e,i.baseCoord,i.options)}return this._concreteRenderer.doUpdate(e,t,r)},doClearSelf:function(e){var t=this._concreteRenderer;if(t)return t.clear(e)},estimateRenderBox:function(e,t,r){return this._concreteRenderer.estimateRenderBox(e,this._getConcreteRendererDrawOptions(t),r)},getChildObjs:function(){var e=this.getChemObj();if(e&&e.getAttachedMarkers){for(var t=[],r=(e.getExposedNodes()||[]).concat(e.getExposedConnectors()||[]),i=0,n=r.length;i<n;++i){var o=r[i];t=t.concat(o.getAttachedMarkers()||[])}return t.concat(this.tryApplySuper("getChildObjs"))}return this.tryApplySuper("getChildObjs")},_needWholelyDraw:function(e,t){var r=this.tryApplySuper("_needWholelyDraw",[e,t]);if(!r){for(var i=this.getChemObj(),n=!1,o=0,a=e.length;o<a;++o){if(e[o].isChildOf(i)){n=!0;break}}r=n}return r},transformCoordToObj:function(e,t,r){var i=this.getChemObj()===t?this._concreteChemObj:t;return this._concreteRenderer.transformCoordToObj(e,i,r)},transformCoordToContext:function(e,t,r){var i=this.getChemObj()===t?this._concreteChemObj:t;return this._concreteRenderer.transformCoordToContext(e,i,r)}}),Kekule.Render.Mol3DRenderer=Kekule.Render.StructFragment3DRenderer,Kekule.Render.CompositeObj3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.CompositeObj3DRenderer"}),Kekule.Render.CompositeMolecule3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule3DRenderer",getChildObjs:function(){for(var e=[],t=this.getChemObj().getSubMolecules(),r=0,i=t.getItemCount();r<i;++r){var n=t.getObjAt(r);e.push(n)}return e.concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.ChemObjGroupList3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemObjGroupList3DRenderer",getChildObjs:function(){var e=this.getChemObj();if(e instanceof Kekule.ChemObjList)for(var t=[],r=0,i=e.getItemCount();r<i;++r)t.push(e.getItemAt(r));else e instanceof Kekule.ChemStructureObjectGroup&&(t=e.getAllObjs());return(t||[]).concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.ChemSpaceElement3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpaceElement3DRenderer",getChildObjs:function(){return(this.getChemObj().getChildren().toArray()||[]).concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.ChemSpace3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpace3DRenderer",getChildObjs:function(){return[this.getChemObj().getRoot()].concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.Renderer3DFactory.register(Kekule.StructureFragment,Kekule.Render.StructFragment3DRenderer),Kekule.Render.Renderer3DFactory.register(Kekule.CompositeMolecule,Kekule.Render.CompositeMolecule3DRenderer),Kekule.Render.Renderer3DFactory.register(Kekule.ChemObjList,Kekule.Render.ChemObjGroupList3DRenderer),Kekule.Render.Renderer3DFactory.register(Kekule.ChemStructureObjectGroup,Kekule.Render.ChemObjGroupList3DRenderer),Kekule.Render.Renderer3DFactory.register(Kekule.ChemSpaceElement,Kekule.Render.ChemSpaceElement3DRenderer),Kekule.Render.Renderer3DFactory.register(Kekule.ChemSpace,Kekule.Render.ChemSpace3DRenderer)}(),function(){"use strict";var e;Kekule.Render.ThreeObjectCache=Class.create({CLASS_NAME:"Kekule.Render.ThreeObjectCache",initialize:function(){this.cache=new Kekule.MapEx(!0)},finalize:function(){this.cache.finalize(),this.cache=null},createInstance:function(e,t){return null},isSameParams:function(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;++r)if(!this.isParamEqual(e[r],t[r]))return!1;return!0},isParamEqual:function(e,t){var r=e===t;return r||DataType.isObjectValue(e)&&DataType.isObjectValue(t)&&(r=Kekule.ObjUtils.equal(e,t)),r},add:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=this.cache.get(t);r||(r=[],this.cache.set(t,r));var i={params:e};return i.instance=this.createInstance(t,e),r.push(i),i.instance},get:function(){var e=Array.prototype.slice.call(arguments),t=e[0],r=this.cache.get(t);if(r){e.shift();for(var i=0,n=r.length;i<n;++i){var o=r[i].params;if(this.isSameParams(o,e))return r[i].instance}e.unshift(t)}return this.add.apply(this,e)}}),Kekule.Render.ThreeGeometryCache=Class.create(Kekule.Render.ThreeObjectCache,{CLASS_NAME:"Kekule.Render.ThreeGeometryCache",createInstance:function(t,r){var i=null,n=r;n[0];switch(t){case e.SphereGeometry:i=new e.SphereGeometry(n[1],n[2],n[3]);break;case e.CylinderGeometry:i=new e.CylinderGeometry(n[1],n[2],n[3],n[4],n[5],n[6])}return i}}),Kekule.ClassUtils.makeSingleton(Kekule.Render.ThreeGeometryCache),Kekule.Render.ThreeMaterialCache=Class.create(Kekule.Render.ThreeObjectCache,{CLASS_NAME:"Kekule.Render.ThreeMaterialCache",createInstance:function(e,t){return new e(t[1])}}),Kekule.ClassUtils.makeSingleton(Kekule.Render.ThreeMaterialCache),Kekule.Render.ThreeContext=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.ThreeContext",initialize:function(e,t,r,i){this.tryApplySuper("initialize"),this.setScene(e),this.setCamera(t),this.setLights(r),this.setRenderer(i)},initProperties:function(){this.defineProp("scene",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("camera",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("lights",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("renderer",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("width",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("height",{dataType:DataType.INT,serializable:!1,setter:null})},getDimension:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimension:function(t,r){this.setPropStoreFieldValue("width",t),this.setPropStoreFieldValue("height",r),this.getRenderer().setSize(t,r);var i=this.getCamera();i instanceof e.OrthographicCamera?(i.left=t/-2,i.right=t/2,i.top=r/2,i.bottom=r/-2):i.aspect=t/r,i.updateProjectionMatrix()}}),Kekule.Render.ThreeRendererBridge=Class.create(Kekule.Render.Abstract3DDrawBridge,{CLASS_NAME:"Kekule.Render.ThreeRendererBridge",_qualitySettings:[null,{sphereSegments:6,sphereRings:6,cylinderSegmentsRadius:6},{sphereSegments:8,sphereRings:8,cylinderSegmentsRadius:8},{sphereSegments:16,sphereRings:16,cylinderSegmentsRadius:16},{sphereSegments:32,sphereRings:32,cylinderSegmentsRadius:32},{sphereSegments:64,sphereRings:64,cylinderSegmentsRadius:64}],initialize:function(){this.geometryCache=Kekule.Render.ThreeGeometryCache.getInstance(),this.materialCache=Kekule.Render.ThreeMaterialCache.getInstance(),this._quality=null,this._modelParams={},this._webglEnabled=!0},finalize:function(){this.geometryCache=null,this.materialCache=null},getGraphicQualityLevel:function(){return this._quality},setGraphicQualityLevel:function(e){this._webglEnabled?this._quality=e:this._quality=Kekule.Render.Render3DGraphicQuality.EXTREME_LOW,this._modelParams=this.calcModelParams(this._quality)},_updateGraphicQualityLevel:function(){this._webglEnabled||this.setGraphicQualityLevel(Kekule.Render.Render3DGraphicQuality.EXTREME_LOW)},calcModelParams:function(e){var t=this._qualitySettings[e];return t||(t=this._qualitySettings[Kekule.Render.Render3DGraphicQuality.MEDIUM]),t},getInitialLightPositions:function(e){return[{x:5,y:5,z:10}]},createContext:function(t,r,i,n){var o=Kekule.BrowserFeature,a={preserveDrawingBuffer:!0,alpha:!0,antialias:!0};n&&(a=Object.extend(a,n));var s=o.webgl?new e.WebGLRenderer(a):o.canvas?new e.CanvasRenderer(a):new e.SVGRenderer(a),l=new e.PerspectiveCamera;l.fov=5,this._webglEnabled=s instanceof e.WebGLRenderer,this._updateGraphicQualityLevel();var u=new e.Scene;u.add(l),s.setSize(r,i);const d=!0===s.useLegacyLights||void 0===s.useLegacyLights&&parseInt(e.REVISION)<155?1:Math.PI;for(var c=this.getInitialLightPositions(),h=[],p=0,g=c.length;p<g;++p){var f=new e.DirectionalLight(13421772,1*d,10,!0),C=c[p];f.castShadow=!0,f.position.set(C.x,C.y,C.z),u.add(f),h.push(f)}f=new e.AmbientLight(2105376,1*d);u.add(f),t.appendChild(s.domElement);var m=new Kekule.Render.ThreeContext(u,l,h,s);return m.setDimension(r,i),m},releaseContext:function(e){var t=this.getContextElem(e);e.finalize(),t&&t.parentNode.removeChild(t)},getContextElem:function(e){return e?e.getRenderer().domElement:null},getContextDimension:function(e){return{width:e.getWidth(),height:e.getHeight()}},setContextDimension:function(e,t,r){e.setDimension(t,r)},transformContextCoordToScreen:function(e,t){var r=e.getDimension();return{x:t.x+r.width/2,y:t.y+r.height/2}},transformScreenCoordToContext:function(e,t){var r=e.getDimension();return{x:t.x-r.width/2,y:t.y-r.height/2,z:0}},canModifyGraphic:function(e){return!0},colorStrToHex:function(e){return Kekule.StyleUtils.colorStrToValue(e)},createGroup:function(t){var r=new e.Object3D;return r.__objGroup__=!0,t.getScene().add(r),r},addToGroup:function(e,t){return t.add(e),t},removeFromGroup:function(e,t){t.remove(e)},setClearColor:function(t,r){var i=t.getRenderer();i&&(i.setClearColor?r?t.getRenderer().setClearColor(new e.Color(r),1):t.getRenderer().setClearColor(new e.Color,0):i.setClearColorHex&&(r?t.getRenderer().setClearColorHex(this.colorStrToHex(r),1):t.getRenderer().setClearColorHex(null,0)))},clearContext:function(e){e.getScene().clearMesh(),this.renderContext(e)},renderContext:function(e){e.getRenderer().render(e.getScene(),e.getCamera())},drawSphere:function(t,r,i,n){var o=this._modelParams.sphereSegments,a=this._modelParams.sphereRings,s=this.geometryCache.get(e.SphereGeometry,t.getScene(),1,o,a),l=this.materialCache.get(e.MeshLambertMaterial,t.getScene(),{color:this.colorStrToHex(n.color),opacity:n.opacity||1}),u=new e.Mesh(s,l);return u.scale.x=i,u.scale.y=i,u.scale.z=i,u.position.x=r.x,u.position.y=r.y,u.position.z=r.z,t.getScene().add(u),u},drawLine:function(t,r,i,n){this.colorStrToHex(n.color);var o,a=this.materialCache.get(e.LineBasicMaterial,t.getScene(),{color:this.colorStrToHex(n.color),opacity:n.opacity||1,linewidth:n.lineWidth||1});if(e.Geometry)(o=new e.Geometry).vertices.push(new e.Vector3(r.x,r.y,r.z)),o.vertices.push(new e.Vector3(i.x,i.y,i.z));else{o=new e.BufferGeometry;var s=[new e.Vector3(r.x,r.y,r.z),new e.Vector3(i.x,i.y,i.z)];o.setFromPoints(s)}var l=new e.Line(o,a);return t.getScene().add(l),l},drawCylinder:function(t,r,i,n,o){var a=Kekule.CoordUtils,s=this._modelParams.cylinderSegmentsRadius,l=a.getDistance(r,i),u=this.geometryCache.get(e.CylinderGeometry,t.getScene(),1,1,1,s,1,!0),d=this.materialCache.get(e.MeshLambertMaterial,t.getScene(),{color:this.colorStrToHex(o.color),opacity:o.opacity||1}),c=new e.Mesh(u,d);c.scale.y=l,c.scale.x=n,c.scale.z=n;var h=Kekule.ObjUtils.isUnset(o.quaternion)?this._calcQuaternion(r,i):o.quaternion;return h&&(c.applyQuaternion?c.applyQuaternion(h):(c.useQuaternion=!0,c.quaternion=h,c.updateMatrix())),c.position.x=(r.x+i.x)/2,c.position.y=(r.y+i.y)/2,c.position.z=(r.z+i.z)/2,t.getScene().add(c),c},drawParallelCylinders:function(e,t,r){Kekule.CoordUtils;for(var i=t[0],n=this._calcQuaternion(i.coord1,i.coord2),o=this.createGroup(e),a=0,s=t.length;a<s;++a){var l=t[a],u=this.drawCylinder(e,l.coord1,l.coord2,l.radius,{color:l.color,quaternion:n,opacity:l.opacity});this.addToGroup(u,o)}if(r){var d;for(a=0,s=t.length;a<s;++a){l=t[a];for(var c=0,h=(d=Kekule.ObjUtils.isUnset(l.jointCoordIndex)?[l.coord1,l.coord2]:1===l.jointCoordIndex?[l.coord2]:[l.coord1]).length;c<h;++c){u=this.drawSphere(e,d[c],l.radius,{color:l.color,opacity:l.opacity});this.addToGroup(u,o)}}}return o},removeDrawnElem:function(e,t){t.parent&&t.parent.remove&&t.parent.remove(t)},_calcQuaternion:function(t,r){var i=Kekule.CoordUtils,n=i.substract(r,t);if(n.x||n.z){var o={x:n.z,y:0,z:-n.x};o=i.standardize(o);var a=Math.atan2(Math.sqrt(Math.sqr(n.x)+Math.sqr(n.z)),n.y)/2,s=Math.cos(a),l=Math.sin(a);return new e.Quaternion(l*o.x,l*o.y,l*o.z,s)}return null},getLightCount:function(e){var t=e.getLights();return t&&t.length||0},getLightProps:function(e,t){return{position:e.getLights()[t].position}},setLightProps:function(e,t,r){var i=e.getLights()[t],n=r.position;n&&(i.position.x=n.x,i.position.y=n.y,i.position.z=n.z),i.updateMatrix()},getCameraProps:function(e){var t=e.getCamera(),r=t.fov*Math.PI/180,i=r*(t.aspect||1),n=Math.min(r,i);return{position:t.position,fov:r,aspect:t.aspect,fovVertical:r,fovHorizontal:i,fovMin:n,left:t.left,right:t.right,top:t.top,bottom:t.bottom,lookAtVector:t.lookAtVector,upVector:t.up}},setCameraProps:function(t,r){var i=t.getCamera(),n=Kekule.ObjUtils.notUnset,o=r.position;if(o&&(i.position.x=o.x,i.position.y=o.y,i.position.z=o.z),n(r.near)&&(i.near=r.near),n(r.far)&&(i.far=r.far),r.fov&&(i.fov=180*r.fov/Math.PI),r.aspect&&(i.aspect=r.aspect),n(r.left)&&(i.left=r.left),n(r.top)&&(i.top=r.top),n(r.bottom)&&(i.bottom=r.bottom),n(r.right)&&(i.right=r.right),n(r.upVector)){var a=r.upVector;i.up=new e.Vector3(a.x,a.y,a.z)}if(n(r.lookAtVector)){a=r.lookAtVector;i.lookAt(new e.Vector3(a.x,a.y,a.z))}i.updateMatrix()},exportToDataUri:function(t,r,i){var n=t.getRenderer();if(e.SVGRenderer&&n instanceof e.SVGRenderer){var o=t.getRenderer().domElement,a=DataType.XmlUtility.serializeNode(o);return"data:image/svg+xml;base64,"+btoa(a)}return(o=t.getRenderer().domElement)?o.toDataURL(r,i):null}}),Kekule.Render.ThreeRendererBridge.isSupported=function(){var e=void 0!==Kekule.Render.getExternalModule("three.js");if(e){var t=Kekule.BrowserFeature;e=t.webgl||t.canvas||t.svg}return!!e},Kekule.Render.ThreeRendererBridge.getAvailabilityInformation=function(){var e=!1,t=void 0!==Kekule.Render.getExternalModule("three.js"),r=Kekule.BrowserFeature,i=r.webgl,n=r.canvas||r.svg,o=null;return t?i||n?e=!0:o=Kekule.$L("ErrorMsg.THREEJS_DRAWING_NOT_UNAVAILABLE"):o=Kekule.$L("ErrorMsg.THREEJS_LIB_NOT_UNAVAILABLE"),{available:e,message:o}},Kekule.Render.DrawBridge3DMananger.register(Kekule.Render.ThreeRendererBridge,20);var t=function(){var e;t.registered||Kekule.$jsRoot.THREE&&Kekule.$jsRoot.THREE.Object3D&&(e=Kekule.$jsRoot.THREE,Kekule.Render.registerExternalModule("three.js",e),t.registered=!0)};Kekule.externalResourceManager.on("three.jsRegistered",function(){(e=Kekule.externalResourceManager.getResource("three.js"))&&(e.Object3D.prototype.clear||(e.Object3D.prototype.clear=function(){for(var e=this.children,t=e.length-1;t>=0;t--){var r=e[t];r.clear(),this.remove(r)}}),e.Scene.prototype.clearMesh||(e.Scene.prototype.clearMesh=function(){for(var t=this.children,r=t.length-1;r>=0;r--){var i=t[r];(i instanceof e.Mesh||i instanceof e.Line||i.__objGroup__)&&(i.clear(),this.remove(i))}}),Kekule.Render.DrawBridge3DMananger.register(Kekule.Render.ThreeRendererBridge,20))}),Kekule.externalResourceManager.on("three.jsUnregistered",function(){}),t(),Kekule.X.domReady(t)}(),Kekule.Render.ChemObjPainter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.ChemObjPainter",initialize:function(e,t,r,i){this.tryApplySuper("initialize");var n=e||Kekule.Render.RendererType.R2D;this.setPropStoreFieldValue("renderType",n),this.setPropStoreFieldValue("chemObj",t),this.setPropStoreFieldValue("drawBridge",r||(n===Kekule.Render.RendererType.R3D?Kekule.Render.DrawBridge3DMananger.getPreferredBridgeInstance():Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance())),i&&this.setPropStoreFieldValue("renderConfigs",i)},finalize:function(){this.getRenderer()&&this.getRenderer().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:null}),this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("renderConfigs");return e||(e=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()),e}}),this.defineProp("renderer",{dateType:"Kekule.Render.AbstractRenderer",serializable:!1,setter:null}),this.defineProp("canModifyTargetObj",{dataType:DataType.BOOL}),this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:!1,setter:null,getter:function(){var e=this.getRenderer();return e&&e.getBoundInfoRecorder()}})},getDrawOptionFromConfigs:function(e){return Kekule.Render.RenderOptionUtils.convertConfigsToPlainHash(e)},prepareRenderer:function(){if(this.getRenderer())return this.getRenderer();var e=(this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.Render.get3DRendererClass:Kekule.Render.get2DRendererClass)(this.getChemObj());if(e){var t=new e(this.getChemObj(),this.getDrawBridge(),this);return this.setPropStoreFieldValue("renderer",t),t}return Kekule.error(Kekule.$L("ErrorMsg.CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ")),null},createContext:function(e,t,r){return this.getDrawBridge().createContext(e,t,r)},_convertContextBoxToScreen:function(e,t){if(!t)return{};var r=this.getDrawBridge(),i=r.transformContextCoordToScreen(e,{x:t.x1,y:t.y1}),n=r.transformContextCoordToScreen(e,{x:t.x2,y:t.y2});return Kekule.BoxUtils.createBox(i,n)},estimateObjBox:function(e,t,r){return this._generateDrawOptions(t),this.prepareRenderer(),this.getRenderer().estimateObjBox(e,t,r)},estimateRenderBox:function(e,t,r,i){var n=this._generateDrawOptions(r);return this.prepareRenderer(),this.getRenderer().estimateRenderBox(e,t,n,i)},estimateScreenBox:function(e,t,r,i){var n=this.estimateRenderBox(e,t,r,i);return n?this._convertContextBoxToScreen(e,n):null},_generateDrawOptions:function(e){var t=this.getRenderConfigs(),r=t?this.getDrawOptionFromConfigs(t):{};return r=Object.extend(r,e)},draw:function(e,t,r){if(!this.getChemObj())return null;this.prepareRenderer();var i=this._generateDrawOptions(r);return this.getRenderer().draw(e,t,i)},redraw:function(e){return this.getRenderer().redraw(e)},getActualRenderTransformParams:function(e){var t=this.getRenderer();return t?t.getRenderFinalTransformParams(e):null},getActualInitialRenderTransformOptions:function(e){var t=this.getRenderer();return t?t.getRenderInitialTransformOptions(e):null},changeGeometryOptions:function(e,t,r){var i=this.getRenderer();if(i&&i.changeGeometryOptions){var n=this._generateDrawOptions(r);return i.changeGeometryOptions(e,t,n)}return this.clearContext(e),this.draw(e,t,r)},supportGeometryOptionChange:function(){var e=this.getRenderer();return e&&e.changeGeometryOptions},beginUpdatePainter:function(){return this.getRenderer().beginUpdateRenderer()},endUpdatePainter:function(){return this.getRenderer().endUpdateRenderer()},update:function(e,t,r){return this.getRenderer().update(e,t,r)},addNew:function(e,t){return this.getRenderer().addNew(e,t)},modify:function(e,t){return this.getRenderer().modify(e,t)},remove:function(e,t){return this.getRenderer().remove(e,t)},clear:function(e){var t=this.getRenderer();return t&&t.clear(e),this},clearContext:function(e){return this.getDrawBridge().clearContext(e)}}),Kekule.Render.ChemObjPainter2D=Class.create(Kekule.Render.ChemObjPainter,{CLASS_NAME:"Kekule.Render.ChemObjPainter2D",initialize:function(e,t,r){this.tryApplySuper("initialize",[Kekule.Render.RendererType.R2D,e,t,r])}}),Kekule.Render.ChemObjPainter3D=Class.create(Kekule.Render.ChemObjPainter,{CLASS_NAME:"Kekule.Render.ChemObjPainter3D",initialize:function(e,t,r){this.tryApplySuper("initialize",[Kekule.Render.RendererType.R3D,e,t,r])}}),function(){"use strict";var e=Class.PropertyScope,t=Kekule.ArrayUtils,r=Kekule.Unit;Kekule.globalOptions.add("spectrum",{spectrumInfo:{enablePrefixOmissionInGetter:!0},data:{allowedComparisonErrorRate:5e-8}}),Kekule.ComparisonMethod.SPECTRUM_DATA=30,Kekule.Spectroscopy={},Kekule.Spectroscopy.DataMode={CONTINUOUS:1,PEAK:2},Kekule.Spectroscopy.DataPeakPosition={MAX:0,MIN:1},Kekule.Spectroscopy.Utils={getSpectrumPeakPosition:function(e){return(e.getSpectrumType?e.getSpectrumType():e.getParentSpectrum()&&e.getParentSpectrum().getSpectrumType())===Kekule.Spectroscopy.SpectrumType.IR?Kekule.Spectroscopy.DataPeakPosition.MIN:Kekule.Spectroscopy.DataPeakPosition.MAX},expandDataRange:function(e,r){for(var i=t.toArray(r),n=e||{},o=0,a=i.length;o<a;++o)for(var s=i[o],l=Kekule.ObjUtils.getOwnedFieldNames(s),u=0,d=l.length;u<d;++u){var c=l[u],h=s[c];n[c]?h<n[c].min?n[c].min=h:h>n[c].max&&(n[c].max=h):n[c]={min:h,max:h}}return n},mergeDataRange:function(e,r){var i={},n=t.clone(Kekule.ObjUtils.getOwnedFieldNames(e));t.pushUnique(n,Kekule.ObjUtils.getOwnedFieldNames(r));for(var o=0,a=n.length;o<a;++o){var s=n[o];e[s]?r[s]?i[s]={min:e[s].min<r[s].min?e[s].min:r[s].min,max:e[s].max>r[s].max?e[s].max:r[s].max}:i[s]=Object.extend(e[s]):i[s]=Object.extend(r[s])}return i},calcScalePointInfo:function(e,t,r){r<=0&&(r=10);var i,n=[Math.log10(Math.abs(e)),Math.log10(Math.abs(t))],o=Math.floor(Math.max(n[0],n[1])),a=Math.sign(e)===Math.sign(t)?Math.floor(Math.min(n[0],n[1],0)):-1/0,s=o>6,l=t-e,u=l/r,d=Math.max(Math.floor(Math.log10(Math.abs(u))),a),c=Math.pow(10,d);i=i<10&&l>.5?2*Math.ceil(i/c/2)*c:Math.ceil(u/c)*c;for(var h=Math.ceil(e/i)*i,p=Math.floor(t/i)*i,g={useSciForm:s,scaleFrom:h,scaleTo:p,scaleSectionCount:Math.round((p-h)/i),scaleValues:[],scaleBase:c,scaleFromOnBase:h/c,scaleToOnBase:p/c,fixDigitsCountAfterPoint:Math.max(-d,0)},f=0,C=g.scaleSectionCount+1;f<C;++f)g.scaleValues.push(Math.round(f*i/c)*c+h);return g},generateInfoKey:function(e,t,r){var n=t||r;return n?n+i.DELIMITER+e:e},getDefaultDataExtraInfoClass:function(e){return e.getMode()===Kekule.Spectroscopy.DataMode.PEAK?Kekule.Spectroscopy.SpectrumPeakDetails:Kekule.Spectroscopy.SpectrumDataDetails},createDefaultDataExtraInfoObject:function(e){var t=Kekule.Spectroscopy.Utils.getDefaultDataExtraInfoClass(e);return t&&new t}},Kekule.Spectroscopy.MetaPropNamespace={CUSTOM:"custom",DELIMITER:".",_namespaces:[],register:function(e){t.pushUnique(i._namespaces,e)},unregister:function(e){i._namespaces=t.exclude(i._namespaces,e)},getNamespaces:function(){return t.clone(i._namespaces)},createPropertyName:function(e,t){return(e||"")+i.DELIMITER+t},getPropertyNameDetail:function(e){var t,r,n=e.lastIndexOf(i.DELIMITER);return n>=0?(t=e.substring(0,n),r=e.substr(n+1)):r=e,{namespace:t,coreName:r}},getPropertyCoreName:function(e){return i.getPropertyNameDetail(e).coreName}};var i=Kekule.Spectroscopy.MetaPropNamespace;i.register(i.CUSTOM),Kekule.Spectroscopy.DataValueConverterManager={_converters:[],register:function(e){o._converters.push(e)},unregister:function(e){var t=DMC._converters.indexOf(e);t>=0&&DMC._converters.splice(t,1)},doConvert:function(e,t,r,i,n,a){if(r===i)return e;if(!Kekule.NumUtils.isNormalNumber(e))return e;var s=o._converters;if(s.length){var l=Kekule.Unit.getUnit(r),u=Kekule.Unit.getUnit(i);if(l&&u)for(var d=s.length-1;d>=0;--d){var c=s[d];if(c.canConvert(e,t,l,u,n,a))return c.convert(e,t,l,u,n,a)}}return Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_CONVERT_BETWEEN_UNITS").format(l.getKey(),u.getKey())),null},getAltUnits:function(e,r,i,n){var a=[],s=o._converters;if(s.length){var l=Kekule.Unit.getUnit(r);if(l)for(var u=s.length-1;u>=0;--u){var d=s[u].getAltUnits(e,l,i,n)||[];t.pushUnique(a,d)}}return a}};var n,o=Kekule.Spectroscopy.DataValueConverterManager;o.register({convert:function(e,t,r,i,n,o){return r.convertValueTo(e,i)},canConvert:function(e,t,r,i,n,o){return r.canConvertValueTo(i)},getAltUnits:function(e,t,r,i){return t.category.getConvertableUnits()}}),o.register({convert:function(e,t,i,n,o,a){var s=a.getParameter("NMR.ObserveFrequency");if(i.category===r.Frequency){var l=(u=i.convertValueTo(e,s.getUnit()))/s.getValue();return r.Dimensionless.ONE.convertValueTo(l,n)}if(i.category===Kekule.Unit.Dimensionless){var u=i.convertValueToStandard(e)*s.getValue();return r.getUnit(s.getUnit()).convertValueTo(u,n)}},canConvert:function(e,t,r,i,n,o){if(o.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.NMR){var a=o.getParameter("NMR.ObserveFrequency"),s=a&&a.getValue();if(a&&s&&Kekule.NumUtils.isNormalNumber(s)&&Kekule.Unit.getUnit(a.getUnit()).category===Kekule.Unit.Frequency)return r.category===Kekule.Unit.Frequency&&i.category===Kekule.Unit.Dimensionless||r.category===Kekule.Unit.Dimensionless&&i.category===Kekule.Unit.Frequency}return!1},getAltUnits:function(e,t,r,i){var n=[];if(i.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.NMR){var o=i.getParameter("NMR.ObserveFrequency"),a=o&&o.getValue();o&&a&&Kekule.NumUtils.isNormalNumber(a)&&Kekule.Unit.getUnit(o.getUnit()).category===Kekule.Unit.Frequency&&(t.category===Kekule.Unit.Frequency?n.push(Kekule.Unit.Dimensionless.PARTS_PER_MILLION):t.category===Kekule.Unit.Dimensionless&&(n=n.concat(Kekule.Unit.Frequency.getConvertableUnits())))}return n}}),o.register({convert:function(e,t,i,n,o,a){if(i.category===r.Length){var s=1/i.convertValueToStandardEx(e).value;return n.convertValueFromStandard(s)}if(i.category===r.WaveNumber){var l=1/i.convertValueToStandardEx(e).value;return n.convertValueFromStandard(l)}},canConvert:function(e,t,r,i,n,o){return o.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.IR&&(r.category===Kekule.Unit.Length&&i.category===Kekule.Unit.WaveNumber||r.category===Kekule.Unit.WaveNumber&&i.category===Kekule.Unit.Length)},getAltUnits:function(e,t,r,i){var n;return i.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.IR&&(t.category===Kekule.Unit.Length?n=[Kekule.Unit.WaveNumber.RECIPROCAL_CENTIMETER]:t.category===Kekule.Unit.WaveNumber&&(n=[Kekule.Unit.Length.getConvertableUnits()])),n}}),Kekule.Spectroscopy.SpectrumVarDefinition=Class.create(Kekule.VarDefinition,{CLASS_NAME:"Kekule.Spectroscopy.SpectrumVarDefinition",initProperties:function(){this.defineProp("internalUnit",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getUnit()},setter:function(e){this.setUnit(e)}}),this.defineProp("externalUnit",{dataType:DataType.STRING})},getActualExternalUnit:function(){return this.getExternalUnit()||this.getInternalUnit()},hasDifferentExternalUnit:function(){var e=this.getExternalUnit();return!(!e||e===this.getInternalUnit())}}),Kekule.Spectroscopy.SpectrumDataSection=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Spectroscopy.SpectrumDataSection",DATAITEM_SRC_FIELD_NAME:"_src",DATAITEM_EXTRA_FIELD_NAME:"_extra",initialize:function(e,t,r){this.updateDataModifiedTime(),this.setPropStoreFieldValue("name",e),this.setPropStoreFieldValue("localVarInfos",[]),this.setPropStoreFieldValue("dataItems",[]),this.setPropStoreFieldValue("parent",t),this.tryApplySuper("initialize",[]),r&&this.setLocalVariables(r),this.setDataSorted(!0),this._cache={}},doFinalize:function(){this.getParent()&&this.getParent().removeChild&&this.getParent().removeChild(this),this.clear();for(var e=this.getVariables(),t=0,r=e.length;t<r;++t)e[t].finalize();this.setPropStoreFieldValue("localVarInfos",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.MapEx",setter:null,serializable:!1}),this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("title",{dataType:DataType.STRING}),this.defineProp("localVarInfos",{dataType:DataType.ARRAY,setter:null}),this.defineProp("localVarSymbols",{dataType:DataType.ARRAY,scope:e.PRIVATE,serializable:!1,getter:function(){var e=[],t=this.getActualLocalVarInfos();if(t&&t.length)for(var r=0,i=t.length;r<i;++r){var n=t[r];e.push(n.symbol)}return e},setter:function(e){var t=e||[];this._updateLocalVarInfosFromSymbols(t)}}),this.defineProp("mode",{dataType:DataType.INT,enumSource:Kekule.Spectroscopy.DataMode,setter:function(e){this.getMode()!==e&&(this.setPropStoreFieldValue("mode",e),this.notifyDataChange())}}),this.defineProp("defPeakRoot",{dataType:DataType.Hash}),this.defineProp("modifiedTime",{dataType:DataType.DATE,setter:null}),this.defineProp("dataItems",{dataType:DataType.ARRAY,setter:null,scope:e.PRIVATE})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMode(Kekule.Spectroscopy.DataMode.CONTINUOUS)},getAutoIdPrefix:function(){return"sec"},ownerChanged:function(e,t){for(var r=0,i=this.getDataCount();r<i;++r){var n=this.getExtraInfoAt(r);n&&n.setOwner&&n.setOwner(e)}this.tryApplySuper("ownerChanged",[e,t])},doSaveProp:function(e,t,r,i,n,o,a,s){if(t.serializable){if("dataItems"===t.name){var l=n.createChildStorageNode(r,n.propNameToStorageName("dataItems"),!1),u=n.createChildStorageNode(l,n.propNameToStorageName("values"),!0);n.saveObj(e.getDataItems(),u,i,o,a,s);var d=e._extractAllExtraInfoOfDataItems();if(d.length){u=n.createChildStorageNode(l,n.propNameToStorageName("extras"),!0);n.saveObj(d,u,i,o,a,s)}return!0}return!1}},doLoadProp:function(e,t,r,i,n,o,a){if(t.serializable){if("dataItems"===t.name){var s=[],l=i.getChildStorageNode(r,i.propNameToStorageName("dataItems")),u=i.getChildStorageNode(l,i.propNameToStorageName("values"));if(i.loadObj(s,u,n,o,a),e.setPropStoreFieldValue("dataItems",s),u=i.getChildStorageNode(l,i.propNameToStorageName("extras"))){var d=[];i.loadObj(d,u,n,o,a),e._writeExtraInfoOfDataItems(d)}return!0}return!1}},_setSysFieldOfDataItem:function(e,t,r){try{Object.defineProperty?Object.defineProperty(e,t,{value:r,configurable:!0,writable:!0,enumerable:!1}):e[t]=r}catch(i){e[t]=r}},_extractAllExtraInfoOfDataItems:function(){for(var e=[],t=0,r=this.getDataCount();t<r;++t){var i=this.getExtraInfoAt(t);i&&e.push({index:t,info:i})}return e},_writeExtraInfoOfDataItems:function(e){for(var t=0,r=e.length;t<r;++t){var i=e[t];this.setExtraInfoAt(i.index,i.info)}},isEmpty:function(){return this.getDataCount()<=0},isPeakSection:function(){return this.getMode()===Kekule.Spectroscopy.DataMode.PEAK},hasPeakAssignments:function(){if(this.isPeakSection()){for(var e=!1,t=0,r=this.getDataCount();t<r;++t){var i=this.getExtraInfoAt(t);if(i&&i&&i.hasAssignments&&i.hasAssignments()){e=!0;break}}return e}return!1},getParentSpectrum:function(){for(var e=this.getParent();e&&!(e instanceof Kekule.Spectroscopy.Spectrum)&&e.getParent;)e=e.getParent();return e},getParentVariables:function(){var e=this.getParentSpectrum();return e&&e.getVariables()||[]},getActualLocalVarInfos:function(){var e=t.clone(this.getLocalVarInfos());if(!e||!e.length)for(var r=this.getParentVariables(),i=0,n=r.length;i<n;++i)e.push({symbol:r[i].symbol});return e},_updateLocalVarInfosFromSymbols:function(e,t){for(var r=e||[],i=[],n=this.getParentSpectrum(),o=0,a=r.length;o<a;++o){var s=r[o];this._pushLocalVariable(n,s,i)}this.setPropStoreFieldValue("localVarInfos",i),this.notifyPropSet("localVarInfos",i,t)},_pushLocalVariable:function(e,t,r){(r||(r=this.getLocalVarInfos()),e&&e.getVariable)&&(e.getVariable(t)&&r.push({symbol:t}))},setLocalVariables:function(e){for(var t,r=[],i=[],n=0,o=e.length;n<o;++n)"string"==typeof(t=e[n])?i.push(t):r.push(t);r.length?(this.setPropStoreFieldValue("localVarInfos",r),this.notifyPropSet("localVarInfos",r)):i.length&&this._updateLocalVarInfosFromSymbols(i)},getLocalVarInfoIndex:function(e){var t=-1,r=this.getActualLocalVarInfos();if("number"==typeof e)t=e;else for(var i=e.getSymbol?e.getSymbol():e,n=0,o=r.length;n<o;++n)if(i===r[n].symbol){t=n;break}return t},getLocalVarInfo:function(e){var t=this.getLocalVarInfoIndex(e);return t>=0?this.getActualLocalVarInfos()[t]:null},getLocalVarInfoValue:function(e,t){var r=this.getLocalVarInfo(e);return r&&r[t]},setLocalVarInfoValue:function(e,t,r){this.getLocalVarInfo(e)[t]=r},getLocalVarDef:function(e){var t=this.getLocalVarInfoValue(e,"symbol"),r=this.getParentSpectrum();return r&&r.getVariable(t)},getLocalVarInfoOfDependency:function(e){for(var t=[],r=this.getActualLocalVarInfos(),i=0,n=r.length;i<n;++i){var o=this.getLocalVarDef(i);if(o.getDependency()===e){var a=Object.extend({},r[i]);a.varDef=o,t.push(a)}}return t},getLocalVarSymbolsOfDependency:function(e){for(var t=this.getLocalVarInfoOfDependency(e),r=[],i=0,n=t.length;i<n;++i)r.push(t[i].varDef.getSymbol());return r},getContinuousVarRange:function(e){var t=this.getParent(),r=this.getLocalVarInfo(e);return r.continuousRange||t&&t.getContinuousVarRange&&t.getContinuousVarRange(r.symbol)},setContinuousVarRange:function(e,t,r){return this.setLocalVarInfoValue(e,"continuousRange",{fromValue:t,toValue:r}),this},clearContinuousVarRange:function(e){return this.setLocalVarInfoValue(e,"continuousRange",null),this},setDefaultVarValue:function(e,t){return this.setLocalVarInfoValue(e,"defaultValue",t),this},clearDefaultVarValue:function(e){return this.setDefaultVarValue(e,null)},getDefaultVarValue:function(e){var t=this.getLocalVarInfoValue(e,"defaultValue");if(Kekule.ObjUtils.isUnset(t)){var r=this.getLocalVarInfo(e),i=this.getParent();t=i&&i.getDefaultVarValue(r.symbol)}return t},getVarDisplayRange:function(e,t){var r=t||{},i=this.getLocalVarInfoIndex(e),n=this.getLocalVarInfo(i),o=n.displayRange?Object.extend({},n.displayRange):null;if(!o){var a=this.getLocalVarDef(i).getInfoValue("displayRange");a&&(o=Object.extend({},a))}return!o&&r.autoCalc&&(o=this.calcDataRange(i,{basedOnInternalUnit:!0})[n.symbol]),r.basedOnInternalUnit||(o=this._convertDataRangeToExternalUnit(o,i)),o},setVarDisplayRange:function(e,t,r,i){var n={min:t,max:r};if((i||{}).basedOnExternalUnit){var o=this.getLocalVarInfoIndex(e);n=this._convertDataRangeToInternalUnit(n,o)}return this.setLocalVarInfoValue(e,"displayRange",n),this},clearVarDisplayRange:function(e){return this.setLocalVarInfoValue(e,"displayRange",null),this},getDisplayRangeOfVars:function(e,t){var r={};e||(e=this.getLocalVarSymbols());for(var i=0,n=e.length;i<n;++i){r[this._varToVarSymbol(e[i])]=this.getVarDisplayRange(e[i],t)}return r},_varToVarSymbol:function(e){var t=this.getLocalVarDef(e);return t?t.getSymbol():null},_varToVarSymbols:function(e){var r=[],i=e?t.toArray(e):null;if(i)for(var n=0,o=i.length;n<o;++n)r.push(this._varToVarSymbol(i[n]));else r=this.getLocalVarSymbols();return r},_getDefaultPeakRoot:function(){for(var e={},t=0,r=this.getActualLocalVarInfos().length;t<r;++t){var i=this.getLocalVarDef(t);i.getDependency()!==Kekule.VarDependency.INDEPENDENT&&(e[i.getSymbol()]=0)}return e},calcDataRange:function(e,t){var r=t||{},i=this._varToVarSymbols(e),n=function(e){return!Kekule.NumUtils.isNormalNumber(e)},o={},a=this._cache.ranges;a||(a={},this._cache.ranges=a);for(var s=[],l=0,u=i.length;l<u;++l){a[h=i[l]]?o[h]=Object.extend({},a[h]):s.push(h)}if(s.length){var d=this,c=this.isPeakSection();this.forEach(function(e,t){for(var i=0,a=s.length;i<a;++i){var l=s[i];if(!n(e[l])&&(o[l]||(o[l]={}),o[l].min=n(o[l].min)?e[l]:Math.min(o[l].min,e[l]),o[l].max=n(o[l].max)?e[l]:Math.max(o[l].max,e[l]),c&&!r.ignorePeakRoot)){var u=d.getPeakRootValueOf(e);u&&!n(u[l])&&(o[l].min=n(o[l].min)?u[l]:Math.min(o[l].min,u[l]),o[l].max=n(o[l].max)?u[l]:Math.max(o[l].max,u[l]))}}},null,{basedOnInternalUnit:!0});for(l=0,u=s.length;l<u;++l){a[h=s[l]]=Object.extend({},o[h])}}if(!r.basedOnInternalUnit)for(l=0,u=i.length;l<u;++l){var h=i[l];o[h]=this._convertDataRangeToExternalUnit(o[h],l)}return o},_convertDataRangeToExternalUnit:function(e,t){if(!e)return e;for(var r=["min","max"],i=0,n=r.length;i<n;++i){var o=r[i];e[o]=this._convertVarValueToExternal(e[o],t)}if(e.min>e.max){var a=e.min;e.min=e.max,e.max=a}return e},_convertDataRangeToInternalUnit:function(e,t){if(!e)return e;for(var r=["min","max"],i=0,n=r.length;i<n;++i){var o=r[i];e[o]=this._convertVarValueToInternal(e[o],t)}if(e.min>e.max){var a=e.min;e.min=e.max,e.max=a}return e},calcDataAverage:function(e,t){var r=t||{},i=this._varToVarSymbols(e),n={},o=this._cache.averages,a=function(e){return!Kekule.NumUtils.isNormalNumber(e)};o||(o={},this._cache.averages=o);for(var s=[],l=0,u=i.length;l<u;++l){var d=i[l];a(o[d])?s.push(d):n[d]=o[d]}if(s.length){var c={},h={};for(l=0,u=s.length;l<u;++l)c[s[l]]=0,h[s[l]]=0;this.forEach(function(e,t){for(var r=0,i=s.length;r<i;++r){var n=s[r],o=e[n];a(o)||(c[n]+=o,++h[n])}},null,{basedOnInternalUnit:!0});for(l=0,u=s.length;l<u;++l){n[d=s[l]]=c[d]/h[d],o[d]=n[d]}}if(!r.basedOnInternalUnit)for(l=0,u=i.length;l<u;++l){n[d=i[l]]=this._convertVarValueToExternal(n[l])}return n},getContinuousVarSymbols:function(){for(var e=[],t=this.getActualLocalVarInfos(),r=0,i=t.length;r<i;++r)this.getContinuousVarRange(r)&&e.push(t[r].symbol);return e},_itemHashToArray:function(e){if(!e)return null;for(var r=[],i=this.getLocalVarSymbols(),n=0,o=i.length;n<o;++n)r.push(e[i[n]]);var a,s=this._getDataValueSrc(e);if(s&&this._setSysFieldOfDataItem(r,this.DATAITEM_SRC_FIELD_NAME,s),s&&s[this.DATAITEM_EXTRA_FIELD_NAME])a=s[this.DATAITEM_EXTRA_FIELD_NAME];else{var l=t.exclude(Kekule.ObjUtils.getOwnedFieldNames(e,!1),[this.DATAITEM_SRC_FIELD_NAME,this.DATAITEM_EXTRA_FIELD_NAME].concat(i));l.length&&(a={});for(n=0,o=l.length;n<o;++n)a[l[n]]=e[l[n]]}return a&&this._setSysFieldOfDataItem(s||r,this.DATAITEM_EXTRA_FIELD_NAME,a),r},_convArrayToSymboledHash:function(e,t){for(var r={},i=0,n=Math.min(t.length,e.length);i<n;++i){var o=e[i];r[t[i]]=o}return r},_itemArrayToHash:function(e,t){if(!e)return null;for(var r={},i=this.getLocalVarSymbols(),n=0,o=Math.min(i.length,e.length);n<o;++n){var a;a=t.basedOnInternalUnit?e[n]:this._convertVarValueToExternal(e[n],n),r[i[n]]=a}var s=this._getDataValueSrc(e);return s[this.DATAITEM_EXTRA_FIELD_NAME]&&this._setSysFieldOfDataItem(r,this.DATAITEM_EXTRA_FIELD_NAME,e[this.DATAITEM_EXTRA_FIELD_NAME]),this._setSysFieldOfDataItem(r,this.DATAITEM_SRC_FIELD_NAME,s||e),r},_convertVarValueToNewUnit:function(e,t,r,i){return Kekule.NumUtils.isNormalNumber(e)?Kekule.Spectroscopy.DataValueConverterManager.doConvert(e,t,r,i,this,this.getParent()):e},_convertVarValueToExternal:function(e,t){var r=e,i=this.getLocalVarDef(t);return i&&i.hasDifferentExternalUnit&&i.hasDifferentExternalUnit()&&(r=this._convertVarValueToNewUnit(e,i,i.getInternalUnit(),i.getActualExternalUnit())),r},_convertVarValueToInternal:function(e,t){var r=e,i=this.getLocalVarDef(t);return i&&i.hasDifferentExternalUnit&&i.hasDifferentExternalUnit()&&(r=this._convertVarValueToNewUnit(e,i,i.getActualExternalUnit(),i.getInternalUnit())),r},isDataSorted:function(){return this._sorted||this.getDataCount()<=1},setDataSorted:function(e){return this._sorted=!!e,this},sort:function(e){if(!this.isDataSorted()){var r=this,i=e?function(t,i){return e(r._itemArrayToHash(t),r._itemArrayToHash(i))}:function(e,r){return t.compare(e,r)};return this.getDataItems().sort(i),this.setDataSorted(!0),this}},getIndependentVarValueOrder:function(e){var t=0;if(this.isDataSorted()){var r=this,i=function(e,t,i,o){var a=t,s={},l=!1;do{s.value=r.getHashValueAt(a)[e],s.index=a,a+=o,l=Kekule.NumUtils.isNormalNumber(s.value)}while(!l&&(o>0&&a<=n||o<0&&a>=i));return l?s:null},n=this.getDataCount()-1,o=i(e,0,n,1),a=i(e,n,0,-1);o&&a&&o.index<a.index&&(t=Math.sign(a.value-o.value))}return t},getDataCount:function(){return this.getDataItems().length},clearCache:function(){this._cache={}},notifyDataChange:function(){var e=this.getDataItems();this.setDataSorted(!1),this.clearCache(),this.updateDataModifiedTime(),this.notifyPropSet("dataItems",e),this.invokeEvent("dataChange",{data:e})},updateDataModifiedTime:function(){this.setPropStoreFieldValue("modifiedTime",new Date)},clear:function(){this.setDataItems([]),this.notifyDataChange(),this.setDataSorted(!0)},indexOfDataItem:function(e){var t=e[this.DATAITEM_SRC_FIELD_NAME]||e;return this.getDataItems().indexOf(t)},appendData:function(e){var t;if(t=DataType.isArrayValue(e)?e:this._itemHashToArray(e))return this.getDataItems().push(t),t[this.DATAITEM_EXTRA_FIELD_NAME]&&this._extraInfoAdded(t[this.DATAITEM_EXTRA_FIELD_NAME]),this.notifyDataChange(),t},removeData:function(e){var t=this.getDataItems().indexOf(e);return this.removeDataItemAt(t)},removeDataAt:function(e){var t=this.getDataItems().splice(e,1);return this.notifyDataChange(),t},getRawValueAt:function(e){var r=this.getDataItems()[e];if(r){var i=t.clone(r);i[this.DATAITEM_SRC_FIELD_NAME]=r;for(var n=this.getMode()===Kekule.Spectroscopy.DataMode.CONTINUOUS,o=this.getDataCount()-1,a=0,s=i.length;a<s;++a){var l=i[a];if(DataType.isUndefinedValue(l)||DataType.isNullValue(l)){var u=this.getDefaultVarValue(a);if(Kekule.ObjUtils.notUnset(u))l=u;else if(n){var d=this.getContinuousVarRange(a);d&&(l=o>1?e/o*(d.toValue-d.fromValue)+d.fromValue:d.fromValue)}}i[a]=l}return r[this.DATAITEM_EXTRA_FIELD_NAME]&&this._setSysFieldOfDataItem(i,this.DATAITEM_EXTRA_FIELD_NAME,r._extra),i}return null},getHashValueAt:function(e,t){return this._itemArrayToHash(this.getRawValueAt(e),t||{})},getValueAt:function(e,t){return this.getHashValueAt(e,t)},setRawValueAt:function(e,t){var r=this.getDataItems()[e];return r&&r[this.DATAITEM_EXTRA_FIELD_NAME]&&this._extraInfoRemoved(r[this.DATAITEM_EXTRA_FIELD_NAME]),this.getDataItems()[e]=t,t[this.DATAITEM_EXTRA_FIELD_NAME]&&(this._setSysFieldOfDataItem(t,this.DATAITEM_EXTRA_FIELD_NAME,t[this.DATAITEM_EXTRA_FIELD_NAME]),this._extraInfoAdded(t[this.DATAITEM_EXTRA_FIELD_NAME])),this.notifyDataChange(),this},setHashValueAt:function(e,t,r){var i=this._itemHashToArray(t);return this.setRawValueAt(e,i),this},setValueAt:function(e,t,r){var i;return i=DataType.isArrayValue(t)?t:this._itemHashToArray(t),this.setRawValueAt(e,i),this},_getDataValueSrc:function(e){return e?DataType.isArrayValue(e)?e[this.DATAITEM_SRC_FIELD_NAME]||e:e[this.DATAITEM_SRC_FIELD_NAME]:null},createDefaultExtraInfoObjectFor:function(e){var t=this.isPeakSection()?Kekule.Spectroscopy.SpectrumPeakDetails:null,r=t?new t:null;return r&&Kekule.ObjUtils.notUnset(e)&&("number"==typeof e?this.setExtraInfoAt(e,r):e&&this.setExtraInfoOf(e,r)),r},getExtraInfoOf:function(e){return(this._getDataValueSrc(e)||e)[this.DATAITEM_EXTRA_FIELD_NAME]||e[this.DATAITEM_EXTRA_FIELD_NAME]},setExtraInfoOf:function(e,t){var r=this._getDataValueSrc(e)||e;return r[this.DATAITEM_EXTRA_FIELD_NAME]&&this._extraInfoRemoved(r[this.DATAITEM_EXTRA_FIELD_NAME]),this._setSysFieldOfDataItem(r,this.DATAITEM_EXTRA_FIELD_NAME,t),this._extraInfoAdded(t),this.notifyDataChange(),this},getExtraInfoAt:function(e){var t=this.getDataItems()[e];return t&&t[this.DATAITEM_EXTRA_FIELD_NAME]},setExtraInfoAt:function(e,t){var r=this.getDataItems()[e];return r[this.DATAITEM_EXTRA_FIELD_NAME]&&this._extraInfoRemoved(r[this.DATAITEM_EXTRA_FIELD_NAME]),this._setSysFieldOfDataItem(r,this.DATAITEM_EXTRA_FIELD_NAME,t),this._extraInfoAdded(t),this.notifyDataChange(),this},_extraInfoAdded:function(e){e&&e instanceof Kekule.ChemObject&&(e.setParent(this),e.setOwner(this.getOwner()))},_extraInfoRemoved:function(e){e&&e instanceof Kekule.ChemObject&&e.getParent()===this&&(e.setParent(null),e.setOwner(null))},getPeakRootValueOf:function(e){if(this.getMode()!==Kekule.Spectroscopy.DataMode.PEAK)return null;var t=this.getDefPeakRoot()||this._getDefaultPeakRoot();return Object.extend(Object.extend({},e),t)},getPeakRootValueAt:function(e){return this.getPeakRootValueOf(this.getValueAt(e))},getSurroundingDataItemIndexesFromIndependent:function(e,t){},getDataItemIndexFromIndependent:function(e,t){var r={};r="number"==typeof e?this._convArrayToSymboledHash([e],this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):DataType.isArrayValue(e)?this._convArrayToSymboledHash(e,this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):e;for(var i=Kekule.ObjUtils.getOwnedFieldNames(r),n=this.calcDataRange(i),o=t&&t.allowedErrorRate,a={},s=0,l=i.length;s<l;++s){if((C=r[f=i[s]])<n[f].min||C>n[f].max)return-1;a[f]=o&&(n[f].max-n[f].min)*o}var u={index:-1,distanceSqr:0};for(s=0,l=this.getDataCount();s<l;++s){for(var d,c=this.getHashValueAt(s),h=!0,p=0,g=i.length;p<g;++p){var f,C=r[f=i[p]],m=c[f],T=Math.abs(m-C);if(!(T<=a[f])){h=!1;break}d+=Math.sqr(T/n[f])}h&&(u.index<0||u.distanceSqr>d)&&(u.index=s,u.distanceSqr=d)}return u.index},getDataValueFromIndependent:function(e,t){var r=this.getDataItemIndexFromIndependent(e,t);return r>=0?this.getValueAt(r):null},calcValueFromIndependent:function(e,t){var r={};return r="number"==typeof e?this._convArrayToSymboledHash([e],this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):DataType.isArrayValue(e)?this._convArrayToSymboledHash(e,this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):e,this.doCalcValueFromIndependent(r,t)},doCalcValueFromIndependent:function(e,t){return this.getMode()===Kekule.Spectroscopy.DataMode.PEAK?this._doCalcValueFromIndependentInPeakMode(e,t):this._doCalcValueFromIndependentInContinousMode(e,t)},_doCalcValueFromIndependentInPeakMode:function(e,t){var r=this.getDataItemIndexFromIndependent(e,t);return r>=0?this.getHashValueAt(r):this.getPeakRootValueOf(e)},_doCalcValueFromIndependentInContinousMode:function(e,t){var r=this._doCalcValueFromIndependentInContinousModeEx(e,t);return r&&r.value},_doCalcValueFromIndependentInContinousModeEx:function(e,t){var r=this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT),i=this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.DEPENDENT);if(r.length>1)return null;var n,o=r[0],a=e[o],s=this.calcDataRange([o])[o];if(a<s.min||a>s.max)return null;var l=-1,u=-1,d=!0,c=this.getLocalVarDef(o),h=this.getDataCount();if(d=!c.hasDifferentExternalUnit()){var p=this.getContinuousVarRange(o);d=!!p}if(d){var g=(a-p.fromValue)/(p.toValue-p.fromValue)*(h-1);l=Math.max(Math.floor(g),0),u=Math.min(Math.ceil(g),h-1)}else{var f=this.getIndependentVarValueOrder(o);if(0===f);else{var C=f<0,m=this._calcNeighborDataIndexesToIndependentValue(o,a,0,h-1,C);l=m[0],u=m[1]}}if(l<0||u<0)return null;if(l===u)n=this.getHashValueAt(l);else{var T=this._calcIntermediateDependentVarValuesBetween(i,o,a,l,u);(n={})[o]=a,n=Object.extend(n,T)}return{value:n,dataIndexes:[l,u]}},_calcNeighborDataIndexesToIndependentValue:function(e,t,r,i,n){if(i-r<=2)return[r,i];var o=Math.round((r+i)/2),a=this.getHashValueAt(o)[e];return a===t?[o,o]:a<=t?n?this._calcNeighborDataIndexesToIndependentValue(e,t,r,o,n):this._calcNeighborDataIndexesToIndependentValue(e,t,o,i,n):n?this._calcNeighborDataIndexesToIndependentValue(e,t,o,i,n):this._calcNeighborDataIndexesToIndependentValue(e,t,r,o,n)},_calcIntermediateDependentVarValuesBetween:function(e,t,r,i,n){if(i===n){for(var o=this.getHashValueAt(i),a={},s=0,l=e.length;s<l;++s)a[e[s]]=o[e[s]];return a}var u=this.getHashValueAt(i),d=this.getHashValueAt(n),c=u[t],h=d[t];if(Kekule.NumUtils.isNormalNumber(c)){if(Kekule.NumUtils.isNormalNumber(h)){var p=(r-u[t])/(d[t]-u[t]);for(a={},s=0,l=e.length;s<l;++s){var g=e[s],f=u[g],C=d[g],m=!1;m=Kekule.NumUtils.isNormalNumber(f)?Kekule.NumUtils.isNormalNumber(C)?f+(C-f)*p:n<this.getDataCount()-1?this._calcIntermediateDependentVarValuesBetween([g],t,r,i,n+1):f[g]:i>0?this._calcIntermediateDependentVarValuesBetween([g],t,r,i-1,n):C[g],a[g]=m}return a}return n<this.getDataCount()-1?this._calcIntermediateDependentVarValuesBetween(e,t,r,i,n+1):this._calcIntermediateDependentVarValuesBetween(e,t,r,i,i)}return i>0?this._calcIntermediateDependentVarValuesBetween(e,t,r,i-1,n):this._calcIntermediateDependentVarValuesBetween(e,t,r,n,n)},calcValueRangeFromIndependentRangeEx:function(e,t){var r={};return r=DataType.isArrayValue(e)?this._convArrayToSymboledHash(e,this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):e,this.doCalcValueRangeFromIndependentRangeEx(r,t)},doCalcValueRangeFromIndependentRangeEx:function(e,t){for(var r=this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT),i=this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.DEPENDENT),n=this.calcDataRange(r),o=(t&&t.findNearest,{}),a={},s=0,l=r.length;s<l;++s){var u=r[s];if(e[u]){var d=Object.extend({},e[u]),c=n[u];d.min<c.min&&(d.min=c.min),d.max>c.max&&(d.max=c.max),o[u]=d,a[u]=(d.min+d.max)/2}}var h=this.getMode()===Kekule.Spectroscopy.DataMode.PEAK?this._doCalcValueRangeFromIndependentRangeInPeakModeEx(o,a,r,i,t):this._doCalcValueRangeFromIndependentRangeInContinousModeEx(o,a,r,i,t);return h&&h.range&&Kekule.ObjUtils.getOwnedFieldNames(h.range)<=0&&(h.range=null),h},_doCalcValueRangeFromIndependentRangeInPeakModeEx:function(e,t,r,i,n){var o,a,s,l,u=!!t,d={dataIndexes:[],dataValues:[],range:{}};n.findInReversedOrder?(a=this.getDataCount()-1,s=0,l=-1):(a=0,s=this.getDataCount()-1,l=1);for(var c=a;n.findInReversedOrder?c>=s:c<=s;c+=l){for(var h=this.getHashValueAt(c),p=!0,g=0,f=0,C=r.length;f<C;++f){var m=r[f];if(!(p=h[m]>=e[m].min&&h[m]<=e[m].max))break;u&&(g+=Math.sqr(h[m]-t[m]))}p&&(d.dataIndexes.push(c),d.dataValues.push(h),u&&(void 0===o||g<o)&&(o=g,d.nearest={dataIndex:c,dataValue:h}))}return d.range=Kekule.Spectroscopy.Utils.expandDataRange(d.range,d.dataValues),d},_doCalcValueRangeFromIndependentRangeInContinousModeEx:function(e,t,r,i,n){if(r.length>1)return null;var o=r[0],a=e[o],s={},l={};s[o]=a.min,l[o]=a.max;var u=this._doCalcValueFromIndependentInContinousModeEx(s,n),d=this._doCalcValueFromIndependentInContinousModeEx(l,n);if(!u||!d)return null;var c=u.dataIndexes[0]>d.dataIndexes[0],h={};c?(h.fromIndex=d.dataIndexes[1],h.toIndex=u.dataIndexes[0]):(h.fromIndex=u.dataIndexes[1],h.toIndex=d.dataIndexes[0]);for(var p={range:{},dataIndexes:[],dataValues:[]},g=h.fromIndex;g<=h.toIndex;++g){var f=this.getHashValueAt(g);p.dataValues.push(f),p.dataIndexes.push(g),p.range=Kekule.Spectroscopy.Utils.expandDataRange(p.range,f)}return p.range=Kekule.Spectroscopy.Utils.expandDataRange(p.range,[u.value,d.value]),c?(p.dataValues.push(u.value),p.dataValues.unshift(d.value)):(p.dataValues.push(d.value),p.dataValues.unshift(u.value)),p.dataIndexes.push(-1),p.dataIndexes.unshift(-1),p},getIterator:function(){return this.doGetIterator()},doGetIterator:function(){var e=this.getDataItems(),t=this;return{index:0,next:function(r){if(this.index>=e.length)return{done:!0};var i={done:!1,value:t.getHashValueAt(this.index,r)};return++this.index,i}}},forEach:function(e,t,r){var i=this.getIterator();if(i)for(var n=0,o=i.next(r);!o.done;)e.apply(t,[o.value,n]),++n,o=i.next();return this},getComparisonPropNames:function(e){var r=this.tryApplySuper("getComparisonPropNames",[e]);return r&&(r=t.exclude(r,["parent","owner"]),t.pushUnique(r,"dataItems")),r},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(t=(t||[]).concat("defPeakRoot","localVarInfos","mode","dataItems")),t},doCompareProperty:function(e,t,r){return"dataItems"===t?this.doCompareDataItems(this,e,r):"localVarInfos"===t?this.doCompareLocalVarInfos(this,e,r):this.tryApplySuper("doCompareProperty",[e,t,r])},doCompareLocalVarInfos:function(e,t,r){var i=e.getActualLocalVarInfos(),n=t.getActualLocalVarInfos(),o=i.length-n.length;if(!o&&r.method!==Kekule.ComparisonMethod.CHEM_STRUCTURE)for(var a=0,s=i.length;a<s;++a){var l=i[a],u=n[a];if(o=Kekule.ObjComparer.compare(l,u,r))break}if(!o)for(a=0,s=i.length;a<s;++a){var d=e.getLocalVarDef(a),c=e.getLocalVarDef(a);if(o=this.doCompareOnValue(d,c,r))break}return o},doCompareDataItems:function(e,t,r){var i=function(e,t){var r=e.getHashValueAt(t);return e._itemHashToArray(r)},n=e.getDataCount()-t.getDataCount();if(!n)for(var o=0,a=e.getDataCount();o<a;++o){var s=i(e,o),l=i(e,o);if(!(n=this._compareDataRawValue(s,l,r))){var u=e.getExtraInfoAt(o)||null,d=t.getExtraInfoAt(o)||null;u&&u.isEmpty()&&(u=null),d&&d.isEmpty()&&(d=null),n=this.doCompareOnValue(u,d,r)}if(n)break}return n},_compareDataRawValue:function(e,t,r){var i;if(!e&&!t)return 0;if(e&&!t)return 1;if(!e&&t)return-1;if(!(i=(e.length||-1)-(t.length||-1)))for(var n=Kekule.NumUtils,o=r.allowedComparisonErrorRate||Kekule.globalOptions.spectrum.data.allowedComparisonErrorRate||5e-8,a=0,s=e.length;a<s;++a){var l=e[a],u=t[a];if(i=n.isNormalNumber(l)&&n.isNormalNumber(u)?n.isFloatEqual(l,u,Math.abs(l*o))?0:Math.sign(l-u):this.doCompareOnValue(e,t,r))break}return i}}),Kekule.Spectroscopy.SpectrumData=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Spectroscopy.SpectrumData",initialize:function(e,r,i){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("variables",r?t.clone(r):[]);var n=new Kekule.ChemObjList(null,Kekule.Spectroscopy.SpectrumDataSection,!0);this.setPropStoreFieldValue("sections",n),this.setParent(i),n.setOwner(this.getOwner())},doFinalize:function(){this.getSections().finalize();for(var e=this.getVariables()||[],t=0,r=e.length;t<r;++t)e[t].finalize();this.setPropStoreFieldValue("variables",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getPropStoreFieldValue("owner")||this._getDefaultOwner()},setter:function(e){if(e!==this.getPropStoreFieldValue("owner")){this.setPropStoreFieldValue("owner",e);var t=this.getOwner(),r=this.getSections();r&&r.setOwner(t)}}}),this.defineProp("parent",{dataType:"Kekule.Spectroscopy.Spectrum",serializable:!1,setter:function(e){this.setPropStoreFieldValue("parent",e);var t=this.getSections();t&&t.setParent(this.getParent()||this)}}),this.defineProp("sections",{dataType:"Kekule.ChemObjList",setter:function(e){var t=this.getSections();t!==e&&(t&&t.finalize(),e&&(e._transparent=!0,e.setParent(this.getParent()||this),e.setOwner(this.getOwner())),this.setPropStoreFieldValue("sections",e))}}),this.defineProp("autoCreateSection",{dataType:DataType.BOOL}),this.defineProp("activeSectionIndex",{dataType:DataType.INT,getter:function(){return this.getSectionCount()<=0?-1:1===this.getSectionCount()?0:this.getPropStoreFieldValue("activeSectionIndex")},setter:function(e){e>=0&&e<=this.getSectionCount()&&this.setPropStoreFieldValue("activeSectionIndex",e)}}),this.defineProp("activeSection",{dataType:"Kekule.Spectroscopy.SpectrumDataSection",serializable:!1,getter:function(){var e=this.getSectionAt(this.getActiveSectionIndex()||0);return!e&&this.getSectionCount()<=0&&this.getAutoCreateSection()&&(e=this.createSection(this.getVariables())),e},setter:function(e){this.setActiveSectionIndex(this.indexOfSection(e))}}),this.defineProp("variables",{dataType:DataType.ARRAY}),this.defineProp("varSymbols",{dataType:DataType.ARRAY,setter:null,scope:e.PRIVATE,getter:function(){for(var e=[],t=this.getVariables()||[],r=0,i=t.length;r<i;++r){var n=t[r];e.push(n.getSymbol())}return e}}),this.defineProp("mode",{dataType:DataType.INT,enumSource:Kekule.Spectroscopy.DataMode})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoCreateSection(!0),this.setMode(Kekule.Spectroscopy.DataMode.CONTINUOUS)},_getDefaultOwner:function(){var e=this.getParent();return e&&e.getOwner&&e.getOwner()},getHigherLevelObj:function(){return this.getParent()},getChildHolder:function(){return this.getSections()},loaded:function(e){var t=this.getSections();t&&(t.parentChanged(this),t.ownerChanged(this.getOwner())),this.tryApplySuper("loaded",[e])},isEmpty:function(){for(var e=0,t=this.getSectionCount();e<t;++e)if(!this.getSectionAt(e).isEmpty())return!1;return!0},createSection:function(e,t){var r=new Kekule.Spectroscopy.SpectrumDataSection(void 0,this,e);return r.setMode(t||this.getMode()),this.getSections().appendChild(r),r},clearSection:function(){for(var e=this.getChildren(),t=0,r=e.length;t<r;++t)e[t].clear(),e[t].setParent(null),e[t].finalize();this.getSections().clear()},getSectionCount:function(){return this.getSections().getChildCount()},getSectionAt:function(e){return this.getSections().getItemAt(e)},indexOfSection:function(e){return this.getSections().indexOfItem(e)},hasSection:function(e){return this.indexOfSection(e)>=0},removeSectionAt:function(e){return this.getSections().removeItemAt(e)},removeSection:function(e){return this.getSections().removeItem(e)},insertSectionAt:function(e,t){return this.getSections().insertItemAt(e,t)},insertSectionBefore:function(e,t){return this.getSections().insertItemBefore(e,t)},appendSection:function(e){return this.getSections().appendChild(e)},hasMultipleSections:function(){return this.getSections().getChildCount()>1},calcDataRangeOfSection:function(e,t){return e.calcDataRange(t)},calcDataRangeOfSections:function(e,t,r){for(var i={},n=0,o=e.length;n<o;++n){var a=e[n].calcDataRange(t,r);i=Kekule.Spectroscopy.Utils.mergeDataRange(i,a)}return i},getDisplayRangeOfSection:function(e,t,r){return e.getDisplayRangeOfVars(t,r)},getDisplayRangeOfSections:function(e,t,r){for(var i={},n=0,o=e.length;n<o;++n){var a=e[n].getDisplayRangeOfVars(t,r);i=Kekule.Spectroscopy.Utils.mergeDataRange(i,a)}return i},getVariableCount:function(){return(this.getVariables()||[]).length},getVariable:function(e){return e instanceof Kekule.VarDefinition?e:"number"==typeof e?this.getVariables()[e]:this.getVariables()[this.getVarSymbols().indexOf(e)]},indexOfVariable:function(e){return this.getVariables().indexOf(e)},insertVariableAt:function(e,t){return t>=0?this.getVariables().splice(t,0,e):this.getVariables().push(e),this},insertVariableBefore:function(e,t){var r=t?this.indexOfVarDefinition(t):-1;return this.insertVarDefinitionAt(e,r)},appendVariable:function(e){return this.insertVariableAt(e,-1)},removeVariableAt:function(e){return this.getVariables().splice(e,1),this},removeVariable:function(e){var t=this.indexOfVariable(e);return t>=0&&this.removeVariableAt(t),this},getVariablesOfDependency:function(e){for(var t=[],r=0,i=this.getVariableCount();r<i;++r){var n=this.getVariable(r);n&&n.getDependency()===e&&t.push(n)}return t},getContinuousVarRange:function(e){var t=this.getVariable(e),r=t&&t.getInfo();return r&&r.continuous?{fromValue:r.fromValue,toValue:r.toValue}:null},setContinuousVarRange:function(e,t,r){var i=this.getVariable(e),n=i&&i.getInfo(!0);return n.continuous=!0,n.fromValue=t,n.toValue=r,this},clearContinuousVarRange:function(e){var t=this.getVariable(e).getInfo();return t&&t.continuous&&(t.continuous=!1),this},setDefaultVarValue:function(e,t){var r=this.getVariable(e);return(r&&r.getInfo(!0)).defaultValue=t,this},clearDefaultVarValue:function(e){return this.setDefaultVarValue(e,null)},getDefaultVarValue:function(e){var t=this.getVariable(e),r=t&&t.getInfo();if(r)return r.defaultValue},iterateSections:function(e){for(var t=0,r=this.getSectionCount();t<r;++t)e(this.getSectionAt(t),t)},sort:function(e){this.iterateSections(function(t){t.sort(e)})},getDataCount:function(){var e=0;return this.iterateSections(function(t){e+=t.getDataCount()}),e},clearData:function(){this.iterateSections(function(e){e.clear()})},appendData:function(e){return this.getActiveSection().appendData(e)},removeData:function(e){return this.getActiveSection().removeData(e)},removeDataAt:function(e){return this.getActiveSection().removeDataAt(e)},getRawValueAt:function(e){return this.getActiveSection().getRawValueAt(e)},getHashValueAt:function(e){return this.getActiveSection().getHashValueAt(e)},getValueAt:function(e){return this.getHashValueAt(e)},setRawValueAt:function(e,t){return this.getActiveSection().setRawValueAt(e,t),this},setHashValueAt:function(e,t,r){return this.getActiveSection().setHashValueAt(e,t,r),this},setValueAt:function(e,t,r){return this.getActiveSection().setValueAt(e,t),this},getExtraInfoOf:function(e){return this.getActiveSection().getExtraInfoOf(e)},setExtraInfoOf:function(e,t){return this.getActiveSection().setExtraInfoOf(e,t),this},getExtraInfoAt:function(e){return this.getActiveSection().getExtraInfoAt(e)},setExtraInfoAt:function(e,t){return this.getActiveSection().setExtraInfoAt(e,t),this},getIterator:function(){return this.doGetIterator()},doGetIterator:function(){var e=this.getSections().getItems();return{sectionIndex:0,index:0,next:function(){var t=this,r=function(){return t.sectionIndex>=e.length||t.sectionIndex===e.length-1&&t.index>=e[e.length-1].getDataCount()};if(r())return{done:!0};if(!(this.index<e[this.sectionIndex].getDataCount())){do{++this.sectionIndex,this.index=0}while(this.index>=e[this.sectionIndex].getDataCount()||t.sectionIndex>=e.length);return r()?{done:!0}:{done:!1,value:e[this.sectionIndex].getValueAt(this.index)}}var i={done:!1,value:e[this.sectionIndex].getValueAt(this.index)};return++this.index,i}}},forEach:function(e,t){var r=this.getIterator();if(r)for(var i=0,n=r.next();!n.done;)e.apply(t,[n.value,i]),++i,n=r.next();return this}}),Kekule.Spectroscopy.PeakShape={SHARP:"sharp",BROAD:"broad"},Kekule.Spectroscopy.PeakMultiplicity={UNKNOWN:0,SINGLET:1,DOUBLET:2,TRIPLET:3,QUARTET:4,QUINTET:5,SEXTUPLET:6,DOUBLE_DOUBLET:22,TRIPLE_DOUBLET:32,MULTIPLET:255},Kekule.Spectroscopy.SpectrumDataDetails=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Spectroscopy.SpectrumDataDetails",initialize:function(e){this.setPropStoreFieldValue("assignments",[]),this.tryApplySuper("initialize",[]),this.setPropValues(e)},initProperties:function(){this.defineProp("assignments",{dataType:DataType.ARRAY,objRef:!0,autoUpdate:!0,setter:function(e){var r=e?DataType.isArrayValue(e)?t.clone(e):t.toArray(e):[];this.setPropStoreFieldValue("assignments",r)}}),this.defineProp("assignment",{dataType:"Kekule.ChemObject",serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return(this.getAssignments()||[])[0]},setter:function(e){this.setAssignments(e)}})},doFinalize:function(){this.setPropStoreFieldValue("assignments",null),this.tryApplySuper("doFinalize")},getAutoIdPrefix:function(){return"d"},isEmpty:function(){var e=this.getAssignments();return!e||!e.length},hasAssignments:function(){var e=this.getAssignments();return!(!e||!e.length)},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(t=t||[]).unshift("assignments"),t}}),Kekule.Spectroscopy.SpectrumPeakDetails=Class.create(Kekule.Spectroscopy.SpectrumDataDetails,{CLASS_NAME:"Kekule.Spectroscopy.SpectrumPeakDetails",initProperties:function(){this.defineProp("shape",{dataType:DataType.STRING}),this.defineProp("multiplicity",{dataType:DataType.VARIANT})},getAutoIdPrefix:function(){return"p"},isEmpty:function(){var e=this.tryApplySuper("isEmpty");return e=e&&!this.getShape()&&Kekule.ObjUtils.isUnset(this.getMultiplicity())},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&((t=t||[]).unshift("shape"),t.unshift("multiplicity")),t}}),Kekule.Spectroscopy.SpectrumType={NMR:"NMR",IR:"IR",MS:"MS",UV_VIS:"UV_VIS",IMS:"IMS",RAMAN:"Raman",CHROMATOGRAPHY:"chromatography",GENERAL:"general"},Kekule.Spectroscopy.SpectrumNMR={TargetNucleus:{C13:"C13",H:"H"}},Kekule.Spectroscopy.Spectrum=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Spectroscopy.Spectrum",initialize:function(e){this.setPropStoreFieldValue("data",new Kekule.Spectroscopy.SpectrumData(null,null,this)),this.tryApplySuper("initialize",[e]),this._initDelegatedMethods()},doFinalize:function(){this.setPropStoreFieldValue("refMolecules",null);var e=this.getData();e&&e.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("spectrumType",{dataType:DataType.STRING}),this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("data",{dataType:"Kekule.Spectroscopy.SpectrumData",setter:function(e){var t=this.getData();e!==t&&(t&&t.finalize(),e&&e.setPropValue("parent",this,!0),this.setPropStoreFieldValue("data",e))}}),this.defineProp("refMolecules",{dataType:DataType.ARRAY,objRef:!0,autoUpdate:!0,setter:function(e){var r=e?DataType.isArrayValue(e)?t.clone(e):t.toArray(e):[];this.setPropStoreFieldValue("refMolecules",r)}}),this.defineProp("refMolecule",{dataType:"Kekule.Molecule",serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return(this.getRefMolecules()||[])[0]},setter:function(e){this.setrRefMolecules(e)}}),this._defineInfoProperty("title"),this._defineInfoProperty("metaData",null,{dataType:DataType.HASH}),this._defineInfoProperty("conditions",null,{dataType:DataType.HASH}),this._defineInfoProperty("parameters",null,{dataType:DataType.HASH}),this._defineInfoProperty("annotations",null,{dataType:DataType.HASH}),this._defineDataDelegatedProperty("variables"),this._defineDataDelegatedProperty("varSymbols"),this._defineDataDelegatedProperty("dataSections","sections"),this._defineDataDelegatedProperty("activeDataSectionIndex","activeSectionIndex"),this._defineDataDelegatedProperty("activeDataSection","activeSection")},_initDelegatedMethods:function(){this._defineDataDelegatedMethod("isEmpty"),this._defineDataDelegatedMethod("createDataSection","createSection"),this._defineDataDelegatedMethod("clearDataSection","clearSection"),this._defineDataDelegatedMethod("getDataSectionCount","getSectionCount"),this._defineDataDelegatedMethod("getDataSectionAt","getSectionAt"),this._defineDataDelegatedMethod("indexOfDataSection","indexOfSection"),this._defineDataDelegatedMethod("hasDataSection","hasSection"),this._defineDataDelegatedMethod("removeDataSectionAt","removeSectionAt"),this._defineDataDelegatedMethod("removeDataSection","removeSection"),this._defineDataDelegatedMethod("insertDataSectionAt","insertSectionAt"),this._defineDataDelegatedMethod("insertDataSectionBefore","insertSectionBefore"),this._defineDataDelegatedMethod("appendDataSection","appendSection"),this._defineDataDelegatedMethod("iterateDataSection","iterateSection"),this._defineDataDelegatedMethod("sortData","sort"),this._defineDataDelegatedMethod("clearData"),this._defineDataDelegatedMethod("getVariableCount"),this._defineDataDelegatedMethod("getVariable"),this._defineDataDelegatedMethod("indexOfVariable"),this._defineDataDelegatedMethod("insertVariableAt"),this._defineDataDelegatedMethod("insertVariableBefore"),this._defineDataDelegatedMethod("appendVariable"),this._defineDataDelegatedMethod("removeVariableAt"),this._defineDataDelegatedMethod("removeVariable"),this._defineDataDelegatedMethod("getVariablesOfDependency"),this._defineDataDelegatedMethod("getContinuousVarRange"),this._defineDataDelegatedMethod("setContinuousVarRange"),this._defineDataDelegatedMethod("clearContinuousVarRange"),this._defineDataDelegatedMethod("getDefaultVarValue"),this._defineDataDelegatedMethod("setDefaultVarValue"),this._defineDataDelegatedMethod("clearDefaultVarValue")},_defineInfoProperty:function(e,t,r){var i,n,o;return o=(n=t||e).upperFirst(),i=Object.extend({getter:function(){return this.getInfoValue(n)||this.getInfoValue(o)},setter:function(e){this.setInfoValue(n,e)},serializable:!1},r),this.defineProp(e,i)},_defineDataDelegatedProperty:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(Kekule.Spectroscopy.SpectrumData,t),i=Object.create(r);return i.getter=null,i.setter=null,i.serializable=!1,r.getter&&(i.getter=function(){return this.getData().getPropValue(t)}),r.setter&&(i.setter=function(e){this.getData().setPropValue(t,e)}),this.defineProp(e,i)},_defineDataDelegatedMethod:function(e,t){t||(t=e),ClassEx.getPrototype(this.getClass())[e]=function(){var e=this.getData(),r=e[t].apply(e,arguments);return r===e&&(r=this),r}},getAutoIdPrefix:function(){return"s"},ownerChanged:function(e,t){var r=this.getData();r&&r.setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},isEmpty:function(){if(this.getDataSectionCount()<=0)return!0;for(var e=0,t=this.getDataSectionCount();e<t;++e)if(!this.getDataSectionAt(e).isEmpty())return!1;return!0},getChildSubgroupNames:function(){return["dataSection"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.Spectroscopy.SpectrumDataSection?"dataSection":this.tryApplySuper("getBelongChildSubGroupName",[e])},doGetChildCount:function(){return this.getDataSectionCount()},doGetChildAt:function(e){return this.getDataSectionAt(e)},doIndexOfChild:function(e){return this.indexOfDataSection(e)},_getCandidateInfoPropNames:function(e){if(e.indexOf(i.DELIMITER)>=0)return[e];var t=i.getNamespaces(),r=this.getSpectrumType();r&&(t=[r].concat(t));for(var n=[e],o=0,a=t.length;o<a;++o)n.push(t[o]+i.DELIMITER+e);return n},_getSpectrumInfoValueOfCategory:function(e,t){var r=e?this.getInfoValue(e):this.getInfo();if(r){if(!Kekule.globalOptions.spectrum.spectrumInfo.enablePrefixOmissionInGetter)return r[t];for(var i=this._getCandidateInfoPropNames(t),n=0,o=i.length;n<o;++n){var a=i[n];if(void 0!==r[a])return r[a]}}},setSpectrumInfoValue:function(e,t,r){if(e){var i=this.getInfoValue(e);i||(i={},this.setInfoValue(e,i)),i[t]=r}else this.setInfoValue(t,r);return this},getSpectrumInfoKeysOfCategory:function(e){if(e){var r=this.getInfoValue(e);return r?Kekule.ObjUtils.getOwnedFieldNames(r,!1):[]}if(""===e){var i=this.getInfoKeys();return i=t.exclude(i,this.getSpectrumInfoCategories())}return[]},getSpectrumInfoCategories:function(){for(var e=["metaData","conditions","parameters","annotations"],t=[],r=0,i=e.length;r<i;++r){var n=e[r],o=this.getSpectrumInfoKeysOfCategory(n);o&&o.length&&t.push(n)}return t},getSpectrumInfoValue:function(e,r){for(var i,n=0,o=(i=r?t.toArray(r):["conditions","parameters","metaData","annotations",""]).length;n<o;++n){var a=i[n],s=this._getSpectrumInfoValueOfCategory(a,e);if(Kekule.ObjUtils.notUnset(s))return s}},getMeta:function(e){return this._getSpectrumInfoValueOfCategory("metaData",e)},setMeta:function(e,t){return this.setSpectrumInfoValue("metaData",e,t),this},getMetaKeys:function(){return this.getSpectrumInfoKeysOfCategory("metaData")},getCondition:function(e){return this._getSpectrumInfoValueOfCategory("conditions",e)},setCondition:function(e,t){return this.setSpectrumInfoValue("conditions",e,t),this},getConditionKeys:function(){return this.getSpectrumInfoKeysOfCategory("conditions")},getParameter:function(e){return this._getSpectrumInfoValueOfCategory("parameters",e)},setParameter:function(e,t){return this.setSpectrumInfoValue("parameters",e,t),this},getParameterKeys:function(){return this.getSpectrumInfoKeysOfCategory("parameters")},getAnnotation:function(e){return this._getSpectrumInfoValueOfCategory("annotations",e)},setAnnotation:function(e,t){return this.setSpectrumInfoValue("annotations",e,t),this},getAnnotationKeys:function(){return this.getSpectrumInfoKeysOfCategory("annotations")},getVarAvailableExternalUnitObjs:function(e){return Kekule.Spectroscopy.DataValueConverterManager.getAltUnits(e,e.getInternalUnit?e.getInternalUnit():e.getUnit(),null,this)},getVarAvailableExternalUnitSymbols:function(e){for(var t=Kekule.Spectroscopy.DataValueConverterManager.getAltUnits(e,e.getInternalUnit?e.getInternalUnit():e.getUnit(),null,this),r=[],i=0,n=t.length;i<n;++i)r.push(t[i].symbol);return r},getComparisonPropNames:function(e){var t=this.tryApplySuper("getComparisonPropNames",[e]),r=t.indexOf("data");return r>=0&&t.splice(r,1),t},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(t=(t||[]).concat(["refMolecules","metaData","conditions","parameters","dataSections"])),t},doCompareProperty:function(e,t,r){if("dataSections"===t&&r.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){var n=this.getDataSections().getItems(),o=e.getDataSections().getItems();return this.doCompareOnValue(n,o,r)}if(["metaData","conditions","parameters"].indexOf(t)>=0){for(var a=["metaData","conditions","parameters","annotations"],s=this.getSpectrumInfoKeysOfCategory(t),l=0,u=s.length;l<u;++l){var d=s[l],c=this.getSpectrumInfoValue(d,[t]),h=e.getSpectrumInfoValue(d,a);if(Kekule.ObjUtils.isUnset(h)){var p=i.getPropertyCoreName(d);h=e.getSpectrumInfoValue(p,a)}if(g=this.doCompareOnValue(c,h,r))return g}return 0}var g;c=this.getPropValue(t),h=e.getPropValue(t);return g=this.doCompareOnValue(c,h,r)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.Spectroscopy.Spectrum),Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.Spectroscopy.Spectrum),(n=Kekule.Unit.register)("transmittance","transmittance","OpticalTransmittance",1),n("transmittance%","transmittance_percent","OpticalTransmittance",.01),n("reflectance","reflectance","OpticalReflectance",1),n("absorbance","absorbance","OpticalAbsorbance",1),n("Kubelka Munk","Kubelka_Munk","OpticalKubelkaMunk",1),n("counts","ms_count","Misc",null),n("relative abundance","ms_relative_abundance","SpectrumMS",null),n("m/z","ms_mass_charge_ratio","SpectrumMS",null)}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.globalOptions.add("IO.jcamp",{enableXYDataValueCheck:!0,dataValueCheckAllowedErrorRatio:.001,maxCharsPerLine:80}),Kekule.IO.Jcamp={};var t=Kekule.IO.Jcamp;Kekule.IO.Jcamp.Consts={DATA_LABEL_FLAG:"##",DATA_LABEL_TERMINATOR:"=",PRIVATE_LABEL_PREFIX:"$",SPECIFIC_LABEL_PREFIX:".",LABEL_BLOCK_BEGIN:"TITLE",LABEL_BLOCK_END:"END",LABEL_DATA_TYPE:"DATATYPE",LABEL_BLOCK_COUNT:"BLOCKS",LABEL_BLOCK_ID:"BLOCKID",LABEL_CROSS_REF:"CROSSREFERENCE",INLINE_COMMENT_FLAG:"$$",TABLE_LINE_CONTI_MARK:"=",UNKNOWN_VALUE:NaN,LABEL_DX_VERSION:"JCAMPDX",LABEL_CS_VERSION:"JCAMPCS",DATA_FORMAT_GROUP_LEADING:"(",DATA_FORMAT_GROUP_TAILING:")",DATA_FORMAT_LOOP:"..",DATA_FORMAT_INC:"++",DATA_FORMAT_SYMBOL_ASSIGNMENT:"A",DATA_FORMAT_PLOT_DESCRIPTOR_DELIMITER:",",SIMPLE_VALUE_DELIMITER:",",CROSS_REF_TYPE_TERMINATOR:":",DATA_VARLIST_FORMAT_XYDATA:1,DATA_VARLIST_FORMAT_XYPOINTS:2,DATA_VARLIST_FORMAT_XYWPOINTS:2,DATA_VARLIST_FORMAT_VAR_GROUPS:5,GROUPED_VALUE_GROUP_DELIMITER:"\n",GROUPED_VALUE_GROUP_DELIMITER_PATTERN:/[;\s+]/g,GROUPED_VALUE_ITEM_DELIMITER:",",GROUPED_VALUE_ITEM_DELIMITER_PATTERN:/,/g,GROUPED_VALUE_STR_ENCLOSER_LEADING:"<",GROUPED_VALUE_STR_ENCLOSER_TAILING:">",GROUPED_VALUE_EXPLICIT_GROUP_LEADING:"(",GROUPED_VALUE_EXPLICIT_GROUP_TAILING:")",NTUPLE_DEFINITION_ITEM_DELIMITER:",\t",VALUE_STR_EXPLICIT_QUOTE:'"',VALUE_ABNORMAL_NUM:"?",MOL_FORMULA_SUP_PREFIX:"^",MOL_FORMULA_SUB_PREFIX:"/"};var r=Kekule.IO.Jcamp.Consts;Kekule.IO.Jcamp.Format={DX:"dx",CS:"cs"},Kekule.IO.Jcamp.BlockType={DATA:0,LINK:1},Kekule.IO.Jcamp.CrossRefType={SPECTRUM:1,STRUCTURE:2,UNKNOWN:0},Kekule.IO.Jcamp.AsdfForm={AFFN:1,PAC:2,SQZ:3,DIF:4,SQZ_DUP:13,DIF_DUP:14},Kekule.IO.Jcamp.DigitCharType={ASCII:1,PAC:2,SQZ:3,DIF:4,DUP:5,_DECIMAL_POINT:9,_ABNORMAL_VALUE:19};var i=Kekule.IO.Jcamp.DigitCharType;Kekule.IO.Jcamp.Labels={_maps:[],getMaps:function(){return n._maps},addMaps:function(t){e.pushUnique(n._maps,t,!0)}};var n=Kekule.IO.Jcamp.Labels;Kekule.IO.Jcamp.Utils={compareFloat:function(e,t,r){return Kekule.ObjUtils.isUnset(r)&&(r=.01*Math.max(Math.abs(e),Math.abs(t))),Kekule.NumUtils.compareFloat(e,t,r)},calcNumFactorForRange:function(e,t,r,i,n){if(Kekule.NumUtils.isFloatEqual(e,t)&&Kekule.ObjUtils.notUnset(i)&&Kekule.ObjUtils.notUnset(n)&&e>i&&t<n)return 1;var o=1,a=Math.abs(t-e)||Math.max(Math.abs(t),Math.abs(e));if(r&&(o=a*r),Kekule.ObjUtils.notUnset(i)&&Kekule.ObjUtils.notUnset(n)&&e/o>i&&t/o<n){var s=Math.max(e/i,0),l=Math.max(t/n,0),u=s?l?Math.max(s,l):s:l;u&&(o=Math.min(o,u))}return o},standardizeLdrLabelName:function(e){return e.replace(/[\/\\\-\_\s]/g,"").toUpperCase()},ldrLabelNameEqual:function(e,t){return o.standardizeLdrLabelName(e)===o.standardizeLdrLabelName(t)},analysisLdrLabelName:function(e,t){var i;if(i=e.startsWith(r.SPECIFIC_LABEL_PREFIX)?{coreName:o.standardizeLdrLabelName(e.substr(r.SPECIFIC_LABEL_PREFIX.length)),labelType:l.SPECIFIC,labelCategory:u.ANNOTATION}:e.startsWith(r.PRIVATE_LABEL_PREFIX)?{coreName:o.standardizeLdrLabelName(e.substr(r.PRIVATE_LABEL_PREFIX.length)),labelType:l.PRIVATE,labelCategory:u.ANNOTATION}:{coreName:e,labelType:l.GLOBAL,labelCategory:u.META},void 0===t||t){var n=d.getInfo(i.coreName,i.labelType);n&&(i.dataType=n.dataType,i.labelCategory=n.labelCategory)}return i},jcampLabelNameToKekule:function(e,t){var i=Kekule.Spectroscopy.MetaPropNamespace,a=o.standardizeLdrLabelName(e);if(a.startsWith(r.PRIVATE_LABEL_PREFIX)){var s=a.substr(r.PRIVATE_LABEL_PREFIX.length);return i.createPropertyName(i.CUSTOM,s)}for(var l,u=n.getMaps(),d=0,c=u.length;d<c;++d){var h=u[d];if(a===h[0]){var p=h[1],g=i.getPropertyNameDetail(p);if(!t||!g.namespace||g.namespace===i.CUSTOM)return p;if(t===g.namespace)return p;l=p}}if(l)return l;if(a.startsWith(r.SPECIFIC_LABEL_PREFIX)){s=a.substr(r.SPECIFIC_LABEL_PREFIX.length);return i.createPropertyName(t,s)}return i.createPropertyName("jcamp",a)},kekuleLabelNameToJcamp:function(e,t,i){for(var o=Kekule.Spectroscopy.MetaPropNamespace,a=n.getMaps(),s=0,l=a.length;s<l;++s){var u=a[s];if(e===u[1])return u[0]}if(i)return null;var d=o.getPropertyNameDetail(e);return r.PRIVATE_LABEL_PREFIX+d.coreName.toUpperCase()},getCrossReferenceDetail:function(e){var i,n=e.split(r.CROSS_REF_TYPE_TERMINATOR),o=n[0].trim(),a="STRUCTURE"===o.toUpperCase()?t.CrossRefType.STRUCTURE:t.CrossRefType.SPECTRUM,s=n[1]&&n[1].trim();s&&s.toUpperCase().indexOf("BLOCK")>=0&&((i=s.split(r.DATA_LABEL_TERMINATOR)[1])&&(i=i.trim()));return{refType:a,refTypeText:o,blockId:i}},addMoleculeSpectrumCrossRef:function(e,t){var r=e.getRefMolecules()||[];r.indexOf(t)<0&&(r.push(t),e.setRefMolecules(r))},getFirstNonemptyLine:function(e){var t,r=0;do{t=(e[r]||"").trim(),++r}while(!t&&r<e.length);return t||""},getAsdfDigitInfo:function(e){var t={};return e===r.VALUE_ABNORMAL_NUM?(t.digitType=i._ABNORMAL_VALUE,t.value=null,t.sign=1):"."===e?(t.digitType=i._DECIMAL_POINT,t.value=0,t.sign=1):e>="0"&&e<="9"?(t.digitType=i.ASCII,t.value=e.charCodeAt(0)-"0".charCodeAt(0),t.sign=1):"+"===e?(t.digitType=i.PAC,t.value=0,t.sign=1):"-"===e?(t.digitType=i.PAC,t.value=0,t.sign=-1):"@"===e?(t.digitType=i.SQZ,t.value=0,t.sign=1):e>="A"&&e<="I"?(t.digitType=i.SQZ,t.value=e.charCodeAt(0)-"A".charCodeAt(0)+1,t.sign=1):e>="a"&&e<="i"?(t.digitType=i.SQZ,t.value=e.charCodeAt(0)-"a".charCodeAt(0)+1,t.sign=-1):"%"===e?(t.digitType=i.DIF,t.value=0,t.sign=1):e>="J"&&e<="R"?(t.digitType=i.DIF,t.value=e.charCodeAt(0)-"J".charCodeAt(0)+1,t.sign=1):e>="j"&&e<="r"?(t.digitType=i.DIF,t.value=e.charCodeAt(0)-"j".charCodeAt(0)+1,t.sign=-1):e>="S"&&e<="Z"?(t.digitType=i.DUP,t.value=e.charCodeAt(0)-"S".charCodeAt(0)+1,t.sign=1):"s"===e?(t.digitType=i.DUP,t.value=9,t.sign=1):(t.digitType=null,t.value=null),t},_calcAsdfNumber:function(e){for(var t,r=1,n=0,o=1,a=0,s=e.length-1;s>=0;--s){var l=e[s];if(l.digitType===i._DECIMAL_POINT){if(o=r,++a>1)return null}else n+=l.value*r,r*=10,t=l.digitType}return{value:n*=e[0].sign/o,digitType:t}},_pushAsdfNumberToSeq:function(e,t,n){var a={seq:e,lastValueType:t.digitType};if(t.digitType===i._ABNORMAL_VALUE)e.push(r.UNKNOWN_VALUE);else if(t.digitType===i.ASCII||t.digitType===i.PAC||t.digitType===i.SQZ)e.push(t.value);else{if(!e.length)return!1;var s=e[e.length-1];if(t.digitType===i.DIF)e.push(s+t.value);else{if(t.digitType!==i.DUP)return!1;if(n.digitType===i.PAC||n.digitType===i.DUP||!n.digitType)return!1;for(var l=1;l<t.value;++l)a=o._pushAsdfNumberToSeq(e,n,null);n&&(a.lastValueType=n.digitType)}}return a},decodeAsdfLine:function(e){for(var t=[],r=[],n=null,a=function(t,r,i){if(r.length){var n,a=o._calcAsdfNumber(r);return a&&(n=o._pushAsdfNumberToSeq(t,a,i)),a&&n||Kekule.error(Kekule.$L("ErrorMsg.JCAMP_ASDF_FORMAT_ERROR_WITH_STR").format(e)),t.__$lastValueType__=n.lastValueType,a}},s=0,l=e.length;s<l;++s){var u=o.getAsdfDigitInfo(e.charAt(s));u.digitType?u.digitType===i._ABNORMAL_VALUE?(n=a(t,r,n),a(t,[u],null),r=[]):u.digitType===i._DECIMAL_POINT?r.push(u):u.digitType===i.ASCII?r.push(u):(n=a(t,r,n),r=[u]):(n=a(t,r,n),r=[])}return n=a(t,r,n),t},encodeAsdfLine:function(e,t){var r=Kekule.IO.Jcamp.AsdfForm;return t===r.AFFN?o._encodeNumbersToAffnLine(e):t===r.PAC?o._encodeNumbersToPacLine(e):t===r.SQZ?o._encodeNumbersToSqzLine(e,!1):t===r.SQZ_DUP?o._encodeNumbersToSqzLine(e,!0):t===r.DIF?o._encodeNumbersToDifLine(e,!1):(r.DIF_DUP,o._encodeNumbersToDifLine(e,!0))},_encodeNumbersToAffnLine:function(e){for(var t=[],i=0,n=e.length;i<n;++i){var o=e[i],a=Kekule.NumUtils.isNormalNumber(o)?o.toString():r.VALUE_ABNORMAL_NUM;t.push(a)}return t.join(" ")},_encodeNumbersToPacLine:function(e){for(var t=[],i=0,n=e.length;i<n;++i){var o,a=e[i];if(Kekule.NumUtils.isNormalNumber(a))o=(a>=0?"+":"-")+Math.abs(a).toString();else o=r.VALUE_ABNORMAL_NUM;t.push(o)}return t.join("")},_encodeNumbersToSqzLine:function(e,t){return o._numSeqToCompressedFormString(e,"A","a","@",t)},_encodeNumbersToDifLine:function(e,t){var r=[],i={seq:[]};r.push(i);for(var n,a=0,s=e.length;a<s;++a){var l=e[a];n=l,Kekule.NumUtils.isNormalNumber(n)?(Kekule.ObjUtils.isUnset(i.head)?i.head=n:i.seq.push(n-i.last),i.last=n):(Kekule.ObjUtils.isUnset(i.head)?i.head=n:i.seq.push(n),i={seq:[]},r.push(i))}var u=[];for(a=0,s=r.length;a<s;++a){var d=r[a];Kekule.ObjUtils.notUnset(d.head)&&(u.push(o._encodeNumbersToSqzLine([d.head])),d.seq.length&&u.push(o._numSeqToCompressedFormString(d.seq,"J","j","%",t)))}return u.join("")},_numToCompressedFormString:function(e,t,i,n){if(!Kekule.NumUtils.isNormalNumber(e))return r.VALUE_ABNORMAL_NUM;if(0===e)return n;var o=Math.abs(e).toString(),a=Kekule.NumUtils.getHeadingDigit(e);return o=(e>0?String.fromCharCode(t.charCodeAt(0)+(a-1)):String.fromCharCode(i.charCodeAt(0)+(a-1)))+o.substr(1)},_numSeqToCompressedFormString:function(e,t,r,i,n){for(var a,s=[],l=0,u=["S","T","U","V","W","X","Y","Z","s"],d=0,c=e.length;d<c;++d){var h=!1,p=e[d];if(n&&(p===a?(++l,h=!0):l&&(s.push(u[l]),l=0)),!h){var g=o._numToCompressedFormString(p,t,r,i);s.push(g)}a=p}return n&&l&&s.push(u[l]),s.join("")},decodeAsdfTableLines:function(e,t){for(var n,a=t||{},s=[],l=[],u=!1,d=!1,c=e.length,h=function(e,t,r,i,n,o){if(n){var a=e[e.length-1];if(a&&a.length)if(i){var s=a[a.length-1],l=t[1];"number"==typeof s&&Kekule.ObjUtils.notUnset(s)&&"number"==typeof l&&Kekule.ObjUtils.notUnset(l)&&(Kekule.NumUtils.isFloatEqual(s,l)?a.pop():Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_Y_VALUE_CHECK_ERROR")))}else a.pop()}r&&p(t,e[e.length-1],o),e.push(t)},p=function(e,t,r){if(e&&t){var i=(e[0]-t[0])/(t.length-1);if(n){var a=Math.min(Math.abs(i),Math.abs(n))*(r||1)*(Kekule.globalOptions.IO.jcamp.dataValueCheckAllowedErrorRatio||1e-4);0!==o.compareFloat(i,n,a)&&(console.log("X check error",i,n,a),Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_X_VALUE_CHECK_ERROR")))}else n=i}return!0},g=0,f=e.length;g<f;++g){var C=e[g].trim();if(C){var m=C.endsWith(r.TABLE_LINE_CONTI_MARK);m&&(C=C.substr(0,C.length-r.TABLE_LINE_CONTI_MARK.length));var T=o.decodeAsdfLine(C);l=u?l.concat(T):T,(u=m)||(h(s,l,a.doValueCheck,a.doValueCheck&&d,d,c),l=[]),d=T.__$lastValueType__===i.DIF}}return l.length&&h(s,l,a.doValueCheck,a.doValueCheck&&d,d,c),s},encodeAsdfTableLines:function(e,t,r){for(var i=r||{},n=[],a=0,s=e.length;a<s;++a){var l,u=e[a],d="";u.length&&(i.abscissaFirst?(d+=o._encodeNumbersToAffnLine([u[0]])+" ",l=u.slice(1)):l=u,d+=o.encodeAsdfLine(l,t)),n.push(d)}return n},decodeAffnGroupLine:function(e){var t=1,i=2,n=3,o=11,a=12,s=21,l=22,u=30,d=e.trim();d.startsWith(r.GROUPED_VALUE_EXPLICIT_GROUP_LEADING)&&d.endsWith(r.GROUPED_VALUE_EXPLICIT_GROUP_TAILING)&&(d=d.substr(r.GROUPED_VALUE_EXPLICIT_GROUP_LEADING.length,d.length-r.GROUPED_VALUE_EXPLICIT_GROUP_LEADING.length-r.GROUPED_VALUE_EXPLICIT_GROUP_TAILING.length));for(var c={tokenType:null,text:""},h=[],p=[],g=function(e){var r,i,n;return(e||c.text)&&(i=c.text,n=c.tokenType,r=i?n===t?parseFloat(i):i:void 0,p.push(r)),c.tokenType=null,c.text="",r},f=function(){p.length&&h.push(p),p=[]},C=function(e,n,d){return n?e.match(r.GROUPED_VALUE_STR_ENCLOSER_TAILING)?a:i:e>="0"&&e<="9"||"."===e?t:e.match(/\s/)?u:e.match(r.GROUPED_VALUE_STR_ENCLOSER_LEADING)?o:e.match(r.GROUPED_VALUE_STR_ENCLOSER_TAILING)?a:e.match(r.GROUPED_VALUE_GROUP_DELIMITER_PATTERN)?d?s:l:e.match(r.GROUPED_VALUE_ITEM_DELIMITER_PATTERN)?s:i},m=!1,T=0,E=d.length;T<E;++T){var _=d.charAt(T),S=C(_,c.tokenType===n);S===u&&c.tokenType===n&&(c.text+=_,S=c.tokenType),S<o?(m&&c.text&&(g(),f()),c.tokenType?c.tokenType=Math.max(c.tokenType,S):c.tokenType=S,c.text+=_):S<s?S===o?(m&&c.text?(g(),f()):g(),c.tokenType=n):c.tokenType=i:S===s?g(!0):S===l&&(g(!0),f()),m=S===u}return g(),f(),h},encodeAffnGroupLine:function(e,t){for(var i=[],n=0,o=e.length;n<o;++n){var a,s=e[n];a="number"==typeof s?Kekule.NumUtils.isNormalNumber(s)?s.toString():r.VALUE_ABNORMAL_NUM:r.GROUPED_VALUE_STR_ENCLOSER_LEADING+s.toString()+r.GROUPED_VALUE_STR_ENCLOSER_TAILING,i.push(a)}return i.join(r.GROUPED_VALUE_ITEM_DELIMITER)},decodeAffnGroupTableLines:function(e,t){for(var r=[],i=0,n=e.length;i<n;++i){var a=e[i];r=r.concat(o.decodeAffnGroupLine(a))}return r},encodeAffnGroupTableLines:function(e,t){for(var i=[],n=0,a=e.length;n<a;++n){var s=e[n],l=o.encodeAffnGroupLine(s,t);t&&t.explicitlyEnclosed&&(l=r.GROUPED_VALUE_EXPLICIT_GROUP_LEADING+l+r.GROUPED_VALUE_EXPLICIT_GROUP_TAILING),i.push(l)}return i},getDataTableFormatDetails:function(e){if(e.startsWith(r.DATA_FORMAT_GROUP_LEADING)||e.endsWith(r.DATA_FORMAT_GROUP_TAILING)){var t=e.substr(r.DATA_FORMAT_GROUP_LEADING.length,e.length-r.DATA_FORMAT_GROUP_LEADING.length-r.DATA_FORMAT_GROUP_TAILING.length);if(a=(t=t.replace(/\s/g,"")).match(/^([a-zA-Z])\+\+\(([a-zA-Z])\.\.([a-zA-Z])\)$/))return a[2]!==a[3]?Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR",e)):{format:r.DATA_VARLIST_FORMAT_XYDATA,varInc:a[1],varLoop:a[2],vars:[a[1],a[2]]};if(a=t.match(/^([a-zA-Z]+)\s*\.\.\s*([a-zA-Z]+)$/)){if(a[1]!==a[2])return Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR",e));for(var i=[],n=0,o=a[1].length;n<o;++n)a[1].charAt(n).match(/\s/)||i.push(a[1].charAt(n));return i.length<=2?{format:r.DATA_VARLIST_FORMAT_XYPOINTS,vars:i}:{format:r.DATA_VARLIST_FORMAT_XYWPOINTS,vars:i}}var a;if(a=t.match(/^(([a-zA-Z]\,?)+)$/)){for(i=[],n=0,o=a[1].length;n<o;++n)","!==a[1].charAt(n)&&i.push(a[1].charAt(n));return{format:r.DATA_VARLIST_FORMAT_VAR_GROUPS,vars:i}}return Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VAR_LIST_FORMAT_UNSUPPORTED",e))}return Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR",e))},generateDataTableFormatDescriptor:function(e,t){if(e===r.DATA_VARLIST_FORMAT_XYDATA)return(r.DATA_FORMAT_GROUP_LEADING+"{0}++"+r.DATA_FORMAT_GROUP_LEADING+"{1}"+r.DATA_FORMAT_LOOP+"{1}"+r.DATA_FORMAT_GROUP_TAILING+r.DATA_FORMAT_GROUP_TAILING).format(t[0],t[1]);if(e===r.DATA_VARLIST_FORMAT_XYPOINTS||e===r.DATA_VARLIST_FORMAT_XYWPOINTS){for(var i=[],n=0,o=t.length;n<o;++n)i.push("{"+n+"}");var a=i.join(""),s=r.DATA_FORMAT_GROUP_LEADING+a+r.DATA_FORMAT_LOOP+a+r.DATA_FORMAT_GROUP_TAILING;return s.format.apply(s,t)}return e===r.DATA_VARLIST_FORMAT_VAR_GROUPS?r.DATA_FORMAT_GROUP_LEADING+t.join("")+r.DATA_FORMAT_GROUP_TAILING:""},getDataTableFormatAndPlotDetails:function(e){var t=e.indexOf(r.DATA_FORMAT_GROUP_LEADING),i=e.lastIndexOf(r.DATA_FORMAT_GROUP_TAILING);if(t>=0&&i>=0){var n=e.substring(t,i+1),a=o.getDataTableFormatDetails(n),s=e.substr(i+1).trim();return s.indexOf(r.DATA_FORMAT_PLOT_DESCRIPTOR_DELIMITER)>=0&&(s=s.substr(r.DATA_FORMAT_PLOT_DESCRIPTOR_DELIMITER.length),a.plotDescriptor=s),a}Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR",e))},generateDataTableFormatAndPlotDescriptors:function(e,t){var i,n=o.generateDataTableFormatDescriptor(e,t);return e===r.DATA_VARLIST_FORMAT_XYDATA?i="XYDATA":e===r.DATA_VARLIST_FORMAT_XYPOINTS?i="XYPOINTS":e===r.DATA_VARLIST_FORMAT_VAR_GROUPS&&(i=t.length<=2?"PEAK TABLE":"PEAK ASSIGNMENTS"),{format:n,plot:i}},generateDataTableFormatAndPlotString:function(e,t){var i=o.generateDataTableFormatAndPlotDescriptors(e,t);return i.format+r.DATA_FORMAT_PLOT_DESCRIPTOR_DELIMITER+i.plot}};var o=Kekule.IO.Jcamp.Utils;Kekule.IO.Jcamp.BlockUtils={createBlock:function(e){return{blocks:[],ldrs:[],ldrIndexes:{},_parent:e}},setBlockParent:function(e,t){return e._parent=t,e},getLabelIndex:function(e,t){return t.ldrIndexes[e]||-1},getLdrAt:function(e,t){return t.ldrs[e]},addLdrToBlock:function(e,t){e.ldrs.push(t),e.ldrIndexes[t.labelName]=e.ldrs.length-1},getNestedBlockLevelCount:function(e){var t=1,r=e.blocks;if(r&&r.length){for(var i=0,n=0,o=r.length;n<o;++n){var s=a.getNestedBlockLevelCount(r[n]);s>i&&(i=s)}t+=i}return t},getBlockLdr:function(e,t){var r=e.ldrIndexes[t];return r>=0?e.ldrs[r]:null},getBlockMeta:function(e){var i=e.meta;return i||(i={blockType:e.blocks.length?t.BlockType.LINK:t.BlockType.DATA,format:e.ldrIndexes[r.LABEL_DX_VERSION]?t.Format.DX:e.ldrIndexes[r.LABEL_CS_VERSION]?t.Format.CS:null},e.meta=i),i}};var a=Kekule.IO.Jcamp.BlockUtils;Kekule.IO.Jcamp.ValueType={AFFN:1,ASDF:2,AFFN_ASDF:3,MULTILINE_AFFN_ASDF:5,MULTILINE_AFFN_GROUP:6,SIMPLE_AFFN_GROUP:7,STRING_GROUP:8,DATA_TABLE:9,STRING:10,SHORT_DATE:21,SHORT_TIME:22,DATETIME:23,NONE:0};var s=Kekule.IO.Jcamp.ValueType;Kekule.IO.Jcamp.LabelType={GLOBAL:0,SPECIFIC:1,PRIVATE:2};var l=Kekule.IO.Jcamp.LabelType;Kekule.IO.Jcamp.LabelCategory={GLOBAL:"global",META:"meta",PARAMTER:"parameter",CONDITION:"condition",ANNOTATION:"annotation"};var u=Kekule.IO.Jcamp.LabelCategory;Kekule.IO.Jcamp.LabelTypeInfos={_DEFAULT_TYPE:s.STRING},Kekule.IO.Jcamp.LabelTypeInfos.createInfo=function(e,t,i,n,a){var s=o.standardizeLdrLabelName(e),d=a?l.SPECIFIC:l.GLOBAL;i||(i=d),n||(n=i===l.GLOBAL?u.META:u.ANNOTATION),i!==l.SPECIFIC||s.startsWith(r.SPECIFIC_LABEL_PREFIX)?i!==l.PRIVATE||s.startsWith(r.PRIVATE_LABEL_PREFIX)||(s=r.PRIVATE_LABEL_PREFIX+s):s=r.SPECIFIC_LABEL_PREFIX+s;var c={labelName:s,labelType:i,labelCategory:n,dataType:t};return a&&(c.specificType=a),Kekule.IO.Jcamp.LabelTypeInfos[s]=c,c},Kekule.IO.Jcamp.LabelTypeInfos.createInfos=function(e){for(var t=0,r=e.length;t<r;++t){var i=e[t];Kekule.IO.Jcamp.LabelTypeInfos.createInfo.apply(null,i)}},Kekule.IO.Jcamp.LabelTypeInfos.getType=function(e){var t=d[e];return t&&t.dataType||d._DEFAULT_TYPE},Kekule.IO.Jcamp.LabelTypeInfos.getCategory=function(e){var t=d[e];return t&&t.labelCategory||u.ANNOTATION},Kekule.IO.Jcamp.LabelTypeInfos.getInfo=function(e,t){var r=d[e];return r&&t&&r.labelType!==t?null:r};var d=Kekule.IO.Jcamp.LabelTypeInfos;(0,Kekule.IO.Jcamp.LabelTypeInfos.createInfos)([["TITLE",s.STRING,null,u.GLOBAL],["JCAMPDX",s.STRING,null,u.ANNOTATION],["JCAMPCX",s.STRING,null,u.ANNOTATION],["DATA TYPE",s.STRING],["BLOCKS",s.AFFN],["END",s.NONE],["XUNITS",s.STRING],["YUNITS",s.STRING],["XLABEL",s.STRING],["YLABEL",s.STRING],["FIRSTX",s.AFFN],["LASTX",s.AFFN],["FIRSTY",s.AFFN],["MAXX",s.AFFN],["MINX",s.AFFN],["MAXY",s.AFFN],["MINY",s.AFFN],["DELTAX",s.AFFN],["XFACTOR",s.AFFN],["YFACTOR",s.AFFN],["NPOINTS",s.AFFN],["RESOLUTION",s.STRING,null,u.PARAMTER],["XYDATA",s.MULTILINE_AFFN_ASDF],["XYPOINTS",s.MULTILINE_AFFN_GROUP],["PEAK TABLE",s.MULTILINE_AFFN_GROUP],["PEAK ASSIGNMENTS",s.MULTILINE_AFFN_GROUP],["CLASS",s.STRING],["ORIGIN",s.STRING],["OWNER",s.STRING],["DATE",s.SHORT_DATE,null,u.GLOBAL],["TIME",s.SHORT_TIME,null,u.GLOBAL],["LONGDATE",s.DATETIME,null,u.GLOBAL],["SOURCE REFERENCE",s.STRING],["CROSS REFERENCE",s.STRING],["SAMPLE DESCRIPTION",s.STRING],["CAS NAME",s.STRING],["NAMES",s.STRING],["MOLFORM",s.STRING],["CAS REGISTRY NO",s.STRING],["WISWESSER",s.STRING],["BEILSTEIN LAWSON NO",s.STRING],["REFRACTIVE INDEX",s.AFFN],["DENSITY",s.AFFN],["MW",s.AFFN],["MP",s.AFFN],["BP",s.AFFN],["CONCENTRATIONS",s.STRING],["SPECTROMETER/DATA SYSTEM",s.STRING],["INSTRUMENTAL PARAMETERS",s.STRING],["SAMPLING PROCEDURE",s.STRING],["STATE",s.STRING],["PATH LENGTH",s.STRING],["PRESSURE",s.STRING],["TEMPERATURE",s.STRING],["DATA PROCESSING",s.STRING],["RUNITS",s.STRING],["AUNITS",s.STRING],["FIRSTR",s.AFFN],["LASTR",s.AFFN],["FIRSTA",s.AFFN],["MAXA",s.AFFN],["MINA",s.AFFN],["DELTAR",s.AFFN],["RFACTOR",s.AFFN],["AFACTOR",s.AFFN],["ALIAS",s.AFFN],["ZPD",s.AFFN],["RADATA",s.MULTILINE_AFFN_ASDF],["APPLICATION",s.STRING],["DATACLASS",s.STRING],["DICTIONARY",s.STRING],["BLOCKID",s.STRING],["INDEX",s.STRING],["SMILES",s.STRING],["NTUPLES",s.STRING],["VAR_NAME",s.STRING_GROUP],["SYMBOL",s.STRING_GROUP],["VAR_TYPE",s.STRING_GROUP],["VAR_FORM",s.STRING_GROUP],["VAR_DIM",s.SIMPLE_AFFN_GROUP],["UNITS",s.STRING_GROUP],["FIRST",s.SIMPLE_AFFN_GROUP],["LAST",s.SIMPLE_AFFN_GROUP],["MIN",s.SIMPLE_AFFN_GROUP],["MAX",s.SIMPLE_AFFN_GROUP],["FACTOR",s.SIMPLE_AFFN_GROUP],["END NTUPLES",s.STRING],["PAGE",s.STRING],["DATA TABLE",s.DATA_TABLE]]),Kekule.IO.Jcamp.LdrValueParserCoder={_parserFuncs:{byLabelName:{},byDataType:{}},_coderFuncs:{byLabelName:{},byDataType:{}},registerParser:function(e,t,r){e?c._parserFuncs.byLabelName[o.standardizeLdrLabelName(e)]=r:t&&(c._parserFuncs.byDataType[t]=r)},getParserFunc:function(e){var r=t.Utils.standardizeLdrLabelName(e.labelName),i=c._parserFuncs.byLabelName[r];if(!i){var n=d.getType(r);i=c._parserFuncs.byDataType[n]}return i||(i=c._parserFuncs._default),i},registerCoder:function(e,t,r){e?c._coderFuncs.byLabelName[o.standardizeLdrLabelName(e)]=r:t&&(c._coderFuncs.byDataType[t]=r)},getCoderFunc:function(e){var r=t.Utils.standardizeLdrLabelName(e),i=c._coderFuncs.byLabelName[r];if(!i){var n=d.getType(r);i=c._coderFuncs.byDataType[n]}return i||(i=c._coderFuncs._default),i},parseValue:function(e,t){return c.getParserFunc(e)(e.valueLines,t)},encodeValue:function(e,t,r){var i=c.getCoderFunc(e)(t,r);return Kekule.ArrayUtils.toArray(i)},stringParser:function(e,t){return e.join("\n")},stringCoder:function(e,t){return e.toString().split("\n")},affnParser:function(e,t){var r=o.getFirstNonemptyLine(e),i=parseFloat(r);return Kekule.NumUtils.isNormalNumber(i)?i:NaN},affnCoder:function(e,t){return Kekule.NumUtils.isNormalNumber(e)?e.toString():r.VALUE_ABNORMAL_NUM},asdfParser:function(e,t){var r=o.getFirstNonemptyLine(e),i=o.decodeAsdfLine(r);return i&&i[0]},asdfCoder:function(e,t){Kekule.error("not implemented yet")},shortDateParser:function(e,t){var r=o.getFirstNonemptyLine(e).split("/");return{year:parseInt(r[0])||0,month:parseInt(r[1])||0,day:parseInt(r[2])||0}},shortTimeParser:function(e,t){var r=o.getFirstNonemptyLine(e).split(":");return{hour:parseInt(r[0])||0,minute:parseInt(r[1])||0,second:parseInt(r[2])||0}},longDateParser:function(e,t){var r=0,i=0,n=0,a=null,s=null,l=null,u=null,d=o.getFirstNonemptyLine(e).split(/\s+/g),c=/(\d+)\/(\d+)\/(\d+)/,h=(d[0]||"").match(c);h&&(r=parseInt(h[1])||0,i=parseInt(h[2])||0,n=parseInt(h[3])||0);var p=(d[1]||"").trim();return p&&(c=/(\d+)\:(\d+)\:(\d+)(\.(\d+))?/,(h=p.match(c))&&(a=parseInt(h[1]),s=parseInt(h[2]),l=parseInt(h[3]),u=parseInt(h[5])||null)),new Date(r,i-1,n,a,s,l,u)},longDateCoder:function(e,t){var r=e.getFullYear(),i=e.getMonth()+1,n=e.getDate(),o=e.getHours(),a=e.getMinutes(),s=e.getSeconds(),l=e.getMilliseconds(),u=[r.toString().lpad(4,"0"),i.toString().lpad(2,"0"),n.toString().lpad(2,"0")].join("/")+" "+[o.toString().lpad(2,"0"),a.toString().lpad(2,"0"),s.toString().lpad(2,"0")].join(":");return l&&(u+="."+l.toString().lpad(4,"0")),u},stringGroupParser:function(e,t){var i=e.join(" ").trim();i.endsWith(r.SIMPLE_VALUE_DELIMITER)&&(i=i.substr(0,i.length-r.SIMPLE_VALUE_DELIMITER.length));for(var n=i.split(r.SIMPLE_VALUE_DELIMITER),o=0,a=n.length;o<a;++o){n[o]=n[o].trim();var s=n[o];s.startsWith(r.VALUE_STR_EXPLICIT_QUOTE)&&s.endsWith(r.VALUE_STR_EXPLICIT_QUOTE)&&(n[o]=s.substr(r.VALUE_STR_EXPLICIT_QUOTE.length,s.length-2*r.VALUE_STR_EXPLICIT_QUOTE.length))}return n},stringGroupCoder:function(e,i){for(var n=Kekule.ArrayUtils.toArray(e),o=!1,a=0,s=n.length;a<s;++a)if("string"==typeof n[a]){o=!0;break}var l=[],u=t.LdrValueParserCoder.stringCoder;for(a=0,s=n.length;a<s;++a){var d=u(n[a],i);o&&(d=r.VALUE_STR_EXPLICIT_QUOTE+d+r.VALUE_STR_EXPLICIT_QUOTE),l.push(d)}return l.join(r.SIMPLE_VALUE_DELIMITER)},simpleAffnGroupParser:function(e,t){for(var i=e.join(" ").split(r.SIMPLE_VALUE_DELIMITER),n=0,o=i.length;n<o;++n)i[n]=parseFloat(i[n].trim());return i},simpleAffnGroupCoder:function(e,t){return Kekule.ArrayUtils.toArray(e).join(r.SIMPLE_VALUE_DELIMITER)},xyDataTableParser:function(e,r){var i={format:e[0],formatDetail:t.Utils.getDataTableFormatAndPlotDetails(e[0])},n=Kekule.globalOptions.IO.jcamp.enableXYDataValueCheck&&r&&r.doValueCheck&&!!i.formatDetail.varInc,a=Object.extend(r||{},{doValueCheck:n});return i.values=o.decodeAsdfTableLines(e.slice(1),a),i},xyDataTableCoder:function(e,t){var r=[t.dataFormat];return r=r.concat(o.encodeAsdfTableLines(e,t.asdfForm,t))},groupedDataTableParser:function(e,r){return{format:e[0],formatDetail:t.Utils.getDataTableFormatAndPlotDetails(e[0]),values:o.decodeAffnGroupTableLines(e.slice(1),r)}},ntuplesDataTableParser:function(e,r){var i,n=t.Utils.getDataTableFormatAndPlotDetails(e[0]);return n.format===t.Consts.DATA_VARLIST_FORMAT_XYDATA?i=c.xyDataTableParser(e,r):n.format===t.Consts.DATA_VARLIST_FORMAT_XYPOINTS?i=c.groupedDataTableParser(e,r):n.format===t.Consts.DATA_VARLIST_FORMAT_VAR_GROUPS&&(i=c.groupedDataTableParser(e,r)),i},molecularFormulaParser:function(e,r){var i,n=e[0].trim();return n&&Kekule.MolecularFormula&&(n=(n=n.replace(new RegExp(t.Consts.MOL_FORMULA_SUP_PREFIX,"g")," ")).replace(new RegExp(t.Consts.MOL_FORMULA_SUB_PREFIX,"g"),""),i=Kekule.FormulaUtils.textToFormula(n)),i||n},molecularFormulaCoder:function(r,i){if(Kekule.MolecularFormula&&r instanceof Kekule.MolecularFormula){var n=e.clone(r.getSections()),o=function(e){var t="ZZZZZ",r=0,i=e.obj;return i&&(i.getSymbol&&(t=i.getSymbol()),"C"===t?t="0":"H"===t&&(t="1"),i.getMassNumber&&(r=i.getMassNumber()||0)),[t,r]};n.sort(function(t,r){var i=o(t),n=o(r);return e.compare(i,n)});for(var a=[],s=0,l=n.length;s<l;++s){var u=n[s],d=u.obj,c=u.count,h=d.getLabel&&d.getLabel();d.getMassNumber&&d.getMassNumber()&&(h=t.Consts.MOL_FORMULA_SUP_PREFIX+h),c>1&&(h+=c),a.push(h)}return[a.join(" ")]}return[r]}};var c=Kekule.IO.Jcamp.LdrValueParserCoder;c._parserFuncs._default=c.stringParser,c.registerParser(null,s.AFFN,c.affnParser),c.registerParser(null,s.ASDF,c.asdfParser),c.registerParser(null,s.STRING,c.stringParser),c.registerParser(null,s.SHORT_DATE,c.shortDateParser),c.registerParser(null,s.SHORT_TIME,c.shortTimeParser),c.registerParser(null,s.DATETIME,c.longDateParser),c.registerParser(null,s.MULTILINE_AFFN_ASDF,c.xyDataTableParser),c.registerParser(null,s.MULTILINE_AFFN_GROUP,c.groupedDataTableParser),c.registerParser(null,s.DATA_TABLE,c.ntuplesDataTableParser),c.registerParser(null,s.STRING_GROUP,c.stringGroupParser),c.registerParser(null,s.SIMPLE_AFFN_GROUP,c.simpleAffnGroupParser),c.registerParser("MOLFORM",null,c.molecularFormulaParser),c.registerCoder(null,s.AFFN,c.affnCoder),c.registerCoder(null,s.ASDF,c.asdfCoder),c.registerCoder(null,s.STRING,c.stringCoder),c.registerCoder(null,s.DATETIME,c.longDateCoder),c.registerCoder(null,s.STRING_GROUP,c.stringGroupCoder),c.registerCoder(null,s.SIMPLE_AFFN_GROUP,c.simpleAffnGroupCoder),c.registerCoder("MOLFORM",null,c.molecularFormulaCoder),Kekule.IO.Jcamp.BlockReaderManager={_readerClasses:[],_findRegisteredItemIndex:function(e,t,r,i){for(var n=Kekule.ObjUtils.isUnset,o=h._readerClasses,a=o.length-1;a>=0;--a){var s=o[a];if((n(e)||e===s.blockType||i&&"*"===s.blockType)&&(n(t)||t===s.blockFormat||i&&"*"===s.blockFormat)&&(n(r)||r===s.readerClass))return a}return-1},register:function(e,t,r){h._findRegisteredItemIndex(e,t,r)<0&&h._readerClasses.push({blockType:e,blockFormat:t,readerClass:r})},unregister:function(e,t,r){var i=h._findRegisteredItemIndex(e,t,r);i>=0&&h._readerClasses.splice(i,1)},getReaderClass:function(e,t){var r=h._findRegisteredItemIndex(e,t,null,!0);return r>=0?h._readerClasses[r].readerClass:null}},Kekule.IO.Jcamp.BlockWriterManager={_writerClasses:[],_findRegisteredItemIndex:function(e,t){for(var r=Kekule.ObjUtils.isUnset,i=p._writerClasses,n=i.length-1;n>=0;--n){var o=i[n];if((r(e)||ClassEx.isOrIsDescendantOf(e,o.objClass))&&(r(t)||t===o.writerClass))return n}return-1},register:function(e,t){p._findRegisteredItemIndex(e,t)<0&&p._writerClasses.push({objClass:e,writerClass:t})},unregister:function(e,t){var r=p._findRegisteredItemIndex(e,t);r>=0&&p._writerClasses.splice(r,1)},getWriterClass:function(e){var t=DataType.isObjectExValue(e)?e.getClass():e,r=p._findRegisteredItemIndex(t,null);return r>=0?p._writerClasses[r].writerClass:null}};var h=Kekule.IO.Jcamp.BlockReaderManager,p=Kekule.IO.Jcamp.BlockWriterManager;Kekule.IO.Jcamp.BlockReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.Jcamp.BlockReader",initialize:function(e){this.setPropStoreFieldValue("ldrHandlerMap",{}),this.tryApplySuper("initialize",e),this._initLdrHandlers()},initProperties:function(){this.defineProp("ldrHandlerMap",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("blockId",{dataType:DataType.STRING,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currOptions",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("parentReader",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("rootReader",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var e=this.getParentReader();return e?e.getRootReader?e.getRootReader():e:this}})},_initLdrHandlers:function(){var e=this.getLdrHandlerMap();e._default=this._defaultLdrHandler.bind(this),e[r.LABEL_BLOCK_BEGIN]=this.doStoreTitleLdr.bind(this),e[r.LABEL_DX_VERSION]=this.doStoreLdrToChemObjInfoProp.bind(this,r.LABEL_DX_VERSION),e[r.LABEL_CS_VERSION]=this.doStoreLdrToChemObjInfoProp.bind(this,r.LABEL_CS_VERSION),e[r.LABEL_BLOCK_END]=this._ignoreLdrHandler;var t=this.doStoreDateTimeLdr.bind(this);return e.DATE=t,e.TIME=t,e.LONGDATE=t,e[r.LABEL_CROSS_REF]=this.doStoreCrossRefLdr.bind(this),e},_defaultLdrHandler:function(e,t,r,i){return this.saveLdrValueToChemObjInfoProp(e.labelName,c.parseValue(e),r,i)},_ignoreLdrHandler:function(e,t,r,i){},_getBlockMeta:function(e){return a.getBlockMeta(e)},setObjWithBlockId:function(e,t){var r=this.getRootReader();r&&r.setObjWithBlockId&&r.setObjWithBlockId(e,t)},getObjFromBlockId:function(e){var t=this.getRootReader();return t&&t.getObjFromBlockId?t.getObjFromBlockId(e):null},addCrossRef:function(e,t,r){var i=this.getRootReader();i&&i.addCrossRefItem&&i.addCrossRefItem(this,this.getBlockId(),e,t,r)},doCreateChemObjForBlock:function(e){return null},getLdrNamePrefixForInfoField:function(e,t,r){var i="jcamp.";return t===l.SPECIFIC||t===l.PRIVATE&&(i+="custom."),i},getLdrStorageParamsForInfoField:function(e,r){var i=t.Utils.analysisLdrLabelName(e),n=i.labelType,o=this.getLdrNamePrefixForInfoField(e,n,r);return{fullName:o?o+i.coreName:i.coreName,labelType:n,labelCategory:i.labelCategory}},saveLdrValueToChemObjInfoProp:function(e,t,r,i){var n,o=this.getLdrStorageParamsForInfoField(e,r),a=i,s=o.labelCategory;s===u.ANNOTATION?n=r.setAnnotation:s===u.PARAMTER?n=r.setParameter:s===u.CONDITION?n=r.setCondition:s===u.META?n=r.setMeta:s===u.GLOBAL?n=r.setInfoValue:o.labelType===l.PRIVATE&&(n=r.setAnnotation),n||(n=r.setInfoValue),n.apply(r,[a,t])},doStoreTitleLdr:function(e,r,i,n){i.setInfoValue("title",t.LdrValueParserCoder.parseValue(e))},doStoreCrossRefLdr:function(e,r,i,n){var o=t.LdrValueParserCoder.parseValue(e),a=t.Utils.getCrossReferenceDetail(o);a.blockId&&this.addCrossRef(a.blockId,a.refType,a.refTypeText)},doStoreLdrToChemObjInfoProp:function(e,t,r,i,n){var o=c.parseValue(t);this.saveLdrValueToChemObjInfoProp(e,o,i,n)},doStoreDateTimeLdr:function(e,t,r,i){var n,o=e.labelName,s=c.parseValue(e);if("LONGDATE"===o)n=s;else if("DATE"===o){n=new Date(s.year,s.month-1,s.day);var l=a.getBlockLdr(t,"TIME");if(l){var u=c.parseValue(l);n.setHours(u.hour,u.minute,u.second)}}n&&this.saveLdrValueToChemObjInfoProp("date",n,r,"date")},getPendingLdrNames:function(){return[]},getIgnoredLdrNames:function(){return[]},processLdr:function(e,t,r){return this.doProcessLdr(e,t,r)},doProcessLdr:function(e,t,r){var i=t.labelName,n=r&&r.getSpectrumType&&r.getSpectrumType(),a=o.jcampLabelNameToKekule(i,n),s=this.getLdrHandlerMap(),l=s[i]||s._default;l&&l(t,e,r,a)},doBuildCrossRef:function(e,t,r,i){},doReadBlockId:function(e){var i=t.BlockUtils.getBlockLdr(e,r.LABEL_BLOCK_ID);i&&this.setPropStoreFieldValue("blockId",t.LdrValueParserCoder.parseValue(i))},doSetChemObjFromBlock:function(e,t){if(t){for(var r=this.getIgnoredLdrNames()||[],i=this.getPendingLdrNames()||[],n=[],o=0,a=e.ldrs.length;o<a;++o){var s=e.ldrs[o];r.indexOf(s.labelName)>=0||(i.indexOf(s.labelName)>=0?n.push(s):this.processLdr(e,s,t))}for(o=0,a=n.length;o<a;++o){s=n[o];this.processLdr(e,s,t)}}return t},doReadBlock:function(e,t){this.setPropStoreFieldValue("currOptions",t||{});var r=this.doCreateChemObjForBlock(e);return r&&(this.doReadBlockId(e),this.doSetChemObjFromBlock(e,r),this.getBlockId()&&this.setObjWithBlockId(this.getBlockId(),r)),r},doReadData:function(e,t,r,i){return this.doReadBlock(e,i)}}),Kekule.IO.Jcamp.DataBlockReader=Class.create(Kekule.IO.Jcamp.BlockReader,{CLASS_NAME:"Kekule.IO.Jcamp.DataBlockReader"}),Kekule.IO.Jcamp.LinkBlockReader=Class.create(Kekule.IO.Jcamp.BlockReader,{CLASS_NAME:"Kekule.IO.Jcamp.LinkBlockReader",initProperties:function(){this.defineProp("childReaders",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC})},doFinalize:function(){this._finalizeChildReaders(),this.tryApplySuper("doFinalize")},_finalizeChildReaders:function(){var e=this.getChildReaders();if(e)for(var t=0,r=e.length;t<r;++t)e[t].finalize();this.setPropStoreFieldValue("childReaders",[])},_initLdrHandlers:function(){var e=this.tryApplySuper("_initLdrHandlers");e[r.LABEL_DATA_TYPE]=this._ignoreLdrHandler,e[r.LABEL_BLOCK_COUNT]=this._ignoreLdrHandler},doCreateChemObjForBlock:function(e){return this._getBlockMeta(e).blockType===t.BlockType.LINK?new Kekule.ChemObjList:this.tryApplySuper("doCreateChemObjForBlock",[e])},doReadBlock:function(e,t){var r;if(e.blocks.length<=0)return null;r=this.tryApplySuper("doReadBlock",[e,t]),this._finalizeChildReaders();for(var i=[],n=0,o=e.blocks.length;n<o;++n){var a=e.blocks[n],s=this._getBlockMeta(a),l=h.getReaderClass(s.blockType,s.format);if(l){var u=this._createChildReader(l);try{var d=u.doReadData(a,null,null,t);d&&i.push(d)}finally{}}}if(i.length<=1)return r.finalize(),i[0];for(n=0,o=i.length;n<o;++n)r.appendChild(i[n]);return r},_createChildReader:function(e){var t=new e;return t&&(t.setParentReader(this),this.getChildReaders().push(t)),t}}),h.register(t.BlockType.LINK,"*",Kekule.IO.Jcamp.LinkBlockReader),h.register(t.BlockType.DATA,"*",Kekule.IO.Jcamp.DataBlockReader),Kekule.IO.Jcamp.BlockWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.Jcamp.BlockWriter",initialize:function(e){this.setPropStoreFieldValue("ldrCreatorMap",{}),this.tryApplySuper("initialize",e),this._initLdrCreators()},initProperties:function(){this.defineProp("blockId",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("blockDataType",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("ldrCreatorMap",{dataType:DataType.HASH,setter:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("parentWriter",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("rootWriter",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var e=this.getParentWriter();return e?e.getRootWriter?e.getRootWriter():e:this}})},assignBlockIdAndDataType:function(e){var t=this.getRootWriter(),r=t&&t.generateUniqueBlockId();r&&this.setBlockId(r);var i=this.doGetDataTypeForBlock(e);return i&&this.setBlockDataType(i),e&&this.setBlockInfoForObj(e,{id:r,dataType:i}),r},setBlockInfoForObj:function(e,t){var r=this.getRootWriter();r&&r.setBlockInfoForObj(e,t)},getBlockInfoFromObj:function(e){var t=this.getRootWriter();return t&&t.getBlockInfoFromObj(e)},getLdrCreator:function(e){var t=this.getLdrCreatorMap();return t[e]||t._default},_initLdrCreators:function(){this.getLdrCreatorMap()._default=this._defaultLdrCreator.bind(this)},_defaultLdrCreator:function(e,t,r,i){return this.createLdr(e,t,i)},_ignoreLdrCreator:function(e,t,r,i){},doWriteData:function(e,t,r,i){var n=Object.extend({},Kekule.globalOptions.IO.jcamp);return n=Object.extend(n,i||{}),this.doWriteBlock(e,n)},doWriteBlock:function(e,t){var i=a.createBlock();if(i){var n=this.getTitleForBlock(e);this.saveToLdrInBlock(i,e,"",n,r.LABEL_BLOCK_BEGIN),this.doSaveJcampVersionToBlock(e,i,t);var o=this.getDataTypeForBlock(e);o&&this.saveToLdrInBlock(i,e,"",o,r.LABEL_DATA_TYPE),this.getBlockId()&&this.doSaveBlockIdToBlock(e,i,t),this.doSaveChemObjInfoToBlock(e,i,t),this.doSaveChemObjToBlock(e,i,t),this.saveToLdrInBlock(i,e,"","",r.LABEL_BLOCK_END)}return i},getTitleForBlock:function(e){return null},getDataTypeForBlock:function(e){return this.getBlockDataType()||this.doGetDataTypeForBlock(e)},doGetDataTypeForBlock:function(e){return null},doSaveJcampVersionToBlock:function(e,t,r){},doSaveBlockIdToBlock:function(e,t,i){var n=this.getBlockId();n&&this.saveToLdrInBlock(t,e,"",n,r.LABEL_BLOCK_ID)},doSaveChemObjInfoToBlock:function(e,r,i){for(var n=e.getInfoKeys(),o=this.doGetIgnoredChemObjInfoKeys(e,i),a=0,s=n.length;a<s;++a){var l=n[a];if(!(o.indexOf(l)>=0)){var u=e.getInfoValue(l);Kekule.ObjUtils.notUnset(u)&&this.doSaveChemObjInfoItemToBlock(e,l,"info."+l,u,r,i)}}t.BlockUtils.getBlockLdr(r,"LONGDATE")||this.saveToLdrInBlock(r,e,"",new Date,"LONGDATE",!1)},doSaveChemObjInfoItemToBlock:function(e,r,i,n,o,a){var s=this.doGetIgnoredChemObjInfoJcampLabelNames(e,a),l=t.Utils.kekuleLabelNameToJcamp(r,null);s.indexOf(l)<0&&this.saveToLdrInBlock(o,e,i,n,l,!1)},doGetIgnoredChemObjInfoKeys:function(e,t){return["title"]},doGetIgnoredChemObjInfoJcampLabelNames:function(e,r){return[t.Consts.LABEL_BLOCK_BEGIN,t.Consts.LABEL_BLOCK_END,t.Consts.LABEL_DX_VERSION,t.Consts.LABEL_CS_VERSION]},doSaveChemObjToBlock:function(e,t,r){},createLdr:function(e,t,r){return{labelName:r,valueLines:Kekule.ObjUtils.notUnset(t)?this._convToLdrValueLines(r,t):[]}},createLdrRaw:function(t,r){return{labelName:t,valueLines:e.toArray(r)}},saveToLdrInBlock:function(e,t,r,i,n,o){var a=this.getLdrCreator(r),s=a&&a(r,i,e,n);s&&this.setLdrInBlock(e,s,o)},setLdrInBlock:function(e,r,i){if(r){var n=r.labelName,o=t.BlockUtils.getLabelIndex(n,e);if(o>=0&&i)t.BlockUtils.getLdrAt(o,e).valueLines=r.valueLines;else t.BlockUtils.addLdrToBlock(e,r)}},_convJsValueToBasicType:function(e){return e instanceof Kekule.Scalar?e.getValue():e},_convToLdrValueLines:function(e,t){return c.encodeValue(e,this._convJsValueToBasicType(t))}}),Kekule.IO.Jcamp.LinkBlockWriter=Class.create(Kekule.IO.Jcamp.BlockWriter,{CLASS_NAME:"Kekule.IO.Jcamp.LinkBlockWriter",initProperties:function(){this.defineProp("childObjWriterClassMap",{dataType:DataType.OBJECT,setter:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("targetChildObjs",{dataType:DataType.ARRAY,setter:!1,scope:Class.PropertyScope.PRIVATE})},doWriteData:function(e,t,r,i){var n=this.doCreateChildObjWriterClassMap(e);return n.children.length>0?(this.setPropStoreFieldValue("childObjWriterClassMap",n.map),this.setPropStoreFieldValue("targetChildObjs",n.children),this.tryApplySuper("doWriteData",[e,t,r,i])):null},getTitleForBlock:function(e){return e.getInfoValue("title")||e.getId()},doSaveJcampVersionToBlock:function(e,r,i){this.saveToLdrInBlock(r,e,"",i.outputDxVersion,t.Consts.LABEL_DX_VERSION)},doGetDataTypeForBlock:function(e){return"LINK"},doSaveChemObjToBlock:function(e,r,i){var n=this.getTargetChildObjs();if(n.length){var o=new Kekule.MapEx;try{for(var a=0,s=n.length;a<s;++a){if(d=n[a]){var l=this.getChildObjWriterClassMap().get(d);if(l)(c=this._createChildWriter(l)).assignBlockIdAndDataType(d),o.set(d,c)}}var u=n;for(a=0,s=u.length;a<s;++a){var d=u[a],c=o.get(d);try{var h=c.writeData(d,null,null,i);h&&this.doAppendChildBlock(r,h,i)}finally{c.finalize()}}}finally{o.finalize()}}this.saveToLdrInBlock(r,e,"",r.blocks.length,t.Consts.LABEL_BLOCK_COUNT,!0)},doCreateChildObjWriterClassMap:function(e){var t=this,r={map:new Kekule.MapEx,children:null},i=[],n=[],o=function(e){if(e.getChildCount&&e.getChildAt)for(var a=0,s=e.getChildCount();a<s;++a){var l=e.getChildAt(a);if(l){var u=t.doGetChildWriterClass(l);u&&(u===t.getClass()?o(l):(r.map.set(l,u),l instanceof Kekule.Spectroscopy.Spectrum?i.push(l):n.push(l)))}}};return o(e),r.children=n.concat(i),r},doGetChildWriterClass:function(e){return t.BlockWriterManager.getWriterClass(e)||null},_createChildWriter:function(e){var t=new e;return t.setParentWriter(this),t},doAppendChildBlock:function(e,t,r){t&&e.blocks.push(t)}}),t.BlockWriterManager.register(Kekule.ChemObjList,Kekule.IO.Jcamp.LinkBlockWriter),t.BlockWriterManager.register(Kekule.ChemSpace,Kekule.IO.Jcamp.LinkBlockWriter)}(),function(){"use strict";Kekule.IO.Jcamp.Labels.addMaps([["JCAMPCS","JcampCsVersion"],["JCAMPDX","JcampDxVersion"],["TITLE","Title"],["DATATYPE","DataType"],["DATACLASS","DataClass"],["XUNITS","XUnits"],["YUNITS","YUnits"],["XFACTOR","XFactor"],["YFACTOR","YFactor"],["FIRSTX","FirstX"],["LASTX","LastX"],["FIRSTY","FirstY"],["MAXX","MaxX"],["MINX","MinX"],["MAXY","MaxY"],["MINY","MinY"],["DELTAX","DeltaX"],["NPOINTS","NPoints"],["XYDATA","XYData"],["XYPOINTS","XYPoints"],["PEAKASSIGNMENTS","PeakAssignments"],["PEAKTABLE","PeakTable"],["CLASS","Class"],["ORIGIN","Origin"],["OWNER","Owner"],["DATE","Date"],["TIME","Time"],["LONGDATE","LongDate"],["SOURCEREFERENCE","SourceReference"],["CROSSREFERENCE","CrossReference"],["SAMPLEDESCRIPTION","SampleDescription"],["CASNAME","CASName"],["NAMES","Names"],["MOLFORM","MolForm"],["IUPACNAME","IUPACName"],["CASREGISTRYNO","CASRegistryNo"],["WISWESSER","Wiswesser"],["BEILSTEINLAWSONNO","BeilsteinLawsonNo"],["BP","BP"],["MP","MP"],["PRESSURE","Pressure"],["TEMPERATURE","Temperature"],["STATE","State"],["REFRACTIVEINDEX","RefractiveIndex"],["DENSITY","Density"],["MW","MW"],["CONCENTRATIONS","Concentrations"],["SOLVENTNAME","SolventName"],["SPECTROMETERDATASYSTEM","SpectrometerDataSystem"],["INSTRUMENTALPARAMETERS","InstrumentalParameters"],["INSTRUMENTPARAMETERS","InstrumentParameters"],["SAMPLINGPROCEDURE","SamplingProcedure"],["RESOLUTION","Resolution"],["PATHLENGTH","PathLength"],["DATAPROCESSING","DataProcessing"],["XLABEL","XLabel"],["YLABEL","YLabel"],["AUDITTRAIL","AuditTrail"],["COMMENTS","Comments"],["END","END"],["BLOCKS","BLOCKS"],["BLOCKID","BLOCKID"],["NTUPLES","NTUPLES"],["ENDNTUPLES","ENDNTUPLES"],["PAGE","PAGE"],["DATATABLE","DataTable"],["VARDIM","VARDIM"],["VARFORM","VARFORM"],["VARNAME","VARNAME"],["VARTYPE","VARTYPE"],["FACTOR","Factor"],["FIRST","First"],["LAST","Last"],["MAX","Max"],["MIN","Min"],["SYMBOL","Symbol"],["UNITS","Units"],[".METHOD","EMR.Method"],[".DETECTIONMODE","EMR.DetectionMode"],[".DETECTIONMETHOD","EMR.DetectionMethod"],[".MICROWAVEFREQUENCY1","EMR.MicrowaveFrequency1"],[".MICROWAVEPOWER1","EMR.MicrowavePower1"],[".MICROWAVEPHASE1","EMR.MicrowavePhase1"],[".MICROWAVEFREQUENCY2","EMR.MicrowaveFrequency2"],[".MICROWAVEPOWER2","EMR.MicrowavePower2"],[".MICROWAVEPHASE2","EMR.MicrowavePhase2"],[".MODULATIONUNIT","EMR.ModulationUnit"],[".MODULATIONAMPLITUDE","EMR.ModulationAmplitude"],[".MODULATIONFREQUENCY","EMR.ModulationFrequency"],[".RECEIVERGAIN","EMR.ReceiverGain"],[".RECEIVERHARMONIC","EMR.ReceiverHarmonic"],[".DETECTIONPHASE","EMR.DetectionPhase"],[".SCANTIME","EMR.ScanTime"],[".NUMBEROFSCANS","EMR.NumberofScans"],[".GONIOMETERANGLE","EMR.GoniometerAngle"],[".STATICFIELD","EMR.StaticField"],[".SCANNEDRFPOWER","EMR.ScannedRFPower"],[".PUMPEDRFFREQUENCY1","EMR.PumpedRFFrequency1"],[".PUMPEDRFPOWER1","EMR.PumpedRFPower1"],[".PUMPEDRFFREQUENCY2","EMR.PumpedRFFrequency2"],[".PUMPEDRFPOWER2","EMR.PumpedRFPower2"],[".GRADIENTTHETA","EMR.GradientTheta"],[".GRADIENTPHI","EMR.GradientPhi"],[".GRADIENTSTRENGTHINTHETAPHIDIRECTION","EMR.GradientStrengthinThetaPhiDirection"],[".GRADIENTSTRENGTHX","EMR.GradientStrengthX"],[".GRADIENTSTRENGTHY","EMR.GradientStrengthY"],[".GRADIENTSTRENGTHZ","EMR.GradientStrengthZ"],[".SIMULATIONSOURCE","EMR.SimulationSource"],[".SIMULATIONPARAMETERS","EMR.SimulationParameters"],[".RESONATOR","EMR.Resonator"],[".TIMECONSTANT","EMR.TimeConstant"],[".CALIBRATIONSTANDARD","EMR.CalibrationStandard"],[".XOFFSET","EMR.X_Offset"],[".AVERAGES","IMS.Averages"],[".CARRIERGAS","IMS.CarrierGas"],[".CARRIERGASFLOW","IMS.CarrierGasFlow"],[".CARRIERGASMOISTURE","IMS.CarrierGasMoisture"],[".DRIFTCHAMBER","IMS.DriftChamber"],[".DRIFTGAS","IMS.DriftGas"],[".DRIFTGASFLOW","IMS.DriftGasFlow"],[".ELECTRICFIELD","IMS.ElectricField"],[".IONIZATIONCHAMBER","IMS.IonizationChamber"],[".IONIZATIONENERGY","IMS.IonizationEnergy"],[".IONIZATIONMODE","IMS.IonizationMode"],[".IONIZATIONSOURCE","IMS.IonizationSource"],[".IONPOLARITY","IMS.IonPolarity"],[".PRESSURE","IMS.Pressure"],[".TEMPERATURE","IMS.Temperature"],[".REDUCEDMOBILITY","IMS.ReducedMobility"],[".REPETITIONRATE","IMS.RepititionRate"],[".SHUTTERGRIDPOTENTIAL","IMS.ShutterGridPotential"],[".SHUTTEROPENINGTIME","IMS.ShutterOpeningTime"],[".ACCELERATINGVOLTAGE","MS.AcceleratingVoltage"],[".BASEPEAK","MS.Basepeak"],[".BASEPEAKINTENSITY","MS.BasepeakIntensity"],[".MONOISOTOPICMASS","MS.MonoisotopicMass"],[".NOMINALMASS","MS.NominalMass"],[".RETENTIONTIME","MS.RetentionTime"],[".RIC","MS.RIC"],[".SCANNUMBER","MS.ScanNumber"],[".SCANRATE","MS.ScanRate"],[".SOURCETEMPERATURE","MS.SourceTemperature"],[".SPECTROMETERTYPE","MS.SpectrometerType"],[".TOTALIONCURRENT","MS.TotalIonCurrent"],[".DETECTOR","MS.Detector"],[".INLET","MS.Inlet"],[".INLETTEMPERATURE","MS.InletTemperature"],[".IONIZATIONENERGY","MS.IonizationEnergy"],[".IONIZATIONMODE","MS.IonizationMode"],[".ACQUISITIONMODE","NMR.AcquisitionMode"],[".ACQUISITIONRANGE","NMR.AcquisitionRange"],[".ACQUISITIONTIME","NMR.AcquisitionTime"],[".AVERAGES","NMR.Averages"],[".COUPLINGCONSTANTS","NMR.CouplingConstants"],[".DECOUPLER","NMR.Decoupler"],[".DELAY","NMR.Delay"],[".DIGITISERRES","NMR.DigitiserRes"],[".FIELD","NMR.Field"],[".FILTERWIDTH","NMR.FilterWidth"],[".MASFREQUENCY","NMR.MASFrequency"],[".MAXINTENSITY","NMR.MaxIntensity"],[".MININTENSITY","NMR.MinIntensity"],[".OBSERVE90","NMR.Observe90"],[".OBSERVEFREQUENCY","NMR.ObserveFrequency"],[".OBSERVENUCLEUS","NMR.ObserveNucleus"],[".PHASE0","NMR.Phase0"],[".PHASE1","NMR.Phase1"],[".PULSESEQUENCE","NMR.PulseSequence"],[".RELAXATIONTIMES","NMR.RelaxationTimes"],[".SHIFTREFERENCE","NMR.ShiftReference"],[".SOLVENTREFERENCE","NMR.SolventReference"],[".SPINNINGRATE","NMR.SpinningRate"],[".ZEROFILL","NMR.ZeroFill"],["AFACTOR","AFactor"],["ALIAS","Alias"],["AUNITS","AUnits"],["FIRSTA","FirstA"],["MAXA","MaxA"],["MINA","MinA"],["DELTAR","DeltaR"],["FIRSTR","FirstR"],["LASTR","LastR"],["RADATA","RAData"],["RFACTOR","RFactor"],["RUNITS","RUnits"],["ZPD","ZPD"],["ATOMLIST","AtomList"],["BONDLIST","BondList"],["CHARGE","Charge"],["MAXRASTER","MaxRaster"],["MAXXYZ","MaxXYZ"],["RADICAL","Radical"],["STEREOCENTER","Stereocenter"],["STEREOMOLECULE","Stereomolecule"],["STEREOPAIR","Stereopair"],["XYRASTER","XYRaster"],["XYZ","XYZ"],["XYZFACTOR","XYZFactor"],["XYZSOURCE","XYZSource"]])}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.IO.Jcamp,r=Kekule.Spectroscopy,i=Kekule.Unit,n=Kekule.Spectroscopy.SpectrumType;Kekule.IO.Jcamp.SpectrumDataStorageStyle={CLASSIC:1,NTUPLE:2,SMART:0},Kekule.globalOptions.add("IO.jcamp",{outputDxVersion:"5.00",dxDataStorageStyle:Kekule.IO.Jcamp.SpectrumDataStorageStyle.SMART,dxDataAllowedLoadingErrorRatio:.001,dxDataAllowedSavingErrorRatio:1e-4,dxDataPreferredOrdinateScaledRange:{min:-32767,max:32767},dxDataAsdfTableOutputForm:t.AsdfForm.DIF_DUP,useDxMinMaxValueAsDisplayRange:!1,disablePeakAssignmentReading:!1,disablePeakAssignmentWriting:!1,autoHiddenSpectrumRefMolecule:!0}),Kekule.IO.Jcamp.DxConsts={CANDIDATE_INDEPENDENT_VAR_SYMBOLS:["X","R","U","V","K","P"],CANDIDATE_DEPENDENT_VAR_SYMBOLS:["Y","Z","A","B","C","D"]},Kekule.IO.Jcamp.DxUtils={_spectrumTypeMap:[["INFRARED",n.IR],["NMR",n.NMR],["MASS",n.MS],["ION MOBILITY",n.IMS],["IMS",n.IMS],["RAMAN",n.RAMAN],["UV",n.UV_VIS],["VIS",n.UV_VIS],["",n.GENERAL]],_dxUnitToMetricsObjMap:{"ARBITARY UNITS":i.Arbitrary.ARBITRARY,"ARBITARY UNIT":i.Arbitrary.ARBITRARY,SECONDS:i.Time.SECOND,SECOND:i.Time.SECOND,MILLISECONDS:i.Time.MILLISECOND,MICROSECONDS:i.Time.MICROSECOND,NANOSECONDS:i.Time.NANOSECOND,PPM:i.Dimensionless.PARTS_PER_MILLION,HZ:i.Frequency.HERTZ,"1/CM":i.WaveNumber.RECIPROCAL_CENTIMETER,MICROMETERS:i.Length.MICROMETER,NANOMETERS:i.Length.NANOMETER,TRANSMITTANCE:i.OpticalTransmittance.TRANSMITTANCE_PERCENT,REFLECTANCE:i.OpticalReflectance.REFLECTANCE,ABSORBANCE:i.OpticalAbsorbance.ABSORBANCE,"KUBELKA-MUNK":i.OpticalKubelkaMunk.KUBELKA_MUNK,"CHANNEL NUMBER":null,COUNTS:i.Misc.MS_COUNT,COUNT:i.Misc.MS_COUNT,"M/Z":i.SpectrumMS.MS_MASS_CHARGE_RATIO,"RELATIVE ABUNDANCE ":i.SpectrumMS.MS_RELATIVE_ABUNDANCE,MICROAMPERES:i.ElectricCurrent.MICROAMPERE,NANOAMPERES:i.ElectricCurrent.NANOAMPERE,PICOAMPERES:i.ElectricCurrent.PICOAMPERE},jcampSpectrumTypeToKekule:function(e){for(var r,i=t.DxUtils._spectrumTypeMap,n=(e||"").toUpperCase(),o=0,a=i.length;o<a;++o)if(n.indexOf(i[o][0])>=0){r=i[o][1];break}return r||(r=n),r},kekuleSpectrumTypeToJcampCoreName:function(e){for(var r,i=t.DxUtils._spectrumTypeMap,n=0,o=i.length;n<o;++n)if(e===i[n][1]){r=i[n][0];break}return r||(r=jType),r},dxUnitToMetricsUnitSymbol:function(e){if(!e)return"";var r=t.DxUtils._dxUnitToMetricsObjMap[e],i=r&&r.symbol;return i||(i=e.toLowerCase().upperFirst()),i},mertricsUnitSymbolToDxUnit:function(e){if(!e)return"";for(var r=t.DxUtils._dxUnitToMetricsObjMap,i=Kekule.ObjUtils.getOwnedFieldNames(r),n=0,o=i.length;n<o;++n){var a=i[n],s=r[a];if(s&&s.symbol===e)return a}return e.toUpperCase()},calcNumFactorForRange:function(e,r,i,n,o){return t.Utils.calcNumFactorForRange(e,r,i,n,o)}},Kekule.IO.Jcamp.LabelTypeInfos.createInfos([["SPECTROMETER TYPE",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.MS],["INLET",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.MS],["IONIZATION MODE",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.MS],["OBSERVE FREQUENCY",t.ValueType.AFFN,null,t.LabelCategory.PARAMTER,r.SpectrumType.NMR],["OBSERVE NUCLEUS",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.NMR],["SOLVENT REFERENCE",t.ValueType.AFFN,null,t.LabelCategory.PARAMTER,r.SpectrumType.NMR],["DELAY",t.ValueType.SIMPLE_AFFN_GROUP,null,t.LabelCategory.PARAMTER,r.SpectrumType.NMR],["ACQUISITION MODE",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.NMR],["IMS PRESSURE",t.ValueType.AFFN,null,t.LabelCategory.PARAMTER,r.SpectrumType.IMS],["CARRIER GAS",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.IMS],["DRIFT GAS",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.IMS],["ELECTRIC FIELD",t.ValueType.SIMPLE_AFFN_GROUP,null,t.LabelCategory.PARAMTER,r.SpectrumType.IMS],["ION POLARITY",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.IMS],["IONIZATION MODE",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.IMS],["IMS TEMPERATURE",t.ValueType.SIMPLE_AFFN_GROUP,null,t.LabelCategory.PARAMTER,r.SpectrumType.IMS],["SHUTTER OPENING TIME",t.ValueType.AFFN,null,t.LabelCategory.PARAMTER,r.SpectrumType.IMS],["MASS ANALYSER",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.CHROMATOGRAPHY],["TANDEM SCANNING METHOD",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.CHROMATOGRAPHY],["INTERFACE",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.CHROMATOGRAPHY],["CHROMATOGRAPHY TYPE",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.CHROMATOGRAPHY],["CHROMATOGRAPHY SOLVENTS",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.CHROMATOGRAPHY],["ADDITIVES",t.ValueType.STRING,null,t.LabelCategory.PARAMTER,r.SpectrumType.CHROMATOGRAPHY],["DIMENSIONALITY",t.ValueType.AFFN,null,t.LabelCategory.PARAMTER,r.SpectrumType.CHROMATOGRAPHY]]),Kekule.IO.Jcamp.DxDataBlockReader=Class.create(Kekule.IO.Jcamp.DataBlockReader,{CLASS_NAME:"Kekule.IO.Jcamp.DxDataBlockReader",initProperties:function(){this.defineProp("currDataClass",{dataType:DataType.STRING,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currVarInfos",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currNTuplesInfos",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currNTuplesVarInfos",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE,getter:function(){var e=this.getCurrNTuplesInfos();return e&&e.varInfos}}),this.defineProp("currNTuplesVarRawInfos",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE,getter:function(){var e=this.getCurrNTuplesInfos();return e&&e.varRawInfos}}),this.defineProp("dataSectionsWithPeakAssignments",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},initPropValues:function(){this.tryApplySuper("initPropValues"),this._initCurrVarInfos()},_initCurrVarInfos:function(){this.setPropStoreFieldValue("currVarInfos",{}),this.setPropStoreFieldValue("currNTuplesVarInfos",{})},_initLdrHandlers:function(){var e=this.tryApplySuper("_initLdrHandlers");e[t.Consts.LABEL_BLOCK_BEGIN]=this.doStoreSpectrumTitleLdr.bind(this),e.DATATYPE=this.doStoreSpectrumDataTypeLdr.bind(this,"DATATYPE"),e.DATACLASS=this.doStoreSpectrumDataClassLdr.bind(this);for(var r=this.doStoreSpectrumDataLdr.bind(this),i=this._getDataTableLdrNames(),n=0,o=i.length;n<o;++n)e[i[n]]=r;var a=this._getDataTableVarDefLdrNames(),s=this.doStoreDataVarInfoLdr.bind(this);for(n=0,o=a.length;n<o;++n)e[a[n]]=s;var l=this._getNTuplesDefinitionLdrNames(),u=this.doStoreNTuplesAttributeLdr.bind(this);for(n=0,o=l.length;n<o;++n)e[l[n]]=u;e.DATATABLE=this.doStoreNTuplesDataLdr.bind(this);for(var d=this._getSpectrumParamLdrNames(),c=Kekule.ObjUtils.getOwnedFieldNames(d),h=(n=0,c.length);n<h;++n)for(var p=c[n],g=this.doStoreSpectrumParamLdr.bind(this,p),f=d[p],C=0,m=f.length;C<m;++C)e[f[C]]=g;return e},_getDataTableVarDefLdrNames:function(){return["XUNITS","FIRSTX","LASTX","MAXX","MINX","XFACTOR","YUNITS","MAXY","MINY","FIRSTY","LASTY","YFACTOR","NPOINTS","DELTAX","XLABEL","YLABEL","RUNITS","AUNITS","FIRSTR","LASTR","DELTAR","MAXA","MINA","RFACTOR","AFACTOR","FIRSTA","ALIAS","ZPD"]},_getNTuplesDefinitionLdrNames:function(){return["NTUPLES","VARNAME","SYMBOL","VARTYPE","VARFORM","VARDIM","UNITS","FIRST","LAST","MIN","MAX","FACTOR","PAGE","POINTS","ENDNTUPLES"]},_getDataTableLdrNames:function(){return["XYDATA","XYPOINTS","PEAKTABLE","PEAKASSIGNMENTS","ASSIGNMENTS","RADATA"]},_isDataTableLabelName:function(e){return this._getDataTableLdrNames().indexOf(e)>=0},_getSpectrumParamLdrNames:function(){return{ir:["RESOLUTION"],uv_vis:["RESOLUTION"],nmr:[".OBSERVEFREQUENCY",".OBSERVENUCLEUS",".SOLVENTREFERENCE",".DELAY",".ACQUISITIONMODE"],ms:[".SPECTROMETERTYPE",".INLET",".IONIZATIONMODE"],ims:[".IMSPRESSURE",".CARRIERGAS",".DRIFTGAS",".ELECTRICFIELD",".IONPOLARITY",".IONIZATIONMODE",".IMSTEMPERATURE",".SHUTTEROPENINGTIME"],chromatography:[".MASSANALYSER",".TANDEMSCANNINGMETHOD",".INTERFACE",".CHROMATOGRAPHYTYPE",".CHROMATOGRAPHYSOLVENTS",".ADDITIVES",".DIMENSIONALITY"]}},getLdrNamePrefixForInfoField:function(e,r,i){var n=this.tryApplySuper("getLdrNamePrefixForInfoField",[e,r,i]);if(r===t.LabelType.SPECIFIC){var o=i.getSpectrumType();o&&(n+=o+".")}return n},getPendingLdrNames:function(){return this.tryApplySuper("getPendingLdrNames").concat(["RESOLUTION"])},doStoreSpectrumTitleLdr:function(e,r,i,n){i.setTitle(t.LdrValueParserCoder.parseValue(e))},doStoreDataVarInfoLdr:function(e,r,i,n){this.getCurrVarInfos()[e.labelName]=t.LdrValueParserCoder.parseValue(e)},doStoreNTuplesAttributeLdr:function(e,r,i,n){var o=this.getCurrNTuplesInfos(),a=t.LdrValueParserCoder.parseValue(e);"ENDNTUPLES"===e.labelName?(a!==o.name&&Kekule.error(Kekule.$L("ErrorMsg.JCAMP_NTUPLES_BEGIN_END_NAME_NOT_MATCH",o.value,a)),this.setPropStoreFieldValue("currNTuplesInfos",null)):"NTUPLES"===e.labelName?this.setPropStoreFieldValue("currNTuplesInfos",{name:a,varRawInfos:{}}):"PAGE"===e.labelName?this._doStoreNTuplesPageAttributeLdr(e):o.varRawInfos[e.labelName]=a},_doStoreNTuplesPageAttributeLdr:function(e){var t=this.getCurrNTuplesInfos(),r=e.valueLines.join(""),i=r.split("=");if(2!==i.length)Kekule.error(Kekule.$L("ErrorMsg.JCAMP_NTUPLES_PAGE_DECLARATION_FORMAT_ERROR",r));else{var n=i[0].trim(),o=i[1].trim();t[e.labelName]={varSymbol:n,sValue:o}}},doStoreSpectrumDataTypeLdr:function(e,r,i,n,o){var a=t.LdrValueParserCoder.parseValue(r);if(a&&a.toUpperCase){var s=t.DxUtils.jcampSpectrumTypeToKekule(a);n.setSpectrumType(s)}},doStoreSpectrumDataClassLdr:function(e,r,i,n){var o=t.LdrValueParserCoder.parseValue(e);this.setPropStoreFieldValue("currDataClass",o)},doStoreSpectrumDataLdr:function(e,r,i,n){if(!this._isSpectrumDataLdr(e,r,i))return this.doStoreLdrToChemObjInfoProp(e.labelName,e,r,i);if(this._isDataTableLabelName(e.labelName)){var o=t.LdrValueParserCoder.parseValue(e,{doValueCheck:!0}),a=o.formatDetail,s=a.vars,l=this._retrieveSpectrumDataVarInfos(s,r,i);l[0].dependency=Kekule.VarDependency.INDEPENDENT;for(var u=1,d=l.length;u<d;++u)l[u].dependency=Kekule.VarDependency.DEPENDENT;var c=this._createSpectrumVariableDefinitions(l),h=i.getData();h.setVariables(c);var p=e.labelName.indexOf("PEAK")<0&&e.labelName.indexOf("ASSIGNMENT")<0,g=e.labelName.indexOf("ASSIGNMENT")>=0;h.setMode(p?Kekule.Spectroscopy.DataMode.CONTINUOUS:Kekule.Spectroscopy.DataMode.PEAK);this._createSpectrumDataSectionByFormat(a,o.values,l,h,g,this.getCurrOptions())}},_retrieveSpectrumDataVarInfos:function(e,t,r){var i=[];i._symbols=[],i._bySymbol={};for(var n=this.getCurrVarInfos(),o=function(e){return n[e]},a=0,s=e.length;a<s;++a){var l=e[a],u={symbol:l,units:o(l+"UNITS"),firstValue:o("FIRST"+l),lastValue:o("LAST"+l),maxValue:o("MAX"+l),minValue:o("MIN"+l),factor:o(l+"FACTOR")};u.units||2!==a||"W"!==l||(u.units=o("XUNITS")),i.push(u),i._symbols.push(l),i._bySymbol[l]=i[i.length-1]}return i},_createSpectrumVariableDefinitions:function(e){for(var r=[],i=this.getCurrOptions(),n=0,o=e.length;n<o;++n){var a=e[n],s=a.varType;if(s)if("DEPENDENT"===s)a.dependency=Kekule.VarDependency.DEPENDENT;else if("INDEPENDENT"===s)a.dependency=Kekule.VarDependency.INDEPENDENT;else if("PAGE"===s)continue;var l=new Kekule.Spectroscopy.SpectrumVarDefinition({name:(a.name||"").toLowerCase(),symbol:a.symbol,unit:t.DxUtils.dxUnitToMetricsUnitSymbol(a.units),dependency:Kekule.ObjUtils.notUnset(a.dependency)?a.dependency:Kekule.VarDependency.DEPENDENT});Kekule.ObjUtils.notUnset(a.minValue)&&Kekule.ObjUtils.notUnset(a.maxValue)&&i.useDxMinMaxValueAsDisplayRange&&a.minValue!==a.maxValue&&l.setInfoValue("displayRange",{min:a.minValue,max:a.maxValue}),r.push(l)}return r},doStoreNTuplesDataLdr:function(e,r,i){var n=this.getCurrNTuplesInfos(),o=this.getCurrNTuplesVarInfos();if(o||(o=this._retrieveNTupleVariableInfos(),n.varInfos=o),!(a=n.spectrumData)){var a,s=this._createSpectrumVariableDefinitions(o);(a=i.getData()).setVariables(s),n.spectrumData=a}var l=t.LdrValueParserCoder.parseValue(e,{doValueCheck:!0}),u=l.formatDetail,d=u.plotDescriptor||"",c=(u.vars,d.indexOf("PEAK")<0&&d.indexOf("ASSIGNMENT")<0),h=d.indexOf("ASSIGNMENT")>=0,p=c?Kekule.Spectroscopy.DataMode.CONTINUOUS:Kekule.Spectroscopy.DataMode.PEAK,g=this._createSpectrumDataSectionByFormat(u,l.values,o,a,h,this.getCurrOptions());g.setMode(p);var f=n.PAGE;g.setName(f.varSymbol+": "+f.sValue)},_retrieveNTupleVariableInfos:function(){var r=[];r._bySymbol={},r._symbols=[];var i=this.getCurrNTuplesVarRawInfos(),n=function(n,o,a){for(var s=t.Utils.standardizeLdrLabelName(n),l=e.toArray(i[s]),u=0,d=l.length;u<d;++u)a[u]||(a[u]={}),a[u][o]=l[u],"SYMBOL"===n&&(r._symbols[u]=l[u]);return a};n("VAR_NAME","name",r),n("SYMBOL","symbol",r),n("VAR_TYPE","varType",r),n("VAR_FORM","varForm",r),n("VAR_DIM","varDim",r),n("UNITS","units",r),n("FIRST","firstValue",r),n("LAST","lastValue",r),n("MIN","minValue",r),n("MAX","maxValue",r),n("FACTOR","factor",r);for(var o=0,a=r.length;o<a;++o)r[o].symbol&&(r._bySymbol[r[o].symbol]=r[o]);return r},doStoreSpectrumParamLdr:function(e,i,n,o,a){var s=e.toUpperCase();if(!o.getSpectrumType()||o.getSpectrumType()===s){var l=i.labelName,u=t.LdrValueParserCoder.parseValue(i),d=function(e){o.setParameter(a,e)};if(s===r.SpectrumType.IR||s===r.SpectrumType.UV_VIS){if("RESOLUTION"===l){if(u.indexOf(t.Consts.SIMPLE_VALUE_DELIMITER)<0){var c;u=parseFloat(u)||u;for(var h=0,p=o.getVariableCount();h<p;++h){var g=o.getVariable(h);if(g.isIndependent()){var f=g.getUnit();if((f&&Kekule.Unit.getUnit(f)).category===Kekule.Unit.Length){c=f;break}}}c&&(u=Kekule.Scalar.create(u,c))}d(u)}}else if(s===r.SpectrumType.NMR){if(".OBSERVENUCLEUS"===l)d(u.indexOf("C")>=0&&u.indexOf("13")>=0?r.SpectrumNMR.TargetNucleus.C13:u.indexOf("H")>=0?r.SpectrumNMR.TargetNucleus.H:u);else".OBSERVEFREQUENCY"===l?(Kekule.NumUtils.isNormalNumber(u)&&(u=Kekule.Scalar.create(u,Kekule.Unit.Frequency.MEGAHERTZ.symbol)),d(u)):".SOLVENTREFERENCE"===l?(Kekule.NumUtils.isNormalNumber(u)&&(u=Kekule.Scalar.create(u,Kekule.Unit.Dimensionless.PARTS_PER_MILLION.symbol)),d(u)):".DELAY"===l?(Kekule.NumUtils.isNormalNumber(u)&&(u=Kekule.Scalar.create(u,Kekule.Unit.Time.MICROSECOND.symbol)),d(u)):d(u)}else s===r.SpectrumType.MS?d(u):(r.SpectrumType.IMS,d(u))}},_calcActualVarValue:function(e,t){return e*(t.factor||1)},_createSpectrumDataSectionByFormat:function(e,r,i,n,o,a){var s;return e.format===t.Consts.DATA_VARLIST_FORMAT_XYDATA?s=this._createXyDataFormatSpectrumDataSection(e,r,i,n,a):e.format===t.Consts.DATA_VARLIST_FORMAT_XYPOINTS?s=this._createXyPointsFormatSpectrumDataSection(e,r,i,n,a):e.format===t.Consts.DATA_VARLIST_FORMAT_VAR_GROUPS&&(s=o?this._createPeakAssignmentsVarGroupFormatSpectrumDataSection(e,r,i,n,a):this._createVarGroupFormatSpectrumDataSection(e,r,i,n,a)),s},_createXyDataFormatSpectrumDataSection:function(e,r,i,n,o){var a=e.varInc,s=e.varLoop,l=n.createSection(e.vars,Kekule.Spectroscopy.DataMode.CONTINUOUS);l.beginUpdate();try{var u={firstValue:this._calcActualVarValue(r[0][0],i._bySymbol[a]),lastValue:null};if(r.length>1){var d=(r[r.length-1][0]-r[r.length-2][0])/(r[r.length-2].length-1);u.lastValue=this._calcActualVarValue(r[r.length-1][0]+d*(r[r.length-1].length-2),i._bySymbol[a])}else u.lastValue=i[a].lastValue;var c=Math.abs(u.lastValue-u.firstValue)*o.dxDataAllowedLoadingErrorRatio;0===t.Utils.compareFloat(u.firstValue,i._bySymbol[a].firstValue,c)&&0===t.Utils.compareFloat(u.lastValue,i._bySymbol[a].lastValue,c)||Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VALUE_FIRST_LAST_NOT_MATCH")),l.setContinuousVarRange(a,u.firstValue,u.lastValue);for(var h=0,p=r.length;h<p;++h)for(var g=r[h],f=1,C=g.length;f<C;++f)l.appendData([void 0,this._calcActualVarValue(g[f],i._bySymbol[s])]);l.setDataSorted(!0)}finally{l.endUpdate()}return l},_createXyPointsFormatSpectrumDataSection:function(e,t,r,i,n){var o=i.createSection(e.vars);o.beginUpdate();try{for(var a=0,s=t.length;a<s;++a){for(var l=t[a],u=[],d=0,c=l.length;d<c;++d){var h=this._calcActualVarValue(l[d],r[d]);u.push(h)}o.appendData(u)}o.setDataSorted(!0)}finally{o.endUpdate()}return o},_createVarGroupFormatSpectrumDataSection:function(e,t,r,i,n){var o=i.createSection(e.vars);o.beginUpdate();try{for(var a=0,s=t.length;a<s;++a){for(var l=t[a],u=[],d=0,c=l.length;d<c;++d){var h=this._calcActualVarValue(l[d],r[d]);u.push(h)}o.appendData(u)}o.setDataSorted(!0)}finally{o.endUpdate()}return o},_createPeakAssignmentsVarGroupFormatSpectrumDataSection:function(e,t,r,i,n){var o=e.vars.slice(0,2),a=[null,null];if(e.vars.length>2){for(var s=2,l=e.vars.length;s<l;++s){var u=e.vars[s].toUpperCase()[0];["A","W","M"].indexOf(u)>=0?a.push(u):(a.push(null),o.push(e.vars[s]))}var d=!1,c=i.createSection(o);c.beginUpdate();try{var h=[];for(s=0,l=t.length;s<l;++s)if(a.length){for(var p=t[s],g=[],f={},C=0,m=a.length;C<m;++C){var T=a[C];if("M"===T);else if("W"===T)g.push(p[C]);else if("A"===T)Kekule.ObjUtils.notUnset(p[C])&&!n.disablePeakAssignmentReading&&(f.peakAssignmentRaw=[p[C]]);else{var E=this._calcActualVarValue(p[C],r[C]);g.push(E)}}Kekule.ObjUtils.getOwnedFieldNames(f).length&&(g._extra=new Kekule.Spectroscopy.SpectrumPeakDetails,g._extra._peakAssignmentRaw=f.peakAssignmentRaw,d=!0),h.push(g)}else h.push(t[s]);d&&(h=this._mergePeakAssignmentDataRows(h,a));for(s=0,l=h.length;s<l;++s)c.appendData(h[s]);c.setDataSorted(!0),d&&this.getDataSectionsWithPeakAssignments().push(c)}finally{c.endUpdate()}return c}return this._createVarGroupFormatSpectrumDataSection(e,t,r,i,n)},_mergePeakAssignmentDataRows:function(e,t){var r=Kekule.NumUtils,i=function(e,i){for(var n=!0,o=0,a=t.length;o<a;++o)if("A"!==t[o]){var s=e[o],l=i[o];if(s!=l&&r.isNormalNumber(s)&&r.isNormalNumber(l)&&!Kekule.NumUtils.isFloatEqual(s,l)){n=!1;break}}return n},n=function(e,t){for(var r=0,n=t.length;r<n;++r)if(i(e,t[r]))return t[r];return null};if(t.indexOf("A")>=0){for(var o=[],a=0,s=e.length;a<s;++a){var l=e[a],u=n(l,o);u&&l._extra._peakAssignmentRaw?u._extra._peakAssignmentRaw?u._extra._peakAssignmentRaw=u._extra._peakAssignmentRaw.concat(l._extra._peakAssignmentRaw):u._extra._peakAssignmentRaw=l._extra._peakAssignmentRaw:o.push(l)}return o}return e},_isSpectrumDataLdr:function(e,t,r){var i=!r.getData()||r.getData().getSectionCount()<=0;if(i){var n=this.getCurrDataClass()||null;n&&(i=e.labelName.replace(/\s/g,"").indexOf(n.replace(/\s/g,""))>=0)}return i},doCreateChemObjForBlock:function(e){var r,i=this._getBlockMeta(e);return i.blockType===t.BlockType.DATA&&i.format===t.Format.DX?(r=new Kekule.Spectroscopy.Spectrum,this.setPropStoreFieldValue("dataSectionsWithPeakAssignments",[])):r=this.tryApplySuper("doCreateChemObjForBlock",[e]),r},doBuildCrossRef:function(e,r,i,n){if(this.tryApplySuper("doBuildCrossRef",[e,r,i,n]),i===t.CrossRefType.STRUCTURE&&r instanceof Kekule.StructureFragment&&e instanceof Kekule.Spectroscopy.Spectrum){t.Utils.addMoleculeSpectrumCrossRef(e,r);var o=this.getDataSectionsWithPeakAssignments();if(o.length)for(var a=0,s=o.length;a<s;++a)this._buildPeakAssignmentRefs(o[a],r);this.getCurrOptions().autoHiddenSpectrumRefMolecule&&r.setVisible&&r.setVisible(!1)}},_buildPeakAssignmentRefs:function(t,r){for(var i=0,n=t.getDataCount();i<n;++i){var o=t.getExtraInfoAt(i);if(o&&o._peakAssignmentRaw){for(var a=[],s=0,l=o._peakAssignmentRaw.length;s<l;++s){var u=o._peakAssignmentRaw[s],d=parseInt(u);if(Kekule.NumUtils.isNormalNumber(d)&&d>0){var c=r.getNodeAt(d-1);c&&e.pushUnique(a,c)}}o.setAssignments(a),delete o._peakAssignmentRaw}}}}),Kekule.IO.Jcamp.DxDataBlockWriter=Class.create(Kekule.IO.Jcamp.BlockWriter,{CLASS_NAME:"Kekule.IO.Jcamp.DxDataBlockWriter",initProperties:function(){this.defineProp("varSymbolMap",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},_initLdrCreators:function(){this.tryApplySuper("_initLdrCreators");var e=this.getLdrCreatorMap();e["metaData.date"]=this._dateLdrCreator.bind(this),e["parameters.NMR.ObserveNucleus"]=this._nmrObserveNucleusLdrCreator.bind(this),e["parameters.NMR.ObserveFrequency"]=this._scalarWithSpecifiedUnitLdrCreator.bind(this,Kekule.Unit.Frequency.MEGAHERTZ),e["parameters.NMR.SolventReference"]=this._scalarWithSpecifiedUnitLdrCreator.bind(this,Kekule.Unit.Dimensionless.PARTS_PER_MILLION),e["parameters.NMR.Delay"]=this._scalarWithSpecifiedUnitLdrCreator.bind(this,Kekule.Unit.Time.MICROSECOND)},doWriteBlock:function(e,t){return this.tryApplySuper("doWriteBlock",[e,t])},getTitleForBlock:function(e){return e.getTitle()||e.getName()||e.getId()},doSaveJcampVersionToBlock:function(e,r,i){this.saveToLdrInBlock(r,e,"",i.outputDxVersion||Kekule.globalOptions.IO.jcamp.outputDxVersion,t.Consts.LABEL_DX_VERSION)},doGetDataTypeForBlock:function(e){return this.doGetJcampSpectrumDataType(e)},doSaveChemObjToBlock:function(e,t,r){this.tryApplySuper("doSaveChemObjToBlock",[e,t,r]),this.saveToLdrInBlock(t,e,"","","DATA CLASS"),this.doSaveChemObjCrossRefToBlock(e,t,r),this.doSaveSpectrumDataToBlock(e,t,r)},doSaveChemObjCrossRefToBlock:function(e,r,i){var n=e.getRefMolecule();if(n){var o=this.getBlockInfoFromObj(n);if(o&&o.id){var a="STRUCTURE"+t.Consts.CROSS_REF_TYPE_TERMINATOR+" BLOCK_ID"+t.Consts.DATA_LABEL_TERMINATOR+o.id;this.saveToLdrInBlock(r,e,"",a,t.Consts.LABEL_CROSS_REF)}}},doSaveChemObjInfoToBlock:function(e,t,r){this.doSaveSpectrumKeyMetaToBlock(e,t,r),this.doSaveSpectrumInfoToBlock(e,t,r)},doSaveSpectrumKeyMetaToBlock:function(e,t,r){},doGetJcampSpectrumDataType:function(e){var t=e.getSpectrumType(),r=this._getSpectrumPeakDetails(e);return t===n.IR?r.isPeak?"INFRARED PEAK TABLE":"INFRARED SPECTRUM":t===n.RAMAN?"RAMAN SPECTRUM":t===n.NMR?r.isPeakAssignment?"NMR PEAK ASSIGNMENTS":r.isPeak?"NMR PEAK TABLE":"NMR SPECTRUM":t===n.MS?r.isPeak?"MASS SPECTRUM":"CONTINUOUS MASS SPECTRUM":t===n.UV_VIS?"UV/VIS SPECTRUM":t===n.IMS?r.isPeakAssignment?"IMS PEAK ASSIGNMENTS":r.isPeak?"IMR PEAK TABLE":"ION MOBILITY SPECTRUM":null},_getSpectrumPeakDetails:function(e){for(var t={isPeak:!0,isPeakAssignment:!0},r=0,i=e.getDataSectionCount();r<i;++r){var n=e.getDataSectionAt(r);if(t.isPeak=t.isPeak&&n.isPeakSection(),t.isPeakAssignment=t.isPeakAssignment&&n.hasPeakAssignments(),!t.isPeak&&!t.isPeakAssignment)break}return t},doSaveSpectrumInfoToBlock:function(t,r,i){var n=t.getSpectrumType(),o=t.getSpectrumInfoCategories();e.pushUnique(o,"");for(var a=0,s=o.length;a<s;++a)for(var l=o[a],u=t.getSpectrumInfoKeysOfCategory(l),d=0,c=u.length;d<c;++d){var h=u[d],p=l+"."+h,g=t.getSpectrumInfoValue(h,l);Kekule.ObjUtils.notUnset(g)&&this.doSaveSpectrumInfoItemToBlock(t,h,p,g,r,n,i)}},doSaveSpectrumInfoItemToBlock:function(e,r,i,n,o,a,s){var l=[t.Consts.LABEL_BLOCK_BEGIN,t.Consts.LABEL_BLOCK_END,t.Consts.LABEL_DX_VERSION,t.Consts.LABEL_CS_VERSION],u=t.Utils.kekuleLabelNameToJcamp(r,a);l.indexOf(u)<0&&this.saveToLdrInBlock(o,e,i,n,u,!1)},doInsertDataClassToBlock:function(e,t,r,i){if(r){var n=this.createLdrRaw("DATA CLASS",[r]);this.setLdrInBlock(t,n,!0)}},doSaveSpectrumDataToBlock:function(e,r,i){if(this.doGetSpectrumDataStorageStyle(e,i)===t.SpectrumDataStorageStyle.CLASSIC)this.doSaveSpectrumSectionDataToClassic(e,e.getActiveDataSection(),r,i);else{for(var n=[],o=0,a=e.getDataSectionCount();o<a;++o){var s=e.getDataSectionAt(o);s.getDataCount()&&n.push(s)}this.doSaveSpectrumSectionsDataToNTuple(e,n,r,i)}},doGetSpectrumDataStorageStyle:function(e,r){var i=Kekule.oneOf(r.dxDataStorageStyle,Kekule.globalOptions.IO.jcamp.dxDataStorageStyle);i===t.SpectrumDataStorageStyle.SMART&&(i=e.getDataSectionCount()>1?t.SpectrumDataStorageStyle.NTUPLE:t.SpectrumDataStorageStyle.CLASSIC);return i},doGetSpectrumSectionDataStorageFormat:function(e,r,i){if(r.isPeakSection()){var n=r.getActualLocalVarInfos().length;return r.hasPeakAssignments()&&!i.disablePeakAssignmentWriting?t.Consts.DATA_VARLIST_FORMAT_VAR_GROUPS:n<=2?t.Consts.DATA_VARLIST_FORMAT_XYPOINTS:t.Consts.DATA_VARLIST_FORMAT_XYWPOINTS}var o=e.getVariablesOfDependency(Kekule.VarDependency.INDEPENDENT)[0];return o&&r.getContinuousVarRange(o)?t.Consts.DATA_VARLIST_FORMAT_XYDATA:t.Consts.DATA_VARLIST_FORMAT_XYPOINTS},doGetSpectrumVariableInfoOfSections:function(e,r,i){for(var n=[],o=!1,a=[],s=new Kekule.MapEx,l=0,u=r.length;l<u;++l){var d=r[l];o=o||d.hasPeakAssignments();var c={},h={};d.getDataCount()&&(c=d.getValueAt(0),h=d.getValueAt(d.getDataCount()-1));for(var p=0,g=d.getActualLocalVarInfos().length;p<g;++p){var f=d.getLocalVarDef(p);if(a.indexOf(f)<0)a.push(f),s.set(f,{dataCount:d.getDataCount(),firstValue:c[f.getSymbol()],lastValue:h[f.getSymbol()]});else{(_=s.get(f)).dataCount=Math.max(_.dataCount,d.getDataCount());var C=_.firstValue,m=_.lastValue;Kekule.ObjUtils.notUnset(c[f.getSymbol()])&&(Kekule.ObjUtils.isUnset(C)||c[f.getSymbol()]<C)&&(_.firstValue=c[f.getSymbol()]),Kekule.ObjUtils.notUnset(h[f.getSymbol()])&&(Kekule.ObjUtils.isUnset(m)||h[f.getSymbol()]>m)&&(_.lastValue=h[f.getSymbol()])}}}var T=e.getData().calcDataRangeOfSections(r,a,{basedOnInternalUnit:!0,ignorePeakRoot:!0}),E=[];for(l=0,u=a.length;l<u;++l){f=a[l];var _,S=s.get(f);(_={symbol:f.getSymbol(),name:f.getName()||f.getDisplayLabel(),isIndependent:f.isIndependent(),dependency:f.getDependency(),unit:f.getUnit()||Kekule.Unit.Arbitrary.ARBITRARY.symbol,dim:S.dataCount,_varDef:f}).first=S.firstValue||0,_.last=S.lastValue||0;var O=T[_.symbol];if(_.range=O,O){var y=t.DxUtils.calcNumFactorForRange(O.min,O.max,i.dxDataAllowedSavingErrorRatio,i.dxDataPreferredOrdinateScaledRange.min,i.dxDataPreferredOrdinateScaledRange.max);_.factor=y,_.min=O.min,_.max=O.max}n.push(_),E.push(_.symbol)}return o&&n.push({symbol:"A",Name:"Peak assignment",isIndependent:!1,dependency:Kekule.VarDependency.DEPENDENT,unit:Kekule.Unit.Arbitrary.ARBITRARY.symbol,dim:null,varForm:"STRING",_varDef:new Kekule.Spectroscopy.SpectrumVarDefinition,_isPeakAssignment:!0}),s.finalize(),n},_getVarDetailOfDefinition:function(e,t){for(var r=0,i=t.length;r<i;++r)if(t[r]._varDef===e)return t[r];return null},_generateNTupleVarSymbolsForJcamp:function(e){for(var t=[],r=function(e,t){var r=e;if(t.length>=26)return null;for(var i="A".charCodeAt(0);t.indexOf(r)>=0;){var n=(r.charCodeAt(0)-i)%26+1+i;r=String.fromCharCode(n)}return r},i=0,n=e.length;i<n;++i){var o=(e[i].symbol||e[i].name).charAt(0).toUpperCase();if(!(o=r(o,t)))break;t.push(o)}return t},doSaveSpectrumSectionDataToClassic:function(e,r,i,n){for(var o=this.doGetSpectrumVariableInfoOfSections(e,[r],n),a=[],s=[],l=0,u=o.length;l<u;++l){var d=o[l];d.isIndependent?a.push(d):d.isIndependent||s.push(d)}var c=a[0],h=s[0];if(this.doSaveSepctrumSectionVarInfoToClassic(e,r,c,h,i,n),this.saveToLdrInBlock(i,e,"",r.getDataCount()||0,"NPOINTS"),r.getDataCount()){var p,g,f=this.doGetSpectrumSectionDataStorageFormat(e,r,n);if(f===t.Consts.DATA_VARLIST_FORMAT_XYDATA){var C=r.getContinuousVarRange(c.symbol);C&&(this.saveToLdrInBlock(i,e,"",C.fromValue,"FIRSTX"),this.saveToLdrInBlock(i,e,"",C.toValue,"LASTX")),m=this._createXyDataFormatDataLines(r,c,h,n),g=t.Utils.generateDataTableFormatDescriptor(f,["X","Y"]),p="XYDATA"}else if(f===t.Consts.DATA_VARLIST_FORMAT_XYPOINTS||f===t.Consts.DATA_VARLIST_FORMAT_XYWPOINTS){var m=this._createXyPointsFormatDataLines(r,c,h,n);g=t.Utils.generateDataTableFormatDescriptor(f,["X","Y"]),p=r.isPeakSection()?"PEAK TABLE":"XYPOINTS"}else if(f===t.Consts.DATA_VARLIST_FORMAT_VAR_GROUPS){var T=r.hasPeakAssignments(),E=o.length<=2?["X","Y"]:o.length<=3?T?["X","Y","A"]:["X","Y","W"]:["X","Y","W","A"];m=this._createVarGroupFormatDataLines(r,a,s,T,n);g=t.Utils.generateDataTableFormatDescriptor(f,E),p=T?"PEAK ASSIGNMENTS":"PEAK TABLE"}if(m&&g&&m.unshift(g),p&&m){var _={labelName:p,valueLines:m};this.setLdrInBlock(i,_,!0),this.doInsertDataClassToBlock(e,i,p,n)}}},doSaveSepctrumSectionVarInfoToClassic:function(e,r,i,n,o,a){for(var s=[i,n],l=["X","Y"],u=this,d=function(e,t){var r=u.createLdr("",t,e);u.setLdrInBlock(o,r,!0)},c=0,h=s.length;c<h;++c){var p=s[c],g=l[c];if(p.unit)d(g+"UNITS",t.DxUtils.mertricsUnitSymbolToDxUnit(p.unit));p.name&&d(g+"LABEL",p.name),p.range&&(d("MIN"+g,p.range.min),d("MAX"+g,p.range.max)),p.factor&&d(g+"FACTOR",p.factor)}},doSaveSpectrumSectionsDataToNTuple:function(e,t,r,i){var n=this.doGetSpectrumVariableInfoOfSections(e,t,i);n.push({_varDef:null,symbol:"n",name:"Page number",dependency:"PAGE",isIndependent:!0,isPageNumber:!0,dim:t.length,factor:1,unit:Kekule.Unit.Arbitrary.ARBITRARY.symbol,min:1,max:t.length,first:1,last:t.length});for(var o,a=this._generateNTupleVarSymbolsForJcamp(n),s={},l=new Kekule.MapEx,u=0,d=a.length;u<d;++u){var c=a[u];s[c]=n[u],n[u]._varDef&&l.set(n[u]._varDef,c),n[u].isPageNumber&&(o=c)}var h=this.doGetJcampSpectrumDataType(e);this.saveToLdrInBlock(r,e,"",h,"NTUPLES"),this.doSaveSpectrumSectionVarInfoToNTuple(e,t,n,a,s,r,i);for(u=0,d=t.length;u<d;++u)this.doSaveSpectrumSectionDataToNTuplePage(e,t[u],n,l,o,u,r,i);this.saveToLdrInBlock(r,e,"",h,"END NTUPLES"),this.doInsertDataClassToBlock(e,r,"NTUPLES",i),l.finalize()},doSaveSpectrumSectionDataToNTuplePage:function(e,r,i,n,o,a,s,l){var u=o+"="+(a+1);this.saveToLdrInBlock(s,e,"",u,"PAGE"),this.saveToLdrInBlock(s,e,"",r.getDataCount(),"NPOINTS");for(var d=[],c=[],h=[],p=[],g=0,f=r.getActualLocalVarInfos().length;g<f;++g){var C=r.getLocalVarDef(g),m=n.get(C);if(C){var T=this._getVarDetailOfDefinition(C,i);C.isIndependent()?(d.push(T),h.push(m)):(c.push(T),p.push(m))}}var E=!1;for(g=i.length-1;g>=0;--g){if((T=i[g])._isPeakAssignment){E=!0,c.push(T);m=n.get(T._varDef);p.push(m);break}}var _,S,O,y=this.doGetSpectrumSectionDataStorageFormat(e,r,l);if(y===t.Consts.DATA_VARLIST_FORMAT_XYDATA){S="XYDATA";var A=d[0],I=c[0];_=this._createXyDataFormatDataLines(r,A,I,l),O=t.Utils.generateDataTableFormatDescriptor(y,[h[0],p[0]])}else if(y===t.Consts.DATA_VARLIST_FORMAT_XYPOINTS||y===t.Consts.DATA_VARLIST_FORMAT_XYWPOINTS){S=r.isPeakSection()?"PEAK TABLE":"XYPOINTS";A=d[0],I=c[0];_=this._createXyPointsFormatDataLines(r,A,I,l),O=t.Utils.generateDataTableFormatDescriptor(y,[h[0],p[0]])}else if(y===t.Consts.DATA_VARLIST_FORMAT_VAR_GROUPS){S=E?"PEAK ASSIGNMENTS":"PEAK TABLE";var k=[].concat(h).concat(p);O=t.Utils.generateDataTableFormatDescriptor(y,k),_=this._createVarGroupFormatDataLines(r,d,c,E,l)}if(_){_.unshift(O+t.Consts.GROUPED_VALUE_ITEM_DELIMITER+" "+S);var b=this.createLdrRaw("DATA TABLE",_);this.setLdrInBlock(s,b)}},doSaveSpectrumSectionVarInfoToNTuple:function(e,r,i,n,o,a,s){for(var l={},u=function(e,t){var r=l[e];r||(r=[],l[e]=r),r.push(t)},d=function(e){return Kekule.ObjUtils.isUnset(e)?"":t.LdrValueParserCoder.affnCoder(e)},c=0,h=n.length;c<h;++c){var p=n[c],g=i[c],f=g.isPageNumber?"PAGE":g.isIndependent?"INDEPENDENT":"DEPENDENT";u("SYMBOL",p),u("VARNAME",g.name||""),u("VARTYPE",f),u("VARFORM",g.varForm||"ASDF"),u("VARDIM",d(g.dim||0)),u("UNITS",g.unit?t.DxUtils.mertricsUnitSymbolToDxUnit(g.unit):""),u("FIRST",d(g.first)),u("LAST",d(g.last)),u("MIN",d(g.min)),u("MAX",d(g.max)),u("FACTOR",d(g.factor))}var C=Kekule.ObjUtils.getOwnedFieldNames(l,!1);for(c=0,h=C.length;c<h;++c){var m=C[c],T=l[m].join(t.Consts.NTUPLE_DEFINITION_ITEM_DELIMITER),E=this.createLdrRaw(m,T);this.setLdrInBlock(a,E,!1)}},_createVarGroupFormatDataLines:function(r,i,n,o,a){var s=[].concat(i).concat(n),l=[],u=r.getParentSpectrum().getRefMolecule();return r.forEach(function(t,i){for(var n=[],a=[],d=!1,c=0,h=s.length;c<h;++c){var p,g=s[c];if(g._isPeakAssignment){if(o){p="";var f=-1,C=r.getExtraInfoOf(t);if(C&&C.getAssignments&&u){for(var m=C.getAssignments(),T=[],E=0,_=m.length;E<_;++E){var S=m[E];S&&u&&(f=u.indexOfNode(S)),f>=0&&T.push((f+1).toString())}T.length<=0?p=0:1===T.length?p=T[0]:(p=T,d=c)}}}else{var O=t[g.symbol];p="number"==typeof O?Math.round(O/g.factor||1):O}a.push(p)}if(!1!==d){var y=a[d];for(n=[],c=0,h=y.length;c<h;++c){var A=e.clone(a);A[d]=y[c],n.push(A)}}else n=[a];l=l.concat(n)}),t.Utils.encodeAffnGroupTableLines(l,{explicitlyEnclosed:!0})},_createXyPointsFormatDataLines:function(e,r,i,n){var o=r.factor,a=i.factor,s=[];return e.forEach(function(e,t){var n=Math.round(e[r.symbol]/o),l=Math.round(e[i.symbol]/a);s.push([n,l])}),t.Utils.encodeAffnGroupTableLines(s)},_createXyDataFormatDataLines:function(e,r,i,n){var o,a=function(e,t){var r=Math.round(e).toFixed(0).length,i=Math.round(t).toFixed(0).length;return Math.max(r,i)},s=e.getContinuousVarRange(r.symbol),l=r.factor,u=s.fromValue,d=s.toValue,c=i.factor,h=e.calcDataRange([i.symbol],{basedOnInternalUnit:!0})[i.symbol],p=a(u,d)+1,g=a(h.min/c,h.max/c)+1,f=Math.floor((n.maxCharsPerLine-p)/g),C=n.dxDataAsdfTableOutputForm,m=C===t.AsdfForm.DIF||C===t.AsdfForm.DIF_DUP,T=e.getDataCount(),E=0,_=[],S=[];return e.forEach(function(e,t){var n,a=e[i.symbol],s=Kekule.NumUtils.isNormalNumber(a),u=t>=T;n=s?Math.round(a/c):NaN,(!o||u||s&&E>f)&&(S=[],_.push(S),E=0,m&&o&&o.push(n),S.push(Math.round(e[r.symbol]/l)),o=S),S.push(n),++E},this,{basedOnInternalUnit:!0}),t.Utils.encodeAsdfTableLines(_,C,{abscissaFirst:!0})},_getSpectrumDataLabelAndVarFormatOfSection:function(e,t,r){var i;t.isPeak()?i=t.hasPeakAssignments()?"PEAKASSIGNMENTS":"PEAKTABLE":i=t.getContinuousVarSymbols()||[]?"XYDATA":"XYPOINTS";return i},_dateLdrCreator:function(e,t,r,i){return this.createLdr(e,t,"LONGDATE")},_scalarWithSpecifiedUnitLdrCreator:function(e,t,r,i,n){var o;if(r instanceof Kekule.Scalar&&(o=r.getValue())&&Kekule.NumUtils.isNormalNumber(o)){var a=r.getUnit();if(a&&a!==e.symbol){var s=Kekule.Unit.getUnit(a);if(s&&s.category===e.category)o=s.convertValueTo(o,e);else{var l=Kekule.$L("ErrorMsg.JCAMP_LDR_TARGET_UNIT_NOT_MATCH_WITH_DETAIL").format(t,a,e.symbol,n);Kekule.warn(l)}}}return Kekule.NumUtils.isNormalNumber(o)?this.createLdr(t,o,n):null},_nmrObserveNucleusLdrCreator:function(e,t,r,i){var n=Kekule.Spectroscopy.SpectrumNMR.TargetNucleus,o=t===n.C13?"^13C":t===n.H?"^1H":t;return this.createLdr(e,o,i)}}),t.BlockReaderManager.register(t.BlockType.DATA,t.Format.DX,Kekule.IO.Jcamp.DxDataBlockReader),t.BlockWriterManager.register(Kekule.Spectroscopy.Spectrum,Kekule.IO.Jcamp.DxDataBlockWriter)}(),function(){"use strict";var e=Kekule.ObjUtils,t=(Kekule.ArrayUtils,Kekule.IO.Jcamp);Kekule.globalOptions.add("IO.jcamp",{determinateBondStereoByZIndex:!0,enableCloserBondBetweenPositiveZIndexAtoms:!0,outputCsVersion:"3.7",csCoordAllowedSavingErrorRatio:1e-4,csCoordPreferredScaledRange:{min:-16384,max:16384},autoScaleCsRasterCoords:!0,csRasterAutoScaleRefLength:Kekule.globalOptions.structure.defaultBondLength2D||.8}),Object.extend(t.Consts,{MOL_STRUCTURE_VALUE_GROUP_DELIMITER:"\t",MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN:/\s+/g,MOL_ATOM_SYMBOL_ANY:"A",MOL_ATOM_MASS_NUMBER_PREFIX:"^",LABEL_MOL_NAMES:"NAMES",LABEL_MOL_FORMULA:"MOLFORM",LABEL_MOL_ATOMLIST:"ATOMLIST",LABEL_MOL_BONDLIST:"BONDLIST",LABEL_MOL_CHARGELIST:"CHARGE",LABEL_MOL_RADICALLIST:"RADICAL",LABEL_MOL_RASTERLIST:"XYRASTER",LABEL_MOL_MAX_RASTER:"MAXRASTER",LABEL_MOL_COORDLIST:"XYZ",LABEL_MOL_COORD_FACTOR:"XYZFACTOR",LABEL_MOL_MAX_COORD:"MAXXYZ",LABEL_MOL_COORD_CENTER:t.Consts.PRIVATE_LABEL_PREFIX+"XYZCENTER",LABEL_MOL_RASTER_CENTER:t.Consts.PRIVATE_LABEL_PREFIX+"XYRASTERCENTER",LABEL_MOL_RASTER_FACTOR:t.Consts.PRIVATE_LABEL_PREFIX+"XYRASTERFACTOR"}),Kekule.IO.Jcamp.LabelTypeInfos.createInfos([[t.Consts.LABEL_MOL_FORMULA,t.ValueType.STRING,null,t.LabelCategory.GLOBAL],[t.Consts.LABEL_MOL_ATOMLIST,t.ValueType.STRING,null,t.LabelCategory.GLOBAL],[t.Consts.LABEL_MOL_BONDLIST,t.ValueType.STRING,null,t.LabelCategory.GLOBAL],[t.Consts.LABEL_MOL_COORD_FACTOR,t.ValueType.AFFN,null,t.LabelCategory.GLOBAL],[t.Consts.LABEL_MOL_COORD_CENTER,t.ValueType.STRING,t.LabelType.PRIVATE,t.LabelCategory.ANNOTATION],[t.Consts.LABEL_MOL_RASTER_FACTOR,t.ValueType.AFFN,t.LabelType.PRIVATE,t.LabelCategory.ANNOTATION],[t.Consts.LABEL_MOL_RASTER_CENTER,t.ValueType.STRING,t.LabelType.PRIVATE,t.LabelCategory.ANNOTATION],[t.Consts.LABEL_MOL_MAX_COORD,t.ValueType.AFFN,null,t.LabelCategory.GLOBAL],[t.Consts.LABEL_MOL_MAX_RASTER,t.ValueType.AFFN,null,t.LabelCategory.GLOBAL]]),Kekule.IO.Jcamp.CsUtils={getJcampIsotopeIdDetails:function(e){var r=new RegExp("\\"+t.Consts.MOL_ATOM_MASS_NUMBER_PREFIX+"?([0-9]*)([A-z]+)"),i=e.match(r);return i?{massNumber:i[1]?parseInt(i[1]):null,symbol:i[2]}:null},jcampIsotopeIdToKekule:function(e){var r=t.CsUtils.getJcampIsotopeIdDetails(e);return r?r.symbol+r.massNumber:e},kekuleIsotopeToJcampIsotopeId:function(e){var r=e.getSymbol(),i=e.getMassNumber();return i&&(r=t.Consts.MOL_ATOM_MASS_NUMBER_PREFIX+Math.round(i)+r),r},jcampBondTypeToKekule:function(e){var t=Kekule.BondType,r=Kekule.BondOrder,i=e.toUpperCase(),n={};return"A"===i?(n.bondType=t.UNKNOWN,n.bondOrder=r.UNSET):(n.bondType=t.COVALENT,n.bondOrder="S"===i?r.SINGLE:"D"===i?r.DOUBLE:"T"===i?r.TRIPLE:"Q"===i?r.QUAD:r.UNSET),n},kekuleBondTypeAndOrderToJcampBondType:function(e,t){var r=Kekule.BondType,i=Kekule.BondOrder;return e===r.COVALENT?t===i.QUAD?"Q":t===i.TRIPLE?"T":t===i.DOUBLE?"D":t===i.SINGLE?"S":"A":"A"},jcampRadicalToKekule:function(e){return Math.round(e)},kekuleRadicalToJcamp:function(e){return Math.round(e)},calcFactorForCoordRange:function(r,i,n,o,a){for(var s,l,u=["x","y","z"],d=0,c=u.length;d<c;++d){var h=r[u[d]],p=i[u[d]];if(e.notUnset(h)&&e.notUnset(p)){var g=t.Utils.calcNumFactorForRange(h,p,n);(e.isUnset(s)||s>g)&&(s=g)}}for(d=0,c=u.length;d<c;++d){h=r[u[d]],p=i[u[d]];var f=o[u[d]],C=a[u[d]];g=t.Utils.calcNumFactorForRange(h,p,null,f,C);(e.isUnset(l)||l>g)&&(l=g)}return Math.min(s,l)}},Kekule.IO.Jcamp.CsDataBlockReader=Class.create(Kekule.IO.Jcamp.DataBlockReader,{CLASS_NAME:"Kekule.IO.Jcamp.CsDataBlockReader",initProperties:function(){this.defineProp("currAtomInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currBondInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currChargeInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currRadicalInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currCoordFactor",{dataType:DataType.FLOAT,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currCoordCenter",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currCoordInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currRasterFactor",{dataType:DataType.FLOAT,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currRasterCenter",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currRasterInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},doCreateChemObjForBlock:function(e){var r=this._getBlockMeta(e);return r.blockType===t.BlockType.DATA&&r.format===t.Format.CS?new Kekule.Molecule:this.tryApplySuper("doCreateChemObjForBlock",[e])},doSetChemObjFromBlock:function(e,t){var r=this.tryApplySuper("doSetChemObjFromBlock",[e,t]);return this._buildStructure(t,{atomInfos:this.getCurrAtomInfos(),bondInfos:this.getCurrBondInfos(),chargeInfos:this.getCurrChargeInfos(),radicalInfos:this.getCurrRadicalInfos(),coordFactor:this.getCurrCoordFactor(),coordCenter:this.getCurrCoordCenter(),coordInfos:this.getCurrCoordInfos(),rasterFactor:this.getCurrRasterFactor(),rasterCenter:this.getCurrRasterCenter(),rasterInfos:this.getCurrRasterInfos()},this.getCurrOptions()),r},doBuildCrossRef:function(e,r,i,n){this.tryApplySuper("doBuildCrossRef",[e,r,i,n]),i===t.CrossRefType.SPECTRUM&&e instanceof Kekule.StructureFragment&&r instanceof Kekule.Spectroscopy.Spectrum&&t.Utils.addMoleculeSpectrumCrossRef(r,e)},_initLdrHandlers:function(){var e=this.tryApplySuper("_initLdrHandlers");e[t.Consts.LABEL_MOL_NAMES]=this.doStoreMolNamesLdr.bind(this),e[t.Consts.LABEL_MOL_FORMULA]=this.doStoreMolFormulaLdr.bind(this),e[t.Consts.LABEL_MOL_ATOMLIST]=this.doStoreMolAtomListLdr.bind(this),e[t.Consts.LABEL_MOL_BONDLIST]=this.doStoreMolBondListLdr.bind(this),e[t.Consts.LABEL_MOL_CHARGELIST]=this.doStoreMolChargeOrRadicalListLdr.bind(this,"charge"),e[t.Consts.LABEL_MOL_RADICALLIST]=this.doStoreMolChargeOrRadicalListLdr.bind(this,"radical"),e[t.Consts.LABEL_MOL_COORD_FACTOR]=this.doStoreMolCoordOrRasterFactorLdr.bind(this,"coord"),e[t.Consts.LABEL_MOL_COORD_CENTER]=this.doStoreMolCoordOrRasterCenterLdr.bind(this,"coord"),e[t.Consts.LABEL_MOL_COORDLIST]=this.doStoreMolCoordOrRasterListLdr.bind(this,"coord"),e[t.Consts.LABEL_MOL_RASTER_FACTOR]=this.doStoreMolCoordOrRasterFactorLdr.bind(this,"raster"),e[t.Consts.LABEL_MOL_RASTER_CENTER]=this.doStoreMolCoordOrRasterCenterLdr.bind(this,"raster"),e[t.Consts.LABEL_MOL_RASTERLIST]=this.doStoreMolCoordOrRasterListLdr.bind(this,"raster")},getIgnoredLdrNames:function(){return["MAXRASTER","MAXXYZ","STEREOCENTER","STEREOPAIR","STEREOMOLECULE"]},doStoreMolNamesLdr:function(e,t,r,i){var n=e.valueLines[0].trim();r.setName&&r.setName(n)},doStoreMolFormulaLdr:function(e,r,i,n){var o=t.LdrValueParserCoder.parseValue(e);o&&o instanceof Kekule.MolecularFormula&&i.setFormula(o)},doStoreMolAtomListLdr:function(r,i,n,o){for(var a=[],s=r.valueLines,l=0,u=s.length;l<u;++l){var d=s[l].trim();if(d){var c=d.split(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN),h=parseInt(c[0]),p=(c[1]||"").trim(),g=parseInt(c[2])||null;p&&e.notUnset(h)&&(a[h]={symbol:p,implicitHCount:g})}}this.setPropStoreFieldValue("currAtomInfos",a)},doStoreMolBondListLdr:function(r,i,n,o){for(var a=[],s=r.valueLines,l=0,u=s.length;l<u;++l){var d=s[l].trim();if(d){var c=d.split(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN),h=parseInt(c[0]),p=parseInt(c[1]),g=c[2].trim();e.notUnset(h)&&e.notUnset(p)&&g&&a.push({atomIndex1:h,atomIndex2:p,bondType:g})}}this.setPropStoreFieldValue("currBondInfos",a)},doStoreMolChargeOrRadicalListLdr:function(r,i,n,o,a){for(var s=[],l=r,u=i.valueLines,d=0,c=u.length;d<c;++d){var h=u[d].trim();if(h){for(var p=h.split(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN),g=parseFloat(p[0]),f=[],C=1,m=p.length;C<m;++C){var T=parseInt(p[C]);e.notUnset(T)&&T>=0&&f.push(T)}if(e.notUnset(g)&&f.length){var E={atomIndexes:f};E[l]=g,s.push(E)}}}"charge"===l?this.setPropStoreFieldValue("currChargeInfos",s):"radical"===l&&this.setPropStoreFieldValue("currRadicalInfos",s)},doStoreMolCoordOrRasterFactorLdr:function(e,r,i,n,o){var a=t.LdrValueParserCoder.parseValue(r)||1;"coord"===e?this.setPropStoreFieldValue("currCoordFactor",a):"raster"===e&&this.setPropStoreFieldValue("currRasterFactor",a)},doStoreMolCoordOrRasterCenterLdr:function(e,r,i,n,o){var a=r.valueLines[0];if(a){var s=a.split(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN),l={x:parseFloat(s[0]),y:parseFloat(s[1])};s[2]&&(l.z=parseFloat(s[2])),"coord"===e?this.setPropStoreFieldValue("currCoordCenter",l):"raster"===e&&this.setPropStoreFieldValue("currRasterCenter",l)}},doStoreMolCoordOrRasterListLdr:function(r,i,n,o,a){for(var s=[],l=i.valueLines,u=0,d=l.length;u<d;++u){var c=l[u].trim();if(c){for(var h=c.split(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN),p=parseInt(h[0]),g=[],f=1,C=h.length;f<C;++f){var m=parseFloat(h[f]);e.notUnset(m)&&g.push(m)}if(e.notUnset(p)&&g.length){var T={atomIndex:p,x:g[0],y:g[1],z:g[2]};s.push(T)}}}"coord"===r?this.setPropStoreFieldValue("currCoordInfos",s):"raster"===r&&this.setPropStoreFieldValue("currRasterInfos",s)},_buildStructure:function(r,i,n){var o,a=i.atomInfos||this.getCurrAtomInfos()||[],s=i.bondInfos||this.getCurrBondInfos()||[],l=i.chargeInfos||this.getCurrChargeInfos()||[],u=i.radicalInfos||this.getCurrRadicalInfos()||[],d=i.coordInfos||this.getCurrCoordInfos()||[],c=i.coordFactor||this.getCurrCoordFactor()||1,h=i.coordCenter||this.getCurrCoordCenter(),p=i.rasterInfos||this.getCurrRasterInfos()||[],g=i.rasterFactor||this.getCurrRasterFactor(),f=i.rasterCenter||this.getCurrRasterCenter();r.beginUpdate();try{for(var C=[],m=0,T=a.length;m<T;++m){if(W=a[m]){if(W.symbol&&W.symbol!==t.Consts.MOL_ATOM_SYMBOL_ANY){var E=t.CsUtils.getJcampIsotopeIdDetails(W.symbol);G=r.appendAtom(E.symbol,E.massNumber)}else G=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY),r.appendNode(G);C[m]=G}}var _=Kekule.CoordUtils;if(d.length){var S=h||{x:0,y:0,z:0};for(m=0,T=d.length;m<T;++m){if(W=d[m])if(G=C[W.atomIndex]){var O=_.multiply(_.add({x:W.x,y:W.y,z:W.z},S),c);G.setCoord3D(O)}}}if(p.length){o=!g&&n.autoScaleCsRasterCoords&&n.csRasterAutoScaleRefLength;for(S=f||{x:0,y:0},m=0,T=p.length;m<T;++m){if(W=p[m])if(G=C[W.atomIndex]){O=_.multiply(_.add({x:W.x,y:W.y},S),g||1);G.setCoord2D(O),W.z&&G.setZIndex2D(W.z)}}}var y=[];for(m=0,T=s.length;m<T;++m){if(W=s[m]){var A=C[W.atomIndex1],I=C[W.atomIndex2],k=W.bondType,b=t.CsUtils.jcampBondTypeToKekule(k),v=r.appendBond([A,I],b.bondOrder,b.bondType);if(o){var R=_.getDistance(A.getCoord2D(),I.getCoord2D());R&&y.push(R)}if(n.determinateBondStereoByZIndex&&b.bondType===Kekule.BondType.COVALENT&&b.bondOrder===Kekule.BondOrder.SINGLE){var D=A.getZIndex2D()||0,N=I.getZIndex2D()||0,P=D<N?Kekule.BondStereo.UP:D>N?Kekule.BondStereo.DOWN:null;!P&&D>0&&n.enableCloserBondBetweenPositiveZIndexAtoms&&(P=Kekule.BondStereo.CLOSER),P&&v.setStereo(P)}}}if(o&&y.length){var M=Kekule.ArrayUtils.getMedian(y),K=n.csRasterAutoScaleRefLength/M;for(m=0,T=C.length;m<T;++m){if(G=C[m]){var L=G.getCoord2D();L&&G.setCoord2D(_.multiply(L,K))}}}for(m=0,T=l.length;m<T;++m){if((W=l[m])&&W.charge){var x=W.atomIndexes.length;if(x){for(var B=[],U=0;U<x;++U){var w=W.atomIndexes[U];C[w]&&B.push(C[w])}for(var F=W.charge/B.length,V=(U=0,B.length);U<V;++U)B[U].setCharge(F)}}}for(m=0,T=u.length;m<T;++m){var j=(W=u[m])&&W.radical;if(j)for(U=0,V=W.atomIndexes.length;U<V;++U){(G=C[W.atomIndexes[U]])&&G.setRadical(t.CsUtils.jcampRadicalToKekule(j))}}for(m=0,T=a.length;m<T;++m){var W;if(W=a[m]){var G=C[m],H=W.implicitHCount;if(e.notUnset(H)){var z=G.getImplicitHydrogenCount();H!==z&&(G.setExplicitHydrogenCount?G.setExplicitHydrogenCount(H):Kekule.error(Kekule.$L("ErrorMsg.JCAMP_IMPLICIT_HYDROGEN_COUNT_NOT_MATCH_DETAIL").format(m,W.symbol,H,z)))}}}r.hasCtab()&&r.hasFormula()&&r.removeFormula()}finally{r.endUpdate()}}}),Kekule.IO.Jcamp.CsDataBlockWriter=Class.create(Kekule.IO.Jcamp.BlockWriter,{CLASS_NAME:"Kekule.IO.Jcamp.CsDataBlockWriter",initProperties:function(){this.defineProp("atomIndexMap",{dataType:DataType.OBJECT,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},_initLdrCreators:function(){this.tryApplySuper("_initLdrCreators")},getTitleForBlock:function(e){return e.getInfoValue("title")||e.getName()||e.getId()},doSaveJcampVersionToBlock:function(e,r,i){this.saveToLdrInBlock(r,e,"",i.outputCsVersion||Kekule.globalOptions.IO.jcamp.outputCsVersion,t.Consts.LABEL_CS_VERSION)},doSaveChemObjToBlock:function(e,t,r){this.tryApplySuper("doSaveChemObjToBlock",[e,t,r]);var i=new Kekule.MapEx;try{this.setPropStoreFieldValue("atomIndexMap",i);var n=e.clone(!0);try{n.kekulize()&&n.kekulize();var o=n.getFlattenedShadowFragment()}finally{n.finalize()}if(this.doSaveMolFormulaToBlock(e,t,r),o.hasCtab()){var a=this.doGenerateMolAtomsLdrs(o,r),s=this.doGenerateMolBondsLdrs(o,r);a.atoms&&this.setLdrInBlock(t,a.atoms),s.bonds&&this.setLdrInBlock(t,s.bonds),a.charges&&this.setLdrInBlock(t,a.charges),a.radicals&&this.setLdrInBlock(t,a.radicals),a.rasters&&(a.maxRaster&&this.setLdrInBlock(t,a.maxRaster),a.rasterFactor&&this.setLdrInBlock(t,a.rasterFactor),a.rasterCenter&&this.setLdrInBlock(t,a.rasterCenter),this.setLdrInBlock(t,a.rasters)),a.coords&&a.coordFactor&&(a.maxCoord&&this.setLdrInBlock(t,a.maxCoord),this.setLdrInBlock(t,a.coordFactor),a.coordCenter&&this.setLdrInBlock(t,a.coordCenter),this.setLdrInBlock(t,a.coords))}}finally{i.finalize()}},doSaveMolFormulaToBlock:function(e,r,i){var n=e.calcFormula();n&&this.saveToLdrInBlock(r,e,"",n,t.Consts.LABEL_MOL_FORMULA)},doGenerateMolAtomsLdrs:function(e,r){for(var i,n,o,a,s,l,u,d,c,h,p,g,f,C=this.getAtomIndexMap(),m=1,T=[""],E=[],_=[],S=[],O=[],y=function(e,t){return e.hasCoordOfMode(t)?(e.getAbsCoordOfMode||e.getCoordOfMode).apply(e,[t]):null},A=0,I=e.getNodeCount();A<I;++A){var k=e.getNodeAt(A);if(k instanceof Kekule.ChemStructureNode){var b,v=k.getPrimaryIsotope&&k.getPrimaryIsotope();b=v?t.CsUtils.kekuleIsotopeToJcampIsotopeId(v):t.Consts.MOL_ATOM_SYMBOL_ANY;var R=k.getHydrogenCount&&k.getHydrogenCount(!1),D=[m,b];R&&D.push(R),T.push(D.join(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER));var N=y(k,Kekule.CoordMode.COORD3D);N?g=!0:N={x:0,y:0,z:0},N._index=m,S.push(N);var P=y(k,Kekule.CoordMode.COORD2D);P?f=!0:P={x:0,y:0},P._index=m;var M=k.getZIndex2D&&k.getZIndex2D();M&&(P.zIndex=M),O.push(P);var K=k.getCharge&&k.getCharge();K&&E.push({charge:Math.round(K),atomIndex:m});var L=k.getRadical&&k.getRadical();L&&(_[L=t.CsUtils.kekuleRadicalToJcamp(L)]?_[L].push(m):_[L]=[m]),C.set(k,m),++m}}if(T.length>1&&(i=this.createLdrRaw(t.Consts.LABEL_MOL_ATOMLIST,T)),E.length){var x=[""];for(A=0,I=E.length;A<I;++A){if(B=E[A]){D=[B.charge>0?"+"+B.charge:B.charge.toString(),B.atomIndex];x.push(D.join(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER))}}n=this.createLdrRaw(t.Consts.LABEL_MOL_CHARGELIST,x)}if(_.length){for(x=[""],A=0,I=_.length;A<I;++A){var B;if(B=_[A])D=(D=[A]).concat(_[A]),x.push(D.join(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER))}x.length>1&&(o=this.createLdrRaw(t.Consts.LABEL_MOL_RADICALLIST,x))}var U=Kekule.CoordUtils,w=[f?O:[],g?S:[]];for(A=0,I=w.length;A<I;++A){var F,V=w[A],j=(x=[""],0===A?["x","y"]:["x","y","z"]);if(V.length){var W=U.getCenter(V),G=U.getContainerBoxCorners(V);G.min=U.substract(G.min,W),G.max=U.substract(G.max,W);var H={},z={};H.x=H.y=H.z=r.csCoordPreferredScaledRange.min,z.x=z.y=z.z=r.csCoordPreferredScaledRange.max;for(var Y=t.CsUtils.calcFactorForCoordRange(G.min,G.max,r.csCoordAllowedSavingErrorRatio,H,z),X=0,$=V.length;X<$;++X){D=[V[X]._index];for(var J=U.divide(U.substract(V[X],W),Y),q=0,Z=j.length;q<Z;++q){var Q=j[q],ee=Math.round(J[Q]||0);D.push(ee),(Kekule.ObjUtils.isUnset(F)||ee>F)&&(F=ee)}V[X].zIndex&&D.push(V[X].zIndex),x.push(D.join(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER))}for(J=U.divide(W,Y),D=[],q=0,Z=j.length;q<Z;++q){Q=j[q];D.push(Math.round(J[Q]||0))}var te=D.join(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER);x.length>1&&(0===A?(u=this.createLdrRaw(t.Consts.LABEL_MOL_RASTERLIST,x),d=this.createLdr("",Y,t.Consts.LABEL_MOL_RASTER_FACTOR),c=this.createLdr("",te,t.Consts.LABEL_MOL_RASTER_CENTER),p=this.createLdr("",F,t.Consts.LABEL_MOL_MAX_RASTER)):(a=this.createLdrRaw(t.Consts.LABEL_MOL_COORDLIST,x),s=this.createLdr("",Y,t.Consts.LABEL_MOL_COORD_FACTOR),l=this.createLdr("",te,t.Consts.LABEL_MOL_COORD_CENTER),h=this.createLdr("",F,t.Consts.LABEL_MOL_MAX_COORD)))}}return{atoms:i,charges:n,radicals:o,rasters:u,rasterFactor:d,rasterCenter:c,coords:a,coordFactor:s,coordCenter:l,maxCoord:h,maxRaster:p}},doGenerateMolBondsLdrs:function(r,i){for(var n=this.getAtomIndexMap(),o=[""],a=0,s=r.getConnectorCount();a<s;++a){var l=r.getConnectorAt(a);if(l instanceof Kekule.Bond){for(var u=[],d=l.getConnectedChemNodes(),c=0,h=d.length;c<h;++c){var p=n.get(d[c]);if(e.notUnset(p)&&(u.push(p),u.length>=2))break}var g=t.CsUtils.kekuleBondTypeAndOrderToJcampBondType(l.getBondType(),l.getBondOrder());u.push(g),o.push(u.join(t.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER))}}var f={};return o.length>1&&(f.bonds=this.createLdrRaw(t.Consts.LABEL_MOL_BONDLIST,o)),f}}),t.BlockReaderManager.register(t.BlockType.DATA,t.Format.CS,Kekule.IO.Jcamp.CsDataBlockReader),t.BlockWriterManager.register(Kekule.StructureFragment,Kekule.IO.Jcamp.CsDataBlockWriter)}(),function(){"use strict";Kekule.ArrayUtils;var e=Kekule.IO.Jcamp,t=e.Consts;Kekule.IO.JcampReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.JcampReader",initialize:function(e){this.tryApplySuper("initialize",e)},doFinalize:function(){this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("blockIdObjMap",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("crossRefs",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},_removeInlineComments:function(e){var r=e.indexOf(t.INLINE_COMMENT_FLAG);return r>=0?e.substring(0,r):e},_parseLdrLines:function(r){var i=r[0].indexOf(t.DATA_LABEL_TERMINATOR),n=!1;if(i<0)o=r[0].substring(t.DATA_LABEL_FLAG.length).trim(),n=!0;else var o=r[0].substring(t.DATA_LABEL_FLAG.length,i).trim();if(o){var a=null;if(!n){a=[];var s=this._removeInlineComments(r[0].substr(i+1)).trim();a.push(s||"");for(var l=1,u=r.length;l<u;++l)(s=this._removeInlineComments(r[l].trim()))&&a.push(s)}return{labelName:e.Utils.standardizeLdrLabelName(o),valueLines:a}}return null},doCreateAnalysisTree:function(r){var i=e.BlockUtils.createBlock,n=i(),o=n,a=this,s=function(r){var n=a._parseLdrLines(r);if(n){if(e.Utils.ldrLabelNameEqual(n.labelName,t.LABEL_BLOCK_BEGIN)){var s=i(o);o.blocks.push(s),o=s}!function(t,r){var i=a._parseLdrLines(t);i&&e.BlockUtils.addLdrToBlock(r,i)}(r,o),e.Utils.ldrLabelNameEqual(n.labelName,t.LABEL_BLOCK_END)&&(o=o._parent)}},l=new Kekule.TextLinesBuffer(r);l.reset();for(var u=[];!l.eof();){var d=l.readLine().trim();d.startsWith(t.DATA_LABEL_FLAG)?(u.length&&s(u),u=[d]):u.push(d)}return u.length&&s(u),n},doCheckAnalysisTree:function(t){t.ldrs.length&&Kekule.error(Kekule.$L("ErrorMsg.JCAMP_OTHER_LABEL_BEFORE_TITLE_LINE")),t.blocks.length>1&&Kekule.error(Kekule.$L("ErrorMsg.JCAMP_MORE_THAN_ONE_ROOT_BLOCK"));var r=t.blocks[0];return r||Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_WITHOUT_TITLE_LINE")),e.BlockUtils.getNestedBlockLevelCount(r)>2&&Kekule.error(Kekule.$L("ErrorMsg.JCAMP_MORE_THAN_TWO_NEST_LEVEL")),!0},buildAnalysisTree:function(e){var t=this.doCreateAnalysisTree(e);return this.doCheckAnalysisTree(t)?t:null},setObjWithBlockId:function(e,t){this.getBlockIdObjMap()[e]=t},getObjFromBlockId:function(e){return this.getBlockIdObjMap()[e]},addCrossRefItem:function(e,t,r,i,n){this.getCrossRefs().push({srcReader:e,srcBlockId:t,targetBlockId:r,refType:i,refTypeText:n})},doHandleCrossRefs:function(){for(var e=this.getCrossRefs()||[],t=0,r=e.length;t<r;++t){var i=e[t],n=i.srcReader;if(n&&n.doBuildCrossRef){var o=this.getObjFromBlockId(i.srcBlockId),a=this.getObjFromBlockId(i.targetBlockId);o&&a&&n.doBuildCrossRef(o,a,i.refType,i.refTypeText)}}},doReadData:function(t,r,i,n){var o,a=this.buildAnalysisTree(t).blocks[0],s=e.BlockUtils.getBlockMeta(a),l=e.BlockReaderManager.getReaderClass(s.blockType,s.format);if(l){var u=new l;u.setParentReader(this);try{var d=Object.extend({},Kekule.globalOptions.IO.jcamp);d=Object.extend(d,n||{}),this.setPropStoreFieldValue("blockIdObjMap",{}),this.setPropStoreFieldValue("crossRefs",[]),o=u.doReadData(a,null,null,d),this.doHandleCrossRefs()}finally{u.finalize()}}return o}}),Kekule.IO.JcampWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.JcampWriter",initProperties:function(){this.defineProp("maxBlockId",{dataType:DataType.INT,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("objBlockIdMap",{dataType:DataType.OBJECT,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},doWriteData:function(e,t,r,i){var n=e,o=this.doGetChildWriter(n);if(!o&&e.getChildAt&&e.getChildCount)for(var a=0,s=e.getChildCount();a<s;++a){var l=e.getChildAt(a);if(l&&(o=this.doGetChildWriter(l))){n=l;break}}if(o&&n){this._prepareWriting();var u=Object.extend({},Kekule.globalOptions.IO.jcamp);u=Object.extend(u,i||{}),o.setParentWriter(this);var d=o.writeData(n,t,r,u),c=[];return d&&(c=this.encodeBlockToTextLines(d)),o.finalize(),c.join("\n")}return""},_prepareWriting:function(){this.setPropStoreFieldValue("maxBlockId",0),this.getObjBlockIdMap()&&this.getObjBlockIdMap().finalize(),this.setPropStoreFieldValue("objBlockIdMap",new Kekule.MapEx)},doGetChildWriter:function(t){var r=e.BlockWriterManager.getWriterClass(t);return r?new r:null},encodeBlockToTextLines:function(r){for(var i,n=r.ldrs,o=[],a=0,s=n.length;a<s;++a){var l=n[a],u=l.labelName;if(u===t.LABEL_BLOCK_END)i=l;else{var d=l.valueLines||[],c=e.Consts.DATA_LABEL_FLAG+u+e.Consts.DATA_LABEL_TERMINATOR+d.join("\n");o.push(c)}}var h=r.blocks||[];for(a=0,s=h.length;a<s;++a)o=o.concat(this.encodeBlockToTextLines(h[a]));if(i){c=e.Consts.DATA_LABEL_FLAG+i.labelName+e.Consts.DATA_LABEL_TERMINATOR+(l.valueLines||[]).join("\n");o.push(c)}return o},generateUniqueBlockId:function(){var e=this.getMaxBlockId(),t=++e;return this.setPropStoreFieldValue("maxBlockId",t),t.toString()},setBlockInfoForObj:function(e,t){this.getObjBlockIdMap().set(e,t)},getBlockInfoFromObj:function(e){return this.getObjBlockIdMap().get(e)}}),Kekule.Spectroscopy.MetaPropNamespace.register("jcamp"),Kekule.IO.DataFormat.JCAMP_DX="jcamp-dx",Kekule.IO.MimeType.JCAMP_DX="chemical/x-jcamp-dx",Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.JCAMP_DX,Kekule.IO.MimeType.JCAMP_DX,["jdx","dx","jcm","jcamp"],Kekule.IO.ChemDataType.TEXT,"JCAMP-DX format"),Kekule.IO.ChemDataReaderManager.register(Kekule.IO.DataFormat.JCAMP_DX,Kekule.IO.JcampReader,[Kekule.IO.DataFormat.JCAMP_DX]),Kekule.IO.ChemDataWriterManager.register(Kekule.IO.DataFormat.JCAMP_DX,Kekule.IO.JcampWriter,[Kekule.Spectroscopy.Spectrum,Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemSpace],[Kekule.IO.DataFormat.JCAMP_DX])}(),function(){"use strict";Kekule.globalOptions.add("IO.cml",{enableExtractSampleInsideSpectrum:!0,autoHideSampleInsideSpectrum:!0,autoInsertHiddenRefMoleculeToSample:!0,spectrumDataValueOutputPrecisionCount:8,autoConvertNmrDataFreqToUnit:"Hz"});var e=Kekule.ArrayUtils,t=Kekule.ObjUtils,r=Kekule.DomUtils,i=Kekule.IO.CmlUtils,n=Kekule.IO.CmlDomUtils,o=Kekule.Spectroscopy.SpectrumType,a=Kekule.Spectroscopy.PeakShape,s=Kekule.Spectroscopy.PeakMultiplicity;Kekule.IO.CmlUtils._cmlUnitConvMap.push(["moverz","m/z","m/z",!1]),Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME="__$objRef$__",Kekule.IO.CML.SPECTRUM_DATA_OBJREF_FLAG_FIELDNAME="__$hasObjRef$__",Kekule.IO.CML.Spect={},Kekule.IO.CML.Spect.Consts={SI_UNITS_NAMESPACE_DEF_PREFIX:"siUnits",SI_UNITS_NAMESPACE_URI:"http://www.xml-cml.org/units/siUnits",UNITS_NAMESPACE_DEF_PREFIX:"units",UNITS_NAMESPACE_URI:"http://www.xml-cml.org/units/units",JSPECVIEW_NAMESPACE_DEF_PREFIX:"jspecview",JSPECVIEW_NAMESPACE_URI:"http://jspecview.sf.net/convention.html",JCAMP_NAMESPACE_DEF_PREFIX:"jcamp",JCAMP_NAMESPACE_URI:"http://www.iupac.org/jcamp/dict",JCAMP_UNITS_NAMESPACE_DEF_PREFIX:"jcampUnits",JCAMP_UNITS_NAMESPACE_URI:"http://www.iupac.org/jcamp/dict/units",CML_DICT_NAMESPACE_DEF_PREFIX:"cml",CML_DICT_NAMESPACE_URI:"http://www.xml-cml.org/dict/cmlDict",XML_SCHEMA_INSTANCE_NAMESPACE_DEF_PREFIX:"xsi",XML_SCHEMA_INSTANCE_NAMESPACE_URI:"http://www.w3.org/2001/XMLSchema-instance",CMLSPECT_SCHEMA_LOCATIONS_ATTRIBNAME:"schemaLocation",CMLSPECT_SCHEMA_LOCATIONS:["http://www.xml-cml.org/dict/jcampDict dict/jcampDict.xml","http://www.xml-cml.org/schema schema.xsd","http://www.xml-cml.org/dict/cml dict/cmlDict.xml","http://www.xml-cml.org/dict/cmlDict dict/simpleCmlDict.xml","http://www.xml-cml.org/units/units dict/unitsDict.xml","http://www.xml-cml.org/units/siUnits dict/siUnitsDict.xml"],ANNOTATION_METATYPE:"annotation",INFO_METATYPE:"info"};var l=Kekule.IO.CML.Spect.Consts;Kekule.IO.CmlSpectUtils={_spectrumTypeMap:[["NMR",o.NMR],["infrared",o.IR],["ir",o.IR],["massSpectrum",o.MS],["mass",o.MS],["UV/VIS",o.UV_VIS],["uv",o.UV_VIS],["vis",o.UV_VIS]],_peakShapeMap:[["sharp",a.SHARP],["broad",a.BROAD]],_peakMultiplicityMap:[["singlet",s.SINGLET],["doublet",s.DOUBLET],["triplet",s.TRIPLET],["quartet",s.QUARTET],["quintet",s.QUINTET],["sextuplet",s.SEXTUPLET],["multiplet",s.MULTIPLET],["s",s.SINGLET],["d",s.DOUBLET],["dd",s.DOUBLE_DOUBLET],["ddd",s.TRIPLE_DOUBLET],["t",s.TRIPLET],["m",s.MULTIPLET]],_spectrumInfoKeyMap:[["jcamp:NMR_OBSERVEFREQUENCY","NMR.ObserveFrequency"],["cml:field","NMR.ObserveFrequency"],["jcamp:NMR_OBSERVENUCLEUS","NMR.ObserveNucleus"],["nmr:OBSERVENUCLEUS","NMR.ObserveNucleus"],["jcamp:resolution","Resolution"]],cmlSpectrumTypeToKekule:function(e){for(var t=Kekule.IO.CmlSpectUtils._spectrumTypeMap,r=o.GENERAL,i=e.toLowerCase(),n=0,a=t.length;n<a;++n){var s=t[n];if(i.indexOf(s[0].toLowerCase())>=0){r=s[1];break}}return r},kekuleSpectrumTypeToCml:function(e){for(var t=null,r=Kekule.IO.CmlSpectUtils._spectrumTypeMap,i=0,n=r.length;i<n;++i){var o=r[i];if(e===o[1]){t=o[0];break}}return t},cmlSpectrumInfoDataKeyToKekule:function(e,t,r){r||(r=l.JCAMP_NAMESPACE_DEF_PREFIX);for(var n=u._spectrumInfoKeyMap,o=0,a=n.length;o<a;++o)if(e===n[o][0])return n[o][1];var s=i.getCmlNsValueDetails(e);if(s.namespace&&s.namespace===r){var d=s.localName;if(t){var c=t&&t+"_",h=d.indexOf(c);h>=0&&(d=Kekule.IO.Jcamp.Consts.SPECIFIC_LABEL_PREFIX+d.substr(h+c.length))}var p=d.toUpperCase();return Kekule.IO.Jcamp.Utils.jcampLabelNameToKekule(p,t)}return i.cmlNsTokenToKekule(e)},kekuleSpectrumInfoDataKeyToCml:function(e,t,r){r||(r=l.JCAMP_NAMESPACE_DEF_PREFIX);for(var i=u._spectrumInfoKeyMap,n=0,o=i.length;n<o;++n)if(e===i[n][1])return i[n][0];var a=Kekule.Spectroscopy.MetaPropNamespace.getPropertyNameDetail(e);if(a.namespace===r)return a.namespace+":"+a.coreName;var s=Kekule.IO.Jcamp.Utils.kekuleLabelNameToJcamp(e,t,!0);return s?u._convPossibleJcampLabelNameToCml(s,t,r):a.namespace+":"+a.coreName},_convPossibleJcampLabelNameToCml:function(e,t,r){var i=Kekule.IO.Jcamp.Utils.analysisLdrLabelName(e,!1),n=i.labelType===Kekule.IO.Jcamp.LabelType.SPECIFIC,o=i.labelType===Kekule.IO.Jcamp.LabelType.PRIVATE,a=i.coreName,s=n&&t?t+"_"+a:a;return o?s:r+":"+s},cmlPeakShapeToKekule:function(e){for(var t=u._peakShapeMap,r=e.toLowerCase(),i=0,n=t.length;i<n;++i)if(r===t[i][0])return t[i][1];return e},kekulePeakShapeToCml:function(e){for(var t=u._peakShapeMap,r=0,i=t.length;r<i;++r)if(e===t[r][1])return t[r][0];return e},cmlPeakMultiplicityToKekule:function(e){for(var t=u._peakMultiplicityMap,r=e.toLowerCase(),i=0,n=t.length;i<n;++i)if(r===t[i][0])return t[i][1];return e},kekulePeakMultiplicityToCml:function(e){for(var t=u._peakMultiplicityMap,r=0,i=t.length;r<i;++r)if(e===t[r][1])return t[r][0];return e},floatToCmlString:function(e,t){return t?Kekule.NumUtils.toPrecision(e,t,!0,!0):e.toString()},getSpectrumVarDef:function(e,t,r,i,n){n||(n=Kekule.VarDependency.INDEPENDENT);for(var o=e.getVariables(),a=0,s=o.length;a<s;++a){var l=o[a];if(!(t&&t!==l.getSymbol()||r&&r!==l.getUnit()||i&&i!==l.getName()||n!==l.getDependency()))return l}return null}};var u=Kekule.IO.CmlSpectUtils;Kekule.IO.CmlSampleReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlSampleReader"}),Kekule.IO.CmlSpectrumDataSectionBaseWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumDataWriter",getSpectrumDataSectionVarInfos:function(e){for(var t={dependent:{},independent:{}},r=0,i=e.getActualLocalVarInfos().length;r<i;++r){var n=e.getLocalVarDef(r),o=t[n.getDependency()===Kekule.VarDependency.DEPENDENT?"dependent":"independent"];o.symbol=n.getSymbol(),o.unitSymbol=n.getUnit(),o.name=n.getName(),o.description=n.getDescription();var a=e.getContinuousVarRange(r);if(a&&(o.range={fromValue:a.fromValue,toValue:a.toValue,count:e.getDataCount()}),t.dependent.symbol&&t.independent.symbol)break}return t.varCount=(t.dependent.symbol?1:0)+(t.independent.symbol?1:0),t}}),Kekule.IO.CmlSpectrumPeakListReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakListReader",initialize:function(){this.tryApplySuper("initialize"),this._peakDetailsWithAssignments=[]},doFinalize:function(){this._peakDetailsWithAssignments=null,this.tryApplySuper("doFinalize")},doReadElement:function(e,t,r,i){var n=t instanceof Kekule.Spectroscopy.Spectrum?t:null;if(n){var o=[],a=this.getDomHelper().getElementsByTagNameNS(this.getCoreNamespaceURI(),"peak",e),s=this.doGetChildElementReader("peak");if(s)try{for(var l=0,u=a.length;l<u;++l){var d=s.readElement(a[l],null,this);d&&o.push(d)}}finally{}if(o.length){var c,h=n.getData(),p=this._analysisPeakVarInfo(o,n);if(p){var g=this._addPeakVariablesToSpectrumData(p,h,n);g&&g.length&&(c=h.createSection(g,Kekule.Spectroscopy.DataMode.PEAK),this._setVarLocalInfos(p,c),this._addPeakDataToSpectrumData(o,g,c,h,n))}return c}return null}return null},doDoneReadingDocument:function(){for(var e=this._peakDetailsWithAssignments,t=0,r=e.length;t<r;++t){var i=e[t];if(i instanceof Kekule.Spectroscopy.SpectrumPeakDetails){for(var n=i.getOwner(),o=i.getInfoValue(Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME),a=[],s=0,l=o.length;s<l;++s){var u=o[s],d=this.getLoadedObjById(u)||n&&n.getObjById&&n.getObjById(u);d&&a.push(d)}a.length&&i.setAssignments(a),delete i.getInfo()[Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME]}}this._peakDetailsWithAssignments=[]},_analysisPeakVarInfo:function(e,t){for(var r={},i=0,n=0,o=e.length;n<o;++n){for(var a=e[n],s=a.value,l=0,u=(c=s&&Kekule.ObjUtils.getOwnedFieldNames(s,!1)||[]).length;l<u;++l)r[c[l]]||(r[c[l]]={},++i);var d=a.units;if(d){var c;for(l=0,u=(c=Kekule.ObjUtils.getOwnedFieldNames(d,!1)||[]).length;l<u;++l)if(r[c[n]]&&!r[c[n]].units){var h=Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(d[c[n]]);r[c[n]].units=h,h||(r[c[n]].title=Kekule.IO.CmlUtils.getCmlNsValueLocalPart(d[c[n]]))}}}return i<=0?null:(1===i&&t&&t.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.NMR&&(r.y={units:Kekule.Unit.Arbitrary.ARBITRARY.symbol,displayLabel:Kekule.Unit.Arbitrary.ARBITRARY.name,defaultValue:1}),r)},_addPeakVariablesToSpectrumData:function(e,t,r){if(!e)return null;var i=Kekule.ObjUtils.getOwnedFieldNames(e,!1),n=i.indexOf("x");n<0&&(n=i.indexOf("X")),n<0&&(n=0);var o=i.splice(n,1);i.unshift(o[0]);for(var a=[],s=0,l=i.length;s<l;++s){var u={symbol:i[s],dependency:0===s?Kekule.VarDependency.INDEPENDENT:Kekule.VarDependency.DEPENDENT};e[i[s]].title&&(u.displayLabel=e[i[s]].title),e[i[s]].units&&(u.unit=e[i[s]].units);var d=Kekule.IO.CmlSpectUtils.getSpectrumVarDef(r,u.symbol,u.unit,null,u.dependency);d&&!d.getDisplayLabel()&&u.displayLabel&&d.setDisplayLabel(u.displayLabel),d||(d=new Kekule.Spectroscopy.SpectrumVarDefinition(u),t.appendVariable(d)),a.push(u.symbol)}return a},_setVarLocalInfos:function(e,t){for(var r=Kekule.ObjUtils.getOwnedFieldNames(e,!1),i=0,n=r.length;i<n;++i){var o=e[r[i]];Kekule.ObjUtils.notUnset(o.defaultValue)&&t.setDefaultVarValue(r[i],o.defaultValue)}},_addPeakDataToSpectrumData:function(e,t,r,i,n){for(var o=0,a=e.length;o<a;++o){for(var s=e[o],l=[],u=0,d=t.length;u<d;++u){var c=t[u],h=s.value[c];l.push(h)}this._setPeakDetails(s,l,r),r.appendData(l)}r.setDataSorted(!0)},_setPeakDetails:function(e,t,r){if(e.subStructure||e.multiplicity||e.shape){var i=new Kekule.Spectroscopy.SpectrumPeakDetails({multiplicity:e.multiplicity,shape:e.shape});e.subStructure&&i.setInfoValue("structure",e.subStructure);var n=this._getPeakObjRefIds(e);return n&&(i.setInfoValue(Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME,n),this._peakDetailsWithAssignments.push(i)),r.setExtraInfoOf(t,i),i}return null},_getPeakObjRefIds:function(e){for(var t=[],r=0,i=Kekule.IO.CML.ATOMS_REF_ATTRIBS.length;r<i;++r){e[n=Kekule.IO.CML.ATOMS_REF_ATTRIBS[r]]&&(t=t.concat(e[n].split(/\s/)))}for(r=0,i=Kekule.IO.CML.BONDS_REF_ATTRIBS.length;r<i;++r){var n;e[n=Kekule.IO.CML.BONDS_REF_ATTRIBS[r]]&&(t=t.concat(e[n].split(/\s/)))}var o=[];for(r=0,i=t.length;r<i;++r){var a=t[r].trim();a&&o.push(a)}return o.length?o:null}}),Kekule.IO.CmlSpectrumPeakListWriter=Class.create(Kekule.IO.CmlSpectrumDataSectionBaseWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakListWriter",doCreateElem:function(e,t){return this.createChildElem("peakList",t)},doWriteObject:function(e,t,r){return this.writePeaks(e,t,r)},writePeaks:function(e,t,r){var i=this.getSpectrumDataSectionVarInfos(e);if(i.varCount<2);else{var n=this.getChildPeakWriter();if(n){var o=i.independent.symbol,a=i.independent.unitSymbol,s=i.dependent.symbol,l=i.dependent.unitSymbol,u=this;e.forEach(function(i,d){var c,h={xValue:i[o],xUnits:a,yValue:i[s],yUnits:l},p=e.getExtraInfoOf(i);p instanceof Kekule.Spectroscopy.SpectrumPeakDetails?c=u._peakDetailsToHash(p):DataType.isObjectValue(p)&&(c=p),c&&(h=Object.extend(h,c)),n.writeObject(h,t,r)})}}},getChildPeakWriter:function(){var e=new Kekule.IO.CmlSpectrumPeakWriter;return e&&(this.copySettingsToChildHandler(e),this._appendChildHandler(e)),e},_peakDetailsToHash:function(e){var t={shape:e.getShape(),multiplicity:e.getMultiplicity(),assignments:e.getAssignments()},r=e.getInfoValue("structure");return r&&(t.structure=r),t}}),Kekule.IO.CmlSpectrumPeakReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakReader",doReadElement:function(e,t,i,n){var o={};return this.readPeakAttribs(o,e,this.getDomHelper()),this.iterateChildElements(e,o,this,function(e,t){"peakstructure"===r.getLocalName(e).toLowerCase()&&(o.subStructure||(o.subStructure=[]),o.subStructure.push(t))}),o},readPeakAttribs:function(e,t,r){for(var i=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,null,!0,r),n=Kekule.ObjUtils.getOwnedFieldNames(i),o=0,a=n.length;o<a;++o){var s=n[o],l=s.toLowerCase();"peakheight"===l&&(s="yValue",l="yvalue");var d=i[s];if(l.indexOf("units")>=0){var c=this._getVarSymbolInName(s,"units");e.units||(e.units={}),e.units[c]=Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(d)}else if(l.indexOf("value")>=0){c=this._getVarSymbolInName(s,"value");e.value||(e.value={}),e.value[c]=Kekule.IO.CmlUtils.tryParseFloat(d)}else"peakmultiplicity"===l?e.multiplicity=u.cmlPeakMultiplicityToKekule(d):"peakshape"===l?e.shape=u.cmlPeakShapeToKekule(d):e[s]=d}},_getVarSymbolInName:function(e,t){var r=e.toLowerCase().indexOf(t.toLowerCase());return r>0?e.substring(0,r):null}}),Kekule.IO.CmlSpectrumPeakWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakWriter",doCreateElem:function(e,t){return this.createChildElem("peak",t)},doWriteObject:function(e,t,r){this.writePeakAttribs(e,t,r)},writePeakAttribs:function(e,t,r){for(var i=this.getDomHelper(),o=this._peakHashToCmlHash(e),a=Kekule.ObjUtils.getOwnedFieldNames(o),s=r.spectrumDataValueOutputPrecisionCount||0,l=0,d=a.length;l<d;++l){var c=a[l],h=o[c];["xvalue","yvalue"].indexOf(c.toLowerCase())>=0&&n.setCmlElemAttribute(t,c,u.floatToCmlString(h,s),i),"structure"===c.toLowerCase()&&DataType.isObjectValue(h)?this.writePeakSubStructure(h,t,r):n.setCmlElemAttribute(t,c,h,i)}},getChildPeakStructureWriter:function(){var e=new Kekule.IO.CmlSpectrumPeakStructureWriter;return e&&(this.copySettingsToChildHandler(e),this._appendChildHandler(e)),e},writePeakSubStructure:function(e,t,r){var i=this.getChildPeakStructureWriter();i&&i.writeObj(e,t,r)},_peakHashToCmlHash:function(e){for(var t={},r=["xValue","yValue"],n=0,o=r.length;n<o;++n){var a=r[n],s=e[a];Kekule.ObjUtils.notUnset(s)&&(t[a]=s)}if(e.xUnits&&(t.xUnits=i.metricsUnitSymbolToCmlUnitStr(e.xUnits)),e.yUnits&&(t.yUnits=i.metricsUnitSymbolToCmlUnitStr(e.yUnits)),e.shape&&(t.peakShape=u.kekulePeakShapeToCml(e.shape)),e.multiplicity&&(t.peakMultiplicity=u.kekulePeakMultiplicityToCml(e.multiplicity)),e.assignments&&e.assignments.length){var l=[],d=[];for(n=0,o=e.assignments.length;n<o;++n){var c=e.assignments[n],h=c instanceof Kekule.AbstractAtom?l:c instanceof Kekule.ChemStructureConnector?d:null;if(h){var p=c.getId&&c.getId()||this.autoIdentifyForObj(c);p&&h.push(p)}}l.length&&(t.atomRefs=l.join(" ")),d.length&&(t.bondRefs=d.join(" "))}return t}}),Kekule.IO.CmlSpectrumPeakStructureReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakStructureReader",doReadElement:function(e,t,r,i){for(var n={},o=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(e,null,!0,this.getDomHelper()),a=Kekule.ObjUtils.getOwnedFieldNames(o),s=0,l=a.length;s<l;++s){var u=a[s],d=u.toLowerCase(),c=o[u];Kekule.IO.CML.ATOMS_REF_ATTRIBS.indexOf(u)>=0||Kekule.IO.CML.BONDS_REF_ATTRIBS.indexOf(u)>=0||("units"===d?n.unit=Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(c)||Kekule.IO.CmlUtils.getCmlNsValueLocalPart(c):n[u]=c)}return n}}),Kekule.IO.CmlSpectrumPeakStructureWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakStructureWriter",doCreateElem:function(e,t){return this.createChildElem("peakStructure",t)},doWriteObject:function(e,t,r){for(var o=this.getDomHelper(),a=Kekule.ObjUtils.getOwnedFieldNames(e),s=0,l=a.length;s<l;++s){var u=a[s],d=e[u];"unit"===u&&(d=i.metricsUnitSymbolToCmlUnitStr(d)),n.setCmlElemAttribute(t,u,d,o)}return t}}),Kekule.IO.CmlSpectrumDataAxisReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumDataAxisReader",initProperties:function(){this.defineProp("axisSymbol",{dataType:DataType.STRING,serializable:!1}),this.defineProp("childArrayObj",{dataType:DataType.OBJECT,serializable:!1})},doReadElement:function(e,t,i,n){var o=r.getLocalName(e).toLowerCase(),a=o.indexOf("axis"),s=o.substring(0,a),l=r.getSameNSAttributeValue(e,"multiplierToData",this.getDomHelper());l&&(l=parseFloat(l)),this.setAxisSymbol(s),this.tryApplySuper("doReadElement",[e,t,i]),this.iterateChildElements(e,t,i);var u={symbol:this.getAxisSymbol(),array:this.getChildArrayObj()};return l&&(u.dataMultiplier=l),u},doReadChildElement:function(e,t,i){if("array"!==r.getLocalName(e).toLowerCase())return this.tryApplySuper("doReadChildElement",[e,t,i]);var n=this.doGetChildElementReader(e);if(n){n.setExpandSteppedArray&&n.setExpandSteppedArray(!1),n.setDefaultItemDataType&&n.setDefaultItemDataType("xsd:float");var o=n.readElement(e,t,i);o&&this.setChildArrayObj(o)}}}),Kekule.IO.CmlSpectrumDataReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumDataReader",doReadElement:function(e,t,r,i){if(t instanceof Kekule.Spectroscopy.Spectrum){var n=new Kekule.Spectroscopy.SpectrumDataSection;t.appendDataSection(n);var o=this.iterateChildElements(e,t,r);return this._handleChildResults(o,n),n}},_handleChildResults:function(e,t){for(var i=[],n=0,o=e.length;n<o;++n){var a=e[n],s=a.element;r.getLocalName(s).toLowerCase().indexOf("axis")>=0&&("x"===a.result.symbol.toLowerCase()?i.unshift(a.result):i.push(a.result))}i.length>=2&&this._fillSpectrumData(i,t)},_fillSpectrumData:function(e,t){for(var r=t.getParentSpectrum(),i=r.getData(),n=0,o=[],a=0,s=e.length;a<s;++a){var l=0===a,u=this._getAxisVarDefParams(e[a],l);o.push(u);var d=e[a].array.size||e[a].array.values&&e[a].array.values.length;d>n&&(n=d)}var c=this._addSpectrumDataVarDefs(o,i,r);t.setLocalVarSymbols(c),this._setDataSectionLocalVarInfos(o,t);for(a=0;a<n;++a){for(var h=[],p=0,g=e.length;p<g;++p){var f=e[p].dataMultiplier||1,C=e[p].array.values;C?h.push(C[a]*f):h.push(void 0)}t.appendData(h)}t.setDataSorted(!0)},_getAxisVarDefParams:function(e,r){for(var i=e.symbol,n={symbol:i,dependency:r?Kekule.VarDependency.INDEPENDENT:Kekule.VarDependency.DEPENDENT},o={},a=e.array,s=t.getOwnedFieldNames(a),l=!1,u=0,d=s.length;u<d;++u){var c=s[u].toLowerCase(),h=a[s[u]];"unit"===c||"units"===c?(n.unit=Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(h),n.unit||n.displayLabel||(n.displayLabel=Kekule.IO.CmlUtils.getCmlNsValueLocalPart(h))):"title"===c?n.name=h:"start"===c||"end"===c||"size"===c||"stepsize"===c||"value"===c||"values"===c||"datatype"===c||(o[s[u]]=h,l=!0)}var p;return!a.values&&Kekule.ObjUtils.notUnset(a.start)&&Kekule.ObjUtils.notUnset(a.end)&&(p={start:a.start,end:a.end}),{symbol:i,initParams:n,continuousInfo:p,hasExtraInfo:l,extraInfo:o}},_addSpectrumDataVarDefs:function(e,t,r){for(var i=[],n=0,o=e.length;n<o;++n){var a=e[n].initParams,s=Kekule.IO.CmlSpectUtils.getSpectrumVarDef(r,a.symbol,a.unit,a.name,a.dependency);s&&!s.getDisplayLabel()&&a.displayLabel&&s.setDisplayLabel(a.displayLabel),s||(s=new Kekule.Spectroscopy.SpectrumVarDefinition(a),t.appendVariable(s)),i.push(s.getSymbol())}return i},_setDataSectionLocalVarInfos:function(e,t){for(var r=0,i=e.length;r<i;++r){var n=e[r],o=n.symbol,a=n.continuousInfo;if(a&&t.setContinuousVarRange(o,a.start,a.end),n.hasExtraInfo){var s=n.extraInfo,l=Kekule.ObjUtils.getOwnedFieldNames(s);for(r=0,i=l.length;r<i;++r)t.setLocalVarInfoValue(o,l[r],s[l[r]])}}}}),Kekule.IO.CmlSpectrumDataWriter=Class.create(Kekule.IO.CmlSpectrumDataSectionBaseWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumDataWriter",doCreateElem:function(e,t){return this.createChildElem("spectrumData",t)},doWriteObject:function(e,t,r){return this.writeSpectrumData(e,t,r)},writeSpectrumData:function(e,t,r){var i=this.getSpectrumDataSectionVarInfos(e);if(i.varCount<2);else{for(var n=["independent","dependent"],o=[],a=0,s=n.length;a<s;++a){var l=n[a],d="independent"===l,c={_tagName:d?"xaxis":"yaxis",varSymbol:i[l].symbol,unit:i[l].unitSymbol,title:i[l].name,dataType:DataType.FLOAT,size:DataType.count||e.getDataCount()},h=i[l].range;h?(c.start=h.fromValue,c.end=h.toValue,c.isContinuous=!0):c.values=[],c=this._prepareUnitConversionInfoForArrayObj(c,d,e,r),o.push(c)}var p=r&&r.spectrumDataValueOutputPrecisionCount||0;e.forEach(function(e,t){for(var r=0,i=o.length;r<i;++r){var n=o[r]._originUnitObj&&o[r]._unitObj;if(!o[r].isContinuous){var a=e[o[r].varSymbol]||0;n&&(a=o[r]._originUnitObj.convertValueTo(a,o[r]._unitObj)),o[r].values.push(u.floatToCmlString(a,p))}}});var g=this.doGetChildObjectWriter(DataType.ARRAY,e,this);if(g)for(a=0,s=o.length;a<s;++a){c=o[a];var f=this.createChildElem(c._tagName,t);g.writeObject(c,f,r)}}},_prepareUnitConversionInfoForArrayObj:function(e,t,r,i){var n=r.getParentSpectrum();if(t&&n&&n.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.NMR&&i.autoConvertNmrDataFreqToUnit){var o=e.unit&&Kekule.Unit.getUnit(e.unit),a=Kekule.Unit.getUnit(i.autoConvertNmrDataFreqToUnit);o&&a&&o.category===a.category&&o!==a&&(e.unit=i.autoConvertNmrDataFreqToUnit,e._originUnitObj=o,e._unitObj=a,e.start&&(e.start=o.convertValueTo(e.start,a)),e.end&&(e.end=o.convertValueTo(e.end,a)))}return e}}),Kekule.IO.CmlSpectrumReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumReader",initialize:function(){this.tryApplySuper("initialize"),this._spectrumWithRefMolecules=[]},initProperties:function(){this.defineProp("convention",{dataType:DataType.STRING,serializable:!1}),this.defineProp("additionalRefMolecules",{dataType:DataType.ARRAY,serializable:!1})},doFinalize:function(){this._spectrumWithRefMolecules=null,this.setPropStoreFieldValue("additionalRefMolecules",null),this.tryApplySuper("doFinalize")},readElement:function(t,r,i,n){this.setAdditionalRefMolecules([]);var o=this.tryApplySuper("readElement",[t,r,i,n]),a=this.getAdditionalRefMolecules();if(a.length){var s=e.clone(a);s.push(o);var l=this._createChildObjsHolder(s,n.defaultRootObjListHolder);return o.setRefMolecules(a),l}return o},doReadElement:function(e,t,r,i){return this.readSpectrum(e,this.getDomHelper(),i)},doReadChildElement:function(e,t,i){var n=r.getLocalName(e).toLowerCase();return this._isInfoListElemTagName(n)?this.tryApplySuper("doReadChildElement",[e,null,i]):this.tryApplySuper("doReadChildElement",[e,t,i])},doDoneReadingDocument:function(){for(var e=this._spectrumWithRefMolecules,t=0,r=e.length;t<r;++t){for(var i=e[t],n=i.getOwner(),o=i[Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME]||[],a=[],s=0,l=o.length;s<l;++s){var u=o[s].trim();if(u){var d=this.getLoadedObjById(u)||n&&n.getObjById&&n.getObjById(u);d&&a.push(d)}}a.length&&i.setRefMolecules(a),delete i[Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME]}this._spectrumWithRefMolecules=[]},_isInfoListElemTagName:function(e){return["metadatalist","parameterlist","conditionlist","substancelist"].indexOf(e)>=0},readSpectrum:function(e,t,r){var i=new Kekule.Spectroscopy.Spectrum;this.readSpectrumAttribs(i,e,t);var n=this;this.iterateChildElements(e,i,this,function(e,t){n._handleChildResult(e,t,i,r)});return i},readSpectrumAttribs:function(e,t,r){for(var i=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,null,!0,r),n=Kekule.ObjUtils.getOwnedFieldNames(i),o=[],a=0,s=n.length;a<s;++a){var l=n[a],u=i[l];switch(Kekule.IO.CML.MOL_REF_ATTRIBS.indexOf(l)>=0&&o.push((u||"").trim()),l){case"id":this.setObjId(e,u);break;case"title":e.setTitle(u);break;case"type":var d=Kekule.IO.CmlSpectUtils.cmlSpectrumTypeToKekule(u);e.setSpectrumType(d);break;case"convention":this.setConvention(u);break;default:e.setInfoValue(l,u)}}if(o.length){var c=o.join(" ").split(/\s/);e[Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME]=c,this._spectrumWithRefMolecules.push(e)}},_handleChildResult:function(e,t,i,n){var o=r.getLocalName(e).toLowerCase();"spectrumdata"===o||"peaklist"===o||("sample"===o&&n.enableExtractSampleInsideSpectrum?this._handleSampleData(t,i,n):this._isInfoListElemTagName(o)&&this._handleInfoData(o,t,i))},_handleSampleData:function(e,t,r){for(var i=[],n=0,o=e.length;n<o;++n){var a=e[n];a instanceof Kekule.Molecule&&(i.push(a),r.autoHideSampleInsideSpectrum&&a.setVisible&&a.setVisible(!1))}i.length&&this.setAdditionalRefMolecules(this.getAdditionalRefMolecules().concat(i))},_handleInfoData:function(e,t,r){for(var i=function(e,t,i,n){if("metadatalist"===n){var o=i.metadataType;o===l.ANNOTATION_METATYPE?r.setAnnotation(e,t):o===l.INFO_METATYPE?r.setInfoValue(e,t):r.setMeta(e,t)}},n=function(e,t){var r=null;return"metadatalist"===e?r=null:"parameterlist"===e?r=t.setParameter:"conditionlist"===e?r=t.setCondition:"substancelist"===e||(r=t.setAnnotation),r}(e,r),o=0,a=t.length;o<a;++o){var s,u,d=n,c=t[o];if(c.key)s=c.key,u=c.value;else if(c instanceof Kekule.Scalar){s=c.getInfoValue("dictRef")||c.getName(),u=c}if(s){var h=this.getPrefixForNamespaceUri(l.JCAMP_NAMESPACE_URI)||null,p=r.getSpectrumType(),g=this._convertCmlSpectrumInfoKey(s,p,h);this._processCmlSpectrumInfoItem(s,g,u,c,r,e)||(d?d.apply(r,[g,u]):i(g,u,c,e))}}},_convertCmlSpectrumInfoKey:function(e,t,r){return u.cmlSpectrumInfoDataKeyToKekule(e,t,r)},_processCmlSpectrumInfoItem:function(e,t,r,i,n,o){if("NMR.ObserveFrequency"===t){if(r instanceof Kekule.Scalar){var a=r.getValue(),s=r.getUnit();if(s&&s===Kekule.Unit.Frequency.HERTZ.symbol)return Kekule.UnitUtils.convertValue(a,s,Kekule.Unit.Frequency.MEGAHERTZ)<1&&r.setUnit(Kekule.Unit.Frequency.MEGAHERTZ.symbol),n.setParameter(t,r),!0}}else if("NMR.ObserveNucleus"===t&&"string"==typeof r){var l=r.indexOf("C")>=0&&r.indexOf("13")>=0?Kekule.Spectroscopy.SpectrumNMR.TargetNucleus.C13:Kekule.Spectroscopy.SpectrumNMR.TargetNucleus.H;return n.setParameter(t,l),!0}return!1}}),Kekule.IO.CmlSpectrumWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumWriter",initProperties:function(){this.defineProp("convention",{dataType:DataType.STRING,serializable:!1})},doCreateElem:function(e,t){return this.createChildElem("spectrum",t)},doWriteObject:function(e,t,r){var i=this.getSpectNamespaces();return this.addNamespaces(t.ownerDocument,i),this._addSchemaLocation(t.ownerDocument.documentElement),this.writeSpectrum(e,t,r)},getObjInfoKeysNeedToSaveToMetaList:function(t){var r=this.tryApplySuper("getObjInfoKeysNeedToSaveToMetaList",[t]);return r&&(r=e.exclude(r,["metaData","parameters","conditions","annotations"])),r},doWriteObjInfoValueItem:function(e,t,r,i,n){return this.writeObjMetaValueToListElem(r,e,t,l.INFO_METATYPE,i)},writeSpectrum:function(e,t,r){this.writeSpectrumAttribs(e,t,r),this.writeSpectrumInfoLists(e,t,r),this.writeSpectrumDataSections(e,t,r)},writeSpectrumAttribs:function(e,t){var r=[],i=e.getTitle();i&&r.push({key:"title",value:i});var n=Kekule.IO.CmlSpectUtils.kekuleSpectrumTypeToCml(e.getSpectrumType()||"");n&&r.push({key:"type",value:n});for(var o=0,a=r.length;o<a;++o)Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,r[o].key,r[o].value,this.getDomHelper());var s=e.getRefMolecules();if(s&&s.length){var l=[];for(o=0,a=s.length;o<a;++o){var u=s[o],d=u&&u.getId&&u.getId();d||(d=this.autoIdentifyForObj(u)),d&&l.push(d)}if(l.length){var c=l.length>1?Kekule.IO.CML.MOL_REF_ATTRIBS[1]:Kekule.IO.CML.MOL_REF_ATTRIBS[0];Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,c,l.join(" "),this.getDomHelper())}}},writeSpectrumInfoLists:function(e,t,r){for(var i=this.getDomHelper(),n=e.getSpectrumInfoCategories(),o=this._getSpectrumInfoProcessors(),a=e.getSpectrumType(),s=this.getPrefixForNamespaceUri(l.JCAMP_NAMESPACE_URI)||null,u=0,d=n.length;u<d;++u){var c,h=n[u],p=o[h];if(p&&p.listElemGetter&&p.infoWriter&&(c=p.listElemGetter.apply(this,[t,i])))for(var g=e.getSpectrumInfoKeysOfCategory(h),f=0,C=g.length;f<C;++f){var m=g[f],T=e.getSpectrumInfoValue(m,h);"NMR.ObserveFrequency"===m&&T instanceof Kekule.Scalar&&r.autoConvertNmrDataFreqToUnit&&(T=this._convertScalarUnit(T,r.autoConvertNmrDataFreqToUnit)),Kekule.ObjUtils.notUnset(T)&&p.infoWriter.apply(this,[e,Kekule.IO.CmlSpectUtils.kekuleSpectrumInfoDataKeyToCml(m,a,s),T,c,r])}}},_convertScalarUnit:function(e,t){var r=e.getUnit(),i=e.getValue();if(i){var n=Kekule.Unit.getUnit(r),o=Kekule.Unit.getUnit(t);if(n&&o&&n.category===o.category&&n!==o){var a=e.clone();return a.setUnit(t),a.setValue(n.convertValueTo(i,o)),a}}return e},_getSpectrumInfoProcessors:function(){return{metaData:{listElemGetter:this._spectrumInfoListElemGetter.bind(this,"metaDataList"),infoWriter:this._writeSpectrumMeta},annotations:{listElemGetter:this._spectrumInfoListElemGetter.bind(this,"metaDataList"),infoWriter:this._writeSpectrumAnnotation},conditions:{listElemGetter:this._spectrumInfoListElemGetter.bind(this,"conditionList"),infoWriter:this._writeSpectrumCondition},parameters:{listElemGetter:this._spectrumInfoListElemGetter.bind(this,"parameterList"),infoWriter:this._writeSpectrumParameter}}},_spectrumInfoListElemGetter:function(e,t,r){var i=r.getElementsByTagNameNS(this.getCoreNamespaceURI(),e,t)[0];return i||(i=this.createChildElem(e,t)),i},_writeSpectrumMeta:function(e,t,r,i,n){this.writeObjMetaValueToListElem(e,t,r,null,i,null,n)},_writeSpectrumAnnotation:function(e,t,r,i,n){this.writeObjMetaValueToListElem(e,t,r,l.ANNOTATION_METATYPE,i,null,n)},_writeSpectrumCondition:function(e,t,r,i,n){if(r instanceof ObjectEx){var o=this.doGetChildObjectWriter(r,e,this);o&&o.writeObject(r,i,n)}else this.writeObjMetaValueToListElem(e,t,r,null,i,null,n)},_writeSpectrumParameter:function(e,t,r,i,n){var o=this.createChildElem("parameter",i);if(o.setAttribute("dictRef",t),DataType.isSimpleValue(r))o.setAttribute("value",DataType.StringUtils.serializeValue(r));else if(DataType.isObjectExValue(r)){var a=this.doGetChildObjectWriter(r,e,this);a&&a.writeObject(r,o,n)}},writeSpectrumDataSections:function(e,t,r){for(var i=0,n=e.getDataSectionCount();i<n;++i){var o=e.getDataSectionAt(i),a=this.createDataSectionWriter(o);a&&a.writeObject(o,t,r)}},createDataSectionWriter:function(e){var t=e.getMode()===Kekule.Spectroscopy.DataMode.PEAK?Kekule.IO.CmlSpectrumPeakListWriter:Kekule.IO.CmlSpectrumDataWriter,r=t&&new t;return r&&(this.copySettingsToChildHandler(r),this._appendChildHandler(r)),r},getSpectNamespaces:function(){var e=function(e,t){return{prefix:e,namespaceURI:t}};return[e(l.XML_SCHEMA_INSTANCE_NAMESPACE_DEF_PREFIX,l.XML_SCHEMA_INSTANCE_NAMESPACE_URI),e(l.SI_UNITS_NAMESPACE_DEF_PREFIX,l.SI_UNITS_NAMESPACE_URI),e(l.UNITS_NAMESPACE_DEF_PREFIX,l.UNITS_NAMESPACE_URI),e(l.JSPECVIEW_NAMESPACE_DEF_PREFIX,l.JSPECVIEW_NAMESPACE_URI),e(l.JCAMP_NAMESPACE_DEF_PREFIX,l.JCAMP_NAMESPACE_URI),e(l.JCAMP_UNITS_NAMESPACE_DEF_PREFIX,l.JCAMP_UNITS_NAMESPACE_URI),e(l.CML_DICT_NAMESPACE_DEF_PREFIX,l.CML_DICT_NAMESPACE_URI)]},_addSchemaLocation:function(e){this.getDomHelper().setAttributeNS(l.XML_SCHEMA_INSTANCE_NAMESPACE_URI,l.CMLSPECT_SCHEMA_LOCATIONS_ATTRIBNAME,l.CMLSPECT_SCHEMA_LOCATIONS.join("    "),e)}}),Kekule.Spectroscopy.MetaPropNamespace.register("cml");var d=Kekule.IO.CmlElementReaderFactory;d.register("spectrum",Kekule.IO.CmlSpectrumReader),d.register("peakList",Kekule.IO.CmlSpectrumPeakListReader),d.register("peak",Kekule.IO.CmlSpectrumPeakReader),d.register("peakStructure",Kekule.IO.CmlSpectrumPeakStructureReader),d.register("spectrumData",Kekule.IO.CmlSpectrumDataReader),d.register(["parameterList","substanceList"],Kekule.IO.CmlBaseListReader),d.register("sample",Kekule.IO.CmlSampleReader),d.register(["xaxis","yaxis"],Kekule.IO.CmlSpectrumDataAxisReader),Kekule.IO.CmlElementWriterFactory.register("Kekule.Spectroscopy.Spectrum",Kekule.IO.CmlSpectrumWriter);var c=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.CML);Kekule.IO.ChemDataWriterManager.register("cml",Kekule.IO.CmlWriter,[Kekule.Spectroscopy.Spectrum],[c])}(),function(){"use strict";Kekule._registerAfterLoadSysProc(function(){if(Kekule.Render&&Kekule.Render.ChemObj2DRenderer){Kekule.globalOptions.add("render.spectrum",{continuousSpectrumResampleRatio:1});var e=Kekule.CoordUtils,t=Kekule.ArrayUtils;Kekule.Render.SpectrumDisplayConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.SpectrumDisplayConfigs",initProperties:function(){this.addHashConfigProp("defSize2DRatio"),this.addBoolConfigProp("reversedAxises",!1),this.addBoolConfigProp("reverseIndependentDataDirection",!1),this.addBoolConfigProp("reverseDependentDataDirection",!1),this.addBoolConfigProp("reverseIndependentAxisAlign",!1),this.addBoolConfigProp("reverseDependentAxisAlign",!1),this.addStrConfigProp("dataColor","#000000"),this.addFloatConfigProp("dataStrokeWidthRatio",.025),this.addFloatConfigProp("dataStrokeWidthMin",1),this.addFloatConfigProp("dataStrokeWidthMax",void 0),this.addFloatConfigProp("dataStrokeWidthFixed",void 0),this.addFloatConfigProp("visibleIndependentDataRangeFrom",0),this.addFloatConfigProp("visibleIndependentDataRangeTo",1),this.addFloatConfigProp("visibleDependentDataRangeFrom",-.05),this.addFloatConfigProp("visibleDependentDataRangeTo",1.05),this.addFloatConfigProp("visibleIndependentDataRangeFrom_Peak",-.05),this.addFloatConfigProp("visibleIndependentDataRangeTo_Peak",1.05),this.addFloatConfigProp("visibleDependentDataRangeFrom_Peak",-.05),this.addFloatConfigProp("visibleDependentDataRangeTo_Peak",1.05),this.addFloatConfigProp("visibleIndependentDataRangeFrom_Continuous",0),this.addFloatConfigProp("visibleIndependentDataRangeTo_Continuous",1),this.addFloatConfigProp("visibleDependentDataRangeFrom_Continuous",-.05),this.addFloatConfigProp("visibleDependentDataRangeTo_Continuous",1.05),this.addBoolConfigProp("displayIndependentAxis",!0),this.addBoolConfigProp("displayIndependentAxisScales",!0),this.addBoolConfigProp("displayIndependentAxisLabel",!0),this.addBoolConfigProp("displayIndependentAxisUnit",!0),this.addBoolConfigProp("displayDependentAxis",!0),this.addBoolConfigProp("displayDependentAxisScales",!0),this.addBoolConfigProp("displayDependentAxisLabel",!0),this.addBoolConfigProp("displayDependentAxisUnit",!0),this.addBoolConfigProp("displaySpectrum",!0),this.addStrConfigProp("axisScaleLabelFontFamily","Arial, Helvetica, sans-serif"),this.addFloatConfigProp("axisScaleLabelFontSize",7),this.addStrConfigProp("axisScaleLabelColor","#000000"),this.addStrConfigProp("axisLabelFontFamily","Arial, Helvetica, sans-serif"),this.addFloatConfigProp("axisLabelFontSize",10),this.addStrConfigProp("axisLabelColor","#000000"),this.addStrConfigProp("axisColor","#000000"),this.addFloatConfigProp("axisWidthRatio",.025),this.addFloatConfigProp("axisWidthMin",1),this.addFloatConfigProp("axisWidthMax",void 0),this.addFloatConfigProp("axisWidthFixed",void 0),this.addFloatConfigProp("axisScaleMarkSizeRatio",.1),this.addFloatConfigProp("axisScaleMarkSizeMin",3),this.addFloatConfigProp("axisScaleMarkSizeMax",void 0),this.addFloatConfigProp("axisScaleMarkSizeFixed",void 0),this.addFloatConfigProp("axisUnlabeledScaleSizeRatio",.7),this.addIntConfigProp("axisScaleMarkPreferredCount",10),this.addFloatConfigProp("axisLabelPaddingRatio",.02),this.addFloatConfigProp("axisScaleLabelPaddingRatio",.02)},initPropDefValues:function(){this.tryApplySuper("initPropDefValues"),this.setDefSize2DRatio({x:12,y:8})},doGetPropNameToHashPrefix:function(){return"spectrum_"}}),ClassEx.extendMethod(Kekule.Render.Render2DConfigs,"initProperties",function(e){e(),this.addConfigProp("spectrumDisplayConfigs","Kekule.Render.SpectrumDisplayConfigs")}),ClassEx.extendMethod(Kekule.Render.Render2DConfigs,"initPropDefValues",function(e){e(),this.setPropStoreFieldValue("spectrumDisplayConfigs",new Kekule.Render.SpectrumDisplayConfigs)}),ClassEx.extendMethod(Kekule.Spectroscopy.Spectrum,"initPropValues",function(t){t();var r=this.getSize2D();if(!r){var i=Kekule.Render.Render2DConfigs.getInstance(),n=i.getSpectrumDisplayConfigs().getDefSize2DRatio(),o=i.getLengthConfigs().getDefScaleRefLength();n&&o&&(r=e.multiply(n,o)),this.setSize2D(r)}}),ClassEx.extendMethod(Kekule.Spectroscopy.Spectrum,"doGetObjAnchorPosition",function(e,t){return Kekule.ObjAnchorPosition.CENTER}),ClassEx.extend(Kekule.Spectroscopy.Spectrum,{getDisplayedDataSections:function(){return[this.getActiveDataSection()]},getPseudoRenderSubObject:function(e,t){var r=this.__$subRenderObjs$__;r||(r={},this.__$subRenderObjs$__=r);var i=r[e];return i||t||(i={parent:this},r[e]=i),i},isChildPseudoRenderSubObject:function(e){return this.__$subRenderObjs$__&&this.__$subRenderObjs$__.indexOf(e)>=0},getDataItemOverridenRenderOptions:function(e){for(var t=0,r=this.getDataSectionCount();t<r;++t){var i=this.getDataSectionAt(t);if(i.indexOfDataItem(e)>=0)return i.getDataItemOverridenRenderOptions(e)}return null},setDataItemRenderOptions:function(e,t){for(var r=0,i=this.getDataSectionCount();r<i;++r){var n=this.getDataSectionAt(r);n.indexOfDataItem(e)>=0&&n.setDataItemRenderOptions(e,t)}},setDataItemOverrideRenderOptions:function(e,t){for(var r=0,i=this.getDataSectionCount();r<i;++r){var n=this.getDataSectionAt(r);n.indexOfDataItem(e)>=0&&n.setDataItemOverrideRenderOptions(e,t)}},addDataItemOverrideRenderOptionItem:function(e,t){for(var r=0,i=this.getDataSectionCount();r<i;++r){var n=this.getDataSectionAt(r);n.indexOfDataItem(e)>=0&&n.addDataItemOverrideRenderOptionItem(e,t)}},removeDataItemOverrideRenderOptionItem:function(e,t){for(var r=0,i=this.getDataSectionCount();r<i;++r){var n=this.getDataSectionAt(r);n.indexOfDataItem(e)>=0&&n.removeDataItemOverrideRenderOptionItem(e,t)}}}),ClassEx.extend(Kekule.Spectroscopy.SpectrumDataSection,{_getDataItemSpecifiedRenderOptions:function(e,t){var r=this.getExtraInfoOf(e);if(r||(r=this.createDefaultExtraInfoObjectFor(e)),r)return r instanceof ObjectEx&&r.hasProperty(t)?r.getPropValue(t):r[t]},_setDataItemSpecifiedRenderOptions:function(e,t,r){var i=this.getExtraInfoOf(e);i||(i=this.createDefaultExtraInfoObjectFor(e)),i&&(i instanceof ObjectEx&&i.hasProperty(t)?i.setPropValue(t,r):i[t]=r)},getDataItemRenderOptions:function(e){return this._getDataItemSpecifiedRenderOptions(e,"renderOptions")},setDataItemRenderOptions:function(e,t){return this._setDataItemSpecifiedRenderOptions(e,"renderOptions",t)},getDataItemOverrideRenderOptionItems:function(e){return this._getDataItemSpecifiedRenderOptions(e,"overrideRenderOptionItems")},setDataItemOverrideRenderOptionItems:function(e,t){return this._setDataItemSpecifiedRenderOptions(e,"overrideRenderOptionItems",t)},addDataItemOverrideRenderOptionItem:function(e,t){var r=this.getExtraInfoOf(e);if(r||(r=this.createDefaultExtraInfoObjectFor(e)),r)if(r.addOverrideRenderOptionItem)r.addOverrideRenderOptionItem(t);else{var i=this.getDataItemOverrideRenderOptionItems();if(i){var n=i.indexOf(t);n>=0&&i.splice(n,1),i.push(t)}else i=[t],this.setDataItemOverrideRenderOptionItems(e,i)}},removeDataItemOverrideRenderOptionItem:function(e,t){var r=this.getExtraInfoOf(e);if(r)if(r.removeOverrideRenderOptionItem)r.removeOverrideRenderOptionItem(t);else{var i=this.getDataItemOverrideRenderOptionItems();if(i){var n=i.indexOf(t);n>=0&&i.splice(n,1)}}},getDataItemOverridenRenderOptions:function(e){var t=this.getExtraInfoOf(e);if(t){if(t.getOverriddenRenderOptions)return t.getOverriddenRenderOptions();for(var r=t.renderOptions||{},i=Object.extend({},r),n=t.overrideRenderOptionItems||[],o=0,a=n.length;o<a;++o)i=Object.extend(i,n[o]);return i}return null}}),ClassEx.extendMethod(Kekule.Spectroscopy.SpectrumDataSection,"_extractAllExtraInfoOfDataItems",function($origin){for(var e=$origin()||[],t=[],r=0,i=e.length;r<i;++r){var n=e[r];if(n&&!(n instanceof Kekule.ChemObject)&&DataType.isObjectValue(n)&&n.overrideRenderOptions){var o=Object.create(n);o.overrideRenderOptions=void 0,t.push(o)}else t.push(n)}return t}),Kekule._registerAfterLoadSysProc(function(){var e,r,i,n,o=function(e,r,i,n,o){for(var a=t.toArray(n),s=o||[""],l=0,u=a.length;l<u;++l)for(var d=0,c=s.length;d<c;++d){var h=s[d]?s[d]+r.upperFirst():r;e.push({name:"spectrum_"+h,dataType:i,targetClass:a[l]})}};if(Kekule.PropertyEditor&&Kekule.PropertyEditor.ChemRender2DOptionsEditor){var a=ClassEx.getPrototype(Kekule.PropertyEditor.ChemRender2DOptionsEditor);a.CHILD_FIELD_INFOS=a.CHILD_FIELD_INFOS.concat((e=[],r=Kekule.Spectroscopy.Spectrum,i=Kekule.Spectroscopy.SpectrumDataSection,n=["","independent","dependent"],o(e,"reversedAxises",DataType.BOOL,r),o(e,"reverseIndependentDataDirection",DataType.BOOL,r),o(e,"reverseDependentDataDirection",DataType.BOOL,r),o(e,"reverseIndependentAxisAlign",DataType.BOOL,r),o(e,"reverseDependentAxisAlign",DataType.BOOL,r),o(e,"dataColor",DataType.STRING,[r,i]),o(e,"dataStrokeWidthRatio",DataType.FLOAT,[r,i]),o(e,"dataStrokeWidthMin",DataType.NUMBER,[r,i]),o(e,"dataStrokeWidthMax",DataType.NUMBER,[r,i]),o(e,"dataStrokeWidthFixed",DataType.NUMBER,[r,i]),o(e,"visibleIndependentDataRangeFrom_Continuous",DataType.FLOAT,r),o(e,"visibleIndependentDataRangeTo_Continuous",DataType.FLOAT,r),o(e,"visibleDependentDataRangeFrom_Continuous",DataType.FLOAT,r),o(e,"visibleDependentDataRangeTo_Continuous",DataType.FLOAT,r),o(e,"visibleIndependentDataRangeFrom_Peak",DataType.FLOAT,r),o(e,"visibleIndependentDataRangeTo_Peak",DataType.FLOAT,r),o(e,"visibleDependentDataRangeFrom_Peak",DataType.FLOAT,r),o(e,"visibleDependentDataRangeTo_Peak",DataType.FLOAT,r),o(e,"displayIndependentAxis",DataType.BOOL,r),o(e,"displayIndependentAxisScales",DataType.BOOL,r),o(e,"displayIndependentAxisLabel",DataType.BOOL,r),o(e,"displayIndependentAxisUnit",DataType.BOOL,r),o(e,"displayDependentAxis",DataType.BOOL,r),o(e,"displayDependentAxisScales",DataType.BOOL,r),o(e,"displayDependentAxisLabel",DataType.BOOL,r),o(e,"displayDependentAxisUnit",DataType.BOOL,r),o(e,"displaySpectrum",DataType.BOOL,r),o(e,"axisScaleLabelFontFamily",DataType.STRING,r,n),o(e,"axisScaleLabelFontSize",DataType.NUMBER,r,n),o(e,"axisScaleLabelColor",DataType.STRING,r,n),o(e,"axisLabelFontFamily",DataType.STRING,r,n),o(e,"axisLabelFontSize",DataType.NUMBER,r,n),o(e,"axisLabelColor",DataType.STRING,r,n),o(e,"axisColor",DataType.STRING,r,n),o(e,"axisWidthRatio",DataType.FLOAT,r,n),o(e,"axisWidthMin",DataType.NUMBER,r,n),o(e,"axisWidthMax",DataType.NUMBER,r,n),o(e,"axisWidthFixed",DataType.NUMBER,r,n),o(e,"axisScaleMarkSizeRatio",DataType.FLOAT,r,n),o(e,"axisScaleMarkSizeMin",DataType.NUMBER,r,n),o(e,"axisScaleMarkSizeMax",DataType.NUMBER,r,n),o(e,"axisScaleMarkSizeFixed",DataType.NUMBER,r,n),o(e,"axisUnlabeledScaleSizeRatio",DataType.FLOAT,r,n),o(e,"axisScaleMarkPreferredCount",DataType.NUMBER,r,n),o(e,"axisLabelPaddingRatio",DataType.FLOAT,r,n),o(e,"axisScaleLabelPaddingRatio",DataType.NUMBER,r,n),e))}}),Kekule.Render.CoordAxisRender2DUtils={drawAxises:function(e,t,i,n,o,a){var s=function(e,t,r,i){for(var n=Kekule.Render.RichTextUtils,o=[],a=i?Math.round(Math.log10(r)):null,s=0,l=e.length;s<l;++s){var u,d=e[s],c=(a?d/r:d).toFixed(t);if(!a||Kekule.NumUtils.isFloatEqual(c,0))u=n.strToRichText(c);else{u=n.createGroup(null,{charDirection:Kekule.Render.TextDirection.LTR});var h=n.appendText2(u,c+"×10");n.appendText(u,a.toFixed(0),{textType:Kekule.Render.RichText.SUP,refItem:h})}o.push(u)}return o},l=!!o.abscissaDataRange,u=!!o.ordinateDataRange;if(!l&&!u)return null;var d=l&&o.abscissaScales?s(o.abscissaScales,o.abscissaScaleFixedDigitCountAfterPoint,o.abscissaScaleBase,o.abscissaScaleUseSciForm):null,c=u&&o.ordinateScales?s(o.ordinateScales,o.ordinateScaleFixedDigitCountAfterPoint,o.ordinateScaleBase,o.ordinateScaleUseSciForm):null,h=Kekule.Render.RichTextUtils,p=Object.create(o);if(l){if(p.abscissaLabel&&p.abscissaUnitLabel){var g=Kekule.Render.RichTextUtils.createGroup(null,{charDirection:Kekule.Render.TextDirection.LTR});h.append(g,p.abscissaLabel),h.appendText(g," ("),h.append(g,p.abscissaUnitLabel),h.appendText(g,")"),p.abscissaLabel=g}else p.abscissaLabel=p.abscissaLabel||p.abscissaUnitLabel;p.abscissaUnitLabel=null}if(u){if(p.ordinateLabel&&p.ordinateUnitLabel){g=Kekule.Render.RichTextUtils.createGroup(null,{charDirection:Kekule.Render.TextDirection.LTR});h.append(g,p.ordinateLabel),h.appendText(g," ("),h.append(g,p.ordinateUnitLabel),h.appendText(g,")"),p.ordinateLabel=g}else p.ordinateLabel=p.ordinateLabel||p.ordinateUnitLabel;p.ordinateUnitLabel=null}var f,C=l?r._estimateAxisSizes(e,t,i,n,d,p.abscissaUnitLabel,p.abscissaLabel,a,!0,1===p.abscissaAxisPosition):null,m=u?r._estimateAxisSizes(e,t,i,n,c,p.ordinateUnitLabel,p.ordinateLabel,a,!1,0===p.ordinateAxisPosition):null,T=e.createGroup(i),E=Object.create(n),_=Object.create(n);if(m&&(0===o.ordinateAxisPosition?E.x1+=Math.min(m.total.x,E.x2-E.x1):E.x2-=Math.min(m.total.x,E.x2-E.x1)),C&&(1===o.abscissaAxisPosition?_.y1+=Math.min(C.total.y,_.y2-_.y1):_.y2-=Math.min(C.total.y,_.y2-_.y1)),l){var S=d;(f=r._drawSingleAxis(e,t,i,E,p.abscissaDataRange,p.abscissaScales,S,p.abscissaUnitLabel,p.abscissaLabel,C,a,!0,1===p.abscissaAxisPosition,p.abscissaReversedDirection))&&e.addToGroup(f,T)}if(u){S=c;(f=r._drawSingleAxis(e,t,i,_,p.ordinateDataRange,p.ordinateScales,S,p.ordinateUnitLabel,p.ordinateLabel,m,a,!1,1!==p.ordinateAxisPosition,p.ordinateReversedDirection))&&e.addToGroup(f,T)}return{drawnElem:T,clientBox:{x1:E.x1,x2:E.x2,y1:_.y1,y2:_.y2},abscissaRenderBox:E,ordinateRenderBox:_}},_drawSingleAxis:function(e,t,r,i,n,o,a,s,l,u,d,c,h,p){var g=Kekule.Render.BoxXAlignment,f=Kekule.Render.BoxYAlignment,C=h,m=c?"x":"y",T=c?"y":"x",E=(c?d.abscissa:d.ordinate)||d,_={x:i.x2-i.x1,y:i.y2-i.y1};if(_.x<=0||_.y<=0)return null;var S,O,y=e.createGroup(r),A={x:i.x1,y:i.y1},I=c?!p:p,k={},b={},v=0;l&&(k[m]=A[m]+_[m]/2-u.axisLabel[m]/2*(c?1:-1),k[T]=A[T]+(C?u.axisLabelPadding[T]+u.axisLabel[T]/2:_[T]-(u.axisLabelPadding[T]+u.axisLabel[T]/2)),S=Object.extend(Object.extend({},E.axisLabel),{textBoxXAlignment:g.LEFT,textBoxYAlignment:f.CENTER}),c||(S.transforms=[{rotate:-Math.PI/2,center:Object.extend({},k)}]),O=t.drawEx(r,k,l,S).drawnObj,e.addToGroup(O,y),v+=u.axisLabel[T]+2*u.axisLabelPadding[T]);var R=Object.create(E.axis);if(R.strokeColor||(R.strokeColor=R.color),R.fillColor||(R.fillColor=R.color),o&&a){var D=n.max-n.min,N=c?{textBoxXAlignment:g.LEFT,textBoxYAlignment:C?f.BOTTOM:f.TOP}:{textBoxXAlignment:g.LEFT,textBoxYAlignment:f.CENTER};S=Object.extend(Object.create(E.scaleLabel),N),k[T]=C?A[T]+v+u.scaleLabel[T]+u.scaleLabelPadding[T]:A[T]+_[T]-v-u.scaleLabel[T]-u.scaleLabelPadding[T];var P={};P[T]=k[T];for(var M=_[m]/(a.length-1),K=M,L=1;K<u.scaleLabel[m]&&M>0;)++L,K+=M;for(var x=0,B=o.length;x<B;++x){var U=(I?o[x]-n.min:n.max-o[x])/D*_[m]+A[m];k[m]=U;var w=!1;if(x%L==0){if(P[m]=k[m],c){var F=t.measure(r,P,a[x],S);P.x=k.x-F.width/2}else if(C){F=t.measure(r,P,a[x],S);P.x=k.x-F.width}O=t.drawEx(r,P,a[x],S).drawnObj,e.addToGroup(O,y),w=!0}var V={x:k.x,y:k.y},j=u.scaleMark[T];V[T]+=(j+u.scaleLabelPadding[T])*(h?1:-1),w||(j*=R.unlabeledScaleSizeRatio||1),b[m]=U,b[T]=V[T]-j*(h?1:-1),O=e.drawLine(r,V,b,R),e.addToGroup(O,y)}v+=u.scaleLabel[T]+2*u.scaleLabelPadding[T]+u.scaleMark[T]}return k[m]=A[m],k[T]=C?A[T]+v+u.axis[T]/2:A[T]+_[T]-v-u.axis[T]/2,b[m]=k[m]+_[m],b[T]=k[T],O=e.drawLine(r,k,b,Object.extend({lineCap:"square"},R)),e.addToGroup(O,y),y},_estimateAxisSizes:function(e,t,r,i,n,o,a,s,l,u){var d=(l?s.abscissa:s.ordinate)||s,c={x:0,y:0},h={x:0,y:0};if(n&&n.length){var p=n[0],g=n[n.length-1],f=t.measure(r,{x:0,y:0},p,d.scaleLabel),C=t.measure(r,{x:0,y:0},g,d.scaleLabel);c={x:Math.max(f.width,C.width),y:Math.max(f.height,C.height)},h={x:d.scaleLabel.padding||0,y:d.scaleLabel.padding||0}}var m={x:0,y:0};if(o){var T=t.measure(r,{x:0,y:0},o,d.unitLabel);m.x=Math.max(c.x,T.width),m.y=Math.max(c.y,T.height)}var E={x:0,y:0},_={x:0,y:0};if(a){var S=t.measure(r,{x:0,y:0},a,d.axisLabel);E=l?{x:S.width,y:S.height}:{y:S.width,x:S.height},_={x:d.axisLabel&&d.axisLabel.padding||0,y:d.axisLabel&&d.axisLabel.padding||0}}var O=d.axis,y=l?{x:0,y:O.scaleMarkSize}:{x:O.scaleMarkSize,y:0},A=l?{x:0,y:O.strokeWidth}:{x:O.strokeWidth,y:0},I={};return l?(I.x=i.x2-i.x1,I.y=c.y+E.y+A.y+y.y+2*h.y+2*_.y):(I.y=i.y2-i.y1,I.x=c.x+E.x+A.x+y.x+2*h.x+2*_.x),{total:I,axis:A,scaleMark:y,scaleLabel:c,scaleLabelPadding:h,unitLabel:m,axisLabel:E,axisLabelPadding:_}}};var r=Kekule.Render.CoordAxisRender2DUtils;Kekule.Render.Spectrum2DRenderUtils={_getDataDefaultAxisDirection:function(e,t,r){var i=Kekule.Spectroscopy.SpectrumType,n=Kekule.Unit,o=!0;if((e===i.NMR&&t&&(o=!1),e===i.IR)&&(t&&r&&n.getUnit(r).category===n.WaveNumber))return!1;return o},_getDataDefaultAxisAlign:function(e,t,r){Kekule.Spectroscopy.SpectrumType,Kekule.Unit;return!0},getDefaultAxisDirectionAndAlignInfo:function(e,t,r){return{reversedDirection:!Kekule.Render.Spectrum2DRenderUtils._getDataDefaultAxisDirection(e,t,r),reversedAlign:!Kekule.Render.Spectrum2DRenderUtils._getDataDefaultAxisAlign(e,t,r)}}},Kekule.Render.Spectrum2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.Spectrum2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._initSectionDataDrawerMap()},_initSectionDataDrawerMap:function(){Kekule.Render.Spectrum2DRenderer.sectionDataDrawerMap[Kekule.Spectroscopy.DataMode.CONTINUOUS]=this.doDrawContinuousSectionData,Kekule.Render.Spectrum2DRenderer.sectionDataDrawerMap[Kekule.Spectroscopy.DataMode.PEAK]=this.doDrawPeakSectionData},_initSpectrumDefSize:function(t,r){if(!t.getSize2D()){var i=e.multiply(r.spectrum_defSize2DRatio,r.defScaleRefLength*(r.unitLength||1));t.setSize2D(i)}},doDrawSelf:function(e,t,r){var i=r._spectrum_render_enable_sub_bounds;this.tryApplySuper("doDrawSelf",[e,t,r]);var n=this.getChemObj();t||(t=this.getAutoBaseCoord(r)),this._initSpectrumDefSize(n,r);var o,a=n.getExposedContainerBox(),s={x:a.x1,y:a.y2},l={x:a.x2,y:a.y1},u=this.transformCoordToContext(e,n,s),d=this.transformCoordToContext(e,n,l),c=Kekule.CoordUtils.substract(d,u),h={x:t.x-c.x/2,y:t.y-c.y/2},p=h,g=Kekule.CoordUtils.add(h,c),f=Kekule.BoxUtils.createBox(p,g),C=this._getActualRenderOptions(e,n,r),m=this.doGetTargetDataSections(n);if(m&&m.length){var T=this.doGetDataVarInfos(m);if(T){var E,_=this._getAxisDirectionAndAlignInfo(e,n,O,T.varUnitSymbols,C),S=this._getDisplayRangeOfSections(n,n.getData(),m,T,_,C),O=T.varSymbols;if(Kekule.NumUtils.isFloatEqual(S[O.independant].min,S[O.independant].max)||Kekule.NumUtils.isFloatEqual(S[O.dependant].min,S[O.dependant].max))return Kekule.error(Kekule.$L("ErrorMsg.VISIBLE_DATA_RANGE_IS_EMPTY")),null;o=this.createDrawGroup(e);var y=this._prepareAxisRenderParamsAndOptions(this.getActualTargetContext(e),n,S,O,C,_),A=Kekule.Render.CoordAxisRender2DUtils.drawAxises(this.getDrawBridge(),this.getRichTextDrawer(),this.getActualTargetContext(e),f,y.drawParams,y.renderOptions);if(this.getRenderCache(e).spectrum_reversedAxises=C.spectrum_reversedAxises,A?(this.addToDrawGroup(A.drawnElem,o),E=A.clientBox,i&&(A.abscissaRenderBox&&this.basicDrawObjectUpdated(e,n.getPseudoRenderSubObject("abscissaIndicator"),n,this.createRectBoundInfo({x:A.abscissaRenderBox.x1,y:A.abscissaRenderBox.y1},{x:A.abscissaRenderBox.x2,y:A.abscissaRenderBox.y2}),Kekule.Render.ObjectUpdateType.ADD),A.ordinateRenderBox&&this.basicDrawObjectUpdated(e,n.getPseudoRenderSubObject("ordinateIndicator"),n,this.createRectBoundInfo({x:A.ordinateRenderBox.x1,y:A.ordinateRenderBox.y1},{x:A.ordinateRenderBox.x2,y:A.ordinateRenderBox.y2}),Kekule.Render.ObjectUpdateType.ADD))):E=f,!r||!1!==r.spectrum_displaySpectrum){var I=this.doCalcSprectrumTransformMatrixes(n,m,O,S,E,C,_),k=I.dataTransformMatrix;C.spectrumDataTransformMatrix=k,this.getRenderCache(e).spectrumDataTransformMatrix=k,this.getRenderCache(e).spectrumInvDataTransformMatrix=I.dataTransformInvMatrix;var b=this.doDrawDataSections(n,m,O,e,a,E,k,S,C);b&&this.addToDrawGroup(b,o),i&&this.basicDrawObjectUpdated(e,n.getPseudoRenderSubObject("data"),n,this.createRectBoundInfo({x:E.x1,y:E.y1},{x:E.x2,y:E.y2}),Kekule.Render.ObjectUpdateType.ADD)}this.basicDrawObjectUpdated(e,n,n,this.createRectBoundInfo(p,g),Kekule.Render.ObjectUpdateType.ADD)}}return o},_getActualRenderOptions:function(e,t,r){var i=t.getData().getSections().getRenderOptions(),n=Object.create(r);return n=Object.extend(n,i)},_getAxisDirectionAndAlignInfo:function(e,t,r,i,n){var o=t.getSpectrumType(),a=Kekule.Render.Spectrum2DRenderUtils.getDefaultAxisDirectionAndAlignInfo(o,!0,i.independant),s=Kekule.Render.Spectrum2DRenderUtils.getDefaultAxisDirectionAndAlignInfo(o,!1,i.dependant);return n.spectrum_reverseIndependentDataDirection&&(a.reversedDirection=!a.reversedDirection),n.spectrum_reverseIndependentAxisAlign&&(a.reversedAlign=!a.reversedAlign),n.spectrum_reverseDependentDataDirection&&(s.reversedDirection=!s.reversedDirection),n.spectrum_reverseDependentAxisAlign&&(s.reversedAlign=!s.reversedAlign),{independent:a,dependent:s}},_prepareAxisRenderParamsAndOptions:function(e,t,r,i,n,o){var a=n,s=a.spectrum_reversedAxises,l=a.contextRefLengthes.xy,u=a.unitLength,d=Kekule.oneOf,c={},h={},p=this,g=function(e,t){var r=Object.create(e);return r=Object.extend(r,t)},f=function(e,t,r){return d(e["spectrum_"+r+t.upperFirst()],e["spectrum_"+t])},C=function(e,t,r){var i=t.upperFirst(),n=d(e["spectrum_"+r+i],e["spectrum_"+t]),o=d(e["spectrum_"+r+i+"Fixed"],e["spectrum_"+t+"Fixed"]),a=d(e["spectrum_"+r+i+"Min"],e["spectrum_"+t+"Min"]),s=d(e["spectrum_"+r+i+"Max"],e["spectrum_"+t+"Max"]);if(e.zoom&&(a||s||o))if(o)n=o/e.zoom;else{var l=n*e.zoom;a&&l<a?n=a/e.zoom:s&&l>s&&(n=s/e.zoom)}return n},m=function(e,t,r,i,n){var o=d(e["spectrum_"+r+t.upperFirst()+"Fixed"],e["spectrum_"+t+"Fixed"]);if(o)a=o;else{var a=d(e["spectrum_"+r+t.upperFirst()+"Ratio"],e["spectrum_"+t+"Ratio"])*i,s=d(e["spectrum_"+r+t.upperFirst()+"Min"],e["spectrum_"+t+"Min"]);s&&(a=Math.max(a,s));var l=d(e["spectrum_"+r+t.upperFirst()+"Max"],e["spectrum_"+t+"Max"]);l&&(a=Math.min(a,l))}return a*n},T=function(e,t,r,i){e[r+t.upperFirst()]=i},E=function(e,t){var r=e.getVariable(t),i=r.getDisplayLabel()||r.getName();return i?DataType.isObjectValue(i)?i:Kekule.Render.RichTextUtils.strToRichText(i):null},_=function(e,t){var r,i=e.getVariable(t),n=p.doGetVarDefUnit(i);if(n){var o=Kekule.Unit.getUnit(n);return o?o.symbolHtml?r=Kekule.Render.RichTextUtils.fromSimpleHtmlCode(o.symbolHtml):o.getKey()&&(r=Kekule.Render.RichTextUtils.strToRichText(o.getKey())):r=DataType.isObjectValue(n)?n:Kekule.Render.RichTextUtils.strToRichText(n),r}return null},S=s?"abscissa":"ordinate",O=s?"ordinate":"abscissa",y={},A={};if(a.spectrum_displayIndependentAxis){if(s?c.ordinate=y:c.abscissa=y,y.axis=g(a,{strokeWidth:m(a,"axisWidth","independent",l,u),scaleMarkSize:0,color:d(f(a,"axisColor","independent"),a.color)}),(a.spectrum_displayIndependentAxisLabel||a.spectrum_displayIndependentAxisUnit)&&(y.axisLabel=g(a,{fontFamily:f(a,"axisLabelFontFamily","independent"),fontSize:C(a,"axisLabelFontSize","independent")*u,color:f(a,"axisLabelColor","independent"),padding:m(a,"axisLabelPadding","independent",l,u)})),a.spectrum_displayIndependentAxisScales&&(y.scaleLabel=g(a,{fontFamily:f(a,"axisScaleLabelFontFamily","independent"),fontSize:C(a,"axisScaleLabelFontSize","independent")*u,color:d(f(a,"axisScaleLabelColor","independent"),a.color),padding:m(a,"axisScaleLabelPadding","independent",l,u)}),y.axis.scaleMarkSize=m(a,"axisScaleMarkSize","independent",l,u),y.axis.unlabeledScaleSizeRatio=f(a,"axisUnlabeledScaleSizeRatio","independent")),T(h,"dataRange",O,r[i.independant]),T(h,"axisPosition",O,o.independent.reversedAlign?1:0),T(h,"reversedDirection",O,o.independent.reversedDirection),a.spectrum_displayIndependentAxisScales){var I=f(a,"axisScaleMarkPreferredCount","independent");T(h,"scales",O,(k=Kekule.Spectroscopy.Utils.calcScalePointInfo(r[i.independant].min,r[i.independant].max,I)).scaleValues),T(h,"scaleBase",O,k.scaleBase),T(h,"scaleUseSciForm",O,k.useSciForm),T(h,"scaleFixedDigitCountAfterPoint",O,k.fixDigitsCountAfterPoint)}a.spectrum_displayIndependentAxisLabel&&T(h,"label",O,E(t,i.independant)),a.spectrum_displayIndependentAxisUnit&&T(h,"unitLabel",O,_(t,i.independant))}if(a.spectrum_displayDependentAxis){if(s?c.abscissa=A:c.ordinate=A,A.axis=g(a,{strokeWidth:m(a,"axisWidth","dependent",l,u),scaleMarkSize:0,color:d(f(a,"axisColor","dependent"),a.color)}),(a.spectrum_displayDependentAxisLabel||a.spectrum_displayDependentAxisUnit)&&(A.axisLabel=g(a,{fontFamily:f(a,"axisLabelFontFamily","dependent"),fontSize:C(a,"axisLabelFontSize","dependent")*u,color:f(a,"axisLabelColor","dependent"),padding:m(a,"axisLabelPadding","dependent",l,u)})),a.spectrum_displayDependentAxisScales&&(A.scaleLabel=g(a,{fontFamily:f(a,"axisScaleLabelFontFamily","dependent"),fontSize:C(a,"axisScaleLabelFontSize","dependent")*u,color:d(f(a,"axisScaleLabelColor","dependent"),a.color),padding:m(a,"axisScaleLabelPadding","dependent",l,u)}),A.axis.scaleMarkSize=m(a,"axisScaleMarkSize","dependent",l,u),A.axis.unlabeledScaleSizeRatio=f(a,"axisUnlabeledScaleSizeRatio","dependent")),T(h,"dataRange",S,r[i.dependant]),T(h,"axisPosition",S,o.dependent.reversedAlign?1:0),T(h,"reversedDirection",S,o.dependent.reversedDirection),a.spectrum_displayDependentAxisScales){var k;I=f(a,"axisScaleMarkPreferredCount","dependent");T(h,"scales",S,(k=Kekule.Spectroscopy.Utils.calcScalePointInfo(r[i.dependant].min,r[i.dependant].max,I)).scaleValues),T(h,"scaleBase",S,k.scaleBase),T(h,"scaleUseSciForm",S,k.useSciForm),T(h,"scaleFixedDigitCountAfterPoint",S,k.fixDigitsCountAfterPoint)}a.spectrum_displayDependentAxisLabel&&T(h,"label",S,E(t,i.dependant)),a.spectrum_displayDependentAxisUnit&&T(h,"unitLabel",S,_(t,i.dependant))}return{renderOptions:c,drawParams:h}},doGetTargetDataSections:function(e){return e.getDisplayedDataSections()},doGetDataVarInfos:function(e){for(var t={},r={},i=0,n=e[0].getActualLocalVarInfos().length;i<n;++i){var o=e[0].getLocalVarDef(i);if(o.getDependency()===Kekule.VarDependency.DEPENDENT?(r.dependant=o.getSymbol(),t.dependant=this.doGetVarDefUnit(o)):(r.independant=o.getSymbol(),t.independant=this.doGetVarDefUnit(o)),r.dependant&&r.independant)break}return r.dependant&&r.independant?{varSymbols:r,varUnitSymbols:t}:null},doGetVarDefUnit:function(e){return e.getActualExternalUnit&&e.getActualExternalUnit()||e.getUnit()},doCalcSprectrumTransformMatrixes:function(t,r,i,n,o,a,s){var l=i.dependant,u=i.independant,d=n;if(d[l]&&d[u]){var c,h;s.independent.reversedDirection&&(a.spectrum_reversedAxises?h=!0:c=!0),s.dependent.reversedDirection&&(a.spectrum_reversedAxises?c=!0:h=!0);var p=a.spectrum_reversedAxises?[{y:d[u].min,x:d[l].min},{y:d[u].max,x:d[l].max}]:[{x:d[u].min,y:d[l].min},{x:d[u].max,y:d[l].max}],g=Kekule.BoxUtils.createBox(p[0],p[1]),f={translateX:c?-g.x2:-g.x1,translateY:h?-g.y1:-g.y2},C=Kekule.CoordUtils.calcTransform2DMatrix(f),m={scaleX:(o.x2-o.x1)/(g.x2-g.x1),scaleY:-(o.y2-o.y1)/(g.y2-g.y1),translateX:o.x1,translateY:o.y1};c&&(m.scaleX=-m.scaleX),h&&(m.scaleY=-m.scaleY);var T=C=Kekule.MatrixUtils.multiply(e.calcTransform2DMatrix(m),C),E=e.calcInverseTransform2DMatrix(m);return E=Kekule.MatrixUtils.multiply(e.calcInverseTransform2DMatrix(f),E),a.spectrumDataTransformInvMatrix=E,{dataTransformMatrix:T,dataTransformInvMatrix:E}}},_getDisplayRangeOfSections:function(e,t,r,i,n,o){for(var a=function(e,t,r,i,n){var o=i===Kekule.Spectroscopy.DataMode.PEAK?"_Peak":i===Kekule.Spectroscopy.DataMode.CONTINUOUS?"_Continuous":"",a=r?"dependent":"independent",s=n["spectrum_visible"+a.upperFirst()+"DataRangeFrom"+o]||0,l=n["spectrum_visible"+a.upperFirst()+"DataRangeTo"+o]||1,u=e;if(0!==s||1!==l){var d=(u.max-u.min)*s+u.min,c=(u.max-u.min)*(l-1)+u.max;return{min:Math.min(d,c),max:Math.max(d,c)}}return u},s=function(e,t,r,i,n){var o=r?"dependent":"independent",a=n["spectrum_viewport"+o.upperFirst()+"DataRangeFrom"]||0,s=n["spectrum_viewport"+o.upperFirst()+"DataRangeTo"]||1,l=e;if(0!==a||1!==s){var u=i?l.max:l.min,d=i?l.min:l.max,c=(d-u)*a+u,h=(d-u)*(s-1)+d;return{min:Math.min(c,h),max:Math.max(c,h)}}return l},l=i.varSymbols.independant,u=i.varSymbols.dependant,d={},c={},h=Kekule.Spectroscopy.DataMode.CONTINUOUS,p=0,g=r.length;p<g;++p){var f=r[p],C=f.getRenderOptions()||{},m=t.getDisplayRangeOfSection(f,null,{autoCalc:!0}),T=f.getMode();T===Kekule.Spectroscopy.DataMode.PEAK&&(h=T),c[l]=a(m[l],0,!1,T,C),c[u]=a(m[u],0,!0,T,C),d=Kekule.Spectroscopy.Utils.mergeDataRange(d,c)}return d[l]=a(d[l],0,!1,h,o),d[u]=a(d[u],0,!0,h,o),d[l]=s(d[l],0,!1,n.independent.reversedDirection,o),d[u]=s(d[u],0,!0,n.dependent.reversedDirection,o),d},_clipDataValuePairInsideVisibleRange:function(t,r,i,n){var o=[e.create(t[i.independant],t[i.dependant]),e.create(r[i.independant],r[i.dependant])],a=[e.create(n[i.independant].min,n[i.dependant].min),e.create(n[i.independant].max,n[i.dependant].max)],s=Kekule.GeometryUtils.clipLineSegmentByBox(o,a);if(s){var l={},u={};return l[i.independant]=s[0].x,l[i.dependant]=s[0].y,u[i.independant]=s[1].x,u[i.dependant]=s[1].y,[l,u]}return null},doDrawDataSections:function(e,t,r,i,n,o,a,s,l){for(var u=this.createDrawGroup(i),d=0,c=t.length;d<c;++d){var h=this.doDrawSectionData(e,t[d],i,o,l,r,a,s);h&&this.addToDrawGroup(h,u)}return u},_mergeParentAndLocalSpectrumDataRenderOptions:function(e,t){var r,i=Kekule.oneOf,n=e.contextRefLengthes.xy,o=i(t.unitLength,e.unitLength,1),a=i(t.spectrum_dataStrokeWidthFixed,e.spectrum_dataStrokeWidthFixed)||0;if(a)r=a;else{r=(i(t.spectrum_dataStrokeWidthRatio,e.spectrum_dataStrokeWidthRatio)||0)*n;var s=i(t.spectrum_dataStrokeWidthMin,e.spectrum_dataStrokeWidthMin)||0;s&&(r=Math.max(r,s));var l=i(t.spectrum_dataStrokeWidthMax,e.spectrum_dataStrokeWidthMax)||0;l&&(r=Math.min(r,l))}r=(r||i(t.strokeWidth,e.strokeWidth,1))*o;var u=Object.create(e);return u=Object.extend(u,{strokeColor:i(t.spectrum_dataColor,t.color,e.spectrum_dataColor,e.color),strokeWidth:r})},_prepareSectionDataActualRenderOptions:function(e,t,r,i){var n=i,o=t.getRenderOptions()||{};return this._mergeParentAndLocalSpectrumDataRenderOptions(n,o)},_getSpectrumDataValueItemRenderOptions:function(e,t,r){return t.getDataItemOverridenRenderOptions(r)},doDrawSectionData:function(e,t,r,i,n,o,a,s){if(t.getDataCount()<=0)return null;Object.create(n);var l=t.getMode(),u=Kekule.Render.Spectrum2DRenderer.sectionDataDrawerMap[l],d=this._prepareSectionDataActualRenderOptions(e,t,r,n);return u&&u.apply(this,[e,t,r,i,d,o,a,s])},doDrawPeakSectionData:function(e,t,r,i,n,o,a,s){var l,u=this,d=function(e,t){var r=u._clipDataValuePairInsideVisibleRange(e,t,o,s);return r?[u._calcSectionDataValueContextCoord(r[0],o,a,n.spectrum_reversedAxises),u._calcSectionDataValueContextCoord(r[1],o,a,n.spectrum_reversedAxises)]:null},c=[],h=[],p=[];if(t.forEach(function(i,a){var s=t.getPeakRootValueOf(i);if(s&&i){!function(e,t,r){var i=t[t.length-1];t.length>1&&Kekule.NumUtils.isFloatEqual(i[r.dependant],e[r.dependant])?i[r.independant]=e[r.independant]:t.push(e)}(s,h,o);var l=d(s,i);if(l){var g=u._getSpectrumDataValueItemRenderOptions(e,t,i);if(g){g=u._mergeParentAndLocalSpectrumDataRenderOptions(n,g);var f=u.drawLine(r,l[0],l[1],g);p.push(f)}else{var C=function(e){var t=[];if(e&&e.length>1){var r=e[0];t.push("M"),t.push([r.x,r.y]);for(var i=1,n=e.length;i<n;++i)t.push("L"),t.push([e[i].x,e[i].y])}return t}(l);C&&C.length&&(c=c.concat(C))}}}}),h.length>1){2===h.length&&(h[0][o.independant]=s[o.independant].min,h[1][o.independant]=s[o.independant].max);for(var g=1,f=h.length;g<f;++g){var C=d(h[g-1],h[g]);C&&(c.push("M"),c.push([C[0].x,C[0].y]),c.push("L"),c.push([C[1].x,C[1].y]))}}if(c&&c.length){var m=Kekule.Render.DrawPathUtils.makePath.apply(this,c);p.unshift(this.drawPath(r,m,n))}if(p.length<1)l=null;else if(1===p.length)l=p[0];else{l=this.createDrawGroup(r);for(g=0,f=p.length;g<f;++g)this.addToDrawGroup(p[g],l)}return l},doDrawContinuousSectionData:function(t,r,i,n,o,a,s,l){var u,d=Object.create(o);d.lineCap="round";var c=this,h=function(e,t,r,i){for(var n=[],o=0,a=e.length;o<a;++o){var s=c._calcSectionDataValueContextCoord(e[o],t,r,i);n.push(s)}return n},p=new Date,g={independent:r.getLocalVarDef(a.independant),dependent:r.getLocalVarDef(a.dependant)},f={independent:g.independent.getActualExternalUnit(),dependent:g.dependent.getActualExternalUnit()},C=Kekule.globalOptions.render.spectrum.continuousSpectrumResampleRatio||1,m=Math.abs(n.x2-n.x1)*C,T=(l[a.independant].max-l[a.independant].min)/m,E=this._getContinuousSpectrumSectionSamplingCache(i,r),_=!!E,S=_&&E.modifiedTime===r.getModifiedTime()&&Kekule.NumUtils.isFloatEqual(T,E.sampleMergeWidth)&&f.independent===E.indepUnit&&f.dependent===E.depUnit;_||(E={},this._setContinuousSpectrumSectionSamplingCache(i,r,E)),S||(E.modifiedTime=r.getModifiedTime(),E.sampleMergeWidth=T,E.indepUnit=f.independent,E.depUnit=f.dependent,E.items=[]);for(var O=function(e){return Math.floor((e[a.independant]-l[a.independant].min)/T)},y=function(e,t,r){r.push(t),null==r.fromIndex&&(r.fromIndex=e),r.toIndex=e;var i=t[a.independant];r.indepValueSum=(r.indepValueSum||0)+i},A=null,I=[],k=r.getDataCount(),b=k,v=0,R=0,D=[];v<k;){var N=null,P=null;if(S&&(N=this._getSectionCachedSamplingData(E.items,v,R))&&N.item&&(N.item.typicalValues&&(R=N.cacheIndex+1,v=N.dataValueToIndex),N.item.averageIndepValue<l[a.independant].min||N.item.averageIndepValue>l[a.independant].max||(P=N.item.typicalValues)),!N){var M=r.getHashValueAt(v),K=M[a.independant];if(K<l[a.independant].min||K>l[a.independant].max);else{var L=O(M);null===A&&(A=L),v==b-1||L!==A?(v===b-1&&y(v,M,I),I.length&&((P=this._getMergeSectionDataTypicalValues(I,a))&&this._addSectionSamplingDataCacheItem(E.items,I,P,a),I=[],A=L,v<b-1&&y(v,M,I))):y(v,M,I)}}P&&D.push(P),++v}new Date;p=new Date;var x,B,U,w=[e.create(n.x1,n.y1),e.create(n.x2,n.y2)],F=[];for(v=0,b=D.length;v<b;++v){P=D[v];var V=(U=P,c._clipDataValuePairInsideVisibleRange(U[0],U[1],a,l)),j=null,W=null,G=null;if(V){var H=h(V,a,s,o.spectrum_reversedAxises);if(j=H,x)W=[x[x.length-1],H[0]];else if(B){var z=B[B.length-1],Y=this._calcSectionDataValueContextCoord(z,a,s,o.spectrum_reversedAxises);G=Kekule.GeometryUtils.clipLineSegmentByBox([Y,H[0]],w)}x=j}else{if(x){var X=P[0];if(X){var $=this._calcSectionDataValueContextCoord(X,a,s,o.spectrum_reversedAxises);G=Kekule.GeometryUtils.clipLineSegmentByBox([x[x.length-1],$],w)}}x=null}if(B=P,j&&j.length>1){F.push("M"),F.push([j[0].x,j[0].y]);for(var J=1,q=j.length;J<q;++J)F.push("L"),F.push(j[J].x,j[J].y)}W&&(F.push("M"),F.push([W[0].x,W[0].y]),F.push("L"),F.push([W[1].x,W[1].y])),G&&(F.push("M"),F.push([G[0].x,G[0].y]),F.push("L"),F.push([G[1].x,G[1].y]))}if(F.length){var Z=Kekule.Render.DrawPathUtils.makePath.apply(this,F);u=this.drawPath(i,Z,d)}new Date;return u},_getMergeSectionDataTypicalValues:function(e,t){for(var r,i,n,o,a,s,l,u,d,c=Kekule.NumUtils.isNormalNumber,h=0;h<e.length;++h){var p=e[h][t.independant];c(p)&&(c(n)||(n=p),a=p),c(p=e[h][t.dependant])&&((!c(r)||r>p)&&(r=p,(s={})[t.independant]=a,s[t.dependant]=p,u=h),(!c(i)||i<p)&&(i=p,(l={})[t.independant]=a,l[t.dependant]=p,d=h))}if(o=a,c(n)&&c(o)&&c(r)&&c(i)){var g={},f={};return u<d?(g[t.independant]=n,g[t.dependant]=r,f[t.independant]=o,f[t.dependant]=i):(g[t.independant]=n,g[t.dependant]=i,f[t.independant]=o,f[t.dependant]=r),[g,f]}return null},_calcSectionDataValueContextCoord:function(e,t,r,i){var n=i?{y:e[t.independant],x:e[t.dependant]}:{x:e[t.independant],y:e[t.dependant]};return Kekule.NumUtils.isNormalNumber(n.x)&&Kekule.NumUtils.isNormalNumber(n.y)?Kekule.CoordUtils.transform2DByMatrix(n,r):null},_getContinuousSpectrumSectionSamplingCache:function(e,t,r){var i=this.getRenderCache(e).continuousSpectrumSectionSamplingCacheMap;if(!i)return null;var n=i.get(t);return!n&&r&&(n={},i.set(t,n)),n},_setContinuousSpectrumSectionSamplingCache:function(e,t,r){var i=this.getRenderCache(e).continuousSpectrumSectionSamplingCacheMap;return i||(i=new Kekule.MapEx,this.getRenderCache(e).continuousSpectrumSectionSamplingCacheMap=i),i.set(t,r),r},_addSectionSamplingDataCacheItem:function(e,t,r,i){if(r||(r=this._getMergeSectionDataTypicalValues(t,i)),r){var n={fromIndex:t.fromIndex,toIndex:t.toIndex,averageIndepValue:t.indepValueSum/(t.toIndex-t.fromIndex+1),typicalValues:r},o=e[0];if(!o||o.fromIndex>t.toIndex)e.unshift(n);else if(e[e.length-1].toIndex<t.fromIndex)e.push(n);else{for(var a=-1,s=1,l=e.length-1;s<l;++s){if(e[s].toIndex<t.fromIndex){a=s;break}}a>=0&&e.splice(a,0,n)}}},_getSectionCachedSamplingData:function(e,t,r){for(var i=r||0,n=e.length,o=e[i];o&&i<n;){if(o.fromIndex<=t&&o.toIndex>=t)return{item:o,cacheIndex:i,dataValueFromIndex:o.fromIndex,dataValueToIndex:o.toIndex};if(!(o.toIndex<t))return null;o=e[++i]}return null}}),Kekule.Render.Spectrum2DRenderer.sectionDataDrawerMap={},Kekule.Render.Renderer2DFactory.register(Kekule.Spectroscopy.Spectrum,Kekule.Render.Spectrum2DRenderer)}})}(),"undefined"!=typeof window&&"undefined"!=typeof document&&function(e,t,r,i){"use strict";function n(e,t,r){return setTimeout(u(e,r),t)}function o(e,t,r){return!!Array.isArray(e)&&(a(e,r[t],r),!0)}function a(e,t,r){var n;if(e)if(e.forEach)e.forEach(t,r);else if(e.length!==i)for(n=0;n<e.length;)t.call(r,e[n],n,e),n++;else for(n in e)e.hasOwnProperty(n)&&t.call(r,e[n],n,e)}function s(t,r,i){var n="DEPRECATED METHOD: "+r+"\n"+i+" AT \n";return function(){var r=new Error("get-stack-trace"),i=r&&r.stack?r.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=e.console&&(e.console.warn||e.console.log);return o&&o.call(e.console,n,i),t.apply(this,arguments)}}function l(e,t,r){var i,n=t.prototype;(i=e.prototype=Object.create(n)).constructor=e,i._super=n,r&&Q(i,r)}function u(e,t){return function(){return e.apply(t,arguments)}}function d(e,t){return typeof e==re?e.apply(t&&t[0]||i,t):e}function c(e,t){return e===i?t:e}function h(e,t,r){a(C(t),function(t){e.addEventListener(t,r,!1)})}function p(e,t,r){a(C(t),function(t){e.removeEventListener(t,r,!1)})}function g(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function f(e,t){return e.indexOf(t)>-1}function C(e){return e.trim().split(/\s+/g)}function m(e,t,r){if(e.indexOf&&!r)return e.indexOf(t);for(var i=0;i<e.length;){if(r&&e[i][r]==t||!r&&e[i]===t)return i;i++}return-1}function T(e){return Array.prototype.slice.call(e,0)}function E(e,t,r){for(var i=[],n=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];m(n,a)<0&&i.push(e[o]),n[o]=a,o++}return r&&(i=t?i.sort(function(e,r){return e[t]>r[t]}):i.sort()),i}function _(e,t){for(var r,n,o=t[0].toUpperCase()+t.slice(1),a=0;a<ee.length;){if((n=(r=ee[a])?r+o:t)in e)return n;a++}return i}function S(t){var r=t.ownerDocument||t;return r.defaultView||r.parentWindow||e}function O(e,t){var r=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){d(e.options.enable,[e])&&r.handler(t)},this.init()}function y(e,t,r){var i=r.pointers.length,n=r.changedPointers.length,o=t&fe&&i-n==0,a=t&(me|Te)&&i-n==0;r.isFirst=!!o,r.isFinal=!!a,o&&(e.session={}),r.eventType=t,function(e,t){var r=e.session,i=t.pointers,n=i.length;r.firstInput||(r.firstInput=I(t)),n>1&&!r.firstMultiple?r.firstMultiple=I(t):1===n&&(r.firstMultiple=!1);var o=r.firstInput,a=r.firstMultiple,s=a?a.center:o.center,l=t.center=k(i);t.timeStamp=oe(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=D(s,l),t.distance=R(s,l),function(e,t){var r=t.center,i=e.offsetDelta||{},n=e.prevDelta||{},o=e.prevInput||{};t.eventType!==fe&&o.eventType!==me||(n=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=e.offsetDelta={x:r.x,y:r.y}),t.deltaX=n.x+(r.x-i.x),t.deltaY=n.y+(r.y-i.y)}(r,t),t.offsetDirection=v(t.deltaX,t.deltaY);var u=b(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=u.x,t.overallVelocityY=u.y,t.overallVelocity=ne(u.x)>ne(u.y)?u.x:u.y,t.scale=a?function(e,t){return R(t[0],t[1],ve)/R(e[0],e[1],ve)}(a.pointers,i):1,t.rotation=a?function(e,t){return D(t[1],t[0],ve)+D(e[1],e[0],ve)}(a.pointers,i):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length,A(r,t);var d=e.element;g(t.srcEvent.target,d)&&(d=t.srcEvent.target),t.target=d}(e,r),e.emit("hammer.input",r),e.recognize(r),e.session.prevInput=r}function A(e,t){var r,n,o,a,s=e.lastInterval||t,l=t.timeStamp-s.timeStamp;if(t.eventType!=Te&&(l>ge||s.velocity===i)){var u=t.deltaX-s.deltaX,d=t.deltaY-s.deltaY,c=b(l,u,d);n=c.x,o=c.y,r=ne(c.x)>ne(c.y)?c.x:c.y,a=v(u,d),e.lastInterval=t}else r=s.velocity,n=s.velocityX,o=s.velocityY,a=s.direction;t.velocity=r,t.velocityX=n,t.velocityY=o,t.direction=a}function I(e){for(var t=[],r=0;r<e.pointers.length;)t[r]={clientX:ie(e.pointers[r].clientX),clientY:ie(e.pointers[r].clientY)},r++;return{timeStamp:oe(),pointers:t,center:k(t),deltaX:e.deltaX,deltaY:e.deltaY}}function k(e){var t=e.length;if(1===t)return{x:ie(e[0].clientX),y:ie(e[0].clientY)};for(var r=0,i=0,n=0;t>n;)r+=e[n].clientX,i+=e[n].clientY,n++;return{x:ie(r/t),y:ie(i/t)}}function b(e,t,r){return{x:t/e||0,y:r/e||0}}function v(e,t){return e===t?Ee:ne(e)>=ne(t)?0>e?_e:Se:0>t?Oe:ye}function R(e,t,r){r||(r=be);var i=t[r[0]]-e[r[0]],n=t[r[1]]-e[r[1]];return Math.sqrt(i*i+n*n)}function D(e,t,r){r||(r=be);var i=t[r[0]]-e[r[0]],n=t[r[1]]-e[r[1]];return 180*Math.atan2(n,i)/Math.PI}function N(){this.evEl=De,this.evWin=Ne,this.pressed=!1,O.apply(this,arguments)}function P(){this.evEl=Ke,this.evWin=Le,O.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function M(){this.evTarget=Be,this.evWin=Ue,this.started=!1,O.apply(this,arguments)}function K(){this.evTarget=Fe,this.targetIds={},O.apply(this,arguments)}function L(){O.apply(this,arguments);var e=u(this.handler,this);this.touch=new K(this.manager,e),this.mouse=new N(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function x(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var r={x:t.clientX,y:t.clientY};this.lastTouches.push(r);var i=this.lastTouches;setTimeout(function(){var e=i.indexOf(r);e>-1&&i.splice(e,1)},Ve)}}function B(e,t){this.manager=e,this.set(t)}function U(e){this.options=Q({},this.defaults,e||{}),this.id=le++,this.manager=null,this.options.enable=c(this.options.enable,!0),this.state=Ze,this.simultaneous={},this.requireFail=[]}function w(e){return e&it?"cancel":e&tt?"end":e&et?"move":e&Qe?"start":""}function F(e){return e==ye?"down":e==Oe?"up":e==_e?"left":e==Se?"right":""}function V(e,t){var r=t.manager;return r?r.get(e):e}function j(){U.apply(this,arguments)}function W(){j.apply(this,arguments),this.pX=null,this.pY=null}function G(){j.apply(this,arguments)}function H(){U.apply(this,arguments),this._timer=null,this._input=null}function z(){j.apply(this,arguments)}function Y(){j.apply(this,arguments)}function X(){U.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function $(e,t){return(t=t||{}).recognizers=c(t.recognizers,$.defaults.preset),new J(e,t)}function J(e,t){this.options=Q({},$.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){var t=e.options.inputClass;return new(t||(de?P:ce?K:ue?L:N))(e,y)}(this),this.touchAction=new B(this,this.options.touchAction),q(this,!0),a(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function q(e,t){var r,i=e.element;i.style&&(a(e.options.cssProps,function(n,o){r=_(i.style,o),t?(e.oldCssProps[r]=i.style[r],i.style[r]=n):i.style[r]=e.oldCssProps[r]||""}),t||(e.oldCssProps={}))}function Z(e,r){var i=t.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=r,r.target.dispatchEvent(i)}var Q,ee=["","webkit","Moz","MS","ms","o"],te=t.createElement("div"),re="function",ie=Math.round,ne=Math.abs,oe=Date.now;Q="function"!=typeof Object.assign?function(e){if(e===i||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(n!==i&&null!==n)for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])}return t}:Object.assign;var ae=s(function(e,t,r){for(var n=Object.keys(t),o=0;o<n.length;)(!r||r&&e[n[o]]===i)&&(e[n[o]]=t[n[o]]),o++;return e},"extend","Use `assign`."),se=s(function(e,t){return ae(e,t,!0)},"merge","Use `assign`."),le=1,ue="ontouchstart"in e,de=_(e,"PointerEvent")!==i,ce=ue&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),he="touch",pe="mouse",ge=25,fe=1,Ce=2,me=4,Te=8,Ee=1,_e=2,Se=4,Oe=8,ye=16,Ae=_e|Se,Ie=Oe|ye,ke=Ae|Ie,be=["x","y"],ve=["clientX","clientY"];O.prototype={handler:function(){},init:function(){this.evEl&&h(this.element,this.evEl,this.domHandler),this.evTarget&&h(this.target,this.evTarget,this.domHandler),this.evWin&&h(S(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(S(this.element),this.evWin,this.domHandler)}};var Re={mousedown:fe,mousemove:Ce,mouseup:me},De="mousedown",Ne="mousemove mouseup";l(N,O,{handler:function(e){var t=Re[e.type];t&fe&&0===e.button&&(this.pressed=!0),t&Ce&&1!==e.which&&(t=me),this.pressed&&(t&me&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:pe,srcEvent:e}))}});var Pe={pointerdown:fe,pointermove:Ce,pointerup:me,pointercancel:Te,pointerout:Te},Me={2:he,3:"pen",4:pe,5:"kinect"},Ke="pointerdown",Le="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ke="MSPointerDown",Le="MSPointerMove MSPointerUp MSPointerCancel"),l(P,O,{handler:function(e){var t=this.store,r=!1,i=e.type.toLowerCase().replace("ms",""),n=Pe[i],o=Me[e.pointerType]||e.pointerType,a=o==he,s=m(t,e.pointerId,"pointerId");n&fe&&(0===e.button||a)?0>s&&(t.push(e),s=t.length-1):n&(me|Te)&&(r=!0),0>s||(t[s]=e,this.callback(this.manager,n,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),r&&t.splice(s,1))}});var xe={touchstart:fe,touchmove:Ce,touchend:me,touchcancel:Te},Be="touchstart",Ue="touchstart touchmove touchend touchcancel";l(M,O,{handler:function(e){var t=xe[e.type];if(t===fe&&(this.started=!0),this.started){var r=function(e,t){var r=T(e.touches),i=T(e.changedTouches);return t&(me|Te)&&(r=E(r.concat(i),"identifier",!0)),[r,i]}.call(this,e,t);t&(me|Te)&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:he,srcEvent:e})}}});var we={touchstart:fe,touchmove:Ce,touchend:me,touchcancel:Te},Fe="touchstart touchmove touchend touchcancel";l(K,O,{handler:function(e){var t=we[e.type],r=function(e,t){var r=T(e.touches),i=this.targetIds;if(t&(fe|Ce)&&1===r.length)return i[r[0].identifier]=!0,[r,r];var n,o,a=T(e.changedTouches),s=[],l=this.target;if(o=r.filter(function(e){return g(e.target,l)}),t===fe)for(n=0;n<o.length;)i[o[n].identifier]=!0,n++;for(n=0;n<a.length;)i[a[n].identifier]&&s.push(a[n]),t&(me|Te)&&delete i[a[n].identifier],n++;return s.length?[E(o.concat(s),"identifier",!0),s]:void 0}.call(this,e,t);r&&this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:he,srcEvent:e})}});var Ve=2500,je=25;l(L,O,{handler:function(e,t,r){var i=r.pointerType==he,n=r.pointerType==pe;if(!(n&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents)){if(i)(function(e,t){e&fe?(this.primaryTouch=t.changedPointers[0].identifier,x.call(this,t)):e&(me|Te)&&x.call(this,t)}).call(this,t,r);else if(n&&function(e){for(var t=e.srcEvent.clientX,r=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var n=this.lastTouches[i],o=Math.abs(t-n.x),a=Math.abs(r-n.y);if(je>=o&&je>=a)return!0}return!1}.call(this,r))return;this.callback(e,t,r)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var We=_(te.style,"touchAction"),Ge=We!==i,He="compute",ze="auto",Ye="manipulation",Xe="none",$e="pan-x",Je="pan-y",qe=function(){if(!Ge)return!1;var t={},r=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){t[i]=!r||e.CSS.supports("touch-action",i)}),t}();B.prototype={set:function(e){e==He&&(e=this.compute()),Ge&&this.manager.element.style&&qe[e]&&(this.manager.element.style[We]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return a(this.manager.recognizers,function(t){d(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(f(e,Xe))return Xe;var t=f(e,$e),r=f(e,Je);return t&&r?Xe:t||r?t?$e:Je:f(e,Ye)?Ye:ze}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,r=e.offsetDirection;if(!this.manager.session.prevented){var i=this.actions,n=f(i,Xe)&&!qe[Xe],o=f(i,Je)&&!qe[Je],a=f(i,$e)&&!qe[$e];if(n){var s=1===e.pointers.length,l=e.distance<2,u=e.deltaTime<250;if(s&&l&&u)return}return a&&o?void 0:n||o&&r&Ae||a&&r&Ie?this.preventSrc(t):void 0}t.preventDefault()},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ze=1,Qe=2,et=4,tt=8,rt=tt,it=16;U.prototype={defaults:{},set:function(e){return Q(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(o(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=V(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return o(e,"dropRecognizeWith",this)?this:(e=V(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(o(e,"requireFailure",this))return this;var t=this.requireFail;return-1===m(t,e=V(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(o(e,"dropRequireFailure",this))return this;e=V(e,this);var t=m(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){r.manager.emit(t,e)}var r=this,i=this.state;tt>i&&t(r.options.event+w(i)),t(r.options.event),e.additionalEvent&&t(e.additionalEvent),i>=tt&&t(r.options.event+w(i))},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=32)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|Ze)))return!1;e++}return!0},recognize:function(e){var t=Q({},e);return d(this.options.enable,[this,t])?(this.state&(rt|it|32)&&(this.state=Ze),this.state=this.process(t),void(this.state&(Qe|et|tt|it)&&this.tryEmit(t))):(this.reset(),void(this.state=32))},process:function(e){},getTouchAction:function(){},reset:function(){}},l(j,U,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,r=e.eventType,i=t&(Qe|et),n=this.attrTest(e);return i&&(r&Te||!n)?t|it:i||n?r&me?t|tt:t&Qe?t|et:Qe:32}}),l(W,j,{defaults:{event:"pan",threshold:10,pointers:1,direction:ke},getTouchAction:function(){var e=this.options.direction,t=[];return e&Ae&&t.push(Je),e&Ie&&t.push($e),t},directionTest:function(e){var t=this.options,r=!0,i=e.distance,n=e.direction,o=e.deltaX,a=e.deltaY;return n&t.direction||(t.direction&Ae?(n=0===o?Ee:0>o?_e:Se,r=o!=this.pX,i=Math.abs(e.deltaX)):(n=0===a?Ee:0>a?Oe:ye,r=a!=this.pY,i=Math.abs(e.deltaY))),e.direction=n,r&&i>t.threshold&&n&t.direction},attrTest:function(e){return j.prototype.attrTest.call(this,e)&&(this.state&Qe||!(this.state&Qe)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=F(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),l(G,j,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Xe]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&Qe)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),l(H,U,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ze]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,o=e.deltaTime>t.time;if(this._input=e,!i||!r||e.eventType&(me|Te)&&!o)this.reset();else if(e.eventType&fe)this.reset(),this._timer=n(function(){this.state=rt,this.tryEmit()},t.time,this);else if(e.eventType&me)return rt;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===rt&&(e&&e.eventType&me?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=oe(),this.manager.emit(this.options.event,this._input)))}}),l(z,j,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Xe]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&Qe)}}),l(Y,j,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ae|Ie,pointers:1},getTouchAction:function(){return W.prototype.getTouchAction.call(this)},attrTest:function(e){var t,r=this.options.direction;return r&(Ae|Ie)?t=e.overallVelocity:r&Ae?t=e.overallVelocityX:r&Ie&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&r&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&ne(t)>this.options.velocity&&e.eventType&me},emit:function(e){var t=F(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),l(X,U,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ye]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&fe&&0===this.count)return this.failTimeout();if(i&&o&&r){if(e.eventType!=me)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||R(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&a?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=n(function(){this.state=rt,this.tryEmit()},t.interval,this),Qe):rt}return 32},failTimeout:function(){return this._timer=n(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==rt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),$.VERSION="2.0.8",$.defaults={domEvents:!1,touchAction:He,enable:!0,inputTarget:null,inputClass:null,preset:[[z,{enable:!1}],[G,{enable:!1},["rotate"]],[Y,{direction:Ae}],[W,{direction:Ae},["swipe"]],[X],[X,{event:"doubletap",taps:2},["tap"]],[H]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};J.prototype={set:function(e){return Q(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var r,i=this.recognizers,n=t.curRecognizer;(!n||n&&n.state&rt)&&(n=t.curRecognizer=null);for(var o=0;o<i.length;)r=i[o],2===t.stopped||n&&r!=n&&!r.canRecognizeWith(n)?r.reset():r.recognize(e),!n&&r.state&(Qe|et|tt)&&(n=t.curRecognizer=r),o++}},get:function(e){if(e instanceof U)return e;for(var t=this.recognizers,r=0;r<t.length;r++)if(t[r].options.event==e)return t[r];return null},add:function(e){if(o(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(o(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,r=m(t,e);-1!==r&&(t.splice(r,1),this.touchAction.update())}return this},on:function(e,t){if(e!==i&&t!==i){var r=this.handlers;return a(C(e),function(e){r[e]=r[e]||[],r[e].push(t)}),this}},off:function(e,t){if(e!==i){var r=this.handlers;return a(C(e),function(e){t?r[e]&&r[e].splice(m(r[e],t),1):delete r[e]}),this}},emit:function(e,t){this.options.domEvents&&Z(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](t),i++}},destroy:function(){this.element&&q(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},Q($,{INPUT_START:fe,INPUT_MOVE:Ce,INPUT_END:me,INPUT_CANCEL:Te,STATE_POSSIBLE:Ze,STATE_BEGAN:Qe,STATE_CHANGED:et,STATE_ENDED:tt,STATE_RECOGNIZED:rt,STATE_CANCELLED:it,STATE_FAILED:32,DIRECTION_NONE:Ee,DIRECTION_LEFT:_e,DIRECTION_RIGHT:Se,DIRECTION_UP:Oe,DIRECTION_DOWN:ye,DIRECTION_HORIZONTAL:Ae,DIRECTION_VERTICAL:Ie,DIRECTION_ALL:ke,Manager:J,Input:O,TouchAction:B,TouchInput:K,MouseInput:N,PointerEventInput:P,TouchMouseInput:L,SingleTouchInput:M,Recognizer:U,AttrRecognizer:j,Tap:X,Pan:W,Swipe:Y,Pinch:G,Rotate:z,Press:H,on:h,off:p,each:a,merge:se,extend:ae,assign:Q,inherit:l,bindFn:u,prefixed:_}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=$,"function"==typeof define&&define.amd?define(function(){return $}):"undefined"!=typeof module&&module.exports?module.exports=$:e.Hammer=$}(window,document),Kekule.Operation=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Operation",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){},isReversible:function(){return!0},execute:function(){return this.doExecute()},doExecute:function(){},reverse:function(){return this.isReversible()||Kekule.raise(Kekule.$L("ErrorMsg.COMMAND_NOT_REVERSIBLE")),this.doReverse()},doReverse:function(){}}),Kekule.Operation.State={UNEXECUTED:0,EXECUTED:1},Kekule.MacroOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.MacroOperation",initialize:function(e){this.tryApplySuper("initialize"),this.setChildren(e||[])},initProperties:function(){this.defineProp("children",{dataType:DataType.ARRAY})},isReversible:function(){for(var e=this.getChildren(),t=0,r=e.length;t<r;++t)if(!e[t].isReversible())return!1;return!0},doExecute:function(){for(var e=this.getChildren(),t=0,r=e.length;t<r;++t)e[t].execute()},doReverse:function(){for(var e=this.getChildren(),t=e.length-1;t>=0;--t)e[t].reverse()},add:function(e){return this.getChildren().push(e)},remove:function(e){var t=this.getChildren(),r=t.indexOf(e);return r>=0?t.splice(r,1):null},getChildAt:function(e){return this.getChildren()[e]},getChildCount:function(){return this.getChildren().length}}),Kekule.OperationHistory=Class.create(ObjectEx,{CLASS_NAME:"Kekule.OperationHistory",initialize:function(e){this.tryApplySuper("initialize"),this.setCapacity(e||null)},initProperties:function(){this.defineProp("capacity",{dataType:DataType.INT}),this.defineProp("operations",{dataType:DataType.ARRAY,getter:function(){var e=this.getPropStoreFieldValue("operations");return e||(e=[],this.setPropStoreFieldValue("operations",e)),e}}),this.defineProp("currIndex",{dataType:DataType.INT,serializable:!1}),this.defineEvent("push"),this.defineEvent("pop"),this.defineEvent("undo"),this.defineEvent("redo")},checkCapacity:function(){var e=this.getCapacity();if(e&&!(e<=0))for(var t=this.getPropStoreFieldValue("operations");t&&t.length>e;)t.shift(),this.getCurrIndex()>0&&this.setCurrIndex(this.getCurrIndex()-1)},getOperationCount:function(){return this.getOperations().length},getOperationAt:function(e){return this.getOperations()[e]},getCurrOperation:function(){var e=this.getCurrIndex();return e>=0?this.getOperations()[e]:null},clear:function(){this.setOperations([]),this.setCurrIndex(-1),this.invokeEvent("clear",{currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")},push:function(e){var t=this.getOperations(),r=this.getCurrIndex();r<t.length&&t.splice(r+1,t.length-r-1),t.push(e),this.setCurrIndex(t.length-1),this.checkCapacity(),this.invokeEvent("push",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")},pop:function(){var e,t=this.getCurrIndex();return this.canPop()?(e=this.getOperations()[t],this.setCurrIndex(--t),this.invokeEvent("pop",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")):e=null,e},canPop:function(){return this.getCurrIndex()>=0&&!!this.getOperations().length},unpop:function(){var e,t=this.getCurrIndex();this.getOperations();return this.canUnpop()?(this.setCurrIndex(++t),e=this.getOperations()[t]):e=null,e},canUnpop:function(){return this.getCurrIndex()<this.getOperations().length-1},replaceOperation:function(e,t){var r=this.getOperations(),i=r.lastIndexOf(e);return i>=0?(console.log("replace operation",i===r.length-1),r.splice(i,1,t)):null},undo:function(){var e=this.pop();return e&&e.isReversible()&&e.reverse(),this.invokeEvent("undo",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange"),e},undoAll:function(){for(;this.canUndo;)this.undo()},canUndo:function(){return this.canPop()},redo:function(){var e=this.unpop();return e&&e.execute(),this.invokeEvent("redo",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange"),e},canRedo:function(){return this.canUnpop()}}),function(){Kekule.Action=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Action",HTML_CLASSNAME:null,initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("linkedWidgets",[]),this.setPropStoreFieldValue("enabled",!0),this.setPropStoreFieldValue("visible",!0),this.setPropStoreFieldValue("displayed",!0),this.setPropStoreFieldValue("htmlClassName",this.getInitialHtmlClassName()),this.setBubbleEvent(!0),this.reactWidgetExecuteBind=this.reactWidgetExecute.bind(this)},finalize:function(){var e=this.getOwner();e&&e.actionRemoved&&e.actionRemoved(this),this.unlinkAllWidgets(),this.setPropStoreFieldValue("linkedWidgets",[]),this._lastHtmlEvent=null,this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnabled()&&(this.setPropStoreFieldValue("enabled",e),this.updateAllWidgetsProp("enabled",e))}}),this.defineProp("visible",{dataType:DataType.BOOL,setter:function(e){e!==this.getVisible()&&(this.setPropStoreFieldValue("visible",e),this.updateAllWidgetsProp("visible",e))}}),this.defineProp("displayed",{dataType:DataType.BOOL,setter:function(e){e!==this.getDisplayed()&&(this.setPropStoreFieldValue("displayed",e),this.updateAllWidgetsProp("displayed",e))}}),this.defineProp("checked",{dataType:DataType.BOOL,setter:function(e){e!==this.getChecked()&&(this.setPropStoreFieldValue("checked",e),this.updateAllWidgetsProp("checked",e),this.checkedChanged())}}),this.defineProp("checkGroup",{dataType:DataType.STRING}),this.defineProp("hint",{dataType:DataType.STRING,setter:function(e){e&&e!==this.getHint()&&(this.setPropStoreFieldValue("hint",e),this.updateAllWidgetsProp("hint",e))}}),this.defineProp("text",{dataType:DataType.STRING,setter:function(e){e&&e!==this.getText()&&(this.setPropStoreFieldValue("text",e),this.updateAllWidgetsProp("text",e))}}),this.defineProp("shortcutKeys",{dataType:DataType.ARRAY}),this.defineProp("shortcutKey",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getShortCutKeys()[0]},setter:function(e){this.setShortcutKeys(Kekule.ArrayUtils.toArray(e))}}),this.defineProp("htmlClassName",{dataType:DataType.STRING,setter:function(e){var t=this.getHtmlClassName();this.setPropStoreFieldValue("htmlClassName",e),this.updateAllWidgetClassName(e,t)}}),this.defineProp("owner",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("linkedWidgets",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("invoker",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},getHigherLevelObj:function(){return this.getOwner()},invokeEvent:function(e,t){t||(t={}),t.invoker||(t.invoker=this.getInvoker()),this.tryApplySuper("invokeEvent",[e,t])},getInitialHtmlClassName:function(){return this.HTML_CLASSNAME||null},getActionList:function(){var e=this.getOwner();return e instanceof Kekule.ActionList?e:null},checkedChanged:function(){var e=this.getActionList();e&&e.actionCheckedChanged(this)},linkWidget:function(e){var t=this.getLinkedWidgets();if(t.indexOf(e)<0){var r=this.getText();r&&this.updateWidgetProp(e,"text",r);var i=this.getHint();return i&&this.updateWidgetProp(e,"hint",i),this.updateWidgetProp(e,"enabled",this.getEnabled()),this.updateWidgetProp(e,"displayed",this.getDisplayed()),this.updateWidgetProp(e,"visible",this.getVisible()),this.updateWidgetProp(e,"checked",this.getChecked()),this.updateWidgetProp(e,"shortcutKeys",this.getShortcutKeys()),this.updateWidgetClassName(e,this.getHtmlClassName(),null),e.addEventListener("execute",this.reactWidgetExecuteBind),t.push(e),this}},unlinkWidget:function(e){var t=this.getLinkedWidgets(),r=t.indexOf(e);r>=0&&(this.updateWidgetClassName(e,null,this.getHtmlClassName()),e.removeEventListener("execute",this.reactWidgetExecuteBind),t.splice(r,1))},unlinkAllWidgets:function(){for(var e=this.getLinkedWidgets(),t=e.length-1;t>=0;--t)this.unlinkWidget(e[t])},reactWidgetExecute:function(e){return this.execute(e.target,e.htmlEvent)},execute:function(e,t){if(!t||t!==this._lastHtmlEvent||t.__$periodicalExecuting$__){var r=this.getChecked();this.getCheckGroup()&&r||(this.doExecute(e,t),this.getCheckGroup()&&this.setChecked(!0)),this.setPropStoreFieldValue("invoker",e),this._lastHtmlEvent=t,this.invokeEvent("execute",{htmlEvent:t,invoker:e})}return this},doExecute:function(e,t){},update:function(){return this.doUpdate(),this},doUpdate:function(){},updateAllWidgetsProp:function(e,t){for(var r=this.getLinkedWidgets(),i=0,n=r.length;i<n;++i){var o=r[i];this.updateWidgetProp(o,e,t)}},updateWidgetProp:function(e,t,r){e.hasProperty(t)&&e.setPropValue(t,r)},updateWidgetClassName:function(e,t,r){r&&e.removeClassName(r,!0),t&&e.addClassName(t,!0)},updateAllWidgetClassName:function(e,t){for(var r=this.getLinkedWidgets(),i=0,n=r.length;i<n;++i){var o=r[i];this.updateWidgetClassName(o,e,t)}}}),Kekule.ActionList=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ActionList",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("actions",[]),this.setPropStoreFieldValue("ownActions",!0),this.setPropStoreFieldValue("autoUpdate",!0),this.reactActionExecutedBind=this.reactActionExecuted.bind(this),this.addEventListener("execute",this.reactActionExecutedBind)},finalize:function(){this.removeEventListener("execute",this.reactActionExecutedBind),this.clear(),this.setPropStoreFieldValue("actions",null),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("actions",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("ownActions",{dataType:DataType.BOOL}),this.defineProp("autoUpdate",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoUpdate",e),e&&this.updateAll()}})},hasActionChecked:function(e){return!!this.getCheckedAction(e)},getCheckedAction:function(e){for(var t=this.getActions(),r=0,i=t.length;r<i;++r){var n=t[r];if(n.getCheckGroup()===e&&n.getChecked())return n}return null},actionAdded:function(e){if(this.getOwnActions()){var t=e.getOwner();t&&t.actionRemoved&&t.actionRemoved(e),e.setPropStoreFieldValue("owner",this)}Kekule.ArrayUtils.pushUnique(this.getActions(),e),e.update()},actionRemoved:function(e){Kekule.ArrayUtils.remove(this.getActions(),e),e.setPropStoreFieldValue("owner",null)},actionCheckedChanged:function(e){if(e&&e.getChecked()){var t=e.getCheckGroup();if(t)for(var r=this.getActions(),i=0,n=r.length;i<n;++i){var o=r[i];o!==e&&o.getCheckGroup()===t&&o.getChecked()&&o.setChecked(!1)}}},reactActionExecuted:function(e){e.target instanceof Kekule.Action&&(this.invokeEvent("execute",{action:e.target}),this.getAutoUpdate()&&this.updateAll())},getActionCount:function(){return this.getActions().length},getActionLength:function(){return this.getActions().length},getActionAt:function(e){return this.getActions()[e]},indexOfAction:function(e){return this.getActions().indexOf(e)},setActionIndex:function(e,t){var r=this.getActions();if(r){var i=r.indexOf(e);i>=0&&i!==t&&(r.splice(i,1),r.splice(t,0,e))}return this},hasAction:function(e){return this.indexOfAction(e)>=0},add:function(e){return this.actionAdded(e),this},remove:function(e){return this.actionRemoved(e),this.getOwnActions()&&e.finalize(),this},removeAt:function(e){var t=this.getActions(),r=t[e];return r&&(Kekule.ArrayUtils.removeAt(t,e),this.actionRemoved(r)),this},clear:function(){for(var e=this.getActions(),t=e.length-1;t>=0;--t)this.actionRemoved(e[t]);return this.setPropStoreFieldValue("actions",[]),this},updateAll:function(){for(var e=this.getActions(),t=0,r=e.length;t<r;++t)e[t].update();return this}}),Kekule.ActionFileOpen=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ActionFileOpen",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setEnabled(this.getEnabled()&&Kekule.NativeServices.showFilePickerDialog)},doExecute:function(e){var t=e.getElement().ownerDocument,r=this,i=this.getInvoker();this.openFilePicker(t,function(e,t,n){e&&r.fileOpened(n,i)})},openFilePicker:function(e,t){return Kekule.NativeServices.showFilePickerDialog(e,t,{mode:"open",filters:this.getFilters()})},fileOpened:function(e,t){this.doFileOpened(e,t),this.invokeEvent("open",{files:e,file:e[0]})},doFileOpened:function(e,t){}}),Kekule.ActionLoadFileData=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ActionLoadFileData",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY}),this.defineProp("binaryDetector",{dataType:DataType.FUNCTION,serializable:!1})},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setEnabled(this.getEnabled()&&Kekule.NativeServices.canLoadFileData())},doExecute:function(e){var t=e.getElement().ownerDocument,r=this,i=this.getInvoker();this.loadFileData(t,function(e,t,n){r.dataLoaded(t,n,!!e,i)})},loadFileData:function(e,t){return Kekule.NativeServices.loadFileData(e,t,{filters:this.getFilters(),binaryDetector:this.getBinaryDetector()})},reactFileLoad:function(e,t,r){this.dataLoaded(t,r,!!e)},dataLoaded:function(e,t,r,i){this.doDataLoaded(e,t,r,i),this.invokeEvent("load",{fileName:t,data:e,success:r})},doDataLoaded:function(e,t,r,i){}}),Kekule.ActionFileSave=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileSave",initialize:function(e,t){this.tryApplySuper("initialize"),e&&this.setData(e),t&&this.setFileName(t)},initProperties:function(){this.defineProp("data",{dataType:DataType.STRING,serializable:!1}),this.defineProp("fileName",{dataType:DataType.STRING,serializable:!1}),this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setEnabled(this.getEnabled()&&Kekule.NativeServices.canSaveFileData())},doExecute:function(e){var t;e?t=e.getElement().ownerDocument:t=document;Kekule.NativeServices.saveFileData(t,this.getData(),null,{initialFileName:this.getFileName(),filters:this.getFilters()})}}),Kekule.ActionManager={_namedActionMap:null,_getNamedActionMap:function(t){var r=e._namedActionMap;return!r&&t&&(r=new Kekule.MapEx,e._namedActionMap=r),r},getRegisteredActionsOfClass:function(t,r){var i=e._getNamedActionMap(r);if(i){var n=i.get(t);return!n&&r&&(n={},i.set(t,n)),n}return null},registerNamedActionClass:function(t,r,i){e.getRegisteredActionsOfClass(i,!0)[t]=r},unregisterNamedActionClass:function(t,r){var i=e.getRegisteredActionsOfClass(r,!1);i&&i[t]&&delete i[t]},getActionClassOfName:function(t,r,i){var n=ClassEx.isClass(r)?r:r.getClass&&r.getClass();if(!n)return null;var o=e.getRegisteredActionsOfClass(n,!1),a=o&&o[t];if(!a&&i){var s=ClassEx.getSuperClass(n);a=s?e.getActionClassOfName(t,s,i):null}return a}};var e=Kekule.ActionManager}(),function(){"use strict";Kekule.Widget={DEF_EVENT_HANDLER_PREFIX:"react_",getEventHandleFuncName:function(e){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+e},getTouchGestureHandleFuncName:function(e){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+e}}}(),function(){"use strict";Kekule.DataBingItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DataBingItem",initialize:function(e,t,r,i){this.tryApplySuper("initialize"),this.setSource(e),this.setSourceName(t),this.setTarget(r),this.setTargetName(i)},initProperties:function(){this.defineProp("source",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("sourceName",{dataType:DataType.STRING,serializable:!1}),this.defineProp("target",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("targetName",{dataType:DataType.STRING,serializable:!1})},updateData:function(e){var t=this.getSource(),r=this.getTarget(),i=this.getSourceName(),n=this.getTargetName();if(t&&r&&i&&n)if(e){var o=r.getDataByBindingName(n);t.setDataByBindingName(i,o)}else{o=t.getDataByBindingName(i);r.setDataByBindingName(n,o)}}}),ClassEx.extend(ObjectEx,{getDataByBindingName:function(e){return this.hasProperty(e)?this.getPropValue(e):DataType.isFunctionValue(this[e])?this[e]():void 0},setDataByBindingName:function(e,t){var r=t,i=this.getPropInfo(e);if(i){var n=i.dataType,o=DataType.getType(t);n!==o&&o===DataType.STRING&&(r=DataType.StringUtils.deserializeValue(t))}return this.setPropValue(e,r),this},createDataBinding:function(e,t,r){var i=new Kekule.DataBingItem(e,t,this,r);return this.getDataBindings(!0).push(i),i},removeDataBinding:function(e){Kekule.ArrayUtils.remove(this.getDataBindings(),e)},updateBindingData:function(e){var t=this.getDataBindings();if(t&&t.length)for(var r=0,i=t.length;r<i;++r)t[r].updateData(e)}}),ClassEx.defineProp(ObjectEx,"dataBindings",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,getter:function(e){var t=this.getPropStoreFieldValue("dataBindings");return!t&&e&&(t=[],this.setPropStoreFieldValue("dataBindings",t)),t}})}(),function(){"use strict";Kekule.globalOptions.add("widget.events",{forceSimulatePointerEvent:!1}),Kekule.Widget.UiEvents=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","keydown","keyup","keypress","touchstart","touchend","touchcancel","touchmove","pointerdown","pointermove","pointerout","pointerover","pointerup","drag","dragend","dragenter","dragexit","dragleave","dragover","dragstart","drop"],Kekule.Widget.UiLocalEvents=["blur","focus","mouseenter","mouseleave","mousewheel","pointerenter","pointerleave"],Kekule.Widget.TouchGestures=["hold","tap","doubletap","swipe","swipeup","swipedown","swipeleft","swiperight","transform","transformstart","transformend","rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout","pan","panstart","panmove","panend","pancancel","panleft","panright","panup","pandown"];var e=Kekule.ArrayUtils;Kekule.Widget.HtmlEventMatcher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.HtmlEventMatcher",initialize:function(e){this.tryApplySuper("initialize",[]),this.setEventParams(e||{})},initProperties:function(){this.defineProp("eventParams",{dataType:DataType.HASH}),this._defineEventParamProp("eventType",DataType.STRING,"type")},doFinalize:function(){this.tryApplySuper("doFinalize")},_defineEventParamProp:function(e,t,r){var i=e||r;return this.defineProp(e,{dataType:t,serializable:!1,getter:function(){return this.getEventParams()[i]},setter:function(e){this.getEventParams()[i]=e}})},match:function(e){return(e.getType&&e.getType()||e.type)===this.getEventType()},execOnMatch:function(e,t){var r=this.match(e);return r&&t&&(r=this.doExecTarget(e,t)),r},doExecTarget:function(e,t){var r;return r=DataType.isFunctionValue(t)?t.apply(null,[e,this]):!(!t.execute||!DataType.isFunctionValue(t.execute))&&(DataType.isObjectExValue(t)?t instanceof Kekule.Widget.BaseWidget?t.execute(e):t instanceof Kekule.Action?t.execute(this,e):t.execute(e,this):t.execute(e,this)),Kekule.ObjUtils.isUnset(r)&&(r=!0),r}}),Kekule.Widget.HtmlEventResponser=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.HtmlEventResponser",initialize:function(e,t,r){this.setPropStoreFieldValue("eventMatcher",e),this.setPropStoreFieldValue("execTarget",t),this.tryApplySuper("initialize",[]),this.setExclusive(r||!1)},initProperties:function(){this._defineMatcherRelatedProp("eventParams",{dataType:DataType.HASH}),this._defineMatcherRelatedProp("eventType",DataType.STRING,"type"),this.defineProp("execTarget",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("exclusive",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("eventMatcher",{dataType:"Kekule.Widget.HtmlEventMatcher",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},doFinalize:function(){this.setExecTarget(null);var e=this.getEventMatcher();e&&e.finalize(),this.tryApplySuper("doFinalize")},_defineMatcherRelatedProp:function(e,t,r){var i=e||r;return this.defineProp(e,{dataType:t,getter:function(){return this.getEventMatcher().getPropValue(i)},setter:function(e){this.getEventMatcher().setPropValue(i,e)}})},reactTo:function(e){var t=!1,r=this.getEventMatcher();if(r&&(t=r.match(e))){var i=this.getExecTarget();i&&(t=r.doExecTarget(e,i)),t=t&&this.getExclusive(),this.invokeEvent("execute",{htmlEvent:e,execTarget:i})}return t}}),Kekule.Widget.HtmlEventDispatcher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.HtmlEventDispatcher",initialize:function(){this.setPropStoreFieldValue("responsers",{}),this.tryApplySuper("initialize",[])},initProperties:function(){this.defineProp("responsers",{dataType:DataType.HASH,scope:Class.PropertyScope.PRIVATE,serializable:!1,setter:null})},doFinalize:function(){for(var e=this.getResponsers(),t=Object.getOwnPropertyNames(e),r=0,i=t.length;r<i;++r){var n=e[t[r]];if(n&&n.length)for(var o=n.length-1;o>=0;--o)n[o].finalize()}this.tryApplySuper("doFinalize")},getResponsersForType:function(e,t){var r=this.getResponsers()[e];return r||(r=[],this.getResponsers()[e]=r),r},registerResponser:function(t){var r=t.getEventType();if(r){var i=this.getResponsersForType(r,!0);e.pushUnique(i,t)}},unregisterResponser:function(e,t){var r=e.getEventType();if(r){var i=this.getResponsersForType(r);if(i&&i.length){var n=i.indexOf(e);n>=0&&(i.splice(n,1),t&&e.finalize())}}},addResponser:function(e,t,r){var i=new Kekule.Widget.HtmlEventResponser(e,t,r);return this.registerResponser(i),i},dispatch:function(e){var t=e.getType&&e.getType()||e.type;if(t){var r=this.getResponsersForType(t);if(r&&r.length)for(var i=r.length-1;i>=0;--i){if(r[i].reactTo(e)||e.cancelBubble)break}}}})}(),function(){var e=Kekule.ArrayUtils,t=Kekule.HtmlElementUtils;Kekule.Widget.HtmlTagNames={CHILD_SLOT_HOLDER:"slot",CHILD_HOLDER:"span"},Kekule.Widget.HtmlNames={CHILD_HOLDER:"children"},Kekule.Widget.HtmlClassNames={BASE:"K-Widget",DYN_CREATED:"K-Dynamic-Created",CHILD_HOLDER:"K-Child-Holder",TOP_LAYER:"K-Top-Layer",ISOLATED_LAYER:"K-Isolated-Layer",NORMAL_BACKGROUND:"K-Normal-Background",NONSELECTABLE:"K-NonSelectable",SELECTABLE:"K-Selectable",STYLE_INHERITED:"K-Style-Inherited",STYLE_UNDEPENDENT:"K-Style-Undependent",STATE_NORMAL:"K-State-Normal",STATE_DISABLED:"K-State-Disabled",STATE_HOVER:"K-State-Hover",STATE_ACTIVE:"K-State-Active",STATE_FOCUSED:"K-State-Focused",STATE_SELECTED:"K-State-Selected",STATE_CURRENT_SELECTED:"K-State-Current-Selected",STATE_CHECKED:"K-State-Checked",STATE_READONLY:"K-State-ReadOnly",SHOW_POPUP:"K-Show-Popup",SHOW_DIALOG:"K-Show-Dialog",SHOW_ACTIVE_MODAL:"K-Show-ActiveModal",SECTION:"K-Section",PART_CONTENT:"K-Content",PART_TEXT_CONTENT:"K-Text-Content",PART_ASSOC_TEXT_CONTENT:"K-Assoc-Text-Content",PART_IMG_CONTENT:"K-Img-Content",PART_GLYPH_CONTENT:"K-Glyph-Content",PART_PRI_GLYPH_CONTENT:"K-Pri-Glyph-Content",PART_ASSOC_GLYPH_CONTENT:"K-Assoc-Glyph-Content",PART_DECORATION_CONTENT:"K-Decoration-Content",PART_ERROR_REPORT:"K-Error-Report",FIRST_CHILD:"K-First-Child",LAST_CHILD:"K-Last-Child",TEXT_NO_WRAP:"K-No-Wrap",LAYOUT_H:"K-Layout-H",LAYOUT_V:"K-Layout-V",LAYOUT_G:"K-Layout-G",CORNER_ALL:"K-Corner-All",CORNER_LEFT:"K-Corner-Left",CORNER_RIGHT:"K-Corner-Right",CORNER_TOP:"K-Corner-Top",CORNER_BOTTOM:"K-Corner-Bottom",CORNER_TL:"K-Corner-TL",CORNER_TR:"K-Corner-TR",CORNER_BL:"K-Corner-BL",CORNER_BR:"K-Corner-BR",CORNER_LEADING:"K-Corner-Leading",CORNER_TAILING:"K-Corner-Tailing",FULLFILL:"K-Fulfill",NOWRAP:"K-No-Wrap",HIDE_TEXT:"K-Text-Hide",HIDE_GLYPH:"K-Glyph-Hide",SHOW_TEXT:"K-Text-Show",SHOW_GLYPH:"K-Glyph-Show",MODAL_BACKGROUND:"K-Modal-Background",DUMB_WIDGET:"K-Dumb-Widget",PLACEHOLDER:"K-PlaceHolder"};var r=Kekule.Widget.HtmlClassNames;Kekule.Widget.StyleMode={UNDEPENDENT:0,INHERITED:1},Kekule.Widget.Layout={HORIZONTAL:1,VERTICAL:2,GRID:4},Kekule.Widget.Position={AUTO:0,TOP:1,LEFT:2,BOTTOM:4,RIGHT:8,TOP_LEFT:3,TOP_RIGHT:9,BOTTOM_LEFT:6,BOTTOM_RIGHT:12},Kekule.Widget.Direction={AUTO:0,LTR:1,TTB:2,RTL:4,BTT:8,isInHorizontal:function(e){var t=Kekule.Widget.Direction;return!!(e&t.LTR||e&t.RTL)},isInVertical:function(e){var t=Kekule.Widget.Direction;return!!(e&t.TTB||e&t.BTT)}},Kekule.Widget.State={NORMAL:0,FOCUSED:1,HOVER:2,ACTIVE:3,DISABLED:-1};var i=Kekule.Widget.State;Kekule.Widget.ShowHideType={DROPDOWN:1,POPUP:2,DIALOG:3,DEFAULT:0},Kekule.Widget.DragDrop={ELEM_INDEX_DATA_TYPE:"application/x-kekule-dragdrop-elem-index"},Kekule.Widget._PointerHoldParams={DURATION_THRESHOLD:1e3,MOVEMENT_THRESHOLD:10};Kekule.Widget.BaseWidget=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget",BINDABLE_TAG_NAMES:null,DEF_PERIODICAL_EXEC_DELAY:500,DEF_PERIODICAL_EXEC_INTERVAL:100,STYLE_RES_FIELD:"__$style_resources__",initialize:function(e,t){this._stateClassName=null,this._isDismissed=!1,this._pendingHtmlClassNames="",this._enableShowHideEvents=!0,this._reactElemAttribMutationBind=this._reactElemAttribMutation.bind(this),this.reactTouchGestureBind=this.reactTouchGesture.bind(this),this.setPropStoreFieldValue("inheritEnabled",!0),this.setPropStoreFieldValue("inheritStatic",!0),this.setPropStoreFieldValue("selfEnabled",!0),this.setPropStoreFieldValue("selfStatic",!1),this.setPropStoreFieldValue("periodicalExecDelay",this.DEF_PERIODICAL_EXEC_DELAY),this.setPropStoreFieldValue("periodicalExecInterval",this.DEF_PERIODICAL_EXEC_INTERVAL),this.setPropStoreFieldValue("useNormalBackground",!0),this.setPropStoreFieldValue("inheritedStyles",[]),this.setPropStoreFieldValue("droppableDataKinds",["string"]),this.setPropStoreFieldValue("htmlEventDispatcher",new Kekule.Widget.HtmlEventDispatcher),this._touchActionNoneTouchStartHandlerBind=this._touchActionNoneTouchStartHandler.bind(this),this.tryApplySuper("initialize"),this.setPropStoreFieldValue("isDumb",!!t),t||(this.reactUiEventBind=this.reactUiEvent.bind(this)),e&&(e instanceof Kekule.Widget.BaseWidget?(this.setDocument(e.getDocument()),this.createElement(),this.setParent(e)):e.documentElement?(this.setDocument(e),this.createElement()):(this.setDocument(e.ownerDocument),this.setElement(e))),this._stateClassName=null,this._layoutClassName=null,this.getLayout()||this.setLayout(Kekule.Widget.Layout.HORIZONTAL),this._periodicalExecBind=this._periodicalExec.bind(this),this.setBubbleEvent(!0),this.setInheritBubbleUiEvents(!0),this.stateChanged();var r=this.getGlobalManager();r&&r.notifyWidgetCreated(this)},initProperties:function(){this.defineProp("isDumb",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){if(this.getIsDumb()!=e){this.setPropStoreFieldValue("isDumb",e);var t=this.getElement();t&&(e?this.uninstallUiEventHandlers(t):this.installUiEventHandlers(t))}}}),this.defineProp("bubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("inheritBubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("touchAction",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getCoreElement();t&&(t.style.touchAction=e,"none"===e?Kekule.X.Event.addListener(t,"touchstart",this._touchActionNoneTouchStartHandlerBind,{passive:!1}):Kekule.X.Event.removeListener(t,"touchstart",this._touchActionNoneTouchStartHandlerBind,{passive:!1}))}}),this.defineProp("parent",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=this.getParent();t&&t._removeChild(this),e&&e._addChild(this),this.setPropStoreFieldValue("parent",e)}}),this.defineProp("childWidgets",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("childWidgets");return e||(e=[],this.setPropStoreFieldValue("childWidgets",e)),e}}),this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("element",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getElement();e!==t&&(this.setPropStoreFieldValue("element",e),this.elementChanged(e,t))}}),this.defineProp("observeElementAttribChanges",{dataType:DataType.BOOL,setter:function(e){!!e!=!!this.getObserveElementAttribChanges()&&(this.setPropStoreFieldValue("observeElementAttribChanges",e),this.observeElementAttribChangesChanged(!!e))}}),this.defineElemAttribMappingProp("id","id"),this.defineProp("draggable",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return Kekule.StrUtils.strToBool(this.getElement().getAttribute("draggable")||"")},setter:function(e){this.getElement().setAttribute("draggable",e?"true":"false")}}),this.defineProp("droppable",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("droppableDataKinds",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("fileDroppable",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){if(!this.getDroppable())return!1;var e=this.getDroppableDataKinds();return!e||e&&e.indexOf&&e.indexOf("file")>=0},setter:function(e){e&&!this.getDroppable()&&this.setDroppable(!0);var t=this.getPropStoreFieldValue("droppableDataKinds");if(t){var r=t.indexOf("file");!e&&r>=0?t.splice(r,1):e&&r<0&&t.push("file")}else e||this.setDroppableDataKinds(["string"])}}),this.defineElemStyleMappingProp("width","width"),this.defineElemStyleMappingProp("height","height"),this.defineProp("offsetParent",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().offsetParent},setter:null}),this.defineProp("offsetLeft",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetLeft},setter:null}),this.defineProp("offsetTop",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetTop},setter:null}),this.defineProp("offsetWidth",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetWidth},setter:null}),this.defineProp("offsetHeight",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetHeight},setter:null}),this.defineProp("tabIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().tabIndex},setter:function(e){this.getElement().tabIndex=e}}),this.defineProp("innerHTML",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().innerHTML},setter:function(e){this.getElement().innerHTML=e}}),this.defineProp("style",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style},setter:null}),this.defineProp("cssText",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style.cssText},setter:function(e){this.getElement().style.cssText=e}}),this.defineProp("htmlClassName",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().className},setter:function(e){this.getElement().className=e}}),this.defineProp("customHtmlClassName",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(e){var r=this.getElement(),i=this.getCustomHtmlClassName();r&&i!==e&&(i&&t.removeClass(r,i),e&&t.addClass(r,e),this.setPropStoreFieldValue("customHtmlClassName",e))}}),this.defineProp("visible",{dataType:DataType.BOOL,serializable:!1,getter:function(){return Kekule.StyleUtils.isVisible(this.getElement())},setter:function(e,t){Kekule.StyleUtils.setVisibility(this.getElement(),e),t||this.widgetShowStateChanged(this.isShown())}}),this.defineProp("displayed",{dataType:DataType.BOOL,serializable:!1,getter:function(){return Kekule.StyleUtils.isDisplayed(this.getElement())},setter:function(e,t){Kekule.StyleUtils.setDisplay(this.getElement(),e),t||this.widgetShowStateChanged(this.isShown())}}),this.defineProp("showHideType",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showHideCaller",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showHideCallerPageRect",{dataType:DataType.HASH,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("standaloneOnShowHide",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("finalizeAfterHiding",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("layout",{dataType:DataType.INT,setter:function(e){this.getPropStoreFieldValue("layout")!==e&&(this.setPropStoreFieldValue("layout",e),this.layoutChanged())}}),this.defineProp("useCornerDecoration",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useCornerDecoration",e),e?this.addClassName(r.CORNER_ALL):this.removeClassName(r.CORNER_ALL)}}),this.defineProp("useNormalBackground",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useNormalBackground",e),e?this.addClassName(r.NORMAL_BACKGROUND):this.removeClassName(r.NORMAL_BACKGROUND)}}),this.defineProp("styleMode",{dataType:DataType.INT,enumSource:Kekule.Widget.StyleMode,setter:function(e){e!==this.getStyleMode()&&(this.getElement()&&(e===Kekule.Widget.StyleMode.INHERITED?(this.removeClassName(r.STYLE_UNDEPENDENT),this.addClassName(r.STYLE_INHERITED)):(this.addClassName(r.STYLE_UNDEPENDENT),this.removeClassName(r.STYLE_INHERITED))),this.setPropStoreFieldValue("styleMode",e))}}),this.defineProp("inheritedStyles",{dataType:DataType.ARRAY,setter:function(e){this._applyToAllInheritedStyles(this.getInheritedStyles(),!1),this.setPropStoreFieldValue("inheritedStyles",e||[]),this._applyToAllInheritedStyles(this.getInheritedStyles(),!0)}}),this.defineProp("showText",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showText",e),e?(this.removeClassName(r.HIDE_TEXT),this.addClassName(r.SHOW_TEXT)):(this.addClassName(r.HIDE_TEXT),this.removeClassName(r.SHOW_TEXT))}}),this.defineProp("showGlyph",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showGlyph",e),e?(this.removeClassName(r.HIDE_GLYPH),this.addClassName(r.SHOW_GLYPH)):(this.addClassName(r.HIDE_GLYPH),this.removeClassName(r.SHOW_GLYPH))}}),this.defineProp("allowTextWrap",{dataType:DataType.BOOL,serialzable:!1,setter:function(e){e?this.removeClassName(r.TEXT_NO_WRAP):this.addClassName(r.TEXT_NO_WRAP)}}),this.defineProp("selfEnabled",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("inheritEnabled",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("inheritEnabled",e),this.stateChanged()}}),this.defineProp("enabled",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("selfEnabled");if(this.getInheritEnabled()){var t=this.getParent();t&&(e=e&&t.getEnabled())}return e},setter:function(e){var t=this.getElement();e?t.removeAttribute("disabled"):t.setAttribute("disabled","true"),(t=this.getCoreElement())!=this.getElement()&&(e?t.removeAttribute("disabled"):t.setAttribute("disabled","true")),this.setPropStoreFieldValue("selfEnabled",e),this.stateChanged()}}),this.defineProp("selfStatic",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("inheritStatic",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("inheritStatic",e),this.stateChanged()}}),this.defineProp("static",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("selfStatic");if(this.getInheritStatic()){var t=this.getParent();t&&(e=e||t.getStatic())}return e},setter:function(e){this.setPropStoreFieldValue("selfStatic",e),this.stateChanged()}}),this.defineProp("inheritState",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("inheritState",e),this.stateChanged()}}),this.defineProp("state",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var e;if(this.getInheritState()){var t=this.getParent();t&&(e=t.getState())}else e=this.getEnabled()?this.getIsActive()?i.ACTIVE:this.getIsHover()?i.HOVER:this.getIsFocused()?i.FOCUSED:i.NORMAL:i.DISABLED;return e}}),this.defineProp("shortcuts",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("shortcutKeys",{dataType:DataType.ARRAY,getter:function(){for(var e=[],t=this.getShortcuts()||[],r=0,i=t.length;r<i;++r)e.push(t[r].key);return e},setter:function(t){this._updateShortcuts(t&&e.toArray(t))}}),this.defineProp("shortcutKey",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getShortcutKeys()[0]},setter:function(e){this.setShortcutKeys(e)}}),this.defineProp("cursor",{dataType:DataType.VARIANT,serializable:!1,getter:function(){return this.getStyleProperty("cursor")},setter:function(e){DataType.isArrayValue(e)?Kekule.StyleUtils.setCursor(this.getElement(),e):this.setStyleProperty("cursor",e)}}),this.defineProp("isHover",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("isHover",e),e||this.isCaptureMouse()||this.setPropStoreFieldValue("isActive",!1);var t=this.getGlobalManager();t&&t.notifyWidgetHoverChanged(this,e),this.stateChanged()}}),this.defineProp("isActive",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("isActive",e),e&&this.focus();var t=this.getGlobalManager();t&&t.notifyWidgetActiveChanged(this,e),this.stateChanged()}}),this.defineProp("isFocused",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getDocument(),t=this.getCoreElement();if(e&&t&&e.activeElement)return e.activeElement===t},setter:function(e){this.setPropStoreFieldValue("isFocused",e);var t=this.getGlobalManager();t&&t.notifyWidgetFocusChanged(this,e);var r=this.getCoreElement();if(r){var i=this.getDocument();e&&i.activeElement&&i.activeElement!==r&&i.activeElement.blur&&i.activeElement.blur(),r.focus&&e&&Kekule.HtmlElementUtils.isFormCtrlElement(r)&&r.focus(),r.blur&&!e&&r.blur()}this.stateChanged()}}),this.defineProp("minDimension",{dataType:DataType.HASH}),this.defineProp("enableDimensionTransform",{dataType:DataType.BOOL}),this.defineProp("autoResizeConstraints",{dataType:DataType.HASH,setter:function(e){this.setPropStoreFieldValue("autoResizeConstraints",e);var t=this.getGlobalManager()||Kekule.Widget.globalManager;e?(this.autoResizeToClient(),t.registerAutoResizeWidget(this)):t.unregisterAutoResizeWidget(this)}}),this.defineProp("observeElemResize",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("observeElemResize")&&Kekule.BrowserFeature.resizeObserver},setter:function(e){this.getPropStoreFieldValue("observeElemResize")!=!!e&&(this.setPropStoreFieldValue("observeElemResize",!!e),e?this._installElemResizeObserver():this._uninstallElemResizeObserver())}}),this.defineProp("autoAdjustSizeOnPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("isDialog",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("isPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("popupCaller",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("modalInfo",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC}),this.defineProp("enablePeriodicalExec",{dataType:DataType.BOOL}),this.defineProp("periodicalExecDelay",{dataType:DataType.INT}),this.defineProp("periodicalExecInterval",{dataType:DataType.INT}),this.defineElemAttribMappingProp("hint","title"),this.defineProp("action",{dataType:"Kekule.Action",serializable:!1,setter:function(e){var t=this.getAction();t!==e&&(t&&t.unlinkWidget&&(t.unlinkWidget(this),this.unlinkAction(t)),this.setPropStoreFieldValue("action",e),e&&e.linkWidget&&(e.linkWidget(this),this.linkAction(e)))}}),this.defineProp("defaultChildActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("defaultChildActions");return!t&&e&&(t=new Kekule.ActionList,this.setPropStoreFieldValue("defaultChildActions",t)),t}}),this.defineProp("defaultChildActionMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("defaultChildActionMap");return!t&&e&&(t=new Kekule.MapEx,this.setPropStoreFieldValue("defaultChildActionMap",t)),t}}),this.defineProp("iaControllerMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("iaControllerMap");return e||(e=new Kekule.HashEx,this.setPropStoreFieldValue("iaControllerMap",e)),e}}),this.defineProp("defIaControllerId",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("defIaController",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getDefIaControllerId())}}),this.defineProp("activeIaControllerId",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){if(e!==this.getActiveIaControllerId()){this.setPropStoreFieldValue("activeIaControllerId",e);var t=this.getActiveIaController();t&&t.activated&&t.activated(this)}}}),this.defineProp("activeIaController",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getActiveIaControllerId())}}),this.defineProp("htmlEventDispatcher",{dataType:"Kekule.Widget.HtmlEventDispatcher",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null}),this.defineProp("observingGestureEvents",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null})},doFinalize:function(){this._elemResizeObserver&&(this._elemResizeObserver.disconnect&&this._elemResizeObserver.disconnect(),this._elemResizeObserver=null),this._clearShortcuts(),this.getHtmlEventDispatcher().finalize();var e=this.getDefaultChildActionMap();e&&(e.finalize(),this.setPropStoreFieldValue("defaultChildActionMap",null));var t=this.getDefaultChildActions();t&&(t.finalize(),this.setPropStoreFieldValue("defaultChildActions",null)),this.setAction(null),this.setParent(null),this.releaseChildWidgets();var r=this.getElement();this.setElement(null),this.destroyElement(r),this.getGlobalManager()&&this.getGlobalManager().notifyWidgetFinalized(this),this.tryApplySuper("doFinalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableObjectChangeEvent(!0)},doObjectChange:function(e){(this.tryApplySuper("doObjectChange",[e]),e.indexOf("readOnly")>=0&&this.hasProperty("readOnly"))&&(this.getPropValue("readOnly")?this.addClassName(r.STATE_READONLY):this.removeClassName(r.STATE_READONLY))},invokeEvent:function(e,t){t||(t={}),t.widget||(t.widget=this),this.tryApplySuper("invokeEvent",[e,t]);var r=this.getGlobalManager();r&&r.notifyWidgetEventFired(this,e,t)},getGlobalManager:function(){return Kekule.Widget.Utils.getGlobalManager(this.getDocument())},getCoreElement:function(){return this.getElement()},getChildrenHolderElement:function(){return this.getCoreElement()},getTextSelectable:function(){return!1},canUsePlaceHolderOnElem:function(e){return!1},doPropChanged:function(e,t){"width"!==e&&"height"!==e||this.resized()},getActualBubbleUiEvents:function(){var e=this.getParent();return!!this.getBubbleUiEvents()||(this.getInheritBubbleUiEvents()&&e&&e.getActualBubbleUiEvents?e.getActualBubbleUiEvents():void 0)},releaseChildWidgets:function(){for(var e=this.getChildWidgets(),t=e.length-1;t>=0;--t)e[t].finalize()},defineElemAttribMappingProp:function(e,t,r){var i=Object.extend({dataType:DataType.STRING,serializable:!1,getter:function(){return this.getElement()&&this.getElement().getAttribute(t)},setter:function(e){this.getElement()&&this.getElement().setAttribute(t,e)}},r||{});return this.defineProp(e,i)},defineElemStyleMappingProp:function(e,t,r){var i=Object.extend({dataType:DataType.STRING,serializable:!1,getter:function(){return this.getStyleProperty(t)},setter:function(e){this.setStyleProperty(t,e)}},r||{});return this.defineProp(e,i)},getHigherLevelObj:function(){return this.getParent()},linkAction:function(e){},unlinkAction:function(e){},getChildActionClass:function(e,t){return Kekule.ActionManager.getActionClassOfName(e,this,t)},getChildAction:function(e,t){var r=null,i=this.getChildActionClass(e,t);if(i){var n=this.getDefaultChildActionMap(!0);(r=n.get(i))||(r=new i,this.getDefaultChildActions(!0).add(r),n.set(i,r))}return r},_updateShortcuts:function(e){var t=this.getShortcuts()||[],r=t.length,i=e&&e.length||0;if(i<r)for(var n=i;n<r;++n)t[n].finalzie();else{var o=this.getDocument();for(n=r;n<i;++n){var a=new Kekule.Widget.Shortcut(this);t.push(a),a.registerToGlobal(o)}}for(n=0;n<i;++n)t[n].setKey(e[n]);this.setPropStoreFieldValue("shortcuts",t)},_clearShortcuts:function(){var e=this.getShortcuts()||[],t=e.length;if(t){for(var r=0;r<t;++r)e[r].finalize();this.setShortcuts(null)}},linkStyleResource:function(e,t){var r=e instanceof Kekule.Widget.StyleResource?e:Kekule.Widget.StyleResourceManager.getResource(e);return r&&r.linkTo(t||this),this},unlinkStyleResource:function(e,t){var r=e instanceof Kekule.Widget.StyleResource?e:Kekule.Widget.StyleResourceManager.getResource(e);return r&&r.unlinkFrom(t||this),this},getStyleProperty:function(e,t){var r=t||this.getElement(),i=r[this.STYLE_RES_FIELD];return i&&i[e]?i[e]:r.style[e]},setStyleProperty:function(e,t,r){var i,n=r||this.getElement();if(n)if(t instanceof Kekule.Widget.StyleResource?i=t:DataType.getType(t)===DataType.STRING&&t.startsWith(Kekule.Widget.StyleResourceNames.PREFIX)&&(i=Kekule.Widget.StyleResourceManager.getResource(t)),i){(a=n[this.STYLE_RES_FIELD])||(a={},n[this.STYLE_RES_FIELD]=a);var o=a[e];o&&this.unlinkStyleResource(o,n),i&&this.linkStyleResource(i,n),a[e]=i}else{var a;n.style[e]=t,(a=n[this.STYLE_RES_FIELD])&&a[e]&&this.unlinkStyleResource(a[e],n)}return this},removeStyleProperty:function(e,t){var r=t||this.getElement();return Kekule.StyleUtils.removeStyleProperty(r.style,e),this},setStyleProperties:function(e,t){for(var r=Object.getOwnPropertyNames(e||{}),i=0,n=r.length;i<n;++i){var o=r[i],a=e[o];this.setStyleProperty(o,a,t)}return this},removeStyleProperties:function(t,r){for(var i=0,n=e.toArray(t).length;i<n;++i)this.removeStyleProperty(name,r);return this},getComputedStyle:function(e){return Kekule.StyleUtils.getComputedStyle(this.getCoreElement(),e)},getComputedCustomStyle:function(e){var t;return t=e.indexOf("-")<0?e.dasherize():e,this.getComputedStyle("--"+t)},isStyleInherited:function(e){return(this.getInheritedStyles()||[]).indexOf(e)>=0},_setInheritedStyleValues:function(t,r,i){for(var n=e.toArray(t),o=this.getInheritedStyles()||{},a=0,s=n.length;a<s;++a){var l=n[a],u=o.indexOf(l);r?(!i&&u<0&&(o.push(l),this.notifyInheritedStyleChanged(l,!0)),this.setStyleProperty(l,"inherit")):(this.removeStyleProperty(l),!i&&u>=0&&(o.splice(u,1),this.notifyInheritedStyleChanged(l,!1)))}return this},notifyInheritedStyleChanged:function(e,t){},addInheritedStyle:function(e){return this._setInheritedStyleValues(e,!0)},removeInheritedStyle:function(e){return this._setInheritedStyleValues(e,!1)},clearInheritedStyles:function(){this.setPropStoreFieldValue("inheritedStyles",[])},_applyToAllInheritedStyles:function(e,t){Kekule.ObjUtils.isUnset(t)&&(t=!0);for(var r=0,i=e.length;r<i;++r){var n=e[r];this._setInheritedStyleValues(n,t,!0)}},_addChild:function(e){if(e){var t=this.getChildWidgets();t.indexOf(e)<0&&(t.push(e),this.childWidgetAdded(e),this.childrenModified())}},_insertChild:function(e,t){if(e){var r=this.getChildWidgets(),i=t?r.indexOf(t):r.length;r.indexOf(e)>=0?i>=0&&this._moveChild(e,i):(i<0&&(i=r.length),r.splice(i,0,e),this.childWidgetAdded(e),this.childrenModified())}},_removeChild:function(e){if(e){var t=this.getChildWidgets(),r=t.indexOf(e);if(r>=0){t.splice(r,1);var i=this.getChildrenHolderElement(),n=e.getElement();n&&Kekule.DomUtils.isDescendantOf(n,i)&&n.parentNode.removeChild(n),this.childWidgetRemoved(e),this.childrenModified()}}},_moveChild:function(e,t){e&&Kekule.ArrayUtils.changeItemIndex(this.getChildWidgets(),e,t)&&(this.childWidgetMoved(e,t),this.childrenModified())},childrenModified:function(){},childWidgetAdded:function(e){},childWidgetRemoved:function(e){},childWidgetMoved:function(e,t){},indexOfChild:function(e){return this.getChildWidgets().indexOf(e)},hasChild:function(e,t){var r=this.getChildWidgets(),i=r.indexOf(e)>=0;if(!i)for(var n=0,o=r.length;n<o;++n){var a=r[n];if(a.hasChild&&(i=a.hasChild(e,t)))break}return i},getChildAtIndex:function(e){return this.getChildWidgets()[e]},getPrevSibling:function(){var e=this.getParent();if(e){var t=e.indexOfChild(this);return this.getChildAtIndex(--t)}return null},getNextSibling:function(){var e=this.getParent();if(e){var t=e.indexOfChild(this);return this.getChildAtIndex(++t)}return null},_haltPrevShowHideProcess:function(){Kekule.Widget.showHideManager&&this.__$showHideTransInfo&&this.__$showHideTransInfo.halt()},_setEnableShowHideEvents:function(e){this._enableShowHideEvents=e},show:function(e,t,r,i){if(this.getElement()&&!this.__$isShowing)return this._haltPrevShowHideProcess(),this.doShow(e,t,r,i),this},doShow:function(e,r,i,n){this.__$isShowing=!0;var o=this,a=function(){o.__$showHideTransInfo=null,o.widgetShowStateDone(!0),o.__$isShowing=!1,r&&r()};this.setShowHideType(i),Kekule.ObjUtils.notUnset(i)&&(this.setIsPopup(i===Kekule.Widget.ShowHideType.DROPDOWN||i===Kekule.Widget.ShowHideType.POPUP),i===Kekule.Widget.ShowHideType.DIALOG?(this.setIsDialog(!0),i=Kekule.Widget.ShowHideType.POPUP):this.setIsDialog(!1)),this.widgetShowStateBeforeChanging(!0);var s=this.getGlobalManager();i!==Kekule.Widget.ShowHideType.DROPDOWN&&i!==Kekule.Widget.ShowHideType.POPUP||s.preparePopupWidget(this,e,i),!Kekule.Widget.showHideManager||n&&n.instantly?(this.setDisplayed(!0,!0),this.setVisible(!0,!0),a()):this.__$showHideTransInfo||(this.__$showHideTransInfo=Kekule.Widget.showHideManager.show(this,e,a,i,n)),this.setShowHideCaller(e),e&&this.setShowHideCallerPageRect(t.getElemBoundingClientRect(e.getElement&&e.getElement()||e)),function(){o.widgetShowStateChanged(!0)}.defer()},flash:function(e,t,r,i){var n=this;return this.show(t,function(){r&&r(),setTimeout(n.hide.bind(n),e)},i),this},hide:function(e,t,r,i){if(this.getElement()&&!this.__$isHiding)return this.__$isHiding=!0,e||(e=this.getShowHideCaller()),r||(r=this.getShowHideType()),this._haltPrevShowHideProcess(),this.doHide(e,t,r,i),this},doHide:function(e,t,r,i){var n=Object.extend({callerPageRect:this.getShowHideCallerPageRect()},i),o=n.useVisible,a=this,s=this.getFinalizeAfterHiding(),l=function(){a.__$showHideTransInfo=null,a.widgetShowStateDone(!1);var e=a.getGlobalManager();r!==Kekule.Widget.ShowHideType.DROPDOWN&&r!==Kekule.Widget.ShowHideType.POPUP||e.unpreparePopupWidget(a),a.__$isHiding=!1,t&&t(),s&&a.finalize()};this.widgetShowStateBeforeChanging(!1),Kekule.Widget.showHideManager&&!n.instantly?(this.__$showHideTransInfo&&this.__$showHideTransInfo.halt(),this.__$showHideTransInfo||(this.__$showHideTransInfo=Kekule.Widget.showHideManager.hide(this,e,l,r,!1,n))):(o?this.setVisible(!1,!0):this.setDisplayed(!1,!0),l()),function(){a.widgetShowStateChanged(!1)}.defer()},dismiss:function(e,t,r,i){return this._isDismissed=!0,this.hide(e,t,r,i)},isShown:function(e){return(this.isInDomTree()||e)&&this.getElement()&&this.getVisible()&&this.getDisplayed()},widgetShowStateBeforeChanging:function(e){e&&this.autoResizeToClient()},widgetShowStateChanged:function(e,t){if(Kekule.ObjUtils.isUnset(e)&&(e=this.isShown()),!Kekule.ObjUtils.notUnset(this._lastShown)||this._lastShown!==e){this._lastShown=e,e&&(this._isDismissed=!1);var r=this.getGlobalManager();this.getIsPopup()&&(e?r.registerPopupWidget(this):r.unregisterPopupWidget(this)),this.getIsDialog()&&(e?r.registerDialogWidget(this):r.unregisterDialogWidget(this)),this.doWidgetShowStateChanged(e),this._enableShowHideEvents&&this.invokeEvent("showStateChange",{widget:this,isShown:e,isDismissed:this._isDismissed,byDomChange:t})}},doWidgetShowStateChanged:function(e){},widgetShowStateDone:function(e){},isInDomTree:function(){var e=this.getElement();return Kekule.DomUtils.isInDomTree(e,null,{acrossShadowRoot:!0})},focus:function(){return this.setIsFocused(!0),this},blur:function(){return this.setIsFocused(!1),this},getBoundingClientRect:function(e){if(this.getDisplayed())return Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),e);var t=Kekule.StyleUtils.getDisplayed(this.getElement()),r=Kekule.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden"),this.setDisplayed("");var i=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),e)}finally{this.setDisplayed(t),this.setVisible(r)}return i},getPageRect:function(e){if(this.getDisplayed())return Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),e);var t=Kekule.StyleUtils.getDisplayed(this.getElement()),r=Kekule.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden"),this.setDisplayed("");var i=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),e)}finally{this.setDisplayed(t),this.setVisible(r)}return i},getDimension:function(){return this.getPageRect()},setDimension:function(e,t,r){var i=Kekule.ObjUtils.notUnset,n=this.getMinDimension(),o=n&&n.width,a=n&&n.height,s=!1;if(this.getEnableDimensionTransform()){var l,u=i(e)&&o?e/o:null,d=i(t)&&a?t/a:null;if(l=u&&d?Math.min(u,d):u||d)return l>=1?(this._setTransformScale(1),s=!0,this.doSetDimension(e,t,r)):(!d||u<=d?(c=o,h=t&&t/l):(h=a,c=e&&e/l),this._setTransformScale(l),s=!0,this.doSetDimension(c,h,r));s=!1}if(!s){var c=i(e)?o?Math.max(e,o):e:null,h=i(t)?a?Math.max(t,a):t:null;return this._setTransformScale(1),this.doSetDimension(c,h,r)}},doSetDimension:function(e,t,r){var i=!1,n=Kekule.ObjUtils.notUnset;return n(e)&&(this.getStyle().width="number"==typeof e?e+"px":e,i=!0),n(t)&&(this.getStyle().height="number"==typeof t?t+"px":t,i=!0),i&&!r&&(this.getObserveElemResize()||this.resized()),this.objectChange(["width","height"]),this},_setTransformScale:function(e){var t=this.getElement();1!==e?(t.style.transformOrigin="0 0",t.style.transform="scale("+e+")"):Kekule.StyleUtils.removeStyleProperty(t.style,"transform")},updateDimensionTransform:function(){var e=this.getDimension();this.setDimension(e.width,e.height,!0)},autoResizeToClient:function(){var e=this.getAutoResizeConstraints();if(e){var t=Kekule.DocumentUtils.getClientDimension(this.getDocument()),r=e.width?t.width*e.width:null,i=e.height?t.height*e.height:null;this.setDimension(r,i)}},resized:function(){if(!this._isResizing){this._isResizing=!0;try{this.doResize(),this.invokeEvent("resize",{widget:this})}finally{this._isResizing=!1}}},doResize:function(){},_installElemResizeObserver:function(){if(Kekule.BrowserFeature.resizeObserver){if(!this._elemResizeObserver){var e=this;this._elemResizeObserver=new ResizeObserver(function(t){for(var r=0,i=t.length;r<i;++r){var n=t[r];n.target&&n.contentBoxSize&&n.target===e.getElement()&&e.resized()}})}this._elemResizeObserver.observe(this.getElement())}},_uninstallElemResizeObserver:function(){Kekule.BrowserFeature.resizeObserver&&this._elemResizeObserver&&this._elemResizeObserver.unobserve(this.getElement())},layoutChanged:function(){var e=this.getLayout();this._layoutClassName&&this.removeClassName(this._layoutClassName),this._layoutClassName=this.getLayoutClassName(e),this._layoutClassName&&this.addClassName(this._layoutClassName)},getLayoutClassName:function(e){var t=Kekule.Widget.Layout;return e===t.VERTICAL?r.LAYOUT_V:e===t.HORIZONTAL?r.LAYOUT_H:e===t.GRID?r.LAYOUT_G:null},stateChanged:function(){this._stateClassName&&this.removeClassName(this._stateClassName),this._stateClassName=this.getStateClassName(this.getState()),this._stateClassName&&this.addClassName(this._stateClassName);for(var e=this.getChildWidgets(),t=0,r=e.length;t<r;++t)e[t].stateChanged()},getStateClassName:function(e){var t=Kekule.Widget.State;return e===t.ACTIVE?r.STATE_ACTIVE:e===t.HOVER?r.STATE_HOVER:e===t.FOCUSED?r.STATE_FOCUSED:e===t.DISABLED?r.STATE_DISABLED:r.STATE_NORMAL},createElement:function(){var e=this.getDocument(),t=this.doCreateRootElement(e);return this.setElement(t),t},doCreateRootElement:function(e){},doCreateSubElements:function(e,t){return[]},destroyElement:function(e){(e=e||this.getElement())&&e.parentNode&&e.parentNode.removeChild(e)},appendToElem:function(e){return e&&e.appendChild(this.getElement()),this},insertToElem:function(e,t){return e.insertBefore(this.getElement(),t),this},removeFromDom:function(){var e=this.getElement(),t=e.parentNode;t&&t.removeChild(e)},appendToWidget:function(e){return this.setParent(e),this.appendToElem(e.getChildrenHolderElement()),this},insertToWidget:function(e,t){return this.setParent(e),t?this.insertToElem(e.getChildrenHolderElement(),t.getElement()):this.appendToElem(e.getChildrenHolderElement()),this},insertedToDom:function(){return this.widgetDomStateChanged(!0),this.widgetShowStateChanged(this.isShown(),!0),this.doInsertedToDom()},doInsertedToDom:function(){},removedFromDom:function(){return this.widgetDomStateChanged(!1),this.widgetShowStateChanged(!1,!0),this.doRemovedFromDom()},doRemovedFromDom:function(){},widgetDomStateChanged:function(e){this.doWidgetDomStateChanged(e),this.invokeEvent("domStateChange",{widget:this,isInDom:e})},doWidgetDomStateChanged:function(e){},domElemAdded:function(e){return this.doDomElemAdded(e)},doDomElemAdded:function(e){},domElemRemoved:function(e){return this.doDomElemRemoved(e)},doDomElemRemoved:function(e){},getWidgetClassName:function(){var e=Kekule.Widget.HtmlClassNames.BASE;return e+=" "+(this.getStyleMode()===Kekule.Widget.StyleMode.INHERITED?r.STYLE_INHERITED:r.STYLE_UNDEPENDENT),this.getElement()&&!Kekule.HtmlElementUtils.isFormCtrlElement(this.getCoreElement())&&this.getUseNormalBackground()&&(e+=" "+Kekule.Widget.HtmlClassNames.NORMAL_BACKGROUND),e+=" "+this.doGetWidgetClassName()},doGetWidgetClassName:function(){return""},hasClassName:function(e){return t.hasClass(this.getElement(),e)},addClassName:function(e,r){if(this.getElement())if(r){var i=this.getCustomHtmlClassName();i=Kekule.StrUtils.addTokens(i,e),this.setCustomHtmlClassName(i)}else t.addClass(this.getElement(),e);else this._pendingHtmlClassNames=Kekule.StrUtils.addTokens(this._pendingHtmlClassNames,e);return this},removeClassName:function(e,r){if(this.getElement())if(r){var i=this.getCustomHtmlClassName();i=Kekule.StrUtils.removeTokens(i,e),this.setCustomHtmlClassName(i)}else t.removeClass(this.getElement(),e);else this._pendingHtmlClassNames=Kekule.StrUtils.removeTokens(this._pendingHtmlClassNames,e);return this},toggleClassName:function(e,r){if(this.getElement())if(r){var i=this.getCustomHtmlClassName();i=Kekule.StrUtils.toggleTokens(i,e),this.setCustomHtmlClassName(i)}else t.toggleClass(this.getElement(),e);return this},isElementBindable:function(e){var t=this.getBindableElemTagNames();if(t){var r=e.tagName;return t.indexOf(r.toLowerCase())>=0}return!0},getBindableElemTagNames:function(){return this.getPrototype().hasOwnProperty("BINDABLE_TAG_NAMES")?this.BINDABLE_TAG_NAMES:null},bindElement:function(e){if(e){if(!this.isElementBindable(e))return void Kekule.error(Kekule.$L("ErrorMsg.WIDGET_CAN_NOT_BIND_TO_ELEM").format(this.getClassName(),e.tagName));this.beginUpdate();try{var i=e.className;i&&this.setCustomHtmlClassName(this.getCustomHtmlClassName()||" "+i);var n=this.getDefaultTabIndex();Kekule.ObjUtils.notUnset(n)&&!e.getAttribute("tabindex")&&(e.tabIndex=n);var o=Kekule.DomUtils,a=Kekule.HtmlElementUtils;!function(e){for(var t=o.getDirectChildElems(e),i=t.length-1;i>=0;--i){var n=t[i];a.hasClass(n,r.DYN_CREATED)&&e.removeChild(n)}}(e);var s=this.getDocument().createDocumentFragment(),l=this.doCreateSubElements(this.getDocument(),s);if(l&&l.length)for(var u=0,d=l.length;u<d;++u){var c=l[u];a.addClass(c,r.DYN_CREATED)}(l&&l.length||s.children&&s.children.length||s.childNodes&&s.childNodes.length)&&e.appendChild(s),this.doBindElement(e),this._applyToAllInheritedStyles(this.getInheritedStyles(),!0),Kekule.DomUtils.hasAttribute(e,"disabled")&&this.setEnabled(!1);var h=this.getWidgetClassName();t.addClass(e,h),(h=this.getCustomHtmlClassName())&&t.addClass(e,h),this.getTextSelectable()||t.addClass(e,r.NONSELECTABLE),this._pendingHtmlClassNames&&(t.addClass(e,this._pendingHtmlClassNames),this._pendingHtmlClassNames="");var p=e.getAttribute("width"),g=e.getAttribute("height");(Kekule.ObjUtils.notUnset(p)||Kekule.ObjUtils.notUnset(g))&&(p=parseFloat((p||"").toString())||0,g=parseFloat((g||"").toString())||0,this.setDimension(p,g));var f=Kekule.DomUtils.getDataset(e);if(f)for(var C in f){var m=f[C];try{Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,C,m)}catch(e){Kekule.warn(e)}}var T=this.getTouchAction();Kekule.ObjUtils.notUnset(T)&&this.setTouchAction(T),this.getIsDumb()||this.installUiEventHandlers(e),e.__$kekule_widget__=this,this.elementBound(e)}finally{this.endUpdate(),this.invokeEvent("bind",{widget:this,element:e})}}},doBindElement:function(e){},elementBound:function(e){},unbindElement:function(e){if(e){this.getIsDumb()||this.uninstallUiEventHandlers(e);var r=this.getWidgetClassName();t.removeClass(e,r),this.doUnbindElement(e),e.__$kekule_widget__=void 0;try{delete e.__$kekule_widget__}catch(e){}this.elementUnbound(e),this.invokeEvent("unbind",{widget:this,element:e})}},doUnbindElement:function(e){},elementUnbound:function(e){},elementChanged:function(e,t){t&&this.unbindElement(t),e&&this.bindElement(e)},getDefaultTabIndex:function(){return this.doGetDefaultTabIndex()},doGetDefaultTabIndex:function(){return 0},observeElementAttribChangesChanged:function(e){var t=this.getElement();e?this._installAttribMutationObserver(t):this._uninstallAttribMutationObserver(t)},_installAttribMutationObserver:function(e){if(Kekule.X.MutationObserver){if(!this._attribMutationObserver){var t=new Kekule.X.MutationObserver(this._reactElemAttribMutationBind);this._attribMutationObserver=t}this._attribMutationObserver.observe(e,{attributes:!0})}},_uninstallAttribMutationObserver:function(e){this._attribMutationObserver&&this._attribMutationObserver.disconnect()},_reactElemAttribMutation:function(e){for(var t=this.getElement(),r=this.getCoreElement(),i=0,n=e.length;i<n;++i){var o=e[i];if("attributes"===o.type&&(o.target===t||o.target===r)){var a=o.attributeName;if(a)if("style"===a.toLowerCase())this.notifyStyleAttribChanged(o.target);else if(Kekule.DomUtils.isDataAttribName(a)){var s=Kekule.DomUtils.getDataAttribCoreName(a);if(s){var l=t.getAttribute(a);Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,s,l)}}}}},notifyStyleAttribChanged:function(e){},createDecorationContent:function(e,i){var n=e.ownerDocument.createElement("span");return t.addClass(n,[r.PART_CONTENT,r.PART_DECORATION_CONTENT,r.DYN_CREATED]),i?e.insertBefore(n,i):e.appendChild(n),n},createTextContent:function(e,i,n){var o=i.ownerDocument.createElement("span");return t.addClass(o,[r.PART_CONTENT,r.PART_TEXT_CONTENT,r.DYN_CREATED]),o.innerHTML=e,n?i.insertBefore(o,n):i.appendChild(o),o},createGlyphContent:function(e,i,n){var o=e.ownerDocument.createElement("span");return t.addClass(o,[r.PART_CONTENT,r.PART_GLYPH_CONTENT,r.DYN_CREATED]),n&&t.addClass(o,n),i?e.insertBefore(o,i):e.appendChild(o),o},_touchActionNoneTouchStartHandler:function(e){try{e.preventDefault()}catch(e){}},installUiEventHandlers:function(e){for(var t=Kekule.Widget.UiLocalEvents,r=0,i=t.length;r<i;++r)Kekule.X.Event.addListener(e,t[r],this.reactUiEventBind)},uninstallUiEventHandlers:function(e){for(var t=Kekule.Widget.UiLocalEvents,r=0,i=t.length;r<i;++r)Kekule.X.Event.removeListener(e,t[r],this.reactUiEventBind)},registerHtmlEventResponser:function(e){return this.getHtmlEventDispatcher().registerResponser(e),this},unregisterHtmlEventResponser:function(e){return this.getHtmlEventDispatcher().unregisterResponser(e),this},addHtmlEventResponser:function(e,t,r){return this.getHtmlEventDispatcher().addResponser(e,t,r)},reactUiEvent:function(e){if(this.getStatic());else if(this.getEnabled()){var t,r=!1,i=e.getType(),n=e.getTarget(),o=Kekule.Widget.Utils.getBelongedResponsiveWidget(n)===this,a=Kekule.X.Event.KeyCode;if("mousemove"===i||"pointermove"===i){this.reactPointerMoving(e);var s=this.getEventMouseRelCoord(e),l=this.testMouseCursor(s,e);Kekule.ObjUtils.notUnset(l)&&this.getElement()&&(this.setCursor(l),r=!0)}else if("touchmove"===i){if(this.reactPointerMoving(e),this.getIsActive()&&!this.isCaptureMouse()){var u=e.touches[0];if(u){var d=this.getDocument().elementFromPoint(u.clientX,u.clientY);Kekule.DomUtils.isOrIsDescendantOf(d,this.getElement())||(this.setIsHover(!1),this.setIsActive(!1))}else this.setIsHover(!1),this.setIsActive(!1)}r=!0}else if("focus"===i)o&&e.getTarget()===this.getCoreElement()&&(this.setIsFocused(!0),r=!0);else if("blur"===i){if(o&&e.getTarget()==this.getCoreElement()){var c=this.getDocument().activeElement,h=this.getElement();c&&(Kekule.DomUtils.isDescendantOf(c,h)||c===h)||this.setIsFocused(!1),r=!0}}else if("pointerover"===i)"touch"===e.pointerType||e.ghostMouseEvent||this.setIsHover(!0),r=!0;else if("mouseout"===i||"touchleave"===i){if(!e.ghostMouseEvent){var p=e.getRelatedTarget();p&&Kekule.DomUtils.isOrIsDescendantOf(p,this.getCoreElement())||(this.setIsHover(!1),this.isCaptureMouse()||(this.reactDeactiviting(e),r=!0))}}else"pointerdown"===i&&e.getButton()===Kekule.X.Event.MouseButton.LEFT?(o&&!e.ghostMouseEvent&&this.reactActiviting(e),r=!0):"pointerup"===i&&e.getButton()===Kekule.X.Event.MouseButton.LEFT||"touchcancel"===i?(o&&!e.ghostMouseEvent&&this.reactDeactiviting(e),r=!0):"keydown"===i?(t=e.getKeyCode())!==a.ENTER&&t!==a.SPACE||(o&&!this.getIsActive()&&this.reactActiviting(e),r=!0):"keyup"===i&&((t=e.getKeyCode())!==a.ENTER&&t!==a.SPACE||(o&&this.getIsActive()&&this.reactDeactiviting(e),r=!0));this.doBeforeDispatchUiEvent(e);var g=Kekule.Widget.getEventHandleFuncName(e.getType());this[g]&&(r=this[g](e)),e.cancelBubble||(r=this.dispatchEventToIaControllers(e)||r),e.cancelBubble||this.getHtmlEventDispatcher().dispatch(e),this.doReactUiEvent(e),this.invokeEvent(i,{htmlEvent:e})}else e.stopPropagation();if(this.getActualBubbleUiEvents()&&!e.cancelBubble){var f=this.getParent();f&&f.reactUiEvent&&f.reactUiEvent(e)}},doReactUiEvent:function(e){},doBeforeDispatchUiEvent:function(e){},_supportGestureEvent:function(){return void 0!==Kekule.$jsRoot.Hammer&&Kekule.$jsRoot.document&&Kekule.$jsRoot.document.addEventListener},startObservingGestureEvents:function(t){if(this._supportGestureEvent()){t||(t=Kekule.Widget.TouchGestures);var r=e.exclude(t,this.getObservingGestureEvents()||[]);r.length&&this.installHammerTouchHandlers(r)}},stopObservingGestureEvents:function(t){if(this._supportGestureEvent()&&this.getObservingGestureEvents()){t||(t=Kekule.Widget.TouchGestures);var r=e.intersect(t,this.getObservingGestureEvents());r.length&&this.uninstallHammerTouchHandlers(r)}},installHammerTouchHandlers:function(e){if(this._supportGestureEvent()){e||(e=Kekule.Widget.TouchGestures);var t=this.getCoreElement(),r=new Hammer(t);return e.indexOf("pinch")>=0&&r.get("pinch").set({enable:!0}),e.indexOf("rotate")>=0&&r.get("rotate").set({enable:!0}),r.on(e.join(" "),this.reactTouchGestureBind),this._hammertime=r,this.setPropStoreFieldValue("observingGestureEvents",e),r}},uninstallHammerTouchHandlers:function(e){this._hammertime&&(e||(e=this.getObservingGestureEvents()),this._hammertime.off(e.join(" "),this.reactTouchGestureBind))},reactTouchGesture:function(e){var t=Kekule.Widget.getTouchGestureHandleFuncName(e.getType&&e.getType()||e.type);this[t]?this[t](e):this.dispatchEventToIaControllers(e,"hammer")},reactActiviting:function(e){this.getIsActive()||(this.setIsActive(!0),this.doReactActiviting(e),this.invokeEvent("activate",{widget:this}))},doReactActiviting:function(e){},reactDeactiviting:function(e){this.getIsActive()&&(this.doReactDeactiviting(e),this.invokeEvent("deactivate",{widget:this}),this.setIsActive(!1))},doReactDeactiviting:function(e){},reactPointerMoving:function(e){this.doReactPointerMoving(e)},doReactPointerMoving:function(e){},dispatchEventToIaControllers:function(e,t){var r=!1,i=this.getActiveIaController();return i&&(r="hammer"===t?i.handleGestureEvent(e):i.handleUiEvent(e)),r||(i=this.getDefIaController())&&(r="hammer"===t?i.handleGestureEvent(e):i.handleUiEvent(e)),r},getEventMouseRelCoord:function(e,t){t||(t=this.getCoreElement());var r={x:e.getClientX(),y:e.getClientY()},i=Kekule.HtmlElementUtils.getElemPageRect(t,!0),n={x:i.left-t.scrollLeft,y:i.top-t.scrollTop};return Kekule.CoordUtils.substract(r,n)},testMouseCursor:function(e,t){var r=this.doTestMouseCursor(e,t);if(!r){var i=this.getActiveIaController();if(i){var n=i.testMouseCursor(e,t);Kekule.ObjUtils.notUnset(n)&&(r=n)}if(!r&&(i=this.getDefIaController())){n=i.testMouseCursor(e,t);Kekule.ObjUtils.notUnset(n)&&(r=n)}}return r},doTestMouseCursor:function(e,t){return null},setMouseCapture:function(e){var t=this.getGlobalManager();e?t.setMouseCaptureWidget(this):this.isCaptureMouse()&&t.setMouseCaptureWidget(null)},isCaptureMouse:function(){return this.getGlobalManager().getMouseCaptureWidget()===this},_getEventMouseCoord:function(e,t){var r=t||this.getElement(),i=e.getTarget(),n=e.getOffsetCoord(!0);if(i===r)return n;var o=Kekule.HtmlElementUtils.getElemPagePos(r),a=Kekule.HtmlElementUtils.getElemPagePos(i),s={x:a.x-o.x,y:a.y-o.y};return n=Kekule.CoordUtils.substract(n,s)},_filterDraggedDataItemByKinds:function(e,t){if(e.items){for(var r=[],i=0,n=e.items.length;i<n;++i){var o=e.items[i];t.indexOf(o.kind)>=0&&r.push(o)}return r}return null},dragStart:function(e){if(this.getDraggable()){var t=this.doDragStart(e);return this.invokeEvent("dragStart",{widget:this,dataTransfer:e.dataTransfer,startingElem:e.targetElem}),t}return!1},doDragStart:function(e,t){return!0},dragEnd:function(e){var t=this.doDragEnd(e);return this.invokeEvent("dragEnd",{widget:this,dataTransfer:e.dataTransfer,startingElem:e.targetElem}),t},doDragEnd:function(e){},acceptDragSrc:function(e){if(this.getDroppable()){var t=!0,r={widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files};if(this.invokeEvent("dragAcceptQuery",r),Kekule.ObjUtils.notUnset(r.result))return t=r.result;var i=this.getDroppableDataKinds();return i&&(e.dataTransfer.items?t=!!this._filterDraggedDataItemByKinds(e.dataTransfer,i).length:i.indexOf("file")>=0&&e.dataTransfer.files&&e.dataTransfer.files.length&&(t=!0)),t&&this.doAcceptDragSrc(e)}return!1},doAcceptDragSrc:function(e){return!0},dragOver:function(e){if(this.getDroppable()&&this.acceptDragSrc(e)){var t=this.doDragOver(e);return this.invokeEvent("dragOver",{widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files}),t}return!1},doDragOver:function(e){return!0},dragLeave:function(e){var t=this.doDragLeave(e);return this.invokeEvent("dragLeave",{widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files}),t},doDragLeave:function(e){},dragDrop:function(e){if(this.getDroppable()&&this.acceptDragSrc(e)){var t=this.doDragDrop(e),r=this.getDroppableDataKinds();if(!r||r.indexOf("file")>=0){var i=e.dataTransfer.files;i&&i.length&&(t=t||this.doFileDragDrop(i))}var n={widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files};return this.invokeEvent("dragDrop",n),t||n._preventDefault}return!1},doDragDrop:function(e){return!1},doFileDragDrop:function(e){return!0},addIaController:function(e,t,r){this.getIaControllerMap().set(e,t),r&&this.setDefIaControllerId(e),t&&t.setWidget(this)},removeIaController:function(e){var t=this.getIaControllerMap().get(e);t&&(this.getIaControllerMap().remove(e),e===this.getDefIaControllerId()&&this.setDefIaControllerId(null),e===this.getActiveIaControllerId()&&this.setActiveIaControllerId(null),t.setWidget(null))},getIaController:function(e){return this.getIaControllerMap().get(e)},execute:function(e){this.doExecute(e),this.invokeEvent("execute",{widget:this,htmlEvent:e})},doExecute:function(e){},isPeriodicalExecuting:function(){return this._periodicalExecBind},startPeriodicalExec:function(e){var t=this.getPeriodicalExecDelay()||0;this._periodicalExecuting=!0,this._periodicalExecHtmlEvent=e,this._periodicalExecHtmlEvent.__$periodicalExecuting$__=!0,setTimeout(this._periodicalExecBind,t)},stopPeriodicalExec:function(){this._periodicalExecuting=!1,this._periodicalExecHtmlEvent=null},_periodicalExec:function(e){this.isPeriodicalExecuting()&&(this._waitPeriodicalProcess||(this._waitPeriodicalProcess=!0,this.execute(this._periodicalExecHtmlEvent),this._waitPeriodicalProcess=!1),setTimeout(this._periodicalExecBind,this.getPeriodicalExecInterval()||20))}}),Kekule.Widget.InteractionController=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.InteractionController",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setWidget(e)},doFinalize:function(){this.setWidget(null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},activated:function(e){},handleUiEvent:function(e){var t=e.getType(),r=Kekule.Widget.getEventHandleFuncName(t);return!!this[r]&&this[r](e)},handleGestureEvent:function(e){var t=e.type,r=Kekule.Widget.getEventHandleFuncName(t);return!!this[r]&&this[r](e)},_defEventHandler:function(e){return!1},testMouseCursor:function(e,t){return this.doTestMouseCursor(e,t)},doTestMouseCursor:function(e,t){return null},_getEventMouseCoord:function(e,t){return this.getWidget()._getEventMouseCoord(e,t)}}),Kekule.Widget.DumbWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DumbWidget",initialize:function(e){this.tryApplySuper("initialize",[e,!0])},doGetDefaultTabIndex:function(){return null},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.DUMB_WIDGET},doCreateRootElement:function(e){return e.createElement("span")}}),Kekule.Widget.PlaceHolder=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.PlaceHolder",initialize:function(e,t){this.setPropStoreFieldValue("targetWidgetClass",t),this.tryApplySuper("initialize",[e,!0])},initProperties:function(){this.defineProp("targetWidgetClass",{dataType:DataType.CLASS,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("targetWidgetClass");if(!e){var t=this.getPropStoreFieldValue("targetWidgetClassName");t&&(e=ClassEx.findClass(t))}return e}}),this.defineProp("targetWidgetClassName",{dataType:DataType.STRING,getter:function(){var e=this.getTargetWidgetClass();return e?ClassEx.getClassName(e):this.getPropStoreFieldValue("targetWidgetClassName")},setter:function(e){this.setPropStoreFieldValue("targetWidgetClassName",e),this.setTargetWidgetClass(ClassEx.findClass(e))}}),this.defineProp("target",{dataType:DataType.STRING,getter:function(){return this.getTargetWidgetClassName()},setter:function(e){this.setTargetWidgetClassName(e)}}),this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:"false",setter:null,getter:function(){var e=this.getPropStoreFieldValue("targetWidget");return e||(e=this.createTargetWidget()),e}})},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+r.PLACEHOLDER,t=this.getTargetWidgetClass();if(t){var i=ClassEx.getPrototype(t).getWidgetClassName();e=Kekule.StrUtils.addTokens(e,i)}return e},doCreateRootElement:function(e){return e.createElement("img")},doReactUiEvent:function(e){this.createTargetWidget()},createTargetWidget:function(){var t=this.getTargetWidgetClass();if(t){try{var r=this.getElement(),i=this.getParent();i&&i instanceof Kekule.Widget.PlaceHolder&&(i=i.createTargetWidget());var n=e.clone(this.getChildWidgets());this.unbindElement(this.getElement()),this.setPropStoreFieldValue("element",null);var o=new t(r);if(o){if(i){var a=this.getNextSibling();this.setParent(null),o.setPropStoreFieldValue("parent",i),i._insertChild(o,a)}if(n)for(var s=0,l=n.length;s<l;++s)n[s].setParent(o)}}finally{this.finalize()}return o}Kekule.error(Kekule.$L("ErrorMsg.WIDGET_UNAVAILABLE_FOR_PLACEHOLDER"))}}),Kekule.Widget.Utils={getWidgetOnElem:function(e,t){var r=e.__$kekule_widget__;return!t&&r instanceof Kekule.Widget.PlaceHolder&&(r=r.getTargetWidget()),r},getWidgetsInsideElem:function(e,t){var r,i=Kekule.Widget.Utils.getWidgetOnElem(e);if(i){if(r=[i],!t)return r}else r=[];for(var n=Kekule.DomUtils.getDirectChildElems(e),o=0,a=n.length;o<a;++o){var s=n[o],l=Kekule.Widget.Utils.getWidgetsInsideElem(s,t);r=r.concat(l)}return r},getWidgetById:function(e,t){t||(t=Kekule.$jsRoot.document);var r=t.getElementById(e);return r?Kekule.Widget.Utils.getWidgetOnElem(r):void 0},getBelongedWidget:function(e){for(var t=null;e&&!t;)t=Kekule.Widget.Utils.getWidgetOnElem(e),e=e.parentNode;return t},getBelongedResponsiveWidget:function(e){for(var t=null;e&&!t;)(t=Kekule.Widget.Utils.getWidgetOnElem(e))&&t.getStatic()&&(t=null),e=e.parentNode;return t},createFromHash:function(e,t){var r=t.widgetClass||t.widget;if("string"==typeof r&&(r=ClassEx.findClass(r)),!r)return Kekule.error(Kekule.$L("ErrorMsg.WIDGET_CLASS_NOT_FOUND")),null;for(var i=new r(e),n=Kekule.ObjUtils.getOwnedFieldNames(t,!0),o=0,a=(n=Kekule.ArrayUtils.exclude(n,["widget","widgetClass","htmlClass","children"])).length;o<a;++o){var s=n[o],l=t[s];if(s.startsWith("#")&&DataType.isFunctionValue(l)){var u=s.substr(1);i.addEventListener(u,l)}else i.hasProperty(s)&&i.setPropValue(s,l)}if(t.htmlClass&&i.addClassName(t.htmlClass,!0),t.children){var d=t.children;if(DataType.isArrayValue(d))for(o=0,a=d.length;o<a;++o){var c=d[o],h=Kekule.Widget.Utils.createFromHash(i,c);h&&h.appendToWidget(i)}}return i},setWidgetPropFromElemAttrib:function(e,t,r){var i=t.camelize(),n=e.getPropertyDataType(i);if(n||(t.startsWith("data-")&&(i=t.substr(5).camelize(),n=e.getPropertyDataType(i)),n))if(n===DataType.STRING)e.setPropValue(i,r);else if(Kekule.PredefinedResReferer.isResValue(r))Kekule.PredefinedResReferer.loadResource(r,function(t,r){e.loadPredefinedResDataToProp&&e.loadPredefinedResDataToProp(i,t,r)},null,e.getDocument());else if(r&&r.startsWith("#")&&ClassEx.isOrIsDescendantOf(ClassEx.findClass(n),Kekule.Widget.BaseWidget)){var o=r.substr(1).trim();Kekule.Widget.Utils._setWidgetRefPropFromId(e,i,o)}else{var a=JSON.parse(r);if(Kekule.ObjUtils.notUnset(a)){var s=Class.ObjSerializerFactory.getSerializer("json").load(null,a);e.setPropValue(i,s)}}},_setWidgetRefPropFromId:function(e,t,r){if(r){var i=Kekule.Widget.getWidgetById(r,e.getDocument());i&&e.setPropValue(t,i)}},getGlobalManager:function(e){var t=e||Kekule.$document,r=t&&Kekule.DocumentUtils.getDefaultView(t),i=r&&r.Kekule;return i||(i=Kekule),i.Widget.globalManager},getThemeUrl:function(e){var t=null;e||(e="default");var r=Kekule.getScriptPath();r&&(t=r+((Kekule.isUsingMinJs()?"themes/":"widgets/themes/")+e)+"/kekule.css");return t}},Kekule.Widget.getWidgetOnElem=Kekule.Widget.Utils.getWidgetOnElem,Kekule.Widget.getWidgetById=Kekule.Widget.Utils.getWidgetById,Kekule.$W=Kekule.Widget.Utils.getWidgetById,Kekule.Widget.getBelongedWidget=Kekule.Widget.Utils.getBelongedWidget,Kekule.Widget.createFromHash=Kekule.Widget.Utils.createFromHash,Kekule.Widget.BaseEventsReceiver=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseEventsReceiver",initialize:function(e,t){this._document=e||Kekule.$jsRoot.document,this._eventRootObj=t||this._document&&this._document.documentElement,this.reactUiEventBind=this.reactUiEvent.bind(this),this.reactDomNodeInsertEventBind=this.reactDomNodeInsertEvent.bind(this),this.reactDomNodeRemoveEventBind=this.reactDomNodeRemoveEvent.bind(this),this.tryApplySuper("initialize");var r=this;(function(){Kekule.X.domReady(r.domReadyInit.bind(r),this._document)}).defer()},finalize:function(){var e=this.getEventRootObj();e&&(this.uninstallGlobalDomMutationHandlers(e),this.uninstallGlobalEventHandlers(e)),this.tryApplySuper("finalize")},getEventRootObj:function(){return this._eventRootObj},domReadyInit:function(){var e=this.getEventRootObj();e&&(this.installGlobalEventHandlers(e),this.installGlobalDomMutationHandlers(e))},installGlobalEventHandlers:function(e){if(!this._globalEventInstalled){for(var t=Kekule.Widget.UiEvents,r=0,i=t.length;r<i;++r)"touchstart"===t[r]||"touchmove"===t[r]||"touchend"===t[r]?Kekule.X.Event.addListener(e,t[r],this.reactUiEventBind,{passive:!0}):Kekule.X.Event.addListener(e,t[r],this.reactUiEventBind);this._globalEventInstalled=!0}},uninstallGlobalEventHandlers:function(e){for(var t=Kekule.Widget.UiEvents,r=0,i=t.length;r<i;++r)Kekule.X.Event.removeListener(e,t[r],this.reactUiEventBind)},installGlobalDomMutationHandlers:function(e){var t=this;if(Kekule.X.MutationObserver&&Kekule.DomUtils.isElement(e)){var r=new Kekule.X.MutationObserver(function(e){t.reactDomMutation(e)});r.observe(e,{childList:!0,subtree:!0}),this._domMutationObserver=r}else Kekule.X.Event.addListener(e,"DOMNodeInserted",this.reactDomNodeInsertEventBind),Kekule.X.Event.addListener(e,"DOMNodeRemoved",this.reactDomNodeRemoveEventBind)},uninstallGlobalDomMutationHandlers:function(e){this._domMutationObserver&&this._domMutationObserver.disconnect(),this._reactDomNodeInserted&&Kekule.X.Event.removeListener(e,"DOMNodeInserted",this.reactDomNodeInsertEventBind),this._reactDomNodeRemoved&&Kekule.X.Event.removeListener(e,"DOMNodeRemoved",this.reactDomNodeRemoveEventBind)},reactUiEvent:function(e){},reactDomNodeInsertEvent:function(e){},reactDomNodeRemoveEvent:function(e){},reactDomMutation:function(e){}}),Kekule.Widget.GlobalManager=Class.create(Kekule.Widget.BaseEventsReceiver,{CLASS_NAME:"Kekule.Widget.GlobalManager",INFO_FIELD:"__$info__",ISOLATED_LAYER_FIELD:"__$isolated_layer__",TOPMOST_LAYER_FIELD:"__$topmost_layer__",THEME_LOADED_FIELD:"__$theme_loaded__",initialize:function(e){this._document=e||Kekule.$jsRoot.document,this._touchEventSeq=[],this._hammertime=null,this._globalSysElems=[],this.setPropStoreFieldValue("popupWidgets",[]),this.setPropStoreFieldValue("dialogWidgets",[]),this.setPropStoreFieldValue("modalWidgets",[]),this.setPropStoreFieldValue("autoResizeWidgets",[]),this.setPropStoreFieldValue("widgets",[]),this.setPropStoreFieldValue("draggingElems",[]),this.setPropStoreFieldValue("preserveWidgetList",!0),this.setPropStoreFieldValue("enableMouseEventToPointerPolyfill",!0),this.setPropStoreFieldValue("enableHammerGesture",!1),this.setPropStoreFieldValue("htmlEventDispatcher",new Kekule.Widget.HtmlEventDispatcher),this.reactTouchGestureBind=this.reactTouchGesture.bind(this),this.reactWindowResizeBind=this.reactWindowResize.bind(this),this.tryApplySuper("initialize",[this._document,this._document&&this._document.documentElement])},finalize:function(){this.getHtmlEventDispatcher().finalize(),this.uninstallWindowEventHandlers(Kekule.DocumentUtils.getDefaultView(this._document)),this._hammertime=null,this.setPropStoreFieldValue("popupWidgets",null),this.setPropStoreFieldValue("widgets",null),this.setPropStoreFieldValue("draggingElems",null),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("mouseCaptureWidget",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("popupWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("dialogWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("modalWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("autoResizeWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("draggingElems",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("preserveWidgetList",{dataType:DataType.BOOL,serializable:!1,setter:function(e){this.setPropStoreFieldValue("preserveWidgetList",e),e||this.setPropStoreFieldValue("widgets",[])}}),this.defineProp("widgets",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("currHoverWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("currActiveWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("currFocusedWidget");return e&&e.isShown&&e.isShown()?e:null}}),this.defineProp("currFocusedWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("currFocusedWidget");return e&&e.isShown&&e.isShown()?e:null}}),this.defineProp("modalBackgroundElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("enableHammerGesture",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableMouseEventToPointerPolyfill",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("htmlEventDispatcher",{dataType:"Kekule.Widget.HtmlEventDispatcher",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null})},domReadyInit:function(){this.tryApplySuper("domReadyInit"),this.getEnableHammerGesture()&&(this._hammertime=this.installGlobalHammerTouchHandlers(this._document.body)),this.installWindowEventHandlers(Kekule.DocumentUtils.getDefaultView(this._document))},getDefaultContextRootElem:function(){return this.getDocContextRootElem()},getDocContextRootElem:function(){return this._document.body},_detectIfThemeLoaded:function(e){var t=e[this.THEME_LOADED_FIELD];if(!t){var r=e.ownerDocument.createElement("span");r.className="K-StyleSheet-Detector",r.style.visibility="hidden",e.appendChild(r),-88888==Kekule.StyleUtils.getComputedStyle(r,"z-index")?(t=!0,e[this.THEME_LOADED_FIELD]=t):t=!1,e.removeChild(r)}return t},loadTheme:function(e,t){if(e||(e=this.getDefaultContextRootElem()),!this._detectIfThemeLoaded(e)){var r=Kekule.Widget.Utils.getThemeUrl(t);Kekule.UrlUtils.extractProtocal(r)||(r=Kekule.UrlUtils.normalizePath("file:///"+r));var i=e.ownerDocument.createElement("style");i.innerHTML='@import "'+r+'"',e.appendChild(i),e[this.THEME_LOADED_FIELD]=!0}},notifyWidgetCreated:function(e){this.getPreserveWidgetList()&&this.getWidgets().push(e),this.invokeEvent("widgetCreate",{widget:e})},notifyWidgetFinalized:function(e){this.getWidgets()&&Kekule.ArrayUtils.remove(this.getWidgets(),e),this.getPopupWidgets()&&Kekule.ArrayUtils.remove(this.getPopupWidgets(),e),this.getDialogWidgets()&&Kekule.ArrayUtils.remove(this.getDialogWidgets(),e),this.getAutoResizeWidgets()&&Kekule.ArrayUtils.remove(this.getAutoResizeWidgets(),e),e===this.getCurrActiveWidget()&&this.setCurrActiveWidget(null),e===this.getCurrFocusedWidget()&&this.setCurrFocusedWidget(null),this.invokeEvent("widgetFinalize",{widget:e})},notifyWidgetHoverChanged:function(e,t){var r=this.getCurrHoverWidget();t?e!==r&&(r&&r.setIsHover(!1),this.setCurrHoverWidget(e)):r===e&&this.setCurrHoverWidget(null)},notifyWidgetActiveChanged:function(e,t){var r=this.getCurrActiveWidget();t?e!==r&&(r&&r.setIsActive(!1),this.setCurrActiveWidget(e)):r===e&&this.setCurrActiveWidget(null)},notifyWidgetFocusChanged:function(e,t){var r=this.getCurrFocusedWidget();t?e!==r&&(r&&r.setIsFocused(!1),this.setCurrFocusedWidget(e)):r===e&&this.setCurrFocusedWidget(null)},hasPopupWidgets:function(){return!!this.getPopupWidgets().length},hasDialogWidgets:function(){return!!this.getDialogWidgets().length},getBelongedResponsiveWidget:function(e){return Kekule.Widget.Utils.getBelongedResponsiveWidget(e)},notifyWidgetEventFired:function(e,t,r){var i=Object.extend({},r);i.widget=e,this.invokeEvent(t,i)},installWindowEventHandlers:function(e){Kekule.X.Event.addListener(e,"resize",this.reactWindowResizeBind)},uninstallWindowEventHandlers:function(e){Kekule.X.Event.removeListener(e,"resize",this.reactWindowResizeBind)},installGlobalHammerTouchHandlers:function(e){if(void 0!==Kekule.$jsRoot.Hammer){var t=new Hammer(e);return t.get("pinch").set({enable:!0}),t.get("rotate").set({enable:!0}),t.on(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind),this._hammertime=t,t}},uninstallGlobalHammerTouchHandlers:function(e){this._hammertime&&this._hammertime.off(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind)},registerHtmlEventResponser:function(e){return this.getHtmlEventDispatcher().registerResponser(e),this},unregisterHtmlEventResponser:function(e){return this.getHtmlEventDispatcher().unregisterResponser(e),this},_handleDomAddedElem:function(e){for(var t=Kekule.Widget.Utils.getWidgetsInsideElem(e,!0),r=0,i=t.length;r<i;++r){(n=t[r]).insertedToDom()}var n;(n=Kekule.Widget.Utils.getBelongedWidget(e))&&(n.getElement()===e?n.insertedToDom():n.domElemAdded(e))},_handleDomRemovedElem:function(e){for(var t=Kekule.Widget.Utils.getWidgetsInsideElem(e,!0),r=0,i=t.length;r<i;++r){(n=t[r]).removedFromDom()}var n;(n=Kekule.Widget.Utils.getBelongedWidget(e))&&n.domElemRemoved(e)},isMouseEvent:function(e){return e.startsWith("mouse")||"click"===e},isTouchEvent:function(e){return e.startsWith("touch")},isPointerEvent:function(e){return e.startsWith("pointer")},isKeyEvent:function(e){return e.startsWith("key")},mapTouchToPointerEvent:function(e){var t,r=e.getType(),i=e;if(i.pointerType="touch","touchstart"===r?t="pointerdown":"touchmove"===r?t="pointermove":"touchleave"===r?t="pointerout":"touchend"===r&&(t="pointerup"),t){i.setType(t),i.button=Kekule.X.Event.MouseButton.LEFT;var n=e.touches[0],o=["clientX","clientY","pageX","pageY","screenX","screenY"];if(n){for(var a={},s=0,l=o.length;s<l;++s){i[d=o[s]]=n[d],a[d]=n[d]}this._document;var u=this._retrieveTouchEventActualTarget(i);i.setTarget(u),this._touchPointerMapData={positionCache:a,targetCache:i.getTarget()}}else{if(this._touchPointerMapData)for(s=0,l=o.length;s<l;++s){var d;i[d=o[s]]=this._touchPointerMapData.positionCache[d]}i.setTarget(this._touchPointerMapData.targetCache)}return i}return null},_retrieveTouchEventActualTarget:function(e){var t=e.getTarget();return this._retrieveElementFromClientCoord(t,e.getClientX(),e.getClientY())},_retrieveElementFromClientCoord:function(e,t,r){var i=e;if(e.shadowRoot&&e.getRootNode){var n=e.shadowRoot;if(n.elementFromPoint){var o=n.elementFromPoint(t,r);o&&o!==e&&(i=this._retrieveElementFromClientCoord(o,t,r))}}return i},reactDomNodeInsertEvent:function(e){this.tryApplySuper("reactDomNodeInsertEvent",[e]);var t=e.getTarget();t.nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(t)||this._handleDomAddedElem(t))},reactDomNodeRemoveEvent:function(e){this.tryApplySuper("reactDomNodeRemoveEvent",[e]);var t=e.getTarget();t.nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(t)||this._handleDomRemovedElem(t))},reactDomMutation:function(e){this.tryApplySuper("reactDomMutation",[e]);for(var t=0,r=e.length;t<r;++t){var i=e[t];if("childList"===i.type){for(var n=0,o=(a=i.addedNodes).length;n<o;++n){(s=a[n]).nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(s)||this._handleDomAddedElem(s))}var a;for(n=0,o=(a=i.removedNodes).length;n<o;++n){var s;(s=a[n]).nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(s)||this._handleDomRemovedElem(s))}}}},reactUiEvent:function(e){this.tryApplySuper("reactUiEvent",[e]);var t,r=e.getType();if(this.getMouseCaptureWidget()&&(this.isMouseEvent(r)||this.isTouchEvent(r)||this.isPointerEvent(r)))t=this.getMouseCaptureWidget(),!0;else{var i=e.getTarget();!(t=this.getBelongedResponsiveWidget(i))&&this.isKeyEvent(r)&&i===i.ownerDocument.body&&(t=this.getCurrFocusedWidget()||null)}if("touchstart"===r)this._touchEventSeq=["touchstart"],this._touchDoneTimeStamp=null;else if("touchcancel"===r)this._touchEventSeq=[];else if("touchend"===r)"touchstart"===this._touchEventSeq[0]&&(this._touchEventSeq.push("touchend"),this._touchDoneTimeStamp=Date.now());else if(["mousedown","mouseup","mouseover","mouseout","click"].indexOf(r)>=0)if("touchstart"===this._touchEventSeq[0]&&"touchend"===this._touchEventSeq[1])e.ghostMouseEvent=!0,"click"===r&&(this._touchEventSeq=[],this._touchDoneTimeStamp=Date.now());else if(this._touchDoneTimeStamp){Date.now()-this._touchDoneTimeStamp<1e3&&(e.ghostMouseEvent=!0)}if(this.getHtmlEventDispatcher().dispatch(e),this.doReactUiEvent(e,t),!e.ghostMouseEvent&&(Kekule.globalOptions.widget.events.forceSimulatePointerEvent||!Kekule.BrowserFeature.pointerEvent)&&this.getEnableMouseEventToPointerPolyfill()){var n=["mousedown","mousemove","mouseout","mouseover","mouseup"].indexOf(r);if(n>=0)e.setType(["pointerdown","pointermove","pointerout","pointerover","pointerup"][n]),e.pointerType="mouse",this.doReactUiEvent(e,t);else if(["touchstart","touchmove","touchleave","touchend","touchcancel"].indexOf(r)>=0){var o=this.mapTouchToPointerEvent(e);o&&this.reactUiEvent(o)}}},doReactUiEvent:function(e,t){var r=Kekule.Widget.getEventHandleFuncName(e.getType());this[r]&&this[r](e),t&&(this._htmlEventOnWidgetInvoked(t,e),t.reactUiEvent(e))},reactTouchGesture:function(e){var t=Kekule.Widget.getTouchGestureHandleFuncName(e.getType&&e.getType()||e.type);this[t]&&this[t](e);var r=Kekule.Widget.getBelongedWidget(e.target);r&&r.reactTouchGesture(e)},reactWindowResize:function(e){for(var t=this.getAutoResizeWidgets(),r=0,i=t.length;r<i;++r)t[r].isShown()&&t[r].autoResizeToClient()},_htmlEventOnWidgetInvoked:function(e,t){this.invokeEvent("htmlEventOnWidget",{widget:e,htmlEvent:t}),this.invokeEvent(t.getType(),{widget:e,htmlEvent:t})},_startPointerHolderTimer:function(e){var t=this;return this._pointerHolderTimer={pointerType:e.pointerType,button:e.getButton(),coord:{x:e.getClientX(),y:e.getClientY()},target:e.getTarget(),_timeoutId:setTimeout(function(){var r=e;r.setType("pointerhold"),t._pointerHolderTimer=null,t.reactUiEvent(r)},Kekule.Widget._PointerHoldParams.DURATION_THRESHOLD),cancel:function(){clearTimeout(t._pointerHolderTimer._timeoutId),t._pointerHolderTimer=null}},this._pointerHolderTimer},react_pointerdown:function(e){if(this.hasPopupWidgets()&&!e.ghostMouseEvent&&e.getButton()===Kekule.X.Event.MouseButton.LEFT){var t=e.getTarget();this.hidePopupWidgets(t)}this._pointerHolderTimer?e.pointerType===this._pointerHolderTimer.pointerType&&e.getButton()===this._pointerHolderTimer.button||this._pointerHolderTimer.cancel():this._startPointerHolderTimer(e)},react_pointerup:function(e){this._pointerHolderTimer&&this._pointerHolderTimer.cancel()},react_pointermove:function(e){if(this._pointerHolderTimer)if(e.getTarget()!==this._pointerHolderTimer.target)this._pointerHolderTimer.cancel();else{var t=this._pointerHolderTimer.coord,r={x:e.getClientX(),y:e.getClientY()};Kekule.CoordUtils.getDistance(t,r)>Kekule.Widget._PointerHoldParams.MOVEMENT_THRESHOLD&&this._pointerHolderTimer.cancel()}},react_keydown:function(e){e.getKeyCode()===Kekule.X.Event.KeyCode.ESC&&(this.hasPopupWidgets()?this.hidePopupWidgets(null,!0):this.hasDialogWidgets()&&this.hideTopmostDialogWidget(null,!0))},react_touchstart:function(e){if(this.hasPopupWidgets()){var t=e.getTarget();this.hidePopupWidgets(t)}},react_dragstart:function(e){this._clearDraggingElems();var t=e.getTarget();if(t&&e.dataTransfer){var r=this._appendDraggingElem(t);if(e.dataTransfer.setData)try{e.dataTransfer.setData(Kekule.Widget.DragDrop.ELEM_INDEX_DATA_TYPE,""+r)}catch(e){}var i=Kekule.Widget.getBelongedWidget(t);i&&i.dragStart({htmlEvent:e,dataTransfer:e.dataTransfer,startingElem:t})}},react_dragend:function(e){var t=e.getTarget();if(t){var r=Kekule.Widget.getBelongedWidget(t);r&&r.dragEnd({htmlEvent:e,dataTransfer:e.dataTransfer,startingElem:t})}this._dragDone(e)},react_dragover:function(e){var t=e.getTarget(),r=this._getNearestDragDropDestWidget(Kekule.Widget.getBelongedWidget(t));if(r&&r.getDroppable()&&e.dataTransfer){var i=this._getElemAndWidgetInDraggingTransfer(e.dataTransfer),n={htmlEvent:e,dataTransfer:e.dataTransfer,srcElem:i.elem,srcWidget:i.widget};r.acceptDragSrc(n)&&(e.preventDefault(),r.dragOver(n))}},react_dragleave:function(e){var t=e.getTarget(),r=this._getNearestDragDropDestWidget(Kekule.Widget.getBelongedWidget(t));if(r&&r.getDroppable()&&e.dataTransfer){var i=this._getElemAndWidgetInDraggingTransfer(e.dataTransfer),n={htmlEvent:e,dataTransfer:e.dataTransfer,srcElem:i.elem,srcWidget:i.widget};r.acceptDragSrc(n)&&r.dragLeave(n)}},react_drop:function(e){var t=e.getTarget(),r=this._getNearestDragDropDestWidget(Kekule.Widget.getBelongedWidget(t));if(r&&r.getDroppable()){var i=this._getElemAndWidgetInDraggingTransfer(e.dataTransfer),n={htmlEvent:e,dataTransfer:e.dataTransfer,srcElem:i.elem,srcWidget:i.widget};r.acceptDragSrc(n)&&r.dragDrop(n)&&e.preventDefault()}this._dragDone(e)},_dragDone:function(e){this._clearDraggingElems();var t=e.dataTransfer;t&&(t.items?t.items.clear():t.clearData())},_getNearestDragDropDestWidget:function(e){if(!e)return null;if(e.getDroppable())return e;var t=e.getParent();return t&&this._getNearestDragDropDestWidget(t)},_getElemAndWidgetInDraggingTransfer:function(e){var t,r;if(e.getData){try{var i=e.getData(Kekule.Widget.DragDrop.ELEM_INDEX_DATA_TYPE);if(Kekule.ObjUtils.notUnset(i)){var n=parseInt(i)||0;t=this.getDraggingElems()[n]}}catch(e){var o=this.getDraggingElems();o&&1===o.length&&(t=o[0])}t&&(r=Kekule.Widget.getBelongedWidget(t))}return{elem:t,widget:r}},_clearDraggingElems:function(){this.setPropStoreFieldValue("draggingElems",[])},_appendDraggingElem:function(e){var t=this.getDraggingElems();return t.push(e),t.length-1},unpreparePopupWidget:function(e){e.setPopupCaller(null),this.restoreElem(e.getElement())},preparePopupWidget:function(e,t,r){e.setPopupCaller(t);var i,n,o=e.getElement(),a=o.ownerDocument,s=t?this.getContextRootElementOfCaller(t):o.ownerDocument.body,l=this.getTopmostLayer(a,!0,s),u=o.parentNode===l,d=Kekule.Widget.ShowHideType,c=e.getAutoAdjustSizeOnPopup();if(r===d.DROPDOWN?(n=Kekule.StyleUtils.isSelfOrAncestorPositionFixed(t.getElement()),i=this._calcDropDownWidgetPosInfo(e,t,n)):i=this._calcPopupWidgetPosInfo(e,t,u),c&&i){var h=t||e,p=(a=h.getDocument?h.getDocument():h.ownerDocument,Kekule.DocumentUtils.getClientVisibleBox(a)),g=p.right-p.left,f=p.bottom-p.top,C=i.rect;C.left+C.width>g+p.left&&(i.width=p.right-C.left+"px",i.widthChanged=!0),C.top+C.height>f+p.top&&(i.height=p.bottom-C.top+"px",i.heightChanged=!0)}if(u?this.moveElemToTopmostLayer(o,!0,s):this.moveElemToTopmostLayer(o,null,s),i){var m=["left","top","right","bottom"];i.widthChanged&&m.push("width"),i.heightChanged&&m.push("height");var T={},E=o.style;r===d.DROPDOWN&&n?E.position="fixed":Kekule.StyleUtils.isAbsOrFixPositioned(o)||(E.position="absolute");for(var _=0,S=m.length;_<S;++_){var O=m[_],y=i[O];y&&(T[O]=E[O]||"",E[O]=y)}this._getElemStoredInfo(o).styles=T}},_calcPopupWidgetPosInfo:function(e,t,r){var i,n=Kekule.HtmlElementUtils,o=e.getElement();e.isShown()||(o.style.visible="hidden",o.style.display="");var a,s=!1;if(!Kekule.DomUtils.isInDomTree(o,null,{acrossShadowRoot:!0})){var l=t?this.getContextRootElementOfCaller(t):o.ownerDocument.body;(a=this.getIsolatedLayer(e.getDocument(),!0,l)).appendChild(o),s=!0}var u=n.getElemBoundingClientRect(o,!0);return i={rect:u},r||"fixed"!==Kekule.StyleUtils.getComputedStyle(o,"position")&&(i.top=u.top+"px",i.left=u.left+"px"),s&&a.removeChild(o),i},_calcDropDownWidgetPosInfo:function(e,t,r){var i=Kekule.HtmlElementUtils,n=Kekule.Widget.Position,o=t.getDropPosition?t.getDropPosition():null,a=t.getParent(),s=a&&a.getLayout()||Kekule.Widget.Layout.HORIZONTAL,l=t.getElement(),u=this.getContextRootElementOfCaller(t),d=i.getElemBoundingClientRect(l,!0),c=Kekule.DocumentUtils.getClientVisibleBox(t.getDocument()),h=e.getElement();h.style.visible="hidden",h.style.display="";var p=this.getIsolatedLayer(h.ownerDocument,!0,u);p.appendChild(h),h.style.position="relative";var g=i.getElemOffsetDimension(h),f=i.getElemScrollDimension(h),C=i.getElemPageRect(h,!0);if(h.style.position="absolute",p.removeChild(h),!o||o===n.AUTO)if(o=0,s===Kekule.Widget.Layout.VERTICAL){var m=d.x-c.left,T=c.right-d.x-d.width;T>=g.width?o|=n.RIGHT:o|=m>T?n.LEFT:n.RIGHT}else{var E=d.y-c.top,_=c.bottom-d.y-d.height;_>=g.height?o|=n.BOTTOM:o|=E>_?n.TOP:n.BOTTOM}Kekule.StyleUtils,d=i.getElemBoundingClientRect(l,!r);var S,O,y=f.width,A=f.height;if(o&n.LEFT)S=d.left-C.width;else if(o&n.RIGHT)S=d.right;else{var I=d.right-c.left;S=c.right-d.left>=C.width?d.left:I>=C.width?d.right-C.width:Math.max(c.left,c.right-C.width)}if(o&n.TOP)O=d.top-C.height;else if(o&n.BOTTOM)O=d.bottom;else{var k=d.bottom-c.top;O=c.bottom-d.top>=C.height?d.bottom:k>=C.height?d.bottom-C.height:Math.max(c.top,c.bottom-C.height)}var b={};return b.rect={left:S,top:O,width:y,height:A},S+="px",O+="px",y+="px",A+="px",b.left=S,b.top=O,b.width=y,b.height=A,b},_fillPersistentPopupWidgetsInHidden:function(e,t,r,i){var n,o,a;i.push(e);try{e&&e instanceof Kekule.Widget.BaseWidget?(n=e.getElement(),o=e.getParent(),a=e.getPopupCaller()):n=e instanceof HTMLElement?e:null}catch(e){n=null}if(n){for(var s=0,l=t.length;s<l;++s){var u=t[s];if(u===e)r.push(u);else{var d=u.getElement();Kekule.DomUtils.isDescendantOf(n,d)&&r.push(u)}}o&&i.indexOf(o)<=0&&this._fillPersistentPopupWidgetsInHidden(o,t,r,i),a&&i.indexOf(a)<=0&&this._fillPersistentPopupWidgetsInHidden(a,t,r,i)}},hidePopupWidgets:function(e,t){var r=this.getPopupWidgets(),i=Kekule.Widget.getBelongedWidget(e),n=[];i&&this._fillPersistentPopupWidgetsInHidden(i,r,n,[]);for(var o=r.length-1;o>=0;--o){var a=r[o],s=a.getElement();if(s){if(n.indexOf(a)>=0)continue;e&&(s===e||Kekule.DomUtils.isDescendantOf(e,s))||(t?a.dismiss():a.hide())}else Kekule.ArrayUtils.remove(this.getPopupWidgets(),a)}},hideTopmostDialogWidget:function(e,t){var r=this.getDialogWidgets()||[],i=r[r.length-1];i&&(i.getElement()?t?i.dismiss():i.hide():Kekule.ArrayUtils.remove(this.geDialogWidgets(),i))},registerPopupWidget:function(e){e.addClassName(r.SHOW_POPUP),Kekule.ArrayUtils.pushUnique(this.getPopupWidgets(),e)},unregisterPopupWidget:function(e){e.removeClassName(r.SHOW_POPUP),Kekule.ArrayUtils.remove(this.getPopupWidgets(),e)},registerDialogWidget:function(e){e.addClassName(r.SHOW_DIALOG),Kekule.ArrayUtils.pushUnique(this.getDialogWidgets(),e)},unregisterDialogWidget:function(e){e.removeClassName(r.SHOW_DIALOG),Kekule.ArrayUtils.remove(this.getDialogWidgets(),e)},registerModalWidget:function(e){var t=this.getCurrModalWidget();t&&t.removeClassName(r.SHOW_ACTIVE_MODAL),Kekule.ArrayUtils.pushUnique(this.getModalWidgets(),e),e.addClassName(r.SHOW_ACTIVE_MODAL)},unregisterModalWidget:function(e){e.removeClassName(r.SHOW_ACTIVE_MODAL),Kekule.ArrayUtils.remove(this.getModalWidgets(),e);var t=this.getCurrModalWidget();t&&t.addClassName(r.SHOW_ACTIVE_MODAL)},getCurrModalWidget:function(){var e=this.getModalWidgets();return e&&e.length?e[0]:null},prepareModalWidget:function(e,t){var i=e.getDocument(),n=this.getModalBackgroundElem();n||((n=i.createElement("div")).className=r.MODAL_BACKGROUND,this.setPropStoreFieldValue("modalBackgroundElem",n),this._globalSysElems.push(n));var o=e.getElement();e.setModalInfo({oldParent:o.parentNode,oldSibling:o.nextSibling}),o.parentNode&&o.parentNode.removeChild(o),n.parentNode&&n.parentNode.removeChild(n);var a=t?this.getContextRootElementOfCaller(t):o.ownerDocument.body,s=this.getTopmostLayer(i,!1,a);s&&s.parentNode===a?(a.insertBefore(n,s),a.insertBefore(o,s)):(a.appendChild(n),a.appendChild(o)),this.registerModalWidget(e)},unprepareModalWidget:function(e){e.getDocument();this.unregisterModalWidget(e);var t=e.getElement().parentNode;t&&t.removeChild(e.getElement());var r=e.getModalInfo();r&&(r.oldParent&&r.oldParent.insertBefore(e.getElement(),r.oldSibling),e.setModalInfo(null));var i=this.getCurrModalWidget(),n=this.getModalBackgroundElem();n&&(i?(n.parentNode&&n.parentNode.removeChild(n),i.getElement().parentNode.insertBefore(n,i.getElement())):n.parentNode&&n.parentNode.removeChild(n))},registerAutoResizeWidget:function(e){Kekule.ArrayUtils.pushUnique(this.getAutoResizeWidgets(),e)},unregisterAutoResizeWidget:function(e){Kekule.ArrayUtils.remove(this.getAutoResizeWidgets(),e)},getWidgetContextRootElement:function(e){return e&&e.getDocument?e.getDocument().body:this._document.body},getContextRootElementOfCaller:function(e){return e instanceof Kekule.Widget.BaseWidget?this.getWidgetContextRootElement(e):e.ownerDocument?e.ownerDocument.body:this._document.body},getTopmostLayer:function(e,t,r){e=r.ownerDocument;var i=r[this.TOPMOST_LAYER_FIELD];return i||t&&(i=this._createTopmostLayer(e,r),r.appendChild(i),r[this.TOPMOST_LAYER_FIELD]=i,this._globalSysElems.push(i)),i},_createTopmostLayer:function(e,t){var i=e.createElement("div");return i.className=r.TOP_LAYER,i},getIsolatedLayer:function(e,t,r){var i=r[this.ISOLATED_LAYER_FIELD];if(!i&&t){i=this._createIsolatedLayer(e,r),this._globalSysElems.push(i);var n=r.firstChild;n?r.insertBefore(i,n):r.appendChild(i),r[this.ISOLATED_LAYER_FIELD]=i}return i},_createIsolatedLayer:function(e,t){var i=e.createElement("div");return i.className=r.ISOLATED_LAYER,i},_isGlobalSysElement:function(e){return this._globalSysElems.indexOf(e)>=0},_getElemStoredInfo:function(e){var t=null;return e&&((t=e[this.INFO_FIELD])||(t={},e[this.INFO_FIELD]=t)),t},_clearElemStoredInfo:function(e){e[this.INFO_FIELD]&&(e[this.INFO_FIELD]=void 0)},moveElemToTopmostLayer:function(e,t,r){if(!t){var i=this._getElemStoredInfo(e);i.parentElem=e.parentNode,i.nextSibling=e.nextSibling}this.getTopmostLayer(e.ownerDocument,!0,r).appendChild(e)},restoreElem:function(e){if(e){var t=this._getElemStoredInfo(e);if(t){for(var r=t.styles,i=Kekule.ObjUtils.getOwnedFieldNames(r),n=e.style,o=0,a=i.length;o<a;++o){var s=i[o],l=r[s];l?n[s]=l:Kekule.StyleUtils.removeStyleProperty(n,s)}t.parentElem&&(t.nextSibling?t.parentElem.insertBefore(e,t.nextSibling):t.parentElem.appendChild(e)),e[this.INFO_FIELD]=null}}}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.GlobalManager),Kekule.Widget.globalManager=Kekule.Widget.GlobalManager.getInstance()}(),function(){"use strict";var e,t=function(){var e=["monospace","sans-serif","serif"],t=document.getElementsByTagName("body")[0],r=document.createElement("span");r.style.fontSize="72px",r.innerHTML="mmmmmmmmmmlli";var i={},n={};for(var o in e)r.style.fontFamily=e[o],t.appendChild(r),i[e[o]]=r.offsetWidth,n[e[o]]=r.offsetHeight,t.removeChild(r);this.detect=function(o){var a=!1;for(var s in e){r.style.fontFamily=o+","+e[s],t.appendChild(r);var l=r.offsetWidth!=i[e[s]]||r.offsetHeight!=n[e[s]];t.removeChild(r),a=a||l}return a}};Kekule.Widget.FontDetector={detect:function(r){var i=e;return i||(i=new t,e=i),i.detect(r)}};var r=["Arial, Helvetica, sans-serif","Georgia, Times New Roman, Times, serif","Courier New, Courier, monospace","Tahoma, Geneva, sans-serif","Trebuchet MS, Arial, Helvetica, sans-serif","Arial Black, Gadget, sans-serif","Palatino Linotype, Book Antiqua, Palatino, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","MS Serif, New York, serif","Lucida Console, Monaco, monospace","Comic Sans MS, cursive"];Kekule.Widget.FontEnumerator={getAvailableFontFamilies:function(e){e||(e=r);for(var t=[],i=0,n=e.length;i<n;++i){var o=e[i];Kekule.Widget.FontDetector.detect(o)&&t.push(o)}return t}}}(),function(){"use strict";var e=Kekule.ObjUtils;Kekule.globalOptions.add("widget.shortcut",{enabled:!0}),Kekule.Widget.KeyboardUtils={DEF_COMBINATION_KEY_DELIMITER:"+",_initShiftKeyMap:function(){for(var e=[["`","~"],["1","!"],["2","@"],["3","#"],["4","$"],["5","%"],["6","^"],["7","&"],["8","*"],["9","("],["0",")"],["-","_"],["=","+"],["[","{"],["]","}"],[";",":"],["'",'"'],["\\","|"],[",","<"],[".",">"],["/","?"]],t={},r=0,i=e.length;r<i;++r)t[e[r][0]]=e[r][1],t[e[r][1]]=e[r][0];return t},isPrintableKey:function(e){return!!e&&e.length<=1},getShiftedKey:function(e){if(e&&e.length<=1){var t=e.charAt(0);return t>="a"&&t<="z"?t.toUpperCase():t>="A"&&t<="Z"?t.toLowerCase():Kekule.Widget.KeyboardUtils._shiftKeyMap[t]||t}return e},shortcutLabelToKeyParams:function(e,t,r){for(var i,n,o=t?[t]:["+","-","_"],a=-1,s=0,l=o.length;s<l;++s){var u=o[s],d=e.split(u);d.length>a&&(i=u,a=d.length,n=d)}var c={};if(a<=0)c.key=i;else for(s=0,l=n.length;s<l;++s){var h=n[s];h||s!==l-1||(h=i);var p=h.toLowerCase();"shift"===p?c.shiftKey=!0:"alt"===p?c.altKey=!0:"ctrl"===p||"control"===p?c.ctrlKey=!0:"meta"===p?c.metaKey=!0:c.key="esc"===p?"Escape":"del"===p?"Delete":"ins"===p?"Insert":"pgup"===p?"PageUp":"pgdown"===p||"pgdn"===p?"PageDown":"space"===p?" ":h,c.key||s!==l-1||(c.key="ctrl"===p?"Control":h)}return!r&&c.key&&(c.key=c.key.charAt(0).toUpperCase()+c.key.substr(1)),c},keyParamsToShortcutLabel:function(e,t,r){t||(t=Kekule.Widget.KeyboardUtils.DEF_COMBINATION_KEY_DELIMITER);var i=[];e.ctrlKey&&i.push("Ctrl"),e.altKey&&i.push("Alt"),e.metaKey&&i.push("Meta"),e.shiftKey&&i.push("Shift");var n=e.key;if(n){"Escape"===n?n="Esc":"Insert"===n?n="Ins":"Delete"===n?n="Del":"Control"===n?n="Ctrl":" "===n&&(n="Space"),r||(n=n.charAt(0).toUpperCase()+n.substr(1));var o=i.indexOf(n);o>=0&&i.splice(o,1),i.push(n)}return i.join(t)},_standardizeEventKeyValue:function(e){return"Esc"===e?"Escape":"Del"===e?"Delete":"Spacebar"===e?" ":"Left"===e?"ArrowLeft":"Right"===e?"ArrowRight":"Up"===e?"ArrowUp":"Down"===e?"ArrowDown":"OS"===e?"Meta":"Scroll"===e?"ScrollLock":"Apps"===e?"ContextMenu":"Crsel"===e?"CrSel":"Exsel"===e?"ExSel":e},getKeyParamsFromEvent:function(e,t){var r={altKey:e.getAltKey(),ctrlKey:e.getCtrlKey(),shiftKey:e.getShiftKey(),metaKey:e.getMetaKey()};return t||(r=Object.extend(r,{key:Kekule.Widget.KeyboardUtils._standardizeEventKeyValue(e.getKey()),code:e.getCode(),repeat:e.getRepeat()})),r},createModifierKeyParamsFromArray:function(e){for(var t={},r=0,i=e.length;r<i;++r){var n=e[r].toLowerCase();n.indexOf("shift")>=0?t.shiftKey=!0:n.indexOf("ctrl")>=0?t.ctrlKey=!0:n.indexOf("meta")>=0?t.metaKey=!0:n.indexOf("alt")>=0&&(t.altKey=!0)}return t},matchKeyParams:function(e,t,r){var i,n,o,a=function(e,t){return null===t||!t==!e};return a(e.altKey,t.altKey)&&a(e.ctrlKey,t.ctrlKey)&&a(e.shiftKey,t.shiftKey)&&a(e.metaKey,t.metaKey)&&(!t.key||(i=e.key,n=t.key,o=Kekule.Widget.KeyboardUtils._standardizeEventKeyValue,r?o(n)===o(i):o(n)===o(i)||o(i)===Kekule.Widget.KeyboardUtils.getShiftedKey(n)))&&(!t.code||t.code===e.code)&&a(e.repeat,t.repeat)}},Kekule.Widget.KeyboardUtils._shiftKeyMap=Kekule.Widget.KeyboardUtils._initShiftKeyMap(),Kekule.Widget.HtmlKeyEventMatcher=Class.create(Kekule.Widget.HtmlEventMatcher,{CLASS_NAME:"Kekule.Widget.HtmlKeyEventMatcher",initialize:function(e){var t=Object.extend({strictMatch:!0},e);this.tryApplySuper("initialize",[t])},initProperties:function(){for(var e=Kekule.Widget.HtmlKeyEventMatcher.KEY_PARAM_PROPS,t=0,r=e.length;t<r;++t){var i="key"===e[t]||"code"===e[t]?DataType.STRING:DataType.BOOL;this._defineEventParamProp(e[t],i)}},match:function(e){var t=this.tryApplySuper("match",[e]);return t&&(t=this._matchKeyEvent(e,this.getEventParams())),t},_isKeyIgnored:function(e){return null===e},_matchKeyEvent:function(t,r){var i=this._isKeyIgnored;return(i(r.altKey)||!!t.getAltKey()==!!r.altKey)&&(i(r.ctrlKey)||!!t.getCtrlKey()==!!r.ctrlKey)&&(i(r.shiftKey)||!!t.getShiftKey()==!!r.shiftKey)&&(i(r.metaKey)||!!t.getMetaKey()==!!r.metaKey)&&(!r.key||this._matchKey(t,r.key))&&(!r.code||t.getCode()===r.code)&&(e.isUnset(r.repeat)||!!t.getRepeat()==!!r.repeat)},_matchKey:function(e,t){var r=Kekule.Widget.KeyboardUtils._standardizeEventKeyValue,i=e.getKey();return this.getStrictMatch()?r(i)===r(t):r(i)===r(t)||i===Kekule.Widget.KeyboardUtils.getShiftedKey(t)}}),Kekule.Widget.HtmlKeyEventMatcher.KEY_PARAM_PROPS=["key","code","shiftKey","ctrlKey","altKey","metaKey","repeat","strictMatch"],Kekule.Widget.Shortcut=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Shortcut",initialize:function(e,t){var r=new Kekule.Widget.HtmlEventResponser(new Kekule.Widget.HtmlKeyEventMatcher({eventType:this._getKeyEventType(),strictMatch:!1}),this);this.setPropStoreFieldValue("eventResponser",r),Kekule.ObjUtils.notUnset(t)?r.setExclusive(t):r.setExclusive(!0),e&&this.setPropStoreFieldValue("execTarget",e),this.tryApplySuper("initialize",[]),this._registeredDocs=[]},initProperties:function(){this.defineProp("strictMatch",{dataType:DataType.BOOL,getter:function(){return this.getEventResponser().getEventMatcher().getStrictMatch()},setter:function(e){this.getEventResponser().getEventMatcher().setStrictMatch(e)}}),this.defineProp("exclusive",{dataType:DataType.BOOL,getter:function(){return this.getEventResponser().getEventMatcher().getExclusive()},setter:function(e){this.getEventResponser().getEventMatcher().setExclusive(e)}}),this.defineProp("key",{dataType:DataType.STRING,getter:function(){var e=this.getEventResponser().getEventParams();return Kekule.Widget.KeyboardUtils.keyParamsToShortcutLabel(e,null,this.getStrictMatch())},setter:function(e){if(e!==this.getKey())for(var t=Kekule.Widget.KeyboardUtils.shortcutLabelToKeyParams(e,null,this.getStrictMatch()),r=this.getEventResponser().getEventParams(),i=Kekule.Widget.HtmlKeyEventMatcher.KEY_PARAM_PROPS,n=Kekule.ObjUtils.notUnset,o=0,a=i.length;o<a;++o){var s=i[o];n(t[s])&&(r[s]=t[s])}}}),this.defineProp("execTarget",{dataType:DataType.VARIANT,serializable:!1,setter:null}),this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",setter:null,serializable:!1,getter:function(){var e=this.getExecTarget();return e&&e instanceof Kekule.Widget.BaseWidget?e:null}}),this._defineEventResponserRelatedProp("eventParams",DataType.HASH),this.defineProp("eventResponser",{dataType:"Kekule.Widget.HtmlEventResponser",serializable:!1,setter:null})},doFinalize:function(){this.unregisterFromAll();var e=this.getEventResponser();this.setPropStoreFieldValue("eventResponser",null),e.finalize(),this.tryApplySuper("doFinalize")},_defineEventResponserRelatedProp:function(e,t,r){var i=e||r;return this.defineProp(e,{dataType:t,serializable:!1,getter:function(){return this.getEventResponser().getPropValue(i)},setter:function(e){this.getEventResponser().setPropValue(i,e)}})},_getKeyEventType:function(){return"keydown"},execute:function(e){if(Kekule.globalOptions.widget.shortcut.enabled){var t=this.getExecTarget();return t&&this.doExecTarget(e,t),this.invokeEvent({htmlEvent:e,execTarget:t}),!0}return!1},doExecTarget:function(e,t){var r=!0;return DataType.isFunctionValue(t)?t.apply(null,[e,this]):t.execute&&DataType.isFunctionValue(t.execute)?DataType.isObjectExValue(t)?t instanceof Kekule.Widget.BaseWidget?t.execute(e):t instanceof Kekule.Action?t.execute(this,e):t.execute(e,this):t.execute(e,this):r=!1,r},registerToGlobal:function(e){var t=e||Kekule.$document;t&&this._registeredDocs.indexOf(t)<0&&(Kekule.Widget.Utils.getGlobalManager(t).registerHtmlEventResponser(this.getEventResponser()),Kekule.ArrayUtils.pushUnique(this._registeredDocs,t))},unregisterFromGlobal:function(e){var t=e||Kekule.$document;t&&this._registeredDocs.indexOf(t)>=0&&(Kekule.Widget.Utils.getGlobalManager(t).unregisterHtmlEventResponser(this.getEventResponser()),Kekule.ArrayUtils.remove(this._registeredDocs,t))},unregisterFromAll:function(){for(var e=this._registeredDocs,t=0,r=e.length;t<r;++t)this.unregisterFromGlobal(e[t])}})}(),function(){"use strict";Kekule.Widget.Clipboard=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Clipboard",STORAGE_KEY:"__$kekule_widget_clipboard__",initialize:function(){if(this.tryApplySuper("initialize"),this._data=new Kekule.MapEx(!0),Kekule.BrowserFeature.localStorage){this._crossPageStorage=window.localStorage,this.setEnableCrossPageClipboard(!0);var e=this;Kekule.X.Event.addListener(window,"storage",function(t){if(e.getEnableCrossPageClipboard()){var r=t.key,i=e._extractSessionDataType(r);i&&e.invokeEvent("setData",{dataType:i,data:e.deserializeData(t.newValue)})}})}},finalize:function(){this._data.finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("enableCrossPageClipboard",{dataType:DataType.BOOL})},_useSessionClipboard:function(){return this.getEnableCrossPageClipboard()&&Kekule.BrowserFeature.localStorage},_extractSessionDataType:function(e){return e.startsWith(this.STORAGE_KEY)?e.substr(this.STORAGE_KEY.length):null},serializeData:function(e){var t;if(DataType.isSimpleValue(e))t=JSON.stringify(e);else{var r={};Class.ObjSerializerFactory.getSerializer("json").save(e,r),t=JSON.stringify(r)}return t},deserializeData:function(e){var t=JSON.parse(e);return DataType.isSimpleValue(t)?t:Class.ObjSerializerFactory.getSerializer("json").load(null,t)},setData:function(e,t){if(this._useSessionClipboard()){var r,i=this.serializeData(t);try{this._crossPageStorage.setItem(this.STORAGE_KEY+e,i),r=!0}catch(e){Kekule.warn(e)}r||this._data.set(e,t)}else this._data.set(e,t);return this.invokeEvent("setData",{dataType:e,data:t}),this},getData:function(e){if(this._useSessionClipboard()){var t,r;try{t=this._crossPageStorage.getItem(this.STORAGE_KEY+e),r=!0}catch(e){Kekule.warn(e)}if(r)return t?this.deserializeData(t):null}return this._data.get(e)},hasData:function(e){if(this._useSessionClipboard()){var t,r;try{t=this._crossPageStorage.getItem(this.STORAGE_KEY+e),r=!0}catch(e){Kekule.warn(e)}if(r)return Kekule.ObjUtils.notUnset(t)}return Kekule.ObjUtils.notUnset(this._data.get(e))},clearData:function(){if(this._useSessionClipboard())for(var e=this.getTypes(),t=0,r=e.length;t<r;++t)this._crossPageStorage.removeItem(this.STORAGE_KEY+e[t]);else this._data.clear();return this.invokeEvent("setData",{dataType:null,data:null}),this},getTypes:function(){if(this._useSessionClipboard()){for(var e=[],t=0,r=this._crossPageStorage.length;t<r;++t){var i=this._crossPageStorage.key(t),n=this._extractSessionDataType(i);n&&e.push(n)}return e}return this._data.getKeys()},setObjects:function(e,t){for(var r=[],i=Class.ObjSerializerFactory.getSerializer("json"),n=0,o=t.length;n<o;++n){var a=t[n],s={};i.save(a,s),r.push(s)}var l=JSON.stringify(r);return this.setData(e,l)},getObjects:function(e){var t=this.getData(e);if(DataType.isSimpleValue(t)){var r=JSON.parse(t);DataType.isArrayValue(r)||(r=[r]);for(var i=[],n=Class.ObjSerializerFactory.getSerializer("json"),o=0,a=r.length;o<a;++o){var s=r[o],l=n.load(null,s);i.push(l)}return i}return t}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.Clipboard),Kekule.Widget.clipboard=Kekule.Widget.Clipboard.getInstance()}(),function(){Kekule.Widget.EvokeMode={ALWAYS:0,EVOKEE_CLICK:1,EVOKEE_MOUSE_ENTER:2,EVOKEE_MOUSE_LEAVE:3,EVOKEE_MOUSE_DOWN:4,EVOKEE_MOUSE_UP:5,EVOKEE_MOUSE_MOVE:6,EVOKEE_TOUCH:7,EVOKER_CLICK:11,EVOKER_MOUSE_ENTER:12,EVOKER_MOUSE_LEAVE:13,EVOKER_MOUSE_DOWN:14,EVOKER_MOUSE_UP:15,EVOKER_MOUSE_MOVE:16,EVOKER_TOUCH:17,EVOKEE_TIMEOUT:21,EVOKER_TIMEOUT:22};var e=Kekule.Widget.EvokeMode;Kekule.Widget.DynamicEvokeHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DynamicEvokeHelper",evokeEvents:["click","mouseenter","mouseleave","mousedown","mouseup","touchstart"],DEF_TIMEOUT:5e3,initialize:function(e,t,r,i,n){this.tryApplySuper("initialize"),this._timeoutRevokeHandle=null,this.reactEvokeEventsBind=this.reactEvokeEvents.bind(this),this.checkTimeoutRevokeBind=this.checkTimeoutRevoke.bind(this),this.setTimeout(n||this.DEF_TIMEOUT),this.setPropStoreFieldValue("evokeModes",r||[]),this.setPropStoreFieldValue("revokeModes",i||[]),this.linkWidgets(e,t)},finalize:function(){this.unlinkWidgets(this.getEvokee(),this.getEvoker()),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("evokee",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("evoker",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("evokeModes",{dataType:DataType.ARRAY}),this.defineProp("revokeModes",{dataType:DataType.ARRAY}),this.defineProp("timeout",{dataType:DataType.INT}),this.defineProp("showHideType",{dataType:DataType.INT})},evoke:function(){this.getEvoker()&&(clearTimeout(this._timeoutRevokeHandle),this.getEvoker().show(this.getEvokee(),null,this.getShowHideType()),this.postponeTimeoutCheck())},revoke:function(){this.getEvoker()&&(clearTimeout(this._timeoutRevokeHandle),this.getEvoker().getDocument().body.focus(),this.getEvoker().hide(this.getEvokee(),null,this.getShowHideType()))},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),Kekule.ArrayUtils.intersect(e,["evokeModes","revokeModes"]).length>0&&this.evokeModesChanged()},linkWidgets:function(e,t){this.setPropStoreFieldValue("evokee",e),this.setPropStoreFieldValue("evoker",t),this.installEventHandlers(e,this.evokeEvents,this.reactEvokeEventsBind),this.installEventHandlers(t,this.evokeEvents,this.reactEvokeEventsBind),this.updateOnAlwaysMode()},unlinkWidgets:function(e,t){this.uninstallEventHandlers(e,this.evokeEvents,this.reactEvokeEventsBind),this.uninstallEventHandlers(t,this.evokeEvents,this.reactEvokeEventsBind)},installEventHandlers:function(e,t,r){for(var i=0,n=t.length;i<n;++i)e.addEventListener(t[i],r)},uninstallEventHandlers:function(e,t,r){for(var i=0,n=t.length;i<n;++i)e.removeEventListener(t[i],r)},evokeModesChanged:function(){this.updateOnAlwaysMode()},updateOnAlwaysMode:function(){this.getEvokeModes().indexOf(e.ALWAYS)>=0?this.evoke():this.getRevokeModes().indexOf(e.ALWAYS)>=0&&this.revoke()},checkTimeoutRevoke:function(t){if(this.getEvoker()){var r=Kekule.DomUtils,i=this.getEvoker().getDocument().activeElement,n=this.getRevokeModes(),o=[];n.indexOf(e.EVOKEE_TIMEOUT)>=0&&o.push(this.getEvokee().getElement()),n.indexOf(e.EVOKER_TIMEOUT)>=0&&o.push(this.getEvoker().getElement());for(var a=!1,s=0,l=o.length;s<l;++s){var u=o[s];if(i===u||r.isDescendantOf(i,u)){a=!0;break}}a?this.postponeTimeoutCheck():this.revoke()}},postponeTimeoutCheck:function(){if(this.hasTimeoutMode(this.getRevokeModes())){if(this.getEvokeModes().indexOf(e.ALWAYS)>=0)return;this._timeoutRevokeHandle=setTimeout(this.checkTimeoutRevokeBind,this.getTimeout())}},hasTimeoutMode:function(t){return Kekule.ArrayUtils.intersect([e.EVOKEE_TIMEOUT,e.EVOKER_TIMEOUT],t).length>0},getEventTypeOfMode:function(t){switch(t){case e.EVOKEE_CLICK:case e.EVOKER_CLICK:return"click";case e.EVOKEE_MOUSE_ENTER:case e.EVOKER_MOUSE_ENTER:return"mouseenter";case e.EVOKEE_MOUSE_LEAVE:case e.EVOKER_MOUSE_LEAVE:return"mouseleave";case e.EVOKEE_MOUSE_DOWN:case e.EVOKER_MOUSE_DOWN:return"mousedown";case e.EVOKEE_MOUSE_UP:case e.EVOKER_MOUSE_UP:return"mouseup";case e.EVOKEE_MOUSE_MOVE:case e.EVOKER_MOUSE_MOVE:return"mousemove";case e.EVOKEE_TOUCH:case e.EVOKER_TOUCH:return"touchstart"}},isEvokeTargetOnEvokee:function(t){return t>=e.EVOKEE_CLICK&&t<=e.EVOKEE_TOUCH},reactEvokeEvents:function(t){var r=t.htmlEvent.getType(),i=t.target;if(i===this.getEvokee()||i===this.getEvoker()){var n=t.target===this.getEvokee();if(!this.getEvoker().isShown()){if(this.getRevokeModes().indexOf(e.ALWAYS)>=0)return;for(var o=0,a=(s=this.getEvokeModes()).length;o<a;++o)if(n===this.isEvokeTargetOnEvokee(s[o])&&r===this.getEventTypeOfMode(s[o]))return void this.evoke()}else{if(this.getEvokeModes().indexOf(e.ALWAYS)>=0)return;var s;for(o=0,a=(s=this.getRevokeModes()).length;o<a;++o)if(n===this.isEvokeTargetOnEvokee(s[o])&&r===this.getEventTypeOfMode(s[o]))return void this.revoke()}}}})}(),function(){"use strict";var e=Kekule.HtmlElementUtils;Kekule.Widget.StyleResource=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.StyleResource",initialize:function(e,t){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("name",e),t&&this.setCssClassName(t)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,setter:null}),this.defineProp("cssClassName",{dataType:DataType.STRING})},linkTo:function(t){return e.addClass(this._getElement(t),this.getCssClassName()),this},unlinkFrom:function(t){e.removeClass(this._getElement(t),this.getCssClassName())},_getElement:function(e){return e instanceof Kekule.Widget.BaseWidget?e.getElement():e}}),Kekule.Widget.StyleResourceManager={_resources:{},register:function(e){var r=e.getName();return r&&(t._resources[r]=e),t},unregister:function(e){var r;return"string"==typeof e?r=e:e.getName&&(r=e.getName()),r&&delete t._resources[r],t},getResource:function(e){return t._resources[e]}},Kekule.Widget.StyleResourceNames={PREFIX:"$$",CURSOR_ROTATE:"$$cursor_rotate",CURSOR_ROTATE_NE:"$$cursor_rotate_ne",CURSOR_ROTATE_NW:"$$cursor_rotate_nw",CURSOR_ROTATE_SE:"$$cursor_rotate_se",CURSOR_ROTATE_SW:"$$cursor_rotate_sw",ICON_COLOR_PICK:"$$icon_color_pick",ICON_COLOR_NOTSET:"$$icon_color_default",ICON_COLOR_MIXED:"$$icon_color_mixed",BUTTON_YES_OK:"$$btn_yes_ok",BUTTON_NO_CANCEL:"$$btn_no_cancel",BUTTON_RESET:"$$btn_reset",BUTTON_LOAD_FILE:"$$btn_load_file",ICON_REMOVE:"$$icon_remove"};var t=Kekule.Widget.StyleResourceManager,r=Kekule.Widget.StyleResource,i=Kekule.Widget.StyleResourceNames;t.register(new r(i.CURSOR_ROTATE,"K-Res-Cursor-Rotate")),t.register(new r(i.CURSOR_ROTATE_NE,"K-Res-Cursor-Rotate-NE")),t.register(new r(i.CURSOR_ROTATE_NW,"K-Res-Cursor-Rotate-NW")),t.register(new r(i.CURSOR_ROTATE_SE,"K-Res-Cursor-Rotate-SE")),t.register(new r(i.CURSOR_ROTATE_SW,"K-Res-Cursor-Rotate-SW")),t.register(new r(i.ICON_COLOR_PICK,"K-Res-Icon-Color-Pick")),t.register(new r(i.ICON_COLOR_NOTSET,"K-Res-Icon-Color-NotSet")),t.register(new r(i.ICON_COLOR_MIXED,"K-Res-Icon-Color-Mixed")),t.register(new r(i.BUTTON_YES_OK,"K-Res-Button-YesOk")),t.register(new r(i.BUTTON_NO_CANCEL,"K-Res-Button-NoCancel")),t.register(new r(i.BUTTON_RESET,"K-Res-Button-Reset")),t.register(new r(i.BUTTON_LOAD_FILE,"K-Res-Button-LoadFile")),t.register(new r(i.ICON_REMOVE,"K-Res-Icon-Remove"))}(),function(){var e=Kekule.DomUtils;Kekule.ArrayUtils;Kekule.Widget.AutoLauncher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.AutoLauncher",WIDGET_ATTRIB:"data-widget",WIDGET_ATTRIB_ALT:"data-kekule-widget",PLACEHOLDER_ATTRIB:"data-placeholder",FIELD_PARENT_WIDGET_ELEM:"__$kekule_parent_widget_elem$__",initialize:function(){this.tryApplySuper("initialize"),this._executingFlag=0,this._pendingWidgetRefMap=new Kekule.MapEx(!0),this._pendingElems=[],this._handlingPendings=!1,this._execOnPendingBind=this._execOnPending.bind(this);var e=this;Kekule.Widget.Utils._setWidgetRefPropFromId=function(t,r,i){if(i){var n=Kekule.Widget.getWidgetById(i,t.getDocument());if(n)t.setPropValue(r,n);else{var o=t.getDocument().getElementById(i);o&&e.isExecuting()&&e.addPendingWidgetRefItem(o,t,r)}}}},finalize:function(){this._pendingElems=null,this._pendingWidgetRefMap=null,this.tryApplySuper("finalize")},getPendingElems:function(){return this._pendingElems},addPendingElem:function(e,t,r,i,n){this._pendingElems.push({doc:e,elem:t,parent:r,widgetClass:i,execOnChildren:n})},handlePendingElems:function(e){if(!this._handlingPendings){if(this._handlingPendings=!0,e)this._pendingElems.push({callback:e});this.beginExec(),setTimeout(this._execOnPendingBind,0)}},_execOnPending:function(){var e=this._pendingElems.shift();if(e)try{e.elem?this.createWidgetOnElem(e.doc,e.elem,e.parent):e.callback&&setTimeout(e.callback,0)}finally{setTimeout(this._execOnPendingBind,0)}else this._handlingPendings=!1,this.endExec()},getPendingWidgetRefMap:function(){return this._pendingWidgetRefMap},addPendingWidgetRefItem:function(e,t,r){this._pendingWidgetRefMap.set(e,{widget:t,propName:r})},removePendingWidgetRefItem:function(e){this._pendingWidgetRefMap.remove(e)},handlePendingWidgetRef:function(){for(var e=this._pendingWidgetRefMap.getKeys(),t=0,r=e.length;t<r;++t){var i=e[t],n=Kekule.Widget.getWidgetOnElem(i);if(n){var o=this._pendingWidgetRefMap.get(i);o.widget.setPropValue(o.propName,n)}this.removePendingWidgetRefItem(i)}},beginExec:function(){++this._executingFlag},endExec:function(){this._executingFlag>0&&--this._executingFlag,this._executingFlag<=0&&this.handlePendingWidgetRef()},isExecuting:function(){return this._executingFlag>0},execute:function(e,t,r){var i=Kekule.ObjUtils.notUnset(t)?t:Kekule.Widget.AutoLauncher.deferring;i||this.beginExec();try{"function"==typeof e.querySelector?this.executeOnElemBySelector(e.ownerDocument,e,null,i):this.executeOnElem(e.ownerDocument,e,null,i),i&&this.handlePendingElems(r)}finally{i||(this.endExec(),r&&r())}},executeOnElem:function(t,r,i,n){if(this.isElemLaunchable(r)){var o=null,a=this.getElemWidgetClass(r),s=i;if(n)a&&(this.addPendingElem(t,r,i,a,!1),s=r);else{var l=i;!l||l instanceof Kekule.Widget.BaseWidget||(l=Kekule.Widget.getWidgetOnElem(i)),s=(o=this.createWidgetOnElem(t,r,l,a))||r}if(n&&!a||!n&&!o||Kekule.Widget.AutoLauncher.enableCascadeLaunch)for(var u=e.getDirectChildElems(r),d=0,c=u.length;d<c;++d){var h=u[d];this.executeOnElem(t,h,s,n)}}},executeOnElemBySelector:function(e,t,r,i){var n="["+this.WIDGET_ATTRIB+"],["+this.WIDGET_ATTRIB_ALT+"]",o=t.querySelectorAll(n);if(this.getElemWidgetClass(t)&&(o=Array.prototype.slice.call(o)).unshift(t),o&&o.length){for(var a=0,s=o.length;a<s;++a){var l=o[a],u=this._findParentCandidateElem(l,o,0,a-1);u&&(l[this.FIELD_PARENT_WIDGET_ELEM]=u)}for(a=0,s=o.length;a<s;++a){l=o[a];if(this.isElemLaunchable(l)){var d=l[this.FIELD_PARENT_WIDGET_ELEM]||null;!Kekule.Widget.AutoLauncher.enableCascadeLaunch&&d||(i?this.addPendingElem(e,l,d,null,!1):this.createWidgetOnElem(e,l,d))}}}},_findParentCandidateElem:function(e,t,r,i){for(var n=null,o=e.parentNode;o&&!n;){for(var a=i;a>=r;--a)if(o===t[a])return n=t[a];n||(o=o.parentNode)}return n},createWidgetOnElem:function(e,t,r,i){var n=null,o=Kekule.Widget.getWidgetOnElem(t);if(o)return o;if(i||(i=this.getElemWidgetClass(t)),i){var a=Kekule.Widget.AutoLauncher,s=!1;if(a.placeHolderStrategy!==a.PlaceHolderStrategies.DISABLED){var l=t.getAttribute(this.PLACEHOLDER_ATTRIB)||"";s=(s=a.placeHolderStrategy===a.PlaceHolderStrategies.EXPLICIT&&Kekule.StrUtils.strToBool(l)||a.placeHolderStrategy===a.PlaceHolderStrategies.IMPLICIT)&&ClassEx.getPrototype(i).canUsePlaceHolderOnElem(t)}if(n=s?new Kekule.Widget.PlaceHolder(t,i):new i(t)){var u=r;!u||u instanceof Kekule.Widget.BaseWidget||(u=Kekule.Widget.getWidgetOnElem(r)),u&&n.setParent(u)}}return n},isElemLaunchable:function(e){return!(e.isContentEditable&&!Kekule.HtmlElementUtils.isFormCtrlElement(e)&&!Kekule.Widget.AutoLauncher.enableOnEditable)},getElemWidgetClass:function(e){var t=null,r=e.getAttribute(this.WIDGET_ATTRIB);return r||(r=e.getAttribute(this.WIDGET_ATTRIB_ALT)),r&&(t=this.getWidgetClass(r)),t},getWidgetClass:function(e){return ClassEx.findClass(e)}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.AutoLauncher),Kekule.Widget.autoLauncher=Kekule.Widget.AutoLauncher.getInstance(),Kekule.Widget.AutoLauncher.PlaceHolderStrategies={DISABLED:"disabled",IMPLICIT:"implicit",EXPLICIT:"explicit"},Kekule.Widget.AutoLauncher.enabled=Kekule.oneOf(Kekule.environment.getEnvVar("kekule.widget.autoLauncher.enabled"),!0),Kekule.Widget.AutoLauncher.enableCascadeLaunch=!0,Kekule.Widget.AutoLauncher.enableDynamicDomCheck=!0,Kekule.Widget.AutoLauncher.enableOnEditable=!1,Kekule.Widget.AutoLauncher.placeHolderStrategy=Kekule.Widget.AutoLauncher.PlaceHolderStrategies.EXPLICIT,Kekule.Widget.AutoLauncher.deferring=!1,Kekule.Widget.WidgetsReady={isReady:!1,funcs:[],ready:function(e){t.isReady?e():t.funcs.push(e)},fireReady:function(){if(!t.isReady){t.isReady=!0;for(var e=t.funcs;e.length;){e.shift()()}}}};var t=Kekule.Widget.WidgetsReady;Kekule.Widget.ready=t.ready;var r=function(){if(!r.done)if(Kekule._isLoaded()){var e=Kekule.Widget.AutoLauncher.deferring?function(){Kekule.X.DomReady.resume()}:null,i=function(){try{t.fireReady()}finally{e&&e()}};if(Kekule.Widget.AutoLauncher.enabled?(Kekule.Widget.AutoLauncher.deferring&&Kekule.X.DomReady.suspend(),Kekule.Widget.autoLauncher.execute(document.body,null,i)):i(),Kekule.X.MutationObserver)new Kekule.X.MutationObserver(function(e){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck&&Kekule.Widget.AutoLauncher.enabled)for(var t=0,r=e.length;t<r;++t){var i=e[t];if("childList"===i.type)for(var n=i.addedNodes,o=0,a=n.length;o<a;++o){var s=n[o];s.nodeType===Node.ELEMENT_NODE&&Kekule.Widget.autoLauncher.execute(s)}}}).observe(document.body,{childList:!0,subtree:!0});else Kekule.X.Event.addListener(document,"DOMNodeInserted",function(e){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck&&Kekule.Widget.AutoLauncher.enabled){var t=e.getTarget();t.nodeType===(Node.ELEMENT_NODE||1)&&Kekule.Widget.autoLauncher.execute(t)}});r.done=!0}else Kekule._ready(r)};Kekule.X.domReady(r)}(),function(){var e=Kekule.Widget.Direction,t=Kekule.StyleUtils,r=Kekule.ArrayUtils;Kekule.Widget.BaseTransition=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseTransition",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("element",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("caller",{dataType:DataType.OBJECT,serializable:!1})},canExecute:function(e,t){return!0},prepare:function(e,t,r){},finish:function(e,t,r){},execute:function(e,t,r,i){this.setElement(e),t&&this.setCaller(t);var n=Object.extend({from:0,to:1},i),o=this,a=function(){a.__$applied__||(a.__$applied__=!0,o.finish(e,t,n),r&&r(),o.invokeEvent("finish"))};a.__$applied__=!1,this.prepare(e,t,n),this.invokeEvent("execute");o=this;var s={element:e,caller:t,callback:r,doneCallback:a,options:i,executor:this,halt:function(){o.halt(s)}};return this.doExecute(e,t,a,n),s},doExecute:function(e,t,r,i){},halt:function(e){e.executor!==this?e.executor.halt(e):(this.doHalt(e),e.doneCallback&&e.doneCallback(),this.invokeEvent("halt"))},doHalt:function(e){},setElementProp:function(e,t,r){},storeCssInlineValues:function(e,t){for(var r=e.style,i={},n=0,o=t.length;n<o;++n){var a=t[n];i[a]=r[a]}return i},restoreCssInlineValues:function(e,t,r){for(var i=e.style,n=0,o=t.length;n<o;++n){var a=t[n];if(r[a])i[a]=r[a];else try{i.removeProperty(a)}catch(e){i[a]=""}}},storeCssComputedValues:function(e,r){for(var i={},n=0,o=r.length;n<o;++n){var a=r[n],s=t.getComputedStyle(e,a);i[a]=s}return i}}),Kekule.Widget.Css3TransitionRunner=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Css3TransitionRunner",initProperties:function(){this.defineProp("parent",{dataType:"Kekule.Widget.BaseTransition"})},getCaller:function(){var e=this.getParent();return e&&e.getCaller()},getElement:function(){var e=this.getParent();return e&&e.getElement()},getAffectedCssPropNames:function(e){return[]},getTransCssPropNames:function(e){return[]},prepare:function(e,t,r){},setElementProp:function(e,t,r){}}),Kekule.Widget.Css3OpacityTransRunner=Class.create(Kekule.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3OpacityTransRunner",getAffectedCssPropNames:function(e){return["opacity"]},getTransCssPropNames:function(e){return["opacity"]},prepare:function(e,t,r){},setElementProp:function(e,t,r){var i=this.getParent();if(i){var n=parseFloat(i.getComputedCssValues().opacity)||1;e.style.opacity=n*t}}}),Kekule.Widget.Css3SlideTransRunner=Class.create(Kekule.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3SlideTransRunner",initialize:function(e){this.tryApplySuper("initialize"),Kekule.ObjUtils.notUnset(e)&&this.setDirection(e)},initProperties:function(){this.defineProp("direction",{dataType:DataType.INT})},prepare:function(e,r,i){t.setDisplay(e,!0),this._direction=this.getActualDirection(e,i),this.tryApplySuper("prepare",[e,r,i]),e.style.overflow="hidden",this._clearDimesionConstraints(e)},_clearDimesionConstraints:function(e){var t=e.style;t.minWidth="0",t.minHeight="0",t.maxWidth="none",t.maxHeight="none"},getComputedCssValues:function(){return this.getParent().getComputedCssValues()},setElementProp:function(r,i,n){var o,a=this._direction;if(e.isInHorizontal(a)){o=this.getComputedCssValues().width;var s=t.analysisUnitsValue(o);if(r.style.width=s.value*i+s.units,o=this.getComputedCssValues().left){var l=t.analysisUnitsValue(o);l.units===s.units&&(r.style.left=s.value*(1-i)+l.value+l.units)}}if(e.isInVertical(a)){o=this.getComputedCssValues().height;var u=t.analysisUnitsValue(o);if(r.style.height=u.value*i+u.units,o=this.getComputedCssValues().top){var d=t.analysisUnitsValue(o);d.units===u.units&&(r.style.top=u.value*(1-i)+d.value+d.units)}}},getAffectedCssPropNames:function(e){var t=[].concat(this.getTransCssPropNames(e));return t=t.concat(["overflow","min-width","min-height","max-width","max-height"])},getTransCssPropNames:function(t){var r=this.getActualDirection(this.getElement(),t),i=[];return e.isInHorizontal(r)&&(i.push("width"),r&e.RTL&&i.push("left")),e.isInVertical(r)&&(i.push("height"),r&e.BTT&&i.push("top")),i},getRefRect:function(e){return Kekule.Widget.TransitionUtils.getCallerRefRect(this.getCaller(),e)},getActualDirection:function(t,r){t||(t=this.getElement());var i=this.getDirection();return i&&i!==e.AUTO||(i=Kekule.Widget.TransitionUtils.getPreferredSlideDirection(t,this.getCaller(),r)),i}}),Kekule.Widget.Css3ClipPathSlideTransRunner=Class.create(Kekule.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3ClipPathSlideTransRunner",initialize:function(e){this.tryApplySuper("initialize"),Kekule.ObjUtils.notUnset(e)&&this.setDirection(e)},initProperties:function(){this.defineProp("direction",{dataType:DataType.INT})},prepare:function(e,t,r){this._direction=this.getActualDirection(e,r),this.tryApplySuper("prepare",[e,t,r])},setElementProp:function(t,r,i){var n=this._direction,o=100*(1-r)+"%",a=["0%","0%","0%","0%"];a[n===e.TTB?2:n===e.BTT?0:n===e.RTL?3:1]=o;var s="inset("+a.join(" ")+")";t.style.clipPath=s},getAffectedCssPropNames:function(e){return(this.tryApplySuper("getAffectedCssPropNames",[e])||[]).concat(["clip-path"])},getTransCssPropNames:function(e){return(this.tryApplySuper("getTransCssPropNames",[e])||[]).concat(["clip-path"])},getActualDirection:function(t,r){t||(t=this.getElement());var i=this.getDirection();return i&&i!==e.AUTO||(i=Kekule.Widget.TransitionUtils.getPreferredSlideDirection(t,this.getCaller(),r)),i}}),Kekule.Widget.Css3GrowTransRunner=Class.create(Kekule.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3GrowTransRunner",initialize:function(e){this.tryApplySuper("initialize"),e&&(e.ownerDocument?this.setBaseElement(e):this.setCaller(e))},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(e){var t=Kekule.HtmlElementUtils,r=null;return this.getBaseRect()?r=this.getBaseRect():this.getCaller()&&(r=t.getElemBoundingClientRect(this.getCaller(),!0),Kekule.RectUtils.isZero(r)&&(r=(e||{}).callerPageRect||null)),r||(r={x:0,y:0,width:0,height:0}),r},prepare:function(e,r,i){t.setDisplay(e,!0),this.tryApplySuper("prepare",[e,r,i]),e.style.overflow="hidden",Kekule.HtmlElementUtils.makePositioned(e);var n=this.getRefRect(i),o=Kekule.HtmlElementUtils.getElemBoundingClientRect(e,!0),a={x:o.x-n.x,y:o.y-n.y,width:o.width-n.width,height:o.height-n.height};this._delta=a,this._clearDimesionConstraints(e)},_clearDimesionConstraints:function(e){var t=e.style;t.minWidth="0",t.minHeight="0",t.maxWidth="none",t.maxHeight="none"},setElementProp:function(e,r,i){var n,o=this.getParent().getComputedCssValues(),a=this._delta,s=1-r,l=e.style;"px"===(n=t.analysisUnitsValue(o.left)).units&&(l.left=n.value-s*a.x+"px"),"px"===(n=t.analysisUnitsValue(o.top)).units&&(l.top=n.value-s*a.y+"px"),"px"===(n=t.analysisUnitsValue(o.width)).units&&(l.width=n.value-s*a.width+"px"),"px"===(n=t.analysisUnitsValue(o.height)).units&&(l.height=n.value-s*a.height+"px")},getAffectedCssPropNames:function(e){var t=[].concat(this.getTransCssPropNames(e));return t=t.concat(["overflow","min-width","min-height","max-width","max-height"])},getTransCssPropNames:function(e){return["left","top","width","height","position"]}}),Kekule.BrowserFeature&&Kekule.BrowserFeature.cssTranform&&(Kekule.Widget.Css3TransformTransRunner=Class.create(Kekule.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3TransformTransRunner",getAffectedCssPropNames:function(e){return["transform","transformOrigin"]},getTransCssPropNames:function(e){return["transform","transformOrigin"]},prepare:function(e,t,r){this.tryApplySuper("prepare",[e,t,r]);var i=Kekule.StyleUtils.getTransformMatrixValues(e);i&&(i.scaleX=i.a,i.scaleY=i.d),this._computedTransMatrixInfo=i},setElemTransform:function(e,t,r,i,n){var o=[i,0,0,n,t,r];Kekule.StyleUtils.setTransformMatrixArrayValues(e,o)}}),Kekule.Widget.Css3TransformGrowTransRunner=Class.create(Kekule.Widget.Css3TransformTransRunner,{CLASS_NAME:"Kekule.Widget.Css3TransformGrowTransRunner",initialize:function(e){this.tryApplySuper("initialize"),e&&(e.ownerDocument?this.setBaseElement(e):this.setCaller(e))},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(e){var t=Kekule.HtmlElementUtils,r=null;return this.getBaseRect()?r=this.getBaseRect():this.getCaller()&&(r=t.getElemBoundingClientRect(this.getCaller(),!0),Kekule.RectUtils.isZero(r)&&(r=(e||{}).callerPageRect||null)),r||(r={x:0,y:0,width:0,height:0}),r},prepare:function(e,r,i){t.setDisplay(e,!0),this.tryApplySuper("prepare",[e,r,i]),e.style.overflow="hidden",Kekule.HtmlElementUtils.makePositioned(e);var n=this.getRefRect(i),o=Kekule.HtmlElementUtils.getElemBoundingClientRect(e,!0),a={x:o.x-n.x,y:o.y-n.y};this._translateDelta=a,this._initialScale={x:n.width/o.width,y:n.height/o.height},this._computedTransMatrixInfo?(this._endScale={x:this._computedTransMatrixInfo.scaleX,y:this._computedTransMatrixInfo.scaleY},this._endTranslate={x:this._computedTransMatrixInfo.tx,y:this._computedTransMatrixInfo.ty}):(this._endScale={x:1,y:1},this._endTranslate={x:0,y:0})},setElementProp:function(e,t,r){this.getParent().getComputedCssValues();var i=this._translateDelta,n=this._initialScale,o=this._endScale,a={x:this._endTranslate.x-(1-t)*i.x,y:this._endTranslate.y-(1-t)*i.y},s={x:t*o.x+(1-t)*n.x,y:t*o.y+(1-t)*n.y};e.style.transformOrigin="0 0 0",this.setElemTransform(e,a.x,a.y,s.x,s.y)}})),Kekule.Widget.Css3Transition=Class.create(Kekule.Widget.BaseTransition,{CLASS_NAME:"Kekule.Widget.Css3Transition",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("timingFunc",{dataType:DataType.STRING}),this.defineProp("childRunners",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("cssProperty",{dataType:DataType.STRING})},getRunners:function(){var e=this.getChildRunners();return e?r.toArray(e):[]},iterateRunners:function(e){for(var t=this.getRunners(),r=0,i=t.length;r<i;++r)e(t[r],r,t)},getAffectedCssPropNames:function(e){var t=[];return this.iterateRunners(function(e){var r=e.getAffectedCssPropNames()||[];t=t.concat(r)}),t},getTransCssPropNames:function(e){var t=[];return this.iterateRunners(function(e){var r=e.getTransCssPropNames()||[];t=t.concat(r)}),t},setElementProp:function(e,t,r){this.iterateRunners(function(i){i.setElementProp(e,t,r)})},canExecute:function(e,t){return!!Kekule.BrowserFeature.cssTransition},isSupported:function(){return!!Kekule.BrowserFeature.cssTransition},isAppear:function(e){return!!e.isAppear},isDisappear:function(e){return!!e.isDisappear},getTransitionPropValue:function(e,t){for(var r=[t,"Webkit"+t.capitalizeFirst(),"Moz"+t.capitalizeFirst()],i=null,n=0,o=r.length;n<o&&!(i=Kekule.StyleUtils.getComputedStyle(e,r[n]));++n);return i},setTransitionPropValue:function(e,t,r){for(var i=["Moz"+t.capitalizeFirst(),"Webkit"+t.capitalizeFirst(),t],n=0,o=i.length;n<o;++n)e[i[n]]=r},getOriginCssInlineValues:function(){return this._originCssInlineValues},getComputedCssValues:function(){return this._computedCssValues},prepare:function(e,t,r){this.tryApplySuper("prepare",[e,t,r]),this.setCssProperty(this.getTransCssPropNames(r).join(","));var i=this.getAffectedCssPropNames(r);this._affectedCssPropNames=i,this._originCssInlineValues=this.storeCssInlineValues(e,i),this._computedCssValues=this.storeCssComputedValues(e,i);var n=this;this.iterateRunners(function(i){i.setParent(n),i.prepare(e,t,r)})},finish:function(e,t,r){(1===r.to||this.isAppear(r)||this.isDisappear(r))&&this.restoreCssInlineValues(e,this._affectedCssPropNames,this._originCssInlineValues),this.tryApplySuper("finish",[e,t,r])},doExecute:function(e,t,r,i){var n=Kekule.StyleUtils,o=e.style;this.isAppear(i),this.isDisappear(i);if(this.isSupported()){this.setElementProp(e,i.from,i),n.isDisplayed(e)||n.setDisplay(e,!0),n.isVisible(e)||n.setVisibility(e,!0);var a,s=this.getCssProperty();this.setTransitionPropValue(o,"transitionProperty",s),(s=this.getTimingFunc()||i.timingFunc)&&this.setTransitionPropValue(o,"transitionTimingFunction",s),s=i.duration.toString()+"ms",this.setTransitionPropValue(o,"transitionDuration",s);var l=this,u=function(t){Kekule.X.Event.removeListener(e,"transitionend",u),l.setTransitionPropValue(o,"transition",""),a&&clearTimeout(a),r&&r()};this._currEventHandler=u,Kekule.X.Event.addListener(e,"transitionend",u),a=setTimeout(u,i.duration+100),setTimeout(function(){l.setElementProp(e,i.to,i)},0)}else{try{this.setElementProp(e,i.to,i)}catch(e){}r&&setTimeout(r,0)}},doHalt:function(e){var t=e.element;t&&this.setTransitionPropValue(t.style,"transitionProperty","none")}}),Kekule.Widget.Css3Transition.createConcreteClass=function(e,t){return Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:e,CHILD_RUNNER_CLASSES:r.toArray(t),initialize:function(){this.tryApplySuper("initialize");for(var e=[],t=0,r=this.CHILD_RUNNER_CLASSES.length;t<r;++t)e.push(new this.CHILD_RUNNER_CLASSES[t]);this.setChildRunners(e)}})},Kekule.Widget.Css3OpacityTrans=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3OpacityTrans",[Kekule.Widget.Css3OpacityTransRunner]),Kekule.Widget.Css3ClipPathSlideTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3ClipPathSlideTransition",[Kekule.Widget.Css3ClipPathSlideTransRunner]),Kekule.Widget.Css3SlideTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3SlideTransition",[Kekule.Widget.Css3SlideTransRunner]),Kekule.Widget.Css3GrowTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3GrowTransition",[Kekule.Widget.Css3GrowTransRunner]),Kekule.Widget.Css3ClipPathSlideOpacityTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3ClipPathSlideOpacityTransition",[Kekule.Widget.Css3ClipPathSlideTransRunner,Kekule.Widget.Css3OpacityTransRunner]),Kekule.Widget.Css3GrowOpacityTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3GrowOpacityTransition",[Kekule.Widget.Css3GrowTransRunner,Kekule.Widget.Css3OpacityTransRunner]),Kekule.Widget.Css3TransformGrowTransRunner&&(Kekule.Widget.Css3TransformGrowTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3TransformGrowTransition",[Kekule.Widget.Css3TransformGrowTransRunner]),Kekule.Widget.Css3TransformGrowOpacityTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3TransformGrowOpacityTransition",[Kekule.Widget.Css3TransformGrowTransRunner,Kekule.Widget.Css3OpacityTransRunner])),Kekule.Widget.TransitionUtils={getCallerRefRect:function(e,t){var r,i=Kekule.HtmlElementUtils;return e?(r=i.getElemPageRect(e),Kekule.RectUtils.isZero(r)&&(r=(t||{}).callerPageRect||null)):r=null,r},getPreferredSlideDirection:function(e,t,r){var i=Kekule.Widget.Direction,n=Kekule.HtmlElementUtils,o=null,a=Kekule.Widget.TransitionUtils.getCallerRefRect(t,r);if(a){var s={x:a.x+a.width/2,y:a.y+a.height/2},l=n.getElemPagePos(e),u=n.getElemClientDimension(e),d={x:l.x+(u.width||0)/2,y:l.y+(u.height||0)/2},c=Kekule.CoordUtils.substract(d,s);if(a.width<1)o=c.x>=0?i.LTR:i.RTL;else if(c.x<1)o=c.y>=0?i.TTB:i.BTT;else{o=Math.abs(a.height/a.width)>Math.abs(c.y/c.x)?c.x>=0?i.LTR:i.RTL:c.y>=0?i.TTB:i.BTT}}else o=i.TTB;return o}}}(),function(){Kekule.StyleUtils;Kekule.Widget.ShowHideManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideManager",initialize:function(){this.tryApplySuper("initialize"),this.setEnableTransition(!0),this.setShowDuration(250),this.setHideDuration(250)},initProperties:function(){this.defineProp("enableTransition",{dataType:DataType.BOOL}),this.defineProp("transitionSelector",{dataType:"Kekule.Widget.ShowHideTransitionSelector",serializable:!1}),this.defineProp("showDuration",{dataType:DataType.INT}),this.defineProp("hideDuration",{dataType:DataType.INT})},_getCallerElement:function(e){return e?e.getElement?e.getElement():Kekule.DomUtils.isElement(e)?e:null:null},isUsingTransition:function(){return this.getEnableTransition()&&this.getTransitionSelector()},selectTransition:function(e,t,r){var i=this.getTransitionSelector();if(!i)return null;var n=i.selectTransition(e,t,r);return n&&t&&n.setCaller(this._getCallerElement(t)),n},show:function(e,t,r,i,n){var o=Object.extend(n||{},{from:0,to:1,isAppear:!0,duration:this.getShowDuration()}),a=e.getStandaloneOnShowHide()?null:t,s=this.selectTransition(e,a,i);if(s&&this.isUsingTransition()&&s.canExecute(e.getElement(),o)){var l=this._getCallerElement(a);return s.execute(e.getElement(),l,function(t){e.setVisible(!0,!0),e.setDisplayed(!0,!0),r&&r()},o)}return e.setVisible(!0,!0),e.setDisplayed(!0,!0),r&&r(),null},hide:function(e,t,r,i,n,o){var a=Object.extend(o,{from:1,to:0,isDisappear:!0,duration:this.getHideDuration()}),s=(n=!!o.useVisible,e.getStandaloneOnShowHide()?null:t),l=this.selectTransition(e,s,i);if(l&&this.isUsingTransition()&&l.canExecute(e.getElement(),a)){return l.execute(e.getElement(),this._getCallerElement(s),function(){e&&(n?e.setVisible(!1,!0):e.setDisplayed(!1,!0)),r&&r()},a)}return n?e.setVisible(!1,!0):e.setDisplayed(!1,!0),r&&r(),null}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.ShowHideManager),Kekule.Widget.showHideManager=Kekule.Widget.ShowHideManager.getInstance(),Kekule.Widget.ShowHideTransitionSelector=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideTransitionSelector",initialize:function(){this.tryApplySuper("initialize"),this.setTransitionClassMap({})},initProperties:function(){this.defineProp("transitionClassMap",{dataType:DataType.OBJECT,serializable:!1})},_getTransClassOfType:function(e){var t=this.getTransitionClassMap();return t[e]||t[Kekule.Widget.ShowHideType.DEFAULT]},addTransitionClass:function(e,t){this.getTransitionClassMap()[e]=t},selectTransition:function(e,t,r){var i;Kekule.Widget.ShowHideType;return(i=t?this._getTransClassOfType(r):this._getTransClassOfType(Kekule.Widget.ShowHideType.DEFAULT))?new i:null}});var e=new Kekule.Widget.ShowHideTransitionSelector,t=Kekule.Widget.ShowHideType;e.addTransitionClass(t.DEFAULT,Kekule.Widget.Css3OpacityTrans),e.addTransitionClass(t.DROPDOWN,Kekule.Widget.Css3ClipPathSlideOpacityTransition),e.addTransitionClass(t.POPUP,Kekule.Widget.Css3TransformGrowOpacityTransition||Kekule.Widget.Css3GrowOpacityTransition),e.addTransitionClass(t.DIALOG,Kekule.Widget.Css3TransformGrowOpacityTransition||Kekule.Widget.Css3GrowOpacityTransition),Kekule.Widget.showHideManager.setTransitionSelector(e)}(),function(){"use strict";Kekule.HtmlElementUtils;var e=Kekule.X.Event,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{RESIZEGRIPPER:"K-Resize-Gripper"});var r=Class.PropertyScope;Kekule.Widget.ResizeGripper=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ResizeGripper",BINDABLE_TAG_NAMES:["div","span"],initialize:function(e){if(this.reactMousemoveBind=this.reactMousemove.bind(this),this.reactMouseupBind=this.reactMouseup.bind(this),this.reactTouchmoveBind=this.reactTouchmove.bind(this),this.reactTouchendBind=this.reactTouchend.bind(this),this.tryApplySuper("initialize",[e]),!this.getTarget())if(this.getParent())this.setTarget(this.getParent());else{var t=this.getElement().parentNode;t&&this.setTarget(t)}},initProperties:function(){this.defineProp("target",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getTarget()!==e&&(this.setPropStoreFieldValue("target",e),this.targetChanged(e))}}),this.defineProp("retainAspectRatio",{dataType:DataType.BOOL}),this.defineProp("isUnderResizing",{dataType:DataType.BOOL,serializable:!1,setter:null,scope:r.PRIVATE}),this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:!1,scope:r.PRIVATE}),this.defineProp("baseDimension",{dataType:DataType.HASH,serializable:!1,scope:r.PRIVATE}),this.defineProp("baseAspectRatio",{dataType:DataType.FLOAT,serializable:!1,scope:r.PRIVATE})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.RESIZEGRIPPER},doGetDefaultTabIndex:function(){return null},doCreateRootElement:function(e){return e.createElement("span")},targetChanged:function(e){var t;(t=this.targetIsWidget(e)?e.getResizerElement?e.getResizerElement():e.getChildrenHolderElement():e)&&this.appendToElem(t)},targetIsWidget:function(e){return e instanceof Kekule.Widget.BaseWidget},getTargetDimension:function(e){var t=e||this.getTarget();return this.targetIsWidget(t)?t.getDimension():Kekule.HtmlElementUtils.getElemPageRect(t,!0)},setTargetDimension:function(e,t,r){var i=e||this.getTarget();if(this.targetIsWidget(i))i.setDimension(t,r);else{var n=i.style;n.width=t+"px",n.height=r+"px"}},prepareResizing:function(e,t){if(!this.getIsUnderResizing()){var r=this._getMoveEventReceiverElem(this.getElement());this._installEventHandlers(r),this._setMouseCapture(this.getElement(),!0,t),this.setBaseCoord(e);var i=this.getTargetDimension();this.setBaseDimension(i),this.setBaseAspectRatio(i.width/i.height),this.setPropStoreFieldValue("isUnderResizing",!0)}},doneResizing:function(e){this._setMouseCapture(this.getElement(),!1,e);var t=this._getMoveEventReceiverElem(this.getElement());this._uninstallEventHandlers(t),this.setBaseCoord(null),this.setBaseDimension(null),this.setPropStoreFieldValue("isUnderResizing",!1)},resizeTo:function(e){var t=Kekule.CoordUtils.substract(e,this.getBaseCoord()),r=this.getBaseDimension(),i=r.width+t.x,n=r.height+t.y;if(this.getRetainAspectRatio()){var o=this.getBaseAspectRatio();i/n>o?i=o*n:i/n<o&&(n=i/o)}this.setTargetDimension(this.getTarget(),i,n)},reactMousemove:function(e){if(this.getIsUnderResizing()){var t={x:e.getScreenX(),y:e.getScreenY()};this.resizeTo(t),e.stopPropagation(),e.preventDefault()}},reactMouseup:function(e){e.getButton()===Kekule.X.Event.MouseButton.LEFT&&this.getIsUnderResizing()&&(this.doneResizing(e),e.preventDefault())},reactTouchmove:function(e){if(this.getIsUnderResizing()){var t={x:e.getScreenX(),y:e.getScreenY()};this.resizeTo(t),e.stopPropagation(),e.preventDefault()}},reactTouchend:function(e){this.getIsUnderResizing()&&(this.doneResizing(e),e.preventDefault())},_elemSupportCapture:function(e){return!!e.setCapture},_setMouseCapture:function(e,t,r){e&&(t?(e.setCapture&&e.setCapture(!0),e.setPointerCapture&&Kekule.ObjUtils.notUnset(r.pointerId)&&e.setPointerCapture(r.pointerId)):(e.releaseCapture&&e.releaseCapture(),e.releasePointerCapture&&Kekule.ObjUtils.notUnset(r.pointerId)&&e.releasePointerCapture(r.pointerId)))},_getMoveEventReceiverElem:function(e){return this._elemSupportCapture(e)?e:e.ownerDocument.documentElement},_installEventHandlers:function(t){e.addListener(t,"mousemove",this.reactMousemoveBind),e.addListener(t,"touchmove",this.reactTouchmoveBind),e.addListener(t,"mouseup",this.reactMouseupBind),e.addListener(t,"touchend",this.reactTouchendBind)},_uninstallEventHandlers:function(t){e.removeListener(t,"mousemove",this.reactMousemoveBind),e.removeListener(t,"touchmove",this.reactTouchmoveBind),e.removeListener(t,"mouseup",this.reactMouseupBind),e.removeListener(t,"touchend",this.reactTouchendBind)},doReactActiviting:function(e){this.tryApplySuper("doReactActiviting",[e]);var t={x:e.getScreenX(),y:e.getScreenY()};this.prepareResizing(t,e)}}),ClassEx.extend(Kekule.Widget.BaseWidget,{resizableChanged:function(){var e;this.getResizable()?((e=new Kekule.Widget.ResizeGripper(this)).setRetainAspectRatio(this.getResizeWithAspectRatio()),this.setPropStoreFieldValue("resizeGripper",e)):((e=this.getResizeGripper())&&e.finalize(),this.setPropStoreFieldValue("resizeGripper",null))}}),ClassEx.defineProps(Kekule.Widget.BaseWidget,[{name:"resizable",dataType:DataType.BOOL,setter:function(e){e!==this.getResizable()&&(this.setPropStoreFieldValue("resizable",e),this.resizableChanged())}},{name:"resizeWithAspectRatio",dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("resizeWithAspectRatio",e),this.getResizeGripper()&&this.getResizeGripper().setRetainAspectRatio(e)}},{name:"isResizing",dataType:DataType.BOOL,serializable:!1,scope:r.PRIVATE,setter:null,getter:function(){var e=this.getResizeGripper();return!!e&&e.getIsUnderResizing()}},{name:"resizeGripper",dataType:"Kekule.Widget.ResizeGripper",serializable:!1,setter:null,scope:r.PRIVATE}])}(),function(){"use strict";var e=Kekule.HtmlElementUtils,t=Kekule.StyleUtils,r=Kekule.X.Event,i=Class.PropertyScope;Kekule.Widget.MoveHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.MoveHelper",initialize:function(e,t){this.tryApplySuper("initialize"),this.reactMouseDownBind=this.reactMouseDown.bind(this),this.reactMouseUpBind=this.reactMouseUp.bind(this),this.reactMouseMoveBind=this.reactMouseMove.bind(this),this.reactTouchDownBind=this.reactTouchDown.bind(this),this.reactTouchEndBind=this.reactTouchEnd.bind(this),this.reactTouchMoveBind=this.reactTouchMove.bind(this),this.__$K_initialMoverInfo__={},this.setCssPropX("left").setCssPropY("top").setMovingCursor("move").setMovingCursorDelay(500),this.setTarget(e),this.setGripper(t),this.setEnabled(!0)},doFinalize:function(){this.setGripper(null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("target",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("gripper",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getPropStoreFieldValue("gripper")||this.getTarget()},setter:function(e){var t=this.getPropStoreFieldValue("gripper");e!==t&&(this.setPropStoreFieldValue("gripper",e),this.gripperChanged(e,t))}}),this.defineProp("isMoving",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("cssPropX",{dataType:DataType.STRING}),this.defineProp("cssPropY",{dataType:DataType.STRING}),this.defineProp("movingCursor",{dataType:DataType.STRING}),this.defineProp("movingCursorDelay",{dataType:DataType.INT}),this.defineProp("movable",{dataType:DataType.BOOL,setter:null,getter:function(){return this.getEnabled()&&this.getGripper()}})},_objIsWidget:function(e){return e instanceof Kekule.Widget.BaseWidget},_getElement:function(e){return this._objIsWidget(e)?e.getElement():e},getTargetElement:function(){var e=this.getTarget();return this._objIsWidget(e)?e.getElement():e},getGripperElement:function(){var e=this.getGripper();return this._objIsWidget(e)?e.getElement():e},gripperChanged:function(e,t){t&&this.installEventHandlers(this._getElement(t)),e&&this.installEventHandlers(this._getElement(e))},installEventHandlers:function(e){e&&(r.addListener(e,"mousedown",this.reactMouseDownBind),r.addListener(e,"touchstart",this.reactTouchDownBind))},uninstallEventHandlers:function(e){e&&(r.removeListener(e,"mousedown",this.reactMouseDownBind),r.removeListener(e,"touchstart",this.reactTouchDownBind))},_elemSupportCapture:function(e){return!!e.setCapture},_getMoveEventReceiverElem:function(e){return this._elemSupportCapture(e)?e:e.ownerDocument.documentElement},setMouseCapture:function(e){var t=this.getGripperElement();t&&(e?t.setCapture&&t.setCapture(!0):t.releaseCapture&&t.releaseCapture())},beginMoving:function(t){if(!this.getIsMoving()){var i=this.getTargetElement();e.makePositioned(i),this.saveInitialInformation(t);var n=this._getMoveEventReceiverElem(this.getGripperElement());r.addListener(n,"mousemove",this.reactMouseMoveBind),r.addListener(n,"touchmove",this.reactTouchMoveBind),r.addListener(n,"mouseup",this.reactMouseUpBind),r.addListener(n,"touchend",this.reactTouchEndBind),this.setMouseCapture(!0),this._setCursorHandle=this.delaySetMoveCursor(),this.setIsMoving(!0)}},endMoving:function(){this.setIsMoving(!1),this.setMouseCapture(!1);var e=this.getGripperElement(),t=this._getMoveEventReceiverElem(e);if(r.removeListener(t,"mousemove",this.reactMouseMoveBind),r.removeListener(t,"touchmove",this.reactTouchMoveBind),r.removeListener(t,"mouseup",this.reactMouseUpBind),r.removeListener(t,"touchend",this.reactTouchEndBind),this.clearCursorSetter(),e){var i=this.__$K_initialMoverInfo__.cursor;e.style.cursor=i||"",this.__$K_initialMoverInfo__.cursor=null}},moveTo:function(e){this.clearCursorSetter(),this.doSetMoveCursor();var t=this.getTargetElement();if(t){var r=this.__$K_initialMoverInfo__,i=Kekule.CoordUtils.substract(e,r.pointerCoord);"right"===(this.getCssPropX()||"").toLowerCase()?t.style.right=r.elemCoord.x-i.x+"px":t.style.left=r.elemCoord.x+i.x+"px","bottom"===(this.getCssPropY()||"").toLowerCase()?t.style.bottom=r.elemCoord.y-i.y+"px":t.style.top=r.elemCoord.y+i.y+"px"}},delaySetMoveCursor:function(){return setTimeout(this.doSetMoveCursor.bind(this),this.getMovingCursorDelay()||0)},doSetMoveCursor:function(){var e=this.getGripperElement();e&&this.getMovingCursor()&&(e.style.cursor=this.getMovingCursor())},clearCursorSetter:function(){this._setCursorHandle&&clearTimeout(this._setCursorHandle)},saveInitialInformation:function(r){var i=this.getTargetElement();if(i){var n;this.__$K_initialMoverInfo__.pointerCoord=r;var o=(t.getComputedStyle(i,"position")||"").toLowerCase(),a=(this.getCssPropX()||"left").toLowerCase(),s=(this.getCssPropY()||"top").toLowerCase();if("relative"===o)n={x:t.analysisUnitsValue(t.getComputedStyle(i,"left")).value||0,y:t.analysisUnitsValue(t.getComputedStyle(i,"top")).value||0},a="left",s="top";else n={x:i.offsetLeft,y:i.offsetTop};var l=e.getElemOffsetDimension(i);"right"===a&&(n.x+=l.width),"bottom"===s&&(n.y+=l.height),this.__$K_initialMoverInfo__.elemCoord=n,this.getGripperElement()&&(this.__$K_initialMoverInfo__.cursor=this.getGripperElement().style.cursor)}},reactMouseDown:function(e){this.getTargetElement()&&this.getEnabled()&&e.getButton()===r.MouseButton.LEFT&&(this.beginMoving({x:e.getScreenX(),y:e.getScreenY()},e.getTarget()),e.preventDefault())},reactMouseUp:function(e){e.getButton()===r.MouseButton.LEFT&&this.getIsMoving()&&(this.endMoving(),e.preventDefault())},reactMouseMove:function(e){if(this.getIsMoving()){var t={x:e.getScreenX(),y:e.getScreenY()};this.moveTo(t),e.preventDefault()}},reactTouchDown:function(e){this.getEnabled()&&(this.beginMoving({x:e.getScreenX(),y:e.getScreenY()},e.getTarget()),e.preventDefault())},reactTouchEnd:function(e){this.getIsMoving()&&(this.endMoving(),e.preventDefault())},reactTouchMove:function(e){if(this.getIsMoving()){var t={x:e.getScreenX(),y:e.getScreenY()};this.moveTo(t),e.preventDefault()}}}),ClassEx.extend(Kekule.Widget.BaseWidget,{_getMoveHelper:function(e){var t=this.getMoveHelper();return!t&&e&&(t=new Kekule.Widget.MoveHelper(this)),t},movingGripperChanged:function(){var e,t=this.getMovingGripper();t?(e=this._getMoveHelper(!0)).setGripper(t):(e=this._getMoveHelper(!1))&&e.setGripper(null)}}),ClassEx.defineProps(Kekule.Widget.BaseWidget,[{name:"movable",dataType:DataType.BOOL,getter:function(){return this._getMoveHelper()&&this._getMoveHelper().getMovable()},setter:function(e){if(e!==this.getMovable())if(e)this.setMovingGripper(this.getDefaultMovingGripper&&this.getDefaultMovingGripper()||this);else{var t=this._getMoveHelper();t&&t.setEnabled(!1)}}},{name:"movingGripper",dataType:DataType.OBJECT,setter:function(e){e!==this.getMovingGripper()&&(this.setPropStoreFieldValue("movingGripper",e),this.movingGripperChanged())}},{name:"isMoving",dataType:DataType.BOOL,serializable:!1,scope:i.PRIVATE,setter:null,getter:function(){var e=this.getMoveHelper();return!!e&&e.getIsMoving()}},{name:"moveHelper",dataType:"Kekule.Widget.MoveHelper",serializable:!1,setter:null,scope:i.PRIVATE}])}(),function(){var e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.Glyph=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Glyph",initialize:function(e,t){this._imgElem=null,this.tryApplySuper("initialize",[e]),t&&this.setNormalInfo(t)},initProperties:function(){this.defineImgInfoProp("normalInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("hoverInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("focusedInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("activeInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("disabledInfo",{dataType:DataType.HASH})},defineImgInfoProp:function(e,t){var r=Object.extend({setter:function(t){t?this.setPropStoreFieldValue(e,Object.extend({},t)):this.setPropStoreFieldValue(e,null),this.imgInfoChanged()}},t);return this.defineProp(e,r)},doGetWidgetClassName:function(){return"K-Glyph"},doCreateRootElement:function(e){return e.createElement("span")},doBindElement:function(e){this.tryApplySuper("doBindElement"),this.createImgContainer(e)},createImgContainer:function(e,r){var i=e.ownerDocument;this._imgElem=i.createElement("span"),this._imgElem.className=t.FULLFILL,e.innerHTML="",e.appendChild(this._imgElem)},imgInfoChanged:function(){this.updateImg()},stateChanged:function(){this.tryApplySuper("stateChanged"),this.updateImg()},updateImg:function(){var e=Kekule.Widget.State,t=this.getState(),r=t===e.DISABLED?this.getDisabledInfo():t===e.ACTIVE?this.getActiveInfo()||this.getHoverInfo()||this.getFocusedInfo():t===e.HOVER?this.getHoverInfo():t===e.FOCUSED?this.getFocusedInfo():this.getNormalInfo();r=r||this.getNormalInfo(),this.showImgOfInfo(r)},showImgOfInfo:function(r){var i=this._imgElem;i&&(r?(r.className?(i.className=t.FULLFILL,e.addClass(i,r.className)):i.className=t.FULLFILL,i.style.backgroundImage=r.src?"url("+r.src+")":"",i.style.backgroundPosition=r.position||"",i.style.backgroundRepeat=r.repeat||"no-repeat"):i.style.backgroundImage="")}})}(),function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{CONTAINER:"K-Container",PANEL:"K-Panel",PANEL_CAPTION:"K-Panel-Caption",TOOLBAR:"K-Toolbar"});var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames),r=Kekule.StyleUtils;Kekule.Widget.Container=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Container",initialize:function(e){this._defContainerElem=null,this.tryApplySuper("initialize",[e]),this.reactShowStateChangeBind=this.reactShowStateChange.bind(this),this.addEventListener("showStateChange",this.reactShowStateChangeBind)},finalize:function(){this.removeEventListener("showStateChange",this.reactShowStateChangeBind),this.clearWidgets(),this.tryApplySuper("finalize")},initProperties:function(){this.defineChildDimensionRelatedProp("childWidth"),this.defineChildDimensionRelatedProp("childHeight"),this.defineChildDimensionRelatedProp("childMargin"),this.defineProp("firstChild",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("lastChild",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("allowChildWrap",{dataType:DataType.BOOL,serializable:!1,setter:function(e){this.setPropStoreFieldValue("allowChildWrap",e),e?this.removeClassName(t.NOWRAP):this.addClassName(t.NOWRAP)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAllowChildWrap(!0)},defineChildDimensionRelatedProp:function(e,t){var r=Object.extend({dataType:DataType.STRING,setter:function(t){this.setPropStoreFieldValue(e,t),this.updateChildSizes()}},t||{});return this.defineProp(e,r)},doGetWidgetClassName:function(){return t.CONTAINER},doCreateRootElement:function(e){return e.createElement("span")},doCreateContainerElement:function(e,r,i){var n=Kekule.BrowserFeature.htmlSlot?Kekule.Widget.HtmlTagNames.CHILD_HOLDER:i||"span",o=e.createElement(n);return o.className=t.CHILD_HOLDER,o},getContainerElement:function(){return this.getElement()},getChildrenHolderElement:function(){return this.getContainerElement()},appendWidget:function(e){return e.setParent(this),this},insertWidgetBefore:function(e,t){return e.insertToWidget(this,t),this},removeWidget:function(e,t){e.setParent(null),t||e.finalize()},clearWidgets:function(e){for(var t=this.getChildWidgets(),r=t.length-1;r>=0;--r){var i=t[r];this.removeWidget(i,e)}},_insertChildWidget:function(e,t){var r=t?t.getElement():null,i=this.getChildrenHolderElement();i&&(r?i.insertBefore(e.getElement(),r):i.appendChild(e.getElement()))},reactShowStateChange:function(e){this.childrenModified()},childrenModified:function(){this.tryApplySuper("childrenModified");for(var e=this.getChildWidgets(),r=e.length,i=e[o=0];i&&!i.isShown(!0)&&o<r;)i=e[++o];var n=o<r?i:null,o=r-1;for(i=e[r-1];i&&!i.isShown(!0)&&o>=0;)i=e[--o];var a=o>=0?i:null,s=this.getFirstChild(),l=this.getLastChild();n!==s&&(s&&s.removeClassName(t.FIRST_CHILD),n&&n.addClassName(t.FIRST_CHILD),this.setPropStoreFieldValue("firstChild",n)),a!==l&&(l&&l.removeClassName(t.LAST_CHILD),a&&a.addClassName(t.LAST_CHILD),this.setPropStoreFieldValue("lastChild",a))},childWidgetAdded:function(e){this.tryApplySuper("childWidgetAdded",[e]);var t=this.getChildWidth();t&&e.setWidth(t);var r=this.getChildHeight();r&&e.setHeight(r);var i=this.getChildMargin();i&&(e.getStyle().margin=i),this._insertChildWidget(e,null)},childWidgetRemoved:function(e){this.tryApplySuper("childWidgetRemoved",[e])},childWidgetMoved:function(e,t){this.tryApplySuper("childWidgetMoved",[e,t]);var r=e.getElement(),i=this.getChildWidgets()[t+1],n=i?i.getElement():null;n?this.getContainerElement().insertBefore(r,n):this.getContainerElement().appendChild(r)},updateChildSizes:function(){for(var e=this.getChildWidgets(),t=this.getChildWidth()||"",r=this.getChildHeight()||"",i=this.getChildMargin()||"",n=(this.getLayout(),0),o=e.length;n<o;++n){var a=e[n];a.setWidth(t),a.setHeight(r),a.getStyle().margin=i}}}),Kekule.Widget.Panel=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Panel",initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return this.getCaptionElem(!1)&&e.getElementText(this.getCaptionElem())},setter:function(t){e.setElementText(this.getCaptionElem(!0),t),r.setDisplay(this.getCaptionElem(),!!t)}}),this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(r){var i=this.getPropStoreFieldValue("captionElem");if(!i&&r){(i=this.getDocument().createElement("div")).className=t.PANEL_CAPTION;var n=this.getElement();n.insertBefore(i,e.getFirstChildElem(n)),this.setPropStoreFieldValue("captionElem",i)}return i}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.PANEL}}),Kekule.Widget.WidgetGroup=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGroup",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!0)},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),e.indexOf("useCornerDecoration")>=0&&this._updateChildStyles()},childWidgetAdded:function(e){e.setUseCornerDecoration&&e.setUseCornerDecoration(!1),this.tryApplySuper("childWidgetAdded",[e])},layoutChanged:function(){this.tryApplySuper("layoutChanged"),this._updateChildStyles()},childrenModified:function(){this.tryApplySuper("childrenModified"),this._updateChildStyles()},_updateChildStyles:function(){Kekule.Widget.Layout,this.getLayout();for(var e=this.getFirstChild(),r=this.getLastChild(),i=this.getUseCornerDecoration(),n=this.getChildWidgets(),o=[t.CORNER_LEADING,t.CORNER_TAILING],a=0,s=n.length;a<s;++a){var l=n[a];l.removeClassName(o),l===e&&i&&l.addClassName(t.CORNER_LEADING),l===r&&i&&l.addClassName(t.CORNER_TAILING)}}}),Kekule.Widget.Toolbar=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.Toolbar",finalize:function(){var e=this.getChildWidgetInternalNameMap();e&&e.finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("childDefs",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("childDefs",e),this.recreateChildrenByDefs()}}),this.defineProp("childWidgetInternalNameMap",{dataType:DataType.OBJECT,serializable:!1})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.TOOLBAR},doSetShowText:function(e){this.tryApplySuper("doSetShowText",[e]),this._updateAllChildTextGlyphStyles()},doSetShowGlyph:function(e){this.tryApplySuper("doSetShowGlyph",[e]),this._updateAllChildTextGlyphStyles()},childWidgetAdded:function(e){this.tryApplySuper("childWidgetAdded",[e]),this._updateChildTextGlyphStyles(e)},_updateChildTextGlyphStyles:function(e){e.setShowText&&e.setShowText(this.getShowText()),e.setShowGlyph&&e.setShowGlyph(this.getShowGlyph())},_updateAllChildTextGlyphStyles:function(){for(var e=this.getChildWidgets(),t=e.length-1;t>=0;--t)this._updateChildTextGlyphStyles(e[t])},recreateChildrenByDefs:function(){var e=this.getChildDefs()||[];this.clearWidgets();var t=new Kekule.MapEx(!0);this.setChildWidgetInternalNameMap(t);for(var r=this.getDefaultChildWidgetClassName(),i=0,n=e.length;i<n;++i){var o=e[i];o.widget||o.widgetClass||!r||(o=Object.extend({widget:r},o));var a=Kekule.Widget.createFromHash(this,o);a&&(a.appendToWidget(this),o.internalName&&t.set(o.internalName,a))}},getDefaultChildWidgetClassName:function(){return null},getChildWidgetByInternalName:function(e){var t=this.getChildWidgetInternalNameMap();return t?t.get(e):null}})}(),function(){"use strict";var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames);Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MENU:"K-Menu",POPUPMENU:"K-PopupMenu",MENUBAR:"K-MenuBar",MENUITEM:"K-MenuItem",MENUITEM_NORMAL:"K-MenuItem-Normal",MENUITEM_SEPARATOR:"K-MenuItem-Separator",SUBMENU_MARKER:"K-SubMenu-Marker",CHECKMENU_MARKER:"K-CheckMenu-Marker"}),Kekule.Widget.MenuItem=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.MenuItem",BINDABLE_TAG_NAMES:["li"],SUB_MENU_TAGS:["ol","ul"],initialize:function(e,t){this.tryApplySuper("initialize",[e]),t&&this.setText(t),this._subMenuMarker=null,this._checkMarker=null},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(e){e===Kekule.Widget.MenuItem.SEPARATOR_TEXT?this.setIsSeparator(!0):(e&&this.setIsSeparator(!1),this.changeContentText(e))}}),this.defineProp("checked",{dataType:DataType.BOOL,setter:function(e){this.getPropStoreFieldValue("checked")!==e&&(this.setPropStoreFieldValue("checked",e),this.checkChanged())}}),this.defineProp("autoCheck",{dataType:DataType.BOOL}),this.defineProp("isSeparator",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("isSeparator",e),this.isSeparatorChanged(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!1),this.setIsSeparator(!1)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MENUITEM},doCreateRootElement:function(e){return e.createElement("li")},changeContentText:function(e){this.getElement().innerHTML=e||""},isSeparatorChanged:function(e){e?(this.setText("&nbsp;"),this.removeClassName(t.MENUITEM_NORMAL),this.addClassName(t.MENUITEM_SEPARATOR),this.setStatic(!0)):(this.removeClassName(t.MENUITEM_SEPARATOR),this.addClassName(t.MENUITEM_NORMAL),this.setStatic(!1))},doBindElement:function(t){this.tryApplySuper("doBindElement",[t]);for(var r=e.getDirectChildElems(t),i=0,n=r.length;i<n;++i){var o=r[i];o.nodeType===Node.ELEMENT_NODE&&this.bindSubMenu(o),o=o.nextSibling}},doDomElemAdded:function(e){Kekule.Widget.getWidgetOnElem(e)||this.bindSubMenu(e)},checkChanged:function(){this.getChecked()?(this._createCheckMarker(),this.addClassName(t.STATE_CHECKED),this.invokeEvent("check")):this.removeClassName(t.STATE_CHECKED)},_createCheckMarker:function(){var e;(e=this._checkMarker)||((e=this.getDocument().createElement("span")).className=t.CHECKMENU_MARKER,this.getElement().appendChild(e),this._checkMarker=e);return e},_removeCheckMarker:function(){this._checkMarker&&(this._checkMarker.parentNode.removeChild(this._checkMarker),this._checkMarker=null)},childWidgetAdded:function(e){if(this.tryApplySuper("childWidgetAdded",[e]),e instanceof Kekule.Widget.Menu)e.setIsSubMenu(!0);else if(e instanceof Kekule.Widget.MenuItem){var t=this.getSubMenu(!0);(function(){e.setParent(t),e.appendToWidget(t)}).defer(10)}},childrenModified:function(){this.tryApplySuper("childrenModified"),this.subMenuChanged()},bindSubMenu:function(e){var t=e.tagName.toLowerCase();if("ul"===t||"ol"===t){var r=new Kekule.Widget.PopupMenu(e);return this.addSubMenu(r),r}},subMenuChanged:function(){var e=this.getSubMenu();e?this._createSubMenuMarker(e):this._removeSubMenuMarker()},getSubMenu:function(e){for(var t=this.getChildWidgets(),r=0,i=t.length;r<i;++r){var n=t[r];if(n instanceof Kekule.Widget.Menu)return n}return e?this.createSubMenu():null},addSubMenu:function(e){return e.appendToWidget(this),this},removeSubMenu:function(e){return e.setParent(null),e},createSubMenu:function(){var e=new Kekule.Widget.PopupMenu(this);return this.addSubMenu(e),e},_createSubMenuMarker:function(e){var r;(r=this._subMenuMarker)||((r=this.getDocument().createElement("span")).className=t.SUBMENU_MARKER,this.getElement().appendChild(r),this._subMenuMarker=r);return r},_removeSubMenuMarker:function(){this._subMenuMarker&&(this._subMenuMarker.parentNode.removeChild(this._subMenuMarker),this._subMenuMarker=null)},isLeafItem:function(){var e=this.getElement();return!(e.getElementsByTagName("ul").length||e.getElementsByTagName("ol").length)},isPeriodicalExecuting:function(){return this.tryApplySuper("isPeriodicalExecuting")&&this.getIsActive()},doReactActiviting:function(e){this.tryApplySuper("doReactActiviting",[e]),this.isLeafItem()&&this.getEnablePeriodicalExec()&&this.startPeriodicalExec(e)},doReactDeactiviting:function(e){this.isLeafItem()&&(this.stopPeriodicalExec(),this.getIsActive()&&(this.execute(e),this.getAutoCheck()&&this.setChecked(!this.getChecked()),this.notifyDeactivated()))},notifyDeactivated:function(){var e=this.getParent();e&&e.childDeactivated&&e.childDeactivated(this)},childDeactivated:function(e){var t=this.getParent();t&&t.childDeactivated&&t.childDeactivated(this)}}),Kekule.Widget.MenuItem.SEPARATOR_TEXT="-",Kekule.Widget.MenuItem.createFromHash=function(e,t){var r=t;return DataType.isSimpleValue(r)&&(r=r===Kekule.Widget.MenuItem.SEPARATOR_TEXT?{isSeparator:!0}:{text:r}),r.widget||r.widgetClass||(r.widget=Kekule.Widget.MenuItem),Kekule.Widget.createFromHash(e,r)},Kekule.Widget.Menu=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Menu",BINDABLE_TAG_NAMES:["ol","ul"],MENU_ITEM_TAG:"li",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("isSubMenu",{dataType:DataType.BOOL,serializable:!1,setter:function(e){this.setPropStoreFieldValue("isSubMenu",e),e&&this.setLayout(Kekule.Widget.Layout.VERTICAL)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MENU},doCreateRootElement:function(e){return e.createElement("ul")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]);for(var t=Kekule.DomUtils.getDirectChildElems(e),r=0,i=t.length;r<i;++r){var n=t[r];n.nodeType===Node.ELEMENT_NODE&&this.bindMenuItem(n),n=n.nextSibling}},doDomElemAdded:function(e){this.bindMenuItem(e)},bindMenuItem:function(e){if("li"===e.tagName.toLowerCase()){var t=new Kekule.Widget.MenuItem(e);return t.setParent(this),t}},getSubMenuTagName:function(){return this.getElement().tagName},getMenuItems:function(t){t||(t=this.getElement());for(var r=e.getDirectChildElems(t,this.MENU_ITEM_TAG),i=[],n=0,o=r.length;n<o;++n){var a=Kekule.Widget.getWidgetOnElem(r[n]);a&&a instanceof Kekule.Widget.MenuItem&&i.push(a)}return i},insertMenuItem:function(e,t){return e.insertToWidget(this,t),this},appendMenuItem:function(e){return e.appendToWidget(this),this},removeMenuItem:function(e,t){e.setParent(null),t||e.finalize()},clearMenuItems:function(e){return this.clearWidgets(e),this},isTopLevel:function(){var e=this.getParent();return!e||!(e instanceof Kekule.Widget.MenuItem||e instanceof Kekule.Widget.Menu)},childDeactivated:function(e){var t=this.getParent();t&&t.childDeactivated&&t.childDeactivated(this)},createChildrenByDefs:function(e){for(var t=0,r=e.length;t<r;++t){var i=e[t];Kekule.Widget.MenuItem.createFromHash(this,i)}return this}}),Kekule.Widget.PopupMenu=Class.create(Kekule.Widget.Menu,{CLASS_NAME:"Kekule.Widget.PopupMenu",initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.VERTICAL)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.POPUPMENU},childDeactivated:function(e){}}),Kekule.Widget.MenuBar=Class.create(Kekule.Widget.Menu,{CLASS_NAME:"Kekule.Widget.MenuBar",doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MENUBAR}})}(),function(){"use strict";var e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{BUTTON:"K-Button",BUTTON_KINDED:"K-Button-Kinded",BUTTON_GROUP:"K-Button-Group",COMPACT_BUTTON:"K-Compact-Button",BTN_COMPACT_MARK:"K-Compact-Mark"}),Kekule.Widget.Button=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Button",BINDABLE_TAG_NAMES:["input","button","a","label"],CSS_DROPDOWN_CLASS_NAME:"K-DropDownMark",DEF_GLYPH_WIDTH:"16px",DEF_GLYPH_HEIGHT:"16px",initialize:function(e,t){this._elemTextPart=null,this._elemLeadingGlyphPart=null,this._elemTailingGlyphPart=null,this.tryApplySuper("initialize",[e]),t&&this.setText(t)},initProperties:function(){this.defineElemAttribMappingProp("actionType","type"),this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this._elemTextPart||this.getElement();return e?e.innerHTML:null},setter:function(e){this.changeContentText(e)}}),this.defineProp("leadingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("leadingGlyph");return!t&&e&&(t=this._createDefaultGlyphWidget(this._elemLeadingGlyphPart),this.setPropStoreFieldValue("leadingGlyph",t)),t}}),this.defineProp("tailingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("tailingGlyph");return!t&&e&&(t=this._createDefaultGlyphWidget(this._elemTailingGlyphPart),this.setPropStoreFieldValue("tailingGlyph",t)),t}}),this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("showLeadingGlyph",e),this._elemLeadingGlyphPart.style.display=e&&this.getShowGlyph()?"":"none"}}),this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("showTailingGlyph",e),this._elemTailingGlyphPart.style.display=e&&this.getShowGlyph()?"":"none"}}),this.defineProp("buttonKind",{dataType:DataType.STRING,setter:function(e){var t=this.getButtonKind();e!==t&&(this.cancelButtonKind(t),this.applyButtonKind(e),this.setPropStoreFieldValue("buttonKind",e))}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("showText",!0),this.setPropStoreFieldValue("showGlyph",!0),this.setPropStoreFieldValue("showLeadingGlyph",!0),this.setPropStoreFieldValue("showTailingGlyph",!0),this.setPropStoreFieldValue("useCornerDecoration",!0),this.setAllowTextWrap(!1)},_createDefaultGlyphWidget:function(e){var t=new Kekule.Widget.Glyph(this);return t.setWidth(this.DEF_GLYPH_WIDTH).setHeight(this.DEF_GLYPH_HEIGHT),t.setStatic(!0).setInheritState(!0).setInheritStatic(!0).setInheritEnabled(!0),t.appendToElem(e),t},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.BUTTON},doCreateRootElement:function(e){var t=e.createElement("button");return t.setAttribute("type","button"),t},doBindElement:function(r){this.tryApplySuper("doBindElement",[r]);var i=r.innerHTML||"";r.innerHTML="",this._elemTextPart=this.createTextContent(i,r),this._elemLeadingGlyphPart=this.createGlyphContent(r,this._elemTextPart,t.PART_PRI_GLYPH_CONTENT),this._elemTailingGlyphPart=this.createGlyphContent(r,null,t.PART_ASSOC_GLYPH_CONTENT),this.getUseCornerDecoration()&&e.addClass(r,t.CORNER_ALL)},changeContentText:function(e){this._elemTextPart.innerHTML=e||""},isPeriodicalExecuting:function(){return this.tryApplySuper("isPeriodicalExecuting")&&this.getIsActive()},doReactActiviting:function(e){this.tryApplySuper("doReactActiviting",[e]),this.getEnablePeriodicalExec()&&this.startPeriodicalExec(e)},doReactDeactiviting:function(e){this.stopPeriodicalExec(),this.getIsActive()&&this.execute(e)},cancelButtonKind:function(e){e&&(this.removeClassName(e),this.removeClassName(t.BUTTON_KINDED))},applyButtonKind:function(e){e&&(this.addClassName(t.BUTTON_KINDED),this.addClassName(e))}}),Kekule.Widget.Button.Kinds={DROPDOWN:"K-Kind-DropDown",POPUP:"K-Kind-Popup",SEARCH:"K-Kind-Search",EDIT:"K-Kind-Edit",ENTER:"K-Kind-Enter"},Kekule.Widget.CheckButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.CheckButton",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,setter:function(e){this.getPropStoreFieldValue("checked")!==e&&(this.setPropStoreFieldValue("checked",e),this.checkChanged(),this.stateChanged())}}),this.defineProp("autoCheck",{dataType:DataType.BOOL})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoCheck(!0)},checkChanged:function(){this.getChecked()?this.invokeEvent("check"):this.invokeEvent("uncheck"),this.invokeEvent("checkChange",{checked:this.getChecked()})},getStateClassName:function(e){var t=this.getChecked()?Kekule.Widget.State.ACTIVE:e;return this.tryApplySuper("getStateClassName",[t])},doReactDeactiviting:function(e){var t=this.getChecked();this.tryApplySuper("doReactDeactiviting",[e]),this.getAutoCheck()&&this._doToggleCheckOnSelf(t)},_doToggleCheckOnSelf:function(e){this.getEnabled()&&this.setChecked(!e)}}),Kekule.Widget.RadioButton=Class.create(Kekule.Widget.CheckButton,{CLASS_NAME:"Kekule.Widget.RadioButton",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("group",{dataType:DataType.STRING})},checkChanged:function(){this.tryApplySuper("checkChanged"),this.getChecked()&&this.uncheckSiblings()},uncheckSiblings:function(){var e=this.getParent(),t=this.getGroup();if(e)for(var r=e.getChildWidgets(),i=0,n=r.length;i<n;++i){var o=r[i];o!==this&&o.getGroup&&o.setChecked&&o.getGroup()===t&&o.setChecked(!1)}},doReactDeactiviting:function(e){this.tryApplySuper("doReactDeactiviting",[e])},_doToggleCheckOnSelf:function(e){e||this.tryApplySuper("_doToggleCheckOnSelf",[e])},_doCheckOnSelf:function(){this.getEnabled()&&this.setChecked(!0)}}),Kekule.Widget.DropDownButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.DropDownButton",doFinalize:function(){this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("dropDownWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("dropDownWidget");if(!e){var t=this.getDropDownWidgetGetter();t&&(e=t(this),this.setPropStoreFieldValue("dropDownWidget",e))}return e},setter:function(e){this.setPropStoreFieldValue("dropDownWidget",e),e&&e.setDisplayed(!1)}}),this.defineProp("dropDownWidgetGetter",{dataType:DataType.FUNCTION,serializable:!1}),this.defineProp("dropPosition",{dataType:DataType.INT})},doCreateRootElement:function(e){return this.tryApplySuper("doCreateRootElement",[e])},calcActualDropPosition:function(){var e=Kekule.Widget.Position,t=this.getDropPosition();if(!t){var r=this.getParent(),i=r?r.getLayout():Kekule.Widget.Layout.HORIZONTAL,n=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),!0),o=Kekule.HtmlElementUtils.getViewportDimension(this.getElement()),a=this.getDropDownWidget().getElement();a.style.visible="hidden",a.style.display="",this.getElement().appendChild(a);var s=Kekule.HtmlElementUtils.getElemOffsetDimension(a);if(this.getElement().removeChild(a),i)if(i===Kekule.Widget.Layout.VERTICAL){var l=n.x,u=o.width-l-n.width;t=u>=s.width?e.RIGHT:l>u?e.LEFT:e.RIGHT}else{var d=n.y,c=o.height-d-n.height;t=c>=s.height?e.BOTTOM:d>c?e.TOP:e.BOTTOM}}return t},showDropDownWidget:function(){var e=this.getDropDownWidget();e.getElement().style.position="absolute";this.getElement();e.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN),this.invokeEvent("dropDown",{dropDown:e})},hideDropDownWidget:function(){this.getDropDownWidget().hide(this)},isDropDownWidgetShown:function(){var e=this.getDropDownWidget();return e&&e.isShown()},doExecute:function(e){this.getDropDownWidget()&&(this.isDropDownWidgetShown()?this.hideDropDownWidget():this.showDropDownWidget()),this.tryApplySuper("doExecute",[e])}}),Kekule.Widget.ButtonGroup=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Widget.ButtonGroup",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("showText",!0),this.setPropStoreFieldValue("showGlyph",!0),this.setAllowChildWrap(!1)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.BUTTON_GROUP},doCreateRootElement:function(e){return e.createElement("span")},getDefaultChildWidgetClassName:function(){return"Kekule.Widget.Button"}}),Kekule.Widget.CompactButtonSet=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.CompactButtonSet",initialize:function(e,t){this.reactSetButtonExecuteBind=this.reactSetButtonExecute.bind(this),this.setPropStoreFieldValue("showCompactMark",!0),this.setPropStoreFieldValue("cloneSelectedOutlook",!0),this.tryApplySuper("initialize",[e,t]),this.getButtonSet()||this.initButtonGroup()},initProperties:function(){this.defineProp("buttonSet",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,setter:function(e){var t=this.getButtonSet();t!==e&&(t&&t.finalize(),this.initButtonGroup(e))}}),this.defineProp("buttonSetLayout",{dataType:DataType.INT}),this.defineProp("selected",{dataType:"Kekule.Widget.Button",serializable:!1,setter:function(e){if(e)this.getButtonSet().hasChild(e)&&(this.getCloneSelectedOutlook()&&this.cloneSetButton(e),e.setChecked&&e.setChecked(!0));else{var t=this.getSelected();t&&t.setChecked(!1)}this.setPropStoreFieldValue("selected",e)}}),this.defineProp("cloneSelectedOutlook",{dataType:DataType.BOOL}),this.defineProp("showCompactMark",{dataType:DataType.BOOL,setter:function(e){this.getShowCompactMark()!==e&&(this.setPropStoreFieldValue("showCompactMark",e),e?this.createCompactMark():this.removeCompactMark())}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.COMPACT_BUTTON},doSetShowText:function(e){return this.getButtonSet()&&this.getButtonSet().setShowText(e),this.tryApplySuper("doSetShowText",[e])},doSetShowGlyph:function(e){return this.getButtonSet()&&this.getButtonSet().setShowGlyph(e),this.tryApplySuper("doSetShowGlyph",[e])},createCompactMark:function(){var e=this.getElement();this._compactMark&&e.removeChild(this._compactMark);var r=this.getDocument().createElement("span");return r.className=t.BTN_COMPACT_MARK,e.appendChild(r),this._compactMark=r,r},removeCompactMark:function(){var e=this.getElement();this._compactMark&&e.removeChild(this._compactMark)},initButtonGroup:function(e){if(e)var t=this._getCheckedButtonInGroup(e);else e=new Kekule.Widget.ButtonGroup(this);e.setDisplayed(!1),e.setShowText(this.getShowText()),e.setShowGlyph(this.getShowGlyph()),this.setPropStoreFieldValue("buttonSet",e),this.setDropDownWidget(e),e.addEventListener("execute",this.reactSetButtonExecuteBind),e.addEventListener("check",this.reactSetButtonExecuteBind),t&&this.cloneSetButton(t)},_getCheckedButtonInGroup:function(e){for(var t=e.getChildWidgets(),r=0,i=t.length;r<i;++r){var n=t[r];if(n.getChecked&&n.getChecked())return n}return null},cloneSetButton:function(e){if(this.getCloneSelectedOutlook()){for(var t=this.getElement(),r=this.getButtonSet().getElement(),i=Kekule.DomUtils,n=i.getDirectChildElems(t),o=i.getDirectChildElems(e.getElement()),a=!1,s=0,l=n.length;s<l;++s){(u=n[s])!==r?t.removeChild(u):a=!0}for(s=0,l=o.length;s<l;++s){var u=o[s].cloneNode(!0);a?t.insertBefore(u,r):t.appendChild(u)}this._clonedCustomHtmlClassName&&this.removeClassName(this._clonedCustomHtmlClassName),this._clonedCustomHtmlClassName=e.getCustomHtmlClassName(),this._clonedCustomHtmlClassName&&this.addClassName(this._clonedCustomHtmlClassName),this._compactMark=null,this.createCompactMark()}},calcActualButtonSetLayout:function(){var e=Kekule.Widget.Layout,t=this.getButtonSetLayout();if(!t){var r=this.getParent();t=(r?r.getLayout():e.HORIZONTAL)===e.VERTICAL?e.HORIZONTAL:e.VERTICAL}return t},showDropDownWidget:function(){var e=this.calcActualButtonSetLayout();this.getButtonSet().setLayout(e),this.tryApplySuper("showDropDownWidget")},reactSetButtonExecute:function(e){if(e.target instanceof Kekule.Widget.Button&&e.target!==this.getSelected()&&(!this._currExecButton||this._currExecButton!==e.target))try{this._currExecButton=e.target,e.target.setIsFocused(!1),e.target.setIsHover(!1),e.target.setIsActive(!1),this.setSelected(e.target),this.getButtonSet().isShown()&&this.getButtonSet().hide(),this.invokeEvent("select",{selected:e.target})}finally{this._currExecButton=null}},append:function(e,t){return this.getButtonSet().appendWidget(e),t&&this.setSelected(e),this},insertBefore:function(e,t,r){return this.getButtonSet().insertWidgetBefore(e),r&&this.setSelected(e),this},remove:function(e,t){return this.getButtonSet().removeWidget(e,t),this}})}(),function(){var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,r=Kekule.Widget.HtmlClassNames,i=Kekule.ObjUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OVERLAP:"K-Overlap",FORMCONTROL:"K-FormControl",CHECKBOX:"K-CheckBox",TEXTBOX:"K-TextBox",COMBOTEXTBOX:"K-ComboTextBox",COMBOTEXTBOX_ASSOC_WIDGET:"K-ComboTextBox-Assoc-Widget",BUTTONTEXTBOX:"K-ButtonTextBox",TEXTAREA:"K-TextArea",SELECTBOX:"K-SelectBox",COMBOBOX:"K-ComboBox",COMBOBOX_TEXTWRAPPER:"K-ComboBox-TextWrapper",NUMINPUT:"K-NumInput"}),Kekule.Widget.FormWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.FormWidget",initialize:function(e,t){this.reactValueChangeBind=this.reactValueChange.bind(this),this.reactInputBind=this.reactInput.bind(this),this.setPropStoreFieldValue("isDirty",!1),this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,getter:function(){return this.getCoreElement().name},setter:function(e){this.getCoreElement().name=e}}),this.defineProp("value",{dataType:DataType.VARIANT,serializable:!1,getter:function(){return this.getCoreElement().value},setter:function(e){this.getCoreElement().value=e}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getCoreElement().readOnly},setter:function(e){this.getCoreElement().readOnly=e}})},getTextSelectable:function(){return!0},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.FORMCONTROL},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]);var t=this.getCoreElement();if(t){var r=Kekule.Browser.IE&&8===Kekule.Browser.IEVersion;Kekule.X.Event.addListener(t,"change",this.reactValueChangeBind),Kekule.X.Event.addListener(t,"input",this.reactInputBind),r?(this._bindKeyupEvent=!0,Kekule.X.Event.addListener(t,"keyup",this.reactInputBind)):this._bindKeyupEvent=!1}},doUnbindElement:function(e){var t=this.getCoreElement();t&&(Kekule.X.Event.removeListener(t,"change",this.reactValueChangeBind),Kekule.X.Event.removeListener(t,"input",this.reactInputBind),this._bindKeyupEvent&&Kekule.X.Event.removeListener(t,"keyup",this.reactInputBind)),this.tryApplySuper("doUnbindElement",[e])},notifyValueChanged:function(){this.setIsDirty(!0),this.invokeEvent("valueChange",{widget:this,value:this.getValue()})},selectAll:function(){var e=this.getCoreElement();return e&&e.select&&e.select(),this},reactValueChange:function(){this.notifyValueChanged()},reactInput:function(e){this.setIsDirty(!0),this.invokeEvent("valueInput",{widget:this,value:this.getValue()})}}),Kekule.Widget.CheckBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.CheckBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function(e,t){this.tryApplySuper("initialize",[e]),Kekule.ObjUtils.notUnset(t)&&this.setChecked(!!t)},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,getter:function(){var e=this.getCoreElement();return!!e&&e.checked},setter:function(e){var t=this.getCoreElement();t&&(t.checked=!!e)}}),this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.DomUtils.getElementText(this.getLabelElem())},setter:function(e){Kekule.DomUtils.setElementText(this.getLabelElem(),e)}})},getCoreElement:function(){return this.getInputElem()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.CHECKBOX},getInputElem:function(){var e=this.getElement();if(e){var t=e.getElementsByTagName("input");if(t&&t.length)return t[0]}return null},getLabelElem:function(){var e=this.getElement();if(e){if("label"===e.tagName.toLowerCase())return e;var t=e.getElementsByTagName("label");if(t&&t.length)return t[0]}return null},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=e.createElement("label");t.appendChild(r);var i=e.createElement("input");return i.setAttribute("type","checkbox"),r.appendChild(i),[r,i]}}),Kekule.Widget.TextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextBox",BINDABLE_TAG_NAMES:["input"],initialize:function(e,t){this.tryApplySuper("initialize",[e]),t&&this.setText(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getElement().value},setter:function(e){this.getElement().value=e||""}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.TEXTBOX},doCreateRootElement:function(e){return e.createElement("input")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]),e.setAttribute("type","text")}}),Kekule.Widget.ComboTextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboTextBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function(e,t){this.tryApplySuper("initialize",[e]),t&&this.setText(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var t=this.getTextBox();t&&t.setText(e)}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getTextBox().getPlaceholder()},setter:function(e){this.getTextBox().setPlaceholder(e)}}),this.defineProp("overlapOnTextBox",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("overlapOnTextBox",e),e?this.addClassName(r.OVERLAP):this.removeClassName(r.OVERLAP),this.adjustWidgetsSize()}}),this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:!1,setter:null}),this.defineProp("headingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:function(e){var t=this.getHeadingWidget();if(e!==t&&(this.setPropStoreFieldValue("headingWidget",e),t&&(t.setParent(null),t.removeClassName(r.COMBOTEXTBOX_ASSOC_WIDGET)),e)){var i=this.getTextBox()?this.getTextBox().getElement():this.getTailingWidget()?this.getTailingWidget().getElement():null;e.setParent(this),e.addClassName(r.COMBOTEXTBOX_ASSOC_WIDGET),e.insertToElem(this.getElement(),i)}}}),this.defineProp("tailingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:function(e){var t=this.getTailingWidget();e!==t&&(this.setPropStoreFieldValue("tailingWidget",e),t&&(t.setParent(null),t.removeClassName(r.COMBOTEXTBOX_ASSOC_WIDGET)),e&&(e.setParent(this),e.addClassName(r.COMBOTEXTBOX_ASSOC_WIDGET),e.appendToElem(this.getElement())))}})},finalize:function(){this._finalizeSubWidgets(),this.tryApplySuper("finalize")},_finalizeSubWidgets:function(){var e,t=this.getTextBox();t&&t.finalize(),(e=this.getHeadingWidget())&&e.finalize(),(e=this.getTailingWidget())&&e.finalize()},getCoreElement:function(){var e=this.getTextBox();return e?e.getElement():this.tryApplySuper("getCoreElement")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMBOTEXTBOX},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var i=this.tryApplySuper("doCreateSubElements",[e,t]);this._finalizeSubWidgets();var n=new Kekule.Widget.TextBox(this);return n.addClassName(r.TEXTBOX),n.appendToElem(this.getElement()),this.setPropStoreFieldValue("textBox",n),i.push(n.getElement()),i},elementBound:function(e){this.setObserveElemResize(!0)},relayEvent:function(e,t){var r=t.widget;return r!==this.getTextBox()&&r!==this.getHeadingWidget()&&r!==this.getTailingWidget()||(t.widget=this),this.tryApplySuper("relayEvent",[e,t])},doSetEnabled:function(e){var t=this.getTextBox();t&&t.setEnabled(e);var r=this.getHeadingWidget();r&&r.setEnabled(e),(r=this.getTailingWidget())&&r.setEnabled(e)},doResize:function(){this.adjustWidgetsSize()},widgetShowStateChanged:function(e,t){this.tryApplySuper("widgetShowStateChanged",[e,t]),e&&this.adjustWidgetsSize()},doInsertedToDom:function(){this.isShown()&&this.adjustWidgetsSize()},assocWidgetChanged:function(){this.adjustWidgetsSize()},adjustWidgetsSize:function(){var e=Kekule.StyleUtils,t=this.getOverlapOnTextBox(),r=t?"absolute":"relative",i=this.getTextBox().getElement();if(i){var n,o,a,s=Kekule.HtmlElementUtils.getElemPageRect(i);if((o=(n=this.getHeadingWidget())?n.getElement():null)&&n.isShown())if((a=o.style).position=r,t){var l=Kekule.HtmlElementUtils.getElemPageRect(o);a.left=0,a.top=(s.height-l.height)/2+"px",i.style.paddingLeft=l.width+"px"}else e.removeStyleProperty(a,"left"),e.removeStyleProperty(a,"top"),e.removeStyleProperty(i.style,"paddingLeft");else e.removeStyleProperty(i.style,"paddingLeft");if((o=(n=this.getTailingWidget())?n.getElement():null)&&n.isShown())if((a=o.style).position=r,t){l=Kekule.HtmlElementUtils.getElemPageRect(o);a.right=0,a.top=(s.height-l.height)/2+"px",i.style.paddingRight=l.width+"px"}else e.removeStyleProperty(a,"right"),e.removeStyleProperty(a,"top"),e.removeStyleProperty(i.style,"paddingRight");else e.removeStyleProperty(i.style,"paddingRight")}}}),Kekule.Widget.ButtonTextBox=Class.create(Kekule.Widget.ComboTextBox,{CLASS_NAME:"Kekule.Widget.ButtonTextBox",initialize:function(e,t){this.tryApplySuper("initialize",[e,t]),this.setOverlapOnTextBox(!0)},initProperties:function(){this.defineProp("button",{dataType:"Kekule.Widget.Button",serializable:!1,setter:null,getter:function(){return this.getTailingWidget()}}),this.defineProp("buttonKind",{dataType:DataType.STRING,getter:function(){return this.getButton().getButtonKind()},setter:function(e){this.getButton().setButtonKind(e)}}),this.defineProp("buttonText",{dataType:DataType.STRING,getter:function(){return this.getButton().getText()},setter:function(e){this.getButton().setText(e).setShowText(!!e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.BUTTONTEXTBOX},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.createAssocButton();return i&&r.push(i.getElement()),r},createAssocButton:function(){var e=new Kekule.Widget.Button(this);return e.setShowText(!1),this.setTailingWidget(e),e.addEventListener("change",this.adjustWidgetsSize,this),e.addEventListener("execute",function(e){this.invokeEvent("buttonExecute",{widget:this})},this),e},execBtn:function(e){var t=this.getButton();if(t)return t.execute(e),!0},react_keypress:function(e){13===e.getKeyCode()&&this.execBtn(e)},react_keydown:function(e){if(this.getButtonKind()===Kekule.Widget.Button.Kinds.DROPDOWN){var t=Kekule.X.Event.KeyCode;e.getKeyCode()===t.DOWN&&this.execBtn(e)}}}),Kekule.Widget.TextArea=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextArea",BINDABLE_TAG_NAMES:["textarea"],initialize:function(e,t){this.tryApplySuper("initialize",[e]),t&&this.setText(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getValue()},setter:function(e){this.setValue(e),this.adjustAutoSize()}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}}),this.defineProp("autoSizeX",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeX",e),this._autoSizeChanged()}}),this.defineProp("autoSizeY",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeY",e),this._autoSizeChanged()}}),this.defineProp("wrap",{dataType:DataType.STRING,getter:function(){return this.getElement().wrap},setter:function(e){this.getElement().wrap=e}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.TEXTAREA},doCreateRootElement:function(e){return e.createElement("textarea")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]),this.adjustAutoSize()},setValue:function(e){this.tryApplySuper("setValue",[e]),this.adjustAutoSize()},widgetShowStateChanged:function(e,t){this.tryApplySuper("widgetShowStateChanged",[e,t]),e&&this.adjustAutoSize()},doFileDragDrop:function(e){if(e){if(Kekule.BrowserFeature.fileapi){var t=this,r=new FileReader;r.onload=function(e){var i=r.result;t.setText(i)},r.readAsText(e[0])}return!0}return this.tryApplySuper("doFileDragDrop")},reactValueChange:function(){this.adjustAutoSize(),this.tryApplySuper("reactValueChange")},react_keyup:function(){this.adjustAutoSize()},react_keypress:function(){this.adjustAutoSize()},doWidgetShowStateChanged:function(e){e&&this.adjustAutoSize()},_autoSizeChanged:function(){var e=this.getCoreElement().style;this.getAutoSizeX()?(e.overflowX="hidden",this.setWrap("off")):(e.overflowX="auto",this.setWrap("")),this.getAutoSizeY()?e.overflowY="hidden":e.overflowY="auto",this.adjustAutoSize()},adjustAutoSize:function(){(this.getAutoSizeX()||this.getAutoSizeY())&&this.adjustSizeByContent()},adjustSizeByContent:function(){var e=this.getCoreElement(),t=!this.getText(),r=e.style;this.getAutoSizeX()&&(r.width="1px"),this.getAutoSizeY()&&(r.height="1px");var i=Kekule.HtmlElementUtils.getElemScrollDimension(e),n=Kekule.HtmlElementUtils.getElemClientDimension(e);this.getAutoSizeX()&&(t?r.width="1em":i.width>n.width&&(r.width=i.width+"px")),this.getAutoSizeY()&&(t&&(r.height="1em"),i.height>n.height&&(r.height=i.height+"px"))}}),Kekule.Widget.SelectBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.SelectBox",BINDABLE_TAG_NAMES:["select"],ITEM_DATA_FIELD:"__$item_data__",ITEM_VALUE_FIELD:"__$item_value__",initialize:function(e,t){this.tryApplySuper("initialize",[e]),t&&this.setItems(t)},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){for(var e=this.getAllItemElems(),t=[],r=0,i=e.length;r<i;++r){var n=e[r],o=this._getBoxItemInfo(n);t.push(o)}return t},setter:function(e){var t=this.getElement();if(this.clear(),e)for(var r=Kekule.ArrayUtils.toArray(e),i=0,n=r.length;i<n;++i){var o=r[i];if(o){var a=this._createBoxItemElem(t);this._setBoxItemInfo(a,o)}}}}),this.defineProp("index",{dataType:DataType.INT,getter:function(){return this.getElement().selectedIndex},setter:function(e){this.getElement().selectedIndex=e}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.SELECTBOX},doCreateRootElement:function(e){return e.createElement("select")},_createBoxItemElem:function(e,t){var r=e.ownerDocument.createElement("option");return t?e.insertBefore(r,t):e.appendChild(r),r},doBindElement:function(e){this.tryApplySuper("doBindElement",[e])},doGetValue:function(){var e=this.getSelectedItemElem();return e?this._getBoxItemInfo(e).value:void 0},doSetValue:function(e){for(var t=this.getAllItemElems(),r=0,i=t.length;r<i;++r){var n=t[r];if(this._getBoxItemInfo(n).value===e)return void this.setIndex(r)}this.setIndex(-1)},getAllItemElems:function(){return e.getDirectChildElems(this.getElement(),"option")},getSelectedItemElem:function(){for(var e=this.getAllItemElems(),t=0,r=e.length;t<r;++t){var i=e[t];if(i.selected)return i}return null},getItemData:function(e){var t=this._getBoxItemInfo(e);return t&&t.data},getSelectedItemData:function(){var e=this.getSelectedItemElem();return e&&this.getItemData(e)},clear:function(){this.getElement().innerHTML=""},dropDown:function(){this.getDocument(),this.getElement();var e=this.getDocument().createEvent("MouseEvents");e.initEvent("mousedown",!0,!0),this.getElement().dispatchEvent(e)},_getBoxItemInfo:function(e){var r={};return r.text=t.getInnerText(e),r.value=e[this.ITEM_VALUE_FIELD],i.notUnset(e.title)&&(r.title=e.title),i.notUnset(e[this.ITEM_DATA_FIELD])&&(r.data=e[this.ITEM_DATA_FIELD]),r},_setBoxItemInfo:function(e,t){DataType.isSimpleValue(t)&&(t={value:t});var r=t.text||t.value;return i.notUnset(r)&&Kekule.DomUtils.setElementText(e,r),e.value=""+t.value,e[this.ITEM_VALUE_FIELD]=t.value,i.notUnset(t.title)&&(e.title=t.title),i.notUnset(t.data)&&(e[this.ITEM_DATA_FIELD]=t.data),t.selected?e.setAttribute("selected","selected"):e.selected=!1,this}}),Kekule.Widget.ComboBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var t=this.getTextBox();t&&(t.setText(e),this.textChanged())}}),this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getSelectBox();return e?e.getItems():null},setter:function(e){var t=this.getSelectBox();t&&t.setItems(e)}}),this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("selectBox",{dataType:"Kekule.Widget.SelectBox",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},finalize:function(){this._finalizeSubElements(),this.tryApplySuper("finalize")},_finalizeSubElements:function(){var e=this.getTextBox();e&&e.finalize();var t=this.getSelectBox();t&&t.finalize()},getCoreElement:function(){var e=this.getTextBox();return e?e.getElement():this.tryApplySuper("getCoreElement")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMBOBOX},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var i=this;this._finalizeSubElements();var n=e.createElement("span");n.className=r.COMBOBOX_TEXTWRAPPER,t.appendChild(n);var o=new Kekule.Widget.TextBox(this);o.appendToElem(n),this.setPropStoreFieldValue("textBox",o);var a=new Kekule.Widget.SelectBox(this);return a.appendToElem(t),this.setPropStoreFieldValue("selectBox",a),a.addEventListener("valueChange",function(e){var t=a.getSelectedItemElem();if(t){var r=t.value,n=t.text||t.value;n!==o.getText()&&(o.setText(n),i.notifyValueChanged()),o.selectAll(),o.focus(),i.invokeEvent("valueSelect",{widget:i,value:r})}}),o.addEventListener("valueChange",function(e){i.textChanged()}),Kekule.X.Event.addListener(o.getElement(),"keydown",function(e){e.getKeyCode()===Kekule.X.Event.KeyCode.DOWN&&a.dropDown()}),[n]},relayEvent:function(e,t){var r=t.widget;if(r!==this.getTextBox()&&r!==this.getSelectBox()||(t.widget=this,"valueChange"!==e))return this.tryApplySuper("relayEvent",[e,t])},textChanged:function(){var e=this.getText(),t=this._getValueOfText(e);this.getSelectBox().setValue(t)},_getValueOfText:function(e){for(var t=this.getSelectBox().getItems(),r=0,i=t.length;r<i;++r){var n=t[r];if(n.text&&n.text===e)return n.value}return e},doSetEnabled:function(e){var t=this.getTextBox();t&&t.setEnabled(e);var r=this.getSelectBox();r&&r.setEnabled(e)},doGetValue:function(){var e=this.tryApplySuper("doGetValue");return this._getValueOfText(e)},doSetValue:function(e){var t=e,r=this.getSelectBox().getItems();this.getSelectBox().setIndex(-1);for(var i=0,n=r.length;i<n;++i){var o=r[i];if(o.value===e){t=o.text||o.value,this.getSelectBox().setIndex(i);break}}this.tryApplySuper("doSetValue",[t])}}),Kekule.Widget.NumInput=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.NumInput",BINDABLE_TAG_NAMES:["input"],DEF_MIN_VALUE:0,DEF_MAX_VALUE:100,DEF_STEP:1,initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e]),i.notUnset(t)&&this.setMinValue(t),i.notUnset(r)&&this.setMaxValue(r),i.notUnset(n)&&this.setStep(n),o&&this.setControlType(o)},initProperties:function(){this.defineProp("minValue",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().min)||null},setter:function(e){this.getElement().min=e}}),this.defineProp("maxValue",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().max)||null},setter:function(e){this.getElement().max=e}}),this.defineProp("step",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().step)||null},setter:function(e){this.getElement().step=e}}),this.defineProp("controlType",{dataType:DataType.STRING,getter:function(){return this.getElement().getAttribute("type")},setter:function(e){this.getElement().setAttribute("type",e)}})},doGetValue:function(){var e=this.tryApplySuper("doGetValue");return e?parseFloat(e):0},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.NUMINPUT},doCreateRootElement:function(e){return e.createElement("input")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]),e.setAttribute("type","range")}})}(),function(){"use strict";Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{STATE_COLLAPSED:"K-State-Collapsed",STATE_EMPTY:"K-State-Empty",NESTED_CONTAINER:"K-NestedContainer",NESTED_CONTAINER_ITEM:"K-NestedContainer-Item"}),Kekule.Widget.NestedContainer=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.NestedContainer",DEF_CONTAINER_TAG:"ul",DEF_ITEM_TAG:"li",ITEM_DATA_FIELD:"__$itemData__",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("itemInitialExpanded",{dataType:DataType.BOOL})},doCreateRootElement:function(e){return e.createElement("div")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e])},getContainerElemTag:function(){return this.DEF_CONTAINER_TAG},getItemElemTag:function(){return this.DEF_ITEM_TAG},_createChildItemElem:function(){var e=this.doCreateChildItemElem();return Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM),Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.STATE_EMPTY),e},doCreateChildItemElem:function(){return this.getDocument().createElement(this.getItemElemTag())},_createChildContainerElem:function(){var e=this.doCreateChildContainerElem();return Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER),e},doCreateChildContainerElem:function(){return this.getDocument().createElement(this.getContainerElemTag())},getChildContainerElem:function(e,t){e||(e=this.getElement());var r=e.getElementsByTagName(this.getContainerElemTag()),i=r.length?r[0]:null;return!i&&t&&(i=this._createChildContainerElem(),e.appendChild(i)),i},getItemData:function(e){return e[this.ITEM_DATA_FIELD]},setItemData:function(e,t){this.doSetItemData(e,t),e[this.ITEM_DATA_FIELD]=t;var r=t.children;if(r&&Kekule.ArrayUtils.isArray(r)){this.clearChildItems(e);for(var i=0,n=r.length;i<n;++i){var o=r[i];this.appendChildItem(e,o)}}return this},doSetItemData:function(e,t){},hasChildItem:function(e){return this.getChildItemCount(e)>0},getChildItemCount:function(e){return this.getChildren(e).length},getChildren:function(e){var t=this.getChildContainerElem(e);return t?Kekule.DomUtils.getDirectChildElems(t,this.getItemElemTag()):[]},getChildItemAt:function(e,t){var r=this.getChildren(e);return r.length&&r.length>t?r[t]:null},insertChildItem:function(e,t,r){var i=this.getChildContainerElem(e,!0);if(t&&Kekule.DomUtils.isElement(t))n=t;else{var n=this._createChildItemElem();this.getItemInitialExpanded()||Kekule.HtmlElementUtils.addClass(n,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),t&&this.setItemData(n,t)}var o=DataType.isSimpleType(r)?this.getChildren(e)[r]:r;return o?i.insertBefore(n,o):i.appendChild(n),this.childItemsChanged(e),n},appendChildItem:function(e,t){return this.insertChildItem(e,t)},removeChildItem:function(e,t){var r=this.getChildContainerElem(e);return r&&(r.removeChild(t),this.hasChildItem(e)||e.removeChild(r),this.childItemsChanged(e)),this},removeChildItemAt:function(e,t){var r=this.getChildItemAt(e,t);return r&&this.removeChildItem(e,r),this},clearChildItems:function(e){var t=this.getChildContainerElem(e);e||(e=this.getElement()),t&&e.removeChild(t),this.childItemsChanged(e)},childItemsChanged:function(e){if(e){var t=Kekule.Widget.HtmlClassNames.STATE_EMPTY;this.hasChildItem(e)?Kekule.HtmlElementUtils.removeClass(e,t):Kekule.HtmlElementUtils.addClass(e,t)}},expandItem:function(e){return Kekule.HtmlElementUtils.removeClass(e,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),this},collapseItem:function(e){return Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),this},toggleExpandStateOfItem:function(e){return Kekule.HtmlElementUtils.toggleClass(e,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),this},isChildItem:function(e){return Kekule.HtmlElementUtils.hasClass(e,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM)},getBelongedChildItem:function(e){for(var t=e,r=this.getElement(),i=this.getDocument().body;t!==r&&t!==i;)if(t=t.parentNode,this.isChildItem(t))return t;return null},getAllChildItems:function(e){var t=[],r=this.getChildContainerElem(e,!1);if(r)for(var i=Kekule.DomUtils.getDirectChildElems(r),n=0,o=i.length;n<o;++n){var a=i[n];if(this.isChildItem(a)){t.push(a);var s=this.getAllChildItems(a);t=t.concat(s)}}return t},getChildItemRange:function(e,t,r){var i=this.getAllChildItems(r),n=i.indexOf(e),o=i.indexOf(t);if(n>=0&&o>=0){if(n>o){var a=!0,s=n;n=o,o=s}var l=i.slice(n,o+1);return a&&(l=l.reverse()),l}return[]}})}(),function(){"use strict";Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TREEVIEW:"K-TreeView",TREEVIEW_EXPANDMARK:"K-TreeView-ExpandMark",TREEVIEW_ITEMCONTENT:"K-TreeView-ItemContent"}),Kekule.Widget.TreeView=Class.create(Kekule.Widget.NestedContainer,{CLASS_NAME:"Kekule.Widget.TreeView",BELONGED_ITEM_FIELD:"__$treeItem__",initProperties:function(){this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("selection");return e||(e=[],this.setPropStoreFieldValue("selection",e)),e},setter:function(e){this.select(e)}}),this.defineProp("selectedItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getSelection();return e.length?e[e.length-1]:null},setter:function(e){this.select(e)}}),this.defineProp("autoScrollToSelected",{dataType:DataType.BOOL}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TREEVIEW},doCreateChildItemElem:function(){var t=this.tryApplySuper("doCreateChildItemElem");if(t){var r=this.createGlyphContent(t,null,e.TREEVIEW_EXPANDMARK);r[this.BELONGED_ITEM_FIELD]=t,t._expandMarkerElem=r;var i=this.getDocument().createElement("span");i.className=e.TREEVIEW_ITEMCONTENT,t.appendChild(i),i[this.BELONGED_ITEM_FIELD]=t,t._contentElem=i}return t},doSetItemData:function(e,t){this.setItemText(e,t.text)},getExpandMarkerElem:function(e){return e._expandMarkerElem},getItemContentElem:function(e){return e._contentElem},getTextPartElem:function(e,t){var r=e._textPartElem;return!r&&t&&(r=this.createTextContent("",this.getItemContentElem(e)),e._textPartElem=r),r},setItemText:function(e,t){this.getTextPartElem(e,!0).innerHTML=t},isItemSelected:function(e){var t=this.getSelection();return!!t&&t.indexOf(e)>=0},selectionChanged:function(){if(this.getAutoScrollToSelected()){var e=this.getSelectedItem();e&&e.scrollIntoView&&e.scrollIntoViewIfNeeded()}this.notifyPropSet("selection",this.getSelection()),this.invokeEvent("selectionChange",{selection:this.getSelection(),selectedItem:this.getSelectedItem()})},clearSelection:function(){var t=this.getSelection();if(t.length){for(var r=0,i=t.length;r<i;++r){var n=t[r];Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(n),e.STATE_SELECTED)}this.setPropStoreFieldValue("selection",[]),this.selectionChanged()}return this},removeFromSelection:function(t){if(t){var r=Kekule.ArrayUtils.toArray(t);if(r&&r.length){for(var i=this.getSelection(),n=0,o=r.length;n<o;++n){var a=r[n];Kekule.ArrayUtils.remove(i,a)&&Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(a),e.STATE_SELECTED)}this.selectionChanged()}}return this},addToSelection:function(t){if(t){var r=Kekule.ArrayUtils.toArray(t);if(r&&r.length){this.getEnableMultiSelect()||(this.clearSelection(),r=[r[r.length-1]]);for(var i=this.getSelection(),n=0,o=r.length;n<o;++n){var a=r[n];this.isItemSelected(a)||(Kekule.HtmlElementUtils.addClass(this.getItemContentElem(a),e.STATE_SELECTED),i.push(a))}this.selectionChanged()}}return this},toggleSelectionState:function(e){if(e){this.beginUpdate();try{var t=Kekule.ArrayUtils.toArray(e);this.getSelection();if(t&&t.length)for(var r=0,i=t.length;r<i;++r){var n=t[r];this.isItemSelected(n)?this.removeFromSelection(n):this.addToSelection(n)}}finally{this.endUpdate()}}},select:function(e,t){this.beginUpdate();try{if(this.clearSelection(),e)if(this.getEnableMultiSelect())this.addToSelection(e);else{var r=Kekule.ArrayUtils.toArray(e);this.addToSelection(r[r.length-1])}}finally{this.endUpdate()}},react_click:function(e){var t=e.getTarget(),r=t[this.BELONGED_ITEM_FIELD];if(r&&this.isChildItem(r))this.toggleExpandStateOfItem(r);else if(r=this.getBelongedChildItem(t),e.getShiftKey()){var i=this.getSelectedItem();if(i){var n=this.getChildItemRange(i,r);n.length&&(e.getCtrlKey()?this.addToSelection(n):this.select(n))}else this.select(r)}else e.getCtrlKey()?this.toggleSelectionState(r):r&&this.select(r)},react_dblclick:function(e){var t=e.getTarget(),r=this.getBelongedChildItem(t);r&&this.toggleExpandStateOfItem(r)}})}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,r=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{LISTVIEW:"K-ListView",LISTVIEW_ITEM_HOLDER:"K-ListView-ItemHolder",LISTVIEW_ITEM:"K-ListView-Item",LISTVIEW_ITEMCONTENT:"K-ListView-ItemContent"}),Kekule.Widget.ListView=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ListView",ITEM_DATA_FIELD:"__$itemData__",initialize:function(e){this.setPropStoreFieldValue("enableSelect",!0),this.setPropStoreFieldValue("enableMultiSelect",!0),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){for(var t=[],r=e.getDirectChildElems(this.getChildrenHolderElement()),i=0,n=r.length;i<n;++i){var o=r[i];this.isChildItemElem(o)&&t.push(o)}return t}}),this.defineProp("enableSelect",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableSelect",e),e||this.clearSelection()}}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableMultiSelect",e),e||this.clearSelection()}}),this.defineProp("enableSelectInSelection",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableSelectInSelection",e);var i=this.getSelectedItem();i&&(e?t.addClass(i,r.STATE_CURRENT_SELECTED):t.removeClass(i,r.STATE_CURRENT_SELECTED))}}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("selection");return e||(e=[],this.setPropStoreFieldValue("selection",e)),e},setter:function(e){this.select(e)}}),this.defineProp("currSelectedItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getSelectedItem()},setter:function(e){this.setSelectedItem(e)}}),this.defineProp("selectedItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getSelection();return e.length?e[e.length-1]:null},setter:function(e){var t=this.getBelongedChildItem(e);if(t)if(this.getEnableSelectInSelection()){var r=this.getSelection(),i=r.indexOf(t);i>=0?(this.prepareChangingSelection(),r.splice(i,1),r.push(t),this.selectionChanged()):this.select(t)}else this.select(t);else this.clearSelection()}})},doCreateSubElements:function(e,t){var i=this.tryApplySuper("doCreateSubElements",[]);return this._holderElem=e.createElement("ul"),this._holderElem.className=r.LISTVIEW_ITEM_HOLDER,t.appendChild(this._holderElem),i=i.concat(this._holderElem)},getChildrenHolderElement:function(){return this._holderElem},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.LISTVIEW},doCreateRootElement:function(e){return e.createElement("ul")},getItemClassName:function(){return r.LISTVIEW_ITEM},createChildItem:function(e){var r=this.doCreateChildItem(e);return r&&(t.addClass(r,this.getItemClassName()),e&&this.setItemData(r,e)),r},doCreateChildItem:function(e){return this.getDocument().createElement("li")},getItemData:function(e){return e[this.ITEM_DATA_FIELD]},setItemData:function(e,t){return this.doSetItemData(e,t),e[this.ITEM_DATA_FIELD]=t,this},doSetItemData:function(t,r){r&&(r.text&&e.setElementText(t,r.text),r.hint&&t.setAttribute("title",r.hint))},isChildItemElem:function(e){return e.parentNode===this.getChildrenHolderElement()&&t.hasClass(e,r.LISTVIEW_ITEM)},getBelongedChildItem:function(t){return e.isDescendantOf(t,this.getElement())?this.isChildItemElem(t)?t:this.getBelongedChildItem(t.parentNode):null},getAllChildItems:function(){for(var t=[],r=e.getDirectChildElems(this.getChildrenHolderElement()),i=0,n=r.length;i<n;++i){var o=r[i];this.isChildItemElem(o)&&t.push(o)}return t},getChildItemElemRange:function(e,t){var r=this.getAllChildItems(),i=r.indexOf(e),n=r.indexOf(t);if(i>=0&&n>=0){if(i>n){var o=!0,a=i;i=n,n=a}var s=r.slice(i,n+1);return o&&(s=s.reverse()),s}return[]},indexOfItem:function(e){var t=-1,r=this.getBelongedChildItem(e);r&&(t=this.getAllChildItems().indexOf(r));return t},getItemAt:function(e){return this.getAllChildItems()[e]},_itemBeforeInsert:function(e){},_itemInserted:function(e){t.addClass(e,this.getItemClassName())},_itemBeforeRemove:function(e){this.isItemSelected(e)&&this.removeFromSelection(e),t.removeClass(e,this.getItemClassName())},_itemRemoved:function(e){},appendItem:function(t){return t?e.isElement(t)||(t=this.createChildItem(t)):t=this.createChildItem(),this._itemBeforeInsert(t),this.getChildrenHolderElement().appendChild(t),this._itemInserted(t),t},insertItemBefore:function(t,r){t?e.isElement(t)||(t=this.createChildItem(t)):t=this.createChildItem();var i=r&&this.getBelongedChildItem(r);return i?(this._itemBeforeInsert(t),this.getChildrenHolderElement().insertBefore(t,i),this._itemInserted(t),t):this.appendItem(t)},removeItem:function(e){var t=this.getBelongedChildItem(e);return this._itemBeforeRemove(t),this.getChildrenHolderElement().removeChild(t),this._itemRemoved(t),e},removeItems:function(e){for(var t=e.length-1;t>=0;--t)this.removeItem(e[t]);return this},clearItems:function(){this.select();var e=this.getItems();return this.removeItems(e),this},isItemSelected:function(e){var t=this.getSelection();return!!t&&t.indexOf(e)>=0},prepareChangingSelection:function(){this._prevSelectedItem=this.getSelectedItem()},selectionChanged:function(e,i){var n={selection:this.getSelection(),selectedItem:this.getSelectedItem(),added:e,removed:i},o=this.getSelectedItem();this._prevSelectedItem&&this._prevSelectedItem!==o&&(n.prevSelectedItem=this._prevSelectedItem,t.removeClass(this._prevSelectedItem,r.STATE_CURRENT_SELECTED),this._prevSelectedItem=null),o&&this.getEnableSelectInSelection()&&t.addClass(o,r.STATE_CURRENT_SELECTED),this.notifyPropSet("selection",this.getSelection()),this.invokeEvent("selectionChange",n)},clearSelection:function(){var e=this.getSelection();return e.length&&(this.prepareChangingSelection(),this.doClearSelection(),this.selectionChanged(null,e)),this},doClearSelection:function(){var e=this.getSelection();if(e.length){for(var i=0,n=e.length;i<n;++i){var o=this.getBelongedChildItem(e[i]);t.removeClass(o,[r.STATE_SELECTED,r.STATE_CURRENT_SELECTED])}this.setPropStoreFieldValue("selection",[])}},removeFromSelection:function(e){if(e){var i=[],n=Kekule.ArrayUtils.toArray(e);if(n&&n.length){var o=this.getSelection();this.prepareChangingSelection();for(var a=0,s=n.length;a<s;++a){var l=n[a];Kekule.ArrayUtils.remove(o,l)&&(t.removeClass(this.getBelongedChildItem(l),[r.STATE_SELECTED,r.STATE_CURRENT_SELECTED]),i.push(l))}this.selectionChanged(null,i)}}return this},addToSelection:function(e){if(e){var t=Kekule.ArrayUtils.toArray(e);if(t&&t.length){this.prepareChangingSelection();var r=this.doAddToSelection(t);this.selectionChanged(r)}}return this},doAddToSelection:function(e){var i=[],n=Kekule.ArrayUtils.toArray(e);if(n&&n.length){this.getEnableMultiSelect()||this.clearSelection();for(var o=this.getSelection(),a=0,s=n.length;a<s;++a){var l=n[a];this.isItemSelected(l)||(t.addClass(this.getBelongedChildItem(l),r.STATE_SELECTED),o.splice(o.length-1,0,l),i.push(l))}}return i},toggleSelectionState:function(e){if(e){this.beginUpdate();try{var t=Kekule.ArrayUtils.toArray(e);this.getSelection();if(t&&t.length)for(var r=0,i=t.length;r<i;++r){var n=t[r];this.isItemSelected(n)?this.removeFromSelection(n):this.addToSelection(n)}}finally{this.endUpdate()}}},select:function(e){this.beginUpdate();try{if(this.getSelection().length&&this.clearSelection(),e){var t=Kekule.ArrayUtils.toArray(e),r=this.getEnableMultiSelect()?t:t[t.length-1];this.addToSelection(r)}}finally{this.endUpdate()}},react_click:function(e){if(this.getEnableSelect()){var t=e.getTarget(),r=this.getBelongedChildItem(t);if(r)if(this.getEnableMultiSelect())if(e.getShiftKey()){var i=this.getSelectedItem();if(i){var n=this.getChildItemElemRange(i,r);n.length&&(e.getCtrlKey()?this.addToSelection(n):this.select(n))}else this.select(r)}else e.getCtrlKey()?this.toggleSelectionState(r):r&&(this.getEnableSelectInSelection()&&this.isItemSelected(r)?this.setSelectedItem(r):this.select(r));else this.select(r);else this.select(null)}return this.tryApplySuper("react_click",[e])}})}(),function(){"use strict";var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.StyleUtils),r=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DIALOG:"K-Dialog",DIALOG_INSIDE:"K-Dialog-Inside",DIALOG_OVERFLOW:"K-Dialog-Overflow",DIALOG_CLIENT:"K-Dialog-Client",DIALOG_CAPTION:"K-Dialog-Caption",DIALOG_BTN_PANEL:"K-Dialog-Button-Panel"}),Kekule.Widget.DialogButtons={OK:"ok",CANCEL:"cancel",YES:"yes",NO:"no",isPositive:function(e){var t=Kekule.Widget.DialogButtons;return[t.OK,t.YES].indexOf(e)>=0},isNegative:function(e){var t=Kekule.Widget.DialogButtons;return[t.CANCEL,t.NO].indexOf(e)>=0}},Kekule.Widget.Location={DEFAULT:1,CENTER:2,FULLFILL:3,CENTER_OR_FULLFILL:4},Kekule.Widget.Dialog=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Dialog",BINDABLE_TAG_NAMES:["div","span"],BTN_NAME_FIELD:"__$btnName__",initialize:function(e,t,r){this._dialogCallback=null,this._modalInfo=null,this._childButtons=[],this.setPropStoreFieldValue("location",Kekule.Widget.Location.CENTER),this.tryApplySuper("initialize",[e]),this._dialogOpened=!1,this.setUseCornerDecoration(!0),t&&this.setCaption(t),r&&this.setButtons(r),this.setDisplayed(!1)},doFinalize:function(){this.getModalInfo()&&this.getGlobalManager().unprepareModalWidget(this),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return e.getElementText(this.getCaptionElem())},setter:function(r){e.setElementText(this.getCaptionElem(),r),t.setDisplay(this.getCaptionElem(),!!r)}}),this.defineProp("buttons",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("buttons",e),this.getBtnPanelElem()&&t.setDisplay(this.getBtnPanelElem(),e&&e.length),this.buttonsChanged()}}),this.defineProp("autoFocusedObject",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("result",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("location",{dataType:DataType.INT}),this.defineProp("clientElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("btnPanelElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMovable&&this.setMovable(!0)},getDefaultMovingGripper:function(){return this.getCaptionElem()},getCoreElement:function(){return this.getClientElem()},doGetWidgetClassName:function(){return r.DIALOG},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var i,n=[];return(i=e.createElement("div")).className=r.DIALOG_CAPTION,t.appendChild(i),this.setPropStoreFieldValue("captionElem",i),n.push(i),this.setMovingGripper&&this.setMovingGripper(i),(i=e.createElement("div")).className=r.DIALOG_CLIENT,t.appendChild(i),this.setPropStoreFieldValue("clientElem",i),this.doCreateClientContents(i),n.push(i),(i=e.createElement("div")).className=r.DIALOG_BTN_PANEL,t.appendChild(i),this.setPropStoreFieldValue("btnPanelElem",i),n.push(i),this.buttonsChanged(),n},doCreateClientContents:function(e){},buttonsChanged:function(){for(var e=this._childButtons.length-1;e>=0;--e){this._childButtons[e].finalize()}for(var t=this.getButtons()||[],r=(e=0,t.length);e<r;++e)this.createDialogButton(t[e])},createDialogButton:function(e,t,r,i){var n=this._getPredefinedButtonInfo(e);if(n||(n={text:e}),n){var o=new Kekule.Widget.Button(this,n.text);o[this.BTN_NAME_FIELD]=e,o.addEventListener("execute",this._reactDialogBtnExec,this),o.appendToElem(this.getBtnPanelElem()),o.__$name__=e;var a=t||this._getDialogButtonResName(e);return a&&o.linkStyleResource(a),this._childButtons.push(o),o}return null},_getDialogButtonResName:function(e){var t=Kekule.Widget.DialogButtons;return[t.OK,t.YES].indexOf(e)>=0?Kekule.Widget.StyleResourceNames.BUTTON_YES_OK:[t.CANCEL,t.NO].indexOf(e)>=0?Kekule.Widget.StyleResourceNames.BUTTON_NO_CANCEL:null},_reactDialogBtnExec:function(e){var t=Kekule.Widget.DialogButtons,r=[t.OK,t.YES,t.CANCEL,t.NO],i=e.target;if(i){var n=i.__$name__;r.indexOf(n)>=0&&(this.setResult(n),this.close(n))}},_getPredefinedButtonInfo:function(e){var t=Kekule.Widget.DialogButtons,r=[t.OK,t.CANCEL,t.YES,t.NO],i=[Kekule.$L("WidgetTexts.CAPTION_OK"),Kekule.$L("WidgetTexts.CAPTION_CANCEL"),Kekule.$L("WidgetTexts.CAPTION_YES"),Kekule.$L("WidgetTexts.CAPTION_NO")],n=r.indexOf(e);return n>=0?{text:i[n]}:null},getDialogButton:function(e){for(var t=this._childButtons.length-1;t>=0;--t){var r=this._childButtons[t];if(r[this.BTN_NAME_FIELD]===e)return r}return null},needAdjustPosition:function(){return this.getShowHideType()!==Kekule.Widget.ShowHideType.DROPDOWN},_storePositionInfo:function(){if(this.needAdjustPosition()){var e=this.getElement().style;this._posInfo={left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,position:e.position}}},_restorePositionInfo:function(){if(this.needAdjustPosition()){var e=this.getElement();if(e){var t=e.style,r=this._posInfo;r&&(t.left=r.left,t.top=r.top,t.right=r.right,t.bottom=r.bottom,t.width=r.width,t.height=r.height,t.position=r.position)}}},adjustLocation:function(){if(this.needAdjustPosition()){this._storePositionInfo();var e=Kekule.Widget.Location,t=this.getLocation()||e.DEFAULT,i=!1;if(t!==e.DEFAULT){var n,o,a,s,l,u,d=this.getDisplayed(),c=this.getVisible();try{this.setDisplayed(!0,!0),this.setVisible(!0,!0);var h=Kekule.DocumentUtils.getInnerClientDimension(this.getDocument()),p=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),!0),g=p.right-p.left,f=p.bottom-p.top,C=this.getOffsetParent();C&&Kekule.HtmlElementUtils.getElemPageRect(C,!0);i=g>=h.width||f>=h.height}finally{this.setVisible(c,!0),this.setDisplayed(d,!0)}if(t===e.CENTER_OR_FULLFILL)if(i){Kekule.DocumentUtils.getClientVisibleBox(this.getDocument());g>=h.width?(n=0,l=0):n=(h.width-g)/2,f>=h.height?(o=0,u=0):o=(h.height-f)/2}else t=e.CENTER;if(t===e.FULLFILL?(n=0,o=0,l=0,u=0):t===e.CENTER&&(n=(h.width-g)/2,o=(h.height-f)/2),i){this.removeClassName(r.DIALOG_INSIDE),this.addClassName(r.DIALOG_OVERFLOW);var m=Kekule.DocumentUtils.getScrollPosition(this.getDocument());(n+=m.left)<0&&(n=0),(o+=m.top)<0&&(o=0)}else this.removeClassName(r.DIALOG_OVERFLOW),this.addClassName(r.DIALOG_INSIDE);var T=this.getElement().style,E=Kekule.ObjUtils.notUnset;E(n)&&(T.left=n+"px"),E(o)&&(T.top=o+"px"),E(l)&&(T.right=l+"px"),E(u)&&(T.bottom=l+"px"),E(a)&&(T.width=a+"px"),E(s)&&(T.height=s+"px"),this.adjustClientSize(a,s,i)}this._posAdjusted=!0}},adjustClientSize:function(e,t,r){},prepareShow:function(e,t){var r=this.getElement();if(!r.parentNode){var i=this.getGlobalManager();(t?i.getContextRootElementOfCaller(t):r.ownerDocument.body).appendChild(r)}var n=this;setTimeout(function(){n._dialogCallback=e},0)},openModal:function(e,t){return this.getGlobalManager().prepareModalWidget(this,t),this.open(e,t)},openPopup:function(e,t){return this.open(e,t,Kekule.Widget.ShowHideType.POPUP)},open:function(e,t,r){this.prepareShow(e,t),this.show(t,null,r||Kekule.Widget.ShowHideType.DIALOG);var i=this;return function(){var e=i.getAutoFocusedObject();e&&"function"==typeof e.focus&&e.focus()}.defer(),this._dialogOpened=!0,this},close:function(e){this.setResult(e),this.hide()},isPositiveResult:function(e){return Kekule.Widget.DialogButtons.isPositive(e||this.getResult())},isNegativeResult:function(e){return Kekule.Widget.DialogButtons.isNegative(e||this.getResult())},widgetShowStateBeforeChanging:function(e){this.tryApplySuper("widgetShowStateBeforeChanging",[e]),e&&(this.adjustLocation(),this.setResult(null))},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),e||this._dialogCallback&&(this._dialogCallback(this.getResult()),this._dialogCallback=null)},widgetShowStateDone:function(e){this.tryApplySuper("widgetShowStateDone",[e]),!e&&this._dialogOpened&&(this.getModalInfo()&&this.getGlobalManager().unprepareModalWidget(this),this.isShown()||this._restorePositionInfo(),this._dialogOpened=!1)}})}(),function(){"use strict";var e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MSGPANEL:"K-MsgPanel",MSGPANEL_CONTENT:"K-MsgPanel-Content",MSGGROUP:"K-MsgGroup",MSGGROUP_FOR_WIDGET:"K-Widget-MsgGroup",MSG_NORMAL:"K-Msg-Normal",MSG_INFO:"K-Msg-Info",MSG_WARNING:"K-Msg-Warning",MSG_ERROR:"K-Msg-Error"}),Kekule.Widget.MsgType={NORMAL:"",INFO:"info",WARNING:"warning",ERROR:"error"},Kekule.Widget.MsgPanel=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.MsgPanel",BINDABLE_TAG_NAMES:["span","div"],initialize:function(e,t,r){this._contentElem=null,this._elemTextPart=null,this._elemLeadingGlyphPart=null,this._elemTailingGlyphPart=null,this.setPropStoreFieldValue("showText",!0),this.tryApplySuper("initialize",[e]),t&&this.setText(t),r&&this.setMsgType(r),this.setUseCornerDecoration(!0)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(e){this.changeContentText(e)}}),this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showLeadingGlyph",e),this._elemLeadingGlyphPart.style.display=e?"":"none"}}),this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showTailingGlyph",e),this._elemTailingGlyphPart.style.display=e?"":"none"}}),this.defineProp("msgType",{dataType:DataType.STRING,setter:function(e){var t=this.getMsgType();if(t!==e){var r=this.getClassNameForMsgType(t),i=this.getClassNameForMsgType(e);r!==i&&(this.removeClassName(r),this.addClassName(i)),this.setPropStoreFieldValue("msgType",e)}}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MSGPANEL},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(r,i){var n=this.tryApplySuper("doCreateSubElements",[r,i])||[],o=e.getInnerText(i);i.innerHTML="";var a=r.createElement("span");return a.className=t.MSGPANEL_CONTENT,i.appendChild(a),this._contentElem=a,this._elemTextPart=this.createTextContent(o,a),this._elemLeadingGlyphPart=this.createGlyphContent(a,this._elemTextPart,t.PART_PRI_GLYPH_CONTENT),this._elemTailingGlyphPart=this.createGlyphContent(a,null,t.PART_ASSOC_GLYPH_CONTENT),n.push(a),n},doSetUseCornerDecoration:function(e){this.tryApplySuper("doSetUseCornerDecoration",[e]),e?Kekule.HtmlElementUtils.addClass(this._contentElem,t.CORNER_ALL):Kekule.HtmlElementUtils.removeClass(this._contentElem,t.CORNER_ALL)},getTextSelectable:function(){return!0},changeContentText:function(e){Kekule.DomUtils.setElementText(this._elemTextPart,e||"",!0)},getClassNameForMsgType:function(e){var r=Kekule.Widget.MsgType;switch(e){case r.INFO:return t.MSG_INFO;case r.WARNING:return t.MSG_WARNING;case r.ERROR:return t.MSG_ERROR;default:return t.MSG_NORMAL}}}),Kekule.Widget.MsgGroup=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.MsgGroup",BINDABLE_TAG_NAMES:["span","div"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.setLayout(Kekule.Widget.Layout.VERTICAL)},initProperties:function(){this.defineProp("reversedOrder",{dataType:DataType.BOOL}),this.defineProp("maxMsgCount",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("maxMsgCount",e),this.clearExcessiveMsgs()}}),this.defineProp("msgFlashTime",{dataType:DataType.INT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMsgFlashTime(6e3)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MSGGROUP},doCreateRootElement:function(e){return e.createElement("div")},addMessage:function(e,t,r,i){if(e||t){var n=new Kekule.Widget.MsgPanel(this,e,t);n.setFinalizeAfterHiding(!0),i&&n.addClassName(i),this.getReversedOrder()?n.insertToWidget(this,this.getChildAt(0)):n.appendToWidget(this);var o=Kekule.ObjUtils.isUnset(r)?this.getMsgFlashTime():r;return o?n.flash(o,this):n.show(this),this.clearExcessiveMsgs(),n}},clearExcessiveMsgs:function(){var e=this.getMaxMsgCount();if(e&&e>0){var t=this.getChildWidgets().length-e;if(t>0){var r,i=0,n=this,o=function(){i<t&&(r=n.getOldestMsgPanel(),n.hideMsgPanel(r,o),++i)};o()}}},getOldestMsgPanel:function(){return this.getReversedOrder()?this.getLastChild():this.getFirstChild()},hideMsgPanel:function(e,t){return e.hide(this,t),e}}),ClassEx.defineProp(Kekule.Widget.BaseWidget,"msgReporter",{dataType:"Kekule.Widget.MsgGroup",serializable:!1,setter:null,getter:function(e){var r=this.getPropStoreFieldValue("msgReporter");return!r&&e&&((r=new Kekule.Widget.MsgGroup(this)).addClassName(t.MSGGROUP_FOR_WIDGET),r.appendToWidget(this),this.setPropStoreFieldValue("msgReporter",r)),r}}),ClassEx.extend(Kekule.Widget.BaseWidget,{reportMessage:function(e,t,r,i){var n=this.getMsgReporter(!0),o=n.addMessage(e,t,r||0,i);return n.setDisplayed(!0),o},flashMessage:function(e,t,r,i){return this.reportMessage(e,t,r||this.getMsgReporter(!0).getMsgFlashTime(),i)},removeMessage:function(e){e.hide()}})}(),function(){"use strict";Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames,t=Kekule.ArrayUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TABVIEW:"K-TabView",TABVIEW_TABBUTTON:"K-TabView-TabButton",TABVIEW_CLIENT:"K-TabView-Client",TABVIEW_PAGE:"K-TabView-Page",TABVIEW_ACTIVE_PAGE:"K-TabView-Active-Page",TABVIEW_TABBUTTON_CONTAINER:"K-TabView-TabButton-Container",TABVIEW_PAGE_CONTAINER:"K-TabView-Page-Container",TABBUTTONGROUP:"K-TabButtonGroup",TAB_AT_LEFT:"K-TabAtLeft",TAB_AT_RIGHT:"K-TabAtRight",TAB_AT_TOP:"K-TabAtTop",TAB_AT_BOTTOM:"K-TabAtBottom"}),Kekule.Widget.TabPage=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.TabPage",initProperties:function(){this.defineProp("text",{dataType:DataType.STRING}),this.defineProp("active",{dataType:DataType.STRING,getter:function(){var e=this.getTabView();return e?e.getActiveTabPage()===this:this.getPropStoreFieldValue("active")},setter:function(e){this.setPropStoreFieldValue("active",e);var t=this.getTabView();t&&e&&t.setActiveTabPage(this)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TABVIEW_PAGE},doCreateRootElement:function(e){return e.createElement("div")},getTabView:function(){var e=this.getParent();return e instanceof Kekule.Widget.TabView?e:null}}),Kekule.Widget.TabButtonGroup=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.TabButtonGroup",initialize:function(e){this.tryApplySuper("initialize",[e]),this.addEventListener("execute",function(e){var t=e.target;t instanceof Kekule.Widget.RadioButton&&this.invokeEvent("switch",{button:t})},this),this.tabButtonPosChanged()},initProperties:function(){this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(e){this.getTabButtonPosition()!==e&&(this.setPropStoreFieldValue("tabButtonPosition",e),this.tabButtonPosChanged())}}),this.defineProp("activeTabIndex",{dataType:DataType.INT,getter:function(){for(var e=this.getTabButtons(),t=0,r=e.length;t<r;++t)if(e[t].getChecked())return t;return-1},setter:function(e){for(var t=this.getTabButtons(),r=0,i=t.length;r<i;++r)t[r].setChecked(r===e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!1)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TABBUTTONGROUP},getTabButtons:function(){for(var e=[],t=this.getChildWidgets(),r=0,i=t.length;r<i;++r){var n=t[r];n instanceof Kekule.Widget.RadioButton&&e.push(n)}return e},tabButtonPosChanged:function(){var t=Kekule.Widget.Position,r=this.getTabButtonPosition(),i=r&t.LEFT||r&t.RIGHT,n=r&t.RIGHT?e.TAB_AT_RIGHT:r&t.BOTTOM?e.TAB_AT_BOTTOM:r&t.LEFT?e.TAB_AT_LEFT:e.TAB_AT_TOP;this._lastTabBtnPosClassName&&this.removeClassName(this._lastTabBtnPosClassName),this._lastTabBtnPosClassName=n,this.addClassName(this._lastTabBtnPosClassName),this.setLayout(i?Kekule.Widget.Layout.VERTICAL:Kekule.Widget.Layout.HORIZONTAL)}}),Kekule.Widget.TabView=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.TabView",TAB_BTN_FIELD:"__$tabButton__",initialize:function(e){this._tabBtnContainer=null,this._pageContainer=null,this.tryApplySuper("initialize",[e]),Kekule.ObjUtils.isUnset(this.getUseCornerDecoration())&&this.setUseCornerDecoration(!0),this.tabButtonPosChanged(),this.addEventListener("change",this.reactTabPagePropChange,this)},doFinalize:function(){this.getTabGroup()&&this.getTabGroup().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("tabPages",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("tabPages");return e||(e=[],this.setPropStoreFieldValue("tabPages",e)),e},setter:null}),this.defineProp("activeTabPage",{dataType:"Kekule.Widget.TabPage",serializable:!1,setter:function(t){var r=this.getActiveTabPage();r!==t&&this.hasChild(t)&&(this.setPropStoreFieldValue("activeTabPage",t),r&&(r.removeClassName(e.TABVIEW_ACTIVE_PAGE),this._getPageTabButton(r).setChecked(!1)),t&&(t.addClassName(e.TABVIEW_ACTIVE_PAGE),this._getPageTabButton(t).setChecked(!0),this.invokeEvent("switchTab",{tabPage:t})))}}),this.defineProp("activeTabIndex",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getTabPages().indexOf(this.getActiveTabPage())},setter:function(e){var t=this.getTabPages()[e];t&&this.setActiveTabPage(t)}}),this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(e){this.getTabButtonPosition()!==e&&(this.setPropStoreFieldValue("tabButtonPosition",e),this.tabButtonPosChanged())}}),this.defineProp("showTabButtons",{dataType:DataType.BOOL,getter:function(){var e=this.getTabGroup();return e&&e.getDisplayed()},setter:function(e){var t=this.getTabGroup();t&&t.setDisplayed(e)}}),this.defineProp("tabGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TABVIEW},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(t,r){var i=t.createElement("div");i.className=e.TABVIEW_TABBUTTON_CONTAINER;var n=this.doCreateContainerElement(t,null,"div");return n.className=e.TABVIEW_PAGE_CONTAINER,this._tabBtnContainer=i,this._pageContainer=n,r.appendChild(i),r.appendChild(n),this.setPropStoreFieldValue("tabGroup",this.doCreateTabbar(t,i)),[i,n]},doCreateTabbar:function(e,t){var r=new Kekule.Widget.TabButtonGroup(e);return r.setParent(this),r.appendToElem(t),r.addEventListener("switch",function(e){var t=e.button,r=this._getPageOfTabButton(t);r&&this.setActiveTabPage(r)},this),r},getChildrenHolderElement:function(){return this._pageContainer},getContainerElement:function(){return this._pageContainer},_getPageTabButton:function(e){return e[this.TAB_BTN_FIELD]},_setPageTabButton:function(e,t){e[this.TAB_BTN_FIELD]=t},_getPageOfTabButton:function(e){for(var t=this.getTabPages(),r=0,i=t.length;r<i;++r){var n=t[r];if(this._getPageTabButton(n)===e)return n}return null},childWidgetAdded:function(e){if(this.tryApplySuper("childWidgetAdded",[e]),e instanceof Kekule.Widget.TabPage){var t=!this.getTabPages().length;e.appendToElem(this._pageContainer),this.getTabPages().push(e),this._insertTabButtonBefore(e),(t||e.getActive())&&this.setActiveTabPage(e)}},childWidgetRemoved:function(e){this.tryApplySuper("childWidgetRemoved",[e]),e instanceof Kekule.Widget.TabPage&&(t.remove(this.getTabPages(),e),this._removeTabButton(e))},childWidgetMoved:function(e,t){this.tryApplySuper("childWidgetMoved",[e,t]),e instanceof Kekule.Widget.TabPage&&this._changeTabIndex(e,t)},_insertTabButtonBefore:function(e,t){var r=this.getTabGroup(),i=new Kekule.Widget.RadioButton(this.getDocument());this._updateTabButton(e,i),this._setPageTabButton(e,i),t?i.insertToWidget(r,t):i.appendToWidget(r)},_updateTabButton:function(e,t){t||(t=this._getPageTabButton(e)),t.setText(e.getText()||""),e.getHint()&&t.setHint(e.getHint())},_removeTabButton:function(e){var t=this._getPageTabButton(e);t&&t.finalize()},_changeTabIndex:function(e,r){var i=this._getPageTabButton(e);this.getTabGroup()._moveChild(i,r);var n=this.getTabPages(),o=n.indexOf(e);o>=0&&o!==r&&t.changeItemIndex(n,e,r)},reactTabPagePropChange:function(e){var t=e.target;if(t instanceof Kekule.Widget.TabPage){var r=this._getPageTabButton(t);r&&this._updateTabButton(t,r)}},tabButtonPosChanged:function(){var t=Kekule.Widget.Position,r=this.getTabButtonPosition(),i=r&t.BOTTOM||r&t.RIGHT,n=(r&t.LEFT||t.RIGHT,r&t.RIGHT?e.TAB_AT_RIGHT:r&t.BOTTOM?e.TAB_AT_BOTTOM:r&t.LEFT?e.TAB_AT_LEFT:e.TAB_AT_TOP);this._lastTabBtnPosClassName&&this.removeClassName(this._lastTabBtnPosClassName),this._lastTabBtnPosClassName=n,this.addClassName(this._lastTabBtnPosClassName),this.getTabGroup().setTabButtonPosition(r),i?this.getElement().appendChild(this._tabBtnContainer):this.getElement().insertBefore(this._tabBtnContainer,this._pageContainer)},createNewTabPage:function(e,t,r){var i=this.getDocument(),n=new Kekule.Widget.TabPage(i);if(n.setText(e),t&&n.setHint(t),n.appendToWidget(this),r){var o=this.getChildWidgets().indexOf(r);this._moveChild(n,o)}return n}})}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,r=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{VALUELISTEDITOR:"K-ValueListEditor",VALUELISTEDITOR_ROW:"K-ValueListEditor-Row",VALUELISTEDITOR_CELL:"K-ValueListEditor-Cell",VALUELISTEDITOR_INDICATORCELL:"K-ValueListEditor-IndicatorCell",VALUELISTEDITOR_KEYCELL:"K-ValueListEditor-KeyCell",VALUELISTEDITOR_VALUECELL:"K-ValueListEditor-ValueCell",VALUELISTEDITOR_CELL_CONTENT:"K-ValueListEditor-CellContent",VALUELISTEDITOR_VALUECELL_TEXT:"K-ValueListEditor-ValueCellText",VALUELISTEDITOR_INLINE_EDIT:"K-ValueListEditor-InlineEdit",VALUELISTEDITOR_EXPANDMARK:"K-ValueListEditor-ExpandMark",VALUELISTEDITOR_ACTIVE_ROW:"K-ValueListEditor-ActiveRow"}),Kekule.Widget.ValueListEditor=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ValueListEditor",BINDABLE_TAG_NAMES:["table"],ROW_ELEM_TAG:"tr",CELL_ELEM_TAG:"td",ROW_DATA_FIELD:"__$row_data__",ROW_EDIT_INFO_FIELD:"__$row_edit_info__",initialize:function(e){this.tryApplySuper("initialize",[e]),this._inlineEdit=null,this._isActivitingRow=!1},initProperties:function(){this.defineProp("hash",{dataType:DataType.HASH,getter:function(){return this._getTotalHash()},setter:function(e){this._setTotalHash(e),this.setPropStoreFieldValue("hash",e)}}),this.defineProp("readOnly",{dataType:DataType.BOOL}),this.defineProp("useKeyHint",{dataType:DataType.BOOL}),this.defineProp("valueDisplayMode",{dataType:DataType.INT,enumSource:Kekule.Widget.ValueListEditor.ValueDisplayMode,setter:function(e){this.getValueDisplayMode()!==e&&(this.setPropStoreFieldValue("valueDisplayMode",e),this.valueDisplayModeChanged())}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var i=this.getActiveRow();i!==e&&(i&&(this.finishEditing(),t.removeClass(i,r.VALUELISTEDITOR_ACTIVE_ROW),this._showValueCellText(i)),this._inlineEdit&&this._inlineEdit.finalize(),e&&(t.addClass(e,r.VALUELISTEDITOR_ACTIVE_ROW),this.createValueEditWidget(e)),this.setPropStoreFieldValue("activeRow",e),this.invokeEvent("activeRowChange",{row:e}))}})},doGetWidgetClassName:function(){return r.VALUELISTEDITOR},doCreateRootElement:function(e){return e.createElement("table")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e])},getRootElem:function(){return this.getElement()},createRowElem:function(e){var i=e.createElement(this.ROW_ELEM_TAG);return t.addClass(i,r.VALUELISTEDITOR_ROW),i},createCellElem:function(e){var i=e.createElement(this.CELL_ELEM_TAG);return t.addClass(i,r.VALUELISTEDITOR_CELL),i},createIndicatorCellElem:function(e){var i=this.createCellElem(e);t.addClass(i,r.VALUELISTEDITOR_INDICATORCELL);var n=e.createElement("span");return i.appendChild(n),i},createKeyCellElem:function(e){var i=this.createCellElem(e);return t.addClass(i,r.VALUELISTEDITOR_KEYCELL),i},createValueCellElem:function(e){var i=this.createCellElem(e);return t.addClass(i,r.VALUELISTEDITOR_VALUECELL),i},createValueEditWidget:function(e){var i=null;if(e===this.getActiveRow()?i=this._inlineEdit:this._inlineEdit&&(this._inlineEdit.finalize(),this._inlineEdit=null),!i){(i=this.getReadOnly()?this.doCreateReadOnlyValueEditWidget(e):this.doCreateValueEditWidget(e)).setBubbleUiEvents(!0),t.addClass(i.getElement(),r.VALUELISTEDITOR_INLINE_EDIT);var n=this.getValueCell(e),o=this.getCellContentWrapper(n,!0);i.appendToElem(o)}return i&&(i.focus&&i.focus(),i.selectAll&&i.selectAll(),this._inlineEdit=i,this._hideValueCellText(e)),i},doCreateValueEditWidget:function(e){var t=this.getValueEditWidgetInfo(e);return this._doCreateValueEditWidgetByWidgetInfo(e,t)},doCreateDefaultValueEditWidget:function(e){return this._doCreateValueEditWidgetByWidgetInfo(e,this.getDefaultValueEditWidgetInfo())},doCreateReadOnlyValueEditWidget:function(e){var t=this._doCreateValueEditWidgetByWidgetInfo(e,this.getReadOnlyValueEditWidgetInfo());return t.setReadOnly&&t.setReadOnly(!0),t},_doCreateValueEditWidgetByWidgetInfo:function(e,t){var r=this.getRowData(e),i=this.getValueCellText(e,r),n=new(0,t.widgetClass)(this);return t.propValues&&n.setPropValues(t.propValues),n.setValue(i),n},getDefaultValueEditWidgetInfo:function(){return{widgetClass:Kekule.Widget.TextBox}},getReadOnlyValueEditWidgetInfo:function(){return{widgetClass:Kekule.Widget.TextBox}},getValueEditWidgetInfo:function(e){return this.getRowEditInfo(e)||this.getDefaultValueEditWidgetInfo()},getRowElems:function(){return this.getRootElem()?e.getDirectChildElems(this.getRootElem(),this.ROW_ELEM_TAG):[]},getRows:function(){return this.getRowElems()},getRowCount:function(){var e=this.getRowElems();return e?e.length:0},getRowAt:function(e){var t=this.getRowElems();return t?t[e]:null},getPrevRow:function(e){for(var t=this.ROW_ELEM_TAG.toLowerCase(),r=e.previousSibling;r&&(r.nodeType!==Node.ELEMENT_NODE||r.tagName.toLowerCase()!==t);)r=r.previousSibling;return r},getNextRow:function(e){for(var t=this.ROW_ELEM_TAG.toLowerCase(),r=e.nextSibling;r&&(r.nodeType!==Node.ELEMENT_NODE||r.tagName.toLowerCase()!==t);)r=r.nextSibling;return r},getKeyCell:function(t){return e.getDirectChildElems(t,this.CELL_ELEM_TAG)[1]},getCellContentWrapper:function(i,n){var o=e.getDirectChildElems(i),a=o?o[0]:null;return!a&&n&&(a=i.ownerDocument.createElement("span"),i.appendChild(a),t.addClass(a,r.VALUELISTEDITOR_CELL_CONTENT)),a},getValueCellTextWrapper:function(e,i){var n=null,o=this.getCellContentWrapper(e,i);if(o){var a=o.getElementsByTagName("span");!(n=a?a[0]:null)&&i&&(n=e.ownerDocument.createElement("span"),o.appendChild(n),t.addClass(n,r.VALUELISTEDITOR_VALUECELL_TEXT))}return n},_hideValueCellText:function(e){var t=this.getValueCellTextWrapper(this.getValueCell(e));t&&(t.style.visibility="hidden")},_showValueCellText:function(e){var t=this.getValueCellTextWrapper(this.getValueCell(e));t&&(t.style.visibility="visible")},getValueCell:function(t){return e.getDirectChildElems(t,this.CELL_ELEM_TAG)[2]},getParentCell:function(t){return e.getNearestAncestorByTagName(t,this.CELL_ELEM_TAG,!0)},getParentRow:function(t){return e.getNearestAncestorByTagName(t,this.ROW_ELEM_TAG,!0)},_createNewRow:function(e){var t=this.getDocument(),r=this.createRowElem(t);if(r){var i=this.createIndicatorCellElem(t);r.appendChild(i);var n=this.createKeyCellElem(t);r.appendChild(n);var o=this.createValueCellElem(t);r.appendChild(o),e&&this.setRowData(r,e)}return r},insertRowBefore:function(e,t){var r=this._createNewRow(e);return r&&this.getRootElem().insertBefore(r,t||null),r},appendRow:function(e){return this.insertRowBefore(e,null)},removeRow:function(e){return e===this.getActiveRow()&&this.setActiveRow(null),this.getRootElem().removeChild(e),this},removeRowAt:function(e){var t=this.getRowAt(e);return t&&this.removeRow(t),this},clear:function(){this.setActiveRow(null),this.getRootElem()&&Kekule.DomUtils.clearChildContent(this.getRootElem())},updateAll:function(){for(var e=this.getRowElems(),t=0,r=e.length;t<r;++t){var i=e[t],n=this.getRowData(i);this.setRowData(i,n)}return this},valueDisplayModeChanged:function(){this.updateAll()},getKeyCellText:function(e,t){return t.title||t.key},getKeyCellHint:function(e,t){return t.hint||this.getKeyCellText(e,t)},getValueCellText:function(e,t){return this.getValueDisplayMode()===i.JSON?JSON.stringify(t.value):""+t.value},valueCellTextToValue:function(e,t,r){return this.getValueDisplayMode()===i.JSON?JSON.parse(e):e},setValueCellText:function(e,t){var r=this.getRowData(t),i=this.valueCellTextToValue(e,t,r);return r.value=i,this.setRowData(t,r),this},getRowData:function(e){return e[this.ROW_DATA_FIELD]},setRowData:function(e,t){e[this.ROW_DATA_FIELD]=t,this.setRowKeyCellContent(e,this.getKeyCellText(e,t),this.getKeyCellHint(e,t)),this.setRowValueCellContent(e,this.getValueCellText(e,t)),e===this.getActiveRow()&&this._inlineEdit&&this.createValueEditWidget(e)},setRowKeyCellContent:function(e,t,r){var i=this.getKeyCell(e),n=this.getCellContentWrapper(i,!0);n.innerHTML=t,this.getUseKeyHint()&&(n.title=r)},setRowValueCellContent:function(e,t){var r=this.getValueCell(e),i=this.getValueCellTextWrapper(r,!0),n=t;""===n?i.innerHTML="&nbsp;":Kekule.DomUtils.setElementText(i,n)},getRowEditInfo:function(e){return e[this.ROW_EDIT_INFO_FIELD]},setRowEditInfo:function(e,t){e[this.ROW_EDIT_INFO_FIELD]=t,e===this.getActiveRow()&&(this.setActiveRow(null),this.setActiveRow(e))},editRow:function(e){this.setActiveRow(e)},finishEditing:function(){var e=this.getActiveRow();return e&&this._inlineEdit&&(this.setValueCellText(this._inlineEdit.getValue(),e),this.invokeEvent("editFinish",{row:e})),this},cancelEditing:function(){var e=this.getActiveRow();if(e&&this._inlineEdit){var t=this.getRowData(e);this.setRowData(e,t),this.invokeEvent("editCancel",{row:e})}return this},_getTotalHash:function(){for(var e={},t=this.getRowElems(),r=0,i=t.length;r<i;++r){var n=t[r],o=this.getRowData(n);o&&(e[o.key]=o.value)}return e},_setTotalHash:function(e){for(var t=this.getRowElems(),r=t.length,i=Kekule.ObjUtils.getOwnedFieldNames(e),n=i.length,o=0;o<n;++o){var a,s=i[o],l=e[s];o<r?(a=this.getRowAt(o),this.setRowData(a,{key:s,value:l})):a=this.appendRow({key:s,value:l})}if(r>n)for(o=r-1;o>=n;--o)this.removeRow(t[o]);var u=this.getActiveRow();return u&&(this.setActiveRow(null),this.setActiveRow(u)),this},react_click:function(e){var t=e.getTarget(),r=this.getParentRow(t);r&&this.setActiveRow(r)},react_keydown:function(e){var t=e.getKeyCode();if(!(e.getAltKey()||e.getShiftKey()||e.getCtrlKey())){var r,i=this.getActiveRow();if(i)t===Kekule.X.Event.KeyCode.UP?r=this.getPrevRow(i):t===Kekule.X.Event.KeyCode.DOWN&&(r=this.getNextRow(i)),r&&this.setActiveRow(r)}},react_keyup:function(e){var t=e.getKeyCode();t===Kekule.X.Event.KeyCode.ESC?this.cancelEditing():t===Kekule.X.Event.KeyCode.ENTER&&this.finishEditing()},react_blur:function(e){}}),Kekule.Widget.ValueListEditor.ValueDisplayMode={SIMPLE:0,JSON:1};var i=Kekule.Widget.ValueListEditor.ValueDisplayMode}(),function(){"use strict";Kekule.DomUtils,Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{COLORPICKER:"K-ColorPicker",COLORPICKER_HEADER:"K-ColorPicker-Header",COLORPICKER_SPEC_COLOR_PALETTE:"K-ColorPicker-Spec-Color-Palette",COLORPICKER_HEXBOX:"K-ColorPicker-HexBox",COLORPICKER_PREVIEWER:"K-ColorPicker-Previewer",COLORPICKER_INPUT:"K-ColorPicker-Input",COLORPICKER_BROWSE_BTN:"K-ColorPicker-Browse-Btn",COLORPICKER_PALETTE:"K-ColorPicker-Palette",COLORPICKER_PALETTE_LINE:"K-ColorPicker-Palette-Line",COLORPICKER_PALETTE_CELL:"K-ColorPicker-Palette-Cell",COLORPICKER_PALETTE_CELL_TRANSPARENT:"K-ColorPicker-Palette-Cell-Transparent",COLORPICKER_SPEC_COLOR_UNSET:"K-Color-Unset",COLORPICKER_SPEC_COLOR_DEFAULT:"K-Color-Default",COLORPICKER_SPEC_COLOR_MIXED:"K-Color-Mixed",COLORPICKER_SPEC_COLOR_TRANSPARENT:"K-Color-Transparent",COLORDROPTEXTBOX:"K-ColorDropTextBox",COLORDROPBUTTON:"K-ColorDropButton",COLORPREVIEWER:"K-ColorPreviewer"}),Kekule.Widget.ColorPicker=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ColorPicker",COLOR_VALUE_FIELD:"__$colorValue__",COLOR_TEXT_FIELD:"__$colorText__",COLOR_CLASS_FIELD:"__ $colorClass__",BINDABLE_TAG_NAMES:["div","span"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.setUseCornerDecoration(!0),this.setValue("#000000"),this.setTouchAction("none")},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("value",e),this.getHexBox().innerHTML=e||"&nbsp;",this.getPreviewer().style.backgroundColor=e||"transparent",this.getColorInput()&&(this.getColorInput().value=e)}}),this.defineProp("colorClassName",{dataType:DataType.STRING}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e),this._recreateSpecialColorPaletteCells(this.getDocument(),this.getSpecialColorPalette())}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("hexBox",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("palette",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("previewer",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("colorInput",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("specialColorPalette",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("isPicking",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.COLORPICKER},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=[];return r.push(this.doCreateHeader(e,t)),r.push(this.doCreatePalette(e,t)),r},doCreateHeader:function(t,r){var i=t.createElement("div");i.className=e.COLORPICKER_HEADER,i.appendChild(this.doCreateSpecialColorPalette(t)),i.appendChild(this.doCreateHexBox(t)),i.appendChild(this.doCreatePreviewer(t));var n=this.doCreateColorInput(t);if(n){i.appendChild(n);var o=this.doCreateColorDialogBtn(t);o&&o.appendToElem(i)}return r.appendChild(i),i},doCreateSpecialColorPalette:function(t){var r=t.createElement("div");return r.className=e.COLORPICKER_SPEC_COLOR_PALETTE,this._recreateSpecialColorPaletteCells(t,r),this.setSpecialColorPalette(r),r},_isPredefinedSpecialColor:function(e){var t=Kekule.Widget.ColorPicker.SpecialColors;return[t.UNSET,t.DEFAULT,t.MIXED,t.TRANSPARENT].indexOf(e)>=0},_getPredefinedSpecialColorInfo:function(t){var r=Kekule.Widget.ColorPicker.SpecialColors,i=[r.UNSET,r.DEFAULT,r.MIXED,r.TRANSPARENT],n=[e.COLORPICKER_SPEC_COLOR_UNSET,e.COLORPICKER_SPEC_COLOR_DEFAULT,e.COLORPICKER_SPEC_COLOR_MIXED,e.COLORPICKER_SPEC_COLOR_TRANSPARENT],o=[Kekule.$L("WidgetTexts.S_COLOR_UNSET"),Kekule.$L("WidgetTexts.S_COLOR_DEFAULT"),Kekule.$L("WidgetTexts.S_COLOR_MIXED"),Kekule.$L("WidgetTexts.S_COLOR_TRANSPARENT")],a={value:t},s=i.indexOf(t);return s>=0&&(a.text=o[s],a.className=n[s]),a},_recreateSpecialColorPaletteCells:function(e,t){Kekule.DomUtils.clearChildContent(t);var r=this.getSpecialColors();if(r&&r.length)for(var i=0,n=r.length;i<n;++i){var o,a=r[i],s={};DataType.isObjectValue(a)?s=a:this._isPredefinedSpecialColor(a)?s=this._getPredefinedSpecialColorInfo(a):s.value=a,o=this.doCreatePaletteCell(e,s.value,s.text,s.className),s.className&&Kekule.HtmlElementUtils.addClass(o,s.className),t.appendChild(o)}},doCreateHexBox:function(t){var r=t.createElement("span");return r.className=e.COLORPICKER_HEXBOX,r.innerHTML="&nbsp",this.setHexBox(r),r},doCreatePreviewer:function(t){var r=t.createElement("span");return r.className=e.COLORPICKER_PREVIEWER,r.innerHTML="&nbsp",this.setPreviewer(r),r},doCreateColorInput:function(t){if(Kekule.BrowserFeature.html5Form.supportType("color")){var r=t.createElement("input");r.setAttribute("type","color"),r.className=e.COLORPICKER_INPUT;var i=this;return Kekule.X.Event.addListener(r,"change",function(e){var t=r.value;i.setValue(t),i.notifyColorSet()}),this.setColorInput(r),r}return null},doCreateColorDialogBtn:function(t){if(Kekule.BrowserFeature.html5Form.supportType("color")){var r=new Kekule.Widget.Button(t);return r.setText(Kekule.$L("WidgetTexts.CAPTION_BROWSE_COLOR")),r.setHint(Kekule.$L("WidgetTexts.HINT_BROWSE_COLOR")),r.setShowText(!1),r.doSetShowGlyph(!0),r.linkStyleResource(Kekule.Widget.StyleResourceNames.ICON_COLOR_PICK),r.addClassName(e.COLORPICKER_BROWSE_BTN),r.addEventListener("execute",this.openColorDialog,this),r}},doCreatePalette:function(t,r){var i=t.createElement("div");i.className=e.COLORPICKER_PALETTE;for(var n=["00","00","11","22","33","44","55","66","77","88","99","AA","BB","CC","DD","EE","FF",null],o=n.length,a=this.doCreatePaletteLine(t),s=0;s<o;s++){var l=n[s]?"#"+n[s]+n[s]+n[s]:"transparent",u=this.doCreatePaletteCell(t,l);a.appendChild(u)}i.appendChild(a);for(o=(n=["00","33","66","99","CC","FF"]).length,s=0;s<o;s++){a=this.doCreatePaletteLine(t);for(var d=0;d<o>>1;d++)for(var c=0;c<o;c++){l="#"+n[d]+n[s]+n[c],u=this.doCreatePaletteCell(t,l);a.appendChild(u)}i.appendChild(a)}for(s=0;s<o;s++){for(a=this.doCreatePaletteLine(t),d=o>>1;d<o;d++)for(c=0;c<o;c++){l="#"+n[d]+n[s]+n[c],u=this.doCreatePaletteCell(t,l);a.appendChild(u)}i.appendChild(a)}return r.appendChild(i),this.setPalette(i),i},doCreatePaletteCell:function(t,r,i,n){var o=t.createElement("span"),a=e.COLORPICKER_PALETTE_CELL;if("transparent"===r)a+=" "+e.COLORPICKER_PALETTE_CELL_TRANSPARENT;else try{o.style.backgroundColor=r}catch(e){}return o[this.COLOR_VALUE_FIELD]=r,o[this.COLOR_TEXT_FIELD]=i||r,o[this.COLOR_CLASS_FIELD]=n,o.className=a,o.title=i||r,o},doCreatePaletteLine:function(t){var r=t.createElement("div");return r.className=e.COLORPICKER_PALETTE_LINE,r},_isPaletteCellElem:function(t){return Kekule.HtmlElementUtils.hasClass(t,e.COLORPICKER_PALETTE_CELL)},openColorDialog:function(){return this.getColorInput()&&this.getColorInput().click(),this},applyColor:function(e){var t=e[this.COLOR_VALUE_FIELD];t&&this.setValue(t);var r=e[this.COLOR_TEXT_FIELD];r&&(this.getHexBox().innerHTML=r);var i=e[this.COLOR_CLASS_FIELD];this.setColorClassName(i)},notifyColorSet:function(){this.setIsDirty(!0),this.invokeEvent("valueSet",{value:this.getValue(),colorClassName:this.getColorClassName()}),this.invokeEvent("valueChange",{value:this.getValue(),colorClassName:this.getColorClassName()})},doReactActiviting:function(e){this.tryApplySuper("doReactActiviting",[e]);var t=e.getTarget();if(this._isPaletteCellElem(t))return this.setIsPicking(!0),this.applyColor(t),!0},doReactDeactiviting:function(e){if(this.getIsPicking()){this.setIsPicking(!1);var t=e.getTarget();return this._isPaletteCellElem(t)&&this.applyColor(t),this.notifyColorSet(),!0}this.tryApplySuper("doReactDeactiviting",[e])},reactPointerMoving:function(e){if(this.tryApplySuper("reactPointerMoving",[e]),this.getIsPicking()){var t=e.getTarget();if(e.getTouches()){var r={x:e.getClientX(),y:e.getClientY()},i=this.getDocument();t=i.elementFromPoint&&i.elementFromPoint(r.x,r.y)||t,e.preventDefault()}return t&&this._isPaletteCellElem(t)&&this.applyColor(t),e.preventDefault(),!0}}}),Kekule.Widget.ColorPicker.SpecialColors={UNSET:"(unset)",DEFAULT:"(default)",MIXED:"(mixed)",TRANSPARENT:"transparent"},Kekule.Widget.ColorDropTextBox=Class.create(Kekule.Widget.ButtonTextBox,{CLASS_NAME:"Kekule.Widget.ColorDropTextBox",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),this.addEventListener("buttonExecute",this.reactDropbuttonExecute,this),this.setShowPreview(!0),t&&this.setValue(t)},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(e){this.getPreviewElem().style.display=e?"inherit":""}}),this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(e){var t=this.getPreviewElem();if(t){var r=this.getColorClassName();r&&Kekule.HtmlElementUtils.removeClass(t,r),e&&Kekule.HtmlElementUtils.addClass(t,e)}this.setPropStoreFieldValue("colorClassName",e)}}),this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("colorPicker");return e||((e=new Kekule.Widget.ColorPicker(this)).setDisplayed(!1),e.getElement().style.position="absolute",e.setSpecialColors(this.getSpecialColors()),e.addEventListener("valueChange",this.reactColorPickerValueSet,this),e.appendToElem(this.getElement()),this.setPropStoreFieldValue("colorPicker",e)),e}}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var t=this.getPropStoreFieldValue("colorPicker");t&&t.setSpecialColors(e)}})},doFinalize:function(){var e=this.getPropStoreFieldValue("colorPicker");e&&e.finalize(),this.tryApplySuper("doFinalize")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.COLORDROPTEXTBOX},doCreateSubElements:function(t,r){this.tryApplySuper("doCreateSubElements",[t,r]);var i=new Kekule.Widget.DumbWidget(this);return i.addClassName(e.COLORPREVIEWER),this.setHeadingWidget(i),[i.getElement()]},getPreviewElem:function(){var e=this.getHeadingWidget();if(e)return e.getElement()},showColorPicker:function(){var e=this.getColorPicker();e.isShown()||(e.setValue(this.getValue()),e.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN))},hideColorPicker:function(){var e=this.getPropStoreFieldValue("colorPicker");e&&e.isShown()&&e.hide()},reactDropbuttonExecute:function(e){this.showColorPicker()},reactColorPickerValueSet:function(e){var t=e.value;this.setValue(t),this.setIsDirty(this.getIsDirty()||this.getColorPicker().getIsDirty()),this.setColorClassName(e.colorClassName),this.hideColorPicker(),e.stopPropagation()},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]);var t=this.getPreviewElem();t&&(t.style.backgroundColor="transparent",t.style.backgroundColor=e)}}),Kekule.Widget.ColorDropButton=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.ColorDropButton",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),this.setShowPreview(!0),t&&this.setValue(t)},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(e){try{this.getPreviewElem().style.display=e?"inherit":""}catch(e){}}}),this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getText()},setter:function(e){this.setText(e),this.updateColorPreview(e);var t=this.getPropStoreFieldValue("colorPicker");t&&t.setValue(e)}}),this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(e){var t=this.getPreviewElem();if(t){var r=this.getColorClassName();r&&Kekule.HtmlElementUtils.removeClass(t,r),e&&Kekule.HtmlElementUtils.addClass(t,e)}this.setPropStoreFieldValue("colorClassName",e)}}),this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("colorPicker");return e||((e=new Kekule.Widget.ColorPicker(this)).setDisplayed(!1),e.getElement().style.position="absolute",e.setSpecialColors(this.getSpecialColors()),e.addEventListener("valueChange",this.reactColorPickerValueSet,this),this.setPropStoreFieldValue("colorPicker",e)),e}}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var t=this.getPropStoreFieldValue("colorPicker");t&&t.setSpecialColors(e)}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getColorPicker().getIsDirty()},setter:function(e){this.getColorPicker().setIsDirty(e)}})},doFinalize:function(){var e=this.getPropStoreFieldValue("colorPicker");e&&e.finalize(),this.tryApplySuper("doFinalize")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.COLORDROPBUTTON},doGetDropDownWidget:function(){return this.getColorPicker()},getPreviewElem:function(){return this._elemLeadingGlyphPart},showColorPicker:function(){var e=this.getColorPicker();e.isShown()||(e.setValue(this.getValue()),e.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN))},hideColorPicker:function(){var e=this.getPropStoreFieldValue("colorPicker");e&&e.isShown()&&e.hide()},reactColorPickerValueSet:function(e){var t=e.value,r=e.colorClassName;this.setValue(t),this.setColorClassName(r),this.hideColorPicker(),this.invokeEvent("valueChange",{value:t}),e.stopPropagation()},updateColorPreview:function(e){var t=this.getPreviewElem();t&&(t.style.backgroundColor="transparent",t.style.backgroundColor=e)}})}(),function(){"use strict";Kekule.DomUtils,Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TEXTEDITOR:"K-TextEditor",TEXTEDITOR_TOOLBAR:"K-TextEditor-Toolbar",TEXTEDITOR_TEXTAREA:"K-TextEditor-TextArea",TEXTEDITOR_FONTBOX:"K-TextEditor-FontBox",TEXTEDITOR_BTN_FONTSIZEINC:"K-TextEditor-Btn-FontSizeInc",TEXTEDITOR_BTN_FONTSIZEDEC:"K-TextEditor-Btn-FontSizeDec",TEXTEDITOR_BTN_TEXTWRAP:"K-TextEditor-Btn-TextWrap"}),Kekule.Widget.TextEditor=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextEditor",BINDABLE_TAG_NAMES:["div","span"],DEF_TOOLBAR_COMPONENTS:["fontFamily","fontSizeInc","fontSizeDec","textWrap"],DEF_AUTOWRAP_THRESHOLD:80,initialize:function(e){this._toolCompWidgets=[],this.setPropStoreFieldValue("showToolbar",!0),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getTextArea();return e?e.getText():null},setter:function(e){var t=this.getTextArea();t&&(t.setText(e),this._checkAutoWrap())}}),this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getTextArea().getReadOnly()},setter:function(e){return this.getTextArea().setReadOnly(e)}}),this.defineProp("wrap",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getTextArea().getWrap()},setter:function(e){var t=this.getTextArea().setWrap(e);return this.updateToolButtonStates(),t}}),this.defineProp("autoWrapThreshold",{dataType:DataType.INT,setter:function(e){var t=!0===e?this.DEF_AUTOWRAP_THRESHOLD:e;this.setPropStoreFieldValue("autoWrapThreshold",t),this._checkAutoWrap()}}),this.defineProp("textArea",{dataType:"Kekule.Widget.TextArea",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var e=this.getPropStoreFieldValue("textArea");return e||(e=this.createTextArea(),this.setPropStoreFieldValue("textArea",e)),e}}),this.defineProp("toolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var e=this.getPropStoreFieldValue("toolbar");return e||this.getShowToolbar()&&(e=this.createToolbar(),this.setPropStoreFieldValue("styleToolbar",e)),e}}),this.defineProp("showToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showToolbar",e),this.getToolbar().setDisplayed(e)}}),this.defineProp("toolbarPos",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarPos",e),this.updateChildWidgetPos()}}),this.defineProp("toolbarComponents",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("toolbarComponents");return e||(e=null,this.setPropStoreFieldValue("toolbarComponents",e)),e},setter:function(e){this.setPropStoreFieldValue("toolbarComponents",e),this.recreateToolbarComponents(e)}}),this.defineProp("candidateFontFamilies",{dataType:DataType.ARRAY}),this.defineProp("fontSizeLevel",{dataType:DataType.FLOAT,setter:function(e){this.setPropStoreFieldValue("fontSizeLevel",e),this.setTextStyle({fontSize:e+"em"})}})},finalize:function(){this._finalizeSubElements(),this.tryApplySuper("finalize")},_finalizeSubElements:function(){var e=this.getTextArea();e&&e.finalize()},getCoreElement:function(){var e=this.getTextArea();return e?e.getElement():this.tryApplySuper("getCoreElement")},getChildrenHolderElement:function(){return this.getElement()},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._checkAutoWrap()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TEXTEDITOR},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.createToolbar();r&&r.appendToElem(t);var i=this.createTextArea();return i.appendToElem(t),this.updateChildWidgetPos(),[r.getElement(),i.getElement()]},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),e&&(this.updateChildWidgetPos(),this.updateToolButtonStates())},doFileDragDrop:function(e){if(e){if(Kekule.BrowserFeature.fileapi){var t=this,r=new FileReader;r.onload=function(e){var i=r.result;t.setText(i)},r.readAsText(e[0])}return!0}return this.tryApplySuper("doFileDragDrop")},createToolbar:function(){if(this.getShowToolbar()){var t=new Kekule.Widget.Toolbar(this);return this.setPropStoreFieldValue("toolbar",t),t.addClassName(e.TEXTEDITOR_TOOLBAR),this.recreateToolbarComponents(),t}return null},recreateToolbarComponents:function(e){e||(e=this.getToolbarComponents());var t=e||this.DEF_TOOLBAR_COMPONENTS,r=this.getToolbar();if(r){var i;this._toolCompWidgets.length=0,r.clearWidgets(),r.setShowText(!1),r.setShowGlyph(!0);for(var n=0,o=t.length;n<o;++n){var a=t[n];i="fontFamily"===a?this.createFontFamilyComboBox(r):this.createToolButton(r,a),this._toolCompWidgets[a]=i}this.updateToolButtonStates()}},createFontFamilyComboBox:function(t){for(var r=new Kekule.Widget.ComboBox(t),i=Kekule.Widget.FontEnumerator.getAvailableFontFamilies(this.getCandidateFontFamilies()),n=[],o=0,a=i.length;o<a;++o)n.push({text:i[o],value:i[o]});return r.setHint(Kekule.$L("WidgetTexts.HINT_CHOOSE_FONT_FAMILY")),r.addClassName(e.TEXTEDITOR_FONTBOX),r.setItems(n),r.appendToWidget(t),r.addEventListener("valueChange",function(e){this.setTextStyle({fontFamily:r.getValue()})},this),r},createToolButton:function(t,r){var i,n,o,a=new("textWrap"===r?Kekule.Widget.CheckButton:Kekule.Widget.Button)(t);return a.appendToWidget(t),"textWrap"===r?(i=Kekule.$L("WidgetTexts.CAPTION_TOGGLE_TEXTWRAP"),n=Kekule.$L("WidgetTexts.HINT_TOGGLE_TEXTWRAP"),o=e.TEXTEDITOR_BTN_TEXTWRAP,a.setChecked("off"!==this.getWrap()),a.addEventListener("checkChange",function(e){var t=a.getChecked();this.setWrap(t?"soft":"off")},this)):"fontSizeInc"===r?(i=Kekule.$L("WidgetTexts.CAPTION_INC_TEXT_SIZE"),n=Kekule.$L("WidgetTexts.HINT_INC_TEXT_SIZE"),o=e.TEXTEDITOR_BTN_FONTSIZEINC,a.addEventListener("execute",this.increaseTextSize,this)):"fontSizeDec"===r&&(i=Kekule.$L("WidgetTexts.CAPTION_DEC_TEXT_SIZE"),n=Kekule.$L("WidgetTexts.HINT_DEC_TEXT_SIZE"),o=e.TEXTEDITOR_BTN_FONTSIZEDEC,a.addEventListener("execute",this.decreaseTextSize,this)),a.setText(i),a.setHint(n),a.addClassName(o),a},createToolCheckButton:function(e,t){var r=new Kekule.Widget.CheckButton(e);return r.appendToWidget(e),r},getToolbarComponentWidget:function(e){return this._toolCompWidgets[e]},createTextArea:function(){var t=new Kekule.Widget.TextArea(this);return this.setPropStoreFieldValue("textArea",t),t.addClassName(e.TEXTEDITOR_TEXTAREA),t.addEventListener("valueChange",this._checkAutoWrap,this),t.addEventListener("valueInput",this._checkAutoWrap,this),t},updateChildWidgetPos:function(){var e=this.getToolbarPos(),t=this.getToolbar().getElement(),r=this.getTextArea().getElement(),i=t.parentNode;e===Kekule.Widget.Position.BOTTOM?i.insertBefore(r,t):i.insertBefore(t,r)},updateToolButtonStates:function(){var e=this._toolCompWidgets.textWrap;e&&e.setChecked("off"!==this.getWrap())},setTextStyle:function(e){var t=this.getTextArea();if(t)for(var r=Kekule.ObjUtils.getOwnedFieldNames(e),i=0,n=r.length;i<n;++i){var o=r[i];t.setStyleProperty(o,e[o])}return this},increaseTextSize:function(){var e=this.getFontSizeLevel()||1,t=Kekule.ZoomUtils.getNextZoomInRatio(e);this.setFontSizeLevel(t)},decreaseTextSize:function(){var e=this.getFontSizeLevel()||1,t=Kekule.ZoomUtils.getNextZoomOutRatio(e);this.setFontSizeLevel(t)},_checkAutoWrap:function(){var e=this.getAutoWrapThreshold();if(e){var t=this.getToolbarComponentWidget("textWrap"),r=((this.getWrap()||"").toLowerCase(),this.getValue()||""),i=r.split("\n").length,n=r.length/i;t.setChecked(n>e)}}})}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.StyleUtils,r=Kekule.DomUtils,i=Kekule.HtmlElementUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_GRID:"K-Widget-Grid",WIDGET_GRID_CELL:"K-Widget-Grid-Cell",WIDGET_GRID_ADD_CELL:"K-Widget-Grid-Add-Cell",WIDGET_GRID_INTERACTION_AREA:"K-Widget-Grid-Interaction-Area",WIDGET_GRID_WIDGET_PARENT:"K-Widget-Grid-Widget-Parent",WIDGET_GRID_BUTTON_REMOVE:"K-Widget-Grid-Button-Remove",WIDGET_GRID_ENABLE_CELL_INTERACTION:"K-Widget-Grid-Enable-Cell-Interaction"});var n=Kekule.Widget.HtmlClassNames;Kekule.Widget.WidgetGrid=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGrid",CELL_FIELD:"__$cell__",WIDGET_FIELD:"__$cellWidget__",INTERACTION_AREA_FIELD:"__$interactionArea__",EXCEED_TOPRIGHT_FIELD:"__$exceedTopRight__",BTN_REMOVE_CELL_FIELD:"__$removeCell__",initialize:function(e){this._floatClearer=null,this.reactCellMouseEnterBind=this.reactCellMouseEnter.bind(this),this.reactCellMouseLeaveBind=this.reactCellMouseLeave.bind(this),this.reactCellClickBind=this.reactCellClick.bind(this),this.tryApplySuper("initialize",[e]),this.addEventListener("change",this.reactChildWidgetChange,this)},initProperties:function(){this.defineProp("childWidgetClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("cellWidth",{dataType:DataType.STRING}),this.defineProp("cellHeight",{dataType:DataType.STRING}),this.defineProp("widgetPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position}),this.defineProp("autoShrinkWidgets",{dataType:DataType.BOOL}),this.defineProp("keepWidgetAspectRatio",{dataType:DataType.BOOL}),this.defineProp("restoreWidgetSizeOnHotTrack",{dataType:DataType.BOOL}),this.defineProp("enableAdd",{dataType:DataType.BOOL,setter:function(e){if(this.setPropStoreFieldValue("enableAdd",e),e)this.setAddingCell(this.createAddCell());else{var t=this.getAddingCell();t&&this.getContainerElement().removeChild(t)}}}),this.defineProp("enableRemove",{dataType:DataType.BOOL,getter:function(){return this.hasClassName(n.WIDGET_GRID_ENABLE_CELL_INTERACTION)},setter:function(e){e?this.addClassName(n.WIDGET_GRID_ENABLE_CELL_INTERACTION):this.removeClassName(n.WIDGET_GRID_ENABLE_CELL_INTERACTION)}}),this.defineProp("hotCell",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getHotCell()!==e&&(this.hotCellChanged(this.getHotCell(),e),this.setPropStoreFieldValue("hotCell",e))}}),this.defineProp("addingCell",{dataType:DataType.OBJECT,serializable:!1})},initPropValues:function(){this.setPropStoreFieldValue("autoShrinkWidgets",!0),this.setPropStoreFieldValue("keepWidgetAspectRatio",!0),this.setPropStoreFieldValue("restoreWidgetSizeOnHotTrack",!0),this.setEnableRemove(!0),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.WIDGET_GRID},doCreateRootElement:function(e){return e.createElement("div")},doSetUseCornerDecoration:function(e){this.tryApplySuper("doSetUseCornerDecoration",[e]),this.updateAllCells()},doObjectChange:function(t){this.tryApplySuper("doObjectChange",[t]),e.intersect(t,["autoShrinkWidgets","keepWidgetAspectRatio","cellWidth","cellHeight","widgetPos"]).length>0&&this.updateAllCells()},doWidgetShowStateChanged:function(e){return e&&this.updateAllCells(),this.tryApplySuper("doWidgetShowStateChanged",[e])},each:function(e){for(var t=Kekule.ArrayUtils.clone(this.getChildWidgets()),r=0,i=t.length;r<i;++r)e(t[r])},addWidget:function(e){e.setParent(this)},removeWidget:function(e,t){this.hasChild(e)&&(e.setParent(null),t&&e.finalize())},createWidget:function(){var e=this.doCreateNewChildWidget(this.getDocument());if(e)return e.setParent(this),e},doCreateNewChildWidget:function(e){return null},getFloatClearer:function(){return this._floatClearer||(this._floatClearer=this.getDocument().createElement("div"),this._floatClearer.style.clear="both",this.getContainerElement().appendChild(this._floatClearer)),this._floatClearer},createCell:function(e){var t=!e,r=this.getDocument(),i=r.createElement("div");i.className=n.WIDGET_GRID_CELL+" "+n.DYN_CREATED+(t?" "+n.WIDGET_GRID_ADD_CELL:""),i[this.WIDGET_FIELD]=e,Kekule.X.Event.addListener(i,"mouseenter",this.reactCellMouseEnterBind),Kekule.X.Event.addListener(i,"mouseleave",this.reactCellMouseLeaveBind),Kekule.X.Event.addListener(i,"click",this.reactCellClickBind);var o=r.createElement("div");if(o.className=n.WIDGET_GRID_WIDGET_PARENT+" "+n.DYN_CREATED,o[this.WIDGET_FIELD]=e,t&&(o.innerHTML=Kekule.$L("WidgetTexts.CAPTION_ADD_CELL"),o.title=Kekule.$L("WidgetTexts.HINT_ADD_CELL")),i.appendChild(o),e&&(e.appendToElem(o),e[this.CELL_FIELD]=i),!t){var a=r.createElement("div");a.className=n.WIDGET_GRID_INTERACTION_AREA+" "+n.DYN_CREATED,i.appendChild(a),o[this.INTERACTION_AREA_FIELD]=a,i[this.INTERACTION_AREA_FIELD]=a,this.createCellInteractionWidgets(a,i)}return this.getAddingCell()&&!t?this.getContainerElement().insertBefore(i,this.getAddingCell()):this.getContainerElement().insertBefore(i,this.getFloatClearer()),this.updateCell(i),i},createAddCell:function(){return this.createCell(null)},createCellInteractionWidgets:function(e,t){var r=new Kekule.Widget.Button(e.ownerDocument);r.setText(Kekule.$L("WidgetTexts.CAPTION_REMOVE_CELL")),r.setHint(Kekule.$L("WidgetTexts.HINT_REMOVE_CELL")),r.addClassName(n.WIDGET_GRID_BUTTON_REMOVE),r[this.BTN_REMOVE_CELL_FIELD]=!0;var i=this.getContainingWidget(t);r[this.WIDGET_FIELD]=i,r.setShowText(!1),r.setShowGlyph(!0),r.addEventListener("execute",function(e){var t=e.widget[this.WIDGET_FIELD];this.removeWidget(t,!0)},this),r.appendToElem(e)},getWidgetCell:function(e){return e[this.CELL_FIELD]},getWidgetParentElem:function(e){var t=e.getElement();return t&&t.parentNode},getWidgetParentElemOfCell:function(e){return e.children[0]},getInteractionAreaElemOfCell:function(e){return e[this.INTERACTION_AREA_FIELD]},getContainingWidget:function(e){return e[this.WIDGET_FIELD]},childWidgetAdded:function(e){this.tryApplySuper("childWidgetAdded",[e]),this.createCell(e)},childWidgetRemoved:function(e){this.tryApplySuper("childWidgetRemoved",[e]);var t=this.getWidgetCell(e);this.getContainerElement().removeChild(t)},childWidgetMoved:function(e,t){this.tryApplySuper("childWidgetMoved",[e,t]);var r=this.getWidgetCell(e),i=this.getChildWidgets()[t+1],n=i?this.getWidgetCell(i):null;n?this.getContainerElement().insertBefore(r,n):this.getContainerElement().appendChild(r)},childrenModified:function(){this.getContainerElement().appendChild(this.getFloatClearer())},getAllCells:function(){for(var e=this.getChildWidgets(),t=[],r=0,i=e.length;r<i;++r)t.push(this.getWidgetCell(e[r]));return this.getAddingCell()&&t.push(this.getAddingCell()),t},updateCell:function(e,r){var o=e.style,a=this.getCellWidth(),s=this.getCellHeight();a?o.width=a:t.removeStyleProperty(o,"width"),s?o.height=s:t.removeStyleProperty(o,"height"),this.getUseCornerDecoration()?i.addClass(e,n.CORNER_ALL):i.removeClass(e,n.CORNER_ALL),this.adjustCellWidgetPos(e,r),this.adjustInteractionArea(e,r)},adjustCellWidgetPos:function(e,r){for(var n=this.getWidgetParentElemOfCell(e),o=i.getElemOffsetDimension(n),a=i.getElemClientDimension(e),s=["top","right","bottom","left"],l={},u=0,d=s.length;u<d;++u){var c=t.getComputedStyle(e,"padding-"+s[u]);l[s[u]]=t.analysisUnitsValue(c).value||0}var h=Object.extend({},a);h.width-=l.left+l.right,h.height-=l.top+l.bottom;var p=this.getWidgetPos(),g=Kekule.Widget.Position,f=p&g.LEFT?l.left:p&g.RIGHT?a.width-o.width-l.right:(h.width-o.width)/2+l.left,C=p&g.TOP?l.top:p&g.BOTTOM?a.height-o.height-l.bottom:(h.height-o.height)/2+l.top;n.style.left=f+"px",n.style.top=C+"px";var m=this.getInteractionAreaElemOfCell(e);if(m){var T=i.getElemClientDimension(m),E=f+o.width+T.width>=a.width&&C<=T.height;e[this.EXCEED_TOPRIGHT_FIELD]=E}if(this.getAutoShrinkWidgets()&&!r||!this.getRestoreWidgetSizeOnHotTrack()){var _=o.width>h.width?h.width/o.width:null,S=o.height>h.height?h.height/o.height:1;if(this.getKeepWidgetAspectRatio()){var O=_&&S?Math.min(_,S):_||S;_=O,S=O}n.style.transform="scale("+_+", "+S+")";var y=p&g.LEFT?"0":p&g.RIGHT?"100%":"50%",A=p&g.TOP?"0":p&g.BOTTOM?"100%":"50%";n.style.transformOrigin=y+" "+A}else n.style.transform="none"},adjustInteractionArea:function(e,t){var r=this.getInteractionAreaElemOfCell(e);r&&(t?e[this.EXCEED_TOPRIGHT_FIELD]&&this.getWidgetParentElemOfCell(e).appendChild(r):e.appendChild(r))},updateAllCells:function(){for(var e=this.getAllCells(),t=0,r=e.length;t<r;++t)this.updateCell(e[t],e[t]===this.getHotCell())},restoreCellShrink:function(e){var t=this.getWidgetParentElemOfCell(e);t&&(t.style.transform="none")},hotCellChanged:function(e,t){e&&(this.updateCell(e,!1),i.removeClass(e,n.STATE_HOVER)),t&&(i.addClass(t,n.STATE_HOVER),this.getRestoreWidgetSizeOnHotTrack()&&(this.restoreCellShrink(t),this.adjustInteractionArea(t,!0)))},reactCellMouseEnter:function(e){var t=e.getCurrentTarget();this.setHotCell(t)},reactCellMouseLeave:function(e){var t=e.getCurrentTarget();this.getHotCell()===t&&this.setHotCell(null)},reactCellClick:function(e){var t=e.getCurrentTarget();(r.isDescendantOf(t,this.getAddingCell())||t===this.getAddingCell())&&this.createWidget()},reactChildWidgetChange:function(e){var t=e.widget;t&&this.hasChild(t)&&t.getParent()===this&&this.updateCell(this.getWidgetCell(t),this.getHotCell()===this.getWidgetCell(t))}})}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,r=Kekule.StyleUtils,i=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{PROPLISTEDITOR:"K-PropListEditor",PROPLISTEDITOR_PROPEXPANDMARKER:"K-PropListEditor-PropExpandMarker",PROPLISTEDITOR_PROPEXPANDED:"K-PropListEditor-PropExpanded",PROPLISTEDITOR_PROPCOLLAPSED:"K-PropListEditor-PropCollapsed",PROPLISTEDITOR_INDENTDECORATOR:"K-PropListEditor-IndentDecorator",PROPLISTEDITOR_READONLY:"K-PropListEditor-ReadOnly",OBJINSPECTOR:"K-ObjInspector",OBJINSPECTOR_FLEX_LAYOUT:"K-ObjInspector-Flex-Layout",OBJINSPECTOR_SUBPART:"K-ObjInspector-SubPart",OBJINSPECTOR_OBJSINFOPANEL:"K-ObjInspector-ObjsInfoPanel",OBJINSPECTOR_PROPINFOPANEL:"K-ObjInspector-PropInfoPanel",OBJINSPECTOR_PROPINFO_TITLE:"K-ObjInspector-PropInfoPanel-Title",OBJINSPECTOR_PROPINFO_DESCRIPTION:"K-ObjInspector-PropInfoPanel-Description",OBJINSPECTOR_PROPLISTEDITOR_CONTAINER:"K-ObjInspector-PropListEditorContainer"}),Kekule.Widget.ObjPropListEditor=Class.create(Kekule.Widget.ValueListEditor,{CLASS_NAME:"Kekule.Widget.ObjPropListEditor",PARENT_ROW_FIELD:"__$parentRow__",SUB_ROWS_FIELD:"__$subRows__",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setValueDisplayMode(Kekule.Widget.ValueListEditor.ValueDisplayMode.SIMPLE),this.setPropStoreFieldValue("displayedPropScopes",[Class.PropertyScope.PUBLISHED]),this.setEnableLiveUpdate(!0),this.setSubPropNamePadding("1em"),this.setUseKeyHint(!0)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=Kekule.ArrayUtils.toArray(e),r=this.getObjects();this.setPropStoreFieldValue("objects",t),this.inspectedObjectsChanged(t,r)}}),this.defineProp("displayedPropScopes",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("displayedPropScopes",e),this.updateAll()}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("subPropNamePadding",{dataType:DataType.STRING}),this.defineProp("activePropEditor",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getActiveRow();return e?this.getRowPropEditor(e):null}}),this.defineProp("keyField",{dataType:DataType.STRING}),this.defineProp("sortField",{dataType:DataType.STRING}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,scope:Class.PropertyScope.PUBLIC})},doFinalize:function(){this.tryApplySuper("doFinalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setKeyField("title"),this.setSortField("key")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.PROPLISTEDITOR},inspectedObjectsChanged:function(e,t){var r=Kekule.ArrayUtils.toArray(e);t&&this._uninstallObjectsEventHandlers(t),e&&this._installObjectsEventHandlers(r),this.updateAll(r)},_installObjectsEventHandlers:function(e){for(var t=0,r=e.length;t<r;++t){var i=e[t];i.addEventListener&&i.addEventListener("change",this.reactObjectsChange,this)}},_uninstallObjectsEventHandlers:function(e){for(var t=0,r=e.length;t<r;++t){var i=e[t];i.removeEventListener&&i.removeEventListener("change",this.reactObjectsChange,this)}},reactObjectsChange:function(e){if(this.getEnableLiveUpdate()){var t=e.changedPropNames;this.updateValues(t)}},getKeyCellExpandMarker:function(r,n){var o=null,a=this.getCellContentWrapper(r,n);if(a){for(var s=e.getDirectChildElems(a)||[],l=0,u=s.length;l<u;++l){var d=s[l];if(t.hasClass(d,i.PROPLISTEDITOR_PROPEXPANDMARKER)){o=d;break}}if(!o&&n){o=this.getDocument().createElement("span"),t.addClass(o,i.PROPLISTEDITOR_PROPEXPANDMARKER);var c=e.getChildNodesOfTypes(a,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];a.insertBefore(o,c)}}return o},getKeyCellIndentDecorator:function(r,n){var o=null,a=this.getCellContentWrapper(r,n);if(a){for(var s=e.getDirectChildElems(a)||[],l=0,u=s.length;l<u;++l){var d=s[l];if(t.hasClass(d,i.PROPLISTEDITOR_INDENTDECORATOR)){o=d;break}}if(!o&&n){o=this.getDocument().createElement("div"),t.addClass(o,i.PROPLISTEDITOR_INDENTDECORATOR);var c=e.getChildNodesOfTypes(a,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];a.insertBefore(o,c)}}return o},setRowKeyCellContent:function(e,t,r){var i=this.tryApplySuper("setRowKeyCellContent",[e,t,r]),n=this.getKeyCell(e),o=(this.getKeyCellExpandMarker(n,!0),this.getRowSubLevel(e)),a=this.getSubPropNamePadding();if(a){Kekule.StyleUtils.multiplyUnitsValue(a,o);a=Kekule.StyleUtils.multiplyUnitsValue(a,o);var s=this.getKeyCell(e);this.getCellContentWrapper(s,!0).style.paddingLeft=a}return i},updateAll:function(e){if(e||(e=this.getObjects()),e&&e.length){this.setActiveRow(null),this.collapseAllRows();e[0];var t=this.getDisplayPropEditors(e);this.sortPropEditors(t);e.length;var r=this.getRows(),i=r.length,n=t.length,o=0,a=0,s=this.getValueDisplayMode();for(o=0;o<n;++o){var l=t[o];if(l.setValueTextMode(s),this.isPropEditorVisible(l)){var u=a<i?r[a]:this.appendRow();this.setRowPropEditor(u,l),++a}}if(i>a)for(o=i-1;o>=a;--o)this.removeRow(r[o]);return this}this.clear()},updateValues:function(e){for(var t=e&&e.length,r=this.getRows(),i=0,n=r.length;i<n;++i){var o=r[i];if(t){var a=this.getRowPropEditor(o);if(!a||e.indexOf(a.getPropertyName())<0)continue}this.updateRowPropValue(o)}},updateRowPropValue:function(e){var t=this.getRowPropEditor(e).getValueText(),r=this.getRowData(e);r.value=t,this.setRowData(e,r),this.updateRowExpandState(e);var i=this.getSubPropRows(e);if(i)for(var n=0,o=i.length;n<o;++n)this.updateRowPropValue(i[n])},setRowPropEditor:function(e,r){var n,o=this.getKeyField()||"title";if(o)if("name"===o)n=r.getPropertyName();else if("title"===o)n=r.getTitle();else{n=r.getPropertyInfo()[o]}n||(n=r.getTitle()||r.getPropertyName());var a={key:r.getPropertyName(),value:r.getValueText(),title:n,hint:r.getHint(),propEditor:r,expanded:!1};r.isReadOnly()?t.addClass(e,i.PROPLISTEDITOR_READONLY):t.removeClass(e,i.PROPLISTEDITOR_READONLY),this.setRowData(e,a),this.updateRowExpandState(e)},getRowCascadeKey:function(e){if(e&&this.getRowData(e)){var t=this.getRowData(e).key,r=this.getParentPropRow(e);return r&&(t=this.getRowCascadeKey(r)+"."+t),t}return null},getActiveRowCascadeKey:function(){var e=this.getActiveRow();return e&&this.getRowCascadeKey(e)},getRowPropEditor:function(e){var t=this.getRowData(e);return t?t.propEditor:null},getPropEditor:function(e,t){var r=Kekule.PropertyEditor.findEditorClass(e,t);return r?new r:null},getPropEditorForType:function(e,t){var r=Kekule.PropertyEditor.findEditorClassForType(e,t);return r?new r:null},isPropEditorVisible:function(e){var t=!0;if(t=!(e.getObjects().length>1)||e.getAttributes()&Kekule.PropertyEditor.EditorAttributes.MULTIOBJS){var r=e.getPropertyInfo();if(r){var i=r.scope||Class.PropertyScope.DEFAULT;if(i){var n=this.getDisplayedPropScopes();n&&(t=n.indexOf(i)>=0)}}}return t},isRowExpandable:function(e){var t=this.getRowPropEditor(e);return!!t&&t.hasSubPropertyEditors()},isRowExpanded:function(e){return!!this.getRowData(e).expanded},updateRowExpandState:function(e){var r=this.isRowExpandable(e);r||this.removeSubPropertyRows(e),t.removeClass(e,i.PROPLISTEDITOR_PROPCOLLAPSED),t.removeClass(e,i.PROPLISTEDITOR_PROPEXPANDED),r&&(this.isRowExpanded(e)?t.addClass(e,i.PROPLISTEDITOR_PROPEXPANDED):t.addClass(e,i.PROPLISTEDITOR_PROPCOLLAPSED))},expandRow:function(e){return this._doExpandRow(e),this},_doExpandRow:function(e){if(this.isRowExpandable(e)&&!this.isRowExpanded(e)){t.removeClass(e,i.PROPLISTEDITOR_PROPCOLLAPSED),t.addClass(e,i.PROPLISTEDITOR_PROPEXPANDED),this.getRowData(e).expanded=!0;var r=this.getRowPropEditor(e).getSubPropertyEditors(this.getDisplayedPropScopes());return e[this.SUB_ROWS_FIELD]=this.addSubPropertyRows(e,r),e[this.SUB_ROWS_FIELD]}return null},collapseRow:function(e){this.isRowExpandable(e)&&this.isRowExpanded(e)&&(t.removeClass(e,i.PROPLISTEDITOR_PROPEXPANDED),t.addClass(e,i.PROPLISTEDITOR_PROPCOLLAPSED),this.getRowData(e).expanded=!1,this.removeSubPropertyRows(e));return this},toggleRowExpandState:function(e){return this.isRowExpanded(e)?this.collapseRow(e):this.expandRow(e),this},collapseAllRows:function(){for(var e=this.getRows(),t=0,r=e.length;t<r;++t)this.collapseRow(e[t]);return this},expandAllRows:function(e){var t=this,r=function(e,i){for(var n=0,o=e.length;n<o;++n){var a=t._doExpandRow(e[n]);a&&i&&r(a,i)}},i=this.getRows();return r(i,e),this},addSubPropertyRows:function(e,t){var r=this.getNextRow(e),i=[];if(t&&t.length){this.sortPropEditors(t);for(var n=0,o=t.length;n<o;++n){var a=t[n];this.isPropEditorVisible(a)&&i.push(this.addSubPropRow(e,a,r))}}return i},addSubPropRow:function(e,t,r){var i=this.insertRowBefore(null,r);return i[this.PARENT_ROW_FIELD]=e,this.setRowPropEditor(i,t),i},removeSubPropertyRows:function(e){for(var t=this.getSubPropRows(e),r=t.length-1;r>=0;--r)this.removeSubPropertyRows(t[r]),this.removeRow(t[r]);e[this.SUB_ROWS_FIELD]=null},getSubPropRows:function(e){return e[this.SUB_ROWS_FIELD]||[]},getParentPropRow:function(e){return e[this.PARENT_ROW_FIELD]},getRowSubLevel:function(e){for(var t=0,r=this.getParentPropRow(e);r;)++t,r=this.getParentPropRow(r);return t},getValueCellText:function(e,t){return t.value},finishEditing:function(){var e=this.getActiveRow(),t=this.getRowPropEditor(e);if(t){var r=this.getOperHistory(),i=this.getEnableOperHistory()&&r,n=t.getValue();if(t.saveEditValue()){if(i){var o=new Kekule.Widget.PropEditorModifyOperation(t,t.getValue(),n);r.push(o)}this.updateValues(),this.invokeEvent("propertyChange",{propertyEditor:t,propertyInfo:t.getPropertyInfo(),oldValue:n,newValue:t.getValue()}),this.invokeEvent("editFinish",{row:e})}}return this},doCreateValueEditWidget:function(e){var t=this.getRowPropEditor(e),r=t.createEditWidget(this);return r?(this.getReadOnly()||t.isReadOnly())&&r.setReadOnly&&r.setReadOnly(!0):r=this.doCreateDefaultValueEditWidget(e),r},doCreateDefaultValueEditWidget:function(e){var t=new Kekule.Widget.TextBox(this);t.setReadOnly(!0);var r=this.getRowData(e).value;return t.setValue(r),t},isOperHistoryAvailable:function(){return this.getOperHistory()&&this.getEnableOperHistory()},undo:function(){return this.isOperHistoryAvailable()&&this.getOperHistory().undo(),this},redo:function(){return this.isOperHistoryAvailable()&&this.getOperHistory().redo(),this},getCommonSuperClass:function(e){return ClassEx.getCommonSuperClass(e)},getCommonPropNames:function(e){var t=[],r=this.getCommonSuperClass(e);if(r)for(var i=ClassEx.getPropListOfScopes(r,this.getDisplayedPropScopes()),n=0,o=i.getLength();n<o;++n){var a=i.getPropInfoAt(n);t.push(a.name)}return t},getDisplayPropNames:function(e){return this.getCommonPropNames(e)},getDisplayPropEditors:function(e){var t=[],r=this.getCommonSuperClass(e);if(r)(i=this.getPropEditor(null,{dataType:ClassEx.getClassName(r)}))&&(i.setObjects(e),t=t.concat(i.getSubPropertyEditors(this.getDisplayedPropScopes())||[]));else if(1===e.length){var i,n=e[0];if(DataType.isObjectValue(n))(i=this.getPropEditorForType("object"))&&(i.setObjects(n),t=t.concat(i.getSubPropertyEditors()||[]))}return t},sortPropEditors:function(e){var t=this.getSortField();if(t){"key"===t&&this.getKeyField();var r=function(e,t){return e[t]||e.name};e.sort(function(e,i){var n=r(e.getPropertyInfo(),t),o=r(i.getPropertyInfo(),t);return n<o?-1:n>o?1:0})}},getObjPropValue:function(e,t){return e instanceof ObjectEx?e.getPropValue(t):e instanceof Object?e[t]:void 0},getObjsPropValue:function(e,t){for(var r=e[0],i=this.getObjPropValue(r,t),n=1,o=e.length;n<o;++n){r=e[n];if(this.getObjPropValue(r,t)!==i)return}return i},react_click:function(e){var t=e.getTarget(),r=this.getParentRow(t);r&&(t===this.getKeyCellExpandMarker(this.getKeyCell(r),!1)&&this.toggleRowExpandState(r));this.tryApplySuper("react_click",[e])},react_dblclick:function(e){var t=e.getTarget(),r=this.getParentCell(t);if(r){var i=this.getParentRow(r);r===this.getKeyCell(i)&&(this.toggleRowExpandState(i),!0)}},react_keydown:function(e){this.tryApplySuper("react_keydown",[e]);var t=e.getKeyCode();if(!(e.getAltKey()||e.getShiftKey()||e.getCtrlKey())){var r=this.getActiveRow();r&&(t===Kekule.X.Event.KeyCode.RIGHT?this.expandRow(r):t===Kekule.X.Event.KeyCode.LEFT&&this.collapseRow(r))}}}),Kekule.Widget.ObjectInspector=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ObjectInspector",initialize:function(e){this._propListElem=null,this._objsInfoElem=null,this._propInfoElem=null,this.setPropStoreFieldValue("showObjsInfoPanel",!0),this.setPropStoreFieldValue("showPropInfoPanel",!0),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=Kekule.ArrayUtils.toArray(e);this.setPropStoreFieldValue("objects",t),this.inspectedObjectsChanged(t)}}),this.defineProp("readOnly",{dataType:DataType.BOOL,getter:function(){var e=this.getPropEditor();return e&&e.getReadOnly()},setter:function(e){var t=this.getPropEditor();t&&t.setReadOnly(e)}}),this.defineProp("propEditor",{dataType:"Kekule.Widget.ObjPropListEditor",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showObjsInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showObjsInfoPanel",e),r.setDisplay(this._objsInfoElem,!!e),this._updateChildElemSize()}}),this.defineProp("showPropInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showPropInfoPanel",e),r.setDisplay(this._propInfoElem,!!e),this._updateChildElemSize()}}),this.defineProp("keyField",{dataType:DataType.STRING,getter:function(){var e=this.getPropEditor();return e&&e.getKeyField()},setter:function(e){var t=this.getPropEditor();t&&t.setKeyField(e)}}),this.defineProp("sortField",{dataType:DataType.STRING,getter:function(){var e=this.getPropEditor();return e&&e.getSortField()},setter:function(e){var t=this.getPropEditor();t&&t.setSortField(e)}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e&&e.getActiveRow()},setter:function(e){var t=this.getPropEditor();t&&t.setActiveRow(e)}}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropEditor();return!!e&&e.getEnableOperHistory()},setter:function(e){var t=this.getPropEditor();return t?t.setEnableOperHistory(e):null}}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e?e.getOperHistory():null},setter:function(e){var t=this.getPropEditor();return t?t.setOperHistory(e):null}})},doFinalize:function(){this._finalizeChildWidgets(),this.tryApplySuper("doFinalize")},getChildrenHolderElement:function(){return this._propListElem||this.tryApplySuper("getChildrenHolderElement")},doGetWidgetClassName:function(){var e=i.OBJINSPECTOR;return this._isUsingFlexLayout()&&(e+=" "+i.OBJINSPECTOR_FLEX_LAYOUT),e},_isUsingFlexLayout:function(){return!!Kekule.BrowserFeature.cssFlex},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]),this._updateChildElemSize()},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,r){var n=this.tryApplySuper("doCreateSubElements",[e,r])||[],o=this._createSubPartElem(e);t.addClass(o,i.OBJINSPECTOR_OBJSINFOPANEL),r.appendChild(o),this._objsInfoElem=o;var a=this._createSubPartElem(e);t.addClass(a,i.OBJINSPECTOR_PROPINFOPANEL),r.appendChild(a),this._propInfoElem=a;var s=this._createSubPartElem(e);return t.addClass(s,i.OBJINSPECTOR_PROPLISTEDITOR_CONTAINER),r.appendChild(s),this._propListElem=s,this._createChildWidgets(s),n.concat([o,a,s])},_createSubPartElem:function(e){var t=e.createElement("div");return t.className=i.OBJINSPECTOR_SUBPART,t},_createChildWidgets:function(e){this._finalizeChildWidgets();var t=new Kekule.Widget.ObjPropListEditor(this);t.appendToWidget(this);var r=this;t.addEventListener("activeRowChange",function(e){r._updatePropInfo()}),this.setPropStoreFieldValue("propEditor",t)},_finalizeChildWidgets:function(){var e=this.getPropEditor();e&&e.finalize()},inspectedObjectsChanged:function(e){var t=this.getPropEditor();t&&t.setObjects(e),this._updateObjectsInfo(e),this._updatePropInfo()},_updateObjectsInfo:function(t){if(this._objsInfoElem){var r;if(t.length<=0)r=Kekule.$L("WidgetTexts.S_INSPECT_NONE");else if(1===t.length){var i=t[0],n=i.getId?i.getId():null,o=DataType.getType(i);r=n?Kekule.$L("WidgetTexts.S_INSPECT_ID_OBJECT").format(n,o):Kekule.$L("WidgetTexts.S_INSPECT_ANONYMOUS_OBJECT").format(o)}else r=Kekule.$L("WidgetTexts.S_INSPECT_OBJECTS").format(t.length);e.setElementText(this._objsInfoElem,r)}},_updatePropInfo:function(){if(this._propInfoElem){this._propInfoElem.innerHTML="";var t=this.getPropEditor().getActivePropEditor();if(t){var r,n=t.getTitle(),o=t.getDescription()||t.getPropertyType()||"",a=this._propInfoElem.ownerDocument;(r=a.createElement("div")).className=i.OBJINSPECTOR_PROPINFO_TITLE,e.setElementText(r,n),this._propInfoElem.appendChild(r),(r=a.createElement("div")).className=i.OBJINSPECTOR_PROPINFO_DESCRIPTION,e.setElementText(r,o),this._propInfoElem.appendChild(r)}}},undo:function(){return this.getPropEditor()&&this.getPropEditor().undo(),this},redo:function(){return this.getPropEditor()&&this.getPropEditor().redo(),this},getRowCascadeKey:function(e){var t=this.getPropEditor();return t&&t.getRowCascadeKey(e)},getActiveRowCascadeKey:function(){var e=this.getPropEditor();return e&&e.getActiveRowCascadeKey()},isRowExpandable:function(e){var t=this.getPropEditor();return t&&t.isRowExpandable(e)},isRowExpanded:function(e){var t=this.getPropEditor();return t&&t.isRowExpanded(e)},expandRow:function(e){var t=this.getPropEditor();return t&&t.expandRow(e),this},collapseRow:function(e){var t=this.getPropEditor();return t&&t.collapseRow(e),this},toggleRowExpandState:function(e){var t=this.getPropEditor();return t&&t.toggleRowExpandState(e),this},collapseAllRows:function(){var e=this.getPropEditor();return e&&e.collapseAllRows(),this},expandAllRows:function(e){var t=this.getPropEditor();return t&&t.expandAllRows(e),this},_updateChildElemSize:function(){var e=this;this._isUsingFlexLayout()||setTimeout(function(){var t,i;t=e.getShowObjsInfoPanel()?r.getComputedStyle(e._objsInfoElem,"height"):0,i=e.getShowPropInfoPanel()?r.getComputedStyle(e._propInfoElem,"height"):0,e._propListElem.style.top=t,e._propListElem.style.bottom=i},100)},setUseCornerDecoration:function(e){return this.tryApplySuper("setUseCornerDecoration",[e])}})}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.Widget.PropertyEditor={},Kekule.PropertyEditor=Kekule.Widget.PropertyEditor,Kekule.PropertyEditor.BaseEditor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PropertyEditor.BaseEditor",initialize:function(){this.tryApplySuper("initialize"),this._editWidget=null},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=Kekule.ArrayUtils;this.setPropStoreFieldValue("objects",t.clone(t.toArray(e)))}}),this.defineProp("propertyInfo",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("propertyName",{dataType:DataType.VARIANT,serializable:!1,setter:null,getter:function(){var e=this.getPropertyInfo();return e?e.name:null}}),this.defineProp("propertyType",{dataType:DataType.VARIANT,serializable:!1,setter:null,getter:function(){var e=this.getPropertyInfo();return e?e.dataType:null}}),this.defineProp("parentEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:!1}),this.defineProp("valueTextMode",{dataType:DataType.INT}),this.defineProp("readOnly",{dataType:DataType.BOOL}),this.defineProp("allowEmpty",{dataType:DataType.BOOL})},finalize:function(){this.finalizeWidget(),this.tryApplySuper("finalize")},finalizeWidget:function(){this._editWidget&&(this._editWidget.finalize(),this._editWidget=null)},getEditWidget:function(){return this._editWidget},getObjPropValue:function(e,t){return Kekule.ObjUtils.isUnset(t)?e:e instanceof ObjectEx?e.getPropValue(t):DataType.isArrayValue(e)?e[t]:e instanceof Object?e[t]:void 0},setObjPropValue:function(e,t,r){return e instanceof ObjectEx?e.setPropValue(t,r):e instanceof Object&&(e[t]=r),this},getObjsPropValue:function(e,t){if(e){if(Kekule.ObjUtils.isUnset(t))return e;for(var r=e[0],i=this.getObjPropValue(r,t),n=1,o=e.length;n<o;++n){r=e[n];if(this.getObjPropValue(r,t)!==i)return}return i}},setObjsPropValue:function(e,t,r){if(!e||!t)return this;for(var i=0,n=e.length;i<n;++i){var o=e[i];this.setObjPropValue(o,t,r)}return this},isReadOnly:function(){return!!(this.getAttributes()&t.READONLY)},hasSubPropertyEditors:function(){return!!(this.getAttributes()&t.SUBPROPS)},getAttributes:function(){var e=t.MULTIOBJS|t.SIMPLEVALUE,r=this.getPropertyInfo();return Kekule.ObjUtils.isUnset(this.getReadOnly())?r&&!r.setter&&(e|=t.READONLY):this.getReadOnly()&&(e|=t.READONLY),e},getSubPropertyEditors:function(e){return null},getTitle:function(){var e=this.getPropertyInfo();return e?e.title||e.name:""},getHint:function(){return this.getTitle()},getDescription:function(){return this.getPropertyInfo().description},getValue:function(){return this.getObjsPropValue(this.getObjects(),this.getPropertyName())},getValueText:function(){var e=Kekule.Widget.ValueListEditor.ValueDisplayMode,t=this.getValue(),r=this.getValueTextMode();try{var i=r===e.JSON?JSON.stringify(t):Kekule.ObjUtils.isUnset(t)?"":""+t}catch(e){return""+t}return i},setValue:function(e){var t=this.setObjsPropValue(this.getObjects(),this.getPropertyName(),e);return this.getParentEditor()&&this.getParentEditor().notifyChildEditorValueChange&&this.getParentEditor().notifyChildEditorValueChange(this.getPropertyName(),e),t},createEditWidget:function(e){var t=this.getValue(),r=this.doCreateEditWidget(e,t);return r&&r.setIsDirty&&r.setIsDirty(!1),this._editWidget=r,r},doCreateEditWidget:function(e){},saveEditValue:function(){if(this._editWidget){if(!this._editWidget.getIsDirty||this._editWidget.getIsDirty()){var e=this.doSaveEditValue();return this._editWidget.setIsDirty&&this._editWidget.setIsDirty(!1),e}return!1}return!1},doSaveEditValue:function(){},notifyChildEditorValueChange:function(e,t){}}),Kekule.PropertyEditor.EditorAttributes={MULTIOBJS:1,SUBPROPS:2,SIMPLEVALUE:4,VALUELIST:8,CUSTOMEDIT:16,READONLY:32,INLINE_EDIT:128,DROP_EDIT:256,POPUP_EDIT:512};var t=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.EditorMananger=Class.create({initialize:function(){this._registeredItems=[],this._defaultItems=[]},register:function(e,t,r,i,n){var o={editorClass:e,propType:t,objClass:r,propName:i,matchFunc:n};return this._registeredItems.push(o),t||r||i||n||this._defaultItems.push(o),this},unregister:function(e){for(var t=(r=this._registeredItems).length-1;t>=0;--t){r[t].editorClass===e&&r.splice(t,1)}var r;for(t=(r=this._defaultItems).length-1;t>=0;--t){r[t].editorClass===e&&r.splice(t,1)}return this},_getDefaultItem:function(){var e=this._defaultItems;return e[e.length-1]},_getSuperiorItem:function(e,t){for(var r=["matchFunc","propName","objClass","propType"],i=0,n=r.length;i<n;++i)if(!!e[r]!=!!t[r])return e[r]?e:t;return e},_isMatchedPropType:function(e,t){var r=e===t;if(!r&&DataType.isObjectExType(e)&&DataType.isObjectExType(t)){var i=ClassEx.findClass(e),n=ClassEx.findClass(t);r=ClassEx.isOrIsDescendantOf(i,n)}return r},_testOnPropType:function(e,t){return e.propType&&t.dataType?this._isMatchedPropType(t.dataType,e.propType)?1:-1:0},_testOnObjClass:function(e,t){return e.objClass&&t?ClassEx.isOrIsDescendantOf(t,e.objClass)?1:-1:0},_testOnPropName:function(e,t){return e.propName&&t.name?e.propName===t.name?1:-1:0},_testOnMatchFunc:function(e,t,r){return e.matchFunc?e.matchFunc(t,r)?1:-1:0},findEditorClass:function(e,t){for(var r=null,i=this._registeredItems,n=i.length-1;n>=0;--n){var o=i[n],a=this._testOnPropType(o,t);if(!(a<0)){var s=this._testOnObjClass(o,e);if(!(s<0)){var l=this._testOnPropName(o,t);if(!(l<0)){var u=this._testOnMatchFunc(o,e,t);if(!(u<0)&&a+s+l+u>0&&(r=r?this._getSuperiorItem(r,o.editorClass):o.editorClass)&&o.matchFunc)break}}}}r||(r=(o=this._getDefaultItem())?o.editorClass:null);return r},findEditorClassForType:function(e,t){var r={dataType:e,name:t};return this.findEditorClass(null,r)}}),Kekule.ClassUtils.makeSingleton(Kekule.PropertyEditor.EditorMananger),Kekule.PropertyEditor.findEditorClass=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClass.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.findEditorClassForType=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClassForType.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.register=Kekule.PropertyEditor.EditorMananger.getInstance().register.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.unregister=Kekule.PropertyEditor.EditorMananger.getInstance().unregister.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.SimpleEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SimpleEditor",convertStrToValue:function(e,t){return DataType.isSimpleType(t)?!e&&this.getAllowEmpty()?null:Kekule.StrUtils.convertToType(e,t):e},setValueText:function(e){if(e===this._originValueText)return!1;var t,r=this.getPropertyType();return!(r&&!DataType.isSimpleType(r))&&(t=r?this.convertStrToValue(e,r):e,this.setValue(t),!0)},doCreateEditWidget:function(e){var t=this.getValueText();return this._originValueText=t,new Kekule.Widget.TextBox(e,t)},doSaveEditValue:function(){return this.setValueText(this.getEditWidget().getValue())}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.SimpleEditor),Kekule.PropertyEditor.TextEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.TextEditor",LINE_BREAK_REPLACER:"\\n",textToSingleLine:function(e){return e.split("\n").join(this.LINE_BREAK_REPLACER)},textToMultiLine:function(e){return e.split(this.LINE_BREAK_REPLACER).join("\n")},doCreateEditWidget:function(e){this._parentWidget=e;var t=this.getValueText();this._originValueText=t;var r=new Kekule.Widget.ButtonTextBox(e,this.textToSingleLine(t));return this._textbox=r,r.setButtonKind(Kekule.Widget.Button.Kinds.POPUP),r.addEventListener("buttonExecute",this.reactButtonExecute,this),r},reactButtonExecute:function(e){this.openPopupEditor()},openPopupEditor:function(){var e=this._popupDialog;e||(e=this.createPopupDialog(),this._popupDialog=e);var t=this._popupEditor;t.setValue(this.getValueText());var r=this;e.openPopup(function(e){e===Kekule.Widget.DialogButtons.OK&&(r._textbox.setValue(r.textToSingleLine(t.getValue())),r._textbox.setIsDirty(!0),r.saveEditValue())},this._textbox)},createPopupDialog:function(){var e=this._parentWidget.getDocument(),t=new Kekule.Widget.Dialog(e,this.getPropertyName(),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);t.setLocation(Kekule.Widget.Location.CENTER_OR_FULLFILL);var r=new(0,Kekule.Widget.TextArea)(e),i=r.getElement().style;return i.width="40em",i.height="20em",r.appendToWidget(t),this._popupEditor=r,t},doSaveEditValue:function(){var e=this.getEditWidget().getValue();return(e=this.textToMultiLine(e))!==this._originValueText&&(this.setValueText(e),!0)}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.TextEditor,DataType.STRING),Kekule.PropertyEditor.BoolEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.BoolEditor",boolToStr:function(e){return Kekule.StrUtils.boolToStr(e)},doCreateEditWidget:function(e){this._originValue=this.getValue();var t=new Kekule.Widget.CheckBox(e,this._originValue);t.setText(this.boolToStr(this._originValue));var r=this;return t.addEventListener("valueChange",function(e){var i=t.getChecked();t.setText(r.boolToStr(i))}),t},getValueText:function(){var e=this.getValue();return Kekule.ObjUtils.isUnset(e)?Kekule.$L("WidgetTexts.S_VALUE_UNSET"):this.tryApplySuper("getValueText")},doSaveEditValue:function(){var e=this.getEditWidget().getChecked();return e!==this._originValue&&(this.setValue(e),!0)}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.BoolEditor,DataType.BOOL),Kekule.PropertyEditor.SelectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SelectEditor",getValueText:function(){for(var e=this.getValue(),t=this.getSelectItems()||[],r=0,i=t.length;r<i;++r){var n=t[r];if(n.value===e)return n.text}return this.tryApplySuper("getValueText")},getSelectItems:function(){return[]},doCreateEditWidget:function(e){var t=new Kekule.Widget.SelectBox(e,this.getSelectItems());return this._originalValue=this.getValue(),t.setValue(this._originalValue),t},doSaveEditValue:function(){var e=this.getEditWidget().getValue();return e!==this._originalValue&&(this.setValue(e),!0)}}),Kekule.PropertyEditor.EnumEditor=Class.create(Kekule.PropertyEditor.SelectEditor,{CLASS_NAME:"Kekule.PropertyEditor.EnumEditor",initialize:function(){this.tryApplySuper("initialize"),this.enumInfos=[]},setPropertyInfo:function(e){if(this.tryApplySuper("setPropertyInfo",[e]),e){var t=e.enumSource;if(t&&DataType.isObjectValue(t)){var r=Kekule.ObjUtils.getOwnedFieldNames(t);this.enumInfos=[];for(var i=0,n=r.length;i<n;++i)this.enumInfos.push({text:r[i],value:t[r[i]]})}}},getSelectItems:function(){var e=this.getValue();if(Kekule.ObjUtils.isUnset(e)){var t=Kekule.ArrayUtils.clone(this.enumInfos);return t.unshift({text:Kekule.$L("WidgetTexts.S_VALUE_UNSET"),value:e}),t}return this.enumInfos}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.EnumEditor,null,null,null,function(e,t){return!!t.enumSource}),Kekule.PropertyEditor.ObjectExEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectExEditor",getAttributes:function(){var e=this.tryApplySuper("getAttributes");return e|=t.SUBPROPS},hasSubPropertyEditors:function(){return this.tryApplySuper("hasSubPropertyEditors")&&this.getValue()},getSubPropertyEditors:function(e){var t=[],r=this.getValue();if(r){if(r instanceof ObjectEx)var i=r.getClass();else i=ClassEx.getCommonSuperClass(r);for(var n=ClassEx.getPropListOfScopes(i,e),o=0,a=n.getLength();o<a;++o){var s=n.getPropInfoAt(o),l=Kekule.PropertyEditor.findEditorClass(i,s);if(l){var u=new l;u.setObjects(Kekule.ArrayUtils.toArray(r)),u.setPropertyInfo(s),u.setValueTextMode(this.getValueTextMode()),t.push(u)}}}return t},getValueText:function(){var e=this.getValue();return Kekule.ObjUtils.notUnset(e)?e.getClassName?"["+e.getClassName()+"]":this.tryApplySuper("getValueText"):Kekule.$L("WidgetTexts.S_OBJECT_UNSET")}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectExEditor,"ObjectEx"),Kekule.PropertyEditor.ObjectFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectFieldEditor",initialize:function(){},doCreateEditWidget:function(e){if(!this.getPropertyType()){var t=this.getValue();this.getPropertyInfo().dataType=DataType.getType(t)}return this.tryApplySuper("doCreateEditWidget",[e])}}),Kekule.PropertyEditor.ObjectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectEditor",initialize:function(){this.tryApplySuper("initialize"),this._initialObjValue=void 0},getFieldEditorClass:function(e,t){return Kekule.PropertyEditor.findEditorClass(null,t)||Kekule.PropertyEditor.ObjectFieldEditor},getFieldValueType:function(e,t){var r=e[t];return Kekule.ObjUtils.notUnset(r)?DataType.getType(r):null},createFieldEditor:function(e,t){var r=new(this.getFieldEditorClass(e,t));return r.setParentEditor(this),r.setReadOnly(!1),r.setAllowEmpty(this.getAllowEmpty()),r.setPropertyInfo(t),r.setObjects(e),r.setValueTextMode(this.getValueTextMode()),r},getObjFields:function(e){return e?Kekule.ObjUtils.getOwnedFieldNames(e):[]},getObjFieldInfos:function(e){for(var t=this.getObjFields(e),r=[],i=0,n=t.length;i<n;++i){var o={name:t[i],dataType:this.getFieldValueType(e,t[i])};r.push(o)}return r},notifyChildEditorValueChange:function(e,t){var r=this.getValue()||this._initialObjValue;r[e]=t,this.setValue(r)},getAttributes:function(){var e=this.tryApplySuper("getAttributes");return e|=t.SUBPROPS},hasSubPropertyEditors:function(){return this.tryApplySuper("hasSubPropertyEditors")&&this.getObjFieldInfos(this.getValue()).length},getValueText:function(){var e=Kekule.Widget.ValueListEditor.ValueDisplayMode;return this.getValueTextMode()===e.JSON?this.tryApplySuper("getValueText"):this.getValue()?"["+Kekule.$L("WidgetTexts.S_OBJECT")+"]":""},setValue:function(e){var t=this.tryApplySuper("setValue",[e]);return this._initialObjValue=e,t},getSubPropertyEditors:function(t){var r=[],i=e.toArray(this.getValue());if(i.length>1)return[];var n=i[0];this._initialObjValue=n||{};for(var o=this.getObjFieldInfos(n),a=[this._initialObjValue],s=0,l=o.length;s<l;++s){var u=this.createFieldEditor(a,o[s]);r.push(u)}return r}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectEditor,DataType.OBJECT),Kekule.PropertyEditor.ArrayEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ArrayEditor",getAttributes:function(){var e=this.tryApplySuper("getAttributes");return e|=t.SUBPROPS},hasSubPropertyEditors:function(){var e=this.getValue();return this.tryApplySuper("hasSubPropertyEditors")&&e&&e.length},getSubPropertyEditors:function(e){var t=[],r=this.getValue();if(DataType.isArrayValue(r)&&r.length)for(var i=this.getPropertyInfo().elementType,n=0,o=r.length;n<o;++n){var a=r[n],s=i||DataType.getType(a),l=Kekule.PropertyEditor.findEditorClassForType(s);if(l){var u=new l;u.setParentEditor(this),u.setObjects([r]);var d={name:n,title:n,dataType:s};u.setPropertyInfo(d),u.setValueTextMode(this.getValueTextMode()),t.push(u)}}return t},getValueText:function(){var e=this.getValue();return DataType.isArrayValue(e)?"["+e.length+" "+Kekule.$L("WidgetTexts.S_ITEMS")+"]":this.tryApplySuper("getValueText")}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ArrayEditor,DataType.ARRAY),Kekule.PropertyEditor.ColorEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ColorEditor",doCreateEditWidget:function(e){this._parentWidget=e;var t=this.getValue();this._originValue=t;var r=new Kekule.Widget.ColorDropTextBox(e,t);return r.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET]),r.addEventListener("valueSet",function(e){this.saveEditValue()},this),this._textbox=r,r},doSaveEditValue:function(){var e=this.getEditWidget().getValue();return e===Kekule.Widget.ColorPicker.SpecialColors.UNSET?e=void 0:""===e&&(e=void 0),e!==this._originValue&&(this.setValue(e),!0)}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ColorEditor,DataType.STRING,null,null,function(e,t){var r=t.name;return r&&r.toLowerCase().indexOf("color")>=0})}(),function(){"use strict";Kekule.Widget.PropEditorModifyOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.Widget.PropEditorModifyOperation",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setPropEditor(e),this.setNewValue(t),this.setOldValue(r)},initProperties:function(){this.defineProp("propEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:!1}),this.defineProp("newValue",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("oldValue",{dataType:DataType.VARIANT,serializable:!1})},doExecute:function(){var e=this.getPropEditor();void 0===this.getOldValue()&&this.setOldValue(e.getValue()),e.setValue(this.getNewValue())},doReverse:function(){this.getPropEditor().setValue(this.getOldValue())}})}(),function(){"use strict";Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_CONFIGURATOR:"K-Widget-Configurator",WIDGET_CONFIGURATOR_CLIENT:"K-Widget-Configurator-Client",ACTION_OPEN_CONFIGURATOR:"K-Action-Open-Configurator"});var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.Configurator=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.Widget.Configurator",TAB_BTN_DATA_FIELD:"__$data__",DEF_TAB_POSITION:Kekule.Widget.Position.RIGHT,initialize:function(e){this.setPropStoreFieldValue("widget",e),this._objInspector=null,this._tabGroup=null,this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("autoUpdate",{dataType:DataType.BOOL}),this.defineProp("tabPosition",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("tabPosition",e),this._tabGroup&&this._tabGroup.setTabButtonPosition(e||this.DEF_TAB_POSITION)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.WIDGET_CONFIGURATOR},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(t,r){var i=[],n=t.createElement("div");n.className=e.WIDGET_CONFIGURATOR_CLIENT,i.push(n);var o=new Kekule.Widget.ObjectInspector(this);o.setShowObjsInfoPanel(!1),o.setSortField(null),o.appendToElem(n),this._objInspector=o,o.addEventListener("propertyChange",function(e){this.invokeEvent("configChange",{obj:o.getObjects()[0],propertyName:e.propertyInfo.name,oldValue:e.oldValue,newValue:e.newValue})},this);var a,s=this.getCategoryInfos(),l=new Kekule.Widget.TabButtonGroup(this);this._tabGroup=l,l.setTabButtonPosition(this.getTabPosition()||this.DEF_TAB_POSITION);for(var u=0,d=s.length;u<d;++u){var c=s[u],h=new Kekule.Widget.RadioButton(l);h.setText(c.title||c.name),h.setHint(c.description||""),h[this.TAB_BTN_DATA_FIELD]=c.obj,h.appendToWidget(l),0===u&&(a=h)}return l.addEventListener("execute",function(e){var t=e.widget;t instanceof Kekule.Widget.RadioButton&&this._switchToTab(t)},this),l.appendToElem(n),s.length<=1&&l.setDisplayed("none"),a.setChecked(!0),this._switchToTab(a),r.appendChild(n),i},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),this.getAutoUpdate()&&(e?this.loadConfigValues():this.saveConfigValues())},loadConfigValues:function(){},saveConfigValues:function(){},getCategoryInfos:function(){var e=this.getWidget(),t=[],r=e.getSettingFacade();if(r){var i=e.getPropInfo("settingFacade");t.push({obj:r,name:i.name,title:i.title,descrption:i.description})}return t},_switchToTab:function(e){var t=e[this.TAB_BTN_DATA_FIELD];this._objInspector.setObjects(t)}}),Kekule.Widget.ActionOpenConfigWidget=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Widget.ActionOpenConfigWidget",HTML_CLASSNAME:e.ACTION_OPEN_CONFIGURATOR,initialize:function(e){this.tryApplySuper("initialize"),this.setWidget(e),this.setText(Kekule.$L("WidgetTexts.CAPTION_CONFIG")),this.setHint(Kekule.$L("WidgetTexts.HINT_CONFIG"))},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},doUpdate:function(){var e=this.getWidget();this.setEnabled(e&&e.getEnabled())},doExecute:function(e){this.getWidget().openConfigurator(e)}}),ClassEx.extend(Kekule.Widget.BaseWidget,{getSettingFacadeClass:function(){var e=this.getClass(),t=null;do{var r=ClassEx.getClassName(e)+".Settings";t=ClassEx.findClass(r),e=ClassEx.getSuperClass(e)}while(e&&!t);return t},getConfiguratorClass:function(){var e=this.getClass(),t=null;do{var r=ClassEx.getClassName(e)+".Configurator";t=ClassEx.findClass(r),e=ClassEx.getSuperClass(e)}while(e&&!t);return t},createConfigurator:function(){return new(this.getConfiguratorClass())(this)},getConfigurator:function(){return this._configurator||(this._configurator=this.createConfigurator()),this._configurator},openConfigurator:function(e){this.getConfigurator().show(e||this,null,Kekule.Widget.ShowHideType.DROPDOWN)}}),ClassEx.defineProp(Kekule.Widget.BaseWidget,"settingFacade",{dataType:DataType.OBJECTEX,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var e=this.getPropStoreFieldValue("settingFacade");if(!e){var t=this.getSettingFacadeClass();t&&(e=new t(this),this.setPropStoreFieldValue("settingFacade",e))}return e}}),Kekule.Widget.BaseWidget.Settings=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget.Settings",initialize:function(e){this._basedClass=null,this.tryApplySuper("initialize"),this.setWidget(e)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PUBLIC})},getBasedClass:function(){if(!this.hasOwnProperty("_basedClass")||!this._basedClass){var e=this.getClassName(),t=e.split(".");t.pop(),e=t.join("."),this._basedClass=ClassEx.findClass(e)}return this._basedClass},defineDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(this.getBasedClass(),t),i=Object.create(r);i.setter=null,i.getter=null,r.getter&&(i.getter=function(){return this.getWidget().getPropValue(t)}),r.setter&&(i.setter=function(e){this.getWidget().setPropValue(t,e)}),this.defineProp(e,i)},defineDelegatedProps:function(e,t){t||(t=[]);for(var r=0,i=e.length;r<i;++r){var n=e[r],o=t[r]||n;this.defineDelegatedProp(n,o)}}})}(),function(){"use strict";Kekule.Widget.BaseDataSet=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseDataSet",PREFIX_SORT_DESC:"!",initProperties:function(){this.defineProp("enableCache",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableCache")&&this.getCacheAvailable()},setter:function(e){this.setPropStoreFieldValue("enableCache",e),e||this.clearCache()}}),this.defineProp("defaultTimeout",{dataType:DataType.INT}),this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(e){var t=e?Kekule.ArrayUtils.toArray(e):null;this.setPropStoreFieldValue("sortFields",t),this.sortFieldsChanged(t)}}),this.defineProp("cache",{dataType:DataType.ARRAY})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableCache(!0),this.setCache([]),this.setDefaultTimeout(2e4)},finalize:function(){this.clearCache(),this.setCache(null),this.tryApplySuper("finalize")},dataChanged:function(){this.clearCache(),this.invokeEvent("dataChange")},sortFieldsChanged:function(e){this.clearCache(),this.doSortFieldsChanged(e)},doSortFieldsChanged:function(e){},getTotalCount:function(){return this.doGetTotalCount()||0},doGetTotalCount:function(){},totalCountChanged:function(e){this.invokeEvent("totalCountChange",{totalCount:e})},getFirstIndex:function(){return 0},getLastIndex:function(){return(this.getTotalCount()||0)-1},getCacheAvailable:function(){return!0},clearCache:function(){return this.getCache().length=0,this},saveCacheData:function(e,t){for(var r=this.getCache(),i=t,n=0;n<e.length;++n)r[i]=e[n]||null,++i},loadCacheData:function(e,t){if(this.getEnableCache()){var r=this.getCache();if(r.length<e+t)return null;for(var i=[],n=e,o=e+t;n<o;++n){var a=r[n];if(void 0===a)return null;i.push(a)}return i}return null},fetch:function(e){var t=Object.extend({fromIndex:0,count:0},e);if(t.timeout=t.timeout||this.getDefaultTimeout(),this.getEnableCache()){var r=this.loadCacheData(t.fromIndex,t.count);if(r)return void t.callback(r)}var i=this,n=!1;if(t.timeout>0)var o=setTimeout(function(){o&&clearTimeout(o),n=!0,t.timeoutCallback?t.timeoutCallback():e.errCallback&&e.errCallback(Kekule.$L("ErrorMsg.FETCH_DATA_TIMEOUT"))},t.timeout);t.callback=function(r){n||(o&&clearTimeout(o),e.callback&&e.callback(r),i.getEnableCache()&&i.saveCacheData(r,t.fromIndex))},t.errCallback=function(t){n||(o&&clearTimeout(o),e.errCallback&&e.errCallback(t))};this.doFetch(t.fromIndex,t.count,t.callback,t.errCallback)},doFetch:function(e,t,r,i){}}),Kekule.Widget.ArrayDataSet=Class.create(Kekule.Widget.BaseDataSet,{CLASS_NAME:"Kekule.Widget.ArrayDataSet",initialize:function(e){this.tryApplySuper("initialize"),this.setData(e)},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("data",e);var t=this.getSortFields();t&&this.doSortFieldsChanged(t),this.dataChanged()}})},getCacheAvailable:function(){return!1},doSortFieldsChanged:function(e){var t=this.getData()||[];return Kekule.ArrayUtils.sortHashArray(t,e),this.dataChanged(),this},doGetTotalCount:function(){return(this.getData()||[]).length},doFetch:function(e,t,r,i){for(var n=[],o=this.getData()||[],a=e,s=Math.min(e+t,o.length);a<s;++a){var l=o[a];n.push(l)}r(n)}}),Kekule.Widget.DataPager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DataPager",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("pageSize",10),this.setDataSet(e)},initProperties:function(){this.defineProp("dataSet",{dataType:"Kekule.Widget.BaseDataSet",setter:function(e){var t=this.getDataSet();e!==t&&(this.setPropStoreFieldValue("dataSet",e),this.dataSetChange(t,e),this.switchToPage(this.getCurrPageIndex()||0))}}),this.defineProp("pageSize",{dataType:DataType.INT,setter:function(e){e!==this.getPageSize()&&(this.setPropStoreFieldValue("pageSize",e),this.pageCountChanged(this.getPageCount()),this.switchToPage(this.getCurrPageIndex()||0))}}),this.defineProp("currPageIndex",{dataType:DataType.INT}),this.defineProp("currPageData",{dataType:DataType.ARRAY}),this.defineProp("sortFields",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getDataSet()&&this.getDataSet().getSortFields()},setter:function(e){this.getDataSet()&&this.getDataSet().setSortFields(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setCurrPageIndex(0)},dataSetChange:function(e,t){e&&(e.RemoveEventListener("dataChange",this.reactDataSetDataChange,this),e.RemoveEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)),t&&(t.addEventListener("dataChange",this.reactDataSetDataChange,this),t.addEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)),this.pageCountChanged(this.getPageCount())},reactDataSetDataChange:function(e){this.dataChanged()},dataChanged:function(){this.pageCountChanged(this.getPageCount()),this.switchToPage(this.getCurrPageIndex()||0)},reactDataSetTotalCountChange:function(e){this.pageCountChanged(this.getPageCount())},getPageCount:function(){var e=this.getDataSet(),t=e&&e.getTotalCount()||0;return Math.ceil(t/this.getPageSize())},pageCountChanged:function(e){this.invokeEvent("pageCountChange",{pageCount:e})},fetchPageData:function(e){var t=this.getPageSize()*(Kekule.ObjUtils.isUnset(e.pageIndex)?this.getCurrPageIndex():e.pageIndex),r=this.getPageSize(),i=Object.create(e);return Object.extend(i,{fromIndex:t,count:r}),this.getDataSet().fetch(i),this},switchToPage:function(e,t){var r=this,i={pageIndex:e,timeout:t,callback:function(t){r.setCurrPageData(t),r.setCurrPageIndex(e),r.invokeEvent("dataFetched",{pageIndex:e,data:t})},errCallback:function(e){r.invokeEvent("dataError",{error:e}),Kekule.error(e)}};this.invokeEvent("pageRetrieve",{pageIndex:e}),this.fetchPageData(i)}})}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,r=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DATAGRID:"K-DataGrid",DATATABLE:"K-DataTable",DATATABLE_ROW_ODD:"K-Odd",DATATABLE_ROW_EVEN:"K-Even",DATATABLE_CELL_WRAPPER:"K-DataTable-CellWrapper",DATATABLE_HEADCELL_INTERACTABLE:"K-DataTable-HeadCellInteractable",DATATABLE_OPER_COL:"K-DataTable-OperCol",DATATABLE_OPER_CELL:"K-DataTable-OperCell",DATATABLE_CHECK_COL:"K-DataTable-CheckCol",DATATABLE_CHECK_CELL:"K-DataTable-CheckCell",DATATABLE_DATA_COL:"K-DataTable-DataCol",DATATABLE_DATA_CELL:"K-DataTable-DataCell",DATATABLE_SORTMARK:"K-DataTable-SortMark",DATATABLE_SORTASC:"K-Sort-Asc",DATATABLE_SORTDESC:"K-Sort-Desc",DATATABLE_EDIT:"K-DataTable-Edit",DATATABLE_DELETE:"K-DataTable-Delete",DATATABLE_INSERT:"K-DataTable-Insert",PAGENAVIGATOR:"K-PageNavigator",PAGENAVIGATOR_FIRST:"K-PageNavigator-First",PAGENAVIGATOR_LAST:"K-PageNavigator-Last",PAGENAVIGATOR_PREV:"K-PageNavigator-Prev",PAGENAVIGATOR_NEXT:"K-PageNavigator-Next",PAGENAVIGATOR_PAGEINDEXER:"K-PageNavigator-PageIndexer",PAGENAVIGATOR_PAGEINPUT:"K-PageNavigator-PageInput",PAGENAVIGATOR_PAGESELECTOR:"K-PageNavigator-PageSelector"}),Kekule.Widget.DataTableColNames={OPER:"OPER",CHECK:"CHECK",ALL:"*"};var i=Kekule.Widget.DataTableColNames;Kekule.Widget.DataTable=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DataTable",BINDABLE_TAG_NAMES:["div","span"],PREFIX_SORT_DESC:"!",COLDEF_FIELD:"__$colDef__",ROWDATA_FIELD:"__$rowData__",ROW_OPER_TOOLBAR_FIELD:"__$rowOperToolbar__",ROW_CHECKBOX_FIELD:"__$rowCheckBox__",COLNAME_OPER:i.OPER,COLNAME_CHECK:i.CHECK,COLNAME_ALL:i.ALL,initialize:function(e){this._displayData=null,this.setPropStoreFieldValue("showTableHead",!0),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY}),this.defineProp("columns",{dataType:DataType.ARRAY}),this.defineProp("operColShowMode",{dataType:DataType.STRING}),this.defineProp("operWidgets",{dataType:DataType.ARRAY}),this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(e){var t=e?Kekule.ArrayUtils.toArray(e):null;this.setPropStoreFieldValue("sortFields",t),this.getDataPager()&&this.getDataPager().setSortFields(t)}}),this.defineProp("sortFunc",{dataType:DataType.FUNCTION}),this.defineProp("showTableHead",{dataType:DataType.BOOL}),this.defineProp("enableHeadInteraction",{dataType:DataType.BOOL}),this.defineProp("enableActiveRow",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableActiveRow",e),e||this.setActiveCell(null)}}),this.defineProp("activeCell",{dataType:DataType.OBJECT,setter:function(e){var i=this.getActiveCell();if(i!==e)if(i&&t.removeClass(i,r.STATE_ACTIVE),this.setPropStoreFieldValue("activeCell",e),e){t.addClass(e,r.STATE_ACTIVE);var n=this.getParentRow(e);n&&this.setActiveRow(n)}else this.setActiveRow(null)}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,setter:function(e){var t=this.getActiveRow();t!==e&&(this.activeRowChanged(t,e),this.setPropStoreFieldValue("activeRow",e))}}),this.defineProp("hoverCell",{dataType:DataType.OBJECT,setter:function(e){var i=this.getHoverCell();if(i!==e)if(i&&t.removeClass(i,r.STATE_HOVER),this.setPropStoreFieldValue("hoverCell",e),e){t.addClass(e,r.STATE_HOVER);var n=this.getParentRow(e);n&&this.setHoverRow(n)}else this.setHoverRow(null)}}),this.defineProp("hoverRow",{dataType:DataType.OBJECT,setter:function(e){var t=this.getHoverRow();t!==e&&(this.hoverRowChanged(t,e),this.setPropStoreFieldValue("hoverRow",e))}}),this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(e){var t=this.getDataPager();t!==e&&(this.setPropStoreFieldValue("dataPager",e),this.dataPagerChanged(e,t))}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.reactOperEditBind=this.reactOperEdit.bind(this),this.reactOperDeleteBind=this.reactOperDelete.bind(this),this.reactOperInsertBind=this.reactOperInsert.bind(this)},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]);Kekule.ArrayUtils.intersect(e,["data","columns","sortFields","sortFunc","showTableHead","enableHeadInteraction","operColShowMode","operWidgets"]).length&&this.recreateChildContent()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.DATATABLE},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){return this.doCreateDataTable(e,t)},doCreateDataTable:function(e,t){var r=e.createElement("table");return this.recreateChildContent(e,r),t.appendChild(r),r},getTableElement:function(){return this.getElement()&&this.getElement().getElementsByTagName("table")[0]},getShowOperCol:function(){return(this.getOperColShowMode()||Kekule.Widget.DataTable.OperColShowMode.NONE)!==Kekule.Widget.DataTable.OperColShowMode.NONE},recreateChildContent:function(t,r){this.setActiveCell(null),this.setHoverCell(null);var i=this.prepareData(),n=r||this.getTableElement(),o=[];if(n){if(e.clearChildContent(n),!t)t=n.ownerDocument;o.push(this.doCreateDataTableColGroup(t,n,i.columns)),this.getShowTableHead()&&o.push(this.doCreateDataTableHead(t,n,i.columns)),o.push(this.doCreateDataTableBody(t,n,i.columns,i.data))}return o},doCreateDataTableColGroup:function(e,t,r){for(var i=r||[],n=e.createElement("colgroup"),o=0,a=i.length;o<a;++o){var s=i[o]||{},l=e.createElement("col");s.colClassName&&(l.className=s.colClassName),s.colStyle&&(l.style.cssText=s.colStyle),n.appendChild(l)}return t.appendChild(n),n},doCreateDataTableCellWrapper:function(e,t){var i=e.createElement("span");return i.className=r.DATATABLE_CELL_WRAPPER,t.appendChild(i),i},doCreateDataTableHead:function(e,t,r){for(var i=r||[],n=this.getEnableHeadInteraction(),o=e.createElement("thead"),a=e.createElement("tr"),s=0,l=i.length;s<l;++s){var u=i[s]||{};this.doCreateDataTableHeadCell(e,a,u,n)}return o.appendChild(a),t.appendChild(o),o},doCreateDataTableHeadCell:function(i,n,o,a){var s=i.createElement("th");o.className&&(s.className=o.className),o.style&&(s.style.cssText=o.style);var l=this.doCreateDataTableCellWrapper(i,s);(Kekule.ObjUtils.notUnset(o.disableInteract)?!o.disableInteract:a)&&t.addClass(s,r.DATATABLE_HEADCELL_INTERACTABLE),e.setElementText(l,o.text||o.name);var u=this.doCreateDataTableHeadCellSortMark(i,s);return 1===o.sorting?t.addClass(u,r.DATATABLE_SORTASC):-1===o.sorting&&t.addClass(u,r.DATATABLE_SORTDESC),l.title=o.hint||"",s[this.COLDEF_FIELD]=o,n.appendChild(s),s},doCreateDataTableHeadCellSortMark:function(e,t){var i=e.createElement("span");return i.className=r.DATATABLE_SORTMARK,t.appendChild(i),i},doCreateDataTableBody:function(e,t,i,n){var o=i||[],a=(n=n||[],e.createElement("tbody"));if(this.getShowOperCol())var s=this.getOperWidgetDefinitions();for(var l=!0,u=0,d=n.length;u<d;++u){var c=e.createElement("tr");c.className=l?r.DATATABLE_ROW_ODD:r.DATATABLE_ROW_EVEN,l=!l;var h=n[u]||{};c[this.ROWDATA_FIELD]=h;for(var p=0,g=o.length;p<g;++p){var f=o[p],C=f.name,m=h[C],T=e.createElement("td");f.className&&(T.className=f.className),f.style&&(T.style.cssText=f.style);var E=this.doCreateDataTableCellWrapper(e,T);if(f.isOperCol){var _={rowData:h,rowIndex:u,colIndex:p,childWidgetDefinitions:s},S=this.doCreateOperCellContent(E,_);c[this.ROW_OPER_TOOLBAR_FIELD]=S}else if(f.isCheckCol){_={rowData:h,rowIndex:u,colIndex:p};var O=this.doCreateCheckCellContent(E,_);c[this.ROW_CHECKBOX_FIELD]=O}else{_={rowData:h,cellKey:C,cellValue:m,rowIndex:u,colIndex:p};this.doCreateDataCellContent(E,_)}T.appendChild(E),c.appendChild(T)}a.appendChild(c)}return t.appendChild(a),a},doCreateDataCellContent:function(t,r){var i="";Kekule.ObjUtils.notUnset(r.cellValue)&&(i=""+r.cellValue),e.setElementText(t,i)},doCreateCheckCellContent:function(e,t){var r=new Kekule.Widget.CheckBox(this);return r.appendToElem(e),r},doCreateOperCellContent:function(e,t){var r=this.doCreateOperToolbar(e,t.childWidgetDefinitions),i=Kekule.Widget.DataTable.OperColShowMode;return this.getOperColShowMode()!==i.ALL&&r.setVisible(!1),r},doCreateOperToolbar:function(e,t){var r=new Kekule.Widget.ButtonGroup(this);return r.setChildDefs(t),r.appendToElem(e),r},getDefaultOperButtons:function(){var e=Kekule.Widget.DataTable.Components;return[e.EDIT,e.DELETE]},getOperWidgetDefinitions:function(){for(var e=[],t=this.getOperWidgets()||this.getDefaultOperButtons(),r=0,i=t.length;r<i;++r){var n=t[r];if(DataType.isObjectValue(n))e.push(n);else{var o=this.getDefaultComponentDefinitionHash(n);o&&e.push(o)}}return e},getDefaultComponentDefinitionHash:function(e){var t,i=Kekule.Widget.DataTable.Components;return e===i.EDIT?t={widget:"Kekule.Widget.Button",htmlClass:r.DATATABLE_EDIT,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_EDIT"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_EDIT"),"#execute":this.reactOperEditBind}:e===i.DELETE?t={widget:"Kekule.Widget.Button",htmlClass:r.DATATABLE_DELETE,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_DELETE"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_DELETE"),"#execute":this.reactOperDeleteBind}:e===i.INSERT&&(t={widget:"Kekule.Widget.Button",htmlClass:r.DATATABLE_INSERT,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_INSERT"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_INSERT"),"#execute":this.reactOperInsertBind}),t&&(t.internalName=e),t},hasExternalDataProvider:function(){return!!this.getDataPager()},needSort:function(){return this.getSortFields()||this.getSortFunc()},sortData:function(){var e=this.getData()||[];if(this.needSort()&&!this.hasExternalDataProvider()){var t=Kekule.ArrayUtils.clone(e);return Kekule.ArrayUtils.sortHashArray(t,this.getSortFields()),t}return e},prepareData:function(){var e={},t=this.sortData();e.data=t;var i=function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=Kekule.ObjUtils.getOwnedFieldNames(e[r]);Kekule.ArrayUtils.pushUnique(t,n)}var o=[];for(r=0,i=t.length;r<i;++r)o.push({name:t[r],text:t[r]});return o};this.getColumns()?e.columns=Kekule.ArrayUtils.clone(this.getColumns()):e.columns=i(t);for(var n=0;n<e.columns.length;){var o=e.columns[n];if("string"==typeof o&&(o={name:o}),o.name===this.COLNAME_OPER)e.columns[n]={name:"",text:"",disableInteract:!0,isOperCol:!0,colClassName:r.DATATABLE_OPER_COL,className:r.DATATABLE_OPER_CELL};else if(o.name===this.COLNAME_CHECK)e.columns[n]={name:"",text:"",disableInteract:!0,isCheckCol:!0,colClassName:r.DATATABLE_CHECK_COL,className:r.DATATABLE_CHECK_CELL};else if(o.name===this.COLNAME_ALL){var a=i(t);a.unshift(1),a.unshift(n),e.columns.splice.apply(e.columns,a)}else o.colClassName=r.DATATABLE_DATA_COL+" "+(o.colClassName||""),o.className=r.DATATABLE_DATA_CELL+" "+(o.className||"");++n}if(this.needSort()&&!this.getSortFunc())for(var s=this.getSortFields(),l=(n=0,e.columns.length);n<l;++n){var u=e.columns[n].name;s.indexOf(u)>=0?e.columns[n].sorting=1:s.indexOf(this.PREFIX_SORT_DESC+u)>=0?e.columns[n].sorting=-1:e.columns[n].sorting=0}return e},activeRowChanged:function(e,i){var n=Kekule.Widget.DataTable.OperColShowMode,o=this.getOperColShowMode();e&&(t.removeClass(e,r.STATE_ACTIVE),o!==n.ACTIVE&&o!==n.HOVER||this.hideRowOperToolbar(e)),i&&(t.addClass(i,r.STATE_ACTIVE),o!==n.ACTIVE&&o!==n.HOVER||this.showRowOperToolbar(i))},hoverRowChanged:function(e,i){var n=Kekule.Widget.DataTable.OperColShowMode,o=this.getOperColShowMode();e&&(t.removeClass(e,r.STATE_HOVER),o===n.HOVER&&e!==this.getActiveRow()&&this.hideRowOperToolbar(e)),i&&(t.addClass(i,r.STATE_HOVER),o===n.HOVER&&this.showRowOperToolbar(i))},getParentCell:function(t){return e.isDescendantOf(t,this.getElement())?e.getNearestAncestorByTagName(t,"td",!0):null},getParentHeadCell:function(t){return e.isDescendantOf(t,this.getElement())?e.getNearestAncestorByTagName(t,"th",!0):null},getParentRow:function(t){return e.isDescendantOf(t,this.getElement())?e.getNearestAncestorByTagName(t,"tr",!0):null},getColCount:function(){return(this.getColumns()||[]).length},getRowCount:function(){return(this.getData()||[]).length},getDataRows:function(){var e=this.getElement().getElementsByTagName("tbody")[0];return e&&e.getElementsByTagName("tr")},getCheckedRows:function(){for(var e=[],t=this.getDataRows(),r=0,i=t.length;r<i;++r)this.isRowChecked(t[r])&&e.push(t[r]);return e},getRowData:function(e){return e?e[this.ROWDATA_FIELD]:null},isRowChecked:function(e){var t=this.getRowCheckBox(e);return t&&t.getChecked&&t.getChecked()},getRowCheckBox:function(e){return e&&e[this.ROW_CHECKBOX_FIELD]},getRowOperToolbar:function(e){return e?e[this.ROW_OPER_TOOLBAR_FIELD]:null},showRowOperToolbar:function(e){var t=this.getRowOperToolbar(e);t&&t.setVisible(!0)},hideRowOperToolbar:function(e){var t=this.getRowOperToolbar(e);t&&t.setVisible(!1)},dataPagerChanged:function(e,t){t&&(t.removeEventListener("pageRetrieve",this.reactPagerRetrieve,this),t.removeEventListener("dataFetched",this.reactPagerFetched,this),t.removeEventListener("dataError",this.reactPagerError,this)),e&&(e.addEventListener("pageRetrieve",this.reactPagerRetrieve,this),e.addEventListener("dataFetched",this.reactPagerFetched,this),e.addEventListener("dataError",this.reactPagerError,this),this.setData(e.getCurrPageData()))},reactPagerRetrieve:function(e){this.reportMessage&&(this._loadingDataMsg=this.reportMessage(Kekule.$L("WidgetTexts.MSG_RETRIEVING_DATA"),Kekule.Widget.MsgType.INFO))},reactPagerFetched:function(e){this.setData(e.data),this._loadingDataMsg&&this.removeMessage&&this.removeMessage(this._loadingDataMsg)},reactPagerError:function(e){this._loadingDataMsg&&this.removeMessage&&this.removeMessage(this._loadingDataMsg),this.flashMessage&&this.flashMessage(e.error.message||e.error,Kekule.Widget.MsgType.ERROR)},reactOperEdit:function(e){return this.reactOperExecute(n.EDIT,e)},reactOperDelete:function(e){return this.reactOperExecute(n.DELETE,e)},reactOperInsert:function(e){return this.reactOperExecute(n.INSERT,e)},reactOperExecute:function(e,t){var r=t.target,i=this.getParentRow(r.getElement()),n=this.getRowData(i);return this.doReactOperExecute(e,n,i,t)},doReactOperExecute:function(e,t,r,i){},react_click:function(e){this.tryApplySuper("react_click",[e]);var t=e.getTarget(),r=this.getParentHeadCell(t);if(r)this._autoSortOnHeadCell(r);else if(this.getEnableActiveRow()){var i=this.getParentCell(t);i&&this.setActiveCell(i)}},react_pointerover:function(e){this.tryApplySuper("react_pointerover",[e]);var t=e.getTarget();if(this.getEnableActiveRow()){var r=this.getParentCell(t);r?this.setHoverCell(r):this.setHoverCell(null)}},react_pointerleave:function(e){this.tryApplySuper("react_pointerleave",[e]);e.getTarget();this.getEnableActiveRow()&&this.setHoverCell(null)},_autoSortOnHeadCell:function(e){if(e&&this.getEnableHeadInteraction()){var t=e[this.COLDEF_FIELD];if(t&&!t.disableInteract){var r=t.name;1===t.sorting&&(r=this.PREFIX_SORT_DESC+r),this.setSortFields([r])}}},load:function(e,t,r,i){this.beginUpdate();try{this.setData(e),this.setColumns(t),this.setSortFields(r?Kekule.ArrayUtils.toArray(r):null),this.setSortFunc(i)}finally{this.endUpdate()}return this},reload:function(){return this.recreateChildContent(),this}}),Kekule.Widget.DataTable.OperColShowMode={NONE:"none",ACTIVE:"active",HOVER:"hover",ALL:"all"},Kekule.Widget.DataTable.Components={EDIT:"edit",DELETE:"delete",INSERT:"insert"};var n=Kekule.Widget.DataTable.Components;Kekule.Widget.PageNavigator=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.PageNavigator",initProperties:function(){this.defineProp("components",{dataType:DataType.ARRAY}),this.defineProp("firstIndex",{dataType:DataType.INT}),this.defineProp("lastIndex",{dataType:DataType.INT}),this.defineProp("currIndex",{dataType:DataType.INT}),this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(e){var t=this.getDataPager();t!==e&&(this.setPropStoreFieldValue("dataPager",e),this.dataPagerChanged(e,t))}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowText(!0),this.setShowGlyph(!0),this.setFirstIndex(1),this.reactFirstBind=this.reactFirst.bind(this),this.reactLastBind=this.reactLast.bind(this),this.reactPrevBind=this.reactPrev.bind(this),this.reactNextBind=this.reactNext.bind(this),this.reactPageInputChangeBind=this.reactPageInputChange.bind(this)},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),Kekule.ArrayUtils.intersect(e,["firstIndex","lastIndex","currIndex"]).length&&this.updateChildComponent(),e.indexOf("currIndex")>=0&&this.invokeEvent("pageChange",{currIndex:this.getCurrIndex()})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.PAGENAVIGATOR},doCreateSubElements:function(e,t){return this.recreateChildContent(e,t)},getDefaultComponents:function(){return[o.FIRST,o.PREV,o.PAGESELECTOR,o.NEXT,o.LAST]},recreateChildContent:function(){for(var e=this.getComponents()||this.getDefaultComponents(),t=[],r=0,i=e.length;r<i;++r){var n=e[r];if(DataType.isObjectValue(n))t.push(n);else{var o=this.getDefaultComponentDefinitionHash(n);o&&t.push(o)}}this.setChildDefs(t),this.updateChildComponent()},getDefaultComponentDefinitionHash:function(e){var t;return(t=e===o.FIRST?{widget:"Kekule.Widget.Button",htmlClass:r.PAGENAVIGATOR_FIRST,text:Kekule.$L("WidgetTexts.CAPTION_FIRST_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_FIRST_PAGE"),"#execute":this.reactFirstBind}:e===o.LAST?{widget:"Kekule.Widget.Button",htmlClass:r.PAGENAVIGATOR_LAST,text:Kekule.$L("WidgetTexts.CAPTION_LAST_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_LAST_PAGE"),"#execute":this.reactLastBind}:e===o.PREV?{widget:"Kekule.Widget.Button",htmlClass:r.PAGENAVIGATOR_PREV,text:Kekule.$L("WidgetTexts.CAPTION_PREV_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_PREV_PAGE"),"#execute":this.reactPrevBind}:e===o.NEXT?{widget:"Kekule.Widget.Button",htmlClass:r.PAGENAVIGATOR_NEXT,text:Kekule.$L("WidgetTexts.CAPTION_NEXT_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_NEXT_PAGE"),"#execute":this.reactNextBind}:e===o.PAGEINPUT?{widget:"Kekule.Widget.TextBox",htmlClass:[r.PAGENAVIGATOR_PAGEINPUT,r.PAGENAVIGATOR_PAGEINDEXER],hint:Kekule.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}:e===o.PAGESELECTOR?{widget:"Kekule.Widget.SelectBox",htmlClass:[r.PAGENAVIGATOR_PAGESELECTOR,r.PAGENAVIGATOR_PAGEINDEXER],hint:Kekule.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}:null)&&(t.internalName=e),t},getComponent:function(e){return this.getChildWidgetByInternalName(e)},setChildComponentEnabled:function(e,t){var r=this.getComponent(e);r&&r.setEnabled(t)},updateChildComponent:function(){var e=this.getFirstIndex()||0,t=this.getLastIndex()||0,r=this.getCurrIndex()||0,i=r<=e,n=r>=t;this.setChildComponentEnabled(o.FIRST,!i),this.setChildComponentEnabled(o.PREV,!i),this.setChildComponentEnabled(o.NEXT,!n),this.setChildComponentEnabled(o.LAST,!n),this.setChildComponentEnabled(o.PAGEINPUT,t>e),this.setChildComponentEnabled(o.PAGESELECTOR,t>e);var a=this.getComponent(o.PAGEINPUT);a&&a.setValue(r);var s=this.getComponent(o.PAGESELECTOR);if(s){for(var l=[],u=e;u<=t;++u)l.push({value:u});s.setItems(l),s.setValue(r)}},dataPagerChanged:function(e,t){t&&(t.removeEventListener("dataFetched",this.reactPagerFetched,this),e.removeEventListener("pageCountChange",this.reactPagerPageCountChange,this)),e&&(e.addEventListener("dataFetched",this.reactPagerFetched,this),e.addEventListener("pageCountChange",this.reactPagerPageCountChange,this),this.updatePageDetails(e),this.setCurrIndex(e.getCurrPageIndex()+this.getFirstIndex()))},reactPagerFetched:function(e){this.setCurrIndex(e.pageIndex+this.getFirstIndex())},reactPagerPageCountChange:function(e){this.updatePageDetails(this.getDataPager())},updatePageDetails:function(e){var t=this.getFirstIndex();this.setLastIndex(e.getPageCount()+t-1)},requestChangeCurrIndex:function(e){var t=this.getDataPager();t?t.switchToPage(e-this.getFirstIndex()):this.setCurrIndex(e)},reactFirst:function(e){this.requestChangeCurrIndex(this.getFirstIndex()||0)},reactLast:function(e){this.requestChangeCurrIndex(this.getLastIndex()||0)},reactPrev:function(e){var t=this.getFirstIndex()||0,r=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.max(r-1,t))},reactNext:function(e){var t=this.getLastIndex()||0,r=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.min(r+1,t))},reactPageInputChange:function(e){var t=e.target.getValue();"string"==typeof t&&(t=parseInt(t));var r=this.getFirstIndex()||0,i=this.getLastIndex()||0;t>=r&&t<=i?this.requestChangeCurrIndex(t):Kekule.error(Kekule.$L("ErrorMsg.PAGE_INDEX_OUTOF_RANGE"))}}),Kekule.Widget.PageNavigator.Components={FIRST:"first",LAST:"last",PREV:"prev",NEXT:"next",PAGEINPUT:"pageInput",PAGESELECTOR:"pageSelector"};var o=Kekule.Widget.PageNavigator.Components}(),function(){"use strict";Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{SYSMSGGROUP:"K-SysMsgGroup"}),Kekule.Widget.SysMsgGroup=Class.create(Kekule.Widget.MsgGroup,{CLASS_NAME:"Kekule.Widget.SysMsgGroup",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMaxMsgCount(6)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.SYSMSGGROUP}}),Kekule.Widget.ExceptionHandler=Class.create(Kekule.ExceptionHandler,{CLASS_NAME:"Kekule.Widget.ExceptionHandler",initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getPropStoreFieldValue("document")||document}}),this.defineProp("sysMsgGroup",{dataType:"Kekule.Widget.SysMsgGroup",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("sysMsgGroup");if(!e){var t=(e=new Kekule.Widget.SysMsgGroup(this.getDocument())).getGlobalManager();e.appendToElem(t.getDefaultContextRootElem()),this.setPropStoreFieldValue("sysMsgGroup",e)}return e}})},throwException:function(e,t){var r,i=Kekule.ExceptionLevel,n=Kekule.Widget.MsgType;if(t||(t=i.ERROR),r="string"==typeof e?e:e.message){var o=t!==i.ERROR&&t!==i.NOT_FATAL_ERROR&&t?t===i.WARNING?n.WARNING:t===i.NOTE?n.INFO:n.NORMAL:n.ERROR;this.getSysMsgGroup().addMessage(r,o)}return this.tryApplySuper("throwException",[e,t])}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.ExceptionHandler),Kekule.X.domReady(function(){Kekule.exceptionHandler=Kekule.Widget.ExceptionHandler.getInstance()})}(),function(){"use strict";var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OPER_HISTORY_TREE_VIEW:"K-OperHistory-TreeView"}),Kekule.Widget.OperHistoryTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.Widget.OperHistoryTreeView",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("objMap",new Kekule.MapEx(!0)),this.setEnableLiveUpdate(!0),this.setEnableMultiSelect(!0),this.setOperHistory(t)},initProperties:function(){this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("operHistory");this.setPropStoreFieldValue("operHistory",e),this.operHistoryChanged(e,t)}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:!1})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.OPER_HISTORY_TREE_VIEW},operHistoryChanged:function(e,t){this.clearChildItems(),this.getObjMap().clear(),t&&this._uninstallRootEventHandler(t),e&&(this._fillTree(e),this._installRootEventHandler(e))},_installRootEventHandler:function(e){e.addEventListener("operChange",this.reactOperChange,this)},_uninstallRootEventHandler:function(e){e.removeEventListener("operChange",this.reactOperChange,this)},reactOperChange:function(e){if(this.getEnableLiveUpdate()){e.target;this._fillTree(e.target)}},_fillTree:function(e){if(e){this.clearChildItems(),this._updateTreeItem(this.appendChildItem(),e);var t=e.getCurrOperation(),r=t?this.getObjMap().get(t):null;this.select(r)}},_getOperChildCount:function(e){return e instanceof Kekule.OperationHistory?e.getOperationCount():e instanceof Kekule.MacroOperation?e.getChildCount():0},_getChildOperAt:function(e,t){return e instanceof Kekule.OperationHistory?e.getOperationAt(t):e instanceof Kekule.MacroOperation?e.getChildAt(t):null},_updateTreeItem:function(e,t){var r={text:this._getOperDisplayTitle(t),obj:t};this.setItemData(e,r),this.getObjMap().set(t,e);for(var i=this.getChildItemCount(e),n=this._getOperChildCount(t),o=0;o<n;++o){var a,s=this._getChildOperAt(t,o);a=o<i?this.getChildItemAt(e,o):this.appendChildItem(e),this._updateTreeItem(a,s)}if(i>n)for(o=i-1;o>=n;--o)this.removeChildItemAt(e,o)},_getOperDisplayTitle:function(e){var t=e.getClassName(),r=e.getTarget?e.getTarget():null;return r&&r.getId&&(t+="(target: "+r.getId()+")"),t}})}(),Kekule.ChemWidget={},Kekule.ChemWidget.AbstractWidget=Kekule.Widget.BaseWidget,Kekule.ChemWidget.ComponentWidgetNames={menu:"menu",newDoc:"newDoc",clearObjs:"clearObjs",loadFile:"loadFile",loadData:"loadData",saveData:"saveData",zoomIn:"zoomIn",zoomOut:"zoomOut",resetZoom:"resetZoom",rotateRight:"rotateRight",rotateLeft:"rotateLeft",rotateX:"rotateX",rotateY:"rotateY",rotateZ:"rotateZ",reset:"reset",molDisplayType:"molDisplayType",molDisplayTypeCondensed:"molDisplayTypeCondensed",molDisplayTypeSkeletal:"molDisplayTypeSkeletal",molDisplayTypeWire:"molDisplayTypeWire",molDisplayTypeSticks:"molDisplayTypeSticks",molDisplayTypeBallStick:"molDisplayTypeBallStick",molDisplayTypeSpaceFill:"molDisplayTypeSpaceFill",molHideHydrogens:"molHideHydrogens",molAutoGenerateCoords:"molAutoGenerateCoords",openEditor:"openEditor",config:"config",objInspector:"objInspector",issueInspector:"issueInspector",undo:"undo",redo:"redo",copy:"copy",cut:"cut",paste:"paste",cloneSelection:"cloneSelection",selectAll:"selectAll",toggleSelect:"toggleSelect",eraseSelection:"eraseSelection",recheckIssues:"recheckIssues",toggleShowAllIssues:"toggleShowAllIssues",dragScroll:"dragScroll",erase:"erase",manipulate:"manipulate",trackInput:"trackInput",molBond:"bond",molAtom:"atom",molFormula:"formula",molAtomAndFormula:"atomAndFormula",molCharge:"charge",textBlock:"textBlock",imageBlock:"imageBlock",molRing:"ring",glyph:"glyph",textImage:"textImage",fontName:"fontName",fontSize:"fontSize",color:"color",textDirection:"textDirection",textAlign:"textAlign",nodeDisplayMode:"nodeDisplayMode"},Kekule.ChemWidget.HtmlClassNames={PREFIX:"K-Chem-",INNER_TOOLBAR:"K-Chem-InnerToolbar"},function(){"use strict";Class.PropertyScope,Kekule.ChemWidget,Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DIALOG_LOADDATA:"K-Chem-Dialog-LoadData",DIALOG_LOADDATA_FORMATBOX:"K-Chem-Dialog-LoadData-FormatBox",DIALOG_LOADDATA_SRCEDITOR_REGION:"K-Chem-Dialog-LoadData-SrcEditorRegion",DIALOG_LOADDATA_SRCEDITOR:"K-Chem-Dialog-LoadData-SrcEditor",DIALOG_LOADDATA_BTN_LOADFROMFILE:"K-Chem-Dialog-LoadData-Btn-LoadFromFile",DIALOG_LOADAPPENDDATA:"K-Chem-Dialog-LoadAppendData",DIALOG_LOADAPPENDDATA_APPENDCHECKBOX:"K-Chem-Dialog-LoadAppendData-AppendCheckBox"}),Kekule.ChemWidget.LoadDataDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.ChemWidget.LoadDataDialog",initialize:function(e,t,r){this._openFileAction=new Kekule.ActionLoadFileData,this._openFileAction.setBinaryDetector(this._detectBinaryFormat),this._openFileAction.update(),this._openFileAction.addEventListener("load",this.reactFileLoad,this),this._sBtnLoadFromFile=Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_FROM_FILE"),this._formatItems=null,this.tryApplySuper("initialize",[e,t||Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG"),r||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]]),this.setResizable&&this.setResizable(!0)},finalize:function(){this._openFileAction.finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:null,getter:function(){var e=this.getDataDetails();return e&&e.data?Kekule.IO.loadTypedData(e.data,e.mimeType,e.fileName):null}}),this.defineProp("allowedFormatIds",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("allowedFormatIds",e),this.updateFormatItems()}}),this.defineProp("defaultFormatId",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("defaultFormatId",e),this.updateFormatItems()}}),this.defineProp("dataDetails",{dataType:DataType.HASH,setter:null,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoAdjustSizeOnPopup(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.DIALOG_LOADDATA},doCreateClientContents:function(t){this.tryApplySuper("doCreateClientContents");var r=this.getDocument();(i=r.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_FORMAT"),t.appendChild(i),i=r.createElement("div"),t.appendChild(i);var i,n=new Kekule.Widget.SelectBox(this);n.addClassName(e.DIALOG_LOADDATA_FORMATBOX),n.appendToElem(i),this._formatSelector=n,this.updateFormatItems(),(i=r.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_SRC"),t.appendChild(i),(i=r.createElement("div")).className=e.DIALOG_LOADDATA_SRCEDITOR_REGION,t.appendChild(i);var o=new Kekule.Widget.TextEditor(this);o.setWrap("off").setAutoWrapThreshold(!0).setFileDroppable(!0),o.setToolbarPos(Kekule.Widget.Position.BOTTOM),o.addClassName(e.DIALOG_LOADDATA_SRCEDITOR),o.appendToElem(i),this.setAutoFocusedObject(o.getTextArea()),this._dataEditor=o},getFormatSelectorItems:function(e){for(var t=[],r=this.getAllowedFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds(),i=this.getDefaultFormatId(),n=0,o=r.length;n<o;++n){var a=Kekule.IO.DataFormatsManager.getFormatInfo(r[n]);if(a){for(var s=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(a.fileExts)),l=0,u=s.length;l<u;++l)s[l]="*."+s[l];var d=s.join(", "),c=a.title;d&&(c+=" ("+d+")");var h=i&&i===a.id;t.push({value:a.id,formatId:a.id,text:c,title:a.mimeType,data:a,selected:h})}}return t.sort(function(e,t){return e.text<t.text?-1:e.text>t.text?1:0}),t},getFileFilters:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r],o=n.data,a=n.text||n.title||n.value,s=Kekule.ArrayUtils.toArray(o.fileExts);t.push({title:a,filter:"."+s.join(",.")})}return t.push(Kekule.NativeServices.FILTER_ALL_SUPPORT),t.push(Kekule.NativeServices.FILTER_ANY),t},updateFormatItems:function(){this._formatItems=this.getFormatSelectorItems(),this._formatSelector.setItems(this._formatItems);var e=this.getFileFilters(this._formatItems);this._openFileAction.setFilters(e)},doSetButtons:function(t){var r=t||[];r.indexOf(this._sBtnLoadFromFile)<0&&r.unshift(this._sBtnLoadFromFile),this.tryApplySuper("doSetButtons",[r]);var i=this.getDialogButton(this._sBtnLoadFromFile);i.setAction(this._openFileAction),i.linkStyleResource(Kekule.Widget.StyleResourceNames.BUTTON_LOAD_FILE),i.addClassName(e.DIALOG_LOADDATA_BTN_LOADFROMFILE),i.setEnabled(this._openFileAction.getEnabled())},reactFileLoad:function(e){var t=e.data,r=e.fileName;try{if(e.success&&Kekule.ObjUtils.notUnset(t)&&r){this.setPropStoreFieldValue("dataDetails",{data:t,fileName:r});var i=Kekule.Widget.DialogButtons.OK;this.close(i)}else null}catch(e){Kekule.error(e)}},open:function(e,t,r){return this.setPropStoreFieldValue("dataDetails",{}),this.tryApplySuper("open",[e,t,r])},close:function(e){var t=this.getDataDetails();if((!t||!t.data&&!t.fileName)&&this.isPositiveResult(e)){var r=this._dataEditor.getValue(),i=this._formatSelector.getSelectedItemData(),n=i.id,o=i.mimeType;try{this.setPropStoreFieldValue("dataDetails",{data:r,mimeType:o,formatId:n})}catch(e){Kekule.raise(e,Kekule.ExceptionLevel.ERROR)}}return this.tryApplySuper("close",[e])},_detectBinaryFormat:function(e,t){if(t&&e){var r=Kekule.UrlUtils.extractFileExt(e),i=Kekule.IO.DataFormatsManager.findFormat(null,r);if(i)return Kekule.IO.ChemDataType.isBinaryType(i.dataType)}return!1}}),Kekule.ChemWidget.LoadOrAppendDataDialog=Class.create(Kekule.ChemWidget.LoadDataDialog,{CLASS_NAME:"Kekule.ChemWidget.LoadOrAppendDataDialog",initialize:function(e,t,r){this._appendCheckBox=null,this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("displayAppendCheckBox",{dataType:DataType.BOOL}),this.defineProp("isAppending",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._appendCheckBox&&this._appendCheckBox.getChecked()},setter:function(e){this._appendCheckBox&&this._appendCheckBox.setChecked(!!e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.DIALOG_LOADAPPENDDATA},doCreateClientContents:function(t){this.tryApplySuper("doCreateClientContents",[t]);this.getDocument();var r=new Kekule.Widget.CheckBox(this);r.addClassName(e.DIALOG_LOADAPPENDDATA_APPENDCHECKBOX),r.setText(Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG_APPENDMODE")),r.appendToElem(t),r.setDisplayed(this.getDisplayAppendCheckBox()),this._appendCheckBox=r},open:function(e,t,r){return this.setIsAppending(!1),this._appendCheckBox.setDisplayed(this.getDisplayAppendCheckBox()),this.tryApplySuper("open",[e,t,r])}})}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,r=Kekule.Widget.HtmlClassNames,i=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{PERIODIC_TABLE:"K-Chem-Periodic-Table",PERIODIC_TABLE_MINI:"K-Chem-Periodic-Table-Mini",PERIODIC_TABLE_LEGEND:"K-Chem-Periodic-Table-Legend",PERIODIC_TABLE_LEGEND_CONTENT:"K-Chem-Periodic-Table-Legend-Content",PERIODIC_TABLE_LEGEND_COLORS:"K-Chem-Periodic-Table-Legend-Colors",PERIODIC_TABLE_LEGEND_COLOR:"K-Chem-Periodic-Table-Legend-Color",PERIODIC_TABLE_MAINTABLE:"K-Chem-Periodic-Table-MainTable",PERIODIC_TABLE_EXTRATABLE:"K-Chem-Periodic-Table-ExtraTable",PERIODIC_TABLE_ELEM_CELL:"K-Chem-Periodic-Table-Elem-Cell",PERIODIC_TABLE_ELEM_STUBSCELL:"K-Chem-Periodic-Table-Elem-StubsCell",PERIODIC_TABLE_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_HEAD_CELL:"K-Chem-Periodic-Table-Head-Cell",PERIODIC_TABLE_HEAD_CELL_CONTENT:"K-Chem-Periodic-Table-Head-Cell-Content",PERIODIC_TABLE_HEAD_CELL_GROUP:"K-Chem-Periodic-Table-Head-Cell-Group",PERIODIC_TABLE_HEAD_CELL_PERIOD:"K-Chem-Periodic-Table-Head-Cell-Period",ELEM_SYMBOL:"K-Chem-Elem-Symbol",ELEM_SYMBOL_STUBS:"K-Chem-Elem-Symbol-Stubs",ELEM_NAME:"K-Chem-Elem-Name",ATOMIC_NUM:"K-Chem-Atomic-Num",ATOMIC_WEIGHT:"K-Chem-Atomic-Weight"}),Kekule.globalOptions.add("chemWidget.periodicTable",{displayedComponents:["symbol","name","atomicNumber","groupHead","legend"]}),Kekule.ChemWidget.PeriodicTable=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.PeriodicTable",BINDABLE_TAG_NAMES:["span","div"],ELEM_DATA_FIELD:"__$elemData__",MAX_GROUP:18,MAX_PERIOD:7,LA_SERIES:["La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu"],AC_SERIES:["Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr"],initialize:function(e,t){this.setPropStoreFieldValue("displayedComponents",t||this.getDefaultDisplayedComponents()),this._elemCells=[],this._selectedElemCells=[],this.tryApplySuper("initialize",[e]),this.setEnableSelect(!0),this.setEnableMultiSelect(!0)},initProperties:function(){this.defineProp("displayedComponents",{dataType:DataType.ARRAY,getter:function(){return this.getPropStoreFieldValue("displayedComponents")||this.getDefaultDisplayedComponents()}}),this.defineProp("startingAtomNum",{dataType:DataType.INT}),this.defineProp("endingAtomNum",{dataType:DataType.INT}),this.defineProp("startingElementSymbol",{dataType:DataType.INT,serializable:!1,getter:function(){var e=this.getStartingAtomNum();return e&&Kekule.ChemicalElementsDataUtil.getElementSymbol(e)},setter:function(e){this.setStartingAtomNum(e&&Kekule.ChemicalElementsDataUtil.getAtomicNumber(e)||null)}}),this.defineProp("endingElementSymbol",{dataType:DataType.INT,serializable:!1,getter:function(){var e=this.getEndingAtomNum();return e&&Kekule.ChemicalElementsDataUtil.getElementSymbol(e)},setter:function(e){this.setEndingAtomNum(e&&Kekule.ChemicalElementsDataUtil.getAtomicNumber(e)||null)}}),this.defineProp("enabledElementSymbols",{dataType:DataType.ARRAY}),this.defineProp("disabledElementSymbols",{dataType:DataType.ARRAY}),this.defineProp("useMiniMode",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useMiniMode",e),e?this.addClassName(i.PERIODIC_TABLE_MINI):this.removeClassName(i.PERIODIC_TABLE_MINI)}}),this.defineProp("enableSelect",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableSelect")||this.getEnableMultiSelect()}}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL}),this.defineProp("selected",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(){return this.getSelection()?this.getSelection()[0]:null}}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){for(var e=[],t=this._selectedElemCells||[],r=0,i=t.length;r<i;++r){var n=t[r][this.ELEM_DATA_FIELD];n&&e.push(n)}return e}}),this.defineProp("selectedSymbol",{dataType:DataType.STRING,getter:function(){return this.getSelectedSymbols()[0]},setter:function(e){this.setSelectedSymbols([e])}}),this.defineProp("selectedSymbols",{dataType:DataType.ARRAY,getter:function(){var e=this.getSelection();if(e){for(var t=[],r=0,i=e.length;r<i;++r)t.push(e[r].symbol);return t}return[]},setter:function(e){this.selectSymbols(e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.PERIODIC_TABLE},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.createMainTable(e,t);return r.concat([i])},doObjectChange:function(e){var t=["displayedComponents","startingAtomNum","endingAtomNum"];Kekule.ArrayUtils.intersect(e,t).length&&this.recreateMainTable(),t=["enabledElementSymbols","disabledElementSymbols"],Kekule.ArrayUtils.intersect(e,t).length&&this.updateCellEnableStates()},getDefaultDisplayedComponents:function(){return Kekule.globalOptions.chemWidget.periodicTable.displayedComponents},getShowElemSymbol:function(){return this.getDisplayedComponents().indexOf("symbol")>=0},getShowElemName:function(){return this.getDisplayedComponents().indexOf("name")>=0},getShowAtomicNum:function(){return this.getDisplayedComponents().indexOf("atomicNumber")>=0},getShowAtomicWeight:function(){return this.getDisplayedComponents().indexOf("atomicWeight")>=0},getShowGroupHead:function(){return this.getDisplayedComponents().indexOf("groupHead")>=0},getShowPeriodHead:function(){return this.getDisplayedComponents().indexOf("periodHead")>=0},getShowLegend:function(){return this.getDisplayedComponents().indexOf("legend")>=0},recreateMainTable:function(){this.deselectAll();var t=this.getElement();e.clearChildContent(t),this.createMainTable(t.ownerDocument,t)},createMainTable:function(t,n){var o=Kekule.chemicalElementsData,a=[];this._elemCells=[];for(var s=[],l=[],u=t.createElement("table"),d=0;d<=this.MAX_PERIOD;++d){for(var c=t.createElement("tr"),h=[],p=0;p<=this.MAX_GROUP;++p){var g=t.createElement("td");c.appendChild(g),h.push(g)}u.appendChild(c),a.push(h)}var f=t.createElement("table");for(d=0;d<2;++d){for(c=t.createElement("tr"),h=[],p=0;p<this.LA_SERIES.length;++p){g=t.createElement("td");c.appendChild(g),h.push(g)}f.appendChild(c),s.push(h)}for(var C=this.getStartingAtomNum()||0,m=this.getEndingAtomNum()||3e5,T=0,E=o.length;T<E;++T){var _=o[T],S=_.atomicNumber;if(!(S<C||S>m)){var O=_.symbol,y=_.period,A=_.group,I=_.chemicalSerie.replace(/\s/g,"");Kekule.ArrayUtils.pushUnique(l,_.chemicalSerie);var k=this.LA_SERIES.indexOf(O),b=this.AC_SERIES.indexOf(O);k>=0?g=s[0][k]:b>=0?g=s[1][b]:y&&A&&(g=a[y][A]),g&&(g.className=i.PERIODIC_TABLE_ELEM_CELL,g.appendChild(this.createElemCellContent(t,_,I.upperFirst())),g[this.ELEM_DATA_FIELD]=_,this._elemCells.push(g)),0!==k&&0!==b||((g=a[y][A]).className=i.PERIODIC_TABLE_ELEM_STUBSCELL,g.appendChild(this.createElemCellStubsContent(t,_,I.upperFirst())))}}if(this.getShowGroupHead()){var v=["IA","IIA","IIIB","IVB","VB","VIB","VIIB","","VIII","","IB","IIB","IIIA","IVA","VA","VIA","VIIA","VIIIA"];for(p=1;p<=this.MAX_GROUP;++p){(g=a[d=1===p||18===p?0:2===p||p>=13?1:3][p]).className=i.PERIODIC_TABLE_HEAD_CELL+" "+i.PERIODIC_TABLE_HEAD_CELL_GROUP,g.appendChild(this.createHeadContent(t,v[p-1]))}}if(this.getShowPeriodHead())for(d=1;d<=this.MAX_PERIOD;++d){(g=a[d][0]).className=i.PERIODIC_TABLE_HEAD_CELL+" "+i.PERIODIC_TABLE_HEAD_CELL_PERIOD,g.appendChild(this.createHeadContent(t,d))}if(n.appendChild(u),this.getShowLegend()){var R=t.createElement("a");R.href="javascript:void(0)",R.className=i.PERIODIC_TABLE_LEGEND+" "+r.CORNER_ALL,e.setElementText(R,Kekule.$L("ChemWidgetTexts.LEGEND_CAPTION"));var D=t.createElement("div");D.className=i.PERIODIC_TABLE_LEGEND_CONTENT+" "+r.CORNER_ALL;var N={symbol:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_SYMBOL"),atomicNumber:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_NUM"),naturalMass:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_WEIGHT"),name:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_NAME")},P=this.createElemCellContent(t,N,i.PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT);D.appendChild(P);var M=t.createElement("div");M.className=i.PERIODIC_TABLE_LEGEND_COLORS;for(T=0,E=l.length;T<E;++T){var K=t.createElement("div");K.className=i.PERIODIC_TABLE_LEGEND_COLOR+" "+l[T].replace(/\s/g,""),e.setElementText(K,l[T]),M.appendChild(K)}D.appendChild(M),R.appendChild(D),n.appendChild(R)}return n.appendChild(f),this.updateCellEnableStates(),u},createElemCellContent:function(e,t,r){var n=e.createElement("div"),o=i.PERIODIC_TABLE_ELEM_CELL_CONTENT;if(r&&(o+=" "+r),n.className=o,this.getShowAtomicNum()&&n.appendChild(this.createElemContentComponent(e,t.atomicNumber,i.ATOMIC_NUM)),this.getShowAtomicWeight()){var a=t.naturalMass;if(a){var s="number"==typeof a?a.toFixed(3):a;n.appendChild(this.createElemContentComponent(e,s,i.ATOMIC_WEIGHT))}else n.appendChild(this.createElemContentComponent(e," ",i.ATOMIC_WEIGHT))}return this.getShowElemSymbol()&&n.appendChild(this.createElemContentComponent(e,t.symbol,i.ELEM_SYMBOL)),this.getShowElemName()&&n.appendChild(this.createElemContentComponent(e,t.name,i.ELEM_NAME)),n},createElemCellStubsContent:function(e,t,r){var n,o,a,s=e.createElement("div");return s.className=i.PERIODIC_TABLE_ELEM_CELL_CONTENT+" "+(r||""),a=t.chemicalSerie,"La"===t.symbol?(n="57-71",o="La-Lu"):(n="89-103",o="Ac-Lr"),this.getShowAtomicNum()&&s.appendChild(this.createElemContentComponent(e,n,i.ATOMIC_NUM)),this.getShowElemSymbol()&&s.appendChild(this.createElemContentComponent(e,o,i.ELEM_SYMBOL_STUBS,!0)),this.getShowElemName()&&s.appendChild(this.createElemContentComponent(e,a,i.ELEM_NAME)),s},createElemContentComponent:function(t,r,i,n){var o=t.createElement("span");if(o.className=i,n){var a=t.createElement("span");o.appendChild(a)}return e.setElementText(a||o,r),o},createHeadContent:function(t,r,n){var o=t.createElement("div");return o.className=i.PERIODIC_TABLE_HEAD_CELL_CONTENT+" "+(n||""),e.setElementText(o,r),o},updateCellEnableStates:function(){var e=this.getEnabledElementSymbols()||[],t=!e.length&&this.getDisabledElementSymbols()||[];if(t.length||e.length)for(var r=this._elemCells,i=0,n=r.length;i<n;++i){var o=this._getCellData(r[i]).symbol;e.length?e.indexOf(o)<0&&this.setCellEnableState(r[i],!1):t.length&&t.indexOf(o)>=0&&this.setCellEnableState(r[i],!1)}},setCellEnableState:function(e,i){i?(t.removeClass(e,r.STATE_DISABLED),this._getCellData(e).disabled=null):(t.addClass(e,r.STATE_DISABLED),this._getCellData(e).disabled=!0)},_getCellData:function(e){return e[this.ELEM_DATA_FIELD]},_isCellDisabled:function(e){return!!this._getCellData(e).disabled},_getAtomCellElem:function(t){var r=e.getNearestAncestorByTagName(t,"td",!0);return r&&this._elemCells.indexOf(r)>=0?r:null},_getCellElemOfSymbol:function(e){for(var t=this._elemCells,r=0,i=t.length;r<i;++r){var n=t[r];if(n[this.ELEM_DATA_FIELD].symbol===e)return n}return null},isCellSelected:function(e){return this._selectedElemCells.indexOf(e)>=0},selectCell:function(e){e&&(t.addClass(e,r.STATE_SELECTED),Kekule.ArrayUtils.pushUnique(this._selectedElemCells,e),this.invokeEvent("select",{elemData:e[this.ELEM_DATA_FIELD]}))},deselectCell:function(e){e&&(t.removeClass(e,r.STATE_SELECTED),Kekule.ArrayUtils.remove(this._selectedElemCells,e),this.invokeEvent("deselect",{elemData:e[this.ELEM_DATA_FIELD]}))},toggleCell:function(e){this.isCellSelected(e)?this.deselectCell(e):this.selectCell(e)},deselectAll:function(){for(var e=this._selectedElemCells,t=e.length-1;t>=0;--t)this.deselectCell(e[t]);return this},selectSymbols:function(e){this.deselectAll();for(var t=Kekule.ArrayUtils.toArray(e),r=0,i=t.length;r<i;++r){var n=this._getCellElemOfSymbol(t[r]);n&&this.selectCell(n)}return this},react_click:function(e){if(this.getEnableSelect()){var t=e.getTarget(),r=this._getAtomCellElem(t);if(r&&!this._isCellDisabled(r))return this.getEnableMultiSelect()?this.toggleCell(r):(this.deselectAll(),this.selectCell(r)),!0}this.tryApplySuper("react_click",[e])}})}(),function(){"use strict";var e=Class.PropertyScope,t=Kekule.ArrayUtils,r=(Kekule.DomUtils,Kekule.ZoomUtils),i=(Kekule.ChemWidget,Kekule.Widget.HtmlClassNames),n=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DISPLAYER_DRAWCONTEXT_PARENT:"K-Chem-Displayer-DrawContext-Parent",ACTION_MOL_DISPLAY_TYPE:"K-Chem-MolDisplayType",ACTION_MOL_DISPLAY_SKELETAL:"K-Chem-MolDisplaySkeletal",ACTION_MOL_DISPLAY_CONDENSED:"K-Chem-MolDisplayCondensed",ACTION_MOL_DISPLAY_WIRE:"K-Chem-MolDisplayWire",ACTION_MOL_DISPLAY_BALLSTICK:"K-Chem-MolDisplayBallStick",ACTION_MOL_DISPLAY_STICKS:"K-Chem-MolDisplaySticks",ACTION_MOL_DISPLAY_SPACEFILL:"K-Chem-MolDisplaySpaceFill",ACTION_MOL_HIDE_HYDROGENS:"K-Chem-MolHideHydrogens",ACTION_MOL_AUTO_COORD_GENERATION:"K-Chem-MolAutoCoordGeneration",ACTION_ZOOMIN:"K-Chem-ZoomIn",ACTION_ZOOMOUT:"K-Chem-ZoomOut",ACTION_RESET:"K-Chem-Reset",ACTION_COPY:"K-Chem-Copy",ACTION_RESET_ZOOM:"K-Chem-ResetZoom",ACTION_LOADFILE:"K-Chem-LoadFile",ACTION_LOADDATA:"K-Chem-LoadData",ACTION_SAVEFILE:"K-Chem-SaveFile",ACTION_CLEAROBJS:"K-Chem-ClearObjs",ACTION_CONFIG:"K-Chem-Config",DIALOG_CHOOSE_FILE_FORAMT:"K-Chem-Dialog-Choose-File-Format",DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX:"K-Chem-Dialog-Choose-File-Format-FormatBox",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER_REGION:"K-Chem-Dialog-Choose-File-Format-PreviewerRegion",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER:"K-Chem-Dialog-Choose-File-Format-Previewer"}),Kekule.ChemWidget.ChemObjDisplayerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerConfigs",initProperties:function(){this.addConfigProp("ioConfigs","Kekule.ChemWidget.ChemObjDisplayerIOConfigs"),this.addConfigProp("environment2DConfigs","Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs"),this.addConfigProp("environment3DConfigs","Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("ioConfigs",new Kekule.ChemWidget.ChemObjDisplayerIOConfigs),this.setPropStoreFieldValue("environment2DConfigs",new Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs),this.setPropStoreFieldValue("environment3DConfigs",new Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs)}}),Kekule.ChemWidget.ChemObjDisplayerIOConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerIOConfigs",initProperties:function(){this.addBoolConfigProp("canonicalizeBeforeSave",!0),this.addBoolConfigProp("autoGenerateCoordsAfterLoad",!0)}}),Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs",initProperties:function(){this.addBoolConfigProp("antialias",!1),this.addFloatConfigProp("antialiasBlurRatio",0),this.addFloatConfigProp("overSamplingRatio",1)}}),Kekule.ChemWidget.ChemObjDisplayer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer",initialize:function(e,t,r,i){this._paintFlag=0,this._bgColorMap={},this._contextTransformOpsMap=new Kekule.MapEx,this._reactChemObjDrawBind=this._reactChemObjDraw.bind(this),this.setPropStoreFieldValue("resetAfterLoad",!0),this.setPropStoreFieldValue("renderType",r||Kekule.Render.RendererType.R2D),this.setPropStoreFieldValue("displayerConfigs",i||this.createDefaultConfigs()),this.tryApplySuper("initialize",[e]),t&&this.setChemObj(t),this.setEnableLoadNewFile(!0)},doFinalize:function(){this.clearSubViews(),this.setPropStoreFieldValue("chemObj",null),this.getPainter().finalize();var e=this.getPropStoreFieldValue("drawBridge"),t=this.getPropStoreFieldValue("drawContext");t&&e&&e.releaseContext(t),e&&e.finalize&&e.finalize(),this.setPropStoreFieldValue("drawBridge",null),this.setPropStoreFieldValue("drawContext",null),this._contextTransformOpsMap&&this._contextTransformOpsMap.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("displayerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:!1,scope:e.PUBLIC}),this.defineProp("enableLoadNewFile",{dataType:DataType.BOOL}),this.defineProp("allowedInputFormatIds",{dataType:DataType.ARRAY}),this.defineProp("allowedOutputFormatIds",{dataType:DataType.ARRAY}),this.defineProp("defaultInputFormatId",{dataType:DataType.STRING,serializable:!1}),this.defineProp("defaultOutputFormatId",{dataType:DataType.STRING,serializable:!1}),this.defineProp("standardizationOptions",{dataType:DataType.HASH}),this.defineProp("resetAfterLoad",{dataType:DataType.BOOL}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PUBLISHED,setter:function(e){var t=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",e),this.chemObjChanged(e,t)}}),this.defineProp("chemObjData",{dataType:DataType.STRING,serializable:!1,getter:null,setter:function(e){var t,r;(t="object"==typeof e?e:JSON.parse(e))&&((r=t.format?Kekule.IO.loadFormatData(t.data,t.format):t.mimeType?Kekule.IO.loadMimeData(t.data,t.mimeType):null)&&this._tryAutoGenerateChemObjCoordsAndLoad(r))}}),this.defineProp("chemObjLoaded",{dataType:DataType.BOOL,serializable:!1,scope:e.PUBLIC,setter:null,getter:function(){return this.getChemObj()&&this.getPropStoreFieldValue("chemObjLoaded")}}),this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,enumSource:Kekule.Render.RendererType,scope:e.PUBLISHED,setter:function(e){if(this.getAllowRenderTypeChange()){var t=this.getRenderType();e!==t&&(this.setPropStoreFieldValue("renderType",e),this.resetRenderType(t,e))}else Kekule.error(Kekule.$L("ErrorMsg.RENDER_TYPE_CHANGE_NOT_ALLOWED"))}}),this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:!1,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("renderConfigs");return e||(e=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()),e},setter:function(e){this.setPropStoreFieldValue("renderConfigs",e);var t=this.getPropStoreFieldValue("painter");t&&t.setRenderConfigs(this.getRenderConfigs())}}),this.defineProp("backgroundColor",{dataType:DataType.STRING,scope:e.PUBLISHED,setter:function(e){this.setPropStoreFieldValue("backgroundColor",e),this._bgColorMap[this.getRenderType().toString()]=e,this.backgroundColorChanged()}}),this.defineProp("inheritedRenderStyles",{dataType:DataType.ARRAY,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("inheritedRenderStyles");return e||(e=[],this.setPropStoreFieldValue("inheritedRenderStyles",e)),e},setter:function(e){this.setPropStoreFieldValue("inheritedRenderStyles",e||[]),this.requestRepaint()}}),this.defineProp("inheritedRenderColor",{dataType:DataType.BOOL,scope:e.PUBLISHED,getter:function(){var e=this.getInheritedRenderStyles();return!!(e&&e.indexOf("color")>=0)},setter:function(e){if(!!e!==this.getInheritedRenderColor()){var t=this.getInheritedRenderStyles();e?t.push("color"):Kekule.ArrayUtils.remove(t,"color"),this.setInheritedRenderStyles(t)}}}),this.defineProp("inheritedRenderBackgroundColor",{dataType:DataType.BOOL,scope:e.PUBLISHED,getter:function(){var e=this.getInheritedRenderStyles();return!!(e&&e.indexOf("backgroundColor")>=0)},setter:function(e){if(!!e!==this.getInheritedRenderBackgroundColor()){var t=this.getInheritedRenderStyles();e?t.push("backgroundColor"):Kekule.ArrayUtils.remove(t,"backgroundColor"),this.setInheritedRenderStyles(t)}}}),this.defineProp("enableCustomCssProperties",{dataType:DataType.BOOL,setter:function(e){e!=this.getEnableCustomCssProperties()&&(this.setPropStoreFieldValue("enableCustomCssProperties",!!e),this.requestRepaint())}}),this.defineProp("transformParams",{dataType:DataType.HASH,serializable:!1,scope:e.PUBLIC,getter:function(){var e=Object.extend({},this.getDrawOptions());return e.screenCoordOffset=this.getBaseCoordOffset(),e},setter:function(e){var t=e||{};this.setDrawOptions(t),this.setBaseCoordOffset(t.baseCoordOffset),this.drawOptionChanged()}}),this.defineProp("drawOptions",{dataType:DataType.HASH,serializable:!1,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("drawOptions");return e||(e={},this.setPropStoreFieldValue("drawOptions",e)),e},setter:function(e){this.setPropStoreFieldValue("drawOptions",e),this.drawOptionChanged()}}),this.defineProp("zoom",{dataType:DataType.FLOAT,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).zoom},setter:function(e){return this.zoomTo(e),this}}),this.defineProp("initialZoom",{dataType:DataType.FLOAT}),this.defineProp("autofit",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).autofit},setter:function(e){var t=this.getDrawOptions()||{};return t.autofit=e,this.setDrawOptions(t)}}),this.defineProp("autoShrink",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).autoShrink},setter:function(e){var t=this.getDrawOptions()||{};return t.autoShrink=e,this.setDrawOptions(t)}}),this.defineProp("moleculeDisplayType",{dataType:DataType.INT,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).moleculeDisplayType},setter:function(e){return this.getDrawOptions().moleculeDisplayType=e,this.drawOptionChanged(),this}}),this.defineProp("hideHydrogens",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).hideHydrogens},setter:function(e){return this.getDrawOptions().hideHydrogens=!!e,this.drawOptionChanged(),this}}),this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL,serializable:!1,scope:e.PUBLIC,getter:function(){return Kekule.oneOf(this.getDrawOptions().allowCoordBorrow,this.getRenderConfigs().getGeneralConfigs().getAllowCoordBorrow())}}),this.defineProp("autoSize",{dataType:DataType.BOOL,serializable:!1,setter:function(e){e!=this.getAutoSize()&&(this.setPropStoreFieldValue("autoSize",e),e&&this.allowAutoSize()&&this.drawOptionChanged())}}),this.defineProp("padding",{dataType:DataType.INT,serializable:!1,setter:function(e){e!=this.getPadding()&&(this.setPropStoreFieldValue("padding",e),this.getDrawOptions().autofitContextPadding=e,this.drawOptionChanged())}}),this.defineProp("baseCoordOffset",{dataType:DataType.Hash,serializable:!1,setter:function(e){this.setPropStoreFieldValue("baseCoordOffset",e),this.getChemObjLoaded()&&this.repaint()}}),this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:!1,scope:e.PRIVATE,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("drawBridge");return t||this.__$drawBridgeInitialized$__||(this.__$drawBridgeInitialized$__=!0,t=this.createDrawBridge(),this.setPropStoreFieldValue("drawBridge",t)),t}}),this.defineProp("drawContext",{dataType:DataType.OBJECT,serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("drawContext");if(!e){var t=this.getDrawBridge();if(t){var r=this.getDrawContextParentElem();if(!r)return null;var i=Kekule.HtmlElementUtils.getElemOffsetDimension(r);e=t.createContext(r,i.width,i.height,this.getContextCreationParams(this.getRenderType(),t)),this.setPropStoreFieldValue("drawContext",e)}}return e}}),this.defineProp("painter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("painter");return e||(e=this.createNewPainter()),e}}),this.defineProp("rootRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPainter();return e?e.getRenderer():null}}),this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null,getter:function(){var e=this.getRootRenderer();return e&&e.getBoundInfoRecorder()}}),this.defineProp("subViews",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("subViews");return!t&&e&&(t=[],this.setPropStoreFieldValue("subViews",t)),t}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setStandardizationOptions({unmarshalSubFragments:!1,clearHydrogens:!1})},doEndUpdate:function(e){this.tryApplySuper("doEndUpdate",[e]),this._requestRepainting&&this.repaint(this._requestRepainting.overrideOptions)},elementBound:function(e){this.setObserveElemResize(!0)},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),e&&this.setChemObj(this.getChemObj())},doFileDragDrop:function(e){if(e){var t=this;return function(){Kekule.IO.loadFileData(e[0],function(e,r){r&&t.setChemObj(e)})}.defer(),!0}return this.tryApplySuper("doFileDragDrop")},notifyStyleAttribChanged:function(e){this.tryApplySuper("notifyStyleAttribChanged",[e]),(this.getInheritedRenderStyles()||[]).length&&this.requestRepaint()},getAllowRenderTypeChange:function(){return!1},resetRenderType:function(e,t){var r=this.getChemObj(),i=this.getPropStoreFieldValue("drawBridge"),n=this.getPropStoreFieldValue("drawContext");i&&n&&i.releaseContext(n),this.setPropStoreFieldValue("drawContext",null),this.setPropStoreFieldValue("drawBridge",null),this.__$drawBridgeInitialized$__=!1;var o=this.getBackgroundColorOfType(t);this.getDrawOptions().moleculeDisplayType=this.getDefaultMoleculeDisplayType(t),this.setPropStoreFieldValue("backgroundColor",o),this.backgroundColorChanged(!0),this._doLoadOnObj(r,{refreshOnly:!0}),this.resetDisplay()},resetRenderEnvironment:function(){return this.resetRenderType(null,this.getRenderType()),this},getDisplayerEnvironmentConfigs:function(){return this.getCoordMode()===Kekule.CoordMode.COORD3D?this.getDisplayerConfigs().getEnvironment3DConfigs():this.getDisplayerConfigs().getEnvironment2DConfigs()},getContextCreationParams:function(e,t){var r=this.getRenderConfigs(),i=this.getDisplayerConfigs();return e===Kekule.Render.RendererType.R3D?{alpha:!0,antialias:r.getEnvironmentConfigs().getAntialias()}:{alpha:!0,antialias:i.getEnvironment2DConfigs().getAntialias(),antialiasBlurRatio:i.getEnvironment2DConfigs().getAntialiasBlurRatio(),overSamplingRatio:i.getEnvironment2DConfigs().getOverSamplingRatio()}},createDefaultConfigs:function(){return new Kekule.ChemWidget.ChemObjDisplayerConfigs},getCoordMode:function(){return this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D},setCoordMode:function(e){var t=e===Kekule.CoordMode.COORD3D?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(t)},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r)try{var i=Kekule.IO.loadTypedData(t.data,t.resType,t.resUri);i||(i=Kekule.IO.loadFormatData(t.data,t.resType)),i?this._tryAutoGenerateChemObjCoordsAndLoad(i):Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}catch(e){this.reportException(e)}else this.reportException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},reportException:function(e,t){Kekule.raise(e,t||Kekule.ExceptionLevel.ERROR)},createDrawBridge:function(e){var t=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.Render.DrawBridge3DMananger:Kekule.Render.DrawBridge2DMananger,r=t.getPreferredBridgeInstance();if(!r&&!e){var i=t.getUnavailableMessage()||Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));i&&this.reportException(i,Kekule.ExceptionLevel.NOT_FATAL_ERROR)}return r},getClientElement:function(){return this.getElement()},getDrawContextParentElem:function(e){var t=this._drawContextParentElem;if(!t&&!e){t=this.getDocument().createElement("div"),this._drawContextParentElem=t,Kekule.HtmlElementUtils.addClass(t,i.DYN_CREATED),Kekule.HtmlElementUtils.addClass(t,n.DISPLAYER_DRAWCONTEXT_PARENT),t.style.width="100%",t.style.height="100%";var r=this.getClientElement(),o=Kekule.DomUtils.getFirstChildElem(r);o?r.insertBefore(t,o):r.appendChild(t)}return t},allowAutoSize:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D},canModifyPartialGraphic:function(e){var t=this.getDrawBridge();return!!t.canModifyGraphic&&t.canModifyGraphic(e||this.getDrawContext())},doInsertedToDom:function(){this.doResize()},doResize:function(){this.refitDrawContext(this.isPainting())},refitDrawContext:function(e){if(this.getDrawBridge()&&this.getDrawContext()){var t=Kekule.HtmlElementUtils.getElemClientDimension(this.getDrawContextParentElem()),r=this.changeContextDimension(t);!e&&r&&this.repaint()}},getContextDimension:function(){return this.getDrawBridge()&&this.getDrawContext()?this.getDrawBridge().getContextDimension(this.getDrawContext()):null},_getContextOverSamplingRatio:function(){var e=this.getDisplayerEnvironmentConfigs();return e.getAntialias&&e.getAntialias()&&e.getOverSamplingRatio&&e.getOverSamplingRatio()||1},changeContextDimension:function(e){return this.doChangeContextDimension(this.getDrawContext(),this.getDrawBridge(),e,!0)},doChangeContextDimension:function(e,t,r,i){if(t&&e){var n=r.width,o=r.height,a=t.getContextElem(e);if(a){var s=this._getContextOverSamplingRatio();if(1!==s&&Kekule.BrowserFeature.cssTranform&&i){var l=1/s;a.style.transform="scale("+l+","+l+")",a.style.transformOrigin="0 0",t.setContextParam(e,"overSamplingRatio",s)}else a.style.transform="",t.setContextParam(e,"overSamplingRatio",null)}return this._resizeContext(e,t,n,o),!0}return!1},_resizeContext:function(e,t,r,i){e&&t&&t.setContextDimension(e,r,i)},clearContext:function(){var e=this.getPropStoreFieldValue("drawContext");if(e){var t=this.getPropStoreFieldValue("painter");t&&t.clear(e),this.getDrawBridge().clearContext(e)}},createNewPainter:function(e){var t=this.getPropStoreFieldValue("painter");t&&(t.removeEventListener("draw",this._reactChemObjDrawBind),t.finalize());var r=this.getDrawBridge()?new Kekule.Render.ChemObjPainter(this.getRenderType(),e||this.getChemObj(),this.getDrawBridge()):null;return this.setPropStoreFieldValue("painter",r),r&&r.addEventListener("draw",this._reactChemObjDrawBind),r},isRenderable:function(){return!(!this.getDrawBridge()||!this.getDrawContext())},chemObjChanged:function(e,t){this.doLoad(e),this.getResetAfterLoad()&&t&&this.resetDisplay()},load:function(e){this.setChemObj(e)},doLoad:function(e,t){this._doLoadOnObj(e)},_doLoadOnObj:function(e,t){var r=t&&t.refreshOnly;this.clearSubViews(),this.refitDrawContext(!0),this.setPropStoreFieldValue("chemObjLoaded",!1);try{if(e){var i=this.createNewPainter(e);i&&i.setRenderConfigs(this.getRenderConfigs()),this.repaint(),this.setPropStoreFieldValue("chemObjLoaded",!0),r||this.invokeEvent("load",{obj:e})}else this.clearContext(),r||this.invokeEvent("load",{obj:e})}catch(e){this.clearContext(),this.reportException(e)}finally{this.doLoadEnd(this.getChemObj())}},doLoadEnd:function(e){},loadFromData:function(e,t,r,i,n){try{var o;return e?(i?o=Kekule.IO.loadFormatData(e,i):(t||r)&&(o=Kekule.IO.loadTypedData(e,t,r)),o?n?this._tryAutoGenerateChemObjCoordsForLoading(o,n):this._tryAutoGenerateChemObjCoordsAndLoad(o):Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED")),o):(this.setChemObj(null),null)}catch(e){this.reportException(e)}},loadFromFile:function(e){if(e){var t=this;try{Kekule.IO.loadFileData(e,function(e,r){r&&t._tryAutoGenerateChemObjCoordsAndLoad(e)})}catch(e){this.reportException(e)}}else this.setChemObj(null)},getSavingTargetObj:function(){return this.getChemObj()},saveData:function(e,t,r){r=r||this.getSavingTargetObj();this.prepareSaveData(r);var i=Kekule.IO.ChemDataWriterManager.getWriterByFormat(e,null,r);if(i){if(this._needToCanonicalizeBeforeSaving()&&this.getDisplayerConfigs().getIoConfigs().getCanonicalizeBeforeSave()&&r.standardize)(r=this._cloneSavingTargetObj(r)).standardize(this.getStandardizationOptions());if(!t)t=Kekule.IO.DataFormatsManager.getFormatInfo(e).dataType;return i.writeData(r,t,e)}return Kekule.error(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")),null},_cloneSavingTargetObj:function(e){return e.clone?e.clone(!0):e},_needToCanonicalizeBeforeSaving:function(){return!1},prepareSaveData:function(e){},_molNeedAutoCoordGeneration:function(e,t){return e instanceof Kekule.StructureFragment&&e.getNodeCount()>0&&!e.nodesHasCoordOfMode(this.getCoordMode(),this.getAllowCoordBorrow(),!0)},_isCoordGeneratorAvailable:function(e){if(Kekule.Calculator&&Kekule.Calculator.Services){var t=e===Kekule.CoordMode.COORD3D?Kekule.Calculator.Services.GEN3D:Kekule.Calculator.Services.GEN2D;return Kekule.Calculator.hasService(t)}return!1},canAutoGenerateCoordForChemObj:function(e,t){return e||(e=this.getChemObj()),Kekule.ObjUtils.isUnset(t)&&(t=this.getCoordMode()),e&&e instanceof Kekule.StructureFragment&&e.hasCtab()&&Kekule.Calculator&&Kekule.Calculator.generateStructure&&this._isCoordGeneratorAvailable(t)},_tryAutoGenerateChemObjCoords:function(e,t,r){if(Kekule.ObjUtils.isUnset(t)&&(t=this.getCoordMode()),this.canAutoGenerateCoordForChemObj(e,t)){var i=t===Kekule.CoordMode.COORD3D?Kekule.Calculator.Services.GEN3D:Kekule.Calculator.Services.GEN2D;try{Kekule.Calculator.generateStructure(e,i,{modifySource:!0},function(e){r(e)},function(t){r(e),Kekule.error(t)})}catch(t){r(e)}}else r(e)},_tryAutoGenerateChemObjCoordsForLoading:function(e,t){this.getDisplayerConfigs().getIoConfigs().getAutoGenerateCoordsAfterLoad()?this._molNeedAutoCoordGeneration(e,this.getCoordMode())?this._tryAutoGenerateChemObjCoords(e,null,t):t(e):t(e)},_tryAutoGenerateChemObjCoordsAndLoad:function(e){var t=this;this._tryAutoGenerateChemObjCoordsForLoading(e,function(e){t.setChemObj(e)})},autoGenerateChemObjCoords:function(e,t,r){var i=!t&&Kekule.ObjUtils.isUnset(r);t||(t=this.getChemObj()),Kekule.ObjUtils.isUnset(r)&&(r=this.getCoordMode());var n=this;return this._tryAutoGenerateChemObjCoords(t,r,function(t){i&&n.load(t),e&&e(t)}),this},getDrawClientDimension:function(){return Kekule.HtmlElementUtils.getElemClientDimension(this.getCoreElement())},setDrawDimension:function(e,t){this.setDimension(e,t)},calcDrawBaseCoord:function(e,t){var r,i,n=this.getDrawContext(),o=this.getPainter();if(!this._isContinuousRepainting&&t&&this.getActualAutoSize()){var a=this.getPadding()||0,s=o.estimateScreenBox(n,r,e,this.getAllowCoordBorrow());if(s){var l=s.x2-s.x1+2*a,u=s.y2-s.y1+2*a;this.changeContextDimension({width:l,height:u}),this.setDrawDimension(l,u),i={width:l,height:u},r={x:l/2,y:u/2}}}else if(!(r=e?e.baseCoord:null)){var d=this.getDrawClientDimension();r={x:d.width/2,y:d.height/2};var c=this.getBaseCoordOffset();c&&(r=Kekule.CoordUtils.add(r,c))}return{baseCoord:r=this.getDrawBridge().transformScreenCoordToContext(n,r),baseCoordPos:Kekule.Render.CoordPos.CENTER,newWidgetDimension:i}},getActualDrawOptions:function(){return this.getDrawOptions()},getActualAutoSize:function(){return this.getAutoSize()&&this.allowAutoSize()&&!this.getAutofit()},calcDrawParams:function(e,t){var r=this.getActualDrawOptions();e&&(r=Object.extend(r,e));var i=this.calcDrawBaseCoord(r,t);return{drawOptions:r,baseCoord:i.baseCoord,baseCoordPos:i.baseCoordPos,newWidgetDimension:i.newWidgetDimension}},_savePainterInitialRenderTransformOptions:function(e,t){var r=t.getActualInitialRenderTransformOptions(e);this._contextTransformOpsMap.set(e,r)},requestRepaint:function(e){this._requestRepainting={overrideOptions:e};var t=this;(function(){t._requestRepainting&&t._repaintCore(t._requestRepainting.overrideOptions),t._requestRepainting=null}).delay(0)},repaint:function(e){if(!this.isUpdating()){try{var t=this._repaintCore(e)}finally{this._requestRepainting=null}return t}this._requestRepainting={overrideOptions:e}},_repaintCore:function(e){if(this.getElement()&&!this.isPainting()&&this.isRenderable()){this.beginPaint();try{if(this.getInheritedRenderBackgroundColor()){var t=this.getComputedStyle("backgroundColor");this.backgroundColorChanged(!0,t||null)}else this.backgroundColorChanged(!0);if(e&&e.doNotClear||this.clearContext(),!this.getChemObj())return;var r,i,n=this.getPainter(),o=this.getDrawContext(),a=!0;if(e&&e.preserveTransformOptions?(i=this._contextTransformOpsMap.get(o)||null,a=!1,r=this.calcDrawParams(i,!0)):r=this.calcDrawParams(e,!0),this._lastBaseCoord=r.baseCoord,this.getInheritedRenderColor()){var s=this.getComputedStyle("color");r.drawOptions.color=s}else r.drawOptions.color=null;this.getEnableCustomCssProperties()&&this._applyCustomCssProps(r.drawOptions),this._setupRenderingEnvironment(o,this.getDrawBridge()),n.draw(o,r.baseCoord,r.drawOptions),a&&this._savePainterInitialRenderTransformOptions(o,n),this.invokeEvent("repaint",{obj:this.getChemObj()})}finally{this.endPaint()}}},_setupRenderingEnvironment:function(e,t){var r=this.getDisplayerEnvironmentConfigs();if(r.getAntialias&&r.getAntialias()&&(n=r.getAntialiasBlurRatio&&r.getAntialiasBlurRatio()||0)){var i=this.getRenderConfigs().getLengthConfigs(),n=r.getAntialiasBlurRatio()||0,o=i.getActualLength("bondLineWidth")*n||0,a=t||this.getDrawBridge();a.setFilter&&a.clearFilter&&(o?a.setFilter(e,"blur("+o+"px)"):a.clearFilter(e))}},beginPaint:function(){this._paintFlag||(this._paintFlag=0),++this._paintFlag},endPaint:function(){this._paintFlag>0&&--this._paintFlag,this._paintFlag<0&&(this._paintFlag=0)},isPainting:function(){return this._paintFlag>0},_reactChemObjDraw:function(e){var t=e.obj;t===this.getChemObj()&&this.chemObjRendered(t,e.renderOptions||{})},chemObjRendered:function(e,t){},getBackgroundColorOfType:function(e){return this._bgColorMap[e.toString()]},setBackgroundColorOfType:function(e,t){this._bgColorMap[t.toString()]=e,t===this.getRenderType()&&this.setBackgroundColor(e)},backgroundColorChanged:function(e,t){var r=t;void 0===r&&(r=this.getBackgroundColor()),"transparent"===r&&(r=null);var i=this.getDrawBridge();i&&i.setClearColor&&(i.setClearColor(this.getDrawContext(),r),e||this.requestRepaint())},_getApplicableCustomCssPropNames:function(){return{r2d:["unitLength","moleculeDisplayType","hydrogenDisplayLevel","showCharge","chargeMarkFontSize","chargeMarkMargin","chemMarkerFontSize","chemMarkerMargin","distinguishSingletAndTripletRadical","fontSize","fontFamily","supFontSizeRatio","subFontSizeRatio","superscriptOverhang","subscriptOversink","bondLineWidth","boldBondLineWidth","hashSpacing","multipleBondSpacingRatio","multipleBondSpacingAbs","multipleBondMaxAbsSpacing","bondArrowLength","bondArrowWidth","bondWedgeWidth","bondWedgeHashMinWidth","bondLengthScaleRatio","color","atomColor","bondColor","useAtomSpecifiedColor","opacity","fillColor","strokeColor","strokeWidth","atomRadius"],r3d:["displayMultipleBond","useVdWRadius","nodeRadius","connectorRadius","nodeRadiusRatio","connectorRadiusRatio","color","atomColor","bondColor","useAtomSpecifiedColor","hideHydrogens","bondSpliceMode"]}},_getRenderOptionDefinitionsHash:function(){if(!this.__$renderOptionDefinitionsHash__){this.__$renderOptionDefinitionsHash__={};var e,t,r=Kekule.Render.RenderOptionUtils.getOptionDefinitions(),i=Kekule.Render.Render3DOptionUtils.getOptionDefinitions();for(e=0,t=r.length;e<t;++e)this.__$renderOptionDefinitionsHash__[r[e].name]=r[e];for(e=0,t=i.length;e<t;++e)this.__$renderOptionDefinitionsHash__[i[e].name]=i[e]}return this.__$renderOptionDefinitionsHash__},_applyCustomCssProps:function(e){var t,r,i=this._getRenderOptionDefinitionsHash(),n=this._getApplicableCustomCssPropNames();for(t=0,r=n.r2d.length;t<r;++t){var o=n.r2d[t];this._applyCustomCssPropValue(o,i,e)}if(this.getRenderType()===Kekule.Render.RendererType.R3D)for(t=0,r=n.r3d.length;t<r;++t){o=n.r3d[t];this._applyCustomCssPropValue(o,i,e)}},_applyCustomCssPropValue:function(e,t,r){if(t[e]){var i=this.getComputedCustomStyle(e);if(i&&i.trim){i=i.trim();var n=Kekule.StrUtils.convertToType(i,t.dataType);Kekule.ObjUtils.notUnset(n)&&(r[e]=n)}}},drawOptionChanged:function(){this.repaint()},geometryOptionChanged:function(){var e=this.getPainter(),t=this.getDrawOptions();if(e&&e.supportGeometryOptionChange()){var r=this.getDrawContext();e.changeGeometryOptions(r,t.baseCoord||this._lastBaseCoord,t),this._savePainterInitialRenderTransformOptions(r,e),this.invokeEvent("repaint",{obj:this.getChemObj()})}else this.drawOptionChanged()},beginContinuousRepainting:function(){this._isContinuousRepainting=!0},endContinuousRepainting:function(){this._isContinuousRepainting&&(this._isContinuousRepainting=!1,this.repaint())},resetDisplay:function(){var e=this.getDrawOptions();return e.zoom=this.getInitialZoom()||1,e.rotateX=0,e.rotateY=0,e.rotateZ=0,e.rotateAngle=0,e.rotateAxisVector=null,e.rotateMatrix=null,this.setBaseCoordOffset(null),this.geometryOptionChanged(),this},getCurrZoom:function(){return this.getDrawOptions().zoom||1},zoomTo:function(e,t,r){return this.getDrawOptions().zoom=e,t||this.geometryOptionChanged(),this},zoomIn:function(e,t){var i=this.getCurrZoom(),n=r.getNextZoomInRatio(i,e||1);return this.zoomTo(n,null,t)},zoomOut:function(e,t){var i=this.getCurrZoom(),n=r.getNextZoomOutRatio(i,e||1);return this.zoomTo(n,null,t)},resetZoom:function(e){return this.zoomTo(this.getInitialZoom()||1,null,e)},getDefaultMoleculeDisplayType:function(e){return e===Kekule.Render.RendererType.R3D?Kekule.Render.Molecule3DDisplayType.DEFAULT:Kekule.Render.Molecule2DDisplayType.DEFAULT},getCurrMoleculeDisplayType:function(){var e=this.getDrawOptions().moleculeDisplayType;return e||(e=this.getDefaultMoleculeDisplayType(this.getRenderType())),e},exportToDataUri:function(e,t){return this.getDrawBridge().exportToDataUri(this.getDrawContext(),e,t)},createConfigurator:function(){var e=this.tryApplySuper("createConfigurator");return e.addEventListener("configChange",function(e){this.repaint()},this),e},clearBoundMap:function(){this.getBoundInfoRecorder().clear(this.getDrawContext())},findTopmostBoundInfo:function(e,t){if(e&&e.length){var r=null,i=e.length-1;for(r=e[i];i>=0&&t&&t.indexOf(r.obj)>=0;)r=e[--i];return r}return null},getBoundInfosAtCoord:function(e,t,r){var i=this.getBoundInfoRecorder(),n=r,o=this.screenCoordToContext(e),a=this.getRenderType()===Kekule.Render.RendererType.R3D?{x:0,y:0}:null;return i.getIntersectionInfos(this.getDrawContext(),o,a,n,t)},getTopmostBoundInfoAtCoord:function(e,t,r){return this.findTopmostBoundInfo(this.getBoundInfosAtCoord(e,null,r),t,r)},getBasicObjectsAtCoord:function(e,r,i,n){var o=this.getBoundInfosAtCoord(e,null,r),a=[];if(o){i&&(o=t.filter(o,function(e){var t=o[s].obj;return!!t&&!(t&&i&&i.indexOf(t)>=0)}));for(var s=o.length-1;s>=0;--s){var l=o[s].obj;l&&i&&i.indexOf(l)>=0||a.push(l)}a&&n&&(a=t.filter(a,function(e){for(var t=0,r=n.length;t<r;++t)if(e instanceof n[t])return!0;return!1}))}return a},getTopmostBasicObjectAtCoord:function(e,t,r){var i=this.getBasicObjectsAtCoord(e,t,null,r);return i&&i[0]},translateCoord:function(e,t,r){if(!e)return null;var i=Kekule.Render.CoordSystem;if(t===i.SCREEN){if(r===i.SCREEN)return e;if(r===i.CONTEXT)return this.getDrawBridge()?this.getDrawBridge().transformScreenCoordToContext(this.getDrawContext(),e):e;var n=this.getDrawBridge()?this.getDrawBridge().transformScreenCoordToContext(this.getDrawContext(),e):e;return this.getDrawContext()?this.getRootRenderer().transformCoordToObj(this.getDrawContext(),this.getChemObj(),n):e}if(t===i.CONTEXT)return r===i.SCREEN?this.getDrawBridge()?this.getDrawBridge().transformContextCoordToScreen(this.getDrawContext(),e):e:r===i.CONTEXT?e:this.getDrawContext()?this.getRootRenderer().transformCoordToObj(this.getDrawContext(),this.getChemObj(),e):e;if(r===i.SCREEN){n=this.getRootRenderer().transformCoordToContext(this.getDrawContext(),this.getChemObj(),e);return this.getDrawBridge()?this.getDrawBridge().transformContextCoordToScreen(this.getDrawContext(),n):e}return r===i.CONTEXT&&this.getDrawContext()?this.getRootRenderer().transformCoordToContext(this.getDrawContext(),this.getChemObj(),e):e},translateDistance:function(e,t,r){var i={x:e,y:0,z:0},n=this.translateCoord({x:0,y:0,z:0},t,r),o=this.translateCoord(i,t,r);return Kekule.CoordUtils.getDistance(n,o)},objCoordToContext:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.CHEM,t.CONTEXT)},contextCoordToObj:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.CONTEXT,t.CHEM)},objCoordToScreen:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.CHEM,t.SCREEN)},screenCoordToObj:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.SCREEN,t.CHEM)},screenCoordToContext:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.SCREEN,t.CONTEXT)},contextCoordToScreen:function(e){var t=Kekule.Render.CoordSystem;return this.translateCoord(e,t.CONTEXT,t.SCREEN)},screenBoxToContext:function(e){var t=this.screenCoordToContext({x:e.x1,y:e.y1}),r=this.screenCoordToContext({x:e.x2,y:e.y2});return{x1:t.x,y1:t.y,x2:r.x,y2:r.y}},clearSubViews:function(){var e=this.getSubViews();if(e)for(var t=0,r=e.length;t<r;++t)e[t].finalize();this.setPropStoreFieldValue("subViews",void 0)},iterateSubViews:function(e){var t=this.getSubViews();if(t)for(var r=0,i=t.length;r<i;++r)e(t[r],r);return this},getSubView:function(e,t,r){var i,n=this.getSubViews();if(n)for(var o=0,a=n.length;o<a;++o){var s=n[o];if(s.getTarget()===e&&s instanceof t){i=s;break}}!i&&r&&(ClassEx.getPrototype(t).appliableToTarget(e)&&(i=new t(this,e),this.getSubViews(!0).push(i)));return i},fetchSubView:function(e,t){return this.getSubView(e,t,!0)}}),Kekule.ChemWidget.ChemObjDisplayerSubView=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerSubView",initialize:function(e,t){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("parent",e),this.setPropStoreFieldValue("target",t)},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1,setter:null}),this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:!1,getter:function(){return this.getPropStoreFieldValue("target")||this.getParent().getChemObj()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setBubbleEvent(!0)},getHigherLevelObj:function(){return this.getParent()},appliableToTarget:function(e){return!1}}),Kekule.ChemWidget.ChemObjDisplayer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Settings",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile"])},getDisplayer:function(){return this.getWidget()}}),Kekule.ChemWidget.ChemObjDisplayer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var e=this.tryApplySuper("getCategoryInfos"),t=this.getDisplayer(),r=[t.getDisplayerConfigs(),t.getRenderConfigs()],i=0,n=r.length;i<n;++i)for(var o=r[i],a=o.getPropListOfScopes([Class.PropertyScope.PUBLISHED]),s=0,l=a.getLength();s<l;++s){var u=a.getPropInfoAt(s),d=o.getPropValue(u.name);d&&e.push({obj:d,name:u.name,title:u.title,description:u.description})}return e},getDisplayer:function(){return this.getWidget()}}),Kekule.ChemWidget.ActionDisplayerLoadFile=Class.create(Kekule.ActionLoadFileData,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadFile",HTML_CLASSNAME:n.ACTION_LOADFILE,initialize:function(e){this.tryApplySuper("initialize"),this.setDisplayer(e),this.setText(Kekule.$L("ChemWidgetTexts.CAPTION_LOADFILE")),this.setHint(Kekule.$L("ChemWidgetTexts.HINT_LOADFILE"))},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1})},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(this.getEnabled()&&e&&e.getEnabled()&&e.getEnableLoadNewFile())},doDataLoaded:function(e,t,r){r&&this.getDisplayer().loadFromData(e,null,t)}}),Kekule.ChemWidget.ActionOnDisplayer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnDisplayer",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setDisplayer(e),this.setText(t),this.setHint(r)},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1})},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},execute:function(e,t){return!this.getDisplayer()&&e instanceof Kekule.ChemWidget.ChemObjDisplayer&&this.setDisplayer(e),this.tryApplySuper("execute",[e,t])}}),Kekule.ChemWidget.ActionDisplayerClear=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerClear",HTML_CLASSNAME:n.ACTION_CLEAROBJS,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_CLEAROBJS"),Kekule.$L("ChemWidgetTexts.HINT_CLEAROBJS")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(e&&e.getEnabled()&&e.getChemObj())},doExecute:function(e){this.getDisplayer().setChemObj(null)}}),Kekule.ChemWidget.ActionDisplayerLoadData=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadData",HTML_CLASSNAME:n.ACTION_LOADDATA,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA"),Kekule.$L("ChemWidgetTexts.HINT_LOADDATA")])},finalize:function(){this.tryApplySuper("finalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("dataDialog",{dataType:"Kekule.ChemWidget.LoadDataDialog",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("dataDialog");return e||(e=this.createDataDialog(),this.setPropStoreFieldValue("dataDialog",e)),e}}),this.defineProp("dialogShowType",{dataType:DataType.INT})},createDataDialog:function(){var e=this.getDisplayer().getDocument();return new Kekule.ChemWidget.LoadDataDialog(e)},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(e&&e.getEnabled()&&e.getEnableLoadNewFile())},doExecute:function(e){var t=this,r=this.getDataDialog();r.setPropStoreFieldValue("defaultFormatId",this.getDisplayer().getDefaultInputFormatId()),r.setAllowedFormatIds(this.getDisplayer().getAllowedInputFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds());r._formatSelector;var i=this.getDialogShowType();(i===Kekule.Widget.ShowHideType.DIALOG?r.openModal:r.open).apply(r,[function(e){if(r.isPositiveResult(e)){var i=r.getDataDetails()||{},n=t.getDisplayer();t.doLoadInDisplayer(n,i,r)}},e,i])},doLoadInDisplayer:function(e,t,r){return e.loadFromData(t.data,t.mimeType,t.fileName,t.formatId)}}),Kekule.ChemWidget.ActionDisplayerSaveFile=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerSaveFile",HTML_CLASSNAME:n.ACTION_SAVEFILE,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEFILE"),Kekule.$L("ChemWidgetTexts.HINT_SAVEFILE")]),this._saveAction=new Kekule.ActionFileSave},finalize:function(){this._saveAction.finalize(),this.tryApplySuper("finalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("formatDialog",{dataType:"Kekule.Widget.Dialog",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("formatDialog");return e||(e=this.createFormatDialog(),this.setPropStoreFieldValue("formatDialog",e)),e}}),this.defineProp("lastFormat",{dataType:DataType.STRING,serializable:!1}),this.defineProp("currSaveData",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("dialogShowType",{dataType:DataType.INT})},getChemObjSrcInfo:function(e){var t=this.getDisplayer();return t.getChemObjSrcInfo?t.getChemObjSrcInfo(e):e.getSrcInfo?e.getSrcInfo():null},getChemObjSrcFormat:function(e){var t=this.getChemObjSrcInfo(e);return t?t.format:null},createFormatDialog:function(){var e=this.getDisplayer().getDocument(),t=new Kekule.Widget.Dialog(e,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEDATA_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);t.addClassName(n.DIALOG_CHOOSE_FILE_FORAMT),t.setAutoAdjustSizeOnPopup(!0),(r=e.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_SELECT_FORMAT"),t.getClientElem().appendChild(r),r=e.createElement("div"),t.getClientElem().appendChild(r);var r,i=new Kekule.Widget.SelectBox(t);i.addClassName(n.DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX),i.appendToElem(r),i.addEventListener("valueChange",this.reactFormatSelectorChange,this),t._formatSelector=i,t.setAutoFocusedObject(i),(r=e.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_PREVIEW_FILE_CONTENT"),t.getClientElem().appendChild(r),(r=e.createElement("div")).className=n.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER_REGION,t.getClientElem().appendChild(r);var o=new Kekule.Widget.TextEditor(t);return o.setReadOnly(!0),o.setWrap("off").setAutoWrapThreshold(!0),o.setToolbarPos(Kekule.Widget.Position.BOTTOM),o.addClassName(n.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER),o.appendToElem(r),t._previewTextArea=o,t.setResizable&&t.setResizable(!0),t},getAvailableWriterInfos:function(e){return e?Kekule.IO.ChemDataWriterManager.getAvailableWriterInfos(null,e):[]},getFormatSelectorItems:function(e,t){for(var r=[],i=[],n=this.getChemObjSrcInfo(e),o=n?n.format:null,a=0,s=t.length;a<s;++a){var l=t[a];Kekule.ArrayUtils.pushUnique(i,l.formatId)}for(a=0,s=(i=Kekule.ArrayUtils.intersect(this.getAllowedFormatIds(),i)).length;a<s;++a){var u=Kekule.IO.DataFormatsManager.getFormatInfo(i[a]);if(u){for(var d=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(u.fileExts)),c=0,h=d.length;c<h;++c)d[c]="*."+d[c];var p=d.join(", "),g=u.title;p&&(g+=" ("+p+")");var f=o?i[a]===o:this.getDisplayer().getDefaultOutputFormatId()?i[a]===this.getDisplayer().getDefaultOutputFormatId():this.getLastFormat()?this.getLastFormat()===i[a]:0===a;r.push({value:u.id,text:g,title:u.mimeType,data:u,selected:f})}}return r.sort(function(e,t){return e.text<t.text?-1:e.text>t.text?1:0}),r},getAllowedFormatIds:function(){return this.getDisplayer().getAllowedOutputFormatIds()||Kekule.IO.ChemDataWriterManager.getAllWritableFormatIds()},getFileFilters:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r],o=n.data,a=n.text||n.title||n.value,s=Kekule.ArrayUtils.toArray(o.fileExts);t.push({title:a,filter:"."+s.join(",.")})}return t.push(Kekule.NativeServices.FILTER_ALL_SUPPORT),t.push(Kekule.NativeServices.FILTER_ANY),t},updateFormatItems:function(e){this._formatItems=this.getFormatSelectorItems(e,this.getAvailableWriterInfos()),this._formatSelector.setItems(this._formatItems);var t=this.getFileFilters(this._formatItems);this._saveAction.setFilters(t)},reactFormatSelectorChange:function(){var e=this.getFormatDialog()._formatSelector.getValue();this.updatePreview(e,this.getFormatDialog())},updatePreview:function(e,t){var r=t._previewTextArea;if(r.setValue(""),e){var i=Kekule.IO.DataFormatsManager.getFormatInfo(e),n=this.getTargetObj(),o=this.getChemObjSrcInfo(n);if(o&&o.format===e&&o.data)r.setValue(o.data),this.setCurrSaveData(o.data);else{var a=this.getDisplayer().saveData(e,i.dataType,n);r.setValue(a),this.setCurrSaveData(a)}}},getTargetObj:function(e){return this.getDisplayer().getSavingTargetObj()},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this._saveAction&&this._saveAction.update(),this.setEnabled(e&&e.getEnabled()&&e.getChemObj())},doExecute:function(e){var t=this,r=this.getFormatDialog(),i=this.getTargetObj(),n=r._formatSelector,o=this.getAvailableWriterInfos(i),a=this.getFormatSelectorItems(i,o);n.setItems(a),this.reactFormatSelectorChange();var s=!1;this._saveAction&&(s=this._saveAction.getEnabled());var l=r.getDialogButton(Kekule.Widget.DialogButtons.OK);l&&l.setEnabled(s);var u=this.getDialogShowType();(u===Kekule.Widget.ShowHideType.DIALOG?r.openModal:r.open).apply(r,[function(i){if(i===Kekule.Widget.DialogButtons.OK){var n=t.getCurrSaveData();t._saveAction.setData(n);var o=r._formatSelector.getValue();t.setLastFormat(o);var a=Kekule.IO.DataFormatsManager.getFormatInfo(o),s=a.fileExts,l=Kekule.ArrayUtils.toArray(s[0]||s),u=[{title:a.title||a.mimeType,filter:"."+l.join(",.")},Kekule.NativeServices.FILTER_ANY],d=Kekule.$L("ChemWidgetTexts.S_DEF_SAVE_FILENAME")+"."+l;t._saveAction.setFileName(d),t._saveAction.setFilters(u),t._saveAction.execute(e)}},e,u])}}),Kekule.ChemWidget.ActionDisplayerCopy=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerCopy",HTML_CLASSNAME:n.ACTION_COPY,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_COPY_WHOLE"),Kekule.$L("ChemWidgetTexts.HINT_COPY_WHOLE")])},doUpdate:function(){if(this.tryApplySuper("doUpdate"),this.getEnabled()){var e=this.getDisplayer().getChemObj();this.setEnabled(e&&e.clone)}},doExecute:function(){var e=this.getDisplayer();if(e){var t=e.getChemObj();t&&Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,[t])}}}),Kekule.ChemWidget.ActionDisplayerReset=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerReset",HTML_CLASSNAME:n.ACTION_RESET,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_RESETVIEW"),Kekule.$L("ChemWidgetTexts.HINT_RESETVIEW")])},doExecute:function(){this.getDisplayer().resetDisplay()}}),Kekule.ChemWidget.ActionDisplayerZoomIn=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomIn",HTML_CLASSNAME:n.ACTION_ZOOMIN,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMIN"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMIN")])},doExecute:function(){this.getDisplayer().zoomIn()}}),Kekule.ChemWidget.ActionDisplayerZoomOut=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomOut",HTML_CLASSNAME:n.ACTION_ZOOMOUT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMOUT"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMOUT")])},doExecute:function(){this.getDisplayer().zoomOut()}}),Kekule.ChemWidget.ActionDisplayerResetZoom=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerResetZoom",HTML_CLASSNAME:n.ACTION_RESET_ZOOM,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_RESETZOOM"),Kekule.$L("ChemWidgetTexts.HINT_RESETZOOM")])},doExecute:function(){this.getDisplayer().resetZoom()}}),Kekule.ChemWidget.ActionDisplayerHideHydrogens=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerHideHydrogens",HTML_CLASSNAME:n.ACTION_MOL_HIDE_HYDROGENS,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_HIDEHYDROGENS"),Kekule.$L("ChemWidgetTexts.HINT_HIDEHYDROGENS")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=e&&e.getRenderType()===Kekule.Render.RendererType.R3D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t),this.setChecked(e&&e.getHideHydrogens())},doExecute:function(){var e=!this.getChecked();this.setChecked(e),this.getDisplayer().setHideHydrogens(e)}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,t,r]),this._displayType=i,this.setCheckGroup("__molDisplayType__")},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setChecked(e&&e.getCurrMoleculeDisplayType()===this.getMolDisplayType())},doExecute:function(){this.getDisplayer().setMoleculeDisplayType(this._displayType),this.setChecked(!0)},getMolDisplayType:function(){return this._displayType}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=e&&e.getRenderType()===Kekule.Render.RendererType.R2D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=e&&e.getRenderType()===Kekule.Render.RendererType.R3D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_SKELETAL,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_SKELETAL"),Kekule.$L("ChemWidgetTexts.HINT_SKELETAL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE=Kekule.Render.Molecule2DDisplayType.SKELETAL,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_CONDENSED,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_CONDENSED"),Kekule.$L("ChemWidgetTexts.HINT_CONDENSED"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE=Kekule.Render.Molecule2DDisplayType.CONDENSED,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_WIRE,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_WIRE"),Kekule.$L("ChemWidgetTexts.HINT_WIRE"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE=Kekule.Render.Molecule3DDisplayType.WIRE,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_STICKS,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_STICKS"),Kekule.$L("ChemWidgetTexts.HINT_STICKS"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE=Kekule.Render.Molecule3DDisplayType.STICKS,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_BALLSTICK,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_BALLSTICK"),Kekule.$L("ChemWidgetTexts.HINT_BALLSTICK"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE=Kekule.Render.Molecule3DDisplayType.BALL_STICK,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_SPACEFILL,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_SPACEFILL"),Kekule.$L("ChemWidgetTexts.HINT_SPACEFILL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE=Kekule.Render.Molecule3DDisplayType.SPACE_FILL,Kekule.ChemWidget.ActionDisplayerAutoGenerateCoordsForMolecule=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerAutoGenerateCoordsForMolecule",HTML_CLASSNAME:n.ACTION_MOL_AUTO_COORD_GENERATION,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_AUTO_COORD_GENERATION"),Kekule.$L("ChemWidgetTexts.HINT_AUTO_COORD_GENERATION")])},getCoordMode:function(){return null},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=this.getEnabled()&&!!e.canAutoGenerateCoordForChemObj(e.getChemObj(),Kekule.oneOf(this.getCoordMode(),e.getCoordMode()));this.setDisplayed(t).setEnabled(t)},doExecute:function(){this.getDisplayer().autoGenerateChemObjCoords()}})}(),function(){"use strict";var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEM_STRUCT_TREE_VIEW:"K-Chem-Struct-TreeView",CHEM_STRUCT_TREE_VIEW_ITEM_TITLE:"K-Chem-Struct-TreeView-ItemTitle",CHEM_STRUCT_TREE_VIEW_ITEM_TYPE:"K-Chem-Struct-TreeView-ItemType"}),Kekule.ChemWidget.StructureTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.ChemWidget.StructureTreeView",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("objMap",new Kekule.MapEx(!0)),this.setEnableLiveUpdate(!0),this.setEnableMultiSelect(!0),this.setRootObj(t),this._pauseLiveUpdateFlag=0,this._changedObjects=[]},initProperties:function(){this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("rootObj");this.setPropStoreFieldValue("rootObj",e),this.rootObjChanged(e,t)}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:!1})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.CHEM_STRUCT_TREE_VIEW},rootObjChanged:function(e,t){this.clearChildItems(),this.getObjMap().clear(),t&&this._uninstallRootEventHandler(t),e&&(this._fillTree(e),this._installRootEventHandler(e))},pauseLiveUpdate:function(){return this._pauseLiveUpdateFlag>=0&&(this._pauseLiveUpdateFlag=0,this._changedObjects=[]),--this._pauseLiveUpdateFlag,this},resumeLiveUpdate:function(){if(++this._pauseLiveUpdateFlag,this._pauseLiveUpdateFlag>=0){this._pauseLiveUpdateFlag=0;for(var e=0,t=this._changedObjects.length;e<t;++e)this.refreshObject(this._changedObjects[e])}},isLiveUpdatePaused:function(){return this._pauseLiveUpdateFlag<0},_installRootEventHandler:function(e){e.addEventListener("change",this.reactChemObjChange,this)},_uninstallRootEventHandler:function(e){e.removeEventListener("change",this.reactChemObjChange,this)},reactChemObjChange:function(e){this.getEnableLiveUpdate()&&(this.isLiveUpdatePaused()?this.getObjMap().get(e.target)&&Kekule.ArrayUtils.pushUnique(this._changedObjects,e.target):this.refreshObject(e.target))},refreshObject:function(e){var t=this.getObjMap().get(e);return t&&this._updateTreeItem(t,e),this},_fillTree:function(e){e&&(this.clearChildItems(),this._updateTreeItem(this.appendChildItem(),e))},_updateTreeItem:function(e,t){var r={text:this._getChemObjDisplayTitle(t),obj:t};this.setItemData(e,r),this.getObjMap().set(t,e);for(var i=this.getChildItemCount(e),n=t.getChildCount(),o=0;o<n;++o){var a,s=t.getChildAt(o);a=o<i?this.getChildItemAt(e,o):this.appendChildItem(e),this._updateTreeItem(a,s)}if(i>n)for(o=i-1;o>=n;--o)this.removeChildItemAt(e,o)},_getChemObjDisplayTitle:function(t){var r="",i=t.getId();i&&(r+='<span class="'+e.CHEM_STRUCT_TREE_VIEW_ITEM_TITLE+'">'+i+"</span>");var n=t.getClassName(),o=n.split("."),a=o.length?o[o.length-1]:n;return r+('<span class="'+e.CHEM_STRUCT_TREE_VIEW_ITEM_TYPE+'">('+a+")</span>")},selectChemObjs:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r],o=this.getObjMap().get(n);o&&t.push(o)}return this.select(t),this},getSelectedChemObjs:function(){var e=[],t=this.getSelection();if(t&&t.length)for(var r=0,i=t.length;r<i;++r){var n=this.getItemData(t[r]);n&&n.obj&&e.push(n.obj)}return e}})}(),function(){"use strict";Kekule.oneOf;Kekule.ChemWidget.AbstractUIMarker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.AbstractUIMarker",initialize:function(){this.tryApplySuper("initialize"),this.setVisible(!0)},initProperties:function(){this.defineProp("drawStyles",{dataType:DataType.OBJECT}),this.defineProp("visible",{dataType:DataType.BOOL}),this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("groups",{dataType:DataType.ARRAY})}}),Kekule.ChemWidget.MetaShapeUiMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setShapeInfo(e)},initProperties:function(){this.defineProp("shapeInfo",{dataType:DataType.OBJECT}),this.defineProp("shapeType",{dataType:DataType.INT,serializable:!1,setter:null,getter:function(){var e=this.getShapeInfo();return e?e.shapeType:null}})}}),Kekule.ChemWidget.MetaShapeUIMarker=Kekule.ChemWidget.MetaShapeUiMarker,Kekule.ChemWidget.TextUiMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker",initialize:function(e,t){this.tryApplySuper("initialize"),e&&this.setText(e),t&&this.setCoord(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING}),this.defineProp("coord",{dataType:DataType.HASH})}}),Kekule.ChemWidget.UiMarkerCollection=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection",initProperties:function(){this.defineProp("markers",{dataType:DataType.ARRAY,getter:function(){var e=this.getPropStoreFieldValue("markers");return e||(e=[],this.setPropStoreFieldValue("markers",e)),e},setter:null})},getMarkerCount:function(){return this.getMarkers().length},getMarkerAt:function(e){return this.getMarkers()[e]},getMarkerOfName:function(e){for(var t=0,r=this.getMarkerCount();t<r;++t){var i=this.getMarkerAt(t);if(i.getName()===e)return i}return null},getMarkersOfGroup:function(e){for(var t=Kekule.ArrayUtils.toArray(e),r=[],i=0,n=this.getMarkerCount();i<n;++i){for(var o=this.getMarkerAt(i),a=o.getGroups(),s=!0,l=0,u=t.length;l<u;++l)if(a.indexOf(t[l])<0){s=!1;break}s&&r.push(o)}return r},addMarker:function(e){return this.getMarkers().push(e)},indexOfMarker:function(e){return this.getMarkers().indexOf(e)},removeMarker:function(e){var t=this.getMarkers(),r=t.indexOf(e);r>=0&&t.splice(r,1)},clearMarkers:function(){this.setPropStoreFieldValue("markers",[])}}),Kekule.ChemWidget.UiMarker2DRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerRenderer"}),Kekule.ChemWidget.MetaShapeUiMarker2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker2DRenderer",doDrawSelf:function(e,t,r){var i=this.getChemObj(),n=i.getShapeInfo();if(!n)return null;var o,a=Object.create(r);if((a=Object.extend(a,i.getDrawStyles()||{})).color&&(a.strokeColor||(a.strokeColor=a.color),a.fillColor||(a.fillColor=a.color)),Kekule.Render.MetaShapeUtils.isCompositeShape(n))if(n.length>1){o=this.createDrawGroup(e);for(var s=0,l=n.length;s<l;++s){var u=n[s];this.doDrawShape(e,o,u,a)}}else{if(1!==n.length)return null;o=this.doDrawShape(e,null,n[0],a)}else o=this.doDrawShape(e,null,n,a);return o},doDrawShape:function(e,t,r,i){var n,o=Kekule.Render.MetaShapeType;if(Kekule.Render.MetaShapeUtils.isCompositeShape(r)){n=this.createDrawGroup(e);for(var a=0,s=r.length;a<s;++a)this.doDrawShape(e,n,r[a],i)}else{var l=r.coords;switch(r.shapeType){case o.POINT:n=this.drawCircle(e,l[0],1,i);break;case o.CIRCLE:n=this.drawCircle(e,l[0],r.radius,i);break;case o.LINE:var u=i;r.width&&((u=Object.create(i)).strokeWidth=r.width),n=this.drawLine(e,l[0],l[1],u);break;case o.RECT:n=this.drawRect(e,l[0],l[1],i);break;case o.ARC:(u=Object.extend({},i)).strokeWidth=r.width,u.fillColor=null,n=this.drawArc(e,l[0],r.radius,r.startAngle,r.endAngle,r.anticlockwise,u);break;case o.POLYGON:case o.POLYLINE:var d=[];for(a=0,s=l.length;a<s;++a){var c=0===a?"M":"L";d.push(c);var h=[l[a].x,l[a].y];d.push(h)}r.shapeType===o.POLYGON&&(d.push("L"),h=[l[0].x,l[0].y],d.push(h));var p=Kekule.Render.DrawPathUtils.makePath.apply(this,d);n=this.drawPath(e,p,i)}}return t&&this.addToDrawGroup(n,t),n}}),Kekule.ChemWidget.TextUiMarker2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker2DRenderer",doDrawSelf:function(e,t,r){var i=this.getChemObj(),n={textBoxXAlignment:Kekule.Render.BoxXAlignment.CENTER,textBoxYAlignment:Kekule.Render.BoxYAlignment.CENTER};n=Object.extend(n,r),n=Object.extend(n,i.getDrawStyles()||{});var o=i.getCoord();return i.getText()&&o?this.drawText(e,o,i.getText(),n):null}}),Kekule.ChemWidget.UiMarkerCollection2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection2DRenderer",getChildObjs:function(){for(var e=this.getChemObj().getMarkers(),t=[],r=0,i=e.length;r<i;++r)e[r].getVisible()&&t.push(e[r]);return t}}),Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.MetaShapeUiMarker,Kekule.ChemWidget.MetaShapeUiMarker2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.TextUiMarker,Kekule.ChemWidget.TextUiMarker2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.UiMarkerCollection,Kekule.ChemWidget.UiMarkerCollection2DRenderer),Kekule.ChemWidget.UiMarkersRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkersRenderer",DRAW_ELEM_FIELD:"__$drawElem__",initialize:function(e,t){this.tryApplySuper("initialize",[e,t]),this._drawGroup=null},initProperties:function(){},getObjDrawElem:function(e,t){return this.getExtraProp2(e,t,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(e,t,r){this.setExtraProp2(e,t,this.DRAW_ELEM_FIELD,r)},doEstimateRenderBox:function(e,t,r,i){return null},doDraw:function(e,t,r){this.tryApplySuper("doDraw",[e,t,r]);var i=this.getChemObj(),n=this.createDrawGroup(e);return this.setObjDrawElem(e,i,n),i.getMarkerCount()>0&&this.doDrawMarkers(e,n,i.getMarkers(),r),n},doUpdate1:function(e,t,r){if(this.canModifyGraphic(e)){var i=!1,n=Kekule.Render.ObjectUpdateType;switch(r){case n.ADD:i=this.doAddNew(e,t);break;case n.MODIFY:i=this.doModify(e,t);break;case n.REMOVE:var o=this._extractObjsOfUpdateObjDetails(t);i=this.doRemove(e,o);break;default:return this.tryApplySuper("doUpdate1",[e,t,r])}return i}return this.tryApplySuper("doUpdate1",[e,t,r])},doAddNew:function(e,t){return!!this.canRemoveElem()&&this.doModify(e,t)},doModify:function(e,t){if(!this.canRemoveElem())return!1;var r=this._extractObjsOfUpdateObjDetails(t);this.remove(e,r);var i=this.getChemObj(),n=this.getObjDrawElem(i),o=this.getDrawParams();r.indexOf(i)>=0?this.draw(e,o.baseCoord,o.options):this.doDrawMarkers(e,n,r,o.options)},doRemove:function(e,t){if(!this.canRemoveElem())return!1;var r=this.getObjDrawElem(t);if(r){var i=this.getObjDrawElem(this.getChemObj());this.doRemoveFromGroup(r,i),this.doRemoveElem(e,r),this.setObjDrawElem(t,null)}},doDrawMarkers:function(e,t,r,i){for(var n=0,o=r.length;n<o;++n){var a=r[n];a.getVisible()&&this.doDrawMarker(e,t,a,i)}},doDrawMarker:function(e,t,r,i){var n=r.getShapeInfo();if(!n)return null;var o,a=Object.create(i);if((a=Object.extend(r.getDrawStyles()||{})).color&&(a.strokeColor||(a.strokeColor=a.color),a.fillColor||(a.fillColor=a.color)),Kekule.ArrayUtils.isArray(n))if(n.length>1){o=this.createDrawGroup(e);for(var s=0,l=n.length;s<l;++s){var u=n[s];this.doDrawShape(e,o,u,a)}}else{if(1!==n.length)return null;o=this.doDrawShape(e,null,n[0],a)}else o=this.doDrawShape(e,null,n,a);return o&&(this.setObjDrawElem(e,r,o),t&&this.addToDrawGroup(o,t)),o},doDrawShape:function(e,t,r,i){var n,o=Kekule.Render.MetaShapeType;if(Kekule.Render.MetaShapeUtils.isCompositeShape(r)){n=this.createDrawGroup(e);for(var a=0,s=r.length;a<s;++a)this.doDrawShape(e,n,r[a],i)}else{var l=r.coords;switch(r.shapeType){case o.POINT:n=this.drawCircle(e,l[0],1,i);break;case o.CIRCLE:n=this.drawCircle(e,l[0],r.radius,i);break;case o.LINE:var u=i;r.width&&((u=Object.create(i)).strokeWidth=r.width),n=this.drawLine(e,l[0],l[1],u);break;case o.RECT:n=this.drawRect(e,l[0],l[1],i);break;case o.POLYGON:case o.POLYLINE:var d=[];for(a=0,s=l.length;a<s;++a){var c=0===a?"M":"L";d.push(c);var h=[l[a].x,l[a].y];d.push(h)}r.shapeType===o.POLYGON&&(d.push("L"),h=[l[0].x,l[0].y],d.push(h));var p=Kekule.Render.DrawPathUtils.makePath.apply(this,d);n=this.drawPath(e,p,i)}}return t&&this.addToDrawGroup(n,t),n}}),Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.ChemWidget.UiMarkersRenderer)}(),function(){"use strict";var e=Class.PropertyScope,t=Kekule.ArrayUtils,r=(Kekule.ZoomUtils,Kekule.ChemWidget.ComponentWidgetNames),i=Kekule.ChemWidget,n=Kekule.Widget.EvokeMode;Kekule.globalOptions.add("chemWidget.viewer",{toolButtons:[r.loadData,r.saveData,r.molDisplayType,r.molHideHydrogens,r.zoomIn,r.zoomOut,r.rotateX,r.rotateY,r.rotateZ,r.rotateLeft,r.rotateRight,r.reset,r.copy,r.openEditor],menuItems:[r.loadData,r.saveData,Kekule.Widget.MenuItem.SEPARATOR_TEXT,r.molDisplayType,r.molHideHydrogens,r.zoomIn,r.zoomOut,{text:Kekule.$L("ChemWidgetTexts.CAPTION_ROTATE"),hint:Kekule.$L("ChemWidgetTexts.HINT_ROTATE"),children:[r.rotateLeft,r.rotateRight,r.rotateX,r.rotateY,r.rotateZ]},r.reset,Kekule.Widget.MenuItem.SEPARATOR_TEXT,r.copy,r.openEditor,r.config],toolbar:{evokeModes:[n.EVOKEE_CLICK,n.EVOKEE_MOUSE_ENTER,n.EVOKEE_TOUCH],revokeModes:[n.EVOKEE_MOUSE_LEAVE,n.EVOKER_TIMEOUT],pos:Kekule.Widget.Position.AUTO,marginHorizontal:10,marginVertical:10},editor:{modal:!0,restrainEditorWithCurrObj:!0,shareEditorInstance:!0},enableToolbar:!1,enableDirectInteraction:!0,enableTouchInteraction:!1,enableGestureInteraction:!1,enabledDirectInteractionModes:{move:!0,rotate:!0,zoom:!0},showCaption:!1,useNormalBackground:!1,enableCustomCssProperties:!0,restraintRotation3DEdgeRatio:.18,enableRestraintRotation3D:!0}),Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER:"K-Chem-Viewer",VIEWER2D:"K-Chem-Viewer2D",VIEWER3D:"K-Chem-Viewer3D",VIEWER_CLIENT:"K-Chem-Viewer-Client",VIEWER_CAPTION:"K-Chem-Viewer-Caption",VIEWER_EMBEDDED_TOOLBAR:"K-Chem-Viewer-Embedded-Toolbar",VIEWER_UICONTEXT_PARENT:"K-Chem-Viewer-UiContext-Parent",VIEWER_MENU_BUTTON:"K-Chem-Viewer-Menu-Button",VIEWER_EDITOR_FULLCLIENT:"K-Chem-Viewer-Editor-FullClient",ACTION_ROTATE_LEFT:"K-Chem-RotateLeft",ACTION_ROTATE_RIGHT:"K-Chem-RotateRight",ACTION_ROTATE_X:"K-Chem-RotateX",ACTION_ROTATE_Y:"K-Chem-RotateY",ACTION_ROTATE_Z:"K-Chem-RotateZ",ACTION_VIEWER_EDIT:"K-Chem-Viewer-Edit"});var o=Kekule.Widget.HtmlClassNames,a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ViewerUiMarkerGroup={HOTTRACK:"hotTrack",SELECT:"select"},Kekule.ChemWidget.Viewer=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.ChemWidget.Viewer",BINDABLE_TAG_NAMES:["div","span","img"],DEF_BGCOLOR_2D:null,DEF_BGCOLOR_3D:"#000000",DEF_TOOLBAR_EVOKE_MODES:[n.EVOKEE_CLICK,n.EVOKEE_MOUSE_ENTER,n.EVOKEE_TOUCH],DEF_TOOLBAR_REVOKE_MODES:[n.EVOKEE_MOUSE_LEAVE,n.EVOKER_TIMEOUT],OBSERVING_GESTURES:["pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout"],initialize:function(e,t,r,i){this.setPropStoreFieldValue("renderType",r||Kekule.Render.RendererType.R2D),this.setPropStoreFieldValue("useCornerDecoration",!0);var n=Kekule.oneOf,o=Kekule.globalOptions.get("chemWidget.viewer")||{};this.setPropStoreFieldValue("enableToolbar",n(o.enableToolbar)),this.setPropStoreFieldValue("enableDirectInteraction",n(o.enableDirectInteraction,!0)),this.setPropStoreFieldValue("showCaption",n(o.showCaption,!1)),o=o.toolbar||{},this.setPropStoreFieldValue("toolbarEvokeModes",n(o.evokeModes,this.DEF_TOOLBAR_EVOKE_MODES)),this.setPropStoreFieldValue("toolbarRevokeModes",n(o.revokeModes,this.DEF_TOOLBAR_REVOKE_MODES)),this.setPropStoreFieldValue("toolbarPos",n(o.pos,Kekule.Widget.Position.AUTO)),this.setPropStoreFieldValue("toolbarMarginHorizontal",n(o.marginHorizontal,10)),this.setPropStoreFieldValue("toolbarMarginVertical",n(o.marginVertical,10)),this.tryApplySuper("initialize",[e,t,r]),this.setPropStoreFieldValue("viewerConfigs",i||this.createDefaultConfigs()),this.beginUpdate();try{this.setPadding(this.getRenderConfigs().getLengthConfigs().getActualLength("autofitContextPadding")),this._isContinuousRepainting=!1;var a=Kekule.Render.RendererType,s=this.getRenderType()===a.R2D&&this.getBackgroundColor()||this.DEF_BGCOLOR_2D,l=this.getRenderType()===a.R3D&&this.getBackgroundColor()||this.DEF_BGCOLOR_3D;this.setBackgroundColorOfType(s,a.R2D),this.setBackgroundColorOfType(l,a.R3D),this.useCornerDecorationChanged(),this.doResize()}finally{this.endUpdate()}var u=Kekule.globalOptions.get("chemWidget.viewer")||{};Kekule.ObjUtils.isUnset(this.getEnableGesture())&&this.setEnableGesture(n(u.enableGestureInteraction,!1)),this.addIaController("default",new Kekule.ChemWidget.ViewerBasicInteractionController(this),!0)},doFinalize:function(){var e=this.getUiMarkers();e&&e.finalize();var t=this.getToolbar();this.tryApplySuper("doFinalize"),t&&t.finalize(),this._composerDialog&&this._composerDialog.finalize(),this._composerPanel&&this._composerPanel.finalize()},initProperties:function(){this.defineProp("viewerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:!1,getter:function(){return this.getDisplayerConfigs()},setter:function(e){return this.setDisplayerConfigs(e)}}),this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){if(!this.getEnableUiContext())return null;var e=this.getPropStoreFieldValue("uiDrawBridge");return e||this.__$uiDrawBridgeInitialized$__||(this.__$uiDrawBridgeInitialized$__=!0,e=this.createUiDrawBridge(),this.setPropStoreFieldValue("uiDrawBridge",e)),e}}),this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:!1,getter:function(){if(!this.getEnableUiContext())return null;var e=this.getPropStoreFieldValue("uiContext");if(!e){var t=this.getUiDrawBridge();if(t){var r=this.getUiContextParentElem();if(!r)return null;var i=Kekule.HtmlElementUtils.getElemScrollDimension(r);e=t.createContext(r,i.width,i.height),this.setPropStoreFieldValue("uiContext",e)}}return e}}),this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiPainter");if(!e){var t=this.getUiMarkers();return(e=new Kekule.Render.ChemObjPainter(Kekule.Render.RendererType.R2D,t,this.getUiDrawBridge())).setCanModifyTargetObj(!0),this.setPropStoreFieldValue("uiPainter",e),e}return e}}),this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,setter:null,getter:function(){var e=this.getUiPainter();return e?(e.getRenderer()||e.prepareRenderer(),e.getRenderer()||null):null}}),this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiMarkers");return e||(e=new Kekule.ChemWidget.UiMarkerCollection,this.setPropStoreFieldValue("uiMarkers",e)),e}}),this.defineProp("allowedMolDisplayTypes",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("allowedMolDisplayTypes",e),this.updateUiComps()}}),this.defineProp("retainAspect",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).retainAspect},setter:function(e){var t=this.getDrawOptions()||{};return t.retainAspect=!!e,this.setDrawOptions(t)}}),this.defineProp("enableRestraintRotation3D",{dataType:DataType.BOOL}),this.defineProp("restraintRotation3DEdgeRatio",{dataType:DataType.FLOAT}),this.defineProp("enableHotKey",{dataType:DataType.FLOAT}),this.defineProp("enableEdit",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableEdit")&&this.getCoordMode()!==Kekule.CoordMode.COORD3D}}),this.defineProp("shareEditorInstance",{dataType:DataType.BOOL}),this.defineProp("enableEditFromVoid",{dataType:DataType.BOOL}),this.defineProp("restrainEditorWithCurrObj",{dataType:DataType.BOOL}),this.defineProp("modalEdit",{dataType:DataType.BOOL}),this.defineProp("editorProperties",{dataType:DataType.HASH}),this.defineProp("toolButtons",{dataType:DataType.ARRAY,scope:e.PUBLIC,getter:function(){return this.getPropStoreFieldValue("toolButtons")},setter:function(e){this.setPropStoreFieldValue("toolButtons",e),this.updateToolbar()}}),this.defineProp("menuItems",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("menuItems",e),this.updateMenu()}}),this.defineProp("menu",{dataType:"Kekule.Widget.Menu",serializable:!1,scope:e.PRIVATE,setter:function(e){var t=this.getMenu();e!==t&&(t&&(t.finalize(),t=null),this.setPropStoreFieldValue("menu",e))}}),this.defineProp("toolbar",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,scope:e.PRIVATE,setter:function(e){var t=this.getToolbar(),r=this.getToolbarEvokeHelper();if(e!==t){if(t){t.finalize();var i=this.getToolbarEvokeHelper();i&&i.finalize(),t=null}r&&r.finalize(),this.setPropStoreFieldValue("toolbar",e),e&&this.setPropStoreFieldValue("toolbarEvokeHelper",new Kekule.Widget.DynamicEvokeHelper(this,e,this.getToolbarEvokeModes(),this.getToolbarRevokeModes()))}}}),this.defineProp("enableToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableToolbar",e),this.updateToolbar()}}),this.defineProp("toolbarPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(e){this.setPropStoreFieldValue("toolbarPos",e),this.adjustToolbarPos()}}),this.defineProp("toolbarMarginVertical",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarMarginVertical",e),this.adjustToolbarPos()}}),this.defineProp("toolbarMarginHorizontal",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarMarginHorizontal",e),this.adjustToolbarPos()}}),this.defineProp("toolbarEvokeHelper",{dataType:"Kekule.Widget.DynamicEvokeHelper",serializable:!1,setter:null,scope:e.PRIVATE}),this.defineProp("toolbarEvokeModes",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("toolbarEvokeModes",e||[]),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setEvokeModes(e||[])}}),this.defineProp("toolbarRevokeModes",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("toolbarRevokeModes",e||[]),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setRevokeModes(e||[])}}),this.defineProp("toolbarRevokeTimeout",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarRevokeTimeout",e),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setTimeout(e)}}),this.defineProp("toolbarParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getToolbarParentElem()!==e&&(this.setPropStoreFieldValue("toolbarParentElem",e),this.updateToolbar())}}),this.defineProp("caption",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("caption",e),Kekule.DomUtils.setElementText(this.getCaptionElem(),e||""),this.captionChanged()}}),this.defineProp("showCaption",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showCaption",e),this.captionChanged()}}),this.defineProp("captionPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(e){this.setPropStoreFieldValue("captionPos",e),this.captionChanged()}}),this.defineProp("autoCaption",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoCaption",e),e&&this.autoDetectCaption()}}),this.defineProp("captionElem",{dataType:DataType.OBJECT,scope:e.PRIVATE,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("captionElem");return t||e||(t=this.doCreateCaptionElem(),this.setPropStoreFieldValue("captionElem",t)),t}}),this.defineProp("actions",{dataType:"Kekule.ActionList",serializable:!1,scope:e.PUBLIC,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actions");return e||(e=new Kekule.ActionList,this.setPropStoreFieldValue("actions",e)),e}}),this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actionMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("actionMap",e)),e}}),this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL}),this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableTouchInteraction",!!e),this.setTouchAction(e?"none":null)}}),this.defineProp("enableGesture",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this.getEnableGesture()!==t&&(this.setPropStoreFieldValue("enableGesture",t),t?this.startObservingGestureEvents(this.OBSERVING_GESTURES):this.stopObservingGestureEvents(this.OBSERVING_GESTURES))}}),this.defineProp("enabledDirectInteractionModes",{dataType:DataType.HASH}),this.defineProp("hotTrackedObjects",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("hotTrackedObjects")||[]},setter:function(e){this.changeHotTrackedObjects(e&&t.toArray(e),!0)}}),this.defineProp("selectedObjects",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("selectedObjects")||[]},setter:function(e){this.changeSelectedObjects(e&&t.toArray(e),!0)}})},initPropValues:function(){this.setStyleMode(Kekule.Widget.StyleMode.INHERITED);var e=Kekule.oneOf,t=Kekule.globalOptions.get("chemWidget.viewer")||{};this.setUseNormalBackground(e(t.useNormalBackground,!1)),this.setEnableCustomCssProperties(e(t.enableCustomCssProperties,!0)),this.setRestraintRotation3DEdgeRatio(e(t.restraintRotation3DEdgeRatio,.18)),this.setEnableRestraintRotation3D(e(t.enableRestraintRotation3D,!0)),this.setEnableTouchInteraction(e(t.enableTouchInteraction,!1)),this.setEnabledDirectInteractionModes(e(t.enabledDirectInteractionModes,{move:!0,rotate:!0,zoom:!0})),t=t.editor||{},this.setModalEdit(e(t.modal,!0)),this.setRestrainEditorWithCurrObj(e(t.restrainEditorWithCurrObj,!0)),this.setShareEditorInstance(e(t.shareEditorInstance,!0))},createDefaultConfigs:function(){return new Kekule.ChemWidget.ViewerConfigs},canUsePlaceHolderOnElem:function(e){var t=e.getAttribute("src");return"img"===e.tagName.toLowerCase()&&!!t},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),this.updateActions()},doSetElement:function(e){var t=e;t&&("img"===t.tagName.toLowerCase()&&(t=Kekule.DomUtils.replaceTagName(t,"span")));return this.tryApplySuper("doSetElement",[t])},doUnbindElement:function(e){return this._drawContextParentElem&&this._drawContextParentElem.parentNode&&(this._drawContextParentElem.parentNode.removeChild(this._drawContextParentElem),this._drawContextParentElem=null),this.tryApplySuper("doUnbindElement",[e])},elementBound:function(e){this.setObserveElemResize(!0)},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=e.createElement("div");return r.className=a.VIEWER_CLIENT,this._clientElement=r,t.appendChild(r),[r]},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+a.VIEWER;try{var t=this.getRenderType();e+=" "+this._getRenderTypeSpecifiedHtmlClassName(t)}catch(e){}return e},_getRenderTypeSpecifiedHtmlClassName:function(e){return e===Kekule.Render.RendererType.R3D?a.VIEWER3D:a.VIEWER2D},getClientElement:function(){return this._clientElement},getResizerElement:function(){return this.getElement()},doResize:function(){this.adjustDrawParentDim(),this.adjustToolbarPos(),this.tryApplySuper("doResize")},doWidgetShowStateChanged:function(e){e&&this.updateActions()},refitDrawContext:function(e){this.tryApplySuper("refitDrawContext",[e]),this.adjustToolbarPos()},changeContextDimension:function(e){return this.getEnableUiContext()&&this.getUiDrawBridge()&&this.getUiContext()&&this.doChangeContextDimension(this.getUiContext(),this.getUiDrawBridge(),e,!0),this.tryApplySuper("changeContextDimension",[e])},getAllowRenderTypeChange:function(){return!0},resetRenderType:function(e,t){this.tryApplySuper("resetRenderType",[e,t]);var r=this._getRenderTypeSpecifiedHtmlClassName(e),i=this._getRenderTypeSpecifiedHtmlClassName(t);this.removeClassName(r),this.addClassName(i),this.updateUiComps()},doLoad:function(e){this.beginUpdateUiMarkers();try{this.clearHotTrackedItems(),this.clearSelectedItems(),this.clearUiMarkers()}finally{this.endUpdateUiMarkers()}this.tryApplySuper("doLoad",[e])},doLoadEnd:function(e){this.updateActions(),this.autoDetectCaption()},_repaintCore:function(e){this.tryApplySuper("_repaintCore",[e])},chemObjRendered:function(e,t){var r=this.tryApplySuper("chemObjRendered",[e,t]);return this.updateUiMarkers(!0),r},doSetUseCornerDecoration:function(e){this.tryApplySuper("doSetUseCornerDecoration",[e]),this.useCornerDecorationChanged()},useCornerDecorationChanged:function(){var e=this.getDrawContextParentElem();e&&(this.getUseCornerDecoration()?Kekule.HtmlElementUtils.addClass(e,o.CORNER_ALL):Kekule.HtmlElementUtils.removeClass(e,o.CORNER_ALL))},getBoundInfosAtCoord:function(e,t,r){var i=this.tryApplySuper("getBoundInfosAtCoord",[e,t,r]),n=this.getViewerConfigs().getInteractionConfigs().getEnableTrackOnNearest();if(i&&i.length&&n){var o=new Kekule.MapEx;try{for(var a=Kekule.Render.MetaShapeUtils,s=i.length-1;s>=0;--s){var l=i[s],u=l.boundInfo,d=a.getDistance(e,u);o.set(l,d)}i.sort(function(e,t){var r=-(e.boundInfo.shapeType-t.boundInfo.shapeType);return 0===r&&(r=-(o.get(e)-o.get(t))),r})}finally{o.finalize()}}return i},getEnableUiContext:function(){return!0},getUiContextParentElem:function(e){if(!this.getEnableUiContext())return null;var t=this._uiContextParentElem;if(!t&&!e){t=this.getDocument().createElement("div"),this._uiContextParentElem=t,Kekule.HtmlElementUtils.addClass(t,o.DYN_CREATED),Kekule.HtmlElementUtils.addClass(t,a.VIEWER_UICONTEXT_PARENT),t.style.width="100%",t.style.height="100%";var r=this.getDrawContextParentElem(),i=r?r.parentNode:this.getElement(),n=r&&r.nextSibling;n?i.insertBefore(t,n):i.appendChild(t)}return t},createUiDrawBridge:function(){var e=Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!e){var t=Kekule.Render.DrawBridge2DMananger.getUnavailableMessage()||Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));t&&this.reportException(t,Kekule.ExceptionLevel.NOT_FATAL_ERROR)}return e},adjustDrawParentDim:function(){var e=this.getDrawContextParentElem(),t=e.parentNode,r=this.getCaptionElem(!0);Kekule.HtmlElementUtils.getElemClientDimension(t);if(r&&this.captionIsShown()&&r.parentNode===t){var i=Kekule.HtmlElementUtils.getElemClientDimension(r).height||0;this.getCaptionPos()&Kekule.Widget.Position.TOP?(e.style.top=i+"px",e.style.bottom="0px"):(e.style.top="0px",e.style.bottom=i+"px"),Kekule.StyleUtils.removeStyleProperty(e.style,"height")}else Kekule.StyleUtils.removeStyleProperty(e.style,"top"),Kekule.StyleUtils.removeStyleProperty(e.style,"bottom"),e.style.height="100%"},getInteractionReceiverElem:function(){return this.getClientElement()},setDrawDimension:function(e,t){var r=t;this.captionIsShown()&&(r+=Kekule.HtmlElementUtils.getElemClientDimension(this.getCaptionElem()).height||0);this.tryApplySuper("setDrawDimension",[e,r])},doCreateCaptionElem:function(){var e=this.getDocument().createElement("span");return e.className=o.DYN_CREATED+"  "+o.SELECTABLE+" "+a.VIEWER_CAPTION,this.getElement().appendChild(e),e},captionChanged:function(){if(this.captionIsShown()){var e=(t=this.getCaptionElem()).style;this.getCaptionPos()&Kekule.Widget.Position.TOP?(e.top=0,e.bottom="auto"):(e.bottom=0,e.top="auto"),e.display="block"}else{var t;(t=this.getCaptionElem(!0))&&(t.style.display="none")}this.doResize()},captionIsShown:function(){return this.getCaption()&&this.getShowCaption()},beginUpdateUiMarkers:function(){Kekule.ObjUtils.isUnset(this._uiMarkerUpdateFlag)&&(this._uiMarkerUpdateFlag=0),--this._uiMarkerUpdateFlag,this.beginUpdate()},endUpdateUiMarkers:function(){this.endUpdate(),++this._uiMarkerUpdateFlag,this._uiMarkerUpdateFlag>0&&(this._uiMarkerUpdateFlag=0),this.isUpdatingUiMarkers()||this.repaintUiMarker()},isUpdatingUiMarkers:function(){return this._uiMarkerUpdateFlag<0},_getUiMarkerOfName:function(e,t,r){var i=this.getUiMarkers().getMarkerOfName(e);return!i&&r&&(i=r.apply(this))&&(i.setName(e),i.setGroups(t)),i},_getDefaultHotTrackUiMarker:function(e){var t;return e&&(t=this.createShapeBasedMarker),this._getUiMarkerOfName("hotTrackMarker",[Kekule.ChemWidget.ViewerUiMarkerGroup.HOTTRACK],t)},_getDefaultSelectionUiMarker:function(e){var t;return e&&(t=this.createShapeBasedMarker),this._getUiMarkerOfName("selectionMarker",[Kekule.ChemWidget.ViewerUiMarkerGroup.SELECT],t)},recalcUiMarkers:function(){if(this.getUiDrawBridge()){this.beginUpdateUiMarkers();try{var e,t=this.getHotTrackedObjects();if(t&&t.length){var r=this._calcBoundsOfObjects(t),i=this.getViewerConfigs().getUiMarkerConfigs().getHotTrackMarkerStyles()||{};e=this._getDefaultHotTrackUiMarker(!0),this.modifyShapeBasedMarker(e,r,i,!1),this.showUiMarker(e)}else(e=this._getDefaultHotTrackUiMarker(!1))&&this.hideUiMarker(e,!1);var n=this.getSelectedObjects();if(n&&n.length){r=this._calcBoundsOfObjects(n),i=this.getViewerConfigs().getUiMarkerConfigs().getSelectionMarkerStyles()||{};e=this._getDefaultSelectionUiMarker(!0),this.modifyShapeBasedMarker(e,r,i,!1),this.showUiMarker(e)}else(e=this._getDefaultSelectionUiMarker(!1))&&this.hideUiMarker(e,!1)}finally{this.endUpdateUiMarkers()}}},repaintUiMarker:function(){if(!this.isUpdatingUiMarkers()&&this.getUiDrawBridge()&&this.getUiContext()){this.clearUiContext();var e=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),e.baseCoord,e.drawOptions)}},updateUiMarkers:function(e){this.doUpdateUiMarkers(),e&&this.repaintUiMarker()},doUpdateUiMarkers:function(){this.recalcUiMarkers()},createShapeBasedMarker:function(e,t,r,i){var n=new Kekule.ChemWidget.MetaShapeUiMarker;return e&&n.setShapeInfo(e),t&&n.setDrawStyles(t),r&&n.setPropValues(r),this.getUiMarkers().addMarker(n),i&&this.repaintUiMarker(),n},modifyShapeBasedMarker:function(e,t,r,i){Kekule.Render.ObjectUpdateType.MODIFY;t&&e.setShapeInfo(t),r&&e.setDrawStyles(r),i&&this.repaintUiMarker()},createTextBasedMarker:function(e,t,r,i,n){var o=new Kekule.ChemWidget.TextUiMarker;return e&&o.setCoord(e),t&&o.setText(t),r&&o.setDrawStyles(r),i&&o.setPropValues(i),this.getUiMarkers().addMarker(o),n&&this.repaintUiMarker(),o},modifyTextBasedMarker:function(e,t,r,i,n){Kekule.Render.ObjectUpdateType.MODIFY;t&&e.setCoord(t),r&&e.setText(r),i&&e.setDrawStyles(i),n&&this.repaintUiMarker()},getUiMarkersOfGroup:function(e){return this.getUiMarkers().getMarkersOfGroup(e)},modifyUiMarkers:function(e,r){for(var i=e instanceof Kekule.ChemWidget.UiMarkerCollection?e.getMarkers():t.toArray(e),n=0,o=i.length;n<o;++n)i[n].setPropValues(r)},setVisibleOfUiMarkers:function(e,t,r){return this.modifyUiMarkers(e,{visible:t}),r&&this.repaintUiMarker(),this},setVisibleOfUiMarkerGroup:function(e,t,r){var i=this.getUiMarkersOfGroup(e);return this.setVisibleOfUiMarkers(i,t,r)},hideUiMarker:function(e,t){e.setVisible(!1),t&&this.repaintUiMarker()},showUiMarker:function(e,t){e.setVisible(!0),t&&this.repaintUiMarker()},removeUiMarker:function(e){e&&(this.getUiMarkers().removeMarker(e),this.repaintUiMarker())},clearUiMarkers:function(){this.getUiMarkers().clearMarkers(),this.repaintUiMarker()},clearUiContext:function(){this.getUiContext()&&this.getUiDrawBridge()&&this.getUiDrawBridge().clearContext(this.getUiContext())},getEnableObjectSelect:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getViewerConfigs().getInteractionConfigs().getEnableBasicObjectSelect()},getEnableObjectHotTrack:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getViewerConfigs().getInteractionConfigs().getEnableBasicObjectHotTrack()},addToSelection:function(e){for(var r=t.clone(this.getSelectedObjects()),i=e?t.toArray(e):[],n=!1,o=0,a=i.length;o<a;++o){var s=i[o];r.indexOf(s)>=0||(r.push(s),n=!0)}n&&this.changeSelectedObjects(r,!0)},removeFromSelection:function(e){for(var r=t.clone(this.getSelectedObjects()),i=e?t.toArray(e):[],n=!1,o=0,a=i.length;o<a;++o){var s=i[o],l=r.indexOf(s);l>=0&&(r.splice(l,1),n=!0)}n&&this.changeSelectedObjects(r,!0)},toggleSelectingState:function(e){for(var r=t.clone(this.getSelectedObjects()),i=t.toArray(e),n=0,o=i.length;n<o;++n){var a=i[n],s=r.indexOf(a);s>=0?r.splice(s,1):r.push(a)}this.changeSelectedObjects(r,!0)},select:function(e){var r=e?t.toArray(e):[];this.changeSelectedObjects(r,!0)},clearHotTrackedItems:function(e,t){this.iterateSubViews(function(t){(!e||e.indexOf(t)<0)&&t.doClearHotTrackedItems()}),(!e||e.indexOf(this)<0)&&this.doClearHotTrackedItems(),t&&this.repaintUiMarker()},doClearHotTrackedItems:function(e){this.changeHotTrackedObjects([],e)},clearSelectedItems:function(e,t){this.iterateSubViews(function(t){e&&e.indexOf(t)<0&&t.doClearSelectedItems()}),e&&e.indexOf(this)<0&&this.doClearSelectedItems(),t&&this.repaintUiMarker()},doClearSelectedItems:function(e){this.changeSelectedObjects([],e)},_isSameHotTrackedOrSelectedObjs:function(e,r){var i=e,n=r;return i&&!i.length&&(i=null),n&&!n.length&&(n=null),i==n||!(!i||!n)&&0===t.compare(i,n,function(e,t){return e===t?0:-1})},_changeHotTrackOrSelectObjectRenderStyles:function(e,t,r,i){var n=!1,o=r?"_selectedObjectRenderStyles":"_hotTrackedObjectRenderStyles";if(e&&e.length){var a=this[o];if(a)for(var s=0,l=e.length;s<l;++s){(d=e[s]).removeOverrideRenderOptionItem&&(d.removeOverrideRenderOptionItem(a),n=!0)}}if(t&&t.length){var u=r?this.getViewerConfigs().getUiMarkerConfigs().getSelectedObjectStyles():this.getViewerConfigs().getUiMarkerConfigs().getHotTrackedObjectStyles();if(u){this[o]=u;for(s=0,l=t.length;s<l;++s){var d;(d=t[s]).addOverrideRenderOptionItem&&(d.addOverrideRenderOptionItem(u),n=!0)}}}else this[o]=null;i&&n&&this.requestRepaint()},changeHotTrackedObjects:function(e,r){var i=this.getHotTrackedObjects()||[],n=e?t.toArray(e):[];if(!this._isSameHotTrackedOrSelectedObjs(i,n)){r&&this.beginUpdateUiMarkers();try{this._changeHotTrackOrSelectObjectRenderStyles(i,n,!1,r),this.setPropStoreFieldValue("hotTrackedObjects",n),n&&n.length&&this.clearHotTrackedItems([this],!1),r&&this.updateUiMarkers(!0),this.invokeEvent("hotTrackOnObjects",{objects:n,prevObjects:i})}finally{r&&this.endUpdateUiMarkers()}}},changeSelectedObjects:function(e,r){var i=this.getSelectedObjects(),n=e?t.toArray(e):[];if(!this._isSameHotTrackedOrSelectedObjs(i,n)){r&&this.beginUpdateUiMarkers();try{this._changeHotTrackOrSelectObjectRenderStyles(i,n,!0,r),this.setPropStoreFieldValue("selectedObjects",n),n&&n.length&&this.clearSelectedItems([this],!1),r&&this.updateUiMarkers(!0),this.invokeEvent("selectionChange",{objects:n,prevObjects:i})}finally{r&&this.endUpdateUiMarkers()}}},_calcBoundsOfObjects:function(e,t){var r=[];Kekule.ObjUtils.isUnset(t)&&(t=this.getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation());for(var i=0;i<e.length;++i){var n=e[i],o=this.getBoundInfoRecorder().getBelongedInfos(this.getDrawContext(),n);if(o&&o.length)for(var a=0,s=o.length;a<s;++a){var l=o[a].boundInfo;l&&(l=Kekule.Render.MetaShapeUtils.inflateShape(l,t),Kekule.ArrayUtils.pushUnique(r,l))}}return r},getAllowEditing:function(){return this.getCoordMode()!==Kekule.CoordMode.COORD3D&&this.getEnableEdit()&&(this.getChemObj()||this.getEnableEditFromVoid())},getComposerDialog:function(){var e;return(e=this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerDialog:this._composerDialog)||Kekule.Editor.ComposerDialog&&(e=new Kekule.Editor.ComposerDialog(this.getDocument(),Kekule.$L("ChemWidgetTexts.CAPTION_EDIT_OBJ"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL])),this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerDialog=e:this._composerDialog=e,e},getComposerPanel:function(){var e;if(!(e=this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerPanel:this._composerPanel)&&Kekule.Editor.Composer){(e=new Kekule.Editor.Composer(this.getDocument())).addClassName(a.VIEWER_EDITOR_FULLCLIENT),e.setUseNormalBackground(!0);var i=Kekule.Editor.Composer.getMinPreferredDimension();e.setMinDimension(i),e.setEnableDimensionTransform(!0),e.setAutoResizeConstraints({width:1,height:1});var n=Kekule.globalOptions.chemWidget.composer.commonToolButtons;n=t.exclude(n,[r.cut,r.config,r.objInspector]),e.setCommonToolButtons(n);var o=[{text:Kekule.$L("ChemWidgetTexts.CAPTION_EDITOR_DONE"),hint:Kekule.$L("ChemWidgetTexts.HINT_EDITOR_DONE"),htmlClass:"K-Res-Button-YesOk",showText:!0,"#execute":function(){e._doneEditCallback(),e.hide()}},{text:Kekule.$L("ChemWidgetTexts.CAPTION_EDITOR_CANCEL"),hint:Kekule.$L("ChemWidgetTexts.HINT_EDITOR_CANCEL"),htmlClass:"K-Res-Button-NoCancel",showText:!0,"#execute":function(){e.hide()}}];e._customEndEditButtons=o}return this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerPanel=e:this._composerPanel=e,e._invokerViewer=this,e._doneEditCallback=null,e},openEditor:function(e){if(this.getAllowEditing()){var t=this.getChemObj(),r=!t,i=t&&t.isEmpty&&t.isEmpty(),n=this.getRestrainEditorWithCurrObj(),o=Kekule.DocumentUtils.getClientDimension(this.getDocument()),a=Kekule.Editor.Composer.getMinPreferredDimension();o.width<=a.width+50||o.height<a.height+100?this._openEditComposer(e,t,n,r,i):this._openEditComposerDialog(e,t,n,r,i)}},_prepareEditComposer:function(e,t,r,i){e.setEnableCreateNewDoc(r||!t),e.setEnableLoadNewFile(r||!t),e.setAllowCreateNewChild(r||!t);var n=this.getEditorProperties();n&&e.setPropValues(n)},_feedbackEditResult:function(e,t,r){if(e.isDirty()){var i=e.getSavingTargetObj();r?this.setChemObj(i.clone()):this.getRestrainEditorWithCurrObj()?(t.getClass()===i.getClass()?t.assign(i.clone()):t.assign(i),t.setSrcInfo(null),this.setChemObj(t)):this.setChemObj(i),this.invokeEvent("editingDone",{obj:this.getChemObj()})}},_openEditComposerDialog:function(e,t,r,i,n){var o=this.getComposerDialog();if(o){var a,s=o.getComposer();this._prepareEditComposer(s,r,i,n),i||n?o.getComposer().newDoc():(a=t.clone(),o.setChemObj(a));var l=this,u=function(e){e===Kekule.Widget.DialogButtons.OK&&o.getComposer().isDirty()&&l._feedbackEditResult(o.getComposer(),t,i)};this.getModalEdit()?o.openModal(u,e||this):o.openPopup(u,e||this)}else Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"))},_openEditComposer:function(e,t,r,i,n){var o=this.getComposerPanel();if(o){this._prepareEditComposer(o,r,i,n);for(var a=o._customEndEditButtons,s=o.getCommonToolButtons()||[],l=!1,u=0,d=a.length;u<d;++u){var c=a[u];s.indexOf(c)<0&&(s.push(c),l=!0)}if(l&&o.setCommonToolButtons(s),i||n)o.newDoc();else{var h=t.clone();o.setChemObj(h)}var p=this;o._doneEditCallback=function(){p._feedbackEditResult(o,t,i)},o.show(e,function(){i||n||o.setChemObj(h)},Kekule.Widget.ShowHideType.POPUP)}else Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"))},resetView:function(){return this.resetDisplay()},getCurr2DRotationAngle:function(){return this.getDrawOptions().rotateAngle||0},rotate2DBy:function(e,t){return this.rotate2DTo(this.getCurr2DRotationAngle()+e,t)},rotate2DTo:function(e,t){return this.getDrawOptions().rotateAngle=e,t||this.geometryOptionChanged(),this},getCurr3DRotationInfo:function(){for(var e={},t=["rotateMatrix","rotateX","rotateY","rotateZ","rotateAngle"],r=this.getDrawOptions(),i=0,n=t.length;i<n;++i){var o=t[i];e[o]=r[o]||0}return e.rotateAxisVector=r.rotateAxisVector||null,e},setRotate3DMatrix:function(e,t){return this.getDrawOptions().rotateMatrix=e,t||this.geometryOptionChanged(),this},rotate3DBy:function(e,t,r,i){var n=this.getCurr3DRotationInfo().rotateMatrix||Kekule.MatrixUtils.createIdentity(4),o=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:e,rotateY:t,rotateZ:r}),a=Kekule.MatrixUtils.multiply(o,n);return this.setRotate3DMatrix(a,i),this},rotate3DByAxis:function(e,t,r){var i=this.getCurr3DRotationInfo().rotateMatrix||Kekule.MatrixUtils.createIdentity(4),n=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:e,rotateAxisVector:t}),o=Kekule.MatrixUtils.multiply(n,i);return this.setRotate3DMatrix(o,r),this},getDefaultToolBarButtons:function(){return Kekule.globalOptions.chemWidget.viewer.toolButtons},isToolbarEmbedded:function(){return!this.getToolbarParentElem()},adjustToolbarPos:function(){var e=this.getToolbar();if(e)if(this.isToolbarEmbedded()){var t=Kekule.Widget.Position,r=Kekule.HtmlElementUtils.getElemPageRect(this.getDrawContextParentElem()),i=Kekule.HtmlElementUtils.getElemPageRect(e),n=this.getToolbarPos(),o=this.getToolbarMarginHorizontal(),a=this.getToolbarMarginVertical(),s="left",l="top",u="right",d="bottom",c=(r.width-i.width)/2,h=(r.height-i.height)/2;if(n===t.AUTO||!n){var p=2*(o>0?o:0)+i.width,g=2*(a>0?a:0)+i.height;p>r.width?(n|=t.LEFT,o=0):n|=t.RIGHT,g>r.height/2?(n|=t.BOTTOM,a=-1):n|=t.BOTTOM}n&t.LEFT?(s="left",u="right",c=o>=0?o:o-i.width):n&t.RIGHT&&(s="right",u="left",c=o>=0?o:o-i.width),n&t.TOP?(l="top",d="bottom",h=a>=0?a:a-i.height):n&t.BOTTOM&&(l="bottom",d="top",h=a>=0?a:a-i.height),e.removeStyleProperty(u),e.removeStyleProperty(d),e.setStyleProperty(s,c+"px"),e.setStyleProperty(l,h+"px")}else e.removeStyleProperty("left"),e.removeStyleProperty("top"),e.removeStyleProperty("width"),e.removeStyleProperty("height")},updateToolbar:function(){this.getEnableToolbar()?(this.createToolbar(),this.adjustToolbarPos()):this.setToolbar(null)},updateMenu:function(){this.createMenu()},updateUiComps:function(){this.updateToolbar(),this.updateMenu()},updateActions:function(){this.getActions()&&this.getActions().updateAll()},clearActions:function(){this.getActions().clear(),this.getActionMap().clear()},getCompActionClass:function(e){return this.getChildActionClass(e,!0)},_getActionOfComp:function(e,t,r){var i=this.getActionMap(),n=i.get(e);if(!n&&t){var o=this.getCompActionClass(e)||r;o&&(n=new o(this),i.set(e,n),this.getActions().add(n))}return n},getChildAction:function(e,t){var r=this._getActionOfComp(e,!0);return r||(r=this.tryApplySuper("getChildAction",[e,t])),r},createToolbar:function(){this.clearActions();var e=new Kekule.Widget.ButtonGroup(this);e.addClassName(o.DYN_CREATED),e.setDisplayed(!1),e.setShowText(!1),e.doSetShowGlyph(!0);for(var t=this.getToolButtons()||this.getDefaultToolBarButtons(),r=0,i=t.length;r<i;++r){var n=t[r];this.createToolButton(n,e)}return e.addClassName(a.INNER_TOOLBAR),this.isToolbarEmbedded()&&e.addClassName(a.VIEWER_EMBEDDED_TOOLBAR),e.appendToElem(this.getToolbarParentElem()||this.getElement()),this.setToolbar(e),e},createToolButton:function(e,t){var i=null,n=this.beginContinuousRepainting.bind(this),o=this.endContinuousRepainting.bind(this),a=[r.rotateX,r.rotateY,r.rotateZ,r.rotateLeft,r.rotateRight];if(DataType.isObjectValue(e)){var s=Object.extend({widget:Kekule.Widget.Button},e);if(i=Kekule.Widget.Utils.createFromHash(t,s),(u=s.actionClass)&&"string"==typeof u&&(u=ClassEx.findClass(s.actionClass)),u)(l=this._getActionOfComp(i,!0,u))&&i.setAction(l)}else{if(e===r.molDisplayType)return this.createMolDisplayTypeButton(t);if(e===r.menu)return this.createMenuButton(t);var l,u=this.getCompActionClass(e),d=Kekule.Widget.Button;e===r.molHideHydrogens&&(d=Kekule.Widget.CheckButton),i=new d(t),(l=this._getActionOfComp(e,!0))&&i.setAction(l),a.indexOf(e)>=0&&(i.setPeriodicalExecInterval(20),i.setEnablePeriodicalExec(!0),i.addEventListener("activate",n),i.addEventListener("deactivate",o))}return i},createMenuButton:function(e){var t=new Kekule.Widget.DropDownButton(e);return t.setText(Kekule.$L("WidgetTexts.CAPTION_MENU")).setHint(Kekule.$L("WidgetTexts.HINT_MENU")),t.addClassName(a.VIEWER_MENU_BUTTON),this.getMenu()||this.createMenu(),t.setDropDownWidget(this.getMenu()),t},createMolDisplayTypeButton:function(e){var t=new Kekule.Widget.CompactButtonSet(e);t.getButtonSet().addClassName(a.INNER_TOOLBAR),t.setShowText(!1);var i=this._getActionOfComp(r.molDisplayType,!0);t.setAction(i),this.getActions().add(i);for(var n=this.getDocument(),o=this.getAllowedMolDisplayTypes(),s=this._getUsableMolDisplayActionClasses(o),l=0,u=s.length;l<u;++l){var d=s[l].TYPE,c=new Kekule.Widget.RadioButton(n);i=this._getActionOfComp(r.molDisplayType+d,!0,s[l]);c.setAction(i),t.append(c,d===this.getCurrMoleculeDisplayType())}return t},_getUsableMolDisplayActionClasses:function(e){for(var t=[],r=this.getRenderType()===Kekule.Render.RendererType.R3D?i.Viewer.molDisplayType3DActionClasses:i.Viewer.molDisplayType2DActionClasses,n=0,o=r.length;n<o;++n){var a=r[n].TYPE;e&&e.indexOf(a)<0&&a!==this.getCurrMoleculeDisplayType()||t.push(r[n])}return t},getDefaultMenuItems:function(){return Kekule.globalOptions.chemWidget.viewer.menuItems},prepareMenuItems:function(e){for(var t=[],r=Kekule.Widget.MenuItem.SEPARATOR_TEXT,i=0,n=e.length;i<n;++i){var o=e[i];if("string"==typeof o){if(o!==r){var a=this.createPredefinedMenuItemDefHash(o);a&&t.push(a)}}else{var s=Object.extend({},o);if(o.widget||o.widgetClass||(s.widget=Kekule.Widget.MenuItem),o.children&&o.children.length){var l=this.prepareMenuItems(o.children);s.children=l}t.push(s)}}return t},createPredefinedMenuItemDefHash:function(e){if(e===r.molDisplayType)return this.createMolDisplayMenuDefHash();var t=[r.rotateX,r.rotateY,r.rotateZ,r.rotateLeft,r.rotateRight],i=this.beginContinuousRepainting.bind(this),n=this.endContinuousRepainting.bind(this),o=(this.getCompActionClass(e),Kekule.Widget.MenuItem),a=null,s=this._getActionOfComp(e,!0);return s&&(a={widget:o,action:s},t.indexOf(e)>=0&&(a=Object.extend(a,{periodicalExecInterval:20,enablePeriodicalExec:!0,"#activate":i,"@deactivate":n}))),a},createMolDisplayMenuDefHash:function(){for(var e=this._getActionOfComp(r.molDisplayType,!0),t={widget:Kekule.Widget.MenuItem,action:e},i=[],n=this.getAllowedMolDisplayTypes(),o=this._getUsableMolDisplayActionClasses(n),a=0,s=o.length;a<s;++a){var l=o[a].TYPE;e=this._getActionOfComp(r.molDisplayType+l,!0,o[a]);i.push({widget:Kekule.Widget.MenuItem,action:e})}return i.length&&(t.children=[{widget:Kekule.Widget.PopupMenu,children:i}]),t},createMenu:function(){var e=this.getMenu();e?e.clearMenuItems():((e=new Kekule.Widget.PopupMenu(this)).addClassName(o.DYN_CREATED),e.setDisplayed(!1));var t=this.getMenuItems()||this.getDefaultMenuItems();return t=this.prepareMenuItems(t),e.createChildrenByDefs(t),this.setMenu(e),e},autoDetectCaption:function(){if(this.getAutoCaption()){var e=this.getChemObj();if(e){var t=e&&e.getInfo(),r=e&&e.getSrcInfo();if(t&&r){var i=t.title||t.caption||e.getName()||r.fileName;i&&this.setCaption(i)}}}},getEnabledOfDirectInteractionMode:function(e){return!!(this.getEnabledDirectInteractionModes()||{})[e]},setEnabledOfDirectInteractionMode:function(e,t){var r=this.getEnabledDirectInteractionModes();return r||(r={},this.setPropStoreFieldValue("enabledDirectInteractionModes",r)),r[e]=!!t,this},reactHotKeys:function(e){if(this.getEnableHotKey()){for(var t=this.getCoordMode()||Kekule.CoordMode.COORD2D,r=this.getViewerConfigs().getHotKeyConfigs().getHotKeys(),i=Kekule.Widget.KeyboardUtils.getKeyParamsFromEvent(e),n=!1,o=r.length-1;o>=0;--o){var a=r[o],s=Kekule.Widget.KeyboardUtils.shortcutLabelToKeyParams(r[o].key,null,!1);if(s.repeat=a.repeat,Kekule.Widget.KeyboardUtils.matchKeyParams(i,s,!1)){var l=a.action;if(l&&(!a.coordMode||a.coordMode===t)){var u=this.getChildAction(l,!0);u&&(n=u.execute(this,e)||n)}}}if(n)return e.stopPropagation(),e.preventDefault(),!0}},react_keydown:function(e){if(!this.tryApplySuper("react_keydown",[e]))return this.reactHotKeys(e)}}),Kekule.ChemWidget.ViewerSubView=Class.create(Kekule.ChemWidget.ChemObjDisplayerSubView,{CLASS_NAME:"Kekule.ChemWidget.ViewerSubView",initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null,getter:function(){return this.getParent()}})},doClearHotTrackedItems:function(e){},doClearSelectedItems:function(e){}});var s=Kekule.X.Event;Kekule.ChemWidget.ViewerBasicInteractionController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.ChemWidget.ViewerBasicInteractionController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._enableMouseRotate=!0,this._transformInfo={isTransforming:!1,lastCoord:null,lastZoom:null},this._restraintCoord=null,this._doInteractiveTransformStepBind=this._doInteractiveTransformStep.bind(this)},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,getter:function(){return this.getWidget()},setter:function(e){this.setWidget(e)}})},getViewerRenderType:function(){return this.getViewer().getRenderType()},getEnableInteraction:function(){var e=this.getViewer();return!!(e&&e.getEnableDirectInteraction()&&e.getChemObjLoaded())},getEnableTouchInteraction:function(){var e=this.getViewer();return!!(e&&e.getEnableDirectInteraction()&&e.getEnableTouchInteraction()&&e.getChemObjLoaded())},getEnableGestureManipulation:function(){var e=this.getViewer();return!!(e&&e.getEnableDirectInteraction()&&e.getEnableTouchInteraction()&&e.getEnableGesture()&&e.getChemObjLoaded())},_initTransform:function(){var e,t=this.getViewer(),r=t.getOffsetWidth(),i=t.getOffsetHeight(),n=this._transformInfo,o=this._restraintCoord;o?(e="x"===o?i:r,n.angleRatio=1/e*Math.PI*2):(e=Math.min(r,i),n.angleRatio=1/e*Math.PI)},zoomViewer:function(e,t){var r=this.getViewer();r&&r.getChemObj()&&(e>0?r.zoomIn&&r.zoomIn(e,t):e<0&&r.zoomOut&&r.zoomOut(-e,t))},isEventFromInteractionArea:function(e){var t=e.getTarget(),r=this.getViewer().getInteractionReceiverElem();return t===r||Kekule.DomUtils.isDescendantOf(t,r)},_beginInteractTransformAtCoord:function(e,t,r,i,n,o){var a=this.getViewer();if(a&&a.getChemObj()){var s=this._transformInfo;s.isTransforming=!0,s.interactingPointerId=o,s.lastCoord={x:e,y:t},s.transformInitCoord={x:e,y:t},this.getViewerRenderType()!==Kekule.Render.RendererType.R3D&&(s.initBaseCoordOffset=a.getBaseCoordOffset()||{}),this._restraintCoord=this._calcRestraintRotateCoord(r,i),this._initTransform(),this._requestInteractiveTransform(e,t)}},_beginGestureInteractTransform:function(e){var t=this.getViewer();if(t&&t.getChemObj()){var r=this._transformInfo;r.isGestureTransforming=!0,r.isTransforming=!1,r.initialGestureZoomLevel=t.getCurrZoom(),this._requestInteractiveTransform()}},_clearInteractionTransformInfo:function(){this._transformInfo.interactingPointerId=null,this._transformInfo.isTransforming=!1,this._transformInfo.lastCoord=null,this._transformInfo.transformInitCoord=null,this._transformInfo.initBaseCoordOffset=null,this._transformInfo.isGestureTransforming=!1,this._transformInfo.initialGestureZoomLevel=null},_endInteractTransform:function(){this._clearInteractionTransformInfo(),this._doInteractiveTransformEnd()},isTransforming:function(){return this._transformInfo.isTransforming},_calcRestraintRotateCoord:function(e,t){var r=this.getViewer(),i=null,n=this._getRestraintRotate3DEdgeSize();if(n>0){var o,a,s,l,u=r.getDrawContextParentElem(!0),d=Kekule.HtmlElementUtils.getElemPageRect(u,!0),c=e-d.left,h=t-d.top,p=d.right-e,g=d.bottom-t;c<=p?(s=1,o=c):(s=-1,o=p),h<=g?(l=1,a=h):(l=-1,a=g);var f=Math.min(o,a);if(f>n)return null;a>f?s<0&&(i="x"):i=l>0?"z":"y"}return i},_interactTransformAtCoord:function(e,t,r){if(r===this._transformInfo.interactingPointerId){var i=this._transformInfo.lastCoord;if(i){var n={x:e,y:t};if(Kekule.CoordUtils.getDistance(i,n)<5)return}this._requestInteractiveTransform(e,t)}},_requestInteractiveTransform:function(e,t){this._transformInfo.interactScreenCoord={x:e,y:t},!this._interactiveTransformStepId&&Kekule.$jsRoot.requestAnimationFrame&&(this._interactiveTransformStepId=Kekule.$jsRoot.requestAnimationFrame(this._doInteractiveTransformStepBind))},_doInteractiveTransformStep:function(){if(this._transformInfo){if(this._transformInfo.isGestureTransforming)this._doGestureInteractTransformStep();else if(this._transformInfo.isTransforming){var e=this.getViewer(),t=this._transformInfo.interactScreenCoord;this.getViewerRenderType()===Kekule.Render.RendererType.R3D?e.getEnabledOfDirectInteractionMode("rotate")&&this.rotateByXYDistance(t.x,t.y):e.getEnabledOfDirectInteractionMode("move")&&this.moveByXYDistance(t.x,t.y)}this._interactiveTransformStepId=window.requestAnimationFrame(this._doInteractiveTransformStepBind)}},_doGestureInteractTransformStep:function(){var e=this.getViewer();if(e&&e.getChemObj()){var t=this._transformInfo;if(t.isGestureTransforming&&t.pinchScale){var r=t.pinchScale;if(r&&e.getEnabledOfDirectInteractionMode("zoom")){var i=t.initialGestureZoomLevel*r;e.zoomTo(i)}}}},_doInteractiveTransformEnd:function(){this._interactiveTransformStepId&&(Kekule.$jsRoot.cancelAnimationFrame&&Kekule.$jsRoot.cancelAnimationFrame(this._interactiveTransformStepId),this._interactiveTransformStepId=null)},_getRestraintRotate3DEdgeSize:function(){var e=this.getViewer();if(e.getEnableRestraintRotation3D()&&e.getRenderType()===Kekule.Render.RendererType.R3D){var t=e.getDimension();return Math.min(t.width,t.height)*(e.getRestraintRotation3DEdgeRatio()||0)}return 0},tryHotTrackBasicObject:function(e,t){return this.doTryHotTrackBasicObject(e,t)},doTryHotTrackBasicObject:function(e,t){var r=this.getViewer();if(r.getEnableObjectHotTrack()){var i=r.getTopmostBasicObjectAtCoord(e,t);r.setHotTrackedObjects(i||null)}},trySelectBasicObject:function(e,t,r){return this.doTrySelectBasicObject(e,t,r)},doTrySelectBasicObject:function(e,t,r){var i=this.getViewer();if(i.getEnableObjectSelect()){var n=i.getTopmostBasicObjectAtCoord(e,r);t&&this.getViewer().getViewerConfigs().getInteractionConfigs().getEnableBasicObjectMultiSelect()?n&&i.toggleSelectingState(n):i.select(n||null)}},needReactEvent:function(e){return this.getEnableInteraction()&&this.isEventFromInteractionArea(e)},react_dblclick:function(e){this.needReactEvent(e)&&this.getViewer().resetDisplay()},react_mousewheel:function(e){if(this.needReactEvent(e)&&this.getViewer().getEnabledOfDirectInteractionMode("zoom")){var t=e.wheelDeltaY||e.wheelDelta;t&&(t/=120);var r=e.getOffsetCoord();return this.zoomViewer(t,r),e.preventDefault(),!0}},react_pointerdown:function(e){this.needReactEvent(e)&&e.getButton()===s.MouseButton.LEFT&&(e.getPointerType()!==s.PointerType.TOUCH||this.getEnableTouchInteraction())&&(this._pointerLeftButtonDownInitCoord={x:e.getScreenX(),y:e.getScreenY()},this._beginInteractTransformAtCoord(e.getScreenX(),e.getScreenY(),e.getClientX(),e.getClientY(),e,e.pointerId))},react_pointerhold:function(e){this.needReactEvent(e)&&e.getPointerType()===s.PointerType.TOUCH&&(e.getButton(),s.MouseButton.LEFT)},react_pointerleave:function(e){this._transformInfo.isTransforming&&this._endInteractTransform(),this.getViewer().clearHotTrackedItems(null,!0)},react_pointerup:function(e){if(e.getButton()===s.MouseButton.LEFT&&(this._transformInfo.isTransforming&&this._endInteractTransform(),this._pointerLeftButtonDownInitCoord)){var t={x:e.getScreenX(),y:e.getScreenY()};if(Kekule.CoordUtils.getDistance(t,this._pointerLeftButtonDownInitCoord)<3){var r=this._getEventMouseCoord(e),i=e.getShiftKey()||e.getCtrlKey();this.trySelectBasicObject(r,i,this.getViewer().getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation())}this._pointerLeftButtonDownInitCoord=null}},react_pointermove:function(e){if(this.needReactEvent(e)){if(this._transformInfo.isTransforming){this._interactTransformAtCoord(e.getScreenX(),e.getScreenY(),e.pointerId);try{e.preventDefault()}catch(e){}}var t=this._getEventMouseCoord(e);this.tryHotTrackBasicObject(t,this.getViewer().getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation())}},moveByXYDistance:function(e,t){var r=this._transformInfo;if(r&&r.isTransforming&&!r.calculating){var i=this.getViewer();if(i.getRenderType()===Kekule.Render.RendererType.R3D)return;r.calculating=!0;try{var n={x:e,y:t};if(r.lastCoord&&Kekule.CoordUtils.isEqual(n,r.lastCoord));else{var o=Kekule.CoordUtils.substract(n,r.transformInitCoord),a=r.initBaseCoordOffset;a=Kekule.CoordUtils.add(a,o),i.setBaseCoordOffset(a),r.lastCoord=n}}finally{r.calculating=!1}}},rotateByXYDistance:function(e,t){var r=this._transformInfo;if(r&&r.isTransforming&&!r.calculating){var i=this.getViewer();if(i.getRenderType()!==Kekule.Render.RendererType.R3D)return;r.calculating=!0;try{var n={x:e,y:t};if(r.lastCoord&&Kekule.CoordUtils.isEqual(n,r.lastCoord));else{var o,a,s,l=Kekule.CoordUtils.substract(n,r.lastCoord);if(l.y=-l.y,this._restraintCoord){var u=this._restraintCoord;"x"===u?(o=l.y,s={x:1,y:0,z:0}):(o=l.x,s="y"===u?{x:0,y:-1,z:0}:{x:0,y:0,z:1}),a=-o*r.angleRatio}else a=(o=Kekule.CoordUtils.getDistance({x:0,y:0},l))*r.angleRatio,s={x:-l.y,y:l.x,z:0};i.rotate3DByAxis(a,s),r.lastCoord=n,r.calculating=!1}}catch(e){}finally{r.calculating=!1}}},doTestMouseCursor:function(e,t){var r="";return this._transformInfo.isTransforming&&(r="move"),r},react_pinchstart:function(e){this.getEnableGestureManipulation()&&this._beginGestureInteractTransform(e)},react_pinchmove:function(e){if(this.getEnableGestureManipulation()){var t=this._transformInfo;t.isGestureTransforming&&(t.pinchScale=e.scale)}},react_pinchend:function(e){this.getEnableGestureManipulation()&&this._transformInfo.isGestureTransforming&&this._endInteractTransform()},react_pinchcancel:function(e){this.getEnableGestureManipulation()&&this._transformInfo.isGestureTransforming&&this._endGestureInteractTransform()}}),Kekule.ChemWidget.Viewer2D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer2D",initialize:function(e,t){this.tryApplySuper("initialize",[e,t,Kekule.Render.RendererType.R2D])},getAllowRenderTypeChange:function(){return!1}}),Kekule.ChemWidget.Viewer3D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer3D",initialize:function(e,t){this.tryApplySuper("initialize",[e,t,Kekule.Render.RendererType.R3D])},getAllowRenderTypeChange:function(){return!1}});var l=Kekule.ObjPropSettingManager;l.register("Kekule.ChemWidget.Viewer.fullFunc",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,enableEdit:!0,toolButtons:null}),l.register("Kekule.ChemWidget.Viewer.basic",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[r.saveData,r.molDisplayType,r.zoomIn,r.zoomOut],menuItems:[r.saveData,"-",r.molDisplayType,r.zoomIn,r.zoomOut]}),l.register("Kekule.ChemWidget.Viewer.mini",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[r.menu],menuItems:[r.saveData,"-",r.molDisplayType,r.zoomIn,r.zoomOut]}),l.register("Kekule.ChemWidget.Viewer.static",{enableToolbar:!1,enableDirectInteraction:!1,enableTouchInteraction:!1,toolButtons:[],menuItems:[]}),l.register("Kekule.ChemWidget.Viewer.editOnly",{enableToolbar:!0,enableEdit:!0,toolButtons:[r.openEditor],menuItems:[r.openEditor]}),Kekule.ChemWidget.Viewer.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.ChemWidget.Viewer.Settings",initProperties:function(){this.defineDelegatedProps(["enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","enableEdit","modalEdit"])},getViewer:function(){return this.getWidget()}}),Kekule.ChemWidget.ViewerConfigs=Class.create(Kekule.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerConfigs",initProperties:function(){this.addConfigProp("interactionConfigs","Kekule.ChemWidget.ViewerInteractionConfigs"),this.addConfigProp("hotKeyConfigs","Kekule.ChemWidget.ViewerHotKeyConfigs"),this.addConfigProp("uiMarkerConfigs","Kekule.ChemWidget.ViewerUiMarkerConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("interactionConfigs",new Kekule.ChemWidget.ViewerInteractionConfigs),this.setPropStoreFieldValue("hotKeyConfigs",new Kekule.ChemWidget.ViewerHotKeyConfigs),this.setPropStoreFieldValue("uiMarkerConfigs",new Kekule.ChemWidget.ViewerUiMarkerConfigs)}}),Kekule.ChemWidget.ViewerInteractionConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerInteractionConfigs",initProperties:function(){this.addBoolConfigProp("enableBasicObjectHotTrack",!1),this.addHashConfigProp("enableBasicObjectSelect",!1),this.addHashConfigProp("enableBasicObjectMultiSelect",!1),this.addBoolConfigProp("enableTrackOnNearest",!0),this.addIntConfigProp("objBoundTrackInflation",5)}}),Kekule.ChemWidget.ViewerHotKeyConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerHotKeyConfigs",initProperties:function(){this.defineProp("hotKeys",{dataType:DataType.ARRAY})},initPropValues:function(){var e=Kekule.ChemWidget.ComponentWidgetNames;this.tryApplySuper("initPropValues"),this.setHotKeys([{key:"Ctrl+C",action:e.copy},{key:"+",action:e.zoomIn},{key:"-",action:e.zoomOut},{key:"Space",action:e.reset},{key:"R",action:e.rotateLeft,repeat:null,coordMode:2},{key:"Shift-R",action:e.rotateRight,repeat:null,coordMode:2},{key:"X",action:e.rotateX,repeat:null,coordMode:3},{key:"Shift+X",action:e.rotateX,repeat:null,coordMode:3},{key:"Y",action:e.rotateY,repeat:null,coordMode:3},{key:"Shift+Y",action:e.rotateY,repeat:null,coordMode:3},{key:"Z",action:e.rotateZ,repeat:null,coordMode:3},{key:"Shift+Z",action:e.rotateZ,repeat:null,coordMode:3},{key:"H",action:e.molHideHydrogens,coordMode:3},{key:"1",action:e.molDisplayTypeSkeletal,coordMode:2},{key:"1",action:e.molDisplayTypeCondensed,coordMode:2},{key:"1",action:e.molDisplayTypeWire,coordMode:3},{key:"2",action:e.molDisplayTypeSticks,coordMode:3},{key:"3",action:e.molDisplayTypeBallStick,coordMode:3},{key:"4",action:e.molDisplayTypeSpaceFill,coordMode:3}])}}),Kekule.ChemWidget.ViewerUiMarkerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs",initProperties:function(){this.addHashConfigProp("hotTrackMarkerStyles",void 0),this.addHashConfigProp("selectionMarkerStyles",void 0),this.addHashConfigProp("hotTrackedObjectStyles",void 0),this.addHashConfigProp("selectedObjectStyles",void 0)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setHotTrackMarkerStyles({strokeColor:"#0000FF",opacity:.2}),this.setSelectionMarkerStyles({opacity:.35,strokeColor:"#0000FF",strokeWidth:2})}}),Kekule.ChemWidget.ActionOnViewer=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionOnViewer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},getViewer:function(){var e=this.getDisplayer();return e instanceof Kekule.ChemWidget.Viewer?e:null}}),Kekule.ChemWidget.ActionViewerRotateBase=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this.setDelta(2*Math.PI/180)},initProperties:function(){this.defineProp("delta",{dataType:DataType.FLOAT})},isShiftModified:function(e){return e&&e.getShiftKey()}}),Kekule.ChemWidget.ActionViewerRotateBase2D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase2D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getViewer(),t=e&&e.getRenderType()===Kekule.Render.RendererType.R2D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),Kekule.ChemWidget.ActionViewerRotateBase3D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase3D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getViewer(),t=e&&e.getRenderType()===Kekule.Render.RendererType.R3D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),Kekule.ChemWidget.ActionViewerRotateLeft=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateLeft",HTML_CLASSNAME:a.ACTION_ROTATE_LEFT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATELEFT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATELEFT")])},doExecute:function(e,t){var r=this.getDelta();this.getViewer().rotate2DBy(r)}}),Kekule.ChemWidget.ActionViewerRotateRight=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateRight",HTML_CLASSNAME:a.ACTION_ROTATE_RIGHT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATERIGHT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATERIGHT")])},doExecute:function(e,t){var r=-this.getDelta();this.getViewer().rotate2DBy(r)}}),Kekule.ChemWidget.ActionViewerRotateX=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateX",HTML_CLASSNAME:a.ACTION_ROTATE_X,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEX"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEX")])},doExecute:function(e,t){var r=this.isShiftModified(t),i=-this.getDelta();r&&(i=-i),this.getViewer().rotate3DBy(i,0,0)}}),Kekule.ChemWidget.ActionViewerRotateY=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateY",HTML_CLASSNAME:a.ACTION_ROTATE_Y,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEY"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEY")])},doExecute:function(e,t){var r=this.isShiftModified(t),i=-this.getDelta();r&&(i=-i),this.getViewer().rotate3DBy(0,i,0)}}),Kekule.ChemWidget.ActionViewerRotateZ=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateZ",HTML_CLASSNAME:a.ACTION_ROTATE_Z,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEZ"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEZ")])},doExecute:function(e,t){var r=this.isShiftModified(t),i=-this.getDelta();r&&(i=-i),this.getViewer().rotate3DBy(0,0,i)}}),Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub",initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_MOL_DISPLAY_TYPE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_DISPLAY_TYPE")])},doExecute:function(e){},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(this.getEnabled()&&this._isMolInViewer(e))},_isMolInViewer:function(e){if(e){var t=e.getChemObj();if(t){if(t instanceof Kekule.ChemStructureNode)return!0;var r=Kekule.ChemStructureUtils.getAllStructFragments(t);return!(!r||!r.length)}return!1}return!1}}),Kekule.ChemWidget.ActionViewerEdit=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerEdit",HTML_CLASSNAME:a.ACTION_VIEWER_EDIT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_OPENEDITOR"),Kekule.$L("ChemWidgetTexts.HINT_OPENEDITOR")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getViewer();this.setEnabled(e&&e.getAllowEditing()&&e.getEnabled()),this.setDisplayed(e&&e.getEnableEdit())},doExecute:function(e){this.getViewer().openEditor(e)}}),Kekule.ChemWidget.Viewer.rotate2DActionClasses=[i.ActionViewerRotateLeft,i.ActionViewerRotateRight],Kekule.ChemWidget.Viewer.rotate3DActionClasses=[i.ActionViewerRotateX,i.ActionViewerRotateY,i.ActionViewerRotateZ],Kekule.ChemWidget.Viewer.molDisplayType2DActionClasses=[i.ActionDisplayerChangeMolDisplayTypeSkeletal,i.ActionDisplayerChangeMolDisplayTypeCondensed],Kekule.ChemWidget.Viewer.molDisplayType3DActionClasses=[i.ActionDisplayerChangeMolDisplayTypeWire,i.ActionDisplayerChangeMolDisplayTypeSticks,i.ActionDisplayerChangeMolDisplayTypeBallStick,i.ActionDisplayerChangeMolDisplayTypeSpaceFill],Kekule._registerAfterLoadSysProc(function(){var e=Kekule.ActionManager,t=Kekule.ChemWidget,i=Kekule.ChemWidget.Viewer,n=e.registerNamedActionClass;n(r.loadFile,t.ActionDisplayerLoadFile,i),n(r.loadData,t.ActionDisplayerLoadData,i),n(r.saveData,t.ActionDisplayerSaveFile,i),n(r.clearObjs,t.ActionDisplayerClear,i),n(r.zoomIn,t.ActionDisplayerZoomIn,i),n(r.zoomOut,t.ActionDisplayerZoomOut,i),n(r.rotateLeft,t.ActionViewerRotateLeft,i),n(r.rotateRight,t.ActionViewerRotateRight,i),n(r.rotateX,t.ActionViewerRotateX,i),n(r.rotateY,t.ActionViewerRotateY,i),n(r.rotateZ,t.ActionViewerRotateZ,i),n(r.reset,t.ActionDisplayerReset,i),n(r.molHideHydrogens,t.ActionDisplayerHideHydrogens,i),n(r.molAutoGenerateCoords,t.ActionDisplayerAutoGenerateCoordsForMolecule,i),n(r.molDisplayType,t.ActionViewerChangeMolDisplayTypeStub,i),n(r.copy,t.ActionDisplayerCopy,i),n(r.openEditor,t.ActionViewerEdit,i),n(r.config,Kekule.Widget.ActionOpenConfigWidget,i),n(r.molDisplayTypeCondensed,t.ActionDisplayerChangeMolDisplayTypeCondensed,i),n(r.molDisplayTypeSkeletal,t.ActionDisplayerChangeMolDisplayTypeSkeletal,i),n(r.molDisplayTypeWire,t.ActionDisplayerChangeMolDisplayTypeWire,i),n(r.molDisplayTypeSticks,t.ActionDisplayerChangeMolDisplayTypeSticks,i),n(r.molDisplayTypeBallStick,t.ActionDisplayerChangeMolDisplayTypeBallStick,i),n(r.molDisplayTypeSpaceFill,t.ActionDisplayerChangeMolDisplayTypeSpaceFill,i)})}(),function(){"use strict";Kekule._registerAfterLoadSysProc(function(){if(Kekule.ChemWidget&&Kekule.Spectroscopy){var e=Kekule.ArrayUtils,t=Kekule.ObjUtils,r=Kekule.ZoomUtils;Kekule.globalOptions.add("chemWidget.viewer",{enableSpectrumView:!0,enableLocalSpectrumView:!0}),Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs",initProperties:function(){this.addBoolConfigProp("enableSpectrumView",void 0),this.addBoolConfigProp("enableLocalSpectrumView",void 0),this.addNumConfigProp("spectrumAxisLabelFontSizeMin",15),this.addNumConfigProp("spectrumAxisLabelFontSizeMax",35),this.addNumConfigProp("spectrumAxisLabelFontSizeFixed",18),this.addNumConfigProp("spectrumAxisScaleLabelFontSizeMin",13),this.addNumConfigProp("spectrumAxisScaleLabelFontSizeMax",32),this.addNumConfigProp("spectrumAxisScaleLabelFontSizeFixed",15),this.addHashConfigProp("enableSpectrumDataHotTrackOnMode",void 0),this.addHashConfigProp("enableSpectrumDataSelectOnMode",void 0),this.addHashConfigProp("enableSpectrumDataMultiSelectOnMode",void 0),this.addHashConfigProp("spectrumDataHotTrackUiMarkersOnMode",void 0),this.addHashConfigProp("spectrumDataSelectUiMarkersOnMode",void 0),this.addHashConfigProp("spectrumHotTrackDataPointMarkerDrawStyles",void 0),this.addHashConfigProp("spectrumSelectDataPointMarkerDrawStyles",void 0),this.addHashConfigProp("spectrumHotTrackedDataPointDetailMarkerDrawStyles",void 0),this.addHashConfigProp("spectrumSelectedDataPointDetailMarkerDrawStyles",void 0),this.addIntConfigProp("spectrumDataPointMarkerSize",15),this.addIntConfigProp("spectrumDataPointMarkerWidth",2),this.addIntConfigProp("spectrumDataPointDetailMarkerValuePrecision",8),this.addIntConfigProp("spectrumDataPointDetailMarkerPadding",5),this.addHashConfigProp("spectrumPeakHotTrackStyles",void 0),this.addHashConfigProp("spectrumPeakSelectStyles",void 0),this.addNumConfigProp("spectrumDataPointSelectInflation",1.5),this.defineProp("spectrumZoomPrimaryModifierKeys",{dataType:DataType.ARRAY}),this.defineProp("spectrumZoomSecondaryModifierKeys",{dataType:DataType.ARRAY}),this.defineProp("spectrumZoomBothModifierKeys",{dataType:DataType.ARRAY})},initPropDefValues:function(){this.tryApplySuper("initPropDefValues");var e=Kekule.Spectroscopy.DataMode,t={default:!0};this.setEnableSpectrumDataHotTrackOnMode(t);t={default:!1};this.setEnableSpectrumDataSelectOnMode(t);t={default:!1};this.setEnableSpectrumDataMultiSelectOnMode(t),(t={})[e.CONTINUOUS]=[i.DATA_POINT,i.DATA_DETAIL],t[e.PEAK]=[i.PEAK,i.DATA_DETAIL],this.setSpectrumDataHotTrackUiMarkersOnMode(t),(t={})[e.CONTINUOUS]=[i.DATA_POINT],t[e.PEAK]=[i.PEAK],this.setSpectrumDataSelectUiMarkersOnMode(t),this.setSpectrumHotTrackDataPointMarkerDrawStyles({color:"#c21717",strokeWidth:1,opacity:1}),this.setSpectrumSelectDataPointMarkerDrawStyles({color:"#0077d6",strokeWidth:1,opacity:1}),this.setSpectrumHotTrackedDataPointDetailMarkerDrawStyles({fontFamily:"Arial, Helvetica, sans-serif",fontSize:15,color:"#c21717",strokeWidth:2,opacity:1}),this.setSpectrumSelectedDataPointDetailMarkerDrawStyles({fontFamily:"Arial, Helvetica, sans-serif",fontSize:15,color:"#0077d6",strokeWidth:2,opacity:1}),this.setSpectrumPeakHotTrackStyles({color:"#c21717"}),this.setSpectrumPeakSelectStyles({color:"#0077d6",spectrum_dataStrokeWidthRatio:.05}),this.setSpectrumZoomPrimaryModifierKeys([]),this.setSpectrumZoomSecondaryModifierKeys(["shift"]),this.setSpectrumZoomBothModifierKeys(["alt"])},initPropValues:function(){this.tryApplySuper("initPropValues")},getActualEnableSpectrumView:function(){return Kekule.oneOf(this.getEnableSpectrumView(),Kekule.globalOptions.chemWidget.viewer.enableSpectrumView)},getActualEnableLocalSpectrumView:function(){return Kekule.oneOf(this.getEnableLocalSpectrumView(),Kekule.globalOptions.chemWidget.viewer.enableLocalSpectrumView)},getDataModeSpecifiedConfigValue:function(e,t){var r=this.getPropValue(e);if(DataType.isObjectValue(r)){var i=r[t];return void 0===i&&(i=r.default),i}return r},setDataModeSpecifiedConfigValue:function(e,t,r){var i=this.getPropValue(e);i||(i={},this.setPropValue(e,i)),Kekule.ObjUtils.notUnset(r)?i[r]=t:i.default=t},getDataModeSpecifiedBoolConfigValueOfModeList:function(t,r,i){var n=e.toArray(r),o=this.getDataModeSpecifiedConfigValue(t,n[0]);if(!o&&i)return o;for(var a=0,s=n.length;a<s;++a)if(i){if(!(o=o&&this.getDataModeSpecifiedConfigValue(t,n[a])))return o}else o=o||this.getDataModeSpecifiedConfigValue(t,n[a]);return o}}),ClassEx.extendMethods(Kekule.ChemWidget.ChemObjDisplayerConfigs,{initProperties:function($origin){$origin(),this.addConfigProp("spectrumViewConfigs","Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs")},initPropDefValues:function($origin){$origin(),this.setPropStoreFieldValue("spectrumViewConfigs",new Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs)}}),Kekule.ChemWidget.Viewer.SpectrumSubView=Class.create(Kekule.ChemWidget.ViewerSubView,{CLASS_NAME:"Kekule.ChemWidget.Viewer.SpectrumSubView",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("spectrum",{dataType:"Kekule.Spectroscopy.Spectrum",serializable:!1,getter:function(){return this.getTarget()},setter:function(e){this.setTarget(e)}}),this.defineProp("viewportRanges",{dataType:DataType.HASH,serializable:!1}),this.defineProp("hotTrackedDataItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getHotTrackedDataItemEx();return e&&e.dataItem},setter:function(e){var t=e&&this._findSectionOfDataItem(e,!0),r=t?{section:t,dataValue:e}:null;this.changeHotTrackedDataItem(r,!0)}}),this.defineProp("hotTrackedDataItemEx",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getHotTrackedDataItemsEx();return e&&e[0]},setter:function(e){var t=this._fetchDataItemsEx(e);this.changeHotTrackedDataItems(t,!0)}}),this.defineProp("hotTrackedDataItemsEx",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("hotTrackedDataItemsEx")||[]},setter:function(e){this.changeHotTrackedDataItems(e,!0)}}),this.defineProp("selectedDataItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(e){var t=this.getSelectedDataItemEx();return t&&t.dataItem},setter:function(e){var t=e&&this._findSectionOfDataItem(e,!0),r=t?{section:t,dataValue:e}:null;this.changeSelectedDataItems(r&&[r],!0)}}),this.defineProp("selectedDataItems",{dataType:DataType.ARRAY,serializable:!1,getter:function(e){var t=this.getSelectedDataItemsEx();if(t){for(var r=[],i=0,n=t.length;i<n;++i)r.push(t[i].dataItem);return r}return[]},setter:function(e){var t=this._fetchDataItemsEx(e);this.changeSelectedDataItems(t,!0)}}),this.defineProp("selectedDataItemEx",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getSelectedDataItemsEx();return e&&e[0]},setter:function(e){this.changeSelectedDataItems(e&&[e],!0)}}),this.defineProp("selectedDataItemsEx",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("selectedDataItemsEx")||[]},setter:function(e){this.changeSelectedDataItems(e,!0)}}),this.defineProp("isSpectrumWithReversedAxises",{dataType:DataType.BOOL,serializable:!1,setter:null,getter:function(){var e=this._getSpectrumRenderCache();return!(!e||!e.spectrum_reversedAxises)}})},appliableToTarget:function(e){return e instanceof Kekule.Spectroscopy.Spectrum},_getSpectrumRenderer:function(){var e=this.getSpectrum();if(e){var t=this.getViewer().getDrawContext(),r=this.getViewer().getRootRenderer();return r&&r.getDirectRendererForChildObj&&r.getDirectRendererForChildObj(t,e)}return null},_getSpectrumRenderCache:function(){var e=this._getSpectrumRenderer(),t=this.getViewer().getDrawContext();return e&&e.getRenderCache(t)},getDisplayedDataModes:function(){for(var e=this.getSpectrum(),t=e&&e.getDisplayedDataSections()||[],r=[],i=0,n=t.length;i<n;++i)r.push(t[i].getMode());return r},getClientScreenBox:function(){var e=this.getViewer(),t=this.getSpectrum();if(t){var r=e.getBoundInfoRecorder(),i=r&&r.getBound(e.getDrawContext(),t.getPseudoRenderSubObject("data"));return i.shapeType===Kekule.Render.MetaShapeType.RECT?Kekule.BoxUtils.createBox(i.coords[0],i.coords[1]):null}return null},fetchViewportRanges:function(){var e={},t=Kekule.VarDependency;return e[t.INDEPENDENT]=this.getViewportRange(t.INDEPENDENT),e[t.DEPENDENT]=this.getViewportRange(t.DEPENDENT),e},getViewportRange:function(e){var t=(this.getViewportRanges()||{})[e]||{};return Object.extend({rangeFrom:0,rangeTo:1},t)},setViewportRange:function(e,t,r){var i=this.getViewportRanges();i||(i={},this.setViewportRanges(i));var n=i[e];return n||(n={},i[e]=n),n.rangeFrom=Kekule.oneOf(t,0),n.rangeTo=Kekule.oneOf(r,1),this.applyToRenderOptions(),this},resetViewportRange:function(e){if(Kekule.ObjUtils.isUnset(e))this.setViewportRanges(void 0);else{var t=this.getViewportRange(e);t&&t[e]&&delete t[e]}this.applyToRenderOptions()},getViewportZoomInfo:function(e){e||(e=Kekule.VarDependency.INDEPENDENT);var t=this.getViewportRange(e);return{zoom:1/Math.abs(t.rangeTo-t.rangeFrom),center:(t.rangeTo+t.rangeFrom)/2}},setViewportZoom:function(e,t,r){(e||(e=Kekule.VarDependency.INDEPENDENT),Kekule.ObjUtils.isUnset(r))&&(r=this.getViewportZoomInfo(e).center);var i=1/t/2,n={rangeFrom:r-i,rangeTo:r+i};this.setViewportRange(e,n.rangeFrom,n.rangeTo)},_zoomViewportTo:function(e,t,r,i){var n,o=this.getClientScreenBox(),a=this.getViewportRange(i),s=1/e-(a.rangeTo-a.rangeFrom);n=t?"x"===r?(t.x-o.x1)/(o.x2-o.x1):(o.y2-t.y)/(o.y2-o.y1):.5;var l=a.rangeFrom-s*n,u=a.rangeTo+s*(1-n);return this.setViewportRange(i,l,u),this},zoomViewportByDelta:function(e,t,i){var n=this.getViewer();n.beginUpdate();try{for(var o=0,a=i.length;o<a;++o){var s=i[o],l="x"===s;this.getIsSpectrumWithReversedAxises()&&(l=!l);var u,d=l?Kekule.VarDependency.INDEPENDENT:Kekule.VarDependency.DEPENDENT,c=this.getViewportZoomInfo(d).zoom;e>0?u=r.getNextZoomInRatio(c,e):e<0&&(u=r.getNextZoomOutRatio(c,-e)),this._zoomViewportTo(u,t,s,d)}}finally{n.endUpdate()}},_applyViewportRanges:function(){this.getViewer();for(var e=[Kekule.VarDependency.INDEPENDENT,Kekule.VarDependency.DEPENDENT],t=["independent","dependent"],r=this.getTarget(),i=0,n=t.length;i<n;++i){var o=this.getViewportRange(e[i]),a="spectrum_viewport"+t[i].upperFirst()+"DataRangeFrom",s="spectrum_viewport"+t[i].upperFirst()+"DataRangeTo",l={};l[a]=o.rangeFrom,l[s]=o.rangeTo,r.addOverrideRenderOptionItem(l)}},applyToRenderOptions:function(){this._applyViewportRanges(),this.doRepaintSpectrum()},doRepaintSpectrum:function(){var e=this.getViewer(),t=e.getRootRenderer();t&&(t.update(e.getDrawContext(),[{obj:this.getTarget()}]),this.updateSpectrumDataItemUiMarkers())},_getHotTrackedDataItemRenderStyles:function(){var e=this.getViewer();return e&&e.getDisplayerConfigs().getSpectrumViewConfigs().getSpectrumPeakHotTrackStyles()},_getSelectedDataItemRenderStyles:function(){var e=this.getViewer();return e&&e.getDisplayerConfigs().getSpectrumViewConfigs().getSpectrumPeakSelectStyles()},_findSectionOfDataItem:function(e,t){for(var r=this.getSpectrum(),i=t?r.getDisplayedDataSections():r.getDataSections(),n=0,o=i.length;n<o;++n){var a=i[n];if(a.indexOfDataItem(e)>=0)return a}return null},_fetchDataItemsEx:function(t){for(var r=t?e.toArray(t):[],i=[],n=0,o=r.length;n<o;++n){var a,s=r[n];if(DataType.isObjectValue(s)&&s.section&&s.dataValue)a=s;else{var l=s&&this._findSectionOfDataItem(s,!0);a=l?{section:l,dataValue:s}:null}a&&i.push(a)}return i},_indexOfDataItemEx:function(e,r){var i=r.indexOf(e);if(i<=0)for(var n=0,o=r.length;n<o;++n){var a=r[n];if(e.section&&a.section===e.section)if(e.section.isPeakSection()){var s=a.section._getDataValueSrc(a.dataValue);if(s&&e.section._getDataValueSrc(e.dataValue)===s){i=n;break}}else if(t.equal(e.dataValue,a.dataValue)){i=n;break}}return i},addToSelection:function(t){for(var r=e.clone(this.getSelectedDataItemsEx()),i=this._fetchDataItemsEx(t),n=0,o=i.length;n<o;++n){var a=i[n];this._indexOfDataItemEx(a,r)>=0||r.push(a)}this.changeSelectedDataItems(r,!0)},removeFromSelection:function(t){for(var r=e.clone(this.getSelectedDataItemsEx()),i=this._fetchDataItemsEx(t),n=0,o=i.length;n<o;++n){var a=i[n],s=this._indexOfDataItemEx(a,r);s>=0&&r.splice(s,1)}this.changeSelectedDataItems(r,!0)},toggleSelectingState:function(t){for(var r=e.clone(this.getSelectedDataItemsEx()),i=this._fetchDataItemsEx(t),n=0,o=i.length;n<o;++n){var a=i[n],s=this._indexOfDataItemEx(a,r);s>=0?r.splice(s,1):r.push(a)}this.changeSelectedDataItems(r,!0)},select:function(e){var t=this._fetchDataItemsEx(e);this.changeSelectedDataItems(t,!0)},doClearHotTrackedItems:function(){this.changeHotTrackedDataItems(null,!1)},doClearSelectedItems:function(){this.changeSelectedDataItems(null,!1)},_hotTrackedDataItemsChanged:function(e,t){this._hotTrackedOrSelectDataItemsChanged(e,t,!1),this.invokeEvent("hotTrackOnSpectrumData",{spectrum:this.getSpectrum(),dataItems:t,prevDataItems:e})},_selectedDataItemsChanged:function(e,t){this._hotTrackedOrSelectDataItemsChanged(e,t,!0),this.invokeEvent("spectrumDataSelectionChange",{spectrum:this.getSpectrum(),dataItems:t,prevDataItems:e})},_hotTrackedOrSelectDataItemsChanged:function(e,t,r){var i=this.getViewer(),n=this.getSpectrum(),o=!1,a=r?"_selectDataItemRenderStyles":"_hotTrackedDataItemRenderStyles";if(t&&t.length&&(r?i.clearSelectedItems([this],!1):i.clearHotTrackedItems([this],!1)),e)for(var s=0,l=e.length;s<l;++s)this._updateHotTrackOrSelectUiMarkerToDataItem(null,r,s),this[a]&&(n.removeDataItemOverrideRenderOptionItem(e[s].dataValue,this[a]),o=!0);if(t)for(s=0,l=t.length;s<l;++s){this._updateHotTrackOrSelectUiMarkerToDataItem(t[s],r,s).needRepaintSpectrum&&(o=!0)}else this._updateHotTrackOrSelectUiMarkerToDataItem(null,r);o&&i.requestRepaint()},_updateHotTrackOrSelectUiMarkerToDataItem:function(e,t,r){var n=this.getViewer(),o=this.getViewer().getDisplayerConfigs().getSpectrumViewConfigs(),a=t?"_selectDataItemRenderStyles":"_hotTrackedDataItemRenderStyles",s=e&&e.dataValue?t?this._getSpectrumDataSelectElements(o,e.section):this._getSpectrumDataHotTrackElements(o,e.section):[],l=s.indexOf(i.DATA_POINT)>=0,u=s.indexOf(i.DATA_DETAIL)>=0,d=t?"selectDataDetail":"hotTrackDataDetail";d+=r||0;var c=t?"selectDataPoint":"hotTrackDataPoint";c+=r||0;var h=n.getSpectrumUiMarker(d,!!u),p=n.getSpectrumUiMarker(c,!!l),g=!1;if(e&&s.length){var f=this.getSpectrum(),C=e.dataValue;if(e.section.isPeakSection()&&s.indexOf(i.PEAK)>=0){var m=t?this._getSelectedDataItemRenderStyles():this._getHotTrackedDataItemRenderStyles();m&&(f.addDataItemOverrideRenderOptionItem(e.dataValue,m),this[a]=m,g=!0)}if(l||u){var T=this.getClientScreenBox(),E=this.calcCoordAtSpectrumData(C,Kekule.Render.CoordSystem.CONTEXT),_=null;u&&(_=this._formatSpectrumDataValueString(C,o.getSpectrumDataPointDetailMarkerValuePrecision()))}var S=t?o.getSpectrumSelectedDataPointDetailMarkerDrawStyles():o.getSpectrumHotTrackedDataPointDetailMarkerDrawStyles(),O=t?o.getSpectrumSelectDataPointMarkerDrawStyles():o.getSpectrumHotTrackDataPointMarkerDrawStyles();this._updateDataDetailMarker(h,E,{text:_},u,S,T,!1),this._updateDataPointMarker(p,E,null,l,O,T,!1)}else h&&n.hideUiMarker(h,!1),p&&n.hideUiMarker(p,!1);return{needRepaintSpectrum:g}},updateSpectrumDataItemUiMarkers:function(e){var t=this.getHotTrackedDataItemsEx();if(t)for(var r=0,i=t.length;r<i;++r){var n=t[r];this._updateHotTrackOrSelectUiMarkerToDataItem(n,!1,r)}else e||this._updateHotTrackOrSelectUiMarkerToDataItem(null,!1,0);var o=this.getSelectedDataItemsEx();if(o)for(r=0,i=o.length;r<i;++r){var a=o[r];this._updateHotTrackOrSelectUiMarkerToDataItem(a,!0,r)}else e||this._updateHotTrackOrSelectUiMarkerToDataItem(null,!0,0)},_isSameHotTrackedOrSelectedItems:function(t,r){var i=t,n=r;return i&&!i.length&&(i=null),n&&!n.length&&(n=null),i==n||!(!i||!n)&&0===e.compare(i,n,function(e,t){return e===t?0:-1})},changeHotTrackedDataItems:function(e,t){var r=this.getHotTrackedDataItemsEx();if(!this._isSameHotTrackedOrSelectedItems(r,e)){var i=this.getViewer();t&&i.beginUpdateUiMarkers();try{this.setPropStoreFieldValue("hotTrackedDataItemsEx",e),this._hotTrackedDataItemsChanged(r,e),t&&i.updateUiMarkers(!0)}finally{t&&i.endUpdateUiMarkers()}}},changeSelectedDataItems:function(e,t){var r=this.getSelectedDataItemsEx();if(!this._isSameHotTrackedOrSelectedItems(r,e)){var i=this.getViewer();t&&i.beginUpdateUiMarkers();try{this.setPropStoreFieldValue("selectedDataItemsEx",e),this._selectedDataItemsChanged(r,e),t&&i.updateUiMarkers(!0)}finally{t&&i.endUpdateUiMarkers()}}},_getSpectrumDataHotTrackElements:function(e,t){var r=e,i=t.getMode();return r.getDataModeSpecifiedConfigValue("enableSpectrumDataHotTrackOnMode",i)?r.getDataModeSpecifiedConfigValue("spectrumDataHotTrackUiMarkersOnMode",i):[]},_getSpectrumDataSelectElements:function(e,t){var r=e,i=t.getMode();return r.getDataModeSpecifiedConfigValue("enableSpectrumDataSelectOnMode",i)?r.getDataModeSpecifiedConfigValue("spectrumDataSelectUiMarkersOnMode",i):[]},_formatSpectrumDataValueString:function(e,t){for(var r=Kekule.ObjUtils.getOwnedFieldNames(e),i=[],n=0,o=r.length;n<o;++n)Kekule.NumUtils.isNormalNumber(e[r[n]])&&i.push(r[n]+": "+e[r[n]].toPrecision(t));return i.join(", ")},_updateDataPointMarker:function(e,t,r,i,n,o,a){if(e){var s=this.getViewer(),l=i&&t;if(l)l=!!Kekule.CoordUtils.isInsideBox(t,o);if(l){var u,d=s.getDisplayerConfigs().getSpectrumViewConfigs(),c=s.getRenderConfigs().getLengthConfigs().getUnitLength()||1,h=(d.getSpectrumDataPointMarkerWidth()||1)*c,p=t;if(d.getSpectrumDataPointMarkerSize()){var g=d.getSpectrumDataPointMarkerSize()/2*c;u=[Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:p.x-g,y:p.y},{x:p.x+g,y:p.y}],{width:h}),Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:p.x,y:p.y-g},{x:p.x,y:p.y+g}],{width:h})]}else o&&(u=[Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:o.x1,y:p.y},{x:o.x2,y:p.y}],{width:h}),Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:p.x,y:o.y1},{x:p.x,y:o.y2}],{width:h})]);var f=Object.create(n);f.strokeWidth*=c,s.modifyShapeBasedMarker(e,u,f,!1),s.showUiMarker(e,a)}else s.hideUiMarker(e,a)}},_updateDataDetailMarker:function(e,t,r,i,n,o,a){if(e){var s=this.getViewer(),l=r.text,u=i&&t&&l;if(u)u=!!Kekule.CoordUtils.isInsideBox(t,o);if(u){var d=s.getDisplayerConfigs().getSpectrumViewConfigs(),c=s.getRenderConfigs().getLengthConfigs().getUnitLength()||1,h=Object.create(n);if(h.fontSize*=c,l){var p,g=s.getDrawBridge(),f=g.canMeasureText&&g.canMeasureText(),C=g.canMeasureDrawnText&&g.canMeasureDrawnText(),m=g.canMeasureText&&g.canModifyText();if(f)p=g.measureText(s.getDrawContext(),l,h);else if(C&&m){var T=this.getViewer().getUiContext(),E=g.drawText(T,{x:0,y:0},l,h);p=g.measureDrawnText(T,E),g.removeDrawnElem(T,E)}var _,S,O=(d.getSpectrumDataPointDetailMarkerPadding()||0)*c,y={x1:t.x-o.x1,x2:o.x2-t.x,y1:t.y-o.y1,y2:o.y2-t.y},A={};y.x2-O>=p.width?(A.x=t.x+O,_=Kekule.Render.BoxXAlignment.LEFT):y.x1-O>=p.width?(A.x=t.x-O,_=Kekule.Render.BoxXAlignment.RIGHT):y.x2>=y.x1?(A.x=o.x2-p.width,_=Kekule.Render.BoxXAlignment.LEFT):(A.x=o.x1+p.width,_=Kekule.Render.BoxXAlignment.RIGHT),y.y1-O>=p.height?(A.y=t.y-O,S=Kekule.Render.BoxYAlignment.BOTTOM):y.y2-O>=p.height?(A.y=t.y+O,S=Kekule.Render.BoxYAlignment.TOP):y.y1>=y.y2?(A.y=o.y1+p.height,S=Kekule.Render.BoxYAlignment.BOTTOM):(A.y=o.y2-p.height,S=Kekule.Render.BoxYAlignment.TOP),h.textBoxXAlignment=_,h.textBoxYAlignment=S}s.modifyTextBasedMarker(e,A,l,h,!1),s.showUiMarker(e,a)}else s.hideUiMarker(e,a)}},resetView:function(){this.changeHotTrackedDataItems(null,!1),this.changeSelectedDataItems(null,!1),this.resetViewportRange()},getSpectrumDataValueInfoFromIndependent:function(e,t,r){for(var i=this.getSpectrum(),n=t||i.getDisplayedDataSections()||[],o=0,a=n.length;o<a;++o){var s=n[o],l=s.getDataValueFromIndependent(e,r);if(Kekule.ObjUtils.notUnset(l))return{value:l,section:s}}return null},calcValueFromIndependent:function(e,t){var r={};return r="number"==typeof e?this._convArrayToSymboledHash([e],this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):DataType.isArrayValue(e)?this._convArrayToSymboledHash(e,this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):e,this.doCalcValueFromIndependent(r,t)},translateCoordToSpectrum:function(e,t){var r=this.getViewer().translateCoord(e,t,Kekule.Render.CoordSystem.CONTEXT),i=this._getSpectrumRenderCache().spectrumInvDataTransformMatrix,n=this.getViewer().getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix;return i?n(r,i):r},translateCoordFromSpectrum:function(e,t){var r=this._getSpectrumRenderCache().spectrumDataTransformMatrix,i=this.getViewer().getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix,n=r?i(e,r):e;return this.getViewer().translateCoord(n,Kekule.Render.CoordSystem.CONTEXT,t)},getSpectrumDataValueItemInfoAtCoord:function(e,t,r){for(var i=this.translateCoordToSpectrum(e,t),n=this.getIsSpectrumWithReversedAxises()?i.y:i.x,o=this.getSpectrum().getDisplayedDataSections()||[],a=0,s=o.length;a<s;++a){var l=o[a],u=l.getDataValueFromIndependent(n,r);if(u)return{dataValue:u,dataSection:l}}return null},calcSpectrumDataAtCoord:function(e,t,r){for(var i=this.translateCoordToSpectrum(e,t),n=this.getIsSpectrumWithReversedAxises()?i.y:i.x,o=this.getSpectrum().getDisplayedDataSections()||[],a=0,s=o.length;a<s;++a){var l=o[a].calcValueFromIndependent(n,r);if(l)return l}return null},calcSpectrumDataRangeInCoordRange:function(e,t,r){for(var i=this.getIsSpectrumWithReversedAxises()?"y":"x",n=Kekule.Spectroscopy.Utils.expandDataRange({},e),o=[this.translateCoordToSpectrum({x:n.x.min,y:n.y.min},t),this.translateCoordToSpectrum({x:n.x.max,y:n.y.max},t)],a=[o[0][i],o[1][i]],s={min:Math.min(a[0],a[1]),max:Math.max(a[0],a[1])},l=this.getSpectrum().getDisplayedDataSections()||[],u=0,d=l.length;u<d;++u){var c=l[u],h=c.calcValueRangeFromIndependentRangeEx([s],r);if(h&&h.range)return h.dataSection=c,h}return null},calcSpectrumPrimaryDataValueInCoordRangeEx:function(e,t,r){var i=Object.create(r||null);i.findNearest=!0,i.findInReversedOrder=!0;var n=this.calcSpectrumDataRangeInCoordRange(e,t,i);if(!n)return null;var o,a=n.dataSection;if(a.isPeakSection()&&n.nearest)o=n.nearest.dataValue;else{var s=a.getLocalVarSymbolsOfDependency(Kekule.VarDependency.DEPENDENT)[0];if(s){for(var l=this.getSpectrum(),u=Kekule.Spectroscopy.Utils.getSpectrumPeakPosition(l),d=n.dataValues,c=d[0],h=d.length-1;h>=0;--h){var p=d[h];(u===Kekule.Spectroscopy.DataPeakPosition.MIN&&p[s]<c[s]||p[s]>c[s])&&(c=p)}o=c}else o=d[Math.round((d.length-1)/2)+1]}return{dataValue:o,dataSection:a}},calcSpectrumPrimaryDataValueInCoordRange:function(e,t,r){return this.calcSpectrumPrimaryDataValueInCoordRangeEx(e,t,r).dataValue},calcCoordAtSpectrumData:function(e,t,r){var i=this.getIsSpectrumWithReversedAxises(),n=(this.getSpectrum().getDisplayedDataSections()||[])[0];if(n){var o=this._spectrumSectionDataValueToSpectrumCoord(e,n,i);return o&&this.translateCoordFromSpectrum(o,t)}return null},calcCoordAtSpectrumDataFromIndependent:function(e,t,r){for(var i=this.getSpectrum().getDisplayedDataSections()||[],n=this.getIsSpectrumWithReversedAxises(),o=0,a=i.length;o<a;++o){var s=i[o],l=s.calcValueFromIndependent(indepValue,r);if(l){var u=this._spectrumSectionDataValueToSpectrumCoord(l,s,n);return u&&this.translateCoordFromSpectrum(u,t)}}return null},_spectrumSectionDataValueToSpectrumCoord:function(e,t,r){var i=t.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT),n=t.getLocalVarSymbolsOfDependency(Kekule.VarDependency.DEPENDENT),o=function(e,t){for(var r=0,i=t.length;r<i;++r){var n=e[t[r]];if(Kekule.ObjUtils.notUnset(n))return n}return null},a=o(e,i),s=o(e,n);return{x:r?s:a,y:r?a:s}}}),Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP="spectrum",ClassEx.extend(Kekule.ChemWidget.Viewer,{createShapeBasedSpectrumUiMarker:function(e,t){return this.createShapeBasedMarker(null,null,{name:e,groups:[t,Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP]},!1)},createTextBasedSpectrumUiMarker:function(e,t){return this.createTextBasedMarker(null,null,null,{name:e,groups:[t,Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP]},!1)},getSpectrumUiMarker:function(e,t){var r=this.getUiMarkers().getMarkerOfName(e);if(!r&&t){var i=e.indexOf("DataDetail")>=0,n=e.indexOf("select")>=0?Kekule.ChemWidget.ViewerUiMarkerGroup.SELECT:e.indexOf("hotTrack")>=0?Kekule.ChemWidget.ViewerUiMarkerGroup.HOTTRACK:null;r=i?this.createTextBasedSpectrumUiMarker(e,n):this.createShapeBasedSpectrumUiMarker(e,n)}return r},getSpectrumUiMarkers:function(){return this.getUiMarkers().getMarkersOfGroup(Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP)},_hideAllSpectrumUiMarkers:function(e){this.setVisibleOfUiMarkerGroup(Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP,!1,e)},updateSpectrumViewDataItemUiMarkers:function(){try{this._hideAllSpectrumUiMarkers(!1),this.iterateSubViews(function(e){e instanceof Kekule.ChemWidget.Viewer.SpectrumSubView&&e.updateSpectrumDataItemUiMarkers(!0)})}finally{}}}),ClassEx.extendMethods(Kekule.ChemWidget.Viewer,{_createSpectrumView:function($origin){return this.fetchSubView(this.getChemObj(),Kekule.ChemWidget.Viewer.SpectrumSubView)},_isDisplayingSingleSpectrum:function($origin){var e=this.getChemObj();return!!(e&&e instanceof Kekule.Spectroscopy.Spectrum)},getSpectrumView:function($origin,e){return this.fetchSubView(e||this.getChemObj(),Kekule.ChemWidget.Viewer.SpectrumSubView)},isInSpectrumMode:function($origin){return!(!Kekule.Spectroscopy||!Kekule.Spectroscopy.Spectrum)&&(this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getDisplayerConfigs().getSpectrumViewConfigs().getActualEnableSpectrumView()&&this._isDisplayingSingleSpectrum())},isLocalSpectrumViewEnabled:function($origin){return!(!Kekule.Spectroscopy||!Kekule.Spectroscopy.Spectrum)&&(this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getDisplayerConfigs().getSpectrumViewConfigs().getActualEnableLocalSpectrumView())},enableSpectrumInteraction:function($origin){return this.isInSpectrumMode()||this.isLocalSpectrumViewEnabled()},getEnableUiContext:function($origin){return!0},allowAutoSize:function($origin){return!this.isInSpectrumMode()&&$origin()},getActualDrawOptions:function($origin){var e=$origin();if(this.isInSpectrumMode()&&this.getSpectrumView()){var t=Object.create(e);return Kekule.ObjUtils.isUnset(e.retainAspect)&&(t.retainAspect=!1),t.autofit=!0,t}return e},doLoad:function($origin,e){if(this.isInSpectrumMode()){var t=this.getSpectrumView();t&&t.resetView()}return $origin(e)},_repaintCore:function($origin,e){var t=this.isInSpectrumMode(),r=this.isLocalSpectrumViewEnabled();if(t||r){var i=Object.create(e||{});if(i._spectrum_render_enable_sub_bounds=!0,t){var n=this.getDisplayerConfigs().getSpectrumViewConfigs();i.spectrum_axisLabelFontSizeMin=n.getSpectrumAxisLabelFontSizeMin(),i.spectrum_axisLabelFontSizeMax=n.getSpectrumAxisLabelFontSizeMax(),i.spectrum_axisLabelFontSizeFixed=n.getSpectrumAxisLabelFontSizeFixed(),i.spectrum_axisScaleLabelFontSizeMin=n.getSpectrumAxisScaleLabelFontSizeMin(),i.spectrum_axisScaleLabelFontSizeMax=n.getSpectrumAxisScaleLabelFontSizeMax(),i.spectrum_axisScaleLabelFontSizeFixed=n.getSpectrumAxisScaleLabelFontSizeFixed()}return $origin(i)}return $origin(e)},doUpdateUiMarkers:function($origin){return this.updateSpectrumViewDataItemUiMarkers(),$origin()},repaintUiMarker:function($origin){return $origin()},getCurrZoom:function($origin){return this.isInSpectrumMode()&&this.getSpectrumView()?this.getSpectrumView().getViewportZoomInfo().zoom:$origin()},zoomTo:function($origin,e,t,r){if(this.isInSpectrumMode()){var i=this.getSpectrumView();if(i){var n=i.getClientScreenBox(),o=i.getViewportRange(Kekule.VarDependency.INDEPENDENT),a=1/e-(o.rangeTo-o.rangeFrom),s=r?(r.x-n.x1)/(n.x2-n.x1):.5,l=o.rangeFrom-a*s,u=o.rangeTo+a*(1-s);i.setViewportRange(Kekule.VarDependency.INDEPENDENT,l,u),t||this.geometryOptionChanged()}else $origin(e,t,r)}else $origin(e,t,r);return this},resetZoom:function($origin,e){if(this.isInSpectrumMode()){var t=this.getSpectrumView();return t?(t.resetViewportRange(),this):$origin(e)}return $origin(e)},resetDisplay:function($origin){if(this.isInSpectrumMode()){var e=this.getSpectrumView();e&&e.resetView()}return $origin()}}),Kekule.ChemWidget.Viewer.SpectrumSubView.UiMarker={DATA_POINT:1,DATA_DETAIL:2,PEAK:4};var i=Kekule.ChemWidget.Viewer.SpectrumSubView.UiMarker;ClassEx.extend(Kekule.ChemWidget.ViewerBasicInteractionController,{getSpectrumUiMarker:function(e,t){return this.getViewer().getSpectrumUiMarker(e,t)},_setSpectrumUiMarkersVisible:function(e,t){var r=this.getViewer(),i=this.getSpectrumUiMarker("hotTrackDataPoint",e),n=this.getSpectrumUiMarker("hotTrackDataDetail",e);e?(i&&r.showUiMarker(i,!1),n&&r.showUiMarker(n,!1)):(i&&r.hideUiMarker(i,!1),n&&r.hideUiMarker(n,!1)),t&&r.repaintUiMarker()},hideSpectrumUiMarkers:function(e){this._setSpectrumUiMarkersVisible(!1,e)},showSpectrumUiMarkers:function(e){this._setSpectrumUiMarkersVisible(!0,e)},_getAncestorSpectrumObj:function(e){if(e instanceof Kekule.Spectroscopy.Spectrum)return e;if(e){var t=e.getParent?e.getParent():e.parent;return t?this._getAncestorSpectrumObj(t):null}return null},_getSpectrumObjAtScreenCoord:function(e,t){var r=this.getViewer().getTopmostBasicObjectAtCoord(e,t||0);return this._getAncestorSpectrumObj(r)},getActiveSpectrumViewAtScreenCoord:function(e){var t,r=this.getViewer();if(r.enableSpectrumInteraction()){var i=r.getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation()||0,n=this._getSpectrumObjAtScreenCoord(e,i);n&&(t=r.getSpectrumView(n))}return t},isTransformingSpectrum:function(){return!!this._transformInfo.currSpectrum}}),ClassEx.extendMethods(Kekule.ChemWidget.ViewerBasicInteractionController,{_beginInteractTransformAtCoord:function($origin,e,t,r,i,n,o){$origin(e,t,r,i,n,o);var a=this.getActiveSpectrumViewAtScreenCoord(this._getEventMouseCoord(n));if(a){var s=a.getSpectrum();this._transformInfo.currSpectrum=s,this._transformInfo.spectrumActuallyTransformed=!1,this._transformInfo.initSpectrumViewportRanges=a.fetchViewportRanges()}else this._transformInfo.currSpectrum=void 0,this._transformInfo.initSpectrumViewportRanges=void 0},_endInteractTransform:function($origin){this._transformInfo.currSpectrum=void 0,this._transformInfo.initSpectrumViewportRanges=void 0,$origin()},moveByXYDistance:function($origin,e,t){var r=this.getViewer();if(!r.enableSpectrumInteraction())return $origin(e,t);var i=this._transformInfo;if(i&&i.isTransforming&&!i.calculating){var n=i.currSpectrum&&r.getSpectrumView(i.currSpectrum);if(!n)return $origin(e,t);i.calculating=!0;try{var o={x:e,y:t};if(Kekule.CoordUtils.isEqual(o,i.lastCoord));else{var a=Kekule.CoordUtils.substract(o,i.transformInitCoord),s=n.getClientScreenBox(),l=[a.x/(s.x2-s.x1),-a.y/(s.y2-s.y1)],u=n.getIsSpectrumWithReversedAxises()?[Kekule.VarDependency.DEPENDENT,Kekule.VarDependency.INDEPENDENT]:[Kekule.VarDependency.INDEPENDENT,Kekule.VarDependency.DEPENDENT];r.beginUpdate();try{for(var d=0,c=l.length;d<c;++d){var h=l[d],p=i.initSpectrumViewportRanges[u[d]]||{},g=p.rangeFrom||0,f=p.rangeTo||1,C=(f-g)*h;n.setViewportRange(u[d],g-C,f-C)}}finally{r.endUpdate()}i.lastCoord=o,i.spectrumActuallyTransformed=!0}}finally{i.calculating=!1}}},doZoomSpectrumViewer:function($origin,e,t,r,i){var n=this.getViewer();if(n.enableSpectrumInteraction()){var o=n.getSpectrumView(e);o&&o.zoomViewportByDelta(t,r,i)}},_mayNeedSpectrumDataHotTrack:function($origin,e,t){var r=e.getDisplayedDataModes();return t&&t.getDataModeSpecifiedBoolConfigValueOfModeList("enableSpectrumDataHotTrackOnMode",r)},_getSpectrumDataSelectCoordInflationRange:function($origin,e,t){var r=t.getSpectrumDataPointSelectInflation(),i={x:r,y:r};return[Kekule.CoordUtils.substract(e,i),Kekule.CoordUtils.add(e,i)]},doTrySelectSpectrumData:function($origin,e,t,r,i,n){var o=i;if(o){var a=null,s=n,l=o.getClientScreenBox();if(Kekule.CoordUtils.isInsideBox(e,l)){var u=this._getSpectrumDataSelectCoordInflationRange(e,s),d=o.calcSpectrumPrimaryDataValueInCoordRangeEx(u,Kekule.Render.CoordSystem.SCREEN);if(d)a={section:d.dataSection,dataValue:d.dataValue}}t&&s.getDataModeSpecifiedBoolConfigValueOfModeList("enableSpectrumDataMultiSelectOnMode",o.getDisplayedDataModes())?o.toggleSelectingState(a):o.select(a),r.requestRepaint()}},doTryHotTrackSpectrumData:function($origin,e,t,r,i){var n=r,o=i,a=null,s=n.getClientScreenBox();if(Kekule.CoordUtils.isInsideBox(e,s)){var l=this._getSpectrumDataSelectCoordInflationRange(e,o),u=n.calcSpectrumPrimaryDataValueInCoordRangeEx(l,Kekule.Render.CoordSystem.SCREEN);if(u)a={section:u.dataSection,dataValue:u.dataValue}}n.setHotTrackedDataItemsEx(a&&[a])},doTryHotTrackBasicObject:function($origin,e,t){var r=this.getViewer(),i=r.getDisplayerConfigs().getSpectrumViewConfigs(),n=this.getActiveSpectrumViewAtScreenCoord(e);return n&&r.getRenderType()===Kekule.Render.RendererType.R2D&&this._mayNeedSpectrumDataHotTrack(n,i)?this.doTryHotTrackSpectrumData(e,r,n,i):$origin(e,t)},doTrySelectBasicObject:function($origin,e,t,r){var i=this.getViewer(),n=i.getDisplayerConfigs().getSpectrumViewConfigs(),o=this.getActiveSpectrumViewAtScreenCoord(e);return o&&i.getRenderType()===Kekule.Render.RendererType.R2D&&n.getDataModeSpecifiedBoolConfigValueOfModeList("enableSpectrumDataSelectOnMode",o.getDisplayedDataModes())?this.doTrySelectSpectrumData(e,t,i,o,n):$origin(e,t,r)},react_dblclick:function($origin,e){if(this.needReactEvent(e)){var t=this.getActiveSpectrumViewAtScreenCoord(this._getEventMouseCoord(e));if(t){var r=this.getViewer();r.beginUpdate();try{t&&t.resetView()}finally{r.endUpdate()}}else $origin(e)}},react_pointerleave:function($origin,e){return this.hideSpectrumUiMarkers(!0),$origin(e)},react_mousewheel:function($origin,e){if(this.needReactEvent(e)){var t=this.getActiveSpectrumViewAtScreenCoord(this._getEventMouseCoord(e));if(t){var r=this.getViewer(),i=t.getSpectrum();this.hideSpectrumUiMarkers(!0);var n=r.getDisplayerConfigs().getSpectrumViewConfigs(),o=e.wheelDeltaY||e.wheelDelta;o&&(o/=120);var a=this._getEventMouseCoord(e),s=Kekule.ChemWidget.SpectrumViewUtils.getZoomDirectionsFromEvent(e,n);return this.doZoomSpectrumViewer(i,o,a,s),e.preventDefault(),!0}}return $origin(e)}}),ClassEx.extendMethods(Kekule.ChemWidget.ActionDisplayerZoomIn,{doExecute:function($origin,e,t){var r=this.getDisplayer();if(r.isInSpectrumMode&&r.isInSpectrumMode()){var i=Kekule.ChemWidget.SpectrumViewUtils.getZoomDirectionsFromEvent(t,r.getDisplayerConfigs().getSpectrumViewConfigs()),n=r.getSpectrumView();n?n.zoomViewportByDelta(1,null,i):$origin()}else $origin()}}),ClassEx.extendMethods(Kekule.ChemWidget.ActionDisplayerZoomOut,{doExecute:function($origin,e,t){var r=this.getDisplayer();if(r.isInSpectrumMode&&r.isInSpectrumMode()){var i=Kekule.ChemWidget.SpectrumViewUtils.getZoomDirectionsFromEvent(t,r.getDisplayerConfigs().getSpectrumViewConfigs()),n=r.getSpectrumView();n?n.zoomViewportByDelta(-1,null,i):$origin()}else $origin()}}),Kekule.ChemWidget.SpectrumCorrelationConnector=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.SpectrumCorrelationConnector",initialize:function(e,t){this.reactLoadEventOnSpectrumViewerBind=this.reactLoadEventOnSpectrumViewer.bind(this),this.reactEventOnSpectrumViewerBind=this.reactEventOnSpectrumViewer.bind(this),this.reactEventOnMoleculeViewerBind=this.reactEventOnMoleculeViewer.bind(this),this.tryApplySuper("initialize"),e&&this.setSpectrumViewer(e),t&&this.setMoleculeViewer(t)},initProperties:function(){this.defineProp("spectrumViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:function(e){var t=this.getSpectrumViewer();t!==e&&(this.doSpectrumViewerChange(e,t),this.setPropStoreFieldValue("spectrumViewer",e))}}),this.defineProp("moleculeViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:function(e){var t=this.getMoleculeViewer();t!==e&&(this.doMoleculeViewerChange(e,t),this.setPropStoreFieldValue("moleculeViewer",e))}}),this.defineProp("autoLoadCorrelatedMolecule",{dataType:DataType.BOOL}),this.defineProp("fromSpectrumToMolecule",{dataType:DataType.BOOL}),this.defineProp("fromMoleculeToSpectrum",{dataType:DataType.BOOL}),this.defineProp("enabled",{dataType:DataType.BOOL})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoLoadCorrelatedMolecule(!0),this.setFromSpectrumToMolecule(!0),this.setFromMoleculeToSpectrum(!0),this.setEnabled(!0)},doFinalize:function(){this.setMoleculeViewer(null),this.setSpectrumViewer(null),this.tryApplySuper("doFinalize")},_getLoadedSpectrums:function(e){if(!e){var t=this.getSpectrumViewer();e=t&&t.getChemObj()}return e?e instanceof Kekule.Spectroscopy.Spectrum?[e]:e.filterChildren(function(e){return e&&e instanceof Kekule.Spectroscopy.Spectrum},!0):[]},_getRefMoleculesOfSpectrum:function(e){return e.getRefMolecules()||[]},_getDisplayedSpectrumDataSections:function(){for(var e=[],t=this._getLoadedSpectrums(),r=0,i=t.length;r<i;++r)if(t[r].getVisible()){var n=t[r].getDisplayedDataSections();e=e.concat(n)}return e},_getSpectrumDataItemAssignments:function(e,t){var r,i;return(i="number"==typeof t?e.getExtraInfoAt(t):e.getExtraInfoOf(t))&&(i.getAssignments||i.assignments)&&(r=i.getAssignments()||i.assignments),r},_getDataItemsExOfCorrelatedMolObject:function(e,t){for(var r=[],i=[],n=0,o=t.length;n<o;++n){var a=t[n],s=a.getParentSpectrum(),l=r.indexOf(s);l<0&&(l=r.length,r.push(s),i[l]={spectrum:s,dataItemsEx:[]});var u=i[l].dataItemsEx;if(a.isPeakSection())for(n=0,o=a.getDataCount();n<o;++n){var d=this._getSpectrumDataItemAssignments(a,n);if(d&&d.length)d.indexOf(e)>=0&&u.push({section:a,dataValue:a.getValueAt(n)})}}return i},doSpectrumViewerChange:function(e,t){t&&(t.removeEventListener("load",this.reactLoadEventOnSpectrumViewerBind),t.removeEventListener("hotTrackOnSpectrumData",this.reactEventOnSpectrumViewerBind),t.removeEventListener("spectrumDataSelectionChange",this.reactEventOnSpectrumViewerBind)),e&&(e.addEventListener("load",this.reactLoadEventOnSpectrumViewerBind),e.addEventListener("hotTrackOnSpectrumData",this.reactEventOnSpectrumViewerBind),e.addEventListener("spectrumDataSelectionChange",this.reactEventOnSpectrumViewerBind),this.doTryLoadSpectrumRefMoleculeInViewer(e.getChemObj()))},doMoleculeViewerChange:function(e,t){t&&(t.removeEventListener("hotTrackOnObjects",this.reactEventOnMoleculeViewerBind),t.removeEventListener("selectionChange",this.reactEventOnMoleculeViewerBind)),e&&(e.addEventListener("hotTrackOnObjects",this.reactEventOnMoleculeViewerBind),e.addEventListener("selectionChange",this.reactEventOnMoleculeViewerBind))},doSelectOrHotTrackSpectrumAssignments:function(t,r,i){for(var n,o=[],a=0,s=t.length;a<s;++a){var l=t[a];if(l instanceof Kekule.ChemStructureObject){var u=l.getRootFragment();if(u){if(n){if(n!==u)continue}else n=u;e.pushUnique(o,l)}}}var d=this.getMoleculeViewer();n&&d.getChemObj()!==n&&i&&this.doLoadMoleculeInViewer(n),r?d.setSelectedObjects(o):d.setHotTrackedObjects(o)},doSelectOrHotTrackSpectrumPeaks:function(t,r){var i=this._getDisplayedSpectrumDataSections(),n=new Kekule.MapEx;try{for(var o=[],a=[],s=0,l=t.length;s<l;++s){var u=this._getDataItemsExOfCorrelatedMolObject(t[s],i);if(u&&u.length)for(var d=0,c=u.length;d<c;++d){var h=u[d].spectrum;(f=n.get(h))||(o.push(h),f=[],n.set(h,f)),e.pushUnique(f,u[d].dataItemsEx),a.push({assignments:[t[s]],spectrum:h,dataSection:f.section,dataValue:f.dataValue})}}var p=!1,g=this.getSpectrumViewer();for(s=0,l=o.length;s<l;++s){var f=n.get(o[s]),C=g.getSubView(o[s],Kekule.ChemWidget.Viewer.SpectrumSubView,!0);if(C){r?C.setSelectedDataItemsEx(f):C.setHotTrackedDataItemsEx(f),p=!0;break}}p||(r?g.clearSelectedItems(null,!0):g.clearHotTrackedItems(null,!0)),this._invokeHotTrackOrSelectAssignmentPairEvent(a,r)}finally{n.finalize()}},_invokeHotTrackOrSelectAssignmentPairEvent:function(e,t){t?this.invokeEvent("assignmentSelected",{assignmentDetails:e}):this.invokeEvent("assignmentHotTracked",{assignmentDetails:e})},doLoadMoleculeInViewer:function(e){e&&e.setVisible(!0),this.getMoleculeViewer().setChemObj(e)},doTryLoadSpectrumRefMoleculeInViewer:function(e){if(this.getSpectrumViewer()&&this.getMoleculeViewer()&&this.getAutoLoadCorrelatedMolecule()){for(var t=this._getLoadedSpectrums(e)||[],r=null,i=0,n=t.length;i<n;++i){var o=this._getRefMoleculesOfSpectrum(t[i]);if(o.length){r=o[0];break}}this.doLoadMoleculeInViewer(r)}},reactLoadEventOnSpectrumViewer:function(e){this.getEnabled()&&this.doTryLoadSpectrumRefMoleculeInViewer(e.obj)},reactEventOnSpectrumViewer:function(t){if(this.getEnabled()&&this.getFromSpectrumToMolecule()&&!this._isReactingSpectrumViewerEvent){this._isReactingSpectrumViewerEvent=!0;try{for(var r=t.name,i=t.dataItems||[],n=[],o=[],a=0,s=i.length;a<s;++a){var l=i[a].section;if(l.isPeakSection()){var u=i[a].dataValue,d=this._getSpectrumDataItemAssignments(l,u);d&&(e.pushUnique(n,d),o.push({spectrum:l.getParentSpectrum(),dataSection:l,dataValue:u,assignments:d}))}}var c="spectrumDataSelectionChange"===r;this.doSelectOrHotTrackSpectrumAssignments(n,c,this.getAutoLoadCorrelatedMolecule()),this._invokeHotTrackOrSelectAssignmentPairEvent(o,c)}finally{this._isReactingSpectrumViewerEvent=!1}}},reactEventOnMoleculeViewer:function(e){if(this.getEnabled()&&this.getFromMoleculeToSpectrum()&&!this._isReactingMoleculeViewerEvent){this._isReactingMoleculeViewerEvent=!0;try{var t=e.name,r=e.objects||[];this.doSelectOrHotTrackSpectrumPeaks(r,"selectionChange"===t)}finally{this._isReactingMoleculeViewerEvent=!1}}}}),Kekule.ChemWidget.SpectrumViewUtils={getZoomDirectionsFromEvent:function(e,t){var r=Kekule.Widget.KeyboardUtils,i=r.getKeyParamsFromEvent(e,!0);return r.matchKeyParams(i,r.createModifierKeyParamsFromArray(t.getSpectrumZoomSecondaryModifierKeys()),!0)?["y"]:r.matchKeyParams(i,r.createModifierKeyParamsFromArray(t.getSpectrumZoomBothModifierKeys()),!0)?["x","y"]:["x"]}}}})}(),function(){"use strict";Kekule._registerAfterLoadSysProc(function(){if(Kekule.ChemWidget&&Kekule.Spectroscopy){Kekule.ObjUtils;var e=Kekule.ArrayUtils,t=Class.PropertyScope;Kekule.ChemWidget.ComponentWidgetNames=Object.extend(Kekule.ChemWidget.ComponentWidgetNames,{changeSpectrumSection:"changeSpectrumSection",correlateSpectrumDataAndObject:"correlateSpectrumDataAndObject"});var r=Kekule.ChemWidget.ComponentWidgetNames;Kekule.globalOptions.add("chemWidget.spectrumInspector",{toolButtons:[r.loadData,r.saveData,r.changeSpectrumSection,r.zoomIn,r.zoomOut,r.reset,r.copy,r.config],assocViewerToolButtons:[r.saveData,r.copy],assocViewerSize:"25%",enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,enableGestureInteraction:!1}),Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{SPECTRUM_INSPECTOR:"K-SpectrumInspector",SPECTRUM_INSPECTOR_ASSOC_LEADING:"K-SpectrumInspector-AssocLeading",SPECTRUM_INSPECTOR_ASSOC_TAILING:"K-SpectrumInspector-AssocTailing",SPECTRUM_INSPECTOR_IN_EDITING:"K-SpectrumInspector-Editing",SPECTRUM_INSPECTOR_CLIENT:"K-SpectrumInspector-Client",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER:"K-SpectrumInspector-ClientComponentHolder",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_SPECTRUM_VIEWER:"K-SpectrumInspector-ClientComponentHolder-SpectrumViewer",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_ASSOC_VIEWER:"K-SpectrumInspector-ClientComponentHolder-AssocViewer",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_MODIFIER_PANEL:"K-SpectrumInspector-ClientComponentHolder-ModifierPanel",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_HIDDEN_CANVAS:"K-SpectrumInspector-ClientComponentHolder-HiddenCanvas",SPECTRUM_INSPECTOR_SPECTRUM_VIEWER:"K-SpectrumInspector-SpectrumViewer",SPECTRUM_INSPECTOR_ASSOC_VIEWER:"K-SpectrumInspector-AssocViewer",SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM:"K-SpectrumInspector-MenuItem-Spectrum",SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM_DATASECTION:"K-SpectrumInspector-MenuItem-SpectrumDataSection",ACTION_SPECTRUM_INSPECTOR_CHANGE_SECTION:"K-SpectrumInspector-Change-Section",ACTION_SPECTRUM_INSPECTOR_CORRELATOR:"K-SpectrumInspector-Correlator"});var i=Kekule.Widget.HtmlClassNames,n=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.SpectrumInspector=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.SpectrumInspector",SPECTRUM_SELECT_MENU_SPECTRUM_FIELD:"__$spectrumIndex$__",SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD:"__$spectrumDataSectionIndex$__",initialize:function(e){this._spectrumViewerSetChemObjOverwriteBind=this._spectrumViewerSetChemObjOverwrite.bind(this),this._spectrumViewerCreateToolButtonOverwriteBind=this._spectrumViewerCreateToolButtonOverwrite.bind(this),this._spectrumViewerGetSavingTargetObjOverwriteBind=this._spectrumViewerGetSavingTargetObjOverwrite.bind(this),this._reactChildViewerShowStateChangeBind=this._reactChildViewerShowStateChange.bind(this),this.setPropStoreFieldValue("autoSyncUiMarkerStyles",!0),this.setPropStoreFieldValue("assocViewerVisualMode",o.AUTO),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("spectrumViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null}),this.defineProp("assocViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null}),this.defineProp("correlationConnector",{dataType:"Kekule.ChemWidget.SpectrumCorrelationConnector",serializable:!1,setter:null}),this.defineProp("autoSyncUiMarkerStyles",{dataType:DataType.BOOL,setter:function(e){e!=this.getAutoSyncUiMarkerStyles()&&(this.setPropStoreFieldValue("autoSyncUiMarkerStyles",!!e),e&&this.syncHotTrackAndSelectStylesBetweenViewers())}}),this.defineProp("assocViewerVisualMode",{dataType:DataType.INT,enumSource:Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode,setter:function(e){var t=this.getAssocViewerVisualMode();e!==t&&(this.setPropStoreFieldValue("assocViewerVisualMode",e),this.doAssocViewerVisualModeChange(e,t))}}),this.defineProp("autoShowHideAssocViewer",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getAssocViewerVisualMode()===o.AUTO},setter:function(e){var t=!!e;if(t!==this.getAutoShowHideAssocViewer())if(t)this.setAssocViewerVisualMode(o.AUTO);else{var r=this.getAssocViewer(),i=r&&r.isShown();this.setAssocViewerVisualMode(i?o.VISIBLE:o.INVISIBLE)}}}),this.defineProp("assocViewerPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(e){this.setPropStoreFieldValue("assocViewerPosition",e),this.doChangeAssocViewerPosition(e)}}),this.defineProp("assocViewerSize",{dataType:DataType.STRING,getter:function(){var e=this.getClientComponentHolderElems(),t=e&&e.assocViewer;return t&&this.getStyleProperty("flexBasis",t)},setter:function(e){var t=this.getClientComponentHolderElems(),r=t&&t.assocViewer;r&&this.setStyleProperty("flexBasis",e,r)}}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",e),this.chemObjChanged(e,t)}}),this.defineProp("spectrums",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){return this.getPropStoreFieldValue("spectrums")||[]}}),this.defineProp("activeSpectrum",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getSpectrums()[this.getActiveSpectrumIndex()]},setter:function(e){var t=this.getSpectrums().indexOf(e);this.setActiveSpectrumIndex(t)}}),this.defineProp("activeSpectrumIndex",{dataType:DataType.INT,serializable:!1,setter:function(e){var t=this.getActiveSpectrum();this.setPropStoreFieldValue("activeSpectrumIndex",e);var r=this.getActiveSpectrum();this.activeSpectrumChanged(r,t)}}),this.defineProp("activeDataSection",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getActiveSpectrum();return e&&e.getActiveDataSection()},setter:function(e){var t=this.getActiveSpectrum();if(t){var r=t.indexOfDataSection(e);r>=0&&this.setActiveDataSectionIndex(r)}}}),this.defineProp("activeDataSectionIndex",{dataType:DataType.INT,serializable:!1,setter:function(e){var t=this.getActiveSpectrum();if(t){var r=this.getActiveDataSection();t.setActiveDataSectionIndex(e);var i=t.getActiveDataSection();r!=i&&this.activeSpectrumDataSectionChanged(i,r)}}}),this.defineProp("spectrumViewportRanges",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getSpectrumSubView();return e&&e.getViewportRanges()},setter:function(e){var t=this.getSpectrumSubView();t&&(t.setViewportRanges(e),t.applyToRenderOptions())}}),this.defineProp("backgroundColor",{dataType:DataType.STRING,scope:t.PUBLISHED,setter:function(e){this.setPropStoreFieldValue("backgroundColor",e);var t=this.getSpectrumViewer();t&&t.setBackgroundColor(e);var r=this.getAssocViewer();r&&r.setBackgroundColor(e)}}),this.defineProp("clientElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("clientComponentHolderElems",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("spectrumDataSectionSelectMenu",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("enableHotTrack",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyEnablePropertyToChildViewerConfigs("enableHotTrack",t),this.setPropStoreFieldValue("enableHotTrack",t)}}),this.defineProp("enableSelect",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyEnablePropertyToChildViewerConfigs("enableSelect",t),this.setPropStoreFieldValue("enableSelect",t)}}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyEnablePropertyToChildViewerConfigs("enableMultiSelect",t),this.setPropStoreFieldValue("enableMultiSelect",t)}}),this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyPropertyToChildViewerProperty("enableDirectInteraction",t),this.setPropStoreFieldValue("enableDirectInteraction",t)}}),this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyPropertyToChildViewerProperty("enableTouchInteraction",t),this.setPropStoreFieldValue("enableTouchInteraction",t)}}),this.defineProp("enableGestureInteraction",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this._applyPropertyToChildViewerProperty("enableGesture",t),this.setPropStoreFieldValue("enableGesture",t)}}),this.defineProp("enableEdit",{dataType:DataType.BOOL,scope:t.PRIVATE}),this.defineProp("isEditing",{dataType:DataType.BOOL,serializable:!1,setter:null,scope:t.PRIVATE}),this._defineSubWidgetDelegatedProperties(["autoLoadCorrelatedMolecule",["enableOperationFromSpectrumToMolecule","fromSpectrumToMolecule"],["enableOperationFromMoleculeToSpectrum","fromMoleculeToSpectrum"]],"correlationConnector"),this._defineSubWidgetDelegatedProperties(["viewerConfigs","enableHotKey","toolButtons","toolbar","enableToolbar","toolbarPos","toolbarMarginVertical","toolbarMarginHorizontal","toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","toolbarParentElem","menuItems","menu","caption","showCaption","captionPos","autoCaption","captionElem","renderConfigs","enableLoadNewFile","allowedInputFormatIds","allowedOutputFormatIds","resetAfterLoad","zoom","initialZoom","padding","chemObjData","chemObjLoaded",["spectrumViewerConfigs","viewerConfigs"],["spectrumViewerRenderConfigs","renderConfigs"],["spectrumViewerDrawOptions","drawOptions"],["spectrumViewerbackgroundColor","backgroundColor"]],"spectrumViewer"),this._defineSubWidgetDelegatedProperties([["assocViewerConfigs","viewerConfigs"],["assocViewerbackgroundColor","backgroundColor"],["assocViewerAllowedMolDisplayTypes","allowedMolDisplayTypes"],["assocViewerRenderConfigs","renderConfigs"],["assocViewerDrawOptions","drawOptions"],["assocViewerAllowCoordBorrow","allowCoordBorrow"],["assocViewerAutoSize","autoSize"],["assocViewerAutofit","autofit"],["assocViewerAutoShrink","autoShrink"]],"assocViewer")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableHotTrack(!0).setEnableSelect(!0).setEnableMultiSelect(!1).setUseCornerDecoration(!0);var e=Kekule.oneOf,t=Kekule.globalOptions.get("chemWidget.spectrumInspector")||{};this.setEnableToolbar(e(t.enableToolbar,!0)).setEnableDirectInteraction(e(t.enableDirectInteraction,!0)).setEnableTouchInteraction(e(t.enableTouchInteraction,!0)).setEnableGestureInteraction(e(t.enableGestureInteraction,!0))},doFinalize:function(){this._finalizeSubWidgets(),this.tryApplySuper("doFinalize")},_finalizeSubWidgets:function(){var e=this.getCorrelationConnector();e&&e.finalize();var t=this.getSpectrumDataSectionSelectMenu();t&&t.finalize();var r=this.getAssocViewer();r&&r.finalize();var i=this.getSpectrumViewer();i&&i.finalize()},_defineSubWidgetDelegatedMethods:function(t,r){r||(r="spectrumViewer");for(var i,n,o=ClassEx.getPrototype(this.getClass()),a=0,s=t.length;a<s;++a){var l=t[a];e.isArray(l)?(i=l[0],n=l[1]):i=l,n||(n=i),o[i]=function(){var e=this.getPropValue(r),t=e[n].apply(e,arguments);return t===e&&(t=this),t}}},_defineSubWidgetDelegatedProperties:function(t,r){r||(r="spectrumViewer");for(var i,n,o=this.getPropInfo(r),a=ClassEx.findClass(o.dataType),s=this,l=0,u=t.length;l<u;++l){var d=t[l];n=null,e.isArray(d)?(i=d[0],n=d[1]):i=d,n||(n=i),function(e,t,i){var n=ClassEx.getPropInfo(e,i),o=Object.create(n);o.getter=null,o.setter=null,o.serializable=!1,n.getter&&(o.getter=function(){var e=this.getPropValue(r);return e?e.getPropValue(i):void 0}),n.setter&&(o.setter=function(e){var t=this.getPropValue(r);t&&t.setPropValue(i,e)}),s.defineProp(t,o)}(a,i,n)}},doObjectChange:function(t){var r=this.tryApplySuper("doObjectChange",[t]),i=this.getAssocViewer();if(i)for(var n=e.intersect(t,["toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","enableToolbar","enableHotKey"]),o=0,a=n.length;o<a;++o)i.setPropValue(n[o],this.getPropValue(n[o]));return r},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r){var i=Kekule.IO.loadTypedData(t.data,t.resType,t.resUri);this.setChemObj(i)}else Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.SPECTRUM_INSPECTOR},canUsePlaceHolderOnElem:function(e){var t=e.getAttribute("src");return"img"===e.tagName.toLowerCase()&&!!t},doSetElement:function(e){var t=e;t&&("img"===t.tagName.toLowerCase()&&(t=Kekule.DomUtils.replaceTagName(t,"span")));return this.tryApplySuper("doSetElement",[t])},getChildrenHolderElement:function(){return this.getClientElem()},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);this._finalizeSubWidgets();var i=this._createClientElem(e,t);this.setPropStoreFieldValue("clientElem",i),r.push(i);var o={spectrumViewer:this._createClientComponentHolderElem(e,i,n.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_SPECTRUM_VIEWER),modifierPanel:this._createClientComponentHolderElem(e,i,n.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_MODIFIER_PANEL),assocViewer:this._createClientComponentHolderElem(e,i,n.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_ASSOC_VIEWER),hiddenCanvas:this._createClientComponentHolderElem(e,i,n.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_HIDDEN_CANVAS)};this.setPropStoreFieldValue("clientComponentHolderElems",o),this.setPropStoreFieldValue("spectrumDataSectionSelectMenu",this._createSpectrumDataSectionSelectMenu());var a=this._createSubSpectrumViewer(o.spectrumViewer);this.setPropStoreFieldValue("spectrumViewer",a),a.setToolButtons(this.getDefaultToolBarButtons()).setEnableToolbar(!0);var s=this._createSubAssocViewer(o.assocViewer);this.setPropStoreFieldValue("assocViewer",s);var l=Kekule.globalOptions.get("chemWidget.spectrumInspector")||{};return Kekule.ObjUtils.notUnset(l.assocViewerSize)&&this.setAssocViewerSize(l.assocViewerSize),this._applyAllEnablePropertiesToChildViewerConfigs(),this._createCorrelationConnector(a,s),r},_createClientElem:function(e,t){var r=e.createElement("div");return r.className=n.SPECTRUM_INSPECTOR_CLIENT,t.appendChild(r),r},_createClientComponentHolderElem:function(e,t,r){var i=e.createElement("div"),o=n.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER;return r&&(o+=" "+r),i.className=o,t.appendChild(i),i},_createCorrelationConnector:function(e,t){var r=this,i=new Kekule.ChemWidget.SpectrumCorrelationConnector(e,t);i.addEventListener("assignmentSelected",function(e){r.getSpectrumViewer().updateActions(),r.invokeEvent("spectrumAssignmentSelected",{assignmentDetails:e.assignmentDetails})}),i.addEventListener("assignmentHotTracked",function(e){r.invokeEvent("spectrumAssignmentHotTracked",{assignmentDetails:e.assignmentDetails})}),this.setPropStoreFieldValue("correlationConnector",i)},_createSubSpectrumViewer:function(e){var t=new Kekule.ChemWidget.Viewer2D(this,null,Kekule.Render.RendererType.R2D);this._overwriteSubSpectrumViewerMethods(t),t.setViewerConfigs(new Kekule.ChemWidget.ViewerConfigs),t.setPadding(20),t.setUseCornerDecoration(!1).setBackgroundColor(this.getBackgroundColor()),t.addClassName(n.SPECTRUM_INSPECTOR_SPECTRUM_VIEWER);var r=this;return t.addEventListener("showStateChange",this._reactChildViewerShowStateChangeBind),t.addEventListener("load",function(e){e.widget===r.getSpectrumViewer()&&r.invokeEvent("loadSpectrum",{spectrum:e.obj})}),t.appendToElem(e),t},_overwriteSubSpectrumViewerMethods:function(e){e.overwriteMethod("doSetChemObj",this._spectrumViewerSetChemObjOverwriteBind),e.overwriteMethod("createToolButton",this._spectrumViewerCreateToolButtonOverwriteBind),e.overwriteMethod("getSavingTargetObj",this._spectrumViewerGetSavingTargetObjOverwriteBind),e.overwriteMethod("getDefaultToolBarButtons",this.getDefaultToolBarButtons.bind(this))},_createSubAssocViewer:function(e){var t=new Kekule.ChemWidget.Viewer(this);t.setViewerConfigs(new Kekule.ChemWidget.ViewerConfigs);var r=t.getViewerConfigs().getInteractionConfigs();r.setEnableBasicObjectHotTrack(!0),r.setEnableBasicObjectSelect(!0),r.setEnableBasicObjectMultiSelect(!0),t.addClassName(n.SPECTRUM_INSPECTOR_ASSOC_VIEWER),t.setAutoShrink(!0),t.setToolButtons(Kekule.globalOptions.chemWidget.spectrumInspector.assocViewerToolButtons).setEnableToolbar(!0),t.setUseCornerDecoration(!1).setBackgroundColor(this.getBackgroundColor()),t.setDisplayed(!1),t.addEventListener("load",this._reactAssocViewerLoad.bind(this));var i=this;return t.addEventListener("showStateChange",this._reactChildViewerShowStateChangeBind),t.addEventListener("load",function(e){e.widget===i.getAssocViewer()&&i.invokeEvent("loadAssoc",{obj:e.obj})}),t.appendToElem(e),t},_reactAssocViewerLoad:function(e){var t=this.getAssocViewer();e.widget===t&&this.getAutoShowHideAssocViewer()&&this.doAutoShowHideAssocViewer()},doChangeAssocViewerPosition:function(e){var t=Kekule.Widget.Position;e&t.BOTTOM||e&t.RIGHT?(this.removeClassName(n.SPECTRUM_INSPECTOR_ASSOC_LEADING),this.addClassName(n.SPECTRUM_INSPECTOR_ASSOC_TAILING)):(this.removeClassName(n.SPECTRUM_INSPECTOR_ASSOC_TAILING),this.addClassName(n.SPECTRUM_INSPECTOR_ASSOC_LEADING))},getAssocViewerActualPosition:function(){var e=Kekule.Widget.Layout,t=Kekule.Widget.Position,r=this.getLayout(),i=this.getAssocViewerPosition();return r===e.VERTICAL?i&t.BOTTOM||i&t.RIGHT?t.BOTTOM:t.TOP:i&t.BOTTOM||i&t.RIGHT?t.RIGHT:t.LEFT},doAssocViewerVisualModeChange:function(e,t){var r=this.getAssocViewer();if(r){var i=Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode;if(e===i.AUTO)this.doAutoShowHideAssocViewer();else if(e===i.VISIBLE||e===i.INVISIBLE){var n=e===i.VISIBLE;r.setDisplayed(n),n&&r.setVisible(n)}}},doAutoShowHideAssocViewer:function(){var e=this.getAssocViewer();if(e){var t=!!e.getChemObj();e.setDisplayed(t),t&&e.setVisible(t),Kekule.StyleUtils.setDisplay(this.getClientComponentHolderElems().assocViewer,t)}},_reactChildViewerShowStateChange:function(e){var t,r=e.isShown;e.widget===this.getAssocViewer()?t=this.getClientComponentHolderElems().assocViewer:e.widget===this.getSpectrumViewer()&&(t=this.getClientComponentHolderElems().spectrumViewer),t&&Kekule.StyleUtils.setDisplay(t,!!r)},_createSpectrumDataSectionSelectMenu:function(){var e=new Kekule.Widget.PopupMenu(this);return e.addClassName(i.DYN_CREATED),e.setDisplayed(!1),e.addEventListener("execute",this._reactSpectrumDataSectionSelectMenuItemExecute.bind(this)),e},_reactSpectrumDataSectionSelectMenuItemExecute:function(e){var t=e.widget,r=t[this.SPECTRUM_SELECT_MENU_SPECTRUM_FIELD],i=t[this.SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD],n=this.getSpectrumViewer();n.beginUpdate();try{r!==this.getActiveSpectrum()?(r.setActiveDataSection(i||r.getDataSectionAt(0)),this.setActiveSpectrum(r)):i&&i!==this.getActiveDataSection()&&this.setActiveDataSection(i)}finally{n.endUpdate()}},_refillSpectrumDataSectionSelectMenu:function(){var e=this.getSpectrums(),t=this.getSpectrumDataSectionSelectMenu();t.clearMenuItems();for(var r=0,i=e.length;r<i;++r){var o=e[r],a=o.getDataSectionCount(),s=this._getSpectrumTexts(o,r,i,!0);if(!(a<=0))if(a<=1){(d=this._getSpectrumDataSectionTexts(o,o.getDataSectionAt(0),0,a,!1)).caption&&(s.caption=s.caption+" - "+d.caption),d.hint&&(s.hint=s.hint+" - "+d.hint);var l=this._createSpectrumDataSectionSelectMenuSubItem(t,o,o.getDataSectionAt(0),s.caption,s.hint,n.SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM);t.appendMenuItem(l)}else{l=this._createSpectrumDataSectionSelectMenuSubItem(t,o,null,s.caption,s.hint,n.SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM);t.appendMenuItem(l);for(var u=0;u<a;++u){var d=this._getSpectrumDataSectionTexts(o,o.getDataSectionAt(u),u,a,!0);l=this._createSpectrumDataSectionSelectMenuSubItem(t,o,o.getDataSectionAt(u),d.caption,d.hint,n.SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM_DATASECTION),t.appendMenuItem(l)}}}return this._updateSpectrumDataSectionSelectMenuCheckState(),t},_updateSpectrumDataSectionSelectMenuCheckState:function(){for(var e=this.getActiveSpectrum(),t=e&&e.getActiveDataSection(),r=this.getSpectrumDataSectionSelectMenu().getMenuItems(),i=0,n=r.length;i<n;++i){var o=r[i],a=o[this.SPECTRUM_SELECT_MENU_SPECTRUM_FIELD],s=o[this.SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD];a===e&&s===t?o.setChecked(!0):o.setChecked(!1)}},_createSpectrumDataSectionSelectMenuSubItem:function(e,t,r,i,n,o){var a=new Kekule.Widget.MenuItem(e,i);return a.addClassName(o),a[this.SPECTRUM_SELECT_MENU_SPECTRUM_FIELD]=t,a[this.SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD]=r,a},_getSpectrumTexts:function(e,t,r,i){var n=e.getTitle()||e.getName();return!n&&i&&(n=this._getDefaultSpectrumCaption(e,t,r)),{caption:n,hint:n}},_getDefaultSpectrumCaption:function(e,t,r){return Kekule.$L("ChemWidgetTexts.CAPTION_SPECTRUM_WITH_INDEX").format(t+1)},_getSpectrumDataSectionTexts:function(e,t,r,i,n){var o=t.getTitle()||t.getName();return!o&&n&&(o=this._getDefaultSpectrumDataSectionCaption(e,t,r,i)),{caption:o,hint:o}},_getDefaultSpectrumDataSectionCaption:function(e,t,r,i){return Kekule.$L("ChemWidgetTexts.CAPTION_SPECTRUM_DATASECTION_WITH_INDEX").format(r+1)},_spectrumViewerSetChemObjOverwrite:function($origin,e){this._isLoadingFromSubSpectrumViewer?$origin(e):this.load(e)},_spectrumViewerCreateToolButtonOverwrite:function($origin,e,t){if(this._isCompActionDelegatableToSpectrumViewer(e)){this.getChildActionClass(e);var i=new(e===r.changeSpectrumSection?Kekule.Widget.DropDownButton:Kekule.Widget.Button)(t),n=this._getActionOfComp(e,!0);return n&&i.setAction(n),e===r.changeSpectrumSection&&i.setDropDownWidget(this.getSpectrumDataSectionSelectMenu()),i}return $origin(e,t)},_spectrumViewerGetSavingTargetObjOverwrite:function($origin){return this.getChemObj()},_isCompActionDelegatableToSpectrumViewer:function(e){return[r.changeSpectrumSection,r.correlateSpectrumDataAndObject,r.reset,r.config].indexOf(e)>=0},_getActionOfComp:function(e,t,r){if(this._isCompActionDelegatableToSpectrumViewer(e)){var i=this.getSpectrumViewer(),n=i.getActionMap(),o=n.get(e);if(!o&&t){var a=this.getChildActionClass(e)||r;a&&(o=new a(this),n.set(e,o),i.getActions().add(o))}return o}return null},getDefaultToolBarButtons:function(){return Kekule.globalOptions.chemWidget.spectrumInspector.toolButtons},getSpectrumBaseClass:function(){return Kekule.Spectroscopy.Spectrum},chemObjChanged:function(e,t){var r=this.getSpectrumBaseClass();if(e){var i;i=e instanceof r?[e]:e.filterChildren(function(e){return e&&e instanceof r});var n=this.getSpectrums();this.invokeEvent("load",{obj:e,spectrums:i||[]}),this.spectrumsChanged(i,n)}else{n=this.getSpectrums();this.spectrumsChanged([],n)}},spectrumsChanged:function(e,t){this.setPropStoreFieldValue("spectrums",e),this.setActiveSpectrumIndex(0),this._refillSpectrumDataSectionSelectMenu()},activeSpectrumChanged:function(e,t){this._loadInSpectrumViewer(e),this._updateSpectrumDataSectionSelectMenuCheckState(),this.getAutoSyncUiMarkerStyles()&&this.syncHotTrackAndSelectStylesBetweenViewers()},activeSpectrumDataSectionChanged:function(e,t){e!=t&&(this._repaintSpectrumViewer(),this._updateSpectrumDataSectionSelectMenuCheckState(),this.getAutoSyncUiMarkerStyles()&&this.syncHotTrackAndSelectStylesBetweenViewers())},_loadInSpectrumViewer:function(e){this._isLoadingFromSubSpectrumViewer=!0;try{this.getSpectrumViewer().load(e)}finally{this._isLoadingFromSubSpectrumViewer=!1}},_repaintSpectrumViewer:function(){this.getSpectrumViewer().requestRepaint()},getSpectrumViewerConfigs:function(){var e=this.getSpectrumViewer();return e&&e.getViewerConfigs()},getAssocViewerConfigs:function(){var e=this.getAssocViewer();return e&&e.getViewerConfigs()},_applyPropertyToChildViewerProperty:function(e,t){var r=this.getSpectrumViewer();r&&r.setPropValue(e,t),(r=this.getAssocViewer())&&r.setPropValue(e,t)},_applyEnablePropertyToChildViewerConfigs:function(e,t){var r,i;if("enableHotTrack"===e?(r="enableSpectrumDataHotTrackOnMode",i="enableBasicObjectHotTrack"):"enableSelect"===e?(r="enableSpectrumDataSelectOnMode",i="enableBasicObjectSelect"):"enableMultiSelect"===e&&(r="enableSpectrumDataMultiSelectOnMode",i="enableBasicObjectMultiSelect"),r&&i){var n=this.getSpectrumViewerConfigs(),o=n&&n.getSpectrumViewConfigs(),a=n&&n.getInteractionConfigs(),s=this.getAssocViewerConfigs(),l=s&&s.getInteractionConfigs();if(l&&l.setPropValue(i,t),a&&a.setPropValue(i,t),o){var u=o.getPropValue(r);u?u.default=t:o.setPropValue({default:t})}}},_applyAllEnablePropertiesToChildViewerConfigs:function(){for(var e=["enableSelect","enableMultiSelect","enableHotTrack"],t=0,r=e.length;t<r;++t){var i=e[t],n=this.getPropValue(i);this._applyEnablePropertyToChildViewerConfigs(i,n)}},syncHotTrackAndSelectStylesBetweenViewers:function(){var e=this.getActiveDataSection();if(e){var t,r,i=this.getSpectrumViewer().getViewerConfigs().getSpectrumViewConfigs(),n=this.getAssocViewer().getViewerConfigs().getUiMarkerConfigs(),o=e.getMode(),a=i.getDataModeSpecifiedConfigValue("spectrumDataHotTrackUiMarkersOnMode",o)&&i.getDataModeSpecifiedConfigValue("spectrumHotTrackDataPointMarkerDrawStyles",o),s=i.getDataModeSpecifiedConfigValue("spectrumDataSelectUiMarkersOnMode",o)&&i.getDataModeSpecifiedConfigValue("spectrumSelectDataPointMarkerDrawStyles",o);o===Kekule.Spectroscopy.DataMode.PEAK&&(t=i.getSpectrumPeakHotTrackStyles(),r=i.getSpectrumPeakSelectStyles());var l={opacity:0,color:"transparent"};a?n.setHotTrackMarkerStyles(Object.extend({},a)):n.setHotTrackMarkerStyles(l),s?n.setSelectionMarkerStyles(Object.extend({},s)):n.setSelectionMarkerStyles(l),t?n.setHotTrackedObjectStyles(Object.extend({nodeDisplayMode:Kekule.Render.NodeLabelDisplayMode.SHOWN},t)):n.setHotTrackedObjectStyles({}),r?n.setSelectedObjectStyles(Object.extend({nodeDisplayMode:Kekule.Render.NodeLabelDisplayMode.SHOWN},r)):n.setSelectedObjectStyles({})}},getSpectrumSubView:function(){var e=this.getSpectrumViewer();return e&&e.getSubView(this.getActiveSpectrum(),Kekule.ChemWidget.Viewer.SpectrumSubView,!0)},resetDisplay:function(){var e;(e=this.getSpectrumViewer())&&e.resetDisplay(),(e=this.getAssocViewer())&&e.resetDisplay()},load:function(e){return this.doLoad(e)},doLoad:function(e){this.setChemObj(e)},loadFromData:function(e,t,r,i,n){try{var o;return e?(i?o=Kekule.IO.loadFormatData(e,i):(t||r)&&(o=Kekule.IO.loadTypedData(e,t,r)),o?this.load(o):Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED")),o):(this.setChemObj(null),null)}catch(e){this.reportException(e)}},loadFromFile:function(e){if(e){var t=this;try{Kekule.IO.loadFileData(e,function(e,r){r&&t.load(e)})}catch(e){this.reportException(e)}}else this.setChemObj(null)},getSavingTargetObj:function(){return this.getChemObj()},saveData:function(e,t,r){r=r||this.getSavingTargetObj();this.prepareSaveData(r);var i=Kekule.IO.ChemDataWriterManager.getWriterByFormat(e,null,r);if(i){if(!t)t=Kekule.IO.DataFormatsManager.getFormatInfo(e).dataType;return i.writeData(r,t,e)}return Kekule.error(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")),null},prepareSaveData:function(e){},getSelectedSpectrumDataItemsEx:function(){var e=this.getSpectrumSubView();return e&&e.getSelectedDataItemsEx()},getSelectedSpectrumDataItems:function(){var e=this.getSpectrumSubView();return e&&e.getSelectedDataItems()},getSelectedAssocObjects:function(){return this.getAssocViewer()&&this.getAssocViewer().getSelectedObjects()},doSetSpectrumDataAssignments:function(e,t){if(!(e&&e.length&&t&&t.length))return this;for(var r=0,i=e.length;r<i;++r){var n=e[r].dataValue,o=e[r].section,a=o.getExtraInfoOf(n);a&&a.setAssignments?a.setAssignments(t):((a=Kekule.Spectroscopy.Utils.createDefaultDataExtraInfoObject(o)).setAssignments(t),o.setExtraInfoOf(n,a))}return this},setSpectrumDataAssignmentsBySelectedObjects:function(){var e=this.getSelectedSpectrumDataItemsEx(),t=this.getSelectedAssocObjects();return this.doSetSpectrumDataAssignments(e,t)},exportToDataUriAsync:function(e,t,r){var i=t||{},n=this.getSpectrumViewer(),o=this.getAssocViewer();if(o.isShown())if(n.isShown()){var a=o.exportToDataUri(e,i),s=n.exportToDataUri(e,i),l=this.getAssocViewerActualPosition(),u=this._calcSubViewerOffsetsAndDimensionsForExportDataUri(n,o,l),d=this.getClientComponentHolderElems().hiddenCanvas,c=n.getDrawBridge(),h=c.createContext(d,u.totalDimension.width,u.totalDimension.height),p={},g=function(e,t){if(p[e]=t,!t){C();var r="assocViewer"===e?Kekule.$L("ErrorMsg.FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_ASSOC"):Kekule.$L("ErrorMsg.FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_SPECTRUM");Kekule.warn(r)}p.spectrumViewer&&p.assocViewer&&f()},f=function(){var t=c.exportToDataUri(h,e,i);r&&r(t,u.totalDimension),C()},C=function(){h&&c.releaseContext(h),h=null};c.drawImage(h,s,u.spectrumViewerOffset,{x:u.spectrumViewerDimension.width,y:u.spectrumViewerDimension.height},{},function(e){g("spectrumViewer",e)}),c.drawImage(h,a,u.assocViewerOffset,{x:u.assocViewerDimension.width,y:u.assocViewerDimension.height},{},function(e){g("assocViewer",e)})}else{m=o.isShown()?o.exportToDataUri(e,i):"";r(m,o.getContextDimension())}else{var m=n.isShown()?n.exportToDataUri(e,i):"";r(m,n.getContextDimension())}},_calcSubViewerOffsetsAndDimensionsForExportDataUri:function(e,t,r){var i,n,o,a=t.getContextDimension(),s=e.getContextDimension(),l=Kekule.Widget.Position;return r&l.TOP?(i={x:0,y:0},n={x:0,y:a.height},o={width:Math.max(s.width,a.width),height:s.height+a.height}):r&l.BOTTOM?(i={x:0,y:s.height},n={x:0,y:0},o={width:Math.max(s.width,a.width),height:s.height+a.height}):r&l.RIGHT?(i={x:s.width,y:0},n={x:0,y:0},o={width:s.width+a.width,height:Math.max(s.height,a.height)}):(i={x:0,y:0},n={x:a.width,y:0},o={width:s.width+a.width,height:Math.max(s.height,a.height)}),{spectrumViewerOffset:n,assocViewerOffset:i,spectrumViewerDimension:s,assocViewerDimension:a,totalDimension:o}},repaint:function(e){var t=this.getSpectrumViewer();t&&t.repaint(e),(t=this.getAssocViewer())&&t.repaint(e)},requestRepaint:function(e){var t=this.getSpectrumViewer();t&&t.requestRepaint(e),(t=this.getAssocViewer())&&t.requestRepaint(e)},beginEditing:function(){return this.getEnableEdit()&&this.doBeginEditing(),this},doBeginEditing:function(){this.getCorrelationConnector().setEnabled(!1),this.__enablePropValueStorage__={enableHotTrack:this.getEnableHotTrack(),enableSelect:this.getEnableSelect(),enableMultiSelect:this.getEnableMultiSelect()},this.setEnableHotTrack(!0),this.setEnableSelect(!0),this.setEnableMultiSelect(!0),this.addClassName(n.SPECTRUM_INSPECTOR_IN_EDITING),this.setPropStoreFieldValue("isEditing",!0)},endEditing:function(){this.getIsEditing()&&this.doEndEditing()},doEndEditing:function(){var e=this.__enablePropValueStorage__;e&&(this.setEnableHotTrack(e.enableHotTrack),this.setEnableSelect(e.enableSelect),this.setEnableMultiSelect(e.enableMultiSelect)),this.getCorrelationConnector().setEnabled(!0),this.removeClassName(n.SPECTRUM_INSPECTOR_IN_EDITING),this.setPropStoreFieldValue("isEditing",!1)}}),Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode={VISIBLE:1,INVISIBLE:2,AUTO:0};var o=Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode;Kekule.ChemWidget.SpectrumInspector.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.SpectrumInspector.Settings",initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile","enableHotTrack","enableSelect","enableMultiSelect","enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","autoSyncUiMarkerStyles","assocViewerVisualMode","assocViewerPosition","enableOperationFromSpectrumToMolecule","enableOperationFromMoleculeToSpectrum","assocViewerAutoSize","assocViewerAutofit","assocViewerAutoShrink"])},getSpectrumInspector:function(){return this.getWidget()}}),Kekule.ChemWidget.SpectrumInspector.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.SpectrumInspector.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var e=this.tryApplySuper("getCategoryInfos"),t=this.getSpectrumInspector(),r=["spectrumViewerConfigs","spectrumViewerRenderConfigs","assocViewerConfigs","assocViewerRenderConfigs"],i=0,n=r.length;i<n;++i){var o=t.getPropInfo(r[i]),a=t.getPropValue(r[i]);a&&e.push({obj:a,name:o.name,title:o.title,description:o.description})}return e},getSpectrumInspector:function(){return this.getWidget()}});var a=Kekule.ObjPropSettingManager;a.register("Kekule.ChemWidget.SpectrumInspector.fullFunc",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,enableEdit:!0,toolButtons:null}),a.register("Kekule.ChemWidget.SpectrumInspector.basic",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,toolButtons:[r.saveData,r.changeSpectrumSection,r.zoomIn,r.zoomOut]}),a.register("Kekule.ChemWidget.SpectrumInspector.mini",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[r.changeSpectrumSection]}),a.register("Kekule.ChemWidget.SpectrumInspector.static",{enableToolbar:!1,enableDirectInteraction:!1,enableTouchInteraction:!1,toolButtons:[],menuItems:[]}),Kekule.ChemWidget.ActionOnSpectrumInspector=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnSpectrumInspector",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setTargetWidget(e),this.setText(t),this.setHint(r)},initProperties:function(){this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},getSpectrumInspector:function(e){return e||(e=this.getTargetWidget()),e instanceof Kekule.ChemWidget.SpectrumInspector?e:e&&e.getParent()instanceof Kekule.ChemWidget.SpectrumInspector?e.getParent():void 0},doUpdate:function(){var e=this.getSpectrumInspector();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},execute:function(e,t){return!this.getSpectrumInspector()&&e instanceof Kekule.ChemWidget.SpectrumInspector&&this.setSpectrumInspector(e),this.tryApplySuper("execute",[e,t])}}),Kekule.ChemWidget.ActionSpectrumInspectorReset=Class.create(Kekule.ChemWidget.ActionOnSpectrumInspector,{CLASS_NAME:"Kekule.ChemWidget.ActionSpectrumInspectorReset",HTML_CLASSNAME:n.ACTION_RESET,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_RESETVIEW"),Kekule.$L("ChemWidgetTexts.HINT_RESETVIEW")])},doExecute:function(e){this.tryApplySuper("doExecute",[e]),this.getSpectrumInspector().resetDisplay()}}),Kekule.ChemWidget.ActionSpectrumInspectorChangeSpectrumSectionStub=Class.create(Kekule.ChemWidget.ActionOnSpectrumInspector,{CLASS_NAME:"Kekule.ChemWidget.ActionSpectrumInspectorChangeSpectrumSectionStub",HTML_CLASSNAME:n.ACTION_SPECTRUM_INSPECTOR_CHANGE_SECTION,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_CHANGE_SPECTRUM_SECTION"),Kekule.$L("ChemWidgetTexts.HINT_CHANGE_SPECTRUM_SECTION")])},doExecute:function(e){this.tryApplySuper("doExecute",[e])},doUpdate:function(){this.tryApplySuper("doUpdate")},_hasMultipleDisplayItems:function(e){var t=!1,r=e.getSpectrums();if(r.length>1)t=!0;else{var i=r[0];t=i&&i.getDataSectionCount()>1}return t}}),Kekule.ChemWidget.ActionSpectrumInspectorAssignmentCorrelate=Class.create(Kekule.ChemWidget.ActionOnSpectrumInspector,{CLASS_NAME:"Kekule.ChemWidget.ActionSpectrumInspectorAssignmentCorrelate",HTML_CLASSNAME:n.ACTION_SPECTRUM_INSPECTOR_CORRELATOR,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_SET_SPECTRUM_DATA_ASSIGNMENT"),Kekule.$L("ChemWidgetTexts.HINT_SET_SPECTRUM_DATA_ASSIGNMENT")])},doExecute:function(e){this.tryApplySuper("doExecute",[e]),this.getSpectrumInspector().setSpectrumDataAssignmentsBySelectedObjects()},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getSpectrumInspector(),t=e.getSelectedSpectrumDataItems(),r=e.getSelectedAssocObjects();this.setEnabled(this.getEnabled()&&t&&t.length&&r&&r.length)}}),Kekule._registerAfterLoadSysProc(function(){var e=Kekule.ActionManager,t=Kekule.ChemWidget,i=Kekule.ChemWidget.SpectrumInspector,n=e.registerNamedActionClass;n(r.reset,t.ActionSpectrumInspectorReset,i),n(r.changeSpectrumSection,t.ActionSpectrumInspectorChangeSpectrumSectionStub,i),n(r.correlateSpectrumDataAndObject,t.ActionSpectrumInspectorAssignmentCorrelate,i),n(r.config,Kekule.Widget.ActionOpenConfigWidget,i)})}})}(),function(){"use strict";var e=Class.PropertyScope;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER_GRID:"K-Chem-Viewer-Grid"});Kekule.Widget.HtmlClassNames;var t=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ViewerGrid=Class.create(Kekule.Widget.WidgetGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid",initialize:function(e,t,r){this.setPropStoreFieldValue("renderType",t),this.setPropStoreFieldValue("viewerConfigs",r),this.tryApplySuper("initialize",[e])},initProperties:function(){this._shadowedPropPairs=[],this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,setter:null,scope:e.PUBLIC}),this.defineProp("chemObjs",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){var e=[];return this.each(function(t){e.push(t.getChemObj())}),e}}),this.defineViewerShadowProps(["drawOptions","moleculeDisplayType","zoom","autoSize","enableLoadNewFile","viewerConfigs","allowedMolDisplayTypes","enableEdit","modalEdit","toolButtons","enableToolbar","toolbarPos","toolbarMarginVertical","toolbarMarginHorizontal","toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","caption","showCaption","autoCaption","captionPos","enableDirectInteraction","enableTouchInteraction"]),this.defineViewerShadowProps(["viewerPredefinedSetting"],["predefinedSetting"]),this.defineProp("actionLoadData",{dataType:"Kekule.ChemWidget.ActionDisplayerLoadData",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actionLoadData");return e||(e=new Kekule.ChemWidget.ActionDisplayerLoadData,this.setPropStoreFieldValue("actionLoadData",e)),e}})},defineViewerShadowProps:function(e,t){t||(t=[]);for(var r=0,i=e.length;r<i;++r){var n=e[r],o=t[r]||e[r];this.defineViewerShadowProp(n,o)}},defineViewerShadowProp:function(e,t){t||(t=e);var r=Kekule.ChemWidget.Viewer,i=ClassEx.getPropInfo(r,t);if(i){var n=Object.create(i);n.getter=void 0,n.setter=function(r){this.setPropStoreFieldValue(e,r),this.each(function(e){e.setPropValue(t,r)})},this.defineProp(e,n),this._shadowedPropPairs.push({prop:e,viewerProp:t})}},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.VIEWER_GRID},createWidget:function(){var e=this.getDocument(),t=new Kekule.ChemWidget.LoadDataDialog(e),r=this;t.openModal(function(i){if(t.isPositiveResult(i)){var n=t.getDataDetails();if(a=t.getChemObj()){var o=r.doCreateNewChildWidget(e,null,a),a=o.loadFromData(n.data,n.mimeType,n.fileName,n.formatId);o.setParent(r)}else n.data&&Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}},this.getAddingCell())},doCreateNewChildWidget:function(e,t){var r=new Kekule.ChemWidget.Viewer(e,null,this.getRenderType(),this.getViewerConfigs());return this.doSetShadowedPropValuesToViewer(r),t&&r.setChemObj(t),r},doSetShadowedPropValuesToViewer:function(e){for(var t=0,r=this._shadowedPropPairs.length;t<r;++t){var i=this._shadowedPropPairs[t],n=this.getPropValue(i.prop);void 0!==n&&e.setPropValue(i.viewerProp,n)}},addChemObj:function(e){return this.doCreateNewChildWidget(this.getDocument(),e).setParent(this),this},removeChemObj:function(e){var t=this;return this.each(function(r){r.getChemObj()===e&&t.removeWidget(r,!0)}),this}}),Kekule.ChemWidget.ViewerGrid2D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid2D",initialize:function(e,t){this.tryApplySuper("initialize",[e,Kekule.Render.RendererType.R2D,t])}}),Kekule.ChemWidget.ViewerGrid3D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid3D",initialize:function(e,t){this.tryApplySuper("initialize",[e,Kekule.Render.RendererType.R3D,t])}})}(),function(){"use strict";var e=Class.PropertyScope,t=Kekule.ObjUtils,r=Kekule.DomUtils,i=Kekule.ArrayUtils,n=(Kekule.ChemWidget,Kekule.ChemWidget.ComponentWidgetNames);Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMOBJSETTER:"K-Chem-Obj-Setter",CHEMOBJSETTER_FLEX_LAYOUT:"K-Chem-Obj-Setter-Flex-Layout",CHEMOBJSETTER_TOOLBAR_AREA:"K-Chem-Obj-Setter-Toolbar-Area",CHEMOBJSETTER_CLIENT:"K-Chem-Obj-Setter-Client",CHEMOBJSETTER_VIEWER:"K-Chem-Obj-Setter-Viewer",CHEMOBJSETTER_TABGROUP:"K-Chem-Obj-Setter-TabGroup",CHEMOBJSETTER_INFOLABEL:"K-Chem-Obj-Setter-InfoLabel",CHEMOBJSETTER_STATUSLABEL:"K-Chem-Obj-Setter-StatusLabel",CHEMOBJSETTER_REGION:"K-Chem-Obj-Setter-Region",CHEMOBJSETTER_REGION_LABEL:"K-Chem-Obj-Setter-Region-Label",CHEMOBJSETTER_LINE:"K-Chem-Obj-Setter-Line",CHEMOBJSETTER_CONFIGURATOR:"K-Chem-Obj-Setter-Configurator",SPECTRUMOBJ_INSERTER:"K-SpectrumObjInserter",SPECTRUMOBJ_INSERTER_CONTAINER_ELEM:"K-SpectrumObjInserter-Container",SPECTRUMOBJ_INSERTER_CLIENT:"K-SpectrumObjInserter-Client",SPECTRUMOBJ_INSERTER_TOOLBAR_AREA:"K-SpectrumObjInserter-Toolbar-Area",SPECTRUMOBJ_INSERTER_INFOLABEL:"K-SpectrumObjInserter-InfoLabel",SPECTRUMOBJ_INSERTER_SPECTRUM_INSPECTOR:"K-SpectrumObjInserter-SpectrumInspector",SPECTRUMOBJ_INSERTER_CONFIGURATOR:"K-SpectrumObjInserter-Configurator"});var o=Kekule.Widget.HtmlClassNames,a=Kekule.ChemWidget.HtmlClassNames;Kekule.globalOptions.add("chemWidget.chemObjInserter",{autoSizeExport:!0,backgroundColor3D:"#000000",exportViewerPredefinedSetting:"basic",enable3DStructureAutoGeneration:!1,toolButtons:[n.loadData,n.saveData,n.clearObjs,n.molDisplayType,n.molHideHydrogens,n.molAutoGenerateCoords,n.zoomIn,n.zoomOut,n.rotateX,n.rotateY,n.rotateZ,n.rotateLeft,n.rotateRight,n.reset,n.openEditor,n.config]}),Kekule.ChemWidget.ChemObjInserter=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter",DEF_BGCOLOR_2D:"transparent",DEF_BGCOLOR_3D:"#000000",initialize:function(e,t,r,i){this._configAction=new Kekule.Widget.ActionOpenConfigWidget(this),this._toolbarParentElem=null,this._infoLabel=null,this._infoLabelTemplate=Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH_HEIGHT"),this.tryApplySuper("initialize",[e]);var n=this.getViewer();r&&n.setRenderType(r),i&&n.setViewerConfigs(i),this.adjustChildrenSizes()},doFinalize:function(){this._configAction&&this._configAction.finalize();var e=this.getPropStoreFieldValue("viewer");e&&e.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("viewer");return e||(e=this.createViewer(),this.setPropStoreFieldValue("viewer",e)),e}}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PUBLIC,getter:function(){return this.getPropStoreFieldValue("chemObj")},setter:function(e){this.setPropStoreFieldValue("chemObj",e),this.getViewer()&&this.getViewer().setChemObj(e)}}),this.defineProp("assoc3DChemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PRIVATE,setter:function(e){if(e!==this.getAssoc3DChemObj()&&(this.setPropStoreFieldValue("assoc3DChemObj",e),this.getRenderType()===Kekule.Render.RendererType.R3D)){var t=this._getDisplayedChemObjForRenderType(this.getRenderType());this._changeDisplayedChemObj(t)}}}),this.defineProp("currDisplayedChemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("viewer");return e&&e.getChemObj()}}),this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,scope:e.PUBLIC,setter:function(e){var t=this.getRenderType();if(e!==t){this.setPropStoreFieldValue("renderType",e);var r=this._getDisplayedChemObjForRenderType(t),i=this._getDisplayedChemObjForRenderType(e);this.getViewer().setRenderType(e),r!==i&&this._changeDisplayedChemObj(i);var n=this.getTabs();if(n){var o=e===Kekule.Render.RendererType.R3D?1:0;n.getChildWidgets()[o].setChecked(!0)}}}}),this.defineProp("is3D",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getRenderType()===Kekule.Render.RendererType.R3D},setter:function(e){this.setRenderType(e?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D)}}),this.defineProp("enable3DStructureAutoGeneration",{dataType:DataType.BOOL}),this.defineProp("showInfo",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._infoLabel&&Kekule.StyleUtils.isShown(this._infoLabel)},setter:function(e){this._infoLabel&&Kekule.StyleUtils.setDisplay(this._infoLabel,e)}}),this.defineProp("statusMessage",{dataType:DataType.STRING,serializable:!1,scope:e.PUBLIC,getter:function(){var e=this._statusLabel;return e&&e.innerHTML},setter:function(e){this._updateStatusLabel(e)}}),this.defineProp("autoSizeExport",{dataType:DataType.BOOL}),this.defineProp("backgroundColor2D",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("backgroundColor2D",e),this.backgroundColorChange()}}),this.defineProp("backgroundColor3D",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("backgroundColor3D",e),this.backgroundColorChange()}}),this.defineProp("exportViewerPredefinedSetting",{dataType:DataType.STRING}),this.defineProp("clientPanel",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:e.PRIVATE}),this.defineProp("tabs",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:e.PRIVATE}),this._defineViewerDelegatedProp("chemObjLoaded"),this._defineViewerDelegatedProp("renderConfigs"),this._defineViewerDelegatedProp("drawOptions"),this._defineViewerDelegatedProp("allowCoordBorrow"),this._defineViewerDelegatedProp("autoSize"),this._defineViewerDelegatedProp("autofit"),this._defineViewerDelegatedProp("autoShrink"),this._defineViewerDelegatedProp("viewerConfigs"),this._defineViewerDelegatedProp("allowedMolDisplayTypes"),this._defineViewerDelegatedProp("enableEdit"),this._defineViewerDelegatedProp("enableEditFromVoid"),this._defineViewerDelegatedProp("modalEdit"),this._defineViewerDelegatedProp("restrainEditorWithCurrObj"),this._defineViewerDelegatedProp("editorProperties"),this._defineViewerDelegatedProp("toolButtons"),this._defineViewerDelegatedProp("enableDirectInteraction"),this._defineViewerDelegatedProp("enableTouchInteraction"),this._defineViewerDelegatedProp("enableGesture")},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Object.extend({autoSizeExport:!0,backgroundColor3D:this.DEF_BGCOLOR_3D,exportViewerPredefinedSetting:"basic",enable3DStructureAutoGeneration:!1},Kekule.globalOptions.get("chemWidget.chemObjInserter"),{});this.setAutoSizeExport(e.autoSizeExport),this.setBackgroundColor3D(e.backgroundColor3D),this.setExportViewerPredefinedSetting(e.exportViewerPredefinedSetting)},_defineViewerDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(Kekule.ChemWidget.Viewer,t),i=Object.create(r);return i.getter=null,i.setter=null,r.getter&&(i.getter=function(){return this.getViewer().getPropValue(t)}),r.setter&&(i.setter=function(e){this.getViewer().setPropValue(t,e)}),this.defineProp(e,i)},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r){var i=Kekule.IO.loadTypedData(t.data,t.resType,t.resUri);this.setChemObj(i)}else Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+a.CHEMOBJSETTER;return this._isUsingFlexLayout()&&(e+=" "+a.CHEMOBJSETTER_FLEX_LAYOUT),e},_isUsingFlexLayout:function(){return Kekule.BrowserFeature.cssFlex},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);this.createToolbarParent(t);var i=new Kekule.Widget.Panel(this);return i.addClassName(a.CHEMOBJSETTER_CLIENT),i.setUseCornerDecoration(!1),i.appendToElem(t),this.setPropStoreFieldValue("clientPanel",i),this.createViewer(i.getCoreElement()),this.createInfoLabel(t,this.getViewer()),this.createStatusLabel(t,this.getViewer()),this.createTabs(t),r},elementBound:function(e){this.setObserveElemResize(!0)},doResize:function(){this.adjustChildrenSizes()},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),this.adjustChildrenSizes()},getResizerElement:function(){return this.getClientPanel()?this.getClientPanel().getCoreElement():this.getCoreElement()},getBackgroundColor:function(e){var t=e===Kekule.Render.RendererType.R3D?this.getBackgroundColor3D():this.getBackgroundColor2D();return t===Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT&&(t="transparent"),t},setBackgroundColor:function(e,t){if(t===Kekule.Render.RendererType.R3D){var r=e||this.DEF_BGCOLOR_3D;this.setBackgroundColor3D(r)}else{r=e||this.DEF_BGCOLOR_2D;this.setBackgroundColor2D(r)}},backgroundColorChange:function(){var e=this.getBackgroundColor(this.getRenderType()),t=this.getPropStoreFieldValue("viewer");t&&t.setBackgroundColor(e)},adjustChildrenSizes:function(){if(this._isUsingFlexLayout());else{this.getPageRect();var e=Kekule.HtmlElementUtils.getElemPageRect(this._toolbarParentElem),t=this.getTabs(),r=(t&&t.getPageRect()).top-e.bottom;this.getClientPanel().setHeight(r+"px")}this.getViewer().resized()},createViewer:function(e){var t=Kekule.ChemWidget.ComponentWidgetNames,r=Kekule.Widget.EvokeMode,i=new Kekule.ChemWidget.Viewer(this,null,this.getRenderType());i.addClassName([o.DYN_CREATED,a.CHEMOBJSETTER_VIEWER]),i.setRenderType(Kekule.Render.RendererType.R2D),i.setEnableEdit(!0),i.setEnableEditFromVoid(!0),i.setRestrainEditorWithCurrObj(!1),i.setEnableToolbar(!0),i.setPredefinedSetting("fullFunc");var n=this;i.overwriteMethod("createToolButton",function($origin,e,r){if(e===t.config){var i=new Kekule.Widget.Button(r),o=n._configAction;return o&&i.setAction(o),i}return $origin(e,r)});var s=Kekule.globalOptions.chemWidget.chemObjInserter.toolButtons;return i.setToolbarParentElem(this._toolbarParentElem),i.setToolButtons(s),i.setToolbarPos(Kekule.Widget.Position.BOTTOM),i.setToolbarMarginVertical(-2),i.setToolbarEvokeModes([r.ALWAYS]),i.addEventListener("resize",this.updateInfoLabel,this),i.addEventListener("load",this._reactViewerLoad,this),i.appendToElem(e),i.setChemObj(this.getChemObj()),this.setPropStoreFieldValue("viewer",i),this.backgroundColorChange(),i},_reactViewerLoad:function(e){if(!this._changingDisplayedChemObjFlag||this._changingDisplayedChemObjFlag<=0){var t=e.obj||null;this.setPropStoreFieldValue("chemObj",t),this.setAssoc3DChemObj(null),this.tryAutoGenerate3DCoordsForChemObjInViewer()}},createToolbarParent:function(e){var t=e.ownerDocument.createElement("div");return t.className=a.CHEMOBJSETTER_TOOLBAR_AREA,e.appendChild(t),this._toolbarParentElem=t,t},createTabs:function(e){var t=[Kekule.$L("ChemWidgetTexts.CAPTION_2D"),Kekule.$L("ChemWidgetTexts.CAPTION_3D")],r=this.getRenderType()===Kekule.Render.RendererType.R3D?1:0,i=new Kekule.Widget.TabButtonGroup(this);i.setTabButtonPosition(Kekule.Widget.Position.BOTTOM),i.addClassName([o.DYN_CREATED,a.CHEMOBJSETTER_TABGROUP]);for(var n=[],s=0,l=t.length;s<l;++s){var u=new Kekule.Widget.RadioButton(i);u.setText(t[s]),s===r&&u.setChecked(!0),n.push(u)}return i.addEventListener("switch",function(e){var t=e.button,r=1===n.indexOf(t)?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(r),this.backgroundColorChange(),this.tryAutoGenerate3DCoordsForChemObjInViewer()},this),i.appendToElem(e),this.setPropStoreFieldValue("tabs",i),i},createInfoLabel:function(e,t){var r=this.getDocument().createElement("div");return r.className=o.DYN_CREATED+" "+a.CHEMOBJSETTER_INFOLABEL,t.getElement().appendChild(r),this._infoLabel=r,r},updateInfoLabel:function(){var e=this.getViewer();if(e&&this._infoLabel){var t=e.getContextDimension(),r=t?this._infoLabelTemplate.format(Math.round(t.width),Math.round(t.height)):"";Kekule.DomUtils.setElementText(this._infoLabel,r)}},createStatusLabel:function(e,t){var r=this.getDocument().createElement("div");return r.className=o.DYN_CREATED+" "+a.CHEMOBJSETTER_STATUSLABEL,t.getElement().appendChild(r),this._statusLabel=r,r},_updateStatusLabel:function(e){this._statusLabel&&(this._statusLabel.innerHTML=e)},getContextDimension:function(){return this.getViewer().getContextDimension()},setContextDimension:function(e){var t=this.getContextDimension(),r=e.width-t.width,i=e.height-t.height,n=this.getDimension(),o={width:n.width+r,height:n.height+i};return this.setDimension(o.width,o.height),this},_getDisplayedChemObjForRenderType:function(e){return e===Kekule.Render.RendererType.R3D&&this.getAssoc3DChemObj()||this.getChemObj()},_changeDisplayedChemObj:function(e){this._changingDisplayedChemObjFlag||(this._changingDisplayedChemObjFlag=0),++this._changingDisplayedChemObjFlag;try{this.getViewer().setChemObj(e)}finally{--this._changingDisplayedChemObjFlag}},_getContainingMoleculesWithCtab:function(e){if(e||(e=this.getChemObj()),e instanceof Kekule.StructureFragment)return e.hasCtab()?[e]:[];for(var t=[],r=Kekule.ChemStructureUtils.getAllStructFragments(e),i=0,n=r.length;i<n;++i){var o=r[i];o.hasCtab&&o.hasCtab()&&t.push(o)}return t},_get3DCoordGenerationTargetForChemObj:function(e){e||(e=this.getChemObj());var t=this._getContainingMoleculesWithCtab(e);if(t&&1===t.length){var r=t[0];return r.nodesHasCoord3D(!1)?null:r}return null},_isCoordGeneratorAvailable:function(e){return this.getViewer()._isCoordGeneratorAvailable(e)},doGenerate3DCoordsForChemObjInViewer:function(e){var t=this.getChemObj(),r=this,i=function(t,i){r.setStatusMessage(""),e&&e(t,i)};if(t&&this._isCoordGeneratorAvailable(Kekule.CoordMode.COORD3D)){var n=this._get3DCoordGenerationTargetForChemObj(t);if(n){r.setStatusMessage(Kekule.$L("ChemWidgetTexts.CAPTION_CHEMOBJINSERTER_GENERATING_3D_STRUCTURE"));try{this.getViewer().autoGenerateChemObjCoords(i.bind(this,null),n,Kekule.CoordMode.COORD3D)}catch(e){i(e,t)}return this}}return i(null,t),this},generate3DCoordsForChemObjInViewer:function(e){var t=this;this.doGenerate3DCoordsForChemObjInViewer(function(e,r){!e&&r&&t.setAssoc3DChemObj(r)})},_isMolContainingCoordsOfMode:function(e,t){return e.getNodeCount()<=0||e.nodesHasCoordOfMode(t,!1,!0)},tryAutoGenerate3DCoordsForChemObjInViewer:function(e){if(this.getEnable3DStructureAutoGeneration()&&(this.getRenderType()===Kekule.Render.RendererType.R3D&&!this.getAssoc3DChemObj())){var t=this.getChemObj(),r=this._get3DCoordGenerationTargetForChemObj(t);r&&!this._isMolContainingCoordsOfMode(r,Kekule.CoordMode.COORD3D)&&this.generate3DCoordsForChemObjInViewer(e)}},exportToDataUri:function(e,t){return this.getViewer().exportToDataUri(e,t)},exportDetails:function(e,t){this.getAutoSizeExport()&&this.setAutoSize(!0);var r=this.getViewer().getActualDrawOptions(),i=this.getViewer().getContextDimension(),n=this.getCurrDisplayedChemObj(),o=n?{dataUri:this.exportToDataUri(e,t),drawOptions:r,drawOptionsJson:JSON.stringify(r),chemObj:n,chemObjJson:Kekule.IO.saveMimeData(n,"chemical/x-kekule-json"),autoSize:this.getAutoSizeExport(),autofit:this.getAutofit(),width:Math.round(i.width),height:Math.round(i.height),renderType:this.getRenderType()||Kekule.Render.RendererType.R2D,backgroundColor:this.getBackgroundColor(this.getRenderType()),predefinedSetting:this.getExportViewerPredefinedSetting()}:null;if(this.getAutoSizeExport()){this.setAutoSize(!1);var a=this.getViewer().getElement();a.style.width="auto",a.style.height="auto",this.getViewer().resized()}return o},getImgExportDetailsAsync:function(e,t,r){r(this.exportDetails(e,t))},getExportImgElemAttributes:function(e,t){var r=this.exportDetails(e,t);if(!r)return null;var i="width:"+r.width+"px; height:"+r.height+"px",n={src:r.dataUri,style:i,width:r.width,height:r.height,"data-kekule-widget":"Kekule.ChemWidget.Viewer","data-render-type":r.renderType,"data-chem-obj":r.chemObjJson,"data-draw-options":r.drawOptionsJson,"data-predefined-setting":r.predefinedSetting};return Kekule.ObjUtils.notUnset(r.autoSize)&&(n["data-auto-size"]=r.autoSize),Kekule.ObjUtils.notUnset(r.autofit)&&(n["data-autofit"]=r.autofit),Kekule.ObjUtils.notUnset(r.backgroundColor)&&(n["data-background-color"]=r.backgroundColor),n},getExportImgElemAttributesAsync:function(e,t,r){r(this.getExportImgElemAttributes(e,t))},createExportImgElement:function(e,t,r){var i=this.getExportImgElemAttributes(t,r)||{};if(i){var n=e.createElement("img");return Kekule.DomUtils.setElemAttributes(n,i),n}return null},createExportHtmlElement:function(e,t,r){return this.createExportImgElement(e,t,r)},createExportHtmlElementAsync:function(e,t,r,i){try{var n=this.createExportImgElement(e,t,r);i&&i(n)}catch(e){throw i(null),e}},importChemObjWithDetails:function(e,t){return this.setChemObj(e),this.setRenderType(t.renderType||Kekule.Render.RendererType.R2D),Kekule.ObjUtils.notUnset(t.autoSize)&&this.setAutoSizeExport(!!t.autoSize),Kekule.ObjUtils.notUnset(t.autofit)&&this.setAutofit(!!t.autofit),!t.width||!t.height||t.autoSize&&t.renderType!==Kekule.Render.RendererType.R3D||this.setContextDimension({width:t.width,height:t.height}),t.drawOptions&&this.getViewer().setDrawOptions(t.drawOptions),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,this.getRenderType()),this},importFromDetails:function(e,t){return this.importChemObjWithDetails(e,details)},importFromElemAttribs:function(e){e.width=DataType.JsonUtility.parse(e.width),e.height=DataType.JsonUtility.parse(e.height);var t=e["data-chem-obj"],r=t?Kekule.IO.loadMimeData(t,"chemical/x-kekule-json"):null;return e["data-render-type"]&&(e.renderType=DataType.JsonUtility.parse(e["data-render-type"])),e["data-draw-options"]&&(e.drawOptions=DataType.JsonUtility.parse(e["data-draw-options"])),e["data-auto-size"]&&(e.autoSize=DataType.JsonUtility.parse(e["data-auto-size"])),e["data-autofit"]&&(e.autofit=DataType.JsonUtility.parse(e["data-autofit"])),e["data-background-color"]&&(e.backgroundColor=e["data-background-color"]),this.importChemObjWithDetails(r,e)},importFromElem:function(e){var t=Kekule.HtmlElementUtils.getElemPageRect(e),r=Kekule.DomUtils.fetchAttributeValuesToJson(e);return r.width||(r.width=t.width),r.height||(r.height=t.height),this.importFromElemAttribs(r)}}),Kekule.ChemWidget.ChemObjInserter.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter.Configurator",initialize:function(e){this._checkBoxAutoSize=null,this._checkBoxAutofit=null,this._checkBoxShowInfo=null,this._textBoxWidth=null,this._textBoxHeight=null,this._colorPicker=null,this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",function(e){this.saveConfigValues()},this)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoUpdate(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+a.CHEMOBJSETTER_CONFIGURATOR},doCreateSubElements:function(e,t){var i;(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(s=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOSIZE")),s.addClassName(a.CHEMOBJSETTER_LINE),s.appendToElem(l),this._checkBoxAutoSize=s,(i=e.createElement("span")).className=o.PART_ASSOC_TEXT_CONTENT,r.setElementText(i,Kekule.$L("ChemWidgetTexts.HINT_AUTOSIZE")),l.appendChild(i),(s=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOFIT")),s.addClassName(a.CHEMOBJSETTER_LINE),s.appendToElem(l),this._checkBoxAutofit=s,(i=e.createElement("span")).className=o.PART_ASSOC_TEXT_CONTENT,r.setElementText(i,Kekule.$L("ChemWidgetTexts.HINT_AUTOFIT")),l.appendChild(i),t.appendChild(l),(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(u=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(u,Kekule.$L("ChemWidgetTexts.CAPTION_LABEL_SIZE")),l.appendChild(u),l.appendChild(e.createElement("br")),(n=new Kekule.Widget.TextBox(this)).setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_WIDTH")),n.appendToElem(l),this._textBoxWidth=n;var n,s,l,u=e.createElement("span");r.setElementText(u,"×"),l.appendChild(u),(n=new Kekule.Widget.TextBox(this)).setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_HEIGHT")),n.appendToElem(l),this._textBoxHeight=n,(s=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_SHOWSIZEINFO")),s.appendToElem(l),this._checkBoxShowInfo=s,t.appendChild(l),(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(u=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(u,Kekule.$L("ChemWidgetTexts.CAPTION_BACKGROUND_COLOR")),l.appendChild(u),l.appendChild(e.createElement("br"));var d=new Kekule.Widget.ColorPicker(this);d.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT]),d.appendToElem(l),this._colorPicker=d,t.appendChild(l)},loadConfigValues:function(){this.tryApplySuper("loadConfigValues");var e=this.getWidget();if(e){var t=!e.getIs3D();this._checkBoxAutoSize.setChecked(t&&e.getAutoSizeExport()),this._checkBoxAutoSize.setEnabled(t),this._checkBoxAutofit.setChecked(t&&e.getAutofit()),this._checkBoxAutofit.setEnabled(t),this._checkBoxShowInfo.setChecked(e.getShowInfo());var r=e.getContextDimension();this._textBoxWidth.setText(Math.round(r.width)),this._textBoxHeight.setText(Math.round(r.height));var i=t?e.getBackgroundColor2D():e.getBackgroundColor3D();this._colorPicker.setValue(i||Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT)}},saveConfigValues:function(){this.tryApplySuper("saveConfigValues");var e=this.getWidget();if(e){!e.getIs3D()?(e.setAutoSizeExport(this._checkBoxAutoSize.getChecked()),e.setAutofit(this._checkBoxAutofit.getChecked()),e.setBackgroundColor2D(this._colorPicker.getValue())):e.setBackgroundColor3D(this._colorPicker.getValue()),e.setShowInfo(this._checkBoxShowInfo.getChecked());var t={width:parseInt(this._textBoxWidth.getText()),height:parseInt(this._textBoxHeight.getText())};e.setContextDimension(t),e.invokeEvent("configSave")}}}),Kekule._registerAfterLoadSysProc(function(){Kekule.ChemWidget&&Kekule.Spectroscopy&&(Kekule.globalOptions.add("chemWidget.spectrumObjInserter",{toolButtons:[n.loadData,n.saveData,n.clearObjs,n.changeSpectrumSection,n.zoomIn,n.zoomOut,n.reset,n.copy,n.config]}),Kekule.ChemWidget.SpectrumObjInserter=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.SpectrumObjInserter",DEF_BGCOLOR_2D:"transparent",initialize:function(e,t){this._configAction=new Kekule.Widget.ActionOpenConfigWidget(this),this._toolbarParentElem=null,this._infoLabel=null,this._infoLabelTemplate=Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH_HEIGHT"),this.tryApplySuper("initialize",[e])},doFinalize:function(){this._configAction&&this._configAction.finalize();var e=this.getPropStoreFieldValue("spectrumInspector");e&&e.finalize();var t=this.getPropStoreFieldValue("clientPanel");t&&t.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("spectrumInspector",{dataType:"Kekule.ChemWidget.SpectrumInspector",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("spectrumInspector");return e||(e=this.createSpectrumInspector(),this.setPropStoreFieldValue("spectrumInspector",e)),e}}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("spectrumInspector");return e?e.getChemObj():this.getPropStoreFieldValue("chemObj")},setter:function(e){this.setPropStoreFieldValue("chemObj",e),this.getSpectrumInspector()&&this.getSpectrumInspector().setChemObj(e)}}),this.defineProp("showInfo",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._infoLabel&&Kekule.StyleUtils.isShown(this._infoLabel)},setter:function(e){this._infoLabel&&Kekule.StyleUtils.setDisplay(this._infoLabel,e)}}),this.defineProp("clientPanel",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:e.PRIVATE}),this._defineSpectrumInspectorDelegatedProperties(["spectrumViewportRanges","backgroundColor","enableHotTrack","enableSelect","enableMultiSelect","enableDirectInteraction","enableTouchInteraction","enableGestureInteraction","chemObjLoaded","renderConfigs","viewerConfigs","toolButtons","spectrumViewerDrawOptions","assocViewerDrawOptions","assocViewerConfigs","assocViewerAllowCoordBorrow","assocViewerAutoSize","assocViewerAutofit","assocViewerAutoShrink","assocViewerAllowedMolDisplayTypes","assocViewerVisualMode","assocViewerSize"])},_defineSpectrumInspectorDelegatedProperties:function(e){for(var t,r,n=Kekule.ChemWidget.SpectrumInspector,o=this,a=0,s=e.length;a<s;++a){var l=e[a];r=null,i.isArray(l)?(t=l[0],r=l[1]):t=l,r||(r=t),function(e,t,r){var i=ClassEx.getPropInfo(e,r),n=Object.create(i);n.getter=null,n.setter=null,n.serializable=!1,i.getter&&(n.getter=function(){var e=this.getSpectrumInspector();return e?e.getPropValue(r):void 0}),i.setter&&(n.setter=function(e){var t=this.getSpectrumInspector();t&&t.setPropValue(r,e)}),o.defineProp(t,n)}(n,t,r)}},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r){var i=Kekule.IO.loadTypedData(t.data,t.resType,t.resUri);this.setChemObj(i)}else Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+a.SPECTRUMOBJ_INSERTER},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=e.createElement("div");i.className=a.SPECTRUMOBJ_INSERTER_CONTAINER_ELEM,this._containerElem=i,this.createToolbarParent(i);var n=new Kekule.Widget.Panel(this);return n.addClassName(a.SPECTRUMOBJ_INSERTER_CLIENT),n.setUseCornerDecoration(!1),n.appendToElem(i),this.setPropStoreFieldValue("clientPanel",n),this.createSpectrumInspector(n.getCoreElement()),this.createInfoLabel(n.getCoreElement(),this.getSpectrumInspector()),t.appendChild(i),this.setResizable&&this.setResizable(!0),r},getResizerElement:function(){return this.getClientPanel()?this.getClientPanel().getCoreElement():this.getCoreElement()},createSpectrumInspector:function(e){var t=Kekule.ChemWidget.ComponentWidgetNames,r=Kekule.Widget.EvokeMode,i=new Kekule.ChemWidget.SpectrumInspector(this);i.addClassName([o.DYN_CREATED,a.SPECTRUMOBJ_INSERTER_SPECTRUM_INSPECTOR]);var n=this;i.getSpectrumViewer().overwriteMethod("createToolButton",function($origin,e,r){if(e===t.config){var i=new Kekule.Widget.Button(r),o=n._configAction;return o&&i.setAction(o),i}return $origin(e,r)});var s=Kekule.globalOptions.chemWidget.spectrumObjInserter.toolButtons;return i.setToolbarParentElem(this._toolbarParentElem),i.setToolButtons(s),i.setToolbarPos(Kekule.Widget.Position.BOTTOM),i.setToolbarMarginVertical(-2),i.getSpectrumViewer().setToolbarEvokeModes([r.ALWAYS]),i.getAssocViewer().setToolbarEvokeModes([]),i.addEventListener("resize",this.updateInfoLabel,this),i.appendToElem(e),i.setChemObj(this.getChemObj()),this.setPropStoreFieldValue("spectrumInspector",i),i},createToolbarParent:function(e){var t=e.ownerDocument.createElement("div");return t.className=a.SPECTRUMOBJ_INSERTER_TOOLBAR_AREA,e.appendChild(t),this._toolbarParentElem=t,t},createInfoLabel:function(e,t){var r=this.getDocument().createElement("div");return r.className=o.DYN_CREATED+" "+a.SPECTRUMOBJ_INSERTER_INFOLABEL,e.appendChild(r),this._infoLabel=r,r},updateInfoLabel:function(){var e=this.getSpectrumInspector();if(e&&this._infoLabel){var t=e.getDimension(),r=t?this._infoLabelTemplate.format(Math.round(t.width),Math.round(t.height)):"";Kekule.DomUtils.setElementText(this._infoLabel,r)}},getSpectrumInspectorDimension:function(){return this.getSpectrumInspector().getDimension()},setSpectrumInspectorDimension:function(e){var t=this.getSpectrumInspectorDimension(),r=e.width-t.width,i=e.height-t.height,n=this.getDimension(),o={width:n.width+r,height:n.height+i};return this.setDimension(o.width,o.height),this},getImgExportDetailsAsync:function(e,t,r){try{var i=this.getSpectrumInspector(),n=i.getChemObj();if(n){var o={backgroundColor:i.getBackgroundColor(),enableHotTrack:i.getEnableHotTrack(),enableSelect:i.getEnableSelect(),enableMultiSelect:i.getEnableMultiSelect(),spectrumViewerDrawOptions:i.getSpectrumViewerDrawOptions(),spectrumViewerDrawOptionsJson:i.getSpectrumViewerDrawOptions()?JSON.stringify(i.getSpectrumViewerDrawOptions()):"",spectrumViewportRanges:i.getSpectrumViewportRanges(),spectrumViewportRangesJson:i.getSpectrumViewportRanges()?JSON.stringify(i.getSpectrumViewportRanges()):"",assocViewerDrawOptions:i.getAssocViewerDrawOptions(),assocViewerDrawOptionsJson:i.getAssocViewerDrawOptions()?JSON.stringify(i.getAssocViewerDrawOptions()):"",assocViewerVisualMode:i.getAssocViewerVisualMode(),assocViewerSize:i.getAssocViewerSize(),chemObj:n,chemObjJson:Kekule.IO.saveMimeData(this.getChemObj(),Kekule.IO.MimeType.KEKULE_JSON)};i.exportToDataUriAsync(e,t,function(e,t){o.dataUri=e,o.width=Math.round(t.width),o.height=Math.round(t.height),r(o)})}else r(null)}catch(e){throw r(null),e}},getExportImgElemAttributesAsync:function(e,r,i){this.getImgExportDetailsAsync(e,r,function(e){if(e){var r="width:"+e.width+"px; height:"+e.height+"px",n={src:e.dataUri,style:r,width:e.width,height:e.height,"data-kekule-widget":"Kekule.ChemWidget.SpectrumInspector","data-chem-obj":e.chemObjJson,"data-spectrum-viewer-draw-options":e.spectrumViewerDrawOptionsJson,"data-assoc-viewer-draw-options":e.assocViewerDrawOptionsJson};Kekule.ObjUtils.notUnset(e.assocViewerVisualMode)&&(n["data-assoc-viewer-visual-mode"]=JSON.stringify(e.assocViewerVisualMode)),Kekule.ObjUtils.notUnset(e.assocViewerSize)&&(n["data-assoc-viewer-size"]=e.assocViewerSize),e.spectrumViewportRangesJson&&(n["data-spectrum-viewport-ranges"]=e.spectrumViewportRangesJson),t.notUnset(e.enableHotTrack)&&(n["data-enable-hot-track"]=e.enableHotTrack),t.notUnset(e.enableSelect)&&(n["data-enable-select"]=e.enableSelect),t.notUnset(e.enableMultiSelect)&&(n["data-enable-multi-select"]=e.enableMultiSelect),Kekule.ObjUtils.notUnset(e.backgroundColor)&&(n["data-background-color"]=e.backgroundColor),i(n)}else i(null)})},exportToSingleImgElementAsync:function(e,t,r,i){this.getExportImgElemAttributesAsync(t,r,function(t){if(t){var r=e.createElement("img");Kekule.DomUtils.setElemAttributes(r,t),i(r)}else i(null)})},createExportHtmlElementAsync:function(e,t,r,i){this.exportToSingleImgElementAsync(e,t,r,function(e){i&&i(e)})},importFromDetails:function(e,r){this.setChemObj(e),this.getSpectrumInspector().beginUpdate();try{r.spectrumViewportRanges&&this.setSpectrumViewportRanges(r.spectrumViewportRanges),r.spectrumViewerDrawOptions&&this.setSpectrumViewerDrawOptions(r.spectrumViewerDrawOptions),r.assocViewerDrawOptions&&this.setAssocViewerDrawOptions(r.assocViewerDrawOptions),r.backgroundColor&&this.setBackgroundColor(r.backgroundColor),t.notUnset(r.enableHotTrack)&&this.setEnableHotTrack(r.enableHotTrack),t.notUnset(r.enableSelect)&&this.setEnableSelect(r.enableSelect),t.notUnset(r.enableMultiSelect)&&this.setEnableMultiSelect(r.enableMultiSelect),t.notUnset(r.assocViewerVisualMode)&&this.setAssocViewerVisualMode(r.assocViewerVisualMode),t.notUnset(r.assocViewerSize)&&this.setAssocViewerSize(r.assocViewerSize),r.width&&r.height&&this.setSpectrumInspectorDimension({width:r.width,height:r.height})}finally{this.getSpectrumInspector().endUpdate()}return this},importFromElemAttribs:function(e){e.width=DataType.JsonUtility.parse(e.width),e.height=DataType.JsonUtility.parse(e.height);var t=e["data-chem-obj"],r=t?Kekule.IO.loadMimeData(t,"chemical/x-kekule-json"):null;return e["data-spectrum-viewport-ranges"]&&(e.spectrumViewportRanges=DataType.JsonUtility.parse(e["data-spectrum-viewport-ranges"])),e["data-spectrum-viewer-draw-options"]&&(e.spectrumViewerDrawOptions=DataType.JsonUtility.parse(e["data-spectrum-viewer-draw-options"])),e["data-assoc-viewer-draw-options"]&&(e.assocViewerDrawOptions=DataType.JsonUtility.parse(e["data-assoc-viewer-draw-options"])),e["data-background-color"]&&(e.backgroundColor=e["data-background-color"]),e["data-enable-hot-track"]&&(e.enableHotTrack=DataType.JsonUtility.parse(e["data-enable-hot-track"])),e["data-enable-select"]&&(e.enableSelect=DataType.JsonUtility.parse(e["data-enable-select"])),e["data-enable-multi-select"]&&(e.enableMultiSelect=DataType.JsonUtility.parse(e["data-enable-multi-select"])),e["data-assoc-viewer-visual-mode"]&&(e.assocViewerVisualMode=DataType.JsonUtility.parse(e["data-assoc-viewer-visual-mode"])),this.importFromDetails(r,e)},importFromElem:function(e){var t=Kekule.HtmlElementUtils.getElemPageRect(e),r=Kekule.DomUtils.fetchAttributeValuesToJson(e);return r.width||(r.width=t.width),r.height||(r.height=t.height),this.importFromElemAttribs(r)}}),Kekule.ChemWidget.SpectrumObjInserter.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.SpectrumObjInserter.Configurator",initialize:function(e){this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this._reactInputWidgetValueChange.bind(this))},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoUpdate(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+a.SPECTRUMOBJ_INSERTER_CONFIGURATOR+" "+a.CHEMOBJSETTER_CONFIGURATOR},doCreateSubElements:function(e,t){var i;(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(u=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(u,Kekule.$L("ChemWidgetTexts.CAPTION_INTERACTIONS")),l.appendChild(u),l.appendChild(e.createElement("br")),(i=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_ENABLE_HOTTRACK")).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(l),this._checkBoxEnableHotTrack=i,(i=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_ENABLE_SELECT")).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(l),this._checkBoxEnableSelect=i,(i=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_ENABLE_MULTISELECT")).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(l),this._checkBoxEnableMultiSelect=i,t.appendChild(l),(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(u=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(u,Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE")),l.appendChild(u),l.appendChild(e.createElement("br"));var n=Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode,o=new Kekule.Widget.SelectBox(this);o.setItems([{text:Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE_AUTO"),value:n.AUTO},{text:Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE_VISIBLE"),value:n.VISIBLE},{text:Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE_INVISIBLE"),value:n.INVISIBLE}]).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(l),this._selectBoxAssocViewerVisualMode=o,(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(u=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(u,Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_SIZE")),l.appendChild(u),l.appendChild(e.createElement("br"));var s=e.createElement("input");s.setAttribute("type","range"),s.setAttribute("min","0"),s.setAttribute("max","100"),s.setAttribute("step","5");var l,u,d=this._reactRawInputElemValueChange.bind(this);Kekule.X.Event.addListener(s,"change",d),Kekule.X.Event.addListener(s,"input",d),this._assocViewerSizeInputElem=s,l.appendChild(s),t.appendChild(l),(l=e.createElement("div")).className=a.CHEMOBJSETTER_REGION,(u=e.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,r.setElementText(u,Kekule.$L("ChemWidgetTexts.CAPTION_BACKGROUND_COLOR")),l.appendChild(u),l.appendChild(e.createElement("br"));var c=new Kekule.Widget.ColorPicker(this);c.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT]),c.appendToElem(l),this._colorPicker=c,t.appendChild(l)},_reactInputWidgetValueChange:function(e){this.saveConfigValues()},_reactRawInputElemValueChange:function(e){this.saveConfigValues()},_getSpectrumInspectorAssovViewerSizePercent:function(){var e=this.__$spectrumInspectorAssocViewerSizePercent$__;if(t.isUnset(e)){var r=this.getWidget();if(r=r&&r.getSpectrumInspector()){var i=r.getAssocViewerSize();if(i&&"string"==typeof i){var n=Kekule.StyleUtils.analysisUnitsValue(i);(n.units="%")&&(e=n.value)}if(t.isUnset(e)){var o=r.getDimension()||{},a=r.getAssocViewer().getDimension()||{},s=r.getLayout()===Kekule.Widget.Layout.VERTICAL?"height":"width";e=100*(a[s]||0)/(o[s]||1)}}}return e<0?e=0:e>100&&(e=100),e},_setSpectrumInspectorAssovViewerSizePercent:function(e){this.__$spectrumInspectorAssocViewerSizePercent$__=e;var t=this.getWidget();(t=t&&t.getSpectrumInspector())&&t.setAssocViewerSize(Math.round(e)+"%")},loadConfigValues:function(){this.tryApplySuper("loadConfigValues");var e=this.getWidget();if(e){this._checkBoxEnableHotTrack.setChecked(e.getEnableHotTrack()),this._checkBoxEnableSelect.setChecked(e.getEnableSelect()),this._checkBoxEnableMultiSelect.setChecked(e.getEnableMultiSelect());var t=e.getBackgroundColor();this._colorPicker.setValue(t||Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT),this._selectBoxAssocViewerVisualMode.setValue(e.getAssocViewerVisualMode()),this._assocViewerSizeInputElem.value=Math.round(this._getSpectrumInspectorAssovViewerSizePercent())}},saveConfigValues:function(){this.tryApplySuper("saveConfigValues");var e=this.getWidget();if(e){e.beginUpdate();try{e.setEnableHotTrack(this._checkBoxEnableHotTrack.getChecked()),e.setEnableSelect(this._checkBoxEnableSelect.getChecked()),e.setEnableMultiSelect(this._checkBoxEnableMultiSelect.getChecked()),e.setBackgroundColor(this._colorPicker.getValue()),e.setAssocViewerVisualMode(this._selectBoxAssocViewerVisualMode.getValue()),this._setSpectrumInspectorAssovViewerSizePercent(parseFloat(this._assocViewerSizeInputElem.value)),e.invokeEvent("configSave")}finally{e.endUpdate()}}}}))})}(),function(){var e=Kekule.CoordMode,t=Kekule.ArrayUtils;ClassEx.extend(Kekule.ChemObject,{isStandalone:function(){return!this.getIsAttachedToParent()},getStandaloneAncestor:function(){for(var e=this;e.isStandalone&&!e.isStandalone()&&e.getParent&&e.getParent();)e=e.getParent();return e},getCascadeDeleteObjs:function(){return[]},cascadeRemove:function(e){var t=this.getParent();t&&t.notifyBeforeCascadeRemove&&t.notifyBeforeCascadeRemove(this),e?this.finalize():this.removeSelf(),t&&t.notifyAfterCascadeRemove&&t.notifyAfterCascadeRemove(this)},notifyBeforeCascadeRemove:function(e,t){},notifyAfterCascadeRemove:function(e,t){!this.getKeepEmptyEvenOnCascadeRemove()&&this.isEmpty()&&this.cascadeRemove(t)},isCoordDependent:function(){return!1},getCoordDependentObjects:function(){var e=[];return this.isCoordDependent()||e.push(this),e},getCoordDeterminateObjects:function(){var e=[];if(this.getAttachedMarkers)for(var r=this.getAttachedMarkers()||[],i=0,n=r.length;i<n;++i)e=e.concat(r[i].getCoordDependentObjects());var o=this.getAttachedCoordStickNodes();for(i=0,n=o.length;i<n;++i){var a=o[i];t.pushUnique(e,a),t.pushUnique(e,a.getCoordDeterminateObjects())}return e},getAllContainingConnectors:function(){return[]},getConstraintManipulationBaseObj:function(){if(this.isAttachedMarker&&this.isAttachedMarker()){var e=this.getParent();return e instanceof Kekule.StructureFragment?null:e}return null},transformAbsCoordByMatrix:function(e,t,r,i,n,o){if(this.getChildCount&&(i||Kekule.ObjUtils.isUnset(i)))for(var a=0,s=this.getChildCount();a<s;++a){var l=this.getChildAt(a);l&&l.transformAbsCoordByMatrix&&l.transformAbsCoordByMatrix(t,t,r,i,n,!0)}var u=r===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix;if(o){if(this.getCoordOfMode&&this.setCoordOfMode){var d=u(this.getCoordOfMode(r,n),e);this.setCoordOfMode(d,r)}}else if(this.getAbsCoordOfMode&&this.setAbsCoordOfMode){d=u(this.getAbsCoordOfMode(r,n),e);this.setAbsCoordOfMode(d,r)}},scaleSize:function(e,t,r,i){if(this.getSizeOfMode&&this.setSizeOfMode){var n=this.getSizeOfMode(t,i),o=Kekule.CoordUtils.multiply(n,e);this.setSizeOfMode(o,t)}if(this.getChildCount&&(r||Kekule.ObjUtils.isUnset(r)))for(var a=0,s=this.getChildCount();a<s;++a){var l=this.getChildAt(a);l&&l.scaleSize&&l.scaleSize(e,t,r,i)}}}),ClassEx.extendMethod(Kekule.ChemObject,"_attachedMarkerAdded",function($origin,e){var t=$origin(e);return e&&e.setIsAttachedToParent(!0),t}),ClassEx.extendMethod(Kekule.ChemObject,"_attachedMarkerRemoved",function($origin,e){var t=$origin(e);return e&&e.setIsAttachedToParent(!1),t}),ClassEx.defineProps(Kekule.ChemObject,[{name:"keepEmptyEvenOnCascadeRemove",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC},{name:"isAttachedToParent",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}]),ClassEx.extend(Kekule.ChemStructureObject,{getCascadeDeleteObjs:function(){for(var e=this.tryApplySuper("getCascadeDeleteObjs"),t=this.getLinkedConnectors?this.getLinkedConnectors():[],r=0,i=t.length;r<i;++r){var n=t[r];if(n.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(e,n);var o=n.getCascadeDeleteObjs();Kekule.ArrayUtils.pushUnique(e,o)}}return e},isStandalone:function(){return!1},getCoordDeterminateObjects:function(){for(var e=this.tryApplySuper("getCoordDeterminateObjects"),r=this.getLinkedConnectors(),i=0,n=r.length;i<n;++i){var o=r[i];t.pushUnique(e,o),t.pushUnique(e,o.getCoordDeterminateObjects())}return e}}),ClassEx.extend(Kekule.BaseStructureNode,{getCascadeDeleteObjs:function(){return this.tryApplySuper("getCascadeDeleteObjs")},isCoordDependent:function(){return!1},getCoordDependentObjects:function(){return this.tryApplySuper("getCoordDependentObjects")},move:function(e,t){var r=this.getCoordOfMode(t),i=Kekule.CoordUtils.add(r,e);return this.setCoordOfMode(i,t),i},move2D:function(t){return this.move(t,e.COORD2D)},move3D:function(t){return this.move(t,e.COORD3D)}}),ClassEx.extend(Kekule.BaseStructureConnector,{getCascadeDeleteObjs:function(){for(var e=this.tryApplySuper("getCascadeDeleteObjs"),t=this.getConnectedObjs(),r=0,i=t.length;r<i;++r){var n=t[r];n instanceof Kekule.BaseStructureNode&&n.getLinkedConnectors().length<=1&&Kekule.ArrayUtils.pushUnique(e,n)}return e},isCoordDependent:function(){return!0},getCoordDependentObjects:function(){for(var e=this.tryApplySuper("getCoordDependentObjects"),r=this.getConnectedObjs(),i=0,n=r.length;i<n;++i){var o=r[i];if(o.isExposed)var a=o.isExposed()?o:o.getExposedAncestor();else a=o;a&&t.pushUnique(e,a.getCoordDependentObjects())}return e},move:function(e,t){for(var r=0,i=this.getConnectedObjCount();r<i;++r){var n=this.getConnectedObjAt(r);n.move&&n.move(e,t)}},move2D:function(t){return this.move(t,e.COORD2D)},move3D:function(t){return this.move(t,e.COORD3D)},setAbsBaseCoord:function(e,t){var r=this.getAbsBaseCoord(),i=Kekule.CoordUtils.substract(e,r);this.move(i,t)},setAbsBaseCoord2D:function(e){this.setAbsCoordOfMode(e,Kekule.CoordMode.COORD2D)},setAbsBaseCoord3D:function(e){this.setAbsCoordOfMode(e,Kekule.CoordMode.COORD3D)}}),ClassEx.extend(Kekule.ChemStructureNode,{getConstraintManipulationBaseObj:function(){var e=this.getLinkedObjs();return 1===e.length?e[0]:this.tryApplySuper("getConstraintManipulationBaseObj")}}),ClassEx.extend(Kekule.Glyph.PathGlyphNode,{getCascadeDeleteObjs:function(){return[this.getParent()]},getConstraintManipulationBaseObj:function(){var e=this.getLinkedObjs();return 1===e.length?e[0]:this.tryApplySuper("getConstraintManipulationBaseObj")}}),ClassEx.extend(Kekule.Glyph.PathGlyphConnectorControlNode,{getCoordDeterminateObjects:function(){var e=this.tryApplySuper("getCoordDeterminateObjects"),t=this.getParentConnector();return t&&(e=(e||[]).concat([t])),e}}),ClassEx.extend(Kekule.Glyph.PathGlyphConnector,{getCascadeDeleteObjs:function(){return[this.getParent()]},getCoordDependentObjects:function(){var e=this.tryApplySuper("getCoordDependentObjects"),t=this.getControlPoints&&this.getControlPoints();return t&&t.length&&(e=(e||[]).concat(t)),e}}),ClassEx.extend(Kekule.StructureFragment,{isStandalone:function(){return!this.getCrossConnectors().length},notifyBeforeCascadeRemove:function(e,t){var r=this._getObjsNeedToBeCascadeRemoved(e);if(r&&r.length)for(var i=r.length-1;i>=0;--i){var n=r[i];t?n.finalize():n.removeSelf()}this.tryApplySuper("notifyBeforeCascadeRemove",[e,t])},getCoordDependentObjects:function(){if(this.isExpanded&&!this.isExpanded())return this.tryApplySuper("getCoordDependentObjects");if(this.hasCtab()){for(var e=[],r=this.getChildCount(),i=0;i<r;++i){var n=this.getChildAt(i);t.pushUnique(e,n.getCoordDependentObjects())}return e}return this.tryApplySuper("getCoordDependentObjects")},transformAbsCoordByMatrix:function(e,t,r,i,n,o){if(i||Kekule.ObjUtils.isUnset(i))for(var a=0,s=this.getNodeCount();a<s;++a){var l=this.getNodeAt(a);l&&l.transformAbsCoordByMatrix&&l.transformAbsCoordByMatrix(t,t,r,i,n,!0)}this.tryApplySuper("transformAbsCoordByMatrix",[e,t,r,!1,n,o])}}),ClassEx.extend(Kekule.Glyph.Base,{isStandalone:function(){return this.tryApplySuper("isStandalone")}}),ClassEx.extend(Kekule.Glyph.PathGlyph,{getCoordDependentObjects:function(){for(var e=[],t=this.getNodeCount(),r=0;r<t;++r){var i=this.getNodeAt(r);e.push(i)}return e},transformAbsCoordByMatrix:function(e,t,r,i,n,o){if(i||Kekule.ObjUtils.isUnset(i))for(var a=0,s=this.getNodeCount();a<s;++a){var l=this.getNodeAt(a);l&&l.transformAbsCoordByMatrix&&l.transformAbsCoordByMatrix(t,t,r,i,n,!0)}this.tryApplySuper("transformAbsCoordByMatrix",[e,t,r,!1,n,o])}}),ClassEx.extend(Kekule.Glyph.BaseArc,{ownerChanged:function(e,t){var r=!t&&e,i=this.tryApplySuper("ownerChanged",[e,t]);return r&&this.getIsEditing()&&this._autoAdjustClass(),i},_getChemStickTargets:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var i=this.getNodeAt(t).getCoordStickTarget();this._isValidChemNodeOrConnectorStickTarget(i)&&e.push(i)}return e},notifyChildCoordStickTargetChanged:function(e,t,r){this._autoAdjustClass()},_autoAdjustClass:function(){this.getIsEditing()&&(this._getChemStickTargets().length>=2?this instanceof Kekule.Glyph.ElectronPushingArrow||this.__changeClass__(Kekule.Glyph.ElectronPushingArrow):this instanceof Kekule.Glyph.ElectronPushingArrow&&this.__changeClass__(Kekule.Glyph.Arc))}}),ClassEx.extendMethod(Kekule.Glyph.BaseArc,"createDefaultStructure",function($origin,e,t){var r=$origin(e,t);return this._autoAdjustClass(),r}),ClassEx.extend(Kekule.Glyph.BaseTwinArc,{ownerChanged:function(e,t){var r=!t&&e,i=this.tryApplySuper("ownerChanged",[e,t]);return r&&this.getIsEditing()&&this._autoAdjustClass(),i},_getChemStickTargets:function(){for(var e=[],t=this._getArrowStartingNodes(),r=0,i=t.length;r<i;++r){var n=t[r].getCoordStickTarget();this._isValidChemNodeOrConnectorStickTarget(n)&&e.push(n)}return e},notifyChildCoordStickTargetChanged:function(e,t,r){this._autoAdjustClass()},_autoAdjustClass:function(){this.getIsEditing()&&(this._getChemStickTargets().length>=2?this instanceof Kekule.Glyph.BondFormingElectronPushingArrow||(this.__changeClass__(Kekule.Glyph.BondFormingElectronPushingArrow),this.getElectronCount()||this.setElectronCount(1)):this instanceof Kekule.Glyph.BondFormingElectronPushingArrow&&this.__changeClass__(Kekule.Glyph.TwinArc))}})}(),function(){"use strict";var e=Kekule.ObjUtils,t=Kekule.ArrayUtils,r=Kekule.HtmlElementUtils,i=Kekule.CoordUtils,n=Kekule.Widget.HtmlClassNames,o=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{EDITOR:"K-Chem-Editor",EDITOR_CLIENT:"K-Chem-Editor-Client",EDITOR_UIEVENT_RECEIVER:"K-Chem-Editor-UiEvent-Receiver",EDITOR2D:"K-Chem-Editor2D",EDITOR3D:"K-Chem-Editor3D"}),Kekule.ChemWidget.Editor={},Kekule.Editor=Kekule.ChemWidget.Editor,Kekule.Editor.CoordSys=Kekule.Render.CoordSystem,Kekule.Editor.BoxRegion={OUTSIDE:0,CORNER_TL:1,CORNER_TR:2,CORNER_BL:3,CORNER_BR:4,EDGE_TOP:11,EDGE_LEFT:12,EDGE_BOTTOM:13,EDGE_RIGHT:14,INSIDE:20},Kekule.Editor.SelectMode={RECT:0,POLYGON:1,POLYLINE:2,ANCESTOR:10},Kekule.globalOptions.add("chemWidget.editor",{enableIssueCheck:!0,enableCreateNewDoc:!0,enableOperHistory:!0,enableOperContext:!0,initOnNewDoc:!0,enableSelect:!0,enableMove:!0,enableResize:!0,enableAspectRatioLockedResize:!0,enableRotate:!0,enableGesture:!0}),Kekule.globalOptions.add("chemWidget.editor.issueChecker",{enableAutoIssueCheck:!0,enableAutoScrollToActiveIssue:!0,enableIssueMarkerHint:!0,durationLimit:50}),Kekule.Editor.BaseEditor=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.Editor.BaseEditor",BINDABLE_TAG_NAMES:["div","span"],OBSERVING_GESTURES:["rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout"],initialize:function(e,t,r,i){this._objSelectFlag=0,this._objectUpdateFlag=0,this._objectManipulateFlag=0,this._uiMarkerUpdateFlag=0,this._updatedObjectDetails=[],this._operatingObjs=[],this._operatingRenderers=[],this._initialRenderTransformParams=null,this._objChanged=!1,this._lengthCaches={};var n=Kekule.globalOptions.get;this.setPropStoreFieldValue("enableIssueCheck",n("chemWidget.editor.enableIssueCheck",!0)),this.setPropStoreFieldValue("enableCreateNewDoc",n("chemWidget.editor.enableCreateNewDoc",!0)),this.setPropStoreFieldValue("enableOperHistory",n("chemWidget.editor.enableOperHistory",!0)),this.setPropStoreFieldValue("enableOperContext",n("chemWidget.editor.enableOperContext",!0)),this.setPropStoreFieldValue("initOnNewDoc",n("chemWidget.editor.initOnNewDoc",!0)),this.tryApplySuper("initialize",[e,t,r]),!this.getChemObj()&&this.getInitOnNewDoc()&&this.getEnableCreateNewDoc()&&this.newDoc(),this.setPropStoreFieldValue("editorConfigs",i||this.createDefaultConfigs()),Kekule.ObjUtils.isUnset(this.getEnableGesture())&&this.setEnableGesture(n("chemWidget.editor.enableGesture",!0))},initProperties:function(){this.defineProp("editorConfigs",{dataType:"Kekule.Editor.BaseEditorConfigs",serializable:!1,getter:function(){return this.getDisplayerConfigs()},setter:function(e){return this.setDisplayerConfigs(e)}}),this.defineProp("defBondLength",{dataType:DataType.FLOAT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("defBondLength");return e||(e=this.getEditorConfigs().getStructureConfigs().getDefBondLength()),e}}),this.defineProp("defBondScreenLength",{dataType:DataType.FLOAT,serializable:!1,setter:null,getter:function(){var e=this._lengthCaches.defBondScreenLength;if(e)return e;var t=this.getDefBondLength()||0,r=this.translateDistance(t,Kekule.Render.CoordSystem.CHEM,Kekule.Render.CoordSystem.SCREEN);return this._lengthCaches.defBondScreenLength=r,r}}),this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:!1,setter:null,getter:function(){var e=this.getCurrPointerType();return this.getInteractionBoundInflation(e)}}),this.defineProp("currPointerType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("operHistory");return e||(e=new Kekule.OperationHistory,this.setPropStoreFieldValue("operHistory",e),e.addEventListener("push",this.reactOperHistoryPush,this),e.addEventListener("pop",this.reactOperHistoryPop,this),e.addEventListener("undo",this.reactOperHistoryUndo,this),e.addEventListener("redo",this.reactOperHistoryRedo,this),e.addEventListener("clear",this.reactOperHistoryClear,this),e.addEventListener("change",this.reactOperHistoryChange,this)),e},setter:null}),this.defineProp("operationsInCurrManipulation",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,serializable:!1}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("selection");return e||(e=[],this.setPropStoreFieldValue("selection",e)),e},setter:function(e){this.setPropStoreFieldValue("selection",e),this.selectionChanged()}}),this.defineProp("selectMode",{dataType:DataType.INT,getter:function(){var e=this.getPropStoreFieldValue("selectMode");return Kekule.ObjUtils.isUnset(e)&&(e=Kekule.Editor.SelectMode.RECT),e},setter:function(e){this.getSelectMode()!==e&&(this.setPropStoreFieldValue("selectMode",e),this.hideSelectingMarker())}}),this.defineProp("isToggleSelectOn",{dataType:DataType.BOOL}),this.defineProp("hotTrackedObjs",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=e?Kekule.ArrayUtils.toArray(e):[];if(this.getEditorConfigs()&&this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){var r;if(this.setPropStoreFieldValue("hotTrackedObjs",t),t&&t.length){r=[];for(var i=0,n=t.length;i<n;++i){var o=this.getBoundInfoRecorder().getBound(this.getObjContext(),t[i]);r&&Kekule.ArrayUtils.pushUnique(r,o)}}r?this.changeHotTrackMarkerBounds(r):this.getUiHotTrackMarker().getVisible()&&this.hideHotTrackMarker()}}}),this.defineProp("hotTrackedObj",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getHotTrackedObjs()&&this.getHotTrackedObjs()[0]},setter:function(e){this.setHotTrackedObjs(e)}}),this.defineProp("hoveredBasicObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("enableOperContext",{dataType:DataType.BOOL,setter:function(e){if(this.setPropStoreFieldValue("enableOperContext",!!e),!e){var t=this.getPropStoreFieldValue("operContext"),r=this.getPropStoreFieldValue("drawBridge");r&&t&&r.releaseContext(t)}}}),this.defineProp("issueCheckExecutor",{dataType:"Kekule.IssueCheck.Executor",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("issueCheckExecutor");if(!e){e=this.createIssueCheckExecutor();var t=this;e.addEventListener("execute",function(e){t.setIssueCheckResults(e.checkResults)}),this.setPropStoreFieldValue("issueCheckExecutor",e)}return e}}),this.defineProp("issueCheckerIds",{dataType:DataType.ARRAY,getter:function(){return this.getIssueCheckExecutor().getCheckerIds()},setter:function(e){this.getIssueCheckExecutor().setCheckerIds(e)}}),this.defineProp("enableIssueCheck",{dataType:DataType.BOOL,getter:function(){return this.getIssueCheckExecutor().getEnabled()},setter:function(e){this.getIssueCheckExecutor().setEnabled(!!e),e||this.setIssueCheckResults(null)}}),this.defineProp("issueCheckDurationLimit",{dataType:DataType.NUMBER,getter:function(){return this.getIssueCheckExecutor().getDurationLimit()},setter:function(e){this.getIssueCheckExecutor().setDurationLimit(e)}}),this.defineProp("enableAutoIssueCheck",{dataType:DataType.BOOL,setter:function(e){!!e!==this.getEnableAutoIssueCheck()&&(this.setPropStoreFieldValue("enableAutoIssueCheck",!!e),e&&this.checkIssues(),this.setShowAllIssueMarkers(!!e))}}),this.defineProp("issueCheckResults",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=this.getActiveIssueCheckResult();this.setPropStoreFieldValue("issueCheckResults",e),t&&(e||[]).indexOf(t)<0&&this.setPropStoreFieldValue("activeIssueCheckResult",null),this.issueCheckResultsChanged()}}),this.defineProp("activeIssueCheckResult",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getActiveIssueCheckResult()!==e&&(this.setPropStoreFieldValue("activeIssueCheckResult",e),e&&this.deselectAll(),this.issueCheckResultsChanged())}}),this.defineProp("enableAutoScrollToActiveIssue",{dataType:DataType.BOOL}),this.defineProp("showAllIssueMarkers",{dataType:DataType.BOOL,setter:function(e){!!e!==this.getShowAllIssueMarkers()&&(this.setPropStoreFieldValue("showAllIssueMarkers",!!e),this.recalcIssueCheckUiMarkers())}}),this.defineProp("enableIssueMarkerHint",{dataType:DataType.BOOL}),this.defineProp("enableGesture",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this.getEnableGesture()!==t&&(this.setPropStoreFieldValue("enableGesture",t),t?this.startObservingGestureEvents(this.OBSERVING_GESTURES):this.stopObservingGestureEvents(this.OBSERVING_GESTURES))}}),this.defineProp("uiEventReceiverElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("operContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("uiContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objContext",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){return this.getDrawContext()}}),this.defineProp("operContext",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){if(this.getEnableOperContext()){var e=this.getPropStoreFieldValue("operContext");if(!e){var t=this.getDrawBridge();if(t){var r=this.getOperContextParentElem();if(!r)return null;var i=Kekule.HtmlElementUtils.getElemScrollDimension(r);e=t.createContext(r,i.width,i.height),this.setPropStoreFieldValue("operContext",e)}}return e}return null}}),this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("uiContext");if(!e){var t=this.getUiDrawBridge();if(t){var r=this.getUiContextParentElem();if(!r)return null;var i=Kekule.HtmlElementUtils.getElemScrollDimension(r);e=t.createContext(r,i.width,i.height),this.setPropStoreFieldValue("uiContext",e)}}return e}}),this.defineProp("objDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){return this.getDrawBridge()}}),this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiDrawBridge");return e||this.__$uiDrawBridgeInitialized$__||(this.__$uiDrawBridgeInitialized$__=!0,e=this.createUiDrawBridge(),this.setPropStoreFieldValue("uiDrawBridge",e)),e}}),this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiPainter");if(!e){var t=this.getUiMarkers();return(e=new Kekule.Render.ChemObjPainter(Kekule.Render.RendererType.R2D,t,this.getUiDrawBridge())).setCanModifyTargetObj(!0),this.setPropStoreFieldValue("uiPainter",e),e}return e}}),this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,setter:null,getter:function(){var e=this.getUiPainter();return e?(e.getRenderer()||e.prepareRenderer(),e.getRenderer()||null):null}}),this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiMarkers");return e||(e=new Kekule.ChemWidget.UiMarkerCollection,this.setPropStoreFieldValue("uiMarkers",e)),e}}),this._defineUiMarkerProp("uiHotTrackMarker"),this._defineUiMarkerProp("uiSelectionAreaMarker"),this._defineUiMarkerProp("uiSelectingMarker"),this._defineIssueCheckUiMarkerGroupProps(),this.defineProp("uiSelectionAreaContainerBox",{dataType:DataType.Object,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("objRendererMap",{dataType:"Kekule.MapEx",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("objRendererMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("objRendererMap",e)),e}}),this.defineProp("zoomCenter",{dataType:DataType.HASH})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setOperationsInCurrManipulation([]);var e=Kekule.IssueCheck.CheckerIds,t=Kekule.globalOptions.get;this.setEnableAutoIssueCheck(t("chemWidget.editor.issueChecker.enableAutoIssueCheck",!0)),this.setEnableAutoScrollToActiveIssue(t("chemWidget.editor.issueChecker.enableAutoScrollToActiveIssue",!0)),this.setIssueCheckerIds(t("chemWidget.editor.issueChecker.issueCheckerIds",[e.ATOM_VALENCE,e.BOND_ORDER,e.NODE_DISTANCE_2D])),this.setIssueCheckDurationLimit(t("chemWidget.editor.issueChecker.durationLimit")||null),this.setEnableIssueMarkerHint(t("chemWidget.editor.issueChecker.enableIssueMarkerHint")||this.getEnableAutoIssueCheck())},_defineUiMarkerProp:function(e,t){return this.defineProp(e,{dataType:"Kekule.ChemWidget.AbstractUIMarker",serializable:!1,getter:function(){var t=this.getPropStoreFieldValue(e);return t||(t=this.createShapeBasedMarker(e,null,null,!1)),t},setter:function(r){t||(t=this.getUiMarkers());var i=this.getPropValue(e);i&&(t.removeMarker(i),i.finalize()),t.addMarker(r),this.setPropStoreFieldValue(e,r)}})},_defineIssueCheckUiMarkerGroupProps:function(e){for(var t=Kekule.ErrorLevel,r=function(e,r){return e+"_"+t.levelToString(r)},i="issueCheckUiMarker",n=[t.ERROR,t.WARNING,t.NOTE,t.LOG],o=0,a=n.length;o<a;++o){var s=r(i,n[o]);this._defineUiMarkerProp(s,e)}this._defineUiMarkerProp(i+"_active",e),this["get"+i.upperFirst()]=function(e){var t=r(i,e);return this.getPropValue(t)},this["set"+i.upperFirst()]=function(e,t){var n=r(i,e);return this.setPropValue(n,t)},this["getActive"+i.upperFirst()]=function(){return this.getPropValue(i+"_active")},this["getAll"+i.upperFirst()+"s"]=function(){for(var e=[],t=0,r=n.length;t<r;++t)e.push(this.getIssueCheckUiMarker(n[t]));var i=this.getActiveIssueCheckUiMarker();return i&&e.push(i),e}},doFinalize:function(){var e=this.getPropStoreFieldValue("operHistory");e&&(e.finalize(),this.setPropStoreFieldValue("operHistory",null));var t=this.getPropStoreFieldValue("objDrawBridge"),r=this.getPropStoreFieldValue("operContext");t&&r&&t.releaseContext(r),this.setPropStoreFieldValue("operContext",null);t=this.getPropStoreFieldValue("uiDrawBridge"),r=this.getPropStoreFieldValue("uiContext");t&&r&&t.releaseContext(r),this.setPropStoreFieldValue("uiDrawBridge",null),this.setPropStoreFieldValue("uiContext",null);var i=this.getPropStoreFieldValue("objRendererMap");i&&i.finalize(),this.setPropStoreFieldValue("objRendererMap",null);var n=this.getPropStoreFieldValue("issueCheckExecutor");n&&n.finalize(),this.setPropStoreFieldValue("issueCheckExecutor",null),this.tryApplySuper("doFinalize")},elementBound:function(e){this.setObserveElemResize(!0)},createDefaultConfigs:function(){return new Kekule.Editor.BaseEditorConfigs},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=e.createElement("div");return r.className=o.EDITOR_CLIENT,t.appendChild(r),this._editClientElem=r,[r]},getCoreElement:function(){return this._editClientElem||this.tryApplySuper("getCoreElement")},getEditClientElem:function(){return this._editClientElem},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+o.EDITOR;return e+=" "+(this.getRenderType()===Kekule.Render.RendererType.R3D?o.EDITOR3D:o.EDITOR2D)},doBindElement:function(e){this.createContextParentElems(),this.createUiEventReceiverElem()},doGetInitialZoom:function(){var e,t=this.getEditorConfigs();return t&&(e=t.getInteractionConfigs().getEditorInitialZoom()),e||(e=this.tryApplySuper("doGetInitialZoom")),e},doSetInitialZoom:function(e){var t=this.getEditorConfigs();t&&t.getInteractionConfigs().setEditorInitialZoom(e),this.tryApplySuper("doSetInitialZoom",[e])},zoomTo:function(e,t,r){var i=Kekule.CoordUtils,n=this.getCurrZoom(),o=e,a=this.tryApplySuper("zoomTo",[e,t]),s=this.getElement(),l={x:s.scrollLeft,y:s.scrollTop};r||(r=this.getZoomCenter()),r||(r=i.add(l,{x:s.clientWidth/2,y:s.clientHeight/2}));var u=i.multiply(r,o/n-1);return s.scrollLeft+=u.x,s.scrollTop+=u.y,a},changeClientSize:function(e,t,r){this._initialRenderTransformParams=null;var i=this.getCoreElement().style;r||(r=1);var n=e*r,o=t*r;n&&(i.width=n+"px"),o&&(i.height=o+"px");for(var a=[this.getObjContext(),this.getOperContext(),this.getUiContext()],s=0,l=a.length;s<l;++s){var u=a[s];u&&this.getDrawBridge().setContextDimension(u,n,o)}this.repaint()},getVisibleClientScreenBox:function(){var e=this.getEditClientElem().parentNode,t=Kekule.HtmlElementUtils.getElemClientDimension(e),r=this.getClientScrollPosition();return t.x1=r.x,t.y1=r.y,t.x2=t.x1+t.width,t.y2=t.y1+t.height,t},getVisibleClientBoxOfSys:function(e){var t=this.getVisibleClientScreenBox(),r=Kekule.BoxUtils.getMinMaxCoords(t),i=this.translateCoord(r.min,Kekule.Editor.CoordSys.SCREEN,e),n=this.translateCoord(r.max,Kekule.Editor.CoordSys.SCREEN,e);return Kekule.BoxUtils.createBox(i,n)},getVisibleClientObjBox:function(e){return this.getVisibleClientBoxOfSys(Kekule.Editor.CoordSys.CHEM)},isDirty:function(){return this.getEnableOperHistory()?this.getOperHistory().getCurrIndex()>=0:this._objChanged},getChemObjSrcInfo:function(e){return this.isDirty()?null:e.getSrcInfo?e.getSrcInfo():null},getActualDrawOptions:function(){var e=this.tryApplySuper("getActualDrawOptions");if(this._initialRenderTransformParams){var t=Object.extend({},this._initialRenderTransformParams);return t=Object.extend(t,e)}return e},repaint:function(e){var t=e,r=this.tryApplySuper("repaint",[t]);return this.isRenderable()&&(this._initialRenderTransformParams||(this._initialRenderTransformParams=this.getPainter().getActualInitialRenderTransformOptions(this.getObjContext())),this.recalcUiMarkers()),r},newDoc:function(){this.load(this.doCreateNewDocObj())},doCreateNewDocObj:function(){return new Kekule.Molecule},getExportableClasses:function(){var e=this.getChemObj();return e&&e.getClass?[e.getClass()]:[]},exportObj:function(e){return this.exportObjs(e)[0]},exportObjs:function(e){var t=this.getChemObj();return e?t&&t instanceof e?[t]:[]:[t]},doLoad:function(e){this.deselectAll(),this._initialRenderTransformParams=null,this.getObjRendererMap().clear(),this.getOperHistory()&&this.getOperHistory().clear(),this.tryApplySuper("doLoad",[e]),this._objChanged=!1,this.setPropStoreFieldValue("hoveredBasicObjs",null),this.setIssueCheckResults(null),this.requestAutoCheckIssuesIfNecessary()},doLoadEnd:function(e){this.tryApplySuper("doLoadEnd"),e||(this._initialRenderTransformParams=null)},doResize:function(){this._initialRenderTransformParams=null,this.tryApplySuper("doResize")},geometryOptionChanged:function(){var e=this.getDrawOptions().zoom;this.zoomChanged(e),this._clearLengthCaches(),this.tryApplySuper("geometryOptionChanged")},zoomChanged:function(e){},_clearLengthCaches:function(){this._lengthCaches={}},chemObjChanged:function(e,t){this.tryApplySuper("chemObjChanged",[e,t]),e!==t&&(t&&this._uninstallChemObjEventListener(t),e&&this._installChemObjEventListener(e))},_installChemObjEventListener:function(e){e.addEventListener("change",this.reactChemObjChange,this)},_uninstallChemObjEventListener:function(e){e.removeEventListener("change",this.reactChemObjChange,this)},createUiEventReceiverElem:function(){var e=this.getCoreElement();if(e){var t=e.ownerDocument.createElement("div");return t.className=o.EDITOR_UIEVENT_RECEIVER,e.appendChild(t),r.addClass(t,n.DYN_CREATED),this.setPropStoreFieldValue("uiEventReceiverElem",t),t}},createContextParentElems:function(){var e=this.getCoreElement();if(e){var t=e.ownerDocument;this._createContextParentElem(t,e,"objContextParentElem"),this._createContextParentElem(t,e,"operContextParentElem"),this._createContextParentElem(t,e,"uiContextParentElem")}},_createContextParentElem:function(e,t,r){var i=e.createElement("div");return i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.className=r+" "+n.DYN_CREATED,this.setPropStoreFieldValue(r,i),t.appendChild(i),i},createNewPainter:function(e){var t=this.tryApplySuper("createNewPainter",[e]);return t&&(t.setCanModifyTargetObj(!0),this.installPainterEventHandlers(t)),t},getDrawContextParentElem:function(){return this.getObjContextParentElem()},createUiDrawBridge:function(){var e=Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!e){var t=Kekule.Render.DrawBridge2DMananger.getUnavailableMessage()||Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));t&&this.reportException(t,Kekule.ExceptionLevel.NOT_FATAL_ERROR)}return e},changeContextDimension:function(e){var t=this.tryApplySuper("changeContextDimension",[e]);return t&&(this._resizeContext(this.getOperContext(),this.getObjDrawBridge(),e.width,e.height),this._resizeContext(this.getUiContext(),this.getUiDrawBridge(),e.width,e.height)),t},_clearSpecContext:function(e,t){t&&e&&t.clearContext(e)},_renderSpecContext:function(e,t){t&&e&&t.renderContext(e)},clearObjContext:function(){this._clearSpecContext(this.getObjContext(),this.getDrawBridge()),this.getBoundInfoRecorder()&&this.getBoundInfoRecorder().clear(this.getObjContext())},clearOperContext:function(){this._clearSpecContext(this.getOperContext(),this.getDrawBridge())},clearUiContext:function(){this._clearSpecContext(this.getUiContext(),this.getUiDrawBridge())},clearContext:function(){this.clearObjContext(),this._operatingRenderers&&this.clearOperContext()},repaintOperContext:function(e){if(this._operatingRenderers&&this._operatingObjs){this.clearOperContext();try{var t={partialDrawObjs:this._operatingObjs,doNotClear:!0};this.repaint(t)}finally{this._renderSpecContext(this.getOperContext(),this.getDrawBridge())}}},getOperatingRenderers:function(){return this._operatingRenderers||(this._operatingRenderers=[]),this._operatingRenderers},setOperatingRenderers:function(e){this._operatingRenderers=e},installPainterEventHandlers:function(e){e.addEventListener("prepareDrawing",this.reactChemObjPrepareDrawing,this),e.addEventListener("clear",this.reactChemObjClear,this)},reactChemObjPrepareDrawing:function(e){var r=e.context,i=e.obj;if(i&&(r===this.getObjContext()||r===this.getOperContext())){var n=e.target;if(this.getObjRendererMap().set(i,n),this.getEnableOperContext()){for(var o=this._operatingObjs||[],a=!1,s=0,l=o.length;s<l;++s)if(this._isChemObjDirectlyRenderedByRenderer(this.getObjContext(),o[s],n)){a=!0;break}a&&(this._setRendererToOperContext(n),t.pushUnique(this.getOperatingRenderers(),n))}}},reactChemObjClear:function(e){var r=e.context,i=e.obj;if(i&&(r===this.getObjContext()||r===this.getOperContext())){var n=e.target;this.getObjRendererMap().remove(i),t.remove(this.getOperatingRenderers(),n)}},reactChemObjChange:function(e){var t=e.target,r=e.changedPropNames||[];!(r=Kekule.ArrayUtils.exclude(r,["id","owner","ownedObjs"])).length&&e.changedPropNames||this.objectChanged(t,r)},reactOperHistoryPush:function(e){this.invokeEvent("operPush",e)},reactOperHistoryPop:function(e){this.invokeEvent("operPop",e)},reactOperHistoryUndo:function(e){this.invokeEvent("operUndo",e),this.notifyUserModificationDone()},reactOperHistoryRedo:function(e){this.invokeEvent("operRedo",e),this.notifyUserModificationDone()},reactOperHistoryClear:function(e){this.invokeEvent("operHistoryClear",e)},reactOperHistoryChange:function(e){this.invokeEvent("operChange",e)},beginUpdateObject:function(){this._objectUpdateFlag>=0&&this.invokeEvent("beginUpdateObject"),--this._objectUpdateFlag},endUpdateObject:function(){++this._objectUpdateFlag,this.isUpdatingObject()||(this._updatedObjectDetails&&this._updatedObjectDetails.length&&(this.objectsChanged(this._updatedObjectDetails),this._updatedObjectDetails=[]),this._execAfterUpdateObjectProcs(),this.invokeEvent("endUpdateObject"))},isUpdatingObject:function(){return this._objectUpdateFlag<0},_registerAfterUpdateObjectProc:function(e){this.isUpdatingObject()?(this.endUpdateObject.suspendedProcs||(this.endUpdateObject.suspendedProcs=[]),this.endUpdateObject.suspendedProcs.push(e)):e.apply(this)},_execAfterUpdateObjectProcs:function(){var e=this.endUpdateObject.suspendedProcs;if(e)for(;e.length;){var t=e.shift();t&&t.apply(this)}},_mergeObjUpdatedDetails:function(e,t){for(var r=0,i=t.length;r<i;++r)this._mergeObjUpdatedDetailItem(e,t[r])},_mergeObjUpdatedDetailItem:function(e,t){for(var r=0,i=e.length;r<i;++r){var n=e[r];if(n.obj===t.obj)return n.propNames||(n.propNames=[]),void(t.propNames&&Kekule.ArrayUtils.pushUnique(n.propNames,t.propNames))}e.push(t)},_logUpdatedDetail:function(e){var t="";e.forEach(function(e){t+="Obj: "+e.obj.getId()+"["+e.obj.getClassName()+"]     ",t+="Props: ["+e.propNames.join(", ")+"]",t+="\n"}),console.log(t)},objectChanged:function(e,t){var r={obj:e,propNames:t},i=this.objectsChanged(r);return this.invokeEvent("editObjChanged",Object.extend({},r)),i},objectsChanged:function(e){var r=DataType.isArrayValue(e)?e:[e];if(this.isUpdatingObject())this._mergeObjUpdatedDetails(this._updatedObjectDetails,r);else{var i=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(r);this.doObjectsChanged(r,i),this.requestAutoCheckIssuesIfNecessary(),this.invokeEvent("editObjsUpdated",{details:Object.extend({},e)})}this._objChanged=!0,this.invokeEvent("editObjsChanged",{details:Object.extend({},e)});var n=this.getSelection();if(n&&i){var o=t.intersect(n,i);o.length&&this.invokeEvent("selectedObjsUpdated",{objs:o})}},doObjectsChanged:function(e,t){var r=Kekule.ArrayUtils.clone(e);t||(t=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(r));var i=this._getAdditionalRenderRelatedObjs(t);if(i.length){var n=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(i);Kekule.ArrayUtils.pushUnique(r,n)}Kekule.ArrayUtils.pushUnique(t,i);var o=this._operatingRenderers,a=o&&this._isAllObjsRenderedByRenderers(this.getObjContext(),t,o);this.canModifyPartialGraphic()?(this.getRootRenderer().modify(this.getObjContext(),r),this.recalcUiMarkers()):a?this.repaintOperContext():this.repaint()},beginManipulateObject:function(){this._objectManipulateFlag>=0&&this.invokeEvent("beginManipulateObject"),--this._objectManipulateFlag},endManipulateObject:function(){++this._objectManipulateFlag,this.isManipulatingObject()||(this._objectManipulateFlag=0,this.doManipulationEnd(),this.requestAutoCheckIssuesIfNecessary())},isManipulatingObject:function(){return this._objectManipulateFlag<0},doManipulationEnd:function(){this.setOperationsInCurrManipulation([]),this.invokeEvent("endManipulateObject"),this.notifyUserModificationDone()},beginManipulateAndUpdateObject:function(){this.beginManipulateObject(),this.beginUpdateObject()},endManipulateAndUpdateObject:function(){this.endUpdateObject(),this.endManipulateObject()},notifyUserModificationDone:function(){this.invokeEvent("userModificationDone")},_needToCanonicalizeBeforeSaving:function(){return!0},_getAdditionalRenderRelatedObjs:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r],o=n.getCoordDeterminateObjects?n.getCoordDeterminateObjects():[];Kekule.ArrayUtils.pushUnique(t,o)}return t},_isAllObjsRenderedByRenderers:function(e,t,r){for(var i=0,n=t.length;i<n;++i){for(var o=t[i],a=!1,s=0,l=r.length;s<l;++s){if(r[s].isChemObjRenderedBySelf(e,o)){a=!0;break}}if(!a)return!1}return!0},prepareOperatingObjs:function(e){this._operatingRenderers&&this._operatingRenderers.length&&this.endOperatingObjs(!0),this.getEnableOperContext()&&(this._prepareRenderObjsInOperContext(e),this._operatingObjs=e),this.repaint()},endOperatingObjs:function(e){this.getEnableOperContext()&&(this._endRenderObjsInOperContext(),this._operatingObjs=null,e||this.repaint())},_isChemObjDirectlyRenderedByRenderer:function(e,t,r){var i=t.getStandaloneAncestor?t.getStandaloneAncestor():t;return r.isChemObjRenderedDirectlyBySelf(e,i)},_getStandaloneRenderObjsInOperContext:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r];n.getStandaloneAncestor&&(n=n.getStandaloneAncestor()),Kekule.ArrayUtils.pushUnique(t,n)}return t},_prepareRenderObjsInOperContext:function(e){for(var t=[],r=this.getObjRendererMap().getValues(),i=this.getObjContext(),n=this._getStandaloneRenderObjsInOperContext(e),o=0,a=n.length;o<a;++o)for(var s=n[o],l=0,u=r.length;l<u;++l){(d=r[l]).isChemObjRenderedDirectlyBySelf(i,s)&&Kekule.ArrayUtils.pushUnique(t,d)}if(t.length>0){for(o=0,a=t.length;o<a;++o){var d=t[o];this._setRendererToOperContext(d)}this._operatingRenderers=t}else this._operatingRenderers=null},_endRenderObjsInOperContext:function(){var e=this._operatingRenderers;if(e&&e.length){for(var t=0,r=e.length;t<r;++t){var i=e[t];this._unsetRendererToOperContext(i)}this.clearOperContext()}this._operatingRenderers=null},_setRendererToOperContext:function(e){e.setRedirectContext(this.getOperContext())},_unsetRendererToOperContext:function(e){e.setRedirectContext(null)},getInteractionBoundInflation:function(e){var t=this._lengthCaches.interactionBoundInflations,r=e||"default";if(t&&t[r])return t[r];var i,n=this.getEditorConfigs().getInteractionConfigs(),o=n.getPropValue("objBoundTrackInflationRatio");if(e){var a=e.upperFirst(),s="objBoundTrackInflationRatio"+a;n.hasProperty(s)&&(i=n.getPropValue(s))}var l,u=i||o,d=u&&this.getDefBondScreenLength()*u,c=n.getPropValue("objBoundTrackMinInflation");if(e){var h="objBoundTrackMinInflation"+a;n.hasProperty(h)&&(l=n.getPropValue(h))}var p=l||c,g=Math.max(d||0,p);return t||(t={},this._lengthCaches.interactionBoundInflations=t),t[r]=g,g},getBoundInfosAtCoord:function(e,t,r){var i=r||this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation();return this.tryApplySuper("getBoundInfosAtCoord",[e,t,i])},getTopmostBoundInfoAtCoord:function(e,t,r){if(!this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest())return this.tryApplySuper("getTopmostBoundInfoAtCoord",[e,t,r]);for(var i,n,o,a=Kekule.Render.MetaShapeUtils,s=this.getBoundInfosAtCoord(e,null,r),l=function(t,r,s){i=t,n=r||t.boundInfo,o=Kekule.ObjUtils.notUnset(s)?s:a.getDistance(e,n)},u=s.length-1;u>=0;--u){var d=s[u];if(!(t&&t.indexOf(d.obj)>=0))if(i){var c=d.boundInfo;if(c.shapeType<n.shapeType)l(d,c);else if(c.shapeType===n.shapeType){var h=a.getDistance(e,c);h<o&&l(d,c,h)}}else l(d)}return i},getBasicObjectsAtCoord:function(e,r,i,n){var o=this.getBoundInfosAtCoord(e,null,r),a=[];if(o){i&&(o=t.filter(o,function(e){var t=o[u].obj;return!!t&&!(t&&i&&i.indexOf(t)>=0)}));var s=function(e){return e&&e.getCoordStickTarget&&e.getCoordStickTarget()?1:0};if(o.sort(function(e,t){return s(e.obj)-s(t.obj)}),this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest()){var l=Kekule.Render.MetaShapeUtils;o.sort(function(t,r){var i=0,n=t.boundInfo,o=r.boundInfo;(i=-(n.shapeType-o.shapeType))||(i=-(l.getDistance(e,n)-l.getDistance(e,o)));return i})}for(var u=o.length-1;u>=0;--u){var d=o[u].obj;d&&i&&i.indexOf(d)>=0||a.push(d)}a&&n&&(a=t.filter(a,function(e){for(var t=0,r=n.length;t<r;++t)if(e instanceof n[t])return!0;return!1}))}return a},getTopmostBasicObjectAtCoord:function(e,t,r){var i=this.getBasicObjectsAtCoord(e,t,null,r);return i&&i[0]},getChemObjBounds:function(e,t){var r=[],i=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),e);if(i&&i.length)for(var n=0,o=i.length;n<o;++n){var a=i[n].boundInfo;a&&(a=Kekule.Render.MetaShapeUtils.inflateShape(a,t),r.push(a))}return r},getUiMarkersAtCoord:function(e,t,r){for(var i=this.getUiMarkers(),n=r&&r.length?function(e){for(var t=0,i=r.length;t<i;++t)if(e instanceof r[t])return!0;return!1}:null,o=Kekule.Render.MetaShapeUtils,a=[],s=i.getMarkerCount()-1;s>=0;--s){var l=i.getMarkerAt(s);if(l.getVisible()&&(!n||n(l))){var u=l.shapeInfo;o.isCoordInside(e,u,t)&&a.push(l)}}return a},beginUpdateUiMarkers:function(){--this._uiMarkerUpdateFlag},endUpdateUiMarkers:function(){++this._uiMarkerUpdateFlag,this.isUpdatingUiMarkers()||this.repaintUiMarker()},isUpdatingUiMarkers:function(){return this._uiMarkerUpdateFlag<0},recalcUiMarkers:function(){if(this.getUiDrawBridge()){this.beginUpdateUiMarkers();try{this.recalcHotTrackMarker(),this.recalcSelectionAreaMarker(),this.recalcIssueCheckUiMarkers()}finally{this.endUpdateUiMarkers()}}},repaintUiMarker:function(){if(!this.isUpdatingUiMarkers()&&this.getUiDrawBridge()&&this.getUiContext()){this.clearUiContext();var e=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),e.baseCoord,e.drawOptions)}},createShapeBasedMarker:function(e,t,r,i){var n=new Kekule.ChemWidget.MetaShapeUIMarker;return t&&n.setShapeInfo(t),r&&n.setDrawStyles(r),this.setPropStoreFieldValue(e,n),this.getUiMarkers().addMarker(n),i&&this.repaintUiMarker(),n},modifyShapeBasedMarker:function(e,t,r,i){Kekule.Render.ObjectUpdateType.MODIFY;t&&e.setShapeInfo(t),r&&e.setDrawStyles(r),i&&this.repaintUiMarker()},hideUiMarker:function(e,t){e.setVisible(!1),t&&this.repaintUiMarker()},showUiMarker:function(e,t){e.setVisible(!0),t&&this.repaintUiMarker()},removeUiMarker:function(e){e&&(this.getUiMarkers().removeMarker(e),this.repaintUiMarker())},clearUiMarkers:function(){this.getUiMarkers().clearMarkers(),this.repaintUiMarker()},changeHotTrackMarkerBounds:function(e){for(var t=Kekule.ArrayUtils.toArray(e),r=this.getEditorConfigs().getUiMarkerConfigs(),i={color:r.getHotTrackerColor(),opacity:r.getHotTrackerOpacity()},n=this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation(),o=[],a=0,s=t.length;a<s;++a){var l=t[a],u=n?Kekule.Render.MetaShapeUtils.inflateShape(l,n):l;u&&o.push(u)}var d=this.getUiHotTrackMarker();return d.setVisible(!0),this.modifyShapeBasedMarker(d,o,i,!0),this},hideHotTrackMarker:function(){var e=this.getUiHotTrackMarker();return e&&this.hideUiMarker(e,!0),this},showHotTrackMarker:function(){var e=this.getUiHotTrackMarker();return e&&this.showUiMarker(e,!0),this},hotTrackOnCoord:function(e){return this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()&&this.setHotTrackedObj(this.getTopmostBasicObjectAtCoord(e,this.getCurrBoundInflation())),this},hotTrackOnObj:function(e){return this.setHotTrackedObj(e),this},hideHotTrack:function(e){return this.hideHotTrackMarker(),e||this.clearHotTrackedObjs(),this},clearHotTrackedObjs:function(){this.setHotTrackedObjs([])},addHotTrackedObj:function(e){var t=this.getHotTrackedObjs()||[];return Kekule.ArrayUtils.pushUnique(t,e),this.setHotTrackedObjs(t),this},recalcHotTrackMarker:function(){this.setHotTrackedObjs(this.getHotTrackedObjs())},updateHintForChemObject:function(e){var t=this.getEditClientElem();if(t){var r=e||"";r&&this.updateHintForChemObject._cache==r&&(r+="\f"),t.title=r,r&&(this.updateHintForChemObject._cache=r)}},getChemObjHint:function(e){return null},getChemObjsHint:function(e){for(var r=[],i=0,n=e.length;i<n;++i){var o=this.getChemObjHint(e[i]);o&&t.pushUnique(r,o)}var a=this._getChemObjsRelatedIssuesHints(e);return a.length&&t.pushUnique(r,a),r.length?r.join("\n"):null},_getChemObjsRelatedIssuesHints:function(e){var r=[];if(this.getEnableIssueMarkerHint()&&this.getEnableIssueCheck())for(var i=this.getObjectsRelatedIssueItems(e,!0)||[],n=0,o=i.length;n<o;++n){var a=i[n].getMessage();t.pushUnique(r,a)}return r},issueCheckResultsChanged:function(){this.recalcIssueCheckUiMarkers();var e=this.getActiveIssueCheckResult();if(e&&this.getEnableAutoScrollToActiveIssue()){var t=e.getTargets();if(t&&t.length){var r=this._getExposedSelfOrParentObjs(t);if(r&&r.length)this.getObjectsBoxAndClientBoxRelation(r)!==Kekule.IntersectionState.CONTAINED&&this.scrollClientToObject(r)}}},_needShowInactiveIssueMarkers:function(){return this.getEnableIssueCheck()&&this.getShowAllIssueMarkers()},recalcIssueCheckUiMarkers:function(){if(this.getChemObjLoaded()){this.beginUpdateUiMarkers();try{var e=this.getIssueCheckResults()||[];if(e.length&&this.getEnableIssueCheck()){var t=this._needShowInactiveIssueMarkers(),r=this.getActiveIssueCheckResult();this.getActiveIssueCheckUiMarker().setVisible(!!r);for(var i=this._groupUpIssueObjects(e,r,!0),n=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation(),o=Kekule.ErrorLevel.getAllLevels().concat("active"),a=0,s=o.length;a<s;++a){var l=[],u=o[a],d=i[u],c=d?d.level:u;if(d){var h="active"===u;if(h||t)for(var p=d.objs,g=0,f=p.length;g<f;++g)for(var C=p[g],m=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),C),T=0,E=m.length;T<E;++T){var _=m[T].boundInfo;_&&(_=Kekule.Render.MetaShapeUtils.inflateShape(_,n),l.push(_))}}this.changeIssueCheckUiMarkerBound(c,l,h)}}else this.hideIssueCheckUiMarkers()}finally{this.endUpdateUiMarkers()}}},changeIssueCheckUiMarkerBound:function(e,t,r){var i=r?this.getActiveIssueCheckUiMarker():this.getIssueCheckUiMarker(e);if(i)if(t&&t.length){var n=Kekule.ErrorLevel.levelToString(e),o=this.getEditorConfigs().getUiMarkerConfigs(),a=o.getIssueCheckMarkerColors()[n],s={strokeColor:r?a.activeStrokeColor:a.strokeColor,strokeWidth:r?o.getIssueCheckActiveMarkerStrokeWidth():o.getIssueCheckMarkerStrokeWidth(),fillColor:r?a.activeFillColor:a.fillColor,opacity:r?o.getIssueCheckActiveMarkerOpacity():o.getIssueCheckMarkerOpacity()};i.setVisible(!0),this.modifyShapeBasedMarker(i,t,s,!0)}else i.setVisible(!1);return this},_getExposedSelfOrParentObjs:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r];if(!n.isExposed||n.isExposed())t.push(n);else if(n.getExposedAncestor){var o=n.getExposedAncestor();o&&t.push(o)}}return t},_groupUpIssueObjects:function(e,r,i){for(var n={},o=0,a=e.length;o<a;++o){var s=e[o],l=s.getTargets(),u=s.getLevel();r&&s===r?n.active={level:u,objs:i?this._getExposedSelfOrParentObjs(l):l}:(n[u]||(n[u]={level:u,objs:[]}),n[u].objs=n[u].objs.concat(i?this._getExposedSelfOrParentObjs(l):l))}var d=Kekule.ErrorLevel,c=[d.LOG,d.NOTE,d.WARNING,d.ERROR,"active"];for(o=0,a=c.length;o<a;++o){var h=n[o]&&n[o].objs;if(h)for(var p=o+1,g=c.length;p<g;++p){var f=n[p]&&n[p].objs;if(f){var C=t.exclude(h,f);n[o].objs=C}}}return n},hideIssueCheckUiMarkers:function(){for(var e=this.getAllIssueCheckUiMarkers()||[],t=0,r=e.length;t<r;++t)this.hideUiMarker(e[t])},isObjectRelatedToIssue:function(e,t,r){if((t.getTargets()||[]).indexOf(e)>=0)return!0;if(r){var i=e.getParent();return!!i&&this.isObjectRelatedToIssue(i,t,r)}},getObjectIssueItems:function(e,t){var r=this.getIssueCheckResults()||[];if(r.length&&this.getEnableIssueCheck()){for(var i=[],n=0,o=r.length;n<o;++n){var a=r[n];this.isObjectRelatedToIssue(e,a,t)&&i.push(a)}return i}return[]},getObjectsRelatedIssueItems:function(e,r){if(!(this.getIssueCheckResults()||[]).length||!this.getEnableIssueCheck())return[];var i=[],n=[].concat(e);if(r)for(var o=0,a=e.length;o<a;++o)t.pushUnique(n,e[o].getParentList());for(o=0,a=n.length;o<a;++o){var s=this.getObjectIssueItems(n[o],!1);t.pushUnique(i,s)}return i},changeSelectionAreaMarkerBound:function(e,t){var r=this.getEditorConfigs().getUiMarkerConfigs();t||(t={strokeColor:r.getSelectionMarkerStrokeColor(),strokeWidth:r.getSelectionMarkerStrokeWidth(),fillColor:r.getSelectionMarkerFillColor(),opacity:r.getSelectionMarkerOpacity()});var i=this.getUiSelectionAreaMarker();return i&&(i.setVisible(!0),this.modifyShapeBasedMarker(i,e,t,!0)),this},hideSelectionAreaMarker:function(){var e=this.getUiSelectionAreaMarker();e&&this.hideUiMarker(e,!0)},showSelectionAreaMarker:function(){var e=this.getUiSelectionAreaMarker();e&&this.showUiMarker(e,!0)},recalcSelectionAreaMarker:function(e){this.beginUpdateUiMarkers();try{var t=this.getSelection(),r=t.length;if(r<=0)this.hideSelectionAreaMarker();else{for(var i=[],n=null,o=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation(),a=0;a<r;++a){var s=t[a],l=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),s);if(l&&l.length)for(var u=0,d=l.length;u<d;++u){var c=l[u].boundInfo;if(c){c=Kekule.Render.MetaShapeUtils.inflateShape(c,o),i.push(c);var h=Kekule.Render.MetaShapeUtils.getContainerBox(c);n=n?Kekule.BoxUtils.getContainerBox(n,h):h}}}if(this.setUiSelectionAreaContainerBox(n),n){var p=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:n.x1,y:n.y1},{x:n.x2,y:n.y2}]);i.push(p)}else this.hideSelectionAreaMarker();i.length&&this.changeSelectionAreaMarkerBound(i)}}finally{this.endUpdateUiMarkers()}},_highlightSelectionAreaMarker:function(){var e=this.getEditorConfigs().getUiMarkerConfigs(),t={strokeColor:e.getSelectionMarkerStrokeColor(),strokeWidth:e.getSelectionMarkerStrokeWidth(),fillColor:e.getSelectionMarkerFillColor(),opacity:e.getSelectionMarkerEmphasisOpacity()};this.changeSelectionAreaMarkerBound(null,t)},_restoreSelectionAreaMarker:function(){var e=this.getEditorConfigs().getUiMarkerConfigs(),t={strokeColor:e.getSelectionMarkerStrokeColor(),strokeWidth:e.getSelectionMarkerStrokeWidth(),fillColor:e.getSelectionMarkerFillColor(),opacity:e.getSelectionMarkerOpacity()};this.changeSelectionAreaMarkerBound(null,t)},pulseSelectionAreaMarker:function(e,t){if(this.getUiSelectionAreaMarker()){if(e||(e=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseDuration()||0),t||(t=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseCount()||1),!e)return;var r=e/t;this.doPulseSelectionAreaMarker(r,t)}return this},doPulseSelectionAreaMarker:function(e,t){this._highlightSelectionAreaMarker(),setTimeout(this._restoreSelectionAreaMarker.bind(this),e),t>1&&setTimeout(this.doPulseSelectionAreaMarker.bind(this,e,t-1),2*e)},startSelecting:function(e,t){void 0===t&&(t=this.getIsToggleSelectOn()),t||this.deselectAll();var r=Kekule.Editor.SelectMode,i=this.getSelectMode();return this._currSelectMode=i,i===r.POLYLINE||i===r.POLYGON?this.startSelectingCurveDrag(e,t):this.startSelectingBoxDrag(e,t)},addSelectingAnchorCoord:function(e){var t=Kekule.Editor.SelectMode,r=this._currSelectMode;return r===t.POLYLINE||r===t.POLYGON?this.dragSelectingCurveToCoord(e):this.dragSelectingBoxToCoord(e)},endSelecting:function(e,t){void 0===t&&(t=this.getIsToggleSelectOn());var r,i=Kekule.Editor.SelectMode,n=this._currSelectMode,o=this.getEditorConfigs().getInteractionConfigs().getEnablePartialAreaSelecting();if(n===i.POLYLINE||n===i.POLYGON){var a=this._selectingCurveCoords,s=this.getEditorConfigs().getInteractionConfigs().getSelectingCurveSimplificationDistanceThreshold(),l=Kekule.GeometryUtils.simplifyCurveToLineSegments(a,s);if(this.endSelectingCurveDrag(e,t),n===i.POLYLINE){var u=this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth();r=this.getObjectsIntersetExtendedPolyline(l,u)}else r=this.getObjectsInPolygon(l,o),this.endSelectingCurveDrag(e,t)}else{var d=this._selectingBoxStartCoord,c=Kekule.BoxUtils.createBox(d,e);r=this.getObjectsInScreenBox(c,o),this.endSelectingBoxDrag(e,t)}r=this._getActualSelectedObjsInSelecting(r),t?this.toggleSelectingState(r):this.select(r),this.hideSelectingMarker()},cancelSelecting:function(){this.hideSelectingMarker()},_getActualSelectedObjsInSelecting:function(e){return e&&e.length?(this._isInAncestorSelectMode()&&(e=this._getAllStandaloneAncestorObjs(e)),e):[]},_isInAncestorSelectMode:function(){return this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR},_getAllStandaloneAncestorObjs:function(e){for(var r=[],i=0,n=e.length;i<n;++i){var o=e[i];o&&o.getStandaloneAncestor&&(o=o.getStandaloneAncestor()),t.pushUnique(r,o)}return r},startSelectingBoxDrag:function(e,t){this._selectingBoxStartCoord=e},dragSelectingBoxToCoord:function(e){var t=this._selectingBoxStartCoord,r=e;this.changeSelectingMarkerBox(t,r)},endSelectingBoxDrag:function(e,t){this._selectingBoxStartCoord;this._selectingBoxEndCoord=e},startSelectingCurveDrag:function(e,t){this._selectingCurveCoords=[e]},dragSelectingCurveToCoord:function(e){this._selectingCurveCoords.push(e),this.changeSelectingMarkerCurve(this._selectingCurveCoords,this._currSelectMode===Kekule.Editor.SelectMode.POLYGON)},endSelectingCurveDrag:function(e,t){this._selectingCurveCoords.push(e)},selectOnCoord:function(e,t){void 0===t&&(t=this.getIsToggleSelectOn());var r=this.getTopmostBasicObjectAtCoord(e,this.getCurrBoundInflation());if(r){var i=this._getActualSelectedObjsInSelecting([r]);i&&(t?this.toggleSelectingState(i):this.select(i))}},changeSelectingMarkerBound:function(e,t){var r=this.getEditorConfigs().getUiMarkerConfigs();t||(t={strokeColor:r.getSelectingMarkerStrokeColor(),strokeWidth:r.getSelectingMarkerStrokeWidth(),strokeDash:r.getSelectingMarkerStrokeDash(),fillColor:r.getSelectingMarkerFillColor(),opacity:r.getSelectingMarkerOpacity()});var i=this.getUiSelectingMarker();return i.setVisible(!0),this.modifyShapeBasedMarker(i,e,t,!0),this},changeSelectingMarkerCurve:function(e,t){for(var r=[],i=0,n=e.length-1;i<n;++i)r.push(this.screenCoordToContext(e[i]));var o,a=Kekule.Render.MetaShapeUtils.createShapeInfo(t?Kekule.Render.MetaShapeType.POLYGON:Kekule.Render.MetaShapeType.POLYLINE,r);if(!t){var s=this.getEditorConfigs().getUiMarkerConfigs();o={strokeColor:s.getSelectingBrushMarkerStrokeColor(),strokeWidth:this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth(),strokeDash:s.getSelectingBrushMarkerStrokeDash(),lineCap:s.getSelectingBrushMarkerStrokeLineCap(),lineJoin:s.getSelectingBrushMarkerStrokeLineJoin(),opacity:s.getSelectingBrushMarkerOpacity()}}return this.changeSelectingMarkerBound(a,o)},changeSelectingMarkerBox:function(e,t){var r=this.screenCoordToContext(e),i=this.screenCoordToContext(t),n=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:Math.min(r.x,i.x),y:Math.min(r.y,i.y)},{x:Math.max(r.x,i.x),y:Math.max(r.y,i.y)}]);return this.changeSelectingMarkerBound(n)},hideSelectingMarker:function(){var e=this.getUiSelectingMarker();e&&this.hideUiMarker(e,!0)},showSelectingMarker:function(){var e=this.getUiSelectingMarker();e&&this.showUiMarker(e,!0)},getCoordRegionInSelectionMarker:function(e,t){var r=Kekule.Editor.BoxRegion,i=Kekule.CoordUtils,n=this.screenCoordToContext(e),o=this.getUiSelectionAreaMarker();if(o&&o.getVisible()){var a=this.getUiSelectionAreaContainerBox();Kekule.ObjUtils.isUnset(t)&&(t=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerEdgeInflation());var s=t/2||0,l=i.substract({x:a.x1,y:a.y1},{x:s,y:s}),u=i.add({x:a.x2,y:a.y2},{x:s,y:s});if(n.x<l.x||n.y<l.y||n.x>u.x||n.y>u.y)return r.OUTSIDE;var d=i.substract(n,l),c=i.substract(u,n),h=d.x,p=c.x,g=d.y,f=c.y;return g<f?h<p?g<=t?h<=t?r.CORNER_TL:r.EDGE_TOP:h<=t?r.EDGE_LEFT:r.INSIDE:g<=t?p<=t?r.CORNER_TR:r.EDGE_TOP:p<=t?r.EDGE_RIGHT:r.INSIDE:h<p?f<=t?h<=t?r.CORNER_BL:r.EDGE_BOTTOM:h<=t?r.EDGE_LEFT:r.INSIDE:f<=t?p<=t?r.CORNER_BR:r.EDGE_BOTTOM:p<=t?r.EDGE_RIGHT:r.INSIDE}return r.OUTSIDE},isCoordInSelectionMarkerBound:function(e){return this.getCoordRegionInSelectionMarker(e)!==Kekule.Editor.BoxRegion.OUTSIDE},getObjSelectedRenderOptions:function(){return this._selectedRenderOptions},_getObjRenderOptionItemAppendMethod:function(e){return this.getRenderType()===Kekule.Render.RendererType.R3D?e.addOverrideRender3DOptionItem:e.addOverrideRenderOptionItem},_getObjRenderOptionItemRemoveMethod:function(e){return this.getRenderType()===Kekule.Render.RendererType.R3D?e.removeOverrideRender3DOptionItem:e.removeOverrideRenderOptionItem},_addSelectRenderOptions:function(e){var t=this.getObjSelectedRenderOptions();return t?this._getObjRenderOptionItemAppendMethod(e).apply(e,[t]):null},_removeSelectRenderOptions:function(e){return this.getObjSelectedRenderOptions()?this._getObjRenderOptionItemRemoveMethod(e).apply(e,[this.getObjSelectedRenderOptions()]):null},beginUpdateSelection:function(){this.beginUpdateObject(),--this._objSelectFlag},endUpdateSelection:function(){++this._objSelectFlag,this._objSelectFlag>=0&&this.selectionChanged(),this.endUpdateObject()},isUpdatingSelection:function(){return this._objSelectFlag<0},selectionChanged:function(){if(!this.isUpdatingSelection())return this.notifyPropSet("selection",this.getSelection()),this.invokeEvent("selectionChange"),this.doSelectionChanged()},doSelectionChanged:function(){this.recalcSelectionAreaMarker()},isInSelection:function(e){return!!e&&this.getSelection().indexOf(e)>=0},addObjToSelection:function(e){if(!e)return this;var t=this.getSelection();return Kekule.ArrayUtils.pushUnique(t,e.getNearestSelectableObject()),this._addSelectRenderOptions(e),this.selectionChanged(),this},removeObjFromSelection:function(e,t){if(!e)return this;var r=this.getSelection(),i=e.getNearestSelectableObject&&e.getNearestSelectableObject();Kekule.ArrayUtils.remove(r,e),this._removeSelectRenderOptions(e),i&&(Kekule.ArrayUtils.remove(r,i),this._removeSelectRenderOptions(i));for(var n=r.length-1;n>=0;--n){var o=r[n];o.isChildOf&&(o.isChildOf(e)||i&&o.isChildOf(i))&&this.removeObjFromSelection(o,!0)}return t||this.selectionChanged(),this},selectAll:function(){var e=[],t=this.getChemObj();if(t){var r=t.getChildren()||[];e=r.length?r:[t]}return this.select(e)},deselectAll:function(){var e=this.getSelection();return this.removeFromSelection(e)},select:function(e){this.beginUpdateSelection();try{this.deselectAll(),this.addToSelection(e)}finally{this.endUpdateSelection()}return this},addToSelection:function(e){if(e){var t=DataType.isArrayValue(e)?e:[e];this.beginUpdateSelection();try{for(var r=0,i=t.length;r<i;++r)this.addObjToSelection(t[r])}finally{this.endUpdateSelection()}return this}},removeFromSelection:function(e){if(e){var t=DataType.isArrayValue(e)?e:[e];this.beginUpdateSelection();try{for(var r=t.length-1;r>=0;--r)this.removeObjFromSelection(t[r])}finally{this.endUpdateSelection()}return this}},toggleSelectingState:function(e){if(e){var t=DataType.isArrayValue(e)?e:[e];this.beginUpdateSelection();try{for(var r=0,i=t.length;r<i;++r){var n=t[r],o=n.getNearestSelectableObject&&n.getNearestSelectableObject();this.isInSelection(n)?this.removeObjFromSelection(n):o&&this.isInSelection(o)?this.removeObjFromSelection(o):this.addObjToSelection(n)}}finally{this.endUpdateSelection()}return this}},hasSelection:function(){return!!this.getSelection().length},deleteSelectedObjs:function(){},requestAutoCheckIssuesIfNecessary:function(){this.getEnableAutoIssueCheck()&&this._tryCheckIssueOnIdle()},_tryCheckIssueOnIdle:function(){return this.isUpdatingObject()||this.isManipulatingObject()?null:this.checkIssues()},createIssueCheckExecutor:function(){return new Kekule.IssueCheck.ExecutorForEditor(this)},checkIssues:function(e){var t=null,r=e||this.getChemObj();r&&this.getEnableIssueCheck()&&(t=this.getIssueCheckExecutor(!0).execute(r));return t},getObjectsIntersetExtendedPolyline:function(e,t){for(var r=[],i=0,n=e.length;i<n;++i)r.push(this.screenCoordToContext(e[i]));var o=[],a=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),s=Kekule.Render.MetaShapeUtils.isIntersectingPolyline;for(i=0,n=a.length;i<n;++i){var l=a[i],u=l.boundInfo;u&&s(u,r,t)&&o.push(l.obj)}return o},getObjectsInPolygon:function(e,t){for(var r=[],i=0,n=e.length;i<n;++i)r.push(this.screenCoordToContext(e[i]));var o=[],a=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),s=t?Kekule.Render.MetaShapeUtils.isIntersectingPolygon:Kekule.Render.MetaShapeUtils.isInsidePolygon;for(i=0,n=a.length;i<n;++i){var l=a[i],u=l.boundInfo;u&&s(u,r)&&o.push(l.obj)}return o},getObjectsInScreenBox:function(e,t){for(var r=this.screenBoxToContext(e),i=[],n=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),o=t?Kekule.Render.MetaShapeUtils.isIntersectingBox:Kekule.Render.MetaShapeUtils.isInsideBox,a=0,s=n.length;a<s;++a){var l=n[a],u=l.boundInfo;u&&o(u,r)&&i.push(l.obj)}return i},selectObjectsInScreenBox:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.select(r),r},addObjectsInScreenBoxToSelection:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.addToSelection(r),r},removeObjectsInScreenBoxFromSelection:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.removeFromSelection(r),r},toggleSelectingStateOfObjectsInScreenBox:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.toggleSelectingState(r),r},getObjectsContainerBox:function(e,t){for(var r=Kekule.ArrayUtils.toArray(e),i=t||0,n=null,o=0,a=r.length;o<a;++o){var s=r[o],l=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),s);if(l&&l.length)for(var u=0,d=l.length;u<d;++u){var c=l[u].boundInfo;if(c){i&&(c=Kekule.Render.MetaShapeUtils.inflateShape(c,i));var h=Kekule.Render.MetaShapeUtils.getContainerBox(c);n=n?Kekule.BoxUtils.getContainerBox(n,h):h}}}return n},getObjectsBoxAndClientBoxRelation:function(e){var t=this.getObjectsContainerBox(e);if(t){var r=this.getVisibleClientScreenBox();return Kekule.BoxUtils.getIntersectionState(t,r)}},getSelectionContainerBox:function(e){return this.getObjectsContainerBox(this.getSelection(),e)},isSelectionVisible:function(){var e=this.getSelectionContainerBox();if(e){var t=this.getVisibleClientScreenBox();return Kekule.BoxUtils.hasIntersection(e,t)}return!1},getObjSize:function(e){return this.doGetObjSize(e)},doGetObjSize:function(e){var t=this.getCoordMode();return e.getSizeOfMode?e.getSizeOfMode(t):null},setObjSize:function(e,t){this.doSetObjSize(e,t),this.objectChanged(e)},doSetObjSize:function(e,t){e.setSizeOfMode&&e.setSizeOfMode(t,this.getCoordMode())},getObjCoord:function(e,t){return this.doGetObjCoord(e,t)},doGetObjCoord:function(e,t){if(!e)return null;var r=this.getCoordMode(),i=this.getAllowCoordBorrow(),n=e.getAbsBaseCoord?e.getAbsBaseCoord(r,i):e.getAbsCoordOfMode?e.getAbsCoordOfMode(r,i):e.getCoordOfMode?e.getCoordOfMode(r,i):null;if(r===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(t)&&t!==Kekule.Render.CoordPos.DEFAULT){i=this.getAllowCoordBorrow();var o=e.getExposedContainerBox?e.getExposedContainerBox(r,i):e.getContainerBox?e.getContainerBox(r,i):null;if(o&&t===Kekule.Render.CoordPos.CORNER_TL){var a={x:(o.x2-o.x1)/2,y:(o.y2-o.y1)/2};n.x=n.x-a.x,n.y=n.y+a.y}}return n},setObjCoord:function(e,t,r){this.doSetObjCoord(e,t,r),this.objectChanged(e)},doSetObjCoord:function(e,t,r){var i=Object.create(t),n=this.getCoordMode();if(n===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(r)&&r!==Kekule.Render.CoordPos.DEFAULT){var o=this.getAllowCoordBorrow(),a=e.getExposedContainerBox?e.getExposedContainerBox(n,o):e.getContainerBox?e.getContainerBox(n,o):null;if(a){var s={x:(a.x2-a.x1)/2,y:(a.y2-a.y1)/2};r===Kekule.Render.CoordPos.CORNER_TL&&(i.x=t.x+s.x,i.y=t.y-s.y)}}e.setAbsBaseCoord?e.setAbsBaseCoord(i,n):e.setAbsCoordOfMode?e.setAbsCoordOfMode(i,n):e.setAbsCoordOfMode&&e.setCoordOfMode(i,n)},getObjectContextCoord:function(e,t){var r=this.getObjCoord(e,t);return this.objCoordToContext(r)},setObjectContextCoord:function(e,t,r){var i=this.contextCoordToObj(t);i&&this.setObjCoord(e,i,r)},getObjectScreenCoord:function(e,t){var r=this.getObjCoord(e,t);return this.objCoordToScreen(r)},setObjectScreenCoord:function(e,t,r){var i=this.screenCoordToObj(t);i&&this.setObjCoord(e,i,r)},getCoord:function(e,t,r){var i=this.getObjCoord(e,r);return this.translateCoord(i,Kekule.Editor.CoordSys.OBJ,t)},setCoord:function(e,t,r,i){var n=this.translateCoord(t,r,Kekule.Editor.CoordSys.OBJ);this.setObjCoord(e,n,i)},getSize:function(e,t){var r=this.getObjSize(e);return this.translateCoord(r,Kekule.Editor.CoordSys.OBJ,t)},setSize:function(e,t,r){var i=this.translateCoord(t,r,Kekule.Editor.CoordSys.OBJ);this.setObjSize(e,i)},transformCoordAndSizeOfObjects:function(e,t){var r=this.getCoordMode(),i=this.getAllowCoordBorrow(),n=r===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(t):Kekule.CoordUtils.calcTransform2DMatrix(t),o=Object.extend({},t);o=Object.extend(o,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});for(var a=r===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(o):Kekule.CoordUtils.calcTransform2DMatrix(o),s=0,l=e.length;s<l;++s){var u=e[s];u.transformAbsCoordByMatrix(n,a,r,!0,i),u.scaleSize(t.scale,r,!0,i)}},createDefaultNode:function(e,t,r){var i=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId(),n=new Kekule.Atom;return n.setIsotopeId(i),r&&r.appendNode(n),this.setCoord(n,e,t),n},operationDone:function(e){this.doOperationDone(e)},doOperationDone:function(e){},clearOperHistory:function(){var e=this.getOperHistory();e&&e.clear()},pushOperation:function(e,t){if(e){var r=this.getOperHistory();if(r&&r.push(e),this.getOperationsInCurrManipulation().push(e),t){this.beginManipulateAndUpdateObject();try{e.execute()}finally{this.endManipulateAndUpdateObject()}}}},popOperation:function(e){var t,r=this.getOperHistory();if(r){if(t=r.pop(),e){this.beginUpdateObject();try{t.reverse()}finally{this.endUpdateObject()}}var i=this.getOperationsInCurrManipulation(),n=i.indexOf(t);return n>=0&&i.splice(n,1),t}return null},execOperation:function(e){var r=t.toArray(e);this.beginManipulateAndUpdateObject();try{for(var i=0,n=r.length;i<n;++i){var o=r[i];o.execute(),this.getEnableOperHistory()&&this.pushOperation(o,!1)}}finally{this.endManipulateAndUpdateObject()}return this},execOperations:function(e){if(1===e.length)return this.execOperation(e[0]);var t=new Kekule.MacroOperation(e);return this.execOperation(t)},replaceOperationInHistory:function(e,t){var r=this.getOperHistory();return r&&r.replaceOperation(e,t)},undo:function(){var e,t=this.getOperHistory();if(t){this.beginUpdateObject();try{e=t.undo()}finally{this.endUpdateObject(),e&&this.operationDone(e)}}return e},redo:function(){var e,t=this.getOperHistory();if(t){this.beginUpdateObject();try{e=t.redo()}finally{this.endUpdateObject(),e&&this.operationDone(e)}}return e},undoAll:function(){var e,t=this.getOperHistory();if(t){this.beginUpdateObject();try{e=t.undoAll()}finally{this.endUpdateObject()}}return e},canUndo:function(){var e=this.getOperHistory();return!!e&&e.canUndo()},canRedo:function(){var e=this.getOperHistory();return!!e&&e.canRedo()},modifyObjects:function(e,t,r){var i=Kekule.ArrayUtils.toArray(e);try{for(var n=new Kekule.MacroOperation,o=0,a=i.length;o<a;++o){var s=i[o],l=new Kekule.ChemObjOperation.Modify(s,t,this);n.add(l)}n.execute()}finally{r&&this.getEnableOperHistory()&&n.getChildCount()&&this.pushOperation(n)}return this},modifyObjectsRenderOptions:function(e,t,r,i){var n=Kekule.ArrayUtils.toArray(e),o=r?"render3DOptions":"renderOptions",a=r?"getRender3DOptions":"getRenderOptions";try{for(var s=new Kekule.MacroOperation,l=0,u=n.length;l<u;++l){var d=n[l];if(d[a]){var c=d[a](),h=Object.extend({},c);h=Object.extend(h,t);var p={};p[o]=h;var g=new Kekule.ChemObjOperation.Modify(d,p,this);s.add(g)}}this.beginManipulateAndUpdateObject(),s.execute()}finally{i&&this.getEnableOperHistory()&&s.getChildCount()&&this.pushOperation(s),this.endManipulateAndUpdateObject()}return this},getClientDimension:function(){var e=this.getElement();return{width:e.clientWidth,height:e.clientHeight}},getClientScrollPosition:function(){var e=this.getEditClientElem().parentNode;return e?{x:e.scrollLeft,y:e.scrollTop}:null},getClientScrollCoord:function(t){var r=this.getClientScrollPosition();return e.isUnset(t)||t===Kekule.Editor.CoordSys.SCREEN?r:this.translateCoord(r,Kekule.Editor.CoordSys.SCREEN,t)},getClientVisibleRect:function(){var e=this.getClientDimension(),t=this.getClientScrollPosition();return e.x1=e.left=t.x,e.y1=e.top=t.y,e.x2=e.x1+e.width,e.y2=e.y1+e.height,e},scrollClientTo:function(e,t){return this.scrollClientToCoord({y:e,x:t})},scrollClientToTop:function(){return this.scrollClientTo(0,null)},scrollClientToBottom:function(){var e=this.getEditClientElem(),t=Kekule.HtmlElementUtils.getElemClientDimension(e);return this.scrollClientTo(t.height,null)},scrollClientToCoord:function(t,r,i){var n,o=e.notUnset(t.x),a=e.notUnset(t.y),s=i&&i.scrollToCenter;if(n=e.isUnset(r)?t:this.translateCoord(t,r,Kekule.Editor.CoordSys.SCREEN),s){var l=this.getVisibleClientScreenBox(),u={x:l.width/2,y:l.height/2};n=Kekule.CoordUtils.substract(n,u)}var d=this.getEditClientElem().parentNode;return a&&(d.scrollTop=n.y),o&&(d.scrollLeft=n.x),this},scrollClientToObject:function(e,r){Kekule.BoxUtils;if(!e)return this;var i=this.getChemObj();if(!i)return this;var n=t.toArray(e),o=this._getTargetObjsExposedContainerBoxInfo(n,i),a=o.totalBox,s=o.boxes;if(a){var l=Object.extend({scrollToCenter:!0,coverMostObjs:!0},r||{});return this._scrollClientToContainerBox(a,s,l)}return this},_scrollClientToContainerBox:function(e,t,r){var i,n=Kekule.BoxUtils,o=this.getVisibleClientBoxOfSys(Kekule.Editor.CoordSys.CHEM);i=(e.x2-e.x1>o.x2-o.x1||e.y2-e.y1>o.y2-o.y1)&&r.coverMostObjs?this._getMostIntersectedContainerBox(o.x2-o.x1,o.y2-o.y1,t,e):e;var a=r.scrollToCenter?n.getCenterCoord(i):{x:i.x1,y:i.y2};return this.scrollClientToCoord(a,Kekule.Editor.CoordSys.CHEM,r)},_getTargetObjsExposedContainerBoxInfo:function(e,t){var r=Kekule.BoxUtils;if(t||(t=this.getChemObj()),t)for(var i=null,n=[],o=0,a=e.length;o<a;++o){var s=e[o];if(s.getExposedContainerBox&&s.isChildOf&&s.isChildOf(t)){var l=s.getExposedContainerBox(this.getCoordMode());l&&(n.push(l),i=i?r.getContainerBox(i,l):l)}}return{totalBox:i,boxes:n}},_getMostIntersectedContainerBox:function(e,t,r,n){for(var o,a=Kekule.BoxUtils,s=function(r,o){var s=i.add(r,{x:e*o.x,y:t*o.y});s.x<n.x1?s.x=n.x1:s.x>n.x2&&(s.x=n.x2),s.y<n.y1?s.y=n.y1:s.y>n.y2&&(s.y=n.y2);var l=i.add(s,{x:-e*o.x,y:-t*o.y});return a.createBox(l,s)},l=function(e,t){for(var r=0,i=0,n=t.length;i<n;++i){var o=t[i];a.hasIntersection(o,e)&&++r}return r},u=0,d=0,c=r.length;d<c;++d)for(var h=a.getCornerCoords(r[d]),p=[s(h[0],{x:1,y:1}),s(h[1],{x:1,y:-1}),s(h[2],{x:-1,y:1}),s(h[3],{x:-1,y:-1})],g=0,f=p.length;g<f;++g){var C=l(p[g],r);C>u&&(u=C,o=p[g])}return o},doBeforeDispatchUiEvent:function(e){var r=e.getType();if(["pointerdown","pointermove","pointerup"].indexOf(r)>=0&&(this.setCurrPointerType(e.pointerType),"pointermove"===r&&this.isRenderable())){var i=this._getEventMouseCoord(e,this.getCoreElement()),n=this.getBasicObjectsAtCoord(i,this.getCurrBoundInflation())||[],o=this.getHoveredBasicObjs();this.setPropStoreFieldValue("hoveredBasicObjs",n),o&&n.length===o.length&&t.intersect(o,n).length===n.length||this.notifyHoverOnObjs(n)}return this.tryApplySuper("doBeforeDispatchUiEvent",[e])},notifyHoverOnObjs:function(e){var t=this.getChemObjsHint(e);this.updateHintForChemObject(t),this.invokeEvent("hoverOnObjs",{objs:e})},reactHotKeys:function(e){if(this.getEditorConfigs().getInteractionConfigs().getEnableHotKey()){for(var t=this.getEditorConfigs().getHotKeyConfigs().getHotKeys(),r=Kekule.Widget.KeyboardUtils.getKeyParamsFromEvent(e),i=!1,n=[],o=t.length-1;o>=0;--o){var a=Kekule.Widget.KeyboardUtils.shortcutLabelToKeyParams(t[o].key,null,!1);if(a.repeat=t[o].repeat,Kekule.Widget.KeyboardUtils.matchKeyParams(r,a,!1)){var s=t[o].action;if(s){var l=this.getChildAction(s,!0);if(l)if(l instanceof Kekule.Editor.ActionOperationCreate.Base){var u=l.createOperations(this);(i=!(!u||!u.length)||i)&&(n=n.concat(u))}else i=l.execute(this,e)||i}}}if(n.length&&this.execOperations(n),i)return e.stopPropagation(),e.preventDefault(),!0}},react_keydown:function(e){if(!this.tryApplySuper("react_keydown",[e]))return this.reactHotKeys(e)}}),Kekule.Editor.BaseEditor.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.Editor.BaseEditor.Settings",initProperties:function(){this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableCreateNewDoc()},setter:function(e){this.getEditor().setEnableCreateNewDoc(e)}}),this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getInitOnNewDoc()},setter:function(e){this.getEditor().setInitOnNewDoc(e)}}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableOperHistory()},setter:function(e){this.getEditor().setEnableOperHistory(e)}}),this.defineProp("enableIssueCheck",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableIssueCheck()},setter:function(e){this.getEditor().setEnableIssueCheck(e)}})},getEditor:function(){return this.getDisplayer()}}),Kekule.Editor.IaControllerManager={_controllerMap:new Kekule.MapEx(!0),register:function(e,t){a._controllerMap.set(e,t)},unregister:function(e){a._controllerMap.remove(e)},getAllControllerClasses:function(){return a._controllerMap.getKeys()},getAvailableControllerClasses:function(e){for(var t=[],r=a.getAllControllerClasses(),i=0,n=r.length;i<n;++i){var o=r[i],s=a._controllerMap.get(o);s&&!ClassEx.isOrIsDescendantOf(e,s)||t.push(o)}return t}};var a=Kekule.Editor.IaControllerManager;Kekule.Editor.BaseEditorBaseIaController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},_defineEditorConfigBasedProperty:function(e,t,r){var i={dataType:DataType.VARIANT,serializable:!1,setter:null};r&&r.overwrite?(i.getter=function(){var r=this.getPropStoreFieldValue(e),i=this.getEditorConfigs();return r&&i.getCascadePropValue(t)},i.setter=function(t){this.setPropStoreFieldValue(e,t)}):i.getter=function(){return this.getEditorConfigs().getCascadePropValue(t)};var n=Object.extend(i,r||{});this.defineProp(e,n)},getDefId:function(){return Kekule.ClassUtils.getLastClassName(this.getClassName())},getEditor:function(){return this.getWidget()},setEditor:function(e){return this.setWidget(e)},getEditorConfigs:function(){var e=this.getEditor();return e?e.getEditorConfigs():null}}),Kekule.Editor.BaseEditorIaController=Class.create(Kekule.Editor.BaseEditorBaseIaController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("manuallyHotTrack",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:!1,getter:function(){return this.getEditor().getCurrBoundInflation()},setter:null}),this.defineProp("activePointerType",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getEditor();return e&&e.getCurrPointerType()||this.getPropStoreFieldValue("activePointerType")},setter:function(e){var t=this.getEditor();t?t.setCurrPointerType(e):this.setStoreFieldValue("activePointerType",e)}})},notifyEditorBeginManipulateObjects:function(){this.getEditor().beginManipulateObject()},notifyEditorEndManipulateObjects:function(){this.getEditor().endManipulateObject()},getInteractionBoundInflation:function(e){return this.getEditor().getInteractionBoundInflation(e)},handleUiEvent:function(e){var t=!1,r=e.getTarget&&e.getTarget()||e.target,i=this.getEditor().getUiEventReceiverElem();i?(r===i||Kekule.DomUtils.isDescendantOf(r,i))&&(t=!0):t=!0,t&&this.tryApplySuper("handleUiEvent",[e])},canInteractWithObj:function(e){return!!e},getInteractableTargetClasses:function(){return null},getAllInteractableObjsAtScreenCoord:function(e){return this.getEditor().getBasicObjectsAtCoord(e,this.getCurrBoundInflation(),null,this.getInteractableTargetClasses())},getTopmostInteractableObjAtScreenCoord:function(e){var t=this.getAllInteractableObjsAtScreenCoord(e);if(t)for(var r=0,i=t.length;r<i;++r)if(this.canInteractWithObj(t[r]))return t[r];return null},getTopmostInteractableObjAtCurrPointerPos:function(){var e=this.getEditor().getHoveredBasicObjs();if(e)for(var t=0,r=e.length;t<r;++t)if(this.canInteractWithObj(e[t]))return e[t];return null},hotTrackOnObj:function(e){this.getEditor().hotTrackOnObj(e)},zoomEditor:function(e,t){e>0?this.getEditor().zoomIn(e,t):e<0&&this.getEditor().zoomOut(-e,t)},_filterBasicObjectsInEditor:function(e){for(var t=this.getEditor().getChemObj(),r=[],i=0,n=e.length;i<n;++i){var o=e[i];o.isChildOf(t)&&r.push(o)}return r},doneInsertOrModifyBasicObjects:function(e){if(this.needAutoSelectNewlyInsertedObjects()){var t=this._filterBasicObjectsInEditor(e);this.getEditor().select(t)}},needAutoSelectNewlyInsertedObjects:function(){var e=this.getActivePointerType(),t=this.getEditorConfigs().getInteractionConfigs();return t.getAutoSelectNewlyInsertedObjectsOnTouch()&&"touch"===e||t.getAutoSelectNewlyInsertedObjects()},react_pointerdown:function(e){return this.setActivePointerType(e.pointerType),e.preventDefault(),!0},react_pointermove:function(e){var t=this.getTopmostInteractableObjAtCurrPointerPos();return this.getManuallyHotTrack()||(t?this.hotTrackOnObj(t):this.hotTrackOnObj(null)),e.preventDefault(),!0},react_mousewheel:function(e){if(e.getCtrlKey()){var t=this._getEventMouseCoord(e);try{var r=e.wheelDeltaY||e.wheelDelta;r&&(r/=120),this.zoomEditor(r,t)}finally{}return e.preventDefault(),!0}},_getEventMouseCoord:function(e,t){var r=t||this.getWidget().getCoreElement();return this.tryApplySuper("_getEventMouseCoord",[e,r])}}),Kekule.Editor.ClientDragScrollIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ClientDragScrollIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._isExecuting=!1},canInteractWithObj:function(e){return!1},doTestMouseCursor:function(e,t){return this.isExecuting()?["grabbing","-webkit-grabbing","-moz-grabbing","move"]:["grab","-webkit-grab","-moz-grab","pointer"]},isExecuting:function(){return this._isExecuting},startScroll:function(e){this._startCoord=e,this._originalScrollPos=this.getEditor().getClientScrollPosition(),this._isExecuting=!0},endScroll:function(){this._isExecuting=!1,this._startCoord=null,this._originalScrollPos=null},scrollTo:function(e){if(this.isExecuting()){var t=this._startCoord,r=Kekule.CoordUtils.substract(t,e),i=Kekule.CoordUtils.add(this._originalScrollPos,r);this.getEditor().scrollClientTo(i.y,i.x)}},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===Kekule.X.Event.MouseButton.LEFT){if(!this.isExecuting()){var t={x:e.getScreenX(),y:e.getScreenY()};this.startScroll(t),e.preventDefault()}}else e.getButton()===Kekule.X.Event.MouseButton.RIGHT&&this.isExecuting()&&(this.endScroll(),e.preventDefault())},react_pointerup:function(e){e.getButton()===Kekule.X.Event.MouseButton.LEFT&&this.isExecuting()&&(this.endScroll(),e.preventDefault())},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this.isExecuting()){var t={x:e.getScreenX(),y:e.getScreenY()};this.scrollTo(t),e.preventDefault()}return!0}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.ClientDragScrollIaController,Kekule.Editor.BaseEditor),Kekule.Editor.BasicEraserIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicEraserIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._isExecuting=!1},canInteractWithObj:function(e){return!!e},removeObjs:function(e){if(e&&e.length){var t=this.getEditor();t.beginUpdateObject();try{var r=this.doGetActualRemovedObjs(e);this.doRemoveObjs(r)}finally{t.endUpdateObject()}}},doRemoveObjs:function(e){},doGetActualRemovedObjs:function(e){return e},removeSelection:function(){var e=this.getEditor();this.removeObjs(e.getSelection()),e.deselectAll()},removeOnScreenCoord:function(e){var t=this.getEditor().getTopmostBasicObjectAtCoord(e);return!!t&&(this.removeObjs([t]),!0)},startRemove:function(){this._isExecuting=!0},endRemove:function(){this._isExecuting=!1},isRemoving:function(){return this._isExecuting},reactUiEvent:function(e){var t=this.tryApplySuper("reactUiEvent",[e]),r=e.getType();return["touchstart","touchend","touchcancel","touchmove"].indexOf(r)>=0&&e.preventDefault(),t},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.startRemove();var t=this._getEventMouseCoord(e);this.removeOnScreenCoord(t),e.preventDefault()}else e.getButton()===Kekule.X.Event.MOUSE_BTN_RIGHT&&(this.endRemove(),e.preventDefault())},react_pointerup:function(e){e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT&&(this.endRemove(),e.preventDefault())},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this.isRemoving()){var t=this._getEventMouseCoord(e);this.removeOnScreenCoord(t),e.preventDefault()}return!0}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicEraserIaController,Kekule.Editor.BaseEditor),Kekule.Editor.BasicManipulationIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicManipulationIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),this._suppressConstrainedResize=!1,this._manipulationStepBuffer={},this._suspendedOperations=null,this.execManipulationStepBind=this.execManipulationStep.bind(this)},initProperties:function(){this.defineProp("selectMode",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableSelect",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableRotate",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableGestureManipulation",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("state",{dataType:DataType.INT,serializable:!1}),this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("startCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("endCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("startBox",{dataType:DataType.HASH,serializable:!1}),this.defineProp("endBox",{dataType:DataType.HASH,serializable:!1}),this.defineProp("lastRotateAngle",{dataType:DataType.FLOAT,serializable:!1}),this.defineProp("rotateRefCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("rotateCenter",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("rotateCenter");if(!e){var t=this._getManipulateObjsCenterCoord();e=this.getEditor().objCoordToScreen(t),this.setPropStoreFieldValue("rotateCenter",e)}return e}}),this.defineProp("resizeStartingRegion",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableAspectRatioLockedResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("rotateStartingRegion",{dataType:DataType.INT,serializable:!1}),this.defineProp("manipulateOriginObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("manipulateObjs",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("manipulateObjs",e),e?this.getEditor().prepareOperatingObjs(e):this.getEditor().endOperatingObjs()}}),this.defineProp("manipulateObjInfoMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("manipulateObjInfoMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("manipulateObjInfoMap",e)),e}}),this.defineProp("manipulateObjCurrInfoMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("manipulateObjCurrInfoMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("manipulateObjCurrInfoMap",e)),e}}),this.defineProp("manipulationType",{dataType:DataType.INT,serializable:!1}),this.defineProp("isManipulatingSelection",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("isOffsetManipulating",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("manipulationPointerType",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getActivePointerType()},setter:function(e){this.setActivePointerType(e)}}),this.defineProp("activePointerId",{dataType:DataType.INT,serializable:!1}),this.defineProp("moveOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("moveWrapperOperation",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("objOperationMap",{dataType:"Kekule.MapEx",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("objOperationMap");return e||(e=new Kekule.MapEx(!0),this.setPropStoreFieldValue("objOperationMap",e)),e}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!1),this.setEnableGestureManipulation(!1);var e=Kekule.globalOptions.get("chemWidget.editor")||{},t=Kekule.oneOf;this.setEnableMove(t(e.enableMove,!0)),this.setEnableResize(t(e.enableResize,!0)),this.setEnableAspectRatioLockedResize(t(e.enableAspectRatioLockedResize,!0)),this.setEnableRotate(t(e.enableRotate,!0))},doFinalize:function(){var e=this.getPropStoreFieldValue("manipulateObjInfoMap");e&&e.clear(),(e=this.getPropStoreFieldValue("objOperationMap"))&&e.clear(),this.tryApplySuper("doFinalize")},hotTrackOnObj:function(e){if(this.getEnableSelect()&&this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR){var t=this.getStandaloneAncestor(e);return e&&e.getStandaloneAncestor&&e.getStandaloneAncestor(),this.tryApplySuper("hotTrackOnObj",[t])}return this.tryApplySuper("hotTrackOnObj",[e])},getStandaloneAncestor:function(e){return e&&e.getStandaloneAncestor?e.getStandaloneAncestor():e},isInAncestorSelectMode:function(){return this.getEnableSelect()&&this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR},isAspectRatioLockedResize:function(){return this.getEnableAspectRatioLockedResize()&&!this._suppressConstrainedResize},getCoordOnSelectionRotationRegion:function(e){var t=Kekule.Editor.BoxRegion,r=this.getEditor();if(r.getCoordRegionInSelectionMarker(e)!==t.OUTSIDE)return!1;var i=r.getEditorConfigs().getInteractionConfigs().getRotationRegionInflation(),n=r.getUiSelectionAreaContainerBox();if(n&&r.hasSelection()){for(var o=[t.CORNER_TL,t.CORNER_TR,t.CORNER_BR,t.CORNER_BL],a=[{x:n.x1,y:n.y1},{x:n.x2,y:n.y1},{x:n.x2,y:n.y2},{x:n.x1,y:n.y2}],s=!1,l=i,u=0,d=o.length;u<d;++u){var c=o[u],h=a[u],p=Kekule.CoordUtils.getDistance(h,e);p<=l&&(s=c,l=p)}return s}return!1},createManipulateOperation:function(){return this.doCreateManipulateMoveAndResizeOperation()},doCreateManipulateMoveAndResizeOperation:function(){var e=[];this.setMoveOperations(e);var t=this.getManipulateObjs(),r=this.getManipulateObjInfoMap();this.getObjOperationMap().clear();var i=new Kekule.ChemObjOperation.MoveAndResizeObjs([],[],this.getEditor().getCoordMode(),!0,this.getEditor());i.setDisableIndirectCoord(!0);for(var n=0,o=t.length;n<o;++n){var a=t[n],s=r.get(a),l=new Kekule.ChemObjOperation.MoveAndResize(a,null,null,this.getEditor().getCoordMode(),!0,this.getEditor());l.setAllowCoordBorrow(this.getEditor().getAllowCoordBorrow()),l.setOldCoord(s.objCoord),l.setOldDimension(s.size),e.push(l),i.getChildOperations().push(l),this.setMoveWrapperOperation(i)}return[i]},updateChildMoveOperation:function(e,t,r){this.getMoveOperations()[e].setNewCoord(r)},updateChildResizeOperation:function(e,t,r){this.getMoveOperations()[e].setNewDimension(r)},getAllObjOperations:function(e){var t=this.getMoveOperations(),r=t?Kekule.ArrayUtils.clone(t):[];if(r.length){var i=this.getMoveWrapperOperation();return i.setChildOperations(r),[i]}return[]},getActiveOperation:function(e){var t=this.getAllObjOperations(e);return(t=Kekule.ArrayUtils.toUnique(t)).length<=0?null:1===t.length?t[0]:new Kekule.MacroOperation(t)},reverseActiveOperation:function(){return this.getActiveOperation().reverse()},addOperationToEditor:function(){var e=this.getEditor();if(e&&e.getEnableOperHistory()){var t=this.getActiveOperation(!0);t&&e.pushOperation(t)}},getCurrAvailableManipulationTypes:function(){var e=Kekule.Editor.BasicManipulationIaController.ManipulationType,t=this.getEditor().getSelectionContainerBox();if(t){var r=[];return this.getEnableMove()&&r.push(e.MOVE),Kekule.NumUtils.isFloatEqual(t.x1,t.x2,1e-10)&&Kekule.NumUtils.isFloatEqual(t.y1,t.y2,1e-10)||(this.getEnableResize()&&r.push(e.RESIZE),this.getEnableRotate()&&r.push(e.ROTATE),(this.getEnableResize()||this.getEnableRotate())&&r.push(e.TRANSFORM)),r}return[]},getActualManipulatingObjects:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r],o=n.getCoordDependentObjects?n.getCoordDependentObjects():[n];Kekule.ArrayUtils.pushUnique(t,o)}return t},doPrepareManipulatingObjects:function(e,t){var r=this.getActualManipulatingObjects(e);this.setManipulateOriginObjs(e),this.setManipulateObjs(r);var i=this.getManipulateObjInfoMap();i.clear();this.getEditor();for(var n=0,o=r.length;n<o;++n){var a=r[n],s=this.createManipulateObjInfo(a,n,t);i.set(a,s)}},doPrepareManipulatingStartingCoords:function(e,t,r,i){this.setStartBox(t),this.setRotateCenter(r),this.setRotateRefCoord(i),this.setLastRotateAngle(null)},prepareManipulating:function(e,t,r,i,n,o){this.setManipulationType(e),this.doPrepareManipulatingObjects(t,r),this.doPrepareManipulatingStartingCoords(r,i,n,o),this.createManipulateOperation(),this._cachedTransformCompareThresholds=null,this._runManipulationStepId=Kekule.window.requestAnimationFrame(this.execManipulationStepBind)},cancelManipulate:function(){this.getEditor(),this.getManipulateObjs();this.reverseActiveOperation(),this.notifyCoordChangeOfObjects(this.getManipulateObjs()),this.manipulateEnd()},_getManipulateObjsCenterCoord:function(){var e=this.getManipulateObjs();if(!e||!e.length)return null;for(var t=this.getEditor().getCoordMode(),r=this.getEditor().getAllowCoordBorrow(),i={x:0,y:0,z:0},n=0,o=e.length;n<o;++n){var a=e[n],s=a.getAbsBaseCoord?a.getAbsBaseCoord(t,r):a.getAbsCoord?a.getAbsCoord(t,r):a.getCoordOfMode?a.getCoordOfMode(t,r):null;s&&(i=Kekule.CoordUtils.add(i,s))}return Kekule.CoordUtils.divide(i,e.length)},_maniplateObjsFrameEnd:function(e){},_addManipultingObjNewInfo:function(e,t){var r=this.getManipulateObjCurrInfoMap(),i=r.get(e)||{};i=Object.extend(i,t),r.set(e,i)},applyManipulatingObjsInfo:function(e){var t=this.getManipulateObjs(),r=this.getManipulateObjCurrInfoMap(),i=this._getIndirectCoordObjs(t);this._setEnableIndirectCoordOfObjs(i,!1);try{for(var n=0,o=t.length;n<o;++n){var a=t[n],s=r.get(a);this.applySingleManipulatingObjInfo(n,a,s,e)}}finally{this._setEnableIndirectCoordOfObjs(i,!0)}},_getIndirectCoordObjs:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r];n.getEnableIndirectCoord&&n.getEnableIndirectCoord()&&t.push(n)}return t},_setEnableIndirectCoordOfObjs:function(e,t){if(e)for(var r=0,i=e.length;r<i;++r)e[r].setEnableIndirectCoord(t)},applySingleManipulatingObjInfo:function(e,t,r,i){r&&(r.screenCoord&&this.doMoveManipulatedObj(e,t,r.screenCoord,i),r.size&&this.doResizeManipulatedObj(e,t,r.size))},_calcRotateAngle:function(e){var t,r=Kekule.CoordUtils,i=!1,n=this.getRotateCenter(),o=this.getRotateRefCoord()||this.getStartCoord(),a=this.getEditorConfigs().getInteractionConfigs().getRotationLocationPointDistanceThreshold();if(a){if(r.getDistance(o,n)<a)return t=0,i=!0,this.setStartCoord(e),!1;if(r.getDistance(e,n)<a)return t=0,i=!0,!1}if(!i){var s=r.substract(e,n),l=Math.atan2(s.y,s.x);s=r.substract(o,n);var u=Math.atan2(s.y,s.x);t=l-u}return{angle:t,startAngle:u,endAngle:l}},_calcActualRotateAngle:function(e,t,r,i){return t},_calcManipulateObjsRotationParams:function(e,t){if(!this.getEnableRotate())return!1;var r=this.getRotateCenter(),i=this._calcRotateAngle(t);if(!i)return!1;var n=this._calcActualRotateAngle(e,i.angle,i.startAngle,i.endAngle),o=this.getLastRotateAngle();return(!Kekule.ObjUtils.notUnset(o)||!Kekule.NumUtils.isFloatEqual(n,o,.0175))&&(this.setLastRotateAngle(n),{center:r,rotateAngle:n})},_calcActualResizeScales:function(e,t){return t},_calcManipulateObjsResizeParams:function(e,t,r){if(!this.getEnableResize())return!1;var i,n,o=Kekule.Editor.BoxRegion,a=Kekule.CoordUtils,s=this.getStartBox(),l=a.substract(r,this.getStartCoord());t===o.EDGE_TOP?(l.x=0,i={x:(s.x1+s.x2)/2,y:s.y2}):t===o.EDGE_BOTTOM?(l.x=0,i={x:(s.x1+s.x2)/2,y:s.y1}):t===o.EDGE_LEFT?(l.y=0,i={x:s.x2,y:(s.y1+s.y2)/2}):t===o.EDGE_RIGHT?(l.y=0,i={x:s.x1,y:(s.y1+s.y2)/2}):(this.isAspectRatioLockedResize()&&(n=!0),i=t===o.CORNER_TL?{x:s.x2,y:s.y2}:t===o.CORNER_TR?{x:s.x1,y:s.y2}:t===o.CORNER_BL?{x:s.x2,y:s.y1}:{x:s.x1,y:s.y1});var u,d,c=t===o.CORNER_TL||t===o.CORNER_BL||t===o.EDGE_LEFT,h=t===o.CORNER_TL||t===o.CORNER_TR||t===o.EDGE_TOP;if(u=Kekule.NumUtils.isFloatEqual(s.x1,s.x2,1e-10)?1:1+l.x/(s.x2-s.x1)*(c?-1:1),d=Kekule.NumUtils.isFloatEqual(s.y1,s.y2,1e-10)?1:1+l.y/(s.y2-s.y1)*(h?-1:1),n){var p=Math.abs(u),g=Math.abs(d);p>=g?d=(Math.sign(d)||1)*p:u=(Math.sign(u)||1)*g}var f=this._calcActualResizeScales(e,{scaleX:u,scaleY:d});return{center:i,scaleX:f.scaleX,scaleY:f.scaleY}},_calcManipulateObjsTransformInfo:function(e,t){for(var r=Kekule.CoordUtils,i=r.calcTransform2DMatrix(t),n=t.scaleX||t.scale,o=t.scaleY||t.scale,a=this._isManipulatingSingleStickedObj(e),s=0,l=e.length;s<l;++s){var u=e[s],d=this.getManipulateObjInfoMap().get(u),c={};if(!d.hasNoCoord){var h=d.screenCoord;if(!d.stickTarget||a){var p=r.transform2DByMatrix(h,i);c.screenCoord=p}else c.screenCoord=h}if(d.size&&(n||o)){var g={x:d.size.x*Math.abs(n||1),y:d.size.y*Math.abs(o||1)};c.size=g}this._addManipultingObjNewInfo(u,c)}return!0},_isStickedObj:function(e){return e&&e.getCoordStickTarget&&e.getCoordStickTarget()},_isManipulatingSingleStickedObj:function(e){var t=!1;if(1===e.length){var r=e[0];t=!!this.getManipulateObjInfoMap().get(r).stickTarget}return t},doTransformManipulatedObjs:function(e,t,r){var i=Kekule.Editor.BasicManipulationIaController.ManipulationType,n=this.getEditor(),o=this.getManipulateObjs(),a=r;if((a||(e===i.RESIZE?a=this._calcManipulateObjsResizeParams(o,this.getResizeStartingRegion(),t):e===i.ROTATE&&(a=this._calcManipulateObjsRotationParams(o,t))),!this._lastTransformParams||!this._isSameTransformParams(this._lastTransformParams,a,null,n.getCoordMode()))&&(a&&this._calcManipulateObjsTransformInfo(o,a))){this._lastTransformParams=a,n.beginUpdateObject();this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(t),this._maniplateObjsFrameEnd(o),this.notifyCoordChangeOfObjects(o)}finally{n.endUpdateObject(),this.manipulateStepDone()}}},_isSameTransformParams:function(e,t,r,n){return r||(r=this._cachedTransformCompareThresholds),r||(r=this._getTransformCompareThresholds(),this._cachedTransformCompareThresholds=r),n===Kekule.CoordMode.COORD2D?i.isSameTransform2DOptions(e,t,{translate:r.translate,scale:r.scale,rotate:r.rotate}):i.isSameTransform3DOptions(e,t,{translate:r.translate,scale:r.scale,rotate:r.rotate})},_getTransformCompareThresholds:function(e){return{translate:.1,scale:.1,rotate:.1}},_calcActualMovedScreenCoord:function(e,t,r){return r},_calcManipulateObjsMoveInfo:function(e,t){var r=Kekule.CoordUtils,i=(this.getManipulateObjCurrInfoMap(),this.getEditor()),n=this._isManipulatingSingleStickedObj(e),o=this.isDirectManipulating()&&1===e.length,a=!o||e[0]&&e[0].getSizeOfMode&&e[0].getSizeOfMode(i.getCoordMode(),i.getAllowCoordBorrow()),s=o&&!a&&this.getEditorConfigs().getInteractionConfigs().getFollowPointerCoordOnDirectManipulatingSingleObj();if(s){var l=this.getStartCoord();r.getDistance(t,l)<=this.getEditorConfigs().getInteractionConfigs().getFollowPointerCoordOnDirectManipulatingSingleObjDistanceThreshold()&&(s=!1)}for(var u=0,d=e.length;u<d;++u){var c,h=e[u],p=this.getManipulateObjInfoMap().get(h);if(!p.hasNoCoord)if(!p.stickTarget||n)c=s?t:r.add(t,p.screenCoordOffset),c=this._calcActualMovedScreenCoord(h,p,c),this._addManipultingObjNewInfo(h,{screenCoord:c})}},moveManipulatedObjs:function(e){Kekule.CoordUtils;var t=this.getEditor(),r=this.getManipulateObjs();this._calcManipulateObjsMoveInfo(r,e),t.beginUpdateObject();this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(e),this._maniplateObjsFrameEnd(r),this.notifyCoordChangeOfObjects(r)}finally{t.endUpdateObject(),this.manipulateStepDone()}},doMoveManipulatedObj:function(e,t,r,i){var n=this.getEditor();this.updateChildMoveOperation(e,t,n.screenCoordToObj(r)),n.setObjectScreenCoord(t,r)},doResizeManipulatedObj:function(e,t,r){this.updateChildResizeOperation(e,t,r),t.setSizeOfMode&&t.setSizeOfMode(r,this.getEditor().getCoordMode())},isDirectManipulating:function(){return this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING&&!this.getIsManipulatingSelection()},startDirectManipulate:function(e,t,r,i,n,o){return this.manipulateBegin(),this.doStartDirectManipulate(e,t,r,i,n,o)},doStartDirectManipulate:function(e,t,r,i,n,o){var a=Kekule.ArrayUtils.toArray(t);this.setState(Kekule.Editor.BasicManipulationIaController.State.MANIPULATING),this.setBaseCoord(r),this.setStartCoord(r),this.setRotateRefCoord(o),this.setIsManipulatingSelection(!1),this.prepareManipulating(e||Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE,a,r,i,n,o)},manipulateStepDone:function(){},doManipulateObjectsEnd:function(e){for(var t=this.getManipulateObjInfoMap(),r=e.length-1;r>=0;--r)this.doManipulateObjectEnd(e[r],t.get(e[r]))},doManipulateObjectEnd:function(e,t){},manipulateBegin:function(){this.notifyEditorBeginManipulateObjects()},manipulateEnd:function(){this._runManipulationStepId&&(Kekule.window.cancelAnimationFrame(this._runManipulationStepId),this._runManipulationStepId=null),this.doManipulateObjectsEnd(this.getManipulateObjs()),this._lastTransformParams=null,this.setIsOffsetManipulating(!1),this.setManipulateObjs(null),this.getManipulateObjInfoMap().clear(),this.getObjOperationMap().clear(),this.notifyEditorEndManipulateObjects()},manipulateBeforeStopping:function(){},stopManipulate:function(){this.manipulateEnd()},refreshManipulateObjs:function(){this.setManipulateObjs(this.getManipulateObjs())},createManipulateObjInfo:function(e,t,r){var i=this.getEditor(),n={objCoord:i.getObjCoord(e),screenCoord:i.getObjectScreenCoord(e),size:i.getObjSize(e),enableIndirectCoord:!(!e.getEnableIndirectCoord||!e.getEnableIndirectCoord())};return n.hasNoCoord=!n.objCoord,!n.hasNoCoord&&r&&(n.screenCoordOffset=Kekule.CoordUtils.substract(n.screenCoord,r)),e.getCoordStickTarget&&(n.stickTarget=e.getCoordStickTarget()),n},notifyCoordChangeOfObjects:function(e){for(var t=[],r=this.getEditor(),i=this.getEditor().getCoordMode()===Kekule.CoordMode.COORD3D?"coord3D":"coord2D",n=0,o=e.length;n<o;++n){var a=e[n];Kekule.ArrayUtils.pushUnique(t,{obj:a,propNames:[i]});for(var s=a.getCoordDeterminateObjects?a.getCoordDeterminateObjects():[a],l=0,u=s.length;l<u;++l)Kekule.ArrayUtils.pushUnique(t,{obj:s[l],propNames:[i]})}r.objectsChanged(t)},canInteractWithObj:function(e){return this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL&&e},doTestMouseCursor:function(e,t){if(!this.getEditor().isRenderable())return"";var r="",i=this._getEventMouseCoord(t,this.getEditor().getEditClientElem());if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL){var n=Kekule.Editor.BoxRegion,o=this.getEditor().getCoordRegionInSelectionMarker(i);if(this.getEnableSelect()){var a=Kekule.Editor.BasicManipulationIaController.ManipulationType,s=this.getCurrAvailableManipulationTypes();if(s.indexOf(a.MOVE)>=0&&(r=o===n.INSIDE?"move":""),!r&&s.indexOf(a.RESIZE)>=0)r=o===n.CORNER_TL?"nwse-resize":o===n.CORNER_TR?"nesw-resize":o===n.CORNER_BL?"nesw-resize":o===n.CORNER_BR?"nwse-resize":o===n.EDGE_TOP||o===n.EDGE_BOTTOM?"ns-resize":o===n.EDGE_LEFT||o===n.EDGE_RIGHT?"ew-resize":"";if(!r)if(s.indexOf(a.ROTATE)>=0)if(o=this.getCoordOnSelectionRotationRegion(i)){var l=Kekule.Widget.StyleResourceNames;r=o===n.CORNER_TL?l.CURSOR_ROTATE_NW:o===n.CORNER_TR?l.CURSOR_ROTATE_NE:o===n.CORNER_BL?l.CURSOR_ROTATE_SW:o===n.CORNER_BR?l.CURSOR_ROTATE_SE:l.CURSOR_ROTATE}}}return r},setSuspendedOperations:function(e,t,r){this._suspendedOperations&&this.haltSuspendedOperations();return this._suspendedOperations={immediate:e,delayed:t,delayExecId:setTimeout(this.execSuspendedDelayOperation.bind(this),r)},this._suspendedOperations},execSuspendedImmediateOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var e=this._suspendedOperations.immediate;return this._suspendedOperations=null,e.apply(this)}},execSuspendedDelayOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var e=this._suspendedOperations.delayed;return this._suspendedOperations=null,e.apply(this)}},haltSuspendedOperations:function(){this._suspendedOperations&&(clearTimeout(this._suspendedOperations.delayExecId),this._suspendedOperations=null)},_startNewSelecting:function(e,t){this.getEnableSelect()&&(this.getEditor().startSelecting(e,t||this.getEditor().getIsToggleSelectOn()),this.setState(Kekule.Editor.BasicManipulationIaController.State.SELECTING))},_startOffSelectionManipulation:function(e){this.setIsOffsetManipulating(!0),this.startManipulation(e,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE),this.getEditor().pulseSelectionAreaMarker()},startManipulation:function(e,t,r){var i=Kekule.Editor.BasicManipulationIaController.State,n=Kekule.Editor.BasicManipulationIaController.ManipulationType,o=this.getCurrAvailableManipulationTypes(),a=t&&"touch"===t.pointerType;t&&this.setManipulationPointerType(t&&t.pointerType),this.manipulateBegin(),this.setBaseCoord(e),this.setStartCoord(e),this._lastTransformParams=null;var s=e&&this.getEditor().getCoordRegionInSelectionMarker(e),l=Kekule.Editor.BoxRegion,u=e&&this.getCoordOnSelectionRotationRegion(e),d=o.indexOf(n.TRANSFORM)>=0&&r===n.TRANSFORM;if(d)this._availTransformTypes=o;else var c=!a&&o.indexOf(n.RESIZE)>=0&&(r===n.RESIZE||s!==l.INSIDE&&s!==l.OUTSIDE),h=!c&&o.indexOf(n.MOVE)>=0&&(r===n.MOVE||s!==l.OUTSIDE),p=!a&&!c&&!h&&o.indexOf(n.ROTATE)>=0&&(r===n.ROTATE||!!u);if(!d&&!c&&!p){var g=this.getEditor().getTopmostBasicObjectAtCoord(e,this.getCurrBoundInflation());if(g&&!a&&(this.isInAncestorSelectMode()&&(g=this.getStandaloneAncestor(g)),g=g.getNearestMovableObject(),this.getEnableMove()))return void this.doStartDirectManipulate(null,g,e)}if(d)this.setState(i.MANIPULATING),this.setIsManipulatingSelection(!0),this.setResizeStartingRegion(s),this.setRotateStartingRegion(u),this.prepareManipulating(n.TRANSFORM,this.getEditor().getSelection(),e,this.getEditor().getSelectionContainerBox());else if(c)this.setState(i.MANIPULATING),this.setIsManipulatingSelection(!0),this.setResizeStartingRegion(s),this.prepareManipulating(n.RESIZE,this.getEditor().getSelection(),e,this.getEditor().getSelectionContainerBox());else if(h)this.setState(i.MANIPULATING),this.setIsManipulatingSelection(!0),this.prepareManipulating(n.MOVE,this.getEditor().getSelection(),e);else if(p)this.setState(i.MANIPULATING),this.setIsManipulatingSelection(!0),this.setRotateStartingRegion(u),this.prepareManipulating(n.ROTATE,this.getEditor().getSelection(),e,this.getEditor().getSelectionContainerBox());else if(g)this.getEnableMove()&&this.startDirectManipulate(null,g,e);else if(this.getEnableMove()&&this.getEnableSelect()&&this.getEditorConfigs().getInteractionConfigs().getEnableOffSelectionManipulation()&&this.getEditor().hasSelection()&&this.getEditor().isSelectionVisible()){this.setState(i.SUSPENDING);var f=this.getEditorConfigs().getInteractionConfigs().getOffSelectionManipulationActivatingTimeThreshold(),C=t&&t.getShiftKey();this.setSuspendedOperations(this._startNewSelecting.bind(this,e,C),this._startOffSelectionManipulation.bind(this,e),f)}else if(this.getEnableSelect()){C=t&&t.getShiftKey();this._startNewSelecting(e,C)}},execManipulationStep:function(e){if(this.getState()!==Kekule.Editor.BasicManipulationIaController.State.MANIPULATING)return!1;var t=this._manipulationStepBuffer.coord,r=this._manipulationStepBuffer.event,i=this._manipulationStepBuffer.explicitTransformParams;i?this.doExecManipulationStepWithExplicitTransformParams(i,this._manipulationStepBuffer):t&&r&&this.doExecManipulationStep(t,r,this._manipulationStepBuffer),this._manipulationStepBuffer.coord=null,this._manipulationStepBuffer.event=null,this._manipulationStepBuffer.explicitTransformParams=null,this._runManipulationStepId=Kekule.window.requestAnimationFrame(this.execManipulationStepBind)},doExecManipulationStep:function(e,t,r){var i=Kekule.Editor.BasicManipulationIaController.ManipulationType,n=this.getManipulationType(),o=this.getEditor();o.beginUpdateObject();try{this._isBusy=!0,n===i.MOVE?this.moveManipulatedObjs(e):n===i.RESIZE?this.doTransformManipulatedObjs(n,e):n===i.ROTATE&&this.doTransformManipulatedObjs(n,e)}finally{o.endUpdateObject(),this._isBusy=!1}},doExecManipulationStepWithExplicitTransformParams:function(e,t){var r=Kekule.Editor.BasicManipulationIaController.ManipulationType,i=this.getManipulationType();if(i===r.TRANSFORM){var n=this.getEditor();n.beginUpdateObject();try{this._isBusy=!0,this.doTransformManipulatedObjs(i,null,e)}finally{n.endUpdateObject(),this._isBusy=!1}}},updateManipulationStepBuffer:function(e,t){Object.extend(e,t)},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this._isBusy)return!0;if(Kekule.ObjUtils.notUnset(this.getActivePointerId())&&e.pointerId!==this.getActivePointerId())return!0;var t,r=Kekule.Editor.BasicManipulationIaController.State,i=(Kekule.Editor.BasicManipulationIaController.ManipulationType,this.getState()),n=this._getEventMouseCoord(e);if((i===r.NORMAL||i===r.SUSPENDING)&&this._lastMouseMoveCoord){var o=Kekule.CoordUtils.getDistance(n,this._lastMouseMoveCoord);if(t=o,o<4)return!0}if(this._lastMouseMoveCoord=n,i===r.SUSPENDING){var a=this.getEditorConfigs().getInteractionConfigs().getUnmovePointerDistanceThreshold()||0;Kekule.ObjUtils.notUnset(t)&&t>a&&this.execSuspendedImmediateOperation()}return i===r.SELECTING?(this.getEnableSelect()&&this.getEditor().addSelectingAnchorCoord(n),e.preventDefault()):i===r.MANIPULATING&&(this.updateManipulationStepBuffer(this._manipulationStepBuffer,{coord:n,event:e}),e.preventDefault()),!0},react_pointerdown:function(e){this.tryApplySuper("react_pointerdown",[e]),this.setActivePointerId(e.pointerId);var t=Kekule.Editor.BasicManipulationIaController.State;if(e.getButton()===Kekule.X.Event.MouseButton.LEFT){this._lastMouseMoveCoord=null;var r=this._getEventMouseCoord(e);if(this.getState()===t.NORMAL){var i=this,n=function(){i.getState()!==t.NORMAL&&i.getState()!==t.SUSPENDING||(i.startManipulation(r,e),e.preventDefault())};this.setState(t.SUSPENDING),this.setSuspendedOperations(n,n,50)}}else e.getButton()===Kekule.X.Event.MouseButton.RIGHT&&(this.getState()===t.MANIPULATING?(this.cancelManipulate(),this.setState(t.NORMAL),e.stopPropagation(),e.preventDefault()):this.getState()===t.SUSPENDING&&this.haltSuspendedOperations());return!0},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MouseButton.LEFT){var t=this._getEventMouseCoord(e);this.setEndCoord(t);var r=this.getStartCoord(),i=t,n=e.getShiftKey(),o=Kekule.Editor.BasicManipulationIaController.State;this.getState()===o.SUSPENDING&&this.execSuspendedImmediateOperation();var a=this.getState();if(a===o.SELECTING)this.getEditor().endSelecting(t,n||this.getEditor().getIsToggleSelectOn()),this.setState(o.NORMAL),e.preventDefault(),this.getEditor().endManipulateObject();else a===o.MANIPULATING&&(r&&i&&Kekule.CoordUtils.isEqual(r,i)?this.getEnableSelect()&&this.getEditor().selectOnCoord(r,n||this.getEditor().getIsToggleSelectOn()):(this.manipulateBeforeStopping(),this.addOperationToEditor()),this.stopManipulate(),this.setState(o.NORMAL),e.preventDefault())}return!0},react_mousewheel:function(e){if(e.getCtrlKey()){if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL)return this.tryApplySuper("react_mousewheel",[e]);e.preventDefault()}},_isGestureManipulationEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureManipulation()},_isGestureZoomOnEditorEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureZoomOnEditor()},_isInGestureManipulation:function(){return!!this._initialGestureTransformParams},_isGestureZoomOnEditor:function(){return!!this._initialGestureZoomLevel},beginGestureTransform:function(e){this.getEditor().hasSelection()?(this._initialGestureZoomLevel=null,this._isGestureManipulationEnabled()?(this.haltSuspendedOperations(),this._initialGestureTransformParams={angle:e.rotation*Math.PI/180||0},this.getState()!==Kekule.Editor.BasicManipulationIaController.State.MANIPULATING?this.startManipulation(null,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM):this.getManipulationType()!==Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM&&this.startManipulation(null,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM)):this._initialGestureTransformParams=null):this._isGestureZoomOnEditorEnabled()&&(this.getEditor().cancelSelecting(),this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),this._initialGestureZoomLevel=this.getEditor().getZoom())},endGestureTransform:function(){this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING&&this._isInGestureManipulation()&&(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),this._initialGestureTransformParams=null),this._isGestureZoomOnEditor()&&(this._initialGestureZoomLevel=null)},doGestureTransformStep:function(e){var t=Kekule.Editor.BasicManipulationIaController.ManipulationType;if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING&&this.getManipulationType()===t.TRANSFORM&&this._isInGestureManipulation()){var r,i=this._availTransformTypes||[],n=this.getRotateCenter();if(i.indexOf(t.RESIZE)>=0){var o=e.scale;r=this._calcActualResizeScales(this.getManipulateObjs(),{scaleX:o,scaleY:o})}else r={scaleX:1,scaleY:1};if(i.indexOf(t.ROTATE)>=0){var a=e.rotation*Math.PI/180,s=a-this._initialGestureTransformParams.angle;s=this._calcActualRotateAngle(this.getManipulateObjs(),s,this._initialGestureTransformParams.angle,a)}else s=0;this.updateManipulationStepBuffer(this._manipulationStepBuffer,{explicitTransformParams:{center:n,scaleX:r.scaleX,scaleY:r.scaleY,rotateAngle:s}}),e.preventDefault()}else if(this._isGestureZoomOnEditor()){var l=this.getEditor(),u=(o=e.scale,this._initialGestureZoomLevel);l.zoomTo(u*o,null,e.center)}},react_rotatestart:function(e){this.getEnableGestureManipulation()&&this.beginGestureTransform(e)},react_rotate:function(e){this.getEnableGestureManipulation()&&this.doGestureTransformStep(e)},react_rotateend:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_rotatecancel:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_pinchstart:function(e){this.getEnableGestureManipulation()&&this.beginGestureTransform(e)},react_pinchmove:function(e){this.getEnableGestureManipulation()&&this.doGestureTransformStep(e)},react_pinchend:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_pinchcancel:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()}}),Kekule.Editor.BasicManipulationIaController.State={NORMAL:0,SELECTING:1,MANIPULATING:2,WAITING:10,SUSPENDING:11},Kekule.Editor.BasicManipulationIaController.ManipulationType={MOVE:0,ROTATE:1,RESIZE:2,TRANSFORM:4},Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicManipulationIaController,Kekule.Editor.BaseEditor)}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.ChemObjOperation={},Kekule.ChemObjOperation.Base=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemObjOperation.Base",initialize:function(e,t){this.tryApplySuper("initialize"),this.setTarget(e),t&&this.setEditor(t)},initProperties:function(){this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL}),this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},notifyBeforeAddingByEditor:function(e,t,r){e.beforeAddingByEditor&&e.beforeAddingByEditor(t,r)},notifyBeforeRemovingByEditor:function(e,t){e.beforeRemovingByEditor&&e.beforeRemovingByEditor(t)},notifyBeforeModifyingByEditor:function(e,t){e.beforeModifyingByEditor&&e.beforeModifyingByEditor(t)},notifyAfterAddingByEditor:function(e,t,r){e.afterAddingByEditor&&e.afterAddingByEditor(t,r)},notifyAfterRemovingByEditor:function(e,t){e.afterRemovingByEditor&&e.afterRemovingByEditor(t)},notifyAfterModifyingByEditor:function(e,t){e.afterModifyingByEditor&&e.afterModifyingByEditor(t)}}),Kekule.ChemObjOperation.ChangeClass=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.ChangeClass",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),t&&this.setNewClass(t)},initProperties:function(){this.defineProp("newClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("oldClass",{dataType:DataType.CLASS,serializable:!1})},doExecute:function(){var e=this.getTarget();e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,{}),this.getOldClass()||this.setOldClass(e.getClass()),e.__changeClass__(this.getNewClass()),this.notifyAfterModifyingByEditor(e,{})}finally{e.endUpdate()}},doReverse:function(){var e=this.getTarget();e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,{}),e.__changeClass__(this.getOldClass()),this.notifyAfterModifyingByEditor(e,{})}finally{e.endUpdate()}}}),Kekule.ChemObjOperation.Modify=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Modify",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),t&&this.setNewPropValues(t)},initProperties:function(){this.defineProp("newPropValues",{dataType:DataType.HASH}),this.defineProp("oldPropValues",{dataType:DataType.HASH})},doExecute:function(){var e={},t=this.getNewPropValues(),r=this.getTarget();r.beginUpdate();try{for(var i in this.notifyBeforeModifyingByEditor(r,t),t){var n=t[i];e[i]=r.getPropValue(i),r.setPropValue(i,n)}this.notifyAfterModifyingByEditor(r,t)}finally{r.endUpdate()}this.setOldPropValues(e)},doReverse:function(){var e=this.getOldPropValues(),t=this.getTarget();t.beginUpdate();try{for(var r in this.notifyBeforeModifyingByEditor(t,e),e){var i=e[r];t.setPropValue(r,i)}this.notifyAfterModifyingByEditor(t,e)}finally{t.endUpdate()}}}),Kekule.ChemObjOperation.ModifyHashProp=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.ModifyHashProp",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),t&&this.setPropName(t),r&&this.setNewPropValue(r)},initProperties:function(){this.defineProp("propName",{dataType:DataType.STRING}),this.defineProp("newPropValue",{dataType:DataType.HASH}),this.defineProp("oldPropValue",{dataType:DataType.HASH})},_extendHash:function(e,t){},doExecute:function(){var e=this.getTarget(),t=this.getPropName(),r=e.getPropValue(this.getPropName()),i=Object.extend(Object.extend({},r),this.getNewPropValue(),!1),n={};n[t]=i,e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,n),e.setPropValue(t,i),this.notifyAfterModifyingByEditor(e,n)}finally{e.endUpdate()}this.getOldPropValue()||this.setOldPropValue(r)},doReverse:function(){var e=this.getTarget(),t=this.getPropName(),r=this.getOldPropValue(),i=(e.getPropValue(t),r),n={};n[t]=i,e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,n),e.setPropValue(t,i),this.notifyAfterModifyingByEditor(e,n)}finally{e.endUpdate()}}}),Kekule.ChemObjOperation.MoveTo=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveTo",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,n]),t&&this.setNewCoord(t),this.setCoordMode(r||Kekule.CoordMode.COORD2D),this.setUseAbsBaseCoord(!!i)},initProperties:function(){this.defineProp("newCoord",{dataType:DataType.HASH}),this.defineProp("oldCoord",{dataType:DataType.HASH}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("useAbsBaseCoord",{dataType:DataType.BOOL})},setObjCoord:function(e,t,r){if(e&&t&&r){var i=!1;if(this.getUseAbsBaseCoord()?e.setAbsBaseCoord&&(e.setAbsBaseCoord(t,r,this.getAllowCoordBorrow()),i=!0):e.setCoordOfMode&&(e.setCoordOfMode(t,r),i=!0),!i){var n=e.getClassName?e.getClassName():typeof e;Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_COORD_OF_CLASS").format(n))}}},getObjCoord:function(e,t){if(this.getUseAbsBaseCoord()){if(e.getAbsBaseCoord)return e.getAbsBaseCoord(t,this.getAllowCoordBorrow())}else if(e.getCoordOfMode)return e.getCoordOfMode(t,this.getAllowCoordBorrow());return null},doExecute:function(){var e=this.getTarget();this.getOldCoord()||this.setOldCoord(this.getObjCoord(e,this.getCoordMode())),this.getNewCoord()&&this.setObjCoord(this.getTarget(),this.getNewCoord(),this.getCoordMode())},doReverse:function(){this.getOldCoord()&&this.setObjCoord(this.getTarget(),this.getOldCoord(),this.getCoordMode())}}),Kekule.ChemObjOperation.MoveAndResize=Class.create(Kekule.ChemObjOperation.MoveTo,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResize",initialize:function(e,t,r,i,n,o){this.tryApplySuper("initialize",[e,r,i,n,o])},initProperties:function(){this.defineProp("newDimension",{dataType:DataType.HASH}),this.defineProp("oldDimension",{dataType:DataType.HASH})},setObjSize:function(e,t,r){if(e&&t)if(e.setSizeOfMode)e.setSizeOfMode(t,r);else{var i=e.getClassName?e.getClassName():typeof e;Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_DIMENSION_OF_CLASS").format(i))}},getObjSize:function(e,t){return e.getSizeOfMode?e.getSizeOfMode(t,this.getAllowCoordBorrow()):null},doExecute:function(){this.tryApplySuper("doExecute");var e=this.getTarget();this.getOldDimension()||this.setOldDimension(this.getObjSize(e,this.getCoordMode())),this.getNewDimension()&&this.setObjSize(this.getTarget(),this.getNewDimension(),this.getCoordMode())},doReverse:function(){this.getOldDimension()&&this.setObjSize(this.getTarget(),this.getOldDimension(),this.getCoordMode()),this.tryApplySuper("doReverse")}}),Kekule.ChemObjOperation.MoveAndResizeObjs=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResizeObjs",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[null,i]),e&&this.setObjCoordAndSizeInfo(e),this.setCoordMode(t||Kekule.CoordMode.COORD2D),this.setUseAbsCoord(!!r),this.setPropStoreFieldValue("childOperations",[])},initProperties:function(){this.defineProp("objCoordAndSizeInfo",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("useAbsCoord",{dataType:DataType.BOOL}),this.defineProp("disableIndirectCoord",{dataType:DataType.BOOL}),this.defineProp("childOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("indirectCoordObjs",{dataType:DataType.ARRAY,serializable:!1})},_setEnableIndirectCoordOfObjs:function(e,t){if(e)for(var r=0,i=e.length;r<i;++r)e[r].setEnableIndirectCoord(t)},_prepareIndirectCoordObjs:function(e){var t=[];if(this.getDisableIndirectCoord())for(var r=0,i=e.length;r<i;++r){var n=e[r];if(n&&n instanceof Kekule.ChemObjOperation.MoveAndResize){var o=n.getTarget();o.hasProperty("enableIndirectCoord")&&o.getEnableIndirectCoord()&&(o.setEnableIndirectCoord(!1),t.push(o))}}this.setIndirectCoordObjs(t)},_prepareExecute:function(){var e=this.getChildOperations();if(!e.length){e.length=0;for(var t=this.getObjCoordAndSizeInfo(),r=0,i=t.length;r<i;++r){var n=t[r],o=n.obj,a=new Kekule.ChemObjOperation.MoveAndResize(o,n.newDimension,n.newCoord,this.getCoordMode(),this.getUseAbsCoord(),this.getEditor());a.setAllowCoordBorrow(this.getAllowCoordBorrow()),n.oldDimension&&a.setOldDimension(n.oldDimension),n.oldCoord&&a.setOldCoord(n.oldCoord),e.push(a)}}this._prepareIndirectCoordObjs(e)},_prepareReverse:function(){this.getDisableIndirectCoord()&&(this.getIndirectCoordObjs()||this._prepareIndirectCoordObjs(this.getChildOperations()),this._setEnableIndirectCoordOfObjs(this.getIndirectCoordObjs(),!1))},_doneMoveAndResize:function(){this._setEnableIndirectCoordOfObjs(this.getIndirectCoordObjs(),!0)},doExecute:function(){this.tryApplySuper("doExecute");try{this._prepareExecute();for(var e=this.getChildOperations(),t=0,r=e.length;t<r;++t)e[t].execute()}finally{this._doneMoveAndResize()}},doReverse:function(){try{this._prepareReverse();for(var e=this.getChildOperations(),t=e.length-1;t>=0;--t)e[t].reverse()}finally{this._doneMoveAndResize()}this.tryApplySuper("doReverse")}}),Kekule.ChemObjOperation.StickTo=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.StickTo",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),t&&this.setStickTarget(t)},initProperties:function(){this.defineProp("stickTarget",{dataType:Kekule.ChemObject,serializable:!1}),this.defineProp("oldStickTarget",{dataType:Kekule.ChemObject,serializable:!1})},_canExecute:function(e){return e&&e.getAllowCoordStickTo&&e.getAllowCoordStickTo(this.getStickTarget())},doExecute:function(){this.tryApplySuper("doExecute");var e=this.getTarget();this._canExecute(e)&&(void 0===this.getOldStickTarget()&&this.setOldStickTarget(e.getCoordStickTarget()||null),e.setCoordStickTarget(this.getStickTarget()))},doReverse:function(){this.getTarget().setCoordStickTarget(this.getOldStickTarget()),this.tryApplySuper("doReverse")}}),Kekule.ChemObjOperation.StickTo.canStick=function(e,t,r,i){var n=e&&e.getAllowCoordStickTo&&e.getAllowCoordStickTo(t);if(t&&(n=(n=(n=(n=(n=n&&t&&t.getAbsCoordOfMode)&&t!==e)&&t.getAcceptCoordStickFrom&&t.getAcceptCoordStickFrom(e))&&(!t.getCoordStickTarget||t.getCoordStickTarget()!==e))&&(r||!(t instanceof Kekule.StructureFragment)))&&!i){var o=e.getParent(),a=t.getParent();n=o!==a||!o||!a}return n},Kekule.ChemObjOperation.Add=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Add",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),this.setParentObj(t),this.setRefSibling(r)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:!1})},doExecute:function(){var e=this.getParentObj(),t=this.getTarget();if(e&&t){var r=this.getRefSibling()||null;this.notifyBeforeAddingByEditor(t,e,r),e.insertBefore(t,r),this.notifyAfterAddingByEditor(t,e,r)}},doReverse:function(){var e=this.getTarget(),t=this.getParentObj();if(t&&e){var r=this.getRefSibling();r||(r=e.getNextSibling(),this.setRefSibling(r)),this.notifyBeforeRemovingByEditor(e,t),t.removeChild(e),this.notifyAfterRemovingByEditor(e,t)}}}),Kekule.ChemObjOperation.Remove=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Remove",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),this.setParentObj(t),this.setRefSibling(r)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("ownerObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("removedRelations",{dataType:DataType.ARRAY,serializable:!1})},_isInEditorSelection:function(e){var t=this.getEditor();return(t&&t.getSelection&&t.getSelection()||[]).indexOf(e)>=0},_getRelatedObjRefRelations:function(t){var r=[],i=t.getOwner();if(i){var n=i.findObjRefRelations({dest:t},{checkDestChildren:!0});if(n&&n.length)for(var o=0,a=n.length;o<a;++o){var s=Object.extend({},n[o]);e.isArray(s.dest)&&(s.dest=e.clone(s.dest)),r.push(s)}}return r},_restoreRelations:function(e){if(e)for(var t=0,r=e.length;t<r;++t){var i=e[t];i.srcObj.setPropValue(i.srcProp.name,i.dest)}},doExecute:function(){var e=this.getTarget(),t=this.getParentObj(),r=this.getOwnerObj();if(!t&&e.getParent&&(t=e.getParent(),this.setParentObj(t)),!r&&e.getOwner&&(r=e.getOwner(),this.setOwnerObj(r)),t&&e){if(!this.getRefSibling()){var i=e.getNextSibling?e.getNextSibling():null;this.setRefSibling(i)}var n=this._getRelatedObjRefRelations(e);this.setRemovedRelations(n);var o=this.getEditor(),a=this._isInEditorSelection(e);a&&o.beginUpdateSelection(),this.notifyBeforeRemovingByEditor(e,t),t.removeChild(e),this.notifyAfterRemovingByEditor(e,t),a&&(o.removeFromSelection(e),o.endUpdateSelection())}},doReverse:function(){var e=this.getParentObj(),t=this.getOwnerObj(),r=this.getTarget();if(e&&r){var i=this.getRefSibling();t&&r.setOwner(t),this.notifyBeforeAddingByEditor(r,e,i),e.insertBefore(r,i),this._restoreRelations(this.getRemovedRelations()),this.setRemovedRelations([]),this.notifyAfterAddingByEditor(r,e,i)}}}),Kekule.ChemStructOperation={},Kekule.ChemStructOperation.AddNode=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddNode"}),Kekule.ChemStructOperation.RemoveNode=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveNode",initProperties:function(){this.defineProp("linkedConnectorInfos",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){if(!this.getLinkedConnectorInfos()){for(var e=this.getTarget(),t=e.getLinkedConnectors(),r=[],i=0,n=t.length;i<n;++i){var o,a=t[i],s=e.getActualConnectedObjToConnector(a)||e,l=a.indexOfConnectedObj(e);o=l<0?null:a.getConnectedObjAt(l+1)||null,r.push({connector:a,refSibling:o}),s!==e&&(r.actualLinkedNode=s)}this.setLinkedConnectorInfos(r)}this.tryApplySuper("doExecute")},doReverse:function(){this.tryApplySuper("doReverse");var e=this.getLinkedConnectorInfos();if(e)for(var t=this.getTarget(),r=0,i=e.length;r<i;++r){var n=e[r].connector,o=e[r].refSibling,a=e[r].actualLinkedNode||t;n.insertConnectedObjBefore(a,o)}}}),Kekule.ChemStructOperation.ReplaceNode=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemStructOperation.ReplaceNode",initialize:function(e,t,r,i){this.tryApplySuper("initialize"),this.setOldNode(e),this.setNewNode(t),this.setParentObj(r),this.setEditor(i)},initProperties:function(){this.defineProp("oldNode",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("newNode",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("parentObj",{dataType:"Kekule.ChemStructureFragment",serializable:!1}),this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},_isInEditorSelection:function(e){var t=this.getEditor();return(t&&t.getSelection&&t.getSelection()||[]).indexOf(e)>=0},doExecute:function(){var e=this.getOldNode(),t=this.getNewNode();if(e&&t){var r=this.getParentObj();if(r||(r=e.getParent(),this.setParentObj(r)),r.replaceNode){var i=this.getEditor(),n=this._isInEditorSelection(e);n&&i.beginUpdateSelection(),r.replaceNode(e,t),n&&(i.removeFromSelection(e),i.addObjToSelection(t),i.endUpdateSelection())}}},doReverse:function(){var e=this.getOldNode(),t=this.getNewNode();if(e&&t){var r=this.getParentObj()||t.getParent();if(r.replaceNode){var i=this.getEditor(),n=this._isInEditorSelection(t);n&&i.beginUpdateSelection(),r.replaceNode(t,e),n&&(i.removeFromSelection(t),i.addObjToSelection(e),i.endUpdateSelection())}}}}),Kekule.ChemStructOperation.AddConnector=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddConnector",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,t,r,n]),this.setConnectedObjs(i)},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){this.tryApplySuper("doExecute");var e=Kekule.ArrayUtils.clone(this.getConnectedObjs());e&&e.length&&this.getTarget().setConnectedObjs(e)},doReverse:function(){this.tryApplySuper("doReverse")}}),Kekule.ChemStructOperation.RemoveConnector=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveConnector",initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){this.getConnectedObjs()||this.setConnectedObjs(Kekule.ArrayUtils.clone(this.getTarget().getConnectedObjs())),this.tryApplySuper("doExecute")},doReverse:function(){this.tryApplySuper("doReverse");var e=this.getConnectedObjs();e&&e.length&&this.getTarget().setConnectedObjs(e)}}),Kekule.ChemStructOperation.MergeNodesBase=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesBase",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),this.setDest(t),this.setEnableStructFragmentMerge(r||!1),this._refSibling=null,this._nodeParent=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL}),this.defineProp("mergeConnectorPropsFromTarget",{dataType:DataType.BOOL})},getCommonSiblings:function(e,t){var r=e.getLinkedObjs(),i=t.getLinkedObjs();return Kekule.ArrayUtils.intersect(r,i)},doExecute:function(){},doReverse:function(){}}),Kekule.ChemStructOperation.MergeNodes=Class.create(Kekule.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodes",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,t,r,i]),this._refSibling=null,this._nodeParent=null,this._structFragmentMergeOperation=null,this._removeConnectorOperations=[],this._removeNodeOperation=null,this._modifyConnecorOperations=[]},initProperties:function(){this.defineProp("relinkedConnectors",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("removedConnectors",{dataType:DataType.ARRAY,serializable:!1})},getMergeConnPropsOperation:function(e,t){var r;if(e instanceof Kekule.Bond&&t instanceof Kekule.Bond&&(e.getBondType()===t.getBondType()&&e.getBondType()===Kekule.BondType.COVALENT)){var i=e.getBondOrder();i>t.getBondOrder()&&(r=new Kekule.ChemObjOperation.Modify(t,{bondOrder:i}))}return r},doExecute:function(){var e=this.getMergeConnectorPropsFromTarget(),t=this._modifyConnecorOperations||[],r=this.getTarget(),i=this.getDest(),n=r.getParentFragment(),o=i.getParentFragment();if(n!==o){if(!this.getEnableStructFragmentMerge())return null;this._structFragmentMergeOperation=new Kekule.ChemStructOperation.MergeStructFragment(n,o,this.getEditor()),this._structFragmentMergeOperation.execute(),n=o}this._nodeParent=n,n.beginUpdate();try{var a,s=this.getEditor();if(!(l=this.getRemovedConnectors())){t=[],a=this.getCommonSiblings(r,i);var l=[];if(a.length)for(var u=0,d=a.length;u<d;++u){var c=a[u];(T=r.getConnectorTo(c))&&2==T.getConnectedObjCount()&&l.push(T)}var h=r.getConnectorTo(i);h&&l.push(h),this.setRemovedConnectors(l)}if(!(p=this.getRelinkedConnectors())){var p=Kekule.ArrayUtils.clone(r.getLinkedConnectors())||[];p=Kekule.ArrayUtils.exclude(p,l),this.setRelinkedConnectors(p)}this._refSibling=r.getNextSibling();for(u=0,d=p.length;u<d;++u){var g=(T=p[u]).indexOfConnectedObj(r);T.removeConnectedObj(r),T.insertConnectedObjAt(i,g)}if(e&&!t.length&&l&&l.length){a||(a=this.getCommonSiblings(r,i));for(u=0,d=a.length;u<d;++u){c=a[u];var f=r.getConnectorTo(c);if(l.indexOf(f)>=0){var C=i.getConnectorTo(c);if(C){var m=this.getMergeConnPropsOperation(f,C);m&&t.push(m)}}}}this._removeConnectorOperations=[];for(u=0,d=l.length;u<d;++u){var T=l[u],E=new Kekule.ChemStructOperation.RemoveConnector(T,null,null,s);E.execute(),this._removeConnectorOperations.push(E)}if(this._removeNodeOperation=new Kekule.ChemStructOperation.RemoveNode(r,null,null,s),this._removeNodeOperation.execute(),t){this._modifyConnecorOperations=t;for(u=0,d=t.length;u<d;++u)t[u].execute()}}finally{n.endUpdate()}},doReverse:function(){var e=this.getTarget(),t=this.getDest(),r=this._nodeParent;r.beginUpdate();try{var i=this._modifyConnecorOperations;if(i)for(var n=0,o=i.length;n<o;++n)i[n].reverse();if(this._removeNodeOperation.reverse(),this._removeConnectorOperations.length)for(n=this._removeConnectorOperations.length-1;n>=0;--n){this._removeConnectorOperations[n].reverse()}this._removeConnectorOperations=[];var a=this.getRelinkedConnectors();for(n=0,o=a.length;n<o;++n){var s=a[n],l=s.indexOfConnectedObj(t);s.removeConnectedObj(t),s.insertConnectedObjAt(e,l)}}finally{r.endUpdate()}this._structFragmentMergeOperation&&this._structFragmentMergeOperation.reverse()}}),Kekule.ChemStructOperation.MergeNodes.canMerge=function(e,t,r,i){if(e instanceof Kekule.StructureFragment||t instanceof Kekule.StructureFragment)return!1;if(!(e instanceof Kekule.ChemStructureNode&&t instanceof Kekule.ChemStructureNode))return!1;var n=e.getParent()===t.getParent()||r;return i||(n=n&&!e.getConnectorTo(t)),n},Kekule.ChemStructOperation.MergeNodesPreview=Class.create(Kekule.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesPreview",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,t,r,i]),this._nodeParent=null},doExecute:function(){this._moveNodeOperations=[];var e=this.getTarget(),t=this.getDest(),r=e.getParentFragment(),i=Kekule.CoordMode,n=[i.COORD2D,i.COORD3D];r&&r.beginUpdate();try{for(var o=0,a=n.length;o<a;++o){var s=t.getAbsBaseCoord(n[o],!1),l=new Kekule.ChemObjOperation.MoveTo(e,s,n[o],!0,this.getEditor());l.execute(),this._moveNodeOperations.push(l)}this._nodeParent=r}finally{r&&r.endUpdate()}},doReverse:function(){var e=this._nodeParent;e&&e.beginUpdate();try{for(var t=this._moveNodeOperations,r=t.length-1;r>=0;--r)t[r].reverse()}finally{e&&e.endUpdate()}this._moveNodeOperations=null}}),Kekule.ChemStructOperation.MergeNodesPreview.canMerge=Kekule.ChemStructOperation.MergeNodes.canMerge,Kekule.ChemStructOperation.MergeConnectorsBase=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectorsBase",initialize:function(e,t,r,i,n){this.tryApplySuper("initialize",[e,n]),this.setDest(t),this.setCoordMode(r||Kekule.CoordMode.COORD2D),this.setEnableStructFragmentMerge(i||!1),this._refSibling=null,this._nodeParent=null,this._nodeMergeOperations=[]},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureConnector",serializable:!1}),this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL}),this.defineProp("coordMode",{dataType:DataType.INT})},getMergeNodeOperationClass:function(){},doExecute:function(){Kekule.ChemStructOperation.MergeConnectors.canMerge(this.getTarget(),this.getDest(),this.getEnableStructFragmentMerge())||Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_MERGE_CONNECTORS"));for(var e=this.getCoordMode(),t=[this.getTarget(),this.getDest()],r=Kekule.ArrayUtils,i=r.clone(this.getTarget().getConnectedObjs()),n=r.clone(this.getDest().getConnectedObjs()),o=this.getAllowCoordBorrow(),a=0,s=t.length;a<s;++a){var l=t[a],u=l.getConnectedObjAt(0).getAbsCoordOfMode(e,o),d=l.getConnectedObjAt(1).getAbsCoordOfMode(e,o),c=Kekule.CoordUtils.substract(u,d),h=Math.abs(c.x)>Math.abs(c.y)?"x":"y";Kekule.ObjUtils.notUnset(u.z)&&Math.abs(c.z)>Math.abs(c.x)&&(h="z"),(0===a?i:n).sort(function(t,r){var i=t.getAbsCoordOfMode(e,o),n=r.getAbsCoordOfMode(e,o);return i[h]-n[h]||0})}var p=r.intersect(i,n);i=r.exclude(i,p),n=r.exclude(n,p),this._nodeMergeOperations=[];var g=this.getMergeNodeOperationClass();for(a=0,s=i.length;a<s;++a){if(i[a]!==n[a]){var f=new g(i[a],n[a],this.getEnableStructFragmentMerge());f.execute()}this._nodeMergeOperations.push(f)}},doReverse:function(){for(var e=this._nodeMergeOperations.length-1;e>=0;--e){this._nodeMergeOperations[e].reverse()}this._nodeMergeOperations=[]}}),Kekule.ChemStructOperation.MergeConnectors=Class.create(Kekule.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return Kekule.ChemStructOperation.MergeNodes}}),Kekule.ChemStructOperation.MergeConnectors.canMerge=function(e,t,r){if(!r&&e.getParent()!==t.getParent())return!1;if(e.isConnectingConnector()||t.isConnectingConnector())return!1;var i=e.getConnectedExposedObjs(),n=t.getConnectedObjs();return i.length===n.length&&(2===i.length&&!(Kekule.ArrayUtils.intersect(i,n).length>=1))},Kekule.ChemStructOperation.MergeConnectorsPreview=Class.create(Kekule.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return Kekule.ChemStructOperation.MergeNodesPreview}}),Kekule.ChemStructOperation.MergeConnectorsPreview.canMerge=Kekule.ChemStructOperation.MergeConnectors.canMerge,Kekule.ChemStructOperation.MergeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeStructFragment",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),this.setDest(t),this._removeOperation=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("mergedNodes",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergedConnectors",{dataType:DataType.ARRAY,serializable:!1})},moveChildBetweenStructFragment:function(e,t,r,i){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(e,t,r,i)},doExecute:function(){var e=this.getTarget(),t=this.getDest();if(e&&t){var r=Kekule.ArrayUtils.clone(e.getNodes());this.setMergedNodes(r);var i=Kekule.ArrayUtils.clone(e.getConnectors());this.setMergedConnectors(i),this.moveChildBetweenStructFragment(e,t,r,i);var n=e.getParent();n&&(this._removeOperation=new Kekule.ChemObjOperation.Remove(e,n,null,this.getEditor()),this._removeOperation.execute())}},doReverse:function(){var e=this.getTarget(),t=this.getDest();if(e&&t){this._removeOperation&&(this._removeOperation.reverse(),this._removeOperation=null);var r=this.getMergedNodes(),i=this.getMergedConnectors();this.moveChildBetweenStructFragment(t,e,r,i)}}}),Kekule.ChemStructOperation.SplitStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.SplitStructFragment",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("splittedFragments",{dataType:DataType.ARRAY,serializable:!1,setter:null})},doExecute:function(){var e=Kekule.ChemStructureUtils.splitStructFragment(this.getTarget());if(e.length>1){this.setPropStoreFieldValue("splittedFragments",e);var t=this.getTarget().getParent(),r=this.getTarget().getNextSibling();t.beginUpdate();try{if(t)for(var i=1,n=e.length;i<n;++i){var o=e[i];t.insertBefore(o,r)}}finally{t.endUpdate()}}else this.setPropStoreFieldValue("splittedFragments",null)},doReverse:function(){var e=this.getSplittedFragments();if(e&&e.length)for(var t=this.getTarget(),r=0,i=e.length;r<i;++r){var n=e[r];if(n!==t){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(n,t,Kekule.ArrayUtils.clone(n.getNodes()),Kekule.ArrayUtils.clone(n.getConnectors()));var o=n.getParent();o&&o.removeChild(n),n.finalize()}}}}),Kekule.ChemStructOperation.StandardizeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.StandardizeStructFragment",initialize:function(e,t){this.tryApplySuper("initialize",[e,t]),this.setEnableSplit(!0),this.setEnableRemove(!0),this._concreteOper=null},initProperties:function(){this.defineProp("enableRemove",{dataType:DataType.BOOL}),this.defineProp("enableSplit",{dataType:DataType.BOOL})},doExecute:function(){var e=this.getTarget(),t=e.getNodeCount();this._concreteOper=null;var r=this.getEditor();return t<=0?this.getEnableRemove()&&(this._concreteOper=new Kekule.ChemObjOperation.Remove(e,null,null,r)):this.getEnableSplit()&&(this._concreteOper=new Kekule.ChemStructOperation.SplitStructFragment(e,r)),this._concreteOper?this._concreteOper.execute():null},doReverse:function(){return this._concreteOper?this._concreteOper.reverse():null}}),Kekule.ChemSpaceEditorOperation={},Kekule.ChemSpaceEditorOperation.ChangeSpaceSize=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ChangeSpaceSize",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),this.setCoordMode(r||Kekule.CoordMode.COORD2D),t&&this.setNewSize(t)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("newSize",{dataType:DataType.HASH}),this.defineProp("oldSize",{dataType:DataType.HASH})},doExecute:function(){var e=this.getEditor(),t=this.getTarget();try{var r=this.getCoordMode();this.getOldSize()||this.setOldSize(Object.extend({},t.getSizeOfMode(r,e.getAllowCoordBorrow()))),e.changeChemSpaceSize(this.getNewSize(),r)}finally{}},doReverse:function(){var e=this.getEditor();this.getTarget();if(this.getOldSize())try{var t=this.getCoordMode();e.changeChemSpaceSize(this.getOldSize(),t)}finally{}}}),Kekule.ChemSpaceEditorOperation.ShiftChildrenCoords=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ShiftChildrenCoords",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,i]),this.setCoordMode(r||Kekule.CoordMode.COORD2D),t&&this.setCoordDelta(t)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("coordDelta",{dataType:DataType.HASH})},doExecute:function(){var e=this.getEditor(),t=(this.getTarget(),this.getCoordDelta()),r=this.getCoordMode();try{e._shiftChemSpaceChildCoord(t,r)}finally{}},doReverse:function(){var e=this.getEditor(),t=(this.getTarget(),Kekule.CoordUtils.multiply(this.getCoordDelta(),-1)),r=this.getCoordMode();try{e._shiftChemSpaceChildCoord(t,r)}finally{}}}),Kekule.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords",initialize:function(e,t,r,i,n){this.setPropStoreFieldValue("restoreScrollPosition",!0),this.tryApplySuper("initialize",[e,n]),this.setCoordMode(i||Kekule.CoordMode.COORD2D),t&&this.setNewSize(t),r&&this.setCoordDelta(r)},initProperties:function(){this.defineProp("restoreScrollPosition",{dataType:DataType.BOOL}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("coordDelta",{dataType:DataType.HASH}),this.defineProp("newSize",{dataType:DataType.HASH}),this.defineProp("oldSize",{dataType:DataType.HASH,serializable:!1})},doExecute:function(){var e=this.getEditor(),t=this.getTarget();try{var r,i=this.getCoordMode(),n=this.getRestoreScrollPosition();n&&(r=e.getClientScrollCoord(Kekule.Editor.CoordSys.CHEM)),this.getNewSize()&&(this.getOldSize()||this.setOldSize(Object.extend({},t.getSizeOfMode(i,e.getAllowCoordBorrow()))),e.changeChemSpaceSize(this.getNewSize(),i)),this.getCoordDelta()&&(e._shiftChemSpaceChildCoord(this.getCoordDelta(),i),r=Kekule.CoordUtils.add(r,this.getCoordDelta())),n&&e._registerAfterUpdateObjectProc(function(){e.scrollClientToCoord(r,Kekule.Editor.CoordSys.CHEM)})}finally{}},doReverse:function(){var e=this.getEditor();this.getTarget();if(this.getOldSize()||this.getCoordDelta())try{var t,r=this.getRestoreScrollPosition(),i=this.getCoordMode();r&&(t=e.getClientScrollCoord(Kekule.Editor.CoordSys.CHEM)),this.getCoordDelta()&&(e._shiftChemSpaceChildCoord(Kekule.CoordUtils.multiply(this.getCoordDelta(),-1),i),t=Kekule.CoordUtils.substract(t,this.getCoordDelta())),this.getOldSize()&&e.changeChemSpaceSize(this.getOldSize(),i),this.getRestoreScrollPosition()&&t&&e._registerAfterUpdateObjectProc(function(){e.scrollClientToCoord(t,Kekule.Editor.CoordSys.CHEM)})}finally{}}})}(),Kekule.Editor.StructureUtils={getCascadeDeleteObjs:function(e){return Kekule.ChemStructureUtils.getCascadeDeleteObjs(e)},getSurroundingObjs:function(e){var t=e.getLinkedObjs();if(e instanceof Kekule.ChemStructureConnector){var r=e.getConnectedObjs();Kekule.ArrayUtils.pushUnique(t,r)}return t},calcMostEmptyDirectionAngleOfChemObj:function(e,t,r){var i=[];t||(t=e.getLinkedObjs());for(var n=e.getAbsBaseCoord2D(r),o=0,a=t.length;o<a;++o){var s=t[o].getAbsBaseCoord2D(r);s=Kekule.CoordUtils.substract(s,n);var l=Math.atan2(s.y,s.x);l<0&&(l=2*Math.PI+l),i.push(l)}if(i.sort(),0===(a=i.length))return 0;if(1===a)return-i[0];var u=0,d=0;for(o=0;o<a;++o){var c=i[o],h=i[(o+1)%a]-c;h<0&&(h+=2*Math.PI),h>u&&(u=h,d=o)}return i[d]+u/2},calcPreferred2DBondGrowingDirection:function(e,t,r){var i=e.getAbsBaseCoord2D(r),n=Kekule.Editor.StructureUtils.getSurroundingObjs(e);switch(n?n.length:0){case 0:return t;case 1:var o=n[0].getAbsBaseCoord2D(r),a=Kekule.CoordUtils.substract(o,i),s=Math.atan2(a.y,a.x),l=s-t,u=s+t;return l<0&&(l+=2*Math.PI),u<0&&(u+=2*Math.PI),l!==u?Math.min(l>Math.PI?Math.abs(l-2*Math.PI):l,Math.abs(l-Math.PI))<=Math.min(u>Math.PI?Math.abs(u-2*Math.PI):u,Math.abs(u-Math.PI))?l:u:l;default:return Kekule.Editor.StructureUtils.calcMostEmptyDirectionAngleOfChemObj(e,n,r)}},calcPreferred2DBondGrowingLocation:function(e,t,r,i){var n=e.getAbsBaseCoord2D(i),o=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(e,r,i);return Kekule.CoordUtils.add(n,{x:t*Math.cos(o),y:t*Math.sin(o)})},isBondPropsMatch:function(e,t,r){var i=!0;return i&&r.indexOf("bondType")>=0&&(i=e.bondType==t.bondType||!e.bondType&&!t.bondType),i&&e.bondType===Kekule.BondType.COVALENT&&((i&&r.indexOf("bondOrder")>=0||!e.bondOrder&&!t.bondOrder)&&(i=e.bondOrder==t.bondOrder),i&&r.indexOf("stereo")>=0&&(i=e.stereo==t.stereo||!e.stereo&&!t.stereo)),i&&(i=Kekule.ObjUtils.equal(e,t,["bondType","bondOrder","stereo"])),i},getChemStructureNodeLabel:function(e,t,r){if(e.getIsotopeId){var i=e.getIsotopeId();if(r&&r.includeExplicitHydrogens){var n=e.getExplicitHydrogenCount&&e.getExplicitHydrogenCount();n>0&&(i+="H"),n>1&&(i+=n.toString())}return i}if(e instanceof Kekule.SubGroup){var o=e.getAbbr()||e.getFormulaText();return t&&(o=o||t.getRgroup()),o}var a=e.getCoreDisplayRichTextItem(null,null,t);return Kekule.Render.RichTextUtils.toText(a)},getAllChemStructureNodesLabel:function(e,t,r){for(var i,n=0,o=e.length;n<o;++n){var a=e[n],s=Kekule.Editor.StructureUtils.getChemStructureNodeLabel(a,t,r);if(i){if(i!==s)return null}else i=s}return i},getAllChemStructureNodesHtmlCode:function(e,t,r,i){for(var n,o=0,a=e.length;o<a;++o){var s=e[o].getCoreDisplayRichTextItem(t,r,i),l=Kekule.Render.RichTextUtils.toSimpleHtmlCode(s);if(n){if(n!==l)return null}else n=l}return n},getStructureCenterAbsBaseCoord:function(e,t,r){for(var i=null,n=Kekule.CoordUtils.add,o=e.getNodeCount(),a=0;a<o;++a){var s=e.getNodeAt(a).getAbsBaseCoord(t,r);i=i?n(i,s):s}return i=Kekule.CoordUtils.divide(i,o)}},Kekule.Editor.RepositoryStructureUtils={_calcNodeMergeAdjustRotateAngle:function(e,t,r){var i=0,n=e.getCoordMode();if(n!==Kekule.CoordMode.COORD3D){var o=e.getAllowCoordBorrow(),a=e.getEditorConfigs().getStructureConfigs(),s=Kekule.Editor.StructureUtils.getSurroundingObjs(t),l=Kekule.Editor.StructureUtils.getSurroundingObjs(r);if(1===s.length){var u=(h=t.getLinkedConnectorAt(0)).getBondOrder?h.getBondOrder():0,d=a.getNewBondDefAngle(r,u);p=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(r,d,o);var c=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(t,s[0],n,o);i=p-Math.atan2(c.y,c.x)}else if(1===l.length){u=(h=r.getLinkedConnectorAt(0)).getBondOrder?h.getBondOrder():0,d=a.getNewBondDefAngle(t,u);var h,p=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(t,d,o);c=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(r,l[0],n,o),i=Math.atan2(c.y,c.x)-p}else{d=a.getNewBondDefAngle(r,null),p=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(r,d,o);for(var g={},f=0,C=s.length;f<C;++f){c=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(t,s[f],n,o);var m=Math.atan2(c.y,c.x);(Kekule.ObjUtils.isUnset(g.min)||m<g.min)&&(g.min=m),(Kekule.ObjUtils.isUnset(g.max)||m>g.max)&&(g.max=m)}i=p-(g.max+g.min)/2}}return i},_calcConnectorMergeTransformParams:function(e,t,r){var i=t.getConnectedObjAt(0),n=t.getConnectedObjAt(1),o=r.getConnectedObjAt(0),a=r.getConnectedObjAt(1),s=e.getObjCoord(i),l=e.getObjCoord(n),u=e.getObjCoord(o),d=e.getObjCoord(a);return Kekule.CoordUtils.calcCoordGroup2DTransformParams(s,l,d,u)},calcRepObjInitialTransformParams:function(e,t,r,i,n){var o,a=r.baseObjCoord,s=e.getDefBondLength()/t.getRefLength(),l=a;if(r.mergeObj&&(i=r.mergeDest||i))if(n=e.getObjectScreenCoord(i),r.mergeObj instanceof Kekule.ChemStructureNode&&i instanceof Kekule.ChemStructureNode)o=Kekule.Editor.RepositoryStructureUtils._calcNodeMergeAdjustRotateAngle(e,r.mergeObj,i);else if(r.mergeObj instanceof Kekule.ChemStructureConnector&&i instanceof Kekule.ChemStructureConnector)return Kekule.Editor.RepositoryStructureUtils._calcConnectorMergeTransformParams(e,r.mergeObj,i);var u=e.translateCoord(n,Kekule.Editor.CoordSys.SCREEN,Kekule.Editor.CoordSys.CHEM);return a&&(u=Kekule.CoordUtils.substract(u,a)),{scale:s,translateX:u.x,translateY:u.y,translateZ:u.z,rotateAngle:o,center:l}},transformChemObjectsCoordAndSize:function(e,t,r){var i=e.getCoordMode(),n=e.getAllowCoordBorrow(),o=i===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(r):Kekule.CoordUtils.calcTransform2DMatrix(r),a=Object.extend({},r);a=Object.extend(a,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});for(var s=i===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(a):Kekule.CoordUtils.calcTransform2DMatrix(a),l=0,u=t.length;l<u;++l){var d=t[l];d.transformAbsCoordByMatrix(o,s,i,!0,n),d.scaleSize(r.scale,i,!0,n)}}},Kekule.Editor.OperationUtils={createNodeModificationOperation:function(e,t,r,i,n){var o,a,s=e.getClass();if(t&&!r&&(r=t.getClass()),t||r!==s){o=new Kekule.MacroOperation,t||(t=new r);var l=new Kekule.ChemStructureNode;l.assign(e),t.assign(l);var u=new Kekule.ChemStructOperation.ReplaceNode(e,t,null,n);o.add(u)}else t=e;return i&&(Kekule.ObjUtils.match(t,i)||(a=new Kekule.ChemObjOperation.Modify(t,i,n),o&&o.add(a))),o||a},createNodeModificationOperationFromData:function(e,t,r){if(!t)return null;var i,n=t.nodeClass,o=t.props,a=t.repositoryItem;if(a){var s=a.createObjects(e)||{},l=s.objects,u=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(r,a,s,e,null);r.transformCoordAndSizeOfObjects(l,u),n=(i=l[0]).getClass()}if(t.isUnknownPseudoatom&&!r.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()&&(n=null),n){if(o){var d=Object.extend({},o);if(e.getExplicitHydrogenCount&&e.getExplicitHydrogenCount()&&(d.explicitHydrogenCount=null),d.inputHydrogenCount&&d.isotopeId){var c,h=i||e;if(h&&h.getDisableImplicitHydrogenEstimation&&h.getDisableImplicitHydrogenEstimation())c=0;else{var p=e._getCurrCovalentBondsInfo&&e._getCurrCovalentBondsInfo()||{},g=e._getCurrIonicBondsInfo&&e._getCurrIonicBondsInfo()||{},f=Kekule.IsotopesDataUtil.getIsotopeIdDetail(d.isotopeId).symbol,C=Kekule.ChemicalElementsDataUtil.getAtomicNumber(f),m=Math.round(e.getCharge&&e.getCharge()||0),T=e.getRadical?Kekule.RadicalOrder.getRadicalElectronCount(e.getRadical()):0;c=Kekule.ChemStructureUtils.getImplicitHydrogenCount(C,{coValenceBondValenceSum:p.valenceSum||0,otherBondValenceSum:g.valenceSum||0,charge:m,radicalECount:T})}c!==d.inputHydrogenCount&&(d.explicitHydrogenCount=d.inputHydrogenCount,delete d.inputHydrogenCount)}}return Kekule.Editor.OperationUtils.createNodeModificationOperation(e,i,n,d,r)}return Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL")),null}},function(){"use strict";var e=Class.PropertyScope;Kekule.Editor.BaseEditorConfigs=Class.create(Kekule.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.Editor.BaseEditorConfigs",initProperties:function(){this.addConfigProp("uiMarkerConfigs","Kekule.EditorConfigs.UiMarkerConfigs"),this.addConfigProp("interactionConfigs","Kekule.EditorConfigs.InteractionConfigs"),this.addConfigProp("structureConfigs","Kekule.Editor.StructureConfigs"),this.addConfigProp("hotKeyConfigs","Kekule.Editor.HotKeyConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("uiMarkerConfigs",new Kekule.Editor.UiMarkerConfigs),this.setPropStoreFieldValue("interactionConfigs",new Kekule.Editor.InteractionConfigs),this.setPropStoreFieldValue("structureConfigs",new Kekule.Editor.StructureConfigs),this.setPropStoreFieldValue("hotKeyConfigs",new Kekule.Editor.HotKeyConfigs)}}),Kekule.Editor.ChemSpaceEditorConfigs=Class.create(Kekule.Editor.BaseEditorConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditorConfigs",initProperties:function(){this.addConfigProp("chemSpaceConfigs","Kekule.Editor.ChemSpaceConfigs"),this.addConfigProp("styleSetterConfigs","Kekule.Editor.StyleSetterConfigs",void 0,{scope:e.PUBLIC})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("chemSpaceConfigs",new Kekule.Editor.ChemSpaceConfigs),this.setPropStoreFieldValue("styleSetterConfigs",new Kekule.Editor.StyleSetterConfigs)}}),Kekule.ClassUtils.makeSingleton(Kekule.Editor.ChemSpaceEditorConfigs),Kekule.Editor.InteractionConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.InteractionConfigs",initProperties:function(){var t=Math.PI/180;this.addBoolConfigProp("enableTrackOnNearest",!0),this.addBoolConfigProp("enableHotTrack",!0),this.addBoolConfigProp("scrollToObjAfterLoading",!0),this.addBoolConfigProp("autoExpandClientSizeAfterLoading",!0),this.addBoolConfigProp("autoExpandClientSizeAfterManipulation",!1),this.addBoolConfigProp("autoSelectNewlyInsertedObjects",!1),this.addBoolConfigProp("autoSelectNewlyInsertedObjectsOnTouch",!0),this.addIntConfigProp("objBoundTrackMinInflation",5),this.addIntConfigProp("objBoundTrackMinInflationMouse",null),this.addIntConfigProp("objBoundTrackMinInflationPen",null),this.addIntConfigProp("objBoundTrackMinInflationTouch",10),this.addFloatConfigProp("objBoundTrackInflationRatio",.2),this.addFloatConfigProp("objBoundTrackInflationRatioMouse",null),this.addFloatConfigProp("objBoundTrackInflationRatioPen",null),this.addFloatConfigProp("objBoundTrackInflationRatioTouch",.33),this.addBoolConfigProp("enablePartialAreaSelecting",!1),this.addFloatConfigProp("selectingBrushWidth",12),this.addBoolConfigProp("enableOffSelectionManipulation",!0),this.addIntConfigProp("offSelectionManipulationActivatingTimeThreshold",800),this.addFloatConfigProp("unmovePointerDistanceThreshold",5,{scope:e.PUBLIC}),this.addIntConfigProp("selectingCurveSimplificationDistanceThreshold",2,{scope:e.PUBLIC}),this.addIntConfigProp("selectionMarkerInflation",5),this.addIntConfigProp("selectionMarkerEdgeInflation",5),this.addIntConfigProp("selectionMarkerDefPulseDuration",500),this.addIntConfigProp("selectionMarkerDefPulseCount",2),this.addBoolConfigProp("followPointerCoordOnDirectManipulatingSingleObj",!0),this.addIntConfigProp("followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold",2),this.addFloatConfigProp("constrainedResizeStep",.125),this.addIntConfigProp("rotationRegionInflation",10),this.addFloatConfigProp("constrainedRotateStep",7.5*t),this.addIntConfigProp("rotationLocationPointDistanceThreshold",10),this.addIntConfigProp("directedMoveDistanceThreshold",10),this.addBoolConfigProp("enableMergePreview",!0),this.addBoolConfigProp("enableMagneticMerge",!0),this.addBoolConfigProp("enableNodeMerge",!0),this.addBoolConfigProp("enableNeighborNodeMerge",!0),this.addBoolConfigProp("enableConnectorMerge",!0),this.addBoolConfigProp("enableStructFragmentMerge",!0),this.addBoolConfigProp("enableGestureManipulation",!0),this.addBoolConfigProp("enableGestureZoomOnEditor",!0),this.addBoolConfigProp("enableHotKey",!0),this.addIntConfigProp("clonedObjectScreenOffset",10),this.addIntConfigProp("atomSetterFontSize",14),this.addBoolConfigProp("allowUnknownAtomSymbol",!0),this.addBoolConfigProp("enableBondKekulizeHucklize",!0),this.addIntConfigProp("trackSimplifierDistanceThreshold",8),this.addIntConfigProp("trackSimplifierIgnoreSegmentThreshold",10),this.addIntConfigProp("trackMergeDistanceThreshold",20),this.addFloatConfigProp("trackOptimizationAngleConstraint",30*t),this.addConfigProp("trackOptimizationDistanceConstraints",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addIntConfigProp("trackOptimizationPrimaryDistanceConstraint",1),this.addFloatConfigProp("trackTouchRefLength",.5,{scope:e.PUBLIC}),this.addBoolConfigProp("autoAdjustZoomLevelOnTrackTouching",!1,{scope:e.PUBLIC}),this.addFloatConfigProp("editorInitialZoom",1.5)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setTrackOptimizationDistanceConstraints([.5,1,3,4,5])}}),Kekule.Editor.UiMarkerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.UiMarkerConfigs",initProperties:function(){this.addStrConfigProp("hotTrackerColor","#0000FF"),this.addFloatConfigProp("hotTrackerOpacity",.5),this.addStrConfigProp("selectionMarkerStrokeColor","#0000FF"),this.addFloatConfigProp("selectionMarkerStrokeWidth",2),this.addStrConfigProp("selectionMarkerFillColor","#0000FF"),this.addFloatConfigProp("selectionMarkerOpacity",.2),this.addFloatConfigProp("selectionMarkerEmphasisOpacity",.4),this.addFloatConfigProp("selectionTransformMarkerSize",8,{scope:e.PUBLIC}),this.addFloatConfigProp("selectionTransformMarkerOpacity",.4,{scope:e.PUBLIC}),this.addStrConfigProp("selectingMarkerStrokeColor","#000000"),this.addFloatConfigProp("selectingMarkerStrokeWidth",1),this.addStrConfigProp("selectingMarkerStrokeDash",!0),this.addStrConfigProp("selectingMarkerFillColor",null),this.addFloatConfigProp("selectingMarkerOpacity",.7),this.addStrConfigProp("selectingBrushMarkerStrokeColor","#0000FF"),this.addStrConfigProp("selectingBrushMarkerStrokeDash",!1),this.addFloatConfigProp("selectingBrushMarkerStrokeLineCap","round"),this.addFloatConfigProp("selectingBrushMarkerStrokeLineJoin","round"),this.addFloatConfigProp("selectingBrushMarkerOpacity",.3),this.addStrConfigProp("trackMarkerStrokeColor","#0000AA"),this.addFloatConfigProp("trackMarkerStrokeWidth",2),this.addStrConfigProp("trackMarkerStrokeDash",!1),this.addFloatConfigProp("trackMarkerOpacity",.5),this.addHashConfigProp("issueCheckMarkerColors",{error:{strokeColor:"#FF0000",fillColor:null,activeStrokeColor:"#FF0000",activeFillColor:"#FF6666"},warning:{strokeColor:"#f1a200",fillColor:null,activeStrokeColor:"#f1a200",activeFillColor:"#ffdb15"},note:{strokeColor:"#00b0f0",fillColor:null,activeStrokeColor:"#007ca8",activeFillColor:"#00b0f0"},log:{strokeColor:"#00b0f0",fillColor:null,activeStrokeColor:"#007ca8",activeFillColor:"#00b0f0"}}),this.addFloatConfigProp("issueCheckMarkerStrokeWidth",2),this.addFloatConfigProp("issueCheckActiveMarkerStrokeWidth",2),this.addStrConfigProp("issueCheckMarkerOpacity",.3),this.addStrConfigProp("issueCheckActiveMarkerOpacity",.6),this.addStrConfigProp("flexStructureAssocMarkerColor","#0000AA"),this.addFloatConfigProp("flexStructureAssocMarkerOpacity",.5),this.addIntConfigProp("flexStructureAssocMarkerFontSize",14),this.addStrConfigProp("flexStructureAssocMarkerFontFamily","Arial, Helvetica, sans-serif")}}),Kekule.Editor.StructureConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StructureConfigs",initProperties:function(){this.addStrConfigProp("defBondType",Kekule.BondType.DEFAULT,{enumSource:Kekule.BondType}),this.addIntConfigProp("defBondOrder",Kekule.BondOrder.SINGLE,{enumSource:Kekule.BondOrder}),this.addFloatConfigProp("defBondLength",Kekule.globalOptions.structure.defaultBondLength2D||.8),this.addConfigProp("defBondAngles",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addFloatConfigProp("bondConstrainedDirectionDelta",void 0,{scope:e.PUBLIC}),this.addConfigProp("bondConstrainedDirectionAngles",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addFloatConfigProp("bondConstrainedDirectionAngleThreshold",void 0,{scope:e.PUBLIC}),this.addFloatConfigProp("initialBondDirection",void 0,{scope:e.PUBLIC}),this.addStrConfigProp("defIsotopeId","C"),this.addConfigProp("primaryOrgChemAtoms",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addIntConfigProp("maxFlexChainAtomCount",0),this.addIntConfigProp("minFlexRingAtomCount",3),this.addIntConfigProp("maxFlexRingAtomCount",18),this.addHashConfigProp("enabledNonAtomNodeTypes",{RGroup:!0,pseudoatomDummy:!0,pseudoatomHetero:!0,pseudoatomAny:!0,variableAtomList:!0,variableAtomNotList:!0}),this.addHashConfigProp("enabledBondForms",{single:!0,double:!0,triple:!0,quad:!0,explicitAromatic:!0,up:!0,upInverted:!0,down:!0,downInverted:!0,upOrDown:!0,eOrZ:!0,closer:!0,ionic:!1,coordinate:!1,metallic:!1,hydrogen:!0,transition:!0})},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Math.PI/180,t=[],r=Kekule.BondOrder,i=2*Math.PI/3;t[0]=i,t[r.EXPLICIT_AROMATIC]=[i],t[r.TRIPLE]=[Math.PI],t[r.DOUBLE]=[i],t[r.DOUBLE][r.DOUBLE]=Math.PI,t[r.SINGLE]=[i],this.setDefBondAngles(t),this.setBondConstrainedDirectionDelta(10*Math.PI/180),this.setBondConstrainedDirectionAngles([0,90*e,180*e,270*e]),this.setBondConstrainedDirectionAngleThreshold(3*e),this.setInitialBondDirection(30*e),this.setPrimaryOrgChemAtoms(["C","H","O","N","P","S","F","Cl","Br","I","Si","D","C13"])},getDefAngleOfBonds:function(e,t){var r=e||0,i=t||0;r>i&&(r=t||0,i=e||0);var n=this.getDefBondAngles(),o=n[i];return o?o[r]||o[0]:n[0]},getNewBondDefAngle:function(e,t){var r;Kekule.ObjUtils.isUnset(t)&&(t=this.getDefBondOrder());var i=Kekule.Editor.StructureUtils.getSurroundingObjs(e);if(1===i.length){var n=e.getLinkedConnectorAt(0);if(n&&n.getConnectedObjs().indexOf(i[0])>=0){var o=n.getBondOrder?n.getBondOrder():null;Kekule.ObjUtils.notUnset(o)&&(r=this.getDefAngleOfBonds(t,o))}}else r=0===i.length?this.getInitialBondDirection():this.getDefAngleOfBonds(t,0);return r}}),Kekule.Editor.ChemSpaceConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceConfigs",initProperties:function(){this.addHashConfigProp("defScreenSize2D"),this.addHashConfigProp("defScreenSize3D"),this.addHashConfigProp("autoExpandScreenSize2D"),this.addHashConfigProp("autoExpandScreenSize3D"),this.addNumConfigProp("defPadding",50)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDefScreenSize2D({x:900,y:1500}),this.setDefScreenSize3D({x:600,y:600,z:600}),this.setAutoExpandScreenSize2D({x:200,y:200}),this.setAutoExpandScreenSize3D({x:100,y:100,z:100})}}),Kekule.Editor.StyleSetterConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StyleSetterConfigs",initProperties:function(){this.defineProp("listedFontSizes",{dataType:DataType.ARRAY}),this.defineProp("listedFontNames",{dataType:DataType.ARRAY})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setListedFontSizes([8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88,96]),this.setListedFontNames(Kekule.Widget.FontEnumerator.getAvailableFontFamilies())}}),Kekule.Editor.HotKeyConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.HotKeyConfigs",initProperties:function(){this.defineProp("hotKeys",{dataType:DataType.ARRAY})},initPropValues:function(){var e=Kekule.ChemWidget.ComponentWidgetNames;this.tryApplySuper("initPropValues"),this.setHotKeys([{key:"c",action:"atom_C"},{key:"h",action:"atom_H"},{key:"o",action:"atom_O"},{key:"n",action:"atom_N"},{key:"p",action:"atom_P"},{key:"s",action:"atom_S"},{key:"f",action:"atom_F"},{key:"Shift+C",action:"atom_Cl"},{key:"b",action:"atom_Br"},{key:"i",action:"atom_I"},{key:"Shift+B",action:"atom_B"},{key:"k",action:"atom_K"},{key:"Shift+N",action:"atom_Na"},{key:"d",action:"atom_D"},{key:"m",action:"subgroup_methyl"},{key:"e",action:"subgroup_ethyl"},{key:"t",action:"subgroup_TMS"},{key:"Shift+P",action:"subgroup_phenyl"},{key:"Shift+T",action:"subgroup_OTs"},{key:"Shift+E",action:"subgroup_COOCH3"},{key:"a",action:"atom_any"},{key:"q",action:"atom_hetero"},{key:"l",action:"atom_variable"},{key:"r",action:"subgroup_R"},{key:"1",action:"bond_single"},{key:"2",action:"bond_double"},{key:"3",action:"bond_triple"},{key:"4",action:"bond_quad"},{key:"b",action:"bond_closer"},{key:"w",action:"bond_up"},{key:"h",action:"bond_down"},{key:"Shift+W",action:"bond_down"},{key:"y",action:"bond_upOrDown"},{key:"Ctrl+A",action:e.selectAll},{key:"Ctrl+C",action:e.copy},{key:"Ctrl+X",action:e.cut},{key:"Ctrl+V",action:e.paste},{key:"Ctrl+Z",action:e.undo},{key:"Ctrl+Shift+Z",action:e.redo},{key:"+",action:e.zoomIn},{key:"-",action:e.zoomOut},{key:"Delete",action:e.eraseSelection},{key:"Backspace",action:e.eraseSelection}])}})}(),Kekule.Editor.RepositoryData={subGroups:[{name:"methyl",inputTexts:["Me","CH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Thu, 15 Sep 2016 15:49:02 GMT"},"__type__":"object"},"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Me","__type__":"Kekule.SubGroup"}'},{name:"ethyl",inputTexts:["Et","C2H5"],structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Et","__type__":"Kekule.SubGroup"}'},{name:"n-propyl",inputTexts:["n-Pr","nPr","C3H7"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Pr","formulaText":"C3H7","__type__":"Kekule.SubGroup"}'},{name:"i-propyl",inputTexts:["i-Pr","iPr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Pr","__type__":"Kekule.SubGroup"}'},{name:"n-butyl",inputTexts:["n-Bu","nBu","C4H9"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Bu","formulaText":"C4H9","__type__":"Kekule.SubGroup"}'},{name:"i-butyl",inputTexts:["i-Bu","iBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Bu","__type__":"Kekule.SubGroup"}'},{name:"s-butyl",inputTexts:["s-Bu","sBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"s-Bu","__type__":"Kekule.SubGroup"}'},{name:"t-butyl",inputTexts:["t-Bu","tBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"t-Bu","__type__":"Kekule.SubGroup"}'},{name:"phenyl",inputTexts:["Ph","C6H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ph","formulaText":"C6H5","__type__":"Kekule.SubGroup"}'},{name:"benzyl",inputTexts:["Bn"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bn","__type__":"Kekule.SubGroup"}'},{name:"benzoyl",inputTexts:["Bz"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bz","__type__":"Kekule.SubGroup"}'},{inputTexts:["CF3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CF3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CCl3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CCl3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CBr3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CBr3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CI3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CI3","__type__":"Kekule.SubGroup"}'},{inputTexts:["OMe","OCH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["OEt","OC2H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ot-Bu","OtBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275525,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275454,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.7763568394002505e-15,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ot-Bu","__type__":"Kekule.SubGroup"}'},{inputTexts:["CO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO","__type__":"Kekule.SubGroup"}'},{inputTexts:["CHO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CHO","__type__":"Kekule.SubGroup"}'},{name:"carboxyl",inputTexts:["COOH","CO2H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOH","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOOH","CO3H","CO2OH"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["COONa"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Na"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COONa","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOK"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"K"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOK","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOCH3","COOMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOC2H5","COOEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.039230484541326,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["COCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["COBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COBr","__type__":"Kekule.SubGroup"}'},{inputTexts:["CONH2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CONH2","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ac"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ac","__type__":"Kekule.SubGroup"}'},{inputTexts:["OAc"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OAc","__type__":"Kekule.SubGroup"}'},{inputTexts:["MeCO","COMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.3464101615137771,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.3464101615137771,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["EtCO","COEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COEt","__type__":"Kekule.SubGroup"}'},{name:"hydroxymethyl",inputTexts:["CH2OH"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999968,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CH2OH","__type__":"Kekule.SubGroup"}'},{inputTexts:["NMe2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NMe2","__type__":"Kekule.SubGroup"}'},{name:"nitro",inputTexts:["NO2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO2","__type__":"Kekule.SubGroup"}'},{name:"nitroso",inputTexts:["NO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO","__type__":"Kekule.SubGroup"}'},{name:"diazo",inputTexts:["N2","NN","N2 +"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Cl","NNCl","N2 +Cl-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +Cl-","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Br","NNBr","N2 +Br-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +Br-","__type__":"Kekule.SubGroup"}'},{name:"nitrile group",inputTexts:["CN"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CN","__type__":"Kekule.SubGroup"}'},{name:"pyridyl",inputTexts:["Py"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Py","__type__":"Kekule.SubGroup"}'},{name:"sulfonic group",inputTexts:["SO3H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000213,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000213,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.399999999999995,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Cl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Cl","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Br"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Br","__type__":"Kekule.SubGroup"}'},{inputTexts:["TMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"TMS","__type__":"Kekule.SubGroup"}'},{inputTexts:["OTMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTMS","__type__":"Kekule.SubGroup"}'},{name:"OTs",inputTexts:["OTs","OTS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":1.399999999999988,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":1.7999999999999936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275507,"y":1.399999999999988,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.SubGroup","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":-1.7999999999999936,"__type__":"object"},"charge":0,"parity":null}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[9,10]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTs","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgBr","__type__":"Kekule.SubGroup"}'}],fragments:[{name:"methane",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Sat, 25 Feb 2017 04:21:08 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"fischer1",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer2",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer3",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999972,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.6000000000000085,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,10]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"sawhorseStaggered",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:51:35 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34060000000000024,"y":-0.642199999999999,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.37219999999999764,"y":-1.0575999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.0877999999999997,"y":-0.648899999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3686000000000007,"y":-1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34060000000000024,"y":0.6422000000000061,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.0877999999999997,"y":0.6489000000000011,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3686000000000007,"y":1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"zIndex2D":0,"coord2D":{"x":0.3722000000000012,"y":1.0576000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-6","__type__":"Kekule.Molecule"}'},{name:"sawhorseEclipsed",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:50:51 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3022000000000009,"y":0.4405000000000001,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.4229000000000003,"y":0.8340999999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.1265,"y":0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"coord2D":{"x":0.44500000000000206,"y":1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.1265,"y":-1.6214000000000084,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.4015000000000004,"y":-1.2276999999999987,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3013999999999992,"y":-1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.38010000000000055,"y":-0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-5","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:43:26 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.5715736151962387,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9715297072546738,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.20235354281841378,"y":-0.12653156366939555,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.5714766561436155,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9715297072546738,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.20225658376579414,"y":0.1266285227220152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:44:10 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9716412105880998,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.5715992908679759,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.20239696641355032,"y":-0.14362717166194017,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9716412105880998,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.571696270727303,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.20239696641355032,"y":0.14372415152126905,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-2","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:47:35 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4999174283497734,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.4999174283497734,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:47:08 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.49991742834977515,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.49991742834977515,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":10,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:48:11 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.48039814732735664,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4815600495278858,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0006293636919529888,"y":-0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:48:04 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.4804171472781027,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":-1,"coord2D":{"x":-0.48158784071773564,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0005848625620670234,"y":-0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[4,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"substituentMark",dataFormat:"Kekule-JSON",scale:.7,structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Pseudoatom","coordPos2D":0,"coordPos3D":0,"renderOptions":{"nodeDisplayMode":-1,"__type__":"object"},"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"atomType":"any","symbol":"A"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"renderOptions":{"opacity":0.5,"__type__":"object"},"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'}]},function(){"use strict";Kekule.Editor.AbstractRepositoryItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.AbstractRepositoryItem",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAvailableCoordModes:function(){return[]},createObjects:function(e,t){},getScale:function(){return this.doGetScale()||1},doGetScale:function(){return 1},getRefLength:function(){return this.doGetRefLength()/(this.getScale()||1)},doGetRefLength:function(){},isOneStructureFragmentObj:function(){return!1}}),Kekule.Editor.MolRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.MolRepositoryItem2D",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("molScale",{dataType:DataType.FLOAT}),this.defineProp("molManipulationCenterCoord",{dataType:DataType.HASH}),this.defineProp("molManipulationDefDirectionCoord",{dataType:DataType.HASH})},doGetScale:function(){return this.getMolScale()||this.tryApplySuper("doGetScale")},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},isOneStructureFragmentObj:function(){return!0},createObjects:function(e,t){var r=this.doCreateObjects(e,t);if(!r)return null;var i=null,n=null,o={x:0,y:0};return e&&(i=e instanceof Kekule.ChemStructureNode?this.doGetMergableNode(r,e):e instanceof Kekule.ChemStructureConnector?this.doGetMergableConnector(r,e):null)&&(n=e,o=i.getAbsBaseCoord2D()),{objects:[r],mergeObj:i,mergeDest:n,baseObjCoord:o,centerCoord:{x:0,y:0}}},doCreateObjects:function(e,t){return null},doGetMergableNode:function(e,t){return null},doGetMergableConnector:function(e,t){return null}}),Kekule.Editor.StoredStructFragmentRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredStructFragmentRepositoryItem2D",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.beginUpdate();try{t&&this.setDataFormat(t),e&&this.setStructData(e),r&&this.setMolScale(r)}finally{this.endUpdate()}},initProperties:function(){this.defineProp("structureFragment",{dataType:"Kekule.StructureFragment",setter:null,serializable:!1}),this.defineProp("structData",{dataType:DataType.STRING}),this.defineProp("dataFormat",{dataType:DataType.STRING})},objectChange:function(e){if(this.tryApplySuper("objectChange",[e]),e.indexOf("structData")>=0||e.indexOf("dataFormat")>=0){var t=null;this.getStructData()&&(t=this._createTemplateStructFragment()),this.setPropStoreFieldValue("structureFragment",t)}},_createTemplateStructFragment:function(){var e=null;return this.getStructData()&&(e=Kekule.IO.loadFormatData(this.getStructData(),this.getDataFormat()||Kekule.IO.DataFormat.KEKULE_JSON)),e&&this._adjustTemplateStructureFragmentCoords(e),e},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var t=Kekule.Render.ObjUtils.getContainerBox(e,Kekule.CoordMode.COORD2D,!0);if(t){e.getCoordOfMode&&e.getCoordOfMode(Kekule.CoordMode.COORD2D,!0);var r={};r.x=-(t.x2+t.x1)/2,r.y=-(t.y2+t.y1)/2,e.beginUpdate();try{for(var i=0,n=e.getNodeCount();i<n;++i){var o=e.getNodeAt(i),a=o.getCoord2D(!0);a=Kekule.CoordUtils.add(a,r),o.setCoord2D(a)}}finally{e.endUpdate()}}},doGetRefLength:function(){var e=this.getStructureFragment();return e?e.getConnectorLengthMedian(Kekule.CoordMode.COORD2D,!0):0},doCreateObjects:function(e,t){var r=this.getStructureFragment();return r?r.clone():null},doGetMergableNode:function(e,t){return e.getAnchorNodeAt(0)||e.getNodeAt(0)},doGetMergableConnector:function(e,t){return null}}),Kekule.Editor.StoredSubgroupRepositoryItem2D=Class.create(Kekule.Editor.StoredStructFragmentRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredSubgroupRepositoryItem2D",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("inputTexts",{dataType:DataType.STRING})},doCreateObjects:function(e,t){var r=this.getStructureFragment();if(r){var i=new Kekule.SubGroup;return i.assign(r,!1),i}return null},createObjects:function(e){return this.tryApplySuper("createObjects",[e])},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var t=e.getCurrConnectableObj();if(t){var r=Kekule.CoordUtils.substract({x:0,y:0},t.getCoord2D(!0));e.beginUpdate();try{for(var i=0,n=e.getNodeCount();i<n;++i){var o=e.getNodeAt(i),a=o.getCoord2D(!0);a=Kekule.CoordUtils.add(a,r),o.setCoord2D(a)}}finally{e.endUpdate()}}}}),Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText=function(e){for(var t=Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[],r=0,i=t.length;r<i;++r){var n=t[r];if((n.getInputTexts()||[]).indexOf(e)>=0)return n}return null},Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems=function(){return Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[]},Kekule.Editor.MolRingRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolRingRepositoryItem2D",initialize:function(e,t){this.tryApplySuper("initialize"),this.setRingAtomCount(e),this.setBondLength(t||1)},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT}),this.defineProp("bondLength",{dataType:DataType.FLOAT,setter:function(e){e!==this.getBondLength()&&this.setPropStoreFieldValue("bondLength",e)}}),this.defineProp("isAromatic",{dataType:DataType.BOOL}),this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnableCoordCache()&&(this.setPropStoreFieldValue("enableCoordCache",e),e&&!this._coordCache&&this._initCoordCache())}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(e,t){var r=t&&t.originalStructFragment;return this.generateRing(r)},doGetMergableNode:function(e,t){return e.getNodeAt(0)},doGetMergableConnector:function(e,t){return e.getConnectorAt(0)},generateRing:function(e,t){var r;t||(t=Kekule.Molecule),r=e||new t;var i=this.getRingAtomCount();r.beginUpdate();try{r.setCoord2D({x:0,y:0});var n,o=r.getNodeCount();if(o>i)for(var a=o-1;a>=i;--a)r.removeNodeAt(a);for(a=r.getConnectorCount()-1;a>=0;--a)r.removeConnectorAt(a);n=this.getEnableCoordCache()&&this._hasCoordCache(i)?this._getCachedCoords(i):this._calcAtomCoords(i);var s,l,u,d=this.getBondLength();for(a=0;a<i;++a){var c=r.getNodeAt(a);c||(c=this._generateAtom(a),r.appendNode(c));var h=n[a];if(1!==d&&(h=Kekule.CoordUtils.multiply(h)),c.setCoord2D(h),0===a&&(u=c),s){var p=this._generateBond(l,a);r.appendConnector(p),p.appendConnectedObj(s),p.appendConnectedObj(c)}s=c,l=a}p=this._generateBond(i-1,0);r.appendConnector(p),p.appendConnectedObj(s),p.appendConnectedObj(u)}finally{r.endUpdate()}return r},_generateAtom:function(e){return new Kekule.Atom(null,"C")},_generateBond:function(e,t){var r=Kekule.BondOrder.SINGLE;return this.getIsAromatic()&&e%2&&(r=Kekule.BondOrder.DOUBLE),new Kekule.Bond(null,null,r)},_calcAtomCoords:function(e){for(var t=this.getEnableCoordCache(),r=Math.PI/e,i=2*r,n=.5/Math.sin(r),o=4===e||8===e?-Math.PI/2-i/2:-Math.PI/2,a=[],s=0;s<e;++s){var l={x:n*Math.cos(o),y:n*Math.sin(o)};a.push(l),t&&this._setCoordToCache(l,e,s),o+=i}return a},_initCoordCache:function(){this._coordCache=[];for(var e=3;e<13;++e)this._calcAtomCoords(e)},_clearCoordCache:function(){this._coordCache=[]},_setCoordToCache:function(e,t,r){var i=this._coordCache[t];i||(i=[],this._coordCache[t]=i),i[r]=e},_getCachedCoord:function(e,t){var r=this._coordCache[e];return r&&r[t]},_getCachedCoords:function(e){return this._coordCache[e]},_hasCoordCache:function(e){return!(!this._coordCache||!this._coordCache[e])}}),Kekule.Editor.MolChainRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolChainRepositoryItem2D",STEP_X_INC:Math.cos(30/180*Math.PI),STEP_Y_INC:Math.sin(30/180*Math.PI),initialize:function(e,t){this.tryApplySuper("initialize"),this.setAtomCount(e),this.setBondLength(t||1)},initProperties:function(){this.defineProp("atomCount",{dataType:DataType.INT}),this.defineProp("bondLength",{dataType:DataType.FLOAT}),this.defineProp("negativeDirection",{dataType:DataType.BOOL}),this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnableCoordCache()&&(this.setPropStoreFieldValue("enableCoordCache",e),e&&!this._coordCache&&this._initCoordCache())}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(e,t){var r=t&&t.originalStructFragment;return this.generateChain(r)},doGetMergableNode:function(e,t){return e.getNodeAt(0)},doGetMergableConnector:function(e,t){return null},generateChain:function(e,t){t||(t=Kekule.Molecule);var r=e||new t,i=this.getAtomCount(),n=this.getBondLength()||1,o=this.getNegativeDirection();r.beginUpdate();try{r.setCoord2D({x:0,y:0});var a=r.getNodeCount();if(a>i)for(var s=a-1;s>=i;--s)r.removeNodeAt(s);var l,u,d=r.getConnectorCount();if(d>i-1)for(s=d-1;s>=i-1;--s)r.removeConnectorAt(s);s=0;for(var c=i;s<c;++s){l=h;var h,p=!1;(h=r.getNodeAt(s))||(h=this._generateAtom(s),p=!0);var g=this._getCachedCoord(s);g||(g=this._calcAtomCoord(s)),1!==n&&(g=Kekule.CoordUtils.multiply(g,n)),o&&(g={x:g.x,y:-g.y}),h.setCoord2D(g),p&&r.appendNode(h),l&&p&&(u=this._generateBond(s-1,s),r.appendConnector(u),u.appendConnectedObj(l),u.appendConnectedObj(h))}}finally{r.endUpdate()}return this.setMolManipulationCenterCoord({x:0,y:0}),this.setMolManipulationDefDirectionCoord({x:1,y:0}),r},_generateAtom:function(e){return new Kekule.Atom(null,"C")},_generateBond:function(e,t){var r=Kekule.BondOrder.SINGLE;return new Kekule.Bond(null,null,r)},_calcAtomSetCoords:function(e){var t=this.getEnableCoordCache(),r={x:1*this.STEP_X_INC,y:1*this.STEP_Y_INC},i=[],n={x:0,y:0};i.push(n),this._coordCache[0]=n;for(var o=1,a=e;o<a;++o)n={x:n.x+r.x,y:o%2?r.y:0},i.push(n),t&&(this._coordCache[o]=n);return i},_calcAtomCoord:function(e){var t={x:1*this.STEP_X_INC,y:1*this.STEP_Y_INC},r={x:t.x*e,y:e%2?t.y:0};return this._coordCache&&(this._coordCache[e]=r),r},_initCoordCache:function(){this._coordCache=[];this._calcAtomSetCoords(30)},_clearCoordCache:function(){this._coordCache=[]},_getCachedCoord:function(e){return this._coordCache&&this._coordCache[e]}}),Kekule.Editor.PathGlyphRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.PathGlyphRepositoryItem2D",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setGlyphClass(e),this.setGlyphRefLength(t||1),this.setGlyphInitialParams(r)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT}),this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("glyphInitialParams",{dataType:DataType.HASH})},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},doGetRefLength:function(){return this.getGlyphRefLength()},createObjects:function(e){var t={x:0,y:0};return{objects:[this.generateGlyph()],mergeObj:null,mergeDest:null,baseObjCoord:t,centerCoord:t}},generateGlyph:function(){return new(this.getGlyphClass())(null,this.getGlyphRefLength(),this.getGlyphInitialParams())}}),Kekule.Editor.RepositoryItemManager={_itemClassMap:new Kekule.MapEx(!0),_itemNameMap:new Kekule.MapEx(!0),getAllItems:function(t){return e._itemClassMap.get(t)},getItem:function(t){return e._itemNameMap.get(t)},register:function(t){var r,i=t.getName();i&&(r=e.getItem(),e._itemNameMap.set(i,t));var n=t.getClass(),o=e.getAllItems(n);o?r?Kekule.ArrayUtils.replace(o,r,t):Kekule.ArrayUtils.pushUnique(o,t):(o=[t],e._itemClassMap.set(n,o))},unregister:function(t){var r=t.getClass(),i=e.getAllItems(r);i&&Kekule.ArrayUtils.remove(i,t);var n=t.getName();n&&e._itemNameMap.remove(n)}};var e=Kekule.Editor.RepositoryItemManager;Kekule._registerAfterLoadSysProc(function(){if(Kekule.Editor.RepositoryData){for(var t=0,r=(n=Kekule.Editor.RepositoryData.subGroups||[]).length;t<r;++t){var i=n[t];(o=new Kekule.Editor.StoredSubgroupRepositoryItem2D(i.structData,i.dataFormat,i.scale)).setInputTexts(i.inputTexts).setName(i.name||i.inputTexts[0]),e.register(o)}var n;for(t=0,r=(n=Kekule.Editor.RepositoryData.fragments||[]).length;t<r;++t){var o;i=n[t];(o=new Kekule.Editor.StoredStructFragmentRepositoryItem2D(i.structData,i.dataFormat,i.scale)).setName(i.name),e.register(o)}}})}(),function(){"use strict";var e=Kekule.ObjUtils,t=Kekule.ArrayUtils,r=Kekule.Widget.HtmlClassNames,i=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{STRUCTURE_NODE_SELECT_PANEL:"K-Chem-StructureNodeSelectPanel",STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureNodeSelectPanel-SetButton",STRUCTURE_NODE_SETTER:"K-Chem-StructureNodeSetter",STRUCTURE_NODE_SETTER_INPUTBOX:"K-Chem-StructureNodeSetter-InputBox",STRUCTURE_CONNECTOR_SELECT_PANEL:"K-Chem-StructureConnectorSelectPanel",STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureConnectorSelectPanel-SetButton",STRUCTURE_CONNECTOR_SELECT_PANEL_ADV:"K-Chem-StructureConnectorSelectPanelAdv",STRUCTURE_CONNECTOR_SELECT_PANEL_ADV_EXTRA_SECTION:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_KEKULIZE:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button-Kekulize",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_HUCKLIZE:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button-Hucklize",CHARGE_SELECT_PANEL:"K-Chem-Charge-SelectPanel",CHARGE_SELECT_PANEL_BTNGROUP:"K-Chem-Charge-SelectPanel-BtnGroup",CHARGE_SELECT_PANEL_CHARGE_BUTTON:"K-Chem-Charge-SelectPanel-ChargeButton",GLYPH_PATH_ARROW_SETTING_PANEL:"K-Chem-GlyphPath-Arrow-SettingPanel",GLYPH_PATH_ARROW_STYLE_BTNGROUP:"K-Chem-GlyphPath-Arrow-StyleButtonGroup",GLYPH_PATH_ARROW_STYLE_BUTTON:"K-Chem-GlyphPath-Arrow-StyleButton",GLYPH_PATH_ARROW_CONTINUOUS_SIDES_BTNGROUP:"K-Chem-GlyphPath-Arrow-ContinuousSidesButtonGroup",GLYPH_PATH_ARROW_CONTINUOUS_SIDES_BUTTON:"K-Chem-GlyphPath-Arrow-ContinuousSidesButton",GLYPH_Path_ARROW_SIZE_SETTER:"K-Chem-GlyphPath-Arrow-SizeSetter",GLYPH_REACTION_ARROW_PRESET_SELECTOR:"K-Chem-Glyph-ReactionArrow-PresetSelector",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonSet",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET_DROPDOWN:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonSet-DropDown",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON:"K-Chem-Glyph-ReactionArrow-PresetSelector-Button",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR:"K-Chem-Glyph-ElectronPushingArrow-PresetSelector",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BTNGROUP:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonGroup",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON:"K-Chem-Glyph-ElectronPushingArrow-PresetSelector-Button",GLYPH_PATH_LINE_SETTING_PANEL:"K-Chem-GlyphPath-Line-SettingPanel",GLYPH_PATH_SETTING_PANEL:"K-Chem-GlyphPath-SettingPanel",GLYPH_PATH_SETTING_PANEL_SECTION:"K-Chem-GlyphPath-SettingPanel-Section",GLYPH_PATH_SETTING_PANEL_SECTION_TITLE:"K-Chem-GlyphPath-SettingPanel-Section-Title",GLYPH_PATH_SETTING_PANEL_SECTION_PANEL:"K-Chem-GlyphPath-SettingPanel-Section-Panel",GLYPH_MULTIPATH_SETTING_PANEL:"K-Chem-GlyphMultiPath-SettingPanel",GLYPH_MULTIPATH_SETTING_PANEL_PATH_TABGROUP:"K-Chem-GlyphMultiPath-SettingPanel-PathTabGroup",GLYPH_MULTIPATH_SETTING_PANEL_PATH_SETTING_PANEL:"K-Chem-GlyphMultiPath-SettingPanel-PathSettingPanel",GLYPH_REACTION_ARROW_PATH_SETTING_PANEL:"K-Chem-ReactionArrow-SettingPanel",GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION:"K-Chem-ReactionArrow-SettingPanel-ArrowPresetSection",GLYPH_ARC_PATH_SETTING_PANEL:"K-Chem-ArcPath-SettingPanel",GLYPH_MULTIARC_PATH_SETTING_PANEL:"K-Chem-MultiArcPath-SettingPanel",GLYPH_ELECTRON_PUSHING_ARROW_SETTING_PANEL:"K-Chem-ElectronPusingArrow-SettingPanel",GLYPH_MULTI_ELECTRON_PUSHING_ARROW_SETTING_PANEL:"K-Chem-MultiElectronPusingArrow-SettingPanel"}),Kekule.ChemWidget.StructureNodeSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSelectPanel",BTN_DATA_FIELD:"__$btn_data__",initialize:function(e){this.setPropStoreFieldValue("displayElements",!0),this.setPropStoreFieldValue("displayNonElements",!0),this.setPropStoreFieldValue("displaySubgroups",!0),this.tryApplySuper("initialize",[e]),this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null}),this.defineProp("elementSymbols",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("nonElementInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("subGroupInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("subGroupRepItems",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("subGroupRepItems",e),this._updateSubGroupInfosFromRepItems(e)}}),this.defineProp("displayElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("displayNonElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("displaySubgroups",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("activeNode",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("activeNode",e),this.activeNodeChanged(e)}}),this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PRIVATE,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("periodicTableDialog");if(!t&&e){var r=this.getCoreElement(),i=this.getDocument();t=this._createPeriodicTableDialogWidget(i,r),this.setPropStoreFieldValue("periodicTableDialog",t)}return t}})},initPropValues:function(){return this.tryApplySuper("initPropValues")},doFinalize:function(){var e=this.getPeriodicTableDialog();e&&e.finalize(),this.tryApplySuper("doFinalize")},setSelectableInfos:function(e){this.beginUpdate();try{this.setPropValues(e)}finally{this.endUpdate()}},reactSelButtonExec:function(e){var t=this,r=e.target;if(this._selButtons.indexOf(r)>=0){var i=r[this.BTN_DATA_FIELD];i&&(i.isPeriodicTable?this._openPeriodicTableDialog(r,function(e){if(e===Kekule.Widget.DialogButtons.OK){var r=t._periodicTable.getSelectedSymbol();t.doValueChanged(t.generateSelectableDataFromElementSymbol(r))}},{isSimpleAtom:!0}):i.isVarList||i.isVarNotList?this._openPeriodicTableDialog(r,function(e){if(e===Kekule.Widget.DialogButtons.OK){var r=t._periodicTable.getSelectedSymbols(),n=Kekule.VariableAtom,o=i.isVarList?{allowedIsotopeIds:r,disallowedIsotopeIds:null}:{allowedIsotopeIds:null,disallowedIsotopeIds:r};t.doValueChanged({nodeClass:n,props:o})}},{isVarList:i.isVarList,isVarNotList:i.isVarNotList}):this.doValueChanged(i))}},doValueChanged:function(e){this.setPropStoreFieldValue("value",e),this.invokeEvent("valueChange",{value:{nodeClass:e.nodeClass,props:e.props,repositoryItem:e.repositoryItem}})},activeNodeChanged:function(e){},doObjectChange:function(e){Kekule.ArrayUtils.intersect(e,["elementSymbols","nonElementInfos","subGroupInfos","displayElements","displayNonElements","displaySubGroups"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.STRUCTURE_NODE_SELECT_PANEL},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updatePanelContent(e,this.getChildrenHolderElement()),r},_updateSubGroupInfosFromRepItems:function(e){var t=[];if(e&&e.length){for(var r=0,i=e.length;r<i;++r){var n=e[r],o=n.getStructureFragment(),a=o.getAbbr();if(!a){var s=o.getFormulaText(),l=Kekule.FormulaUtils.textToFormula(s).getDisplayRichText();a=Kekule.Render.RichTextUtils._toDebugHtml(l)}var u={text:a,repositoryItem:n,nodeClass:o.getClass(),node:o,hint:n.getName()};t.push(u)}this.setSubGroupInfos(t)}},updatePanelContent:function(e,t){if(this._selButtons)for(var r=this._selButtons.length-1;r>=0;--r){var i=this._selButtons[r];this.removeWidget(i)}this._selButtons=[],Kekule.DomUtils.clearChildContent(t);var n=this.generateSelectableData(),o=this._getDisplayedTabPageNames(),a=new Kekule.Widget.TabView(this);if(o.indexOf("atom")>=0){var s=a.createNewTabPage(Kekule.$L("ChemWidgetTexts.CAPTION_ATOM"));if(this.getDisplayElements())this.doCreateSelButtonSection(e,s.getCoreElement(),n.elementData);if(this.getDisplayNonElements())this.doCreateSelButtonSection(e,s.getCoreElement(),n.nonElementData,!0)}if(o.indexOf("subgroup")>=0){var l=a.createNewTabPage(Kekule.$L("ChemWidgetTexts.CAPTION_SUBGROUP"));this.doCreateSelButtonSection(e,l.getCoreElement(),n.subGroupData,!0)}a.setShowTabButtons(o.length>1)},_getDisplayedTabPageNames:function(){var e=[];return(this.getDisplayElements()||this.getDisplayNonElements())&&e.push("atom"),this.getDisplaySubgroups()&&e.push("subgroup"),e},generateSelectableDataFromElementSymbol:function(e){var t=e,r=Kekule.IsotopesDataUtil.getIsotopeInfoById(e);return r&&(t=r.isotopeAlias?r.isotopeAlias:"<sup>"+r.massNumber+"</sup>"+r.elementSymbol),{text:t,nodeClass:Kekule.Atom,props:{isotopeId:e}}},generateSelectableData:function(){for(var e=this.getElementSymbols()||[],t=[],r=0,i=e.length;r<i;++r){var n;n="..."===e[r]?{text:"…",nodeClass:null,hint:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE"),isPeriodicTable:!0}:this.generateSelectableDataFromElementSymbol(e[r]),t.push(n)}return{elementData:t,nonElementData:this.getNonElementInfos(),subGroupData:this.getSubGroupInfos()}},doCreateSelButton:function(e,t,r,n){var o=r.text;n&&r.description&&(o+='<span style="font-size:80%"> '+r.description+"</span>");var a=new(0,Kekule.Widget.Button)(e,o);return a.addClassName(i.STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON),a.setGroup&&a.setGroup(this.getClassName()),r.hint&&a.setHint(r.hint),a[this.BTN_DATA_FIELD]=r,this._selButtons.push(a),a},doCreateSectionSelButtons:function(e,t,r,i){if(r)for(var n=0,o=r.length;n<o;++n){var a=this.doCreateSelButton(e,t,r[n],i);a.setParent(this),a.appendToElem(t)}},doCreateSection:function(e,t){var i=e.createElement("div");return i.className=r.SECTION,t&&t.appendChild(i),i},doCreateSelButtonSection:function(e,t,r,i){var n=this.doCreateSection(e,t);return this.doCreateSectionSelButtons(e,n,r,i),n},_createPeriodicTableDialogWidget:function(e,t){var r=new Kekule.Widget.Dialog(e,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]),i=new Kekule.ChemWidget.PeriodicTable(e);return i.setUseMiniMode(!0).setEnableSelect(!0),i.setParent(r),i.appendToElem(r.getClientElem()),this._periodicTable=i,r},_openPeriodicTableDialog:function(e,t,r){var i=this.getPeriodicTableDialog(!0),n=r.isVarList||r.isVarNotList;this._periodicTable.setEnableMultiSelect(n).setSelectedSymbol(null);var o=this.getActiveNode();if((r.isVarList||r.isVarNotList)&&o instanceof Kekule.VariableAtom){var a=o.getAllowedIsotopeIds(),s=o.getDisallowedIsotopeIds();this._periodicTable.setSelectedSymbols(r.isVarList?a:s)}!n&&o instanceof Kekule.Atom&&this._periodicTable.setSelectedSymbol(o.getSymbol()),i.openPopup(t,e||this)}}),Kekule.ChemWidget.StructureNodeSetter=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSetter",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueSetBySelectPanel=!1},initProperties:function(){this.defineProp("enableHydrogenCountInput",{dataType:DataType.BOOL}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=Kekule.ArrayUtils.toArray(e);this.setPropStoreFieldValue("nodes",t),this.nodesChanged(t)}}),this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("value");if(!e&&!this._valueSetBySelectPanel){var t=this.getNodeInputBox().getValue();e=this._getValueFromDirectInputText(t)||e}return e}}),this.defineProp("nodeLabel",{dataType:DataType.STRING,serializable:!1,setter:null,getter:function(){return this.getNodeInputBox().getValue()}}),this.defineProp("nodeInputBox",{dataType:"Kekule.Widget.ButtonTextBox",serializable:!1,setter:!1}),this.defineProp("nodeInputBoxFontSize",{dataType:DataType.STRING,serializable:!1,setter:function(e){this.getNodeInputBox().getTextBox().getElement().style.fontSize=e,this.setPropStoreFieldValue("nodeInputBoxFontSize",e)}}),this.defineProp("nodeSelectPanel",{dataType:"Kekule.ChemWidget.StructureNodeSelectPanel",serializable:!1,setter:!1}),this.defineProp("showInputBox",{dataType:DataType.BOOL,getter:function(){return this.getNodeInputBox().getDisplayed()},setter:function(e){this.getNodeInputBox().setDisplayed(e)}}),this.defineProp("showSelectPanel",{dataType:DataType.BOOL,getter:function(){return this.getNodeSelectPanel().getDisplayed()},setter:function(e){this.getNodeSelectPanel().setDisplayed(e)}}),this.defineProp("useDropDownSelectPanel",{dataType:DataType.BOOL,setter:function(e){this.getUseDropDownSelectPanel()!==e&&(this.setPropStoreFieldValue("useDropDownSelectPanel",e),this._updateDropDownSettings(e))}}),this.defineProp("labelConfigs",{dataType:DataType.OBJECT,serializable:!1}),this._defineSelectPanelDelegatedProp("selectableElementSymbols","elementSymbols"),this._defineSelectPanelDelegatedProp("selectableNonElementInfos","nonElementInfos"),this._defineSelectPanelDelegatedProp("selectableSubGroupInfos","subGroupInfos"),this._defineSelectPanelDelegatedProp("selectableSubGroupRepItems","subGroupRepItems"),this._defineSelectPanelDelegatedProp("displaySelectableElements","displayElements"),this._defineSelectPanelDelegatedProp("displaySelectableNonElements","displayNonElements"),this._defineSelectPanelDelegatedProp("displaySelectableSubgroups","displaySubgroups")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableHydrogenCountInput(!0)},doFinalize:function(){var e=this.getNodeSelectPanel();e&&e.finalize();var t=this.getNodeInputBox();t&&t.finalize(),this.tryApplySuper("doFinalize")},_defineSelectPanelDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(Kekule.ChemWidget.StructureNodeSelectPanel,t),i=Object.create(r);return i.getter=null,i.setter=null,r.getter&&(i.getter=function(){return this.getNodeSelectPanel().getPropValue(t)}),r.setter&&(i.setter=function(e){this.getNodeSelectPanel().setPropValue(t,e)}),this.defineProp(e,i)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.STRUCTURE_NODE_SETTER},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),n=this,o=new Kekule.Widget.ButtonTextBox(this);this.setPropStoreFieldValue("nodeInputBox",o),o.addClassName(i.STRUCTURE_NODE_SETTER_INPUTBOX),o.appendToElem(this.getCoreElement()),o.addEventListener("valueChange",function(e){n._valueSetBySelectPanel=!1,e.stopPropagation()}),o.addEventListener("keyup",function(e){var t=e.htmlEvent.getKeyCode();t===Kekule.X.Event.KeyCode.ENTER&&n._applyDirectInput(),n.getUseDropDownSelectPanel()&&(t===Kekule.X.Event.KeyCode.DOWN?n.showNodeSelectPanel():t===Kekule.X.Event.KeyCode.UP&&n.hideNodeSelectPanel())}),o.addEventListener("blur",function(e){e.target===o.getTextBox()&&o.getIsDirty()&&n._applyDirectInput()}),o.getButton().addEventListener("execute",function(e){n.getUseDropDownSelectPanel()?n.toggleNodeSelectPanel():n._applyDirectInput()});var a=new Kekule.ChemWidget.StructureNodeSelectPanel(this);return this.setPropStoreFieldValue("nodeSelectPanel",a),a.appendToElem(this.getCoreElement()),a.addEventListener("valueChange",function(e){Object.extend({},e);e.stopPropagation(),n._valueSetBySelectPanel=!0,n.doValueChanged(e.value,!0),n.getUseDropDownSelectPanel()&&a.hide()}),this._updateDropDownSettings(this.getUseDropDownSelectPanel()),r},_updateDropDownSettings:function(e){var t=this.getNodeInputBox(),r=this.getNodeSelectPanel();e?(t.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),r.removeFromDom(),r.hide(null,null,Kekule.Widget.ShowHideType.DEFAULT)):(t.setButtonKind(Kekule.Widget.Button.Kinds.ENTER),r.appendToElem(this.getCoreElement()),r.setStyleProperty("position",""),r.show(null,null,Kekule.Widget.ShowHideType.DEFAULT))},_indexOfNonElementLabel:function(e){for(var t=this.getNonAtomLabelInfos(),r=0,i=t.length;r<i;++r){if(t[r].nodeLabel===e)return r}return-1},_getNonAtomInfo:function(e){var t=this.getSelectableNonElementInfos();if(t)for(var r=0,i=t.length;r<i;++r){var n=t[r];if(n.text===e)return n}return null},_getNodeWithExplicitHInfo:function(e){var t={},r=e.trim().match(/^(\d*[A-Z][a-z]?\d*)H(\d*)$/);return r?(t.core=r[1],t.explicitHCount=parseInt(r[2])||1):t.core=e,t},_getValueFromDirectInputText:function(e){if(!e)return null;var t,r,i,n,o,a=this._getNonAtomInfo(e);if(a)t=a.nodeClass,r=a.props;else{var s=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(e);if(i=s,s)t=s.getStructureFragment().getClass();else if(e){var l=e;if(!(t=Kekule.ChemStructureNodeFactory.getClassByLabel(l,null))){if(this.getEnableHydrogenCountInput()){var u=this._getNodeWithExplicitHInfo(l);u.explicitHCount&&(t=Kekule.ChemStructureNodeFactory.getClassByLabel(u.core,null))&&(o=u.explicitHCount,l=u.core)}t||(t=Kekule.Pseudoatom,n=!0)}r=t===Kekule.Atom?{isotopeId:l,inputHydrogenCount:o}:t===Kekule.Pseudoatom?{symbol:e}:{}}}return{nodeClass:t,props:r,repositoryItem:i,isUnknownPseudoatom:n}},_applyDirectInput:function(){this._valueSetBySelectPanel=!1;var e=this.getNodeInputBox();if(e.getIsDirty()){var t=e.getValue();if(t){var r=this._getValueFromDirectInputText(t);r&&this.doValueChanged(r)}e.setIsDirty(!1)}else this.doValueChanged(null)},_getVarAtomListLabel:function(){var e=this.getLabelConfigs();return e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var e=this.getLabelConfigs();return"~"+(e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM)},_getAllNodeLabels:function(e){var t={};return this.getEnableHydrogenCountInput()&&(t.includeExplicitHydrogens=!0),Kekule.Editor.StructureUtils.getAllChemStructureNodesLabel(e,this.getLabelConfigs(),t)},nodesChanged:function(e){var t=this._getAllNodeLabels(e)||"",r=t?e[0]:null;this.getNodeSelectPanel().setActiveNode(r),this.getNodeInputBox().setValue(t),this.getNodeInputBox().setIsDirty(!1),this.setPropStoreFieldValue("value",null),this._valueSetBySelectPanel=!1},doValueChanged:function(e,t){this.setPropStoreFieldValue("value",e);var r=e&&{nodeClass:e.nodeClass,props:e.props,repositoryItem:e.repositoryItem,isUnknownPseudoatom:e.isUnknownPseudoatom};t&&this.invokeEvent("valueSelect",{value:r}),this.invokeEvent("valueChange",{value:r})},setSelectableInfos:function(e){this.getNodeSelectPanel().setSelectableInfos(e)},showNodeSelectPanel:function(){var e=this.getNodeSelectPanel();e.isShown()||e.show(this.getNodeInputBox(),null,Kekule.Widget.ShowHideType.DROPDOWN)},hideNodeSelectPanel:function(){var e=this.getNodeSelectPanel();e.isShown()&&e.hide()},toggleNodeSelectPanel:function(){var e=this.getNodeSelectPanel();e.isShown()?e.hide():e.show(this.getNodeInputBox(),null,Kekule.Widget.ShowHideType.DROPDOWN)}}),Kekule.ChemWidget.StructureConnectorSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureConnectorSelectPanel",BTN_DATA_FIELD:"__$btn_data__",BTN_GROUP:"__$bond_btn_group__",initialize:function(e){this.tryApplySuper("initialize",[e]),this._selButtons=[],this._activeBtn=null,this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null}),this.defineProp("bondData",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("activeBondPropValues",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("activeBondPropValues",e),this.activeBondPropsChanged(e)}}),this.defineProp("activeBondHtmlClass",{dataType:DataType.STRING,scope:Class.PropertyScope.PRIVATE,setter:null,getter:function(){var e=this._activeBtn;if(e){var t=e[this.BTN_DATA_FIELD];return t&&t.htmlClass}return null}}),this.defineProp("bondPropNames",{dataType:DataType.ARRAY,serializable:!1})},doObjectChange:function(e){Kekule.ArrayUtils.intersect(e,["bondData"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.STRUCTURE_CONNECTOR_SELECT_PANEL},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updatePanelContent(e,t),r},activeBondPropsChanged:function(e){if(this._activeBtn&&(this._activeBtn.setChecked(!1),this._activeBtn=null),e)for(var t=this._selButtons,r=0,i=t.length;r<i;++r){var n=t[r][this.BTN_DATA_FIELD];if(n&&this._isBondPropsMatch(e,n.bondProps,this.getBondPropNames())){t[r].setChecked(!0),this._activeBtn=t[r];break}}},_isBondPropsMatch:function(e,t,r){return Kekule.Editor.StructureUtils.isBondPropsMatch(e,t,r)},reactSelButtonExec:function(e){var t=e.target;if(this._selButtons.indexOf(t)>=0){this._activeBtn=t;var r=t[this.BTN_DATA_FIELD];r&&(this.setPropStoreFieldValue("activeBondPropValues",r.bondProps),this.doValueChanged(r.bondProps))}},doValueChanged:function(e){this.setPropStoreFieldValue("value",e),this.invokeEvent("valueChange",{value:e})},updatePanelContent:function(e,r){if(this._selButtons)for(var i=this._selButtons.length-1;i>=0;--i){var n=this._selButtons[i];this.removeWidget(n)}var o=[];this._selButtons=[];var a=this.getBondData();if(a){i=0;for(var s=a.length;i<s;++i){var l=a[i],u=l.bondProps;(n=this._createBondSelButton(e,l)).appendToElem(r),this._selButtons.push(n),u&&t.pushUnique(o,Kekule.ObjUtils.getOwnedFieldNames(u))}}this.getBondPropNames()||this.setPropStoreFieldValue("bondPropNames",o)},_createBondSelButton:function(e,t){var r=new Kekule.Widget.RadioButton(this);return r.addClassName(i.STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON),r.setGroup(this.BTN_GROUP).setShowGlyph(!0).setShowText(!1),r.setText(t.text||null).setHint(t.hint||t.description||null),t.htmlClass&&r.addClassName(t.htmlClass),r[this.BTN_DATA_FIELD]=t,r}}),Kekule.ChemWidget.StructureConnectorSelectPanelAdv=Class.create(Kekule.ChemWidget.StructureConnectorSelectPanel,{CLASS_NAME:"Kekule.ChemWidget.StructureConnectorSelectPanelAdv",initialize:function(e){this.setPropStoreFieldValue("extraComponents",[Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE]),this._additionalCompWidgets=[],this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("extraComponents",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.STRUCTURE_CONNECTOR_SELECT_PANEL_ADV},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]);Kekule.ArrayUtils.intersect(e,["extraComponents"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},updatePanelContent:function(e,t){this.clearAdditionalSections(),this.tryApplySuper("updatePanelContent",[e,t]);var r=this.getExtraComponents();r&&r.indexOf(Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE)>=0&&this._createKekulizeSection(e,t).appendToElem(t)},reactSelButtonExec:function(e){this.tryApplySuper("reactSelButtonExec",[e]);var t=e.target;t._command&&this.invokeEvent("command",{command:t._command})},clearAdditionalSections:function(){if(this._additionalCompWidgets){for(var e=0,t=this._additionalCompWidgets.length;e<t;++e){this._additionalCompWidgets[e].finalize()}this._additionalCompWidgets=[]}},createAdditionalSection:function(e,t){var r=new Kekule.Widget.Container(e);return r.addClassName(i.STRUCTURE_CONNECTOR_SELECT_PANEL_ADV_EXTRA_SECTION),this._additionalCompWidgets.push(r),r.appendToElem(t),r.setParent(this),r},_createKekulizeSection:function(e,t){var r=this.createAdditionalSection(e,t),n=new Kekule.Widget.Button(r);n.addClassName([i.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON,i.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_KEKULIZE]).setText(Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_KEKULIZE")).setHint(Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_KEKULIZE")).setShowGlyph(!0).setShowText(!1),n._command=Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands.KEKULIZE,r.appendWidget(n);var o=e.createElement("span");Kekule.DomUtils.setElementText(o," ◀ ▶ "),r.getElement().appendChild(o);var a=new Kekule.Widget.Button(r);return a.addClassName([i.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON,i.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_HUCKLIZE]).setText(Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_HUCKLIZE")).setHint(Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_HUCKLIZE")).setShowGlyph(!0).setShowText(!1),a._command=Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands.HUCKLIZE,r.appendWidget(a),r}}),Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components={KEKULIZE:"kekulize"},Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands={KEKULIZE:"kekulize",HUCKLIZE:"hucklize"},Kekule.ChemWidget.ChargeSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.ChargeSelectPanel",CHARGE_FIELD:"__$charge__",initialize:function(e){this._chargeBtnGroups={},this._selectedButton=null,this._chargeButtonMap=[],this.setPropStoreFieldValue("maxCharge",4),this.setPropStoreFieldValue("minCharge",-4),this.tryApplySuper("initialize",[e]),this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getValue();if(e!==t){var r=this._chargeButtonMap[t];r&&(r.setChecked(!1),r.blur()),this.setPropStoreFieldValue("value",e);var i=this._chargeButtonMap[e];i&&i.setChecked(!0),this._selectedButton=i}}}),this.defineProp("minCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!==this.getMinCharge()&&(this.setPropStoreFieldValue("minCharge",e),this.updateChargeButtons())}}),this.defineProp("maxCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!==this.getMaxCharge()&&(this.setPropStoreFieldValue("maxCharge",e),this.updateChargeButtons())}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.CHARGE_SELECT_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updateChargeButtons(e,t),r},updateChargeButtons:function(e,t){for(var r=this._chargeBtnGroups,n=["zero","positive","negative"],o=0,a=n.length;o<a;++o){(s=r[n[o]])?s.clearWidgets():((s=new Kekule.Widget.ButtonGroup(this)).addClassName(i.CHARGE_SELECT_PANEL_BTNGROUP),s.appendToElem(t),r[n[o]]=s)}var s,l=Math.floor(this.getMaxCharge()),u=Math.floor(this.getMinCharge()),d=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE"),c=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE");if(l>=1&&(s=this._chargeBtnGroups.positive))for(o=Math.max(u,1);o<=l;++o)this._createChargeButton(s,o,o+d);l>=0&&u<=0&&((s=this._chargeBtnGroups.zero)&&this._createChargeButton(s,0,Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NONE"),Kekule.$L("ChemWidgetTexts.HINT_CHARGE_NONE")));if(u<=-1&&(s=this._chargeBtnGroups.negative))for(o=Math.min(l,-1);o>=u;--o)this._createChargeButton(s,o,Math.abs(o)+c)},_createChargeButton:function(e,t,r,n){var o=new Kekule.Widget.RadioButton(e,r);return o[this.CHARGE_FIELD]=t,this._chargeButtonMap[t]=o,n&&o.setHint(n),o.addClassName(i.CHARGE_SELECT_PANEL_CHARGE_BUTTON),o.appendToWidget(e),this.getValue()===t&&(o.setChecked(!0),this._selectedButton=o),o},reactSelButtonExec:function(e){var t=e.target[this.CHARGE_FIELD];Kekule.ObjUtils.notUnset(t)&&(this.setValue(t),this.notifyValueChange(t))},notifyValueChange:function(e){this.invokeEvent("valueChange",{value:e})}}),Kekule.ChemWidget.GlyphPathArrowSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathArrowSettingPanel",DATA_FIELD:"__$data$__",initialize:function(e){this._isSettingValue=!1,this._arrowWidthInputter=null,this._arrowLengthInputter=null,this._arrowStyleButtons=null,this.setPropStoreFieldValue("arrowWidthMin",0),this.setPropStoreFieldValue("arrowWidthMax",.5),this.setPropStoreFieldValue("arrowWidthStep",.1),this.setPropStoreFieldValue("arrowLengthMin",0),this.setPropStoreFieldValue("arrowLengthMax",.5),this.setPropStoreFieldValue("arrowLengthStep",.1),this.setPropStoreFieldValue("showContinousArrowSidesSetter",!1),this.setPropStoreFieldValue("defaultValue",{arrowType:Kekule.Glyph.ArrowType.NONE,arrowSide:Kekule.Glyph.ArrowSide.BOTH}),this.tryApplySuper("initialize",[e]),this.addEventListener("check",this.reactArrowStyleButtonCheck.bind(this)),this.addEventListener("valueChange",this.reactArrowSizeInputterChange.bind(this)),this.addEventListener("valueInput",this.reactArrowSizeInputterInput.bind(this))},initProperties:function(){this.defineProp("defaultValue",{dataType:DataType.HASH,scope:Class.PropertyScope.PRIVATE}),this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("value");return e||(e={},this.setPropStoreFieldValue("value",e)),e},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e);for(var t=Object.extend(Object.extend({},this.getDefaultValue()),e,!1,!0),r=0,i=this._arrowStyleButtons.length;r<i;++r){var n=this._arrowStyleButtons[r],o=n[this.DATA_FIELD];o.arrowType!==t.arrowType||o.arrowSide!==t.arrowSide&&o.arrowType!==Kekule.Glyph.ArrowType.NONE?n.setChecked(!1):n.setChecked(!0)}this._arrowWidthInputter.setValue(t.arrowWidth||0),this._arrowLengthInputter.setValue(t.arrowLength||0)}finally{this._isSettingValue=!1}}}),this.defineProp("allowedArrowTypes",{dataType:DataType.ARRAY}),this.defineProp("allowedArrowSides",{dataType:DataType.ARRAY}),this.defineProp("arrowWidthMin",{dataType:DataType.NUMBER}),this.defineProp("arrowWidthMax",{dataType:DataType.NUMBER}),this.defineProp("arrowWidthStep",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthMin",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthMax",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthStep",{dataType:DataType.NUMBER})},doObjectChange:function(e){(e.indexOf("allowedArrowTypes")>=0||e.indexOf("allowedArrowSides")>=0)&&this._updateStyleButtons(),t.intersect(e,["arrowWidthMin","arrowWidthMax","arrowWidthStep"]).length&&this._updateWidthInputter(),t.intersect(e,["arrowLengthMin","arrowLengthMax","arrowLengthStep"]).length&&this._updateLengthInputter()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_PATH_ARROW_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.doCreateSectionElem(e,t),n=(this.doCreateArrowStyleButtons(e,i),this.doCreateSectionElem(e,t));this.doCreateArrowSizeControls(e,n);return r.concat(i).concat(n)},doCreateSectionElem:function(e,t){var r=e.createElement("div");return t.appendChild(r),r},doCreateArrowStyleButtons:function(e,t){var r=Kekule.Glyph.ArrowType,n=Kekule.Glyph.ArrowSide,o={};o[r.NONE]="None",o[r.OPEN]="Open",o[r.TRIANGLE]="Triangle";var a={};a[n.BOTH]="Both",a[n.SINGLE]="Single",a[n.REVERSED]="Reversed";var s=[r.NONE,r.OPEN,r.TRIANGLE],l=[n.BOTH,n.SINGLE,n.REVERSED],u=new Kekule.Widget.ButtonGroup(this);u.addClassName(i.GLYPH_PATH_ARROW_STYLE_BTNGROUP),this._arrowStyleButtons=[];var d=s.indexOf(r.NONE);if(d>=0){s.splice(d,1);var c=m=E=o[r.NONE],h=i.GLYPH_PATH_ARROW_STYLE_BUTTON+"-"+E;(T=new Kekule.Widget.RadioButton(u,m)).setHint(c).addClassName(h),T[this.DATA_FIELD]={arrowType:r.NONE,arrowSide:(this.getDefaultValue()||{}).arrowSide},this._arrowStyleButtons.push(T)}for(var p=0,g=s.length;p<g;++p)for(var f=0,C=l.length;f<C;++f){var m,T,E=o[s[p]],_=a[l[f]];c=m=E+" / "+_,h=i.GLYPH_PATH_ARROW_STYLE_BUTTON+"-"+E+"-"+_;(T=new Kekule.Widget.RadioButton(u,m)).setHint(c).addClassName(h),T[this.DATA_FIELD]={arrowType:s[p],arrowSide:l[f]},this._arrowStyleButtons.push(T)}return u.setShowGlyph(!0).setShowText(!1),this._updateStyleButtons(this._arrowStyleButtons),u.appendToElem(t),[u]},doCreateArrowSizeControls:function(e,t){var r=this._createArrowSizeSlider(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH")+":"),i=this._createArrowSizeSlider(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_LENGTH")+":");return this._arrowWidthInputter=r,this._arrowLengthInputter=i,this._updateWidthInputter(r),this._updateLengthInputter(i),[r,i]},_createArrowSizeSlider:function(e,t,r){var n=e.createElement("div");n.className=i.GLYPH_Path_ARROW_SIZE_SETTER;var o=e.createElement("label");Kekule.DomUtils.setElementText(o,r);var a=new Kekule.Widget.NumInput(this);return a.appendToElem(o),n.appendChild(o),t.appendChild(n),a},_updateStyleButtons:function(e){var t=this.getAllowedArrowTypes(),r=this.getAllowedArrowSides();if(e||(e=this._arrowStyleButtons),e)for(var i=0,n=e.length;i<n;++i){var o=e[i][this.DATA_FIELD],a=t&&t.indexOf(o.arrowType)<0||r&&r.indexOf(o.arrowSide)<0;e[i].setDisplayed(!a)}},_updateSizeInputter:function(t,r,i,n,o){var a=e.notUnset;a(i)&&t.setMinValue(i),a(n)&&t.setMaxValue(n),a(o)&&t.setStep(o),a(r)&&t.setValue(r)},_updateWidthInputter:function(e){e||(e=this._arrowWidthInputter),this._updateSizeInputter(e,this.getValue().arrowWidth,this.getArrowWidthMin(),this.getArrowWidthMax(),this.getArrowWidthStep())},_updateLengthInputter:function(e){e||(e=this._arrowLengthInputter),this._updateSizeInputter(e,this.getValue().arrowLength,this.getArrowLengthMin(),this.getArrowLengthMax(),this.getArrowLengthStep())},getDefaultAllowedArrowTypes:function(){var e=Kekule.Glyph.ArrowType;return[e.NONE,e.OPEN,e.TRIANGLE]},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})},notifyValueInput:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueInput",{value:e})},reactArrowStyleButtonCheck:function(e){if(!this._isSettingValue){var t=e.widget;if(t&&t[this.DATA_FIELD]){var r=this.getValue();r.arrowType=t[this.DATA_FIELD].arrowType,r.arrowSide=t[this.DATA_FIELD].arrowSide,this.notifyValueChange(r),e.stopPropagation()}}},reactArrowSizeInputterChange:function(t){if(!this._isSettingValue){var r=t.widget;if(r===this._arrowWidthInputter||r===this._arrowLengthInputter){var i=r.getValue()&&r.getValue();if(e.notUnset(i)){var n=this.getValue();r===this._arrowWidthInputter?n.arrowWidth=i:r===this._arrowLengthInputter&&(n.arrowLength=i),this.notifyValueChange(n),t.stopPropagation()}}}},reactArrowSizeInputterInput:function(t){if(!this._isSettingValue){var r=t.widget;if(r===this._arrowWidthInputter||r===this._arrowLengthInputter){var i=r.getValue()&&r.getValue();if(e.notUnset(i)){var n=this.getValue();r===this._arrowWidthInputter?n.arrowWidth=i:r===this._arrowLengthInputter&&(n.arrowLength=i),this.notifyValueInput(n),t.stopPropagation()}}}}}),Kekule.ChemWidget.GlyphReactionArrowPresetSelector=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.ChemWidget.GlyphReactionArrowPresetSelector",DATA_FIELD:"__$data$__",initialize:function(e){this._isSettingValue=!1,this._buttonSet=null,this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getPropStoreFieldValue("value")||""},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e);for(var t=this._buttonSet.getButtonSet().getChildWidgets(),r=0,i=t.length;r<i;++r){var n=t[r];n[this.DATA_FIELD].reactionArrowType===e?n.setChecked(!0):n.setChecked(!1)}}finally{this._isSettingValue=!1}}}),this.defineProp("allowedReactionArrowTypes",{dataType:DataType.ARRAY})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_REACTION_ARROW_PRESET_SELECTOR},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.doCreateButtonSet(e,t);return r.concat([i.getElement()])},doCreateButtonSet:function(e,t){var r=new Kekule.Widget.CompactButtonSet(this);r.addClassName(i.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET),r.getButtonSet().addClassName(i.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET_DROPDOWN);for(var n=this.getAllowedReactionArrowTypes()||this.getDefaultAllowedReactionTypes(),o=0,a=n.length;o<a;++o){var s=new Kekule.Widget.RadioButton(r),l=this._getPresetButtonDetails(n[o]);s.addClassName(l.className,!0).setText(l.caption).setHint(l.hint).setShowText(!0).setShowGlyph(!0),s[this.DATA_FIELD]={reactionArrowType:n[o]},r.append(s)}var u=this;return r.addEventListener("select",function(e){if(!u._isSettingValue&&e.target===r){var t=e.selected;if(t&&t[u.DATA_FIELD]){var i=t[u.DATA_FIELD].reactionArrowType;u.setPropStoreFieldValue("value",i),u.notifyValueChange(i)}}}),r.appendToElem(t),this._buttonSet=r,r},_getPresetButtonDetails:function(e){Kekule.Glyph.ReactionArrowType;var t=e?e.toUpperCase():"UNSET",r=e?e.upperFirst():"Unset",n="REACTION_ARROW_"+t;return{caption:Kekule.$L("ChemWidgetTexts.CAPTION_"+n),hint:Kekule.$L("ChemWidgetTexts.HINT_"+n),className:i.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON+" "+i.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON+"-"+r}},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})},getDefaultAllowedReactionTypes:function(){var e=Kekule.Glyph.ReactionArrowType;return[null,e.NORMAL,e.REVERSIBLE,e.RESONANCE,e.RETROSYNTHESIS,e.CUSTOM]}}),Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector",DATA_FIELD:"__$data$__",initialize:function(e){this._isSettingValue=!1,this._buttonGroup=null,this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("value",{dataType:DataType.INT,getter:function(){return this.getPropStoreFieldValue("value")||""},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e);for(var t=this._buttonGroup.getChildWidgets(),r=0,i=t.length;r<i;++r){var n=t[r];n[this.DATA_FIELD].electronCount===e?n.setChecked(!0):n.setChecked(!1)}}finally{this._isSettingValue=!1}}}),this.defineProp("allowedReactionArrowTypes",{dataType:DataType.ARRAY})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.doCreateButtonGroup(e,t);return r.concat([i.getElement()])},doCreateButtonGroup:function(e,t){var r=new Kekule.Widget.ButtonGroup(this);r.addClassName(i.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BTNGROUP);for(var n=[2,1],o=0,a=n.length;o<a;++o){var s=n[o],l=new Kekule.Widget.RadioButton(r),u=this._getPresetButtonDetails(s);l.addClassName(u.className,!0).setText(u.caption).setHint(u.hint).setShowText(!0).setShowGlyph(!0),l[this.DATA_FIELD]={electronCount:s},r.appendWidget(l)}var d=this;return r.addEventListener("check",function(e){if(!d._isSettingValue){var t=e.widget;if(t&&t[d.DATA_FIELD]){var r=t[d.DATA_FIELD].electronCount;d.setPropStoreFieldValue("value",r),d.notifyValueChange(r)}}}),r.appendToElem(t),this._buttonGroup=r,r},_getPresetButtonDetails:function(e){var t=e.toString(),r="ELECTRON_PUSHING_ARROW_"+e;return{caption:Kekule.$L("ChemWidgetTexts.CAPTION_"+r+"_ABBR"),hint:Kekule.$L("ChemWidgetTexts.HINT_"+r),className:i.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON+" "+i.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON+"-"+t}},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})}}),Kekule.ChemWidget.GlyphPathLineSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathLineSettingPanel",initialize:function(e){this._isSettingValue=!1,this.setPropStoreFieldValue("lineCountMin",1),this.setPropStoreFieldValue("lineCountMax",5),this.setPropStoreFieldValue("lineCountStep",1),this.setPropStoreFieldValue("lineGapMin",0),this.setPropStoreFieldValue("lineGapMax",.8),this.setPropStoreFieldValue("lineGapStep",.1),this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this.reactInputWidgetChange.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("value");return e||(e={},this.setPropStoreFieldValue("value",e)),e},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e),this._lineCountInput.setValue(e.lineCount),this._lineGapInput.setValue(e.lineGap)}finally{this._isSettingValue=!1}}}),this.defineProp("lineCountMin",{dataType:DataType.NUMBER}),this.defineProp("lineCountMax",{dataType:DataType.NUMBER}),this.defineProp("lineCountStep",{dataType:DataType.NUMBER}),this.defineProp("lineGapMin",{dataType:DataType.NUMBER}),this.defineProp("lineGapMax",{dataType:DataType.NUMBER}),this.defineProp("lineGapStep",{dataType:DataType.NUMBER})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_PATH_LINE_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.doCreateNumInputSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_LINE_COUNT")+":");this._lineCountInput=i.widget,this._updateLineCountInput();var n=this.doCreateNumInputSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_LINE_GAP")+":");return this._lineGapInput=n.widget,this._updateLineGapInput(),r.concat([i.elem,n.elem])},doCreateNumInputSection:function(e,t,r){var i=e.createElement("span"),n=e.createElement("label");Kekule.DomUtils.setElementText(n,r);var o=new Kekule.Widget.NumInput(this,null,null,null,"number");return o.appendToElem(n),i.appendChild(n),t.appendChild(i),{elem:i,widget:o}},_updateInputWidget:function(t,r,i,n,o){var a=e.notUnset;t&&(t.setValue(r),a(i)&&t.setMinValue(i),a(n)&&t.setMaxValue(n),a(o)&&t.setStep(o))},_updateLineCountInput:function(){this._updateInputWidget(this._lineCountInput,this.getValue().lineCount,this.getLineCountMin(),this.getLineCountMax(),this.getLineCountStep())},_updateLineGapInput:function(){this._updateInputWidget(this._lineGapInput,this.getValue().lineGap,this.getLineGapMin(),this.getLineGapMax(),this.getLineGapStep())},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})},reactInputWidgetChange:function(t){if(!this._isSettingValue){var r=t.widget;if(r===this._lineCountInput||r===this._lineGapInput){var i=r.getValue()&&r.getValue();if(e.notUnset(i)){var n=this.getValue();r===this._lineCountInput?n.lineCount=i:r===this._lineGapInput&&(n.lineGap=i),this.notifyValueChange(n),t.stopPropagation()}}}}}),Kekule.ChemWidget.GlyphPathSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow","line"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this.reactChildSetterValueChange.bind(this)),this.addEventListener("valueInput",this.reactChildSetterValueInput.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e={};return this._startingArrowSetter&&(e=Object.extend(e,this._addPropPrefix(this._startingArrowSetter.getValue(),"start"))),this._endingArrowSetter&&(e=Object.extend(e,this._addPropPrefix(this._endingArrowSetter.getValue(),"end"))),this._lineSetter&&(e=Object.extend(e,this._lineSetter.getValue())),e},setter:function(e){if(e){var t=this._splitChildSetterValues(e);this._startingArrowSetter&&this._startingArrowSetter.setValue(t.startingArrow),this._endingArrowSetter&&this._endingArrowSetter.setValue(t.endingArrow),this._lineSetter&&this._lineSetter.setValue(t.line)}}}),this.defineProp("components",{dataType:DataType.ARRAY})},doObjectChange:function(e){return e.indexOf("components")>=0&&this.updateComponents(),this.tryApplySuper("doObjectChange",[e])},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_PATH_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this.doCreateArrowSettingSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_STARTING_ARROW"));this._startingArrowSetter=i.widget,this._startingArrowElem=i.elem;var n=this.doCreateArrowSettingSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_ENDING_ARROW"));this._endingArrowSetter=n.widget,this._endingArrowElem=n.elem;var o=this.doCreateLineSettingSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_LINE"));return this._lineSetter=o.widget,this._lineElem=o.elem,r=r.concat([i.elem,n.elem,o.elem]),this.updateComponents(),r},doCreateSectionElem:function(e,t,r,n){var o=e.createElement("div"),a=e.createElement("label");Kekule.DomUtils.setElementText(a,r),a.className=i.GLYPH_PATH_SETTING_PANEL_SECTION_TITLE,o.appendChild(a);var s=i.GLYPH_PATH_SETTING_PANEL_SECTION;return n&&(s+=" "+n),o.className=s,t.appendChild(o),o},doCreateArrowSettingSection:function(e,t,r){var n=this.doCreateSectionElem(e,t,r),o=new Kekule.ChemWidget.GlyphPathArrowSettingPanel(this);return o.addClassName(i.GLYPH_PATH_SETTING_PANEL_SECTION_PANEL),o.appendToElem(n),{elem:n,widget:o}},doCreateLineSettingSection:function(e,t,r){var n=this.doCreateSectionElem(e,t,r),o=new Kekule.ChemWidget.GlyphPathLineSettingPanel(this);return o.addClassName(i.GLYPH_PATH_SETTING_PANEL_SECTION_PANEL),o.appendToElem(n),{elem:n,widget:o}},updateComponents:function(){var e=this.getComponents()||this.DEF_COMPONENTS,t=Kekule.StyleUtils;t.setDisplay(this._startingArrowElem,e.indexOf("startingArrow")>=0),t.setDisplay(this._endingArrowElem,e.indexOf("endingArrow")>=0),t.setDisplay(this._lineElem,e.indexOf("line")>=0)},reactChildSetterValueChange:function(e){var t=e.widget;if(t&&this.getChildValueSetterWidgets().indexOf(t)>=0){var r=this.getValue();e.stopPropagation(),this.notifyPropSet("value",r),this.invokeEvent("valueChange",{value:r})}},reactChildSetterValueInput:function(e){var t=e.widget;if(t&&this.getChildValueSetterWidgets().indexOf(t)>=0){var r=this.getValue();e.stopPropagation(),this.notifyPropSet("value",r),this.invokeEvent("valueInput",{value:r})}},getChildValueSetterWidgets:function(e){return[this._startingArrowSetter,this._endingArrowSetter,this._lineSetter]},getStartingArrowSetter:function(){return this._startingArrowSetter},getEndingArrowSetter:function(){return this._endingArrowSetter},_addPropPrefix:function(t,r){for(var i={},n=e.getOwnedFieldNames(t,!1),o=0,a=n.length;o<a;++o){var s=t[n[o]];i[r+n[o].capitalizeFirst()]=s}return i},_splitChildSetterValues:function(t){for(var r={startingArrow:{},endingArrow:{},line:{}},i=e.getOwnedFieldNames(t),n=0,o=i.length;n<o;++n){var a,s=i[n],l=t[s];s.startsWith("startArrow")?(a="arrow"+s.substr(10),r.startingArrow[a]=l):s.startsWith("endArrow")?(a="arrow"+s.substr(8),r.endingArrow[a]=l):r.line[s]=l}return r}}),Kekule.ChemWidget.GlyphMultiPathSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiPathSettingPanel",DEF_PATH_COUNT:2,DEF_COMPONENTS:["endingArrow"],initialize:function(e){this.setPropStoreFieldValue("value",[]),this.tryApplySuper("initialize",[e]),this.getPathCount()||this.setPathCount(this.DEF_PATH_COUNT),this.setActivePathIndex(0);var t=this.reactChildSetterValueChange.bind(this),r=this.reactChildSetterValueInput.bind(this);this.addEventListener("valueChange",t),this.addEventListener("valueInput",r),this.addEventListener("switch",this.reactPathTabSwitch.bind(this))},initProperties:function(){this.defineProp("pathCount",{dataType:DataType.INT,getter:function(){return this.getPathTabGroup().getTabButtons().length},setter:function(e){this._updatePathTabGroup(e)}}),this.defineProp("pathSettingPanel",{dataType:"Kekule.ChemWidget.GlyphPathSettingPanel",serializable:!1,setter:null}),this.defineProp("pathTabGroup",{dataType:"Kekule.Widget.TabButtonGroup",serializable:!1,setter:null}),this.defineProp("activePathIndex",{dataType:DataType.INT,getter:function(){return this.getPathTabGroup().getActiveTabIndex()},setter:function(e){this.getPathTabGroup().setActiveTabIndex(e),this._switchToNewPathTab(e)}}),this.defineProp("value",{dataType:DataType.HASH,setter:function(e){if(e){var r=t.toArray(e);this.setPropStoreFieldValue("value",r),r.length>this.getActivePathIndex()&&this.getPathSettingPanel().setValue(r[this.getActivePathIndex()])}else this.setPropStoreFieldValue("value",[])}}),this.defineProp("components",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPathSettingPanel();return e&&e.getComponents()},setter:function(e){this.getPathSettingPanel().setComponents(e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_MULTIPATH_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),n=new Kekule.Widget.TabButtonGroup(this);n.setTabButtonPosition(Kekule.Widget.Position.TOP).addClassName(i.GLYPH_MULTIPATH_SETTING_PANEL_PATH_TABGROUP),this.setPropStoreFieldValue("pathTabGroup",n);var o=new Kekule.ChemWidget.GlyphPathSettingPanel(this);return o.addClassName(i.GLYPH_MULTIPATH_SETTING_PANEL_PATH_SETTING_PANEL),o.setComponents(this.DEF_COMPONENTS),this.setPropStoreFieldValue("pathSettingPanel",o),r},getStartingArrowSetter:function(){return this.getPathSettingPanel().getStartingArrowSetter()},getEndingArrowSetter:function(){return this.getPathSettingPanel().getEndingArrowSetter()},_updatePathTabGroup:function(e){this.getActivePathIndex();var t=this.getPathCount();if(t!==e){var r=this.getPathTabGroup(),i=r.getTabButtons();if(t>e)for(var n=t-1;n>=e;--n){var o=i[n];r.removeWidget(o)}else for(n=t;n<e;++n){o=new Kekule.Widget.RadioButton(r);var a=Kekule.$L("ChemWidgetTexts.CAPTION_PATH_INDEX").format(""+(n+1)),s=Kekule.$L("ChemWidgetTexts.HINT_PATH_INDEX").format(""+(n+1));o.setText(a).setHint(s)}}},_switchToNewPathTab:function(e){if(e>=0){var t=(this.getValue()||[])[e];this.getPathSettingPanel().setValue(t||{})}},reactChildSetterValueChange:function(e){var t=this.getActivePathIndex();if(t>=0){var r=e.widget;if(r===this.getPathSettingPanel()){var i=r.getValue();e.stopPropagation();var n=this.getValue()||[];n[t]=i,this.setPropStoreFieldValue("value",n),this.notifyPropSet("value",n),this.invokeEvent("valueChange",{value:n})}}},reactChildSetterValueInput:function(e){var t=this.getActivePathIndex();if(t>=0){var r=e.widget;if(r===this.getPathSettingPanel()){var i=r.getValue();e.stopPropagation();var n=this.getValue()||[];n[t]=i,this.setPropStoreFieldValue("value",n),this.notifyPropSet("value",n),this.invokeEvent("valueInput",{value:n})}}},reactPathTabSwitch:function(e){if(e.widget===this.getPathTabGroup()){var t=e.button,r=this.getPathTabGroup().getTabButtons().indexOf(t);this._switchToNewPathTab(r)}}}),Kekule.ChemWidget.GlyphReactionArrowPathSettingPanel=Class.create(Kekule.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphReactionArrowPathSettingPanel",doGetValue:function(){var e=this.tryApplySuper("doGetValue")||{};return this._reactionArrowPresetSelector&&(e.reactionArrowType=this._reactionArrowPresetSelector.getValue()),e},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._reactionArrowPresetSelector&&(this._reactionArrowPresetSelector.setValue(e.reactionArrowType),this._updateArrowSettingPanelEnableState())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.doCreateReactionArrowPresetSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_TYPE"));this._reactionArrowPresetSelector=r.widget,this._reactionArrowPresetElem=r.elem;var i=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updateComponents(),i},doCreateReactionArrowPresetSection:function(e,t,r){var n=this.doCreateSectionElem(e,t,r,i.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION),o=new Kekule.ChemWidget.GlyphReactionArrowPresetSelector(this);return o.appendToElem(n),{elem:n,widget:o}},updateComponents:function(){this.tryApplySuper("updateComponents"),this._updateArrowSettingPanelEnableState()},_updateArrowSettingPanelEnableState:function(){var e=Kekule.Glyph.ReactionArrowType,r=this._reactionArrowPresetSelector.getValue(),i=null,n=null,o=e.getDefPathParamOfArrowType(r);if(o){o.startArrowType,o.endArrowType;var a=o.hasOwnProperty("startArrowType")&&o.startArrowType,s=o.hasOwnProperty("endArrowType")&&o.endArrowType;if(a&&(i=this._startingArrowSetter.getDefaultAllowedArrowTypes(),i=t.exclude(i,[Kekule.Glyph.ArrowType.NONE])),s){n=this._endingArrowSetter.getDefaultAllowedArrowTypes();n=t.exclude(n,[Kekule.Glyph.ArrowType.NONE])}this._startingArrowSetter.setEnabled(a),this._endingArrowSetter.setEnabled(s)}else this._startingArrowSetter.setEnabled(!0),this._endingArrowSetter.setEnabled(!0);this._startingArrowSetter.setAllowedArrowTypes(i),this._endingArrowSetter.setAllowedArrowTypes(n)},_updatePathParamsByReactionArrowPreset:function(t){var r=Kekule.Glyph.ArrowType,i=Kekule.Glyph.ReactionArrowType.getDefPathParamOfArrowType(t);if(i||t||(i={startArrowType:r.NONE,endArrowType:r.NONE}),i){var n={},o={},a={};void 0!==i.startArrowType&&(n.arrowType=i.startArrowType),void 0!==i.startArrowSide&&(n.arrowSide=i.startArrowSide),void 0!==i.endArrowType&&(o.arrowType=i.endArrowType),void 0!==i.endArrowSide&&(o.arrowSide=i.endArrowSide),i.lineCount&&(a.lineCount=i.lineCount),i.lineGap&&(a.lineGap=i.lineGap),e.getOwnedFieldNames(n).length&&this._startingArrowSetter.setValue(Object.extend(this._startingArrowSetter.getValue(),n)),e.getOwnedFieldNames(o).length&&this._endingArrowSetter.setValue(Object.extend(this._endingArrowSetter.getValue(),o)),e.getOwnedFieldNames(a).length&&this._lineSetter.setValue(Object.extend(this._lineSetter.getValue(),a))}},getChildValueSetterWidgets:function(){var e=this.tryApplySuper("getChildValueSetterWidgets");return e.push(this._reactionArrowPresetSelector),e},reactChildSetterValueChange:function(e){e.widget===this._reactionArrowPresetSelector&&(this._updateArrowSettingPanelEnableState(),this._updatePathParamsByReactionArrowPreset(e.value)),this.tryApplySuper("reactChildSetterValueChange",[e])}}),Kekule.ChemWidget.GlyphArcPathSettingPanel=Class.create(Kekule.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphArcPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_ARC_PATH_SETTING_PANEL}}),Kekule.ChemWidget.GlyphMultiArcPathSettingPanel=Class.create(Kekule.ChemWidget.GlyphMultiPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiArcPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_MULTIARC_PATH_SETTING_PANEL}}),Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],initialize:function(e){this._glyphPathSettingPanel=null,this._endingArrowSetter=null,this._arrowPresetSelector=null,this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this.reactChildSetterValueChange.bind(this)),this.addEventListener("valueInput",this.reactChildSetterValueInput.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e=this._glyphPathSettingPanel.getValue()||{};return e.electronCount=this._arrowPresetSelector.getValue(),e},setter:function(e){this._glyphPathSettingPanel.setValue(e),this._arrowPresetSelector.setValue(e&&e.electronCount),this._updateArrowSettingPanel()}})},doCreateSubElements:function(e,t){var n=this.tryApplySuper("doCreateSubElements",[e,t]),o=this.doCreateArrowPresetSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));this._arrowPresetSelector=o.widget,this._arrowPresetElem=o.elem,Kekule.HtmlElementUtils.addClass(this._arrowPresetElem,i.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION);var a=this.doCreateGlyphPathSettingSection(e,t);if(this._glyphPathSettingPanel=a.widget,this._glyphPathSettingPanel&&(this._glyphPathSettingPanel.removeClassName(r.PANEL),this._glyphPathSettingPanel.setComponents&&this._glyphPathSettingPanel.setComponents(this.DEF_COMPONENTS),this._glyphPathSettingPanel.getEndingArrowSetter)){this._endingArrowSetter=this._glyphPathSettingPanel.getEndingArrowSetter();var s=Kekule.Glyph.ArrowType;this._endingArrowSetter.setAllowedArrowTypes([s.OPEN,s.TRIANGLE])}return n.concat([o.elem,a.elem])},doCreateSectionElem:function(e,t,r,n){var o=e.createElement("div");if(r){var a=e.createElement("label");Kekule.DomUtils.setElementText(a,r),a.className=i.GLYPH_PATH_SETTING_PANEL_SECTION_TITLE,o.appendChild(a)}var s=i.GLYPH_PATH_SETTING_PANEL_SECTION;return n&&(s+=" "+n),o.className=s,t.appendChild(o),o},doCreateArrowPresetSection:function(e,t,r){var i=this.doCreateSectionElem(e,t,r),n=new Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return n.appendToElem(i),{elem:i,widget:n}},doCreateGlyphPathSettingSection:function(e,t,r){var i=this.doCreateGlyphPathSettingWidget();if(i){var n=this.doCreateSectionElem(e,t,r);return i.appendToElem(n),{elem:n,widget:i}}return null},doCreateGlyphPathSettingWidget:function(){return null},reactChildSetterValueChange:function(e){var t=e.widget;t===this._arrowPresetSelector&&this._updateArrowSettingPanel(),[this._arrowPresetSelector,this._glyphPathSettingPanel].indexOf(t)>=0&&(e.stopPropagation(),this.invokeEvent("valueChange",{value:this.getValue()})),this.tryApplySuper("reactChildSetterValueChange",[e])},reactChildSetterValueInput:function(e){var t=e.widget;t===this._arrowPresetSelector&&this._updateArrowSettingPanel(),[this._arrowPresetSelector,this._glyphPathSettingPanel].indexOf(t)>=0&&(e.stopPropagation(),this.invokeEvent("valueInput",{value:this.getValue()})),this.tryApplySuper("reactChildSetterValueInput",[e])},_updateArrowSettingPanel:function(){var e=Kekule.Glyph.ArrowSide,t=this._endingArrowSetter,r=this._arrowPresetSelector.getValue(),i=[];i=r>=2?[e.BOTH]:1===r?[e.SINGLE,e.REVERSED]:[e.BOTH,e.SINGLE,e.REVERSED],t.setAllowedArrowSides(i)}}),Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel=Class.create(Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel",doCreateGlyphPathSettingWidget:function(){return new Kekule.ChemWidget.GlyphArcPathSettingPanel(this)}}),Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel=Class.create(Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel",doCreateGlyphPathSettingWidget:function(){return new Kekule.ChemWidget.GlyphMultiArcPathSettingPanel(this)}}),Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel_OLD=Class.create(Kekule.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],initialize:function(e){this.tryApplySuper("initialize",[e]);var t=Kekule.Glyph.ArrowType;this._endingArrowSetter.setAllowedArrowTypes([t.OPEN,t.TRIANGLE])},doGetValue:function(){var e=this.tryApplySuper("doGetValue")||{};return this._arrowPresetSelector&&(e.electronCount=this._arrowPresetSelector.getValue()),e},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._arrowPresetSelector&&(this._arrowPresetSelector.setValue(e.electronCount),this._updateArrowSettingPanel())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_ELECTRON_PUSHING_ARROW_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.doCreateArrowPresetSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));return this._arrowPresetSelector=r.widget,this._arrowPresetElem=r.elem,this.tryApplySuper("doCreateSubElements",[e,t])},doCreateArrowPresetSection:function(e,t,r){var i=this.doCreateSectionElem(e,t,r),n=new Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return n.appendToElem(i),{elem:i,widget:n}},getChildValueSetterWidgets:function(){var e=this.tryApplySuper("getChildValueSetterWidgets");return e.push(this._arrowPresetSelector),e.push(this._reversedArrowSideCheckBox),e},reactChildSetterValueChange:function(e){e.widget===this._arrowPresetSelector&&this._updateArrowSettingPanel(),this.tryApplySuper("reactChildSetterValueChange",[e])},_updateArrowSettingPanel:function(){var e=Kekule.Glyph.ArrowSide,t=this.getEndingArrowSetter(),r=this._arrowPresetSelector.getValue(),i=[];i=r>=2?[e.BOTH]:1===r?[e.SINGLE,e.REVERSED]:[e.BOTH,e.SINGLE,e.REVERSED],t.setAllowedArrowSides(i)}}),Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel_OLD=Class.create(Kekule.ChemWidget.GlyphMultiPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.GLYPH_MULTI_ELECTRON_PUSHING_ARROW_SETTING_PANEL},initialize:function(e){this.tryApplySuper("initialize",[e]);var t=Kekule.Glyph.ArrowType;this._endingArrowSetter=this.getPathSettingPanel().getEndingArrowSetter(),this._endingArrowSetter.setAllowedArrowTypes([t.OPEN,t.TRIANGLE])},doGetValue:function(){var e=this.tryApplySuper("doGetValue")||{};return this._arrowPresetSelector&&(e.electronCount=this._arrowPresetSelector.getValue()),e},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._arrowPresetSelector&&(this._arrowPresetSelector.setValue(e.electronCount),this._updateArrowSettingPanel())},doCreateSubElements:function(e,t){var r=this.doCreateArrowPresetSection(e,t,Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));return this._arrowPresetSelector=r.widget,this._arrowPresetElem=r.elem,this.tryApplySuper("doCreateSubElements",[e,t])},doCreateSectionElem:function(e,t,r,n){var o=e.createElement("div"),a=e.createElement("label");Kekule.DomUtils.setElementText(a,r),o.appendChild(a);var s=i.GLYPH_PATH_SETTING_PANEL_SECTION;return n&&(s+=" "+n),o.className=s,t.appendChild(o),o},doCreateArrowPresetSection:function(e,t,r){var i=this.doCreateSectionElem(e,t,r),n=new Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return n.appendToElem(i),{elem:i,widget:n}},_updateArrowSettingPanel:function(){var e=Kekule.Glyph.ArrowSide,t=this.getEndingArrowSetter(),r=this._arrowPresetSelector.getValue(),i=[];i=r>=2?[e.BOTH]:1===r?[e.SINGLE,e.REVERSED]:[e.BOTH,e.SINGLE,e.REVERSED],t.setAllowedArrowSides(i)}})}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.CoordUtils,r=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMSPACE_EDITOR:"K-Chem-Space-Editor",CHEMSPACE_EDITOR2D:"K-Chem-Space-Editor2D",CHEMSPACE_EDITOR3D:"K-Chem-Space-Editor3D",CHEMEDITOR_ATOM_SETTER:"K-ChemEditor-Atom-Setter",CHEMEDITOR_TEXT_SETTER:"K-ChemEditor-Text-Setter",CHEMEDITOR_FORMULA_SETTER:"K-ChemEditor-Formula-Setter"}),Kekule.globalOptions.add("chemWidget.editor",{enableSelect:!0,enableFileDrop:!0,allowCreateNewChild:!0,autoCreateNewStructFragment:!0,allowAppendDataToCurr:!0,enableGesture:!0,initOnNewDoc:!0}),Kekule.globalOptions.add("chemWidget.editor.molManipulation",{enableNodeStick:!0,enableStructFragmentStick:!0,enableConstrainedMove:!0,enableConstrainedRotate:!0,enableConstrainedResize:!0,enableDirectedMove:!0}),Kekule.globalOptions.add("chemWidget.editor.bondManipulation",{enableBondModification:!0,allowBondingToBond:!1,autoSwitchBondOrder:!1}),Kekule.Editor.ChemSpaceEditor=Class.create(Kekule.Editor.BaseEditor,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor",initialize:function(e,t,r,i){var n=Kekule.globalOptions.get;this.setPropStoreFieldValue("allowCreateNewChild",n("chemWidget.editor.allowCreateNewChild",!0)),this.setPropStoreFieldValue("autoCreateNewStructFragment",n("chemWidget.editor.autoCreateNewStructFragment",!0)),this.setPropStoreFieldValue("allowAppendDataToCurr",n("chemWidget.editor.autoCreateNewStructFragment",!0)),this.tryApplySuper("initialize",[e,t,r,i]),this._containerChemSpace=null},initProperties:function(){this.defineProp("chemSpace",{dataType:"Kekule.ChemSpace",serializable:!1,getter:function(){return this.getChemObj()},setter:function(e){this.setChemObj(e)}}),this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("autoCreateNewStructFragment")&&this.canCreateNewChild()}}),this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setFileDroppable(Kekule.globalOptions.get("chemWidget.editor.enableFileDrop",!0))},canCreateNewChild:function(){return this.getChemSpace()&&(this.getAllowCreateNewChild()||this.getChemSpace().getChildCount()<=0)},getActualDrawOptions:function(){var e=this.tryApplySuper("getActualDrawOptions");return e.useExplicitSpaceSize=!0,e},doSetChemObj:function(e){var t=this.getChemObj();if(t!==e)if(t&&this._containerChemSpace&&(t.finalize(),this._containerChemSpace=null),e){if(e instanceof Kekule.ChemSpace)this._initChemSpaceDefProps(e),this.tryApplySuper("doSetChemObj",[e]);else{var r=this.createContainerChemSpace(null,e);this._containerChemSpace=r,this.tryApplySuper("doSetChemObj",[r])}if(this.getEditorConfigs().getInteractionConfigs().getAutoExpandClientSizeAfterLoading()&&this.autoExpandChemSpaceSize(),e instanceof Kekule.ChemSpace&&this.getEditorConfigs().getInteractionConfigs().getScrollToObjAfterLoading()){var i=e.getChildren();i&&i.length&&this.scrollClientToObject(i)}}else this.tryApplySuper("doSetChemObj",[e]);else this.tryApplySuper("doSetChemObj",[e])},getExportableClasses:function(){var e=this.tryApplySuper("getExportableClasses"),t=this.getChemSpace();if(t){t.iterateChildren(function(t){if(t.isStandalone&&t.isStandalone()&&t.getClass){var r=t.getClass();Kekule.ArrayUtils.pushUnique(e,r)}},!0)}return e},exportObjs:function(e){var t=this.tryApplySuper("exportObjs",[e]);if((!t||!t.length)&&e){t=[];t=this.getChemSpace().filterChildren(function(t){return t&&t instanceof e},!0)}return t},getSavingTargetObj:function(){var e=this.getChemSpace();return 1===e.getChildCount()?e.getChildAt(0):this.tryApplySuper("getSavingTargetObj")},_cloneSavingTargetObj:function(e){var t=this.getChemSpace();return 1===t.getChildCount()&&e===t.getChildAt(0)?t.clone(!0).getChildAt(0):this.tryApplySuper("_cloneSavingTargetObj",[e])},createDefaultConfigs:function(){return Kekule.Editor.ChemSpaceEditorConfigs.getInstance()},doCreateNewDocObj:function(){return this.createContainerChemSpace()},doLoad:function(e){this._supplyChemMarkersOnObj(e),this.tryApplySuper("doLoad",[e])},doLoadEnd:function(e){var t=this.tryApplySuper("doLoadEnd",[e]),r=null;if(e){var i=e.getAllContainingConnectors();if(i&&i.length){var n=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;r=Kekule.ChemStructureUtils.getConnectorLengthMedian(i,n,this.getAllowCoordBorrow())}}return this.setDefBondLength(r),t},resetDisplay:function(){this.tryApplySuper("resetDisplay"),this.resetClientDisplay()},resetClientDisplay:function(e){if(!this.isUpdatingObject())return this._resetClientDisplayCore(e);var t=this;this._registerAfterUpdateObjectProc(function(){t._resetClientDisplayCore(e)})},_resetClientDisplayCore:function(e){var t=this.getChemObj();if(t){var r;e&&(r=this.getClientScrollPosition());var i=t.getScreenSize();this.changeClientSize(i.x,i.y,this.getCurrZoom());var n=this.getEditClientElem().parentNode,o=Kekule.HtmlElementUtils.getElemClientDimension(n);e?this.scrollClientTo(r.y,r.x):this.scrollClientTo(0,(i.x*this.getCurrZoom()-o.width)/2)}},zoomChanged:function(e){this.tryApplySuper("zoomChanged");var t=this.getChemObj();if(t){var r=t.getScreenSize();this.changeClientSize(r.x,r.y,e)}},createNewBoundInfoRecorder:function(e){this.tryApplySuper("createNewBoundInfoRecorder",[e]);var t=this.getBoundInfoRecorder();t&&t.addEventListener("updateBasicDrawObject",this.reactUpdateBasicDrawObject,this)},reactUpdateBasicDrawObject:function(e){var t=e.obj;if(t&&t instanceof Kekule.TextBlock){var r=e.boundInfo;this.updateTextBlockSize(t,r)}},objectChanged:function(e,t){return this.tryApplySuper("objectChanged",[e,t])},doManipulationEnd:function(){if(this.getEditorConfigs().getInteractionConfigs().getAutoExpandClientSizeAfterManipulation()){var e=this._calcChemSpaceAutoExpandInfo();if(e){var t=this._createChemSpaceAutoExpandOperations(e);if(t){this.getEnableOperHistory()&&this._appendOpersToLastManipulationOperation(t);for(var r=0,i=t.length;r<i;++r)t[r].execute()}}}return this.tryApplySuper("doManipulationEnd")},_appendOpersToLastManipulationOperation:function(e){var t=this.getOperationsInCurrManipulation();if(t&&t.length){var r=t[t.length-1],i=this.getOperHistory();if(i){var n=i.getOperations(),o=n.indexOf(r);if(o>=0){var a;r instanceof Kekule.MacroOperation?a=r:(a=new Kekule.MacroOperation([r]),n.splice(o,1,a),t.splice(t.length-1,1,a));for(var s=0,l=e.length;s<l;++s)a.add(e[s])}}}},updateTextBlockSize:function(e,t){if(this.getCoordMode()===Kekule.CoordMode.COORD2D&&e.getNeedRecalcSize()){t.shapeType;Kekule.Render.BoundShapeType.RECT}},createContainerChemSpace:function(e,t){var r=new Kekule.ChemDocument(e);if(this._initChemSpaceDefProps(r,t),t){r.appendChild(t);var i,n=r.getSizeOfMode(this.getCoordMode(),this.getAllowCoordBorrow()),o=Kekule.Render.ObjUtils.getContainerBox(t,this.getCoordMode(),this.getAllowCoordBorrow());if(this.getCoordMode()===Kekule.CoordMode.COORD2D)var a=this.getEditorConfigs().getChemSpaceConfigs().getDefPadding(),s=r.getObjScreenLengthRatio();var l=t.getAbsBaseCoord&&t.getAbsBaseCoord(this.getCoordMode(),this.getAllowCoordBorrow())||{};if(s&&o){i=Kekule.CoordUtils.divide(n,2);var u={x:(o.x1+o.x2)/2,y:(o.y1+o.y2)/2},d={x:i.x,y:n.y-a*s-(o.y2-o.y1)/2},c=Kekule.CoordUtils.substract(d,u);i=Kekule.CoordUtils.add(l,c)}else i=Kekule.CoordUtils.divide(n,2);t.setAbsBaseCoord&&t.setAbsBaseCoord(i,this.getCoordMode())}return r},_initChemSpaceDefProps:function(e,t,r){var i=this.getEditorConfigs(),n=i.getChemSpaceConfigs();if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var o=e.getScreenSize();if(o.x||o.y||(o=n.getDefScreenSize2D(),e.setScreenSize(o)),!e.getDefAutoScaleRefLength()){var a,s;if(t&&t.getAllAutoScaleRefLengths)a=(s=t.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow()))&&s.length?Kekule.ArrayUtils.getMedian(s):null;else a=(s=e.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow())).length?Kekule.ArrayUtils.getMedian(s):null;a||(a=i.getStructureConfigs().getDefBondLength()),e.setDefAutoScaleRefLength(a)}if(!e.getSize2D()||r){var l=this.getRenderConfigs().getLengthConfigs().getDefBondLength(),u=e.getDefAutoScaleRefLength()/l;e.setObjScreenLengthRatio(u),e.setSize2D({x:o.x*u,y:o.y*u})}}e.setIsEditing&&e.setIsEditing(!0)},_getChemSpaceObjScreenLengthRatio:function(){var e=this.getChemSpace(),t=e.getObjScreenLengthRatio();if(!t){var r=this.getRenderConfigs().getLengthConfigs().getDefBondLength();t=e.getDefAutoScaleRefLength()/r}return t},changeChemSpaceSize:function(e,t){var r=this.getChemSpace();r.beginUpdate();try{if(r.setSizeOfMode(e,t),t===Kekule.CoordMode.COORD2D){var i=this._getChemSpaceObjScreenLengthRatio();i&&r.setScreenSize({x:e.x/i,y:e.y/i})}}finally{r.endUpdate()}this.resetClientDisplay(!0)},changeChemSpaceScreenSize:function(e){var t=this.getChemSpace();t.beginUpdate();try{var r=this._getChemSpaceObjScreenLengthRatio();r&&t.setSize2D({x:e.x*r,y:e.y*r}),t.setScreenSize(e)}finally{t.endUpdate()}this.resetClientDisplay(!0)},_shiftChemSpaceChildCoord:function(e,r,i){var n=this.getChemSpace(),o=n.getChildren();if(o){var a;i&&(a=this.getClientScrollCoord(Kekule.Editor.CoordSys.CHEM)),this.beginUpdateObject();try{n.beginUpdate();try{for(var s=this.getAllowCoordBorrow(),l=0,u=o.length;l<u;++l){var d=o[l];if(d&&d.setCoordOfMode){var c=d.getCoordOfMode(r,s)||{};d.setCoordOfMode(t.add(c,e))}}i&&this.scrollClientToCoord(a,Kekule.Editor.CoordSys.CHEM)}finally{n.endUpdate()}}finally{this.endUpdateObject()}}},_calcExpandChemSpaceSizeToTargetObjsInfo:function(e,t){if(e&&e.length){var r=this._getTargetObjsExposedContainerBoxInfo(e).totalBox;if(r)return this._calcExpandChemSpaceSizeToContainerBoxInfo(r,t)}return null},_calcExpandChemSpaceSizeToContainerBoxInfo:function(e,r){var i=Kekule.CoordMode,n=this.getChemSpace(),o=r===i.COORD3D,a=["x","y"];o&&a.push("z");for(var s=this.getEditorConfigs().getChemSpaceConfigs(),l=this._getChemSpaceObjScreenLengthRatio(),u=s.getDefPadding()*l,d=o?n.getSize3D():n.getSize2D(),c=Kekule.BoxUtils.getMinMaxCoords(e),h=c.min,p={},g=!1,f=0,C=a.length;f<C;++f){(_=h[a[f]])<u?(p[a[f]]=u-_,g=!0):p[a[f]]=0}var m=c.max,T={},E=!1;for(f=0,C=a.length;f<C;++f){var _;(_=m[a[f]])>d[a[f]]-u?(T[a[f]]=_-(d[a[f]]-u),E=!0):T[a[f]]=0}var S={},O={};if(g||E){var y=o?s.getAutoExpandScreenSize2D():s.getAutoExpandScreenSize3D(),A=t.multiply(y,l);for(f=0,C=a.length;f<C;++f){var I=a[f];S[I]=p[I]+T[I];var k=Math.ceil(S[I]/A[I]);O[I]=k*A[I]}var b={newSize:t.add(d,O)};return g&&(b.coordShift=p),b}return null},_expandChemSpaceSizeAndShiftChildrenCoords:function(e,t,r){this.beginUpdateObject();try{t&&this._shiftChemSpaceChildCoord(t,r,!0),this.changeChemSpaceSize(e,r)}finally{this.endUpdateObject()}},_expandChemSpaceSizeToContainerBox:function(e,t){var r=this._calcExpandChemSpaceSizeToContainerBoxInfo(e,t);return r&&this._expandChemSpaceSizeAndShiftChildrenCoords(r.newSize,r.coordShift,t),r},expandChemSpaceSizeToTargetObjs:function(e,t){if(Kekule.ObjUtils.isUnset(t)&&(t=this.getCoordMode()),e&&e.length){var r=this._getTargetObjsExposedContainerBoxInfo(e).totalBox;r&&this._expandChemSpaceSizeToContainerBox(r,t)}return this},autoExpandChemSpaceSize:function(){if(this._isAutoExpandingChemSpace)return this;this._isAutoExpandingChemSpace=!0;try{var e=this.getChemSpace().getChildren();e&&this.expandChemSpaceSizeToTargetObjs(e,this.getCoordMode())}finally{this._isAutoExpandingChemSpace=!1}return this},_calcChemSpaceAutoExpandInfo:function(){var e=this.getChemSpace().getChildren();return e?this._calcExpandChemSpaceSizeToTargetObjsInfo(e,this.getCoordMode()):null},_createChemSpaceAutoExpandOperations:function(e){if(e){var t=[],r=this.getChemSpace(),i=this.getCoordMode();return t.push(new Kekule.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords(r,e.newSize,e.coordShift,i,this)),t}return null},createNewStructFragmentAnchor:function(e){if(this.getAutoCreateNewStructFragment()){var t=new Kekule.Molecule(e);return this.getChemSpace().appendChild(t),t}return null},createStructStartingAtom:function(e,t,r,i){this.beginUpdateObject();try{if(e){i||(i=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId());var n=new Kekule.Atom(null,i);return e.appendNode(n),n.setAbsCoordOfMode(r,this.getCoordMode()),n}return null}finally{this.endUpdateObject()}},createNewStructFragmentAndStartingAtom:function(e,t,r){this.beginUpdateObject();try{var i;return(i=this.createNewStructFragmentAnchor(e))?this.createStructStartingAtom(i,e,t,r):null}finally{this.endUpdateObject()}},hasOnlyOneBlankStructFragment:function(){var e=!1;if(1===this.getChemSpace().getChildCount()){var t=this.getChemSpace().getChildAt(0);t instanceof Kekule.StructureFragment&&t.getNodeCount()<=0&&t.getConnectorCount()<=0&&!t.hasFormula()&&(e=!0)}return e},getOnlyOneBlankStructFragment:function(){if(this.hasOnlyOneBlankStructFragment())return this.getChemSpace().getChildAt(0)},canAddNewStandaloneObject:function(){return this.getAllowCreateNewChild()||this.getChemSpace().getChildCount()<=0},canAddUnconnectedStructFragment:function(){return this.canAddNewStandaloneObject()||this.hasOnlyOneBlankStructFragment()},canCloneObjects:function(){return this.getAllowCreateNewChild()},cloneObjects:function(t,r,i,n){var o=this;if(!this.getChemSpace())return null;for(var a=this.getAllowCreateNewChild(),s=function(e,t){for(var r=0,i=t.length;r<i;++r){if(t[r].isChildOf(e))return!0}return!1},l=function(t,r,i){if(i.indexOf(r)>=0)e.remove(i,r);else if(t.getChildAt&&r.getChildAt)for(var n=r.getChildCount()-1;n>=0;--n){var o=t.getChildAt(n);if(i.length){var a=r.getChildAt(n);i.indexOf(a)>=0?e.remove(i,a):s(a,i)?a.getChildObjs&&l(o,a,i):t.removeChild(o)}else t.removeChild(o)}},u=function(e,t){for(var r=0,i=t.length;r<i;++r){var n=t[r];if(e===n||e.isChildOf&&e.isChildOf(n))return n}return null},d=function(t,r,i){var n,o,a=t.relation,s=t.srcParent,l=t.destParents,u=[],d=i[r.indexOf(s)];if(a.srcObj===s?o=d:(n=s.indexStackOfChild&&s.indexStackOfChild(a.srcObj))&&(o=d.getChildAtIndexStack&&d.getChildAtIndexStack(n)),!o)return null;for(var c=e.isArray(a.dest),h=c?a.dest:[a.dest],p=0,g=l.length;p<g;++p){var f,C=l[p],m=i[r.indexOf(C)];C&&(C===h[p]?u.push(m):h[p]&&(n=C.indexStackOfChild&&C.indexStackOfChild(h[p]))&&(f=m.getChildAtIndexStack&&m.getChildAtIndexStack(n))&&u.push(f))}if(!u.length)return null;var T=c?u:u[0];return{srcObj:o,srcProp:a.srcProp,dest:T}},c=Kekule.ArrayUtils.toArray(t),h=[],p=new Kekule.MapEx,g=0,f=c.length;g<f;++g){var C=(y=c[g]).getStandaloneAncestor?y.getStandaloneAncestor():y;if(C.clone){Kekule.ArrayUtils.pushUnique(h,C);var m=p.get(C);m||(m=[],p.set(C,m)),m.push(y)}}var T=function(t,r){var i=[];r||(r=o.getChemObj());var n=r.getObjRefRelations&&r.getObjRefRelations();if(n)for(var a=0,s=n.length;a<s;++a){var l=n[a],d=l.srcObj,c=e.toArray(l.dest),h=u(d,t),p=[],g=!1;if(h){for(var f=0,C=c.length;f<C;++f){var m=c[f],T=u(m,t);T&&(g=!0),p.push(T)}g&&i.push({relation:l,srcParent:h,destParents:p})}}return i}(h,this.getChemSpace()),E=this.getChemSpace(),_=[],S=(this.getCoordMode(),this.getAllowCoordBorrow(),h.length);for(g=0;g<S;++g){(A=(y=h[g]).clone()).clearIds&&A.clearIds(),_.push(A)}var O=[];for(g=0,f=T.length;g<f;++g){(v=d(T[g],h,_))&&O.push(v)}for(g=0;g<S;++g){var y=h[g],A=_[g];if(l(A,y,p.get(y)),i&&a&&(E.appendChild(A),r)){var I=this.getObjectScreenCoord(A),k=Kekule.CoordUtils.add(I,r);this.setObjectScreenCoord(A,k)}}for(g=0,f=O.length;g<f;++g){var b,v=O[g];if(u(v.srcObj,_)){if(e.isArray(v.dest)){b=[];for(var R=0,D=v.dest.length;R<D;++R){var N=v.dest[R];u(N,_)&&b.push(N)}b.length||(b=null)}else u(v.dest,_)&&(b=v.dest);b&&v.srcObj.setPropValue(v.srcProp.name,b)}}return p.finalize(),_},cloneSelection:function(t,r,i){void 0===t&&(t=this.getDefaultCloneScreenCoordOffset());var n=this.getSelection();n=function(t,r){for(var i=[],n=0,o=t.length;n<o;++n){var a=t[n];if(a instanceof Kekule.ChemSpace&&!r){var s=a.getChildren();e.pushUnique(i,s)}else e.pushUnique(i,a)}return i}(n,i);var o=this.cloneObjects(n,t,r);return r&&this.setSelection(o),o},getDefaultCloneScreenCoordOffset:function(){var e=this.getEditorConfigs().getInteractionConfigs().getClonedObjectScreenOffset()||0,t={x:e,y:e};return this.getCoordMode()===Kekule.CoordMode.COORD3D&&(t.z=e),t},_supplyChemMarkersOnObj:function(e){if(e){var t=Kekule.ChemStructureUtils.getAllStructFragments(e,!0);if(t||t.length)for(var r=0,i=t.length;r<i;++r)this._createLosingChemMarkerOnStructFragment(t[r])}},_createLosingChemMarkerOnStructFragment:function(e){e.beginUpdate();try{e.hasExplicitCharge&&e.hasExplicitCharge()&&e.fetchChargeMarker(!0);e.getNodes();for(var t=0,r=e.getNodeCount();t<r;++t){var i=e.getNodeAt(t);i.beginUpdate();try{i.hasExplicitChargeOrElectronicBias&&i.hasExplicitChargeOrElectronicBias()&&i.fetchChargeMarker(!0),i.getRadical()&&i.fetchRadicalMarker(!0),i.getNodeAt&&this._createLosingChemMarkerOnStructFragment(i)}finally{i.endUpdate()}}}finally{e.endUpdate()}},getEnabledNonAtomInputData:function(){var e=[],t=this.getRenderConfigs().getDisplayLabelConfigs(),r=this.getEditorConfigs().getStructureConfigs().getEnabledNonAtomNodeTypes();return r.RGroup&&e.push({text:t.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")}),r.pseudoatomDummy&&e.push({text:t.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")}),r.pseudoatomHetero&&e.push({text:t.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")}),r.pseudoatomAny&&e.push({text:t.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")}),r.variableAtomList&&e.push({text:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,isVarList:!0,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")}),r.variableAtomNotList&&e.push({text:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,isVarNotList:!0,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")}),e},_getVarAtomListLabel:function(){var e=this.getRenderConfigs().getDisplayLabelConfigs();return e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var e=this.getRenderConfigs().getDisplayLabelConfigs();return"~"+(e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM)},getEnabledBondFormData:function(){for(var e=Kekule.BondType,t=Kekule.BondOrder,r=Kekule.BondStereo,i=Kekule.$L,n="K-Chem-MolBondIaController-",o={single:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),htmlClass:n+"Single",isDefault:!0,bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.NONE}},double:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),htmlClass:n+"Double",bondProps:{bondType:e.COVALENT,bondOrder:t.DOUBLE,stereo:r.NONE}},triple:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),htmlClass:n+"Triple",bondProps:{bondType:e.COVALENT,bondOrder:t.TRIPLE,stereo:r.NONE}},quad:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_QUAD"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_QUAD"),htmlClass:n+"Quad",bondProps:{bondType:e.COVALENT,bondOrder:t.QUAD,stereo:r.NONE}},explicitAromatic:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_EXPLICIT_AROMATIC"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_EXPLICIT_AROMATIC"),htmlClass:n+"Aromatic",bondProps:{bondType:e.COVALENT,bondOrder:t.EXPLICIT_AROMATIC,stereo:r.NONE}},up:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),htmlClass:n+"WedgeUp",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP}},upInverted:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP_INVERTED"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP_INVERTED"),htmlClass:n+"WedgeUpInverted",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP_INVERTED}},down:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),htmlClass:n+"WedgeDown",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.DOWN}},downInverted:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN_INVERTED"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN_INVERTED"),htmlClass:n+"WedgeDownInverted",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.DOWN_INVERTED}},upOrDown:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),htmlClass:n+"WedgeUpOrDown",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP_OR_DOWN}},closer:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),htmlClass:n+"Closer",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.CLOSER}},eOrZ:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),htmlClass:n+"Double-Either",bondProps:{bondType:e.COVALENT,bondOrder:t.DOUBLE,stereo:r.E_OR_Z}},ionic:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_IONIC"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_IONIC"),htmlClass:n+"Ionic",bondProps:{bondType:e.IONIC,bondOrder:t.SINGLE,stereo:r.NONE}},coordinate:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_COORDINATE"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_COORDINATE"),htmlClass:n+"Coordinate",bondProps:{bondType:e.COORDINATE,bondOrder:t.SINGLE,stereo:r.NONE}},metallic:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_METALLIC"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_METALLIC"),htmlClass:n+"Metallic",bondProps:{bondType:e.METALLIC,bondOrder:t.SINGLE,stereo:r.NONE}},hydrogen:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_HYDROGEN"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_HYDROGEN"),htmlClass:n+"Hydrogen",bondProps:{bondType:e.HYDROGEN,bondOrder:t.SINGLE,stereo:r.NONE}},transition:{text:i("ChemWidgetTexts.CAPTION_MOL_BOND_TRANSITION"),hint:i("ChemWidgetTexts.HINT_MOL_BOND_TRANSITION"),htmlClass:n+"Transition",bondProps:{bondType:e.TRANSITION,bondOrder:t.SINGLE,stereo:r.NONE}}},a=(i("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),i("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),this.getEditorConfigs().getStructureConfigs().getEnabledBondForms()),s=Kekule.ObjUtils.getOwnedFieldNames(a,!1),l=[],u=0,d=s.length;u<d;++u){var c=s[u];a[c]&&(DataType.isObjectValue(a[c])?l.push(a[c]):o[c]&&l.push(o[c]))}return l}}),Kekule.Editor.ChemSpaceEditor.Settings=Class.create(Kekule.Editor.BaseEditor.Settings,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor.Settings",initProperties:function(){this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAllowCreateNewChild()},setter:function(e){this.getEditor().setAllowCreateNewChild(e)}}),this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAutoCreateNewStructFragment()},setter:function(e){this.getEditor().setAutoCreateNewStructFragment(e)}}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAllowAppendDataToCurr()},setter:function(e){this.getEditor().setAllowAppendDataToCurr(e)}})}}),Kekule.Editor.BasicMolEraserIaController=Class.create(Kekule.Editor.BasicEraserIaController,{CLASS_NAME:"Kekule.Editor.BasicMolEraserIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},doGetActualRemovedObjs:function(e){for(var t=[],r=this.getEditor().getChemObj(),i=0,n=e.length;i<n;++i){var o,a=e[i];a instanceof Kekule.ChemSpace&&a===r?o=a.getChildren():(Kekule.ArrayUtils.pushUnique(t,a),o=a.getCascadeDeleteObjs?a.getCascadeDeleteObjs():[]),o&&Kekule.ArrayUtils.pushUnique(t,o)}return t},doRemoveObjs:function(e){if(e.length){for(var t=new Kekule.MacroOperation,r=[],i=0,n=e.length;i<n;++i){var o,a=e[i],s=(a.getParent(),this.getEditor());a instanceof Kekule.BaseStructureNode?(o=new Kekule.ChemStructOperation.RemoveNode(a,null,null,s),Kekule.ArrayUtils.pushUnique(r,a.getParent())):a instanceof Kekule.BaseStructureConnector?(o=new Kekule.ChemStructOperation.RemoveConnector(a,null,null,s),Kekule.ArrayUtils.pushUnique(r,a.getParent())):o=new Kekule.ChemObjOperation.Remove(a,null,null,s),o&&t.add(o)}for(i=0,n=r.length;i<n;++i){var l=r[i];if(l&&l instanceof Kekule.StructureFragment){var u=new Kekule.ChemStructOperation.StandardizeStructFragment(l,s);u.setEnableSplit(this.getEditor().canCreateNewChild()),t.add(u)}}s.execOperation(t)}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolEraserIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.BasicMolManipulationIaController=Class.create(Kekule.Editor.BasicManipulationIaController,{CLASS_NAME:"Kekule.Editor.BasicMolManipulationIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._suppressConstrainedMoving=!1,this._suppressConstrainedRotating=!1,this._isInDirectedMoving=!1,this._directedMovingDirection=null},initProperties:function(){this._defineEditorConfigBasedProperty("enableMagneticMerge","interactionConfigs.enableMagneticMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableNodeMerge","interactionConfigs.enableNodeMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableNeighborNodeMerge","interactionConfigs.enableNeighborNodeMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableConnectorMerge","interactionConfigs.enableConnectorMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableStructFragmentMerge","interactionConfigs.enableStructFragmentMerge",{overwrite:!0}),this.defineProp("allManipulateObjsMerged",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("isMergeDone",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableNodeStick",{dataType:DataType.BOOL}),this.defineProp("enableSiblingStick",{dataType:DataType.BOOL}),this.defineProp("enableStructFragmentStick",{dataType:DataType.BOOL}),this.defineProp("enableConstrainedMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableConstrainedRotate",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableConstrainedResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableDirectedMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("stickOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergeOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergePreviewOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergingDests",{dataType:DataType.ARRAY,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Kekule.globalOptions.get("chemWidget.editor.molManipulation",{});e=Object.extend({enableMagneticMerge:!0,enableNodeMerge:!0,enableNeighborNodeMerge:!0,enableConnectorMerge:!0,enableStructFragmentMerge:!0,enableNodeStick:!0,enableStructFragmentStick:!0,enableConstrainedMove:!0,enableConstrainedRotate:!0,enableConstrainedResize:!0,enableDirectedMove:!0},e),this.setEnableMagneticMerge(e.enableMagneticMerge),this.setEnableNodeMerge(e.enableNodeMerge),this.setEnableNeighborNodeMerge(e.enableNeighborNodeMerge),this.setEnableConnectorMerge(e.enableConnectorMerge),this.setEnableStructFragmentMerge(e.enableStructFragmentMerge),this.setEnableNodeStick(e.enableNodeStick),this.setEnableStructFragmentStick(e.enableStructFragmentStick),this.setEnableConstrainedMove(e.enableConstrainedMove),this.setEnableConstrainedRotate(e.enableConstrainedRotate),this.setEnableConstrainedResize(e.enableConstrainedResize),this.setEnableDirectedMove(e.enableDirectedMove)},canInteractWithObj:function(e){return this.tryApplySuper("canInteractWithObj",[e])||this._isMerging&&e},doSetManipulateObjs:function(t){var r=t?e.clone(t):[];this.getMergingDests()&&!this.useMergePreview()&&e.pushUnique(r,this.getMergingDests()),this.setPropStoreFieldValue("manipulateObjs",t),t?this.getEditor().prepareOperatingObjs(r):this.getEditor().endOperatingObjs()},isConstrainedRotate:function(){return this.getEnableConstrainedMove()},isConstrainedResize:function(){return this.getEnableConstrainedResize()},isConstrainedMove:function(){if(!this.getEnableConstrainedMove())return!1;var e=this.getManipulateObjs();if(1===e.length){var t=e[0],r=this.getEditor().getSelection();if(r&&r.indexOf(t)<0)return t.getConstraintManipulationBaseObj&&t.getConstraintManipulationBaseObj()}return!1},isInActualConstrainedRotation:function(){return this.isConstrainedRotate()&&!this._suppressConstrainedRotating},isDirectedMove:function(){return this.getEnableDirectedMove()&&!this.isConstrainedMove()&&this._isInDirectedMoving},useMergePreview:function(){return this._useMergePreview},setUseMergePreview:function(e){this._useMergePreview=e},getMergeOperationsInManipulating:function(){return this._useMergePreview?this.getMergePreviewOperations():this.getMergeOperations()},createManipulateObjInfo:function(e,t,r){var i=this.getEditor(),n=this.tryApplySuper("createManipulateObjInfo",[e,t,r]);if(this.isConstrainedMove()){var o=e.getConstraintManipulationBaseObj();if(o&&(n.isConstrained=!0,!n.hasNoCoord)){n.originScreenCoord=i.getObjectScreenCoord(e),n.refScreenCoord=i.getObjectScreenCoord(o),n.connectorScreenLength=Kekule.CoordUtils.getDistance(n.screenCoord,n.refScreenCoord),n.connectorObjLength=Kekule.CoordUtils.getDistance(i.getObjCoord(e),i.getObjCoord(o));var a=Kekule.CoordUtils.substract(n.originScreenCoord,n.refScreenCoord);n.originBondDirectionAngle=Math.atan2(a.y,a.x),n.constrainedBondDirectionDelta=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionDelta(),n.constrainedBondDirectionAngles=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngles(),n.constrainedBondDirectionAngleThreshold=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngleThreshold()}}return n},getAllowLengthChangeInConstrainedMoving:function(e){return e instanceof Kekule.Glyph.PathGlyphNode},_getTransformCompareThresholds:function(e){return e===Kekule.CoordMode.COORD3D?this.tryApplySuper("_getTransformCompareThresholds",[e]):{translate:this.getEditorConfigs().getStructureConfigs().getDefBondLength()||this.getEditor().getChemSpace().getAutoScaleRefLength()||.05,rotate:this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep()/5,scale:this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep()/5}},_calcActualMovedScreenCoord:function(e,t,r){var i,n=Kekule.CoordUtils,o=r;if(t.isConstrained&&!this._suppressConstrainedMoving){var a,s,l=t.constrainedBondDirectionDelta||null,u=t.constrainedBondDirectionAngles||null,d=t.constrainedBondDirectionAngleThreshold||null,c=!1,h=n.substract(r,t.refScreenCoord),p=Math.atan2(h.y,h.x),g=n.getDistance(h);if(u&&d)for(var f=0,C=u.length;f<C;++f){var m=u[f];Math.abs(m-p)<=d&&(c=!0,a=m)}if(!c&&l){var T=Math.round((p-t.originBondDirectionAngle)/l);a=t.originBondDirectionAngle+T*l,c=!0}if(c||(a=p),this.getAllowLengthChangeInConstrainedMoving(e)){var E=this.getEditor().getDefBondScreenLength(),_=g/E,S=this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep();s=E*(_=(Math.round(_/S)||1)*S)}else s=t.connectorScreenLength;i=n.add(t.refScreenCoord,{x:s*Math.cos(a),y:s*Math.sin(a)})}else i=o;return i},_calcActualRotateAngle:function(e,t,r,i){var n=this.isConstrainedRotate()&&!this._suppressConstrainedRotating?this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;return n?Math.round(t/n)*n:this.tryApplySuper("_calcActualRotateAngle",[e,t])},_calcActualResizeScales:function(e,t){if(this.isConstrainedResize()&&!this._suppressConstrainedResize){var r=this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep();return r?{scaleX:(Math.round(t.scaleX/r)||1)*r,scaleY:(Math.round(t.scaleY/r)||1)*r}:t}return t},prepareManipulating:function(e,t,r,i,n,o){this.setUseMergePreview(this.getEditorConfigs().getInteractionConfigs().getEnableMergePreview()),this.setMergeOperations([]),this.setMergePreviewOperations([]),this.setStickOperations([]),this.tryApplySuper("prepareManipulating",[e,t,r,i,n,o]),this._directedMovingDirection=null,this.setManuallyHotTrack(!0)},manipulateBeforeStopping:function(){if(this.tryApplySuper("manipulateBeforeStopping"),this.useMergePreview()){var e=this.getMergePreviewOperations();if(e&&e.length){for(var t=this.getMergeOperations(),r=0,i=e.length;r<i;++r){var n=e[r];if(n){var o=n instanceof Kekule.ChemStructOperation.MergeConnectorsBase?this.createConnectorMergeOperation(n.getTarget(),n.getDest()):this.createNodeMergeOperation(n.getTarget(),n.getDest());t.push(o)}}this.executeMergeOpers(t)}}},manipulateEnd:function(){this.tryApplySuper("manipulateEnd"),this.getEditor().hideHotTrack(),this.setManuallyHotTrack(!1)},createManipulateOperation:function(){this.tryApplySuper("createManipulateOperation"),this.setMergeOperations([]),this.setMergePreviewOperations([]),this.setStickOperations([])},getAllObjOperations:function(e){var t=this.getMergeOperations(),r=this.tryApplySuper("getAllObjOperations")||[];t&&t.length&&Kekule.ArrayUtils.pushUnique(r,t);var i=this.getStickOperations();if(i&&i.length)for(var n=0,o=i.length;n<o;++n){var a=i[n];a&&(a.getStickTarget&&!a.getStickTarget()?r.unshift(a):r.push(a))}return r},_objCanBeMagneticMerged:function(e){return!(e instanceof Kekule.StructureFragment)&&(e instanceof Kekule.ChemStructureNode||e instanceof Kekule.ChemStructureConnector)},_objCanBeMagneticSticked:function(e){return!(e instanceof Kekule.StructureFragment)&&(e instanceof Kekule.BaseStructureNode&&e.getAllowCoordStickTo())},_canStickNode:function(e,t){if(this.getEnableNodeStick()){var r=this.getEnableStructFragmentStick(),i=this.getEnableSiblingStick();return Kekule.ChemObjOperation.StickTo.canStick(e,t,r,i)}return!1},_canMergeNodes:function(e,t){if(this.getEnableNodeMerge()){var r=this.getEnableStructFragmentMerge(),i=this.getEnableNeighborNodeMerge();return Kekule.ChemStructOperation.MergeNodes.canMerge(e,t,r,i)}return!1},_canMergeConnectors:function(e,t){if(this.getEnableConnectorMerge()){var r=this.getEnableStructFragmentMerge();return Kekule.ChemStructOperation.MergeConnectors.canMerge(e,t,r)}return!1},_findSuitableMergeTargetBoundInfo:function(e,t,r,i){for(var n=e.length-1;n>=0;--n){var o=e[n],a=o.obj;if(!(t.indexOf(a)>=0)&&(a instanceof r&&(!i||i(a))))return o}return null},_getCoordStickActualTarget:function(e){for(var t=e,r=t.getCoordStickTarget&&t.getCoordStickTarget();r;)r=(t=r).getCoordStickTarget&&t.getCoordStickTarget();return t},_getMagneticNodeMergeOrStickDestInfo:function(e,t,r){var i=this.getEditor(),n=this;if(t){var o=i.getBoundInfosAtCoord(t,function(t){var i=t.obj,o=n._getCoordStickActualTarget(i);return e!==i&&r.indexOf(i)<0&&(i instanceof Kekule.BaseStructureNode&&n._canMergeNodes(e,i)||n._canStickNode(e,o))},this.getCurrBoundInflation()),a=o.length?o[o.length-1]:null;if(a){var s=a.obj,l=this._getCoordStickActualTarget(s);return this._canMergeNodes(e,s)?{obj:s,isMerge:!0}:this._canStickNode(e,l)?{obj:l,isStick:!0}:null}return null}return null},moveManipulatedObjs:function(e){var t;if(this.isDirectedMove()){var r=Kekule.CoordUtils,i=this.getStartCoord(),n=r.getDistance(i,e),o=r.substract(e,i),a=this._directedMovingDirection;this._directedMovingDirection||(a=Math.abs(o.x)>=Math.abs(o.y)?"x":"y",n<this.getEditor().getEditorConfigs().getInteractionConfigs().getDirectedMoveDistanceThreshold()||(this._directedMovingDirection=a)),(t=Object.extend({},i))[a]=e[a]}else t=e;return this.tryApplySuper("moveManipulatedObjs",[t])},applyManipulatingObjsInfo:function(e){var t={MERGE:0,MERGE_BOND:1,STICK:10,UNSTICK:20};this.setAllManipulateObjsMerged(!1);var r=this.useMergePreview(),i=this.getEditor();i.hotTrackOnObj(null);var n=Kekule.Editor.BasicManipulationIaController.ManipulationType,o=this.getManipulationType(),a=this.getManipulateOriginObjs(),s=this.getManipulateObjs(),l=[].concat(a);Kekule.ArrayUtils.pushUnique(l,s);var u=this.getMergeOperationsInManipulating(),d=this.getStickOperations(),c=this,h=1===a.length&&a[0]instanceof Kekule.ChemStructureConnector,p=1===s.length&&s[0]instanceof Kekule.BaseStructureNode&&(this._objCanBeMagneticMerged(s[0])||this._objCanBeMagneticSticked(s[0])),g=o===n.MOVE&&!this.getIsOffsetManipulating()&&(h&&this.getEnableConnectorMerge()||p&&this.getEnableNodeMerge()),f=!h&&this.getEnableMagneticMerge();if(f||g){var C=this.getManipulateObjCurrInfoMap(),m=this.getManipulateObjInfoMap(),T=[],E=[],_=[],S=[];if(g){var O=h?a[0]:s[0],y=this._calcMagneticMergeOrStickInfoOnScreenCoord(e,O,this._isManipulatingSingleStickedObj(s),C,m,l,t);if(y)T=[0],E=[y.magneticObj],_=[y.magneticDest],S=[y.magneticType];else if(h&&this.getEnableConnectorMerge()){var A=i.getBoundInfosAtCoord(e,null,this.getCurrBoundInflation()),I=Kekule.ChemStructureConnector,k=(O=a[0],this._findSuitableMergeTargetBoundInfo(A,l,I,function(e){return c._canMergeConnectors(O,e)}));k&&(T=[0],E=[O],_=[k.obj],S=[t.MERGE_BOND])}}if(!E.length&&f){var b=this._calcMagneticMergeOrStickInfos(s,C,m,l,t);T=b.magneticObjIndexes,E=b.magneticObjs,_=b.magneticDests,S=b.magneticTypes}if(E.length||d.length){var v=E.length;this.setAllManipulateObjsMerged(v===s.length);for(var R=1===v,D=!1,N=!1,P=[],M=[],K=0,L=E.length;K<L;++K){var x=E[K],B=_[K],U=T[K];if(S[K]===t.STICK){if(!N){if(!(F=d[U])||!this.isSameNodeStick(F,x,B)){N=!0;break}M.push(F)}}else if(!D)(w=u[U])&&this.isSameNodeMerge(w,x,B)?P.push(w):D=!0;if(D&&N)break}for(K=0,L=u.length;K<L;++K){var w;if(w=u[K]){if((U=P.indexOf(w))<0){D=!0;break}P.splice(U,1)}}for(K=0,L=d.length;K<L;++K){var F;if(F=d[K]){if((U=M.indexOf(F))<0){N=!0;break}M.splice(U,1)}}if(D||N||R){D&&this.reverseMergeOpers(this.getMergeOperationsInManipulating()),N&&this.reverseStickOpers(this.getStickOperations());var V=Kekule.CoordUtils;if(1===v||i.getCoordMode()===Kekule.CoordMode.COORD3D){if(S[0]!==t.MERGE_BOND){var j=(ie=C.get(E[0]))&&ie.screenCoord,W=i.getObjectScreenCoord(_[0]);if(j&&W){var G=V.substract(W,j),H=!1,z=Kekule.NumUtils.isFloatEqual;if(!z(G.x,0,1e-10)||!z(G.y,0,1e-10))for(K=0,L=s.length;K<L;++K){x=s[K];var Y=C.get(x);if(x!==E[0]){if(Y&&Y.screenCoord){var X=V.add(Y.screenCoord,G);Y.screenCoord=X,this._getMagneticNodeMergeOrStickDestInfo(x,X,l)&&(H=!0)}}else Y&&Y.screenCoord&&(Y.screenCoord=W)}if(H)return this.applyManipulatingObjsInfo(e);for(K=0,L=s.length;K<L;++K){x=s[K],Y=C.get(x);this.applySingleManipulatingObjInfo(K,x,Y,e)}}}}else if(v>1&&i.getCoordMode()!==Kekule.CoordMode.COORD3D){var $=E[0],J=E[1];if($&&J){var q=m.get($).screenCoord,Z=m.get(J).screenCoord,Q=i.getObjectScreenCoord(_[0]),ee=i.getObjectScreenCoord(_[1]),te=V.calcCoordGroup2DTransformParams(q,Z,Q,ee),re=V.calcTransform2DMatrix(te);for(H=!1,K=0,L=s.length;K<L;++K){x=s[K];if(E.indexOf(x)<0){Y=m.get(x);var ie=C.get(x);if(Y.screenCoord){X=V.transform2DByMatrix(Y.screenCoord,re);ie.screenCoord=X,this._getMagneticNodeMergeOrStickDestInfo(x,X,l)&&(H=!0)}Y.size&&(ie.size=V.multiply(Y.size,te.scale))}}if(H)return this.applyManipulatingObjsInfo(e);for(K=0,L=s.length;K<L;++K){x=s[K];if(E.indexOf(x)<0){ie=C.get(x);this.applySingleManipulatingObjInfo(K,x,ie,e)}}}}if(D||N){var ne=[];this._mergeOperationsChanged(v,E,_);for(K=0,L=v;K<L;++K){x=E[K],B=_[K],U=T[K];var oe=S[K];if(oe===t.STICK){if(B!==m.get(x).stickTarget)var ae=this.createNodeStickOperation(x,B);this.getStickOperations()[U]=ae,B||ne.push({index:U,obj:x,newInfo:C.get(x)})}else if(r){var se=oe===t.MERGE_BOND?this.createConnectorMergeOperation(x,B,!0):this.createNodeMergeOperation(x,B,!0);this.getMergePreviewOperations()[U]=se}else{var le=oe===t.MERGE_BOND?this.createConnectorMergeOperation(x,B):this.createNodeMergeOperation(x,B);this.getMergeOperations()[U]=le}}if(D&&this.executeMergeOpers(this.getMergeOperationsInManipulating()),N&&this.executeStickOpers(this.getStickOperations()),ne.length)for(K=0,L=ne.length;K<L;++K){var ue=ne[K];this.applySingleManipulatingObjInfo(ue.index,ue.obj,ue.newInfo,e)}}}return void i.hotTrackOnObj(_)}}(u=this.getMergeOperationsInManipulating())&&u.length&&(this._mergeOperationsChanged(0,[],[]),this.reverseMergeOpers(u)),this.tryApplySuper("applyManipulatingObjsInfo",[e])},_calcMagneticMergeOrStickInfoOnScreenCoord:function(e,t,r,i,n,o,a){var s=this.getEditor(),l=(this._objCanBeMagneticMerged,this._objCanBeMagneticSticked,t),u=e;if(u){s.getBoundInfosAtCoord(u,null,this.getCurrBoundInflation());var d=this._getMagneticNodeMergeOrStickDestInfo(l,u,o),c=null,h=null;if(d&&(d.isStick?h=d.obj:d.isMerge&&(c=d.obj)),c||h)return{magneticObj:l,magneticDest:c||h,magneticType:h?a.STICK:a.MERGE};if(!h&&r&&n.get(l).stickTarget)return{magneticObj:l,magneticDest:null,magneticType:a.STICK}}},_calcMagneticMergeOrStickInfos:function(e,t,r,i,n){for(var o=this._isManipulatingSingleStickedObj(e),a=this._objCanBeMagneticMerged,s=this._objCanBeMagneticSticked,l=(this.getEditor(),[]),u=[],d=[],c=[],h=0,p=e.length;h<p;++h){var g=e[h];if(a(g)||s(g)){var f=t.get(g),C=f&&f.screenCoord;if(C){var m=this._calcMagneticMergeOrStickInfoOnScreenCoord(C,g,o,t,r,i,n);m&&(l.push(h),u.push(m.magneticObj),d.push(m.magneticDest),c.push(m.magneticType))}}}return{magneticObjIndexes:l,magneticObjs:u,magneticDests:d,magneticTypes:c}},_mergeOperationsChanged:function(e,t,r){},doMoveManipulatedObj_old:function(e,t,r,i){var n=this.getEditor(),o=(this.getManipulateObjInfoMap().get(t),r),a=this.getManipulateOriginObjs(),s=this.getManipulationType(),l=s===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE&&1===a.length&&a[0]instanceof Kekule.ChemStructureConnector,u=o,d=null,c=this.getMergeOperations(),h=c[e],p=this.getManipulateObjs();if(!l&&this.getEnableMagneticMerge()&&t instanceof Kekule.ChemStructureNode){var g=n.getBoundInfosAtCoord(u);if(g&&g.length){for(var f=g.length-1;f>=0;--f){var C=g[f].obj;if(C!==t&&(!(p.indexOf(C)>=0)&&C instanceof Kekule.ChemStructureNode&&this._canMergeNodes(t,C))){if(n.addHotTrackedObj(C),this.isSameNodeMerge(h,t,C))return;d=this.createNodeMergeOperation(t,C);break}}d?(h&&this.reverseMergeOpers(e),this.getMergeOperations()[e]=d,this.executeMergeOpers()):n.hotTrackOnObj(null)}}u=i;if(s===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE){var m=a[0];if(a&&1===a.length){var T=n.getTopmostBoundInfoAtCoord(u,[m]);if(T){var E=T.obj;if(E&&p.indexOf(E)<0){if(l&&m instanceof Kekule.ChemStructureConnector&&E instanceof Kekule.ChemStructureConnector)this.getEnableConnectorMerge()&&(n.hotTrackOnObj(E),(!!this.getEnableStructFragmentMerge()||m.getParent()===E.getParent())&&(d=this.createConnectorMergeOperation(m,E)));else if(m instanceof Kekule.ChemStructureNode&&E instanceof Kekule.ChemStructureNode&&this._canMergeNodes(m,E)){if(n.hotTrackOnObj(E),this.isSameNodeMerge(h,m,E))return;d=this.createNodeMergeOperation(m,E)}if(d)return(h=c[e])&&this.reverseMergeOpers(e),this.getMergeOperations()[e]=d,void this.executeMergeOpers()}}}}d||(n.hideHotTrack(),!!this.getMergeOperations().length&&this.reverseMergeOpers(e),this.tryApplySuper("doMoveManipulatedObj_old",[e,t,r,i]))},createNodeMergeOperation:function(e,t,r){var i=this.getEnableStructFragmentMerge();return Kekule.ChemStructOperation.MergeNodes.canMerge(e,t,i,this.getEnableNeighborNodeMerge())?r?new Kekule.ChemStructOperation.MergeNodesPreview(e,t,i,this.getEditor()):new Kekule.ChemStructOperation.MergeNodes(e,t,i,this.getEditor()):null},createConnectorMergeOperation:function(e,t,r){var i=this.getEnableStructFragmentMerge();return Kekule.ChemStructOperation.MergeConnectors.canMerge(e,t,i)?new(r?Kekule.ChemStructOperation.MergeConnectorsPreview:Kekule.ChemStructOperation.MergeConnectors)(e,t,this.getEditor().getCoordMode(),i,this.getEditor()):null},createNodeStickOperation:function(e,t){this.getEnableStructFragmentStick();return this._canStickNode(e,t)?new Kekule.ChemObjOperation.StickTo(e,t,this.getEditor()):null},isSameConnectorMerge:function(e,t,r){return e&&e instanceof Kekule.ChemStructOperation.MergeConnectorsBase&&t===e.getTarget()&&r===e.getDest()},isSameNodeMerge:function(e,t,r){return e&&e instanceof Kekule.ChemStructOperation.MergeNodesBase&&t===e.getTarget()&&r===e.getDest()},isSameNodeStick:function(e,t,r){return e&&e instanceof Kekule.ChemObjOperation.StickTo&&t===e.getTarget()&&r===e.getStickTarget()},isSameNodeMergeOrStick:function(e,t,r){return this.isSameNodeMerge(e,t,r)||this.isSameNodeStick(e,t,r)},executeStickOpers:function(e){var t=this.getEditor(),r=Kekule.ArrayUtils.toUnique(e||this.getStickOperations());t.beginUpdateObject();try{for(var i=0,n=r.length;i<n;++i)r[i]&&r[i].execute()}finally{t.endUpdateObject()}},reverseStickOpers:function(e){var t=this.getEditor(),r=e||this.getStickOperations(),i=Kekule.ArrayUtils.toUnique(r);if(i&&i.length){t.beginUpdateObject();try{for(var n=i.length-1;n>=0;--n)i[n]&&i[n].reverse();r.length=0}finally{t.endUpdateObject()}}else;},executeMergeOpers:function(t){var r=this.getEditor(),i=Kekule.ArrayUtils.toUnique(t||this.getMergeOperationsInManipulating()),n=[];r.beginUpdateObject();try{for(var o=0,a=i.length;o<a;++o)if(i[o]){i[o].execute();var s=i[o].getDest?i[o].getDest():null;s&&e.pushUnique(n,s)}this.setMergingDests(n.length?n:null),this.refreshManipulateObjs(),this._mergeJustReversed=!1}finally{r.endUpdateObject()}},reverseMergeOpers:function(e){var t=this.getEditor();this.setMergingDests(null);var r=e||this.getMergeOperationsInManipulating(),i=Kekule.ArrayUtils.toUnique(r);if(i&&i.length){t.beginUpdateObject();try{for(var n=i.length-1;n>=0;--n)i[n]&&i[n].reverse();r.length=0,this._mergeJustReversed=!0,this.refreshManipulateObjs()}finally{t.endUpdateObject()}}else;},react_pointermove:function(e){return this._suppressConstrainedMoving=e.getAltKey(),this._suppressConstrainedRotating=e.getAltKey(),this._suppressConstrainedResize=e.getAltKey(),this._isInDirectedMoving=e.getShiftKey(),this.tryApplySuper("react_pointermove",[e])}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolManipulationIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.SelectIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.SelectIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Kekule.globalOptions.get;this.setEnableSelect(e("chemWidget.editor.enableSelect",!0)),this.setEnableGestureManipulation(e("chemWidget.editor.enableGesture",!0))}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.SelectIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.StructureInsertIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.StructureInsertIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._manipulatedBasicObjs=null},getInsertedObjs:function(){return this._manipulatedBasicObjs},doSetManipulateOriginObjs:function(e){return this._manipulatedBasicObjs=this._getManipulatedBasicObjects(e),this.tryApplySuper("doSetManipulateOriginObjs",[e])},_getManipulatedBasicObjects:function(t){for(var r=[],i=0,n=t.length;i<n;++i){var o=t[i];if(o instanceof Kekule.ChemStructureObject)if(o instanceof Kekule.StructureFragment&&o.isExpanded()){var a=[].concat(o.getNodes()).concat(o.getConnectors());e.pushUnique(r,a)}else e.pushUnique(r,o);else e.pushUniqueEx(r,o)}return r},stopManipulate:function(){if(this.needAutoSelectNewlyInsertedObjects()){var e=this.getInsertedObjs();this.doneInsertOrModifyBasicObjects(e)}return this.tryApplySuper("stopManipulate")}}),Kekule.Editor.MolBondIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.MolBondIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setState(i.State.INITIAL),this.setBondOrder(Kekule.BondOrder.SINGLE)},initProperties:function(){this.defineProp("allowBondingToBond",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("state",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableBondModification",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("autoSwitchBondOrder",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("startingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("endingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("structFragment",{dataType:"Kekule.ChemStructureFragment",serializable:!1}),this.defineProp("autoCreatedStructFragment",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("autoCreatedStartingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("bond",{dataType:"Kekule.Bond",serializable:!1}),this.defineProp("bondType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("bondOrder",{dataType:DataType.INT,serializable:!1}),this.defineProp("bondStereo",{dataType:DataType.INT,serializable:!1}),this.defineProp("initialBondDirection",{dataType:DataType.FLOAT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!1),this.setEnableMove(!0),this.setEnableNeighborNodeMerge(!1);var e=Kekule.globalOptions.get;this.setEnableBondModification(e("chemWidget.editor.bondManipulation.enableBondModification",!0)),this.setAllowBondingToBond(e("chemWidget.editor.bondManipulation.allowBondingToBond",!1)),this.setAutoSwitchBondOrder(e("chemWidget.editor.bondManipulation.autoSwitchBondOrder",!1))},_isBondDifferent:function(e){var t=this.getBondStereo(),r=Kekule.BondStereo;return t===r.UP||t===r.UP_INVERTED||t===r.DOWN||t===r.DOWN_INVERTED||(e.getBondType()!==this.getBondType()||e.getBondOrder()!==this.getBondOrder()||e.getStereo()!==this.getBondStereo())},_isBondOrderSwitchApplicable:function(e){return this.getAutoSwitchBondOrder()&&this.getBondOrder()===Kekule.BondOrder.SINGLE&&this.getBondType()===Kekule.BondType.COVALENT&&this.getBondStereo()===Kekule.BondStereo.NONE&&(!e.getBondType()||e.getBondType()===Kekule.BondType.COVALENT)&&(!e.getStereo()||e.getStereo()===Kekule.BondStereo.NONE)},canInteractWithObj:function(e){if(this.getState()!==i.State.INITIAL)return this.tryApplySuper("canInteractWithObj",[e]);if(e instanceof Kekule.ChemStructureNode)return!0;if(e instanceof Kekule.ChemStructureConnector){if(this.getAllowBondingToBond())return!0;if(!this.getEnableBondModification())return!1;if(e instanceof Kekule.Bond)return this._isBondDifferent(e)||this._isBondOrderSwitchApplicable(e)}},doTestMouseCursor:function(e,t){return""},getInsertedObjs:function(){var e=this.getBond();return e?[e]:this.tryApplySuper("getInsertedObjs")},isObjValidBondTerminator:function(e){return!!e&&(this.getAllowBondingToBond()?e instanceof Kekule.ChemStructureNode||e instanceof Kekule.ChemStructureConnector:e instanceof Kekule.ChemStructureNode)},isBond:function(e){return e instanceof Kekule.Bond},getNewBondDefAngle:function(e,t){return this.getEditorConfigs().getStructureConfigs().getNewBondDefAngle(e,t)},addDefBond:function(e,t,r){var i;(a=this.getEditor()).beginUpdateObject();try{if(t)this.setAutoCreatedStartingObj(null),this.setAutoCreatedStructFragment(null);else{if(!this.getEditor().canAddUnconnectedStructFragment())return null;var n=this.getEditor().screenCoordToObj(e),o=this.getEditor().getOnlyOneBlankStructFragment();o?(t=this.getEditor().createStructStartingAtom(o,null,n),this.setAutoCreatedStructFragment(null),this.setAutoCreatedStartingObj(t)):(t=this.getEditor().createNewStructFragmentAndStartingAtom(null,n),this.setAutoCreatedStartingObj(null),this.setAutoCreatedStructFragment(t?t.getParent():null))}if(this.isObjValidBondTerminator(t)){var a=this.getEditor();this.setStartingObj(t);var s=t.getParent();this.setStructFragment(s);var l=this.getEditorConfigs().getStructureConfigs(),u=Kekule.oneOf(this.getBondType(),l.getDefBondType()),d=Kekule.oneOf(this.getBondOrder(),l.getDefBondOrder()),c=Kekule.oneOf(this.getBondStereo(),Kekule.BondStereo.NONE),h=a.getDefBondLength?a.getDefBondLength():l.getDefBondLength(),p=this.getNewBondDefAngle(t,d),g=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingLocation(t,h,p,this.getEditor().getAllowCoordBorrow()),f=this.getEditor().createDefaultNode(g,Kekule.Editor.CoordSys.OBJ,s);this.setEndingObj(f);var C=new Kekule.Bond;C.setBondType(u),C.setBondOrder(d),C.setStereo(c),s.appendConnector(C),C.appendConnectedObj(t),C.appendConnectedObj(f),this.setBond(C),r&&this.getEditor().objectsChanged([{obj:C},{obj:f}]),i=g}else i=null}finally{a.endUpdateObject()}return i},addOperationToEditor:function(){return this.tryApplySuper("addOperationToEditor")},getAllObjOperations:function(e){var t=this.tryApplySuper("getAllObjOperations",[e])||[],r=this.getAddBondOperation();return r&&t.unshift(r),t},getAddBondOperation:function(){var e=new Kekule.MacroOperation,t=this.getEditor(),r=this.getAutoCreatedStructFragment();if(r){var i=new Kekule.ChemObjOperation.Add(r,this.getEditor().getChemObj(),null,this.getEditor());e.add(i)}var n=this.getStartingObj(),o=this.getEndingObj(),a=this.getBond(),s=this.getStructFragment(),l=(t=this.getEditor(),this.getAutoCreatedStartingObj());if(l){var u=new Kekule.ChemStructOperation.AddNode(l,s,null,t);e.add(u)}u=new Kekule.ChemStructOperation.AddNode(o,s,null,t);e.add(u);var d=new Kekule.ChemStructOperation.AddConnector(a,s,null,[n,o],t);return e.add(d),e},modifyBond:function(e){var t,r=this.getBondType(),i=Kekule.BondOrder,n=[i.SINGLE,i.DOUBLE,i.TRIPLE];if(this._isBondOrderSwitchApplicable(e)){var o=e.getBondOrder(),a=n.indexOf(o);t=n[a=a>=0?++a%n.length:0]}else t=this.getBondOrder();var s=e.getStereo(),l=this.getBondStereo();s===l&&(l=Kekule.BondStereo.getInvertedDirection(l));var u={bondType:r,bondOrder:t,stereo:l},d=!1;for(var c in u){if(e.getPropValue(c)!==u[c]){d=!0;break}}if(d){var h=this.getEditor();h.beginManipulateObject(),h.beginUpdateObject();try{var p=new Kekule.ChemObjOperation.Modify(e,u,this.getEditor());p.execute(),h.pushOperation(p);for(var g=[e].concat(e.getConnectedObjs()),f=[],C=0,m=g.length;C<m;++C)f.push({obj:g[C]});this.getEditor().objectsChanged(f)}finally{h.endUpdateObject(),h.endManipulateObject()}}},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var t=i.State,r=this._getEventMouseCoord(e);if(this.getState()===t.INITIAL){var n=this.getEditor().getTopmostBoundInfoAtCoord(r,null,this.getCurrBoundInflation());if(n){var o=n.obj;if(this.isObjValidBondTerminator(o))return this.addDefBond(r,o,!0)&&(this.startDirectManipulate(null,this.getEndingObj(),r),this.moveManipulatedObjs(r)),!0;if(this.isBond(o)&&this.getEnableBondModification())return this.modifyBond(o),!0;e.preventDefault()}else if(this.getEditor().canAddUnconnectedStructFragment()){return this.addDefBond(r,null,!0)&&(this.startDirectManipulate(null,this.getEndingObj(),r),this.moveManipulatedObjs(r)),e.preventDefault(),!0}}}},react_pointerup:function(e){var t=this.getState(),r=this.getStartCoord(),i=this._getEventMouseCoord(e),n=Kekule.Editor.BasicManipulationIaController.State;return t===n.MANIPULATING&&e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT&&(e.preventDefault(),Kekule.CoordUtils.isEqual(r,i))?(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(n.NORMAL),!0):this.tryApplySuper("react_pointerup",[e])}}),Kekule.Editor.MolBondIaController.State={INITIAL:0,START_NODE_SET:21,ADJUSTING:22};var i=Kekule.Editor.MolBondIaController;Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolBondIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolAtomIaController_OLD=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController_OLD",initialize:function(e){this.tryApplySuper("initialize",[e]),this._createNonAtomLabelInfos(),this._setterShown=!1},finalize:function(){this.getAtomSetter()&&this.getAtomSetter().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("periodicTable",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:!1})},canInteractWithObj:function(e){return!!this.isValidNode(e)},isValidNode:function(e){return e instanceof Kekule.ChemStructureNode},getNodeLabel:function(e){var t=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();if(e.getIsotopeId)return e.getIsotopeId();if(e instanceof Kekule.SubGroup)return e.getAbbr()||e.getFormulaText()||t.getRgroup();if(e instanceof Kekule.VariableAtom){var r=e.getAllowedIsotopeIds(),i=e.getDisallowedIsotopeIds();return r&&r.length?this._getVarAtomListLabel():i&&i.length?this._getVarAtomNotListLabel():this._getVarAtomListLabel()}var n=e.getCoreDisplayRichTextItem(null,null,t);return Kekule.Render.RichTextUtils.toText(n)},_getVarAtomListLabel:function(){return this.getEditor().getRenderConfigs().getDisplayLabelConfigs().getVariableAtom()},_getVarAtomNotListLabel:function(){return"~"+this.getEditor().getRenderConfigs().getDisplayLabelConfigs().getVariableAtom()},_createNonAtomLabelInfos:function(){var e=[],t=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return e.push({nodeLabel:t.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")}),e.push({nodeLabel:t.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")}),e.push({nodeLabel:t.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")}),e.push({nodeLabel:t.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")}),e.push({nodeLabel:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")}),e.push({nodeLabel:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")}),this.setNonAtomLabelInfos(e),e},_indexOfNonAtomLabel:function(e){for(var t=this.getNonAtomLabelInfos(),r=0,i=t.length;r<i;++r){if(t[r].nodeLabel===e)return r}return-1},_getNonAtomInfo:function(e){var t=this._indexOfNonAtomLabel(e);return t<0?null:this.getNonAtomLabelInfos()[t]},getAtomSetterWidget:function(e){var t=this.getAtomSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createAtomSetterWidget(i,r),this.setAtomSetter(t)}return t},_createAtomSetterWidget:function(e,t){for(var r=new Kekule.Widget.ComboBox(e),i=this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms(),n=[],o=0,a=i.length;o<a;++o)n.push({value:i[o],data:{props:{isotopeId:i[o]}}});n.push({value:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")});var s=this.getNonAtomLabelInfos();for(o=0,a=s.length;o<a;++o){var l=s[o],u={value:l.nodeLabel,data:{props:l.props}};l.description&&(u.text=l.nodeLabel+" - "+l.description),n.push(u)}r.setItems(n),r.appendToElem(t);var d=this;return r.addEventListener("keyup",function(e){e.htmlEvent.getKeyCode()===Kekule.X.Event.KeyCode.ENTER&&(d.applySetter(r),r.dismiss())}),r.addEventListener("valueSelect",function(e){d.applySetter(r),r.dismiss()}),r.addEventListener("showStateChange",function(e){e.isShown||e.isDismissed||d.getAtomSetter()&&d.getAtomSetter().isShown()&&d.applySetter(r)}),r},getPeriodicTableDialogWidget:function(e){var t=this.getPeriodicTableDialog();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createPeriodicTableDialogWidget(i,r),this.setPeriodicTableDialog(t)}return t},_createPeriodicTableDialogWidget:function(e,t){var r=new Kekule.Widget.Dialog(e,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]),i=new Kekule.ChemWidget.PeriodicTable(e);return i.setUseMiniMode(!0),i.setEnableSelect(!0),i.appendToElem(r.getClientElem()),this.setPeriodicTable(i),r},openSetterUi:function(e,t){this.getAtomSetter();if(this.isValidNode(t)){this.setCurrAtom(t);var r=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0,i=r/1.5,n=this.getNodeLabel(t),o=this.getAtomSetterWidget(!0);o.setValue(n),o.setIsDirty(!1);var a=o.getElement().style;a.position="absolute",a.fontSize=r,a.left=e.x-i+"px",a.top=e.y-i+"px",o._applied=!1,o.setStandaloneOnShowHide(!0),o.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),function(){o.focus(),o.selectAll()}.defer()}},applySetter:function(e,t){if(!e._applied&&e.getIsDirty()){var r;t||(t=this.getCurrAtom());var i=null,n=e.getValue();if(n===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){(a=this.getPeriodicTableDialogWidget(!0)).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var o=t.getSymbol?t.getSymbol():null;this.getPeriodicTable().setEnableSelect(!0).setEnableMultiSelect(!1).setSelectedSymbol(o)}else if(n===this._getVarAtomListLabel()||n===this._getVarAtomNotListLabel()){var a,s=n===this._getVarAtomNotListLabel();(a=this.getPeriodicTableDialogWidget(!0)).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var l=t.getAllowedIsotopeIds?t.getAllowedIsotopeIds():null,u=t.getDisallowedIsotopeIds?t.getDisallowedIsotopeIds():null;this.getPeriodicTable().setEnableSelect(!0).setEnableMultiSelect(!0).setSelectedSymbols(s?u:l)}if(a){var d=this;a.openModal(function(e){if(e===Kekule.Widget.DialogButtons.OK){var r,i;if(n===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){var o=d.getPeriodicTable().getSelectedSymbol();r=Kekule.Atom,i={isotopeId:o}}if(n===d._getVarAtomListLabel()){var a=d.getPeriodicTable().getSelectedSymbols();r=Kekule.VariableAtom,i={allowedIsotopeIds:a,disallowedIsotopeIds:null}}if(n===d._getVarAtomNotListLabel()){a=d.getPeriodicTable().getSelectedSymbols();r=Kekule.VariableAtom,i={allowedIsotopeIds:null,disallowedIsotopeIds:a}}d.applyModification(t,null,r,i)}},this)}else{var c=null,h=this._getNonAtomInfo(n);if(h)r=h.nodeClass,i=h.props;else{var p=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(n);if(p){var g=p.createObjects(t)||{},f=g.objects,C=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),p,g,t,null);this.getEditor().transformCoordAndSizeOfObjects(f,C),r=(c=f[0]).getClass()}else(r=Kekule.ChemStructureNodeFactory.getClassByLabel(n,null))||this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()&&(r=Kekule.Pseudoatom),i=r===Kekule.Atom?{isotopeId:n}:r===Kekule.Pseudoatom?{symbol:n}:{}}r?(this.applyModification(t,c,r,i),e._applied=!0):Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL"))}}},applyModification:function(e,t,r,i){var n,o,a=e.getClass();if(t&&!r&&(r=t.getClass()),t||r!==a){n=new Kekule.MacroOperation,t||(t=new r);var s=new Kekule.ChemStructureNode;s.assign(e),t.assign(s);var l=new Kekule.ChemStructOperation.ReplaceNode(e,t,null,this.getEditor());n.add(l)}else t=e;i&&(o=new Kekule.ChemObjOperation.Modify(t,i,this.getEditor()),n&&n.add(o));var u=n||o;if(u){var d=this.getEditor();d.beginManipulateAndUpdateObject();try{u.execute()}catch(e){throw e}finally{d.endManipulateAndUpdateObject()}d&&d.getEnableOperHistory()&&u&&d.pushOperation(u)}},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var t=this._getEventMouseCoord(e),r=this.getEditor().getTopmostBoundInfoAtCoord(t,null,this.getCurrBoundInflation());if(r){var i=r.obj;if(this.isValidNode(i)){var n=this.getEditor().getObjectScreenCoord(i);e.preventDefault(),e.stopPropagation(),this.openSetterUi(n,i),this.getEditor().setSelection([i])}return!0}}}}),Kekule.Editor.MolAtomIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._createNonAtomLabelInfos(),this._setterShown=!1},finalize:function(){this.getAtomSetter()&&this.getAtomSetter().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){var t=this.getAtomSetter();t&&this.unbindAtomSetter(t),this.setPropStoreFieldValue("atomSetter",e),e&&this.bindAtomSetter(e)}})},canInteractWithObj:function(e){return!!this.isValidNode(e)},isValidNode:function(e){return e instanceof Kekule.ChemStructureNode&&!(e instanceof Kekule.StructureFragment&&e.isStandalone())},_createNonAtomLabelInfos:function(){var e=this.getEditor(),t=e&&e.getEnabledNonAtomInputData&&e.getEnabledNonAtomInputData();return this.setNonAtomLabelInfos(t),t},_indexOfNonAtomLabel:function(e){for(var t=this.getNonAtomLabelInfos(),r=0,i=t.length;r<i;++r){if(t[r].nodeLabel===e)return r}return-1},_getNonAtomInfo:function(e){var t=this._indexOfNonAtomLabel(e);return t<0?null:this.getNonAtomLabelInfos()[t]},getAtomSetterWidget:function(e){var t=this.getAtomSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createAtomSetterWidget(i,r),this.setAtomSetter(t)}return t},bindAtomSetter:function(e){this._initAtomSetterWidgetSettings(e),this._setAtomSetterEventListener(e,!0)},unbindAtomSetter:function(e){this._setAtomSetterEventListener(e,!1)},_createAtomSetterWidget:function(e,t){var r=new Kekule.ChemWidget.StructureNodeSetter(this.getEditor());return r.setUseDropDownSelectPanel(!0),r.appendToElem(t),r},_initAtomSetterWidgetSettings:function(t){if(t.addClassName(r.CHEMEDITOR_ATOM_SETTER),t.setSelectableInfos){var i=e.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());i.push("...");var n=this.getNonAtomLabelInfos();t.setSelectableInfos({elementSymbols:i,nonElementInfos:n,subGroupRepItems:Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()})}},_setAtomSetterEventListener:function(e,t){t?e.addEventListener("valueChange",this._reactAtomSetterValueChange,this):e.removeEventListener("valueChange",this._reactAtomSetterValueChange,this)},_reactAtomSetterValueChange:function(e){var t=this.getAtomSetter();t&&t.isShown()&&(e.value&&this.applySetter(t),t.dismiss())},_reactAtomSetterShowStateChange:function(e){var t=this.getAtomSetter();e.target!==t||e.byDomChange||e.isShown||e.isDismissed||t&&t.isShown()&&this.applySetter(t)},getPeriodicTableDialogWidget:function(e){var t=this.getPeriodicTableDialog();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createPeriodicTableDialogWidget(i,r),this.setPeriodicTableDialog(t)}return t},_createPeriodicTableDialogWidget:function(e,t){var r=new Kekule.Widget.Dialog(e,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]),i=new Kekule.ChemWidget.PeriodicTable(e);return i.setUseMiniMode(!0),i.setEnableSelect(!0),i.appendToElem(r.getClientElem()),this.setPeriodicTable(i),r},openSetterUi:function(e,t){var r=this.getAtomSetter();if(r&&r.isShown()&&(r.hide(),r._haltPrevShowHideProcess()),this.isValidNode(t)){this.setCurrAtom(t);var i=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0,n=(i*=this.getEditor().getZoom()||1)/1.5,o=this.getAtomSetterWidget(!0);o.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),o.setNodes([t]);var a=this.getEditor().getCoreElement();o.appendToElem(a);var s=o.getNodeInputBox(),l=o.getElement().style;l.position="absolute",l.left=e.x-n+"px",l.top=e.y-n+"px",l.opacity=1,o.setNodeInputBoxFontSize&&o.setNodeInputBoxFontSize(i+"px"),o._applied=!1,o.setStandaloneOnShowHide(!0),o.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),function(){s.focus(),s.selectAll()}.defer()}},applySetter:function(e,t){if(!e._applied){t||(t=this.getCurrAtom());var r=e.getValue();if(r){var i=Kekule.Editor.OperationUtils.createNodeModificationOperationFromData(t,r,this.getEditor());if(i){var n=this.getEditor();n.beginManipulateAndUpdateObject();try{i.execute()}catch(e){throw e}finally{n.endManipulateAndUpdateObject()}n&&n.getEnableOperHistory()&&i&&n.pushOperation(i)}}}},applyModification:function(e,t,r,i){var n=Kekule.Editor.OperationUtils.createNodeModificationOperation(e,t,r,i,this.getEditor());if(n){var o=this.getEditor();o.beginManipulateAndUpdateObject();try{n.execute()}catch(e){throw e}finally{o.endManipulateAndUpdateObject()}o&&o.getEnableOperHistory()&&n&&o.pushOperation(n)}},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var t=this._getEventMouseCoord(e),r=this.getTopmostInteractableObjAtScreenCoord(t),i=this.getEditor().getObjectScreenCoord(r);return e.preventDefault(),e.stopPropagation(),this.openSetterUi(i,r),this.doneInsertOrModifyBasicObjects([r]),!0}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolAtomIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.RepositoryIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.RepositoryIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._repObjStartingScreenCoord=null},initProperties:function(){this.defineProp("repositoryItem",{dataType:"Kekule.AbstractRepositoryItem",serializable:!1}),this.defineProp("addRepObjsOper",{dataType:"Kekule.MacroOperation",serializable:!1}),this.defineProp("initialTransformParams",{dataType:DataType.HASH,serializable:!1}),this.defineProp("currRepositoryObjects",{dataType:"Kekule.ChemObject",serializable:!1})},doTestMouseCursor:function(e,t){return""},canInteractWithObj:function(e){return this.tryApplySuper("canInteractWithObj",[e])},isValidStartingObj:function(e){return!0},calcInitialTransformParams:function(e,t,r,i){return Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),e,t,r,i)},getRepObjCreationOptions:function(){return null},createObjFromRepositoryItem:function(e,t){return t.createObjects(e,this.getRepObjCreationOptions())||{}},addRepositoryObj:function(e,t,r){var i=this.getEditor();this.setAddRepObjsOper(null);var n=null;i.beginUpdateObject();try{var o=i.getChemSpace(),a=this.getRepositoryItem(),s=(n=this.createObjFromRepositoryItem(e,a)).objects;this.setCurrRepositoryObjects(s);var l=a.isOneStructureFragmentObj(),u=!1,d=this.getEditor().getOnlyOneBlankStructFragment();if(!i.canCreateNewChild()&&!n.mergeObj&&!r){if(!l||!i.canAddUnconnectedStructFragment())return null;u=!0}for(var c=new Kekule.MacroOperation,h=0,p=s.length;h<p;++h){var g,f=s[h];g=u?new Kekule.ChemStructOperation.MergeStructFragment(f,d,i):new Kekule.ChemObjOperation.Add(f,o,null,i),c.add(g)}c.execute(),this.setAddRepObjsOper(c);var C=u?[d]:s,m=this.calcInitialTransformParams(a,n,e,t);this._transformObjectsCoordAndSize(C,m),this.setInitialTransformParams(m),n.objects=C;var T=a.getMolManipulationCenterCoord&&a.getMolManipulationCenterCoord();T&&(n.manipulationCenterCoord=Kekule.CoordUtils.transform2D(T,m));var E=a.getMolManipulationDefDirectionCoord&&a.getMolManipulationDefDirectionCoord();E&&(n.manipulationDefDirectionCoord=Kekule.CoordUtils.transform2D(E,m))}finally{i.endUpdateObject()}return n},doRefreshRepositoryObj:function(e,t,r,i,n){this.doPrepareManipulatingObjects(e,t),this.doPrepareManipulatingStartingCoords(t,r,i,n),this.doCreateManipulateMoveAndResizeOperation()},_transformObjectsCoordAndSize:function(e,t){return this.getEditor().transformCoordAndSizeOfObjects(e,t)},getAllObjOperations:function(e){var t=this.tryApplySuper("getAllObjOperations",[e])||[],r=this.getAddRepObjsOper();return r&&t.unshift(r),t},addOperationToEditor:function(){return this.tryApplySuper("addOperationToEditor")},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE},doInsertRepositoryObjToEditor:function(e,t,r,i){i||(this._initialStartingObj=r,this._repObjStartingScreenCoord=t);var n=e;if(n){var o=n.objects,a=null,s=null,l=this.getInitManipulationType();return n.mergeObj?(a=this.getEditor().getObjectScreenCoord(n.mergeObj),l=Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE):n.manipulationCenterCoord&&(a=this.getEditor().objCoordToScreen(n.manipulationCenterCoord)),n.manipulationDefDirectionCoord&&(s=this.getEditor().objCoordToScreen(n.manipulationDefDirectionCoord)),{objects:o,manipulateType:l,coord:t,box:this.getEditor().getObjectsContainerBox(o),rotateCenter:a,rotateRefCoord:s,startingObj:r}}return null},insertRepositoryObjToEditor:function(e,t,r){var i=this.addRepositoryObj(t,e);return this.doInsertRepositoryObjToEditor(i,e,t,r)},updateRepositoryObjInEditor:function(){var t=this.getEditor();t.beginUpdateObject();try{this.useMergePreview()||this.reverseActiveOperation();for(var r=this.getCurrRepositoryObjects(),i=this.addRepositoryObj(this._initialStartingObj,this._repObjStartingScreenCoord,!0),n=e.exclude(r,(i||{}).objects),o=0,a=n.length;o<a;++o){var s=n[o],l=s.getParent();l&&l.removeChild(s)}this.useMergePreview()&&!n.length||(this.setMergeOperations([]),this.setMergePreviewOperations([]));var u=this.doInsertRepositoryObjToEditor(i,this._repObjStartingScreenCoord,this._initialStartingObj,!0);u&&(this.doRefreshRepositoryObj(u.objects,u.coord,u.box,u.rotateCenter,u.rotateRefCoord),this.moveManipulatedObjs(this._repObjStartingScreenCoord))}finally{t.endUpdateObject()}return u},getDirectManipulateObjs:function(e,t){return e},react_pointerdown:function(t){if(this.setActivePointerType(t.pointerType),t.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var r=i.State,n=this._getEventMouseCoord(t);if(this.getState()===r.INITIAL){var o=this.getEditor().getTopmostBoundInfoAtCoord(n,null,this.getCurrBoundInflation()),a=o?o.obj:null,s=this.insertRepositoryObjToEditor(n,a);if(s){var l=s.objects||[],u=this.getDirectManipulateObjs(s.objects,s)||[];e.exclude(l,u).length||e.exclude(u,l).length?(this.startDirectManipulate(s.manipulateType,l,s.coord,s.box,s.rotateCenter),this.moveManipulatedObjs(n),this.notifyEditorEndManipulateObjects(),this.startDirectManipulate(s.manipulateType,u,s.coord,s.box,s.rotateCenter),this.moveManipulatedObjs(n)):(this.startDirectManipulate(s.manipulateType,l,s.coord,s.box,s.rotateCenter),this.moveManipulatedObjs(n))}return t.preventDefault(),!0}}},react_pointerup:function(e){var t=this.getState(),r=this.getStartCoord(),i=this._getEventMouseCoord(e),n=Kekule.Editor.BasicManipulationIaController.State;return t===n.MANIPULATING&&e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT&&Kekule.CoordUtils.isEqual(r,i)?(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(n.NORMAL),e.preventDefault(),!0):this.tryApplySuper("react_pointerup",[e])}}),Kekule.Editor.RepositoryStructureFragmentIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.RepositoryStructureFragmentIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("repItemName",{dataType:DataType.STRING,setter:function(e){if(e!==this.getRepItemName()){var t=Kekule.Editor.RepositoryItemManager.getItem(e);t&&(this.setRepositoryItem(t),this.setPropStoreFieldValue("repItemName",e))}}})}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.RepositoryStructureFragmentIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolFlexStructureIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.MolFlexStructureIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1)},initProperties:function(){this.defineProp("assocMarker",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("assocMarker");return e||(e=new Kekule.ChemWidget.TextUiMarker,this.setPropStoreFieldValue("assocMarker",e)),e}})},manipulateEnd:function(){this.tryApplySuper("manipulateEnd"),this.hideAssocMarker()},initAssocMarker:function(){var e=this.getAssocMarker(),t=this.getEditorConfigs().getUiMarkerConfigs(),r={color:t.getFlexStructureAssocMarkerColor(),opacity:t.getFlexStructureAssocMarkerOpacity(),fontSize:t.getFlexStructureAssocMarkerFontSize(),fontFamily:t.getFlexStructureAssocMarkerFontFamily(),textBoxXAlignment:Kekule.Render.BoxXAlignment.CENTER,textBoxYAlignment:Kekule.Render.BoxYAlignment.CENTER};return e.setDrawStyles(r),e.setVisible(!0),this.getEditor().getUiMarkers().addMarker(e),e},hideAssocMarker:function(){var e=this.getPropStoreFieldValue("assocMarker");e&&(e.setVisible(!1),this.getEditor().getUiMarkers().removeMarker(e),this.repaintMarker())},updateAssocMarker:function(e,t,r){var i=this.getAssocMarker();e&&i.setCoord(e),t&&i.setPropValues(t),r||this.repaintMarker()},repaintMarker:function(){this.getEditor().repaintUiMarker()}}),Kekule.Editor.MolFlexChainIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexChainIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._deltaDistance=null,this._deltaCount=0,this._lastDeltaCount=1,this._repObjStartingScreenCoord=null,this._repObjNeedUpdate=!1,this._isForceReversedChainDirection=!1,this._assocMarkerInitCoord=null,this._manipulateObjInfoCache=[],this._chain=null;var t=new Kekule.Editor.MolChainRepositoryItem2D(2);t.setEnableCoordCache(!0),this.setRepositoryItem(t)},updateAssocMarker:function(e,r,i){var n=this.getEditor(),o=this.getAssocMarker().getDrawStyles(),a=this._chain,s=e;if(!s&&a){var l,u=a.getNodeAt(0),d=a.getNodeAt(a.getNodeCount()-1),c=n.getObjectContextCoord(u);if((s=n.getObjectContextCoord(d))&&c&&(l=t.substract(s,c)),l){var h=(o.fontSize||10)/2,p={x:0,y:0};if(s){var g=t.getDistance(l);p={x:h*(l.x/g),y:h*(l.y/g)};s=Kekule.CoordUtils.add(s,p)}}}this.tryApplySuper("updateAssocMarker",[s,r,i])},getChainMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexChainAtomCount(),0)},manipulateEnd:function(){this._clearManipulateObjInfoCache(),this.tryApplySuper("manipulateEnd")},createManipulateObjInfo:function(e,t,r){var i=this.getRepositoryItem().getNegativeDirection(),n=this._getCachedManipulateObjInfo(t,i);if(n)return n;var o=this.tryApplySuper("createManipulateObjInfo",[e,t,r]);return this._setCachedManipulateObjInfo(o,t,i),o},canInteractWithObj:function(e){return this.tryApplySuper("canInteractWithObj",[e])&&e instanceof Kekule.ChemStructureNode},getActualManipulatingObjects:function(t){var r=this.getCurrRepositoryObjects()[0];return r?e.clone(r.getNodes()):[]},_setCachedManipulateObjInfo:function(e,t,r){var i=r?1:0,n=this._manipulateObjInfoCache[i];n||(n=[],this._manipulateObjInfoCache[i]=n),n[t]=e},_getCachedManipulateObjInfo:function(e,t){var r=t?1:0,i=this._manipulateObjInfoCache[r];return i&&i[e]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var e=this.getRepositoryItem().getBondLength(),t=this.getInitialTransformParams(),r=this.getEditor(),i=r.objCoordToScreen(Kekule.CoordUtils.transform2D({x:0,y:0},t)),n=r.objCoordToScreen(Kekule.CoordUtils.transform2D({x:e*Math.cos(Math.PI/6),y:0},t));return Kekule.CoordUtils.getDistance(i,n)},getRepObjCreationOptions:function(){return this._isUpdateRepObj?{originalStructFragment:this.getCurrRepositoryObjects()[0]}:null},addRepositoryObj:function(e,t,r){var i=this.tryApplySuper("addRepositoryObj",[e,t,r]);return this._deltaDistance=this._calcStepDeltaDistance(),this._repObjNeedUpdate=!1,i},insertRepositoryObjToEditor:function(e,t,r){if(!r){this._deltaDistance=null,this._deltaCount=0,this._lastDeltaCount=1;var i=2;this.getRepositoryItem().setAtomCount(i)}this._isUpdateRepObj=r;var n=this.tryApplySuper("insertRepositoryObjToEditor",[e,t,r]);if(this._chain=n&&n.objects[0],n&&!r){this.initAssocMarker();this.updateAssocMarker(null,{text:""+i})}return n},_updateChain:function(){this._isUpdateRepObj=!0;var e=this.updateRepositoryObjInEditor();return this._chain=e.objects[0],this._repObjNeedUpdate=!1,e},doTransformManipulatedObjs:function(e,t,r){var i=t;if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){var n=this.getBaseCoord();if(n){var o=Kekule.CoordUtils.getDistance(i,n),a=Math.max(Math.round(o/this._deltaDistance),1);if(!this._lastDeltaCount||a!==this._lastDeltaCount){this._deltaCount=a;var s=this.getChainMaxAtomCount(),l=s?Math.min(s,a+1):a+1;this.getRepositoryItem().getAtomCount()!==l&&(this.getRepositoryItem().setAtomCount(l),this._repObjNeedUpdate=!0,this.updateAssocMarker(null,{text:""+l},!0)),this._lastDeltaCount=a}var u,d=this._calcRotateAngle(i),c=d&&d.angle,h=this.isInActualConstrainedRotation();if(h){var p=h?2*this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;u=Math.round(c/p)*p-c<0}else u=!1;this._isForceReversedChainDirection&&(u=!u),!!this.getRepositoryItem().getNegativeDirection()!==u&&(this.getRepositoryItem().setNegativeDirection(u),this._repObjNeedUpdate=!0)}}this._repObjNeedUpdate&&this._updateChain();var g=this.getCurrRepositoryObjects()[0];g.beginUpdate();try{var f=this.tryApplySuper("doTransformManipulatedObjs",[e,t,r]);this.updateAssocMarker(null,null,!1)}finally{g.endUpdate()}return f},react_pointermove:function(e){return this._isForceReversedChainDirection=!!e.getShiftKey(),this.tryApplySuper("react_pointermove",[e])}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolFlexChainIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolFlexRingIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexRingIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._deltaDistance=null,this._lastDeltaCount=1,this._repObjStartingScreenCoord=null,this._repObjNeedUpdate=!1,this._manipulateObjInfoCache=[];var t=new Kekule.Editor.MolRingRepositoryItem2D(3);t.setEnableCoordCache(!0),this.setRepositoryItem(t)},getRingMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexRingAtomCount(),0)},getRingMinAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount(),3)},getActualManipulatingObjects:function(t){var r=this.getCurrRepositoryObjects()[0];return r?e.clone(r.getNodes()):[]},manipulateEnd:function(){this._clearManipulateObjInfoCache(),this.tryApplySuper("manipulateEnd")},createManipulateObjInfo:function(e,t,r){var i=this.getRepositoryItem().getRingAtomCount(),n=this._getCachedManipulateObjInfo(t,i);if(n)return n;var o=this.tryApplySuper("createManipulateObjInfo",[e,t,r]);return this._setCachedManipulateObjInfo(o,t,i),o},_setCachedManipulateObjInfo:function(e,t,r){var i=this._manipulateObjInfoCache[r];i||(i=[],this._manipulateObjInfoCache[r]=i),i[t]=e},_getCachedManipulateObjInfo:function(e,t){var r=this._manipulateObjInfoCache[t];return r&&r[e]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var e=this.getRepositoryItem().getBondLength(),t=this.getInitialTransformParams(),r=this.getEditor(),i=r.objCoordToScreen(Kekule.CoordUtils.transform2D({x:0,y:0},t)),n=r.objCoordToScreen(Kekule.CoordUtils.transform2D({x:e,y:0},t));return Kekule.CoordUtils.getDistance(i,n)/3},getRepObjCreationOptions:function(){return this._isUpdateRepObj?{originalStructFragment:this.getCurrRepositoryObjects()[0]}:null},addRepositoryObj:function(e,t,r){var i=this.tryApplySuper("addRepositoryObj",[e,t,r]);return this._deltaDistance=this._calcStepDeltaDistance(),this._repObjNeedUpdate=!1,i},insertRepositoryObjToEditor:function(e,t,r){if(!r){this._deltaDistance=null,this._lastDeltaCount=1;var i=this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount();this.getRepositoryItem().setRingAtomCount(i)}this._isUpdateRepObj=r;var n=this.tryApplySuper("insertRepositoryObjToEditor",[e,t]);if(n&&!r){var o=n.objects[0];this.initAssocMarker(),this.updateAssocMarker(this._getRingCenterAbsContextCoord(o),{text:""+i})}return n},updateAssocMarker:function(e,t,r){if(!e){var i=this._getManipulateObjsCenterCoord();e=this.getEditor().objCoordToContext(i)}return this.tryApplySuper("updateAssocMarker",[e,t,r])},_getRingCenterAbsContextCoord:function(e){var t=this.getEditor(),r=Kekule.Editor.StructureUtils.getStructureCenterAbsBaseCoord(e,t.getCoordMode(),t.getAllowCoordBorrow());return t.objCoordToContext(r)},_updateRing:function(){this._isUpdateRepObj=!0;var e=this.updateRepositoryObjInEditor();return this._repObjNeedUpdate=!1,e},doTransformManipulatedObjs:function(e,t,r){var i=t;if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){var n=this.getBaseCoord();if(n){var o=this.getRingMinAtomCount(),a=Kekule.CoordUtils.getDistance(i,n),s=Math.round(a/this._deltaDistance)+o;if(!this._lastDeltaCount||s!==this._lastDeltaCount){var l=this.getRingMaxAtomCount(),u=l?Math.min(l,s):s;u=o?Math.max(u,o):u,this.getRepositoryItem().getRingAtomCount()!==u&&(this.getRepositoryItem().setRingAtomCount(u),this._repObjNeedUpdate=!0,this.updateAssocMarker(null,{text:""+u},!0)),this._lastDeltaCount=s}}}this._repObjNeedUpdate&&this._updateRing();var d=this.getCurrRepositoryObjects()[0];d.beginUpdate();try{var c=this.tryApplySuper("doTransformManipulatedObjs",[e,t,r]);this.updateAssocMarker(null,null,!1)}finally{d.endUpdate()}return c}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolFlexRingIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolRingIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolRingIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setRepositoryItem(new Kekule.Editor.MolRingRepositoryItem2D),this.setEnableSelect(!1),this._currBondOrders=null},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getRingAtomCount()},setter:function(e){this.getRepositoryItem().setRingAtomCount(e)}}),this.defineProp("isAromatic",{dataType:DataType.INT})},getActualManipulatingObjects:function(t){var r=this.getCurrRepositoryObjects()[0];return r?e.clone(r.getNodes()):[]},createNodeMergeOperation:function(e,t,r){var i=this.tryApplySuper("createNodeMergeOperation",[e,t,r]);return this.getIsAromatic()&&i&&i.setMergeConnectorPropsFromTarget&&i.setMergeConnectorPropsFromTarget(!0),i},manipulateBeforeStopping:function(){return this._currBondOrders&&this.useMergePreview()&&this._applyBondOrdersToSrcStruct(null,this._currBondOrders),this.tryApplySuper("manipulateBeforeStopping")},_mergeOperationsChanged:function(e,t,r){this.tryApplySuper("_mergeOperationsChanged",[e,t,r]);var i=this.getCurrRepositoryObjects(),n=i&&i[0];if(n){var o=this._getMergedDestObjs(n,e,t,r);this.updateRepStructureBondOrders(n,o,this.useMergePreview())}},createObjFromRepositoryItem:function(e,t){var r=this.tryApplySuper("createObjFromRepositoryItem",[e,t]);return this.updateRepStructureBondOrders(r.objects[0],null),this._currBondOrders=null,r},updateRepStructureBondOrders:function(e,t,r){if(this.getIsAromatic()){if(!e){var i=this.getCurrRepositoryObjects();e=i&&i[0]}t||(t={nodes:[],connectors:[],nodeCount:0,connectorCount:0});var n=this._calcSrcBondOrders(e,t),o=n.bondOrders,a=n.previewBondOrders;this._currBondOrders=o,this._applyBondOrdersToSrcStruct(e,r?a:o)}},_applyBondOrdersToSrcStruct:function(e,t){if(!e){var r=this.getCurrRepositoryObjects();e=r&&r[0]}var i=this.getEditor();try{i.beginUpdateObject(),e.beginUpdate();try{for(var n=0,o=e.getConnectorCount();n<o;++n){var a=e.getConnectorAt(n);if(a&&a.setBondOrder){var s=t[n];a.setBondOrder(s)}}}finally{e.endUpdate()}}finally{i.endUpdateObject()}},_getMergedDestObjs:function(e,t,r,i){var n=e;if(n){for(var o=function(e,t,r){for(var i=e.getConnectedChemNodes(),n=[],o=0,a=i.length;o<a;++o){var s=i[o],l=r[t.indexOf(s)];if(!l)return null;n.push(l)}if(2===n.length){var u=n[0].getLinkedConnectors();for(o=0,a=u.length;o<a;++o){var d=u[o],c=d.getConnectedChemNodes();if(2===c.length&&c.indexOf(n[1])>=0)return d}}return null},a={nodes:[],connectors:[],nodeCount:0,connectorCount:0},s=0,l=n.getNodeCount();s<l;++s){var u=n.getNodeAt(s),d=r.indexOf(u),c=d>=0?i[d]:null;a.nodes.push(c),c&&++a.nodeCount}for(s=0,l=n.getConnectorCount();s<l;++s){var h=o(n.getConnectorAt(s),n.getNodes(),a.nodes)||null;a.connectors.push(h),h&&++a.connectorCount}}return a},_calcSrcBondOrders:function(t,r){if(t&&t.getNodeCount()){r&&r.nodeCount;for(var i=t.getConnectors(),n=r.connectors,o=t.getNodes(),a=r.nodes,s=function(e){return e>Kekule.BondOrder.SINGLE&&e<=Kekule.BondOrder.QUAD},l=function(e){var t=e.getLinkedBonds(Kekule.BondType.COVALENT),r=!1;if(t.length)for(var i=0,n=t.length;i<n;++i){if(t[i].getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC){r=!0;break}}return r},u=function(t,r){var n=t.getLinkedBonds(Kekule.BondType.COVALENT),o=e.exclude(n,r),a=!1;if((o=e.exclude(o,i)).length)for(var l=0,u=o.length;l<u;++l){var d=o[l].getBondOrder();if(s(d)){a=!0;break}}return a},d=function(t,r){var i=t.getLinkedBonds(Kekule.BondType.COVALENT),n=e.intersect(i,r),o=!1;if(n.length)for(var a=0,l=n.length;a<l;++a){var u=n[a].getBondOrder();if(s(u)){o=!0;break}}return o},c=function(e,t,r,i,n,o,a){var l,h,p=Kekule.BondOrder,g=e-1;g<0&&(g=t.length-1);var f,C=!!o[g],m=C?o[g]:null,T=t[e],E=i[e],_=E&&E.getBondOrder(),S=0;if(_&&s(_))l=[_],h=[p.SINGLE],m&&s(m)&&++S;else if(C&&s(m))l=[p.SINGLE];else{for(var O=T.getConnectedChemNodes(),y=!1,A=!1,I=0,k=O.length;I<k;++I){var b=n[r.indexOf(O[I])];if(b&&(y=u(b,i),A=d(b,i),y||A))break}l=y||A?[p.SINGLE]:[p.DOUBLE,p.SINGLE]}for(I=0,k=l.length;I<k;++I){var v=l[I];if(o[e]=v,a[e]=h&&h[I]||v,e<t.length-1&&(S+=c(++e,t,r,i,n,o,a),(Kekule.ObjUtils.isUnset(f)||f>S)&&(f=S,v),S<=0))break}return S},h=[],p=[],g=!1,f=0,C=a.length;f<C;++f){var m=a[f];if(m&&l(m)){g=!0;break}}if(g){h=[];for(f=0,C=i.length;f<C;++f)h[f]=Kekule.BondOrder.EXPLICIT_AROMATIC;return h}for(f=0,C=n.length;f<C;++f){var T=n[f];if(T){var E=T.getBondOrder();s(E)&&(h[f]=E)}}c(0,i,o,n,a,h,p);return{bondOrders:h,previewBondOrders:p}}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolRingIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.PathGlyphIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.PathGlyphIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},getDirectManipulateObjs:function(e,t){var r;if(1===e.length){var i=e[0];if(i.getNodeAt&&i.getNodeCount){i.getNodeCount();i.getDirectManipulationTarget&&(r=i.getDirectManipulationTarget())}}return r||(r=this.tryApplySuper("getDirectManipulateObjs",[e,t])),r},getInsertedObjs:function(){return this.getCurrRepositoryObjects()}}),Kekule.Editor.ArrowLineIaController=Class.create(Kekule.Editor.PathGlyphIaController,{CLASS_NAME:"Kekule.Editor.ArrowLineIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setRepositoryItem(new Kekule.Editor.PathGlyphRepositoryItem2D)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT,getter:function(){return this.getRepositoryItem().getGlyphRefLength()},setter:function(e){this.getRepositoryItem().setGlyphRefLength(e)}}),this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:!1,getter:function(){return this.getRepositoryItem().getGlyphClass()},setter:function(e){this.getRepositoryItem().setGlyphClass(e)}}),this.defineProp("glyphInitialParams",{dataType:DataType.HASH,getter:function(){return this.getRepositoryItem().getGlyphInitialParams()},setter:function(e){this.getRepositoryItem().setGlyphInitialParams(e)}})},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE},addRepositoryObj:function(e,t,r){return this.getRepositoryItem().setGlyphRefLength(this.getEditor().getChemSpace().getDefAutoScaleRefLength()),this.tryApplySuper("addRepositoryObj",[e,t,r])}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.ArrowLineIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.FormulaIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.FormulaIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._operAddMol=null},initProperties:function(){this.defineProp("currMol",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:!1})},canInteractWithObj:function(e){return!(!e||!this.isValidMol(e))},isValidMol:function(e){return e instanceof Kekule.StructureFragment&&e.hasFormula()&&!e.hasCtab()},getFormulaText:function(e){return e.hasFormula()?e.getFormula().getText():""},createNewMol:function(e,t){var r=this.getEditor();if(!r.canCreateNewChild()&&!(i=r.getOnlyOneBlankStructFragment()))return null;r.beginUpdateObject();try{if(!i)var i=new Kekule.Molecule;i.getFormula(!0),e.appendChild(i),r.setObjectScreenCoord(i,t);var n=new Kekule.ChemObjOperation.Add(i,e,null,r);this._operAddBlock=n}finally{r.endUpdateObject()}return i},getTextSetterWidget:function(e){var t=this.getTextSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createTextSetterWidget(i,r),this.setTextSetter(t)}return t},_createTextSetterWidget:function(e,t){var i=new Kekule.Widget.TextBox(this.getEditor());i.addClassName(r.CHEMEDITOR_FORMULA_SETTER),i.appendToElem(t);var n=this;return i.addEventListener("keyup",function(e){var t=e.htmlEvent.getKeyCode();t===Kekule.X.Event.KeyCode.ENTER?(n.applySetter(i),i.dismiss()):t===Kekule.X.Event.KeyCode.ESC&&(i.dismiss(),n.cancelSetter())}),i.addEventListener("showStateChange",function(e){e.byDomChange||(e.isShown||e.isDismissed||n.applySetter(i),e.isShown&&(i._applied=!1))}),i},cancelSetter:function(){this._operAddBlock&&(this._operAddBlock.reverse(),this._operAddBlock=null)},applySetter:function(e,t){if(!e._applied){t||(t=this.getCurrMol());var r=e.getText();if(r)var i=new Kekule.ChemObjOperation.Modify(t.getFormula(),{text:r},this.getEditor());else this._operAddBlock?this.cancelSetter():i=new Kekule.ChemObjOperation.Remove(t,t.getParent(),null,this.getEditor());var n=this.getEditor();if(n&&i){n.beginManipulateAndUpdateObject();try{if(i.execute(),n.getEnableOperHistory()){if(this._operAddBlock){var o=new Kekule.MacroOperation;o.add(this._operAddBlock),o.add(i),n.pushOperation(o),this._operAddBlock=null}else n.pushOperation(i);this.doneInsertOrModifyBasicObjects([t])}}finally{n.endManipulateAndUpdateObject()}}e._applied=!0}},openSetterUi:function(e,t){var r=this.getTextSetter();if(r&&r.isShown()&&(this.applySetter(r,this.getCurrMol()),r.hide(),r._haltPrevShowHideProcess()),t||(t=this.createNewMol(this.getEditor().getChemObj(),e)),this.isValidMol(t)){this.setCurrMol(t),this.getEditor().setSelection([t]);var i=t.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();i*=this.getEditor().getZoom()||1;var n=t.getCascadedRenderOption("fontFamily")||"",o=this.getFormulaText(t),a=this.getTextSetterWidget(!0),s=this.getEditor().getCoreElement();a.appendToElem(s);var l=o||"";a.setValue(l);var u=a.getElement().style;u.position="absolute",u.fontSize=i+"px",u.left=e.x+"px",u.top=e.y+"px",u.fontFamily=n,a._applied=!1,a.setStandaloneOnShowHide(!0),a.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),a.selectAll(),a.focus()}},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var t,r=this._getEventMouseCoord(e),i=this.getTopmostInteractableObjAtScreenCoord(r);t=i;var n,o=i&&this.getEditor().getChemObjBounds(i),a=o&&o[0];return n=a&&a.boundInfo?a.boundInfo.coords[0]:r,e.preventDefault(),e.stopPropagation(),this.openSetterUi(n,t),!0}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.FormulaIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.ContentBlockIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ContentBlockIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("currBlock",{dataType:DataType.OBJECT,serializable:!1})},canInteractWithObj:function(e){return e&&this.isValidBlock(e)},isValidBlock:function(e){return e instanceof Kekule.ContentBlock},execute:function(e,t,r){},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MouseButton.LEFT){this.getEditor().setSelection(null);var t=this._getEventMouseCoord(e),r=this.getTopmostInteractableObjAtScreenCoord(t),i=r?this.getEditor().getObjectScreenCoord(r):t;return e.preventDefault(),e.stopPropagation(),this.execute(this.getEditor().getChemObj(),i,r),!0}}}),Kekule.Editor.TextBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.TextBlockIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._operAddBlock=null},initProperties:function(){this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:!1})},isValidBlock:function(e){return e instanceof Kekule.TextBlock},createNewBlock:function(e,t){var r=this.getEditor();if(!r.canCreateNewChild())return null;r.beginUpdateObject();try{var i=new Kekule.TextBlock;if(i){e.appendChild(i),r.setObjectScreenCoord(i,t,Kekule.Render.CoordPos.CORNER_TL);var n=new Kekule.ChemObjOperation.Add(i,e,null,r);this._operAddBlock=n}}finally{r.endUpdateObject()}return i},getBlockText:function(e){return e.getText()},execute:function(e,t,r){this.openSetterUi(t,r)},getTextSetterWidget:function(e){var t=this.getTextSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),i=r.ownerDocument;t=this._createTextSetterWidget(i,r),this.setTextSetter(t)}return t},_createTextSetterWidget:function(e,t){var i=new Kekule.Widget.TextArea(this.getEditor());i.setAutoSizeX(!0),i.setAutoSizeY(!0),i.setDisplayed(!1),i.addClassName(r.CHEMEDITOR_TEXT_SETTER),i.appendToElem(t);var n=this;return i.addEventListener("keyup",function(e){var t=e.htmlEvent,r=t.getKeyCode();r===Kekule.X.Event.KeyCode.ENTER&&t.getCtrlKey()?(n.applySetter(i),i.dismiss()):r===Kekule.X.Event.KeyCode.ESC&&(i.dismiss(),n.cancelSetter())}),i.addEventListener("showStateChange",function(e){e.byDomChange||(e.isShown||e.isDismissed||n.applySetter(i),e.isShown&&(i._applied=!1))}),i},cancelSetter:function(){this._operAddBlock&&(this._operAddBlock.reverse(),this._operAddBlock=null)},applySetter:function(e,t){if(!e._applied){t||(t=this.getCurrBlock());var r,i=e.getText();i?r=new Kekule.ChemObjOperation.Modify(t,{text:i},this.getEditor()):this._operAddBlock?this.cancelSetter():r=new Kekule.ChemObjOperation.Remove(t,t.getParent(),null,this.getEditor());var n=this.getEditor();if(r&&n){n.beginManipulateAndUpdateObject();try{if(r.execute(),n.getEnableOperHistory())if(this._operAddBlock){var o=new Kekule.MacroOperation;o.add(this._operAddBlock),o.add(r),n.pushOperation(o),this._operAddBlock=null}else n.pushOperation(r)}finally{n.endManipulateAndUpdateObject()}this.doneInsertOrModifyBasicObjects([t])}e._applied=!0}},openSetterUi:function(e,t){var r=this.getTextSetter();if(r&&r.isShown()&&(this.applySetter(r,this.getCurrBlock()),r._haltPrevShowHideProcess()),t||(t=this.createNewBlock(this.getEditor().getChemObj(),e)),this.isValidBlock(t)){this.setCurrBlock(t);var i=this.getEditor().getObjectScreenCoord(t,Kekule.Render.CoordPos.CORNER_TL),n=t.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();n*=this.getEditor().getZoom()||1;var o=t.getCascadedRenderOption("fontFamily")||"",a=this.getBlockText(t),s=this.getTextSetterWidget(!0);s._applied=!1,s.setValue(a);var l=a||Kekule.$L("ChemWidgetTexts.CAPTION_TEXTBLOCK_INIT");s.setPlaceholder(l);var u=this.getEditor().getCoreElement();s.appendToElem(u);var d=s.getElement().style;d.position="absolute",d.fontSize=n+"px",d.left=i.x+"px",d.top=i.y+"px",d.fontFamily=o,d.opacity=1,s.setStandaloneOnShowHide(!0),s.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),function(){s.selectAll(),s.focus()}.defer()}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.TextBlockIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.ImageBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.ImageBlockIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._operAddBlock=null,this._imgProbeElem=null,this._actionOpenFile=this.createOpenAction()},doFinalize:function(){this._actionOpenFile&&this.actionOpenFile.finalize()},initProperties:function(){},isValidBlock:function(e){return e instanceof Kekule.ImageBlock},createNewBlock:function(e,t,r,i){var n=this.getEditor();if(!n.canCreateNewChild())return null;n.beginUpdateObject();try{var o=new Kekule.ImageBlock;i&&o.setSrc(i),r&&o.setSize2D(r),n.setObjectScreenCoord(o,t,Kekule.Render.CoordPos.CORNER_TL);var a=new Kekule.ChemObjOperation.Add(o,e,null,n);this._operAddBlock=a}finally{n.endUpdateObject()}return o},_getImgFilters:function(){return[{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_PNG"),filter:".png"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_JPG"),filter:".jpg,.jpeg"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_GIF"),filter:".gif"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_SVG"),filter:".svg"},Kekule.NativeServices.FILTER_ALL_SUPPORT,Kekule.NativeServices.FILTER_ANY]},createOpenAction:function(){var e=new Kekule.ActionFileOpen;return e.setFilters(this._getImgFilters()),e.on("open",this.reactImageFileOpen,this),e},reactImageFileOpen:function(e){var t=e.file;if(t){var r=this,i=new FileReader;i.addEventListener("load",function(){var e=r._getImageProbeElem();e.ownerDocument;try{delete e.width,delete e.height}catch(e){}e.src=i.result;var t=r.getEditor();(function(){if((l={x:e.width,y:e.height}).x<=0||l.y<=0)Kekule.error(Kekule.$L("ErrorMsg.INVALID_OR_EMPTY_IMAGE"));else{var n=r._currCoord,o=t.objCoordToContext(n),a=Kekule.CoordUtils.add(o,l),s=t.contextCoordToObj(a),l=Kekule.CoordUtils.substract(s,n);l=Kekule.CoordUtils.absValue(l);var u,d=r.getCurrBlock(),c=t.getChemObj();if(d)u=new Kekule.ChemObjOperation.Modify(d,{src:i.result,size2D:l});else{var h=r.createNewBlock(r.getEditor().getChemObj(),r._currCoord,l,i.result);r.setCurrBlock(h),u=new Kekule.ChemObjOperation.Add(h,c,null,t)}if(u){t.beginManipulateAndUpdateObject();try{u.execute(),t&&t.getEnableOperHistory()&&t.pushOperation(u),r.doneInsertOrModifyBasicObjects([r.getCurrBlock()])}finally{t.endManipulateAndUpdateObject()}}}}).defer()}),i.readAsDataURL(t)}},_getImageProbeElem:function(){if(!this._imgProbeElem){var e=this.getEditor().getElement().ownerDocument;this._imgProbeElem=e.createElement("img")}return this._imgProbeElem},execute:function(e,t,r){this.setCurrBlock(r),this._currCoord=t,this._actionOpenFile.execute(this.getEditor())}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.ImageBlockIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.AttachedMarkerIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.AttachedMarkerIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("markerClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("targetClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("markerClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getMarkerClass())},setter:function(e){this.setMarkerClass(ClassEx.findClass(e))}}),this.defineProp("targetClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getTargetClass())},setter:function(e){this.setTargetClass(ClassEx.findClass(e))}}),this.defineProp("initialPropValues",{dataType:DataType.HASH})},canInteractWithObj:function(e){return this.isValidTarget(e)},isValidTarget:function(e){var t=this.getTargetClass();return e instanceof t||!t},createMarker:function(){var e,t=this.getMarkerClass();if(t){e=new t;var r=this.getInitialPropValues();r&&e&&e.setPropValues&&e.setPropValues(r)}return e},createOperations:function(e){var t,r=this.createMarker();return r&&(t=new Kekule.ChemObjOperation.Add(r,e,null,this.getEditor())),[t]},apply:function(e){var t=this.createOperations(e),r=t.length<=0?null:1===t.length?t[0]:new Kekule.MacroOperation(t);if(r){var i=this.getEditor();i&&i.getEnableOperHistory()&&i.pushOperation(r,!0)}},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MouseButton.LEFT){var t=this._getEventMouseCoord(e),r=this.getEditor().getTopmostBoundInfoAtCoord(t,null,this.getCurrBoundInflation());if(r){var i=r.obj;return this.isValidTarget(i)&&(this.apply(i),e.preventDefault(),e.stopPropagation()),!0}}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.AttachedMarkerIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolNodeChargeIaController=Class.create(Kekule.Editor.AttachedMarkerIaController,{CLASS_NAME:"Kekule.Editor.MolNodeChargeIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setChargeInc(1)},initProperties:function(){this.defineProp("chargeInc",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("charge",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("electronicBiasInc",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("electronicBias",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("radical",{dataType:DataType.INT,serializable:!1}),this.defineProp("currNode",{dataType:DataType.OBJECT,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setTargetClass(Kekule.ChemStructureNode)},createOperations:function(e){var t=!1,r=!1,i=!1,n={},o=e.getCharge(),a=e.getElectronicBias&&e.getElectronicBias();Kekule.ObjUtils.notUnset(this.getCharge())?o!==this.getCharge()&&(n.charge=this.getCharge(),t=!0):this.getChargeInc()&&(o+=this.getChargeInc(),n.charge=o,t=!0),Kekule.ObjUtils.notUnset(this.getElectronicBias())?a!==this.getElectronicBias()&&(n.electronicBias=this.getElectronicBias(),r=!0):this.getElectronicBiasInc()&&(a?a+=this.getElectronicBiasInc():a=this.getElectronicBiasInc(),n.electronicBias=a,r=!0);var s=e.getRadical();this.getRadical()!==s&&(n.radical=this.getRadical(),i=!0);var l,u,d=[],c=[],h=[],p=this.getEditor();if(t||r){var g=e.fetchChargeMarker(!1);g?n.charge||n.electronicBias||h.push(new Kekule.ChemObjOperation.Remove(g,null,null,p)):0===n.electronicBias&&0===n.charge||((l=new Kekule.ChemMarker.Charge).setValue({electronicBias:n.electronicBias,charge:n.charge}),c.push(new Kekule.ChemObjOperation.Add(l,e,null,p)))}if(i){var f=e.fetchRadicalMarker(!1);0===n.radical||f||((l=new Kekule.ChemMarker.Radical).setValue(n.radical),c.push(new Kekule.ChemObjOperation.Add(l,e,null,p))),0===n.radical&&f&&h.push(new Kekule.ChemObjOperation.Remove(f,null,null,p))}return d=d.concat(c),(t||r||i)&&(u=new Kekule.ChemObjOperation.Modify(e,n,this.getEditor()),d.push(u)),d=d.concat(h)}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolNodeChargeIaController,Kekule.Editor.ChemSpaceEditor)}(),function(){"use strict";Kekule.Editor.EditorNexus=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.EditorNexus",initialize:function(e){this.tryApplySuper("initialize"),this._currInvoker=null,e&&(e.editor&&this.setEditor(e.editor),e.structureTreeView&&this.setStructureTreeView(e.structureTreeView),e.objectInspector&&this.setObjectInspector(e.objectInspector),e.issueInspector&&this.setIssueInspector(e.issueInspector))},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("editor");this.setPropStoreFieldValue("editor",e),this.editorChanged(e,t)}}),this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("structureTreeView");this.setPropStoreFieldValue("structureTreeView",e),this.structureTreeViewChanged(e,t)}}),this.defineProp("objectInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("objectInspector");this.setPropStoreFieldValue("objectInspector",e),this.objectInspectorChanged(e,t)}}),this.defineProp("issueInspector",{dataType:"Kekule.Editor.IssueInspector",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("issueInspector");this.setPropStoreFieldValue("issueInspector",e),this.issueInspectorChanged(e,t)}})},editorChanged:function(e,t){t&&this._uninstallEditorEventHandler(t),e&&this._installEditorEventHandler(e)},structureTreeViewChanged:function(e,t){t&&this._uninstallStructureTreeViewEventHandler(t),e&&(this._installStructureTreeViewEventHandler(e),this._updateByEditor())},objectInspectorChanged:function(e,t){var r=this.getEditor();r&&(t&&t.getOperHistory()===r.getOperHistory()&&(this._uninstallObjInspectorEventHandler(t),t.setOperHistory(null)),e&&(e.setOperHistory(r.getOperHistory()),e.setEnableOperHistory(r.getEnableOperHistory()),this._installObjInspectorEventHandler(e),this._updateByEditor()))},issueInspectorChanged:function(e,t){t&&this._uninstallIssueInspectorEventHandler(t),e&&this._installIssueInspectorEventHandler(e),this.getEditor()&&e&&this._updateByEditor()},_installEditorEventHandler:function(e){e.addEventListener("change",this._reactEditorChanged,this),e.addEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this),e.addEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_uninstallEditorEventHandler:function(e){e.removeEventListener("change",this._reactEditorChanged,this),e.removeEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this),e.removeEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_installStructureTreeViewEventHandler:function(e){e.addEventListener("change",this._reactStructureTreeViewChanged,this)},_uninstallStructureTreeViewEventHandler:function(e){e.removeEventListener("change",this._reactStructureTreeViewChanged,this)},_installObjInspectorEventHandler:function(e){e.addEventListener("propertyChange",this._reactObjInspectorPropertyChange,this)},_uninstallObjInspectorEventHandler:function(e){e.removeEventListener("propertyChange",this._reactObjInspectorPropertyChange,this)},_installIssueInspectorEventHandler:function(e){e.addEventListener("selectResult",this._reactIssueInspectorSelectResult,this)},_uninstallIssueInspectorEventHandler:function(e){e.removeEventListener("selectResult",this._reactIssueInspectorSelectResult,this)},_reactEditorChanged:function(e){if(!this._currInvoker){var t=e.target;if(t===this.getEditor()){var r=e.changedPropNames;if(r.indexOf("chemObj")>=0&&this.changeRootObj(t.getChemObj(),t),r.indexOf("selection")>=0&&this.changeSelection(t.getSelection(),t),r.indexOf("operHistory")>=0||r.indexOf("enableOperHistory")>=0){var i=this.getObjectInspector();i&&(i.setOperHistory(t.getOperHistory()),i.setEnableOperHistory(t.getEnableOperHistory()))}var n=this.getIssueInspector();n&&(r.indexOf("issueCheckExecutor")>=0&&n.setIssueCheckExecutor(t.getIssueCheckExecutor()),r.indexOf("issueCheckResults")>=0&&n.setCheckResults(t.getIssueCheckResults()))}}},_reactEditorBeginUpdateObject:function(e){this.pauseLiveUpdate()},_reactEditorEndUpdateObject:function(e){this.resumeLiveUpdate()},_updateByEditor:function(){this._reactEditorChanged({target:this.getEditor(),changedPropNames:["chemObj","selection","operHistory","issueCheckExecutor","issueCheckResults"]})},_reactStructureTreeViewChanged:function(e){if(!this._currInvoker){var t=e.target;if(t===this.getStructureTreeView())if(e.changedPropNames.indexOf("selection")>=0){var r=t.getSelectedChemObjs();this.changeSelection(r,t)}}},_reactIssueInspectorSelectResult:function(e){var t=e.selectedResult,r=this.getEditor();r&&r.setActiveIssueCheckResult&&r.setActiveIssueCheckResult(t)},_reactObjInspectorPropertyChange:function(e){var t=this.getEditor();t&&t.notifyUserModificationDone&&t.notifyUserModificationDone()},pauseLiveUpdate:function(){var e=this.getStructureTreeView();e&&e.pauseLiveUpdate()},resumeLiveUpdate:function(){var e=this.getStructureTreeView();e&&e.resumeLiveUpdate()},changeSelection:function(e,t){this._currInvoker=t;try{var r=this.getEditor();r&&this._currInvoker!==r&&r.setSelection(e);var i=this.getStructureTreeView();i&&this._currInvoker!==i&&i.selectChemObjs(e);var n=this.getObjectInspector();n&&this._currInvoker!==n&&n.setObjects(e)}finally{this._currInvoker=null}},changeRootObj:function(e,t){this._currInvoker=t;try{var r=this.getEditor();r&&this._currInvoker!==r&&r.setChemObj(e);var i=this.getStructureTreeView();i&&this._currInvoker!==i&&i.setRootObj(e);var n=this.getIssueInspector();n&&this._currInvoker!==n&&n.setRootObj(e)}finally{this._currInvoker=null}}})}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.ChemWidget.ComponentWidgetNames,r=Kekule.ChemWidget.HtmlClassNames,i=(Kekule.ActionManager,[]);function n(){!function(){for(var e=["C","H","O","N","P","S","Si","F","Cl","Br","I","B","K","Na","D"],t=["methyl","ethyl","phenyl","Ac","TMS","COOCH3","OTs"],r=Kekule.Editor.ActionOperationCreate.ChemNodeModify,i=Kekule.Editor.createEditorOperationCreateActionClass,n=0,o=e.length;n<o;++n)i(null,s="atom_"+e[n],r,{nodeClass:Kekule.Atom,props:{isotopeId:e[n]}});for(n=0,o=t.length;n<o;++n){var a=t[n],s="subgroup_"+a,l=Kekule.Editor.RepositoryItemManager.getItem(a),u=l.getStructureFragment&&l.getStructureFragment();u&&i(null,s,r,{nodeClass:u.getClass(),repositoryItem:l})}i(null,"subgroup_R",r,{nodeClass:Kekule.SubGroup}),i(null,"atom_variable",r,{nodeClass:Kekule.VariableAtom}),i(null,"atom_dummy",r,{nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY}}),i(null,"atom_hetero",r,{nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO}}),i(null,"atom_any",r,{nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY}})}(),function(){for(var e=Kekule.BondType,t=Kekule.BondOrder,r=Kekule.BondStereo,i={single:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.NONE},double:{bondType:e.COVALENT,bondOrder:t.DOUBLE,stereo:r.NONE},triple:{bondType:e.COVALENT,bondOrder:t.TRIPLE,stereo:r.NONE},quad:{bondType:e.COVALENT,bondOrder:t.QUAD,stereo:r.NONE},up:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP},down:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.DOWN},closer:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.CLOSER},upOrDown:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP_OR_DOWN}},n=Kekule.Editor.ActionOperationCreate.ChemConnectorModify,o=Kekule.Editor.createEditorOperationCreateActionClass,a=Kekule.ObjUtils.getOwnedFieldNames(i),s=0,l=a.length;s<l;++s)o(null,"bond_"+a[s],n,i[a[s]])}()}Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{ACTION_UNDO:"K-Chem-Undo",ACTION_REDO:"K-Chem-Redo",ACTION_NEWDOC:"K-Chem-NewDoc",ACTION_SELECT_ALL:"K-Chem-SelectAll",ACTION_CLONE_SELECTION:"K-Chem-Clone-Selection",ACTION_COPY:"K-Chem-Copy",ACTION_CUT:"K-Chem-Cut",ACTION_PASTE:"K-Chem-Paste",ACTION_TOGGLE_SELECT:"K-Chem-Toggle-Select-State",ACTION_ERASE_SELECTION:"K-Chem-Erase-Selection",ACTION_RECHECK_ISSUES:"K-Chem-Recheck-Issues",ACTION_TOGGLE_OBJ_INSPECTOR:"K-Chem-Toggle-ObjInspector",ACTION_TOGGLE_ISSUE_INSPECTOR:"K-Chem-Toggle-IssueInspector",ACTION_TOGGLE_SHOW_ISSUES:"K-Chem-Toggle-ShowIssues"}),Object.extend(Kekule.ChemWidget.ComponentWidgetNames,{manipulateMarquee:"manipulateMarquee",manipulateLasso:"manipulateLasso",manipulateBrush:"manipulateBrush",manipulateAncestor:"manipulateAncestor",molBondSingle:"bondSingle",molBondDouble:"bondDouble",molBondTriple:"bondTriple",molBondCloser:"bondCloser",molBondWedgeUp:"bondWedgeUp",molBondWedgeDown:"bondWedgeDown",molBondWedgeUpOrDown:"bondWedgeUpOrDown",molBondDoubleEither:"bondDoubleEither",molChargeClear:"chargeClear",molChargePositive:"chargePositive",molChargeNegative:"chargeNegative",molElectronicBiasPositive:"electronicBiasPositive",molElectronicBiasNegative:"electronicBiasNegative",molRadicalSinglet:"radicalSinglet",molRadicalTriplet:"radicalTriplet",molRadicalDoublet:"radicalDoublet",molElectronLonePair:"electronLonePair",molChain:"chain",molRing3:"ring3",molRing4:"ring4",molRing5:"ring5",molRing6:"ring6",molRing7:"ring7",molRing8:"ring8",molRingAr6:"ringAr6",molRingAr5:"ringAr5",molFlexRing:"flexRing",molRepCyclopentaneHaworth1:"repCyclopentaneHaworth1",molRepCyclopentaneHaworth2:"repCyclopentaneHaworth2",molRepCyclohexaneHaworth1:"repCyclohexaneHaworth1",molRepCyclohexaneHaworth2:"repCyclohexaneHaworth2",molRepCyclohexaneChair1:"repCyclohexaneChair1",molRepCyclohexaneChair2:"repCyclohexaneChair2",molRepSubBondMark:"subBondMark",molRepMethane:"methane",molRepFischer1:"repFischer1",molRepFischer2:"repFischer2",molRepFischer3:"repFischer3",molRepSawhorseStaggered:"repSawhorseStaggered",molRepSawhorseEclipsed:"repSawhorseEclipsed",glyphRepLine:"repLine",glyphRepOpenArrowLine:"repOpenArrowLine",glyphRepTriangleArrowLine:"repTriangleArrowLine",glyphRepDiOpenArrowLine:"repDiOpenArrowLine",glyphRepDiTriangleArrowLine:"repDiTriangleArrowLine",glyphRepReversibleArrowLine:"repReversibleArrowLine",glyphRepOpenArrowDiLine:"repOpenArrowDiLine",glyphRepOpenArrowArc:"repOpenArrowArc",glyphRepSingleSideOpenArrowArc:"repSingleSideOpenArrowArc",glyphRepHeatSymbol:"repHeatSymbol",glyphRepAddSymbol:"repAddSymbol",glyphElectronPushingArrow:"repElectronPushingArrow",glyphElectronPushingArrowDouble:"repElectronPushingArrowDouble",glyphElectronPushingArrowSingle:"repElectronPushingArrowSingle",glyphElectronPushingArrowBondForming:"repElectronPushingArrowBondForming",glyphRepSegment:"repGlyphSegment",glyphReactionArrowNormal:"repGlyphReactionArrowNormal",glyphReactionArrowReversible:"glyphReactionArrowReversible",glyphReactionArrowResonance:"glyphReactionArrowResonance",glyphReactionArrowRetrosynthesis:"glyphReactionArrowRetrosynthesis"}),Kekule.Editor.ActionOperUtils={getObjsCenterScreenCoord:function(e,t){for(var r=Kekule.BoxUtils,i=Kekule.CoordUtils,n=null,o=0,a=t.length;o<a;++o){var s=Kekule.Render.ObjUtils.getContainerBox(t[o],e.getCoordMode(),e.getAllowCoordBorrow());n=n?r.getContainerBox(s,n):s}var l=r.getMinMaxCoords(n),u={min:e.objCoordToScreen(l.min),max:e.objCoordToScreen(l.max)},d=i.add(u.min,u.max);return d=i.divide(d,2)},addObjectsToChemSpaceEditor:function(t,r,i){var n,o,a,s=Object.extend({autoAdjustPosition:!0},i),l=t.getChemSpace&&t.getChemSpace();if(t&&l&&t.canAddNewStandaloneObject&&t.canAddNewStandaloneObject()){for(var u=[],d=0,c=r.length;d<c;++d){var h=(n=r[d],o=void 0,a=void 0,o=[],(a=l)&&n&&(o=n.getClass()===a.getClass()||n instanceof Kekule.ChemSpace?e.clone(n.getChildren()):[n]),o);h&&h.length&&e.pushUnique(u,h)}t.beginManipulateAndUpdateObject();try{var p=new Kekule.MacroOperation;for(d=0,c=u.length;d<c;++d){var g=u[d],f=new Kekule.ChemObjOperation.Add(g,l,null,t);p.add(f)}p.execute();var C=s.screenCoordOffset;if(!C&&s.autoAdjustPosition){var m=t.getClientVisibleRect(),T={x:m.left+m.width/2,y:m.top+m.height/2},E=this.getObjsCenterScreenCoord(t,u);C=Kekule.CoordUtils.substract(T,E)}if(C)for(d=0,c=u.length;d<c;++d){g=u[d];var _=t.getObjectScreenCoord(g),S=Kekule.CoordUtils.add(_,C);t.setObjectScreenCoord(g,S)}t.pushOperation(p),s.autoSelect&&t.select(u)}finally{t.endManipulateAndUpdateObject()}}}},Kekule.Editor.ActionOnEditor=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.Editor.ActionOnEditor",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("explicitGroup",{dataType:DataType.STRING})},getPreferredWidgetClass:function(){return null},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},getEditor:function(){var e=this.getDisplayer();return e instanceof Kekule.Editor.BaseEditor?e:null}}),Kekule.Editor.ActionEditorUndo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorUndo",HTML_CLASSNAME:r.ACTION_UNDO,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_UNDO"),Kekule.$L("ChemWidgetTexts.HINT_UNDO")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getEnableOperHistory()&&this.getEditor().canUndo())},doExecute:function(){var e=this.getEditor();e&&e.undo()}}),Kekule.Editor.ActionEditorRedo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorRedo",HTML_CLASSNAME:r.ACTION_REDO,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_REDO"),Kekule.$L("ChemWidgetTexts.HINT_REDO")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getEnableOperHistory()&&this.getEditor().canRedo())},doExecute:function(){var e=this.getEditor();e&&e.redo()}}),Kekule.Editor.ActionEditorNewDoc=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorNewDoc",HTML_CLASSNAME:r.ACTION_NEWDOC,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_NEWDOC"),Kekule.$L("ChemWidgetTexts.HINT_NEWDOC")])},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getEnabled()&&e.getEnableCreateNewDoc())},doExecute:function(){var e=this.getEditor();e&&e.newDoc()}}),Kekule.Editor.ActionEditorLoadData=Class.create(Kekule.ChemWidget.ActionDisplayerLoadData,{CLASS_NAME:"Kekule.Editor.ActionEditorLoadData",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("enableAppend",{dataType:DataType.BOOL})},doExecute:function(e){var t=this.getDataDialog();return t&&t.setDisplayAppendCheckBox&&t.setDisplayAppendCheckBox(this._isEditorRootObjAppendable()&&!this._isEditorEmpty()),this.tryApplySuper("doExecute",[e])},_getEditorRootObj:function(){return this.getDisplayer().getChemObj()},_isEditorRootObjAppendable:function(){var e=this.getDisplayer(),t=this._getEditorRootObj();return t&&t instanceof Kekule.ChemSpace&&e.canAddNewStandaloneObject&&e.canAddNewStandaloneObject()&&e.getAllowAppendDataToCurr&&e.getAllowAppendDataToCurr()},_isEditorEmpty:function(){var e=this._getEditorRootObj();return!e||e.getChildCount&&0===e.getChildCount()},createDataDialog:function(){var e=this.getDisplayer().getDocument();return new Kekule.ChemWidget.LoadOrAppendDataDialog(e)},doLoadInDisplayer:function(e,t,r){var i=e||this.getDisplayer();if(!r.getIsAppending()||this._isEditorEmpty()||!this._isEditorRootObjAppendable())return this.tryApplySuper("doLoadInDisplayer",[e,t,r]);var n=this._getEditorRootObj();i.loadFromData(t.data,t.mimeType,t.fileName,t.formatId,function(e){if(e){i.beginUpdateObject();try{n.beginUpdate();try{Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(i,[e],{autoSelect:!0})}finally{n.endUpdate()}}finally{i.endUpdateObject()}}})}}),Kekule.Editor.ActionSelectAll=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionSelectAll",HTML_CLASSNAME:r.ACTION_SELECT_ALL,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_SELECT_ALL"),Kekule.$L("ChemWidgetTexts.HINT_SELECT_ALL")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getChemObj())},doExecute:function(){this.getEditor().selectAll()}}),Kekule.Editor.ActionCloneSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCloneSelection",HTML_CLASSNAME:r.ACTION_CLONE_SELECTION,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_CLONE_SELECTION"),Kekule.$L("ChemWidgetTexts.HINT_CLONE_SELECTION")])},_hasCloneMethod:function(){var e=this.getEditor();return e&&e.cloneSelection},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this._hasCloneMethod()&&this.getEditor().hasSelection()),this.setDisplayed(this._hasCloneMethod()&&this.getEditor().canCloneObjects())},doExecute:function(){var e=this.getEditor();if(e&&e.getChemSpace){var t=e.getDefaultCloneScreenCoordOffset&&e.getDefaultCloneScreenCoordOffset(),r=e.cloneSelection();Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(e,r,{screenCoordOffset:t,autoSelect:!0})}}}),Kekule.Editor.ActionCopySelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCopySelection",HTML_CLASSNAME:r.ACTION_COPY,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_COPY"),Kekule.$L("ChemWidgetTexts.HINT_COPY")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var e=this.getEditor(),t=e.getChemSpace&&e.getChemSpace();if(e&&t){var r=e.cloneSelection(),i=new Kekule.IntermediateChemSpace;try{i.appendChildren(r),Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,[i])}finally{i.finalize()}}}}),Kekule.Editor.ActionCutSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCutSelection",HTML_CLASSNAME:r.ACTION_CUT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_CUT"),Kekule.$L("ChemWidgetTexts.HINT_CUT")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var e=this.getEditor(),t=e.getChemSpace&&e.getChemSpace();if(e&&t){var r=e.cloneSelection(),i=new Kekule.IntermediateChemSpace;try{i.appendChildren(r),Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,[i])}finally{i.finalize()}var n=e.getIaController("BasicMolEraserIaController");n&&n.removeSelection()}}}),Kekule.Editor.ActionPaste=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionPaste",HTML_CLASSNAME:r.ACTION_PASTE,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_PASTE"),Kekule.$L("ChemWidgetTexts.HINT_PASTE")]),Kekule.Widget.clipboard.addEventListener("setData",this._reactClipboardChange,this)},finalize:function(){Kekule.Widget.clipboard.removeEventListener("setData",this._reactClipboardChange,this),this.tryApplySuper("finalize")},_reactClipboardChange:function(){this.update()},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(Kekule.Widget.clipboard.hasData(Kekule.IO.MimeType.JSON)&&this.getEditor().canAddNewStandaloneObject())},getObjsCenterScreenCoord:function(e,t){return Kekule.Editor.ActionOperUtils.getObjsCenterScreenCoord(e,t)},doExecute:function(){var t=this.getEditor();if(t&&t.getChemSpace){var r,i,n=Kekule.Widget.clipboard.getObjects(Kekule.IO.MimeType.JSON);1===n.length&&n[0]instanceof Kekule.IntermediateChemSpace?(r=n[0],i=e.clone(r.getChildren()),r.removeChildren(i)):i=n,r&&r.finalize();var o=null,a=t.getSelection();if(a&&a.length){o=t.getDefaultCloneScreenCoordOffset?t.getDefaultCloneScreenCoordOffset():null;var s=e.clone(a);if(s&&s.length&&o){var l=this.getObjsCenterScreenCoord(t,s),u=this.getObjsCenterScreenCoord(t,i),d=Kekule.CoordUtils.substract(l,u);o=Kekule.CoordUtils.add(o,d)}}Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(t,i,{screenCoordOffset:o,autoSelect:!0})}}}),Kekule.Editor.ActionToggleSelectState=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionToggleSelectState",HTML_CLASSNAME:r.ACTION_TOGGLE_SELECT,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_SELECT"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_SELECT")]),this.setExplicitGroup("")},getPreferredWidgetClass:function(){return Kekule.Widget.CheckButton},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setChecked(this.getEditor().getIsToggleSelectOn())},checkedChanged:function(){this.tryApplySuper("checkedChanged")},doExecute:function(e,t){this.tryApplySuper("doExecute",[e,t]);var r=this.getChecked();this.getEditor().setIsToggleSelectOn(!r),this.setChecked(!r)}}),Kekule.Editor.ActionEraseSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEraseSelection",HTML_CLASSNAME:r.ACTION_ERASE_SELECTION,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_ERASE_SELECTION"),Kekule.$L("ChemWidgetTexts.HINT_ERASE_SELECTION")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var e=this.getEditor();if(e){var t=e.getIaController("BasicMolEraserIaController");t&&t.removeSelection()}}}),Kekule.Editor.ActionRecheckIssues=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionRecheckIssues",HTML_CLASSNAME:r.ACTION_RECHECK_ISSUES,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_RECHECK_ISSUES"),Kekule.$L("ChemWidgetTexts.HINT_RECHECK_ISSUES")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getEditor();this.setEnabled(e.getEnableIssueCheck()).setDisplayed(e.getEnableIssueCheck())},doExecute:function(e,t){this.tryApplySuper("doExecute",[e,t]);var r=this.getEditor();r&&r.checkIssues()}}),Kekule.Editor.ActionToggleShowIssueMarkers=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionToggleShowIssueMarkers",HTML_CLASSNAME:r.ACTION_TOGGLE_SHOW_ISSUES,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_SHOW_ISSUE_MARKERS"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_SHOW_ISSUE_MARKERS")]),this.setExplicitGroup("")},getPreferredWidgetClass:function(){return Kekule.Widget.CheckButton},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getEditor();this.setChecked(e.getShowAllIssueMarkers()),this.setEnabled(e.getEnableIssueCheck()).setDisplayed(e.getEnableIssueCheck())},doExecute:function(e,t){this.tryApplySuper("doExecute",[e,t]);var r=this.getChecked();this.getEditor().setShowAllIssueMarkers(!r),this.setChecked(!r)}}),Kekule.Editor.ActionOperationCreate={},Kekule.Editor.ActionOperationCreate.Base=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.Base",initialize:function(e){this.tryApplySuper("initialize",[e])},applicable:function(e){var t=this.getOperationTargets();if(t&&t.length){for(var r=this.getData(),i=0,n=t.length;i<n;++i)if(this.applicableOnTarget(t[i],r,e))return!0;return!1}return!1},applicableOnTarget:function(e,t,r){return!1},getOperationTargets:function(e){return[]},getData:function(){return this.ACTION_DATA||{}},createOperations:function(e){for(var t=this.getOperationTargets(e),r=this.getData(),i=[],n=0,o=t.length;n<o;++n){var a=t[n];if(this.applicableOnTarget(a,r,e)){var s=this.doCreateOperationOnTarget(a,r,e);s&&i.push(s)}}return i},doCreateOperationOnTarget:function(e,t,r){return null},doExecute:function(){var e=this.getEditor(),t=this.getModificationTargets(e),r=this.createOperations(t,data,e);return!(!r||!r.length)&&(e.execOperations(r),!0)}}),Kekule.Editor.ActionOperationCreate.ChemObjModify=Class.create(Kekule.Editor.ActionOperationCreate.Base,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemObjModify",getOperationTargets:function(e){var t=e.getHotTrackedObjs();return t&&t.length||(t=e.getSelection()),t}}),Kekule.Editor.ActionOperationCreate.ChemNodeModify=Class.create(Kekule.Editor.ActionOperationCreate.ChemObjModify,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemNodeModify",applicableOnTarget:function(e,t,r){return e instanceof Kekule.ChemStructureNode&&!(e instanceof Kekule.Molecule)&&e.getLinkedBonds().length},doCreateOperationOnTarget:function(e,t,r){return Kekule.Editor.OperationUtils.createNodeModificationOperationFromData(e,t,r)}}),Kekule.Editor.ActionOperationCreate.ChemConnectorModify=Class.create(Kekule.Editor.ActionOperationCreate.ChemObjModify,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemConnectorModify",applicableOnTarget:function(e,t,r){return e instanceof Kekule.ChemStructureConnector},doCreateOperationOnTarget:function(e,t,r){return Kekule.ObjUtils.match(e,t)?null:new Kekule.ChemObjOperation.Modify(e,t,r)}}),Kekule.Editor.createEditorOperationCreateActionClass=function(e,t,r,n){var o={};e&&(o.CLASS_NAME="Kekule.Editor.ActionOperationCreate."+e),n&&(o.ACTION_DATA=n);var a=Class.create(r,o);return t&&i.push({name:t,actionClass:a}),a},Kekule.Editor.ActionOnComposer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Editor.ActionOnComposer",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setText(t),this.setHint(r),this.setComposer(e)},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1})},doUpdate:function(){var e=this.getComposer(),t=this.getEditor();this.setEnabled(e&&e.getEnabled()&&t&&t.getChemObj()&&t.getChemObjLoaded()&&t.getEnabled())},getEditor:function(){var e=this.getComposer();return e?e.getEditor():null}}),Kekule.Editor.ActionOnComposerAdv=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionOnComposerAdv",initialize:function(e,t,r){var i=new Kekule.ActionList;i.setOwnActions(!0),this.setPropStoreFieldValue("attachedActions",i),this.tryApplySuper("initialize",[e,t,r])},finalize:function(){this.getAttachedActions().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("attachedActionClasses",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("attachedActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null}),this.defineProp("defaultAttachedAction",{dataType:"Kekule.Action",serializable:!1}),this.defineProp("defaultAttachedActionClass",{dataType:DataType.CLASS,serializable:!1})},checkedChanged:function(){this.tryApplySuper("checkedChanged");var e=this.getChecked();if(this.hasAttachedActions()){var t=this.getComposer();if(t)if(e){var r=this.getAttachedActions();t.bindAssocActions(r),t.showAssocToolbar();var i=r.getCheckedAction(this.getClassName());i||(i=this.getDefaultAttachedAction()),i&&(i.setChecked(!1),i.execute())}else t.hideAssocToolbar()}},doSetDefaultAttachedActionClass:function(e){if(this.setPropStoreFieldValue("defaultAttachedActionClass",e),e&&this.hasAttachedActions())for(var t=0,r=this.getAttachedActions().getActionCount();t<r;++t){var i=this.getAttachedActions().getActionAt(t);if(i.getClass()===e){this.setDefaultAttachedAction(i);break}}},hasAttachedActions:function(){return!!this.getAttachedActions().getActionCount()},setAttachedActionIndex:function(e,t){var r=this.getAttachedActions();return r&&r.setActionIndex(e,t),this},addAttachedAction:function(e,t){if(this.getAttachedActions().add(e),t)this.setDefaultAttachedAction(e);else if(void 0===t){let t=this.getDefaultAttachedActionClass();t&&e.getClass()===t&&this.setDefaultAttachedAction(e)}return this},removeAttachedAction:function(e){return this.getDefaultAttachedAction()===e&&this.setDefaultAttachedAction(null),this.getAttachedActions().remove(e),this},clearAttachedActions:function(){this.setDefaultAttachedAction(null),this.getAttachedActions().clear()},doExecute:function(){},update:function(){this.tryApplySuper("update"),this.getAttachedActions().updateAll()}}),Kekule.Editor.ActionComposerToggleObjInspector=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleObjInspector",HTML_CLASSNAME:r.ACTION_TOGGLE_OBJ_INSPECTOR,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_OBJ_INSPECTOR"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_OBJ_INSPECTOR")])},doUpdate:function(){var e=this.getComposer();e&&this.setChecked(e.getShowObjInspector())},doExecute:function(){var e=this.getComposer();e&&(this.setChecked(!this.getChecked()),e.setShowObjInspector(this.getChecked()))}}),Kekule.Editor.ActionComposerToggleInspector=Kekule.Editor.ActionComposerToggleObjInspector,Kekule.Editor.ActionComposerToggleIssueInspector=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleIssueInspector",HTML_CLASSNAME:r.ACTION_TOGGLE_ISSUE_INSPECTOR,initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_ISSUE_INSPECTOR"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_ISSUE_INSPECTOR")])},doUpdate:function(){var e=this.getComposer();e&&(this.setChecked(e.getShowIssueInspector()),this.setEnabled(e.getEnableIssueCheck()).setDisplayed(e.getEnableIssueCheck()))},doExecute:function(){var e=this.getComposer();e&&(this.setChecked(!this.getChecked()),e.setShowIssueInspector(this.getChecked()))}}),Kekule.Editor.ActionComposerSetIaController=Class.create(Kekule.Editor.ActionOnComposerAdv,{CLASS_NAME:"Kekule.Editor.ActionComposerSetIaController",initialize:function(e,t,r,i){this.tryApplySuper("initialize",[e,t,r]),this.setPropStoreFieldValue("iaControllerId",i)},initProperties:function(){this.defineProp("iaControllerId",{dataType:DataType.STRING,serializable:!1,setter:null})},doExecute:function(){this.getEditor().setActiveIaControllerId(this.getIaControllerId())}}),Kekule.Editor.createComposerIaControllerActionClass=function(e,t,r,n,o,a,s,l,u,d,c){o||(o=n),o.startsWith(Kekule.ChemWidget.HtmlClassNames.PREFIX)||(o=Kekule.ChemWidget.HtmlClassNames.PREFIX+o);var h,p={CLASS_NAME:e,HTML_CLASSNAME:o,initialize:function(e){this.tryApplySuper("initialize",[e,t,r,n]),this.initAttachedActions&&this.initAttachedActions()}};(l&&(p=Object.extend(p,l)),c&&(p.initPropValues=function(){this.tryApplySuper("initPropValues"),this.setPropValues(c)}),a)&&(p.doExecute&&(h=p.doExecute),p.doExecute=function(){var e=this.getEditor().getIaController(n);e&&e.setPropValues(a),h?h.apply(this):this.tryApplySuper("doExecute")});s&&(p.initAttachedActions=function(){this.setPropStoreFieldValue("attachedActionClasses",s)});var g=Class.create(Kekule.Editor.ActionComposerSetIaController,p);return u&&i.push({name:u,actionClass:g,widgetClass:d}),g},Kekule.Editor.ActionComposerClientDragScrollController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerClientDragScrollController",Kekule.$L("ChemWidgetTexts.CAPTION_CLIENT_DRAGSCROLL"),Kekule.$L("ChemWidgetTexts.HINT_CLIENT_DRAGSCROLL"),"ClientDragScrollIaController",null,null,null,null,t.dragScroll),Kekule.Editor.ActionComposerSetManipulateControllerMarquee=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerMarquee",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_MARQUEE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_MARQUEE"),"SelectIaController","SelectIaController-Marquee",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.RECT},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.RECT)}},t.manipulateMarquee),Kekule.Editor.ActionComposerSetManipulateControllerLasso=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerLasso",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_LASSO"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_LASSO"),"SelectIaController","SelectIaController-Lasso",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.POLYGON},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.POLYGON)}},t.manipulateLasso),Kekule.Editor.ActionComposerSetManipulateControllerBrush=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerBrush",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_BRUSH"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_BRUSH"),"SelectIaController","SelectIaController-Brush",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.POLYLINE},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.POLYLINE)}},t.manipulateBrush),Kekule.Editor.ActionComposerSetManipulateControllerAncestor=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerAncestor",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_ANCESTOR"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_ANCESTOR"),"SelectIaController","SelectIaController-Ancestor",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.ANCESTOR},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.ANCESTOR)}},t.manipulateAncestor),Kekule.Editor.ActionComposerSetManipulateController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateController",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE"),"SelectIaController",null,null,[Kekule.Editor.ActionComposerSetManipulateControllerMarquee,Kekule.Editor.ActionComposerSetManipulateControllerLasso,Kekule.Editor.ActionComposerSetManipulateControllerBrush,Kekule.Editor.ActionComposerSetManipulateControllerAncestor,Kekule.Editor.ActionComposerClientDragScrollController,Kekule.Editor.ActionToggleSelectState],null,t.manipulate),Kekule.Editor.ActionComposerSetEraserController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetEraserController",Kekule.$L("ChemWidgetTexts.CAPTION_ERASE"),Kekule.$L("ChemWidgetTexts.HINT_ERASE"),"BasicMolEraserIaController",null,null,null,{doExecute:function(){this.tryApplySuper("doExecute");var e=this.getEditor();e.hasSelection()&&e.getActiveIaController().removeSelection()}},t.erase),Kekule.Editor.ActionComposerSetTrackController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTrackController",Kekule.$L("ChemWidgetTexts.CAPTION_TRACK_INPUT"),Kekule.$L("ChemWidgetTexts.HINT_TRACK_INPUT"),"TrackInputIaController",null,null,null,null,t.trackInput),Kekule.Editor.ActionComposerSetBondControllerSingle=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerSingle",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),"MolBondIaController","MolBondIaController-Single",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.NONE},null,null,t.molBondSingle),Kekule.Editor.ActionComposerSetBondControllerDouble=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDouble",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),"MolBondIaController","MolBondIaController-Double",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.NONE},null,null,t.molBondDouble),Kekule.Editor.ActionComposerSetBondControllerTriple=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerTriple",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),"MolBondIaController","MolBondIaController-Triple",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.TRIPLE,bondStereo:Kekule.BondStereo.NONE},null,null,t.molBondTriple),Kekule.Editor.ActionComposerSetBondControllerCloser=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerCloser",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),"MolBondIaController","MolBondIaController-Closer",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.CLOSER},null,null,t.molBondCloser),Kekule.Editor.ActionComposerSetBondControllerWedgeUp=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUp",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),"MolBondIaController","MolBondIaController-WedgeUp",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP},null,null,t.molBondWedgeUp),Kekule.Editor.ActionComposerSetBondControllerWedgeDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),"MolBondIaController","MolBondIaController-WedgeDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.DOWN},null,null,t.molBondWedgeDown),Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),"MolBondIaController","MolBondIaController-WedgeUpOrDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP_OR_DOWN},null,null,t.molBondWedgeUpOrDown),Kekule.Editor.ActionComposerSetBondControllerDoubleEither=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDoubleEither",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),"MolBondIaController","MolBondIaController-Double-Either",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.E_OR_Z},null,null,t.molBondDoubleEither),Kekule.Editor.ActionComposerSetRepositoryFischer1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer1",{repItemName:"fischer1"},null,null,t.molRepFischer1),Kekule.Editor.ActionComposerSetRepositoryFischer2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer2",{repItemName:"fischer2"},null,null,t.molRepFischer2),Kekule.Editor.ActionComposerSetRepositoryFischer3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER3"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer3",{repItemName:"fischer3"},null,null,t.molRepFischer3),Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_STAGGERED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_STAGGERED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseStaggered",{repItemName:"sawhorseStaggered"},null,null,t.molRepSawhorseStaggered),Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_ECLIPSED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_ECLIPSED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseEclipsed",{repItemName:"sawhorseEclipsed"},null,null,t.molRepSawhorseEclipsed),Kekule.Editor.ActionComposerSetRepositoryMethaneController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMethaneController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_METHANE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_METHANE"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Methane",{repItemName:"methane"},null,null,t.molRepMethane),Kekule.Editor.ActionComposerSetRepositorySubBondMarkController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySubBondMarkController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SUBBOND_MARK"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SUBBOND_MARK"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SubBondMark",{repItemName:"substituentMark"},null,null,t.molRepSubBondMark),Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FLEXCHAIN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FLEXCHAIN"),"MolFlexChainIaController","MolFlexChainIaController",null,null,null,t.molChain),Kekule.Editor.ActionComposerSetBondController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND"),"MolBondIaController",null,null,[Kekule.Editor.ActionComposerSetBondControllerSingle,Kekule.Editor.ActionComposerSetBondControllerDouble,Kekule.Editor.ActionComposerSetBondControllerTriple,Kekule.Editor.ActionComposerSetBondControllerWedgeUp,Kekule.Editor.ActionComposerSetBondControllerWedgeDown,Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController,Kekule.Editor.ActionComposerSetTrackController,Kekule.Editor.ActionComposerSetRepositoryFischer1Controller,Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController,Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController],null,t.molBond),Kekule.Editor.ActionComposerSetAtomController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM"),"MolAtomIaController",null,null,null,null,t.molAtom),Kekule.Editor.ActionComposerSetFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FORMULA"),"FormulaIaController",null,null,null,null,t.molFormula),Kekule.Editor.ActionComposerSetAtomAndFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomAndFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM_AND_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM_AND_FORMULA"),"MolAtomIaController",null,null,[Kekule.Editor.ActionComposerSetAtomController,Kekule.Editor.ActionComposerSetRepositoryMethaneController,Kekule.Editor.ActionComposerSetFormulaController],null,t.molAtomAndFormula),Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ELECTRON_LONEPAIR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ELECTRON_LONEPAIR"),"AttachedMarkerIaController","AttachedMarkerIaController-LonePair",{markerClassName:"Kekule.ChemMarker.UnbondedElectronSet",targetClassName:"Kekule.AbstractAtom",initialPropValues:{electronCount:2}},null,null,t.molElectronLonePair),Kekule.Editor.ActionComposerSetNodeChargeControllerClear=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerClear",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_CLEAR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_CLEAR"),"MolNodeChargeIaController","MolNodeChargeIaController-Clear",{charge:0,chargeInc:0,electronicBias:0,electronicBiasInc:0,radical:Kekule.RadicalOrder.NONE},null,null,t.molChargeClear),Kekule.Editor.ActionComposerSetNodeChargeControllerPositive=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerPositive",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_POSITIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_POSITIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Positive",{charge:null,chargeInc:1,electronicBias:0,electronicBiasInc:0,radical:Kekule.RadicalOrder.NONE},null,null,t.molChargePositive),Kekule.Editor.ActionComposerSetNodeChargeControllerNegative=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerNegative",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_NEGATIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_NEGATIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Negative",{charge:null,chargeInc:-1,electronicBias:0,electronicBiasInc:0,radical:Kekule.RadicalOrder.NONE},null,null,t.molChargeNegative),Kekule.Editor.ActionComposerSetNodeElectronicBiasControllerPositive=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeElectronicBiasControllerPositive",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ELECTRONIC_BIAS_POSITIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ELECTRONIC_BIAS_POSITIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-ElectronicBiasPositive",{charge:0,chargeInc:0,electronicBias:null,electronicBiasInc:1,radical:Kekule.RadicalOrder.NONE},null,null,t.molElectronicBiasPositive),Kekule.Editor.ActionComposerSetNodeElectronicBiasControllerNegative=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeElectronicBiasControllerNegative",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ELECTRONIC_BIAS_NEGATIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ELECTRONIC_BIAS_NEGATIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-ElectronicBiasNegative",{charge:0,chargeInc:0,electronicBias:null,electronicBiasInc:-1,radical:Kekule.RadicalOrder.NONE},null,null,t.molElectronicBiasNegative),Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_SINGLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_SINGLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Singlet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.SINGLET},null,null,t.molRadicalSinglet),Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_TRIPLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_TRIPLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Triplet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.TRIPLET},null,null,t.molRadicalTriplet),Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_DOUBLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_DOUBLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Doublet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.DOUBLET},null,null,t.molRadicalDoublet),Kekule.Editor.ActionComposerSetNodeChargeController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE"),"MolNodeChargeIaController",null,null,[Kekule.Editor.ActionComposerSetNodeChargeControllerClear,Kekule.Editor.ActionComposerSetNodeChargeControllerPositive,Kekule.Editor.ActionComposerSetNodeChargeControllerNegative,Kekule.Editor.ActionComposerSetNodeElectronicBiasControllerPositive,Kekule.Editor.ActionComposerSetNodeElectronicBiasControllerNegative,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet,Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair],null,t.molCharge),Kekule.Editor.ActionComposerSetTextBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_BLOCK"),"TextBlockIaController",null,null,null,null,t.textBlock),Kekule.Editor.ActionComposerSetImageBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetImageBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_IMAGE_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_IMAGE_BLOCK"),"ImageBlockIaController",null,null,null,null,t.imageBlock),Kekule.Editor.ActionComposerSetTextImageController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextImageController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_IMAGE"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_IMAGE"),"TextImageIaController","TextImageIaController",null,[Kekule.Editor.ActionComposerSetTextBlockController,Kekule.Editor.ActionComposerSetImageBlockController],null,t.textImage),Kekule.Editor.ActionComposerSetRepositoryRing3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_3"),"MolRingIaController","MolRingIaController-3",{ringAtomCount:3,isAromatic:!1},null,null,t.molRing3),Kekule.Editor.ActionComposerSetRepositoryRing4Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing4Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_4"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_4"),"MolRingIaController","MolRingIaController-4",{ringAtomCount:4,isAromatic:!1},null,null,t.molRing4),Kekule.Editor.ActionComposerSetRepositoryRing5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_5"),"MolRingIaController","MolRingIaController-5",{ringAtomCount:5,isAromatic:!1},null,null,t.molRing5),Kekule.Editor.ActionComposerSetRepositoryRing6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_6"),"MolRingIaController","MolRingIaController-6",{ringAtomCount:6,isAromatic:!1},null,null,t.molRing6),Kekule.Editor.ActionComposerSetRepositoryRing7Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing7Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_7"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_7"),"MolRingIaController","MolRingIaController-7",{ringAtomCount:7,isAromatic:!1},null,null,t.molRing7),Kekule.Editor.ActionComposerSetRepositoryRing8Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing8Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_8"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_8"),"MolRingIaController","MolRingIaController-8",{ringAtomCount:8,isAromatic:!1},null,null,t.molRing8),Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_6"),"MolRingIaController","MolRingIaController-Ar-6",{ringAtomCount:6,isAromatic:!0},null,null,t.molRingAr6),Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_5"),"MolRingIaController","MolRingIaController-Ar-5",{ringAtomCount:5,isAromatic:!0},null,null,t.molRingAr5),Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FLEXRING"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FLEXRING"),"MolFlexRingIaController","MolFlexRingIaController",null,null,null,t.molFlexRing),Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth1",{repItemName:"cyclopentaneHaworth1"},null,null,t.molRepCyclopentaneHaworth1),Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth2",{repItemName:"cyclopentaneHaworth2"},null,null,t.molRepCyclopentaneHaworth2),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth1",{repItemName:"cyclohexaneHaworth1"},null,null,t.molRepCyclohexaneHaworth1),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth2",{repItemName:"cyclohexaneHaworth2"},null,null,t.molRepCyclohexaneHaworth2),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair1",{repItemName:"cyclohexaneChair1"},null,null,t.molRepCyclohexaneChair1),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair2",{repItemName:"cyclohexaneChair2"},null,null,t.molRepCyclohexaneChair2),Kekule.Editor.ActionComposerSetRepositoryRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING"),"MolRingIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryRing3Controller,Kekule.Editor.ActionComposerSetRepositoryRing4Controller,Kekule.Editor.ActionComposerSetRepositoryRing5Controller,Kekule.Editor.ActionComposerSetRepositoryRing6Controller,Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController,Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller,Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller],null,t.molRing,void 0,{defaultAttachedActionClass:Kekule.Editor.ActionComposerSetRepositoryRing6Controller}),Kekule.Editor.ActionComposerSetRepositoryPathLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathGlyphLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:null,lineLength:1.5},null,null,t.glyphRepLine),Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepOpenArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-TriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepTriangleArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiOpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowWidth:.25,startArrowLength:.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepDiOpenArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiTriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.TRIANGLE,startArrowWidth:.25,startArrowLength:.25,endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepDiTriangleArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_REV_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-ReversibleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowSide:Kekule.Glyph.ArrowSide.REVERSED,startArrowWidth:.25,startArrowLength:.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowSide:Kekule.Glyph.ArrowSide.SINGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1,lineCount:2}},null,null,t.glyphRepReversibleArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowDiLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1,lineCount:2}},null,null,t.glyphRepOpenArrowDiLine),Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowArcController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowArcController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC"),"ArrowLineIaController","ArrowLineIaController-OpenArrowArc",{glyphClass:Kekule.Glyph.BaseArc,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphRepOpenArrowArc),Kekule.Editor.ActionComposerSetRepositoryPathSingleSideOpenArrowArcController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathSingleSideOpenArrowArcController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC"),"ArrowLineIaController","ArrowLineIaController-SingleSideOpenArrowArc",{glyphClass:Kekule.Glyph.BaseArc,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowSide:Kekule.Glyph.ArrowSide.REVERSED,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphRepSingleSideOpenArrowArc),Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_HEAT_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_HEAT_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-HeatSymbol",{glyphClass:Kekule.Glyph.HeatSymbol,glyphInitialParams:{lineLength:1}},null,null,t.glyphRepHeatSymbol),Kekule.Editor.ActionComposerSetRepositoryAddSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryAddSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ADD_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ADD_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-AddSymbol",{glyphClass:Kekule.Glyph.AddSymbol,glyphInitialParams:{lineLength:1}},null,null,t.glyphRepAddSymbol),Kekule.Editor.ActionComposerSetRepositoryLineSegmentController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryLineSegmentController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:Kekule.Glyph.Segment,glyphInitialParams:{startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphRepSegment),Kekule.Editor.ActionComposerSetRepositoryNormalReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryNormalReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_NORMAL"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_NORMAL"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowNormal",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionArrowType:Kekule.Glyph.ReactionArrowType.NORMAL,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowNormal),Kekule.Editor.ActionComposerSetRepositoryReversibleReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryReversibleReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_REVERSIBLE"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_REVERSIBLE"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowReversible",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionType:Kekule.Glyph.ReactionArrowType.REVERSIBLE,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowReversible),Kekule.Editor.ActionComposerSetRepositoryResonanceReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryResonanceReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_RESONANCE"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_RESONANCE"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowResonance",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionType:Kekule.Glyph.ReactionArrowType.RESONANCE,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowResonance),Kekule.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_RETROSYNTHESIS"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_RETROSYNTHESIS"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowRetrosynthesis",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionType:Kekule.Glyph.ReactionArrowType.RETROSYNTHESIS,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowRetrosynthesis),Kekule.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_2"),Kekule.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_2"),"ArrowLineIaController","ArrowLineIaController-ElectronPushingArrowDouble",{glyphClass:Kekule.Glyph.ElectronPushingArrow,glyphInitialParams:{electronCount:2,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphElectronPushingArrowDouble),Kekule.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_1"),Kekule.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_1"),"ArrowLineIaController","ArrowLineIaController-ElectronPushingArrowSingle",{glyphClass:Kekule.Glyph.ElectronPushingArrow,glyphInitialParams:{electronCount:1,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphElectronPushingArrowSingle),Kekule.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1"),Kekule.$L("ChemWidgetTexts.HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1"),"ArrowLineIaController","ArrowLineIaController-BondFormingElectronPushingArrowSingle",{glyphClass:Kekule.Glyph.BondFormingElectronPushingArrow,glyphInitialParams:{endArrowWidth:.25,endArrowLength:.25,lineLength:1,pathEndGap:.1,lineCount:1}},null,null,t.glyphElectronPushingArrowBondForming),Kekule.Editor.ActionComposerSetRepositoryGlyphController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryGlyphController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ARROWLINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ARROWLINE"),"ArrowLineIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryNormalReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryReversibleReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryResonanceReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryLineSegmentController,Kekule.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController,Kekule.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController,Kekule.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController,Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController,Kekule.Editor.ActionComposerSetRepositoryAddSymbolController],null,t.glyph),Kekule._registerAfterLoadSysProc(function(){var e=Kekule.ActionManager,r=Kekule.ChemWidget,o=Kekule.Editor,a=Kekule.Editor.ChemSpaceEditor,s=e.registerNamedActionClass;s(t.newDoc,o.ActionEditorNewDoc,a),s(t.loadFile,r.ActionDisplayerLoadFile,a),s(t.loadData,o.ActionEditorLoadData,a),s(t.saveData,r.ActionDisplayerSaveFile,a),s(t.zoomIn,r.ActionDisplayerZoomIn,a),s(t.zoomOut,r.ActionDisplayerZoomOut,a),s(t.resetZoom,r.ActionDisplayerResetZoom,a),s(t.reset,r.ActionDisplayerReset,a),s(t.config,Kekule.Widget.ActionOpenConfigWidget,a),s(t.undo,o.ActionEditorUndo,a),s(t.redo,o.ActionEditorRedo,a),s(t.selectAll,o.ActionSelectAll,a),s(t.cloneSelection,o.ActionCloneSelection,a),s(t.copy,o.ActionCopySelection,a),s(t.cut,o.ActionCutSelection,a),s(t.paste,o.ActionPaste,a),s(t.toggleSelect,o.ActionToggleSelectState,a),s(t.eraseSelection,o.ActionEraseSelection,a),s(t.recheckIssues,o.ActionRecheckIssues,a),s(t.toggleShowAllIssues,o.ActionToggleShowIssueMarkers,a),s(t.objInspector,o.ActionComposerToggleObjInspector,a),s(t.issueInspector,o.ActionComposerToggleIssueInspector,a),n();for(var l=0,u=i.length;l<u;++l){var d=i[l];s(d.name,d.actionClass,d.widgetClass||a)}})}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.CoordUtils;Kekule.Editor.PointerTrackConstraint={NONE:0,LEADING:1,BOTH:2,CIRCLE:5},Kekule.Editor.TrackParser=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackParser",simplifyCurveToLineSegments:function(e,t){return Kekule.GeometryUtils.simplifyCurveToLineSegments(e,t)},addLineCrossPoints:function(e){for(var t=[],r=e.length,i=0;i<r-1;++i)for(var n={coord1:e[i],coord2:e[i+1]},o=i+2;o<r-1;++o){var a={coord1:e[o],coord2:e[o+1]},s=Kekule.GeometryUtils.getCrossPointOfLines(n.coord1,n.coord2,a.coord1,a.coord2);s&&(this._addInsertedPoint(i,s,t),this._addInsertedPoint(o,s,t))}for(i=0;i<r-1;++i)t[i]&&this._sortInsertedPointsInLine(t[i],e[i],e[i+1]);var l=[];for(i=0;i<r-1;++i)if(l.push(e[i]),t[i]){o=0;for(var u=t[i].length;o<u;++o)l.push(t[i][o])}return l.push(e[r-1]),l},addVertexToLineMergePoint:function(e,t){if(t<=0)return e;for(var r=e.length,i=[],n=0;n<r-1;++n)for(var o=e[n],a=0;a<r-1;++a)if(a<n-1||a>n+1){var s=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(o,e[a],e[a+1],!1);if(s)Kekule.CoordUtils.getDistance(o,s)<=t&&(o.x=s.x,o.y=s.y,this._addInsertedPoint(a,o,i))}var l=[];for(n=0;n<r-1;++n)if(l.push(e[n]),i[n]){this._sortInsertedPointsInLine(i[n],e[n],e[n+1]);a=0;for(var u=i[n].length;a<u;++a)l.push(i[n][a])}return l.push(e[r-1]),l},_addInsertedPoint:function(e,t,r){r[e]||(r[e]=[]),r[e].push(t)},_sortInsertedPointsInLine:function(e,t,r){if(e){var i=r.x-t.x,n=r.y-t.y;e.sort(function(e,t){return Math.abs(n)>Math.abs(i)?-(t.y-e.y)*n:-(t.x-e.x)*i})}},mergeNearbyTrackPoints:function(e,r){if(r<=0)return e;for(var i=e.length,n=e.concat([]),o=0;o<i;++o){var a=n[o];if(!a.__$merge_handled__)for(var s=o+1;s<i;++s){var l=n[s];if(!l.__$merge_handled__){var u=a.__$merge_weight__||1,d=l.__$merge_weight__||1;if(Kekule.CoordUtils.getDistance(a,l)<=r){var c,h=u+d;a.__$merge_weight__=h,a.boundObj?c=a:l.boundObj?(c=l,a.boundObj=l.boundObj):(c=1===u?a:t.multiply(a,u),c=t.add(c,1===d?l:t.multiply(l,d)),c=t.divide(c,h)),a.x=c.x,a.y=c.y,n.splice(s,1,a)}}}a.__$merge_handled__=!0}return n},mergeCloseVertexes:function(e,t){return(t=t||this.getVertexMergeRadius())<=0?e:this._doMergeCloseVertexes(e,t)},_doMergeCloseVertexes:function(e,t){for(var r=e.getVertexes(),i=r.length,n=!1,o=0;o<i;++o){for(var a=r[o],s=r[o].getData("coord"),l=o+1;l<i;++l){var u=r[l],d=u.getData("coord");if(Kekule.CoordUtils.getDistance(s,d)<=t){this._doMergeVertex(e,a,u),n=!0;break}}if(n)break}return n?this._doMergeCloseVertexes(e,t):e},_doMergeVertex:function(r,i,n){for(var o=i.getData("coord"),a=i.getData("weight")||1,s=n.getData("coord"),l=n.getData("weight")||1,u=e.clone(n.getEdges()),d=0,c=u.length;d<c;++d){u[d].replaceVertex(n,i)}r.removeVertex(n);var h=1===a?o:t.multiply(o,a);h+=1===l?s:t.multiply(s,l),h=t.divide(h,a+l),i.setData("coord",h)},removeRepetitivePoints:function(e){for(var t=[],r=null,i=0,n=e.length;i<n;++i)e[i]!==r&&(t.push(e[i]),r=e[i]);return t},refineTrack:function(e,t,r){var i=this.simplifyCurveToLineSegments(e,t);return i=this.addLineCrossPoints(i),i=this.addVertexToLineMergePoint(i,r),i=this.mergeNearbyTrackPoints(i,r),i=this.removeRepetitivePoints(i)},convertTrackToStructure:function(e,t,r,i){if(!t||!t.length)return null;var n=t.length;if(n<2)return null;for(var o,a=i||new Kekule.StructureFragment,s=0;s<n;++s){var l=t[s],u=l.__$structure_node__;if(u||((u=new Kekule.Atom).setIsotopeId(r),e.setObjectScreenCoord(u,l),l.__$structure_node__=u,a.appendNode(u)),o&&o!==u&&!u.getConnectorTo(o)){var d=new Kekule.Bond(null,[o,u]);d.setBondOrder(1),a.appendConnector(d)}o=u}return a},convertLinesToGraph:function(e){if(e&&e.length){for(var t,r=new Kekule.Graph,i=e.length,n=0;n<i;++n){var o,a=e[n];if((o=a.__$graph_vertex__)||((o=new Kekule.GraphVertex).setData("coord",a),a.__$graph_vertex__=o,r.addVertex(o)),t&&!o.getEdgeTo(t)){var s=new Kekule.GraphEdge;r.addEdge(s,t,o)}t=o}return r}return null}}),Kekule.Editor.TrackLayoutOptimizer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackLayoutOptimizer",OPTIMIZED_COORD_FIELD:"__$optimizedCoord__",COORD_INDEX_FIELD:"__$coordIndex__",RING_END_INDEX_FIELD:"__$ringEndIndex__",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){},initPropValues:function(){this.tryApplySuper("initPropValues")},splitTrackByRings:function(e){for(var t=[],r=function(e,r){for(var i=0,n=t.length;i<n;++i){var o=t[i];if(!(o.startIndex>r||o.endIndex<e))return!1}return!0},i=0,n=e.length;i<n;++i){var o=e[i];if(void 0===o[this.COORD_INDEX_FIELD])o[this.COORD_INDEX_FIELD]=i;else{var a=o[this.COORD_INDEX_FIELD],s=i;o[this.RING_END_INDEX_FIELD]=s,r(a,s)&&t.push({startIndex:a,endIndex:s})}}var l=[],u=t.length;if(u>0){var d=0;for(i=0;i<u;++i){var c=t[i];c.startIndex>d&&l.push({track:e.slice(d,c.startIndex+1),isRing:!1}),l.push({track:e.slice(c.startIndex,c.endIndex+1),isRing:!0}),d=c.endIndex}return d<e.length-1&&l.push({track:e.slice(d,e.length),isRing:!1}),l}return[{track:e,isRing:!1}]},optimize:function(t,r){var i,n=t,o=Kekule.Editor.PointerTrackConstraint,a=t[0],s=a.boundObj,l=t[t.length-1],u=l.boundObj;s&&u?i=s===u?o.CIRCLE:o.BOTH:s||u?(i=o.LEADING,u&&(n=e.reverse(t))):i=a===l?o.CIRCLE:o.LEADING;var d=Object.extend({},r);return d.preferredStartingAngles=r.preferredStartingAngles||[0],d.segmentsInfo=this._calcTrackSegmentsInfo(n),d.distanceMedian=e.getMedian(d.segmentsInfo.distances),i===o.CIRCLE?this.doOptimizeOnCircleConstraint(n,d):i===o.BOTH?this.doOptimizeOnBothConstraint(n,d):this.doOptimizeOnLeadingConstraint(n,d)},_calcTrackSegmentsInfo:function(e){for(var r=[],i=[],n=0,o=e.length;n<o-1;++n){var a=e[n],s=e[n+1],l=t.getDistance(a,s),u=t.substract(s,a),d=Math.atan2(u.y,u.x);r.push(l),i.push(d)}return{distances:r,angles:i}},doOptimizeOnLeadingConstraint:function(e,r,i){var n=Kekule.GeometryUtils,o=[];if(i){Kekule.Editor.PointerTrackConstraint;var a,s=this.splitTrackByRings(e);if(1===s.length)return s[l].isRing?this.doOptimizeOnCircleConstraint(d,r,!0):this.doOptimizeOnLeadingConstraint(d,r,!0);for(var l=0,u=s.length;l<u;++l){var d=s[l].track,c=s[l].isRing?this.doOptimizeOnCircleConstraint(d,r,!0):this.doOptimizeOnLeadingConstraint(d,r,!0);if(a){for(var h=c[0],p=t.substract(a,h),g=0,f=c.length;g<f;++g)c[g]=t.add(c[g],p);a=c[c.length-1],c.shift(),o=o.concat(c)}else a=c[c.length-1],o=o.concat(c)}return o}var C,m=r.preferredStartingAngles;o.push(e[0]);for(r.preferredIncludeAngle,r.preferredIncludeAngle,l=1,u=e.length;l<u;++l)if(e[l][this.OPTIMIZED_COORD_FIELD])o.push(e[l][this.OPTIMIZED_COORD_FIELD]);else{var T,E=e[l-1],_=o[l-1],S=e[l],O=(p=t.substract(S,E),t.getDistance(E,S)),y=this._optimizeLineSegmentDistance(O,r),A=Math.atan2(p.y,p.x);C=T=this._optimizeDirectionAngle(A,m,r,C);var I=Math.PI-r.preferredIncludeAngle,k=(m=[n.standardizeAngle(T-I),n.standardizeAngle(T+I)],{x:y*Math.cos(T),y:y*Math.sin(T)}),b=t.add(_,k);o.push(b),e[l][this.OPTIMIZED_COORD_FIELD]=b}return o},doOptimizeOnBothConstraint:function(e,r,i){var n=e.length,o=this.doOptimizeOnLeadingConstraint(e,r,i),a=o[n-1],s=e[n-1],l=e[0],u=t.substract(s,l),d=Math.atan2(u.y,u.x),c=t.substract(a,l),h=Math.atan2(c.y,c.x),p=t.getDistance(u)/t.getDistance(c);if(p<=2){var g=t.calcTransform2DMatrix({rotateAngle:-h,center:l}),f=t.calcTransform2DMatrix({scale:p,center:l}),C=t.calcTransform2DMatrix({rotateAngle:d,center:l}),m=Kekule.MatrixUtils.multiply(g,f);m=Kekule.MatrixUtils.multiply(m,C);for(var T=[o[0]],E=1;E<n-1;++E)T.push(t.transform2DByMatrix(o[E],m));T.push(e[n-1])}else{var _=t.divide(t.substract(s,a),n-1),S=(T=[o[0]],{x:0,y:0});for(E=0;E<n-1;++E)S=t.add(S,_),T.push(t.add(o[E],S));T.push(e[n-1])}return T},doOptimizeOnCircleConstraint:function(e,r,i){var n=e.length-1,o=Object.create(r);if(n<=8){var a=(1-2/n)*Math.PI;(o=Object.create(r)).preferredIncludeAngle=a}for(var s=e.length,l=this.doOptimizeOnLeadingConstraint(e,o,i),u=l[s-1],d=e[s-1],c=t.divide(t.substract(d,u),s-1),h=[l[0]],p={x:0,y:0},g=1;g<s-1;++g)p=t.add(p,c),h.push(t.add(l[g],p));return h.push(e[s-1]),h},_optimizeIncludeAngle:function(e,t,r){return this._optimizeDirectionAngle(e,t,r)},_optimizeDirectionAngle:function(e,t,r,i){var n=Kekule.GeometryUtils,o=null,a=null;if(t&&t.length){for(var s=null,l=0,u=t.length;l<u;++l){var d=Math.abs(n.standardizeAngle(e)-t[l]);(null===s||d<s)&&(a=t[l],s=d)}s<=Math.PI/6&&(o=a)}if(null===o){var c=r.angleConstraint;if(!c)return e;null===a&&(a=0);d=e-a;if(o=a+Math.round(d/c)*c,i){var h=5*Math.PI/180,p=Math.abs(n.standardizeAngle(o-i,-Math.PI));if(Kekule.NumUtils.isFloatEqual(p,0,h)||Kekule.NumUtils.isFloatEqual(p,Math.PI,h)){var g=o+c,f=o-c;o=Math.abs(e-g)<Math.abs(e-f)?g:f}}}return o},_optimizeLineSegmentDistance:function(e,t){var r=t.defBondScreenLength,i=t.distanceConstraints||[];if(!i)return e;if(e>i[i.length-1]*r)return Math.round(e/r)*r;var n,o=t.primaryDistanceConstraint,a=i.length,s=i.indexOf(o);s<0&&(s=0);for(var l=a-1;l>=s;--l){var u=i[l];if(e>(n=u*r))return n}for(l=0;l<=s;++l)if(e<(n=u*r))return n;return n}}),Kekule.Editor.TrackInputIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.TrackInputIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._isTracking=!1,this._trackCoordToObjBindings=null,this._trackParser=new Kekule.Editor.TrackParser,this._trackLayoutOptimizer=new Kekule.Editor.TrackLayoutOptimizer,this._addStructureOperation=null,this._editorScaled=!1,this._editorOriginalZoomLevel=1,this._lastRenderedMarkerCoord=null,this._debugMarkers={}},doFinalize:function(){this._trackLayoutOptimizer.finalize(),this._trackParser.finalize();var e=this.getPropStoreFieldValue("trackMarker");e&&e.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("trackMarker",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("trackMarker");return e||(e=new Kekule.ChemWidget.MetaShapeUIMarker({shapeType:Kekule.Render.MetaShapeType.POLYLINE,coords:[]}),this.setPropStoreFieldValue("trackMarker",e)),e}})},initPropValues:function(){this.tryApplySuper("initPropValues")},getEditorUiMarkers:function(){return this.getEditor().getUiMarkers()},refineTrackCoords:function(e){var r=this.getEditor(),i=this.getEditorConfigs(),n={angleConstraint:i.getInteractionConfigs().getTrackOptimizationAngleConstraint(),distanceConstraints:i.getInteractionConfigs().getTrackOptimizationDistanceConstraints(),primaryDistanceConstraint:i.getInteractionConfigs().getTrackOptimizationPrimaryDistanceConstraint(),preferredIncludeAngle:2*Math.PI/3},o=r.getDefBondLength?r.getDefBondLength():i.getStructureConfigs().getDefBondLength(),a=r.objCoordToScreen({x:0,y:0}),s=r.objCoordToScreen({x:o,y:0}),l=t.getDistance(a,s);n.defBondScreenLength=l;for(var u=this.getEditorConfigs().getInteractionConfigs().getTrackSimplifierDistanceThreshold(),d=this.getEditorConfigs().getInteractionConfigs().getTrackMergeDistanceThreshold(),c=this._mergeCoordsToBoundNodesAndSplitTrack(e),h=[],p=0,g=c.length;p<g;++p){var f=c[p],C=(f=this._trackParser.refineTrack(f,u,d))[0].obj||f[f.length-1].obj,m=C?i.getStructureConfigs.getNewBondDefAngle(C,1):-Math.PI/6;n.preferredStartingAngles=[m],f=this._trackLayoutOptimizer.optimize(f,n),h.push(f)}return h},_mergeCoordsToBoundNodesAndSplitTrack:function(e){var t=this._trackCoordToObjBindings,r=t.length;if(r){for(var i=this.getEditor(),n=[],o=t[0].obj,a=t[0].coordIndex,s=0,l=1;l<=r;++l){var u=t[l];if(l<r&&u&&(o!==u.obj||u.coordIndex-a>10)||l===r){a>s&&n.push(e.slice(s,a));var d=i.getObjectScreenCoord(o);d.boundObj=o,s=t[l-1].coordIndex+1,n.push([d]),l!==r&&(o=u.obj,a=u.coordIndex)}}e.length-1>t[r-1].coordIndex&&n.push(e.slice(t[r-1].coordIndex));for(var c=[],h=[],p=(l=0,n.length);l<p;++l){var g=n[l];c=c.concat(g),l===p-1?h.push(c):g[0].boundObj&&l>0&&(h.push(c),c=g)}return h}return[e]},convertTracksToStructure:function(e,t){var r=new Kekule.Molecule;r.setCoord2D({x:0,y:0});for(var i=this.getEditor(),n=0,o=e.length;n<o;++n)this._trackParser.convertTrackToStructure(i,e[n],t,r);return r.getNodeCount()<2?null:r},getStructureSelectableChildren:function(e){return[].concat(e.getNodes()).concat(e.getConnectors())},addStructureToEditor:function(e){var t=this.getEditor();this._addStructureOperation=null,t.beginUpdateObject();try{var r,i=t.getChemSpace();this._targetMol?(r=new Kekule.ChemStructOperation.MergeStructFragment(e,this._targetMol,t),this._targetMol=null):r=new Kekule.ChemObjOperation.Add(e,i,null,t),r.execute(),this._addStructureOperation=r}finally{t.endUpdateObject()}},getTrackCoords:function(){return this.getTrackMarker().getShapeInfo().coords},clearTrackCoords:function(){this.getTrackMarker().getShapeInfo().coords=[]},startTracking:function(e,t){this._targetMol=null;var r=this.getEditor(),i=this._getMergeDestObjAtCoord(t);if(!r.canCreateNewChild()&&!i){if(!r.canAddUnconnectedStructFragment())return null;var n=r.getOnlyOneBlankStructFragment();this._targetMol=n}this._isTracking=!0,this._trackCoordToObjBindings=[],this.setManuallyHotTrack(!0),this.clearTrackCoords();var o=this.getTrackMarker();this.getEditorUiMarkers().addMarker(o);var a=this.getEditorConfigs().getUiMarkerConfigs(),s={strokeColor:a.getTrackMarkerStrokeColor(),strokeWidth:a.getTrackMarkerStrokeWidth(),strokeDash:a.getTrackMarkerStrokeDash(),opacity:a.getTrackMarkerOpacity()};if(o.setDrawStyles(s),o.setVisible(!0),this.addTrackCoord(t,!1),this.getEditorConfigs().getInteractionConfigs().getAutoAdjustZoomLevelOnTrackTouching()){r=this.getEditor();var l=this.getEditorConfigs().getInteractionConfigs().getTrackTouchRefLength();if(l){var u=r.getDocument(),d=r.getDefBondScreenLength(),c=Kekule.DocumentUtils.getDevicePPI(u)*l/Kekule.DocumentUtils.getClientScaleLevel(u)/d;if(c>.9){var h=r.getCurrZoom();r.setZoomCenter(t),r.zoomTo(h*c);var p=this._getEventMouseCoord(e),g=this.getTrackCoords(),f=g[g.length-1];t=p,Object.extend(f,p),this._editorScaled=!0,this._editorOriginalZoomLevel=h,this._autoScaleStartCoord=p}else this._editorScaled=!1,this._editorOriginalZoomLevel=null}}this.repaintMarker(),this._lastRenderedMarkerCoord=t},endTracking:function(e){var t=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId()||"C";this._isTracking=!1,this.addTrackCoord(e);var r=this.refineTrackCoords(this.getTrackCoords());if(r.length){var i=this.convertTracksToStructure(r,t);if(i){this.addStructureToEditor(i),this.startDirectManipulate(null,i,e),this.moveManipulatedObjs(e),this.manipulateBeforeStopping(),this.stopManipulate();var n=this.getStructureSelectableChildren(i);this.doneInsertOrModifyBasicObjects(n)}}this.doneTracking()},cancelTracking:function(){this._isTracking=!1,this.getEditorUiMarkers().removeMarker(this.getTrackMarker()),this.doneTracking()},doneTracking:function(){if(this._editorScaled){var e=this.getTrackCoords();e[e.length-1];this._editorScaled=!1,this.getEditor().zoomTo(this._editorOriginalZoomLevel,null,this._autoScaleStartCoord),this._editorOriginalZoomLevel=null,this._autoScaleStartCoord=null}this.setManuallyHotTrack(!1),this.getEditor().hideHotTrack(),this.clearTrackCoords(),this.repaintMarker()},_getMergeDestObjAtCoord:function(e){for(var t=this.getEditor().getBasicObjectsAtCoord(e,this.getCurrBoundInflation()),r=0,i=t.length;r<i;++r){var n=t[r];if(this.isValidMergeDestObj(n))return n}return null},addTrackCoord:function(e,t){var r=this.getTrackCoords(),i=r&&r[r.length-1];if(!i||!Kekule.CoordUtils.isEqual(e,i)){var n=this._getMergeDestObjAtCoord(e);if(n&&(this._trackCoordToObjBindings.push({coord:e,obj:n,coordIndex:this.getTrackCoords().length}),this.getEditor().addHotTrackedObj(n)),r.push(e),!t)this._lastRenderedMarkerCoord?Kekule.CoordUtils.getDistance(this._lastRenderedMarkerCoord,e)>5&&(this.repaintMarker(),this._lastRenderedMarkerCoord=e):(this.repaintMarker(),this._lastRenderedMarkerCoord=e)}},repaintMarker:function(){this.getEditor().repaintUiMarker()},isValidMergeDestObj:function(e){return e instanceof Kekule.ChemStructureNode},canInteractWithObj:function(e){return e instanceof Kekule.ChemStructureNode},getAllObjOperations:function(e){var t=this.tryApplySuper("getAllObjOperations",[e])||[],r=this._addStructureOperation;return r&&t.unshift(r),t},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===Kekule.X.Event.MouseButton.LEFT){var t=this._getEventMouseCoord(e);return this.startTracking(e,t),e.preventDefault(),!0}if(e.getButton()===Kekule.X.Event.MouseButton.RIGHT)return this.cancelTracking(),e.preventDefault(),!0},react_pointerup:function(e){if(e.getButton()===Kekule.X.Event.MouseButton.LEFT){if(this._isTracking){var t=this._getEventMouseCoord(e);this.endTracking(t),this.addOperationToEditor()}return this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),e.preventDefault(),!0}},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this._isTracking){var t=this._getEventMouseCoord(e);return this.addTrackCoord(t),e.preventDefault(),!0}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.TrackInputIaController,Kekule.Editor.ChemSpaceEditor)}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.Editor,Kekule.Widget.HtmlClassNames,Kekule.ChemWidget.HtmlClassNames,Kekule.ChemWidget.ComponentWidgetNames;Kekule.Editor.ObjModifier={},Kekule.Editor.ObjModifier.Category={GENERAL:"general",CHEM_STRUCTURE:"chemStruct",GLYPH:"glyph",STYLE:"style",MISC:"misc"},Kekule.Editor.ObjModifier.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.ObjModifier.Base",initialize:function(e){this.tryApplySuper("initialize"),this.setEditor(e),this.modifierWidgetValueChangedBind=this.modifierWidgetValueChanged.bind(this)},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1}),this.defineProp("targetObjs",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getEditor().getSelection()}}),this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("widget");return e||(e=this.createWidget(),this.setPropStoreFieldValue("widget",e)),e}})},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getModifierName:function(){return this.getClassLocalName().toLowerCase()},createWidget:function(){var e=this.doCreateWidget();return e&&this.installValueChangeEventHandler(e),e},doCreateWidget:function(){return null},installValueChangeEventHandler:function(e){e.on("valueChange",this.modifierWidgetValueChangedBind)},modifierWidgetValueChanged:function(){this.applyToTargets()},loadFromTargets:function(){var e=this.getEditor();if(e){var t=this.getTargetObjs();t&&this.doLoadFromTargets(e,t)}return this},doLoadFromTargets:function(e,t){},applyToTargets:function(){var e=this.getEditor();if(e){var t=this.getTargetObjs();t&&this.doApplyToTargets(e,t)}return this},doApplyToTargets:function(e,t){var r=this.createModificationOper();r&&e.execOperation(r)},createModificationOper:function(e){var t=[];if(e&&e.length)for(var r=0,i=e.length;r<i;++r){var n=this.createModificationOperOnTarget(e[r]);n&&t.push(n)}var o=t.length;return o<=0?null:1===o?t[0]:new Kekule.MacroOperation(t)},createModificationOperOnTarget:function(e){var t=this.getModifiedPropValues();return t?this.createModificationOperation(e,t):null},getModifiedPropValues:function(){return null},createModificationOperation:function(e,t){return new Kekule.ChemObjOperation.Modify(e,t,this.getEditor())}}),Kekule.Editor.ObjModifierManager={_modifierMap:new Kekule.MapEx(!0),register:function(r,i){if(i&&r)for(var n=e.toArray(i),o=e.toArray(r),a=0,s=o.length;a<s;++a){var l=o[a],u=t._modifierMap.get(l);u?e.pushUnique(u,n):(u=n,t._modifierMap.set(l,u))}},unregister:function(r){if(r)for(var i=e.toArray(r),n=t._modifierMap.getKeys(),o=0,a=n.length;o<a;++o){var s=t._modifierMap.get(n[o]);s&&s.length&&t._modifierMap.set(n[o],e.exclude(s,i))}},getModifierCategories:function(r){var i=r.getCategories&&r.getCategories()||[],n=ClassEx.getSuperClass(r);return n&&e.pushUnique(i,t.getModifierCategories(n)),i},getModifierClasses:function(r,i){var n=t._modifierMap.get(r)||[],o=ClassEx.getSuperClass(r);if(o&&e.pushUnique(n,t.getModifierClasses(o,i)),i&&i.length){var a=n;n=[];for(var s=0,l=a.length;s<l;++s){var u=t.getModifierCategories(a[s]);e.intersect(u,i).length&&n.push(a[s])}}return n}};var t=Kekule.Editor.ObjModifierManager}(),function(){"use strict";Kekule.ArrayUtils,Kekule.Editor;var e=Kekule.Widget.HtmlClassNames,t=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ComponentWidgetNames;Kekule.Editor.ObjModifier.BaseRenderOptionModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.BaseRenderOptionModifier",getRenderOptionValue:function(e,t,r){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(e,t,r)}}),Kekule.Editor.ObjModifier.BaseRenderOptionModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.STYLE]},Kekule.Editor.ObjModifier.Color=Class.create(Kekule.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Color",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:Kekule.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:e.COLORPICKER_SPEC_COLOR_MIXED},initProperties:function(){this.defineProp("colorBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new Kekule.Widget.ColorDropButton(this.getEditor());return e.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR")),e.setShowText(!1),e.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]),e.addClassName(t.COMPOSER_COLOR_BOX),this.setPropStoreFieldValue("colorBox",e),e},doLoadFromTargets:function(e,t){if(t&&t.length){var r=this.getColorBox();if(r){var i=this.getRenderOptionValue(t,"useAtomSpecifiedColor"),n=this.getRenderOptionValue(t,"color");i?(n=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value,r.setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className),r.setValue(n)):(r.setColorClassName(null),r.setValue(n))}}},doApplyToTargets:function(e,t){var r=this.getWidget().getValue();r===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value?e.modifyObjectsRenderOptions(t,{useAtomSpecifiedColor:!0,color:void 0},!1,!0):(r==Kekule.Widget.ColorPicker.SpecialColors.UNSET&&(r=void 0),e.modifyObjectsRenderOptions(t,{useAtomSpecifiedColor:!1,color:r},!1,!0))}}),Kekule.Editor.ObjModifierManager.register(Kekule.ChemObject,[Kekule.Editor.ObjModifier.Color])}(),function(){"use strict";var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames,Kekule.ChemWidget.HtmlClassNames),r=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_TEXTFORMAT_BUTTON:"K-Chem-Composer-TextFormat-Button",COMPOSER_MODIFIER_RICHTEXT_PANEL:"K-Chem-Composer-Modifier-RichText-Panel",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP:"K-Chem-Composer-Modifier-RichText-Panel-Group",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-LabelCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-CtrlCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABEL:"K-Chem-Composer-Modifier-RichText-Panel-Group-Label",COMPOSER_TEXTDIRECTION_BOX:"K-Chem-Composer-TextDirection-Box",COMPOSER_TEXTALIGN_BOX:"K-Chem-Composer-TextAlign-Box"}),Kekule.globalOptions.add("chemWidget.composer.objModifier.richText",{componentNames:[r.fontName,r.fontSize,r.textDirection,r.textAlign,r.nodeDisplayMode]}),Kekule.Editor.ObjModifier.RichText=Class.create(Kekule.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.RichText",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={},this._nodeLabelDisplayModeGroup=null},initProperties:function(){this.defineProp("fontPanel",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("fontNameBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textDirectionBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textHorizontalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textVerticalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("nodeLabelDisplayModeBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},_createCtrlGroup:function(r,i,n,o){var a=r.createElement("tr");a.className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP,(s=r.createElement("td")).className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL;var s,l=r.createElement("label");return l.className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUPLABEL,e.setElementText(l,n),s.appendChild(l),a.appendChild(s),(s=r.createElement("td")).className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL,o.appendToElem(s),a.appendChild(s),i.appendChild(a),a},_doCreateDropDownPanel:function(){var e=new Kekule.Widget.Panel(this.getEditor());e.addClassName(t.COMPOSER_MODIFIER_RICHTEXT_PANEL).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT"));var i,n=Kekule.globalOptions.chemWidget.composer.objModifier.richText.componentNames,o=this.getEditor().getDocument(),a=o.createElement("table");if(e.getContainerElement().appendChild(a),n.indexOf(r.fontName)>=0){var s=new Kekule.Widget.ComboBox(e);this.fillFontNameBox(s),s.addClassName(t.COMPOSER_FONTNAME_BOX),s.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME")),s.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontFamily:this.getFontNameBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("fontNameBox",s),this._createCtrlGroup(o,a,Kekule.$L("ChemWidgetTexts.CAPTION_FONTNAME"),s)}if(n.indexOf(r.fontSize)>=0&&(s=new Kekule.Widget.ComboBox(e),this.fillFontSizeBox(s),s.addClassName(t.COMPOSER_FONTSIZE_BOX),s.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE")),s.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontSize:this.getFontSizeBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("fontSizeBox",s),this._createCtrlGroup(o,a,Kekule.$L("ChemWidgetTexts.CAPTION_FONTSIZE"),s)),n.indexOf(r.textDirection)>=0){i=new Kekule.Widget.SelectBox(e);var l=Kekule.Render.TextDirection,u=[{value:l.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT")},{value:l.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR")},{value:l.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL")},{value:l.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB")},{value:l.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT")}];i.setItems(u),s.addClassName(t.COMPOSER_TEXTDIRECTION_BOX),i.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION")),i.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{charDirection:this.getTextDirectionBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("textDirectionBox",i),this._createCtrlGroup(o,a,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),i)}if(n.indexOf(r.textAlign)>=0){i=new Kekule.Widget.SelectBox(e);u=[{value:(d=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:d.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:d.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:d.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:d.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT")},{value:d.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT")}];i.setItems(u),s.addClassName(t.COMPOSER_TEXTALIGN_BOX),i.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN")),i.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{horizontalAlign:this.getTextHorizontalAlignBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("textHorizontalAlignBox",i),this._createCtrlGroup(o,a,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),i),i=new Kekule.Widget.SelectBox(e);var d;u=[{value:(d=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:d.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:d.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:d.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:d.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP")},{value:d.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM")}];i.setItems(u),s.addClassName(t.COMPOSER_TEXTALIGN_BOX),i.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN")),i.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{verticalAlign:this.getTextVerticalAlignBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("textVerticalAlignBox",i),this._createCtrlGroup(o,a,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),i)}if(n.indexOf(r.nodeDisplayMode)>=0){s=new Kekule.Widget.SelectBox(e);this.fillNodeDisplayModeBox(s),s.addClassName(t.COMPOSER_NODEDISPLAYMODE_BOX),s.setHint(Kekule.$L("ChemWidgetTexts.HINT_NODE_LABEL_DISPLAY_MODE")),s.addEventListener("valueChange",function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{nodeDisplayMode:this.getNodeLabelDisplayModeBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("nodeLabelDisplayModeBox",s),this._nodeLabelDisplayModeGroup=this._createCtrlGroup(o,a,Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE"),s)}this.setPropStoreFieldValue("fontPanel",e);var c=this._valueStorage;return c&&this._updateUiValuesFromStorage(c),e},doCreateWidget:function(){var e=new Kekule.Widget.DropDownButton(this.getEditor());return e.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_FORMAT")),e.setText(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT")),e.setShowText(!1),e.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),e.addClassName(t.COMPOSER_TEXTFORMAT_BUTTON),e.setDropDownWidgetGetter(this._doCreateDropDownPanel.bind(this)),e},_filterNodeLabelDisplayModeTargets:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r];n instanceof Kekule.ChemStructureNode&&(n instanceof Kekule.StructureFragment&&n.hasCtab(),t.push(n))}return t},_hasNodeLabelDisplayModeTarget:function(e){return!!this._filterNodeLabelDisplayModeTargets(e).length},_updateUiValuesFromStorage:function(e){this.getFontPanel()&&(this.getFontNameBox()&&this.getFontNameBox().setValue(e.fontName),this.getFontSizeBox()&&this.getFontSizeBox().setValue(e.fontSize),this.getTextDirectionBox()&&this.getTextDirectionBox().setValue(e.textDirection),this.getTextHorizontalAlignBox()&&this.getTextHorizontalAlignBox().setValue(e.textHAlign),this.getTextVerticalAlignBox()&&this.getTextVerticalAlignBox().setValue(e.textVAlign),this.getNodeLabelDisplayModeBox()&&this.getNodeLabelDisplayModeBox().setValue(e.nodeDisplayMode),this._nodeLabelDisplayModeGroup&&Kekule.StyleUtils.setDisplay(this._nodeLabelDisplayModeGroup,e.hasNodeLabelDisplayModeTarget))},doLoadFromTargets:function(e,t){if(t&&t.length){var r=this._valueStorage;r.fontName=this.getRenderOptionValue(t,"fontFamily")||"",r.fontSize=this.getRenderOptionValue(t,"fontSize")||void 0,r.textDirection=this.getRenderOptionValue(t,"charDirection")||Kekule.Render.TextDirection.DEFAULT,r.textHAlign=this.getRenderOptionValue(t,"horizontalAlign")||Kekule.Render.TextAlign.DEFAULT,r.textVAlign=this.getRenderOptionValue(t,"verticalAlign")||Kekule.Render.TextAlign.DEFAULT,r.nodeDisplayMode=this.getRenderOptionValue(this._filterNodeLabelDisplayModeTargets(t),"nodeDisplayMode")||Kekule.Render.NodeLabelDisplayMode.DEFAULT,r.hasNodeLabelDisplayModeTarget=this._hasNodeLabelDisplayModeTarget(t),this.getFontPanel()&&this._updateUiValuesFromStorage(r)}},doApplyToTargets:function(e,t){},fillFontSizeBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes(),r=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:void 0}],i=0,n=t.length;i<n;++i)r.push({text:t[i]+" px",value:t[i]});e.setItems(r)},fillFontNameBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames(),r=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}],i=0,n=t.length;i<n;++i)r.push({text:t[i],value:t[i]});e.setItems(r)},fillNodeDisplayModeBox:function(e){var t=Kekule.Render.NodeLabelDisplayMode,r=[{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT"),value:t.DEFAULT},{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN"),value:t.SHOWN},{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN"),value:t.HIDDEN},{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_SMART"),value:t.SMART}];e.setItems(r)}}),Kekule.Editor.ObjModifierManager.register(Kekule.ChemObject,[Kekule.Editor.ObjModifier.RichText])}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.DomUtils,r=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames),i=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_ATOM_MODIFIER_BUTTON:"K-Chem-Composer-AtomModifier-Button",COMPOSER_ATOM_MODIFIER_DROPDOWN:"K-Chem-Composer-AtomModifier-DropDown",COMPOSER_BOND_MODIFIER_BUTTON:"K-Chem-Composer-BondModifier-Button",COMPOSER_BOND_MODIFIER_DROPDOWN:"K-Chem-Composer-BondModifier-DropDown",COMPOSER_CHARGE_MODIFIER_BUTTON:"K-Chem-Composer-ChargeModifier-Button",COMPOSER_CHARGE_MODIFIER_DROPDOWN:"K-Chem-Composer-ChargeModifier-DropDown"}),Kekule.Editor.ObjModifier.ChemStructureModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.ChemStructureModifier",installValueChangeEventHandler:function(e){}}),Kekule.Editor.ObjModifier.ChemStructureModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.CHEM_STRUCTURE]},Kekule.Editor.ObjModifier.Atom=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Atom",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={}},initProperties:function(){this.defineProp("atomSetter",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new Kekule.Widget.DropDownButton(this.getEditor());return e.setHint(Kekule.$L("ChemWidgetTexts.HINT_ATOM_MODIFIER")),e.setText(Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER")),e.setShowText(!0),e.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),e.addClassName(i.COMPOSER_ATOM_MODIFIER_BUTTON),e.setDropDownWidgetGetter(this._createAtomSetter.bind(this)),e},_createAtomSetter:function(n){n||(n=this.getEditor());var o=this.getEditor(),a=new Kekule.ChemWidget.StructureNodeSetter(n);a.addClassName([r.PANEL,i.COMPOSER_ATOM_MODIFIER_DROPDOWN,r.CORNER_ALL]),a.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs());var s=n.getDocument().createElement("div");s.className=r.PANEL_CAPTION,t.setElementText(s,Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER"));var l=a.getElement();l.insertBefore(s,Kekule.DomUtils.getFirstChildElem(l));var u=e.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());u.push("...");var d=o&&o.getEnabledNonAtomInputData&&o.getEnabledNonAtomInputData();a.setSelectableInfos({elementSymbols:u,nonElementInfos:d,subGroupRepItems:Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()});var c=this;return a.addEventListener("valueChange",function(e){var t=c.getAtomSetter();t&&t.isShown()&&(e.value&&c.applyToTargets(),a.dismiss())}),this.setPropStoreFieldValue("atomSetter",a),this._valueStorage.nodes&&a.setNodes(this._valueStorage.nodes),a},_filterStructureNodes:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r];n instanceof Kekule.ChemStructureNode&&t.push(n)}return t},_getActualModificationNodes:function(t,r){for(var i=[],n=0,o=t.length;n<o;++n){var a=t[n];if(a instanceof Kekule.StructureFragment&&a.isExpanded()){var s=this._getActualModificationNodes(a.getNodes(),!0);e.pushUnique(i,s)}else i.push(a)}return r||(i=this._filterStructureNodes(i)),i},doLoadFromTargets:function(e,t){var r,i=this._getActualModificationNodes(t);this._valueStorage.nodes=i,this.getAtomSetter()&&(this.getAtomSetter().setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),this.getAtomSetter().setNodes(i)),r=Kekule.Editor.StructureUtils.getAllChemStructureNodesHtmlCode(i,null,null,this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),this.getWidget().setText(r||Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER_MIXED")).setShowText(!0).setDisplayed(!!i.length)},doApplyToTargets:function(e,t){for(var r,i=this.getAtomSetter().getValue(),n=[],o=this._getActualModificationNodes(t),a=0,s=o.length;a<s;++a){var l=o[a];if(l instanceof Kekule.ChemStructureNode){var u=this._createNewDataToAtomOperation(i,l);u&&n.push(u)}}(r=n.length>1?new Kekule.MacroOperation(n):n[0])&&this.getEditor().execOperation(r)},_createNewDataToAtomOperation:function(e,t){return Kekule.Editor.OperationUtils.createNodeModificationOperationFromData(t,e,this.getEditor())},_createModificationOperation:function(e,t,r,i){return Kekule.Editor.OperationUtils.createNodeModificationOperation(e,t,r,i,this.getEditor())}}),Kekule.Editor.ObjModifier.Bond=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Bond",initialize:function(e){this.tryApplySuper("initialize",[e]),this._activeSelBtnHtmlClass=null,this._defaultBondTypeData=null,this._valueStorage={};var t=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=t[0]},initProperties:function(){this.defineProp("bondSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new Kekule.Widget.DropDownButton(this.getEditor());return e.setHint(Kekule.$L("ChemWidgetTexts.HINT_BOND_MODIFIER")),e.setText(Kekule.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER")),e.setShowText(!1),e.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),e.addClassName(i.COMPOSER_BOND_MODIFIER_BUTTON),e.setDropDownWidgetGetter(this._createBondSelector.bind(this)),this._defaultBondTypeData.htmlClass&&e.addClassName(this._defaultBondTypeData.htmlClass),e},_filterBond:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r];n instanceof Kekule.Bond&&t.push(n)}return t},_getActualModificationBonds:function(t,r){for(var i=[],n=0,o=t.length;n<o;++n){var a=t[n];if(a instanceof Kekule.StructureFragment&&a.isExpanded()){var s=this._getActualModificationBonds(a.getNodes(),!0);e.pushUnique(i,s),e.pushUnique(i,a.getConnectors())}else a instanceof Kekule.Bond&&i.push(a)}return r||(i=this._filterBond(i)),i},_createBondSelector:function(e){e||(e=this.getEditor());var t=new Kekule.ChemWidget.StructureConnectorSelectPanelAdv(e);if(t.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER")),t.addClassName(i.COMPOSER_BOND_MODIFIER_DROPDOWN),this.getEditor().getEnabledBondFormData){var r=this.getEditor().getEnabledBondFormData();t.setBondPropNames(this._getBondComparePropNames(r)),t.setBondData(r);var n=this.getEditor().getEditorConfigs().getInteractionConfigs().getEnableBondKekulizeHucklize();t.setExtraComponents(n?[Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE]:[])}this._valueStorage.bondsPropValues&&t.setActiveBondPropValues(this._valueStorage.bondsPropValues),this.setPropStoreFieldValue("bondSelector",t);var o=this;return t.addEventListener("valueChange",function(e){o.applyToTargets(),t.dismiss()}),t.addEventListener("command",function(e){o.execExtraCommand(e.command)}),t},_setActiveBondHtmlClass:function(e){var t=this._activeSelBtnHtmlClass;t&&this.getWidget().removeClassName(t),this._activeSelBtnHtmlClass=e,e||(e=this._defaultBondTypeData.htmlClass),e&&this.getWidget().addClassName(e)},_extractBondPropValues:function(e,t){return e.getPropValues(t)},_extractBondsPropValues:function(e,t){for(var r,i,n=0,o=e.length;n<o;++n)if(i=this._extractBondPropValues(e[n],t),r){if(!Kekule.Editor.StructureUtils.isBondPropsMatch(r,i,t)){r=null;break}}else r=i;return r},_getBondComparePropNames:function(t){for(var r=[],i=0,n=t.length;i<n;++i){var o=t[i].bondProps;o&&e.pushUnique(r,Kekule.ObjUtils.getOwnedFieldNames(o))}return r},_getMatchedBondData:function(e,t,r){if(!e)return null;for(var i=0,n=t.length;i<n;++i){var o=t[i];if(o&&Kekule.Editor.StructureUtils.isBondPropsMatch(e,o.bondProps,r))return o}return null},_createBondModificationOperation:function(e,t){return new Kekule.ChemObjOperation.Modify(t,e,this.getEditor())},_execModificationOperations:function(e){var t;(t=e.length>1?new Kekule.MacroOperation(e):e[0])&&this.getEditor().execOperation(t)},doLoadFromTargets:function(e,t){var r=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=r[0];var i=this._getActualModificationBonds(t);if(this._valueStorage.connectors=i,this.getBondSelector()){var n=this.getBondSelector().getBondPropNames(),o=this._extractBondsPropValues(i,n);this.getBondSelector().setActiveBondPropValues(o),this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())}else{this._valueStorage.bondPropNames=this._getBondComparePropNames(r),this._valueStorage.bondsPropValues=this._extractBondsPropValues(i,this._valueStorage.bondPropNames);var a=this._getMatchedBondData(this._valueStorage.bondsPropValues,r,this._valueStorage.bondPropNames);this._setActiveBondHtmlClass(a&&a.htmlClass)}this.getWidget().setDisplayed(!!i.length)},doApplyToTargets:function(e,t){for(var r=this.getBondSelector().getActiveBondPropValues(),i=[],n=this._getActualModificationBonds(t),o=0,a=n.length;o<a;++o){var s=n[o],l=this._createBondModificationOperation(r,s);l&&i.push(l)}this._execModificationOperations(i),this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())},execExtraCommand:function(e){var t=this._getActualModificationBonds(this.getTargetObjs());if(t&&t.length){var r=this.getEditor().getChemObj();if(r&&r.getKekulizationChanges){var i,n=Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands;if(e===n.KEKULIZE?i=r.getKekulizationChanges(t):e===n.HUCKLIZE&&(i=r.getHucklizationChanges(t)),i&&i.length){for(var o=[],a=0,s=i.length;a<s;++a){var l=i[a].bond,u=i[a].bondOrder,d=this._createBondModificationOperation({bondOrder:u},l);o.push(d)}this._execModificationOperations(o)}}}},_getKekulizeOrHucklizeBondModifications:function(e){this.getEditor()}}),Kekule.Editor.ObjModifier.Charge=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Charge",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={}},initProperties:function(){this.defineProp("chargeSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new Kekule.Widget.DropDownButton(this.getEditor());return e.setHint(Kekule.$L("ChemWidgetTexts.HINT_CHARGE_MODIFIER")).setText(Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN")).setShowText(!0).setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),e.addClassName(i.COMPOSER_CHARGE_MODIFIER_BUTTON),e.setDropDownWidgetGetter(this._createChargeSelector.bind(this)),e},_createChargeSelector:function(e){e||(e=this.getEditor());var t=new Kekule.ChemWidget.ChargeSelectPanel(e);t.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_CHARGE_MODIFIER")),t.addClassName(i.COMPOSER_CHARGE_MODIFIER_DROPDOWN),Kekule.ObjUtils.notUnset(this._valueStorage.charge)&&t.setValue(this._valueStorage.charge),this.setPropStoreFieldValue("chargeSelector",t);var r=this;return t.addEventListener("valueChange",function(e){r.applyToTargets(),t.dismiss()}),t},_filterStructureNodes:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r];n instanceof Kekule.ChemStructureNode&&n.getCharge&&t.push(n)}return t},_getActualModificationNodes:function(t,r){for(var i=[],n=0,o=t.length;n<o;++n){var a=t[n];if(a instanceof Kekule.StructureFragment&&a.isExpanded()){var s=this._getActualModificationNodes(a.getNodes(),!0);e.pushUnique(i,s)}else i.push(a)}return r||(i=this._filterStructureNodes(i)),i},_getChargeOfNodes:function(e){for(var t=null,r=0,i=e.length;r<i;++r){var n=e[r];if(n.getCharge){var o=n.getCharge()||0;if(null===t)t=o;else if(t!==o)return null}}return t},doLoadFromTargets:function(e,t){var r=this._getActualModificationNodes(t),i=r.length>=0&&r.length<=1;if(i){var n,o=this._getChargeOfNodes(r);if(this._valueStorage.charge=o,this.getChargeSelector()&&this.getChargeSelector().setValue(o),o){var a=o>0?Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE"):Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE"),s=Kekule.NumUtils.toDecimals(o,1);n=Math.abs(s)+a}else n=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN");this.getWidget().setText(n).setShowText(!0)}this.getWidget().setDisplayed(i)},doApplyToTargets:function(e,t){for(var r,i=this.getChargeSelector().getValue(),n=[],o=this._getActualModificationNodes(t),a=(e=this.getEditor(),0),s=o.length;a<s;++a){var l=o[a];if(l instanceof Kekule.ChemStructureNode){var u=new Kekule.ChemObjOperation.Modify(l,{charge:i},e);u&&n.push(u)}}(r=n.length>1?new Kekule.MacroOperation(n):n[0])&&(e=this.getEditor()).execOperation(r)}});var n=Kekule.Editor.ObjModifierManager;n.register(Kekule.ChemStructureNode,[Kekule.Editor.ObjModifier.Atom]),n.register(Kekule.ChemStructureNode,[Kekule.Editor.ObjModifier.Charge]),n.register([Kekule.Bond,Kekule.StructureFragment],[Kekule.Editor.ObjModifier.Bond])}(),function(){"use strict";var e=Kekule.ObjUtils,t=Kekule.ArrayUtils,r=(Kekule.DomUtils,Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames,Kekule.ChemWidget.HtmlClassNames);Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_GLYPH_PATH_MODIFIER_BUTTON:"K-Chem-Composer-GlyphPathModifier-Button",COMPOSER_Glyph_PATH_MODIFIER_DROPDOWN:"K-Chem-Composer-GlyphPathModifier-DropDown",COMPOSER_GLYPH_REACTION_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-ReactionArrowModifier-Button",COMPOSER_GLYPH_ARC_PATH_MODIFIER_BUTTON:"K-Chem-Composer-ArcPathModifier-Button",COMPOSER_GLYPH_MULTI_ARC_PATH_MODIFIER_BUTTON:"K-Chem-Composer-MultiArcPathModifier-Button",COMPOSER_GLYPH_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-ElectronPushingArrowModifier-Button",COMPOSER_GLYPH_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-BondFormingElectronPushingArrowModifier-Button"}),Kekule.Editor.ObjModifier.GlyphModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.GlyphModifier"}),Kekule.Editor.ObjModifier.GlyphModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.GLYPH]},Kekule.Editor.ObjModifier.GlyphPath=Class.create(Kekule.Editor.ObjModifier.GlyphModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.GlyphPath",MIX_VALUE:"[mixed]",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={}},initProperties:function(){this.defineProp("pathParamSetter",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new Kekule.Widget.DropDownButton(this.getEditor());return e.setHint(this.getModifierHint()),e.setText(this.getModifierCaption()),e.setShowText(!0),e.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),e.addClassName(r.COMPOSER_GLYPH_PATH_MODIFIER_BUTTON+" "+this.getModifierClassName()),e.setDropDownWidgetGetter(this._createPathParamSetter.bind(this)),e},_createPathParamSetter:function(e){e||(e=this.getEditor());var t=new(this.getPathParamSetterClass())(e);t.setCaption(this.getModifierCaption()),t.addClassName(r.COMPOSER_GLYPH_PATH_MODIFIER_DROPDOWN),this.setPropStoreFieldValue("pathParamSetter",t),this._valueStorage.pathParams&&(t.setValue(this._valueStorage.pathParams),this._valueStorage.pathParams=null);var i=this;return t.addEventListener("showStateChange",function(e){e.widget===t&&(e.isShown?i._lastOperation=null:e.isDismissed&&(i._lastOperation&&i._lastOperation.reverse(),i._lastOperation=null))}),t.addEventListener("valueChange",function(e){e.widget===t&&(i.doModification(i.getEditor(),i.getTargetObjs(),!1),i._lastOperation=null,e.stopPropagation())}),t.addEventListener("valueInput",function(e){e.widget===t&&(i.doModification(i.getEditor(),i.getTargetObjs(),!1),e.stopPropagation())}),t},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_GLYPH_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_GLYPH_PATH_MODIFIER")},getModifierClassName:function(){return""},_mergeHashValues:function(r,i){if(!r)return i;if(i){var n=e.getOwnedFieldNames(r,!1),o=e.getOwnedFieldNames(i,!1),a=t.clone(n);if(t.pushUnique(a,o),a.length){for(var s={},l=0,u=a.length;l<u;++l){var d=a[l],c=r[d],h=i[d];s[d]=c===h?c:this.MIX_VALUE}return s}return null}return r},_extractPathParamsOfObjs:function(e){for(var t=null,r=0,i=e.length;r<i;++r){var n=e[r],o=n instanceof Kekule.Glyph.PathGlyphConnector?[n]:n instanceof Kekule.Glyph.PathGlyph?n.getConnectors():null;if(o){var a=this._extractPathParamOfConnectors(o);t=this._mergeHashValues(t,a)}}return t},_extractPathParamOfConnectors:function(e){for(var t=null,r=0,i=e.length;r<i;++r){var n=this._extractPathParamOfConnector(e[r]);n&&(t=this._mergeHashValues(t,n))}return t},_extractPathParamOfConnector:function(e){return e.getPathParams&&e.getPathParams()},getApplicableGlyphClasses:function(){return[Kekule.Glyph.PathGlyph]},isApplicableGlyph:function(e){if(this.getTargetPathGlyph(e)){var t=this.getApplicableGlyphClasses();if(t){for(var r=0,i=t.length;r<i;++r)if(e instanceof t[r])return!0;return!1}return!0}return!1},getTargetPathGlyph:function(e){return e instanceof Kekule.Glyph.PathGlyph?e:e instanceof Kekule.Glyph.PathGlyphConnector?e.getParent():null},_getActualModificationObjs:function(e){for(var r=[],i=0,n=e.length;i<n;++i){var o=e[i];this.isApplicableGlyph(o)&&t.pushUnique(r,o)}return r},_getActualModificationConnectors:function(e){for(var r=[],i=this._getActualModificationObjs(e),n=0,o=i.length;n<o;++n){var a=i[n];a instanceof Kekule.Glyph.PathGlyphConnector?r.push(a):a instanceof Kekule.Glyph.PathGlyph&&t.pushUnique(r,a.getConnectors())}return r},_getActualModificationGlyphs:function(e){for(var r=[],i=this._getActualModificationObjs(e),n=0,o=i.length;n<o;++n){var a=i[n],s=this.getTargetPathGlyph(a);s&&t.pushUnique(r,s)}return r},_filterAppliableParams:function(t){for(var r={},i=e.getOwnedFieldNames(t),n=0,o=i.length;n<o;++n){var a=t[i[n]];void 0!==a&&a!==this.MIX_VALUE&&(r[i[n]]=a)}return r},_splitPathParamValues:function(t){for(var r={},i=e.getOwnedFieldNames(t),n=0,o=i.length;n<o;++n){var a=i[n];if(!a.startsWith("_")){var s=this._getPathParamFieldCategory(a);r[s]||(r[s]={}),r[s][a]=t[a]}}return r},_getPathParamFieldCategory:function(e){return"connectorParams"},createModificationOperations:function(e,t,r){var i=this._splitPathParamValues(r);return this.doCreateModificationOperations(e,t,i)},doCreateModificationOperations:function(e,t,r){if(r.connectorParams){var i=this._getActualModificationConnectors(t);return this._createModificationOperationsOnConnectors(e,i,r.connectorParams)}return null},updateModificationOperations:function(e,t,r,i){var n,o=this._splitPathParamValues(r);return n=i.length?i:i instanceof Kekule.MacroOperation?i.getChildren():[i],this.doUpdateModificationOperations(e,n,t,o)},doUpdateModificationOperations:function(e,t,r,i){return this._updateModificationOperationsOnConnectors(e,r,i.connectorParams,t),t},_updateModificationOperationsOnConnectors:function(e,t,r,i){for(var n=0,o=i.length;n<o;++n){var a=i[n],s=a.getTarget();s instanceof Kekule.Glyph.PathGlyphConnector&&a instanceof Kekule.ChemObjOperation.ModifyHashProp&&this._updateModificationOperationOnConnector(e,s,a,r)}},_updateModificationOperationOnConnector:function(e,t,r,i){t instanceof Kekule.Glyph.PathGlyphConnector&&r instanceof Kekule.ChemObjOperation.ModifyHashProp&&r.setNewPropValue(i)},_createModificationOperationsOnConnectors:function(e,t,r){for(var i=[],n=0,o=t.length;n<o;++n){var a=t[n];if(a instanceof Kekule.Glyph.PathGlyphConnector){var s=this._createModificationOperationOnConnector(e,a,r);s&&i.push(s)}}return i},_createModificationOperationOnConnector:function(e,t,r){return t instanceof Kekule.Glyph.PathGlyphConnector?new Kekule.ChemObjOperation.ModifyHashProp(t,"pathParams",r,e):null},_createWrapperOperation:function(e){return e&&e.length>1?new Kekule.MacroOperation(e):e[0]},_execModificationOperationInEditor:function(e){var t=!this._lastOperation,r=this.getEditor();r.beginManipulateAndUpdateObject();try{e&&(t?r.execOperation(e):e.execute())}finally{r.endManipulateAndUpdateObject(),this._lastOperation=e}},doModification:function(e,t,r){var i,n=this.getPathParamSetter().getValue();n=this._filterAppliableParams(n),i=this._lastOperation?this.updateModificationOperations(e,t,n,this._lastOperation):this.createModificationOperations(e,t,n);var o=this._createWrapperOperation(i);this._execModificationOperationInEditor(o)},doLoadFromTargets:function(e,t){var r=this._getActualModificationObjs(t),i=r.length>0;if(this._lastOperation=null,i){var n=this._extractPathParamsOfObjs(r);this._valueStorage.pathParams=n;var o=this.getPathParamSetter();o&&o.setValue(n)}this.getWidget().setDisplayed(i)},doApplyToTargets:function(e,t){this.doModification(e,t,!1)}}),Kekule.Editor.ObjModifier.ReactionArrowAndSegmentPath=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.ReactionArrowAndSegmentPath",MIX_VALUE:"[mixed]",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphReactionArrowPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_REACTION_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.StraightLine,Kekule.Glyph.Segment,Kekule.Glyph.ReactionArrow]},_extractPathParamsOfObjs:function(e){for(var t,r=this.tryApplySuper("_extractPathParamsOfObjs",[e]),i=0,n=e.length;i<n;++i){var o=e[i],a=this.getTargetPathGlyph(o);if(a&&a.getReactionType){var s=a.getReactionType();if(t){if(t!==s){t=Kekule.Glyph.ReactionArrowType.CUSTOM;break}}else t=s}}return r.reactionArrowType=t,r},createModificationOperations_OLD:function(e,t,r){var i=[];if(r.reactionArrowType!==this.MIX_VALUE){for(var n=this._getActualModificationGlyphs(t),o=0,a=n.length;o<a;++o){var s=n[o];s.setReactionType?r.reactionArrowType||s instanceof Kekule.Glyph.ReactionArrow&&i.push(new Kekule.ChemObjOperation.ChangeClass(s,Kekule.Glyph.Segment,e)):r.reactionArrowType&&s instanceof Kekule.Glyph.StraightLine&&i.push(new Kekule.ChemObjOperation.ChangeClass(s,Kekule.Glyph.ReactionArrow,e))}i.push(new Kekule.ChemObjOperation.Modify(s,{reactionType:r.reactionArrowType},e))}var l=this.tryApplySuper("createModificationOperations_OLD",[e,t,r])||[];return i=i.concat(l)},doCreateModificationOperations:function(e,t,r){var i=[],n=r.connectorParams;if(n.reactionArrowType!==this.MIX_VALUE){for(var o=this._getActualModificationGlyphs(t),a=0,s=o.length;a<s;++a){var l=o[a];l.setReactionType?n.reactionArrowType||l instanceof Kekule.Glyph.ReactionArrow&&i.push(new Kekule.ChemObjOperation.ChangeClass(l,Kekule.Glyph.Segment,e)):n.reactionArrowType&&l instanceof Kekule.Glyph.StraightLine&&i.push(new Kekule.ChemObjOperation.ChangeClass(l,Kekule.Glyph.ReactionArrow,e))}i.push(new Kekule.ChemObjOperation.Modify(l,{reactionType:n.reactionArrowType},e))}var u=this.tryApplySuper("doCreateModificationOperations",[e,t,r])||[];return i=i.concat(u)}}),Kekule.Editor.ObjModifier.ArcPath=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.ArcPath",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphArcPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_ARC_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_ARC_PATH_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_ARC_PATH_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.Arc]}}),Kekule.Editor.ObjModifier.MultiArcPath=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.MultiArcPath",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphMultiArcPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_MULTI_ARC_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_MULTI_ARC_PATH_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_MULTI_ARC_PATH_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.TwinArc]},_filterAppliableParams:function(e){if(DataType.isArrayValue(e)){for(var t=[],r=0,i=e.length;r<i;++r)t.push(this.tryApplySuper("_filterAppliableParams",[e[r]]));return t}return this.tryApplySuper("_filterAppliableParams",[e])},_buildConnectorGroup:function(e,t){var r,i,n,o=[];t&&(r=new Kekule.MapEx,o.map=r);for(var a=0,s=e.length;a<s;++a)for(var l=e[a],u=l instanceof Kekule.Glyph.PathGlyphConnector?[l]:l instanceof Kekule.Glyph.PathGlyph?l.getConnectors():[],d=0,c=u.length;d<c;++d){var h=u[d];(i=d,n=void 0,n=o[i],n||(n=[],o[i]=n),n).push(h),t&&r.set(h,d)}return o},_extractPathParamsOfObjs:function(e){for(var t=[],r=this._buildConnectorGroup(e),i=0,n=r.length;i<n;++i){var o=r[i]||[],a=this._extractPathParamOfConnectors(o)||null;t.push(a)}return t},_splitPathParamValues:function(t){if(DataType.isArrayValue(t)){for(var r=[],i=0,n=t.length;i<n;++i){var o=this.tryApplySuper("_splitPathParamValues",[t[i]]);if(o)for(var a=e.getOwnedFieldNames(o),s=0,l=a.length;s<l;++s){var u=a[s];r[u]||(r[u]=[]),r[u][i]=o[u]}}return r}return this.tryApplySuper("_splitPathParamValues",[t])},_updateModificationOperationsOnConnectors:function(e,t,r,i){for(var n=this._buildConnectorGroup(t,!0).map,o=0,a=i.length;o<a;++o){var s=i[o],l=s.getTarget();if(l instanceof Kekule.Glyph.PathGlyphConnector&&s instanceof Kekule.ChemObjOperation.ModifyHashProp){var u=n.get(l);u>=0&&this._updateModificationOperationOnConnector(e,l,s,r[u])}}},doCreateModificationOperations:function(e,r,i){var n=[];if(i.connectorParams)for(var o=t.toArray(i.connectorParams),a=this._buildConnectorGroup(r),s=0,l=a.length;s<l;++s){var u=o[s];if(u){var d=a[s]||[],c=this._createModificationOperationsOnConnectors(e,d,u);c&&(n=n.concat(c))}}return n}}),Kekule.Editor.ObjModifier.BaseElectronPushingArrow=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.BaseElectronPushingArrow",getPathParamSetterClass:function(){return null},getModifierCaption:function(){return null},getModifierHint:function(){return null},getModifierClassName:function(){return""},getApplicableGlyphClasses:function(){return[]},_extractPathParamsOfObjs:function(t){for(var r,i=this.tryApplySuper("_extractPathParamsOfObjs",[t]),n=0,o=t.length;n<o;++n){var a=t[n],s=this.getTargetPathGlyph(a);if(s&&s.getElectronCount){var l=s.getElectronCount();if(e.isUnset(r))r=l;else if(r!==l){r=0;break}}}return i.electronCount=r,i},_getPathParamFieldCategory:function(e){return"electronCount"===e?"glyphParams":this.tryApplySuper("_getPathParamFieldCategory",[e])},doCreateModificationOperations:function(e,t,r){var i=this.tryApplySuper("doCreateModificationOperations",[e,t,r])||[];if(r.glyphParams&&r.glyphParams.electronCount)for(var n=this._getActualModificationGlyphs(t),o=0,a=n.length;o<a;++o){var s=n[o];s.hasProperty("electronCount")&&i.push(new Kekule.ChemObjOperation.Modify(s,{electronCount:r.glyphParams.electronCount},e))}return i},doUpdateModificationOperations:function(e,t,r,i){return this.tryApplySuper("doUpdateModificationOperations",[e,t,r,i]),this._updateGlyphModificationOperations(e,t,i),t},_updateGlyphModificationOperations:function(e,t,r){}}),Kekule.Editor.ObjModifier.ElectronPushingArrow=Class.create(Kekule.Editor.ObjModifier.BaseElectronPushingArrow,{CLASS_NAME:"Kekule.Editor.ObjModifier.ElectronPushingArrow",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.ElectronPushingArrow]}}),Kekule.Editor.ObjModifier.BondFormingElectronPushingArrow=Class.create(Kekule.Editor.ObjModifier.MultiArcPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.BondFormingElectronPushingArrow",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.BondFormingElectronPushingArrow]},_extractPathParamsOfObjs:function(t){for(var r,i=this.tryApplySuper("_extractPathParamsOfObjs",[t]),n=0,o=t.length;n<o;++n){var a=t[n],s=this.getTargetPathGlyph(a);if(s&&s.getElectronCount){var l=s.getConnectorCount()||1,u=Math.round((s.getElectronCount()||0)/l);if(e.isUnset(r))(r=u)<=0&&(r=1);else if(r!==u){r=0;break}}}return i.electronCount=r,i},_getPathParamFieldCategory:function(e){return"electronCount"===e?"glyphParams":this.tryApplySuper("_getPathParamFieldCategory",[e])},_filterAppliableParams:function(e){var t=this.tryApplySuper("_filterAppliableParams",[e])||[];return e.electronCount&&(t.electronCount=e.electronCount),t},_splitPathParamValues:function(e){var t=this.tryApplySuper("_splitPathParamValues",[e])||[];return e.electronCount&&(t.glyphParams||(t.glyphParams={}),t.glyphParams.electronCount=e.electronCount),t},doCreateModificationOperations:function(e,t,r){var i=this.tryApplySuper("doCreateModificationOperations",[e,t,r])||[];if(r.glyphParams&&r.glyphParams.electronCount)for(var n=this._getActualModificationGlyphs(t),o=0,a=n.length;o<a;++o){var s=n[o];if(s.hasProperty("electronCount")){var l=s.getConnectorCount()||1,u=Math.round(r.glyphParams.electronCount*l);u<=0&&(u=1),i.push(new Kekule.ChemObjOperation.Modify(s,{electronCount:u},e))}}return i}});var i=Kekule.Editor.ObjModifierManager;i.register([Kekule.Glyph.StraightLine,Kekule.Glyph.PathGlyphConnector],[Kekule.Editor.ObjModifier.ReactionArrowAndSegmentPath]),i.register([Kekule.Glyph.Arc],[Kekule.Editor.ObjModifier.ArcPath]),i.register([Kekule.Glyph.TwinArc],[Kekule.Editor.ObjModifier.MultiArcPath]),i.register([Kekule.Glyph.ElectronPushingArrow],[Kekule.Editor.ObjModifier.ElectronPushingArrow]),i.register([Kekule.Glyph.BondFormingElectronPushingArrow],[Kekule.Editor.ObjModifier.BondFormingElectronPushingArrow])}(),function(){"use strict";var e=Kekule.ErrorLevel;Kekule.IssueCheck={},Kekule.IssueCheck.IssueCode={ERROR_UNKNOWN:0,ERROR_ATOM_VALENCE_ABNORMAL:1101,ERROR_BOND_ORDER_EXCEED:1201};var t=Kekule.IssueCheck.IssueCode;Kekule.IssueCheck.CheckerIds={ATOM_VALENCE:"atomValence",BOND_ORDER:"bondOrder"};var r=Kekule.IssueCheck.CheckerIds;Kekule.IssueCheck.CheckerManager={_checkerMap:{},register:function(e,t){e||(e=ClassEx.getClassName(t));var r=i._checkerMap[e];r&&r.checkerClass===t||(i._checkerMap[e]={checkerClass:t})},unregister:function(e){i._checkerMap[e]=null},getCheckerClass:function(e){var t=i._checkerMap[e];return t&&t.checkerClass},getCheckerInstance:function(e){var t=null,r=i._checkerMap[e];if(r){if(!r.instance){var n=r.checkerClass;r.instance=new n}t=r.instance}return t}};var i=Kekule.IssueCheck.CheckerManager;Kekule.IssueCheck.Executor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.Executor",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("ignoreUnexposedObjs",{dataType:DataType.ARRAY}),this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("durationLimit",{dataType:DataType.NUMBER}),this.defineProp("allFinished",{dataType:DataType.BOOL,setter:null,serializable:!1}),this.defineProp("checkerIds",{dataType:DataType.ARRAY,setter:function(e){for(var t=[],r=Kekule.ArrayUtils.toArray(e),n=0,o=r.length;n<o;++n){var a=i.getCheckerInstance(r[n]);a&&t.push(a)}this.setPropStoreFieldValue("checkers",t)}}),this.defineProp("checkers",{dataType:DataType.ARRAY,serializable:!1,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setIgnoreUnexposedObjs(!0),this.setEnabled(!0)},doFinalize:function(){this.setPropStoreFieldValue("checkers",null),this.tryApplySuper("doFinalize")},execute:function(e,t){if(!this.getEnabled())return null;for(var r=this.getDurationLimit(),i=r&&Date.now()+r,n=this.doPrepareOptions(t),o=new Kekule.MapEx,a=this.getCheckers(),s=[],l=0,u=a.length;l<u;++l)a[l].getEnabled()&&s.push(a[l]);this._getAllObjsNeedCheck(e,e,s,o,n);var d=!0,c=[];for(l=0,u=s.length;l<u;++l){var h=s[l];h.setDeadline(i);var p=o.get(h);if(p&&p.length){var g=h.check(p,e,n);g&&g.length&&(c=c.concat(g)),d=d&&h.getAllFinished()}}return this.setPropStoreFieldValue("allFinished",d),this.invokeEvent("execute",{checkResults:c,allFinished:d}),c},recheck:function(e,t,r,i){var n;if(r){n=[];for(var o=0,a=t.length;o<a;++o)t[o].isChildOf(r)&&n.push(t[o])}else n=t;return n.length?e.check(t,i||{}):null},doPrepareOptions:function(e){return options||{}},_getAllObjsNeedCheck:function(e,t,r,i,n){var o=!this.getIgnoreUnexposedObjs();if(this._isObjExposed(e)||o)for(var a=0,s=t.getChildCount();a<s;++a){var l=t.getChildAt(a);if(this._isObjExposed(l)||o){for(var u=0,d=r.length;u<d;++u){var c=r[u];if(c.applicable(l,e,n)){var h=i.get(c);h?h.push(l):(h=[l],i.set(c,h))}}this._getAllObjsNeedCheck(e,l,r,i,n)}}},_isObjExposed:function(e){return!e.isExposed||e.isExposed()}}),Kekule.IssueCheck.CheckResult=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.CheckResult",DEF_ERROR_CODE:t.UNKNOWN,initialize:function(t,r,i,n,o){this.setPropStoreFieldValue("level",t||e.ERROR),this.setPropStoreFieldValue("code",r||this.DEF_ERROR_CODE),this.setPropStoreFieldValue("data",i),this.setPropStoreFieldValue("targets",n),this.setPropStoreFieldValue("reporter",o),this.tryApplySuper("initialize")},doFinalize:function(){this.setData(null),this.setTargets(null),this.setReporter(null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("level",{dataType:DataType.INT}),this.defineProp("code",{dataType:DataType.INT}),this.defineProp("data",{dataType:DataType.HASH}),this.defineProp("targets",{dataType:DataType.Array,serializable:!1}),this.defineProp("reporter",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("msg",{dataType:DataType.STRING,serializable:!1,setter:null,getter:function(){return this.getMessage()}})},getDataValue:function(e){return(this.getData()||{})[e]},getMessage:function(){return Kekule.$L("ErrorCheckMsg.GENERAL_ERROR_WITH_CODE").format(this.getErrorCode())}}),Kekule.IssueCheck.BaseChecker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.BaseChecker",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("deadline",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("allFinished",{dataType:DataType.BOOL,setter:null,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnabled(!0)},_createReport:function(e,t,r,i,n){return new e(t,r,i,n,this)},applicable:function(e,t,r){return this.doApplicable(e,t,r||{})},doApplicable:function(e,t,r){return!1},check:function(e,t,r){return this.doCheck(e,t,r||{})},doCheck:function(e,t,r){this.setPropStoreFieldValue("allFinished",!1);for(var i=[],n=this.getDeadline()||null,o=!1,a=0,s=e.length;a<s;++a){if(n)if(Date.now()>=n){o=!0;break}var l=this.doCheckOnTarget(e[a],a,e,t,r)||[];i=i.concat(l)}return this.setPropStoreFieldValue("allFinished",!!o),i},doCheckOnTarget:function(e,t,r,i,n){}}),Kekule.IssueCheck.AtomValenceChecker=Class.create(Kekule.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.AtomValenceChecker",initialize:function(){this.tryApplySuper("initialize")},doApplicable:function(e,t,r){return e instanceof Kekule.Atom&&e.isNormalAtom()},doCheckOnTarget:function(e,t,r,i,n){var o=this.checkValence(e);return o?[o]:null},checkValence:function(r){var i=r.getValence(),n=r.getCharge()||0,o=this._getPossibleValences(r.getAtomicNumber(),n);return o.length&&o.indexOf(i)<0?this._createReport(Kekule.IssueCheck.AtomValenceChecker.Result,e.ERROR,t.ERROR_ATOM_VALENCE_ABNORMAL,{currValence:i,possibleValences:o},[r]):null},_getPossibleValences:function(e,t){var r=[],i=Kekule.ValenceUtils.getPossibleMdlValenceInfo(e,t);return i&&i.valences&&!i.unexpectedCharge&&(r=[].concat(i.valences)),r}}),i.register(r.ATOM_VALENCE,Kekule.IssueCheck.AtomValenceChecker),Kekule.IssueCheck.AtomValenceChecker.Result=Class.create(Kekule.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.AtomValenceChecker.Result",DEF_ERROR_CODE:t.ERROR_ATOM_VALENCE_ABNORMAL,getMessage:function(){var e=this.getDataValue("currValence"),t=this.getDataValue("possibleValences"),r=t.length<=1?Kekule.$L("ErrorCheckMsg.ATOM_VALENCE_ERROR_WITH_SUGGEST"):Kekule.$L("ErrorCheckMsg.ATOM_VALENCE_ERROR_WITH_SUGGESTS"),i=this.getTargets()[0],n=(i.getId(),i.getLabel?i.getLabel():i.getSymbol()),o=t.join("/");return r.format(n,e,o)}}),Kekule.IssueCheck.BondOrderChecker=Class.create(Kekule.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker",doApplicable:function(e,t,r){return e instanceof Kekule.Bond&&e.isCovalentBond()},doCheckOnTarget:function(e,t,r,i,n){var o=this.checkBondOrder(e);return o?[o]:null},checkBondOrder:function(r){var i=r.getBondValence&&r.getBondValence();if(i){for(var n=r.getConnectedChemNodes(),o=0,a=0,s=n.length;a<s;++a){var l=this._getAllowedMaxBondOrder(n[a]);l>0&&(!o||l<o)&&(o=l)}if(o&&i>o)return this._createReport(Kekule.IssueCheck.BondOrderChecker.Result,e.ERROR,t.ERROR_BOND_ORDER_EXCEED,{currOrder:i,maxOrder:o},[r])}return null},_getAllowedMaxBondOrder:function(e){var t=0;if(e instanceof Kekule.Atom&&e.isNormalAtom()){var r=e.getValence(),i=Kekule.AtomTypeDataUtil.getAllAtomTypes(e.getAtomicNumber());if(i)for(var n=0,o=i.length;n<o;++n)if(r<=i[n].bondOrderSum){t=i[n].maxBondOrder;break}}return t}}),i.register(r.BOND_ORDER,Kekule.IssueCheck.BondOrderChecker),Kekule.IssueCheck.BondOrderChecker.Result=Class.create(Kekule.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker.Result",DEF_ERROR_CODE:t.ERROR_BOND_ORDER_EXCEED,getMessage:function(){for(var e=this.getDataValue("currOrder"),t=this.getDataValue("maxOrder"),r=this.getTargets()[0].getConnectedChemNodes(),i=[],n=0,o=r.length;n<o;++n){var a=r[n],s=a.getLabel&&a.getLabel();s&&i.push(s)}var l=i.length>1?i.join("-"):null;return l?Kekule.$L("ErrorCheckMsg.BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST").format(l,e,t):Kekule.$L("ErrorCheckMsg.BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST").format(e,t)}})}(),function(){"use strict";Kekule.IssueCheck.IssueCode=Object.extend(Kekule.IssueCheck.IssueCode,{WARNING_NODE_TOO_CLOSE:2101});var e=Kekule.IssueCheck.IssueCode;Kekule.IssueCheck.CheckerIds=Object.extend(Kekule.IssueCheck.CheckerIds,{NODE_DISTANCE_2D:"nodeDistance2D"});var t=Kekule.IssueCheck.CheckerIds,r=Kekule.IssueCheck.CheckerManager,i=Kekule.CoordUtils;Kekule.IssueCheck.ExecutorForEditor=Class.create(Kekule.IssueCheck.Executor,{CLASS_NAME:"Kekule.IssueCheck.ExecutorForEditor",initialize:function(e){this.setPropStoreFieldValue("editor",e),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},doPrepareOptions:function(e){var t=e?Object.create(e):{},r=this.getEditor();return r&&(t.editor=r),t}}),Kekule.IssueCheck.IssueResolver=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.IssueResolver",initialize:function(){this.tryApplySuper("initialize")},createSolutions:function(e,t){return this.doCreateSolutions(e,t)},doCreateSolutions:function(e,t){return[]},_createSolutionInstance:function(e,t,r,i,n){return n||(n=Kekule.IssueCheck.IssueSolution),new n(e,t,r,i)},_getEditorWidget:function(e){return e&&e instanceof Kekule.Editor.BaseEditor?e:null}}),Kekule.IssueCheck.IssueSolution=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.IssueSolution",initialize:function(e,t,r,i){this.setPropStoreFieldValue("issueResult",i),this.setPropStoreFieldValue("title",e),this.setPropStoreFieldValue("description",t),this.setPropStoreFieldValue("operation",r),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("issueResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1}),this.defineProp("title",{dataType:DataType.STRING}),this.defineProp("description",{dataType:DataType.STRING}),this.defineProp("operation",{dataType:"Kekule.Operation",serializable:!1})},doFinalize:function(){var e=this.getOperation();e&&e.finalize(),this.tryApplySuper("doFinalize")}}),Kekule.IssueCheck.ResolverManager={_resolverMap:new Kekule.MapEx,_resolverInstanceMap:new Kekule.MapEx,register:function(e,t){var r=n._resolverMap.get(e);r||(r=[],n._resolverMap.set(e,r)),r.indexOf(t)<0&&r.push(t)},unregister:function(e,t){var r=n._resolverMap.get(e),i=r.indexOf(t);i>=0&&r.splice(i,1)},getResolverClasses:function(e){return n._resolverMap.get(e)||[]},getResolverInstances:function(e){for(var t=[],r=n.getResolverClasses(e),i=0,o=r.length;i<o;++i){var a=r[i],s=n._resolverInstanceMap.get(a);s||(s=new a,n._resolverInstanceMap.set(a,s)),t.push(s)}return t}};var n=Kekule.IssueCheck.ResolverManager;ClassEx.extend(Kekule.IssueCheck.CheckResult,{getResolvers:function(){return n.getResolverInstances(this.getClass())},fetchSolutions:function(e){for(var t=this.getResolvers(),r=[],i=0,n=t.length;i<n;++i){var o=t[i].createSolutions(this,e);o&&o.length&&(r=r.concat(o))}return r}}),Kekule.IssueCheck.BondOrderChecker.Resolver=Class.create(Kekule.IssueCheck.IssueResolver,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker.Resolver",doCreateSolutions:function(e,t){var r=e.getTargets()[0],i=r.getBondOrder(),n=e.getData().maxOrder,o=this._getEditorWidget(t);if(r&&n&&o){var a=new Kekule.ChemObjOperation.Modify(r,{bondOrder:n},o),s=Kekule.$L("ErrorCheckMsg.TITLE_CHANGE_BOND_ORDER_TO").format(n),l=Kekule.$L("ErrorCheckMsg.DESCRIPTION_CHANGE_BOND_ORDER_TO").format(i,n);return[this._createSolutionInstance(s,l,a,e)]}return[]}}),n.register(Kekule.IssueCheck.BondOrderChecker.Result,Kekule.IssueCheck.BondOrderChecker.Resolver),Kekule.IssueCheck.Node2DDistanceChecker=Class.create(Kekule.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.Node2DDistanceChecker",doApplicable:function(e,t,r){return t instanceof Kekule.ChemSpace&&e instanceof Kekule.ChemStructureNode&&(!(e instanceof Kekule.Molecule)||!(e.isExpanded&&e.isExpanded()))&&!(e instanceof Kekule.SubGroup&&e.isExpanded&&e.isExpanded())&&(!e.isExposed||e.isExposed())},doCheckOnTarget:function(e,t,r,i,n){for(var o=[],a=e,s=t+1,l=r.length;s<l;++s){var u=r[s];if(u){var d=this.doCheckDistance(a,u,i,n);d&&o.push(d)}}return o},doCheckDistance:function(t,r,i,n){var o=this._getDistanceRefLength(i)/5,a=n.editor,s=!!a&&a.getAllowCoordBorrow();return this._isNodesDistanceTooClose(t,r,o,s,a)?new Kekule.IssueCheck.Node2DDistanceChecker.Result(Kekule.ErrorLevel.WARNING,e.WARNING_NODE_TOO_CLOSE,null,[t,r],this):null},_getDistanceRefLength:function(e){return e.getDefAutoScaleRefLength()},_getEditor:function(e){return e.editor},_isNodesDistanceTooClose:function(e,t,r,i,n){if(n){var o=n.translateDistance(r,Kekule.Render.CoordSystem.CHEM,Kekule.Render.CoordSystem.SCREEN);return this._isNodesDistanceTooCloseByBound(e,t,r,o,n)}return this._getNodesDistanceByCoord(e,t,i)<distanceThreshold},_getNodesDistanceByCoord:function(e,t,r){var n=e.getAbsCoord2D(r),o=t.getAbsCoord2D(r);return i.getDistance(n,o)},_isNodesDistanceTooCloseByBound:function(e,t,r,n,o){Kekule.Render.BoundShapeType;var a=Kekule.Render.MetaShapeUtils,s=o.getChemObjBounds(e)[0],l=o.getChemObjBounds(t)[0];if(!s||!l)return!1;if(this._isPointOrCircleShape(s)&&this._isPointOrCircleShape(l))return i.getDistance(s.coords[0],l.coords[0])-(s.radius||0)-(s.radius||0)<n;if(this._isPointOrCircleShape(s)||this._isPointOrCircleShape(l)){var u=this._isPointOrCircleShape(s),d=u?s.coords[0]:l.coords[0],c=u?s.radius||0:l.radius||0,h=u?l:s,p=a.inflateShape(h,n);return a.getDistance(d,p)-c<0}for(var g=0,f=s.coords.length;g<f;++g){var C=s.coords[g];if(a.isCoordInside(C,l))return!0}for(g=0,f=l.coords.length;g<f;++g){C=l.coords[g];if(a.isCoordInside(C,s))return!0}return!1},_isPointOrCircleShape:function(e){var t=Kekule.Render.BoundShapeType;return e.shapeType===t.POINT||e.shapeType===t.CIRCLE}}),r.register(t.NODE_DISTANCE_2D,Kekule.IssueCheck.Node2DDistanceChecker),Kekule.IssueCheck.Node2DDistanceChecker.Result=Class.create(Kekule.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.NodeDistanceChecker.Result",DEF_ERROR_CODE:e.WARNING_NODE_TOO_CLOSE,getMessage:function(){var e=this.getTargets()[0],t=this.getTargets()[1],r=e.getLabel&&e.getLabel()||e.getId&&e.getId(),i=t.getLabel&&t.getLabel()||t.getId&&t.getId();return r&&r?Kekule.$L("ErrorCheckMsg.NODE_DISTANCE_TOO_CLOSE_WITH_LABEL").format(r+"/"+i):Kekule.$L("ErrorCheckMsg.NODE_DISTANCE_TOO_CLOSE")}}),Kekule.IssueCheck.Node2DDistanceChecker.Resolver=Class.create(Kekule.IssueCheck.IssueResolver,{CLASS_NAME:"Kekule.IssueCheck.Node2DDistanceChecker.Resolver",doCreateSolutions:function(e,t){var r=e.getTargets()[0],i=e.getTargets()[1],n=r.getLabel&&r.getLabel(),o=i.getLabel&&i.getLabel(),a=n===o;if(!n||a){var s=r.getId&&r.getId();s&&(n=n?n+"("+s+")":s)}if(!n||a){var l=i.getId&&i.getId();l&&(o=o?o+"("+l+")":l)}var u=this._getEditorWidget(t),d=[];if(r&&i&&u){var c=u.getEditorConfigs().getInteractionConfigs().getEnableStructFragmentMerge(),h=u.getEditorConfigs().getInteractionConfigs().getEnableNeighborNodeMerge();if(Kekule.ChemStructOperation.MergeNodes.canMerge(r,i,c,h)){var p=new Kekule.ChemStructOperation.MergeNodes(r,i,c,u);d.push(this._createSolutionInstance(Kekule.$L("ErrorCheckMsg.TITLE_MERGE_TO").format(n,o),Kekule.$L("ErrorCheckMsg.DESCRIPTION_MERGE_TO").format(n,o),p,e))}if(Kekule.ChemStructOperation.MergeNodes.canMerge(i,r,c,h)){p=new Kekule.ChemStructOperation.MergeNodes(i,r,c,u);d.push(this._createSolutionInstance(Kekule.$L("ErrorCheckMsg.TITLE_MERGE_TO").format(o,n),Kekule.$L("ErrorCheckMsg.DESCRIPTION_MERGE_TO").format(o,n),p,e))}}return d}}),n.register(Kekule.IssueCheck.Node2DDistanceChecker.Result,Kekule.IssueCheck.Node2DDistanceChecker.Resolver)}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,r=Kekule.Widget.HtmlClassNames,i=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHECK_RESULT_LIST_VIEW:"K-Chem-CheckResultListView",CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED:"K-Chem-CheckResultListView-SolutionEnabled",CHECK_RESULT_LIST_VIEW_ITEM:"K-Chem-CheckResultListView-Item",CHECK_RESULT_LIST_VIEW_ITEM_BODY:"K-Chem-CheckResultListView-ItemBody",CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_SECTION:"K-Chem-CheckResultListView-Item-SolutionSection",CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_WIDGET:"K-Chem-CheckResultListView-Item-SolutionWidget",ISSUE_INSPECTOR:"K-Chem-IssueInspector",ISSUE_INSPECTOR_FLEX_LAYOUT:"K-Chem-IssueInspector-Flex-Layout",ISSUE_INSPECTOR_SUBPART:"K-Chem-IssueInspector-SubPart",ISSUE_INSPECTOR_LIST_PANEL:"K-Chem-IssueInspector-ListPanel"}),Kekule.ChemWidget.CheckResultListView=Class.create(Kekule.Widget.ListView,{CLASS_NAME:"Kekule.ChemWidget.CheckResultListView",initProperties:function(){this.defineProp("checkResults",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("checkResults",e),this._updateListView()}}),this.defineProp("selectedCheckResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1,setter:null,getter:function(){var e,t=this.getSelectedItem();return t&&(e=this.getItemData(t).checkResult),e}}),this.defineProp("enableIssueSolutions",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this.getEnableIssueSolutions()!==t&&(this.setPropStoreFieldValue("enableIssueSolutions",t),t?this.addClassName(i.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED):this.removeClassName(i.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED))}}),this.defineProp("resolverCaller",{dataType:DataType.OBJECT,serialiazable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!0).setEnableMultiSelect(!1).setLayout(Kekule.Widget.Layout.VERTICAL)},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+i.CHECK_RESULT_LIST_VIEW;return e+=" "+this._getSolutionEnableRelatedClassName()},getItemClassName:function(){return this.tryApplySuper("getItemClassName")+" "+i.CHECK_RESULT_LIST_VIEW_ITEM},_getSolutionEnableRelatedClassName:function(){return this.getEnableIssueSolutions()?i.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED:""},selectionChanged:function(e,t){var r=this.tryApplySuper("selectionChanged",[e,t]);if(e&&this.getEnableIssueSolutions())for(var i=0,n=e.length;i<n;++i){var o=e[i],a=this.getItemData(o);a.solutions||(a.solutions=a.checkResult.fetchSolutions(this.getResolverCaller()),a.solutions&&this.doFillSolutionSection(o,a.solutions))}return r},createChildItem:function(e){var t;return t=e instanceof Kekule.IssueCheck.CheckResult?this._wrapCheckResultToItemData(e):e,this.tryApplySuper("createChildItem",[t])},doCreateChildItem:function(e){var t=this.getDocument(),r=t.createElement("li"),n=t.createElement("span");n.className=i.CHECK_RESULT_LIST_VIEW_ITEM_BODY,r.appendChild(n);var o=t.createElement("span");return o.className=i.CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_SECTION,r._solutionSecElem=o,r.appendChild(o),r},doFillSolutionSection:function(t,r){if(r&&this.getEnableIssueSolutions())for(var i=this.getDocument(),n=0,o=r.length;n<o;++n){this.doCreateSolutionWidget(i,r[n],t).appendToElem(t._solutionSecElem)}else e.clearChildContent(t._solutionSecElem)},doCreateSolutionWidget:function(e,t,r){var n=this,o=new Kekule.Widget.Button(this);return o.addClassName(i.CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_WIDGET),o.setText(t.getTitle()).setHint(t.getDescription()),o.addEventListener("execute",function(e){n.getEnableIssueSolutions()&&n.invokeEvent("resolveIssue",{solution:t,issueResult:t.getIssueResult()})}),o},setItemData:function(e,t){var r;r=t instanceof Kekule.IssueCheck.CheckResult?this._wrapCheckResultToItemData(t):t,this.tryApplySuper("setItemData",[e,r])},doSetItemData:function(r,n){var o=this.getItemData(r);if(o&&o.className&&t.removeClass(r,o.className),n){var a=n;a.text&&e.setElementText(r.getElementsByClassName(i.CHECK_RESULT_LIST_VIEW_ITEM_BODY)[0],a.text),a.hint&&r.setAttribute("title",a.hint),a.className&&t.addClass(r,a.className),this.doFillSolutionSection(r,a.solutions)}},_wrapCheckResultToItemData:function(e){var t=e.getMessage();return{text:t,hint:t,className:this._getErrorLevelHtmlClass(e.getLevel()),checkResult:e,solutions:null}},_updateListView:function(){for(var e=this.getItems(),t=e.length,r=this.getCheckResults()||[],i=r.length,n=0;n<i;++n)n<t?this.setItemData(e[n],r[n]):this.appendItem(r[n]);if(t>i)for(n=t-1;n>=i;--n){var o=e[n];this.removeItem(o)}},_getErrorLevelHtmlClass:function(e){var t=Kekule.ErrorLevel;return e===t.LOG||e===t.NOTE?r.MSG_INFO:e===t.WARNING?r.MSG_WARNING:r.MSG_ERROR}}),Kekule.Editor.IssueInspector=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Editor.IssueInspector",initialize:function(e){this._reactExecutorExecuteBind=this._reactExecutorExecute.bind(this),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("issueCheckExecutor",{dataType:"Kekule.IssueCheck.Executor",serializable:!1,setter:function(e){var t=this.getIssueCheckExecutor();e!==t&&(this.setPropStoreFieldValue("issueCheckExecutor",e),this._issueCheckExecutorChanged(t,e))}}),this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("checkResults",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getResultListView().getCheckResults()},setter:function(e){this.getResultListView().setCheckResults(e)}}),this.defineProp("selectedResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1,setter:null,getter:function(){return this.getResultListView().getSelectedResult()}}),this.defineProp("enableIssueSolutions",{dataType:DataType.BOOL,getter:function(){return this.getResultListView().getEnableIssueSolutions()},setter:function(e){this.getResultListView().setEnableIssueSolutions(e)}}),this.defineProp("resultListView",{dataType:"Kekule.ChemWidget.CheckResultListView",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("resolverCaller",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getResultListView().getResolverCaller()},setter:function(e){this.getResultListView().setResolverCaller(e)}})},doFinalize:function(){this._finalizeChildWidgets(),this.tryApplySuper("doFinalize")},_finalizeChildWidgets:function(){var e=this.getResultListView();e&&e.finalize(),this.setPropStoreFieldValue("resultListView",null)},_isUsingFlexLayout:function(){return!!Kekule.BrowserFeature.cssFlex},doGetWidgetClassName:function(){var e=i.ISSUE_INSPECTOR;return this._isUsingFlexLayout()&&(e+=" "+i.ISSUE_INSPECTOR_FLEX_LAYOUT),e},getChildrenHolderElement:function(){return this._listPanelElem||this.tryApplySuper("getChildrenHolderElement")},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,r){var n=this.tryApplySuper("doCreateSubElements",[e,r])||[],o=this._createSubPartElem(e);return t.addClass(o,i.ISSUE_INSPECTOR_LIST_PANEL),this._listPanelElem=o,r.appendChild(o),n.push(o),this._createChildWidgets(),n},_createSubPartElem:function(e){var t=e.createElement("div");return t.className=i.ISSUE_INSPECTOR_SUBPART,t},_createChildWidgets:function(){this._finalizeChildWidgets();var e=new Kekule.ChemWidget.CheckResultListView(this);e.setUseCornerDecoration(!0),e.appendToElem(this._listPanelElem);var t=this;e.addEventListener("selectionChange",function(r){if(r.target===e){var i,n=r.selectedItem;n&&(i=e.getItemData(n).checkResult),t.invokeEvent("selectResult",{selectedResult:i})}}),this.setPropStoreFieldValue("resultListView",e)},_issueCheckExecutorChanged:function(e,t){e&&e.removeEventListener("execute",this._reactExecutorExecuteBind),t&&t.addEventListener("execute",this._reactExecutorExecuteBind)},_reactExecutorExecute:function(e){this.setCheckResults(e.checkResults)},deselect:function(){this.getResultListView().clearSelection()}})}(),function(){"use strict";var e=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.ChemIdEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemIdEditor",getAttributes:function(){var t=this.tryApplySuper("getAttributes");return t&e.MULTIOBJS&&(t^=e.MULTIOBJS),t}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemIdEditor,null,Kekule.ChemObject,"id"),Kekule.PropertyEditor.ChemCoordSizeFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordSizeFieldEditor",initProperties:function(){this.defineProp("parentObjects",{dataType:DataType.Object,serializable:!1}),this.defineProp("parentPropName",{dataType:DataType.STRING,serializable:!1})},getCoordFieldValue:function(e,t,r){if(e.length){var i=e[0].getPropValue(t);if(i){for(var n=i[r],o=1,a=e.length;o<a;++o){if(e[o].getPropValue(t)[r]!==n)return}return n}}},getValue:function(){var e=this.getParentObjects(),t=this.getParentPropName();return e&&t?this.getCoordFieldValue(e,t,this.getPropertyName()):this.tryApplySuper("getValue")}}),Kekule.PropertyEditor.ChemCoordEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordEditor",is3DCoord:function(){return this.getPropertyName().indexOf("3")>=0},getFieldEditorClass:function(e,t){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function(e,t){var r=this.tryApplySuper("createFieldEditor",[e,t]);return r.setParentObjects&&r.setParentObjects(this.getObjects()),r.setParentPropName&&r.setParentPropName(this.getPropertyName()),r},getFieldValueType:function(e,t){return DataType.FLOAT},getObjFields:function(e){return this.is3DCoord()?["x","y","z"]:["x","y"]},getValueText:function(){var e=Kekule.Widget.ValueListEditor.ValueDisplayMode;if(this.getValueTextMode()===e.JSON)return this.tryApplySuper("getValueText");var t=this.getValue();if(t){for(var r=this.getObjFields(),i="",n=0,o=r.length;n<o;++n){var a=t[r[n]];Kekule.ObjUtils.notUnset(a)&&(i&&(i+=", "),i+=r[n]+": "+a)}return"{"+i+"}"}return""}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord2D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord3D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord2D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord3D"),Kekule.PropertyEditor.ChemSizeEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemSizeEditor",is3DSize:function(){return this.getPropertyName().indexOf("3")>=0},getFieldEditorClass:function(e,t){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function(e,t){var r=this.tryApplySuper("createFieldEditor",[e,t]);return r.setParentObjects&&r.setParentObjects(this.getObjects()),r.setParentPropName&&r.setParentPropName(this.getPropertyName()),r},getFieldValueType:function(e,t){return DataType.FLOAT},getObjFields:function(e){return this.is3DSize()?["x","y","z"]:["x","y"]},getValueText:function(){var e=Kekule.Widget.ValueListEditor.ValueDisplayMode;if(this.getValueTextMode()===e.JSON)return this.tryApplySuper("getValueText");var t=this.getValue();if(t){for(var r=this.getObjFields(),i="",n=0,o=r.length;n<o;++n){var a=t[r[n]];Kekule.ObjUtils.notUnset(a)&&(i&&(i+=", "),i+=r[n]+": "+a)}return"{"+i+"}"}return""}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size2D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size3D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"screenSize"),Kekule.PropertyEditor.ChemOptionObjectEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemOptionObjectEditor",CHILD_FIELD_INFOS:null,initialize:function(){this.tryApplySuper("initialize"),this.setAllowEmpty(!0)},getObjFieldInfos:function(e){for(var t=ClassEx.getCommonSuperClass(this.getObjects()),r=[],i=this.CHILD_FIELD_INFOS,n=0,o=i.length;n<o;++n){var a=i[n];a.targetClass&&t&&!ClassEx.isOrIsDescendantOf(t,a.targetClass)||r.push(a)}return r.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),r},notifyChildEditorValueChange:function(e,t){var r=this.getValue()||this._initialObjValue;r=Object.extend({},r),Kekule.ObjUtils.notUnset(t)?r[e]=t:delete r[e],this.setValue(r)}}),Kekule.PropertyEditor.ChemRender2DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender2DOptionsEditor",CHILD_FIELD_INFOS:Kekule.Render.RenderOptionUtils.getOptionDefinitions()}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender2DOptionsEditor,null,Kekule.ChemObject,"renderOptions"),Kekule.PropertyEditor.ChemRender3DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender3DOptionsEditor",CHILD_FIELD_INFOS:Kekule.Render.Render3DOptionUtils.getOptionDefinitions()}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender3DOptionsEditor,null,Kekule.ChemObject,"render3DOptions"),Kekule.PropertyEditor.GlyphPathParamsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathParamsEditor",CHILD_FIELD_INFOS:[{name:"lineCount",dataType:DataType.INT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"lineGap",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowType",dataType:DataType.STRING,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowType",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector}]}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.GlyphPathParamsEditor,null,Kekule.Glyph.PathGlyphConnector,"pathParams"),Kekule.PropertyEditor.GlyphPathNodeParamsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathNodeParamsEditor",CHILD_FIELD_INFOS:[{name:"useStickingOffset",dataType:DataType.BOOL,targetClass:Kekule.Glyph.PathGlyphNode},{name:"stickingOffsetRelLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphNode}]}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.GlyphPathNodeParamsEditor,null,Kekule.Glyph.PathGlyphNode,"pathNodeParams")}(),function(){Class.PropertyScope;var e=Kekule.ArrayUtils,t=(Kekule.ChemWidget,Kekule.Editor,Kekule.Widget.HtmlClassNames),r=Kekule.ChemWidget.HtmlClassNames,i=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER:"K-Chem-Composer",COMPOSER_GRID_LAYOUT:"K-Chem-Composer-Grid-Layout",COMPOSER_LANDSCAPE:"K-Chem-Composer-Landscape",COMPOSER_PORTRAIT:"K-Chem-Composer-Portrait",COMPOSER_EDITOR_STAGE:"K-Chem-Composer-Editor-Stage",COMPOSER_ADV_PANEL:"K-Chem-Composer-Adv-Panel",COMPOSER_ISSUE_PANEL:"K-Chem-Composer-Issue-Panel",COMPOSER_ISSUE_PANEL_WRAPPER:"K-Chem-Composer-Issue-Panel-Wrapper",COMPOSER_ISSUE_PANEL_TOOL_PANEL:"K-Chem-Composer-Issue-Panel-ToolPanel",COMPOSER_ISSUE_PANEL_INSPECTOR_REGION:"K-Chem-Composer-Issue-Panel-InspectorRegion",COMPOSER_TOP_REGION:"K-Chem-Composer-Top-Region",COMPOSER_LEFT_REGION:"K-Chem-Composer-Left-Region",COMPOSER_BOTTOM_REGION:"K-Chem-Composer-Bottom-Region",COMPOSER_TOOLBAR:"K-Chem-Composer-Toolbar",COMPOSER_COMMON_TOOLBAR:"K-Chem-Composer-Common-Toolbar",COMPOSER_ZOOM_TOOLBAR:"K-Chem-Composer-Zoom-Toolbar",COMPOSER_CHEM_TOOLBAR:"K-Chem-Composer-Chem-Toolbar",COMPOSER_ASSOC_TOOLBAR:"K-Chem-Composer-Assoc-Toolbar",COMPOSER_STYLE_TOOLBAR:"K-Chem-Composer-Style-Toolbar",COMPOSER_OBJMODIFIER_TOOLBAR:"K-Chem-Composer-ObjModifier-Toolbar",COMPOSER_FONTNAME_BOX:"K-Chem-Composer-FontName-Box",COMPOSER_FONTSIZE_BOX:"K-Chem-Composer-FontSize-Box",COMPOSER_NODEDISPLAYMODE_BOX:"K-Chem-Composer-NodeDisplayMode-Box",COMPOSER_COLOR_BOX:"K-Chem-Composer-Color-Box",COMPOSER_TEXTDIRECTION_BUTTON:"K-Chem-Composer-TextDirection-Button",COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT:"K-Chem-Composer-TextDirection-Button-Default",COMPOSER_TEXTDIRECTION_BUTTON_LTR:"K-Chem-Composer-TextDirection-Button-LTR",COMPOSER_TEXTDIRECTION_BUTTON_RTL:"K-Chem-Composer-TextDirection-Button-RTL",COMPOSER_TEXTDIRECTION_BUTTON_TTB:"K-Chem-Composer-TextDirection-Button-TTB",COMPOSER_TEXTDIRECTION_BUTTON_BTT:"K-Chem-Composer-TextDirection-Button-BTT",COMPOSER_TEXTALIGN_BUTTON:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL:"K-Chem-Composer-TextAlign-Button-Horizontal",COMPOSER_TEXTALIGN_BUTTON_VERTICAL:"K-Chem-Composer-TextAlign-Button-Vertical",COMPOSER_TEXTALIGN_BUTTON_DEFAULT:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_LEADING:"K-Chem-Composer-TextAlign-Button-Leading",COMPOSER_TEXTALIGN_BUTTON_TRAILING:"K-Chem-Composer-TextAlign-Button-Trailing",COMPOSER_TEXTALIGN_BUTTON_CENTER:"K-Chem-Composer-TextAlign-Button-Center",COMPOSER_TEXTALIGN_BUTTON_LEFT:"K-Chem-Composer-TextAlign-Button-Left",COMPOSER_TEXTALIGN_BUTTON_RIGHT:"K-Chem-Composer-TextAlign-Right",COMPOSER_TEXTALIGN_BUTTON_TOP:"K-Chem-Composer-TextAlign-Top",COMPOSER_TEXTALIGN_BUTTON_BOTTOM:"K-Chem-Composer-TextAlign-Bottom",COMPOSER_DIALOG:"K-Chem-ComposerDialog",COMPOSER_FRAME:"K-Chem-ComposerFrame",COMPOSER_FRAME_CONTENT_DOC:"K-Chem-ComposerFrame-ContentDoc",COMPOSER_FRAME_CONTENT_BODY:"K-Chem-ComposerFrame-ContentBody"}),Kekule.globalOptions.add("chemWidget.composer",{commonToolButtons:[i.newDoc,i.loadData,i.saveData,i.undo,i.redo,i.copy,i.cut,i.paste,i.zoomIn,i.zoomOut,i.config,i.objInspector],chemToolButtons:[i.manipulate,i.erase,i.molBond,i.molAtomAndFormula,i.molRing,i.molCharge,i.glyph,i.textImage],styleToolComponentNames:[i.fontName,i.fontSize,i.color,i.textDirection,i.textAlign]}),Kekule.Editor.ComposerStyleToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerStyleToolbar",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:Kekule.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:t.COLORPICKER_SPEC_COLOR_MIXED},LINKED_VALUE_FIELD:"__$value__",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("composer",e),this.createChildWidgets(),this.appendToWidget(e),this._relatedPropNames=e.getCoordMode()===Kekule.CoordMode.COORD3D?["renderOptions","render3DOptions"]:["renderOptions"],this.getEditor().addEventListener("selectionChange",function(e){this._isApplying||this.updateStyleValues()},this),this.getEditor().addEventListener("editObjChanged",function(e){var t=e.propNames;t&&t.length&&Kekule.ArrayUtils.intersect(this._relatedPropNames,t).length&&(this._isApplying||this.updateStyleValues())},this),this._isApplying=!1},doFinalize:function(){this.clearWidgets(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("fontNameBox",{dataType:"Kekule.Widget.ComboBox",serializable:!1,setter:null}),this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.ComboBox",serializable:!1,setter:null}),this.defineProp("colorBox",{dataType:"Kekule.Widget.ColorDropButton",serializable:!1,setter:null}),this.defineProp("textDirectionButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("textHorizontalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("textVerticalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("fontName",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getFontNameBox()?this.getFontNameBox().getValue():null},setter:function(e){this.getFontNameBox()&&this.getFontNameBox().setValue(e)}}),this.defineProp("fontSize",{dataType:DataType.NUMBER,serializable:!1,getter:function(){return this.getFontSizeBox()?parseFloat(this.getFontSizeBox().getValue()):null},setter:function(e){this.getFontSizeBox()&&this.getFontSizeBox().setValue(e)}}),this.defineProp("color",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getColorBox()?this.getColorBox().getValue():void 0},setter:function(e){this.getColorBox()&&this.getColorBox().setValue(e)}}),this.defineProp("textDirection",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextDirectionButtonSet())},setter:function(e){this._setButtonSetLinkedValue(this.getTextDirectionButtonSet(),e)}}),this.defineProp("textHorizontalAlign",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet())},setter:function(e){this._setButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet(),e)}}),this.defineProp("textVerticalAlign",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextVerticalAlignButtonSet())},setter:function(e){this._setButtonSetLinkedValue(this.getTextVerticalAlignButtonSet(),e)}}),this.defineProp("componentNames",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("componentNames");return e||(e=this.getDefaultComponentNames(),this.setPropStoreFieldValue("componentNames",e)),e},setter:function(e){this.setPropStoreFieldValue("componentNames",e),this.recreateComponents()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowGlyph(!0)},removeWidget:function(e,t){e===this.getFontNameBox()&&this.setPropStoreFieldValue("fontNameBox",null),e===this.getFontSizeBox()&&this.setPropStoreFieldValue("fontSizeBox",null),e===this.getColorBox()&&this.setPropStoreFieldValue("colorBox",null),e===this.getTextDirectionButtonSet()&&this.setPropStoreFieldValue("textDirectionButtonSet",null),e===this.getTextHorizontalAlignButtonSet()&&this.setPropStoreFieldValue("textHorizontalAlignButtonSet",null),e===this.getTextVerticalAlignButtonSet()&&this.setPropStoreFieldValue("textVerticalAlignButtonSet",null),this.tryApplySuper("removeWidget",[e,t])},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_TOOLBAR+" "+r.COMPOSER_STYLE_TOOLBAR},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},createChildWidgets:function(e){e||(e=this.getComponentNames());for(var t=0,n=e.length;t<n;++t){var o=e[t];if(o===i.fontName){var a=new Kekule.Widget.ComboBox(this);this.fillFontNameBox(a),a.addClassName(r.COMPOSER_FONTNAME_BOX),a.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME")),a.addEventListener("valueChange",function(e){this.applyFontName()},this),this.setPropStoreFieldValue("fontNameBox",a)}else if(o===i.fontSize)a=new Kekule.Widget.ComboBox(this),this.fillFontSizeBox(a),a.addClassName(r.COMPOSER_FONTSIZE_BOX),a.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE")),a.addEventListener("valueChange",function(e){this.applyFontSize()},this),this.setPropStoreFieldValue("fontSizeBox",a);else if(o===i.color){var s=new Kekule.Widget.ColorDropButton(this);s.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR")),s.setShowText(!1),s.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]),s.addClassName(r.COMPOSER_COLOR_BOX),s.addEventListener("valueChange",function(e){this.applyColor()},this),this.setPropStoreFieldValue("colorBox",s)}else if(o===i.textDirection){var l=Kekule.Render.TextDirection,u=[{value:l.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT},{value:l.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_LTR},{value:l.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_RTL},{value:l.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_TTB},{value:l.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_BTT}];(c=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION"),r.COMPOSER_TEXTDIRECTION_BUTTON,u)).addEventListener("select",function(e){this.applyTextDirection()},this),this.setPropStoreFieldValue("textDirectionButtonSet",c)}else if(o===i.textAlign){u=[{value:(d=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:r.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:d.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:r.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:d.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:r.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:d.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:r.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:d.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT"),className:r.COMPOSER_TEXTALIGN_BUTTON_LEFT},{value:d.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT"),className:r.COMPOSER_TEXTALIGN_BUTTON_RIGHT}];(c=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN"),r.COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL,u)).addEventListener("select",function(e){this.applyTextHorizontalAlign()},this),this.setPropStoreFieldValue("textHorizontalAlignButtonSet",c);var d,c;u=[{value:(d=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:r.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:d.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:r.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:d.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:r.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:d.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:r.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:d.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP"),className:r.COMPOSER_TEXTALIGN_BUTTON_TOP},{value:d.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM"),className:r.COMPOSER_TEXTALIGN_BUTTON_BOTTOM}];(c=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN"),r.COMPOSER_TEXTALIGN_BUTTON_VERTICAL,u)).addEventListener("select",function(e){this.applyTextVerticalAlign()},this),this.setPropStoreFieldValue("textVerticalAlignButtonSet",c)}}this.updateStyleValues()},_createStyleButtonSet:function(e,t,i,n){var o=new Kekule.Widget.CompactButtonSet(this);if(o.setText(e),o.setHint(t),o.addClassName(i),o.setShowText(!1),o.setShowCompactMark(!1),o.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),o.getButtonSet().addClassName(r.COMPOSER_STYLE_TOOLBAR),o.getButtonSet().setShowText(!0),n)for(var a=0,s=n.length;a<s;++a){var l=n[a],u=new Kekule.Widget.RadioButton(o,l.text||"");u.setHint(l.hint||""),u.addClassName(l.className),u[this.LINKED_VALUE_FIELD]=l.value,o.append(u,l.selected)}return o},_getButtonSetLinkedValue:function(e){var t=e?e.getSelected():null;return t?t[this.LINKED_VALUE_FIELD]:void 0},_setButtonSetLinkedValue:function(e,t){if(e){var r=e.getButtonSet().getChildWidgets();e.setSelected(null);for(var i=0,n=r.length;i<n;++i){var o=r[i];if(o.hasOwnProperty(this.LINKED_VALUE_FIELD)&&o[this.LINKED_VALUE_FIELD]==t){e.setSelected(o);break}}}},getDefaultComponentNames:function(){return Kekule.globalOptions.chemWidget.composer.styleToolComponentNames},recreateComponents:function(){var e=this.getComponentNames();this.clearWidgets(),this.createChildWidgets(e)},fillFontSizeBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes(),r=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:void 0}],i=0,n=t.length;i<n;++i)r.push({text:t[i]+" px",value:t[i]});e.setItems(r)},fillFontNameBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames(),r=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}],i=0,n=t.length;i<n;++i)r.push({text:t[i],value:t[i]});e.setItems(r)},applyStyle:function(e,t,r){this._isApplying=!0;try{this.getEditor().modifyObjectsRenderOptions(e,t,r,!0)}finally{this._isApplying=!1}},getStyleValue:function(e,t,r){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(e,t,r)},applyStyleToEditorSelection:function(e,t){var r=this.getEditor().getSelection();if(r&&r.length)return this.applyStyle(r,e,t)},applyFontName:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getFontName();this.applyStyle(e,{fontFamily:t})}},applyFontSize:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getFontSize();this.applyStyle(e,{fontSize:t})}},applyColor:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getColor();t===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value?this.applyStyle(e,{useAtomSpecifiedColor:!0,color:void 0}):(t==Kekule.Widget.ColorPicker.SpecialColors.UNSET&&(t=void 0),this.applyStyle(e,{useAtomSpecifiedColor:!1,color:t}))}},applyTextDirection:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getTextDirection();this.applyStyle(e,{charDirection:t})}},applyTextHorizontalAlign:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getTextHorizontalAlign();this.applyStyle(e,{horizontalAlign:t})}},applyTextVerticalAlign:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getTextVerticalAlign();this.applyStyle(e,{verticalAlign:t})}},updateStyleValues:function(e){e||(e=this.getEditor().getSelection()),e&&e.length&&(this.updateFontName(e),this.updateFontSize(e),this.updateColor(e),this.updateTextDirection(e),this.updateTextHorizontalAlign(e),this.updateTextVerticalAlign(e))},updateFontName:function(e){if(e&&e.length&&this.getFontNameBox()){var t=this.getStyleValue(e,"fontFamily");this.setFontName(t||"")}},updateFontSize:function(e){if(e&&e.length&&this.getFontSizeBox()){var t=this.getStyleValue(e,"fontSize");this.setFontSize(t||void 0)}},updateColor:function(e){if(e&&e.length&&this.getColorBox()){var t=this.getStyleValue(e,"useAtomSpecifiedColor"),r=this.getStyleValue(e,"color");this.getColorBox().setColorClassName(null),r?this.getColorBox().setColorClassName(null):t&&(r=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value,this.getColorBox().setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className)),this.setColor(r||void 0)}},updateTextDirection:function(e){if(e&&e.length&&this.getTextDirectionButtonSet()){var t=this.getStyleValue(e,"charDirection");this.setTextDirection(t)}},updateTextHorizontalAlign:function(e){if(e&&e.length&&this.getTextHorizontalAlignButtonSet()){var t=this.getStyleValue(e,"horizontalAlign");this.setTextHorizontalAlign(t)}},updateTextVerticalAlign:function(e){if(e&&e.length&&this.getTextVerticalAlignButtonSet()){var t=this.getStyleValue(e,"verticalAlign");this.setTextVerticalAlign(t)}},updateState:function(){var e=this.getEditor(),t=e&&e.hasSelection();this.getFontNameBox()&&this.getFontNameBox().setEnabled(t),this.getFontSizeBox()&&this.getFontSizeBox().setEnabled(t),this.getColorBox()&&this.getColorBox().setEnabled(t),this.getTextDirectionButtonSet()&&this.getTextDirectionButtonSet().setEnabled(t),this.getTextHorizontalAlignButtonSet()&&this.getTextHorizontalAlignButtonSet().setEnabled(t),this.getTextVerticalAlignButtonSet()&&this.getTextVerticalAlignButtonSet().setEnabled(t)}}),Kekule.Editor.ComposerObjModifierToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerObjModifierToolbar",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("modifiers",[]),this.setPropStoreFieldValue("modifierMap",new Kekule.MapEx),this.setPropStoreFieldValue("composer",e),this.appendToWidget(e),e.addEventListener("selectionChange",function(e){this._isApplying||this.updateModifierValues()},this),e.addEventListener("selectedObjsUpdated",function(t){this._isApplying||(e.getEditor().isManipulatingObject()?this._suppressUpdateModifierValuesInManipulation=!0:this.updateModifierValues())},this),e.addEventListener("endManipulateObject",function(e){this._suppressUpdateModifierValuesInManipulation&&(this.updateModifierValues(),this._suppressUpdateModifierValuesInManipulation=!1)},this),this._isApplying=!1},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("modifierMap",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("modifiers",{dataType:DataType.ARRAY,serializable:!1,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowGlyph(!0)},doFinalize:function(){this.clearWidgets(),this.getModifierMap().finalize();for(var e=this.getModifiers(),t=0,r=e.length;t<r;++t)e[t].finalize();this.tryApplySuper("doFinalize")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_TOOLBAR+" "+r.COMPOSER_OBJMODIFIER_TOOLBAR},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getAllowedModifierCategories:function(){var e=this.getComposer();return e&&e.getAllowedObjModifierCategories()},getTargetObjs:function(){return this.getEditor().getSelection()},getAvailableModifierClasses:function(){for(var t=[],r=this.getTargetObjs(),i=0,n=r.length;i<n;++i)r[i].getClass&&e.pushUnique(t,r[i].getClass());var o=[],a=this.getAllowedModifierCategories();for(i=0,n=t.length;i<n;++i){var s=Kekule.Editor.ObjModifierManager.getModifierClasses(t[i],a);s&&e.pushUnique(o,s)}return o.length&&o.sort(function(e,t){var r=e&&ClassEx.getPrototype(e),i=t&&ClassEx.getPrototype(t),n=r&&r.getModifierName&&r.getModifierName(),o=i&&i.getModifierName&&i.getModifierName();return n===o?0:n<o?-1:1}),o},getModifierInstanceOfClass:function(e,t){var r=this.getModifierMap(),i=r.get(e);return!i&&t&&(i=new e(this.getEditor()),r.set(e,i)),i},updateModifierWidgets:function(){var e=[];this.clearWidgets(!0);for(var r=this.getAvailableModifierClasses(),i=0,n=r.length;i<n;++i){var o=r[i],a=this.getModifierInstanceOfClass(o,!0),s=a.getWidget();s&&(this.appendWidget(s),e.push(a))}this.setPropStoreFieldValue("modifiers",e),this.updateModifierValues(),this._isAllModifierWidgetButtons(e)?this.removeClassName(t.TOOLBAR).addClassName(t.BUTTON_GROUP):this.removeClassName(t.BUTTON_GROUP).addClassName(t.TOOLBAR)},updateState:function(){this.updateModifierWidgets()},updateModifierValues:function(){for(var e=this.getModifiers(),t=0,r=e.length;t<r;++t)e[t].loadFromTargets()},_isAllModifierWidgetButtons:function(e){for(var t=0,r=e.length;t<r;++t){var i=e[t],n=i&&i.getWidget();if(n&&n.getDisplayed()&&!(n instanceof Kekule.Widget.Button))return!1}return!0}}),Kekule.Editor.Composer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.Composer",BINDABLE_TAG_NAMES:["div"],CHEM_TOOL_CHILD_FIELDS:"__$children__",initialize:function(e,t){this.updateSelectionAssocToolbarStateBind=this.updateSelectionAssocToolbarState.bind(this),this.setPropStoreFieldValue("enableIssueInspectorSolutions",!0),this.setPropStoreFieldValue("enableStyleToolbar",!0),this.setPropStoreFieldValue("enableObjModifierToolbar",!0),this.setPropStoreFieldValue("editor",t),this.setPropStoreFieldValue("editorNexus",new Kekule.Editor.EditorNexus),this.tryApplySuper("initialize",[e]),this.bindEditor(t);var r=this.getEditor();r&&r.setChemObj(r.getChemObj()),this.getCommonBtnGroup()||this.createCommonToolbar(),this.getChemBtnGroup()||this.createChemToolbar(),this.getZoomBtnGroup()||this.createZoomToolbar(),this.uiLayoutChanged()},doFinalize:function(){var e=this.getIssueInspector();e&&e.finalize();var t=this.getStructureTreeView();t&&t.finalize();var r,i=this.getObjInspector();i&&i.finalize(),(r=this.getCommonBtnGroup())&&r.finalize(),(r=this.getChemBtnGroup())&&r.finalize();var n=this.getPropStoreFieldValue("editor");n&&n.finalize(),this.getEditorNexus().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("editor");return e||(e=this.createDefaultEditor(),this.setPropStoreFieldValue("editor",e)),e}}),this.defineProp("autoSetMinDimension",{dataType:DataType.BOOL}),this.defineProp("showObjInspector",{dataType:DataType.BOOL,getter:function(){return(this.getAdvPanelDisplayedComponents()||[]).indexOf("objInspector")>=0},setter:function(t){if(this.getShowObjInspector()!==t){var r=this.getAdvPanelDisplayedComponents()||[];r=t?["objInspector"]:e.exclude(r,"objInspector"),this.setAdvPanelDisplayedComponents(r)}}}),this.defineProp("showIssueInspector",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getAdvPanelDisplayedComponents()||[]).indexOf("issueInspector")>=0},setter:function(t){if(this.getShowIssueInspector()!==t){var r=this.getAdvPanelDisplayedComponents()||[];if(r=t?["issueInspector"]:e.exclude(r,"issueInspector"),this.setAdvPanelDisplayedComponents(r),t){var i=this.getEditor();i&&(i.getEnableAutoIssueCheck()||i.checkIssues(),i.getIssueCheckResults()&&i.getIssueCheckResults().length&&i.deselectAll())}else{this.getIssueInspector().deselect()}}}}),this.defineProp("enableIssueInspectorSolutions",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableIssueInspectorSolutions",!!e),this.getIssueInspector()&&this.getIssueInspector().setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions())}}),this.defineProp("showInspector",{dataType:DataType.BOOL,getter:function(){return this.getShowObjInspector()},setter:function(e){this.setShowObjInspector(e)}}),this.defineProp("advPanelDisplayedComponents",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("advPanelDisplayedComponents",e),this.updateAdvPanelDisplayedComponents(e)}}),this.defineProp("editorStageElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("advPanelElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objInspectorHolderElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("issueInspectorHolderElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("topRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("leftRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("bottomRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("editorNexus",{dataType:"Kekule.Editor.EditorNexus",serializable:!1,setter:null}),this.defineProp("objInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:!1,setter:null}),this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:!1,setter:null}),this.defineProp("issueInspector",{dataType:"Kekule.Editor.IssueInspector",serializable:!1,setter:null}),this.defineProp("commonBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("zoomBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("chemBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("assocBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("styleToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("styleToolbar");return e||this.getEnableStyleToolbar()&&(e=this.createStyleToolbar(),this.setPropStoreFieldValue("styleToolbar",e)),e}}),this.defineProp("styleToolComponentNames",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getStyleToolbar();return e?e.getComponentNames():null},setter:function(e){var t=this.getStyleToolbar();return t&&t.setComponentNames(e),this}}),this.defineProp("enableStyleToolbar",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableStyleToolbar")&&!this.getEnableObjModifierToolbar()},setter:function(e){this.setPropStoreFieldValue("enableStyleToolbar",e),e&&this.setPropStoreFieldValue("enableObjModifierToolbar",!1),this.updateSelectionAssocToolbarState()}}),this.defineProp("objModifierToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("objModifierToolbar");return e||this.getEnableObjModifierToolbar()&&(e=this.createObjModifierToolbar(),this.setPropStoreFieldValue("objModifierToolbar",e)),e}}),this.defineProp("enableObjModifierToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableObjModifierToolbar",e),e&&this.setPropStoreFieldValue("enableStyleToolbar",!1),this.updateSelectionAssocToolbarState()}}),this.defineProp("allowedObjModifierCategories",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("allowedObjModifierCategories",e),this.updateObjModifierToolbarState()}}),this.defineProp("commonToolButtons",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("commonToolButtons");return e||(e=this.getDefaultCommonToolBarButtons(),this.setPropStoreFieldValue("commonToolButtons",e)),e},setter:function(e){this.setPropStoreFieldValue("commonToolButtons",e),this.updateCommonToolbar(),this.updateZoomToolbar()}}),this.defineProp("chemToolButtons",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("chemToolButtons");return e||(e=this.getDefaultChemToolBarButtons(),this.setPropStoreFieldValue("chemToolButtons",e)),e},setter:function(e){this.setPropStoreFieldValue("chemToolButtons",e),this.updateChemToolbar()}}),this.defineProp("styleBarComponents",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("styleBarComponents");return e||(e=null,this.setPropStoreFieldValue("styleBarComponents",e)),e},setter:function(e){this.setPropStoreFieldValue("styleBarComponents",e),this.getStyleToolbar()&&this.getStyleToolbar().setComponentNames(e)}}),this.defineProp("commonActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("commonActions");return e||(e=new Kekule.ActionList,this.setPropStoreFieldValue("commonActions",e)),e}}),this.defineProp("zoomActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("zoomActions");return e||(e=new Kekule.ActionList,this.setPropStoreFieldValue("zoomActions",e)),e}}),this.defineProp("chemActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("chemActions");return e||(e=new Kekule.ActionList,this.setPropStoreFieldValue("chemActions",e)),e}}),this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actionMap");return e||(e=new Kekule.MapEx,this.setPropStoreFieldValue("actionMap",e)),e}}),this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,getter:function(){var e=this.getEditor();return e&&e.getAllowCreateNewChild?e.getAllowCreateNewChild():null},setter:function(e){var t=this.getEditor();return t.setAllowCreateNewChild&&t.setAllowCreateNewChild(e),this}}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL,getter:function(){var e=this.getEditor();return e&&e.getAllowAppendDataToCurr?e.getAllowAppendDataToCurr():null},setter:function(e){var t=this.getEditor();return t.setAllowAppendDataToCurr&&t.setAllowAppendDataToCurr(e),this}}),this._defineEditorDelegatedProp("chemObj"),this._defineEditorDelegatedProp("chemObjData"),this._defineEditorDelegatedProp("chemObjLoaded"),this._defineEditorDelegatedProp("renderType"),this._defineEditorDelegatedProp("renderConfigs"),this._defineEditorDelegatedProp("drawOptions"),this._defineEditorDelegatedProp("allowCoordBorrow"),this._defineEditorDelegatedProp("editorConfigs"),this._defineEditorDelegatedProp("operHistory"),this._defineEditorDelegatedProp("enableOperHistory"),this._defineEditorDelegatedProp("selection"),this._defineEditorDelegatedProp("hotTrackedObjs"),this._defineEditorDelegatedProp("enableOperContext"),this._defineEditorDelegatedProp("enableCreateNewDoc"),this._defineEditorDelegatedProp("enableLoadNewFile"),this._defineEditorDelegatedProp("enableIssueCheck"),this._defineEditorDelegatedProp("enableAutoIssueCheck"),this._defineEditorDelegatedProp("initOnNewDoc")},_defineEditorDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(Kekule.Editor.BaseEditor,t),i=Object.create(r);return i.getter=null,i.setter=null,r.getter&&(i.getter=function(){return this.getEditor().getPropValue(t)}),r.setter&&(i.setter=function(e){this.getEditor().setPropValue(t,e)}),this.defineProp(e,i)},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r)try{var i=Kekule.IO.loadTypedData(t.data,t.resType,t.resUri);this.setChemObj(i)}catch(e){Kekule.raise(e,Kekule.ExceptionLevel.ERROR)}else Kekule.throwException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var i=[],n=this._doCreateSubElement(e,t,"div",r.COMPOSER_EDITOR_STAGE,"editorStageElem");return i.push(n),n=this._doCreateSubElement(e,t,"div",r.COMPOSER_ADV_PANEL,"advPanelElem"),this._doCreateSubElement(e,n,"div",null,"objInspectorHolderElem"),this._doCreateSubElement(e,n,"div",r.COMPOSER_ISSUE_PANEL,"issueInspectorHolderElem"),i.push(n),i.push(this._doCreateSubElement(e,t,"div",r.COMPOSER_TOP_REGION,"topRegionElem")),i.push(this._doCreateSubElement(e,t,"div",r.COMPOSER_LEFT_REGION,"leftRegionElem")),i.push(this._doCreateSubElement(e,t,"div",r.COMPOSER_BOTTOM_REGION,"bottomRegionElem")),i},_doCreateSubElement:function(e,t,r,i,n){var o=e.createElement(r);return i&&(o.className=i),t&&t.appendChild(o),n&&this.setPropStoreFieldValue(n,o),o},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER;return this._isUsingGridLayout()&&(e+=" "+r.COMPOSER_GRID_LAYOUT),e},_isUsingGridLayout:function(){return Kekule.BrowserFeature.cssGrid},elementBound:function(e){this.setObserveElemResize(!0)},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),e&&this.adjustComponentPositions()},getResizerElement:function(){return this.getEditorStageElem()},getChildActionClass:function(e,t){var r=this.tryApplySuper("getChildActionClass",[e,t]);return r||(r=this.getEditor().getChildActionClass(e,t)),r},getCoordMode:function(){return this.getEditor().getCoordMode()},isDirty:function(){return this.getEditor().isDirty()},newDoc:function(){return this.getEditor().newDoc()},load:function(e){return this.getEditor().load(e)},loadFromData:function(e,t,r,i,n){return this.getEditor().loadFromData(e,t,r,i)},loadFromFile:function(e){return this.getEditor().loadFromFile(e)},getSavingTargetObj:function(){var e=this.getEditor();return e?e.getSavingTargetObj():null},getExportableClasses:function(){return this.getEditor().getExportableClasses()},exportObj:function(e){return this.getEditor().exportObj(e)},exportObjs:function(e){return this.getEditor().exportObjs(e)},undo:function(){return this.getEditor().undo()},redo:function(){return this.getEditor().redo()},undoAll:function(){return this.getEditor().undoAll()},canUndo:function(){return this.getEditor().canUndo()},canRedo:function(){return this.getEditor().canRedo()},repaint:function(e){return this.getEditor().repaint(e),this},getBoundEditorAction:function(e){var t;return"string"==typeof e?t=this.getCompActionClass(e):ClassEx.isClass(e)&&(t=e),t?this.getActionMap().get(t):null},execBoundEditorAction:function(e){var t=this.getBoundEditorAction(e);return t&&t.execute(),t},uiLayoutChanged:function(){this.adjustComponentPositions()},doResize:function(){this.adjustComponentPositions()},adjustComponentPositions:function(){var e=this.getCommonBtnGroup()?this.getCommonBtnGroup().getElement():null,t=this.getZoomBtnGroup()?this.getZoomBtnGroup().getElement():null,i=this.getChemBtnGroup()?this.getChemBtnGroup().getElement():null;if(e&&i){if(e)var n=Kekule.HtmlElementUtils.getElemPageRect(e);if(t)var o=Kekule.HtmlElementUtils.getElemPageRect(t);if(i)var a=Kekule.HtmlElementUtils.getElemPageRect(i);if(n.width&&a.width){var s=n.height,l=a.width,u=o&&o.height||s,d=!this._isUsingGridLayout(),c=this.getTopRegionElem(),h=this.getBottomRegionElem(),p=this.getLeftRegionElem(),g=Kekule.HtmlElementUtils.getElemPageRect(this.getElement()),f=(Kekule.HtmlElementUtils.getElemPageRect(c),Kekule.HtmlElementUtils.getElemPageRect(h).width-(o?o.width:0)),C=Kekule.HtmlElementUtils.getElemPageRect(p).height-a.height,m=g.width;if(.85*g.height>m?(this.removeClassName(r.COMPOSER_LANDSCAPE),this.addClassName(r.COMPOSER_PORTRAIT)):(this.addClassName(r.COMPOSER_LANDSCAPE),this.removeClassName(r.COMPOSER_PORTRAIT)),d){(E=c.style).top="0px",E.left=l+"px",E.right="0px",E.height=s+"px",(E=h.style).bottom="0px",E.height=u+"px",E.left=l+"px",E.right="0px",(E=p.style).left="0px",E.top=s+"px",E.bottom="0px",E.width=l+"px";var T,E,_=s,S=l,O=u;if((this.getAdvPanelDisplayedComponents()||[]).length){var y=this.getAdvPanelElem();T=Kekule.HtmlElementUtils.getElemPageRect(y).width}else T=0;(E=this.getEditorStageElem().style).position="absolute",E.top=_+"px",E.left=S+"px",E.bottom=O+"px",E.right=T+"px",(E=(y=this.getAdvPanelElem()).style).position="absolute",E.top=_+"px",E.bottom=O+"px"}if(C/f>.9?this.changeAssocToolbarRegion(!0):this.changeAssocToolbarRegion(!1),this.getAutoSetMinDimension()){var A={width:l+n.width,height:s+a.height};A.width&&A.height&&this.setMinDimension(A)}}}},adjustAssocToolbarPositions:function(){this.adjustStyleAndObjModifierToolbarPosition()},adjustStyleAndObjModifierToolbarPosition:function(){},bindEditor:function(e){e?e.setParent(this):e=this.getEditor(),e.setTouchAction("none");var t=this.getCommonActions();this.getChemActions();this.createIaControllers(e),e.addEventListener("load",function(e){this.updateAllActions(),this.updateUiWidgets();var t=this.getChemActions().getActionAt(0);t&&t.execute()},this),e.addEventListener("operChange",function(e){t.updateAll(),this.updateUiWidgets()},this),e.addEventListener("selectionChange",function(e){t.updateAll(),this.updateUiWidgets()},this),e.addEventListener("change",function(e){e.changedPropNames.indexOf("enableAutoIssueCheck")>=0&&this.getIssueInspector().setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions())},this);var r=this;e.overwriteMethod("getChildAction",function(e,t,i){var n=r._getCreatedNamedAction(t);return n||(n=e(t,i)),n}),e.appendToElem(this.getEditorStageElem()),this.getEditorNexus().setEditor(e)},createDefaultEditor:function(){var e=new Kekule.Editor.ChemSpaceEditor(this,null,Kekule.Render.RendererType.R2D);return e.addClassName(t.DYN_CREATED),e},createIaControllers:function(e){for(var t=Kekule.Editor.IaControllerManager.getAvailableControllerClasses(e.getClass()),r=0,i=t.length;r<i;++r){var n=new(0,t[r])(e);e.addIaController(n.getDefId(),n)}},updateAdvPanelDisplayedComponents:function(e){if(e&&e.length){var t=e.indexOf("objInspector")>=0,r=e.indexOf("issueInspector")>=0;t||r?(t&&!this.getObjInspector()&&this._createObjInspectorControls(),r&&!this.getIssueInspector()&&this._createIssueInspectorControls(),this.getObjInspectorHolderElem().style.display=t?"block":"none",this.getIssueInspectorHolderElem().style.display=r?"block":"none",this.showAdvPanel()):this.hideAdvPanel()}else this.hideAdvPanel();this.uiLayoutChanged()},_createObjInspectorControls:function(e){e||(e=this.getObjInspectorHolderElem());var t=this.getDocument(),r=new Kekule.ChemWidget.StructureTreeView(t);r.setItemInitialExpanded(!0),r.appendToElem(e),r.setParent(this),this.setPropStoreFieldValue("structureTreeView",r);var i=new Kekule.Widget.ObjectInspector(t);i.setShowPropInfoPanel(!1),i.appendToElem(e),i.setParent(this),this.setPropStoreFieldValue("objInspector",i);var n=this.getEditorNexus();n.setObjectInspector(i),n.setStructureTreeView(r)},_createIssueInspectorControls:function(e){e||(e=this.getIssueInspectorHolderElem());var t=this.getDocument(),n=this._doCreateSubElement(t,e,"div",r.COMPOSER_ISSUE_PANEL_WRAPPER),o=this._doCreateSubElement(t,n,"div",r.COMPOSER_ISSUE_PANEL_TOOL_PANEL),a=this.getCommonActions();this.createToolButton(i.recheckIssues,this,a).setShowText(!1).setShowGlyph(!0).appendToElem(o),this.createToolButton(i.toggleShowAllIssues,this,a).setShowText(!1).setShowGlyph(!0).appendToElem(o);var s=this._doCreateSubElement(t,n,"div",r.COMPOSER_ISSUE_PANEL_INSPECTOR_REGION),l=new Kekule.Editor.IssueInspector(t);l.appendToElem(s),l.setParent(this).setResolverCaller(this.getEditor()).setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions());var u=this;l.addEventListener("resolveIssue",function(e){var t=e.solution;if(t){var r=t.getOperation();r&&u.getEditor().execOperation(r)}}),this.setPropStoreFieldValue("issueInspector",l),this.getEditorNexus().setIssueInspector(l)},getActualEnableIssueInspectorSolutions:function(){return this.getEnableIssueInspectorSolutions()&&this.getEnableAutoIssueCheck()},showAdvPanel:function(){this.getAdvPanelElem().style.display="block"},hideAdvPanel:function(){this.getAdvPanelElem().style.display="none"},getDefaultCommonToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.commonToolButtons},getZoomButtonNames:function(){return[i.zoomIn,i.zoomOut,i.reset,i.resetZoom]},getDefaultChemToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.chemToolButtons},getCompActionClass:function(e){return this.getChildActionClass(e,!0)},_getActionTargetWidget:function(e){return ClassEx.isOrIsDescendantOf(e,Kekule.Editor.ActionOnComposer)||ClassEx.isOrIsDescendantOf(e,Kekule.Widget.ActionOpenConfigWidget)?this:this.getEditor()},createToolButton:function(e,t,r,n){var o=null,a=DataType.isObjectValue(e)?e.name:e,s=this.getCompActionClass(a),l=this._createToolButtonAction(e,r,n);if(DataType.isObjectValue(e)&&!s){var u,d=n?Kekule.Widget.RadioButton:Kekule.Widget.Button;u=Object.extend({widget:d},e),o=Kekule.Widget.Utils.createFromHash(t,u)}else{var c=l.getPreferredWidgetClass&&l.getPreferredWidgetClass();o=new(c||(e===i.objInspector||e===i.issueInspector?Kekule.Widget.CheckButton:n?Kekule.Widget.RadioButton:Kekule.Widget.Button))(t)}return l&&(l.update(),o.setAction(l)),o},_createActionButton:function(e,t){var r=e.getCheckGroup(),i=e.getPreferredWidgetClass&&e.getPreferredWidgetClass(),n=new(i||(r?Kekule.Widget.RadioButton:Kekule.Widget.Button))(t);return e.update(),n.setAction(e),n},_createToolButtonAction:function(e,t,r){var i=DataType.isObjectValue(e),n=null,o=i?e.name:e,a=i?e.attached:null,s=this.getCompActionClass(o);if(i&&!s){var l=e;(s=l.actionClass)&&"string"==typeof s&&(s=ClassEx.findClass(l.actionClass))}if(s){var u=this.getActionMap();if(!(n=u.get(s))){n=new s(this._getActionTargetWidget(s));i&&(e.text&&n.setText(e.text),e.hint&&n.setHint(e.hint),(e.htmlClass||e.htmlClassName)&&n.setHtmlClassName((n.getHtmlClassName()||"")+(e.htmlClass||e.htmlClassName))),u.set(s,n)}var d=r||"",c=n.getExplicitGroup&&n.getExplicitGroup();if(Kekule.ObjUtils.notUnset(c)&&(d=c),d&&n.setCheckGroup(d),n&&t&&t.add(n),n&&n.addAttachedAction){var h=n.getClassName(),p=Kekule.ArrayUtils.clone(n.getAttachedActions().getActions()||[]),g=function(e,t,r,i,n){if(!t)return null;var o=r.indexOf(t);o>=0?r[o]=null:e.addAttachedAction(t,i),Kekule.ObjUtils.notUnset(n)&&e.setAttachedActionIndex(t,n)};if(a)for(var f=0,C=a.length;f<C;++f){var m=a[f],T=this._createToolButtonAction(m,null,h),E=n.getDefaultAttachedActionClass()===T.getClass()||0===f;g(n,T,p,E,f)}else{var _=n.getAttachedActionClasses();if(_)for(f=0,C=_.length;f<C;++f){var S=_[f];if(!(T=u.get(S))){var O=(T=new S(this._getActionTargetWidget(S))).getExplicitGroup&&T.getExplicitGroup();Kekule.ObjUtils.notUnset(O)?T.setCheckGroup(O):T.setCheckGroup(h),u.set(S,T)}E=n.getDefaultAttachedActionClass()===T.getClass()||0===f;g(n,T,p,E,f)}}if(p.length)for(f=0,C=p.length;f<C;++f){var y=p[f];y&&(n.removeAttachedAction(y),u.remove(y.getClass()))}}}return n},_getCreatedNamedAction:function(e){var t=this.getCompActionClass(e),r=this.getActionMap();return t&&r.get(t)},createInnerToolbar:function(e,i){var n=new Kekule.Widget.ButtonGroup(this);n.addClassName(r.COMPOSER_TOOLBAR),n.addClassName(r.INNER_TOOLBAR),n.addClassName(t.DYN_CREATED),n.setShowText(!1),n.doSetShowGlyph(!0);var o=e||this.getElement();if(i){var a=Kekule.DomUtils.getFirstChildElem(o);a?n.insertToElem(o,a):n.appendToElem(o)}else n.appendToElem(o);return n.setBubbleUiEvents(!0),n},createCommonToolbar:function(){var e=this.getTopRegionElem(),i=this.createInnerToolbar(e);i.addClassName(r.COMPOSER_COMMON_TOOLBAR);var n=this.getCommonToolButtons();n=Kekule.ArrayUtils.exclude(n,this.getZoomButtonNames());var o=this.getCommonActions();this.getEditor();o.clear();for(var a=0,s=n.length;a<s;++a){var l=n[a];this.createToolButton(l,i,o)}return this.setCommonBtnGroup(i),i.addClassName(t.DYN_CREATED),this.updateZoomToolbar(),this.adjustComponentPositions(),i},createZoomToolbar:function(){var e=Kekule.ArrayUtils.intersect(this.getCommonToolButtons(),this.getZoomButtonNames());if(e.length){var i=this.getBottomRegionElem(),n=this.createInnerToolbar(i);n.addClassName(r.COMPOSER_ZOOM_TOOLBAR);var o=this.getZoomActions();this.getEditor();o.clear();for(var a=0,s=e.length;a<s;++a){var l=e[a];this.createToolButton(l,n,o)}return this.setZoomBtnGroup(n),n.addClassName(t.DYN_CREATED),this.adjustComponentPositions(),n}return this.setZoomBtnGroup(null),null},updateCommonToolbar:function(){var e=this.getCommonBtnGroup();e&&e.finalize(),this.createCommonToolbar()},updateZoomToolbar:function(){var e=this.getZoomBtnGroup();e&&e.finalize(),this.createZoomToolbar()},createChemToolbar:function(){var e=this.getLeftRegionElem(),i=this.createInnerToolbar(e,!0);i.addClassName(r.COMPOSER_CHEM_TOOLBAR),i.setLayout(Kekule.Widget.Layout.VERTICAL);var n=this.getChemToolButtons(),o=this.getChemActions();o.clear();for(var a,s=0,l=n.length;s<l;++s){var u=n[s],d=this.createToolButton(u,i,o,"chemTools");0===s&&(a=d)}if(this.setChemBtnGroup(i),i.addClassName(t.DYN_CREATED),this.adjustComponentPositions(),a){var c=a.getAction();if(c){c.setChecked(!0);var h=c.getAttachedActions&&c.getAttachedActions();this.bindAssocActions(h||null)}}return i},updateChemToolbar:function(){var e=this.getChemBtnGroup();e&&e.finalize(),this.createChemToolbar()},createAssocToolbar:function(){var e=this.getBottomRegionElem(),i=this.createInnerToolbar(e);return i.addClassName(r.COMPOSER_ASSOC_TOOLBAR),this.setAssocBtnGroup(i),this.adjustAssocToolbarPositions(),i.addClassName(t.DYN_CREATED),i},changeAssocToolbarRegion:function(e){var t,r=this.getAssocBtnGroup();if(r||(r=this.createAssocToolbar()),e)t=this.getLeftRegionElem(),r.getElement().parentNode!==t&&(r.setLayout(Kekule.Widget.Layout.VERTICAL),r.appendToElem(t));else if(t=this.getBottomRegionElem(),r.getElement().parentNode!==t){r.setLayout(Kekule.Widget.Layout.HORIZONTAL);var i=Kekule.DomUtils.getFirstChildElem(t);t.insertBefore(r.getElement(),i)}},showAssocToolbar:function(){var e=this.getAssocBtnGroup();e||(e=this.createAssocToolbar());var t=this;return e.show(null,function(){t.uiLayoutChanged(),setTimeout(t.updateSelectionAssocToolbarStateBind,0)}),this},hideAssocToolbar:function(){var e=this.getAssocBtnGroup();if(e){var t=this;e.hide(null,function(){t.uiLayoutChanged(),setTimeout(t.updateSelectionAssocToolbarStateBind,0)})}return this},isAssocToolbarShown:function(){var e=this.getAssocBtnGroup();return e&&e.isShown()},bindAssocActions:function(e){var t=this.getAssocBtnGroup();if(t||(t=this.createAssocToolbar()),t.clearWidgets(),e)for(var r=0,i=e.getActionCount();r<i;++r){var n=e.getActionAt(r);this._createActionButton(n,t)}},createObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var e=new Kekule.Editor.ComposerObjModifierToolbar(this);return e.appendToElem(this.getBottomRegionElem()),e.setBubbleUiEvents(!0),this.setObjModifierToolbar(e),this.adjustAssocToolbarPositions(),this.updateObjModifierToolbarState(),e}return null},showObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var e=this.getObjModifierToolbar();if(!e.isShown()){var t=this;e.show(null,function(){t.uiLayoutChanged()})}}return this},hideObjModifierToolbar:function(){var e=this.getPropStoreFieldValue("objModifierToolbar");if(e&&e.isShown()){var t=this;e.hide(null,function(){t.uiLayoutChanged()},null,{instantly:!0})}return this},isObjModifierToolbarShown:function(){var e=this.getPropStoreFieldValue("objModifierToolbar");return e&&e.isShown()},updateObjModifierToolbarState:function(){var e=!1;this.getEnableObjModifierToolbar()&&this.needShowSelectionAssocToolbar()&&(e=!0),e?(this.showObjModifierToolbar(),this.getObjModifierToolbar().updateState()):this.hideObjModifierToolbar()},createStyleToolbar:function(){if(this.getEnableStyleToolbar()){var e=new Kekule.Editor.ComposerStyleToolbar(this);return e.setComponentNames(this.getStyleBarComponents()),e.appendToElem(this.getBottomRegionElem()),e.setBubbleUiEvents(!0),this.setStyleToolbar(e),this.adjustAssocToolbarPositions(),this.updateStyleToolbarState(),e}return null},showStyleToolbar:function(){if(this.getEnableStyleToolbar()){var e=this.getStyleToolbar();if(!e.isShown()){var t=this;e.show(null,function(){t.uiLayoutChanged()})}}return this},hideStyleToolbar:function(){var e=this.getPropStoreFieldValue("styleToolbar");if(e&&e.isShown()){var t=this;e.hide(null,function(){t.uiLayoutChanged()})}return this},isStyleToolbarShown:function(){var e=this.getPropStoreFieldValue("styleToolbar");return e&&e.isShown()},updateStyleToolbarState:function(){this.getEnableStyleToolbar()&&this.needShowSelectionAssocToolbar()?(this.showStyleToolbar(),this.getStyleToolbar().updateState()):this.hideStyleToolbar()},needShowSelectionAssocToolbar:function(){var e=this.getEditor();return e&&e.hasSelection()},updateSelectionAssocToolbarState:function(){this.adjustStyleAndObjModifierToolbarPosition(),this.updateStyleToolbarState(),this.updateObjModifierToolbarState()},updateAllActions:function(){this.getCommonActions().updateAll(),this.getZoomActions().updateAll(),this.getChemActions().updateAll()},updateUiWidgets:function(){this.updateStyleToolbarState(),this.updateObjModifierToolbarState()},createConfigurator:function(){var e=this.tryApplySuper("createConfigurator");return e.addEventListener("configChange",function(e){this.getEditor().repaint()},this),e},react_keydown:function(e){if(!this.tryApplySuper("react_keydown",[e])&&this._isAcceptableHotKeyEvent(e))return!!this.getEditor().reactHotKeys(e)},_isAcceptableHotKeyEvent:function(e){var t=!1,r=e.getTarget();if(r&&r.tagName&&["input","select"].indexOf(r.tagName.toLowerCase())<0){var i=e.getKey()||"";t=Kekule.Widget.KeyboardUtils.isPrintableKey(i)&&" "!==i||"Backspace"===i||"Delete"===i||"Del"===i}return t}}),Kekule.Editor.Composer.getMinPreferredDimension=function(){return{width:630,height:350}},Kekule.Editor.Composer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.Editor.Composer.Settings",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineDelegatedProps(["enableCreateNewDoc","enableLoadNewFile","initOnNewDoc","enableOperHistory","allowCreateNewChild","allowAppendDataToCurr","enableIssueCheck","enableStyleToolbar","enableObjModifierToolbar"])}}),Kekule.Editor.Composer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.Editor.Composer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var e=this.tryApplySuper("getCategoryInfos"),t=this.getComposer().getEditor(),r=[t.getDisplayerConfigs(),t.getRenderConfigs()],i=0,n=r.length;i<n;++i)for(var o=r[i],a=o.getPropListOfScopes([Class.PropertyScope.PUBLISHED]),s=0,l=a.getLength();s<l;++s){var u=a.getPropInfoAt(s),d=o.getPropValue(u.name);d&&e.push({obj:d,name:u.name,title:u.title,description:u.description})}return e},getComposer:function(){return this.getWidget()},getEditor:function(){return this.getComposer().getEditor()}}),Kekule._registerAfterLoadSysProc(function(){var e=Kekule.Editor.ObjModifier.Category,t=Kekule.ObjPropSettingManager;t.register("Kekule.Editor.Composer.fullFunc",{enableObjModifierToolbar:!0,enableOperHistory:!0,enableLoadNewFile:!0,enableCreateNewDoc:!0,allowCreateNewChild:!0,commonToolButtons:null,chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null}),t.register("Kekule.Editor.Composer.molOnly",{enableObjModifierToolbar:!0,enableOperHistor:!0,enableLoadNewFile:!0,enableCreateNewDoc:!0,allowCreateNewChild:!0,commonToolButtons:null,chemToolButtons:[i.manipulate,i.erase,i.molBond,i.molAtom,i.molRing,i.molCharge],styleToolComponentNames:null,allowedObjModifierCategories:[e.GENERAL,e.CHEM_STRUCTURE]}),t.register("Kekule.Editor.Composer.compact",{enableObjModifierToolbar:!0,commonToolButtons:[i.newDoc,i.loadData,i.saveData,i.undo,i.redo,i.zoomIn,i.zoomOut],chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null}),t.register("Kekule.Editor.Composer.singleObj",{allowCreateNewChild:!1})}),Kekule.Editor.ComposerDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.Editor.ComposerDialog",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,getter:function(){var e=this.getComposer();return e&&e.getChemObj()},setter:function(e){var t=this.getComposer();t&&t.setChemObj(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_DIALOG},doCreateClientContents:function(e){this.tryApplySuper("doCreateClientContents");var t=this.doCreateComposerWidget();this.setPropStoreFieldValue("composer",t),t.appendToElem(e)},getSavingTargetObj:function(){var e=this.getComposer();return e?e.getSavingTargetObj():null},doCreateComposerWidget:function(){var e=new Kekule.Editor.Composer(this);return e.addClassName(t.DYN_CREATED),e.setResizable&&e.setResizable(!0),e.getEditor().addClassName(t.DYN_CREATED),e}}),Kekule.Editor.ComposerFrame=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.ComposerFrame",BINDABLE_TAG_NAMES:["iframe"],initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null}),this.defineProp("frameDocument",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.getElement().contentDocument}}),this.defineProp("frameWindow",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return Kekule.DocumentUtils.getDefaultView(this.getFrameDocument())}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMinDimension({width:550,height:350}),this.setEnableDimensionTransform(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_FRAME},doCreateRootElement:function(e){return e.createElement("iframe")},doBindElement:function(e){(this.tryApplySuper("doBindElement",[e]),e.parentNode)||(this.setDisplayed(!1),e.ownerDocument.body.appendChild(e));this._createComposerWidgetInFrame()},_initFrame:function(){var e=this.getFrameDocument();e.open("text/htmlreplace"),e.write("<!DOCTYPE html><html><head></head><body></body></html>"),e.close()},_createComposerWidgetInFrame:function(e){this._initFrame();var t=this,i=this.getFrameDocument();i.documentElement.className=r.COMPOSER_FRAME_CONTENT_DOC,i.body.className=r.COMPOSER_FRAME_CONTENT_BODY,Kekule.X.Event.addListener(i.body,"kekuleload",function(r){var n=new Kekule.Editor.Composer(i);n.appendToElem(i.body),t.setPropStoreFieldValue("composer",n),e&&e(n)}),this._insertKekuleScriptAndStyleSheetFiles(i)},_insertKekuleScriptAndStyleSheetFiles:function(e,t){var r=e.head,i=e.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",Kekule.getStyleSheetUrl()),r.appendChild(i),Kekule.ScriptFileUtils.appendScriptFile(e,Kekule.getScriptSrc(),t)}})}(),function(){"use strict";if("undefined"!=typeof HTMLElement){Kekule.WebComponent={},Kekule.globalOptions.add("webComponent.init",{shadowInitOptions:{mode:"open"}}),Kekule.globalOptions.add("webComponent.widgetWrapper",{exposeWidgetProperties:!0,exposeWidgetMethods:!1,ignoredProperties:["id","draggable","droppable","innerHTML","style","offsetParent","offsetLeft","offsetTop","offsetWidth","offsetHeight"],ignoredMethods:["constructor","initialize","finalize","doFinalize","afterInitialization","initProperties","initPropValues","saved","loaded","invokeEvent"]});Kekule.WebComponent;var e=Kekule.DomUtils;Kekule.WebComponent.WebComponentContextEventRelayer=Class.create(Kekule.Widget.BaseEventsReceiver,{CLASS_NAME:"Kekule.WebComponent.WebComponentContextEventRelayer",initialize:function(t,r,i){this._globalManager=i,this.tryApplySuper("initialize",[t,r]),this._isInShadow=r&&e.isInShadowRoot(r),this._globalManager.setHasWebComponentContext(!0)},isInShadow:function(){return this._isInShadow},reactUiEvent:function(e){var t=this.tryApplySuper("reactUiEvent",[e]);return this.isInShadow()&&(t=this._globalManager.reactUiEvent(e),e.stopPropagation()),t},reactDomNodeInsertEvent:function(e){return this.isInShadow()?(e.stopPropagation(),this._globalManager.reactDomNodeInsertEvent(e)):this.tryApplySuper("reactDomNodeInsertEvent",[e])},reactDomNodeRemoveEvent:function(e){return this.isInShadow()?(e.stopPropagation(),this._globalManager.reactDomNodeRemoveEvent(e)):this.tryApplySuper("reactDomNodeRemoveEvent",[e])},reactDomMutation:function(e){return this.isInShadow()?this._globalManager.reactDomMutation(e):this.tryApplySuper("reactDomMutation")}});class t extends HTMLElement{constructor(){super();var e=this.attachShadow(Kekule.globalOptions.webComponent.init.shadowInitOptions);this._initStyles(e),this._importStyleSheet(e),this._createSubElements(e);new Kekule.WebComponent.WebComponentContextEventRelayer(this.ownerDocument,this.hostElem,Kekule.Widget.globalManager)}_createSubElements(e){var t=this.ownerDocument.createElement("div");e.appendChild(t),this._hostElem=t}_importStyleSheet(e){Kekule.Widget.globalManager.loadTheme(e)}_initStyles(e){var t=e.ownerDocument.createElement("style");t.innerHTML=":host { position: static; width: 0px; height: 0px; left: 0px; top: 0px; }",e.appendChild(t)}ensureToBeLast(){var e=this.ownerDocument.body;e.lastChild!==this&&e.appendChild(this)}get hostElem(){return this._hostElem}}Kekule.WebComponent.WebComponentContextPopupHost=t,"undefined"!=typeof customElements&&customElements.define("kekule-webcomponent-popup-host",t),Kekule.WebComponent.widgetWrapperPopupHost=null,ClassEx.extend(Kekule.Widget.GlobalManager,{getWebComponentContextRootElem:function(){return Kekule.WebComponent.widgetWrapperPopupHost||(Kekule.WebComponent.widgetWrapperPopupHost=new t,document.body.appendChild(Kekule.WebComponent.widgetWrapperPopupHost)),Kekule.WebComponent.widgetWrapperPopupHost.ensureToBeLast(),Kekule.WebComponent.widgetWrapperPopupHost.hostElem},isWidgetEnvironmentSetupIn:function(e){return"webComponent"===e?!!this.getHasWebComponentContext():(this._docContextEnvironmentSetup||this._detectIfThemeLoaded(this.getDocContextRootElem())&&(this._docContextEnvironmentSetup=!0),this._docContextEnvironmentSetup)}}),ClassEx.extendMethod(Kekule.Widget.GlobalManager,"getWidgetContextRootElement",function($origin,e){return e&&e.isWrappedInWebComponent()?this.getWebComponentContextRootElem():$origin(e)}),ClassEx.extendMethod(Kekule.Widget.GlobalManager,"getDefaultContextRootElem",function($origin){return this.isWidgetEnvironmentSetupIn("document")?this.getDocContextRootElem():this.isWidgetEnvironmentSetupIn("webComponent")?this.getWebComponentContextRootElem():$origin()}),ClassEx.defineProp(Kekule.Widget.GlobalManager,"hasWebComponentContext",{dataType:DataType.BOOL,serializable:!1}),ClassEx.extend(Kekule.Widget.BaseWidget,{isWrappedInWebComponent:function(){if("undefined"==typeof ShadowRoot)return!1;var e=this.getElement(),t=e.getRootNode&&e.getRootNode();return!!(t&&t instanceof ShadowRoot)}}),Kekule.WebComponent.BaseWidgetWrapper=class extends HTMLElement{constructor(){super();var e=this.attachShadow(Kekule.globalOptions.webComponent.init.shadowInitOptions);this._shadow=e;var t=this._createWidget(this.constructor.widgetClass,e);this._prepareStyles(e);new Kekule.WebComponent.WebComponentContextEventRelayer(this.ownerDocument,t.getElement(),Kekule.Widget.globalManager);this._reflectingChangedAttributes=[]}connectedCallback(){for(var e=this.getAttributeNames(),t=this.constructor.observedAttributes,r=0,i=(e=Kekule.ArrayUtils.intersect(e,t)).length;r<i;++r){var n=this.getAttribute(e[r]);this._setWidgetPropValueFromAttribute(e[r],n)}}static get observedAttributes(){var e=[];if(this._exposedWidgetProperties)for(var t=0,r=this._exposedWidgetProperties.length;t<r;++t){var i=this._exposedWidgetProperties[t].name;e.push(i.dasherize()),e.push("data-"+i.dasherize())}return e}attributeChangedCallback(e,t,r){if(!this._isChangingPropFromAttribute(e))try{this._reflectingChangedAttributes.push(e),this._setWidgetPropValueFromAttribute(e,r)}finally{Kekule.ArrayUtils.remove(this._reflectingChangedAttributes,e)}}_setWidgetPropValueFromAttribute(e,t){Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this.widget,e,t)}_isChangingPropFromAttribute(e){return this._reflectingChangedAttributes.indexOf(e)>=0}static get widgetClass(){return this._widgetClass}static set widgetClass(e){this._widgetClass=e}static _exposeWidgetProperties(e,t,r){for(var i=r||{},n=this.widgetClass,o=ClassEx.getAllPropList(n),a=[],s=[],l=0,u=o.getLength();l<u;++l){var d=o.getPropInfoAt(l);if(!(d.scope<Class.PropertyScope.PUBLIC)&&(!(e&&e.indexOf(d.name)<0)&&!(t&&t.indexOf(d.name)>=0)&&(!Kekule.ObjUtils.getPropertyDescriptor(this.prototype,d.name,!0)||i.overwriteExisitedProperties))){a.push(d);var c={enumerable:d.enumerable,configurable:!1};if(void 0===c.enumerable&&(c.enumerable=!0),d.getter){d.getter;var h="get"+d.name.upperFirst();!function(e,t){t.get=function(){return this.widget.getPropValue(e)}}(d.name,c),s.push(h)}if(d.setter){d.setter;var p="set"+d.name.upperFirst();!function(e,t){t.set=function(t){var r=this.widget.setPropValue(e,t),i=this.widget.getPropValue(e);return this._exposedPropValueChanged(e,i),r}}(d.name,c),s.push(p)}try{Object.defineProperty(this.prototype,d.name,c)}catch(e){throw e}}}return this._exposedWidgetProperties=a,{exposedPropInfos:a,getterSetterMethodNames:s}}static _exposeWidgetMethods(e,t,r){for(var i=this.widgetClass,n=(ClassEx.getPrototype(i),function e(t,r){var i=function(e){for(var t=ClassEx.getPrototype(e),r=ClassEx.getSuperClass(e),i=(r&&ClassEx.getPrototype(r),Object.getOwnPropertyNames(t)),n=[],o=0,a=i.length;o<a;++o){var s=i[o],l=Object.getOwnPropertyDescriptor(t,s);l&&l.value&&"function"==typeof l.value&&n.push(s)}return n}(t);if(t!==r){var n=ClassEx.getSuperClass(t);n&&(i=e(n,r).concat(i))}return i}(i,Kekule.Widget.BaseWidget)),o=ClassEx.getPrototype(ClassEx.getSuperClass(Kekule.Widget.BaseWidget)),a=[],s=0,l=n.length;s<l;++s){var u=n[s],d=e&&e.indexOf(u)>=0;if(!(t&&t.indexOf(u)>=0)&&(!(e&&e.indexOf(u)<0)&&(d||!(u in o))&&(d||!u.startsWith("_"))&&!Object.getOwnPropertyDescriptor(u))){try{if(u in this)continue}catch(e){}!function(e,t,r){e.prototype[t]=function(){return this.widget[t].apply(this.widget,arguments)},r.push(t)}(this,u,a)}}return a}_createWidget(e,t){this._widget=new e(this.ownerDocument),this._widget.beginUpdate();try{var r=this._widget.getElement().style;r.width="100%",r.height="100%",this._widget.appendToElem(t)}finally{this._widget.endUpdate()}return this._widget}_prepareStyles(e){Kekule.Widget.globalManager.loadTheme(e);var t=e.ownerDocument.createElement("style");t.innerHTML=":host { display: inline-block; position: relative; vertical-align: bottom; }\n:host([hidden]) { display: none }",e.appendChild(t)}_exposedPropValueChanged(e,t){if(this.widget.getPropInfo(e)&&DataType.isSimpleValue(t)){var r=e.dasherize();this.setAttribute(r,t)}}get widgetHost(){return this._shadow}get widget(){return this._widget}},Kekule.WebComponent.Utils={wrapWidget:function(e,t,r){var i,n=Kekule.globalOptions.webComponent.widgetWrapper,o=Object.extend({exposeWidgetProperties:n.exposeWidgetProperties,ignoredProperties:n.ignoredProperties,exposeWidgetMethods:n.exposeWidgetMethods,ignoredMethods:n.ignoredMethods},r||{}),a=class extends Kekule.WebComponent.BaseWidgetWrapper{constructor(){super()}};if(a.widgetClass=e,o.exposeWidgetProperties&&(i=a._exposeWidgetProperties(o.exposedProperties,o.ignoredProperties,{overwriteExisitedProperties:o.overwriteExisitedProperties})),o.exposeWidgetMethods){var s=o.ignoredMethods||[];i&&(s=s.concat(i.getterSetterMethodNames)),a._exposeWidgetMethods(o.exposedMethods,s,{})}return t&&"undefined"!=typeof customElements&&customElements.define(t,a),a}}}}(),function(){"use strict";var e=[{widgetClassName:"Kekule.ChemWidget.PeriodicTable",htmlTagName:"kekule-periodic-table"},{widgetClassName:"Kekule.ChemWidget.Viewer",htmlTagName:"kekule-viewer"},{widgetClassName:"Kekule.ChemWidget.Viewer2D",htmlTagName:"kekule-viewer2d"},{widgetClassName:"Kekule.ChemWidget.Viewer3D",htmlTagName:"kekule-viewer3d"},{widgetClassName:"Kekule.ChemWidget.SpectrumInspector",htmlTagName:"kekule-spectrum-inspector"},{widgetClassName:"Kekule.ChemWidget.ChemObjInserter",htmlTagName:"kekule-chem-obj-inserter"},{widgetClassName:"Kekule.ChemWidget.SpectrumObjInserter",htmlTagName:"kekule-spectrum-obj-inserter"},{widgetClassName:"Kekule.Editor.Composer",htmlTagName:"kekule-composer"}];Kekule._registerAfterLoadSysProc(function(){if(Kekule.WebComponent&&Kekule.WebComponent.Utils)for(var t=Kekule.WebComponent,r=0,i=e.length;r<i;++r){var n=e[r],o=Object.getCascadeFieldValue(n.widgetClassName,Kekule.$jsRoot),a=n.htmlTagName;if(o&&a){var s=Kekule.ClassUtils.getLastClassName(n.widgetClassName),l=Kekule.WebComponent.Utils.wrapWidget(o,a);t[s]=l}}})}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.GraphElement=Class.create(ObjectEx,{CLASS_NAME:"Kekule.GraphElement",initialize:function(){this.tryApplySuper("initialize"),this._data={}},initProperties:function(){this.defineProp("storedData",{dataType:DataType.HASH,getter:function(){return this._data},setter:function(e){this._data=e||{}}})},getData:function(e){return e?this._data[e]:this._data},setData:function(e,t){return e&&(this._data[e]=t),this},removeData:function(e){return this._data[e]&&delete this._data[e],this}}),Kekule.GraphVertex=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphVertex",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("edges",{dataType:DataType.ARRAY,serializable:!1,setter:null})},getEdgeCount:function(){return this.getEdges().length},getNeighbors:function(){for(var t=[],r=this.getEdges(),i=0,n=r.length;i<n;++i){var o=r[i].getVertexes();e.pushUnique(t,e.exclude(o,this))}return t},getNeighborOnEdge:function(e){for(var t=e.getVertexes(),r=0,i=t.length;r<i;++r)if(t[r]!==this)return t[r]},getEdgeTo:function(e){for(var t=this.getEdges(),r=0,i=t.length;r<i;++r){if(t[r].getVertexes().indexOf(e)>=0)return t[r]}return null},doAppendEdge:function(e){return Kekule.ArrayUtils.pushUnique(this.getEdges(),e),this},doRemoveEdge:function(e){return Kekule.ArrayUtils.remove(this.getEdges(),e),this},doClearEdges:function(){for(var e=this.getEdges(),t=e.length-1;t>=0;--t)this.removeEdge(e[t]);return this}}),Kekule.GraphEdge=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphEdge",initialize:function(){this.setPropStoreFieldValue("weight",1),this.tryApplySuper("initialize"),this.setPropStoreFieldValue("vertexes",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("weight",{dataType:DataType.NUMBER})},replaceVertex:function(e,t){var r=this.getVertexes(),i=r.indexOf(e),n=r.indexOf(t);i<0||n>=0||(r.splice(i,1,t),e.doRemoveEdge(this),t.doAppendEdge(this))}}),Kekule.GraphTraverseMode={DEPTH_FIRST:0,BREADTH_FIRST:1},Kekule.Graph=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Graph",VISITED_KEY:"__$visited__",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("vertexes",[]),this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("edges",{dataType:DataType.ARRAY,serializable:!1,setter:null})},addVertex:function(e){return Kekule.ArrayUtils.pushUnique(this.getVertexes(),e),this},newVertex:function(){var e=new Kekule.GraphVertex;return this.addVertex(e),e},removeVertex:function(e){if(Kekule.ArrayUtils.remove(this.getVertexes(),e))for(var t=Kekule.ArrayUtils.clone(e.getEdges()),r=0,i=t.length;r<i;++r)this.removeEdge(t[r])},addEdge:function(e,t,r){return Kekule.ArrayUtils.pushUnique(this.getEdges(),e)&&(e.setPropStoreFieldValue("vertexes",[t,r]),t.doAppendEdge(e),r.doAppendEdge(e)),this},newEdge:function(e,t){var r=new Kekule.GraphEdge;return this.addEdge(r,e,t),r},removeEdge:function(e){for(var t=e.getVertexes(),r=0,i=t.length;r<i;++r){t[r].doRemoveEdge(e)}return Kekule.ArrayUtils.remove(this.getEdges(),e),this},traverse:function(t,r,i){for(var n=[],o=e.clone(this.getVertexes()),a=0,s=o.length;a<s;++a)o[a].setData(this.VISITED_KEY,!1);for(;o.length;){var l,u={vertexes:[],edges:[]};l=i&&o.indexOf(i)>=0?i:o[0];var d=this._doTravers(t,r,l);u.vertexes=u.vertexes.concat(d.vertexes),u.edges=u.edges.concat(d.edges),o=e.exclude(o,d.vertexes),n.push(u)}return n},_doTravers:function(e,t,r){var i={vertexes:[],edges:[]},n=r;n.getData(this.VISITED_KEY)||(i.vertexes.push(n),n.setData(this.VISITED_KEY,!0),e&&e(n,!1));for(var o=n.getEdges(),a=[],s=t===Kekule.GraphTraverseMode.BREADTH_FIRST,l=0,u=o.length;l<u;++l){var d=o[l],c=n.getNeighborOnEdge(d);if(!c.getData(this.VISITED_KEY))if(i.vertexes.push(c),i.edges.push(d),c.setData(this.VISITED_KEY,!0),e&&(e(d,!0),e(c,!1)),s)a.push(c);else{var h=this._doTravers(e,t,c);i.vertexes=i.vertexes.concat(h.vertexes),i.edges=i.edges.concat(h.edges)}}if(s)for(l=0,u=a.length;l<u;++l){var p=a[l];h=this._doTravers(e,t,p);i.vertexes=i.vertexes.concat(h.vertexes),i.edges=i.edges.concat(h.edges)}return i}}),Kekule.globalOptions.add("algorithm.molToGraph",{expandSubStructures:!0,ignoreBondedHydrogen:!0}),Kekule.GraphAdaptUtils={ctabToGraph:function(e,t,r){var i=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.molToGraph),r||{}),n=e,o=Kekule.ArrayUtils,a=null,s=i.expandSubStructures;if(n){for(var l=i.nodeFilter||function(e,t){if(i.nodeClasses){var r=e.getClass();if(!ClassEx.isOrIsDescendantOfClasses(r,i.nodeClasses))return!1}if(i.ignoreBondedHydrogen&&e.isHydrogenAtom&&e.isHydrogenAtom()&&!e.getCharge()){var n=e.getLinkedConnectors();if(t&&(n=o.intersect(n,t)),1===n.length){var a=n[0];if(!a)return!1;if(a.isSingleBond&&a.isSingleBond()){var s=e.getLinkedObjsOnConnector(a);if(1===s.length){var l=s[0];if(!l.isHydrogenAtom||!l.isHydrogenAtom())return!1}}}}return!0},u=i.connectorFilter||function(e,t){if(i.connectorClasses){var r=e.getClass();if(!ClassEx.isOrIsDescendantOfClasses(r,i.connectorClasses))return!1}return!(e.getBondType&&i.bondTypes&&i.bondTypes.indexOf(e.getBondType())<0)},d=(a=t||new Kekule.Graph,s?n.getAllContainingConnectors():n.getConnectors()),c=s?n.getLeafNodes():n.getNodes(),h=[],p=new Kekule.MapEx,g=0,f=d.length;g<f;++g){var C=d[g];if(u(C))for(var m=[],T=s?C.getConnectedObjs():C.getConnectedSiblings(),E=0,_=T.length;E<_;++E){var S=T[E];if(c.indexOf(S)>=0&&(l(S,d)?m.push(S):o.pushUnique(h,S),m.length>=2)){for(var O=o.exclude(m,h),y=0,A=O.length;y<A;++y){(k=a.newVertex()).setData("object",O[y]),p.set(O[y],k)}a.newEdge(p.get(m[0]),p.get(m[1])).setData("object",C),o.pushUnique(h,m);break}}}var I=o.exclude(c,h);for(g=0,f=I.length;g<f;++g){var k,b=I[g];if(l(b,d))(k=a.newVertex()).setData("object",b)}p.finalize()}return a},molToGraph:function(e,t,r){Kekule.ArrayUtils;if(!e||!e.hasCtab())return null;var i=e.getCtab();return i?Kekule.GraphAdaptUtils.ctabToGraph(i,t,r):null},chemObjToGraph:function(e,t,r){for(var i=Kekule.ChemStructureUtils.getAllStructFragments(e,!0),n=t||new Kekule.Graph,o=0,a=i.length;o<a;++o)Kekule.GraphAdaptUtils.molToGraph(i[o],n,r);return n}},Kekule.GraphAlgorithmUtils={SEQ_KEY:"__$seq__",RESD_DEGREE_KEY:"__$resdDegree__",VISIT_EDGE_DEGREE_KEY:"__$visitedEdgeDegree__",TYPE_KEY:"__$type__",TYPE_CYCLE:"cycle",TYPE_BRIDGE:"bridge",VISITED_KEY:"__$visited",createSpanningTrees:function(e,t){return e.traverse(null,t)},calcMinDistances:function(e,t){var r,i,n=e.getVertexes();DataType.isSimpleValue(t)?r=n[i=t]:(r=t,i=n.indexOf(r));for(var o=[],a=[],s=0,l=n.length;s<l;++s){var u=n[s];if(s===i)o[s]=0,a[s]=r;else(C=r.getEdgeTo(u))?(o[s]=C.getWeight(),a[s]=r):(o[s]=1/0,a[s]=null)}var d=[i];for(s=0,l=n.length;s<l;++s)if(s!==i){for(var c,h=1/0,p=-1,g=0,f=n.length;g<f;++g)g!==i&&d.indexOf(g)<0&&o[g]<h&&(h=o[g],p=g,c=n[g]);d.push(p);for(g=0,f=n.length;g<f;++g)if(d.indexOf(g)<0){var C,m=h+((C=c.getEdgeTo(n[g]))?C.getWeight():1/0);m<o[g]&&(o[g]=m)}}return o},findCycleBlocks:function(t){for(var r=[],i=Kekule.GraphAlgorithmUtils,n=i.SEQ_KEY,o=i.RESD_DEGREE_KEY,a=i.VISIT_EDGE_DEGREE_KEY,s=i.TYPE_KEY,l=i.TYPE_CYCLE,u=i.TYPE_BRIDGE,d=t.getEdges(),c=0,h=d.length;c<h;++c)d[c].removeData(n);var p=t.getVertexes();for(c=0,h=p.length;c<h;++c)p[c].removeData(s);var g=1,f=1,C=[],m=[],T=[];for(t.traverse(function(e,t){t?(e.setData(n,g),m.push(e),++g):(e.setData(n,f),++f,C.push(e))}),c=0,h=C.length;c<h;++c){var E=C[c],_=E.getEdges();E.setData(o,_.length);for(var S=0,O=0,y=_.length;O<y;++O){_[O].getData(n)&&++S}E.setData(a,S),S<_.length&&T.push(E)}for(var A=function(e,t){if(t&&e.getData(n)<=1)return null;for(var r=e.getEdges(),i=null,o=null,a=0,s=r.length;a<s;++a){var l=r[a].getData(n);l&&(o?l<o&&(i=r[a],o=l):(i=r[a],o=l))}return i||null},I=function(e){for(var t=e.getEdges(),r=0,i=t.length;r<i;++r)if(!t[r].getData(n)&&!t[r].getData(s))return t[r];return null},k=function(t){var r=[],i=[],n=t.getData(a),u=(p=t.getData(o))-n;if(u>0){t.setData(s,l),e.pushUnique(r,t);for(var d=0;d<u;++d){t.setData(o,p+1);var c=I(t);if(c){c.setData(s,l),e.pushUnique(i,c);var h=t.getNeighborOnEdge(c);for(h.setData(o,h.getData(o)+1),h.setData(s,l),e.pushUnique(r,h);;){var p;if((n=h.getData(a))<(p=h.getData(o))){var g=k(h);e.pushUnique(r,g.vertexes),e.pushUnique(i,g.edges)}var f=A(h,!1);if(!f)break;f.setData(s,l),e.pushUnique(i,f);var C=h.getNeighborOnEdge(f);if(C.getData(s))break;C.setData(s,l),e.pushUnique(r,C),h=C}}}}return{vertexes:r,edges:i}},b=C.shift();b;){if(b.getData(s));else{var v=b.getData(a);if(b.getData(o)-v>0){var R=k(b);r.push(R)}else{b.setData(s,u);var D=A(b,!0);D&&D.setData(s,u)}}b=C.shift()}return r},findEndChains:function(e){for(var t=Kekule.ArrayUtils,r={vertexes:[],edges:[]},i=t.clone(e.getVertexes()),n=[],o=0,a=i.length;o<a;++o){var s=i[o],l=s.getEdgeCount();s.setData("__$currConnectivity__",l),l<=1&&n.push(s)}if(n.length){var u=n.pop();for(t.remove(i,u),r.vertexes.push(u);i.length;){var d=!1,c=t.exclude(u.getEdges(),r.edges);if(c.length){r.edges=r.edges.concat(c);var h=u.getNeighborOnEdge(c[0]);l=h.getData("__$currConnectivity__")-1;h.setData("__$currConnectivity__",l),l<=1&&(u=h,t.remove(i,u),r.vertexes.push(u),d=!0)}if(!d){if(!n.length)break;u=n.pop();t.remove(i,u),r.vertexes.push(u)}}}return r},removeEndChains:function(e){for(var t=Kekule.GraphAlgorithmUtils.findEndChains(e),r=0,i=t.vertexes.length;r<i;++r)e.removeVertex(t.vertexes[r]);return t},findBridgeChains:function(t){for(var r=t.getVertexes(),i=t.getEdges(),n=Kekule.GraphAlgorithmUtils.findCycleBlocks(t),o=0,a=n.length;o<a;++o)r=e.exclude(r,n[o].vertexes),i=e.exclude(i,n[o].edges);return{vertexes:r,edges:i}},removeBridgeChains:function(e){for(var t=Kekule.GraphAlgorithmUtils.findBridgeChains(e),r=0,i=t.vertexes.length;r<i;++r)e.removeVertex(t.vertexes[r]);return t},findAllRings:function(t){var r,i=Kekule.GraphAlgorithmUtils,n=[];r=t instanceof Kekule.Graph?i.findCycleBlocks(t):[t];for(var o,a=function(e,t){var r=e.vertexes,i=r.length;return i&&(r[0]===t||r[i-1]===t)},s=function(t,r,i){var n=e.clone(t.vertexes),o=e.clone(r.vertexes),a=e.clone(t.edges),s=e.clone(r.edges);n[0]===i&&(n.reverse(),a.reverse()),o[o.length-1]===i&&(o.reverse(),s.reverse()),n.pop();var l=n.concat(o),u=a.concat(s);return{vertexCount:t.vertexCount+r.vertexCount-1,vertexes:l,edges:u}},l=function(t){for(var r=[],i=e.clone(t.vertexes),n=t.edges,o=0,l=i.length;o<l;++o){var u=i[o],d=e.intersect(u.getEdges(),n);u.setData("__$vertextPartDegree__",d.length)}i.sort(function(e,t){return e.getData("__$vertextPartDegree__")-t.getData("__$vertextPartDegree__")});var c,h,p,g,f=[];for(o=0,l=t.edges.length;o<l;++o){var C=t.edges[o],m=C.getVertexes();f.push({vertexCount:m.length,vertexes:[m[0],m[1]],edges:[C]})}for(;i.length;){var T=i.shift(),E=null;for(o=f.length-1;o>=0;--o){var _=f[o];if(a(_,T)){E=_;for(var S=o-1;S>=0;--S){_=f[S];if(a(_,T)&&(c=E,h=_,p=void 0,g=void 0,p=e.clone(c.vertexes),g=e.clone(h.vertexes),p.shift(),p.pop(),g.shift(),g.pop(),!(e.intersect(p,g).length>=1))){var O=s(E,_,T),y=O.vertexes;y[0]===y[y.length-1]?(y.pop(),r.push(O)):f.push(O)}}f.splice(o,1)}}}return r},u=0,d=r.length;u<d;++u){var c=r[u];if((o=c).vertexes.length===o.edges.length)n.push({vertexes:e.clone(c.vertexes),edges:e.clone(c.edges)});else for(var h=l(c),p=0,g=h.length;p<g;++p){var f=h[p];n.push({vertexes:e.clone(f.vertexes),edges:e.clone(f.edges)})}}return n},findSSSR:function(t,r){var i,n=Kekule.GraphAlgorithmUtils,o=[];t instanceof Kekule.Graph?(i=n.findCycleBlocks(t),r=null):i=[t];for(var a=function(t,r){var i=[],o=t.edges.length-t.vertexes.length+1;if(o<=0)return[];var a=r?e.clone(r):n.findAllRings(t);a.sort(function(e,t){return e.vertexes.length-t.vertexes.length});var s,l=function(e){i.push(e)},u=[],d=Kekule.RingVectorUtils;d.prepareConvertRingToVector(t);var c=a.shift();for(l(c),s=d.convertRingToVector(c,t),u.push(s);i.length<o&&a.length;)c=a.shift(),s=d.convertRingToVector(c,t),d.isLinearDependant(s,u)||(u.push(s),l(c));return i},s=0,l=i.length;s<l;++s){var u=a(i[s],r);o=o.concat(u)}return o},analysisRings:function(e){for(var t,r=Kekule.GraphAlgorithmUtils,i=[],n=0,o=(t=e instanceof Kekule.Graph?r.findCycleBlocks(e):[e]).length;n<o;++n){var a=t[n],s=r.findAllRings(a),l=r.findSSSR(a,s);i.push({vertexes:a.vertexes,edges:a.edges,allRings:s,sssrRings:l})}return i}},Kekule.RingVectorUtils={MAX_INT_BITNUM:23,EDGE_INDEX_FIELD:"__$index__",prepareConvertRingToVector:function(e){for(var t=e.edges,r=0,i=t.length;r<i;++r)t[r][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]=r},convertRingToVector:function(e,t){var r,i=t.edges.length,n=e.edges;if(i<Kekule.RingVectorUtils.MAX_INT_BITNUM){r=0;for(var o=0,a=n.length;o<a;++o){r+=1<<n[o][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]}}else{r=[];for(o=0,a=n.length;o<a;++o){r[n[o][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]]=!0}}return r},vectorNotNull:function(e){if(DataType.isSimpleValue(e))return!!e;for(var t=0;t<e.length;++t)if(e[t])return!0;return!1},getVectorLength:function(e){return DataType.isSimpleValue(e)?e.toString(2).length:e.length},ringVectorAnd:function(e,t){if(DataType.isSimpleValue(e))return e&t;for(var r=[],i=Math.min(e.length,t.length),n=0;n<i;++n)r[n]=e[n]&&t[n];return r},ringVectorAndAll:function(e){if(e.length<2)return e[0];for(var t=Kekule.RingVectorUtils,r=t.ringVectorAnd(e[0],e[1]),i=2,n=e.length;i<n;++i)r=t.ringVectorAnd(r,e[i]);return r},ringVectorOr:function(e,t){if(DataType.isSimpleValue(e))return e|t;for(var r=[],i=Math.max(e.length,t.length),n=0;n<i;++n)r[n]=e[n]||t[n];return r},ringVectorOrAll:function(e){if(e.length<2)return e[0];for(var t=Kekule.RingVectorUtils,r=t.ringVectorOr(e[0],e[1]),i=2,n=e.length;i<n;++i)r=t.ringVectorOr(r,e[i]);return r},ringVectorXor:function(e,t){if(DataType.isSimpleValue(e))return e^t;for(var r=[],i=Math.max(e.length,t.length),n=0;n<i;++n)r[n]=!!(e[n]^t[n]);return r},ringVectorXorAll:function(e){if(e.length<2)return e[0];for(var t=Kekule.RingVectorUtils,r=t.ringVectorXor(e[0],e[1]),i=2,n=e.length;i<n;++i)r=t.ringVectorXor(r,e[i]);return r},ringVectorNot:function(e){if(DataType.isSimpleValue(e))return~e;for(var t=[],r=0,i=e.length;r<i;++r)t[r]=!e[r];return t},isLinearDependant:function(e,t){var r=Kekule.RingVectorUtils,i=r.ringVectorOrAll(t),n=r.ringVectorAnd(e,r.ringVectorNot(i));if(r.vectorNotNull(n))return!1;for(var o=t.length,a=function(e){for(var t=[],r=0;r<e;++r)t[r]=e-r-1;return t},s=function(e,t,r){var i=e[t],n=++i;if(n>=r-t)return!(t>=e.length-1)&&s(e,t+1,r);e[t]=n;for(var o=n,a=t-1;a>=0;--a)++o,e[a]=o;return!0},l=!1,u=2;u<=o;++u){for(var d=a(u);;){0;for(var c=[],h=0,p=d.length;h<p;++h)c.push(t[d[h]]);var g=r.ringVectorXorAll(c);if(!r.vectorNotNull(r.ringVectorXor(g,e))){l=!0;break}if(!s(d,0,o)){l=!1;break}}if(l)break}return l},isLinearDependant_wrong:null}}(),function(){"use strict";Kekule.ChemStructObjContainer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructObjContainer",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("nodes",[]),this.setPropStoreFieldValue("connectors",[])},initProperties:function(){this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,setter:null})},clear:function(){return this.getNodes().length=0,this.getConnectors().length=0,this},add:function(e){var t=null;return e instanceof Kekule.ChemStructureConnector?t=this.getConnectors():e instanceof Kekule.ChemStructureNode&&(t=this.getNodes()),t?Kekule.ArrayUtils.pushUnique(t,e):Kekule.error(Kekule.$L("ErrorMsg.CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER")),this},remove:function(e){var t=null;return t=e instanceof Kekule.ChemStructureConnector?this.getConnectors():this.getNodes(),Kekule.ArrayUtils.remove(t,e),this}})}(),function(){var e=Kekule.ArrayUtils;Kekule.BondType;Kekule.CanonicalizationIndexer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationIndexer",initialize:function(){this.tryApplySuper("initialize")},execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t):null},doExecute:function(e){}}),Kekule.CanonicalizationNodeSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationNodeSorter",execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getNodes()):null},doExecute:function(e){}}),Kekule.CanonicalizationConnectorSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationConnectorSorter",execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getConnectors()):null},doExecute:function(e){}}),Kekule.CanonicalizationConnectorConnectedObjsSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationConnectorConnectedObjsSorter",execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getConnectors()):null},doExecute:function(e){}}),Kekule.CanonicalizationCustomExecutor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationCustomExecutor",execute:function(e){var t=this.doExecute(e);return t&&this.doCanonicalizeConnectedObjs(t),t},doExecute:function(e){return e},doCanonicalizeConnectedObjs:function(e){e&&(new Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter).execute(e)}}),Kekule.CanonicalizationGeneralConnectorSorter=Class.create(Kekule.CanonicalizationConnectorSorter,{CLASS_NAME:"Kekule.CanonicalizationGeneralConnectorSorter",doExecute:function(t){var r=new Kekule.MapEx;try{for(var i=0,n=t.getConnectorCount();i<n;++i){for(var o=t.getConnectorAt(i),a=o.getConnectedObjs(),s=[],l=0,u=a.length;l<u;++l){var d,c=a[l];c instanceof Kekule.ChemStructureNode&&(d=t.indexOfNode(c),s.push(d))}s.sort(function(e,t){return e-t}),r.set(o,s)}t.sortConnectors(function(t,i){var n=r.get(t),o=r.get(i),a=e.compare(n,o);return 0===a&&(a=-(t.getConnectedObjCount()-i.getConnectedObjCount())),a})}finally{r.finalize()}}}),Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter=Class.create(Kekule.CanonicalizationConnectorConnectedObjsSorter,{CLASS_NAME:"Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter",doExecute:function(e){var t=new Kekule.MapEx;try{for(var r=0,i=e.getConnectorCount();r<i;++r){var n=e.getConnectorAt(r);if(2===n.getConnectedObjCount()){var o=n.getConnectedObjAt(0),a=n.getConnectedObjAt(1),s=e.indexOfChild(o),l=e.indexOfChild(a);(s<0||l<0)&&(s=(o.getCanonicalizationIndex?-o.getCanonicalizationIndex():0)||0,l=(a.getCanonicalizationIndex?-a.getCanonicalizationIndex():0)||0),s>l&&n.reverseConnectedObjOrder()}else n.sortConnectedObjs(function(t,r){var i=e.indexOfChild(t),n=e.indexOfChild(r);(i<0||n<0)&&(o=((i=(t.getCanonicalizationIndex?-t.getCanonicalizationIndex():0)||0)||0)-((n=(r.getCanonicalizationIndex?-r.getCanonicalizationIndex():0)||0)||0));var o=e.indexOfChild(t)-e.indexOfChild(r);return o})}}finally{t.finalize()}}}),Kekule.CanonicalizationMorganIndexer=Class.create(Kekule.CanonicalizationIndexer,{CLASS_NAME:"Kekule.CanonicalizationMorganIndexer",doExecute:function(e){var t=this.doCalcGraphAndEcResult(e);this.doExecuteOnGraphEcResult(t.graph,t.ecMapping,t.vertexGroup)},doCalcGraphAndEcResult:function(e){var t=Kekule.GraphAdaptUtils.ctabToGraph(e,null,{expandSubStructures:!0,ignoreBondedHydrogen:!0});if(!t)return null;var r=this._calcGraphFinalECs(t);return{graph:t,ecMapping:r.ecMapping,vertexGroup:r.vertexGroup}},doExecuteOnGraphEcResult:function(e,t,r){var i=this._sortNodeByEcMapping(e,t,r);this._setCanonicalizationIndexToNodeGroups(i),this._fillSpanningTreeInfo(e)},_fillSpanningTreeInfo:function(e){if((i=e.getVertexes())&&i.length){i.sort(function(e,t){var r=e.getData("object"),i=t.getData("object");if(r||i){if(r){if(i){var n=(i.getCanonicalizationIndex()||-1)-(r.getCanonicalizationIndex()||-1);if(0===n&&r.hasCoord3D(!0)&&i.hasCoord3D(!0)){var o=Kekule.CoordUtils.substract(i.getAbsCoord3D(!0),r.getAbsCoord3D(!0));n=o.z||o.y||o.x}return n}return-1}return 1}return 0});var t=e.getEdges();if(t&&t.length){var r=function(e,t){for(var r=t.length,i=[],n=e.getVertexes(),o=0,a=n.length;o<a;++o){var s=t.indexOf(n[o]);s<0&&(s=r),i.push(s)}return i.sort(),i},i=e.getVertexes();t.sort(function(e,t){var n=r(e,i),o=r(t,i);return Kekule.ArrayUtils.compare(n,o)})}for(var n=0,o=(i=e.getVertexes()).length;n<o;++n){i[n].getEdges().sort(function(e,r){return t.indexOf(e)-t.indexOf(r)})}}this._setSpanningTreeIndexToNodeOfGraph(e)},_sortNodeByEcMapping:function(e,t,r){return this._doSortNodeByEcMapping(e,t,r)},_doSortNodeByEcMapping:function(t,r,i){for(var n=this._doSortNodeByEcMappingDirectly(i),o=this._doSortNodeBySortedNodeList(n),a=[],s=0,l=o.length;s<l;++s){var u=o[s];e.isArray(u)&&1===u.length?a.push(u[0]):a.push(u)}return a},_doSortNodeByEcMappingDirectly:function(t){for(var r=[],i=t,n=0,o=i.length;n<o;++n){var a=i[n],s=this._vertexesToNodes(a.vertexes);if(1===s.length)e.pushUnique(r,s[0]);else{var l=this._groupNodesWithSameEcValue(s,r);r=r.concat(l)}}return r},_doSortNodeBySortedNodeList:function(e){var t=(r=this._doSortNodeBySortedNodeListCore(e)).length;do{var r,i=r,n=t;t=(r=this._doSortNodeBySortedNodeListCore(i)).length}while(t>n);return i},_doSortNodeBySortedNodeListCore:function(t){for(var r=[],i=[],n=0,o=t.length;n<o;++n){var a=t[n];if(e.isArray(a)){var s=function(t,r){for(var i=0,n=r.length;i<n;++i)if(e.isArray(r[i])){if(r[i].indexOf(t)>=0)return i}else if(r[i]===t)return i;return-1},l=function(e,t,r){for(var i=[],n=0,o=t.length;n<o;++n)i.push(s(t[n],r));return i.sort(function(e,t){return t-e}),i},u=e.group(a,function(n,o){var a=e.intersect(n.getLinkedObjs(),i),s=e.intersect(o.getLinkedObjs(),i);if(0==(c=a.length-s.length)&&a.length>0){var u=l(0,a,r),d=l(0,s,r);c=e.compare(u,d)}if(0===c){var c;a=e.intersect(n.getLinkedObjs(),t),s=e.intersect(o.getLinkedObjs(),t),0==(c=a.length-s.length)&&(u=l(0,a,t),d=l(0,s,t),c=e.compare(u,d))}return c});r=r.concat(u),i=i.concat(a)}else r.push([a]),i.push(a)}return r},_setCanonicalizationIndexToNodeGroups:function(t){for(var r=0,i=t.length;r<i;++r){var n=r+1,o=t[r];if(e.isArray(o))for(var a=0,s=o.length;a<s;++a)o[a].setCanonicalizationIndex(n);else o.setCanonicalizationIndex(n)}},_setSpanningTreeIndexToNodeOfGraph:function(e){for(var t=Kekule.GraphAlgorithmUtils.createSpanningTrees(e,Kekule.GraphTraverseMode.DEPTH_FIRST),r=0,i=t.length;r<i;++r){var n=t[r];if(n.vertexes)for(var o=n.vertexes.length,a=0;a<o;++a){var s=n.vertexes[a].getData("object");s&&s.setCanonicalizationAssocIndex&&s.setCanonicalizationAssocIndex(o-a)}}},_vertexesToNodes:function(e){for(var t=[],r=0,i=e.length;r<i;++r){var n=e[r].getData("object");t.push(n)}return t},_processECs:function(t,r,i,n){if(n)return this._initECs(t,r);for(var o=[],a=[],s=t.getVertexes(),l=0,u=s.length;l<u;++l){var d=s[l],c=this._usePrimeECs?1:0;if(this._usePrimeECs)var h=this._getPrimeArray();for(var p=d.getNeighbors(),g=0,f=p.length;g<f;++g)this._usePrimeECs?c*=h[i.get(p[g])-1||0]:c+=i.get(p[g])||0;e.pushUnique(o,c),a[c]?a[c].push(d):a[c]=[d]}o.sort(function(e,t){return e-t});var C=[];for(l=0,u=o.length;l<u;++l){var m=o[l];a[m]&&C.push(a[m])}return this._setECValueByVertexGroup(C,r),C.length},_initECs:function(t,r){for(var i=[],n=0,o=(u=t.getVertexes()).length;n<o;++n){var a=u[n],s=a.getEdgeCount();i[s]?i[s].push(a):i[s]=[a]}var l=[];for(n=0,o=i.length;n<o;++n){var u;if(u=i[n])if(1===u.length)l.push(u);else for(var d=e.group(u,function(e,t){var r=e.getData("object"),i=t.getData("object"),n=(r.getLinkedNonHydrogenConnectors()||[]).length-(i.getLinkedNonHydrogenConnectors()||[]).length;return n||(n=r.compareStructure(i))||(n=(r.getHydrogenCount?r.getHydrogenCount(!0):0)-(i.getHydrogenCount?i.getHydrogenCount(!0):0)),n}),c=0,h=d.length;c<h;++c)l.push(e.toArray(d[c]))}return this._setECValueByVertexGroup(l,r),l.length},_setECValueByVertexGroup:function(e,t){for(var r=0,i=e.length;r<i;++r)for(var n=e[r],o=0,a=n.length;o<a;++o)t.set(n[o],r+1)},_getPrimeArray:function(){return Kekule.CanonicalizationMorganIndexer.primes||(Kekule.CanonicalizationMorganIndexer.primes=Kekule.NumUtils.getPrimes(1e4)),Kekule.CanonicalizationMorganIndexer.primes},_calcGraphFinalECs:function(e){var t=[new Kekule.MapEx,new Kekule.MapEx];try{e.getVertexes().length<this._getPrimeArray().length?this._usePrimeECs=!0:this._usePrimeECs=!1;for(var r,i,n=0,o=t[0],a=t[0],s=0,l=[],u=this._processECs(e,o,a,!0),d=!0;d;)s=u,r=i,a=o,o=t[++n%2],u=this._processECs(e,o,a),i=null,d=u>s,u===s?(i=this._groupVertexesByEcValue(e,o),!r&&a&&(r=this._groupVertexesByEcValue(e,a)),l.push(r),d=!this._hasVertexGroup(i,l)):l=[]}finally{o.finalize()}return{ecMapping:a,ecCount:s,vertexGroup:r||this._groupVertexesByEcValue(e,a)}},_groupVertexesByEcValue:function(t,r){for(var i=[],n=[],o=t.getVertexes(),a=0,s=o.length;a<s;++a){var l=o[a],u=r.get(l);e.pushUnique(n,u),i[u]||(i[u]=[]),i[u].push(l)}n.sort(function(e,t){return e-t});var d=[];for(a=0,s=n.length;a<s;++a){var c=i[n[a]];d.push({ecValue:n[a],vertexes:c,vertexesCount:c.length})}return d},_hasVertexGroup:function(e,t){for(var r=0,i=t.length;r<i;++r)if(0===this._compareEcVertexGroup(e,t[r]))return!0;return!1},_compareEcVertexGroup:function(t,r){var i=t.length,n=i-r.length;if(0===n)for(var o=0;o<i&&(0===(n=t[o].vertexes.length-r[o].vertexes.length)&&(n=e.exclude(t[o].vertexes,r[o].vertexes).length),0===n);++o);return n},_groupNodesWithSameEcValue:function(t,r){var i=function(t,r){for(var i=e.flatten(r),n=t.getLinkedObjs(),o=e.intersect(n,i),a=[],s=[],l=0,u=o.length;l<u;++l){var d=o[l],c=e.indexStackOfElem(d,r);a.push(c)}a.sort(function(t,r){return e.compare(t,r)});for(l=0,u=a.length;l<u;++l){(d=e.getElemByIndexStack(r,a[l]))||console.error("not found",d,a[l]);var h=t.getConnectorTo(d);s.push(h)}return{nodeIndexValues:a,connectors:s}};return e.group(t,function(t,n){var o=t.compareStructure(n);if(0===o){var a=i(t,r),s=i(n,r);o=e.compare(a.nodeIndexValues,s.nodeIndexValues);for(var l=a.connectors,u=s.connectors,d=0,c=l.length;d<c&&0===(o=l[d].compareStructure(u[d]));++d);if(0===o){var h=t.getBelongedSssrRings&&t.getBelongedSssrRings()||[],p=n.getBelongedSssrRings&&n.getBelongedSssrRings()||[];if(0===(o=h.length-p.length)){var g=[],f=[];for(d=0,c=h.length;d<c;++d)g.push(h[d].nodes.length),f.push(p[d].nodes.length);g.sort(),f.sort(),o=e.compare(g,f)}}}return o})}}),Kekule.CanonicalizationMorganNodeSorter=Class.create(Kekule.CanonicalizationNodeSorter,{CLASS_NAME:"Kekule.CanonicalizationMorganNodeSorter",doExecute:function(e){var t=this._getNodeSortedArray(e),r=t.length,i=this;e.sortNodes(function(e,n){var o=t.indexOf(e),a=t.indexOf(n);o<0&&(o=r),a<0&&(a=r);var s=o-a;return 0===s&&o===r&&(s=i._getNeighborNodesMinIndex(e,t)-i._getNeighborNodesMinIndex(n,t)),s})},_getNeighborNodesMinIndex:function(e,t){for(var r=e.getLinkedChemNodes(),i=t.length,n=0,o=r.length;n<o;++n){var a=t.indexOf(r[n]);a>0&&a<i&&(i=a)}return i},_getNodeSortedArray:function(t){var r=function(e,t,r,i){var n;if(0===(n=(t.getCanonicalizationIndex()||-1)-(r.getCanonicalizationIndex()||-1))){if(e){var o=e.getConnectorTo(t),a=e.getConnectorTo(r);n=o.compareStructure(a)}if(0===n)if(i)n=(i.get(t)||1/0)-(i.get(r)||1/0);if(0===n)n=(t.getCanonicalizationAssocIndex()||-1)-(r.getCanonicalizationAssocIndex()||-1);if(0===n&&t.hasCoord3D(!0)&&r.hasCoord3D(!0)){var s=Kekule.CoordUtils.substract(t.getAbsCoord3D(!0),r.getAbsCoord3D(!0));n=s.z||s.y||s.x}}return n};try{for(var i,n=e.clone(t.getNodes()),o=0,a=n.length;o<a;++o){var s=n[o];d?r(null,s,d)>0&&(d=s,i=o):(d=s,i=o)}n.splice(i,1);var l=[],u=[];d&&l.push(d);for(o=0;o<l.length;++o){var d=l[o];if(0!==o){var c=n.indexOf(d);c>=0&&(l.push(d),n.splice(c,1))}var h=d.getLinkedObjs();if((h=e.intersect(h,n)).length){h.sort(function(e,t){return r(d,e,t)});for(var p=h.length-1;p>=0;--p){var g=h[p];if((c=n.indexOf(g))>=0){var f=g.getCanonicalizationIndex();Kekule.ObjUtils.isUnset(f)?u.push(g):l.push(g),n.splice(c,1)}}}}return l=l.concat(u)}finally{}}}),Kekule.Canonicalizer=Class.create({CLASS_NAME:"Kekule.Canonicalizer",initialize:function(){this._executorClasses={},this._executorInstances={},this._defExecutorId=null},registerExecutor:function(t,r,i){e.isArray(r)?this._executorClasses[t]={indexer:r[0],nodeSorter:r[1],connectorSorter:r[2]||Kekule.CanonicalizationGeneralConnectorSorter,connectorConnectedObjsSorter:r[3]||Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter}:this._executorClasses[t]={customExecutor:r},i&&(this._defExecutorId=t)},getExecutor:function(e){if(!e)return null;var t=this._executorInstances[e];if(!t){var r=this._executorClasses[e];r&&(t=r.customExecutor?{customExecutor:new r.customExecutor}:{indexer:new r.indexer,nodeSorter:new r.nodeSorter,connectorSorter:new r.connectorSorter,connectorConnectedObjsSorter:new r.connectorConnectedObjsSorter},this._executorInstances[e]=t)}return t},canonicalize:function(e,t){e.beginUpdate();try{var r=t||this._defExecutorId,i=this.getExecutor(r);if(i){var n=e instanceof Kekule.StructureFragment?e:null,o=n.getCanonicalizationInfo();if(o&&o.id===r)return e;var a=e.getCtab?e.getCtab():e;if(!a||a.isEmpty())return e;var s=a.getParent();i.customExecutor?i.customExecutor.execute(a):this._doDefaultCanonicalize(i,a,s),n.setCanonicalizationInfo({id:r})}else Kekule.error(Kekule.$L("ErrorMsg.REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND"))}finally{e.endUpdate()}return e},_doDefaultCanonicalize:function(e,t,r){var i=r.getFlattenedShadowFragment();(t=i.getCtab()).beginUpdate();try{e.indexer.execute(t),e.nodeSorter.execute(t),e.connectorSorter.execute(t),e.connectorConnectedObjsSorter.execute(t)}finally{t.endUpdate()}if(!r.getFlattenedShadowOnSelf()){r.beginUpdate();try{this._sortSrcStructBaseOnShadow(r,i),e.connectorConnectedObjsSorter.execute(r.getCtab())}finally{r.endUpdate()}}},_sortSrcStructBaseOnShadow:function(e,t){var r=function(e){return e.__$flattern_index$__},i=function(e,t){e.__$flattern_index$__=t},n=function(t,o,a,s){i(o,a);var l=o.getParent();if(l.isChildOf(e)){var u=r(l),d=a+s;(Kekule.ObjUtils.isUnset(u)||u>d)&&n(t,l,d,s)}},o=function(e){e.beginUpdate();try{e.sortNodes(function(e,t){return r(e)-r(t)}),e.sortConnectors(function(e,t){return r(e)-r(t)});for(var t=0,i=e.getNodeCount();t<i;++t){var n=e.getNodeAt(t);n instanceof Kekule.StructureFragment&&o(n)}}finally{e.endUpdate()}};e.cascadeOnChildren(function(e){e&&i(e,null)});var a=t.getChildCount();e.beginUpdate();try{for(var s=0;s<a;++s){var l=t.getChildAt(s);if(l instanceof Kekule.ChemStructureNode){var u=l,d=e.getFlatternedShadowSourceObj(u);d&&(n(e,d,s,a),d.setCanonicalizationIndex(u.getCanonicalizationIndex()))}else if(l instanceof Kekule.ChemStructureConnector){var c=l,h=e.getFlatternedShadowSourceObj(c);i(h,s)}}o(e)}finally{e.endUpdate()}}}),Kekule.ClassUtils.makeSingleton(Kekule.Canonicalizer),Kekule.canonicalizer=Kekule.Canonicalizer.getInstance(),ClassEx.extend(Kekule.ChemObject,{canonicalize:function(e){for(var t=Kekule.ChemStructureUtils.getAllStructFragments(this,!0),r=0,i=t.length;r<i;++r)t[r].canonicalize(e);return this}}),ClassEx.extend(Kekule.StructureConnectionTable,{canonicalize:function(e){return Kekule.canonicalizer.canonicalize(this),this}}),ClassEx.extend(Kekule.StructureFragment,{canonicalize:function(e){return Kekule.canonicalizer.canonicalize(this),this}}),ClassEx.defineProp(Kekule.ChemStructureObject,"canonicalizationIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLISHED}),ClassEx.defineProp(Kekule.ChemStructureObject,"canonicalizationAssocIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLISHED}),Kekule.canonicalizer.registerExecutor("morgan",[Kekule.CanonicalizationMorganIndexer,Kekule.CanonicalizationMorganNodeSorter],!0)}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.GraphAlgorithmUtils,r=Kekule.ChemStructureUtils,i=Kekule.BondType;Kekule.globalOptions.add("algorithm.ringSearch",{bondTypes:[i.COVALENT]}),ClassEx.extend(Kekule.StructureConnectionTable,{getGraph:function(e){var t=Class.create(e);return t.connectorClasses=[Kekule.Bond],Kekule.GraphAdaptUtils.ctabToGraph(this,null,t)},extractStructObjs:function(e){for(var t=e.edges,r=e.vertexes,i=[],n=[],o=0,a=r.length;o<a;++o){(s=r[o].getData("object"))instanceof Kekule.BaseStructureNode&&i.push(s)}for(o=0,a=t.length;o<a;++o){var s;(s=t[o].getData("object"))instanceof Kekule.BaseStructureConnector&&n.push(s)}return{nodes:i,connectors:n}},findCycleBlocks:function(){var e=this.getRingInfo();return e?e.cycleBlocks:[]},findAllRings:function(){var e=this.getRingInfo(),t=[];if(e)for(var r=0,i=e.cycleBlocks.length;r<i;++r){var n=e.cycleBlocks[r].allRings;t=t.concat(n)}return t},findSSSR:function(){var e=this.getRingInfo(),t=[];if(e)for(var r=0,i=e.cycleBlocks.length;r<i;++r){var n=e.cycleBlocks[r].sssrRings;t=t.concat(n)}return t},analysisRings:function(e){var r=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.ringSearch),e),i=this.getGraph(r);if(i){for(var n=[],o=t.analysisRings(i),a=0,s=o.length;a<s;++a){var l=o[a],u=this.extractStructObjs(l);n.push(u),u.allRings=[];for(var d=l.allRings,c=0,h=d.length;c<h;++c){var p=d[c],g=this.extractStructObjs(p);u.allRings.push(g)}u.sssrRings=[];var f=l.sssrRings;for(c=0,h=f.length;c<h;++c){p=f[c];var C=d.indexOf(p);if(C>=0)u.sssrRings.push(u.allRings[C]);else{g=this.extractStructObjs(p);u.sssrRings.push(g)}}}return{cycleBlocks:n}}return null}}),ClassEx.defineProps(Kekule.StructureConnectionTable,[{name:"ringInfo",dataType:DataType.HASH,serializable:!1,getter:function(e){var t=this.getStructureCacheData("ringInfo");return t||e||(t=this.analysisRings(),this.setStructureCacheData("ringInfo",t)),t},setter:null}]),ClassEx.extend(Kekule.StructureFragment,{findCycleBlocks:function(){return this.hasCtab()?this.getCtab().findCycleBlocks():null},findAllRings:function(){return this.hasCtab()?this.getCtab().findAllRings():null},findSSSR:function(){return this.hasCtab()?this.getCtab().findSSSR():null},analysisRings:function(e){return this.hasCtab()?this.getCtab().analysisRings(e):null}}),ClassEx.defineProps(Kekule.StructureFragment,[{name:"ringInfo",dataType:DataType.HASH,serializable:!1,getter:function(e){return this.hasCtab()?this.getCtab().getRingInfo(e):null},setter:null}]),ClassEx.extendMethod(Kekule.StructureFragment,"_copyAdditionalFragmentInfo",function($origin,e,t,r){var i=function(e){for(var r={nodes:[],connectors:[]},i=0,n=e.nodes.length;i<n;++i){(o=t.get(e.nodes[i]))&&r.nodes.push(o)}for(i=0,n=e.connectors.length;i<n;++i){var o;(o=t.get(e.connectors[i]))&&r.connectors.push(o)}return r};$origin(e,t,r);var n=this.getRingInfo(!0);if(n){for(var o={cycleBlocks:[]},a=0,s=n.cycleBlocks.length;a<s;++a){for(var l=n.cycleBlocks[a],u={allRings:[],sssrRings:[]},d=l.allRings,c=0,h=d.length;c<h;++c){var p=d[c];u.allRings.push(i(p))}var g=l.sssrRings;for(c=0,h=g.length;c<h;++c){p=g[c];u.sssrRings.push(i(p))}o.cycleBlocks.push(u)}e.setPropStoreFieldValue("ringInfo",o)}}),ClassEx.extend(Kekule.ChemStructureObject,{getBelongedSssrRings:function(){var e=[],t=this.getParent();if(t&&t.findSSSR)for(var r=t.findSSSR(),i=0,n=r.length;i<n;++i){var o=r[i];this instanceof Kekule.BaseStructureConnector?o.connectors.indexOf(this)>=0&&e.push(o):o.nodes.indexOf(this)>=0&&e.push(o)}return e},getBelongedRingMinSize:function(){var e=null,t=this.getBelongedSssrRings();if(t&&t.length)for(var r=0,i=t.length;r<i;++r){var n=t[r].nodes.length;e=e?Math.min(e,n):n}return e},isInRing:function(t){var r=t&&e.toArray(t);if(!r){var i=this.getParent();i&&i.findSSSR&&(r=i.findSSSR())}if(r&&r.length){for(var n=0,o=r.length;n<o;++n){var a=r[n];if(this instanceof Kekule.BaseStructureConnector){if(a.connectors.indexOf(this)>=0)return!0}else if(a.nodes.indexOf(this)>=0)return!0}return!1}return!1}}),ClassEx.extend(Kekule.ChemObject,{findCycleBlocks:function(){for(var e=r.getAllStructFragments(this),t=[],i=0,n=e.length;i<n;++i){var o=e[i].findCycleBlocks();o&&(t=t.concat(o))}return t.length?t:null},findAllRings:function(){for(var e=r.getAllStructFragments(this),t=[],i=0,n=e.length;i<n;++i){var o=e[i].findAllRings();o&&(t=t.concat(o))}return t.length?t:null},findSSSR:function(){for(var e=r.getAllStructFragments(this),t=[],i=0,n=e.length;i<n;++i){var o=e[i].findSSSR();o&&(t=t.concat(o))}return t.length?t:null},analysisRings:function(e){for(var t=r.getAllStructFragments(this),i=[],n=0,o=t.length;n<o;++n){var a=t[n].analysisRings(e);a&&(i=i.concat(a))}return i.length?i:null}})}(),function(){"use strict";var e=Kekule.ObjUtils,t=Kekule.ArrayUtils,r=Kekule.BondType,i=Kekule.BondOrder,n=Kekule.ChemStructureUtils,o=-1,a=-16,s=-32;Kekule.AromaticTypes={NONAROMATIC:0,EXPLICIT_AROMATIC:1,ANTIAROMATIC:-1,UNCERTAIN:64},ClassEx.extend(Kekule.Atom,{isSulfoneOrSulfoxideSulphur:function(){if("S"===this.getSymbol()){var e=this.getLinkedMultipleBonds();if(e.length>=1)for(var t=0,r=e;t<r;++t)for(var i=this.getLinkedObjsOnConnector(e[t]),n=0,o=i.length;n<o;++n){var a=i[n];if(a instanceof Kekule.Atom&&"O"===a.getSymbol())return!0}}return!1},isEsterCarbon:function(){if("C"===this.getSymbol())for(var e,t,n=this.getLinkedBonds(r.COVALENT),o=0,a=n.length;o<a;++o){var s=n[o];if(s.isBondBetween("C","O")&&(t||s.getBondOrder()!==i.SINGLE?e||s.getBondOrder()!==i.DOUBLE||(e=!0):t=!0,t&&e))return!0}return!1}}),Kekule.globalOptions.add("algorithm.aromaticRingsPerception",{allowUncertainRings:!1}),ClassEx.extend(Kekule.StructureConnectionTable,{_getPossibleRingNodePiElectronCounts:function(e,r,i){var n=function(e,r,i,n){var l=e,u=Kekule.IsotopeFactory.getIsotope(l),d=r.getCharge();if(!(r.isSaturated&&r.isSaturated())){var c,h,p,g=r.getLinkedMultipleBonds();if(r.isSulfoneOrSulfoxideSulphur&&r.isSulfoneOrSulfoxideSulphur())return s;if(r.isEsterCarbon&&r.isEsterCarbon())return a;if(n?p=(h=t.intersect(g,n)).length:(h=null,p=1),p)if(2===p&&h[0].getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC)c=u.isHetero&&u.isHetero()?[1,2]:1;else if(1===p&&h&&h[0].getBondOrder()===Kekule.BondOrder.DOUBLE)c=1;else{if(1!==p||h)return-1;c=1}else if("C"===l){for(var f=!1,C=0,m=g.length;C<m;++C){var T=g[C],E=r.getLinkedObjsOnConnector(T);if(1===E.length)if(E[0].getPrimaryIsotope().isHetero()){f=!0;break}}c=f?0:1}else c=1;if(t.isArray(c)){for(C=0,m=c.length;C<m;++C)c[C]=Math.min(Math.max(c[C]-d,0),2);return c}return Math.min(Math.max(c-d,0),2)}return r.getRadical&&r.getRadical()===Kekule.RadicalOrder.DOUBLET?1:u.isHetero()?Math.min(Math.max(2-d,0),2):"C"===l?d>0?0:d<0?2:o:0};if(e instanceof Kekule.VariableAtom){var l=e.getAllowedIsotopeIds();if(l&&l.length){for(var u=[],d=0,c=l.length;d<c;++d){var h=l[d],p=Kekule.IsotopeFactory.getIsotopeById(h).getSymbol();t.pushUnique(u,n(p,e,0,i))}return u}return[0,1,2]}var g=e.getPrimaryIsotope();return g?n(p=g.getSymbol(),e,0,i):[0,1,2]},_checkRingAromaticType:function(e,r,i){if(r){for(var n=i&&Kekule.ChemStructureUtils.isInRings(e,i),o=e.nodes,a=o.length,s=a>6&&a<16,l=[],u=[],d=o.length,c=0;c<d;++c){var h=o[c],p=r.get(h);t.isArray(p)?l.push(p):l.push([p]),u[c]=0}var g,f=function(e,t){var r=t[e],i=++r;return i>=l[e].length?!(e>=t.length-1)&&(t[e]=0,f(e+1,t)):(t[e]=i,!0)},C=null,m=null;do{0;var T=0,E=null;for(c=0;c<d;++c){var _=l[c][u[c]];if(!(_>=0)){E=Kekule.AromaticTypes.NONAROMATIC;break}T+=_}if(null===E){var S=parseInt(T/4),O=T%4;S<=5&&(2!==S||!(s&&n))&&(2===O?(E=Kekule.AromaticTypes.EXPLICIT_AROMATIC,m=t.clone(u)):O||(E=Kekule.AromaticTypes.ANTIAROMATIC))}if(null!==C){if(E&&C!==E&&(C===Kekule.AromaticTypes.EXPLICIT_AROMATIC||E===Kekule.AromaticTypes.EXPLICIT_AROMATIC)){g=Kekule.AromaticTypes.UNCERTAIN;break}}else C=E}while(f(0,u));if(g||(g=C),m)for(var y=new Kekule.MapEx,A=(c=0,m.length);c<A;++c)y.set(o[c],l[c][m[c]]);return{result:g,eMap:y}}},_calcPossibleRingNodesPElectronCounts:function(e,r,i){var n=[],o=[],a=[];if(i){for(s=0,l=i.length;s<l;++s)t.pushUnique(n,i[s].nodes),t.pushUnique(o,i[s].connectors);for(s=0,l=r.length;s<l;++s)t.pushUnique(a,r[s].nodes)}else{for(var s=0,l=r.length;s<l;++s)t.pushUnique(n,r[s].nodes),t.pushUnique(o,r[s].connectors);a=n}for(s=0,l=a.length;s<l;++s){var u=a[s],d=u.getStructureCacheData("piElectronCount");if(Kekule.ObjUtils.notUnset(d))e.set(u,[d]);else{var c=this._getPossibleRingNodePiElectronCounts(u,n,o);e.set(u,c)}}},_storeAromaticCacheToRingInfo:function(e,t,r){if(e.aromaticType=t,t===Kekule.AromaticTypes.EXPLICIT_AROMATIC)for(var i=e.nodes,n=0,o=i.length;n<o;++n){var a=i[n];if(Kekule.ObjUtils.isUnset(a.getStructureCacheData("piElectronCount"))&&r){var s=r.get(a);Kekule.ObjUtils.notUnset(s)&&a.setStructureCacheData("piElectronCount",s)}}},perceiveAromaticRings:function(e,t){Kekule.ObjUtils.isUnset(e)&&(e=Kekule.globalOptions.algorithm.aromaticRingsPerception.allowUncertainRings);var r=this.findSSSR(),i=t||r,n=[],o=new Kekule.MapEx;try{this._calcPossibleRingNodesPElectronCounts(o,i,null);for(var a=0,s=i.length;a<s;++a){var l,u=i[a];if(Kekule.ObjUtils.notUnset(u.aromaticType))l=u.aromaticType;else{var d=this._checkRingAromaticType(u,o,r);l=d.result,this._storeAromaticCacheToRingInfo(u,l,d.eMap)}(l===Kekule.AromaticTypes.EXPLICIT_AROMATIC||e&&l===Kekule.AromaticTypes.UNCERTAIN)&&n.push(u)}return n}finally{o.finalize()}},findAromaticRings:function(e,t){return this.perceiveAromaticRings(e,t)},getRingAromaticType:function(e,t){if(Kekule.ObjUtils.notUnset(e.aromaticType))return e.aromaticType;var r,i=this.findSSSR();t||(t=i);var n=new Kekule.MapEx;try{this._calcPossibleRingNodesPElectronCounts(n,[e],t);var o=this._checkRingAromaticType(e,n,i);r=o.result,this._storeAromaticCacheToRingInfo(e,r,o.eMap)}finally{n.finalize()}return r},getHucklizationChanges:function(e,t){for(var r=t&&t.allowUncertainRings,i=Kekule.BondOrder,n=[],o=(this.getParent(),this.findAromaticRings(r)),a=0,s=o.length;a<s;++a)for(var l=o[a].connectors,u=0,d=l.length;u<d;++u){var c=l[u];if(!e||e.indexOf(c)>=0){var h=c.getBondOrder&&c.getBondOrder();h!==i.SINGLE&&h!==i.DOUBLE||c.setBondOrder&&n.push({bond:c,bondOrder:Kekule.BondOrder.EXPLICIT_AROMATIC})}}return n},hucklize:function(e,t){t&&t.allowUncertainRings,Kekule.BondOrder;var r=[],i=this.getParent();i.setAutoClearStructureCache(!1),i.beginUpdate();try{var n=this.getHucklizationChanges(e,t);if(n)for(var o=0,a=n.length;o<a;++o){var s=n[o].bond,l=n[o].bondOrder;s.setBondOrder&&(s.setBondOrder(l),r.push(s))}}finally{i.endUpdate(),i.setAutoClearStructureCache(!0)}return r},getKekulizationChanges:function(e,t){var r,n=Object.extend({doAromaticTests:!1,includingSubFragments:!0,expandSubFragments:!1,useShadow:!0},t||{}),o=[],a=this.getParent();if(n.doAromaticTests&&this.perceiveAromaticRings(),n.useShadow){var s=a.createShadow();r=s.getShadowFragment()}else r=a;try{var l;if(n.expandSubFragments&&n.useShadow&&r.unmarshalAllSubFragments(!0),e)if(l=[],n.useShadow)for(var u=0,d=e.length;u<d;++u){var c=s.getShadowObj(e[u]);c&&l.push(c)}else l=e;else l=n.includingSubFragments&&!n.expandSubFragments?r.getAllContainingConnectors():r.getConnectors();var h=[];for(u=0,d=l.length;u<d;++u){var p=l[u];p.getBondType()===Kekule.BondType.COVALENT&&p.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC&&2===p.getConnectedChemNodeCount()&&h.push(p)}r.setAutoClearStructureCache(!1),r.beginUpdate();try{var g=this._splitConnectorsToContinuousParts(h)||[];for(u=0,d=g.length;u<d;++u){var f=g[u];if(this._kekulizeContinousBonds(f,s,r,a))for(var C=0,m=f.length;C<m;++C){var T=f[C].getBondOrder();if(T!==i.EXPLICIT_AROMATIC){var E=n.useShadow?s.getSourceObj(f[C]):f[C];o.push({bond:E,bondOrder:T})}}}}finally{r.endUpdate(),r.setAutoClearStructureCache(!0)}}finally{n.useShadow&&s.finalize()}return o._useShadow=n.useShadow,o},kekulize:function(e,t){var r=[],i=this.getKekulizationChanges(e,t);if(i&&i._useShadow){var n=this.getParent();try{n.setAutoClearStructureCache(!1),n.beginUpdate();for(var o=0,a=i.length;o<a;++o){var s=i[o];s.bond.setBondOrder(s.bondOrder),r.push(s.bond)}}finally{n.endUpdate(),n.setAutoClearStructureCache(!0)}}return r},_kekulizeContinousBonds:function(r,i,n,o){for(var a=[],s=0,l=r.length;s<l;++s){var u=r[s].getConnectedChemNodes()||[];t.pushUnique(a,u)}var d=new Kekule.MapEx(!1);for(s=0,l=a.length;s<l;++s){var c=a[s],h=i?i.getSourceObj(c):c,p=h&&h.getStructureCacheData("piElectronCount");e.notUnset(p)&&d.set(c,{cachedPiElectronCount:p})}return this._doKekulizeContinousBondSys(0,r,a,d)},_doKekulizeContinousBondSys:function(r,n,o,a){var s=this,l=function(t){var r,i=a.get(t);return i?r=i.bondOrder:n.indexOf(t)<0&&(r=t.getBondOrder()),e.notUnset(r)?r:null},u=function(e){var t=l(e);return t>i.SINGLE&&t<=i.QUAD},d=function(r){var o=a.get(r),u=o&&o.cachedPiElectronCount;if(e.isUnset(u)){var d=r.getLinkedBonds(Kekule.BondType.COVALENT);if(function(e){var r=t.intersect(e,n),i=!r||!r.length;if(!i){i=!0;for(var o=0,s=r.length;o<s;++o){var l=r[o];if(!a.get(l)){i=!1;break}}}return i}(d)){var c=t.toArray(s._getPossibleRingNodePiElectronCounts(r,null,null));return!c||!c.length||c[0]<0?-1:c[0]}for(var h=0,p=0,g=d.length;p<g;++p){var f=d[p],C=l(f);e.notUnset(C)&&(C===i.DOUBLE||C===i.TRIPLE||C===i.QUAD?++h:0)}h&&(u=1===h?1:-1)}return u},c=n[r],h=c.getConnectedChemNodes(),p=[];if(!a.get(c)){if(function(e){for(var t=e.getNeighboringBonds(),r=0,i=t.length;r<i;++r)if(e=t[r],u(e))return!0;return!1}(c))p=[i.SINGLE];else{var g=function(t,r){for(var i=0,n=0,o=0,a=r.length;o<a;++o){var s=d(r[o]);e.notUnset(s)&&(s>=2?++i:++n)}return i>0||!(n>=2)&&null}(0,h);p=g?[i.SINGLE]:null!==g?[i.DOUBLE]:[i.DOUBLE,i.SINGLE]}for(var f,C=0,m=p.length;C<m;++C){f=!0;var T=p[C];a.set(c,{bondOrder:T}),c.setBondOrder(T);for(var E=0,_=h.length;E<_;++E){var S=h[E];if(d(S)<0){f=!1;break}}if(f){if(!(r<n.length-1)){f=!0;break}if(f=this._doKekulizeContinousBondSys(r+1,n,o,a))break}}return!!f||(c.setBondOrder(i.EXPLICIT_AROMATIC),a.remove(c),!1)}},_splitConnectorsToContinuousParts:function(e){if(!e||!e.length)return null;for(var r=function(e,t){var i=t.indexOf(e);if(i<0)return[];t.splice(i,1);for(var n=[e],o=e.getNeighboringConnectors(),a=0,s=o.length;a<s;++a){var l=o[a];t.indexOf(l)>=0&&(n=n.concat(r(l,t)))}return n},i=[],n=t.clone(e);n.length;){var o=n[0],a=r(o,n);a&&a.length&&i.push(a)}return i}}),ClassEx.extend(Kekule.StructureFragment,{perceiveAromaticRings:function(e,t){var r=this.hasCtab()?this.getCtab().perceiveAromaticRings(e,t):[];return this.setAromaticRings(r||[]),r},findAromaticRings:function(e,t){return this.perceiveAromaticRings(e,t)},getRingAromaticType:function(e,t){return this.hasCtab()?this.getCtab().getRingAromaticType(e,t):null},getHucklizationChanges:function(e,t){return this.hasCtab()?this.getCtab().getHucklizationChanges(e,t):[]},hucklize:function(e,t){return this.hasCtab()?this.getCtab().hucklize(e,t):[]},getKekulizationChanges:function(e,t){return this.hasCtab()?this.getCtab().getKekulizationChanges(e,t):[]},kekulize:function(e,t){return this.hasCtab()?this.getCtab().kekulize(e,t):[]}}),ClassEx.extend(Kekule.ChemObject,{perceiveAromaticRings:function(e,t){for(var r=n.getAllStructFragments(this),i=[],o=0,a=r.length;o<a;++o){var s=r[o].perceiveAromaticRings(e,t);s&&(i=i.concat(s))}return i.length?i:null},findAromaticRings:function(e,t){return this.perceiveAromaticRings(e,t)},_groupActualTargetBondsOfKekulizationOrHucklization:function(e,t,r){var i=[];if(t)for(l=0,u=t.length;l<u;++l)for(var n=t[l],o=0,a=e.length;o<a;++o){var s=e[o];n.isChildOf(s)&&(i[o]?i[o].bonds.push(n):i[o]={structFragment:s,bonds:[n]})}else for(var l=0,u=e.length;l<u;++l)i.push({structFragment:e[l],bonds:null});return i},getHucklizationChanges:function(e,t){for(var r=[],i=n.getAllStructFragments(this),o=this._groupActualTargetBondsOfKekulizationOrHucklization(i,e,t),a=0,s=o.length;a<s;++a){var l=o[a];l&&(r=r.concat(l.structFragment.getHucklizationChanges(l.bonds,t)||[]))}return r},hucklize:function(e,t){for(var r=[],i=n.getAllStructFragments(this),o=this._groupActualTargetBondsOfKekulizationOrHucklization(i,e,t),a=0,s=o.length;a<s;++a){var l=o[a];l&&(r=r.concat(l.structFragment.hucklize(l.bonds,t)||[]))}return r},getKekulizationChanges:function(e,t){for(var r=[],i=n.getAllStructFragments(this),o=this._groupActualTargetBondsOfKekulizationOrHucklization(i,e,t),a=0,s=o.length;a<s;++a){var l=o[a];l&&(r=r.concat(l.structFragment.getKekulizationChanges(l.bonds,t)||[]))}return r},kekulize:function(e,t){for(var r=[],i=n.getAllStructFragments(this),o=this._groupActualTargetBondsOfKekulizationOrHucklization(i,e,t),a=0,s=o.length;a<s;++a){var l=o[a];l&&(r=r.concat(l.structFragment.kekulize(l.bonds,t)||[]))}return r}})}(),function(){"use strict";Kekule.globalOptions.add("algorithm.molStandardization",{cleanStructure:!0,clearHydrogens:!0,unmarshalSubFragments:!0,doCanonicalization:!0,doAromaticPerception:!0,doStereoPerception:!0}),Kekule.MolStandardizer={standardize:function(e,t){var r=Object.extend({},Kekule.globalOptions.algorithm.molStandardization),i=e,n=Object.extend(r,t);return n.unmarshalSubFragments&&i.unmarshalAllSubFragments(!0),n.cleanStructure&&i.clean(),n.hucklizeStructure&&i.hucklize(),n.doCanonicalization&&Kekule.canonicalizer.canonicalize(i,n.canonicalizerExecutorId||null),n.doAromaticPerception&&i.perceiveAromaticRings(),n.doStereoPerception&&i.perceiveStereos(null,!0,n),n.clearHydrogens&&i.clearExplicitBondHydrogens(!0),i}},Object.extend(Kekule.ChemStructureUtils,{compareStructFragment:function(e,t,r){var i=e.clone(!1),n=t.clone(!1);i.setCanonicalizationIndex(null),n.setCanonicalizationIndex(null);var o=Object.create(r||{});return void 0===o.hucklizeStructure&&(o.hucklizeStructure=!0),i=Kekule.MolStandardizer.standardize(i,o),n=Kekule.MolStandardizer.standardize(n,o),o.doStandardize=!1,o.extraComparisonProperties=["canonicalizationIndex"],i.compareStructure(n,o)},isSameStructure:function(e,t,r){return 0===Kekule.ChemStructureUtils.compareStructFragment(e,t,r)}}),ClassEx.extend(Kekule.ChemObject,{standardize:function(e){for(var t=Kekule.ChemStructureUtils.getAllStructFragments(this,!0),r=0,i=t.length;r<i;++r)t[r].standardize(e);return this}}),ClassEx.extend(Kekule.StructureFragment,{standardize:function(e){return Kekule.MolStandardizer.standardize(this,e)},isSameStructureWith:function(e,t){return Kekule.ChemStructureUtils.isSameStructure(this,e,t)}}),ClassEx.extendMethod(Kekule.StructureFragment,"compare",function($origin,e,t){return t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&!1!==t.doStandardize&&e instanceof Kekule.StructureFragment?Kekule.ChemStructureUtils.compareStructFragment(this,e,t):$origin(e,t)})}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.globalOptions.add("algorithm.structureSearch",{doStandardize:!0}),Kekule.ChemStructureSearcher={findSubStructure:function(r,i,n){var o=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.structureSearch),n);if(o.exactMatch)return!!i.isSameStructureWith(r,o)&&[].concat(i.getNodes()).concat(i.getConnectors());o=Object.extend({level:Kekule.StructureComparationLevel.CONSTITUTION,compareLinkedConnectorCount:!1,compareHydrogenCount:!1,compareConnectedObjCount:!1},o);var a=o=Kekule.ObjComparer.getStructureComparisonDetailOptions(o);if(o.doStandardize){var s={unmarshalSubFragments:!1,doCanonicalization:!0,doAromaticPerception:!0,hucklizeStructure:!0};o.compareStereo||(s.doCanonicalization=!1),r.standardize(s),i.standardize(s)}for(var l=i.getFlattenedShadowFragment(!0),u=r.getFlattenedShadowFragment(!0).getNonHydrogenNodes()[0],d=l.getNonHydrogenNodes(),c=d.length,h=0,p=[],g=[],f=!1;!f&&h<c;)f=t._compareNode(u,d[h],p,g,a),++h;if(f){var C=e.toUnique(f);return i.getFlatternedShadowSourceObjs(C)}return!1},_addToComparedObjs:function(e,t,r){t.push(e)},_removeFromComparedObjs:function(e,t,r){var i=t.indexOf(e);t.length=i},_isSameMappedObj:function(e,t,r,i){var n=i.indexOf(t),o=r.indexOf(e);return n>=0&&n===o},_compareComparedNeighbors:function(e,t,r,i){if(e.length>t.length)return!1;for(var n=[],o=0,a=e.length;o<a;++o)n.push(r.indexOf(e[o]));var s=[];for(o=0,a=t.length;o<a;++o)s.push(i.indexOf(t[o]));for(o=0,a=n.length;o<a;++o)if(s.indexOf(n[o])<0)return!1;return!0},_compareNode:function(r,i,n,o,a){if(0!==r.compareStructure(i,a))return!1;var s=r.getLinkedNonHydrogenConnectors(),l=i.getLinkedNonHydrogenConnectors();if(s.length>l.length)return!1;var u=e.clone(n),d=e.clone(o);t._addToComparedObjs(r,u,"target"),t._addToComparedObjs(i,d,"src");var c=e.intersect(s,u),h=e.intersect(l,d),p=!0;t._compareComparedNeighbors(c,h,u,d)?(s=e.exclude(s,c),l=e.exclude(l,h),s.length>l.length&&(p=!1)):p=!1;for(var g=[];p&&s.length;){for(var f,C=!1,m=s.shift(),T=0;l.length&&!C&&T<l.length;)f=l[T],(C=t._compareConnector(m,f,u,d,a))&&(g=g.concat(C)),++T;if(!C){p=!1;break}e.remove(l,f)}return p&&(p=[i].concat(g)),p},_compareConnector:function(r,i,n,o,a){if(0!==r.compareStructure(i,a))return!1;if(r.getConnectedObjCount()>i.getConnectedObjCount())return!1;var s=e.clone(n),l=e.clone(o);t._addToComparedObjs(r,s,"target"),t._addToComparedObjs(i,l,"src");var u=e.clone(r.getConnectedObjs()),d=e.clone(i.getConnectedObjs()),c=e.intersect(u,s),h=e.intersect(d,l),p=!0;t._compareComparedNeighbors(c,h,s,l)?(u=e.exclude(u,c),d=e.exclude(d,h),u.length>d.length&&(p=!1)):p=!1;for(var g=[];p&&u.length;){for(var f,C=!1,m=u.shift(),T=0;d.length&&!C&&T<d.length;)(C=(f=d[T]).getClass()===m.getClass()&&(f instanceof Kekule.ChemStructureNode?t._compareNode(m,f,s,l,a):f instanceof Kekule.ChemStructureConnector&&t._compareConnector(m,f,s,l,a)))&&(g=g.concat(C)),++T;if(!C){p=!1;break}e.remove(d,f)}return p&&(p=[i].concat(g)),p}};var t=Kekule.ChemStructureSearcher;ClassEx.extend(Kekule.StructureFragment,{search:function(e,r){return t.findSubStructure(e,this,r)}})}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.CoordUtils;Kekule.RotationDir={CLOCKWISE:1,ANTICLOCKWISE:-1,UNKNOWN:0};var r=Kekule.RotationDir;Kekule.globalOptions.add("algorithm.stereoPerception",{useFlattenedShadow:!0,perceiveStereoConnectors:!0,perceiveChiralNodes:!0,calcParity:!0,strictStereoBondGeometry:!1,strictStereoAtomGeometry:!1,wedgeBondPrior:!0}),Kekule.MolStereoUtils={FISCHER_PROJECTION_BOND_ALLOWED_ERROR:.08,getDihedralAngleOfNodes:function(e,t,r,i,n,o){Kekule.ObjUtils.isUnset(o)&&(o=!0),Kekule.ObjUtils.isUnset(n)&&(n=t.hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D);var a=Kekule.MolStereoUtils._getNodeCoordForBondParity,s=t.getConnectorTo(r),l=s&&s.isDoubleBond&&s.isDoubleBond(),u=a(t,null,null,n,o),d=a(r,null,null,n,o),c=a(e,t,u,n,o,l),h=a(i,r,d,n,o,l);return c&&u&&d&&h?Kekule.GeometryUtils.getDihedralAngleOfPoints(c,u,d,h):-1},getParityOfNodeSeq:function(e,t,r,i,n,o){var a=Kekule.StereoParity,s=Kekule.MolStereoUtils.getDihedralAngleOfNodes(e,t,r,i,n,o);return s<0?a.UNKNOWN:s<2*Math.PI/5||s>8*Math.PI/5?a.ODD:s>3*Math.PI/5&&s<7*Math.PI/5?a.EVEN:a.UNKNOWN},_getNodeCoordForBondParity:function(e,r,i,n,o,a){if(n!==Kekule.CoordMode.COORD2D)return e.getAbsCoordOfMode(n,!0);var s=e.getAbsCoordOfMode(n,!0);if(r&&i){var l=e.getConnectorTo(r);if(l.getStereo){var u=l.getStereo(),d=Kekule.BondStereo,c=[d.UP,d.UP_INVERTED,d.DOWN,d.DOWN_INVERTED];if(c.indexOf(u)>=0){l.indexOfConnectedObj(e)-l.indexOfConnectedObj(r)<0&&(u=d.getInvertedDirection(u));var h=t.getDistance(s,i);s.z=h*[1,-1,-1,1][c.indexOf(u)]}else if([d.UP_OR_DOWN,d.UP_OR_DOWN_INVERTED].indexOf(u)>=0)return null}}return s.z=s.z||0,s},_calcParityOfCoordPairs:function(e,r,i,n,o,a,s){var l=Kekule.StereoParity,u=t.substract(r,e);if(!u.x&&!u.y)return l.UNKNOWN;for(var d=Math.atan2(u.y,u.x),c=t.calcTransform2DMatrix({rotateAngle:-d,center:e,translateX:-e.x,translateY:-e.y}),h=[e,r,i,n,o,a],p=[],g=0,f=h.length;g<f;++g){var C=h[g];p[g]=C?t.transform2DByMatrix(C,c):null}p[0];var m=p[1],T=p[2],E=p[3],_=t.substract(p[4],m),S=p[5]?t.substract(p[5],m):null,O=function(e,t,r,i){var n=0,o=Math.sqrt(Math.sqr(e.x)+Math.sqr(e.y));if(t){var a=Math.sqrt(Math.sqr(t.x)+Math.sqr(t.y));l=e.y/o-t.y/a;if(Math.abs(l)<r)n=0;else if(Math.sign(e.y)!==Math.sign(t.y))n=Math.sign(l)*i;else{if(s)return 0;l=-(e.x/e.y-t.x/t.y),n=Math.sign(l)}}else{var l=e.y/o;n=Math.abs(l)<r?0:Math.sign(e.y)*i}return n},y=O(T,E,.05,-1),A=O(_,S,.05,1);return y&&A?y!==A?l.ODD:l.EVEN:l.UNKNOWN},isStereoBond:function(t){var r=Kekule.ObjUtils.isUnset;if(t.getBelongedRingMinSize){var i=t.getBelongedRingMinSize()||0;if(i>0&&i<=10)return!1}var n=!1;if(t.isDoubleBond&&t.isDoubleBond()&&2===t.getConnectedObjCount()){var o=t.getConnectedChemNodes();if(2===o.length){n=!0;for(var a=0;a<2;++a){for(var s=o[a],l=s.getHydrogenCount(!0),u=[],d=s.getLinkedBonds(Kekule.BondType.COVALENT),c=0,h=d.length;c<h;++c){var p=d[c];if(p!==t){var g=p.getBondOrder();if(g&&g!==Kekule.BondOrder.SINGLE)return!1;var f=e.exclude(p.getConnectedChemNodes(),o);if(1!==f.length)return!1;u.push(f[0])}}if(l>=2||!u.length){n=!1;break}if(1===u.length);else if(2===u.length&&(r(u[0].getCanonicalizationIndex())&&r(u[1].getCanonicalizationIndex())||u[0].getCanonicalizationIndex()===u[1].getCanonicalizationIndex())){n=!1;break}for(c=0,h=u.length;c<h;++c){var C=s.getConnectorTo(u[c]);if(!C.isSingleBond||!C.isSingleBond()){n=!1;break}}if(!n)break}}}else n=!1;return n},doFindStereoBonds:function(e,t){var r=[];t||Kekule.canonicalizer.canonicalize(e,"morganEx");for(var i=0,n=e.getConnectorCount();i<n;++i){var o=e.getConnectorAt(i);Kekule.MolStereoUtils.isStereoBond(o)&&r.push(o)}return r},getStereoBondKeyNodes:function(t){var r=null;if(2===t.getConnectedObjCount()){var i=t.getConnectedChemNodes();if(2===i.length){for(var n=[],o=0;o<2;++o){var a=i[o],s=e.exclude(a.getLinkedChemNodes(),i);if(1===s.length)n.push(s[0]);else{if(2!==s.length)return null;var l=s[0].getCanonicalizationIndex()||-1,u=s[1].getCanonicalizationIndex()||-1;n.push(u>l?s[1]:s[0])}}r=[n[0],i[0],i[1],n[1]]}}return r},getStereoBondKeyNeighborConnectors:function(e){var t=Kekule.MolStereoUtils.getStereoBondKeyNodes(e);return[t[1].getConnectorTo(t[0]),t[2].getConnectorTo(t[3])]},getStereoBondRelNodes:function(t){var r=null;if(2===t.getConnectedObjCount()){var i=t.getConnectedChemNodes();if(2===i.length){for(var n=[],o=0;o<2;++o){var a=i[o],s=e.exclude(a.getLinkedChemNodes(),i);if(1===s.length)n.push(s[0]),n.push(null);else{if(2!==s.length)return null;var l=s[0].getCanonicalizationIndex()||-1,u=s[1].getCanonicalizationIndex()||-1;n.push(u>l?s[1]:s[0]),n.push(u>l?s[0]:s[1])}}r=[i[0],i[1],n[0],n[1],n[2],n[3]]}}return r},calcStereoBondParity:function(e,t,r,i){var n=Kekule.StereoParity;if(!r&&!Kekule.MolStereoUtils.isStereoBond(e))return n.NONE;if(e.getStereo&&[Kekule.BondStereo.E_OR_Z,Kekule.BondStereo.CIS_OR_TRANS].indexOf(e.getStereo())>=0)return n.NONE;var o,a,s=n.UNKNOWN,l=Kekule.MolStereoUtils.getStereoBondKeyNodes(e);if(l&&l.length){if(Kekule.ObjUtils.isUnset(t)&&(t=l[1].hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D),t===Kekule.CoordMode.COORD3D){var u=Kekule.MolStereoUtils.getDihedralAngleOfNodes(l[0],l[1],l[2],l[3],t);if(u<0||u>2*Math.PI/5&&u<3*Math.PI/5||u>7*Math.PI/5&&u<8*Math.PI/5)return n.UNKNOWN}var d=Kekule.MolStereoUtils._getNodeCoordForBondParity,c=Kekule.MolStereoUtils.getStereoBondRelNodes(e),h=[d(c[0],null,null,t,!0),d(c[1],null,null,t,!0)];h=h.concat([d(c[2],c[0],h[0],t,!0,!0),c[3]?d(c[3],c[0],h[0],t,!0,!0):null,d(c[4],c[1],h[1],t,!0,!0),c[5]?d(c[5],c[1],h[1],t,!0,!0):null]);for(var p=t===Kekule.CoordMode.COORD2D?[["x","y"]]:[["x","y"],["x","z"],["y","z"]],g=null,f=0,C=p.length;f<C;++f){for(var m=[],T=0,E=h.length;T<E;++T)h[T]?m.push((o=h[T],a=p[f],o?{x:o[a[0]],y:o[a[1]]}:null)):m.push(null);var _=Kekule.MolStereoUtils._calcParityOfCoordPairs(m[0],m[1],m[2],m[3],m[4],m[5],i);if(_!==n.UNKNOWN)if(null===g)g=_;else if(g!==_)return n.UNKNOWN}s=g}return s},doPerceiveStereoConnectors:function(e,t,r,i){var n=Kekule.MolStereoUtils.doFindStereoBonds(e,r);e.beginUpdate();try{if(n&&n.length)for(var o=0,a=n.length;o<a;++o){var s=n[o],l=Kekule.MolStereoUtils.calcStereoBondParity(s,t,!0,i);s.setParity&&s.setParity(l)}}finally{e.endUpdate()}return n},isChiralNode:function(e){var t=!1;if(e.mayContainElement){var r,i,n=null,o=!1;if(e.mayContainElement("C")||e.mayContainElement("Si")?(r=4,i=0,n=[0],o=!0):e.mayContainElement("N")?(r=4,i=0,o=!0):e.mayContainElement("S")||e.mayContainElement("P")?(r=3,i=0,o=!0):e.mayContainElement("B")&&(r=3,i=0,n=[-1],o=!0),o){if(e.getLinkedMultiCenterBonds().length)return!1;var a=e.getLinkedChemNodes(),s=e.getLinkedMultipleBonds(),l=e.getHydrogenCount?e.getHydrogenCount():0,u=e.getHydrogenCount?e.getHydrogenCount(!0):0,d=e.getCharge()||0;if(s.length>i||u>=2||a.length+l<r||n&&n.indexOf(d)<0)t=!1;else{t=!0;for(var c=[],h=0,p=a.length;h<p;++h){var g=a[h].getCanonicalizationIndex()||0;if(c[g]){t=!1;break}c[g]=1}}}}return t},doFindChiralNodes:function(e,t){var r=[];t||Kekule.canonicalizer.canonicalize(e,"morganEx");for(var i=0,n=e.getNodeCount();i<n;++i){var o=e.getNodeAt(i);Kekule.MolStereoUtils.isChiralNode(o)&&r.push(o)}return r},calcRotationDirection:function(e,i,n,o,a,s){var l,u=s?t.substract(e,i):t.substract(i,e),d=null;0!==u.x||0!==u.y?(l=Kekule.GeometryUtils.getVectorCrossProduct(u,{x:0,y:0,z:1}),g=Kekule.GeometryUtils.getVectorIncludedAngle(u,{x:0,y:0,z:1}),u.z<0&&(g=Math.PI-g)):u.z<0&&(l={x:1,y:0,z:0},g=Math.PI),l&&g&&(d=t.calcRotate3DMatrix({rotateAngle:g,rotateAxisVector:l,center:{x:0,y:0,z:0}}));var c=t.substract(n,e),h=t.substract(o,e),p=t.substract(a,e);d&&(c=t.transform3DByMatrix(c,d),h=t.transform3DByMatrix(h,d),p=t.transform3DByMatrix(p,d));var g=-Math.atan2(c.y,c.x),f=(d=t.calcTransform2DMatrix({rotateAngle:g,center:{x:0,y:0,z:0}}),t.transform2DByMatrix(h,d)),C=t.transform2DByMatrix(p,d);if(0===f.x||0===C.x)return r.UNKNOWN;var m=Math.atan2(f.y,f.x),T=Math.atan2(C.y,C.x);return T<0&&(T=2*Math.PI+T),m<0&&(m=2*Math.PI+m),m<T?r.ANTICLOCKWISE:m>T?r.CLOCKWISE:r.UNKNOWN},_extractFischerProjectionDetectOptions:function(e){var t=e||{};return{allowedError:t.fischerAllowedError,reversedDirection:t.reversedFischer,allowExplicitHydrogen:t.allowExplicitHydrogenInFischer,allowExplicitVerticalHydrogen:t.allowExplicitVerticalHydrogen}},_getFischerProjectionInfo:function(e,r,i){var n=Object.create(i||null);if(r.length<3||r.length>4)return null;if(3===r.length&&!n.allowExplicitHydrogen)return null;var o=Kekule.CoordMode.COORD2D,a=n.allowedError||Kekule.MolStereoUtils.FISCHER_PROJECTION_BOND_ALLOWED_ERROR;if(!n.ignoreStructure){var s=e instanceof Kekule.Atom&&6===e.getAtomicNumber();if(s&&e.getRenderOption&&(s=e.getRenderOption("nodeDisplayMode")!==Kekule.Render.NodeLabelDisplayMode.SHOWN),s)s=!e.getExplicitHydrogenCount();if(!s)return null}for(var l=e.getAbsCoordOfMode(o,!0),u=[],d=[],c=0,h=function(e,t,r){return!e[t]&&(e[t]=r,!0)},p=0,g=r.length;p<g;++p){var f=r[p],C=f.getConnectorTo(e);if(!n.ignoreStructure){var m=C.getStereo()||Kekule.BondStereo.NONE;if(!(C instanceof Kekule.Bond&&m===Kekule.BondStereo.NONE))return null}var T,E,_=f.getAbsCoordOfMode(o,!0),S=t.substract(_,l),O=Math.abs(S.x),y=Math.abs(S.y);if(Kekule.NumUtils.isFloatEqual(O,0)&&Kekule.NumUtils.isFloatEqual(y,0))return null;if(O>y?(E=y/O,T=S.x>0?1:3):(E=O/y,T=S.y>0?0:2,++c),E>a)return null;if(!h(u,T,f))return null;h(d,T,C)}if(2!==c&&!n.allowExplicitVerticalHydrogen)return null;var A={horizontalSiblings:[u[3],u[1]],verticalSiblings:[u[0],u[2]],horizontalBonds:[d[3],d[1]],verticalBonds:[d[0],d[2]]};return n.reversedDirection?(A.towardSiblings=A.verticalSiblings,A.awaySiblings=A.horizontalSiblings,A.towardBonds=A.verticalBonds,A.awayBonds=A.horizontalBonds,A.implicitTowardSibling=!u[0]||!u[2],A.implicitAwaySibling=!u[1]||!u[3]):(A.towardSiblings=A.horizontalSiblings,A.awaySiblings=A.verticalSiblings,A.towardBonds=A.horizontalBonds,A.awayBonds=A.verticalBonds,A.implicitTowardSibling=!u[1]||!u[3],A.implicitAwaySibling=!u[0]||!u[2]),A},calcTetrahedronChiralCenterRotationDirectionEx:function(i,n,o,a){var s=Object.extend({implicitFischerProjection:!0,allowExplicitHydrogenInFischer:!0},a),l=s.coordMode,u=!!s.withImplicitSibling,d=!!s.refSiblingBehind;s.implicitFischerProjection;if(!l){var c=i||n||o[0];if(!c)return{direction:r.UNKNOWN};l=c.hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D}var h=l===Kekule.CoordMode.COORD2D,p=o.length,g=p;if(n&&++g,u&&++g,g<4)return{direction:r.UNKNOWN};var f=Kekule.MolStereoUtils._extractFischerProjectionDetectOptions(s),C=[].concat(o);n&&Kekule.ArrayUtils.pushUnique(C,n);var m=i&&s.implicitFischerProjection?Kekule.MolStereoUtils._getFischerProjectionInfo(i,C,f):null,T=e.clone(o);n&&e.pushUnique(T,n);for(var E=function(e,r,i,n,o,a){var l=Kekule.ObjUtils.isUnset,u=n!==Kekule.CoordMode.COORD2D,d=e&&e.getAbsCoordOfMode(n,a);d&&l(d.z)&&(u?d.z=0:e.getZIndex2D?d.z=e.getZIndex2D()||0:d.z=0);for(var c=[],h={count:0,sum:0},p=0,g=r.length;p<g;++p){var f=r[p];if(u)A=f.getAbsCoordOfMode(n,a);else{if(l((A=f.getAbsCoordOfMode(n,a)).z)){var C=f.getConnectorTo(e);if(C.getStereo&&e&&d){var m=C.indexOfConnectedObj(f)-C.indexOfConnectedObj(e),T=Kekule.BondStereo,E=C.getStereo()||T.NONE;E===T.NONE&&o&&(o.towardSiblings.indexOf(f)>=0?E=m<0?T.UP_INVERTED:T.UP:o.awaySiblings.indexOf(f)>=0&&(E=m<0?T.DOWN_INVERTED:T.DOWN));var _=[T.UP,T.UP_INVERTED,T.DOWN,T.DOWN_INVERTED];if(_.indexOf(E)>=0){m<0&&(E=T.getInvertedDirection(E));var S=s.wedgeBondPrior?[2,-2,-1,1]:[1,-1,-1,1],O=t.getDistance(A,d);A.z=O*S[_.indexOf(E)]+d.z}else[T.UP_OR_DOWN,T.UP_OR_DOWN_INVERTED].indexOf(E)>=0&&(A=null)}}A&&l(A.z)&&f.getZIndex2D&&(A.z=f.getZIndex2D()),A&&!l(A.z)&&!1!==A.z&&(h.sum+=A.z-d.z,++h.count)}c.push(A)}if(!u&&d){var y;for(y=-h.sum/(i-h.count)+d.z,p=0,g=r.length;p<g;++p){var A;(A=c[p])&&l(A.z)&&(A.z=y)}}var I=new Kekule.MapEx;e&&I.set(e,d);for(p=0,g=r.length;p<g;++p)I.set(r[p],c[p]);return I}(i,T,g,l,m,!0),_=E.get(i),S=function(e,t,r,i,n){return E.get(e)},O=[],y=0;y<p;++y){var A=S(o[y]);O.push(A)}var I=e.clone(O),k=n?S(n):null;if(k&&I.push(k),I.indexOf(null)>=0)return{direction:r.UNKNOWN,fischerInfo:m};if(!_){for(var b={},v=(y=0,I.length);y<v;++y)b=t.add(I[y],b);_=t.divide(b,I.length)}var R=0;for(y=0,v=I.length;y<v;++y){var D=I[y],N=t.substract(D,_);D.x=N.x,D.y=N.y,D.z=N.z,h&&N.z&&++R}if(h&&R<=0)return{direction:r.UNKNOWN,fischerInfo:m};if(_={x:0,y:0,z:0},u){var P=0;for(b={},y=0,v=I.length;y<v;++y)b=t.add(I[y],b),P=Math.max(P,I[y].z||0);var M=t.substract({x:0,y:0,z:0},b);m&&(m.implicitTowardSibling||m.implicitTowardSibling)&&(M.z=m.implicitTowardSibling?P:-P),n?O.push(M):k=M}return 3===O.length&&O.indexOf(null)<0?{direction:Kekule.MolStereoUtils.calcRotationDirection(_,k,O[0],O[1],O[2],d),fischerInfo:m}:{direction:r.UNKNOWN,fischerInfo:m}},calcTetrahedronChiralCenterRotationDirection:function(e,t,r,i,n,o,a){var s=Object.create(a);return Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirectionEx(t,r,i,Object.extend(s,{coordMode:e,withImplicitSibling:n,refSiblingBehind:o})).direction},calcTetrahedronChiralNodeParity:function(e,t,i){var n=Object.create(i||null);t||(t=e.hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D),n.coordMode=t,n.refSiblingBehind=!0;var o=Kekule.StereoParity;if(!n.ignoreChiralCheck&&!Kekule.MolStereoUtils.isChiralNode(e))return o.NONE;var a=e.getLinkedChemNodes();if(t===Kekule.CoordMode.COORD2D&&i.strictStereoAtomGeometry&&!Kekule.MolStereoUtils._isSiblingBond2DGeometryLegal(e,a))return o.UNKNOWN;var s=e.getHydrogenCount();n.withImplicitSibling=!!s||a.length<4,a.sort(function(e,t){return-((e.getCanonicalizationIndex()||0)-(t.getCanonicalizationIndex()||0))});var l=n.withImplicitSibling?null:a[3];a=a.slice(0,3);var u=Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirectionEx(e,l,a,n).direction;return u===r.CLOCKWISE?o.ODD:u===r.ANTICLOCKWISE?o.EVEN:o.UNKNOWN},_isSiblingBond2DGeometryLegal:function(e,t){for(var r=Kekule.BondStereo,i=[r.NONE,r.CLOSER],n=[2,2],o=[],a=0,s=t.length;a<s;++a){var l=t[a];if(!l.getZIndex2D()){var u=e.getConnectorTo(l);if(u.getStereo){var d=u.getStereo();if(i.indexOf(d)>=0)if(o[d]){if(++o[d],o[d]>n[d])return!1}else o[d]=1}}}return!0},doPerceiveChiralNodes:function(e,t,r,i){var n=Object.create(i||null),o=Object.create(n);o.ignoreChiralCheck=!0;var a=Kekule.MolStereoUtils.doFindChiralNodes(e,r);e.beginUpdate();try{if(a&&a.length)for(var s=0,l=a.length;s<l;++s){var u=a[s],d=Kekule.MolStereoUtils.calcTetrahedronChiralNodeParity(u,t,o);u.setParity&&u.setParity(d)}}finally{e.endUpdate()}return a},perceiveStereos:function(e,t,r,i){var n,o,a=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.stereoPerception),i),s=e instanceof Kekule.StructureConnectionTable?e.getParent():e;o=a.useFlattenedShadow?s.getFlattenedShadowFragment(!0):s,r||Kekule.canonicalizer.canonicalize(o,"morganEx"),o.beginUpdate();try{var l,u;a.perceiveStereoConnectors&&(l=a.calcParity?Kekule.MolStereoUtils.doPerceiveStereoConnectors(o,t,!0,a.strictStereoBondGeometry):Kekule.MolStereoUtils.doFindStereoBonds(o,!0)),a.perceiveChiralNodes&&(u=a.calcParity?Kekule.MolStereoUtils.doPerceiveChiralNodes(o,t,!0,a):Kekule.MolStereoUtils.doFindChiralNodes(o,!0));var d=(u||[]).concat(l||[]);if(a.useFlattenedShadow&&!s.getFlattenedShadowOnSelf()){n=[],s.beginUpdate();try{for(var c=0,h=d.length;c<h;++c){var p=s.getFlatternedShadowSourceObj(d[c]);p&&(a.calcParity&&p.setParity(d[c].getParity()),n.push(p))}}finally{s.endUpdate()}}else n=d}finally{o.endUpdate()}return n},_setWedgeAroundFischerCenter:function(e,t,r,i){for(var n=Kekule.BondStereo,o=function(e,t,r){(e.setStereo(d),r)&&(e.getRenderOption("renderType")||e.setRenderOption("renderType",Kekule.Render.BondRenderType.SINGLE))},a=!(!i||!i.maintainRenderStyle),s=0,l=t.towardBonds.length;s<l;++s){var u=t.towardBonds[s];if(r.indexOf(u)>=0){var d=u.indexOfConnectedObj(e)>0?n.UP_INVERTED:n.UP;o(u,0,a)}}for(s=0,l=t.awayBonds.length;s<l;++s){u=t.awayBonds[s];if(r.indexOf(u)>=0){d=u.indexOfConnectedObj(e)>0?n.DOWN_INVERTED:n.DOWN;o(u,0,a)}}},convertFischerCenterBondsToWedge:function(e,t,r,i){r||(r=t.getLinkedBonds());var n=t.getLinkedChemNodes(),o=(Kekule.MolStereoUtils._extractFischerProjectionDetectOptions(i),Kekule.MolStereoUtils._getFischerProjectionInfo(t,n,fischerOptions));if(o){e.beginUpdate();try{Kekule.MolStereoUtils._setWedgeAroundFischerCenter(t,o,r,i)}finally{e.endUpdate()}}},convertFischerBondsToWedge:function(e,t){for(var r=Kekule.MolStereoUtils.perceiveStereos(e,null,null,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!1}),i=Kekule.MolStereoUtils._extractFischerProjectionDetectOptions(t),n=new Kekule.MapEx,o=[],a=0,s=r.length;a<s;++a){var l=r[a].getLinkedChemNodes();(c=Kekule.MolStereoUtils._getFischerProjectionInfo(r[a],l,i))&&(n.set(r[a],c),o.push(r[a]))}var u=function(e,t,r){for(var i=[],n=0,o=e.length;n<o;++n){var a=e[n],s=t.getLinkedObjsOnConnector(a);Kekule.ArrayUtils.intersect(s,r).length||i.push(a)}return i};e.beginUpdate();try{for(a=0,s=o.length;a<s;++a){var d=o[a],c=n.get(d),h=[].concat(c.towardBonds).concat(c.awayBonds);h=u(h,d,o),Kekule.MolStereoUtils._setWedgeAroundFischerCenter(d,c,h,t)}}finally{e.endUpdate()}},findStereoConnectors:function(e,t){return Kekule.MolStereoUtils.perceiveStereos(e,null,t,{perceiveStereoConnectors:!0,perceiveChiralNodes:!1,calcParity:!1})},perceiveStereoConnectors:function(e,t,r,i){return Kekule.MolStereoUtils.perceiveStereos(e,t,r,{perceiveStereoConnectors:!0,perceiveChiralNodes:!1,calcParity:!0,strictStereoBondGeometry:i})},findChiralNodes:function(e,t){return Kekule.MolStereoUtils.perceiveStereos(e,null,t,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!1})},perceiveChiralNodes:function(e,t,r,i){var n=Object.create(i||null);return n=Object.extend(n,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!0}),Kekule.MolStereoUtils.perceiveStereos(e,t,r,n)}},Kekule.CanonicalizationMorganExIndexer=Class.create(Kekule.CanonicalizationMorganIndexer,{CLASS_NAME:"Kekule.CanonicalizationMorganExIndexer",doExecute:function(e){var t=this.doCalcGraphAndEcResult(e);this.doExecuteOnGraphEcResult(t.graph,t.ecMapping,t.vertexGroup);var r=e.getNonHydrogenNodes(),i=this._groupNodesByCanoIndex(r),n=null,o=0;for(n=Kekule.MolStereoUtils.perceiveStereos(e,null,!0)||[];o<n.length;)i=this._regroupSortedNodes(i),this._setCanonicalizationIndexToNodeGroups(i),o=n.length,n=Kekule.MolStereoUtils.perceiveStereos(e,null,!0)||[];o>0&&this.doExecuteOnGraphEcResult(t.graph,t.ecMapping,t.vertexGroup)},_groupNodesByCanoIndex:function(t){return e.group(t,function(e,t){return(e.getCanonicalizationIndex()||-1)-(t.getCanonicalizationIndex()||-1)})},_regroupSortedNodes:function(e){var t,r,i=e;do{t=i.length,r=(i=this._doRegroupSortedNodes(i)).length}while(r>t);return i},_doRegroupSortedNodes:function(t){for(var r=[],i=0,n=t.length;i<n;++i){var o=t[i];if(e.isArray(o)){var a=e.group(o,function(e,t){var r=e.compareStructure(t);if(0===r){var i=e.getLinkedConnectors(),n=t.getLinkedConnectors();r=Kekule.ObjComparer.compareStructure(i,n)}return r});r=r.concat(a)}else r.push(o)}return r}}),Kekule.canonicalizer.registerExecutor("morganEx",[Kekule.CanonicalizationMorganExIndexer,Kekule.CanonicalizationMorganNodeSorter],!0),ClassEx.extend(Kekule.StructureFragment,{perceiveChiralNodes:function(e,t,r){return Kekule.MolStereoUtils.perceiveChiralNodes(this,e,t,r)},perceiveStereoConnectors:function(e,t){return Kekule.MolStereoUtils.perceiveStereoConnectors(this,e,t)},perceiveStereos:function(e,t,r){return Kekule.MolStereoUtils.perceiveStereos(this,e,t,r)}})}(),function(){"use strict";Kekule.Calculator={},Kekule.Calculator.Utils={_instanceMaxIndex:0,generateUid:function(){return++Kekule.Calculator.Utils._instanceMaxIndex,"Kekule.Calculator."+Kekule.Calculator.Utils._instanceMaxIndex}},Kekule.Calculator.getWorkerBasePath=function(){var e=Kekule.isUsingMinJs()?"workers/":"calculation/workers/";return e=Kekule.getScriptPath()+e},Kekule.Calculator.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Calculator.Base",WORKER_SHARED_COUNT_FIELD:"__$workerSharedCount$__",initialize:function(){this.setPropStoreFieldValue("uid",this._generateUid()),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("async",{dataType:DataType.BOOL}),this.defineProp("worker",{dataType:DataType.OBJECT,setter:null}),this.defineProp("uid",{dataType:DataType.STRING,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAsync(!0),this.reactWorkerMessageBind=this.reactWorkerMessage.bind(this),this.reactWorkerErrorBind=this.reactWorkerError.bind(this)},doFinalize:function(){this.finalizeWorker(),this.tryApplySuper("doFinalize")},_generateUid:function(){return Kekule.Calculator.Utils.generateUid()},isWorkerShared:function(){return!1},_incWorkerSharedCount:function(e){if(this.isWorkerShared()){var t=e[this.WORKER_SHARED_COUNT_FIELD]||0;++t,e[this.WORKER_SHARED_COUNT_FIELD]=t}},_decWorkerSharedCount:function(e){if(this.isWorkerShared()){var t=e[this.WORKER_SHARED_COUNT_FIELD]||0;t&&--t,e[this.WORKER_SHARED_COUNT_FIELD]=t}},_isWorkerInSharingState:function(e){return this.isWorkerShared()&&(e[this.WORKER_SHARED_COUNT_FIELD]||0)>0},getWorkerBasePath:function(){return Kekule.Calculator.getWorkerBasePath()},execute:function(e,t,r){if(this._doneCallback=e,this._errCallback=t,this._msgCallback=r,this.getAsync()&&this.isWorkerSupported()&&this.fetchWorker()){var i=this.getWorker();this._incWorkerSharedCount(i),this._installWorkerEventReceiver(i),this.workerStartCalc(i)}else{var n,o;try{o=this.executeSync(e)}catch(e){n=e}n?(Kekule.error(n),this.error(n)):o&&(n?this.error(n):this.done())}},executeSync:function(e){this._doneCallback=e;var t=this.doExecuteSync(e);return t&&this.done(),t},doExecuteSync:function(e){},error:function(e){if(!this._errCallback)throw e;this._errCallback(e)},done:function(){this._doneCallback&&this._doneCallback.apply(this,arguments),this.getWorker()&&this.workerJobDone()},halt:function(){var e=this.getWorker();e&&(e.terminate(),this.error(Kekule.$L("ErrorMsg.CALC_TERMINATED_BY_USER")))},isWorkerSupported:function(){return Kekule.BrowserFeature.workers},fetchWorker:function(){var e=this.getWorker();return e||(e=this.createWorker()),e},createWorker:function(){if(this.isWorkerSupported()){var e=this.getWorkerScriptFile();if(e){var t=new Worker(e);return this.setPropStoreFieldValue("worker",t),t}}},_installWorkerEventReceiver:function(e){e.addEventListener("message",this.reactWorkerMessageBind),e.addEventListener("error",this.reactWorkerErrorBind)},_uninstallWorkerEventReceiver:function(e){e.removeEventListener("message",this.reactWorkerMessageBind),e.removeEventListener("error",this.reactWorkerErrorBind)},getWorkerScriptFile:function(){return null},importWorkerScriptFile:function(e){this.postWorkerMessage({type:"importScript",url:e})},postWorkerMessage:function(e){var t=Object.extend({uid:this.getUid()},e),r=this.getWorker();r&&r.postMessage(t)},reactWorkerMessage:function(e){return e.data.uid===this.getUid()?(this._msgCallback&&this._msgCallback(e.data),this.doReactWorkerMessage(e.data,e)):null},doReactWorkerMessage:function(e,t){},reactWorkerError:function(e){this.error(e.message)},workerStartCalc:function(e){},workerJobDone:function(){var e=this.getWorker();e&&(this._uninstallWorkerEventReceiver(e),this._decWorkerSharedCount(e))},finalizeWorker:function(){var e=this.getWorker();e&&(this._isWorkerInSharingState(e)||e.terminate(),this.setPropStoreFieldValue("worker",null))}}),Kekule.Calculator.AbstractStructureGenerator=Class.create(Kekule.Calculator.Base,{CLASS_NAME:"Kekule.Calculator.AbstractStructureGenerator",initProperties:function(){this.defineProp("sourceMol",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("generatedMol",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("childObjMap",{dataType:"Kekule.MapEx",serializable:!1}),this.defineProp("options",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("options");return e||(e={},this.setPropStoreFieldValue("options",e)),e}})},getGeneratorCoordMode:function(){return Kekule.CoordMode.COORD3D},done:function(){this._modifySourceAccordingToGeneratedMol(this.getSourceMol(),this.getGeneratedMol(),this.getChildObjMap()),this.tryApplySuper("done")},_modifySourceAccordingToGeneratedMol:function(e,t,r){var i=r;if(i){var n=this.getGeneratorCoordMode(),o=i.getKeys();e.beginUpdate();try{for(var a=0,s=o.length;a<s;++a)if(o[a]instanceof Kekule.ChemStructureNode){var l=o[a],u=i.get(l).getCoordOfMode(n);l.setCoordOfMode(u,n)}}finally{e.endUpdate()}}}}),Kekule.Calculator.ServiceManager={_serviceInfos:{},_getServiceClassInfos:function(t,r){var i=e._serviceInfos[t];return!i&&r&&(i=[],e._serviceInfos[t]=i),i},_findServiceClassInfoItemIndex:function(t,r,i){var n=e._getServiceClassInfos(t,!1);if(n)for(var o=n.length-1;o>=0;--o){var a=n[o];if(a&&!(r&&a.serviceClass!==r||i&&a.id!==i))return o}return-1},register:function(t,r,i,n){var o=e._getServiceClassInfos(t,!0),a=e._findServiceClassInfoItemIndex(t,r);a>=0&&o.splice(a,1),o.push({serviceClass:r,id:i,priorityLevel:n||0})},unregister:function(t,r){var i=e._findServiceClassInfoItemIndex(t,r);i>=0&&e._getServiceClassInfos(t,!1).splice(i,1)},_getRegisteredServiceInfo:function(t,r){var i=-1,n=null,o=e._getServiceClassInfos(t);if(o)for(var a=0,s=o.length;a<s;++a){var l=o[a];if(l){if(r&&l.id===r){n=l;break}(!n||l.priorityLevel>=i)&&(n=l,i=l.priorityLevel)}}return n},getServiceClass:function(t,r){var i=e._getRegisteredServiceInfo(t,r);return i&&i.serviceClass}};var e=Kekule.Calculator.ServiceManager;Kekule.Calculator.Services={GEN2D:"2D structure generator",GEN3D:"3D structure generator"},Kekule.Calculator.hasService=function(t){return!!e.getServiceClass(t)},Kekule.Calculator.generateStructure=function(t,r,i,n,o,a){var s=r||Kekule.Calculator.Services.GEN3D,l=e.getServiceClass(s);if(l){var u,d=new l;d.setChildObjMap&&(u=new Kekule.MapEx(!0),d.setChildObjMap(u));var c=function(e){o&&o(e)};try{d.setSourceMol(t),d.setOptions(i),i&&i.sync&&d.setAsync(!1),d.execute(function(){n&&n(d.getGeneratedMol(),u)},c,function(e){a&&a(e)})}catch(e){c(e)}return d}var h=Kekule.$L("ErrorMsg.CALC_SERVICE_UNAVAILABLE").format(s);return o&&o(h),null},Kekule.Calculator.generate3D=function(e,t,r,i,n){return Kekule.Calculator.generateStructure(e,Kekule.Calculator.Services.GEN3D,t,r,i,n)},Kekule.Calculator.generate2D=function(e,t,r,i,n){return Kekule.Calculator.generateStructure(e,Kekule.Calculator.Services.GEN2D,t,r,i,n)}}(),Kekule.chemicalElementsData=[{symbol:"H",casId:"1333-74-0",group:1,period:1,name:"Hydrogen",atomicNumber:1,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.37,radiiVdw:1.2,paulingE:2.2,naturalMass:1.00794075382579},{symbol:"He",casId:"7440-59-7",group:18,period:1,name:"Helium",atomicNumber:2,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.32,radiiVdw:1.4,naturalMass:4.002601902393709},{symbol:"Li",casId:"7439-93-2",group:1,period:2,name:"Lithium",atomicNumber:3,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:.32,radiiVdw:2.2,paulingE:.98,naturalMass:6.9400376247955},{symbol:"Be",casId:"7440-41-7",group:2,period:2,name:"Beryllium",atomicNumber:4,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:.9,radiiVdw:1.9,paulingE:1.57,naturalMass:9.0121822},{symbol:"B",casId:"7440-42-8",group:13,period:2,name:"Boron",atomicNumber:5,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:.82,radiiVdw:1.8,paulingE:2.04,naturalMass:10.811028088400002},{symbol:"C",casId:"7440-44-0",group:14,period:2,name:"Carbon",atomicNumber:6,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:.77,radiiVdw:1.7,paulingE:2.55,naturalMass:12.010735896788},{symbol:"N",casId:"7727-37-9",group:15,period:2,name:"Nitrogen",atomicNumber:7,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.77,radiiVdw:1.6,paulingE:3.04,naturalMass:14.006743088432001},{symbol:"O",casId:"7782-44-7",group:16,period:2,name:"Oxygen",atomicNumber:8,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.73,radiiVdw:1.55,paulingE:3.44,naturalMass:15.999404927569397},{symbol:"F",casId:"7782-41-4",group:17,period:2,name:"Fluorine",atomicNumber:9,chemicalSerie:"Halogens",phase:"Gas",radiiCova:.73,radiiVdw:1.5,paulingE:3.98,naturalMass:18.99840322},{symbol:"Ne",casId:"7440-01-9",group:18,period:2,name:"Neon",atomicNumber:10,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.69,radiiVdw:1.54,naturalMass:20.180046383574997},{symbol:"Na",casId:"7440-23-5",group:1,period:3,name:"Sodium",atomicNumber:11,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.54,radiiVdw:2.4,paulingE:.93,naturalMass:22.98976928},{symbol:"Mg",casId:"7439-95-4",group:2,period:3,name:"Magnesium",atomicNumber:12,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.3,radiiVdw:2.2,paulingE:1.31,naturalMass:24.305051612423004},{symbol:"Al",casId:"7429-90-5",group:13,period:3,name:"Aluminum",atomicNumber:13,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.18,radiiVdw:2.1,paulingE:1.61,naturalMass:26.98153863},{symbol:"Si",casId:"7440-21-3",group:14,period:3,name:"Silicon",atomicNumber:14,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.11,radiiVdw:2.1,paulingE:1.9,naturalMass:28.085384754933294},{symbol:"P",casId:"7723-14-0",group:15,period:3,name:"Phosphorus",atomicNumber:15,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.06,radiiVdw:1.95,paulingE:2.19,naturalMass:30.97376163},{symbol:"S",casId:"7704-34-9",group:16,period:3,name:"Sulfur",atomicNumber:16,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.02,radiiVdw:1.8,paulingE:2.58,naturalMass:32.066084993038},{symbol:"Cl",casId:"7782-50-5",group:17,period:3,name:"Chlorine",atomicNumber:17,chemicalSerie:"Halogens",phase:"Gas",radiiCova:.99,radiiVdw:1.8,paulingE:3.16,naturalMass:35.452538168202},{symbol:"Ar",casId:"7440-37-1",group:18,period:3,name:"Argon",atomicNumber:18,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.97,radiiVdw:1.8,naturalMass:39.947676710841314},{symbol:"K",casId:"7440-09-7",group:1,period:4,name:"Potassium",atomicNumber:19,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.96,radiiVdw:2.8,paulingE:.82,naturalMass:39.09830112446276},{symbol:"Ca",casId:"7440-70-2",group:2,period:4,name:"Calcium",atomicNumber:20,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.74,radiiVdw:2.4,paulingE:1,naturalMass:40.078022651988505},{symbol:"Sc",casId:"7440-20-2",group:3,period:4,name:"Scandium",atomicNumber:21,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.3,paulingE:1.36,naturalMass:44.9559119},{symbol:"Ti",casId:"7440-32-6",group:4,period:4,name:"Titanium",atomicNumber:22,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.15,paulingE:1.54,naturalMass:47.866749245159994},{symbol:"V",casId:"7440-62-2",group:5,period:4,name:"Vanadium",atomicNumber:23,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.63,naturalMass:50.94146749750001},{symbol:"Cr",casId:"7440-47-3",group:6,period:4,name:"Chromium",atomicNumber:24,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.27,radiiVdw:2.05,paulingE:1.66,naturalMass:51.996133070619},{symbol:"Mn",casId:"7439-96-5",group:7,period:4,name:"Manganese",atomicNumber:25,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.39,radiiVdw:2.05,paulingE:1.55,naturalMass:54.9380451},{symbol:"Fe",casId:"7439-89-6",group:8,period:4,name:"Iron",atomicNumber:26,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.83,naturalMass:55.845145623527},{symbol:"Co",casId:"7440-48-4",group:9,period:4,name:"Cobalt",atomicNumber:27,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2,paulingE:1.88,naturalMass:58.933195},{symbol:"Ni",casId:"7440-02-0",group:10,period:4,name:"Nickel",atomicNumber:28,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.21,radiiVdw:2,paulingE:1.91,naturalMass:58.693351562447994},{symbol:"Cu",casId:"7440-50-8",group:11,period:4,name:"Copper",atomicNumber:29,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2,paulingE:1.9,naturalMass:63.5456400936},{symbol:"Zn",casId:"7440-66-6",group:12,period:4,name:"Zinc",atomicNumber:30,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.1,paulingE:1.65,naturalMass:65.39556265691999},{symbol:"Ga",casId:"7440-55-3",group:13,period:4,name:"Gallium",atomicNumber:31,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.1,paulingE:1.81,naturalMass:69.723065622084},{symbol:"Ge",casId:"7440-56-4",group:14,period:4,name:"Germanium",atomicNumber:32,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.22,radiiVdw:2.1,paulingE:2.01,naturalMass:72.61275825015},{symbol:"As",casId:"7440-38-2",group:15,period:4,name:"Arsenic",atomicNumber:33,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.19,radiiVdw:2.05,paulingE:2.18,naturalMass:74.9215965},{symbol:"Se",casId:"7782-49-2",group:16,period:4,name:"Selenium",atomicNumber:34,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.16,radiiVdw:1.9,paulingE:2.55,naturalMass:78.9593882401},{symbol:"Br",casId:"7726-95-6",group:17,period:4,name:"Bromine",atomicNumber:35,chemicalSerie:"Halogens",phase:"Liquid",radiiCova:1.14,radiiVdw:1.9,paulingE:2.96,naturalMass:79.90352797085},{symbol:"Kr",casId:"7439-90-9",group:18,period:4,name:"Krypton",atomicNumber:36,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.1,radiiVdw:2.02,paulingE:3,naturalMass:83.79932499157},{symbol:"Rb",casId:"7440-17-7",group:1,period:5,name:"Rubidium",atomicNumber:37,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.11,radiiVdw:2.9,paulingE:.82,naturalMass:85.46766359685701},{symbol:"Sr",casId:"7440-24-6",group:2,period:5,name:"Strontium",atomicNumber:38,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.92,radiiVdw:2.55,paulingE:.95,naturalMass:87.61664410489999},{symbol:"Y",casId:"7440-65-5",group:3,period:5,name:"Yttrium",atomicNumber:39,chemicalSerie:"Transition metals",phase:"Solid",naturalMass:88.9058483},{symbol:"Zr",casId:"7440-67-7",group:4,period:5,name:"Zirconium",atomicNumber:40,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:91.22364760672002},{symbol:"Nb",casId:"7440-03-1",group:5,period:5,name:"Niobium",atomicNumber:41,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2.15,naturalMass:92.9063781},{symbol:"Mo",casId:"7439-98-7",group:6,period:5,name:"Molybdenum",atomicNumber:42,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.45,radiiVdw:2.1,naturalMass:95.93129211008},{symbol:"Tc",casId:"7440-26-8",group:7,period:5,name:"Technetium",atomicNumber:43,chemicalSerie:"Transition metals",phase:"Synthetic",radiiCova:1.56,radiiVdw:2.05},{symbol:"Ru",casId:"7440-18-8",group:8,period:5,name:"Ruthenium",atomicNumber:44,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2.05,naturalMass:101.06494544279},{symbol:"Rh",casId:"7440-16-6",group:9,period:5,name:"Rhodium",atomicNumber:45,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.35,radiiVdw:2,naturalMass:102.905504},{symbol:"Pd",casId:"7440-05-3",group:10,period:5,name:"Palladium",atomicNumber:46,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.05,naturalMass:106.41532878129999},{symbol:"Ag",casId:"7440-22-4",group:11,period:5,name:"Silver",atomicNumber:47,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.53,radiiVdw:2.1,naturalMass:107.86815084455},{symbol:"Cd",casId:"7440-43-9",group:12,period:5,name:"Cadmium",atomicNumber:48,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.2,naturalMass:112.41155220052002},{symbol:"In",casId:"7440-74-6",group:13,period:5,name:"Indium",atomicNumber:49,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.25,naturalMass:114.818085722},{symbol:"Sn",casId:"7440-31-5",group:14,period:5,name:"Tin",atomicNumber:50,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.41,radiiVdw:2.25,naturalMass:118.71010831537001},{symbol:"Sb",casId:"7440-36-0",group:15,period:5,name:"Antimony",atomicNumber:51,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:121.75978613257},{symbol:"Te",casId:"13494-80-9",group:16,period:5,name:"Tellurium",atomicNumber:52,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.35,radiiVdw:2.1,naturalMass:127.60312784714},{symbol:"I",casId:"7553-56-2",group:17,period:5,name:"Iodine",atomicNumber:53,chemicalSerie:"Halogens",phase:"Solid",radiiCova:1.33,radiiVdw:2.1,naturalMass:126.904473},{symbol:"Xe",casId:"7440-63-3",group:18,period:5,name:"Xenon",atomicNumber:54,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.3,radiiVdw:2.16,naturalMass:131.29248059059},{symbol:"Cs",casId:"7440-46-2",group:1,period:6,name:"Cesium",atomicNumber:55,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.25,radiiVdw:3,naturalMass:132.9054519},{symbol:"Ba",casId:"7440-39-3",group:2,period:6,name:"Barium",atomicNumber:56,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.98,radiiVdw:2.7,naturalMass:137.32689183471098},{symbol:"La",casId:"7439-91-0",group:3,period:6,name:"Lanthanum",atomicNumber:57,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.69,radiiVdw:2.5,naturalMass:138.90545398283},{symbol:"Ce",casId:"7440-45-1",period:6,name:"Cerium",atomicNumber:58,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.48,naturalMass:140.11572621392},{symbol:"Pr",casId:"7440-10-0",period:6,name:"Praseodymium",atomicNumber:59,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:140.9076528},{symbol:"Nd",casId:"7440-00-8",period:6,name:"Neodymium",atomicNumber:60,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:144.23613137220002},{symbol:"Pm",casId:"7440-12-2",period:6,name:"Promethium",atomicNumber:61,chemicalSerie:"Lanthanides",phase:"Synthetic",radiiVdw:2.43},{symbol:"Sm",casId:"7440-19-9",period:6,name:"Samarium",atomicNumber:62,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.43,naturalMass:150.36634852618},{symbol:"Eu",casId:"7440-53-1",period:6,name:"Europium",atomicNumber:63,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:2.4,naturalMass:151.96437047419},{symbol:"Gd",casId:"7440-54-2",period:6,name:"Gadolinium",atomicNumber:64,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.38,naturalMass:157.25212221544},{symbol:"Tb",casId:"7440-27-9",period:6,name:"Terbium",atomicNumber:65,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.37,naturalMass:158.9253468},{symbol:"Dy",casId:"7429-91-6",period:6,name:"Dysprosium",atomicNumber:66,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.35,naturalMass:162.49703350552},{symbol:"Ho",casId:"7440-60-0",period:6,name:"Holmium",atomicNumber:67,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.33,naturalMass:164.9303221},{symbol:"Er",casId:"7440-52-0",period:6,name:"Erbium",atomicNumber:68,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.32,naturalMass:167.25630413192},{symbol:"Tm",casId:"7440-30-4",period:6,name:"Thulium",atomicNumber:69,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.3,naturalMass:168.9342133},{symbol:"Yb",casId:"7440-64-4",period:6,name:"Ytterbium",atomicNumber:70,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.28,naturalMass:173.03769558789998},{symbol:"Lu",casId:"7439-94-3",period:6,name:"Lutetium",atomicNumber:71,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.6,radiiVdw:2.27,naturalMass:174.96672138555},{symbol:"Hf",casId:"7440-58-6",group:4,period:6,name:"Hafnium",atomicNumber:72,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.5,radiiVdw:2.25,naturalMass:178.48497214162},{symbol:"Ta",casId:"7440-25-7",group:5,period:6,name:"Tantalum",atomicNumber:73,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:180.94787573628},{symbol:"W",casId:"7440-33-7",group:6,period:6,name:"Tungsten",atomicNumber:74,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.46,radiiVdw:2.1,naturalMass:183.84177810241},{symbol:"Re",casId:"7440-15-5",group:7,period:6,name:"Rhenium",atomicNumber:75,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.59,radiiVdw:2.05,naturalMass:186.2067066106},{symbol:"Os",casId:"7440-04-2",group:8,period:6,name:"Osmium",atomicNumber:76,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2,naturalMass:190.22486304558998},{symbol:"Ir",casId:"7439-88-5",group:9,period:6,name:"Iridium",atomicNumber:77,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2,naturalMass:192.2160564148},{symbol:"Pt",casId:"7440-06-4",group:10,period:6,name:"Platinum",atomicNumber:78,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2.05,naturalMass:195.07780788031297},{symbol:"Au",casId:"7440-57-5",group:11,period:6,name:"Gold",atomicNumber:79,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.1,naturalMass:196.9665687},{symbol:"Hg",casId:"7439-97-6",group:12,period:6,name:"Mercury",atomicNumber:80,chemicalSerie:"Transition metals",phase:"Liquid",radiiCova:1.49,radiiVdw:2.05,naturalMass:200.59916661780002},{symbol:"Tl",casId:"7440-28-0",group:13,period:6,name:"Thallium",atomicNumber:81,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.49,radiiVdw:2.2,naturalMass:204.38333242650796},{symbol:"Pb",casId:"7439-92-1",group:14,period:6,name:"Lead",atomicNumber:82,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:207.21690766300003},{symbol:"Bi",casId:"7440-69-9",group:15,period:6,name:"Bismuth",atomicNumber:83,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.47,radiiVdw:2.3,naturalMass:208.9803987},{symbol:"Po",casId:"7440-08-6",group:16,period:6,name:"Polonium",atomicNumber:84,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.46,radiiVdw:2},{symbol:"At",casId:"7440-08-6",group:17,period:6,name:"Astatine",atomicNumber:85,chemicalSerie:"Halogens",phase:"Solid",radiiVdw:2},{symbol:"Rn",casId:"10043-92-2",group:18,period:6,name:"Radon",atomicNumber:86,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.45,radiiVdw:2},{symbol:"Fr",casId:"7440-73-5",group:1,period:7,name:"Francium",atomicNumber:87,chemicalSerie:"Alkali Metals",phase:"Solid",radiiVdw:2},{symbol:"Ra",casId:"7440-14-4",group:2,period:7,name:"Radium",atomicNumber:88,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiVdw:2},{symbol:"Ac",casId:"7440-34-8",group:3,period:7,name:"Actinium",atomicNumber:89,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Th",casId:"7440-29-1",period:7,name:"Thorium",atomicNumber:90,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:232.0380553},{symbol:"Pa",casId:"7440-13-3",period:7,name:"Protactinium",atomicNumber:91,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2,naturalMass:231.035884},{symbol:"U",casId:"7440-61-1",period:7,name:"Uranium",atomicNumber:92,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:238.0289182792545},{symbol:"Np",casId:"7439-99-8",period:7,name:"Neptunium",atomicNumber:93,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Pu",casId:"7440-07-5",period:7,name:"Plutonium",atomicNumber:94,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Am",casId:"7440-35-9",period:7,name:"Americium",atomicNumber:95,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cm",casId:"7440-51-9",period:7,name:"Curium",atomicNumber:96,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Bk",casId:"7440-40-6",period:7,name:"Berkelium",atomicNumber:97,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cf",casId:"7440-71-3",period:7,name:"Californium",atomicNumber:98,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Es",casId:"7429-92-7",period:7,name:"Einsteinium",atomicNumber:99,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Fm",casId:"7440-72-4",period:7,name:"Fermium",atomicNumber:100,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Md",casId:"7440-11-1",period:7,name:"Mendelevium",atomicNumber:101,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"No",casId:"10028-14-5",period:7,name:"Nobelium",atomicNumber:102,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Lr",casId:"22537-19-5",period:7,name:"Lawrencium",atomicNumber:103,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Rf",casId:"53850-36-5",group:4,period:7,name:"Rutherfordium",atomicNumber:104,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Db",casId:"53850-35-4",group:5,period:7,name:"Dubnium",atomicNumber:105,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Sg",casId:"54038-81-2",group:6,period:7,name:"Seaborgium",atomicNumber:106,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Bh",casId:"54037-14-8",group:7,period:7,name:"Bohrium",atomicNumber:107,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Hs",casId:"54037-57-9",group:8,period:7,name:"Hassium",atomicNumber:108,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Mt",casId:"54038-01-6",group:9,period:7,name:"Meitnerium",atomicNumber:109,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Ds",casId:"54083-77-1",group:10,period:7,name:"Darmstadtium",atomicNumber:110,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Rg",casId:"54386-24-2",group:11,period:7,name:"Roentgenium",atomicNumber:111,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Uub",group:12,period:7,name:"Ununbium",atomicNumber:112,chemicalSerie:"Transition metals",phase:"Synthetic"}],Kekule.isotopesData=[{elementSymbol:"H",atomicNumber:1,isotopes:[{id:"H1",massNumber:1,relativeAbundance:.999885,atomicNumber:1,exactMass:1.007825032,spin:"1/2+",magneticMoment:"+2.792846",halfLife:-1},{id:"H2",massNumber:2,relativeAbundance:115e-6,atomicNumber:1,exactMass:2.014101778,spin:"1+",magneticMoment:"+0.857438",halfLife:-1},{id:"H3",massNumber:3,exactMass:3.016049278,atomicNumber:1,spin:"1/2+",magneticMoment:"+2.978960",halfLife:388839e3,betaminusDecay:"0.01861",betaminusDecayLikeliness:"100.0"},{id:"H4",massNumber:4,exactMass:4.02781,atomicNumber:1},{id:"H5",massNumber:5,exactMass:5.03531,atomicNumber:1},{id:"H6",massNumber:6,exactMass:6.04494,atomicNumber:1},{id:"H7",massNumber:7,exactMass:7.05275,atomicNumber:1}]},{elementSymbol:"He",atomicNumber:2,isotopes:[{id:"He3",massNumber:3,relativeAbundance:137e-8,atomicNumber:2,exactMass:3.016029319,spin:"1/2+",magneticMoment:"-2.127624",halfLife:-1},{id:"He4",massNumber:4,relativeAbundance:.99999863,atomicNumber:2,exactMass:4.002603254,spin:"0+",halfLife:-1},{id:"He5",massNumber:5,exactMass:5.01222,atomicNumber:2},{id:"He6",massNumber:6,exactMass:6.0188891,atomicNumber:2,halfLife:.8067},{id:"He7",massNumber:7,exactMass:7.028021,atomicNumber:2},{id:"He8",massNumber:8,exactMass:8.033922,atomicNumber:2,halfLife:.119},{id:"He9",massNumber:9,exactMass:9.04395,atomicNumber:2},{id:"He10",massNumber:10,exactMass:10.0524,atomicNumber:2}]},null,null,{elementSymbol:"B",atomicNumber:5,isotopes:[{id:"B6",massNumber:6,exactMass:6.04681,atomicNumber:5},{id:"B7",massNumber:7,exactMass:7.02992,atomicNumber:5},{id:"B8",massNumber:8,exactMass:8.0246072,atomicNumber:5,halfLife:.77},{id:"B9",massNumber:9,exactMass:9.0133288,atomicNumber:5},{id:"B10",massNumber:10,relativeAbundance:.19899999999999998,atomicNumber:5,exactMass:10.012937,spin:"3+",magneticMoment:"+1.80065",halfLife:-1},{id:"B11",massNumber:11,relativeAbundance:.8009999999999999,atomicNumber:5,exactMass:11.0093054,spin:"3/2-",magneticMoment:"+2.688637",halfLife:-1},{id:"B12",massNumber:12,exactMass:12.0143521,atomicNumber:5,halfLife:.0202},{id:"B13",massNumber:13,exactMass:13.0177802,atomicNumber:5,halfLife:.01736},{id:"B14",massNumber:14,exactMass:14.025404,atomicNumber:5,halfLife:.0138},{id:"B15",massNumber:15,exactMass:15.031103,atomicNumber:5,halfLife:.0105},{id:"B16",massNumber:16,exactMass:16.03981,atomicNumber:5},{id:"B17",massNumber:17,exactMass:17.04699,atomicNumber:5,halfLife:.00508},{id:"B18",massNumber:18,exactMass:18.05617,atomicNumber:5},{id:"B19",massNumber:19,exactMass:19.06373,atomicNumber:5}]},{elementSymbol:"C",atomicNumber:6,isotopes:[{id:"C8",massNumber:8,exactMass:8.037675,atomicNumber:6},{id:"C9",massNumber:9,exactMass:9.0310367,atomicNumber:6,halfLife:.126},{id:"C10",massNumber:10,exactMass:10.0168532,atomicNumber:6,halfLife:19.255},{id:"C11",massNumber:11,exactMass:11.0114336,atomicNumber:6,spin:"3/2-",halfLife:1223.4,betaplusDecay:"0.96",betaplusDecayLikeliness:"100.0"},{id:"C12",massNumber:12,relativeAbundance:.9893000000000001,atomicNumber:6,exactMass:12,spin:"0+",halfLife:-1},{id:"C13",massNumber:13,relativeAbundance:.010700000000000001,atomicNumber:6,exactMass:13.00335484,spin:"1/2-",magneticMoment:"+0.702411",halfLife:-1},{id:"C14",massNumber:14,exactMass:14.00324199,atomicNumber:6,halfLife:180701e6,betaminusDecay:"0.15648",betaminusDecayLikeliness:"100.0"},{id:"C15",massNumber:15,exactMass:15.0105993,atomicNumber:6,halfLife:2.449},{id:"C16",massNumber:16,exactMass:16.014701,atomicNumber:6,halfLife:.747},{id:"C17",massNumber:17,exactMass:17.022586,atomicNumber:6,halfLife:.193},{id:"C18",massNumber:18,exactMass:18.02676,atomicNumber:6,halfLife:.095},{id:"C19",massNumber:19,exactMass:19.03481,atomicNumber:6,halfLife:.046},{id:"C20",massNumber:20,exactMass:20.04032,atomicNumber:6,halfLife:.014},{id:"C21",massNumber:21,exactMass:21.04934,atomicNumber:6},{id:"C22",massNumber:22,exactMass:22.0572,atomicNumber:6}]},{elementSymbol:"N",atomicNumber:7,isotopes:[{id:"N10",massNumber:10,exactMass:10.04165,atomicNumber:7},{id:"N11",massNumber:11,exactMass:11.02609,atomicNumber:7},{id:"N12",massNumber:12,exactMass:12.0186132,atomicNumber:7,halfLife:.011},{id:"N13",massNumber:13,exactMass:13.00573861,atomicNumber:7,halfLife:597.9},{id:"N14",massNumber:14,relativeAbundance:.9963200000000001,atomicNumber:7,exactMass:14.003074,spin:"1+",magneticMoment:"+0.403761",halfLife:-1},{id:"N15",massNumber:15,relativeAbundance:.00368,atomicNumber:7,exactMass:15.0001089,spin:"1/2-",magneticMoment:"-0.283189",halfLife:-1},{id:"N16",massNumber:16,exactMass:16.0061017,atomicNumber:7,halfLife:7.13},{id:"N17",massNumber:17,exactMass:17.00845,atomicNumber:7,halfLife:4.173},{id:"N18",massNumber:18,exactMass:18.014079,atomicNumber:7,halfLife:.624},{id:"N19",massNumber:19,exactMass:19.017029,atomicNumber:7,halfLife:.304},{id:"N20",massNumber:20,exactMass:20.02337,atomicNumber:7,halfLife:.1},{id:"N21",massNumber:21,exactMass:21.02711,atomicNumber:7,halfLife:.085},{id:"N22",massNumber:22,exactMass:22.03439,atomicNumber:7,halfLife:.024},{id:"N23",massNumber:23,exactMass:23.04122,atomicNumber:7},{id:"N24",massNumber:24,exactMass:24.05104,atomicNumber:7},{id:"N25",massNumber:25,exactMass:25.06066,atomicNumber:7}]},{elementSymbol:"O",atomicNumber:8,isotopes:[{id:"O12",massNumber:12,exactMass:12.034405,atomicNumber:8},{id:"O13",massNumber:13,exactMass:13.024812,atomicNumber:8,halfLife:.00858},{id:"O14",massNumber:14,exactMass:14.00859625,atomicNumber:8,halfLife:70.606},{id:"O15",massNumber:15,exactMass:15.0030656,atomicNumber:8,halfLife:122.24},{id:"O16",massNumber:16,relativeAbundance:.9975700000000001,atomicNumber:8,exactMass:15.99491462,spin:"0+",halfLife:-1},{id:"O17",massNumber:17,relativeAbundance:.00037999999999999997,atomicNumber:8,exactMass:16.9991317,spin:"5/2+",magneticMoment:"-1.89379",halfLife:-1},{id:"O18",massNumber:18,relativeAbundance:.0020499999999999997,atomicNumber:8,exactMass:17.999161,spin:"0+",halfLife:-1},{id:"O19",massNumber:19,exactMass:19.00358,atomicNumber:8,halfLife:26.91},{id:"O20",massNumber:20,exactMass:20.0040767,atomicNumber:8,halfLife:13.51},{id:"O21",massNumber:21,exactMass:21.008656,atomicNumber:8,halfLife:3.42},{id:"O22",massNumber:22,exactMass:22.00997,atomicNumber:8,halfLife:2.25},{id:"O23",massNumber:23,exactMass:23.01569,atomicNumber:8,halfLife:.082},{id:"O24",massNumber:24,exactMass:24.02047,atomicNumber:8,halfLife:.061},{id:"O25",massNumber:25,exactMass:25.02946,atomicNumber:8},{id:"O26",massNumber:26,exactMass:26.03834,atomicNumber:8},{id:"O27",massNumber:27,exactMass:27.04826,atomicNumber:8},{id:"O28",massNumber:28,exactMass:28.05781,atomicNumber:8}]},{elementSymbol:"F",atomicNumber:9,isotopes:[{id:"F14",massNumber:14,exactMass:14.03506,atomicNumber:9},{id:"F15",massNumber:15,exactMass:15.01801,atomicNumber:9,halfLife:-1},{id:"F16",massNumber:16,exactMass:16.011466,atomicNumber:9},{id:"F17",massNumber:17,exactMass:17.00209524,atomicNumber:9,halfLife:64.49},{id:"F18",massNumber:18,exactMass:18.000938,atomicNumber:9,spin:"1+",halfLife:6586.2,betaplusDecay:"0.64",betaplusDecayLikeliness:"97.0",ecDecay:"",ecDecayLikeliness:"3.0"},{id:"F19",massNumber:19,relativeAbundance:1,atomicNumber:9,exactMass:18.99840322,spin:"1/2+",magneticMoment:"+2.628866",halfLife:-1},{id:"F20",massNumber:20,exactMass:19.99998132,atomicNumber:9,halfLife:11},{id:"F21",massNumber:21,exactMass:20.999949,atomicNumber:9,halfLife:4.158},{id:"F22",massNumber:22,exactMass:22.002999,atomicNumber:9,halfLife:4.23},{id:"F23",massNumber:23,exactMass:23.00357,atomicNumber:9,halfLife:2.23},{id:"F24",massNumber:24,exactMass:24.00812,atomicNumber:9,halfLife:.34},{id:"F25",massNumber:25,exactMass:25.0121,atomicNumber:9,halfLife:.059},{id:"F26",massNumber:26,exactMass:26.01962,atomicNumber:9},{id:"F27",massNumber:27,exactMass:27.02676,atomicNumber:9},{id:"F28",massNumber:28,exactMass:28.03567,atomicNumber:9},{id:"F29",massNumber:29,exactMass:29.04326,atomicNumber:9},{id:"F30",massNumber:30,exactMass:30.0525,atomicNumber:9},{id:"F31",massNumber:31,exactMass:31.06043,atomicNumber:9}]},null,null,null,null,{elementSymbol:"Si",atomicNumber:14,isotopes:[{id:"Si22",massNumber:22,exactMass:22.03453,atomicNumber:14,halfLife:.006},{id:"Si23",massNumber:23,exactMass:23.02552,atomicNumber:14},{id:"Si24",massNumber:24,exactMass:24.011546,atomicNumber:14,halfLife:.102},{id:"Si25",massNumber:25,exactMass:25.004106,atomicNumber:14,halfLife:.22},{id:"Si26",massNumber:26,exactMass:25.99233,atomicNumber:14,halfLife:2.234},{id:"Si27",massNumber:27,exactMass:26.98670491,atomicNumber:14,halfLife:4.16},{id:"Si28",massNumber:28,relativeAbundance:.9222969999999999,atomicNumber:14,exactMass:27.97692653,spin:"0+",halfLife:-1},{id:"Si29",massNumber:29,relativeAbundance:.046832000000000006,atomicNumber:14,exactMass:28.9764947,spin:"1/2+",magneticMoment:"-0.55529",halfLife:-1},{id:"Si30",massNumber:30,relativeAbundance:.030872,atomicNumber:14,exactMass:29.97377017,spin:"0+",halfLife:-1},{id:"Si31",massNumber:31,exactMass:30.97536323,atomicNumber:14,halfLife:9438},{id:"Si32",massNumber:32,exactMass:31.97414808,atomicNumber:14,halfLife:47304e5},{id:"Si33",massNumber:33,exactMass:32.978,atomicNumber:14,halfLife:6.18},{id:"Si34",massNumber:34,exactMass:33.978576,atomicNumber:14,halfLife:2.77},{id:"Si35",massNumber:35,exactMass:34.98458,atomicNumber:14,halfLife:.78},{id:"Si36",massNumber:36,exactMass:35.9866,atomicNumber:14,halfLife:.45},{id:"Si37",massNumber:37,exactMass:36.99294,atomicNumber:14},{id:"Si38",massNumber:38,exactMass:37.99563,atomicNumber:14},{id:"Si39",massNumber:39,exactMass:39.00207,atomicNumber:14},{id:"Si40",massNumber:40,exactMass:40.00587,atomicNumber:14},{id:"Si41",massNumber:41,exactMass:41.01456,atomicNumber:14},{id:"Si42",massNumber:42,exactMass:42.01979,atomicNumber:14},{id:"Si43",massNumber:43,exactMass:43.02866,atomicNumber:14},{id:"Si44",massNumber:44,exactMass:44.03526,atomicNumber:14}]},{elementSymbol:"P",atomicNumber:15,isotopes:[{id:"P24",massNumber:24,exactMass:24.03435,atomicNumber:15},{id:"P25",massNumber:25,exactMass:25.02026,atomicNumber:15},{id:"P26",massNumber:26,exactMass:26.01178,atomicNumber:15,halfLife:.02},{id:"P27",massNumber:27,exactMass:26.99923,atomicNumber:15,halfLife:.26},{id:"P28",massNumber:28,exactMass:27.992315,atomicNumber:15,halfLife:.2703},{id:"P29",massNumber:29,exactMass:28.9818006,atomicNumber:15,halfLife:4.14},{id:"P30",massNumber:30,exactMass:29.9783138,atomicNumber:15,halfLife:149.88},{id:"P31",massNumber:31,relativeAbundance:1,atomicNumber:15,exactMass:30.97376163,spin:"1/2+",magneticMoment:"+1.13160",halfLife:-1},{id:"P32",massNumber:32,exactMass:31.97390727,atomicNumber:15,spin:"1+",magneticMoment:"-0.2524",halfLife:1232240,betaminusDecay:"1.710",betaminusDecayLikeliness:"100.0"},{id:"P33",massNumber:33,exactMass:32.9717255,atomicNumber:15,halfLife:2189380},{id:"P34",massNumber:34,exactMass:33.973636,atomicNumber:15,halfLife:12.43},{id:"P35",massNumber:35,exactMass:34.9733141,atomicNumber:15,halfLife:47.3},{id:"P36",massNumber:36,exactMass:35.97826,atomicNumber:15,halfLife:5.6},{id:"P37",massNumber:37,exactMass:36.97961,atomicNumber:15,halfLife:2.31},{id:"P38",massNumber:38,exactMass:37.98416,atomicNumber:15,halfLife:.64},{id:"P39",massNumber:39,exactMass:38.98618,atomicNumber:15,halfLife:.16},{id:"P40",massNumber:40,exactMass:39.9913,atomicNumber:15,halfLife:.26},{id:"P41",massNumber:41,exactMass:40.99434,atomicNumber:15,halfLife:.12},{id:"P42",massNumber:42,exactMass:42.00101,atomicNumber:15,halfLife:.11},{id:"P43",massNumber:43,exactMass:43.00619,atomicNumber:15,halfLife:.033},{id:"P44",massNumber:44,exactMass:44.01299,atomicNumber:15},{id:"P45",massNumber:45,exactMass:45.01922,atomicNumber:15},{id:"P46",massNumber:46,exactMass:46.02738,atomicNumber:15}]},{elementSymbol:"S",atomicNumber:16,isotopes:[{id:"S26",massNumber:26,exactMass:26.02788,atomicNumber:16},{id:"S27",massNumber:27,exactMass:27.01883,atomicNumber:16,halfLife:.021},{id:"S28",massNumber:28,exactMass:28.00437,atomicNumber:16,halfLife:.125},{id:"S29",massNumber:29,exactMass:28.99661,atomicNumber:16,halfLife:.187},{id:"S30",massNumber:30,exactMass:29.984903,atomicNumber:16,halfLife:1.178},{id:"S31",massNumber:31,exactMass:30.9795547,atomicNumber:16,halfLife:2.572},{id:"S32",massNumber:32,relativeAbundance:.9493,atomicNumber:16,exactMass:31.972071,spin:"0+",halfLife:-1},{id:"S33",massNumber:33,relativeAbundance:.0076,atomicNumber:16,exactMass:32.97145876,spin:"3/2+",magneticMoment:"+0.643821",halfLife:-1},{id:"S34",massNumber:34,relativeAbundance:.0429,atomicNumber:16,exactMass:33.9678669,spin:"0+",halfLife:-1},{id:"S35",massNumber:35,exactMass:34.96903216,atomicNumber:16,spin:"3/2+",magneticMoment:"+1",halfLife:7544450,betaminusDecay:"0.1674",betaminusDecayLikeliness:"100.0"},{id:"S36",massNumber:36,relativeAbundance:2e-4,atomicNumber:16,exactMass:35.96708076,spin:"0+",halfLife:-1},{id:"S37",massNumber:37,exactMass:36.97112557,atomicNumber:16,halfLife:303},{id:"S38",massNumber:38,exactMass:37.971163,atomicNumber:16,halfLife:10218},{id:"S39",massNumber:39,exactMass:38.97513,atomicNumber:16,halfLife:11.5},{id:"S40",massNumber:40,exactMass:39.97545,atomicNumber:16,halfLife:8.8},{id:"S41",massNumber:41,exactMass:40.97958,atomicNumber:16},{id:"S42",massNumber:42,exactMass:41.98102,atomicNumber:16,halfLife:.56},{id:"S43",massNumber:43,exactMass:42.98715,atomicNumber:16,halfLife:.22},{id:"S44",massNumber:44,exactMass:43.99021,atomicNumber:16,halfLife:.123},{id:"S45",massNumber:45,exactMass:44.99651,atomicNumber:16,halfLife:.082},{id:"S46",massNumber:46,exactMass:46.00075,atomicNumber:16},{id:"S47",massNumber:47,exactMass:47.00859,atomicNumber:16},{id:"S48",massNumber:48,exactMass:48.01417,atomicNumber:16},{id:"S49",massNumber:49,exactMass:49.02362,atomicNumber:16}]},{elementSymbol:"Cl",atomicNumber:17,isotopes:[{id:"Cl28",massNumber:28,exactMass:28.02851,atomicNumber:17},{id:"Cl29",massNumber:29,exactMass:29.01411,atomicNumber:17},{id:"Cl30",massNumber:30,exactMass:30.00477,atomicNumber:17},{id:"Cl31",massNumber:31,exactMass:30.99241,atomicNumber:17,halfLife:.15},{id:"Cl32",massNumber:32,exactMass:31.98569,atomicNumber:17,halfLife:.298},{id:"Cl33",massNumber:33,exactMass:32.9774519,atomicNumber:17,halfLife:2.511},{id:"Cl34",massNumber:34,exactMass:33.97376282,atomicNumber:17,halfLife:1.5264},{id:"Cl35",massNumber:35,relativeAbundance:.7578,atomicNumber:17,exactMass:34.96885268,spin:"3/2+",magneticMoment:"+0.82187",halfLife:-1},{id:"Cl36",massNumber:36,exactMass:35.96830698,atomicNumber:17},{id:"Cl37",massNumber:37,relativeAbundance:.2422,atomicNumber:17,exactMass:36.96590259,spin:"3/2+",magneticMoment:"+0.68412",halfLife:-1},{id:"Cl38",massNumber:38,exactMass:37.96801043,atomicNumber:17,halfLife:2234.4},{id:"Cl39",massNumber:39,exactMass:38.9680082,atomicNumber:17,halfLife:3336},{id:"Cl40",massNumber:40,exactMass:39.97042,atomicNumber:17,halfLife:81},{id:"Cl41",massNumber:41,exactMass:40.97068,atomicNumber:17,halfLife:38.4},{id:"Cl42",massNumber:42,exactMass:41.97325,atomicNumber:17,halfLife:6.8},{id:"Cl43",massNumber:43,exactMass:42.97405,atomicNumber:17,halfLife:3.3},{id:"Cl44",massNumber:44,exactMass:43.97828,atomicNumber:17,halfLife:.434},{id:"Cl45",massNumber:45,exactMass:44.98029,atomicNumber:17,halfLife:.4},{id:"Cl46",massNumber:46,exactMass:45.98421,atomicNumber:17,halfLife:.223},{id:"Cl47",massNumber:47,exactMass:46.98871,atomicNumber:17},{id:"Cl48",massNumber:48,exactMass:47.99495,atomicNumber:17},{id:"Cl49",massNumber:49,exactMass:49.00032,atomicNumber:17},{id:"Cl50",massNumber:50,exactMass:50.00784,atomicNumber:17},{id:"Cl51",massNumber:51,exactMass:51.01449,atomicNumber:17}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"Br",atomicNumber:35,isotopes:[{id:"Br67",massNumber:67,exactMass:66.96479,atomicNumber:35},{id:"Br68",massNumber:68,exactMass:67.95852,atomicNumber:35},{id:"Br69",massNumber:69,exactMass:68.95011,atomicNumber:35},{id:"Br70",massNumber:70,exactMass:69.94479,atomicNumber:35,halfLife:.0791},{id:"Br71",massNumber:71,exactMass:70.93874,atomicNumber:35,halfLife:21.4},{id:"Br72",massNumber:72,exactMass:71.93664,atomicNumber:35,halfLife:78.6},{id:"Br73",massNumber:73,exactMass:72.93169,atomicNumber:35,halfLife:204},{id:"Br74",massNumber:74,exactMass:73.929891,atomicNumber:35,halfLife:1524},{id:"Br75",massNumber:75,exactMass:74.925776,atomicNumber:35,halfLife:5802},{id:"Br76",massNumber:76,exactMass:75.924541,atomicNumber:35,halfLife:58320},{id:"Br77",massNumber:77,exactMass:76.921379,atomicNumber:35,halfLife:205330},{id:"Br78",massNumber:78,exactMass:77.921146,atomicNumber:35,halfLife:387.6},{id:"Br79",massNumber:79,relativeAbundance:.5069,atomicNumber:35,exactMass:78.9183371,spin:"3/2-",magneticMoment:"+2.1064",halfLife:-1},{id:"Br80",massNumber:80,exactMass:79.9185293,atomicNumber:35,halfLife:1060.8},{id:"Br81",massNumber:81,relativeAbundance:.49310000000000004,atomicNumber:35,exactMass:80.9162906,spin:"3/2-",magneticMoment:"+2.2706",halfLife:-1},{id:"Br82",massNumber:82,exactMass:81.9168041,atomicNumber:35,halfLife:127080},{id:"Br83",massNumber:83,exactMass:82.91518,atomicNumber:35,halfLife:8640},{id:"Br84",massNumber:84,exactMass:83.916479,atomicNumber:35,halfLife:1908},{id:"Br85",massNumber:85,exactMass:84.915608,atomicNumber:35,halfLife:174},{id:"Br86",massNumber:86,exactMass:85.918798,atomicNumber:35,halfLife:55.1},{id:"Br87",massNumber:87,exactMass:86.920711,atomicNumber:35,halfLife:55.6},{id:"Br88",massNumber:88,exactMass:87.92407,atomicNumber:35,halfLife:16.34},{id:"Br89",massNumber:89,exactMass:88.92639,atomicNumber:35,halfLife:4.348},{id:"Br90",massNumber:90,exactMass:89.93063,atomicNumber:35,halfLife:1.91},{id:"Br91",massNumber:91,exactMass:90.93397,atomicNumber:35,halfLife:.541},{id:"Br92",massNumber:92,exactMass:91.93926,atomicNumber:35,halfLife:.343},{id:"Br93",massNumber:93,exactMass:92.94305,atomicNumber:35,halfLife:.102},{id:"Br94",massNumber:94,exactMass:93.94868,atomicNumber:35,halfLife:.07},{id:"Br95",massNumber:95,exactMass:94.95287,atomicNumber:35},{id:"Br96",massNumber:96,exactMass:95.95853,atomicNumber:35},{id:"Br97",massNumber:97,exactMass:96.9628,atomicNumber:35}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,isotopes:[{id:"I108",massNumber:108,exactMass:107.94348,atomicNumber:53,halfLife:.036},{id:"I109",massNumber:109,exactMass:108.93815,atomicNumber:53,halfLife:1e-4},{id:"I110",massNumber:110,exactMass:109.93524,atomicNumber:53,halfLife:.65},{id:"I111",massNumber:111,exactMass:110.93028,atomicNumber:53,halfLife:2.5},{id:"I112",massNumber:112,exactMass:111.92797,atomicNumber:53,halfLife:3.42},{id:"I113",massNumber:113,exactMass:112.92364,atomicNumber:53,halfLife:6.6},{id:"I114",massNumber:114,exactMass:113.92185,atomicNumber:53,halfLife:2.1},{id:"I115",massNumber:115,exactMass:114.91805,atomicNumber:53,halfLife:78},{id:"I116",massNumber:116,exactMass:115.91681,atomicNumber:53,halfLife:2.91},{id:"I117",massNumber:117,exactMass:116.91365,atomicNumber:53,halfLife:133.2},{id:"I118",massNumber:118,exactMass:117.913074,atomicNumber:53,halfLife:822},{id:"I119",massNumber:119,exactMass:118.91007,atomicNumber:53,halfLife:1146},{id:"I120",massNumber:120,exactMass:119.910048,atomicNumber:53,halfLife:4860},{id:"I121",massNumber:121,exactMass:120.907367,atomicNumber:53,halfLife:7632},{id:"I122",massNumber:122,exactMass:121.907589,atomicNumber:53,halfLife:217.8},{id:"I123",massNumber:123,exactMass:122.905589,atomicNumber:53,halfLife:47772},{id:"I124",massNumber:124,exactMass:123.9062099,atomicNumber:53,halfLife:360806},{id:"I125",massNumber:125,exactMass:124.9046302,atomicNumber:53,spin:"5/2+",halfLife:5132850},{id:"I126",massNumber:126,exactMass:125.905624,atomicNumber:53,spin:"2-",halfLife:1132700},{id:"I127",massNumber:127,relativeAbundance:1,atomicNumber:53,exactMass:126.904473,spin:"5/2+",magneticMoment:"+2.808",halfLife:-1},{id:"I128",massNumber:128,exactMass:127.905809,atomicNumber:53,spin:"1+",halfLife:1499.4},{id:"I129",massNumber:129,exactMass:128.904988,atomicNumber:53,magneticMoment:"+2.617",halfLife:157e5,betaminusDecay:"0.193",betaminusDecayLikeliness:"100.0"},{id:"I130",massNumber:130,exactMass:129.906674,atomicNumber:53,halfLife:44496},{id:"I131",massNumber:131,exactMass:130.9061246,atomicNumber:53,halfLife:692988},{id:"I132",massNumber:132,exactMass:131.907997,atomicNumber:53,halfLife:8262},{id:"I133",massNumber:133,exactMass:132.907797,atomicNumber:53,halfLife:74880},{id:"I134",massNumber:134,exactMass:133.909744,atomicNumber:53,halfLife:3150},{id:"I135",massNumber:135,exactMass:134.910048,atomicNumber:53,halfLife:23652},{id:"I136",massNumber:136,exactMass:135.91465,atomicNumber:53,halfLife:83.4},{id:"I137",massNumber:137,exactMass:136.917871,atomicNumber:53,halfLife:24.5},{id:"I138",massNumber:138,exactMass:137.92235,atomicNumber:53,halfLife:6.49},{id:"I139",massNumber:139,exactMass:138.9261,atomicNumber:53,halfLife:2.29},{id:"I140",massNumber:140,exactMass:139.931,atomicNumber:53,halfLife:.86},{id:"I141",massNumber:141,exactMass:140.93503,atomicNumber:53,halfLife:.43},{id:"I142",massNumber:142,exactMass:141.94018,atomicNumber:53},{id:"I143",massNumber:143,exactMass:142.94456,atomicNumber:53},{id:"I144",massNumber:144,exactMass:143.94999,atomicNumber:53}]}],Kekule.structGenAtomTypesData=[{elementSymbol:"H",atomicNumber:1,atomTypes:[{id:"H1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Li",atomicNumber:3,atomTypes:[{id:"Li1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"B",atomicNumber:5,atomTypes:[{id:"B3",maxBondOrder:2,bondOrderSum:3}]},{elementSymbol:"C",atomicNumber:6,atomTypes:[{id:"C4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"N",atomicNumber:7,atomTypes:[{id:"N3",maxBondOrder:3,bondOrderSum:3},{id:"N5",maxBondOrder:2,bondOrderSum:5}]},{elementSymbol:"O",atomicNumber:8,atomTypes:[{id:"O2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"F",atomicNumber:9,atomTypes:[{id:"F1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Na",atomicNumber:11,atomTypes:[{id:"Na1",maxBondOrder:1,bondOrderSum:1}]},null,null,{elementSymbol:"Si",atomicNumber:14,atomTypes:[{id:"Si4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"P",atomicNumber:15,atomTypes:[{id:"P3",maxBondOrder:3,bondOrderSum:3},{id:"P4",maxBondOrder:3,bondOrderSum:5}]},{elementSymbol:"S",atomicNumber:16,atomTypes:[{id:"S2",maxBondOrder:2,bondOrderSum:2},{id:"S3",maxBondOrder:2,bondOrderSum:4},{id:"S4",maxBondOrder:2,bondOrderSum:6}]},{elementSymbol:"Cl",atomicNumber:17,atomTypes:[{id:"Cl1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"As",atomicNumber:33,atomTypes:[{id:"As3",maxBondOrder:1,bondOrderSum:3}]},{elementSymbol:"Se",atomicNumber:34,atomTypes:[{id:"Se2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"Br",atomicNumber:35,atomTypes:[{id:"Br1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,atomTypes:[{id:"I1",maxBondOrder:1,bondOrderSum:1}]}],Kekule.ChemicalElementsDataUtil={_getElementInfoBySymbol:function(e){for(var t,r=0,i=Kekule.chemicalElementsData.length;r<i;++r)if((t=Kekule.chemicalElementsData[r])&&t.symbol==e)return t;return null},_getElementInfoByAtomicNumber:function(e){var t=Kekule.chemicalElementsData[e-1];if(t&&t.atomicNumber==e)return t;if(!t||t.atomicNumber<e){for(var r=e,i=Kekule.chemicalElementsData.length;r<i;++r)if((t=Kekule.chemicalElementsData[r])&&t.atomicNumber==e)return t;for(r=e-2;r>=0;--r)if((t=Kekule.chemicalElementsData[r])&&t.atomicNumber==e)return t}else{for(r=e-2;r>=0;--r)if((t=Kekule.chemicalElementsData[r])&&t.atomicNumber==e)return t;for(r=e,i=Kekule.chemicalElementsData.length;r<i;++r)if((t=Kekule.chemicalElementsData[r])&&t.atomicNumber==e)return t}return null},getElementInfo:function(e){return"number"==typeof e?Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(e):Kekule.ChemicalElementsDataUtil._getElementInfoBySymbol(e)},getElementProp:function(e,t){var r=Kekule.ChemicalElementsDataUtil.getElementInfo(e);return r?r[t]:null},getAtomicNumber:function(e){var t=Kekule.ChemicalElementsDataUtil._getElementInfoBySymbol(e);return t?t.atomicNumber:0},getElementSymbol:function(e){var t=Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(e);return t?t.symbol:null},isAtomicNumberAvailable:function(e){return!!Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(e)},isElementSymbolAvailable:function(e){return Kekule.ChemicalElementsDataUtil.getAtomicNumber(e)>0},getAllElementSymbols:function(){for(var e=[],t=Kekule.chemicalElementsData,r=0,i=t.length;r<i;++r)e.push(t[r].symbol);return e}},Kekule.IsotopeAliasUtil={enableAlias:!0,ALIAS:[{alias:"D",atomicNumber:1,massNumber:2}],getAllAlias:function(){return Kekule.IsotopeAliasUtil.enableAlias?Kekule.IsotopeAliasUtil.ALIAS:[]},getAliasInfo:function(e){for(var t=Kekule.IsotopeAliasUtil.getAllAlias(),r=0,i=t.length;r<i;++r){var n=t[r];if(n.alias===e)return Object.extend(Kekule.IsotopesDataUtil.getIsotopeInfo(n.atomicNumber,n.massNumber),{isotopeAlias:e})}return null},getAlias:function(e,t){for(var r=Kekule.IsotopeAliasUtil.getAllAlias(),i=0,n=r.length;i<n;++i){var o=r[i];if(o.atomicNumber===e&&o.massNumber===t)return o.alias}return null}},Kekule.IsotopesDataUtil={_getElementItem:function(e){var t;if(t="number"==typeof e?e:Kekule.ChemicalElementsDataUtil.getAtomicNumber(e),!(n=Kekule.isotopesData[t-1])||n.atomicNumber!=t)for(var r=0,i=Kekule.isotopesData.length;r<i;++r){var n;if((n=Kekule.isotopesData[r])&&n.atomicNumber==t)break}return n},getAllIsotopeInfos:function(e){var t=Kekule.IsotopesDataUtil._getElementItem(e);return t?t.isotopes:null},getIsotopeInfo:function(e,t){var r=null;if(!t&&"string"==typeof e&&(r=Kekule.IsotopeAliasUtil.getAliasInfo(e)))return r;var i=Kekule.IsotopesDataUtil._getElementItem(e),n=i.isotopes;if(n){if(t)for(var o=0,a=n.length;o<a&&(!(r=n[o])||r.massNumber!=t);++o);else 1===n.length&&(r=n[0]);if(r)return r.elementSymbol=i.elementSymbol,r}return null},getIsotopeInfoById:function(e){var t=Kekule.IsotopesDataUtil.getIsotopeIdDetail(e);return Kekule.IsotopesDataUtil.getIsotopeInfo(t.symbol,t.massNumber)},isMassNumberAvailable:function(e,t){return!!Kekule.IsotopesDataUtil.getIsotopeInfo(e,t)},getIsotopeId:function(e,t){if("string"!=typeof e||t){var r=Kekule.IsotopeAliasUtil.getAlias(e,t);if(r)return r}else{if(Kekule.IsotopeAliasUtil.getAliasInfo(e))return e}var i=Kekule.ChemicalElementsDataUtil.getElementInfo(e);if(!i)return null;var n=i.symbol;return t?n+t.toString():n},getIsotopeIdDetail:function(e){if(!e)return null;for(var t="",r="",i=0,n=e.length;i<n;++i){var o=e.charAt(i);o>="0"&&o<="9"?r+=o:t+=o}var a=r?parseInt(r,10):null,s={symbol:t};return a&&(s.massNumber=a),s},isIsotopeIdAvailable:function(e){var t=Kekule.IsotopesDataUtil.getIsotopeIdDetail(e);if(Kekule.IsotopeAliasUtil.getAliasInfo(e))return!0;var r=Kekule.ChemicalElementsDataUtil.isElementSymbolAvailable(t.symbol);r&&t.massNum&&(r=!!Kekule.IsotopesDataUtil.getIsotopeInfo(t.symbol,t.massNum));return r}},Kekule.AtomTypeDataUtil={getAtomTypeInfoObj:function(e){var t;t="number"==typeof e?e:Kekule.ChemicalElementsDataUtil.getAtomicNumber(e);var r=Kekule.structGenAtomTypesData[t-1];if(r&&r.atomicNumber==t)return r;for(var i=0,n=Kekule.structGenAtomTypesData.length;i<n;++i)if((r=Kekule.structGenAtomTypesData[i])&&r.atomicNumber==t)return r;return null},getAllAtomTypes:function(e){var t=Kekule.AtomTypeDataUtil.getAtomTypeInfoObj(e);return t?t.atomTypes:null},getAtomTypeFromId:function(e,t){if(!e){for(var r="",i=0,n=t.length;i<n;++i){var o=t.chatAt(i);(o<"0"||o>"9")&&(r+=o)}e=r}if(e){var a=Kekule.AtomTypeDataUtil.getAllAtomTypes(e);for(i=0,n=a.length;i<n;++i)if(a[i].id==t)return a[i]}return null}},function(e){var t=Kekule.$jsRoot||e;Kekule.EmscriptenUtils={DEF_MODULE_NAME:"Module",_createdModules:{},_getActualModule:function(e){return t[e||r.DEF_MODULE_NAME]},isSupported:function(e){return void 0!==r._getActualModule(e)},getRootModule:function(e,t){var i=r._createdModules[e];if(i)return i;var n=r._getActualModule(e);return i=n,"function"==typeof n&&(i=n(t)),i&&(r._createdModules[e]=i),i},setRootModule:function(e,t){r._createdModules[e]=t},getModuleObj:function(e){return"object"==typeof e?e:r.getRootModule(e)},getMember:function(e,t){return(r.getModuleObj(t)||{})[e]},getClassCtor:function(e,t){return(r.getModuleObj(t)||{})[e]},cwrap:function(e,t,i,n){var o=r.getModuleObj(n);return o&&o.cwrap&&o.cwrap(e,t,i)},initModule:function(e,t,i){e||(e=Kekule.$jsRoot.document);var n=t.moduleName,o=t.moduleInitEventName,a=t.moduleInitCallbackName,s=t.creationOptions,l=function(e){i&&i(e)};if(r.isModuleReady(n))l();else try{if(o&&e&&Kekule.X){var u=function(){l(),Kekule.X.Event.removeListener(e,o,u)};Kekule.X.Event.addListener(e,o,u)}else a&&(Kekule.$jsRoot[a]=function(){l()});n&&r.getRootModule(n,s)}catch(e){throw l(e),e}},isModuleReady:function(e){return!!r._createdModules[e]},ensureModuleReady:function(e,t,i){return r.initModule(e,t,i)},loadScript:function(e,t,i,n){i||(i=Kekule.$jsRoot.document);var o=function(e){e?t(e):r.initModule(i,n,t)};if(Kekule.environment.isNode)try{var a=Kekule.environment.nodeRequire(e);n.moduleName&&(Kekule.$jsRoot[n.moduleName]=a),o()}catch(e){throw o(e),e}else Kekule.ScriptFileUtils.appendScriptFile(i,e,o)}};var r=Kekule.EmscriptenUtils}(this),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("extra.openbabel"),Kekule.Localization.addResource("en","ErrorMsg",{OpenBabel:{CHEM_NODE_TYPE_NOT_SUITABLE:"Unsuitable node type",CHEM_CONNECTOR_TYPE_NOT_SUITABLE:"Unsuitable connector type",ONLY_STR_INPUT_DATA_ALLOWED:"Input data must be text",ONLY_STR_OUTPUT_DATA_ALLOWED:"Output data must be text",FAIL_TO_GENERATE_3D_STRUCTURE:"Fail to generate 3D structure coordinates"}}),function(){var e=Kekule.EmscriptenUtils,t={usingModulaize:!0,moduleName:"OpenBabelModule",moduleInitEventName:"OpenBabel.Initialized",moduleInitCallbackName:"__$openBabelInitialized$__"};Kekule.OpenBabel={_autoEnabled:!0,_module:null,SCRIPT_FILE:"openbabel.js",_enableFuncs:[],BondOrder:{SINGLE:1,DOUBLE:2,TRIPLE:3,EXPLICIT_AROMATIC:5},getObInitOptions:function(){return t},getModule:function(){return r._module||(r._module=e.getRootModule(t.moduleName,t)),r._module},setModule:function(i){r._module=i,e.setRootModule(t.moduleName,i)},getMember:function(t){return e.getMember(t,r.getModule())},getClassCtor:function(t){return e.getClassCtor(t,r.getModule())},isScriptLoaded:function(){return e.isSupported(t.moduleName)},isModuleReady:function(){return e.isModuleReady(t.moduleName)},enable:function(e){r.isScriptLoaded()?(r._enableAllFunctions(),e&&e()):r.loadObScript(Kekule.$jsRoot.document,function(t){Kekule.OpenBabel.AdaptUtils.isAvailable()&&(t||r._enableAllFunctions(),e&&e(t))})},_enableAllFunctions:function(){if(r.isModuleReady())for(var e=r._enableFuncs,t=0,i=e.length;t<i;++t){var n=e[t];n&&n()}}};var r=Kekule.OpenBabel;Kekule._registerAfterLoadSysProc(function(){r._autoEnabled&&r.isScriptLoaded()&&e.ensureModuleReady(Kekule.$jsRoot.document,t,r._enableAllFunctions)}),Kekule.OpenBabel.getObPath=function(){var e=Kekule.environment.getEnvVar("openbabel.path");e||(e=Kekule.isUsingMinJs()?"extra/":"_extras/OpenBabel/",e=Kekule.getScriptPath()+e);return e},Kekule.OpenBabel.getObScriptUrl=function(){var e=Kekule.environment.getEnvVar("openbabel.scriptSrc");e||(e=Kekule.OpenBabel.getObPath()+Kekule.OpenBabel.SCRIPT_FILE,Kekule.isUsingMinJs()||(e+=".dev"));return e},Kekule.OpenBabel.loadObScript=function(i,n){i||(i=Kekule.$jsRoot.document);var o=function(e){r._obScriptLoadedBySelf=!e,n&&n(e)};if(r._obScriptLoadedBySelf||r.isScriptLoaded())o();else{var a=Kekule.OpenBabel.getObScriptUrl();e.loadScript(a,o,i,t)}},Kekule.OpenBabel.AdaptUtils={DEF_ATOM_ID_PREFIX:"A",DEF_BOND_ID_PREFIX:"B",DEF_MOL_ID_PREFIX:"M",wrapCFuncs:function(){if(!Kekule.OpenBabel._funcInited){Object.extend(Kekule.OpenBabel,{}),Kekule.OpenBabel._funcInited=!0}},isAvailable:function(){return void 0!==r.getClassCtor("ObBaseHelper")},obObjToKekule:function(e,t,r){var i=Kekule.OpenBabel.AdaptUtils,n=Kekule.ObjUtils.getPrototypeOf(e).constructor.name;return("OBReaction"===n?i.obReactionToKekule:"OBMol"===n?i.obMolToKekule:i.obBaseToKekule)(e,t,r)},kObjToOB:function(e,t,r){var i=Kekule.OpenBabel.AdaptUtils,n=e instanceof Kekule.Reaction?i.kReactionToOB:e instanceof Kekule.StructureFragment?i.kMolToOB:null;return n?n(e,t,r):null},kIdToOB:function(e){var t=parseInt(e,10);return t||null},obBondOrderToKekule:function(e){return e<=3?e:e===Kekule.OpenBabel.BondOrder.EXPLICIT_AROMATIC?Kekule.BondOrder.EXPLICIT_AROMATIC:Kekule.BondOrder.OTHER},kBondOrderToOB:function(e){return e<=3?e:e===Kekule.BondOrder.EXPLICIT_AROMATIC?Kekule.OpenBabel.BondOrder.EXPLICIT_AROMATIC:0},obBaseToKekule:function(e,t){var i=t||new Kekule.ChemObject,n=new(r.getClassCtor("ObBaseHelper"))(e),o=n.getTitle();o&&i.setName&&i.setName(o);var a=n.getDataSize();if(a)for(var s=i.getInfo(!0),l=0;l<a;++l){var u=n.getDataAt(l);if(u){var d=u.GetAttribute(),c=u.GetValue();d&&c&&(s[d]=c)}}return i},kChemObjToOB:function(e,t){var i=t||new(r.getClassCtor("OBBase"));e.getName&&i.SetTitle&&i.SetTitle(e.getName());var n=e.getInfo();if(n)for(var o=Kekule.ObjUtils.getOwnedFieldNames(n),a=0,s=o.length;a<s;++a){var l=o[a],u=n[l];if(l&&u){var d=new(r.getClassCtor("OBPairData"));d.SetAttribute(""+l),d.SetValue(""+u),i.SetData(d)}}},obAtomToKekule:function(e,t,r){var i=e.GetAtomicNum(),n=i?Kekule.Atom:Kekule.SubGroup;!t||t instanceof n||Kekule.Error(Kekule.$L("ErrorMsg.OpenBabel.CHEM_NODE_TYPE_NOT_SUITABLE"));var o,a=t||new n;return Kekule.OpenBabel.AdaptUtils.obBaseToKekule(e,a),o=e.GetId(),Kekule.ObjUtils.notUnset(o)&&a.setId(Kekule.OpenBabel.AdaptUtils.DEF_ATOM_ID_PREFIX+o),(o=e.GetFormalCharge())&&a.setCharge(o),(o=e.GetSpinMultiplicity())&&a.setRadical(o),o={x:e.GetX(),y:e.GetY()},r===Kekule.CoordMode.COORD3D&&(o.z=e.GetZ()),a.setAbsCoordOfMode?a.setAbsCoordOfMode(o,r):a.setCoordOfMode(o,r),a instanceof Kekule.Atom&&(i&&a.setAtomicNumber(i),(o=e.GetIsotope())&&a.setMassNumber(o),(o=e.GetHyb())&&a.setHybridizationType(o)),a},kChemNodeToOB:function(e,t,i){var n,o=t||new(r.getClassCtor("OBAtom"));if(n=e.getId(),n=Kekule.OpenBabel.AdaptUtils.kIdToOB(n),Kekule.ObjUtils.notUnset(n)&&o.SetId(n),n=e.getCharge())if(parseInt(n,10)===parseFloat(n))o.SetFormalCharge(n);else{var a=parseInt(n,10),s=n-a;o.SetFormalCharge(a),o.SetPartialCharge(s)}if((n=e.getRadical())&&o.SetSpinMultiplicity(n),n=e.getAbsCoordOfMode?e.getAbsCoordOfMode(i):e.getCoordOfMode(i),o.SetVector(n.x||0,n.y||0,n.z||0),e instanceof Kekule.Atom){o.SetAtomicNum(e.getAtomicNumber()),(n=e.getMassNumber())&&o.SetIsotope(n),(n=e.getHybridizationType())&&o.SetHyb(n);var l=e.getImplicitHydrogenCount();l&&o.SetImplicitHCount(l)}else o.SetAtomicNum(0);return o},obBondToKekule:function(e,t,r){var i,n=t||new Kekule.Bond;Kekule.OpenBabel.AdaptUtils.obBaseToKekule(e,n),i=e.GetId(),Kekule.ObjUtils.notUnset(i)&&n.setId(Kekule.OpenBabel.AdaptUtils.DEF_BOND_ID_PREFIX+i),i=e.GetBondOrder(),n.setBondOrder(Kekule.OpenBabel.AdaptUtils.obBondOrderToKekule(i));var o=Kekule.BondStereo;if(i=e.IsWedge()?o.UP:e.IsHash()?o.DOWN:e.IsWedgeOrHash()?o.UP_OR_DOWN:e.IsCisOrTrans()?o.CIS_OR_TRANS:e.IsDoubleBondGeometry()?o.E_Z_BY_COORDINATES:o.NONE,n.setStereo(i),console.log(e.GetFlags().toString(2)),r){i=null;for(var a=[e.GetBeginAtom(),e.GetEndAtom()],s=0,l=a.length;s<l;++s){var u=a[s];u&&(i=r.get(u.GetIdx()))&&n.appendConnectedObj(i)}}return n},kBondToOB:function(e,t,i,n){var o=t||new(r.getClassCtor("OBBond"));Kekule.OpenBabel.AdaptUtils.kChemObjToOB(e,o),d=Kekule.OpenBabel.AdaptUtils.kIdToOB(e.getId()),Kekule.ObjUtils.notUnset(d)&&o.SetId(d),(d=e.getBondOrder())&&(o.SetBondOrder(Kekule.OpenBabel.AdaptUtils.kBondOrderToOB(d)),d===Kekule.BondOrder.EXPLICIT_AROMATIC&&o.SetAromatic()),o.UnsetHash(),o.UnsetWedge(),o.UnsetUp(),o.UnsetDown(),o.UnsetAromatic();var a=Kekule.BondStereo;if((d=e.getStereo())===a.UP?o.SetWedge(!0):d===a.DOWN?o.SetHash(!0):d===a.UP_OR_DOWN&&o.SetWedgeOrHash(!0),i)for(var s=0,l=0,u=e.getConnectedObjCount();l<u;++l){var d,c=e.getConnectedObjAt(l);if(c&&c instanceof Kekule.ChemStructureNode)if((d=i.get(c))&&(0===s?o.SetBegin(d):1===s&&o.SetEnd(d),++s),d.AddBond&&d.AddBond(o),s>1)break}return o},obMolToKekule:function(e,t,i){var n=t,o=new(r.getClassCtor("ObConversionWrapper"));try{o.setOutFormat("","mol");var a=o.writeString(e,!1),s=Kekule.IO.loadFormatData(a,Kekule.IO.DataFormat.MOL);n?n.assign(s):n=s,s.finalize()}finally{o.delete()}if(Kekule.OpenBabel.AdaptUtils.obBaseToKekule(e,n),i){var l;if((l=e.NumAtoms())===n.getNodeCount())for(var u=0;u<l;++u){var d=e.GetAtom(u+1);if(d){var c=n.getNodeAt(u);c&&i.set(d,c)}}if((l=e.NumBonds())===n.getConnectorCount())for(u=0;u<l;++u){var h=e.GetBond(u);if(h){var p=n.getConnectorAt(u);p&&i.set(h,p)}}}return n},kMolToOB:function(e,t,i){var n=e.nodesHasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D,o=t||new(r.getClassCtor("OBMol"));t&&o.Clear();for(var a=new Kekule.MapEx(!1),s=e.getFlattenedShadowFragment(!0),l=0,u=s.getNodeCount();l<u;++l){var d=s.getNodeAt(l);if(d){var c=Kekule.OpenBabel.AdaptUtils.kChemNodeToOB(d,o.NewAtom(),n);if(c&&(a.set(d,c),i)){var h=e.getFlatternedShadowSourceObj(d);i.set(h,c)}}}for(l=0,u=s.getConnectorCount();l<u;++l){var p=s.getConnectorAt(l);if(p&&p instanceof Kekule.Bond){var g=Kekule.OpenBabel.AdaptUtils.kBondToOB(p,o.NewBond(),a,o);if(i&&g){var f=e.getFlatternedShadowSourceObj(p);i.set(f,g)}}}return a.finalize(),a=null,o},obReactionToKekule:function(e,t,r){var i=t||new Kekule.Reaction;i.clearAll(),Kekule.OpenBabel.AdaptUtils.obBaseToKekule(e,i),i.setDirection(e.IsReversible()?Kekule.ReactionDirection.BIDIRECTION:Kekule.ReactionDirection.FORWARD);for(var n=0,o=e.NumReactants();n<o;++n){var a=e.GetReactant(n),s=Kekule.OpenBabel.AdaptUtils.obMolToKekule(a,null,r);i.appendReactant(s),r&&r.set(a,s)}for(n=0,o=e.NumProducts();n<o;++n){a=e.GetProduct(n),s=Kekule.OpenBabel.AdaptUtils.obMolToKekule(a,null,r);i.appendProduct(s),r&&r.set(a,s)}return i},kReactionToOB:function(e,t,i){var n=t||new(r.getClassCtor("OBReaction"));n.Clear(),Kekule.OpenBabel.AdaptUtils.kChemObjToOB(e,n);var o=!1,a=e.getDirection();a===Kekule.ReactionDirection.BIDIRECTION?n.SetReversible(!0):a===Kekule.ReactionDirection.BACKWARD&&(o=!0);for(var s=0,l=e.getReactantCount();s<l;++s){if(d=e.getReactantAt(s)){var u=Kekule.OpenBabel.AdaptUtils.kMolToOB(d,null,i);o?n.AddProduct(u):n.AddReactant(u),i&&i.set(d,u)}}for(s=0,l=e.getProductCount();s<l;++s){var d;if(d=e.getProductAt(s)){u=Kekule.OpenBabel.AdaptUtils.kMolToOB(d,null,i);o?n.AddReactant(u):n.AddProduct(u),i&&i.set(d,u)}}}}}(),function(){Kekule.EmscriptenUtils;var e=Kekule.OpenBabel,t=Kekule.OpenBabel.AdaptUtils;Kekule.IO.OpenBabelReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.OpenBabelReader",initialize:function(e){this.tryApplySuper("initialize")},finalize:function(){this.tryApplySuper("finalize")},getFormatTargetObClassName:function(e){return e.getTypeName().toLowerCase().indexOf("reaction")>=0?"OBReaction":"OBMol"},doReadData:function(r,i,n){this._obConv=new(e.getClassCtor("ObConversionWrapper"));try{var o=Kekule.IO.DataFormatsManager.getFormatInfo(n),a=(o.mimeType,o.fileExts[0],this._obConv.setInFormatId(o.id)),s=this.getFormatTargetObClassName(a);try{var l=[];this._obConv.setInStr(r);for(var u=new(e.getClassCtor(s)),d=this._obConv.readFromInput(u);d;){if(u.NumAtoms&&u.NumAtoms()>0){var c=t.obObjToKekule(u);l.push(c)}d=this._obConv.readFromInput(u)}var h=l.length;if(h<=0)return null;if(1===h)return l[0];for(var p=new Kekule.ChemObjList,g=0;g<h;++g)p.append(l[g]);return p}finally{u&&(u.delete(),u=null)}}finally{this._obConv&&(this._obConv.delete(),this._obConv=null)}}}),Kekule.IO.OpenBabelWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.OpenBabelWriter",initialize:function(e){this.tryApplySuper("initialize",[e])},finalize:function(){this.tryApplySuper("finalize")},doWriteData:function(r,i,n){this._obConv=new(e.getClassCtor("ObConversionWrapper"));try{var o=Kekule.IO.DataFormatsManager.getFormatInfo(n);o.mimeType,o.fileExts[0];this._obConv.setOutFormatId(o.id);for(var a=Kekule.ChemStructureUtils.getChildStructureObjs(r,!0),s=0,l=a.length;s<l;++s){var u=a[s];if(u){var d=t.kObjToOB(u);if(d)try{if(!this._obConv.writeToOutput(d))break}finally{d.delete(),d=null}}}return this._obConv.getOutStr()}finally{this._obConv&&this._obConv.delete()}},isAllowedObj:function(e){var t=Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES;return Kekule.ObjUtils.isInstanceOf(e,t)}}),Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES=[Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace],Kekule.OpenBabel.IORegHelper=Class.create({listFormatInfo:function(e,t){for(var r=[],i=("in"===e?t.getSupportedInputFormatsStr("\n"):t.getSupportedOutputFormatsStr("\n")).split("\n"),n=0,o=i.length;n<o;++n){var a=i[n],s=a.indexOf("--");if(s>0){var l=a.substring(0,s).trim(),u=t.getFormatInfoById(l);r.push(u)}}return r},registerByInfos:function(e,t){for(var r=Kekule.IO.DataFormatsManager,i=[],n=0,o=e.length;n<o;++n){var a=e[n],s=a.id,l=a.mimeType;if((u=r.findFormatId(l))&&(u=r.findFormatId(null,s)),!u)var u=r.register(s,l,s,Kekule.IO.ChemDataType.UNKNOWN,a.description,a.description,{specificationUrl:a.specificationURL}).id;("in"===t?Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(u):Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(u))||Kekule.ArrayUtils.pushUnique(i,u)}i.length&&("in"===t?Kekule.IO.ChemDataReaderManager.register("openbabel",Kekule.IO.OpenBabelReader,i):Kekule.IO.ChemDataWriterManager.register("openbabel",Kekule.IO.OpenBabelWriter,Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES,i))},registerAll:function(){var t=new(e.getClassCtor("ObConversionWrapper"));try{var r=this.listFormatInfo("in",t);this.registerByInfos(r,"in");r=this.listFormatInfo("out",t);this.registerByInfos(r,"out")}finally{t.delete()}}}),Kekule.IO.registerAllOpenBabelFormats=function(){if(Kekule.OpenBabel.AdaptUtils.isAvailable())try{var e=new Kekule.OpenBabel.IORegHelper;e.registerAll()}finally{e=null}},Kekule.OpenBabel._enableFuncs.push(Kekule.IO.registerAllOpenBabelFormats),Kekule.IO.enableOpenBabelFormats=function(){Kekule.OpenBabel.AdaptUtils.isAvailable()?Kekule.IO.registerAllOpenBabelFormats():Kekule.OpenBabel.loadObScript(document,function(){Kekule.IO.registerAllOpenBabelFormats()})}}(),function(){"use strict";Kekule.EmscriptenUtils;var e=Kekule.OpenBabel,t=Kekule.OpenBabel.AdaptUtils;Kekule.OpenBabel.StructUtils={generate2DStructure:function(e,r,i){var n=r||{};try{var o=new Kekule.MapEx,a=new Kekule.MapEx,s=t.kObjToOB(e,null,o);if(Kekule.OpenBabel.StructUtils._gen2DByObOperation(s,n)||(s.delete(),s=null),s){if(e=t.obObjToKekule(s,null,a),i)for(var l=o.getKeys(),u=0,d=l.length;u<d;++u){var c=l[u],h=o.get(c);if(h){var p=a.get(h);p&&i.set(c,p)}}}else Kekule.raise(Kekule.$L("ErrorMsg.OpenBabel.FAIL_TO_GENERATE_3D_STRUCTURE"))}finally{s&&s.delete()}return e},generate3DStructure:function(r,i,n){var o,a=i||{},s=a.forceField;try{var l=new Kekule.MapEx,u=new Kekule.MapEx,d=t.kObjToOB(r,null,l);if(a.applyFFCalc){var c=new(e.getClassCtor("OB3DGenWrapper"));try{c.generate3DStructure(d,s||"")}finally{c.delete()}}else Kekule.OpenBabel.StructUtils._gen3DByObOperation(d,a)||(d.delete(),d=null);if(d){if(o=t.obObjToKekule(d,null,u),n)for(var h=l.getKeys(),p=0,g=h.length;p<g;++p){var f=h[p],C=l.get(f);if(C){var m=u.get(C);m&&n.set(f,m)}}}else Kekule.raise(Kekule.$L("ErrorMsg.OpenBabel.FAIL_TO_GENERATE_3D_STRUCTURE"))}finally{d&&d.delete()}return o},_gen2DByObOperation:function(t,r){var i=!1,n=e.getModule().OBOp.FindType("Gen2D");if(n){var o=""+r.speed||"";n.Do(t,o),i=!0}return i},_gen3DByObOperation:function(t,r){var i=""+r.speed||"",n=!1,o=e.getModule().OBOp.FindType("Gen3D");return o&&(o.Do(t,i),n=!0),n}},Kekule.Calculator&&(Kekule.Calculator.ObStructureBaseGenerator=Class.create(Kekule.Calculator.AbstractStructureGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructureBaseGenerator",isWorkerShared:function(){return!0},getGeneratorCoordMode:function(){return 2===this.getOutputDimension()?Kekule.CoordMode.COORD2D:Kekule.CoordMode.COORD3D},getOutputDimension:function(){return 3},_getInputMsgName:function(){return"gen"+this.getOutputDimension()+"D"},_getOutputMsgName:function(){return"output"+this.getOutputDimension()+"D"},getObInitOptions:function(){return Kekule.OpenBabel.getObInitOptions()},getForceField:function(){return this.getOptions().forceField},doGetWorker:function(){var e=this.tryApplySuper("doGetWorker");return e||(e=Kekule.Calculator.ObStructureBaseGenerator._worker),e},_requestImportingObScriptInWorker:function(){var e=Kekule.OpenBabel.getObScriptUrl();this.importWorkerScriptFile(e)},createWorker:function(){var e=this.tryApplySuper("createWorker");if(e){this._requestImportingObScriptInWorker();var t=this.getObInitOptions();this.postWorkerMessage({type:"obInit",usingModulaize:t.usingModulaize,moduleName:t.moduleName,initCallbackName:t.moduleInitCallbackName}),Kekule.Calculator.ObStructureBaseGenerator._worker=e}return e},getWorkerScriptFile:function(){return Kekule.OpenBabel.getObPath()+"kekule.worker.obStructureGenerator.js"},doReactWorkerMessage:function(e,t){if(this.tryApplySuper("doReactWorkerMessage",[e,t]),e.type===this._getOutputMsgName()){var r=e.molData;if(r){var i=Kekule.IO.loadMimeData(r,"chemical/x-mdl-molfile"),n=this.getChildObjMap();if(n){for(var o=this.getSourceMol().getFlattenedShadowFragment(!0),a=0,s=o.getNodeCount();a<s;++a)n.set(o.getNodeAt(a),i.getNodeAt(a));for(a=0,s=o.getConnectorCount();a<s;++a)n.set(o.getConnectorAt(a),i.getConnectorAt(a))}this.setGeneratedMol(i),this.done()}}},workerStartCalc:function(e){this._requestImportingObScriptInWorker();var t=this.getSourceMol().getFlattenedShadowFragment(!0),r=Kekule.IO.saveMimeData(t,"chemical/x-mdl-molfile"),i=Object.extend(this.getOptions(),{type:this._getInputMsgName(),molData:r});this.postWorkerMessage(i)},doExecuteSync:function(e){if(Kekule.OpenBabel){var t=this;Kekule.OpenBabel.loadObScript(null,function(){var r;try{var i=(2===t.getOutputDimension()?Kekule.OpenBabel.StructUtils.generate2DStructure:Kekule.OpenBabel.StructUtils.generate3DStructure)(t.getSourceMol(),t.getOptions());t.setGeneratedMol(i)}catch(e){throw r=e,e}return r||t.done(),e&&e(r),!0})}else Kekule.error(Kekule.$L("ErrorMsg.MODULE_NOT_LOADED").format("OpenBabel"));return!1}}),Kekule.Calculator.ObStructure3DGenerator=Class.create(Kekule.Calculator.ObStructureBaseGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructure3DGenerator",getOutputDimension:function(){return 3}}),Kekule.Calculator.ObStructure2DGenerator=Class.create(Kekule.Calculator.ObStructureBaseGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructure2DGenerator",getOutputDimension:function(){return 2}}),Kekule.Calculator.ServiceManager.register(Kekule.Calculator.Services.GEN3D,Kekule.Calculator.ObStructure3DGenerator,"openbabel",10),Kekule.Calculator.ServiceManager.register(Kekule.Calculator.Services.GEN2D,Kekule.Calculator.ObStructure2DGenerator,"openbabel",10))}(),function(e){"use strict";var t=Kekule.$jsRoot||e||{},r=Kekule.EmscriptenUtils,i={usingModulaize:!0,moduleName:"IndigoModule",moduleInitEventName:"Indigo.Initialized",moduleInitCallbackName:"__$indigoInitialized$__",indigoAdaptFuncName:"CreateIndigo"};Kekule.Indigo={_autoEnabled:!0,_module:null,_indigo:null,SCRIPT_FILE:"indigo.js",HELPER_SCRIPT_FILE:"indigoAdapter.js",_enableFuncs:[],isScriptLoaded:function(){return r.isSupported(i.moduleName)&&void 0!==t[i.indigoAdaptFuncName]},getIndigoInitOptions:function(){return i},getModule:function(){return n._module||(n._module=r.getRootModule(i.moduleName,i)),n._module},setModule:function(e){n._module=e,r.setRootModule(i.moduleName,e)},getIndigo:function(){if(!n._indigo){var e=n.getModule();e&&(n._indigo=t[i.indigoAdaptFuncName](e))}return n._indigo},getClassCtor:function(e){return r.getClassCtor(e,n.getModule())},isAvailable:function(){return n.getModule()&&n.getIndigo()},enable:function(e){n.isScriptLoaded()?(n._enableAllFunctions(),e&&e()):n.loadIndigoScript(Kekule.$jsRoot.document,function(t){t||n._enableAllFunctions(),e&&e(t)})},_enableAllFunctions:function(){if(r.isModuleReady(i.moduleName))for(var e=n._enableFuncs,t=0,o=e.length;t<o;++t){var a=e[t];a&&a()}}},Kekule.Indigo.getIndigoPath=function(){var e=Kekule.environment.getEnvVar("indigo.path");e||(e=Kekule.isUsingMinJs()?"extra/":"_extras/Indigo/",e=Kekule.getScriptPath()+e);return e},Kekule.Indigo.getIndigoScriptUrl=function(){var e=Kekule.environment.getEnvVar("indigo.scriptSrc");e||(e=n.getIndigoPath()+n.SCRIPT_FILE,Kekule.isUsingMinJs()||(e+=".dev"));return e},Kekule.Indigo.getIndigoHelperScriptUrl=function(){return n.getIndigoPath()+n.HELPER_SCRIPT_FILE},Kekule.Indigo.loadIndigoScript=function(e,t){e||(e=Kekule.$jsRoot.document);var o=function(e){n._scriptLoadedBySelf=!e,e||Kekule.Indigo.getIndigo(),t&&t(e)};if(n._scriptLoadedBySelf||n.isScriptLoaded())o();else{var a=n.getIndigoScriptUrl();r.loadScript(a,function(t){t?o(t):Kekule.ScriptFileUtils.appendScriptFiles(e,[n.getIndigoHelperScriptUrl()],o)},e,i)}};var n=Kekule.Indigo;Kekule.Indigo.AdaptUtils={iMolToKekule:function(e){var t=n.getIndigo(),r=t.molfile(e);return t.free(e),Kekule.IO.loadFormatData(r,Kekule.IO.DataFormat.MOL)},kMolToIndigo:function(e){var t=n.getIndigo(),r=Kekule.IO.saveFormatData(e,Kekule.IO.DataFormat.MOL);return t.loadMoleculeFromString(r)}},Kekule._registerAfterLoadSysProc(function(){n._autoEnabled&&n.isScriptLoaded()&&r.ensureModuleReady(Kekule.$jsRoot.document,i,n._enableAllFunctions)})}(this),function(){"use strict";Kekule.EmscriptenUtils;var e=Kekule.Indigo;Kekule.IO.IndigoReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.IndigoReader",doReadData:function(t,r,i,n){var o=e.getIndigo(),a=o.loadMoleculeFromString(t);if(a>=0){if(i===Kekule.IO.DataFormat.SMILES){!n||n.autoLayout||Kekule.ObjUtils.isUnset(n.autoLayout);0}var s=o.molfile(a);return o.free(a),Kekule.IO.loadFormatData(s,Kekule.IO.DataFormat.MOL)}return null}}),Kekule.IO.registerAllIndigoFormats=function(){e.isAvailable()&&Kekule.IO.ChemDataReaderManager.register("Indigo-smiles",Kekule.IO.IndigoReader,Kekule.IO.DataFormat.SMILES)},Kekule.IO.enableIndigoFormats=function(){e.isAvailable()?Kekule.IO.registerAllIndigoFormats():e.loadIndigoScript(document,function(){Kekule.IO.registerAllIndigoFormats()})},e._enableFuncs.push(Kekule.IO.registerAllIndigoFormats)}(),function(){"use strict";var e=Kekule.Indigo;Kekule.Indigo.StructUtils={generate2DStructure:function(t,r,i){var n=e.getIndigo(),o=e.AdaptUtils.kMolToIndigo(t);return n.setOption("smart-layout","true"),n.layout(o),e.AdaptUtils.iMolToKekule(o)}},Kekule.Calculator&&(Kekule.Calculator.IndigoStructure2DGenerator=Class.create(Kekule.Calculator.AbstractStructureGenerator,{CLASS_NAME:"Kekule.Calculator.IndigoStructure2DGenerator",execute:function(e){var t,r;try{r=this.executeSync(e)}catch(e){t=e}t?(Kekule.error(t),this.error(t)):r&&(t?this.error(t):this.done())},doExecuteSync:function(e){if(Kekule.Indigo){var t=this;Kekule.Indigo.loadIndigoScript(null,function(){var r;try{var i=Kekule.Indigo.StructUtils.generate2DStructure(t.getSourceMol(),t.getOptions());t.setGeneratedMol(i)}catch(e){r=e}r||t.done(),e&&e(r)})}else Kekule.error(Kekule.$L("ErrorMsg.MODULE_NOT_LOADED").format("Indigo"));return!1}}),Kekule.Calculator.ServiceManager.register(Kekule.Calculator.Services.GEN2D,Kekule.Calculator.IndigoStructure2DGenerator,"indigo",0))}(),function(){"use strict";var e=Kekule.EmscriptenUtils,t={usingModulaize:!0,moduleName:"InChIModule",moduleInitEventName:"InChI.Initialized",moduleInitCallbackName:"__$inChIInitialized$__"};Kekule.InChI={_autoEnabled:!0,_scriptLoadedBySelf:!1,_module:null,_enableFuncs:[],SCRIPT_FILE:"inchi.js",isScriptLoaded:function(){return e.isSupported(t.moduleName)},getInchiInitOptions:function(){return t},getModule:function(){return r._module||(r._module=e.getRootModule(t.moduleName,t)),r._module},setModule:function(i){r._module=i,e.setRootModule(t.moduleName,i)},getInChIPath:function(){var e=Kekule.environment.getEnvVar("inchi.path");e||(e=Kekule.isUsingMinJs()?"extra/":"_extras/InChI/",e=Kekule.getScriptPath()+e);return e},getInChIScriptUrl:function(){var e=Kekule.environment.getEnvVar("inchi.scriptSrc");e||(e=r.getInChIPath()+r.SCRIPT_FILE,Kekule.isUsingMinJs()||(e+=".dev"));return e},loadInChIScript:function(i,n){i||(i=Kekule.$jsRoot.document);var o=function(e){r._scriptLoadedBySelf=!e,n&&n(e)};if(r._scriptLoadedBySelf||r.isScriptLoaded())o();else{var a=r.getInChIScriptUrl();e.loadScript(a,o,i,t)}},molDataToInChI:function(e,t){var i=r._molToInChI;i||(i=r.getModule().cwrap("molToInchiJson","string",["string","string"]));var n=i(e,t);return JSON.parse(n)},getInChIKeyFromInChI:function(e,t,i){var n=r._getInChIKeyFromInChI;n||(n=r.getModule().cwrap("getInChIKeyJson","string",["string","number","number"]));var o=n(e,t,i);return JSON.parse(o)},getInChIInfo:function(e){var t=Kekule.IO.saveFormatData(e,Kekule.IO.DataFormat.MOL);return r.molDataToInChI(t)},enable:function(e){r.isScriptLoaded()?(r._enableAllFunctions(),e&&e()):r.loadInChIScript(Kekule.$jsRoot.document,function(t){t||r._enableAllFunctions(),e&&e(t)})},_enableAllFunctions:function(){if(e.isModuleReady(t.moduleName))for(var i=r._enableFuncs,n=0,o=i.length;n<o;++n){var a=i[n];a&&a()}}};var r=Kekule.InChI;Kekule.IO.InChIWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.InChIWriter",doWriteData:function(e,t,i){var n=r.getInChIInfo(e);if(n&&n.inchi){var o=n.inchi;n.auxInfo&&(o+="\n"+n.auxInfo);var a=r.getInChIKeyFromInChI(n.inchi,1,1);return o+="\n"+JSON.stringify(a)}return null},isAllowedObj:function(e){var t=Kekule.IO.InChIWriter.ALLOWED_CLASSES;return Kekule.ObjUtils.isInstanceOf(e,t)}}),Kekule.IO.InChIWriter.ALLOWED_CLASSES=[Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace],Kekule.IO.registerAllInChIFormats=function(){if(r.isScriptLoaded()){Kekule.IO.DataFormat.INCHI="inchi",Kekule.IO.MimeType.INCHI="chemical/x-inchi",Kekule.IO.DataFormatsManager.register("inchi",Kekule.IO.MimeType.INCHI,"inchi",Kekule.IO.ChemDataType.TEXT,"InChI format"),Kekule.IO.ChemDataWriterManager.register("inchi",Kekule.IO.InChIWriter,Kekule.IO.InChIWriter.ALLOWED_CLASSES,"inchi")}},Kekule.IO.enableInChIFormats=function(){r.enable()},r._enableFuncs.push(Kekule.IO.registerAllInChIFormats),Kekule._registerAfterLoadSysProc(function(){r._autoEnabled&&r.isScriptLoaded()&&e.ensureModuleReady(Kekule.$jsRoot.document,t,r._enableAllFunctions)})}(),void 0!==Kekule&&Kekule._loaded(),"undefined"!=typeof module)try{module.exports={Class:Class,ClassEx:ClassEx,ObjectEx:ObjectEx,DataType:DataType,Kekule:Kekule}}catch(e){}